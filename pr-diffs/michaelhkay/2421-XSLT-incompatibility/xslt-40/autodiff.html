<!DOCTYPE HTML><html xmlns="http://www.w3.org/1999/xhtml" lang="EN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>XSL Transformations (XSLT) Version 4.0</title><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" type="text/css" href="css/w3c-base.css"><link rel="stylesheet" href="css/qtspecs.css"><link rel="stylesheet" href="css/xslt-40.css"><style type="text/css">
          body { margin-top: 50px }
          a.button { background: #DDD; border: 2px outset black; padding: 2px; margin: 2px; font-family: sans-serif; font-size: small;}
          a.button:hover { cursor:pointer; }
          a.button:active { border-style: inset; }
        </style><link rel="stylesheet" href="/css/autodiff.css"></head><body class="toc-inline"><div style="position:fixed; clear:both; top:0px" id="_autodiff_buttons"><p><a class="button" onclick="view('old')">
              View Old
            </a><a class="button" onclick="view('new')">
              View New
            </a><a class="button" onclick="view('both')">
              View Both
            </a><a class="button" onclick="view('only')">
              View Only
            </a><a class="button" onclick="scroll_to('prev')">
              Previous
            </a><a class="button" onclick="scroll_to('next')">
              Next
            </a><span id="__autodiff__"></span></p><p>This draft contains only sections that have differences from the version that it modified.</p></div><div class="head"><p><a href="https://www.w3.org/"><img src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" alt="W3C" height="48" width="72"></a></p><h1><a id="title"></a>XSL Transformations (XSLT) Version 4.0</h1><h2><a id="w3c-doctype"></a>W3C Editor's Draft <span class="deltaxml-old" style="background:#FF5555">30 January</span><span class="deltaxml-new" style="background:#90EE90">2 February</span> 2026</h2><dl><dt>This version:</dt><dd><a href="https://qt4cg.org/specifications/xslt-40/">https://qt4cg.org/specifications/xslt-40/</a></dd><dt>Latest version:</dt><dd><a href="https://qt4cg.org/specifications/xslt-40/">https://qt4cg.org/specifications/xslt-40/</a></dd><dt>Most recent Recommendation of XSL Transformations (XSLT):</dt><dd><a href="https://www.w3.org/TR/xslt-30/">https://www.w3.org/TR/xslt-30/</a></dd><dt>Editor:</dt><dd>Michael Kay, Saxonica <a href="http://www.saxonica.com/">&lt;http://www.saxonica.com/&gt;</a></dd></dl><p>The following associated resources are available: <a href="xslt-40.xml">Specification in XML format</a>, <a href="schema-for-xslt40.xsd">XSD 1.1 Schema for XSLT 4.0 Stylesheets (non-normative)</a>, <a href="schema-for-xslt40.rnc">Relax-NG Schema for XSLT 4.0 Stylesheets (non-normative)</a>, <a href="xml-to-json.xsl">Stylesheet for XML-to-JSON conversion (non-normative)</a></p><p class="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>&nbsp;©&nbsp;2026&nbsp;<a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p><hr></div><div><h2><a id="abstract"></a>Abstract</h2><p>This specification defines the syntax and semantics of XSLT 4.0, a language designed primarily for transforming XML documents into other XML documents, but also offering support for other data formats including JSON, HTML, and CSV.</p><p>XSLT 4.0 is a revised version of the XSLT 3.0 Recommendation <a href="#xslt-30">[XSLT 3.0]</a> published on 8 June 2017. Changes are presented in <a href="#whats-new-in-xslt4"><i>1.2 What’s New in XSLT 4.0?</i></a>. </p><p>XSLT 4.0 is designed to be used in conjunction with XPath 4.0, which is defined in <a href="#xpath-40">[XPath 4.0]</a>. XSLT shares the same data model as XPath 4.0, which is defined in <a href="#xpath-datamodel-40">[XDM 4.0]</a>, and it uses the library of functions and operators defined in <a href="#xpath-functions-40">[Functions and Operators 4.0]</a>. XPath 4.0 and the underlying function library introduce a number of enhancements, for example the availability of union and record types. </p><p><em>This document contains hyperlinks to specific sections or definitions within other documents in this family of specifications. These links are indicated visually by a superscript identifying the target specification: for example XP for XPath 4.0, DM for the XDM data model version 4.0, FO for Functions and Operators version 4.0, SG for XSLT Streaming version 4.0.</em></p><p>An optional feature of the XSLT language is support for streamed transformations. The XSLT 4.0 specification has been modularized so that streaming is now described in a separate specification document. This has been done in order to make the specifications more manageable, both for editors and readers: it does not alter the status of streaming as an optional feature, available in some processors and not others.</p></div><div><h2><a id="status"></a>Status of this Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document.</em></p><p>This document is a working draft developed and maintained by a W3C Community Group, the <a href="https://www.w3.org/community/xslt-40/">XQuery and XSLT Extensions Community Group</a> unofficially known as QT4CG (where "QT" denotes Query and Transformation). This draft is work in progress and should not be considered either stable or complete. Standard W3C copyright and patent conditions apply.</p><p>The community group welcomes comments on the specification. Comments are best submitted as issues on the group's <a href="https://github.com/qt4cg/qtspecs/issues">GitHub repository</a>.</p><p>The community group maintains two extensive test suites, one oriented to XQuery and XPath, the other to XSLT. These can be found at <a href="https://github.com/qt4cg/qt4tests">qt4tests</a> and <a href="https://github.com/qt4cg/xslt40-test">xslt40-test</a> respectively. New tests, or suggestions for correcting existing tests, are welcome. The test suites include extensive metadata describing the conditions for applicability of each test case as well as the expected results. They do not include any test drivers for executing the tests: each implementation is expected to provide its own test driver.</p><div class="dedication" id="dedication"><h3>Dedication</h3><p>The publications of this community group <a href="../xquery-40/xpath-40.html#dedication">are dedicated</a> to our co-chair, Michael Sperberg-McQueen&nbsp;(1954–2024).</p></div></div><hr><div class="body"><div class="_diffs div1"><h2><a id="stylesheet-structure"></a>3 <a href="#stylesheet-structure" style="text-decoration: none">Stylesheet Structure</a></h2><p>This section describes the overall structure of a stylesheet as a collection of XML documents.</p><div class="_diffs div2"><h3><a id="simplified-stylesheet"></a>3.7 <a href="#simplified-stylesheet" style="text-decoration: none">Simplified Stylesheet Modules</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#include">next</a> | <a href="#fixed-namespaces">previous</a>)</p><ol><li><p> Simplified stylesheets no longer require an <code>xsl:version</code> attribute (which means they might not need a declaration of the XSLT namespace). Unless otherwise specified, a 4.0 simplified stylesheet defaults <code>expand-text</code> to <code>true</code>. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/90">90</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/599">599</a>&nbsp;12 September 2023]</i></p></li><li><p> The outermost element of a simplified stylesheet need no longer be a literal result element, it can now be any instruction (including <a href="#element-result-document"><code>xsl:result-document</code></a>). This allows a simplified stylesheet to produce JSON output as well as XML or HTML. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2322">2322</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2323">2323</a>&nbsp;30 November 2025]</i></p></li></ol></div><p>A simplified syntax is allowed for a <a title="stylesheet module" class="termref" href="#dt-stylesheet-module">stylesheet module</a> that defines only a single template rule. A simplified stylesheet module consist of a single <a title="instruction" class="termref" href="#dt-instruction">instruction</a> or <a title="literal result element" class="termref" href="#dt-literal-result-element">literal result element</a> together with its contents. Such a stylesheet module is equivalent to a standard stylesheet module whose <a href="#element-stylesheet"><code>xsl:stylesheet</code></a> element contains a <a title="template rule" class="termref" href="#dt-template-rule">template rule</a> containing the instruction or literal result element; the template rule has a match <a title="pattern" class="termref" href="#dt-pattern">pattern</a> of <code>match="."</code>, which matches any item.</p><div class="example"><div class="exampleHeader"><a id="d4e10439"></a>Example: A Simplified Stylesheet</div><p>The following example shows a stylesheet that simply evaluates one XPath expression:</p><div class="exampleInner"><pre xml:space="preserve">&lt;out&gt;{count(//*)}&lt;/out&gt;</pre></div><p>The output of the stylesheet will be an XML document such as <code>&lt;out&gt;17&lt;/out&gt;</code> showing the number of elements found in the supplied source document.</p><p>This simplified stylesheet is defined to be equivalent to the following expanded stylesheet:</p><div class="exampleInner"><pre xml:space="preserve">&lt;xsl:stylesheet xmlns="http://www.w3.org/1999/XSL/Transform"
                  version="4.0" expand-text="yes"&gt;
    &lt;xsl:template match="."&gt;
        &lt;out&gt;{count(//*)}&lt;/out&gt;
    &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre></div><p>Because the stylesheet contains no elements or attributes in the XSLT namespace, it does not need to contain any namespace declarations.</p></div><p>A simplified stylesheet can contain XSLT instructions, in which case the XSLT namespace needs to be declared. This is illustrated in the next example.</p><div class="example"><div class="exampleHeader"><a id="d4e10454"></a>Example: A Simplified Stylesheet Containing XSLT Instructions</div><p>This stylesheet outputs an HTML document containing a table that summarizes the value of transactions according to their rate of tax:</p><div class="exampleInner"><pre xml:space="preserve">&lt;html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
      xsl:version="4.0"&gt;
  &lt;head&gt;
    &lt;title&gt;Expenditure by Tax Rate&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
           &lt;th&gt;Gross Amount&lt;/th&gt;
           &lt;th&gt;Tax Rate&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;xsl:for-each-group select="//transaction" group-by="vat-rate"&gt;
          &lt;tr&gt;
            &lt;td&gt;{sum(current-group()/value)}&lt;/td&gt;
            &lt;td&gt;{current-grouping-key()}&lt;/td&gt;
          &lt;/tr&gt;
        &lt;/xsl:for-each-group&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div></div><p>&nbsp;</p><div class="example"><div class="exampleHeader"><a id="d4e10459"></a>Example: A Simplified Stylesheet to Transform JSON</div><p>This example expects as input a parsed JSON document containing an array of records. It outputs a serialized JSON document containing a selection of fields from these records.</p><div class="exampleInner"><pre xml:space="preserve">&lt;xsl:result-document method="json" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:array&gt;
    &lt;xsl:for-each select="?*"&gt;
      &lt;xsl:record first="?firstName" 
                  last="?surname"
                  phone="?mobile"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:array&gt;
&lt;/xsl:result-document&gt;</pre></div></div><p>More formally, a simplified stylesheet module is equivalent to the standard stylesheet module that would be generated by applying the following transformation to the simplified stylesheet module, invoking the transformation by calling the <a title="named template" class="termref" href="#dt-named-template">named template</a><code>expand</code>, with the outermost element as the <a title="context node" class="termref" href="#dt-context-node">context node</a>: </p><div class="exampleInner"><pre xml:space="preserve">&lt;xsl:stylesheet version="4.0"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&amp;gt;

&lt;xsl:template name="expand"&gt;
  &lt;xsl:element name="xsl:stylesheet"&gt;
    &lt;xsl:variable name="version"
        select="(if (self::xsl:*) then @version else @xsl:version)
                   otherwise '4.0'"/&gt;
    &lt;xsl:attribute name="version" select="$version"/&gt;
    &lt;xsl:attribute name="expand-text" 
                   select="not(number($version) le 3.0)"/&gt;
    &lt;xsl:element name="xsl:template"&gt;
      &lt;xsl:attribute name="match" select="'.'"/&gt;
      &lt;xsl:copy-of select="."/&gt;
    &lt;/xsl:element&gt;
  &lt;/xsl:element&gt;
&lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</pre></div><p>The allowed content of an instruction or literal result element when used as a simplified stylesheet is the same as when it occurs within a <a title="sequence constructor" class="termref" href="#dt-sequence-constructor">sequence constructor</a>. Thus, a simplified stylesheet cannot contain <a title="declaration" class="termref" href="#dt-declaration">declarations</a>. In particular, simplified stylesheets therefore cannot use <a title="template rule" class="termref" href="#dt-template-rule">template rules</a>, <a title="global variable" class="termref" href="#dt-global-variable">global variables</a>, <a title="stylesheet parameter" class="termref" href="#dt-stylesheet-parameter">stylesheet parameters</a>, <a title="stylesheet function" class="termref" href="#dt-stylesheet-function">stylesheet functions</a>, <a title="key" class="termref" href="#dt-key">keys</a>, <a title="attribute set" class="termref" href="#dt-attribute-set">attribute-sets</a>, or <a title="output definition" class="termref" href="#dt-output-definition">output definitions</a>. Furthermore, they cannot contain <a href="#element-include"><code>xsl:include</code></a>, <a href="#element-import"><code>xsl:import</code></a>, or <a href="#element-use-package"><code>xsl:use-package</code></a> declarations.</p><p>The only useful way to initiate the transformation is to supply an item as the <a title="initial match selection" class="termref" href="#dt-initial-match-selection">initial match selection</a>, to be matched by the implicit <code>match="."</code> template rule using the <a title="unnamed mode" class="termref" href="#dt-unnamed-mode">unnamed mode</a>. </p><div class="note"><p class="prefix"><b>Note:</b></p><p>There are several significant changes to simplified stylesheets in XSLT 4.0.</p><ol class="enumar"><li><p>It is no longer required to include an <code>xsl:version</code> attribute; this in turn means it is often no longer necessary to declare the <code>xsl</code> namespace. The <code>xsl:version</code> attribute defaults to the version of the XSLT processor, that is, "4.0" for an XSLT 4.0 processor.</p></li><li><p>If the <code>xsl:version</code> attribute is omitted, or is set to "4.0" or a larger value, then the <code>expand-text</code> attribute defaults to <code>true</code>, meaning that <a title="text value template" class="termref" href="#dt-text-value-template">text value templates</a> are recognized.</p></li><li><p>The outermost element of a simplified stylesheet can be any instruction (for example, <code>xsl:array</code>, <code>xsl:map</code>, or <code>xsl:result-document</code>), allowing the stylesheet to deliver arrays, maps, or serialized JSON.</p></li><li><p><span style="display: none;" class="delete_version">The match pattern of the implicit template rule uses <code>match="."</code> rather than <code>match="/"</code>, allowing the <a class="termref" title="" href="#"></a> to be any item, not only a document node.</span><span style="display: none;" class="add_version">The match pattern of the implicit template rule uses <code>match="."</code> rather than <code>match="/"</code>, allowing the <a class="termref" title="initial match selection" href="#dt-initial-match-selection">initial match selection</a> to be any item, not only a document node.</span><span class="modify_version">The match pattern of the implicit template rule uses <code>match="."</code> rather than <code>match="/"</code>, allowing the <a class="termref" title="initial match selection" href="#dt-initial-match-selection"><span class="deltaxml-new" style="background:#90EE90">initial match selection</span></a> to be any item, not only a document node.</span></p><p><span class="deltaxml-new" style="background:#90EE90">There may be edge cases where this causes a backwards incompatibility. For example, if a transformation using a simplified stylesheet is invoked supplying an element node (rather than a document node) as the </span><a title="initial match selection" class="termref" href="#dt-initial-match-selection"><span class="deltaxml-new" style="background:#90EE90">initial match selection</span></a><span class="deltaxml-new" style="background:#90EE90">, then under 4.0 this will match the implicitly-defined template rule (</span><code><span class="deltaxml-new" style="background:#90EE90">match="."</span></code><span class="deltaxml-new" style="background:#90EE90"> matches an element node), whereas in 3.0 it would have been processed using the built-in template rules for the unnamed mode. A similar situation arises if a simplified stylesheet module is imported into a larger stylesheet package, and the implicitly-defined template rule is invoked using </span><a href="#element-next-match"><code><span class="deltaxml-new" style="background:#90EE90">xsl:next-match</span></code></a><span class="deltaxml-new" style="background:#90EE90"> or </span><a href="#element-apply-imports"><code><span class="deltaxml-new" style="background:#90EE90">xsl:apply-imports</span></code></a><span class="deltaxml-new" style="background:#90EE90">.</span></p></li></ol></div><div class="note"><p class="prefix"><b>Note:</b></p><p>It is technically valid for the outermost element to be <a href="#element-variable"><code>xsl:variable</code></a> or <a href="#element-param"><code>xsl:param</code></a>, because these are defined as <a title="" class="termref" href="#">instructions</a>; however, this achieves no useful purpose because the result of these instructions is an empty sequence.</p></div></div></div></div><div class="back"><div class="_diffs div1"><h2><a id="incompatibilities"></a>J <a href="#incompatibilities" style="text-decoration: none">Incompatibilities with XSLT 3.0</a> (Non-Normative)</h2><p>This section lists all known incompatibilities with XSLT 3.0, that is, situations where a stylesheet that is error-free according to the XSLT 3.0 specification and where all elements have an effective version of <code>3.0</code> or less, will produce different results depending on whether it is run under an XSLT 3.0 processor or an XSLT 4.0 processor.</p><ol class="enumar"><li><p>The rules for comparing values in <a href="#element-for-each-group"><code>xsl:for-each-group</code></a> now reference the rules for <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-distinct-values"><code>distinct-values</code></a>, which have themselves changed <span>to be compatible with <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-atomic-equal"><code>fn:atomic-equal</code></a></span>. This change eliminates the intransitivity in the previous specification, which meant that in edge cases involving rounding of numeric values of different types, two items in different groups could compare equal. Any change in behavior is confined to this edge case.</p></li><li><p>The rules for matching nodes against patterns using the <code>intersect</code> and <code>except</code> operators have changed to deliver a more intuitive result.</p></li><li><p>The rules for comparing values in <a title="key" class="termref" href="#dt-key">keys</a> have changed, to align with the rules for maps. The changes affect edge cases involving rounding of numeric values of different types, and the comparison of date/time values with and without timezones.</p></li><li><p>In previous versions, a template rule whose match pattern was a union pattern and that had no explicity priority was treated as equivalent to a set of template rules, one for each alternative in the union, each potentially with different default priority. This rule has not been carried forward into XSLT 4.0: instead, the priority of the rule is taken as being the highest priority of any of the alternatives.</p></li><li><p>In XSLT 4.0, an <a href="#element-apply-imports"><code>xsl:apply-imports</code></a> or <a href="#element-next-match"><code>xsl:next-match</code></a> instruction automatically passes on the values of any non-tunnel parameters that were present in its own invocation. This means that the template rule invoked by <a href="#element-apply-imports"><code>xsl:apply-imports</code></a> or <a href="#element-next-match"><code>xsl:next-match</code></a>, if it declares a default value for such a parameter, will take the implicitly-supplied value in preference to the default value.</p><p>This change in the specification applies only if the <a title="effective version" class="termref" href="#dt-effective-version">effective version</a> of the <a href="#element-apply-imports"><code>xsl:apply-imports</code></a> or <a href="#element-next-match"><code>xsl:next-match</code></a> is 4.0 or greater. This means that 3.0 behavior can be retained by adding the attribute <code>version="3.0"</code> to the instruction, or to some ancestor element (for example, the <a href="#element-stylesheet"><code>xsl:stylesheet</code></a> or <code>xsl:transform</code> element).</p></li><li class="add_version" style="display: none;"><p>A <a title="" class="termref" href="#"></a> module in XSLT 4.0 defines a template rule whose implicit match pattern is <code>match="."</code> (matching any item), whereas in XSLT 3.0 the implicit match pattern was <code>match="/"</code> (matching document nodes only). This change is made to allow such stylesheets to be used to process JSON input, but it also has the effect of changing the behavior of the stylesheet if it is applied to other items, such as element or text nodes.</p></li><li class="modify_version"><p><span class="deltaxml-new" style="background:#90EE90">A </span><a title="" class="termref" href="#"></a><span class="deltaxml-new" style="background:#90EE90"> module in XSLT 4.0 defines a template rule whose implicit match pattern is </span><code><span class="deltaxml-new" style="background:#90EE90">match="."</span></code><span class="deltaxml-new" style="background:#90EE90"> (matching any item), whereas in XSLT 3.0 the implicit match pattern was </span><code><span class="deltaxml-new" style="background:#90EE90">match="/"</span></code><span class="deltaxml-new" style="background:#90EE90"> (matching document nodes only). This change is made to allow such stylesheets to be used to process JSON input, but it also has the effect of changing the behavior of the stylesheet if it is applied to other items, such as element or text nodes.</span></p></li></ol><p>This specification also corrects a number of errors and omissions in XSLT 3.0, in a way that might create incompatibilities for some processors, depending on how they interpreted the XSLT 3.0 specification:</p><ol class="enumar"><li><p>XSLT 3.0 (and earlier releases) did not fully define the evaluation context for the default values of template parameters. For example, if the default value of a parameter of a template rule invoked <a href="#element-next-match"><code>xsl:next-match</code></a>, it was not specified whether the current template rule should be the calling template or the called template. This omission has been corrected.</p></li><li><p>Where different packages import different schemas, the specification is now more prescriptive about which schema is used for validation. The rules may differ from the conventions adopted by implementations of XSLT 3.0.</p></li><li><p>XSLT 3.0 failed to specify a default value for the serialization parameter <code>indent</code> where the serialization method is <code>json</code> or <code>adaptive</code>. XSLT 4.0 specifies a default value of <code>no</code>.</p></li></ol><p>See also <a href="#xpath-40">[XPath 4.0]</a>, <a href="#xpath-functions-40">[Functions and Operators 4.0]</a>, and <a href="#xslt-xquery-serialization-40">[Serialization 4.0]</a> for incompatibilities in other related specifications that may affect XSLT stylesheets.</p></div></div><p role="navigation" id="back-to-top"><a href="#title"><abbr title="Back to top">↑</abbr></a></p><script src="js/toc.js"></script><script src="/js/scroll.js"></script></body></html>