<!DOCTYPE HTML><html xmlns="http://www.w3.org/1999/xhtml" lang="EN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>XPath and XQuery Functions and Operators 4.0 </title><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" type="text/css" href="css/w3c-base.css"><link rel="stylesheet" href="css/qtspecs.css"><link rel="stylesheet" href="css/xpath-functions-40.css"><script src="js/fo-datalist.js"></script><style type="text/css">
          body { margin-top: 50px }
          a.button { background: #DDD; border: 2px outset black; padding: 2px; margin: 2px; font-family: sans-serif; font-size: small;}
          a.button:hover { cursor:pointer; }
          a.button:active { border-style: inset; }
        </style><link rel="stylesheet" href="/css/autodiff.css"></head><body class="toc-inline"><div style="position:fixed; clear:both; top:0px" id="_autodiff_buttons"><p><a class="button" onclick="view('old')">
              View Old
            </a><a class="button" onclick="view('new')">
              View New
            </a><a class="button" onclick="view('both')">
              View Both
            </a><a class="button" onclick="view('only')">
              View Only
            </a><a class="button" onclick="scroll_to('prev')">
              Previous
            </a><a class="button" onclick="scroll_to('next')">
              Next
            </a><span id="__autodiff__"></span></p><p>This draft contains only sections that have differences from the version that it modified.</p></div><div class="head"><p><a href="https://www.w3.org/"><img src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" alt="W3C" height="48" width="72"></a></p><h1><a id="title"></a>XPath and XQuery Functions and Operators 4.0 </h1><h2><a id="w3c-doctype"></a>W3C Editor's Draft 2&nbsp;February&nbsp;2026</h2><dl><dt>This version:</dt><dd><a href="https://qt4cg.org/specifications/xpath-functions-40/">https://qt4cg.org/specifications/xpath-functions-40/</a></dd><dt>Latest version of XPath and XQuery Functions and Operators 4.0:</dt><dd><a href="https://qt4cg.org/specifications/xpath-functions-40/">https://qt4cg.org/specifications/xpath-functions-40/</a></dd><dt>Most recent Recommendation of XPath and XQuery Functions and Operators:</dt><dd><a href="https://www.w3.org/TR/2017/REC-xpath-functions-31-20170321/">https://www.w3.org/TR/2017/REC-xpath-functions-31-20170321/</a></dd><dt>Editor:</dt><dd>Michael Kay, Saxonica <a href="http://www.saxonica.com/">&lt;http://www.saxonica.com/&gt;</a></dd></dl><p>This document is also available in these non-normative formats: <a href="xpath-functions-40.xml">Specification in XML format</a> and&nbsp;<a href="function-catalog.xml">XML function catalog</a>.</p><p class="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>&nbsp;©&nbsp;2000&nbsp;<a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p><hr></div><div><h2><a id="abstract"></a>Abstract</h2><p>This document defines constructor functions, operators, and functions on the datatypes defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> and the datatypes defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. It also defines functions and operators on nodes and node sequences as defined in the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. These functions and operators are defined for use in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> and <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> and <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a> and other related XML standards. The signatures and summaries of functions defined in this document are available at: <a href="http://www.w3.org/2005/xpath-functions/">http://www.w3.org/2005/xpath-functions/</a>.</p><p>A summary of changes since version 3.1 is provided at <a href="#changelog"><b>H Changes since 3.1</b></a>.</p></div><div><h2><a id="status"></a>Status of this Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document.</em></p><p>This document is a working draft developed and maintained by a W3C Community Group, the <a href="https://www.w3.org/community/xslt-40/">XQuery and XSLT Extensions Community Group</a> unofficially known as QT4CG (where "QT" denotes Query and Transformation). This draft is work in progress and should not be considered either stable or complete. Standard W3C copyright and patent conditions apply.</p><p>The community group welcomes comments on the specification. Comments are best submitted as issues on the group's <a href="https://github.com/qt4cg/qtspecs/issues">GitHub repository</a>.</p><p id="at-risk">As the Community Group moves towards publishing dated, stable drafts, some features that the group thinks may likely be removed or substantially changed are marked “at risk” in their changes section. In this draft:</p><ul><li><a href="#func-array-members">array:members</a></li><li><a href="#func-array-of-members">array:of-members</a></li></ul><p>The community group maintains two extensive test suites, one oriented to XQuery and XPath, the other to XSLT. These can be found at <a href="https://github.com/qt4cg/qt4tests">qt4tests</a> and <a href="https://github.com/qt4cg/xslt40-test">xslt40-test</a> respectively. New tests, or suggestions for correcting existing tests, are welcome. The test suites include extensive metadata describing the conditions for applicability of each test case as well as the expected results. They do not include any test drivers for executing the tests: each implementation is expected to provide its own test driver.</p><div class="dedication" id="dedication"><h3>Dedication</h3><p>The publications of this community group <a href="../xquery-40/xpath-40.html#dedication">are dedicated</a> to our co-chair, Michael Sperberg-McQueen&nbsp;(1954–2024).</p></div></div><hr><div class="body"><div class="_diffs div1"><h2><a id="functions-on-types"></a>19 <a href="#functions-on-types" style="text-decoration: none">Processing types</a></h2><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-schema-type">next</a> | <a href="#func-op">previous</a>)</p><ol><li><p> New functions are provided to obtain information about built-in types and types defined in an imported schema. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/148">148</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1523">1523</a>&nbsp;5 November 2024]</i></p></li></ol></div><p>The functions in this section deliver information about schema types (including simple types and complex types). These may represent built-in types (such as <code>xs:dateTime</code>), user-defined types found in the static context (typically because they appear in an imported schema), or types used as type annotations on schema-validated nodes.</p><p>For more information on schema types, see <a href="#schema-type-hierarchy"><b>1.8.2 Schema Type Hierarchy</b></a>. The properties of a schema type are described in terms of the properties of a Simple Type Definition or Complex Type Definition component as described in <a href="https://www.w3.org/TR/xmlschema11-1/#Simple_Type_Definition_details"> 3.16.1 The Simple Type Definition Schema Component </a><sup><small>XS11-1</small></sup> and <a href="https://www.w3.org/TR/xmlschema11-1/#Complex_Type_Definition_details"> 3.4.1 The Complex Type Definition Schema Component </a><sup><small>XS11-1</small></sup> respectively. Not all properties are exposed.</p><p>The structured representation of a schema type is described in <a href="#schema-type-record"><b>19.1.1 Record fn:schema-type-record</b></a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Simple properties of a schema type that can be expressed as strings or booleans are represented in this record structure directly as atomic field values, while complex properties whose values are themselves types (for example, <code>base-type</code> and <code>primitive-type</code>) are represented as functions. This is done partly to make it easier for implementations to compute complex properties on demand rather than in advance, and partly to ensure that the overall structure is always acyclic. For example, the primitive type of <code>xs:decimal</code> is itself <code>xs:decimal</code>, and if this were represented as a field value without a guarding function, serialization of the map using the JSON output method would not terminate.</p></div><div class="_diffs div2"><h3><a id="functions-returning-type-information"></a>19.1 <a href="#functions-returning-type-information" style="text-decoration: none">Functions returning type information</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-schema-type"><code>fn:schema-type</code></a></td><td>Returns a record containing information about a named schema type in the static context.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-type-of"><code>fn:type-of</code></a></td><td>Returns information about the type of a value, as a string.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-atomic-type-annotation"><code>fn:atomic-type-annotation</code></a></td><td>Returns a record containing information about the type annotation of an atomic value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-node-type-annotation"><code>fn:node-type-annotation</code></a></td><td>Returns a record containing information about the type annotation of an element or attribute node.</td></tr></tbody></table><div class="_diffs div3"><h4><a id="func-type-of"></a>19.1.3 <a href="#func-type-of" style="text-decoration: none">fn:type-of</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-atomic-type-annotation">next</a> | <a href="#func-schema-type">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1550">1550</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1570">1570</a>&nbsp;12 November 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns information about the type of a value, as a string.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:type-of</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a string, whose lexical form will always match the grammar of <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#SequenceType">SequenceType</a><sup><small>XP</small></sup>, representing a sequence type that matches <code>$value</code>.</p><p>If <code>$value</code> is the empty sequence, the function returns the string <code>"empty-sequence()"</code>.</p><p>Otherwise, the returned string is the concatenation of:</p><ol class="enumar"><li><p>A string representing the distinct item types that are present in <code>$value</code>, formed as follows:</p><ol class="enumla"><li><p>For each item in <code>$value</code>, construct a string representing its item type as described below.</p></li><li><p>Eliminate duplicate strings from this list by applying the <a href="#func-distinct-values"><code>fn:distinct-values</code></a> function, forming a sequence of strings <var>$ss</var>.</p></li><li><p>If <var>$ss</var> contains only one string, use that string.</p></li><li><p>Otherwise, return the result of the expression <code>`({ fn:string-join(<var>$ss</var>, "|") })`</code>.</p></li></ol></li><li><p>An occurrence indicator: absent if <code>$value</code> contains exactly one item, or <code>"+"</code> if it contains more than one item.</p></li></ol><p>The string representing the type of an individual item <var>J</var> is constructed as follows:</p><ol class="enumar"><li><p>If <var>J</var> is an <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-XNode">XNode</a><sup><small>DM</small></sup>, the result is one of the following strings, determined by the node kind of the node (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-node-kind">7.6.9 node-kind Accessor</a>):</p><blockquote><p><code>"document-node()"</code><br><code>"element()"</code><br><code>"attribute()"</code><br><code>"text()"</code><br><code>"processing-instruction()"</code><br><code>"comment()"</code><br><code>"namespace-node()"</code></p></blockquote></li><li><p>If <var>J</var> is a <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JNode">JNode</a><sup><small>DM</small></sup>, the result is in the form <code>jnode(<var>T</var>)</code>, where <var>T</var> is the result of applying the <a href="#func-type-of"><code>type-of</code></a> function to the <b>·content·</b> property of <var>J</var>.</p></li><li><p>If <var>J</var> is an atomic item, the result is a string chosen as follows:</p><ol class="enumla"><li><p>Let <var>T</var> be the type denoted by the type annotation of <var>J</var>.</p></li><li><p>If <var>T</var> is an anonymous type, set <var>T</var> to the base type of <var>T</var>, and repeat until a type is reached that is not anonymous.</p></li><li><p>If the name of <var>T</var> is in the namespace <code>http://www.w3.org/2001/XMLSchema</code>, return the string <code>"xs:<var>local</var>"</code> where <var>local</var> is the local part of the name of <var>T</var>.</p></li><li><p>Otherwise, return the name of <var>T</var> in the form of a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#URIQualifiedName">URIQualifiedName</a><sup><small>XP</small></sup> (that is, <code>"Q{<var>uri</var>}<var>local</var>"</code>, or <code>"Q{}<var>local</var>"</code> if the name is in no namespace).</p></li></ol></li><li><p>If <var>J</var> is a function item:</p><ol class="enumla"><li><p>If <var>J</var> is an array, return <code>"array(*)"</code>.</p></li><li><p>If <var>J</var> is a map, return <code>"map(*)"</code>.</p></li><li><p><span style="display: none;" class="delete_version">Otherwise, return <code>"function(*)"</code>.</span><span style="display: none;" class="add_version">Otherwise, return <code>"fn(*)"</code>.</span><span class="modify_version">Otherwise, return <code>"<span class="deltaxml-old" style="background:#FF5555">function</span><span class="deltaxml-new" style="background:#90EE90">fn</span>(*)"</code>.</span></p></li></ol></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>If the <code>$value</code> argument is omitted and the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, the function raises type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>In general, an item matches more than one type, and there are cases where there is no single matching type that is more specific than all the others. This is especially true with functions, maps, and arrays. This function therefore selects one of the types that matches the item, which is not necessarily the most specific type.</p><p>This function should not be used as a substitute for an <code>instance of</code> test. The precise type annotation of the result of an expression is not always predictable, because processors are free to deliver a more specific type than is mandated by the specification. For example, if <code>$n</code> is of type <code>xs:positiveInteger</code>, then the result of <code>abs($n)</code> is guaranteed to be an instance of <code>xs:integer</code>, but an implementation might reasonably return the supplied value unchanged: that is, a value whose actual type annotation is <code>xs:positiveInteger</code>. Similarly the type annotation of the value returned by <code>position()</code> might be <code>xs:long</code> rather than <code>xs:integer</code>.</p><p>Implementations <span class="verb">should</span>, however, refrain from exposing types that are purely internal. For example, an implementation might have an optimized internal representation for strings consisting entirely of ASCII characters, or for single-character strings; if this is the case then the type annotation returned by this function should be a user-visible supertype such as <code>xs:string</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $e := &lt;doc&gt;
  &lt;p id="alpha" xml:id="beta"&gt;One&lt;/p&gt;
  &lt;p id="gamma" xmlns="http://example.com/ns"&gt;Two&lt;/p&gt;
  &lt;ex:p id="delta" xmlns:ex="http://example.com/ns"&gt;Three&lt;/ex:p&gt;
  &lt;?pi 3.14159?&gt;
&lt;/doc&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//*[@id = 'alpha'])</code></pre></div></td><td style="vertical-align:top"><p><code>"element()"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//*)</code></pre></div></td><td style="vertical-align:top"><p><code>"element()+"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//@id[. = 'gamma'])</code></pre></div></td><td style="vertical-align:top"><p><code>"attribute()"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//node()[. = '3.14159'])</code></pre></div></td><td style="vertical-align:top"><p><code>"processing-instruction()"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//no-such-node)</code></pre></div></td><td style="vertical-align:top"><p><code>"empty-sequence()"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e/child::node())</code></pre></div></td><td style="vertical-align:top"><p><code>"(element()|processing-instruction())+"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of(1)</code></pre></div></td><td style="vertical-align:top"><p><code>"xs:integer"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of(1 to 5)</code></pre></div></td><td style="vertical-align:top"><p><code>"xs:integer+"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of((1, 1.2, 2))</code></pre></div></td><td style="vertical-align:top"><p><code>"(xs:integer|xs:decimal)+"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of([ 1, 2, 3 ])</code></pre></div></td><td style="vertical-align:top"><p><code>"array(*)"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of({ 'a': 1 })</code></pre></div></td><td style="vertical-align:top"><p><code>"map(*)"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of(type-of#1)</code></pre></div></td><td style="vertical-align:top"><p><span style="display: none;" class="delete_version"><code>"function(*)"</code></span><span style="display: none;" class="add_version"><code>"fn(*)"</code></span><span class="modify_version"><code>"<span class="deltaxml-old" style="background:#FF5555">function</span><span class="deltaxml-new" style="background:#90EE90">fn</span>(*)"</code></span></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of(jtree([]))</code></pre></div></td><td style="vertical-align:top"><p><code>"jnode(array(*))"</code></p></td></tr></tbody></table></div></dd></dl></div></div></div></div><div class="back"></div><script src="js/toc.js"></script><script src="/js/scroll.js"></script></body></html>