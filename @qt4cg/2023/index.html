<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses in 2023</title></head><body><main><article><h1>@qt4cg statuses in 2023</h1><p>This page displays status
              updates
              about the QT4 CG project from 2023.</p><p>See also <a href="../">recent statuses</a>.</p><div class="toots">
<div class="toot" id="created-920"><h2>Issue #920 created<span class="toot-id"> #created-920</span></h2><div class="pubdate">30 Dec at 12:55:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/920">https://github.com/qt4cg/qtspecs/issues/920</a></div><details><summary>The rules for the "tail position" of a sequence constructor need to take account of xsl:switch</summary><div class="markup"><p>Under <code>xsl:iterate</code>, there are rules defining what it means for an instruction to be in a tail position in a sequence constructor. In these rules <code>xsl:switch</code> should be treated the same way as <code>xsl:choose</code>.</p>
</div></details></div>
<div class="toot" id="created-919"><h2>Issue #919 created<span class="toot-id"> #created-919</span></h2><div class="pubdate">28 Dec at 16:14:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/919">https://github.com/qt4cg/qtspecs/issues/919</a></div><details><summary>Should predicate callbacks use EBV?</summary><div class="markup"><p>Currently predicate callback functions used by things like fn:filter have to return a boolean; they can't rely on EBV semantics. For example you have to write <code>fn{boolean(self::p)}</code> rather than <code>fn{self::p}</code>.</p>
<p>It's probably with <code>self</code> tests that this is most noticeable, because self is so often used in a boolean context.</p>
<p>Of course the current rule gives stricter type-checking which will presumably catch some user errors. But it seems an unnecessary inconsistency.</p>
</div></details></div>
<div class="toot" id="created-918"><h2>Pull request #918 created<span class="toot-id"> #created-918</span></h2><div class="pubdate">27 Dec at 03:27:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/918">https://github.com/qt4cg/qtspecs/pull/918</a></div><details><summary>Minor cx through chap. 14</summary><div class="markup"><ul>
<li><code>fn:splice</code> examples expanded to illustrate integer steps other than 1.</li>
<li><code>fn:unparsed-text-lines</code> updated to reflect recent decisions about line handling in <code>fn:unparsed-text</code>.</li>
<li>Other clarifications or corrections.</li>
</ul>
<p>Let me know if any of these edits are misfires.</p>
</div></details></div>
<div class="toot" id="created-917"><h2>Issue #917 created<span class="toot-id"> #created-917</span></h2><div class="pubdate">22 Dec at 19:41:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/917">https://github.com/qt4cg/qtspecs/issues/917</a></div><details><summary>Better support for typed maps</summary><div class="markup"><p><strong>Edit (2023-01-04)</strong>: See https://github.com/qt4cg/qtspecs/issues/917#issuecomment-1875712638 for the most promising suggestion resulting from the discussion in this thread.</p>
<hr>
<p>Inspired by #720 and concerns regarding usability and performance, it may be a big step, but couldn’t we define records as subtypes of maps?</p>
<ul>
<li>The main difference would be that updates on records are only allowed as long as the resulting map matches a record definition.</li>
<li>This would allow us to return much better error messages, and to prevent users from deconstructing their own data structures.</li>
<li>We could still benefit from the existing map functions… provided that we believe it's an advantage. A stricter solution would be to disallow optional map entries completely (and treating records as a separate type).</li>
<li>From a technical point of view, data with a fixed structure can be optimized much better than a structure that changes dynamically.</li>
</ul>
</div></details></div>
<div class="toot" id="created-916"><h2>Pull request #916 created<span class="toot-id"> #created-916</span></h2><div class="pubdate">21 Dec at 17:15:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/916">https://github.com/qt4cg/qtspecs/pull/916</a></div><details><summary>720 Allow methods in maps with access to $this</summary><div class="markup"><p>This proposal allows functions within maps to access the containing map using the variable $this.</p>
<p>The proposal needs editorial work to integrate it fully into the text, but it is intended to be sufficiently complete to enable a full technical review.</p>
<p>Fix #720</p>
</div></details></div>
<div class="toot" id="created-915"><h2>Issue #915 created<span class="toot-id"> #created-915</span></h2><div class="pubdate">21 Dec at 11:45:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/915">https://github.com/qt4cg/qtspecs/issues/915</a></div><details><summary>[Editorial] Incorrect terminology: function implementation is now function body</summary><div class="markup"><p>In 4.6.2.5 Inline Function Expressions we refer to the "implementation" property of a function item; this property has been renamed as the "function body".</p>
</div></details></div>
<div class="toot" id="created-914"><h2>Pull request #914 created<span class="toot-id"> #created-914</span></h2><div class="pubdate">21 Dec at 04:20:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/914">https://github.com/qt4cg/qtspecs/pull/914</a></div><details><summary>XQFO minor edits</summary><div class="markup"><p>From reading up through chap. 13. The change in the title of chap. 10.2 is more accurate, and avoids the repetition of the title of chap. 10 itself.</p>
</div></details></div>
<div class="toot" id="created-913"><h2>Issue #913 created<span class="toot-id"> #created-913</span></h2><div class="pubdate">20 Dec at 23:00:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/913">https://github.com/qt4cg/qtspecs/issues/913</a></div><details><summary>XQFO: under/unused variable apparatus</summary><div class="markup"><p>In the preamble of XQFO chap. 13, several paragraphs are spent introducing a tree structure example, defining variables <code>$po</code>, <code>$item1</code>, <code>$item2</code>, and <code>$item3</code>. The prose leads the reader to expect frequent invocation of this tree example, but chap. 13 never uses it.</p>
<p>Chapter 13's tree example is referred to (sans link) and summarized in the preamble of chap. 14. In that chapter it is used only once, in a <code>fn:count</code> example that really doesn't rely upon anything special in the tree example.</p>
<p>Variables <code>$item1</code> and <code>$item2</code> are invoked only once more: in chap. 4, for <code>fn:number</code>. It's rather out of the blue, because neither the function definition nor chapter 4's preamble say anything about what the variables mean.</p>
<p>My recommendation is to drop this material all together, and for the functions <code>fn:count</code> and <code>fn:number</code> replace the examples with simpler examples.</p>
<p>OTOH, I might have come across an incomplete implementation, and the editors might prefer to make more thorough use of this tree example. I don't know.</p>
</div></details></div>
<div class="toot" id="created-912"><h2>Pull request #912 created<span class="toot-id"> #created-912</span></h2><div class="pubdate">20 Dec at 12:13:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/912">https://github.com/qt4cg/qtspecs/pull/912</a></div><details><summary>XQFO: Minor edits</summary><div class="markup"><p>Editorial; examples fixed</p>
</div></details></div>
<div class="toot" id="closed-297"><h2>Issue #297 closed<span class="toot-id"> #closed-297</span></h2><div class="pubdate">19 Dec at 18:24:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/297">https://github.com/qt4cg/qtspecs/issues/297</a></div><p>Lookup in deeply nested JSON, an abbreviated syntax for map:find</p></div>
<div class="toot" id="closed-20"><h2>Issue #20 closed<span class="toot-id"> #closed-20</span></h2><div class="pubdate">19 Dec at 16:37:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/20">https://github.com/qt4cg/qtspecs/issues/20</a></div><p>Highlight EBNF grammar differences in the diff versions of the specs</p></div>
<div class="toot" id="closed-51"><h2>Issue #51 closed<span class="toot-id"> #closed-51</span></h2><div class="pubdate">19 Dec at 16:37:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/51">https://github.com/qt4cg/qtspecs/issues/51</a></div><p>Generalize lookup operator for function items</p></div>
<div class="toot" id="closed-705"><h2>Issue #705 closed<span class="toot-id"> #closed-705</span></h2><div class="pubdate">19 Dec at 16:37:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/705">https://github.com/qt4cg/qtspecs/issues/705</a></div><p>Function Coercion: Function Arities</p></div>
<div class="toot" id="closed-707"><h2>Issue #707 closed<span class="toot-id"> #closed-707</span></h2><div class="pubdate">19 Dec at 16:37:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/707">https://github.com/qt4cg/qtspecs/issues/707</a></div><p>Dynamic Function Calls: Processing Empty Sequences</p></div>
<div class="toot" id="closed-892"><h2>Issue #892 closed<span class="toot-id"> #closed-892</span></h2><div class="pubdate">19 Dec at 16:36:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/892">https://github.com/qt4cg/qtspecs/issues/892</a></div><p>XPDY0002: Misleading examples</p></div>
<div class="toot" id="closed-903"><h2>Issue #903 closed<span class="toot-id"> #closed-903</span></h2><div class="pubdate">19 Dec at 16:36:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/903">https://github.com/qt4cg/qtspecs/pull/903</a></div><p>892 XPDY0002: Misleading examples</p></div>
<div class="toot" id="closed-902"><h2>Issue #902 closed<span class="toot-id"> #closed-902</span></h2><div class="pubdate">19 Dec at 16:33:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/902">https://github.com/qt4cg/qtspecs/pull/902</a></div><p>900 fn:sort, array:sort: Parameter names</p></div>
<div class="toot" id="closed-900"><h2>Issue #900 closed<span class="toot-id"> #closed-900</span></h2><div class="pubdate">19 Dec at 16:33:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/900">https://github.com/qt4cg/qtspecs/issues/900</a></div><p>fn:sort, array:sort: Parameter names</p></div>
<div class="toot" id="closed-894"><h2>Issue #894 closed<span class="toot-id"> #closed-894</span></h2><div class="pubdate">19 Dec at 16:30:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/894">https://github.com/qt4cg/qtspecs/issues/894</a></div><p>Errors in forming function items</p></div>
<div class="toot" id="closed-897"><h2>Issue #897 closed<span class="toot-id"> #closed-897</span></h2><div class="pubdate">19 Dec at 16:30:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/897">https://github.com/qt4cg/qtspecs/pull/897</a></div><p>894 - errors in forming function items</p></div>
<div class="toot" id="closed-866"><h2>Issue #866 closed<span class="toot-id"> #closed-866</span></h2><div class="pubdate">19 Dec at 16:27:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/866">https://github.com/qt4cg/qtspecs/issues/866</a></div><p>fn:sort, and XSLT and XQuery sorting, should use transitive comparisons</p></div>
<div class="toot" id="closed-881"><h2>Issue #881 closed<span class="toot-id"> #closed-881</span></h2><div class="pubdate">19 Dec at 16:27:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/881">https://github.com/qt4cg/qtspecs/pull/881</a></div><p>866 Introduce and exploit new numeric-compare() function</p></div>
<div class="toot" id="minutes-12-19"><h2>QT4 CG meeting 059 draft minutes<span class="toot-id"> #minutes-12-19</span></h2><div class="pubdate">19 Dec at 16:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/12-19">https://qt4cg.org/meeting/minutes/2023/12-19</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-911"><h2>Issue #911 created<span class="toot-id"> #created-911</span></h2><div class="pubdate">18 Dec at 12:44:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/911">https://github.com/qt4cg/qtspecs/issues/911</a></div><details><summary>Type "Promotion" in the coercion rules</summary><div class="markup"><p>I have an open action: QT4CG-052-06: MK to consider the editorial question of “promotion” for the symmetric relations.</p>
<p>I think the point that led to this was the fact that the word "promotion" seems inappropriate for cases like (string/uri) where the implicit conversion can take place in either direction.</p>
<p>I'd like to propose a fix to this that is not merely editorial. I propose that we allow any cast from one numeric type to another in the coercion rules. For example, if the required type is decimal, then a double or float can be supplied. Since, for many implementations of xs:decimal, this can be done losslessly, it makes at least as much sense to convert from double to decimal as from decimal to double.</p>
<p>The word "promotion" is in fact used (in relation to the coercion rules) only in a table heading, and we can change this heading to "implicit casting".</p>
<p>Appendix B.1 currently says:</p>
<blockquote>
<p>B.1 Type Promotion</p>
<p>[Definition: Under certain circumstances, an atomic value can be promoted from one type to another.] Type promotion is used in a number of contexts:</p>
<p>It forms part of the process described by the [coercion rules], invoked for example when a value of one type is supplied as an argument of a function call where the required type of the corresponding function parameter is declared with a different type.
It forms part of the process described in [B.2 Operator Mapping]), which selects the implementation of a binary operator based on the types of the supplied operands.
It is invoked (by explicit reference) in a number of other situations, for example when computing an average of a sequence of numeric values (in the fn:avg function).</p>
</blockquote>
<p>and I suggest we retain the term only for the second case, operator mapping. This differs from the coercion rules in that there are two operands and the effect is always to convert one to the type of the other. This affects numeric types only (not string/uri or binary), and it will continue to promote decimal to double, decimal to float, and float to double.</p>
<p>Where functions (fn:avg, fn:sum, math:pow) refer to the promotion rules, I suggest that we spell out the conversions that happen explictly, since it's not entirely obvious how the rules should be extrapolated. (For example, fn:avg doesn't make it entirely clear what should happen if the first item is a decimal, the second is a float, and the third is a double. Are you expected to "look ahead" to see what types are present, rather than evaluating the average incrementally?)</p>
</div></details></div>
<div class="toot" id="agenda-12-19"><h2>QT4 CG meeting 059 draft agenda<span class="toot-id"> #agenda-12-19</span></h2><div class="pubdate">18 Dec at 11:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/12-19">https://qt4cg.org/meeting/agenda/2023/12-19</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-910"><h2>Issue #910 created<span class="toot-id"> #created-910</span></h2><div class="pubdate">18 Dec at 02:45:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/910">https://github.com/qt4cg/qtspecs/issues/910</a></div><details><summary>Introduce a Kollection object with functions that operate on all types of items that can be containers of unlimited number of "members"</summary><div class="markup"><p>The base for this issue is the email sent by @ndw  to  public-xslt-40@w3.org on Dec. 13th 2023, fully quoted below:</p>
<blockquote>
<p>Hello all,</p>
<p>After a couple of weeks of discussion[1][2] about naming things, there
seem to be a some quite different perspectives on the problem.</p>
<p>As background, let’s remember that we have a language (or a set of
languages) that evolved over time. We couldn’t anticipate in version
1.0 what we would have in 4.0. We added new features in 2.0 and 3.0
that weren’t anticipated in previous versions either.</p>
<p>We live with decisions (some the result of long and hard battles
within the working group(s)) like the fact that sequences don’t nest
so all individual items are also sequences of length one.</p>
<p>The context for each addition to the language has been roughly: how
can we add new, useful features with a minimum of backwards
incompatibility.</p>
<p>It’s a natural consequence of this sort of evolution that there are
rough edges. Why does fn:count returns the number of items in a
sequence but always returns 1 if the argument is an array? Because an
array is an item and an item is a sequence of length one.</p>
<p>(It doesn’t help that the vision of what the X* languages should be
has changed over time. What started out envisioned as a tool for
transforming documents from one format to another for presentation on
the web or in print has grown into something that at least some
members of the group view as first class, functional programming
languages. That’s not bad, but it puts entirely different stresses on
the design, I think.)</p>
<p>As we add new functions (specifically, in the case of recent
discussions, but I expect the same perspectives apply more generally),
I think one perspective is roughly this:</p>
<p>How can we name and organize the functions so that users are least
likely to be surprised and most likely to be able to figure out how
to solve a particular problem?</p>
<p>Taken to an extreme, this perspective isn’t about changing the
semantics of the functions at all, it’s “just” about naming them. Is
fn:get() better (easier to understand, less confusing) than
fn:items-at?</p>
<p>I think another perspective is roughly this:</p>
<p>We have a messy design. It would be better if we could refactor the
design so that it was more harmonious and logical. We don’t need
four different, closely related functions to get items out of
different sorts of data structures, we need a set of abstractions
that make it obvious that only one function is necessary.</p>
<p>Taken to an extreme, this perspective is about reshaping the whole
language so that a single, obvious set of function names emerges
naturally from the carefully constructed abstractions.</p>
<p>I don’t think anyone holds exactly one perspective (discussions about
renaming often involve some level of discussion about semantics, for
example) and I’m attempting to polarize the perspectives a little bit
in an effort to shine light on a larger problem, not to be divisive.</p>
<p>With my chair’s hat on, the main problem I see with the first
perspective is that naming is hard, often personal and emotional, and
will never be wholly logical (so there will always be more to discuss,
so the “problem” is never resolved). It’s not quite fair to say it’s a
distraction from the “bigger” issues we need to resolve, but it does
take a lot of time.</p>
<p>I see the appeal of the second perspective. If we had a green field,
we’d do things differently. I think we might all agree that, ideally,
fn:count should return the number of items in a sequence, the number
of items in an array, and the number of key-value pairs in a map. But
it doesn’t and it can’t without fundamentally breaking things. I don’t
think we’d get agreement to break fn:count, so what can we do?</p>
<p>A proposal to fundamentally redesign the data model would be a tough
sell, I think.</p>
<p>One thing we could do is define a new namespace “gn” with functions
that work more logically, that treat sequences, arrays, and maps, as
collections and operate on them uniformly.</p>
<p>I suppose we could reconstruct the whole set of functions in this new
namespace and focus our efforts there, perhaps going so far as to
deprecate the current fn: namespace in favor of this new one.
But could we get consensus to do that? Would users thank us?</p>
<p>I dunno. Innovations welcome.</p>
<pre><code>                                    Be seeing you,
                                      norm
</code></pre>
</blockquote>
<p>This issue addresses the 2nd alternative formulated briefly by Norm as:</p>
<blockquote>
<p>One thing we could do is define a new namespace “gn” with functions
that work more logically, that treat sequences, arrays, and maps, as
collections and operate on them uniformly.</p>
<p>I suppose we could reconstruct the whole set of functions in this new
namespace and focus our efforts there, perhaps going so far as to
deprecate the current fn: namespace in favor of this new one.
But could we get consensus to do that? Would users thank us?</p>
</blockquote>
<p>Here are some of the obvious advantages of having a uniform Kollection concept that covers: arrays, sequences, maps, ... and possibly future new, specific, collection-like datatypes as sets:</p>
<ol>
<li>
<p>Uniform definition and understanding of a single data type - the Kollection.</p>
</li>
<li>
<p>O(N) functions only, compared to O(M * N) at present. Here N is the number of functions needed for each of the current collection-like data types (Arrays, Sequences and Maps) and M is the number of collection-like data types (currently 3).</p>
</li>
<li>
<p>The users will need to know about and understand just the single Kollection data type and its functions, not 3 or more similar collection-like data  types and 3 or more number of similar (but different) functions. Minimizing by a factor of 3 the amount of factual knowledge that a user needs is something HUGE  and extremely positive.</p>
</li>
<li>
<p>Allowing users to say "Good Bye" to the unclear and treacherous flat-sequence concepts we have as legacy from XPath 1.0.</p>
</li>
<li>
<p>Staying aligned to the examples of other modern programming languages such as C# with its IEnumerable interface. It is good to know that this has already been done in other shining programming languages, thus a nay-sayer will not be able to argue that this is not doable or, if done, would be negative to the language and its users.</p>
</li>
<li>
<p>Freeing enormous resources and time for the members of the Community Group so that they can spend this on more valuable avenues, than trying to find similar and best names to M similar functions each defined to one of the M current collection-like data types.</p>
</li>
</ol>
<p>Now, to dispel some plausible myths before they start circulating here:</p>
<ol>
<li>
<p>Myth 1: This will break backwards-compatibility? No, as proposed by Norm, all the functions operating on the generalized collection data type can be in a separate, new namespace and thus no existing user-code is affected.</p>
</li>
<li>
<p>Myth 2: If a sequence containing a single Kollection still has <code>count()</code> of 1, then what is the use of the Kollection data type? Actually, as proposed by Norm, the Kollection data type and its functions reside in their own namespace. Doing things using only functions from this new namespace eliminates the possibility of using <code>fn:count</code> as it resides in the different, currently existing standard function namespace.</p>
</li>
<li>
<p>Myth 3: This will be too-complex for the users and the users will not embrace it, so let us not waste time designing it. Wow, there were such prophets saying exactly the same about LINQ in 2005. As it often happens, the future proved them wrong. Users clearly and overwhelmingly "voted with their code" incorporating LINQ in almost all everyday applications and code repositories.</p>
</li>
<li>
<p>Myth 4: Banning the current functions operating on sequences, arrays and maps would be a huge burden to the users, and would intervene negatively with their programming. In fact, nobody would be banning any of the existing functions. Users can continue to use them forever. The acceptance of the uniform and generalized Kollection data - type can happen gradually with time, as was the case with the addition of LINQ to C#.</p>
</li>
</ol>
</div></details></div>
<div class="toot" id="created-909"><h2>Pull request #909 created<span class="toot-id"> #created-909</span></h2><div class="pubdate">17 Dec at 14:04:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/909">https://github.com/qt4cg/qtspecs/pull/909</a></div><p>893 fn:compare: Support for arbitrary atomic types</p></div>
<div class="toot" id="created-908"><h2>Issue #908 created<span class="toot-id"> #created-908</span></h2><div class="pubdate">17 Dec at 11:57:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/908">https://github.com/qt4cg/qtspecs/issues/908</a></div><details><summary>Function identity: documentation still too vague</summary><div class="markup"><p>In #520, the concept of function identities was introduced. This is what the current draft says:</p>
<h3><a href="https://qt4cg.org/specifications/xpath-datamodel-40/Overview.html#function-items">XDM, 2.9.4 Function Items</a></h3>
<blockquote>
<p><strong>identity</strong>: an abstract property that can be used to test whether two variables refer to the same function or to different functions. This property is exposed only for this purpose.</p>
<p><strong>Note</strong>: Currently, the concept of function identity is used for two purposes: firstly, when functions appear in the arguments supplied to the <code>fn:deep-equal</code> function; and secondly, in establishing whether the arguments and results of a function are "the same" when deciding whether the function is deterministic.</p>
<p><strong>Note</strong>: Function identity is not currently defined for maps and arrays, because in the circumstances where function identity would otherwise be used, maps and arrays are compared by examining their content.</p>
</blockquote>
<h3><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#properties-of-functions">XQFO, 1.8.4 Properties of functions</a></h3>
<blockquote>
<ol start="5">
<li>[…] the two function items have the same function identity. The concept of function identity is explained in Section 2.9.4 Function Items.</li>
</ol>
</blockquote>
<h3><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-deep-equal">XQFO, 14.2.8 fn:deep-equal</a></h3>
<blockquote>
<p>c. <code>$i1</code> and <code>$i2</code> have the same function identity. The concept of function identity is explained in Section 2.9.4 Function Items.</p>
</blockquote>
<h3><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-function-lookup">XQFO, 17.1.1 fn:function-lookup</a></h3>
<blockquote>
<p>The function identity is determined in the same way as for a named function reference. Specifically, if there is no context dependency, two calls on <code>fn:function-lookup</code> with the same name and arity must return the same function.</p>
</blockquote>
<p>While I definitely believe in the concept, I believe the documentation is still cryptic, or even impossible, to understand, at least without reading #520 or consuming the existing QT4 test cases. Here are some questions that I’m trying to answer:</p>
<ul>
<li>Does “abstract property” mean that the property will not be materialized in an implementation, or does it mean that the property too vague to be precisely defined?</li>
<li>We should try to specify what “refer to the same function” means. Are function properties that allow us to at least safely identify a subset of functions the same? For example, will <code>true#0</code> and <code>true#0</code> always be identical? The test cases imply this, whereas #520 doesn’t.</li>
<li>In XQFO 17.1.1, there’s a hint that context-dependency influences the decision if functions are identified as equal. Does this mean that <code>name#0</code> and <code>name#0</code> cannot be equal? Or can, or will, they be equal if the context is identical?</li>
<li>The term “deterministic” does not appear anywhere else in the XDM spec, so one is inclined to think of the XQFO nondeterminism. It is then unclear whether two instances of, for example, <code>map:entries</code> and <code>fn:parse-xml</code> can be “the same” if the parameters are the same.</li>
<li>In XQFO 17.1.1, “must return the same function.” is also unclear: What exactly is meant by “same function”? Is it a function that creates an identical result (thus, excluding nondeterministic functions like <code>fn:parse-xml</code>)?</li>
<li>We should explain better what was the motivation to include the context-dependency of functions in the definition. It would certainly be more intuitive if both <code>deep-equal(name#0, name#0)</code> and <code>deep-equal(name#1, name#1)</code> returned <code>true</code>.</li>
</ul>
<p>I’m sorry for not offering good answers in return. I could try to describe what we’ve implemented so far – mostly inspired by the test cases – but I’m not sure if it meets the requirements.</p>
<p>Related: #333</p>
</div></details></div>
<div class="toot" id="created-907"><h2>Pull request #907 created<span class="toot-id"> #created-907</span></h2><div class="pubdate">16 Dec at 09:33:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/907">https://github.com/qt4cg/qtspecs/pull/907</a></div><p>906 fn:deep-equal: unordered → ordered</p></div>
<div class="toot" id="created-906"><h2>Issue #906 created<span class="toot-id"> #created-906</span></h2><div class="pubdate">16 Dec at 09:32:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/906">https://github.com/qt4cg/qtspecs/issues/906</a></div><details><summary>fn:deep-equal: unordered → ordered</summary><div class="markup"><p>As already suggested in https://github.com/qt4cg/qtspecs/pull/798#pullrequestreview-1709271106 (and by first user feedback), the upcoming PR renames the option <code>unordered</code> to <code>ordered</code>, with <code>true</code> as default.</p>
</div></details></div>
<div class="toot" id="closed-339"><h2>Issue #339 closed<span class="toot-id"> #closed-339</span></h2><div class="pubdate">15 Dec at 16:24:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/339">https://github.com/qt4cg/qtspecs/issues/339</a></div><p>The constraints on document-uri are too...constraining</p></div>
<div class="toot" id="created-905"><h2>Pull request #905 created<span class="toot-id"> #created-905</span></h2><div class="pubdate">14 Dec at 13:49:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/905">https://github.com/qt4cg/qtspecs/pull/905</a></div><details><summary>898 - relax the constraints on document-uri</summary><div class="markup"><p>Fix #898</p>
<p>Changes non-normative text for the doc() and document-uri() functions to make it clearer that the consequences of the normative rules are not quite as previously stated.</p>
</div></details></div>
<div class="toot" id="created-904"><h2>Pull request #904 created<span class="toot-id"> #created-904</span></h2><div class="pubdate">14 Dec at 11:42:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/904">https://github.com/qt4cg/qtspecs/pull/904</a></div><details><summary>821 Annotations: Make default namespace explicit</summary><div class="markup"><p>In addition: Lexicographic order; formatting.</p>
</div></details></div>
<div class="toot" id="closed-129"><h2>Issue #129 closed<span class="toot-id"> #closed-129</span></h2><div class="pubdate">14 Dec at 11:22:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/129">https://github.com/qt4cg/qtspecs/issues/129</a></div><p>Context item → Context value?</p></div>
<div class="toot" id="closed-608"><h2>Issue #608 closed<span class="toot-id"> #closed-608</span></h2><div class="pubdate">14 Dec at 11:21:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/608">https://github.com/qt4cg/qtspecs/issues/608</a></div><p>Formatting Monospace (II)</p></div>
<div class="toot" id="created-903"><h2>Pull request #903 created<span class="toot-id"> #created-903</span></h2><div class="pubdate">14 Dec at 09:13:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/903">https://github.com/qt4cg/qtspecs/pull/903</a></div><p>892 XPDY0002: Misleading examples</p></div>
<div class="toot" id="created-902"><h2>Pull request #902 created<span class="toot-id"> #created-902</span></h2><div class="pubdate">14 Dec at 08:18:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/902">https://github.com/qt4cg/qtspecs/pull/902</a></div><details><summary>900 fn:sort, array:sort: Parameter names</summary><div class="markup"><p>Closes #900. In addition, the equivalent expression for <code>array:sort</code> was fixed.</p>
</div></details></div>
<div class="toot" id="created-901"><h2>Pull request #901 created<span class="toot-id"> #created-901</span></h2><div class="pubdate">13 Dec at 18:05:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/901">https://github.com/qt4cg/qtspecs/pull/901</a></div><details><summary>895 Parameters with default values: allow empty sequences</summary><div class="markup"><p>Closes #895</p>
</div></details></div>
<div class="toot" id="created-900"><h2>Issue #900 created<span class="toot-id"> #created-900</span></h2><div class="pubdate">13 Dec at 16:03:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/900">https://github.com/qt4cg/qtspecs/issues/900</a></div><details><summary>fn:sort, array:sort: Parameter names</summary><div class="markup"><p>The sort functions now accept multiple collations, keys, and orders, and this needs to be reflected in the parameter names (which are still singular).</p>
</div></details></div>
<div class="toot" id="created-899"><h2>Issue #899 created<span class="toot-id"> #created-899</span></h2><div class="pubdate">13 Dec at 15:31:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/899">https://github.com/qt4cg/qtspecs/issues/899</a></div><details><summary>Simplifying the language - types have behaviour.</summary><div class="markup"><p>I may misunderstand something but I always find the use of types and "as" to be counter intuitive (I'd prefer to be able to run an xslt 3+ script in some sort of 'strict' mode that was a bit more rigid, but thus simpler) e.g.</p>
<p>consider</p>
<pre><code>      &lt;xsl:variable name="foo1"&gt;
         &lt;foo/&gt;
      &lt;/xsl:variable&gt;

</code></pre>
<p>question - what is the type of <code>foo1</code>?
answer - (according to my saxon/oxygen setup the answer is) "document-node"</p>
<p>consider</p>
<pre><code>      &lt;xsl:variable name="foo2" as="element(foo)"&gt;
         &lt;foo/&gt;
      &lt;/xsl:variable&gt;

</code></pre>
<p>question - is this code valid then (I would as someone not used to xslt 2+ assume not)?
answer - yes</p>
<p>but surely this code is identical to foo1, so the 'type' of variable is actually changing the interpretation of the expression.</p>
<p>For me that's quite confusing</p>
<p>It would appear that these 2 values are not two different views (interfaces) of the same underlying value, else this</p>
<p><code>     &lt;xsl:variable name="foo3" as="element(foo)" select="$foo1"/&gt;</code></p>
<p>would be valid.</p>
<p>It isnt (i.e. this doesn't appear to be some subtle OO style scenario where an evaluation can have multiple interfaces, here 'document-node' and 'element' are presumably disjoint types).</p>
<p>For me conceptually types are descriptions of expressions, they have no behaviour, yet here they appear to (to me) effect the interpretation, not simply describe it.</p>
<p>For me, I'd prefer a 'strict' mode where either</p>
<pre><code>      &lt;xsl:variable name="foo2" as="element(foo)"&gt;
         &lt;foo/&gt;
      &lt;/xsl:variable&gt;

</code></pre>
<p>is a type error, because the expression is clearly a document-node OR some other mechanism to clarify the ambiguity without this conceptual wrinkle.</p>
<p>An expression should either have 1 interpretation, or if its ambigious, that should be an error, I don't think the language should default to prefer one over another.</p>
<p>P.S.
why doesnt this work? I genuinely don't know how to explicitly declare something as a document-node.</p>
<pre><code>  &lt;xsl:variable name="foo1" as=document-node()&gt;
     &lt;foo/&gt;
  &lt;/xsl:variable&gt;
</code></pre>
</div></details></div>
<div class="toot" id="created-898"><h2>Issue #898 created<span class="toot-id"> #created-898</span></h2><div class="pubdate">13 Dec at 10:04:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/898">https://github.com/qt4cg/qtspecs/issues/898</a></div><details><summary>Drop the requirement for document-uri() uniqueness</summary><div class="markup"><p>The specification of document-uri() states that the returned URI must be useable as input to the doc() function and that it always round-trips, so <code>doc(document-uri($X)) is $X</code> is guaranteed true.</p>
<p>A consequence of this rule is that you can't have two documents in the same execution scope with the same document-uri() property.</p>
<p>Enforcing this rule causes a lot of trouble. For example at the API level, the user can set two stylesheet or query parameters to two different documents that are associated with the same URI. Another example, two XSLT packages in the same stylesheet can call doc() on the same URI and get different documents back because they have set different validation and whitespace-stripping options. Use of <code>fn:transform()</code> causes further complications when documents are passed across the boundary (in fact that's where we first encountered the problem). And <code>collection()</code> brings further complications.</p>
<p>In order to conform to the rule in the spec, we changed Saxon a while back so the only documents that are guaranteed to have a document-uri() property are those that were read using the doc() function - and even then, things like validation and whitespace variations are troublesome. This causes users much confusion, partly, because of the change from earlier Saxon releases, but more because there are many situations where they would expect document-uri() to give a useful result and it doesn't.</p>
<p>I think we can fix this simply by removing the guarantee. That will cause less inconvenience to users than the current rule. We could perhaps modify it to say that in the case of a document returned from the doc() function, its document-uri() property will be such that a call to doc() with that URI will return the same document, but in the case of documents derived from other sources (for example <code>collection()</code>, or a result from <code>fn:transform</code>) there is no such guarantee.</p>
</div></details></div>
<div class="toot" id="closed-887"><h2>Issue #887 closed<span class="toot-id"> #closed-887</span></h2><div class="pubdate">12 Dec at 17:57:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/887">https://github.com/qt4cg/qtspecs/issues/887</a></div><p>Trivial syntax error under "named function references"</p></div>
<div class="toot" id="closed-896"><h2>Issue #896 closed<span class="toot-id"> #closed-896</span></h2><div class="pubdate">12 Dec at 17:57:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/896">https://github.com/qt4cg/qtspecs/pull/896</a></div><p>887 - fix simple typo in example</p></div>
<div class="toot" id="closed-862"><h2>Issue #862 closed<span class="toot-id"> #closed-862</span></h2><div class="pubdate">12 Dec at 17:54:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/862">https://github.com/qt4cg/qtspecs/issues/862</a></div><p>Examples needed for "Implausible Expressions"</p></div>
<div class="toot" id="closed-884"><h2>Issue #884 closed<span class="toot-id"> #closed-884</span></h2><div class="pubdate">12 Dec at 17:54:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/884">https://github.com/qt4cg/qtspecs/pull/884</a></div><p>862 Add explanations and examples of implausible expressions</p></div>
<div class="toot" id="closed-844"><h2>Issue #844 closed<span class="toot-id"> #closed-844</span></h2><div class="pubdate">12 Dec at 17:53:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/844">https://github.com/qt4cg/qtspecs/issues/844</a></div><p>New sequence functions: names</p></div>
<div class="toot" id="closed-879"><h2>Issue #879 closed<span class="toot-id"> #closed-879</span></h2><div class="pubdate">12 Dec at 17:53:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/879">https://github.com/qt4cg/qtspecs/pull/879</a></div><p>844 New sequence functions: names</p></div>
<div class="toot" id="closed-875"><h2>Issue #875 closed<span class="toot-id"> #closed-875</span></h2><div class="pubdate">12 Dec at 17:49:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/875">https://github.com/qt4cg/qtspecs/pull/875</a></div><p>XQFO, chap. 9 minor edits</p></div>
<div class="toot" id="closed-865"><h2>Issue #865 closed<span class="toot-id"> #closed-865</span></h2><div class="pubdate">12 Dec at 17:46:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/865">https://github.com/qt4cg/qtspecs/issues/865</a></div><p>Need to explain change in numeric comparison semantics</p></div>
<div class="toot" id="closed-873"><h2>Issue #873 closed<span class="toot-id"> #closed-873</span></h2><div class="pubdate">12 Dec at 17:46:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/873">https://github.com/qt4cg/qtspecs/pull/873</a></div><p>865 Improve explanation of equality comparisons</p></div>
<div class="toot" id="closed-867"><h2>Issue #867 closed<span class="toot-id"> #closed-867</span></h2><div class="pubdate">12 Dec at 17:42:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/867">https://github.com/qt4cg/qtspecs/issues/867</a></div><p>Signature notation in F+O: default values</p></div>
<div class="toot" id="closed-870"><h2>Issue #870 closed<span class="toot-id"> #closed-870</span></h2><div class="pubdate">12 Dec at 17:42:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/870">https://github.com/qt4cg/qtspecs/pull/870</a></div><p>867 Explain defaults in function signatures</p></div>
<div class="toot" id="closed-864"><h2>Issue #864 closed<span class="toot-id"> #closed-864</span></h2><div class="pubdate">12 Dec at 17:41:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/864">https://github.com/qt4cg/qtspecs/issues/864</a></div><p>$position argument in fold-right</p></div>
<div class="toot" id="closed-742"><h2>Issue #742 closed<span class="toot-id"> #closed-742</span></h2><div class="pubdate">12 Dec at 17:39:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/742">https://github.com/qt4cg/qtspecs/issues/742</a></div><p>xsl:function-library: keep, drop, or refine?</p></div>
<div class="toot" id="closed-863"><h2>Issue #863 closed<span class="toot-id"> #closed-863</span></h2><div class="pubdate">12 Dec at 17:39:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/863">https://github.com/qt4cg/qtspecs/pull/863</a></div><p>742 Drop xsl:function-library declaration</p></div>
<div class="toot" id="closed-847"><h2>Issue #847 closed<span class="toot-id"> #closed-847</span></h2><div class="pubdate">12 Dec at 17:24:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/847">https://github.com/qt4cg/qtspecs/issues/847</a></div><p>build-uri() - is {"port":()} legal?</p></div>
<div class="toot" id="closed-849"><h2>Issue #849 closed<span class="toot-id"> #closed-849</span></h2><div class="pubdate">12 Dec at 17:24:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/849">https://github.com/qt4cg/qtspecs/pull/849</a></div><p>847 Allow uri-structure-record keys to have empty sequence values</p></div>
<div class="toot" id="closed-479"><h2>Issue #479 closed<span class="toot-id"> #closed-479</span></h2><div class="pubdate">12 Dec at 17:21:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/479">https://github.com/qt4cg/qtspecs/issues/479</a></div><p>fn:deep-equal: Input order</p></div>
<div class="toot" id="closed-798"><h2>Issue #798 closed<span class="toot-id"> #closed-798</span></h2><div class="pubdate">12 Dec at 17:21:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/798">https://github.com/qt4cg/qtspecs/pull/798</a></div><p>479: fn:deep-equal: Input order</p></div>
<div class="toot" id="minutes-12-12"><h2>QT4 CG meeting 058 draft minutes<span class="toot-id"> #minutes-12-12</span></h2><div class="pubdate">12 Dec at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/12-12">https://qt4cg.org/meeting/minutes/2023/12-12</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-897"><h2>Pull request #897 created<span class="toot-id"> #created-897</span></h2><div class="pubdate">12 Dec at 15:59:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/897">https://github.com/qt4cg/qtspecs/pull/897</a></div><details><summary>894 - errors in forming function items</summary><div class="markup"><p>Fix #894</p>
</div></details></div>
<div class="toot" id="created-896"><h2>Pull request #896 created<span class="toot-id"> #created-896</span></h2><div class="pubdate">12 Dec at 15:18:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/896">https://github.com/qt4cg/qtspecs/pull/896</a></div><details><summary>887 - fix simple typo in example</summary><div class="markup"><p>Fix #887</p>
</div></details></div>
<div class="toot" id="created-895"><h2>Issue #895 created<span class="toot-id"> #created-895</span></h2><div class="pubdate">12 Dec at 11:47:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/895">https://github.com/qt4cg/qtspecs/issues/895</a></div><details><summary>Parameters with default values: allow empty sequences</summary><div class="markup"><p>We need a consistent approach for defining types of optional function arguments. In most current cases, if a function argument is supplied, it must be non-empty:</p>
<pre><code class="language-xquery">map:get(
  $map       as map(*),
  $key       as xs:anyAtomicType,
  $fallback  as function(xs:anyAtomicType) as item()*  := void#1
) as item()*

fn:starts-with-sequence(
  $input        as item()*,
  $subsequence	as item()*,
  $compare      as function(item(), item()) as xs:boolean  := fn:deep-equal#2
) as xs:boolean
</code></pre>
<p>In some cases, it’s optional:</p>
<pre><code class="language-xquery">fn:replace(
  $value        as xs:string?,
  $pattern      as xs:string,
  $replacement  as xs:string?                                                   := (),
  $flags        as xs:string?                                                   := '',
  $action       as (function(xs:untypedAtomic, xs:untypedAtomic*) as item()?)?  := ()
) as xs:string)

(: #874 :)
fn:subsequence(
  $input   as item()*,
  $start   as xs:double?                                     := (),
  $length  as xs:double?                                     := (),
  $from    as (function(item(), xs:integer) as xs:boolean)?  := (),
  $while   as (function(item(), xs:integer) as xs:boolean)?  := (),
  $until   as (function(item(), xs:integer) as xs:boolean)?  := ()
) as item()*
</code></pre>
<p>As a result, <code>map:get($map, fallback := ())</code> is invalid, while <code>replace($string, $pattern, action := ())</code>  would be valid.</p>
<p>I think it’s better to enforce non-empty arguments (provided that a single item is expected).</p>
</div></details></div>
<div class="toot" id="created-894"><h2>Issue #894 created<span class="toot-id"> #created-894</span></h2><div class="pubdate">12 Dec at 11:21:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/894">https://github.com/qt4cg/qtspecs/issues/894</a></div><details><summary>Errors in forming function items</summary><div class="markup"><p>Follow-up to issue #888</p>
<p>There are a number of situations in which error behaviour is insufficiently specified:</p>
<ul>
<li>Consider the partial function application <code>fn:contains(?, 23)</code>, where the second argument is an integer, not a string. Does the partial application fail, or does it result in a function item that fails when dynamically evaluated? The spec does not say.</li>
<li>Consider the expression <code>function-lookup(fn:name, 0</code>) evaluated when there is no context item in the dynamic context. Does the call on function-lookup fail, or does it return a function item that fails when dynamically evaluated? The spec does not say, though there are numerous test cases in the function-lookup test set that suggest the latter.</li>
<li>The same is true for the expression <code>fn:name#0</code> evaluated when there is no context item in the dynamic context.</li>
<li>Consider a user-defined function <code>my:f</code> with a parameter that has a default value of "."; consider both a function reference <code>my:f#0</code> and a partial application <code>my:f(?)</code> evaluated when there is no context item. Again, I think the spec is unclear on the error behaviour.</li>
</ul>
<p>It feels to me that the right thing to do in all these cases is to raise the error early: that is, to fail at the point where a function item is being constructed, not at the point where the function item is subsequently evaluated. However, this disagrees with QT3 expected test results for tests such as <code>fn-function-lookup-267</code> and <code>function-literal-267</code>.</p>
</div></details></div>
<div class="toot" id="created-893"><h2>Issue #893 created<span class="toot-id"> #created-893</span></h2><div class="pubdate">11 Dec at 17:46:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/893">https://github.com/qt4cg/qtspecs/issues/893</a></div><details><summary>fn:compare: Support for arbitrary atomic types</summary><div class="markup"><p>Inspired by #866:</p>
<p>We should extend <code>fn:compare</code> to support arbitrary atomic types. The comparison rules…</p>
<ul>
<li>would be unchanged for strings,</li>
<li>would rely on <code>fn:numeric-compare</code> for numbers, and</li>
<li>would rely on the existing <code>op:</code> functions for the remaining types.</li>
</ul>
<p>For example, the rule for dates would be:</p>
<ul>
<li><code>0</code> is returned if <code>op:date-equal(A, B)</code> is <code>true</code>,</li>
<li><code>-1</code> is returned if <code>op:date-less-than(A, B)</code> is <code>true</code>,</li>
<li><code>1</code> is returned otherwise.</li>
</ul>
<p>Some types will be rejected (<code>xs:duration</code>, <code>xs:QName</code>, <code>xs:NOTATION</code>, Gregorian types).</p>
<p>In addition, I would vote for making <code>fn:numeric-compare</code> and <code>fn:atomic-equal</code> private. I don’t see a benefit to expose them; I rather expect people to be confused.</p>
</div></details></div>
<div class="toot" id="created-892"><h2>Issue #892 created<span class="toot-id"> #created-892</span></h2><div class="pubdate">11 Dec at 16:38:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/892">https://github.com/qt4cg/qtspecs/issues/892</a></div><details><summary>XPDY0002: Misleading examples</summary><div class="markup"><p>Related to #888. The examples in <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-eval-dynamic-function-call">4.6.2.2 Evaluating Dynamic Function Calls</a>…</p>
<img src="https://github.com/qt4cg/qtspecs/assets/196589/f8e9996e-e64b-4e90-b05f-92e649220f5f" width="777">
<p>…are misleading; all of them raise <code>XPDY0002</code> if no element is bound to the global context value. Maybe <code>shop</code> could be replaced with <code>$shop</code> or <code>doc('wares.xml')/shop</code>.</p>
</div></details></div>
<div class="toot" id="agenda-12-12"><h2>QT4 CG meeting 058 draft agenda<span class="toot-id"> #agenda-12-12</span></h2><div class="pubdate">11 Dec at 13:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/12-12">https://qt4cg.org/meeting/agenda/2023/12-12</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-891"><h2>Issue #891 closed<span class="toot-id"> #closed-891</span></h2><div class="pubdate">11 Dec at 10:01:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/891">https://github.com/qt4cg/qtspecs/pull/891</a></div><p>Cleanup the post-diff-hacking hack</p></div>
<div class="toot" id="created-891"><h2>Pull request #891 created<span class="toot-id"> #created-891</span></h2><div class="pubdate">11 Dec at 10:01:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/891">https://github.com/qt4cg/qtspecs/pull/891</a></div><details><summary>Cleanup the post-diff-hacking hack</summary><div class="markup"><p>Improved, I think.</p>
</div></details></div>
<div class="toot" id="closed-890"><h2>Issue #890 closed<span class="toot-id"> #closed-890</span></h2><div class="pubdate">11 Dec at 09:38:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/890">https://github.com/qt4cg/qtspecs/pull/890</a></div><p>Stop fussing with merge base branch</p></div>
<div class="toot" id="created-890"><h2>Pull request #890 created<span class="toot-id"> #created-890</span></h2><div class="pubdate">11 Dec at 09:38:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/890">https://github.com/qt4cg/qtspecs/pull/890</a></div><details><summary>Stop fussing with merge base branch</summary><div class="markup"><p>Trying to track down the spurious diffs that we see in PRs.</p>
<p>I'll have to merge this to test it, so there will be a few random merges here. Sorry.</p>
</div></details></div>
<div class="toot" id="created-889"><h2>Issue #889 created<span class="toot-id"> #created-889</span></h2><div class="pubdate">11 Dec at 00:26:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/889">https://github.com/qt4cg/qtspecs/issues/889</a></div><details><summary>Rename "Named Function Reference"</summary><div class="markup"><p>The term "named function reference" is used for a construct like <code>name#1</code>.</p>
<p>Although we define it as "A named function reference is an expression (written name#arity) which evaluates to a [function item]", the term "named function reference" perpetuates the incorrect assumption that it is some kind of literal or constant denoting a function item.</p>
<p>Of course, in many cases it can be treated as just that. But not when the function is context-dependent, for example name#0 or lang#1.</p>
<p>The term is also questionable because one would assume that a "named function reference" is a reference to a "named function", but there is no such concept as a "named function".</p>
<p>So what might be a better name? What the expression actually does (when evaluated) is to search the static context for a function definition whose name and arity range correspond, and then construct a function item that captures the relevant part of the dynamic context in its closure. It's hard to encapsulate all of that in a simple name for the construct, but I would suggest <strong>named function generator</strong>. This is sufficiently close to the current term to be recognisable, but tries to capture the fact that it's not just a constant or literal, it's an expression that activately does something when evaluated; and it's reasonably accurate in that the result of the evaluation is a function item that has a non-absent name.</p>
</div></details></div>
<div class="toot" id="created-888"><h2>Issue #888 created<span class="toot-id"> #created-888</span></h2><div class="pubdate">09 Dec at 23:31:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/888">https://github.com/qt4cg/qtspecs/issues/888</a></div><details><summary>Reclassify XPDY0002 as a type error</summary><div class="markup"><p>I propose to reclassify XPDY0002 (context item is absent) as a type error rather than a dynamic error.</p>
<p>I don't propose to change the error code.</p>
<p>The only practical distinction is that this will allow the error to be reported statically when it can be detected statically, for example if the user writes something like</p>
<pre><code>function($x as node()) {
  starts-with(name(), 'x')
}
</code></pre>
<p>At present Saxon will give you a compile-time warning for this, followed by a run-time error if the code is actually executed; this is the required behaviour for dynamic errors.</p>
<p>The change does mean that in a case like this example, it will no longer be possible to catch the error using try/catch. However, type errors can only be reported statically if the code is bound to fail at run-time, and catching errors that occur every time is not especially useful.</p>
</div></details></div>
<div class="toot" id="created-887"><h2>Issue #887 created<span class="toot-id"> #created-887</span></h2><div class="pubdate">08 Dec at 15:04:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/887">https://github.com/qt4cg/qtspecs/issues/887</a></div><details><summary>Trivial syntax error under "named function references"</summary><div class="markup"><p>In the XPath/XQuery book, §4.6.2.4,</p>
<p><code>let $f := &lt;foo/&gt;/fn:name#0 return &lt;bar&gt;/$f()</code></p>
<p>should be</p>
<p><code>let $f := &lt;foo/&gt;/fn:name#0 return &lt;bar/&gt;/$f()</code></p>
<p>Digging a bit deeper, this reveals that we are not properly tagging and syntax-checking code examples in the spec.</p>
</div></details></div>
<div class="toot" id="created-886"><h2>Issue #886 created<span class="toot-id"> #created-886</span></h2><div class="pubdate">07 Dec at 23:56:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/886">https://github.com/qt4cg/qtspecs/issues/886</a></div><details><summary>Binary map keys</summary><div class="markup"><p>We have made <code>xs:hexBinary</code> and <code>xs:base64Binary</code> comparable and we now allow implicit coercion between the two types.</p>
<p>I've been assuming, though I'm not sure we ever discussed it, that this automatically means that the two types can be "atomic equal" from the point of view of entries in maps: that is, a hexBinary representation of a particular binary value can no longer coexist in a map with a base64Binary representation of the same binary value.</p>
<p>If we were starting from scratch this would clearly make sense, but it has some messy implications:</p>
<ul>
<li>It's a backwards incompatibility; in 3.1 you could construct maps that you can no longer construct in 4.0</li>
<li>It potentially affects interoperability of 3.1 and 4.0 applications. For example, an XQuery 4.0 application invoking an XSLT 3.0 transformation via <code>fn:transform</code> might get back a map that's not a valid map in 4.0.</li>
</ul>
<p>In effect, this is not just a change to the behaviour of one function/operator, it is a data model change, because it changes the value space of the <code>map(*)</code> data type.</p>
<p>And more parochially, I freely admit, there's a lot of internal complexity trying to maintain a code base that supports both the 3.1 and 4.0 rules simultaneously.</p>
<p>Is this a feature that benefits users sufficiently to justify the transition complexities? Note that we can still support "eq" between the two data types without supporting <code>fn:atomic-equal</code>.</p>
</div></details></div>
<div class="toot" id="created-885"><h2>Issue #885 created<span class="toot-id"> #created-885</span></h2><div class="pubdate">07 Dec at 17:38:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/885">https://github.com/qt4cg/qtspecs/issues/885</a></div><details><summary>fn:uuid</summary><div class="markup"><p>…to create a random universally unique identifier (UUID), represented as 128-bit value.</p>
<p>Should ideally be nondeterministic, or we may need to do something that’s similar to <code>fn:random-number-generator</code>.</p>
</div></details></div>
<div class="toot" id="created-884"><h2>Pull request #884 created<span class="toot-id"> #created-884</span></h2><div class="pubdate">06 Dec at 22:49:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/884">https://github.com/qt4cg/qtspecs/pull/884</a></div><details><summary>862 Add explanations and examples of implausible expressions</summary><div class="markup"><p>Fix #862</p>
</div></details></div>
<div class="toot" id="created-883"><h2>Issue #883 created<span class="toot-id"> #created-883</span></h2><div class="pubdate">06 Dec at 21:57:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/883">https://github.com/qt4cg/qtspecs/issues/883</a></div><details><summary>Improve return type for fn:load-xquery-module()</summary><div class="markup"><p>The return type is given as <code>map(*)</code>. We could make it more precise with a record type.</p>
<p>The same goes for a number of other function signatures that currently use map(*) as an argument or result type.</p>
<p>Perhaps we should also define a more precise type for options parameters.</p>
</div></details></div>
<div class="toot" id="created-882"><h2>Issue #882 created<span class="toot-id"> #created-882</span></h2><div class="pubdate">06 Dec at 18:53:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/882">https://github.com/qt4cg/qtspecs/issues/882</a></div><details><summary>fn:chain or fn:compose</summary><div class="markup"><p>I thought I had a great opportunity to use <code>fn:chain</code> the other day, and then found it didn't do what I wanted.</p>
<p>I wanted to negate a predicate: in pseudo-code</p>
<p><code>items-where($seq, not contains(?, "e"))</code></p>
<p>and I thought I could do this by chaining <code>contains</code> and <code>not</code>. But it doesn't work that way: <code>fn:chain</code> <em>applies</em> a sequence of functions to an argument, it doesn't compose a sequence of functions to yield a new function.</p>
<p>I wonder if a function that composes functions would be more useful, so I could write</p>
<p><code>items-where($seq, compose((contains(?, "e"), not#1)))</code></p>
</div></details></div>
<div class="toot" id="created-881"><h2>Pull request #881 created<span class="toot-id"> #created-881</span></h2><div class="pubdate">06 Dec at 11:59:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/881">https://github.com/qt4cg/qtspecs/pull/881</a></div><details><summary>866 Introduce and exploit new numeric-compare() function</summary><div class="markup"><p>Fix #866</p>
<p>The proposal introduces a new fn:numeric-compare function that differs from lt/eq primarily in that decimals are compared retaining their full precision, rather than converting them to doubles which may lose precision. This makes the comparison fully transitive which makes it safe to use in all sorting algorithms.</p>
<p>The new comparison semantics are exploited in max(), min(), and sort(), and indirectly in highest() and lowest(); they are also referenced for comparing numeric values in XSLT <code>xsl:sort</code> (and therefore indirectly in <code>xsl:merge</code>) and in XQuery <code>order by</code>.</p>
<p>An effect of the change is that max() and min() applied to a sequence of integers now return an integer, not a double.</p>
</div></details></div>
<div class="toot" id="created-880"><h2>Pull request #880 created<span class="toot-id"> #created-880</span></h2><div class="pubdate">06 Dec at 11:13:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/880">https://github.com/qt4cg/qtspecs/pull/880</a></div><details><summary>872 Symmetry: fn:items-at → fn:get</summary><div class="markup"><p>Closes #872.</p>
</div></details></div>
<div class="toot" id="created-879"><h2>Pull request #879 created<span class="toot-id"> #created-879</span></h2><div class="pubdate">06 Dec at 11:05:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/879">https://github.com/qt4cg/qtspecs/pull/879</a></div><details><summary>844 New sequence functions: names</summary><div class="markup"><p>Closes #844. The <code>items</code> keyword in the function names (excluding <code>items-at</code>) has been changed to <code>subsequence</code>.</p>
<p>See #878 for the controversial discussion on what to do with <code>subsequence-(after|before|starting-where|ending-where)</code>.</p>
</div></details></div>
<div class="toot" id="closed-855"><h2>Issue #855 closed<span class="toot-id"> #closed-855</span></h2><div class="pubdate">06 Dec at 10:50:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/855">https://github.com/qt4cg/qtspecs/pull/855</a></div><p>844 New sequence functions: names</p></div>
<div class="toot" id="closed-869"><h2>Issue #869 closed<span class="toot-id"> #closed-869</span></h2><div class="pubdate">06 Dec at 10:29:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/869">https://github.com/qt4cg/qtspecs/issues/869</a></div><p>Incorrect example: for-each-pair</p></div>
<div class="toot" id="created-878"><h2>Issue #878 created<span class="toot-id"> #created-878</span></h2><div class="pubdate">06 Dec at 08:59:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/878">https://github.com/qt4cg/qtspecs/issues/878</a></div><details><summary>Proposed extension to subsequence</summary><div class="markup"><p>Copied from https://github.com/qt4cg/qtspecs/issues/844#issuecomment-1841415417:</p>
<hr>
<p>I'm thinking again about integrating the items-* quartet into a heavily overloaded <code>subsequence</code> function.</p>
<p>Must supply zero or one of:</p>
<ul>
<li>$start - the start position</li>
<li>$from - a predicate, such that the start is the first item to match the predicate</li>
<li>
<ul>
<li>defaulting to 1</li>
</ul>
</li>
</ul>
<p>And zero or one of:</p>
<ul>
<li>$length - the number of items to include</li>
<li>$while - a predicate, the subsequence takes items so long as the predicate is true</li>
<li>$until - a predicate, the subsequence takes items up to and including the first for which the predicate is false</li>
<li>
<ul>
<li>defaulting to the end of the sequence.</li>
</ul>
</li>
</ul>
<p>This omits the "items-after" combination, but that one is easily achieved using <code>tail(subsequence(from:="xxx"))</code>.</p>
</div></details></div>
<div class="toot" id="created-877"><h2>Issue #877 created<span class="toot-id"> #created-877</span></h2><div class="pubdate">06 Dec at 03:29:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/877">https://github.com/qt4cg/qtspecs/issues/877</a></div><details><summary>Inconsistency in XQFO comparator functions/operators with recursive rules</summary><div class="markup"><p>The rules for <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-hexBinary-less-than">op:hexBinary-less-than()</a> appear to define a recursive octet-by-octet operation, but I think it flounders in rule 3, where it does not ask for rule 2 to be applied seriatim to each octet pair, but asks for an en masse comparison of two octet sequences.</p>
<p>Compare to 5.3.2, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#codepoint-collation">Unicode Codepoint Collation</a>, which describes a similar recursive item-for-item comparison. Interesting formal differences (e.g., unordered list versus ordered list).</p>
<p><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-deep-equal">fn:deep-equal()</a> is similar, but it is also much more complex. Nevertheless, the way it breaks down the problem at the outset, to dispense immediately with the recursive factor, and deal simply with the rules for equality, is IMO admirable.</p>
<p>It would be nice if there were a bit more consistency in the prose and presentation of recursive rules. Do others agree, and are there other functions/operations that should be considered in this question? I'm thinking immediately only of comparator functions/operations, not functions that use recursion to filter or create. (There may be parallels, but let's start with those functions that are most similar.)</p>
</div></details></div>
<div class="toot" id="created-876"><h2>Issue #876 created<span class="toot-id"> #created-876</span></h2><div class="pubdate">06 Dec at 02:50:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/876">https://github.com/qt4cg/qtspecs/issues/876</a></div><details><summary>Placement of fn:in-scope-namespaces(), fn:in-scope-prefixes(), fn:namespace-uri-for-prefix()</summary><div class="markup"><p>Currently <code>fn:in-scope-namespaces()</code>, <code>fn:in-scope-prefixes()</code>, and <code>fn:namespace-uri-for-prefix</code> are filed under XQFO chapter 10, which purports to deal exclusively with QNames. But these three functions have no direct bearing on QNames in either input or output.</p>
<p>Two options occur to me:</p>
<ol>
<li>Move sections 10.2.6-8 to fall after 13.3.</li>
<li>Rename chapter 10 to "Functions related to QNames and namespaces". Create a 10.3 that pertains exclusively to namespaces. Move to this new subchapter 10.2.4, 10.2.6-8, as well as 13.3 <code>fn:namespace-uri()</code> .</li>
</ol>
<p>Or some variant of the above.</p>
<p>At any rate, I think the current placement doesn't properly expose these functions to the browsing reader.</p>
</div></details></div>
<div class="toot" id="created-875"><h2>Pull request #875 created<span class="toot-id"> #created-875</span></h2><div class="pubdate">06 Dec at 02:18:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/875">https://github.com/qt4cg/qtspecs/pull/875</a></div><details><summary>XQFO, chap. 9 minor edits</summary><div class="markup"><p>Hopefully nothing controversial here. Edits are motivated by consistency and clarity.</p>
</div></details></div>
<div class="toot" id="closed-624"><h2>Issue #624 closed<span class="toot-id"> #closed-624</span></h2><div class="pubdate">06 Dec at 01:14:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/624">https://github.com/qt4cg/qtspecs/issues/624</a></div><p>XPath function definition clarification</p></div>
<div class="toot" id="closed-616"><h2>Issue #616 closed<span class="toot-id"> #closed-616</span></h2><div class="pubdate">06 Dec at 01:13:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/616">https://github.com/qt4cg/qtspecs/issues/616</a></div><p>XDM: X Node vs. x node</p></div>
<div class="toot" id="closed-464"><h2>Issue #464 closed<span class="toot-id"> #closed-464</span></h2><div class="pubdate">06 Dec at 01:12:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/464">https://github.com/qt4cg/qtspecs/issues/464</a></div><p>Serialization sequence normalization step 3 needs clarification</p></div>
<div class="toot" id="created-874"><h2>Pull request #874 created<span class="toot-id"> #created-874</span></h2><div class="pubdate">06 Dec at 00:09:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/874">https://github.com/qt4cg/qtspecs/pull/874</a></div><details><summary>878 Proposed extension to subsequence</summary><div class="markup"><p>Following discussion under issue #844, I decided to explore the possibility of extending subsequence() with optional parameters, with the aim of making the quartet of items-before/after/starting-with/ending-with unnecessary.</p>
<p>This is the spec that results. I feel it's a good trade-off; by adding three optional parameters to <code>fn:subsequence</code>, we can eliminate 4 functions that we are having trouble finding names for. The examples feel to me to be intuitive and readable; and there is more capability in the new function than we had before, for example by combining a predicate for the start position with an integer for the length.</p>
<p>I haven't explored arity-2 callbacks - these certainly need some notes and examples.</p>
</div></details></div>
<div class="toot" id="closed-822"><h2>Issue #822 closed<span class="toot-id"> #closed-822</span></h2><div class="pubdate">05 Dec at 17:10:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/822">https://github.com/qt4cg/qtspecs/issues/822</a></div><p>XQuery, XQFO: Edits (pool)</p></div>
<div class="toot" id="closed-851"><h2>Issue #851 closed<span class="toot-id"> #closed-851</span></h2><div class="pubdate">05 Dec at 17:10:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/851">https://github.com/qt4cg/qtspecs/pull/851</a></div><p>822: XQuery, XQFO: Edits (pool)</p></div>
<div class="toot" id="minutes-12-05"><h2>QT4 CG meeting 057 draft minutes<span class="toot-id"> #minutes-12-05</span></h2><div class="pubdate">05 Dec at 17:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/12-05">https://qt4cg.org/meeting/minutes/2023/12-05</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-873"><h2>Pull request #873 created<span class="toot-id"> #created-873</span></h2><div class="pubdate">05 Dec at 14:56:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/873">https://github.com/qt4cg/qtspecs/pull/873</a></div><details><summary>865 Improve explanation of equality comparisons</summary><div class="markup"><p>Fix #865</p>
<p>This PR:</p>
<ul>
<li>Adds a non-normative appendix to XPath and XQuery comparing and contrasting the different ways of doing equality comparisons</li>
<li>Changes fn:atomic-equal so it no longer refers to fn:deep-equal (the recursion terminated, but was confusing to follow)</li>
<li>Removes text in XQuery describing the non-transitivity of <code>group by</code> clauses, which is now a solved problem</li>
<li>Corrects the description of backwards incompatibilities relating to numeric comparisons in the F+O spec.</li>
</ul>
</div></details></div>
<div class="toot" id="created-872"><h2>Issue #872 created<span class="toot-id"> #created-872</span></h2><div class="pubdate">05 Dec at 11:58:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/872">https://github.com/qt4cg/qtspecs/issues/872</a></div><details><summary>Symmetry: fn:items-at → fn:get</summary><div class="markup"><p>I think that <code>fn:items-at</code> should be changed to <code>fn:get</code>:</p>
<ul>
<li>In #843, we try to harmonize the function names across sequences, maps, and arrays. We have <code>array:get</code> and <code>map:get</code> to retrieve single entries of the input, but we have <code>fn:items-at</code> for sequences.</li>
<li><code>fn:items-at</code> allows you to supply more than a single position, but <code>items-at($seq, (1, 3, 2)</code> can easily be rewritten to <code>(1, 3, 2) ! get($seq, .)</code> – similar to <code>(1, 3, 2) ! array:get($array, .)</code> and <code>(1, 3, 2) ! map:get($map, .)</code>.</li>
<li>With #844, <code>fn:items-at</code> would be the only function left with <code>items</code> in its name.</li>
</ul>
<p>The function signature would be as simple as:</p>
<pre><code class="language-xquery">fn:get(
  $input  as item()*,
  $at     as xs:integer	
) as item()
</code></pre>
<p>Obviously, most people will still use <code>$input[$at]</code> – but the same applies to arrays and maps (and other functions like <code>fn:head</code>). One of the advantages of <code>fn:get</code> is that you can pass on the context item as position argument.</p>
</div></details></div>
<div class="toot" id="created-871"><h2>Pull request #871 created<span class="toot-id"> #created-871</span></h2><div class="pubdate">04 Dec at 15:25:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/871">https://github.com/qt4cg/qtspecs/pull/871</a></div><p>Action qt4 cg 027 01 next match</p></div>
<div class="toot" id="created-870"><h2>Pull request #870 created<span class="toot-id"> #created-870</span></h2><div class="pubdate">04 Dec at 15:24:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/870">https://github.com/qt4cg/qtspecs/pull/870</a></div><details><summary>867 Explain defaults in function signatures</summary><div class="markup"><p>Fix #867</p>
</div></details></div>
<div class="toot" id="created-869"><h2>Issue #869 created<span class="toot-id"> #created-869</span></h2><div class="pubdate">04 Dec at 14:45:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/869">https://github.com/qt4cg/qtspecs/issues/869</a></div><details><summary>Incorrect example: for-each-pair</summary><div class="markup"><p>The fourth example of <code>fn:for-each-pair</code> is wrong:</p>
<pre><code>for-each-pair(
  (1, 8, 2),
  (3, 4, 3),
  fn($item1, $item2, $pos) {
    $pos || ': ' || max(($item1, $item2))
  }
)
</code></pre>
<p>Result:	
<code>("1: 1", "2: 4", "3: 2")</code></p>
<p>The results as given return the min of the pair, not the max.</p>
</div></details></div>
<div class="toot" id="agenda-12-05"><h2>QT4 CG meeting 057 draft agenda<span class="toot-id"> #agenda-12-05</span></h2><div class="pubdate">04 Dec at 12:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/12-05">https://qt4cg.org/meeting/agenda/2023/12-05</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-868"><h2>Issue #868 created<span class="toot-id"> #created-868</span></h2><div class="pubdate">04 Dec at 11:54:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/868">https://github.com/qt4cg/qtspecs/issues/868</a></div><details><summary>fn:intersperse → fn:join, array:join($arrays, $separator)</summary><div class="markup"><p>With <code>string-join</code>, you can create a string for multiple strings, optionally interspersed with a separator. <code>array:join</code> can be used to create an array from multiple arrays.</p>
<p><code>fn:intersperse</code>, which has been added to the XQuery 4 draft, does something very similar, and early feedback indicates that the function is useful, but easily to overlook due to its name.</p>
<p>I propose to unify the functions by…</p>
<ol>
<li>renaming <code>fn:intersperse</code> to <code>fn:join</code>;</li>
<li>adding a parameter to <code>array:join</code>: <code>$separator as array(*)* := ()</code>; and</li>
<li>allowing a separator sequence for <code>fn:string-join</code>: <code>$separator as xs:string* := ()</code>.</li>
</ol>
<h4>Examples</h4>
<p>Query | Result | Info
-- | -- | --
<code>string-join(('1','2','3'), '-')</code> | <code>'1-2-3'</code> | <em>existing syntax</em>
<code>array:join([[1],[2],[3]], ['-'])</code> | <code>[1,'-',2,'-',3]</code> | <em>new</em>
<code>join((1,2,3), '-')</code> | <code>(1,'-',2,'-',3)</code> | <em>now:</em> <code>intersperse((1,2,3),'-')</code>
<code>string-join(('1','2','3'))</code> | <code>'123'</code> | <em>existing syntax</em>
<code>array:join([[1],[2],[3]])</code> | <code>[1,2,3]</code> | <em>existing syntax</em>
<code>join((1,2,3))</code> | <code>(1,2,3)</code> | <em>now:</em> <code>intersperse((1,2,3))</code><br>(<em>or just</em> <code>(1,2,3)</code>)
<code>string-join(('1','2','3'), ('-','+')</code> | <code>'1-+2-+3'</code> | <em>new</em>
<code>array:join([[1],[2],[3]], ['-','+'])</code> | <code>[1,'-','+',2,'-','+',3]</code> | <em>new</em>
<code>join((1,2,3), ('-','+'))</code> | <code>(1,'-','+',2,'-','+',3)</code> | <em>now:</em> <code>intersperse((1,2,3),('-','+'))</code></p>
</div></details></div>
<div class="toot" id="created-867"><h2>Issue #867 created<span class="toot-id"> #created-867</span></h2><div class="pubdate">03 Dec at 16:31:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/867">https://github.com/qt4cg/qtspecs/issues/867</a></div><details><summary>Signature notation in F+O: default values</summary><div class="markup"><p>Section 1.5 of F+O introduces the signature proforma notation, and indicates that default values may be included for parameters.</p>
<p>It does not however say how the default value is interpreted. For example, with the signature</p>
<pre><code>fn:starts-with-sequence(
    $input as&nbsp;item()*, &nbsp;
    $subsequence as&nbsp;item()*,  &nbsp;
    $compare as&nbsp;function(item(), item()) as xs:boolean :=&nbsp;fn:deep-equal#2
)&nbsp;as&nbsp;xs:boolean

</code></pre>
<p>There is nothing to tell us that the expression fn:deep-equal#2 is evaluated with the static and dynamic context of the caller (or of the function reference).</p>
<p>Note that this is different from the similar notation used for function declarations in XQuery, where the static context for the default fn:deep-equal#2 would be taken from the function declaration in the Query prolog.</p>
</div></details></div>
<div class="toot" id="created-866"><h2>Issue #866 created<span class="toot-id"> #created-866</span></h2><div class="pubdate">03 Dec at 13:19:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/866">https://github.com/qt4cg/qtspecs/issues/866</a></div><details><summary>fn:sort, and XSLT and XQuery sorting, should use transitive comparisons</summary><div class="markup"><p>We have addressed the question of non-transitivity of equality matching in <code>distinct-values()</code>, and in XSLT and XQuery grouping, but the same issue exists for sorting. Currently <code>fn:sort</code>, as well as XSLT and XQuery sorting, rely on the "lt" operator for comparing values including mixed numerics such as doubles and decimals. Because this promotes to double, it is capable of losing precision, and is therefore non-transitive. Most sort algorithms rely on the supplied comparison function being transitive, and if it isn't, then undefined failures may occur including non-termination.</p>
<p>One particular quirk (which led me here) is that <code>fn:highest</code> and <code>fn:lowest</code> start by using <code>fn:sort</code> semantics to put the values in order, and then rely on <code>fn:deep-equal</code> semantics to find the values that are "equal highest" or "equal lowest". But <code>fn:sort</code> and <code>fn:deep-equal</code> have different ways of deciding whether two values are equal: decimal 1.2 and double 1.2 are equal for <code>fn:sort</code>, but not for <code>fn:deep-equal</code>.</p>
</div></details></div>
<div class="toot" id="created-865"><h2>Issue #865 created<span class="toot-id"> #created-865</span></h2><div class="pubdate">03 Dec at 00:49:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/865">https://github.com/qt4cg/qtspecs/issues/865</a></div><details><summary>Need to explain change in numeric comparison semantics</summary><div class="markup"><p>We need to explain more clearly that we now have different rules for comparing numeric values in different circumstances. My understanding of the situation is:</p>
<p>For <code>eq</code>, <code>=</code>, etc, we continue to use the XPath 2.0/3.0/3.1 rules for backwards compatibility reasons: for example comparison between decimal and double is done by converting the decimal to a double. This has known problems in terms of transitivity, but we have retained the rules because we identified that too many compatibility problems would be introduced by changing them.</p>
<p>For deep-equal, distinct-values, XSLT and XQuery grouping, etc, we have switched to the rules that were introduced for comparing map keys in 3.0, now available through the fn:atomic-equal function. Under these rules, doubles are promoted to decimals for comparison.</p>
<p>We should probably include a table showing which rules are used where.</p>
<p>A good example to use is (1e-3 = 0.001). This is true in both 3.1 and 4.0. But under the rules for maps in 3.1, and the new rules for distinct-values in 4.0, these two values are considered distinct.</p>
</div></details></div>
<div class="toot" id="created-864"><h2>Issue #864 created<span class="toot-id"> #created-864</span></h2><div class="pubdate">01 Dec at 23:34:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/864">https://github.com/qt4cg/qtspecs/issues/864</a></div><details><summary>$position argument in fold-right</summary><div class="markup"><p>In fn:fold-right (and thus array:fold-right) it's not clear how the position parameter works.</p>
<p>It appears to start at 1, and then to be decremented, which seems a little weird.</p>
<p>Working out what happens seems to involve reverse engineering the code, which isn't ideal. It's useful to have a formal definition of the function using code, but it shouldn't be necessary to reverse engineer 20 lines of difficult recursive code in order to get a feel for what the function does.</p>
<p>The only example given doesn't add any clarification.</p>
</div></details></div>
<div class="toot" id="closed-470"><h2>Issue #470 closed<span class="toot-id"> #closed-470</span></h2><div class="pubdate">29 Nov at 13:33:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/470">https://github.com/qt4cg/qtspecs/pull/470</a></div><p>369: add fixed-prefixes attribute in XSLT</p></div>
<div class="toot" id="closed-412"><h2>Issue #412 closed<span class="toot-id"> #closed-412</span></h2><div class="pubdate">29 Nov at 13:33:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/412">https://github.com/qt4cg/qtspecs/pull/412</a></div><p>409, QT4CG-027-01: xsl:next-match</p></div>
<div class="toot" id="closed-856"><h2>Issue #856 closed<span class="toot-id"> #closed-856</span></h2><div class="pubdate">29 Nov at 11:58:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/856">https://github.com/qt4cg/qtspecs/issues/856</a></div><p>Spec for deep-equal() still references FOTY0015</p></div>
<div class="toot" id="closed-857"><h2>Issue #857 closed<span class="toot-id"> #closed-857</span></h2><div class="pubdate">29 Nov at 11:58:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/857">https://github.com/qt4cg/qtspecs/pull/857</a></div><p>856 Drop reference to obsolete error condition in deep-equal()</p></div>
<div class="toot" id="created-863"><h2>Pull request #863 created<span class="toot-id"> #created-863</span></h2><div class="pubdate">29 Nov at 11:53:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/863">https://github.com/qt4cg/qtspecs/pull/863</a></div><details><summary>742 Drop xsl:function-library declaration</summary><div class="markup"><p>Fix #742</p>
</div></details></div>
<div class="toot" id="created-862"><h2>Issue #862 created<span class="toot-id"> #created-862</span></h2><div class="pubdate">29 Nov at 04:08:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/862">https://github.com/qt4cg/qtspecs/issues/862</a></div><details><summary>Examples needed for "Implausible Expressions"</summary><div class="markup"><p>In XPath 4.0 there is a new concept of <strong><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-implausible-expressions">Implausible Expressions</a></strong>.</p>
<p>There are several different sections about different types of implausible expressions:</p>
<ul>
<li>2.4.6 Implausible Expressions - only a single example, and it is not in an Examples sub-section and is difficult to locate.</li>
<li>3.8.1 Implausible Coercions -has 3 examples and seems OK.</li>
<li>4.7.4.3 Implausible Axis Steps - has no visible examples.</li>
<li>4.15.3.4 Implausible Lookup Expressions - has no examples.</li>
</ul>
<p>Another problem is that the definition of "implausible" seems not precise and subjective (what is the meaning of "<em>there is a high probability that they were written incorrectly</em>"):</p>
<p>"<strong>implausible</strong>
Certain expressions, while not erroneous, are classified as being <strong>implausible</strong>, because there is a high probability that they were written incorrectly."</p>
<p><strong>Proposed fixing actions</strong>:</p>
<ol>
<li>
<p>Provide a more precise and non-subjective definition of the concept.</p>
</li>
<li>
<p>Provide many examples of implausible expressions - both in the central section 2.4.6 and in all other sections dealing with more specific types of implausible expressions.</p>
</li>
</ol>
</div></details></div>
<div class="toot" id="closed-169"><h2>Issue #169 closed<span class="toot-id"> #closed-169</span></h2><div class="pubdate">28 Nov at 17:24:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/169">https://github.com/qt4cg/qtspecs/issues/169</a></div><p>Handling of duplicate keys in xsl:map</p></div>
<div class="toot" id="minutes-11-28"><h2>QT4 CG meeting 056 draft minutes<span class="toot-id"> #minutes-11-28</span></h2><div class="pubdate">28 Nov at 17:18:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/11-28">https://qt4cg.org/meeting/minutes/2023/11-28</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="agenda-11-28"><h2>QT4 CG meeting 056 draft agenda<span class="toot-id"> #agenda-11-28</span></h2><div class="pubdate">27 Nov at 12:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/11-28">https://qt4cg.org/meeting/agenda/2023/11-28</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-858"><h2>Issue #858 closed<span class="toot-id"> #closed-858</span></h2><div class="pubdate">27 Nov at 08:38:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/858">https://github.com/qt4cg/qtspecs/issues/858</a></div><p>fn:identity: accept 2 arguments, ignore second</p></div>
<div class="toot" id="created-861"><h2>Issue #861 created<span class="toot-id"> #created-861</span></h2><div class="pubdate">26 Nov at 22:52:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/861">https://github.com/qt4cg/qtspecs/issues/861</a></div><details><summary>Precise meaning of $E??KS</summary><div class="markup"><p>I don't think that the semantics of the expression <code>$E??KS</code> are clearly enough defined.</p>
<blockquote>
<p>The effect of the deep lookup expression E??KS is obtained by evaluating E, establishing its recursive content C, removing any item that is not a map or array to yield a sequence D, and then evaluating the shallow lookup expression D?KS, but with one exception: if evaluation of any shallow lookup fails, then the error is not propagated, but instead its result is taken to be an empty sequence.</p>
</blockquote>
<ol>
<li>The definition of "recursive content" needs to be tightened up.</li>
<li>It needs to be more clearly stated which errors we ignore, and which we don't. For example, what if the key specifier evaluates to a non-singleton sequence?</li>
<li>In the case of <code>$E??*</code> in particular, I don't think it makes much sense to exclude items that are not maps or arrays. I think the expectation in this case is to return the full recursive content.</li>
<li>As currently defined, if <code>$M</code> is a map, the the result of <code>$M??*</code> includes the map <code>$M</code> itself. I don't think this matches expectations. Certainly, with the parallel expression <code>$node//*</code>, the result does not include <code>$node</code>.</li>
</ol>
</div></details></div>
<div class="toot" id="created-860"><h2>Issue #860 created<span class="toot-id"> #created-860</span></h2><div class="pubdate">26 Nov at 19:46:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/860">https://github.com/qt4cg/qtspecs/issues/860</a></div><details><summary>Unary Lookup when the context value is a sequence</summary><div class="markup"><p>We have added the text</p>
<blockquote>
<p>If the context value is anything other than a single item, the semantics of the expression ?KS are defined to be equivalent to the expression . ! ?KS. The remainder of this section therefore explains the semantics on the assumption that the [context value] is a single item, referred to as the context item.</p>
</blockquote>
<p>Consider the case where the context value is a sequence of two maps <code>(map{'x':1, 1:'p', 2:'q'}, map{'x':2, 1:'P', 2:'Q'})</code> and the expression is <code>?(?x)</code>. What is the context for evaluation of the key specifier <code>(?x)</code>? I would have expected that we evaluate the key specifier once, in the outer context, so the key specifier value is <code>(1,2)</code> and we therefore take the entries with keys 1 and 2 in both maps, giving a result of ('p', 'q', 'P', 'Q'). But the cited paragraph suggests we evaluate KS separately for each item in the context value, and this return entry 1 of map 1 and entry 2 of map 2, giving a result of ('p', 'Q').</p>
<p>I know it's an edge case and it's unlikely in practice that people will write context-dependent key specifiers, but the rules need to be clear. I thought we had previously decided that the key specifier expression should be evaluated in the outer context.</p>
</div></details></div>
<div class="toot" id="created-859"><h2>Issue #859 created<span class="toot-id"> #created-859</span></h2><div class="pubdate">26 Nov at 16:32:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/859">https://github.com/qt4cg/qtspecs/issues/859</a></div><details><summary>Syntax problem with type-qualified wildcards in lookup expressions</summary><div class="markup"><p>The new syntax for type-qualified wildcards has problems when used in a chained lookup expression, for example</p>
<p><code>[[1,2], [3,4], 5, 6]?*::array(*)?1</code></p>
<p>because the "?" that follows <code>array(*)</code> is interpreted as an occurrence indicator. This can be avoided by using parentheses, but it's too much of an elephant trap - a better solution is needed.</p>
</div></details></div>
<div class="toot" id="created-858"><h2>Issue #858 created<span class="toot-id"> #created-858</span></h2><div class="pubdate">25 Nov at 19:27:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/858">https://github.com/qt4cg/qtspecs/issues/858</a></div><details><summary>fn:identity: accept 2 arguments, ignore second</summary><div class="markup"><p>Apart from <code>id</code>, Haskell has <a href="http://zvon.org/other/haskell/Outputprelude/const_f.html"><code>const</code></a>, which accepts 2 arguments, but only returns the first. Thanks to the introduction of default arguments, it’s straightforward to extend <code>fn:identity</code> to be able to accept 2 arguments:</p>
<pre><code class="language-xquery">fn:identity(
  $input    as item()*,
  $ignored  as item()*  := ()
) as item()*
</code></pre>
</div></details></div>
<div class="toot" id="created-857"><h2>Pull request #857 created<span class="toot-id"> #created-857</span></h2><div class="pubdate">24 Nov at 16:00:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/857">https://github.com/qt4cg/qtspecs/pull/857</a></div><details><summary>856 Drop reference to obsolete error condition in deep-equal()</summary><div class="markup"><p>Fix #856</p>
</div></details></div>
<div class="toot" id="created-856"><h2>Issue #856 created<span class="toot-id"> #created-856</span></h2><div class="pubdate">24 Nov at 13:05:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/856">https://github.com/qt4cg/qtspecs/issues/856</a></div><details><summary>Spec for deep-equal() still references FOTY0015</summary><div class="markup"><p>The errors section of fn:deep-equal still says</p>
<p>A type error is raised [[err:FOTY0015] if either input sequence contains a function item that is not a map or array.</p>
<p>This is no longer the case (and error FOTY0015 is now obsolete and should be removed from the appendix)</p>
</div></details></div>
<div class="toot" id="created-855"><h2>Pull request #855 created<span class="toot-id"> #created-855</span></h2><div class="pubdate">24 Nov at 10:46:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/855">https://github.com/qt4cg/qtspecs/pull/855</a></div><details><summary>844 New sequence functions: names</summary><div class="markup"><p>Closes #844</p>
</div></details></div>
<div class="toot" id="closed-852"><h2>Issue #852 closed<span class="toot-id"> #closed-852</span></h2><div class="pubdate">23 Nov at 12:04:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/852">https://github.com/qt4cg/qtspecs/issues/852</a></div><p>Typo in XQuery equivalent for fn:transitive-closure</p></div>
<div class="toot" id="closed-853"><h2>Issue #853 closed<span class="toot-id"> #closed-853</span></h2><div class="pubdate">23 Nov at 12:04:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/853">https://github.com/qt4cg/qtspecs/pull/853</a></div><p>852 Fix typo in transitive-closure</p></div>
<div class="toot" id="created-854"><h2>Issue #854 created<span class="toot-id"> #created-854</span></h2><div class="pubdate">22 Nov at 22:16:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/854">https://github.com/qt4cg/qtspecs/issues/854</a></div><details><summary>Need more discussion and explanation of deep-lookup operator</summary><div class="markup"><p>During discussion of the <code>??</code> operator it was pointed out that we need more examples and explanation, especially of how to handle cases where the "flattening" behaviour of the operator is inconvenient. This applies equally to paths using the existing <code>?</code> operator - <code>$x?y?z</code> and <code>$x??z</code> both have this problem. For example, there is no way of filtering the result of<code>$x?y?z</code> or <code>$x??z</code> to select only members of size 3.</p>
</div></details></div>
<div class="toot" id="closed-57"><h2>Issue #57 closed<span class="toot-id"> #closed-57</span></h2><div class="pubdate">22 Nov at 20:33:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/57">https://github.com/qt4cg/qtspecs/issues/57</a></div><p>The item-type(T) syntax is not defined</p></div>
<div class="toot" id="closed-172"><h2>Issue #172 closed<span class="toot-id"> #closed-172</span></h2><div class="pubdate">22 Nov at 19:55:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/172">https://github.com/qt4cg/qtspecs/issues/172</a></div><p>Record Tests</p></div>
<div class="toot" id="closed-233"><h2>Issue #233 closed<span class="toot-id"> #closed-233</span></h2><div class="pubdate">22 Nov at 19:53:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/233">https://github.com/qt4cg/qtspecs/issues/233</a></div><p>Declare the result type of a mode, via @as</p></div>
<div class="toot" id="closed-698"><h2>Issue #698 closed<span class="toot-id"> #closed-698</span></h2><div class="pubdate">22 Nov at 19:20:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/698">https://github.com/qt4cg/qtspecs/issues/698</a></div><p>GitHub: Line Endings</p></div>
<div class="toot" id="closed-730"><h2>Issue #730 closed<span class="toot-id"> #closed-730</span></h2><div class="pubdate">22 Nov at 16:44:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/730">https://github.com/qt4cg/qtspecs/issues/730</a></div><p>Equivalence of map and function types</p></div>
<div class="toot" id="closed-840"><h2>Issue #840 closed<span class="toot-id"> #closed-840</span></h2><div class="pubdate">22 Nov at 16:37:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/840">https://github.com/qt4cg/qtspecs/issues/840</a></div><p>Wrong example in fn:seconds-from-duration</p></div>
<div class="toot" id="created-853"><h2>Pull request #853 created<span class="toot-id"> #created-853</span></h2><div class="pubdate">22 Nov at 16:34:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/853">https://github.com/qt4cg/qtspecs/pull/853</a></div><details><summary>852 Fix typo in transitive-closure</summary><div class="markup"><p>Fix #852</p>
</div></details></div>
<div class="toot" id="created-852"><h2>Issue #852 created<span class="toot-id"> #created-852</span></h2><div class="pubdate">22 Nov at 16:04:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/852">https://github.com/qt4cg/qtspecs/issues/852</a></div><details><summary>Typo in XQuery equivalent for fn:transitive-closure</summary><div class="markup"><p><code>tc-inclusive($node/$step(.)), $step)</code></p>
<p>should read</p>
<p><code>tc-inclusive($node/$step(.), $step)</code></p>
</div></details></div>
<div class="toot" id="closed-837"><h2>Issue #837 closed<span class="toot-id"> #closed-837</span></h2><div class="pubdate">21 Nov at 17:15:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/837">https://github.com/qt4cg/qtspecs/pull/837</a></div><p>297 Deep Lookup Operator "??" and wildcard qualifier "::"</p></div>
<div class="toot" id="minutes-11-21"><h2>QT4 CG meeting 055 draft minutes<span class="toot-id"> #minutes-11-21</span></h2><div class="pubdate">21 Nov at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/11-21">https://qt4cg.org/meeting/minutes/2023/11-21</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-848"><h2>Issue #848 closed<span class="toot-id"> #closed-848</span></h2><div class="pubdate">21 Nov at 17:14:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/848">https://github.com/qt4cg/qtspecs/pull/848</a></div><p>More fo spec examples corrections</p></div>
<div class="toot" id="closed-833"><h2>Issue #833 closed<span class="toot-id"> #closed-833</span></h2><div class="pubdate">21 Nov at 17:13:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/833">https://github.com/qt4cg/qtspecs/pull/833</a></div><p>Fix the line endings, force a single lf in text files</p></div>
<div class="toot" id="closed-841"><h2>Issue #841 closed<span class="toot-id"> #closed-841</span></h2><div class="pubdate">21 Nov at 17:10:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/841">https://github.com/qt4cg/qtspecs/pull/841</a></div><p>840: Typo in fn:seconds-from-duration example</p></div>
<div class="toot" id="closed-845"><h2>Issue #845 closed<span class="toot-id"> #closed-845</span></h2><div class="pubdate">21 Nov at 17:09:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/845">https://github.com/qt4cg/qtspecs/issues/845</a></div><p>Quantified expressions and "binding tuples" (Editorial)</p></div>
<div class="toot" id="closed-846"><h2>Issue #846 closed<span class="toot-id"> #closed-846</span></h2><div class="pubdate">21 Nov at 17:06:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/846">https://github.com/qt4cg/qtspecs/pull/846</a></div><p>845 Drop mention of tuples</p></div>
<div class="toot" id="closed-842"><h2>Issue #842 closed<span class="toot-id"> #closed-842</span></h2><div class="pubdate">21 Nov at 17:03:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/842">https://github.com/qt4cg/qtspecs/pull/842</a></div><p>Improve stylesheet for generating keyword tests</p></div>
<div class="toot" id="created-851"><h2>Pull request #851 created<span class="toot-id"> #created-851</span></h2><div class="pubdate">21 Nov at 14:39:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/851">https://github.com/qt4cg/qtspecs/pull/851</a></div><details><summary>822: XQuery, XQFO: Edits (pool)</summary><div class="markup"><p>Editorial; closes #822 (visit this issue for a list of the changes)</p>
</div></details></div>
<div class="toot" id="created-850"><h2>Issue #850 created<span class="toot-id"> #created-850</span></h2><div class="pubdate">21 Nov at 13:04:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/850">https://github.com/qt4cg/qtspecs/issues/850</a></div><details><summary>fn:parse-html: Finalization</summary><div class="markup"><p>Now that <code>fn:parse-html</code> has been added to the specification, we need test cases for all provided options and input types (including binary input).</p>
<p>Looking at the current set of test cases, it seems unrealistic to use older libraries such as TagSoup for this function. I wonder if we should support ·implementation-defined· parsing algorithms at all. What do others think?</p>
<p>Next, is there <strong>any</strong> implementation available that supports all given method/html-version variants?</p>
</div></details></div>
<div class="toot" id="closed-783"><h2>Issue #783 closed<span class="toot-id"> #closed-783</span></h2><div class="pubdate">21 Nov at 12:56:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/783">https://github.com/qt4cg/qtspecs/issues/783</a></div><p>Editorial: errors are raised (not reported, signaled, generated, or thrown).</p></div>
<div class="toot" id="created-849"><h2>Pull request #849 created<span class="toot-id"> #created-849</span></h2><div class="pubdate">21 Nov at 10:09:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/849">https://github.com/qt4cg/qtspecs/pull/849</a></div><details><summary>847 Allow uri-structure-record keys to have empty sequence values</summary><div class="markup"><p>Fix #847</p>
<p>The description of <code>build-uri</code> was written with the expectation that if a key was in the map, it's value should be used. I don't really want to replace every occurrence of</p>
<pre><code>if `x` is present in the map
</code></pre>
<p>with</p>
<pre><code>if `x` is present in the map and its value is not the empty sequence
</code></pre>
<p>So I've attempted to justify that globally with the following paragraph at the beginning of the description:</p>
<blockquote>
<p>The components are derived from the contents of the $parts map. To simplify the description below, any key whose value is the empty sequence is ignored; this is equivalent to the key not being present in the map.</p>
</blockquote>
<p>I'm not hugely proud of that bit of prose though. Suggestions for improvements most welcome.</p>
</div></details></div>
<div class="toot" id="created-848"><h2>Pull request #848 created<span class="toot-id"> #created-848</span></h2><div class="pubdate">21 Nov at 08:07:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/848">https://github.com/qt4cg/qtspecs/pull/848</a></div><details><summary>More fo spec examples corrections</summary><div class="markup"><ul>
<li>
<p>Adds tagging for <code>fos:test</code> elements so we know which tests depend on XQuery (rather than XPath).</p>
</li>
<li>
<p>Corrects expected results for some tests</p>
</li>
</ul>
</div></details></div>
<div class="toot" id="created-847"><h2>Issue #847 created<span class="toot-id"> #created-847</span></h2><div class="pubdate">20 Nov at 23:52:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/847">https://github.com/qt4cg/qtspecs/issues/847</a></div><details><summary>build-uri() - is {"port":()} legal?</summary><div class="markup"><p>The (only) example in the spec of a build-uri() call specifies <code>{"port":()} </code>. But <code>uri-structure-record</code> has</p>
<p><code>port? as&nbsp;xs:string,</code></p>
<p>which means that the empty sequence is not a valid value. Either the record structure should be changed to specify the type as <code>xs:string?</code>, or the example should be changed.</p>
</div></details></div>
<div class="toot" id="agenda-11-21"><h2>QT4 CG meeting 055 draft agenda<span class="toot-id"> #agenda-11-21</span></h2><div class="pubdate">20 Nov at 12:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/11-21">https://qt4cg.org/meeting/agenda/2023/11-21</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-846"><h2>Pull request #846 created<span class="toot-id"> #created-846</span></h2><div class="pubdate">20 Nov at 00:32:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/846">https://github.com/qt4cg/qtspecs/pull/846</a></div><details><summary>845 Drop mention of tuples</summary><div class="markup"><p>Fix #845</p>
</div></details></div>
<div class="toot" id="created-845"><h2>Issue #845 created<span class="toot-id"> #created-845</span></h2><div class="pubdate">19 Nov at 23:46:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/845">https://github.com/qt4cg/qtspecs/issues/845</a></div><details><summary>Quantified expressions and "binding tuples" (Editorial)</summary><div class="markup"><p>The section of the XPath specification on Quantified Expressions contains paragraph starting</p>
<p>"The order in which test expressions are evaluated for the various binding tuples"</p>
<p>This is the only place in which "binding tuples" are mentioned in connection with quantified expressions, and in XPath (as distinct from XQuery) it is the only place where tuples are mentioned at all. The paragraph could easily be rewritten to avoid introducing a new concept.</p>
</div></details></div>
<div class="toot" id="created-844"><h2>Issue #844 created<span class="toot-id"> #created-844</span></h2><div class="pubdate">18 Nov at 11:11:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/844">https://github.com/qt4cg/qtspecs/issues/844</a></div><details><summary>New sequence functions: names</summary><div class="markup"><p>Observations:</p>
<p>A. What about renaming <code>fn:contains-sequence</code>, <code>fn:starts-with-sequence</code> and <code>fn:ends-with-sequence</code> to <code>fn:contains-items</code>, <code>fn:starts-with-items</code> and <code>fn:ends-with-items</code>, in alignment with <code>fn:items-at</code>, <code>fn:items-before</code>, etc.? If we add equivalent functions for arrays, it could be <code>array:contains-members</code>, etc.</p>
<p>B. It seems confusing to have <code>fn:items-starting-where</code> and <code>fn:items-after</code>, instead of <code>fn:items-starting-after</code>. Maybe we can think of alternative (shorter) names for <code>fn:items-starting-where</code> and <code>fn:items-ending-where</code>? – I know we’ve discussed before; I raised it again due to user feedback.</p>
</div></details></div>
<div class="toot" id="created-843"><h2>Issue #843 created<span class="toot-id"> #created-843</span></h2><div class="pubdate">18 Nov at 10:59:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/843">https://github.com/qt4cg/qtspecs/issues/843</a></div><details><summary>Standard, array &amp; map functions: Equivalencies</summary><div class="markup"><p>In many threads (#135, others), we have discussed how to align the functions for sequences, arrays, and maps. This is an attempt to summarize the status quo, which I hope to keep up-to-date in the coming weeks.</p>
<p>The 4.0 functions are the ones with the keyword <em>new</em> attached. If the function is followed by a question mark, there may be an existing issue for its addition, or it may be consistent to add it.</p>
<p>Please note that the data types have fundamental differences, so it’s not always possible to present or provide exact symmetries.</p>
<h3>To be discussed</h3>
<p>Functions | Array Functions | Map Functions
--- | --- | ---
<code>fn:contains-subsequence</code><br><em>new</em>:&nbsp;#94,&nbsp;#844 | <code>array:contains-subarray</code> ? | <strong><code>map:contains</code></strong>
<code>fn:distinct-values</code> | <code>array:distinct-members</code> ? | –
<code>fn:duplicate-values</code> <em>new</em>:&nbsp;#123 | <code>array:duplicate-members</code> ?  | –
<code>fn:empty</code> | <code>array:empty</code> <em>new</em>:&nbsp;#229 | <code>map:empty</code> ? #827
<code>fn:ends-with-subsequence</code><br><em>new</em>:&nbsp;#96,&nbsp;#844 | <code>array:ends-with-subarray</code> ?  | –
<code>fn:every</code> <em>new</em> | <code>array:every</code> ? | <code>map:every</code> ?
<code>fn:exists</code> | <code>array:exists</code> <em>new</em>:&nbsp;#229 | <code>map:exists</code> ? #827
<code>fn:highest</code> <em>new</em> | <code>array:highest</code> ? | –
<code>fn:index-of</code> | <code>array:index-of</code> ? #260 | –
<code>fn:index-where</code> <em>new</em> | <code>array:index-where</code> <em>new</em>:&nbsp;#114 | <code>map:keys($m, $pred)</code> <em>new</em>:&nbsp;#467
<code>fn:intersperse</code><br><em>new</em>:&nbsp;#2 →&nbsp;<code>fn:join</code> ? #868 | <code>array:join</code>  | –
<code>fn:items-at</code><br><em>new</em>:&nbsp;#213 →&nbsp;<code>fn:get</code> ? #872 | <code>array:get</code>;<br><code>array:members-at</code> ? #825 | <code>map:get</code>
<code>fn:lowest</code> <em>new</em> | <code>array:lowest</code> ? | –
<code>fn:slice</code> <em>new</em> | <code>array:slice</code> <em>new</em>  | –
<code>fn:some</code> <em>new</em> | <code>array:some</code> ? | <code>map:some</code> ?
<code>fn:starts-with-subsequence</code><br><em>new</em>:&nbsp;#96,&nbsp;#844 | <code>array:starts-with-subarray</code> ? | –
<code>fn:subsequence-after</code><br><em>new</em>:&nbsp;#149,&nbsp;<em>drop</em>? #844 | – | –
<code>fn:subsequence-before</code><br><em>new</em>:&nbsp;#149,&nbsp;<em>drop</em>? #844 | – | –
<code>fn:subsequence-ending-where</code><br><em>new</em>:&nbsp;#149,&nbsp;<em>drop</em>? #844  | – | –
<code>fn:subsequence-starting-where</code><br><em>new</em>:&nbsp;#149,&nbsp;<em>drop</em>? #844 | – | –
<code>fn:substitute</code> ? #553, #583 | <code>array:replace</code> <em>new</em>;<br><code>array:substitute</code> ? #583 | <code>map:replace</code> <em>new</em>;<br><code>map:substitute</code> <em>new</em> ? #583
– | <code>array:split</code> <em>new</em> | <code>map:entries</code> <em>new</em>
– | <code>array:values</code> <em>new</em> | <code>map:keys</code>; <code>map:values</code> <em>new</em>
– | <code>array:entries</code> ? #826 | <code>map:entries</code> <em>new</em>
– | <code>array:merge</code> ? #826 | <code>map:merge</code>
– | – | <code>map:entry</code>
– | <code>array:members</code><br><em>new</em> → keep? #826 | <code>map:pairs</code><br><em>new</em>&nbsp;→&nbsp;keep?&nbsp;#826
– | <code>array:of-members</code><br><em>new</em> → keep? #826 | <code>map:of-pairs</code><br><em>new</em>&nbsp;→&nbsp;keep?&nbsp;#826
– | – | <code>map:pair</code><br><em>new</em>:&nbsp;#508 → keep? #826</p>
<h3>Settled</h3>
<p>Functions | Array Functions | Map Functions
--- | --- | ---
<code>fn:count</code> | <code>array:size</code> | <code>map:size</code>
<code>fn:filter</code> | <code>array:filter</code> | <code>map:filter</code>
<code>fn:fold-left</code> | <code>array:fold-left</code> | –
<code>fn:fold-right</code> | <code>array:fold-right</code> | –
<code>fn:for-each-pair</code> | <code>array:for-each-pair</code> | –
<code>fn:for-each</code> | <code>array:for-each</code> | <code>map:for-each</code>
<code>fn:head</code> | <code>array:head</code> | –
<code>fn:insert-before</code> | <code>array:insert-before</code> | –
<code>fn:remove</code> | <code>array:remove</code> | <code>map:remove</code>
<code>fn:reverse</code> | <code>array:reverse</code> | –
<code>fn:sort</code> | <code>array:sort</code> | –
<code>fn:subsequence</code> | <code>array:subarray</code> | –
<code>fn:tail</code> | <code>array:tail</code> | –
– | <code>array:put</code>; <code>array:append</code> | <code>map:put</code>
<code>fn:foot</code><em>new</em>:&nbsp;#250 | <code>array:foot</code> <em>new</em>:&nbsp;#250 | –
<code>fn:trunk</code> <em>new</em>:&nbsp;#250 | <code>array:trunk</code> <em>new</em>:&nbsp;#250 | –</p>
</div></details></div>
<div class="toot" id="closed-91"><h2>Issue #91 closed<span class="toot-id"> #closed-91</span></h2><div class="pubdate">18 Nov at 09:58:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/91">https://github.com/qt4cg/qtspecs/issues/91</a></div><p>name of map:substitute</p></div>
<div class="toot" id="closed-104"><h2>Issue #104 closed<span class="toot-id"> #closed-104</span></h2><div class="pubdate">18 Nov at 09:57:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/104">https://github.com/qt4cg/qtspecs/issues/104</a></div><p>name of map:replace/array:replace</p></div>
<div class="toot" id="closed-699"><h2>Issue #699 closed<span class="toot-id"> #closed-699</span></h2><div class="pubdate">17 Nov at 16:34:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/699">https://github.com/qt4cg/qtspecs/issues/699</a></div><p>GitHub: Signing</p></div>
<div class="toot" id="created-842"><h2>Pull request #842 created<span class="toot-id"> #created-842</span></h2><div class="pubdate">17 Nov at 15:47:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/842">https://github.com/qt4cg/qtspecs/pull/842</a></div><details><summary>Improve stylesheet for generating keyword tests</summary><div class="markup"><p>Improves the stylesheet that generates the test set <code>misc/BuiltInKeywords.xml</code>; specifically, it's smarter about generating acceptable callback functions that won't trigger an unwanted error.</p>
<p>(The generated test calls each function twice, once with positional arguments and once with keyword arguments, and checks that the two results are deep-equal).</p>
</div></details></div>
<div class="toot" id="closed-838"><h2>Issue #838 closed<span class="toot-id"> #closed-838</span></h2><div class="pubdate">17 Nov at 10:35:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/838">https://github.com/qt4cg/qtspecs/issues/838</a></div><p>Collations in F&amp;O examples for functions such as fn:contains()</p></div>
<div class="toot" id="closed-839"><h2>Issue #839 closed<span class="toot-id"> #closed-839</span></h2><div class="pubdate">17 Nov at 10:35:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/839">https://github.com/qt4cg/qtspecs/pull/839</a></div><p>838 Fix collation variable references</p></div>
<div class="toot" id="created-841"><h2>Pull request #841 created<span class="toot-id"> #created-841</span></h2><div class="pubdate">16 Nov at 22:57:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/841">https://github.com/qt4cg/qtspecs/pull/841</a></div><details><summary>840: Typo in fn:seconds-from-duration example</summary><div class="markup"><p>Addresses #840</p>
</div></details></div>
<div class="toot" id="created-840"><h2>Issue #840 created<span class="toot-id"> #created-840</span></h2><div class="pubdate">16 Nov at 22:43:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/840">https://github.com/qt4cg/qtspecs/issues/840</a></div><details><summary>Wrong example in fn:seconds-from-duration</summary><div class="markup"><p>The newly added example</p>
<pre><code>seconds-from-duration(
   xs:duration("P1Y1D")
)
</code></pre>
<p>Result:	
<code>1</code></p>
<p>Looks clearly wrong.</p>
<p>Joel, what did you have in mind?</p>
</div></details></div>
<div class="toot" id="created-839"><h2>Pull request #839 created<span class="toot-id"> #created-839</span></h2><div class="pubdate">16 Nov at 20:29:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/839">https://github.com/qt4cg/qtspecs/pull/839</a></div><details><summary>838 Fix collation variable references</summary><div class="markup"><p>Fix #838. Editorial.</p>
</div></details></div>
<div class="toot" id="created-838"><h2>Issue #838 created<span class="toot-id"> #created-838</span></h2><div class="pubdate">16 Nov at 19:25:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/838">https://github.com/qt4cg/qtspecs/issues/838</a></div><details><summary>Collations in F&amp;O examples for functions such as fn:contains()</summary><div class="markup"><p>The examples for a number of functions, such as <code>fn:contains()</code>, use a UCA collation URI bound to the variable <code>$coll</code>.</p>
<p>Two problems:</p>
<p>(a) These sections also contain prose saying "The collation used in these examples,&nbsp;http://example.com/CollationA&nbsp;is a collation in which both&nbsp;-and&nbsp;*&nbsp;are ignorable collation units." - but this is not the collation URI actually used. This error was already present in the published 3.1 Recommendation.</p>
<p>(b) The examples that use the variable <code>$coll</code> do not have a <code>use</code> attribute, which means that the test cases generated in the test suite do not declare the variable, which means that the tests fail.</p>
</div></details></div>
<div class="toot" id="created-837"><h2>Pull request #837 created<span class="toot-id"> #created-837</span></h2><div class="pubdate">15 Nov at 16:57:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/837">https://github.com/qt4cg/qtspecs/pull/837</a></div><details><summary>297 Deep Lookup Operator "??" and wildcard qualifier "::"</summary><div class="markup"><p>Adds support for a deep lookup operator "??" as a transitive equivalent of "?", and allows a wildcard lookup <code>X?*</code> or <code>X??*</code> to be qualified with the required type of value, for example <code>X??*::record(from, to)</code>.</p>
</div></details></div>
<div class="toot" id="created-836"><h2>Issue #836 created<span class="toot-id"> #created-836</span></h2><div class="pubdate">15 Nov at 13:24:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/836">https://github.com/qt4cg/qtspecs/issues/836</a></div><details><summary>Add support for CSV 'dialect' features covered by the OKFN's Frictionless Data CSV spec in `fn:parse-csv` and related functions</summary><div class="markup"><p>The OKFN's <a href="https://frictionlessdata.io">Frictionless Data project</a>'s <a href="https://specs.frictionlessdata.io/csv-dialect/">CSV Standard</a> specifies some additional things we should take into account for <code>fn:parse-csv</code> and related functions.</p>
<p>Most important is the option to specify a comment line character, whose presence at the start of a line will cause it to be treated as a comment. Because of the way that rows can span lines, post-processing to extract comments might be impossible in some cases.</p>
</div></details></div>
<div class="toot" id="created-835"><h2>Issue #835 created<span class="toot-id"> #created-835</span></h2><div class="pubdate">15 Nov at 13:14:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/835">https://github.com/qt4cg/qtspecs/issues/835</a></div><details><summary>Review names of record types</summary><div class="markup"><p>The use of record types as a thing that users will interact with seems to be increasing. There are a number of new types proposed and we should review their names to ensure that we are using a coherent naming scheme for all spec-defined record types, and that the names are good enough - that they explain what they are, and aren't too unwieldy.</p>
</div></details></div>
<div class="toot" id="created-834"><h2>Issue #834 created<span class="toot-id"> #created-834</span></h2><div class="pubdate">15 Nov at 13:09:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/834">https://github.com/qt4cg/qtspecs/issues/834</a></div><details><summary>Add creation function for `csv-row-record` type</summary><div class="markup"><p>The <code>csv-row-record</code> type used by the CSV XDM mapping provides its fields and an accessor function that can perform field lookup by index or column name. The column names are set when the CSV is parsed. For users who want to make use of <code>csv-row-record</code> (when needing to parse CSVs that <code>fn:parse-csv</code> itself cannot handle out-of-the-box, perhaps) we should provide a creation function that accepts the name: index map and the fields for the row and creates a <code>csv-row-record</code> with a correctly functioning <code>field</code> function entry.</p>
</div></details></div>
<div class="toot" id="created-833"><h2>Pull request #833 created<span class="toot-id"> #created-833</span></h2><div class="pubdate">15 Nov at 12:48:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/833">https://github.com/qt4cg/qtspecs/pull/833</a></div><details><summary>Fix the line endings, force a single lf in text files</summary><div class="markup"><p>Hello,</p>
<p>Per discussion on the list, this PR changes the way <code>git</code> handles line endings so that text files will always, exclusively have line endings delimited by a single <code>lf</code>. This should be a largely transparent change for Mac/Unix users. On Windows, it means that checked out files will have <code>lf</code> line termination. If your favorite editing tool can handle this, then you don't have to care. Even if your editor saves files with <code>cr</code>/<code>lf</code> line endings, <code>git</code> will turn them back into single <code>lf</code> endings when you commit your changes.</p>
<p>Hat tip to @ChristianGruen for keeping focus on this issue.</p>
<p>This PR has no technical changes, and effects a relatively small number of files. I'll leave it here for a day or two, then I'm going to be inclined to merge it. Object now, if you object :-)</p>
</div></details></div>
<div class="toot" id="created-832"><h2>Pull request #832 created<span class="toot-id"> #created-832</span></h2><div class="pubdate">15 Nov at 10:29:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/832">https://github.com/qt4cg/qtspecs/pull/832</a></div><details><summary>77 Add map:deep-update and array:deep-update</summary><div class="markup"><p>Note that unlike many of the functions we have added, these are non-trivial: they cannot easily be implemented in XSLT or XQuery.</p>
<p>This is a first cut and I expect some refinement will be needed, but reviews are invited.</p>
<p>I might subsequently propose layering some XSLT syntax on top of this for convenience.</p>
</div></details></div>
<div class="toot" id="closed-831"><h2>Issue #831 closed<span class="toot-id"> #closed-831</span></h2><div class="pubdate">14 Nov at 18:16:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/831">https://github.com/qt4cg/qtspecs/pull/831</a></div><p>Fixed a couple of markup errors</p></div>
<div class="toot" id="created-831"><h2>Pull request #831 created<span class="toot-id"> #created-831</span></h2><div class="pubdate">14 Nov at 18:16:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/831">https://github.com/qt4cg/qtspecs/pull/831</a></div><details><summary>Fixed a couple of markup errors</summary><div class="markup"><p>I don't really know how these crept in. Perhaps I was negligent in confirming that #828 passed tests in PR? Too late to tell now, but I think I've fixed them.</p>
</div></details></div>
<div class="toot" id="closed-516"><h2>Issue #516 closed<span class="toot-id"> #closed-516</span></h2><div class="pubdate">14 Nov at 17:47:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/516">https://github.com/qt4cg/qtspecs/issues/516</a></div><p>Add position argument to HOF callbacks</p></div>
<div class="toot" id="closed-828"><h2>Issue #828 closed<span class="toot-id"> #closed-828</span></h2><div class="pubdate">14 Nov at 17:47:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/828">https://github.com/qt4cg/qtspecs/pull/828</a></div><p>516 Add position argument to HOF callbacks</p></div>
<div class="toot" id="closed-736"><h2>Issue #736 closed<span class="toot-id"> #closed-736</span></h2><div class="pubdate">14 Nov at 17:40:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/736">https://github.com/qt4cg/qtspecs/pull/736</a></div><p>730: Clarify (and correct) rules for maps as instances of function types</p></div>
<div class="toot" id="closed-719"><h2>Issue #719 closed<span class="toot-id"> #closed-719</span></h2><div class="pubdate">14 Nov at 17:37:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/719">https://github.com/qt4cg/qtspecs/pull/719</a></div><p>413: Spec for CSV-related functions</p></div>
<div class="toot" id="closed-554"><h2>Issue #554 closed<span class="toot-id"> #closed-554</span></h2><div class="pubdate">14 Nov at 17:33:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/554">https://github.com/qt4cg/qtspecs/issues/554</a></div><p>The Transitive Closure function produces an incomplete result, completeness/success and number of actual iterations must also be returned</p></div>
<div class="toot" id="closed-754"><h2>Issue #754 closed<span class="toot-id"> #closed-754</span></h2><div class="pubdate">14 Nov at 17:33:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/754">https://github.com/qt4cg/qtspecs/issues/754</a></div><p>fn:transitive-closure: signature; remarks; too specific?</p></div>
<div class="toot" id="closed-761"><h2>Issue #761 closed<span class="toot-id"> #closed-761</span></h2><div class="pubdate">14 Nov at 17:33:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/761">https://github.com/qt4cg/qtspecs/pull/761</a></div><p>554/754 Simplify the new transitive-closure function</p></div>
<div class="toot" id="closed-216"><h2>Issue #216 closed<span class="toot-id"> #closed-216</span></h2><div class="pubdate">14 Nov at 17:21:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/216">https://github.com/qt4cg/qtspecs/issues/216</a></div><p>fn:unparsed-text: End-of-line characters</p></div>
<div class="toot" id="closed-794"><h2>Issue #794 closed<span class="toot-id"> #closed-794</span></h2><div class="pubdate">14 Nov at 17:21:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/794">https://github.com/qt4cg/qtspecs/pull/794</a></div><p>216: fn:unparsed-text: End-of-line characters</p></div>
<div class="toot" id="closed-712"><h2>Issue #712 closed<span class="toot-id"> #closed-712</span></h2><div class="pubdate">14 Nov at 17:18:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/712">https://github.com/qt4cg/qtspecs/issues/712</a></div><p>array:sort: to be aligned with fn:sort</p></div>
<div class="toot" id="closed-823"><h2>Issue #823 closed<span class="toot-id"> #closed-823</span></h2><div class="pubdate">14 Nov at 17:17:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/823">https://github.com/qt4cg/qtspecs/pull/823</a></div><p>712 Extend array:sort to align with fn:sort</p></div>
<div class="toot" id="minutes-11-14"><h2>QT4 CG meeting 054 draft minutes<span class="toot-id"> #minutes-11-14</span></h2><div class="pubdate">14 Nov at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/11-14">https://qt4cg.org/meeting/minutes/2023/11-14</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-738"><h2>Issue #738 closed<span class="toot-id"> #closed-738</span></h2><div class="pubdate">14 Nov at 17:12:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/738">https://github.com/qt4cg/qtspecs/issues/738</a></div><p>FO: Why is fn:op under section "17.3 Dynamic loading"</p></div>
<div class="toot" id="closed-799"><h2>Issue #799 closed<span class="toot-id"> #closed-799</span></h2><div class="pubdate">14 Nov at 17:12:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/799">https://github.com/qt4cg/qtspecs/issues/799</a></div><p>Errors in F&amp;O spec examples</p></div>
<div class="toot" id="closed-824"><h2>Issue #824 closed<span class="toot-id"> #closed-824</span></h2><div class="pubdate">14 Nov at 17:12:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/824">https://github.com/qt4cg/qtspecs/pull/824</a></div><p>799 errors in examples; 738 section heading for fn:op</p></div>
<div class="toot" id="closed-747"><h2>Issue #747 closed<span class="toot-id"> #closed-747</span></h2><div class="pubdate">14 Nov at 17:11:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/747">https://github.com/qt4cg/qtspecs/issues/747</a></div><p>QName literals</p></div>
<div class="toot" id="closed-743"><h2>Issue #743 closed<span class="toot-id"> #closed-743</span></h2><div class="pubdate">14 Nov at 17:11:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/743">https://github.com/qt4cg/qtspecs/issues/743</a></div><p>Extend enumeration types to allow values other than strings</p></div>
<div class="toot" id="agenda-11-14"><h2>QT4 CG meeting 054 draft agenda<span class="toot-id"> #agenda-11-14</span></h2><div class="pubdate">13 Nov at 11:55:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/11-14">https://qt4cg.org/meeting/agenda/2023/11-14</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-830"><h2>Issue #830 created<span class="toot-id"> #created-830</span></h2><div class="pubdate">12 Nov at 22:52:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/830">https://github.com/qt4cg/qtspecs/issues/830</a></div><details><summary>Revise appendix D.4 of F+O: Illustrative user-written functions</summary><div class="markup"><p>Many of the functions in this non-normative appendix are no longer needed, or can be expressed more concisely using new 4.0 language features.</p>
</div></details></div>
<div class="toot" id="created-829"><h2>Issue #829 created<span class="toot-id"> #created-829</span></h2><div class="pubdate">12 Nov at 09:42:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/829">https://github.com/qt4cg/qtspecs/issues/829</a></div><details><summary>fn:boolean: EBV support for more item types</summary><div class="markup"><p>In #817, it was discussed that the current EBV semantics have been inspired a lot by XPath 1.0. Today, we have numerous other data types apart from strings, doubles, booleans, and nodes, and I believe it’s time to do justice to this by getting rid of the error for unsupported data types for <code>fn:boolean</code>.</p>
<p>We currently have:</p>
<p>Type | Rule to compute boolean value
--- | ---
<code>node()</code> | <code>true()</code>
<code>xs:boolean</code> | <code>$item != 0 and not(is-NaN($item))</code>
<code>xs:untypedAtomic</code>, <code>xs:string</code>, <code>xs:anyURI</code> | <code>$item != ''</code></p>
<p>I have two options in mind:</p>
<ol>
<li>The easiest solution, which would come closest to JavaScript, would be to return <code>true()</code> for all other items. This would allow us to do simple checks like:</li>
</ol>
<pre><code class="language-xquery">declare function local:byte-length($data as xs:basexBinary?) xs:integer {
  (: instead of exists($data); utilizes the EXPath Binary Module :)
  if($data) then bin:length($data) else 0
};
</code></pre>
<ol start="2">
<li>If we want to be more fine granular, we could do justice to the specifics of 4 more types:</li>
</ol>
<p>Type | Rule to compute boolean value
--- | ---
<code>array(*)</code> | <code>array:size($item) != 0</code>
<code>map(*)</code> | <code>map:size($item) != 0</code>
<code>xs:base64Binary</code><br><code>xs:hex64Binary</code> | <code>bin:length($item) != 0</code> or <br><code>not($item = (xs:hexBinary(''), xs:base64Binary(''))</code></p>
<p>It would then be possible to write:</p>
<ul>
<li><code>if($map)</code> instead of <code>map:size($map) != 0</code> or <code>map:exists($map)</code> (see <a href="https://github.com/qt4cg/qtspecs/issues/827">#827</a> for the naming controversy).<br>Note that <code>if($map)</code> will also return <code>false()</code> is <code>$map</code> is an empty sequence.</li>
<li><code>if($func) { $func(1, 2) }</code> instead of <code>exists($func)</code></li>
</ul>
<p>In the last comments of #817, it was addressed that the behavior of existing code may change if errors are replaced by results. I hope we can live with that, as I cannot think of cases in which the EBV computation make sense for items that always raise an error.</p>
<p>Which option do some of you prefer?</p>
</div></details></div>
<div class="toot" id="closed-817"><h2>Issue #817 closed<span class="toot-id"> #closed-817</span></h2><div class="pubdate">12 Nov at 09:07:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/817">https://github.com/qt4cg/qtspecs/issues/817</a></div><p>EBV 4.0</p></div>
<div class="toot" id="created-828"><h2>Pull request #828 created<span class="toot-id"> #created-828</span></h2><div class="pubdate">11 Nov at 22:51:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/828">https://github.com/qt4cg/qtspecs/pull/828</a></div><details><summary>516 Add position argument to HOF callbacks</summary><div class="markup"><p>I have added positional parameters to the following functions:</p>
<pre><code>array:filter
array:fold-left
array:fold-right
array:for-each
array:for-each-pair
array:index-where
fn:every
fn:filter
fn:fold-left
fn:fold-right
fn:for-each
fn:for-each-pair
fn:index-where
fn:items-after
fn:items-before
fn:items-ending-where
fn:items-starting-where
fn:iterate-while
fn:partition
fn:some
</code></pre>
<p>Comments:</p>
<ul>
<li>For <code>fn:every</code> and <code>fn:some</code>, the additional parameter seemed useful to me, as a positional variable has been requested for quantifier expressions in the past.</li>
<li>I’ve also added positional variables to folds.</li>
<li>I’ve unified and simplified the formal XPath/XQuery equivalencies in the rule sets.</li>
<li>I’ve dropped some XSLT equivalencies because I felt that the XQuery representations are more concise (I certainly won't mind if they're added back).</li>
</ul>
<p>Closes #516.</p>
</div></details></div>
<div class="toot" id="created-827"><h2>Issue #827 created<span class="toot-id"> #created-827</span></h2><div class="pubdate">09 Nov at 14:36:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/827">https://github.com/qt4cg/qtspecs/issues/827</a></div><details><summary>map:empty, map:exists ← array:empty, array:exists</summary><div class="markup"><p>We have <code>array:empty</code> and <code>array:exists</code>, but no equivalent functions for maps.</p>
<p>I think we have decided to live with the ambiguity (discussed in #229) that <code>map:exists(map {})</code> will return <code>false</code> although the “map exists”. Same for arrays.</p>
</div></details></div>
<div class="toot" id="created-826"><h2>Issue #826 created<span class="toot-id"> #created-826</span></h2><div class="pubdate">09 Nov at 14:03:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/826">https://github.com/qt4cg/qtspecs/issues/826</a></div><details><summary>Arrays: Representation of single members of an array</summary><div class="markup"><p>When introducing the new array features to some users, the <code>for member</code> syntax was welcomed by everyone.</p>
<p>However, there was some confusion (again, see my past <a href="https://lists.w3.org/Archives/Public/public-xslt-40/2023Jun/0026.html">feedback to the mailing list</a>) about what the QT4 group considers to be “members of an array”, and about value records.</p>
<p>In particular, the “value record” representation of arrays led to questions that I didn’t have a good answer for. In particular, people didn’t understand why an array member was returned as a map, and why that map is (again) called “array member” or “value record” – a term no one associated with arrays (at least for now… which somewhat is not surprising, as it has just been introduced).</p>
<p>Next, due to atomization (as mentioned before), <code>array:split</code> allows us to omit the explicit <code>?value</code> lookups that are required for <code>array:members</code>:</p>
<pre><code class="language-xquery">sum(array:members($array)?value)
sum(array:split($array))
</code></pre>
<p>I suppose I have been biased in my presentation, but I’ve failed to give good arguments to justify the current solution in the spec. The questions that I think need to be answered are:</p>
<ul>
<li>How will people benefit from the (usually intermediate) map representation for array members?</li>
<li>What exactly do we win with <code>array:members</code> and <code>array:of-members</code> instead of using the existing <code>array:join</code> function, combined with the new <code>array:split</code> function?</li>
</ul>
<p>Out of interest, I have rewritten the formal equivalencies for the array functions with <code>array:split</code>/<code>array:join</code>:</p>
<ul>
<li><code>array:append</code></li>
</ul>
<p><code>array:of-members((array:members($array), map{'value':$member}))</code>
<code>array:join((array:split($array), array { $member }))</code></p>
<ul>
<li><code>array:build</code></li>
</ul>
<p><code>array:of-members($input ! map { 'value': $action(.) })</code>
<code>array:join($input ! array { $action(.) })</code></p>
<ul>
<li><code>array:filter</code></li>
</ul>
<p><code>array:of-members(array:members($array) =&gt; filter(function($m) { $predicate($m?value) })</code>
<code>array:join(array:split($array) =&gt; filter(function($m) { $predicate($m?*) })</code></p>
<ul>
<li><code>array:for-each</code></li>
</ul>
<p><code>array:of-members(array:members($array) ! map { 'value': $action(?value) })</code>
<code>array:join(array:split($array) ! array { $action(?*) })</code></p>
<ul>
<li><code>array:for-each-pair</code></li>
</ul>
<pre><code>array:of-members(`
  for-each-pair(array:members($array1), 
    array:members($array2), 
    function($m, $n) {map{'value': $action($m?value, $n?value)}}))
array:join(
  for-each-pair(array:split($array1), array:split($array2),
    function($m, $n) { array { $action($m?*, $n?*) } }))
</code></pre>
<ul>
<li><code>array:insert-before</code></li>
</ul>
<p><code>array:of-members(array:members($array) =&gt; insert-before($position, map{'value':$member}))</code>
<code>array:join(array:split($array) =&gt; insert-before($position, array { $member }))</code></p>
<ul>
<li><code>array:remove</code></li>
</ul>
<p><code>array:of-members(array:members($array) =&gt; remove($positions))</code>
<code>array:join(array:split($array) =&gt; remove($positions))</code></p>
<ul>
<li><code>array:reverse</code></li>
</ul>
<p><code>array:of-members(array:members($array) =&gt; reverse())</code>
<code>array:join(array:split($array) =&gt; reverse())</code></p>
<ul>
<li><code>array:slice</code></li>
</ul>
<p><code>array:of-members(array:members($array) =&gt; slice($start, $end, $step))</code>
<code>array:join(array:split($array) =&gt; slice($start, $end, $step))</code></p>
<ul>
<li><code>array:split</code></li>
</ul>
<p><code>array:of-members(array:members($array) =&gt; sort($collation, function($x) { $key($x?value) }))</code>
<code>array:join(array:split($array) =&gt; sort($collation, function($x) { $key($x?*) }))</code></p>
<ul>
<li><code>array:subarray</code></li>
</ul>
<p><code>array:of-members(array:members($array) =&gt; subsequence($start, $length))</code>
<code>array:join(array:split($array) =&gt; subsequence($start, $length))</code></p>
<ul>
<li><code>array { $sequence }</code></li>
</ul>
<p><code>array:of-members($sequence ! map { 'value': . })</code>
<code>array:join($sequence ! array { . })</code></p>
<ul>
<li><code>[E1, E2, E3, ..., En]</code></li>
</ul>
<p><code>array:join((map { 'value': E1 }, map { 'value': E2 }, map { 'value': E3 }, ... map { 'value': En }))</code>
<code>array:join((array { E1 }, array { E2 }, array { E3 }, ... array { En }))</code></p>
<ul>
<li><code>$array?*</code></li>
</ul>
<p><code>array:members($array) ! ?value</code>
<code>array:split($array) ! ?*</code></p>
<ul>
<li><code>$array?$N / $array($N)</code></li>
</ul>
<p><code>array:members($array)[$N]?value</code>
<code>array:split($array)[$N]?*</code>  (or <code>array:get($array, $N)</code>)</p>
<hr>
<p>As a side note, I noticed that the equivalence given for <code>array:join</code> must be buggy:</p>
<pre><code class="language-xquery">(: current equivalence presented in the spec :)
array:of-members($arrays ! array:members(.))

(: returns [ 1, 2, 3 ] :)
let $arrays := ([ 1 ], [ 2, 3 ])
return array:of-members($arrays ! array:members(.))
</code></pre>
<p>Concluding, If I could choose, I would tend to drop <code>array:members</code> and <code>array:of-members</code> and rename <code>array:split</code> to <code>array:members</code>.</p>
</div></details></div>
<div class="toot" id="created-825"><h2>Issue #825 created<span class="toot-id"> #created-825</span></h2><div class="pubdate">09 Nov at 02:03:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/825">https://github.com/qt4cg/qtspecs/issues/825</a></div><details><summary>array:members-at</summary><div class="markup"><p>The title says it all.</p>
<p>We have <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-slice"><strong>fn:slice</strong></a> and <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-array-slice"><strong>array:slice</strong></a>. We also do have <strong><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-items-at">fn:items-at</a></strong>, but we have somehow missed to add the corresponding <s><strong>array:items-at</strong></s> <strong>array:members-at</strong> function.</p>
<p>We could even think of a function <strong>map:entries-at</strong> and <strong>map:values-for-keys</strong>. The first of these would return all map entries that have as keys one of the provided as argument set of keys. The 2nd function would return all values of the map entries that have as keys one of the provided as argument set of keys.</p>
<p>Here is a complete XPath 3.1 implementation:</p>
<pre><code class="language-xq">let $members-at := function(
                 $input as array( *), 
                 $indexes as xs:integer*
                ) as array(*)*
 {
     for $ind in $indexes
       return [$input($ind)]
 }
</code></pre>
<hr>
<p><strong>Example</strong>:</p>
<p>Evaluating this expression:</p>
<pre><code class="language-xq">let $members-at := function(
                 $input as array( *), 
                 $indexes as xs:integer*
                ) as array(*)*
 {
     for $ind in $indexes
       return [$input($ind)]
 }
  return
     $members-at([1, (2, 3), (4, 5, 6)], (1, 3) )
</code></pre>
<p>produces the wanted result:</p>
<p><code>[1], [(4,5,6)]</code></p>
</div></details></div>
<div class="toot" id="closed-771"><h2>Issue #771 closed<span class="toot-id"> #closed-771</span></h2><div class="pubdate">08 Nov at 20:59:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/771">https://github.com/qt4cg/qtspecs/issues/771</a></div><p>British vs. American English</p></div>
<div class="toot" id="created-824"><h2>Pull request #824 created<span class="toot-id"> #created-824</span></h2><div class="pubdate">08 Nov at 20:42:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/824">https://github.com/qt4cg/qtspecs/pull/824</a></div><details><summary>799 errors in examples; 738 section heading for fn:op</summary><div class="markup"><p>Fix #799
Fix #738</p>
</div></details></div>
<div class="toot" id="created-823"><h2>Pull request #823 created<span class="toot-id"> #created-823</span></h2><div class="pubdate">08 Nov at 20:20:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/823">https://github.com/qt4cg/qtspecs/pull/823</a></div><details><summary>712 Extend array:sort to align with fn:sort</summary><div class="markup"><p>Fix #712</p>
</div></details></div>
<div class="toot" id="closed-480"><h2>Issue #480 closed<span class="toot-id"> #closed-480</span></h2><div class="pubdate">08 Nov at 14:17:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/480">https://github.com/qt4cg/qtspecs/issues/480</a></div><p>Allow type promotion of xs:string to xs:anyURI</p></div>
<div class="toot" id="created-822"><h2>Issue #822 created<span class="toot-id"> #created-822</span></h2><div class="pubdate">08 Nov at 12:41:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/822">https://github.com/qt4cg/qtspecs/issues/822</a></div><details><summary>XQuery, XQFO: Edits (pool)</summary><div class="markup"><p>XQuery spec:</p>
<ul>
<li>[x] 4.3.4 Context Value Reference → 4.3.4 Context Value Reference<strong>s</strong> (plural, in alignment with the other expressions)</li>
<li>[x] Move <strong>4.3.4</strong> before <strong>4.3.3 Parenthesized Expressions</strong> (and after <strong>4.3.2 Variable References</strong>)</li>
<li>[x] 4.19 Switch Expression → 4.19 Switch Expression<strong>s</strong></li>
<li>[x] Try/Catch Expressions: There’s no <code>CatchErrorList</code> anymore</li>
</ul>
<p>XQFO spec:</p>
<ul>
<li>[x] Unify representation of equivalent examples, implementations, …see https://github.com/qt4cg/qtspecs/pull/828#issuecomment-1807222990</li>
<li>[x] Add History sections for new functions</li>
<li>[x] <code>9^XXX outputs "4451"</code> → <code>"3185"</code></li>
<li>[x] errors are signaled → raised (#783)</li>
</ul>
</div></details></div>
<div class="toot" id="closed-820"><h2>Issue #820 closed<span class="toot-id"> #closed-820</span></h2><div class="pubdate">08 Nov at 11:40:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/820">https://github.com/qt4cg/qtspecs/issues/820</a></div><p>FLWOR: Variable Bindings, coercion</p></div>
<div class="toot" id="created-821"><h2>Issue #821 created<span class="toot-id"> #created-821</span></h2><div class="pubdate">08 Nov at 11:32:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/821">https://github.com/qt4cg/qtspecs/issues/821</a></div><details><summary>Annotations: Make default namespace explicit</summary><div class="markup"><p>In XQuery, the default namespace for annotations is <code>http://www.w3.org/2012/</code>. It’s the only namespace for which no prefix exists, and I think we should change that. <code>ann</code> feels like a reasonable choice to me as we tend to have short prefixes (such as <code>err</code> for errors).</p>
</div></details></div>
<div class="toot" id="created-820"><h2>Issue #820 created<span class="toot-id"> #created-820</span></h2><div class="pubdate">08 Nov at 11:25:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/820">https://github.com/qt4cg/qtspecs/issues/820</a></div><details><summary>FLWOR: Variable Bindings, coercion</summary><div class="markup"><p>In the current XQuery 4, the coercion rules are applied to variable bindings of FLWOR expressions:</p>
<p>https://qt4cg.org/specifications/xquery-40/xquery-40-diff.html#id-binding-rules</p>
<p>I believe this is yet another feature that needs to be formally accepted. If it has already been done so, this issue can be closed again immediately (maybe with a reference to the related issue, or the associated QT4 meeting).</p>
</div></details></div>
<div class="toot" id="closed-65"><h2>Issue #65 closed<span class="toot-id"> #closed-65</span></h2><div class="pubdate">08 Nov at 10:00:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/65">https://github.com/qt4cg/qtspecs/issues/65</a></div><p>Support using different input/output element namespaces</p></div>
<div class="toot" id="closed-238"><h2>Issue #238 closed<span class="toot-id"> #closed-238</span></h2><div class="pubdate">08 Nov at 09:59:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/238">https://github.com/qt4cg/qtspecs/issues/238</a></div><p>Support Invisible XML</p></div>
<div class="toot" id="closed-789"><h2>Issue #789 closed<span class="toot-id"> #closed-789</span></h2><div class="pubdate">08 Nov at 09:55:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/789">https://github.com/qt4cg/qtspecs/issues/789</a></div><p>Serialization spec: terminology</p></div>
<div class="toot" id="closed-807"><h2>Issue #807 closed<span class="toot-id"> #closed-807</span></h2><div class="pubdate">08 Nov at 09:55:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/807">https://github.com/qt4cg/qtspecs/pull/807</a></div><p>789 Serialization terminology [editorial]</p></div>
<div class="toot" id="closed-791"><h2>Issue #791 closed<span class="toot-id"> #closed-791</span></h2><div class="pubdate">07 Nov at 18:14:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/791">https://github.com/qt4cg/qtspecs/pull/791</a></div><p>238: First draft of an fn:invisible-xml function</p></div>
<div class="toot" id="closed-130"><h2>Issue #130 closed<span class="toot-id"> #closed-130</span></h2><div class="pubdate">07 Nov at 18:12:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/130">https://github.com/qt4cg/qtspecs/issues/130</a></div><p>New super/union type xs:binary?</p></div>
<div class="toot" id="closed-815"><h2>Issue #815 closed<span class="toot-id"> #closed-815</span></h2><div class="pubdate">07 Nov at 18:12:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/815">https://github.com/qt4cg/qtspecs/pull/815</a></div><p>130,480 Binary Promotion</p></div>
<div class="toot" id="closed-772"><h2>Issue #772 closed<span class="toot-id"> #closed-772</span></h2><div class="pubdate">07 Nov at 18:08:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/772">https://github.com/qt4cg/qtspecs/pull/772</a></div><p>Revise the fn:parse-html rules to make them clearer to follow.</p></div>
<div class="toot" id="closed-809"><h2>Issue #809 closed<span class="toot-id"> #closed-809</span></h2><div class="pubdate">07 Nov at 18:06:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/809">https://github.com/qt4cg/qtspecs/issues/809</a></div><p>Placement of fn:atomic-equal in the specification</p></div>
<div class="toot" id="closed-813"><h2>Issue #813 closed<span class="toot-id"> #closed-813</span></h2><div class="pubdate">07 Nov at 18:06:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/813">https://github.com/qt4cg/qtspecs/pull/813</a></div><p>809 Move fn:atomic-equal to section 14.2</p></div>
<div class="toot" id="closed-806"><h2>Issue #806 closed<span class="toot-id"> #closed-806</span></h2><div class="pubdate">07 Nov at 18:02:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/806">https://github.com/qt4cg/qtspecs/pull/806</a></div><p>566 A few minor fixes for parse-uri</p></div>
<div class="toot" id="closed-804"><h2>Issue #804 closed<span class="toot-id"> #closed-804</span></h2><div class="pubdate">07 Nov at 17:58:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/804">https://github.com/qt4cg/qtspecs/pull/804</a></div><p>Minor edits, XQFO chh. 7, 8</p></div>
<div class="toot" id="closed-651"><h2>Issue #651 closed<span class="toot-id"> #closed-651</span></h2><div class="pubdate">07 Nov at 17:45:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/651">https://github.com/qt4cg/qtspecs/issues/651</a></div><p>fn:log → fn:message</p></div>
<div class="toot" id="closed-803"><h2>Issue #803 closed<span class="toot-id"> #closed-803</span></h2><div class="pubdate">07 Nov at 17:45:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/803">https://github.com/qt4cg/qtspecs/pull/803</a></div><p>651: fn:log → fn:message</p></div>
<div class="toot" id="closed-801"><h2>Issue #801 closed<span class="toot-id"> #closed-801</span></h2><div class="pubdate">07 Nov at 17:45:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/801">https://github.com/qt4cg/qtspecs/issues/801</a></div><p>nondeterministic vs non-deterministic</p></div>
<div class="toot" id="closed-802"><h2>Issue #802 closed<span class="toot-id"> #closed-802</span></h2><div class="pubdate">07 Nov at 17:45:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/802">https://github.com/qt4cg/qtspecs/pull/802</a></div><p>801: non-deterministic → nondeterministic</p></div>
<div class="toot" id="closed-660"><h2>Issue #660 closed<span class="toot-id"> #closed-660</span></h2><div class="pubdate">07 Nov at 17:44:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/660">https://github.com/qt4cg/qtspecs/issues/660</a></div><p>Static functions, default parameters</p></div>
<div class="toot" id="closed-800"><h2>Issue #800 closed<span class="toot-id"> #closed-800</span></h2><div class="pubdate">07 Nov at 17:44:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/800">https://github.com/qt4cg/qtspecs/pull/800</a></div><p>660: Static functions, default parameters, XPST0017</p></div>
<div class="toot" id="closed-797"><h2>Issue #797 closed<span class="toot-id"> #closed-797</span></h2><div class="pubdate">07 Nov at 17:34:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/797">https://github.com/qt4cg/qtspecs/pull/797</a></div><p>Edits to parse-uri()</p></div>
<div class="toot" id="closed-704"><h2>Issue #704 closed<span class="toot-id"> #closed-704</span></h2><div class="pubdate">07 Nov at 17:34:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/704">https://github.com/qt4cg/qtspecs/issues/704</a></div><p>Context Value Expression → Context Value Reference</p></div>
<div class="toot" id="closed-793"><h2>Issue #793 closed<span class="toot-id"> #closed-793</span></h2><div class="pubdate">07 Nov at 17:34:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/793">https://github.com/qt4cg/qtspecs/pull/793</a></div><p>704: Context Value Expression → Context Value Reference</p></div>
<div class="toot" id="closed-819"><h2>Issue #819 closed<span class="toot-id"> #closed-819</span></h2><div class="pubdate">07 Nov at 17:33:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/819">https://github.com/qt4cg/qtspecs/pull/819</a></div><p>Fix markup error in example</p></div>
<div class="toot" id="created-819"><h2>Pull request #819 created<span class="toot-id"> #created-819</span></h2><div class="pubdate">07 Nov at 17:33:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/819">https://github.com/qt4cg/qtspecs/pull/819</a></div><p>Fix markup error in example</p></div>
<div class="toot" id="closed-792"><h2>Issue #792 closed<span class="toot-id"> #closed-792</span></h2><div class="pubdate">07 Nov at 17:21:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/792">https://github.com/qt4cg/qtspecs/pull/792</a></div><p>783 XSLT: errors are raised</p></div>
<div class="toot" id="closed-790"><h2>Issue #790 closed<span class="toot-id"> #closed-790</span></h2><div class="pubdate">07 Nov at 17:21:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/790">https://github.com/qt4cg/qtspecs/pull/790</a></div><p>129 XSLT40 and SER40 changes for context item -&gt; value</p></div>
<div class="toot" id="closed-775"><h2>Issue #775 closed<span class="toot-id"> #closed-775</span></h2><div class="pubdate">07 Nov at 17:21:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/775">https://github.com/qt4cg/qtspecs/pull/775</a></div><p>517: Reflected Christian Gruen's remarks</p></div>
<div class="toot" id="minutes-11-07"><h2>QT4 CG meeting 053 draft minutes<span class="toot-id"> #minutes-11-07</span></h2><div class="pubdate">07 Nov at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/11-07">https://qt4cg.org/meeting/minutes/2023/11-07</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-756"><h2>Issue #756 closed<span class="toot-id"> #closed-756</span></h2><div class="pubdate">07 Nov at 17:18:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/756">https://github.com/qt4cg/qtspecs/issues/756</a></div><p>JSON serialization - number formatting</p></div>
<div class="toot" id="created-818"><h2>Issue #818 created<span class="toot-id"> #created-818</span></h2><div class="pubdate">07 Nov at 14:46:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/818">https://github.com/qt4cg/qtspecs/issues/818</a></div><details><summary>Foxpath integration</summary><div class="markup"><p>This is a placeholder issue for Syd Bauman’s <a href="https://app.slack.com/client/T011VK9115Z/C01GVC3JLHE">suggestion on Slack</a> to integrate Foxpath, or parts of it, in the standard.</p>
</div></details></div>
<div class="toot" id="created-817"><h2>Issue #817 created<span class="toot-id"> #created-817</span></h2><div class="pubdate">06 Nov at 20:31:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/817">https://github.com/qt4cg/qtspecs/issues/817</a></div><details><summary>EBV 4.0</summary><div class="markup"><p>Yes, I dare to question the semantics of effective boolean values. The reason is that I never learned to fully like them. It seems obvious where the rules come from, and why they have been reasonable in previous versions of the language. From today’s perspective, I think there’s really some need to simplify and unify the rules, and I believe it’s possible with little effort and without endangering backward compatibility (provided that we are willing to drop errors and return results).</p>
<p>Some examples for the somewhat strange nature of the current rules:</p>
<ul>
<li><code>boolean((&lt;_&gt;x&lt;/_&gt;, &lt;_&gt;y&lt;/_&gt;))</code> returns <code>true</code>, whereas <code>boolean(('x', 'y'))</code> raises an error.</li>
<li><code>boolean(xs:NCName('x'))</code> returns <code>true</code>, whereas <code>boolean(xs:QName('x'))</code> raises an error.</li>
<li><code>boolean((&lt;a/&gt;, 1))</code> and <code>boolean((1, &lt;a/&gt;))</code> may either return <code>true</code> or raise an error, depending on the implementation.</li>
</ul>
<p>I believe it will make much more sense to</p>
<ol>
<li>check all values of the input equally (in analogy to the existential semantics of general comparisons), and</li>
<li>use existence checks for more types instead of raising a clueless error.</li>
</ol>
<p>The semantics would be tidied up a lot, it could look like this…</p>
<pre><code class="language-xquery">declare function ebv($input as item()*) as xs:boolean {
  some $item in $input satisfies typeswitch($item) {
    case xs:untypedAtomic | xs:string | xs:anyURI  return $item != ''
    case xs:numeric                                return $item != 0
    case xs:boolean                                return $item
    default                                        return true()
  }
};
</code></pre>
<p>…or, if we include more types, like this:</p>
<pre><code class="language-xquery">declare function ebv($input as item()*) as xs:boolean {
  some $item in $input satisfies typeswitch($item) {
    case xs:untypedAtomic | xs:string | xs:anyURI  return $item != ''
    case xs:numeric                                return $item != 0
    case xs:boolean                                return $item
    case xs:base64Binary                           return $item != xs:base64Binary('')
    case xs:hexBinary                              return $item != xs:hexBinary('')
    case array(*)                                  return array:size($item) != 0
    case map(*)                                    return map:size($item) != 0
    default                                        return true()
  }
};
</code></pre>
<p>(If we believe that it’s too progressive to accept all types, we could still raise an error for some specific types… although I don’t think that anyone would benefit from this choice).</p>
<p>As a result, EBV checks could also be used to check more than one item:</p>
<pre><code class="language-xquery">(: true if at least one tokenized string is non-empty :)
if(tokenize('a/', '/')) then ...
(: true if at least one number is unequal to 0 :)
if($numbers) then ...
(: true if at least one Boolean is true :)
if(false(), true(), true()) then ...
</code></pre>
<p>Nothing would change for the classical EBV checks: <code>if($node/*)</code>, <code>if($x = $y)</code>, <code>if($ok)</code>, …</p>
<p>Regarding “1. check all values of the input equally”, one could argue that this might affect performance. I don’t actually think so: For node sequences, it will still be sufficient to retrieve only the first item. For mixed-type sequences, errors were raised in the past.</p>
<p>The resulting EBV could be easily combined with revised predicate semantics (#816).</p>
</div></details></div>
<div class="toot" id="created-816"><h2>Issue #816 created<span class="toot-id"> #created-816</span></h2><div class="pubdate">06 Nov at 15:43:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/816">https://github.com/qt4cg/qtspecs/issues/816</a></div><details><summary>Predicates: Support for numeric sequences </summary><div class="markup"><p>Predicates provide a compact syntax for positional access to sequences but only single numbers are supported.</p>
<p>It would be handy to allow <code>E[1, 2, 3]</code> (<code>E[3, 2, 1]</code>, <code>E[1 to 3]</code>, etc.) as a shortcut for <code>E[position() = (1, 2, 3)]</code> (MarkLogic offers this possibility, if I remember correctly). We shouldn’t change the EBV syntax, and we should continue raising an error  if the predicate sequence contains items other than numbers. Examples:</p>
<p>Expression | Result
--- | ---
<code>(1 to 5)[2, 3]</code> | <code>2, 3</code>
<code>(1 to 5)[3, 2]</code> | <code>2, 3</code>
<code>(1 to 5)[2 to 3]</code> | <code>2, 3</code>
<code>(1 to 5)[6, 'x']</code> | <em>error</em>
<code>(1 to 5)[1 to 5, 'x']</code> | <code>1, 2, 3, 4, 5</code> or <em>error</em> (up to the implementation, similar to sequences that start with a node)</p>
<p>I bet this has already been discussed in the past…</p>
</div></details></div>
<div class="toot" id="agenda-11-07"><h2>QT4 CG meeting 053 draft agenda<span class="toot-id"> #agenda-11-07</span></h2><div class="pubdate">06 Nov at 09:50:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/11-07">https://qt4cg.org/meeting/agenda/2023/11-07</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-538"><h2>Issue #538 closed<span class="toot-id"> #closed-538</span></h2><div class="pubdate">06 Nov at 09:21:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/538">https://github.com/qt4cg/qtspecs/pull/538</a></div><p>480: Attempt to allow xs:string to be 'promoted to' xs:anyURI</p></div>
<div class="toot" id="created-815"><h2>Pull request #815 created<span class="toot-id"> #created-815</span></h2><div class="pubdate">03 Nov at 18:15:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/815">https://github.com/qt4cg/qtspecs/pull/815</a></div><details><summary>130,480 Binary Promotion</summary><div class="markup"><p>Introduces mutual promotion between xs:base64Binary and xs:hexBinary. Fix #130.</p>
<p>Reorganises the material on type promotion. Supersedes PR #538.</p>
</div></details></div>
<div class="toot" id="created-814"><h2>Issue #814 created<span class="toot-id"> #created-814</span></h2><div class="pubdate">03 Nov at 08:53:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/814">https://github.com/qt4cg/qtspecs/issues/814</a></div><details><summary>XSLT: Rules for on-no-match="shallow-copy-all"</summary><div class="markup"><p>There are some details missing for the error handling of the built-in template processing for <code>shallow-copy-all</code>.</p>
<p>When the built-in template processes an array, the built-in rule constructs a value record for each member, and applies-templates to this value record, expecting the result to be a value record.</p>
<ul>
<li>It's not stated whether the "value record" is extensible, that is, whether it can contain fields other than "value"</li>
<li>No error code is given, and it's not identified explicitly as a type error.</li>
</ul>
<p>Similarly when a map is processed, the result is expected to be a key-value record, but the details of the error are not spelled out.</p>
</div></details></div>
<div class="toot" id="created-813"><h2>Pull request #813 created<span class="toot-id"> #created-813</span></h2><div class="pubdate">02 Nov at 18:47:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/813">https://github.com/qt4cg/qtspecs/pull/813</a></div><details><summary>809 Move fn:atomic-equal to section 14.2</summary><div class="markup"><p>Fix #809</p>
</div></details></div>
<div class="toot" id="created-812"><h2>Issue #812 created<span class="toot-id"> #created-812</span></h2><div class="pubdate">02 Nov at 10:59:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/812">https://github.com/qt4cg/qtspecs/issues/812</a></div><details><summary>Coercion Rules: Unifications</summary><div class="markup"><p>It has always been a challenge to teach the difference between a conversion, coercion, promotion, casts and treats. Of course, we cannot get rid of the complexity, but I think it’s a good step forward that the conversion rules have recently been unified in the specification.</p>
<p>Maybe we can push it even further. I would suggest…</p>
<ol>
<li>renaming “Coercion Rules” to “Type Coercion” (…most other sections contain rules as well),</li>
<li>making “Function Coercion” a subsection of “Type Coercion”, and</li>
<li>making “Type Promotion” another subsection of “Type Coercion”.</li>
</ol>
<p>I’m the wrong person to decide this, but maybe the full section can be moved to the Appendix, as it’s referenced all around the documents.</p>
</div></details></div>
<div class="toot" id="closed-811"><h2>Issue #811 closed<span class="toot-id"> #closed-811</span></h2><div class="pubdate">01 Nov at 19:16:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/811">https://github.com/qt4cg/qtspecs/pull/811</a></div><p>Highlight changed functions in the ToCs and headings</p></div>
<div class="toot" id="created-811"><h2>Pull request #811 created<span class="toot-id"> #created-811</span></h2><div class="pubdate">01 Nov at 19:16:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/811">https://github.com/qt4cg/qtspecs/pull/811</a></div><details><summary>Highlight changed functions in the ToCs and headings</summary><div class="markup"><p>Obviously, I should have done icons for functions that have changed as well. So now I have. I'm not convinced that the 🆙 emoji is sufficiently different from the 🆕 emoji. Maybe I should try to make them different colors or something. But it's a start.</p>
</div></details></div>
<div class="toot" id="closed-810"><h2>Issue #810 closed<span class="toot-id"> #closed-810</span></h2><div class="pubdate">01 Nov at 16:23:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/810">https://github.com/qt4cg/qtspecs/pull/810</a></div><p>Fix line endings</p></div>
<div class="toot" id="created-810"><h2>Pull request #810 created<span class="toot-id"> #created-810</span></h2><div class="pubdate">01 Nov at 16:23:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/810">https://github.com/qt4cg/qtspecs/pull/810</a></div><details><summary>Fix line endings</summary><div class="markup"><p>This PR adds a <code>.gitattributes</code> file that identifies some files explicitly as text files (and others explicitly as binary files).</p>
<p>After this PR is merged, I believe it will be the case that end-of-line handling will be correct on a per-platform basis. That is, if a Windows user checks out the repository, all the files will have PC-style line endings (CR followed by LF). If a Mac or Unix user checks out the repository, all the files will have Unix-style line endings (LF).</p>
<p>Commits should "do the right thing" to preserve the line endings appropriately.</p>
<p>Fingers crossed!</p>
</div></details></div>
<div class="toot" id="created-809"><h2>Issue #809 created<span class="toot-id"> #created-809</span></h2><div class="pubdate">01 Nov at 14:35:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/809">https://github.com/qt4cg/qtspecs/issues/809</a></div><details><summary>Placement of fn:atomic-equal in the specification</summary><div class="markup"><p>On the XML.com slack, Pieter Lamers observes that <code>fn:atomic-equal</code> looks a little out of place in chapter 18 with the other map functions.</p>
</div></details></div>
<div class="toot" id="closed-808"><h2>Issue #808 closed<span class="toot-id"> #closed-808</span></h2><div class="pubdate">01 Nov at 13:22:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/808">https://github.com/qt4cg/qtspecs/pull/808</a></div><p>Tweaks to highlight new functions in F&amp;O</p></div>
<div class="toot" id="created-808"><h2>Pull request #808 created<span class="toot-id"> #created-808</span></h2><div class="pubdate">01 Nov at 13:21:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/808">https://github.com/qt4cg/qtspecs/pull/808</a></div><details><summary>Tweaks to highlight new functions in F&amp;O</summary><div class="markup"><p>Following a discussion on the XML.com slack, this is a little lunchtime hackery...</p>
<p>Any function listed in the <code>new-functions</code> section of the changes appendix or identified with an <code>ednote</code> that contains the string <code>New in 4.0</code> will be marked as 🆕 in the specification. The 🆕 occurs in the ToC, the drop-down function list, and to the left of the section title.</p>
<p>(I'm just going to merge this as it has no spec changes and the effect won't be visible in the PR anyway.)</p>
</div></details></div>
<div class="toot" id="created-807"><h2>Pull request #807 created<span class="toot-id"> #created-807</span></h2><div class="pubdate">01 Nov at 10:40:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/807">https://github.com/qt4cg/qtspecs/pull/807</a></div><details><summary>789 Serialization terminology [editorial]</summary><div class="markup"><p>"Instance of the data model" generally becomes "input tree"</p>
<p>An instance of the data model used to hold serialization parameters is now referred to as a "parameter document".</p>
<p>Fix #789</p>
</div></details></div>
<div class="toot" id="created-806"><h2>Pull request #806 created<span class="toot-id"> #created-806</span></h2><div class="pubdate">01 Nov at 09:43:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/806">https://github.com/qt4cg/qtspecs/pull/806</a></div><details><summary>566 A few minor fixes for parse-uri</summary><div class="markup"><p>As CG observes in <a href="https://github.com/qt4cg/qtspecs/issues/566#issuecomment-1787666119">issue 566</a>, there are still a couple of small problems with <code>fn:parse-uri()</code>.</p>
<ol>
<li>The regular expressions used to parse the fragment identifier and query are incorrect. The URI specification allows <code>?</code> to appear in a query string and <code>#</code> to appear in a fragment identifier, so the expressions have been rewritten to match everything after the first <code>?</code> and <code>#</code>, respectively, even if they contain additional <code>?</code> or <code>#</code> characters.</li>
<li>The description of how to interpret the regular expression for parsing a Windows file path preceded by slashes was incorrect. It caused the leading "/" to be lost. That's been corrected.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-805"><h2>Issue #805 closed<span class="toot-id"> #closed-805</span></h2><div class="pubdate">01 Nov at 08:42:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/805">https://github.com/qt4cg/qtspecs/pull/805</a></div><p>Improve formatting of FO examples</p></div>
<div class="toot" id="created-805"><h2>Pull request #805 created<span class="toot-id"> #created-805</span></h2><div class="pubdate">31 Oct at 22:02:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/805">https://github.com/qt4cg/qtspecs/pull/805</a></div><details><summary>Improve formatting of FO examples</summary><div class="markup"><p>Stylesheet changes to improve the formatting of F&amp;O examples. (But they still aren't perfect...!)</p>
<ol>
<li>
<p>Variables used by the examples are pulled out under a separate heading.</p>
</li>
<li>
<p>If any examples include long lines, then single-column ("wide") format is used automatically.</p>
</li>
<li>
<p>In two-column layout, if the left-hand column uses "eg" format, then so does the right-hand column. (But it would be nice to get rid of the grey background for this case).</p>
</li>
</ol>
</div></details></div>
<div class="toot" id="created-804"><h2>Pull request #804 created<span class="toot-id"> #created-804</span></h2><div class="pubdate">31 Oct at 21:32:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/804">https://github.com/qt4cg/qtspecs/pull/804</a></div><details><summary>Minor edits, XQFO chh. 7, 8</summary><div class="markup"><p>In addition to a minor typo, note the following:</p>
<ul>
<li>rearrangement of a rule for <code>$input</code> (the original syntax, mixing types and derived types, confused me)</li>
<li>examples in <code>X-from-Y</code> duration functions to help illustrate the problem when mixing the two components of a duration.</li>
</ul>
</div></details></div>
<div class="toot" id="closed-753"><h2>Issue #753 closed<span class="toot-id"> #closed-753</span></h2><div class="pubdate">31 Oct at 19:22:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/753">https://github.com/qt4cg/qtspecs/pull/753</a></div><p>65: Allow xmlns="xxx" to NOT change the default namespace for NameTests</p></div>
<div class="toot" id="minutes-10-31"><h2>QT4 CG meeting 052 draft minutes<span class="toot-id"> #minutes-10-31</span></h2><div class="pubdate">31 Oct at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/10-31">https://qt4cg.org/meeting/minutes/2023/10-31</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-770"><h2>Issue #770 closed<span class="toot-id"> #closed-770</span></h2><div class="pubdate">31 Oct at 17:12:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/770">https://github.com/qt4cg/qtspecs/pull/770</a></div><p>566: Use fn:decode-from-uri in fn:parse-uri</p></div>
<div class="toot" id="closed-469"><h2>Issue #469 closed<span class="toot-id"> #closed-469</span></h2><div class="pubdate">31 Oct at 17:11:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/469">https://github.com/qt4cg/qtspecs/issues/469</a></div><p>array:of-members, map:of-pairs: Signatures, Examples</p></div>
<div class="toot" id="closed-782"><h2>Issue #782 closed<span class="toot-id"> #closed-782</span></h2><div class="pubdate">31 Oct at 17:11:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/782">https://github.com/qt4cg/qtspecs/pull/782</a></div><p>469: array:of-members, map:of-pairs: Signatures, Examples</p></div>
<div class="toot" id="closed-778"><h2>Issue #778 closed<span class="toot-id"> #closed-778</span></h2><div class="pubdate">31 Oct at 17:11:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/778">https://github.com/qt4cg/qtspecs/pull/778</a></div><p>XQFO edits 5.4-5.6</p></div>
<div class="toot" id="closed-784"><h2>Issue #784 closed<span class="toot-id"> #closed-784</span></h2><div class="pubdate">31 Oct at 17:11:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/784">https://github.com/qt4cg/qtspecs/pull/784</a></div><p>fos xsd</p></div>
<div class="toot" id="closed-785"><h2>Issue #785 closed<span class="toot-id"> #closed-785</span></h2><div class="pubdate">31 Oct at 17:11:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/785">https://github.com/qt4cg/qtspecs/pull/785</a></div><p>777: updated history</p></div>
<div class="toot" id="closed-786"><h2>Issue #786 closed<span class="toot-id"> #closed-786</span></h2><div class="pubdate">31 Oct at 17:10:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/786">https://github.com/qt4cg/qtspecs/pull/786</a></div><p>695: Added xref to fn:slice()</p></div>
<div class="toot" id="closed-787"><h2>Issue #787 closed<span class="toot-id"> #closed-787</span></h2><div class="pubdate">31 Oct at 17:10:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/787">https://github.com/qt4cg/qtspecs/pull/787</a></div><p>783(part) - Editorial changes to Serialization spec</p></div>
<div class="toot" id="created-803"><h2>Pull request #803 created<span class="toot-id"> #created-803</span></h2><div class="pubdate">31 Oct at 17:01:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/803">https://github.com/qt4cg/qtspecs/pull/803</a></div><details><summary>651: fn:log → fn:message</summary><div class="markup"><p>Closes #651</p>
</div></details></div>
<div class="toot" id="created-802"><h2>Pull request #802 created<span class="toot-id"> #created-802</span></h2><div class="pubdate">31 Oct at 12:47:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/802">https://github.com/qt4cg/qtspecs/pull/802</a></div><details><summary>801: non-deterministic → nondeterministic</summary><div class="markup"><p>Closes #801</p>
</div></details></div>
<div class="toot" id="created-801"><h2>Issue #801 created<span class="toot-id"> #created-801</span></h2><div class="pubdate">31 Oct at 12:45:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/801">https://github.com/qt4cg/qtspecs/issues/801</a></div><details><summary>nondeterministic vs non-deterministic</summary><div class="markup"><p>In the specs, both “nondeterministic” and “non-deterministic” can be found. The first one is more frequent, so I guess it’s the one that’s preferred.</p>
</div></details></div>
<div class="toot" id="closed-359"><h2>Issue #359 closed<span class="toot-id"> #closed-359</span></h2><div class="pubdate">31 Oct at 10:57:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/359">https://github.com/qt4cg/qtspecs/issues/359</a></div><p>fn:void: Absorb result of evaluated argument</p></div>
<div class="toot" id="created-800"><h2>Pull request #800 created<span class="toot-id"> #created-800</span></h2><div class="pubdate">31 Oct at 10:51:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/800">https://github.com/qt4cg/qtspecs/pull/800</a></div><details><summary>660: Static functions, default parameters, XPST0017</summary><div class="markup"><p>I’ve chosen XPST0017 over XPST0003 (it felt more intuitive to me).</p>
<p>Closes #660.</p>
</div></details></div>
<div class="toot" id="created-799"><h2>Issue #799 created<span class="toot-id"> #created-799</span></h2><div class="pubdate">31 Oct at 10:27:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/799">https://github.com/qt4cg/qtspecs/issues/799</a></div><details><summary>Errors in F&amp;O spec examples</summary><div class="markup"><p>In fn:expanded-QName, <code>http:/example.com</code> should be <code>http://example.com</code>.</p>
<p>In map:merge, there's a stray "(" in</p>
<pre><code>map:merge((
  ($week, map { 7: "Unbekannt" })
)
</code></pre>
</div></details></div>
<div class="toot" id="created-798"><h2>Pull request #798 created<span class="toot-id"> #created-798</span></h2><div class="pubdate">31 Oct at 10:19:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/798">https://github.com/qt4cg/qtspecs/pull/798</a></div><details><summary>479: fn:deep-equal: Input order</summary><div class="markup"><p>I decided to follow my initial suggestion and add <code>unordered</code> to <code>fn:deep-equal</code> instead of adding a separate function for it. My motivation:</p>
<ul>
<li>It’s convenient to be able to use the new option in combination with the other options.</li>
<li>It will be used more often than many other options we’ve added recently.</li>
<li>It seemed pretty straightforward to add, both in terms of documentation and implementation.</li>
</ul>
<p>Closes #479</p>
</div></details></div>
<div class="toot" id="created-797"><h2>Pull request #797 created<span class="toot-id"> #created-797</span></h2><div class="pubdate">31 Oct at 03:33:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/797">https://github.com/qt4cg/qtspecs/pull/797</a></div><details><summary>Edits to parse-uri()</summary><div class="markup"><p>Attn @ndw -- these edits pertain to 6.6.1 <code>fn:parse-uri</code> and require your careful review.</p>
<ul>
<li><code>hierarchical</code> option appears in the rules of the function but not its preamble</li>
<li>"This function is described..." moved to anticipate the actual narrative.</li>
<li>I was a bit thrown by the phrase "This approach...is not implementation advice" because "approach" is vague and the reader is left with the impression that a good deal of <em>something</em> that follows is non-normative. We offer non-normative prose in the rules, but that informal prose is normally followed by an equivalent description that <em>is</em> normative. I did not make any edits in this area, but I would recommend clarification as to exactly what parts of the narrative are normative and which are non-normative.</li>
<li>The period-to-colon change at 27573 is to make sure the reader remains aware of the governing "If..." clause.</li>
<li>I deleted a paragraph that attempted to distill the rather complicated description of <code>fn:decode-from-uri</code>. A mere xref provides a cleaner narrative here and a more accurate description of uri decoding, and the xref is within the same document, so should not pose a burden on the reader.</li>
<li>For the <code>query-parameters</code> there was a discrepancy in the data model presented (in the preamble versus in the function rules), and I opted for the array-of-maps model. If it's supposed to be the other way (simple map), let me know and I'll revise.</li>
<li><code>query-segments</code> versus <code>query-parameters</code>; I went with the latter.</li>
</ul>
<p>Let me know where things ain't right.</p>
</div></details></div>
<div class="toot" id="created-796"><h2>Issue #796 created<span class="toot-id"> #created-796</span></h2><div class="pubdate">30 Oct at 17:28:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/796">https://github.com/qt4cg/qtspecs/issues/796</a></div><details><summary>allow explicit type expressions in XPath variable bindings</summary><div class="markup"><p>It would be useful to be able to write</p>
<p><code>   let $n as xs:integer := some_expr ....</code></p>
<p>and also maybe</p>
<p><code> for $s as xs:string, $p as my:name return....</code></p>
<p>This might occur e.g. in the body of a function, for example... and would help type safety and debugging.</p>
</div></details></div>
<div class="toot" id="created-795"><h2>Pull request #795 created<span class="toot-id"> #created-795</span></h2><div class="pubdate">30 Oct at 15:02:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/795">https://github.com/qt4cg/qtspecs/pull/795</a></div><details><summary>655: fn:sort-with</summary><div class="markup"><p>Closes #655</p>
</div></details></div>
<div class="toot" id="created-794"><h2>Pull request #794 created<span class="toot-id"> #created-794</span></h2><div class="pubdate">30 Oct at 14:05:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/794">https://github.com/qt4cg/qtspecs/pull/794</a></div><details><summary>216: fn:unparsed-text: End-of-line characters</summary><div class="markup"><p>Closes #216. See this issue for more details on the proposed change.</p>
</div></details></div>
<div class="toot" id="created-793"><h2>Pull request #793 created<span class="toot-id"> #created-793</span></h2><div class="pubdate">30 Oct at 13:33:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/793">https://github.com/qt4cg/qtspecs/pull/793</a></div><details><summary>704: Context Value Expression → Context Value Reference</summary><div class="markup"><p>Closes #704</p>
</div></details></div>
<div class="toot" id="created-792"><h2>Pull request #792 created<span class="toot-id"> #created-792</span></h2><div class="pubdate">30 Oct at 12:52:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/792">https://github.com/qt4cg/qtspecs/pull/792</a></div><details><summary>783 XSLT: errors are raised</summary><div class="markup"><p>See issue #783.</p>
<p>Errors are raised, not signalled or reported or generated or thrown.</p>
</div></details></div>
<div class="toot" id="created-791"><h2>Pull request #791 created<span class="toot-id"> #created-791</span></h2><div class="pubdate">30 Oct at 12:37:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/791">https://github.com/qt4cg/qtspecs/pull/791</a></div><details><summary>238: First draft of an fn:invisible-xml function</summary><div class="markup"><p>Pursuant to action QT4CG-051-02, here is a proposal for <code>fn:invisible-xml</code>.</p>
<p>There are a number of different design choices that could be made. For example, one could argue that a function of the form <code>fn:invisible-xml($grammar as xs:anyURI, $input as xs:anyURI)</code> would be the easiest thing for users in many cases. But not in all cases. You might want versions where either the grammar or the input were strings instead of URIs.</p>
<p>I've attempted to craft the smallest proposal that could get the job done.</p>
</div></details></div>
<div class="toot" id="created-790"><h2>Pull request #790 created<span class="toot-id"> #created-790</span></h2><div class="pubdate">30 Oct at 11:23:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/790">https://github.com/qt4cg/qtspecs/pull/790</a></div><details><summary>129 XSLT40 and SER40 changes for context item -&gt; value</summary><div class="markup"><p>Proposes XSLT 4.0 and Serialization 4.0 changes resulting from the generalization of context item to context value in XPath 4.0.</p>
<p>The serialization changes are purely editorial.</p>
<p>In XSLT, we acknowledge the introduction of the context value in XPath but don't take advantage of it; at the XSLT level, the context value for an instruction is still always a single item. The only technical change is that we allow xsl:evaluate to pass any value as the context value to the dynamically evaluated expression (while retaining the name of the relevant attribute "context-item").</p>
<p>Fulfils action QT4CG-046-01</p>
</div></details></div>
<div class="toot" id="agenda-10-31"><h2>QT4 CG meeting 052 draft agenda<span class="toot-id"> #agenda-10-31</span></h2><div class="pubdate">30 Oct at 11:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/10-31">https://qt4cg.org/meeting/agenda/2023/10-31</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-789"><h2>Issue #789 created<span class="toot-id"> #created-789</span></h2><div class="pubdate">30 Oct at 11:09:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/789">https://github.com/qt4cg/qtspecs/issues/789</a></div><details><summary>Serialization spec: terminology</summary><div class="markup"><p>The serialization spec makes extensive use of the phrase "an instance of the data model". This phrase is defined to be a synonym of "value" or "sequence", and it seems to add a lot of words without adding any clarity. In many cases the context makes clear that it is actually referring to a tree rooted at a document node.</p>
<p>In section 3.1 "Setting Serialization Parameters by Means of a Data Model Instance" it would be helpful to use a more specific phrase, for example "a parameter document".</p>
<p>Elsewhere the phrase is often used to mean "the value being serialized", and again, it would be helpful to use a more specific phrase, perhaps a term that is quite distinctive such as "the payload". (It's sometimes referred to as "the result tree", but that assumes that the value being serialized is the result of a query or stylesheet.)</p>
</div></details></div>
<div class="toot" id="created-788"><h2>Issue #788 created<span class="toot-id"> #created-788</span></h2><div class="pubdate">30 Oct at 08:48:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/788">https://github.com/qt4cg/qtspecs/issues/788</a></div><details><summary>New function fn:annotate()</summary><div class="markup"><p>I propose a function fn:annotate() which will add annotations to a function item. It will create a new function item that differs from the original only in its annotations.</p>
<p>Currently annotations are a dynamic property of function items, but they can only be set in very limited ways. Allowing them to be set dynamically creates lot of opportunities. For example, there is currently no way to set annotations on a map or array, but one could define annotations, for example, to indicate that a map should hold entries ordered by key, or that an array should use a "sparse" implementation; there is scope both for spec-defined and vendor-defined (and perhaps even user-defined) annotations.</p>
<p>Some of the possibilities this would open up have been outlined in other issues. At present, though, we have a capability in the data model that is underexploited, and an <code>fn:annotate()</code> function is a conceptually simple addition, which can be justified purely on the grounds of completeness - if something exists in the data model, surely it should have getters and setters?</p>
</div></details></div>
<div class="toot" id="closed-635"><h2>Issue #635 closed<span class="toot-id"> #closed-635</span></h2><div class="pubdate">30 Oct at 08:43:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/635">https://github.com/qt4cg/qtspecs/pull/635</a></div><p>451: Schema compatibility</p></div>
<div class="toot" id="closed-765"><h2>Issue #765 closed<span class="toot-id"> #closed-765</span></h2><div class="pubdate">30 Oct at 08:41:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/765">https://github.com/qt4cg/qtspecs/issues/765</a></div><p>XQuery version declaration: upgrade to 4.0</p></div>
<div class="toot" id="closed-766"><h2>Issue #766 closed<span class="toot-id"> #closed-766</span></h2><div class="pubdate">30 Oct at 08:41:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/766">https://github.com/qt4cg/qtspecs/pull/766</a></div><p>765 Update version references etc to 4.0 status</p></div>
<div class="toot" id="created-787"><h2>Pull request #787 created<span class="toot-id"> #created-787</span></h2><div class="pubdate">27 Oct at 07:46:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/787">https://github.com/qt4cg/qtspecs/pull/787</a></div><details><summary>783(part) - Editorial changes to Serialization spec</summary><div class="markup"><ol>
<li>Errors are raised, not signaled</li>
<li>Cross-references point to 4.0 specs rather than 3.0/3.1</li>
<li>Some internal markup changes for tidiness</li>
</ol>
<p>Partial fix for #783 as it affects the serialization spec.</p>
</div></details></div>
<div class="toot" id="closed-695"><h2>Issue #695 closed<span class="toot-id"> #closed-695</span></h2><div class="pubdate">26 Oct at 22:22:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/695">https://github.com/qt4cg/qtspecs/issues/695</a></div><p>Step in RangeExpression</p></div>
<div class="toot" id="created-786"><h2>Pull request #786 created<span class="toot-id"> #created-786</span></h2><div class="pubdate">26 Oct at 22:21:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/786">https://github.com/qt4cg/qtspecs/pull/786</a></div><details><summary>695: Added xref to fn:slice()</summary><div class="markup"><p>This closes #695 .</p>
</div></details></div>
<div class="toot" id="closed-777"><h2>Issue #777 closed<span class="toot-id"> #closed-777</span></h2><div class="pubdate">26 Oct at 22:09:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/777">https://github.com/qt4cg/qtspecs/issues/777</a></div><p>new replace() parameter $action</p></div>
<div class="toot" id="created-785"><h2>Pull request #785 created<span class="toot-id"> #created-785</span></h2><div class="pubdate">26 Oct at 22:07:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/785">https://github.com/qt4cg/qtspecs/pull/785</a></div><details><summary>777: updated history</summary><div class="markup"><p>Closes issue #777</p>
</div></details></div>
<div class="toot" id="created-784"><h2>Pull request #784 created<span class="toot-id"> #created-784</span></h2><div class="pubdate">26 Oct at 21:54:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/784">https://github.com/qt4cg/qtspecs/pull/784</a></div><details><summary>fos xsd</summary><div class="markup"><p><a href="xsd:assert">xsd:assert</a> is illegal in schema version 1.0; updated to specify version 1.1.</p>
</div></details></div>
<div class="toot" id="created-783"><h2>Issue #783 created<span class="toot-id"> #created-783</span></h2><div class="pubdate">26 Oct at 21:49:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/783">https://github.com/qt4cg/qtspecs/issues/783</a></div><details><summary>Editorial: errors are raised (not reported, signaled, generated, or thrown).</summary><div class="markup"><p>The most common phrase we use when describing an error condition is "A (dynamic|static|type) error is raised if ...".</p>
<p>There are other cases where we use the verb "reported" or "signaled" (and occasionally, "thrown" or "generated"). We should avoid these verbs, partly in the interests of consistency, and partly because they are misleading: an error is not reported if it is caught by a try/catch, but it is still raised.</p>
<p>XSLT also commonly uses the phrase "It is a (dynamic|static|type) error if ... " which is also acceptable.</p>
</div></details></div>
<div class="toot" id="created-782"><h2>Pull request #782 created<span class="toot-id"> #created-782</span></h2><div class="pubdate">26 Oct at 13:26:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/782">https://github.com/qt4cg/qtspecs/pull/782</a></div><details><summary>469: array:of-members, map:of-pairs: Signatures, Examples</summary><div class="markup"><p>I’ve eventually renamed <code>$pairs</code> to <code>$input</code> (I didn’t rename <code>$input</code> to $members<code>as initially suggested, as we have</code>$member<code>parameters in other functions that are of type</code>item()<em><code>, not </code>record(value as item()</em>)`).</p>
<p>Closes #469</p>
</div></details></div>
<div class="toot" id="closed-776"><h2>Issue #776 closed<span class="toot-id"> #closed-776</span></h2><div class="pubdate">26 Oct at 11:37:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/776">https://github.com/qt4cg/qtspecs/issues/776</a></div><p>/etc/XT40 does not get built</p></div>
<div class="toot" id="closed-781"><h2>Issue #781 closed<span class="toot-id"> #closed-781</span></h2><div class="pubdate">26 Oct at 11:37:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/781">https://github.com/qt4cg/qtspecs/pull/781</a></div><p>Fix etc_XT40 output file</p></div>
<div class="toot" id="created-781"><h2>Pull request #781 created<span class="toot-id"> #created-781</span></h2><div class="pubdate">26 Oct at 11:37:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/781">https://github.com/qt4cg/qtspecs/pull/781</a></div><details><summary>Fix etc_XT40 output file</summary><div class="markup"><p>Fix #776</p>
<p>You'll need to pull and rebase <code>master</code> after I merge this.</p>
</div></details></div>
<div class="toot" id="closed-764"><h2>Issue #764 closed<span class="toot-id"> #closed-764</span></h2><div class="pubdate">26 Oct at 07:25:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/764">https://github.com/qt4cg/qtspecs/issues/764</a></div><p>XQuery: Simplify module imports</p></div>
<div class="toot" id="created-780"><h2>Issue #780 created<span class="toot-id"> #created-780</span></h2><div class="pubdate">26 Oct at 04:04:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/780">https://github.com/qt4cg/qtspecs/issues/780</a></div><details><summary>format-number() etc incompatibility</summary><div class="markup"><p>We have changed format-number() and some XSLT functions including system-property(), function-available() etc so that the QName-valued argument is now declared with type union(xs:string, xs:QName) rather than xs:string. I believe that there are edge cases where this is an incompatible change -- for example if the supplied value is an xs:anyURI value. I think the edge cases are probably sufficiently obscure and unlikely to occur in practice that it is sufficient to document them.</p>
</div></details></div>
<div class="toot" id="created-779"><h2>Issue #779 created<span class="toot-id"> #created-779</span></h2><div class="pubdate">26 Oct at 03:18:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/779">https://github.com/qt4cg/qtspecs/issues/779</a></div><details><summary>Hash/checksum function</summary><div class="markup"><p>I propose a new function for the core XPath functions, here called <code>fn:hash()</code> for the sake of discussion. The goal is to give XPath users access to CRC, checksum, and cryptographic hash functions.</p>
<h3>Rationale</h3>
<p>Simple checksums functions, such as those from the Fletcher family, are relatively easy to write in a host language such as XSLT. More complex ones are far more challenging to write, and may incur serious performance penalties. For example, from the TAN function library, see the <a href="https://github.com/textalign/TAN-2021/blob/master/functions/checksums/TAN-fn-hash-and-check.xsl">MD5 checksum/hash functions</a>. (Yes, one day I thought it would be fun to try to implement the MD5 algorithm in XSLT.) Most programming languages in which an implementation is written have access to cryptographic libraries that are highly performative.</p>
<p>Hash functions are widely used, and certainly important in XML-based workflows, whether as filenames, database fields, etc.</p>
<p>The closest comparable existing functions is <code>generate-id()</code>, but this was designed as an identifier for nodes.</p>
<p>In short, I believe there is a significant need that outstrips current functionality.</p>
<p>In the draft below, I have adopted only the MD-5 algorithm as a core requirement, to catalyze discussion. I have assumed the user wants the string form of the output, not the raw bits. I have not tried to flesh out prose that would warn users away from security complacency.</p>
<p>For discussion, <a href="https://en.wikipedia.org/wiki/List_of_hash_functions">here is a list of relevant algorithms</a>. I look forward to community feedback.</p>
<h3><code>fn:hash</code> Draft Specification</h3>
<h4>Summary</h4>
<p>This function takes as input a string or octet sequence and returns a string representation of the results from a specified hash, checksum, or cyclic redundancy check function.</p>
<h4>Signature</h4>
<pre><code>fn:hash(
   $value as union(xs:string, xs:hexBinary, 
                   xs:base64Binary)?   := fn:string(.),
   $algorithm as xs:string             := "md5"
) as xs:string?
</code></pre>
<h4>Properties</h4>
<p>The zero-argument form of this function is deterministic, context-dependent, and focus-dependent.</p>
<p>The one- and two-argument form of this function is deterministic, context-independent, and focus-independent.</p>
<h4>Rules</h4>
<p>If the zero-argument version of the function is used, the result is the same as calling the one-argument version, with <code>$value</code> set to <code>fn:string(.)</code>.</p>
<p>If the one-argument version of the function is used, the result is the same as calling the two-argument version, with <code>$algorithm</code> set to "md5".</p>
<p>The effective value of <code>$algorithm</code> is the value of the expression <code>fn:lower-case(fn:replace($function, '\W+', ''))</code>.</p>
<p>If <code>$value</code> is the empty sequence, or a string of zero length, the function returns the empty sequence.</p>
<p>If <code>$value</code> is an instance of <code>xs:string</code> it is cast to <code>xs:hexBinary</code> on the basis of UTF-8 encoding. If <code>$value</code> is an instance of <code>xs:base64Binary</code> it is cast to <code>xs:hexBinary</code>.</p>
<p>The function returns an <code>xs:string</code> representation of the bytes returned by passing the <code>xs:hexBinary</code> value of <code>$value</code> as an octet sequence through the specified hash or checksum function.</p>
<p>Conforming implementations MUST support <code>md5</code> and the associated MD5 Message-Digest algorithm defined by RFC 6151 (update to RFC 1321). They MAY support other checksum and hash functions with implementation-defined semantics.</p>
<h4>Error Conditions</h4>
<p>A dynamic error is raised <em>[err:XXXXXXX]</em> if the effective value of <code>$algorithm</code> is not one of the values supported by the implementation.</p>
<h4>Notes</h4>
<ul>
<li>The MD5 algorithm is normally not used for cryptographic purposes. <em>[More cautionary prose about not assuming that something can be trusted as secure.]</em></li>
</ul>
<h4>Examples</h4>
<p>Expression | Result
-- | --
fn:hash("abc") | 900150983cd24fb0d6963f7d28e17f72
fn:hash("ABC") | 902fbdd2b1df0c4f70b4a5d23525e932</p>
</div></details></div>
<div class="toot" id="created-778"><h2>Pull request #778 created<span class="toot-id"> #created-778</span></h2><div class="pubdate">26 Oct at 01:53:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/778">https://github.com/qt4cg/qtspecs/pull/778</a></div><details><summary>XQFO edits 5.4-5.6</summary><div class="markup"><p>Light edits for consistency.</p>
<ul>
<li>Examples in <code>char()</code> have been reordered so that the most interesting and useful examples are at top.</li>
<li>Substring functions were difficult to read in the specs because of the overly long collation URI. These are now bound to a variable, to enhance legibility.</li>
<li>Schema location fixed.</li>
<li>extra examples in <code>string-length()</code>, to help users recognize the role of combining characters.</li>
</ul>
</div></details></div>
<div class="toot" id="created-777"><h2>Issue #777 created<span class="toot-id"> #created-777</span></h2><div class="pubdate">26 Oct at 01:35:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/777">https://github.com/qt4cg/qtspecs/issues/777</a></div><details><summary>new replace() parameter $action</summary><div class="markup"><p>In the current draft for <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-replace">replace()</a> the history log states that the new parameter <code>$action</code> has not yet had community review. This ticket provides a placeholder for attention and discussion.</p>
<p>If the CG has already reviewed and accepted <code>$action</code>, comment here and I will update the function history accordingly.</p>
</div></details></div>
<div class="toot" id="created-776"><h2>Issue #776 created<span class="toot-id"> #created-776</span></h2><div class="pubdate">25 Oct at 21:54:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/776">https://github.com/qt4cg/qtspecs/issues/776</a></div><details><summary>/etc/XT40 does not get built</summary><div class="markup"><p>The serialisation spec has <code>xspecref spec="XT31"</code> references that need to be updated to <code>XT40</code>. But for some reason the <code>/etc/XT40</code> file isn't being built, so these references fail to resolve.</p>
</div></details></div>
<div class="toot" id="created-775"><h2>Pull request #775 created<span class="toot-id"> #created-775</span></h2><div class="pubdate">25 Oct at 21:14:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/775">https://github.com/qt4cg/qtspecs/pull/775</a></div><details><summary>517: Reflected Christian Gruen's remarks</summary><div class="markup"><p>I deleted my fork, got a new one and applied the latest changes. Seems this fixed the issues.</p>
</div></details></div>
<div class="toot" id="closed-773"><h2>Issue #773 closed<span class="toot-id"> #closed-773</span></h2><div class="pubdate">25 Oct at 20:38:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/773">https://github.com/qt4cg/qtspecs/pull/773</a></div><p>QT4CG-051-04/05: Reflected today's meeting editorial suggestions</p></div>
<div class="toot" id="closed-768"><h2>Issue #768 closed<span class="toot-id"> #closed-768</span></h2><div class="pubdate">25 Oct at 16:44:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/768">https://github.com/qt4cg/qtspecs/issues/768</a></div><p>Details about decode-for-uri</p></div>
<div class="toot" id="closed-769"><h2>Issue #769 closed<span class="toot-id"> #closed-769</span></h2><div class="pubdate">25 Oct at 16:44:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/769">https://github.com/qt4cg/qtspecs/pull/769</a></div><p>768: details about decode-from-uri</p></div>
<div class="toot" id="closed-517"><h2>Issue #517 closed<span class="toot-id"> #closed-517</span></h2><div class="pubdate">25 Oct at 15:11:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/517">https://github.com/qt4cg/qtspecs/issues/517</a></div><p>fn:chain (before: fn:multi-compose)</p></div>
<div class="toot" id="closed-758"><h2>Issue #758 closed<span class="toot-id"> #closed-758</span></h2><div class="pubdate">25 Oct at 15:10:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/758">https://github.com/qt4cg/qtspecs/issues/758</a></div><p>XQFO UCA keyword strength, quaternary setting</p></div>
<div class="toot" id="closed-686"><h2>Issue #686 closed<span class="toot-id"> #closed-686</span></h2><div class="pubdate">25 Oct at 15:09:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/686">https://github.com/qt4cg/qtspecs/issues/686</a></div><p>XQFO presentation of diagnostic functions</p></div>
<div class="toot" id="created-774"><h2>Issue #774 created<span class="toot-id"> #created-774</span></h2><div class="pubdate">25 Oct at 12:46:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/774">https://github.com/qt4cg/qtspecs/issues/774</a></div><details><summary>What should be percent-encoded in a URI?</summary><div class="markup"><p>(This is related to <code>fn:parse-uri</code>, <code>fn:build-uri</code>, and <code>fn:decode-from-uri</code>. I'm making it a distinct issue to call it out and see if we can get consensus on the right answer. I've come to the conclusion that what I've implemented isn't justified by any specific reading of the relevant specifications, so it's wrong.)</p>
<p>This question is slightly tricky because encoding (or not encoding) characters can change the meaning of the URI.</p>
<p>If you trace your way through the ABNF in RFC 3986 you eventually get to:</p>
<pre><code>   path-abempty  = *( "/" segment )
   path-absolute = "/" [ segment-nz *( "/" segment ) ]
   path-noscheme = segment-nz-nc *( "/" segment )
   path-rootless = segment-nz *( "/" segment )
   path-empty    = 0&lt;pchar&gt;
</code></pre>
<p>The various <code>segment</code> nonterminals boil down to some number of <code>pchar</code>. (The <code>segment-nz</code> form is used to forbid a zero length string before the first <code>/</code>; the <code>segment-nz-nc</code> form is used for a URI that does not begin with a scheme: it must have a non-zero length string before the first <code>/</code> that additionally must not contain a <code>:</code>.)</p>
<pre><code>  pchar         = unreserved / pct-encoded / sub-delims / ":" / "@"
</code></pre>
<p>Where:</p>
<pre><code>  unreserved    = ALPHA / DIGIT / "-" / "." / "_" / "~"
  pct-encoded   = "%" HEXDIG HEXDIG
  sub-delims    = "!" / "$" / "&amp;" / "'" / "(" / ")" / "*" / "+" / "," / ";" / "="
</code></pre>
<p>I think it follows that all characters <strong>except</strong> the following must be encoded:</p>
<p>Upper-and lower-case <code>A</code> to <code>Z</code>, the digits <code>0</code> to <code>9</code>, <code>-</code>, <code>.</code>, <code>_</code>, <code>~</code>, <code>%</code>, <code>!</code>, <code>$</code>, <code>&amp;</code>, <code>'</code>, <code>(</code>, <code>)</code>, <code>*</code>, <code>+</code>, <code>,</code>, <code>;</code>, <code>=</code>, <code>:</code>, and <code>@</code>.</p>
<p>or, conversely, that any characters <em>other than those</em> <strong>must</strong> be encoded.</p>
<p>Observe that <code>/</code> isn't among the characters that are not encoded. That's because the <code>/</code> in hierarchical URIs divides the segments. It's part of the URI syntax. That's <em>why</em> a literal forward slash that appears somewhere in an actual path segment must be encoded <code>%2F</code> and it's why causually unencoding such a character changes the URI.</p>
<p>Observe also that there's no provision here for encoding a space with <code>+</code>, even though it's fairly common. I've carried that error through to some of the test results for <code>fn:build-uri</code> and <code>fn:parse-uri</code>. I'll fix those tests.</p>
<p>I'm going to try changing my implementation to follow the rule above and see what happens.</p>
<p>If you think this analysis is incorrect, please explain where I went wrong.</p>
</div></details></div>
<div class="toot" id="created-773"><h2>Pull request #773 created<span class="toot-id"> #created-773</span></h2><div class="pubdate">24 Oct at 18:48:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/773">https://github.com/qt4cg/qtspecs/pull/773</a></div><details><summary>QT4CG-051-04/05: Reflected today's meeting editorial suggestions</summary><div class="markup"><p>All 3 editorial suggestions made in today's meeting are now reflected.</p>
</div></details></div>
<div class="toot" id="created-772"><h2>Pull request #772 created<span class="toot-id"> #created-772</span></h2><div class="pubdate">24 Oct at 17:17:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/772">https://github.com/qt4cg/qtspecs/pull/772</a></div><details><summary>Revise the fn:parse-html rules to make them clearer to follow.</summary><div class="markup"><p>This actions the comment in #767 that the rules for the function are unclear.</p>
<p>The SVG element name handling is correct in the spec per the comments in https://github.com/qt4cg/qt4tests/issues/57, so don't need changing.</p>
</div></details></div>
<div class="toot" id="minutes-10-24"><h2>QT4 CG meeting 051 draft minutes<span class="toot-id"> #minutes-10-24</span></h2><div class="pubdate">24 Oct at 16:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/10-24">https://qt4cg.org/meeting/minutes/2023/10-24</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-734"><h2>Issue #734 closed<span class="toot-id"> #closed-734</span></h2><div class="pubdate">24 Oct at 16:06:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/734">https://github.com/qt4cg/qtspecs/pull/734</a></div><p>517: fn:chain</p></div>
<div class="toot" id="closed-763"><h2>Issue #763 closed<span class="toot-id"> #closed-763</span></h2><div class="pubdate">24 Oct at 16:05:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/763">https://github.com/qt4cg/qtspecs/pull/763</a></div><p>686: XQFO diagnostic function documentation</p></div>
<div class="toot" id="closed-762"><h2>Issue #762 closed<span class="toot-id"> #closed-762</span></h2><div class="pubdate">24 Oct at 16:04:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/762">https://github.com/qt4cg/qtspecs/pull/762</a></div><p>758: XQFO minor edits 3</p></div>
<div class="toot" id="closed-653"><h2>Issue #653 closed<span class="toot-id"> #closed-653</span></h2><div class="pubdate">24 Oct at 16:04:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/653">https://github.com/qt4cg/qtspecs/issues/653</a></div><p>XQuery - option to suppress entity expansion</p></div>
<div class="toot" id="closed-749"><h2>Issue #749 closed<span class="toot-id"> #closed-749</span></h2><div class="pubdate">24 Oct at 16:04:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/749">https://github.com/qt4cg/qtspecs/pull/749</a></div><p>653: Add string literals E".." and L".." to control entity expansion</p></div>
<div class="toot" id="closed-647"><h2>Issue #647 closed<span class="toot-id"> #closed-647</span></h2><div class="pubdate">24 Oct at 16:04:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/647">https://github.com/qt4cg/qtspecs/issues/647</a></div><p>XQuery: import schema with multiple location hints</p></div>
<div class="toot" id="closed-659"><h2>Issue #659 closed<span class="toot-id"> #closed-659</span></h2><div class="pubdate">24 Oct at 16:04:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/659">https://github.com/qt4cg/qtspecs/pull/659</a></div><p>647: schema location hints</p></div>
<div class="toot" id="closed-383"><h2>Issue #383 closed<span class="toot-id"> #closed-383</span></h2><div class="pubdate">24 Oct at 16:03:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/383">https://github.com/qt4cg/qtspecs/issues/383</a></div><p>fn:deep-equal: Order of child elements (unordered-elements)</p></div>
<div class="toot" id="created-771"><h2>Issue #771 created<span class="toot-id"> #created-771</span></h2><div class="pubdate">24 Oct at 12:42:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/771">https://github.com/qt4cg/qtspecs/issues/771</a></div><details><summary>British vs. American English</summary><div class="markup"><p>Purely editorial: Some words in the specification seem to be British English (organised, generalised, behaviour), whereas the majority of the text is American English. Should this be fixed?</p>
<p>I assume there are tools to get this straight? I am too rarely affected by it to know more about it…</p>
</div></details></div>
<div class="toot" id="created-770"><h2>Pull request #770 created<span class="toot-id"> #created-770</span></h2><div class="pubdate">23 Oct at 14:03:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/770">https://github.com/qt4cg/qtspecs/pull/770</a></div><details><summary>566: Use fn:decode-from-uri in fn:parse-uri</summary><div class="markup"><p>I think this is sufficient to close issue 566. @ChristianGruen could you let me know if you agree?</p>
</div></details></div>
<div class="toot" id="created-769"><h2>Pull request #769 created<span class="toot-id"> #created-769</span></h2><div class="pubdate">23 Oct at 13:26:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/769">https://github.com/qt4cg/qtspecs/pull/769</a></div><details><summary>768: details about decode-from-uri</summary><div class="markup"><p>Closes #768</p>
</div></details></div>
<div class="toot" id="created-768"><h2>Issue #768 created<span class="toot-id"> #created-768</span></h2><div class="pubdate">23 Oct at 12:53:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/768">https://github.com/qt4cg/qtspecs/issues/768</a></div><details><summary>Details about decode-for-uri</summary><div class="markup"><p>I'm unclear on how <code>%XA</code> should be decoded. Is that <code>%X</code> (an error) followed by <code>A</code>, or is that <code>%XA</code> (an error)?</p>
<p>Also, a couple of typos:</p>
<pre><code>s/to an sequence/to a sequence/
s/that are no hexadecimal/that are not hexadecimal`
</code></pre>
</div></details></div>
<div class="toot" id="agenda-10-24"><h2>QT4 CG meeting 051 draft agenda<span class="toot-id"> #agenda-10-24</span></h2><div class="pubdate">23 Oct at 10:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/10-24">https://qt4cg.org/meeting/agenda/2023/10-24</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-767"><h2>Issue #767 created<span class="toot-id"> #created-767</span></h2><div class="pubdate">23 Oct at 09:20:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/767">https://github.com/qt4cg/qtspecs/issues/767</a></div><details><summary>parse-html(): case of SVG element names</summary><div class="markup"><p>Gunther Rademacher points out at https://github.com/qt4cg/qt4tests/issues/57 that the expected test results for parse-html() expect SVG elements to be output in lower case; and as far as I can see, this is consistent with the spec. But is it useful? It means we're producing XML that isn't valid according to the SVG schema, and that presumably might be rejected by tools that expect to handle valid SVG.</p>
<p>In passing, I note that it's very hard to work out from the parse-html() spec what the function actually does; it's somehow written as if it's obvious, but it never gets around to actually saying it explicitly. It also doesn't say what happens when the <code>method</code> option is omitted, as it is in these tests.</p>
<p>In addition, it seems that we don't have any tests that exercise the various options of the function, e.g. the ability to consue binary as well as character input.</p>
</div></details></div>
<div class="toot" id="created-766"><h2>Pull request #766 created<span class="toot-id"> #created-766</span></h2><div class="pubdate">19 Oct at 22:45:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/766">https://github.com/qt4cg/qtspecs/pull/766</a></div><details><summary>765 Update version references etc to 4.0 status</summary><div class="markup"><p>Includes the following changes:</p>
<ul>
<li>Clarification of the syntax and semantics of the version number in the XQuery version declaration</li>
<li>Updates to front and back matter to reflect the current status of the 4.0 specs</li>
<li>Update cross-spec references to point to the 4.0 specs rather than 3.1 specs</li>
<li>A DTD change from spec="SER40" to spec="SE40" to reflect the name of the /etc file generated by the gradle script.</li>
</ul>
<p>Fix #765</p>
</div></details></div>
<div class="toot" id="created-765"><h2>Issue #765 created<span class="toot-id"> #created-765</span></h2><div class="pubdate">19 Oct at 10:33:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/765">https://github.com/qt4cg/qtspecs/issues/765</a></div><details><summary>XQuery version declaration: upgrade to 4.0</summary><div class="markup"><p>The text at §5.1 does not yet acknowledge version="4.0".</p>
<p>We should also be a bit more precise about the syntax, which currently says that the version number is two integers separated by a dot. We should give a regular expression to be absolutely clear that we mean decimal integers, no underscores allowed.</p>
<p>There are a few other version references to tidy up at the same time, e.g. "XQuery is designed to meet the requirements identified by the W3C XML Query Working Group [[XQuery 3.1 Requirements]]."</p>
</div></details></div>
<div class="toot" id="created-764"><h2>Issue #764 created<span class="toot-id"> #created-764</span></h2><div class="pubdate">19 Oct at 09:07:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/764">https://github.com/qt4cg/qtspecs/issues/764</a></div><details><summary>XQuery: Simplify module imports</summary><div class="markup"><p>With XQuery, you can import library modules as follows:</p>
<pre><code class="language-xquery">import module namespace utils = 'http://project.org/utils' at 'org/project/utils.xq`;
utils:action()
</code></pre>
<p>If an implementation has a mechanism to resolve a namespace URI, you can also do this:</p>
<pre><code class="language-xquery">import module namespace utils = 'http://project.org/utils`;
utils:action()
</code></pre>
<p>It would be desirable to simplify this further, and be able to do one of…</p>
<pre><code class="language-xquery">(: already legal, but no namespace binding takes place :)
import module namespace 'http://project.org/utils';
(: not supported yet :)
import module namespace http://project.org/utils;
(: no URI rewriting needed for relative paths :)
import module namespace org/project/utils;

utils:action()
</code></pre>
<p>…and…</p>
<ol>
<li>rewrite namespace URIs to local paths (this is how we proceed: https://docs.basex.org/wiki/Java_Bindings#URI_Rewriting)</li>
<li>extract the prefix from the path.</li>
</ol>
<p>I can imagine that the current ways to simplify imports depend a lot on the used implementations. Suggestions are welcome.</p>
</div></details></div>
<div class="toot" id="closed-759"><h2>Issue #759 closed<span class="toot-id"> #closed-759</span></h2><div class="pubdate">19 Oct at 05:41:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/759">https://github.com/qt4cg/qtspecs/issues/759</a></div><p>Serialization: JSON Parameters</p></div>
<div class="toot" id="created-763"><h2>Pull request #763 created<span class="toot-id"> #created-763</span></h2><div class="pubdate">19 Oct at 04:44:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/763">https://github.com/qt4cg/qtspecs/pull/763</a></div><details><summary>686: XQFO diagnostic function documentation</summary><div class="markup"><p>I think what prompted my original ticket was the use of "output". That term is used scores of times in the specs, and it always implies the output of a function within the XPath expression. Although the term is qualified in the diagnostic functions with the adjective "trace" or "log", it's tempting to think of the function's actual output. Coming back a few weeks later, I think some gentle massaging (instead of a convoluted preamble) can help readers not make the requisite adjustment, reflected in the present PR.</p>
<p>I have offered two examples that I hope show the practical side of these functions. I might have missed something though, so please chime in.</p>
</div></details></div>
<div class="toot" id="created-762"><h2>Pull request #762 created<span class="toot-id"> #created-762</span></h2><div class="pubdate">19 Oct at 03:38:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/762">https://github.com/qt4cg/qtspecs/pull/762</a></div><details><summary>758: XQFO minor edits 3</summary><div class="markup"><p>This covers edits to XQFO 4 through 5.3, and incorporates the suggestion in #758</p>
</div></details></div>
<div class="toot" id="closed-746"><h2>Issue #746 closed<span class="toot-id"> #closed-746</span></h2><div class="pubdate">18 Oct at 20:54:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/746">https://github.com/qt4cg/qtspecs/issues/746</a></div><p>break-when -&gt; split-when in fn:partition</p></div>
<div class="toot" id="created-761"><h2>Pull request #761 created<span class="toot-id"> #created-761</span></h2><div class="pubdate">18 Oct at 20:42:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/761">https://github.com/qt4cg/qtspecs/pull/761</a></div><details><summary>554/754 Simplify the new transitive-closure function</summary><div class="markup"><p>Drops the <code>$min</code> and <code>$max</code> parameters, with the effect that this corresponds much more closely to the general computer-science definition of a transitive closure.</p>
<p>The function now computes the set of nodes delivered by the transitive closure of the supplied <code>$step</code> function when applied to a given <code>$start</code> node, rather than returning a function item that must then be applied to the chosen $start node. This is hopefully easier for most users to understand, and does not lose any useful functionality.</p>
<p>The <code>$min</code> parameter of the old function is effectively forced to its default value of 1, and the $max value to its default of infinity.</p>
<p>Fix #754
Fix #554</p>
<p>This PR addresses the main points of #554 in making the function correspond more closely to the mathematical (or at least the computer-science) definition of transitive closure. It doesn't implement other ideas in #554, like returning the depth of search alongside the actual closure. That's because I believe in the principle that wherever possible a function should do one thing in as simple a way as possible.</p>
</div></details></div>
<div class="toot" id="created-760"><h2>Issue #760 created<span class="toot-id"> #created-760</span></h2><div class="pubdate">18 Oct at 08:47:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/760">https://github.com/qt4cg/qtspecs/issues/760</a></div><details><summary>Serialize functions: consistency</summary><div class="markup"><p>We should be more ambitious about ensuring consistency when serializing data back to its original representation, and how to achieve it. This is the status quo:</p>
<p>Format| Serialize Function | Parse Function
--- | --- | ---
<strong>XML</strong> | <code>fn:serialize($input)</code> | <code>fn:parse-xml</code>
<strong>JSON</strong> | <code>fn:serialize($input, map { 'method': 'json' })</code> | <code>fn:parse-json</code>
<strong>JSON</strong> | <code>fn:xml-to-json($input)</code> | <code>fn:json-to-xml</code>
<strong>XHTML</strong> | <code>fn:serialize($input, map { 'method': 'xhtml' })</code> | <code>fn:parse-html</code>
<strong>HTML</strong> | <code>fn:serialize($input, map { 'method': 'html' })</code> | <code>fn:parse-html</code>
<strong>CSV</strong> | <em>still missing</em> | <code>fn:parse-csv</code> and variants</p>
<p>In BaseX, the XML created by <code>fn:json-to-xml</code> can already be serialized back to JSON as follows (related: #759):</p>
<pre><code class="language-xquery">serialize(
  &lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
    &lt;number key="A"&gt;1&lt;/number&gt;
  &lt;/map&gt;,
  map { 'method': 'json', 'json': map { 'format': 'basic' }
})
</code></pre>
<p>For CSV, we’ve introduced a CSV serialization method that supports all CSV flavors we support (see <a href="docs.basex.org/wiki/CSV_Module">CSV Module</a> for more details):</p>
<pre><code class="language-xquery">serialize(
  &lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
    &lt;number key="A"&gt;1&lt;/number&gt;
  &lt;/map&gt;,
  map { 'method': 'csv', 'csv': map { 'format': 'direct' }
})
</code></pre>
<p>Related (parse functions): #748</p>
</div></details></div>
<div class="toot" id="created-759"><h2>Issue #759 created<span class="toot-id"> #created-759</span></h2><div class="pubdate">18 Oct at 08:41:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/759">https://github.com/qt4cg/qtspecs/issues/759</a></div><details><summary>Serialization: JSON Parameters</summary><div class="markup"><p>We have more and more serialization parameters that are specific to JSON (related: #530, #756, #576, #641). It won’t get better with each new option we add, so maybe it’s time to introduce a custom serialization parameter for JSON (and possibly other methods):</p>
<pre><code class="language-xquery">serialize(
  map { "abc": 123 },
  map { 'method': 'json', 'json': map { 'escape-solidus': true(), 'number-format':'#' }
})
</code></pre>
<p>If we want to be able to use output options in the XQuery prolog, we additionally need to define a syntax for serializing the options to a single string:</p>
<pre><code class="language-xquery">declare namespace output = 'http://www.w3.org/2010/xslt-xquery-serialization';
declare option output:method 'json';
declare option output:json 'escape-solidus=yes,number-format=#';
map { "abc": 123 }
</code></pre>
<p>Both suggestions are inspired by our own implementation; we use it for our custom JSON and CSV options.</p>
</div></details></div>
<div class="toot" id="closed-706"><h2>Issue #706 closed<span class="toot-id"> #closed-706</span></h2><div class="pubdate">18 Oct at 06:53:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/706">https://github.com/qt4cg/qtspecs/issues/706</a></div><p>FLWOR: for member $m1 in $a1, member $m2 in $a2</p></div>
<div class="toot" id="closed-752"><h2>Issue #752 closed<span class="toot-id"> #closed-752</span></h2><div class="pubdate">18 Oct at 06:53:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/752">https://github.com/qt4cg/qtspecs/pull/752</a></div><p>706: Fix "for member" grammar problems</p></div>
<div class="toot" id="closed-750"><h2>Issue #750 closed<span class="toot-id"> #closed-750</span></h2><div class="pubdate">18 Oct at 06:45:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/750">https://github.com/qt4cg/qtspecs/issues/750</a></div><p>xsl:mode/@as and built-in template rules</p></div>
<div class="toot" id="closed-751"><h2>Issue #751 closed<span class="toot-id"> #closed-751</span></h2><div class="pubdate">18 Oct at 06:45:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/751">https://github.com/qt4cg/qtspecs/pull/751</a></div><p>QT4CG-048-01: xsl:mode/@as with built-in templates</p></div>
<div class="toot" id="closed-740"><h2>Issue #740 closed<span class="toot-id"> #closed-740</span></h2><div class="pubdate">18 Oct at 06:32:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/740">https://github.com/qt4cg/qtspecs/pull/740</a></div><p>QT4CG-047-01: Rename break-when to split-when, plus minor editorial cleanup</p></div>
<div class="toot" id="created-758"><h2>Issue #758 created<span class="toot-id"> #created-758</span></h2><div class="pubdate">18 Oct at 03:56:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/758">https://github.com/qt4cg/qtspecs/issues/758</a></div><details><summary>XQFO UCA keyword strength, quaternary setting</summary><div class="markup"><p>In the XQFO specs, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#uca-collations">5.3.3</a>, the description of keyword <code>strength</code>, option <code>quaternary</code>, is I think confusing/misleading:</p>
<blockquote>
<p>quaternary considers spaces and punctuation that would otherwise be ignored (for example <code>data-base</code>=<code>database</code>).</p>
</blockquote>
<p>I propose the following:</p>
<p>"quaternary always considers as significant spaces and punctuation (data-base≠database; if <code>maxVariable</code> is <code>punct</code> or higher and <code>alternate</code> is not <code>non-ignorable</code>, lower strengths will treat data-base=database)."</p>
<p>That's a lot more words, but I think more accurate. And it may help the reader become familiar with the other two keywords.</p>
<p>Editors' input is welcome.</p>
</div></details></div>
<div class="toot" id="minutes-10-17"><h2>QT4 CG meeting 050 draft minutes<span class="toot-id"> #minutes-10-17</span></h2><div class="pubdate">17 Oct at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/10-17">https://qt4cg.org/meeting/minutes/2023/10-17</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-757"><h2>Issue #757 created<span class="toot-id"> #created-757</span></h2><div class="pubdate">17 Oct at 16:24:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/757">https://github.com/qt4cg/qtspecs/issues/757</a></div><details><summary>Function families</summary><div class="markup"><p>We talked on the call today about the tension between defining multiple simple functions focussed on one task, and a small number of omnibus functions that have many different options.</p>
<p>I think we would all agree that multiple simple functions would be the better choice except for the problem that they all end up going into a single global namespace. So the question becomes, how can we better partition the name-space (using the term deliberately with a hyphen).</p>
<p>We're reluctant to use the namespace mechanism to partition our function library because namespaces are cumbersome and clutter the code with lots of boilerplate; declaring namespaces for binding function libraries also has side-effects for example on the semantics of element constructors.</p>
<p>One approach would be to build on the idea that @dnovatchev presented of using maps containing anonymous functions, so for example <code>csv()?parse()</code> would first call fn:csv() to load a family (or library) of functions, of which one is then selected for execution. This works, but I don't think it's a perfect solution; for example static analysis becomes a lot more difficult, and we don't get the benefits of default parameters and keyword arguments.</p>
<p>Most languages use hierarchic names with "." as a separator. Although XML names allow "." as a regular character, none of our built-in function names currently use it as such. So it would be entirely possible to adopt a convention where names like csv.parse() etc are used to name functions in a function family referred to as "csv". This wouldn't by itself require any language changes.</p>
<p>But if we adopted this convention, we could build on it to provide usability tweaks that make a large function library easier to manage. For example, we could put the math functions into the fn namespace with names like <code>fn:math.sin(x)</code>, and then provide a way of binding a namespace prefix to a subtree of the fn namespace, so math:sin becomes a synonym for fn:math.sin(). The immediate benefit is that the namespace prefix doesn't need to be declared unless people want to use it. We could also then consider defining an algorithm for searching the fn namespace for abbreviated names such as sin(x), perhaps with some form of "import functions" declaration that says which subtrees of the fn namespace are to be searched.</p>
</div></details></div>
<div class="toot" id="closed-741"><h2>Issue #741 closed<span class="toot-id"> #closed-741</span></h2><div class="pubdate">17 Oct at 16:20:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/741">https://github.com/qt4cg/qtspecs/pull/741</a></div><p>QT4CG-048-03: Fix copy and paste errors in describing type patterns</p></div>
<div class="toot" id="closed-739"><h2>Issue #739 closed<span class="toot-id"> #closed-739</span></h2><div class="pubdate">17 Oct at 16:18:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/739">https://github.com/qt4cg/qtspecs/pull/739</a></div><p>Apply review comment changes to the HTML DOM XDM mapping.</p></div>
<div class="toot" id="closed-618"><h2>Issue #618 closed<span class="toot-id"> #closed-618</span></h2><div class="pubdate">17 Oct at 15:49:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/618">https://github.com/qt4cg/qtspecs/issues/618</a></div><p>Symmetry: fn:html-doc, fn:csv-doc</p></div>
<div class="toot" id="created-756"><h2>Issue #756 created<span class="toot-id"> #created-756</span></h2><div class="pubdate">17 Oct at 14:39:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/756">https://github.com/qt4cg/qtspecs/issues/756</a></div><details><summary>JSON serialization - number formatting</summary><div class="markup"><p>We get a lot of complaints about the use of exponential notation when formatting large numbers with the JSON serializer.</p>
<p>I propose adding an option such as number-format="picture" to control this, where the picture is a subset of what is allowed for format-number().</p>
<p>And perhaps we should bring <code>xml-to-json()</code> into line. The current capability of providing a callback function is more powerful, but difficult to align with serialization.</p>
</div></details></div>
<div class="toot" id="closed-131"><h2>Issue #131 closed<span class="toot-id"> #closed-131</span></h2><div class="pubdate">17 Oct at 11:16:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/131">https://github.com/qt4cg/qtspecs/issues/131</a></div><p>Expression for binding the Context Value</p></div>
<div class="toot" id="created-755"><h2>Issue #755 created<span class="toot-id"> #created-755</span></h2><div class="pubdate">17 Oct at 11:15:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/755">https://github.com/qt4cg/qtspecs/issues/755</a></div><details><summary>Expression for binding the Context Value</summary><div class="markup"><p>We have no expression yet to bind a value to the context value. Such an expression would be useful, among other things, to extend the focus function to sequences (<code>fn { . }</code>, see #129).</p>
<p>Here are 3 possible constructs for that, ordered by my personal preference:</p>
<h3>1. Value Map Expression</h3>
<pre><code class="language-xquery">ValueExpr      ::=  ValidateExpr | ExtensionExpr | ValueMapExpr
ValueMapExpr   ::=  SimpleMapExpr ("~" SimpleMapExpr)*
SimpleMapExpr  ::=  PathExpr ("!" PathExpr)*

(: Example :)
//flower ~ (count(.) || ' flowers: ' || string-join(name, ', '))
</code></pre>
<p>The expression would be similar to the simple map expression (which we could rename to item map expression). The following equivalents would then exist for simple FLWOR expressions:</p>
<pre><code class="language-xquery">for $i in (1 to 5) return string($i)  ≍  (1 to 5) ! string(.)
let $i := (1 to 5) return count($i)   ≍  (1 to 5) ~ count(.)
</code></pre>
<p><code>fn { E }</code> could be rewritten to <code>fn($c) { $c ~ E }</code>.</p>
<h3>2. Context Value Declaration</h3>
<pre><code class="language-xquery">ContextExpr  ::=  "context" "{" Expr "}" EnclosedExpr

(: Example :)
context { //flower } {
  count(.) || ' flowers: ' || string-join(name, ', ')
}
</code></pre>
<p>The result of the first expression defines the context value, the second expression can reference the context.</p>
<p><code>fn { E }</code> could be rewritten to <code>fn($c) { context { $c } { E } }</code>.</p>
<h3>3. Enhanced FLWOR expression (for the sake of completion)</h3>
<p>Similar to variables, the dot could be used to bind and reference the context:</p>
<pre><code class="language-xquery">LetBinding  ::=  ("." | ("$" VarName)) TypeDeclaration? ":=" ExprSingle
ForBinding  ::=  ("." | ("$" VarName)) TypeDeclaration? AllowingEmpty? PositionalVar? "in" ExprSingle

(: Example :)
let . := //flower
return count(.) || ' flowers: ' || string-join(name, ', ')
</code></pre>
<p><code>fn { E }</code> could be rewritten to <code>fn($c) { let . := $c return E }</code>.</p>
<h3>Assessment</h3>
<ul>
<li>The first solution looks most appealing to me. I like the analogy with the existing syntax for single items.</li>
<li>We could choose the second solution if we believe that the expression will be rarely used.</li>
<li>I‘ve backed away from the third solution; I think it would be too pervasive.</li>
</ul>
</div></details></div>
<div class="toot" id="created-754"><h2>Issue #754 created<span class="toot-id"> #created-754</span></h2><div class="pubdate">17 Oct at 07:22:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/754">https://github.com/qt4cg/qtspecs/issues/754</a></div><details><summary>fn:transitive-closure: signature; remarks; too specific?</summary><div class="markup"><p>I have problems grasping why <code>fn:transitive-closure</code> returns a function. Wouldn’t it be more consistent with the remaining function set, and easier, to pass on the input as the first argument and directly create the result?</p>
<pre><code class="language-xquery">fn:transitive-closure(
  $node  as node(),
  $step  as function(node()) as node()*,	
  $min   as xs:nonNegativeInteger?       := 1,
  $max   as xs:positiveInteger?          := ()
) as node()*
</code></pre>
<p>It would also be easier then to use the function within chains:</p>
<pre><code class="language-xquery">$nodes =!&gt; transitive-closure(fn { * }) =&gt; count()
</code></pre>
</div></details></div>
<div class="toot" id="closed-744"><h2>Issue #744 closed<span class="toot-id"> #closed-744</span></h2><div class="pubdate">16 Oct at 14:32:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/744">https://github.com/qt4cg/qtspecs/pull/744</a></div><p>XQFO Examples: minor fixes, formatting</p></div>
<div class="toot" id="created-753"><h2>Pull request #753 created<span class="toot-id"> #created-753</span></h2><div class="pubdate">16 Oct at 14:05:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/753">https://github.com/qt4cg/qtspecs/pull/753</a></div><details><summary>65: Allow xmlns="xxx" to NOT change the default namespace for NameTests</summary><div class="markup"><p>Fix issue #65. Basically, fix the bug whereby <code>xmlns="xxx"</code> changes the default namespace for element NameTests, while retaining bug-compatibility.</p>
</div></details></div>
<div class="toot" id="agenda-10-17"><h2>QT4 CG meeting 050 draft agenda<span class="toot-id"> #agenda-10-17</span></h2><div class="pubdate">16 Oct at 12:55:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/10-17">https://qt4cg.org/meeting/agenda/2023/10-17</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-649"><h2>Issue #649 closed<span class="toot-id"> #closed-649</span></h2><div class="pubdate">16 Oct at 12:33:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/649">https://github.com/qt4cg/qtspecs/issues/649</a></div><p>xsl:fallback</p></div>
<div class="toot" id="closed-650"><h2>Issue #650 closed<span class="toot-id"> #closed-650</span></h2><div class="pubdate">16 Oct at 12:33:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/650">https://github.com/qt4cg/qtspecs/pull/650</a></div><p>649: fix an xsl:fallback problem</p></div>
<div class="toot" id="created-752"><h2>Pull request #752 created<span class="toot-id"> #created-752</span></h2><div class="pubdate">16 Oct at 09:21:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/752">https://github.com/qt4cg/qtspecs/pull/752</a></div><details><summary>706: Fix "for member" grammar problems</summary><div class="markup"><p>Fix #706</p>
</div></details></div>
<div class="toot" id="created-751"><h2>Pull request #751 created<span class="toot-id"> #created-751</span></h2><div class="pubdate">16 Oct at 06:41:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/751">https://github.com/qt4cg/qtspecs/pull/751</a></div><details><summary>QT4CG-048-01: xsl:mode/@as with built-in templates</summary><div class="markup"><p>Fix #750.</p>
</div></details></div>
<div class="toot" id="created-750"><h2>Issue #750 created<span class="toot-id"> #created-750</span></h2><div class="pubdate">15 Oct at 22:56:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/750">https://github.com/qt4cg/qtspecs/issues/750</a></div><details><summary>xsl:mode/@as and built-in template rules</summary><div class="markup"><p>See ACTION QT4CG-048-01</p>
<p>The question arose, if an xsl:mode declaration specifies an expected type in @as, then all template rules in that mode are expected/required to deliver a value conforming to that type. But what about the default/fallback template rules? Surely they need to deliver a value of that type as well?</p>
<p>For example, suppose the mode specifies as="xs:boolean". Regardless of the value of <code>xsl:on-no-match</code>, none of the built-in template rules is going to deliver a boolean. You're expecting a boolean result from xsl:apply-templates, and if none of the template rules match, you're going to get something other than a boolean.</p>
<p>I think the answer is to say that you get a type error if the built-in template rule for the mode returns a value that's not of the required type.</p>
<p>I don't think this error should ever be reported statically, because the compiler has no way of knowing whether the set of explicit template rules is sufficient to cover all cases that will actually arise in source documents.</p>
</div></details></div>
<div class="toot" id="closed-571"><h2>Issue #571 closed<span class="toot-id"> #closed-571</span></h2><div class="pubdate">15 Oct at 22:29:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/571">https://github.com/qt4cg/qtspecs/issues/571</a></div><p>XSLT: xsl:for-each-group/@break-when</p></div>
<div class="toot" id="created-749"><h2>Pull request #749 created<span class="toot-id"> #created-749</span></h2><div class="pubdate">15 Oct at 20:24:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/749">https://github.com/qt4cg/qtspecs/pull/749</a></div><details><summary>653: Add string literals E".." and L".." to control entity expansion</summary><div class="markup"><p>Allows for expressions interoperable between XPath and XQuery. Fix #653.</p>
</div></details></div>
<div class="toot" id="created-748"><h2>Issue #748 created<span class="toot-id"> #created-748</span></h2><div class="pubdate">15 Oct at 17:40:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/748">https://github.com/qt4cg/qtspecs/issues/748</a></div><details><summary>Parse functions: consistency</summary><div class="markup"><p>The functions for parsing input have been defined by different people, and the current state is quite inconsistent:</p>
<p>Function | Parameters
--- | ---
<code>fn:parse-xml</code> | <code>$value as xs:string?</code>
<code>fn:doc</code> | <code>$href as xs:string?</code>
<code>fn:parse-json</code> | <code>$value as xs:string?, $options as map(*)</code>
<code>fn:json-doc</code> | <code>$href as xs:string?, $options as map(*)</code>
<code>fn:parse-html</code> | <code>$html as union(xs:string, xs:hexBinary, xs:base64Binary)?, $options as map(*)</code>
<code>fn:parse-csv</code> | <code>$csv as xs:string?, $options as map(*)</code></p>
<p>I believe there’s some need to unify the functions, and we could at least:</p>
<ul>
<li>introduce a <code>fn:XYZ-doc($href, $options)</code> function for each input format (with at least one <code>encoding</code> option), and</li>
<li>restrict the type of the input parameter of <code>fn:parse-XYZ</code> to <code>xs:string?</code> and always name it <code>$value</code>.</li>
</ul>
<p>And I wonder if we should tag all <code>fn:XYZ-doc</code> functions as ·nondeterministic· (if it’s not too late)?</p>
</div></details></div>
<div class="toot" id="created-747"><h2>Issue #747 created<span class="toot-id"> #created-747</span></h2><div class="pubdate">15 Oct at 09:27:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/747">https://github.com/qt4cg/qtspecs/issues/747</a></div><details><summary>QName literals</summary><div class="markup"><p>It's quite common to want to write a constant QName; I found myself doing this a lot, for example, in examples and test cases for the <code>elements-to-maps()</code> function. It's clumsy having to call <code>xs:QName()</code> or <code>fn:QName()</code> or <code>parse-QName()</code> for this purpose. It's particularly clumsy with map constructors where you want to write many QNames.</p>
<p>I propose we introduce the syntax <code>Q"prefix:local"</code>.</p>
<p>The quotes can be either single or double; the prefix is optional. If there is no prefix, the result is a no-namespace QName.</p>
<p>The prefix (if present) must be bound to a namespace in the static context.</p>
<p>Character and entity references are not allowed.</p>
<p>Note that <code>Q{uri}local</code> is a NameTest, not a QName literal.</p>
</div></details></div>
<div class="toot" id="created-746"><h2>Issue #746 created<span class="toot-id"> #created-746</span></h2><div class="pubdate">14 Oct at 18:16:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/746">https://github.com/qt4cg/qtspecs/issues/746</a></div><details><summary>break-when -&gt; split-when in fn:partition</summary><div class="markup"><p>We decided to rename <code>xsl:for-each-group/@break-when</code> as <code>@split-when</code>. We should make the same change to the name of the second argument of <code>fn:partition</code>.</p>
</div></details></div>
<div class="toot" id="created-745"><h2>Issue #745 created<span class="toot-id"> #created-745</span></h2><div class="pubdate">12 Oct at 11:21:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/745">https://github.com/qt4cg/qtspecs/issues/745</a></div><details><summary>Support for inline (anonymous) xslt functions</summary><div class="markup"><p>I propose adding support for inline xslt functions.</p>
<p>Whilst XPath supports this, Xpath functions are limited in what they can do, and how "look" e.g. returning newly constructed elements isnt possible without parse-xml-fragment.</p>
<p>I would suggest the syntax would be basically the same as for xsl:function except with the name omitted, e.g.</p>
<pre><code>    &lt;xsl:template name="apply-function" as="xs:integer"&gt;
        &lt;xsl:param name="input" as="xs:integer"/&gt;
        &lt;xsl:param name="function" as="function(xs:integer) as xs:integer"/&gt;
        &lt;xsl:sequence select="$function($input)"/&gt;
    &lt;/xsl:template&gt;

`    &lt;xsl:template ....&gt;
        &lt;xsl:call-template name="apply-function"&gt;
            &lt;xsl:with-param name="input" select="1"/&gt;
            &lt;xsl:with-param name="function"&gt;
                &lt;xsl:function as="xs:integer"&gt;
                    &lt;xsl:param name="value" as="xs:integer"/&gt;
                    &lt;result&gt;
                        &lt;xsl:sequence select="$value * 2"/&gt;
                    &lt;/result&gt;
                &lt;/xsl:function&gt;
            &lt;/xsl:with-param&gt;
        &lt;/xsl:call-template&gt;
    &lt;/xsl:template&gt;
`
</code></pre>
<p>benefits</p>
<ul>
<li>less syntactic "noise" of named functions</li>
<li>the ability to embed xslt functions inline inside maps (and other data types)</li>
<li>functional parity with xpath (and more)</li>
<li>natural generalisation to local function proposal</li>
</ul>
<p>alternatives</p>
<ul>
<li>use reference to explicitly named XSLT function</li>
<li>use XPath (though problematic when constructing new nodes)</li>
</ul>
</div></details></div>
<div class="toot" id="created-744"><h2>Pull request #744 created<span class="toot-id"> #created-744</span></h2><div class="pubdate">11 Oct at 11:48:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/744">https://github.com/qt4cg/qtspecs/pull/744</a></div><details><summary>XQFO Examples: minor fixes, formatting</summary><div class="markup"><p>Editorial: Some XQuery equivalents were buggy, and the formatting was unified.</p>
</div></details></div>
<div class="toot" id="created-743"><h2>Issue #743 created<span class="toot-id"> #created-743</span></h2><div class="pubdate">10 Oct at 23:33:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/743">https://github.com/qt4cg/qtspecs/issues/743</a></div><details><summary>Extend enumeration types to allow values other than strings</summary><div class="markup"><p>In reviewing and accepting the spec for enumeration types, it was suggested that it might be useful to allow values other than strings.</p>
<ul>
<li>There's a difficulty in that not all atomic values can be represented by literals. We have the same problem with function annotations; perhaps we need to bite the bullet and define some kind of "constant atomic expression" construct.</li>
<li>Aside from that, there don't seem to be any major obstacles.</li>
</ul>
<p>We change</p>
<blockquote>
<p>An EnumerationType has a value space consisting of a set of xs:string values. When matching strings against an enumeration type, strings are always compared using the Unicode codepoint collation.</p>
</blockquote>
<p>to</p>
<blockquote>
<p>An EnumerationType has a value space consisting of a set of atomic values. When matching values against an enumeration type, values are always compared using the fn:atomic-compare() function (as used for comparing map keys).</p>
</blockquote>
<p>The subtyping rules (newly defined in terms of unions of singleton enumeration sets) seem to work in their current form, without change. <code>enum("red", "green")</code> is still a subtype of <code>xs:string</code>, because all the enumerated values are instances of <code>xs:string</code>.</p>
</div></details></div>
<div class="toot" id="minutes-10-10"><h2>QT4 CG meeting 049 draft minutes<span class="toot-id"> #minutes-10-10</span></h2><div class="pubdate">10 Oct at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/10-10">https://qt4cg.org/meeting/minutes/2023/10-10</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-742"><h2>Issue #742 created<span class="toot-id"> #created-742</span></h2><div class="pubdate">10 Oct at 16:30:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/742">https://github.com/qt4cg/qtspecs/issues/742</a></div><details><summary>xsl:function-library: keep, drop, or refine?</summary><div class="markup"><p>The draft XSLT 4.0 specification (§5.3.2) proposes a new declaration xsl:function-library as a solution to the problem of having to qualify all function names except those in the core namespace. We have not reviewed this proposal.</p>
</div></details></div>
<div class="toot" id="closed-688"><h2>Issue #688 closed<span class="toot-id"> #closed-688</span></h2><div class="pubdate">10 Oct at 16:08:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/688">https://github.com/qt4cg/qtspecs/issues/688</a></div><p>Coercion rules for union types and enumeration types</p></div>
<div class="toot" id="closed-691"><h2>Issue #691 closed<span class="toot-id"> #closed-691</span></h2><div class="pubdate">10 Oct at 16:08:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/691">https://github.com/qt4cg/qtspecs/pull/691</a></div><p>688 Semantics of local union types, enumeration types, etc</p></div>
<div class="toot" id="closed-372"><h2>Issue #372 closed<span class="toot-id"> #closed-372</span></h2><div class="pubdate">10 Oct at 16:07:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/372">https://github.com/qt4cg/qtspecs/issues/372</a></div><p>Separate default namespace for elements from the default namespace for types</p></div>
<div class="toot" id="closed-715"><h2>Issue #715 closed<span class="toot-id"> #closed-715</span></h2><div class="pubdate">10 Oct at 16:07:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/715">https://github.com/qt4cg/qtspecs/pull/715</a></div><p>372 Rollback the default namespace changes</p></div>
<div class="toot" id="closed-725"><h2>Issue #725 closed<span class="toot-id"> #closed-725</span></h2><div class="pubdate">10 Oct at 16:06:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/725">https://github.com/qt4cg/qtspecs/issues/725</a></div><p>Clarification to load-xquery-module</p></div>
<div class="toot" id="closed-727"><h2>Issue #727 closed<span class="toot-id"> #closed-727</span></h2><div class="pubdate">10 Oct at 16:06:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/727">https://github.com/qt4cg/qtspecs/pull/727</a></div><p>725 Add clarification note for load-xquery-module</p></div>
<div class="toot" id="closed-52"><h2>Issue #52 closed<span class="toot-id"> #closed-52</span></h2><div class="pubdate">10 Oct at 16:06:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/52">https://github.com/qt4cg/qtspecs/issues/52</a></div><p>Allow record(*) based RecordTests</p></div>
<div class="toot" id="closed-728"><h2>Issue #728 closed<span class="toot-id"> #closed-728</span></h2><div class="pubdate">10 Oct at 16:06:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/728">https://github.com/qt4cg/qtspecs/pull/728</a></div><p>52 Allow record(*)</p></div>
<div class="toot" id="closed-731"><h2>Issue #731 closed<span class="toot-id"> #closed-731</span></h2><div class="pubdate">10 Oct at 16:06:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/731">https://github.com/qt4cg/qtspecs/issues/731</a></div><p>Capturing accumulators: a couple of minor errors/omissions</p></div>
<div class="toot" id="closed-732"><h2>Issue #732 closed<span class="toot-id"> #closed-732</span></h2><div class="pubdate">10 Oct at 16:06:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/732">https://github.com/qt4cg/qtspecs/pull/732</a></div><p>731 Capturing accumulators: Add error conditions, revise streaming rules</p></div>
<div class="toot" id="created-741"><h2>Pull request #741 created<span class="toot-id"> #created-741</span></h2><div class="pubdate">10 Oct at 14:16:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/741">https://github.com/qt4cg/qtspecs/pull/741</a></div><details><summary>QT4CG-048-03: Fix copy and paste errors in describing type patterns</summary><div class="markup"><p>Fulfils Action QT4CG-048-03.</p>
</div></details></div>
<div class="toot" id="created-740"><h2>Pull request #740 created<span class="toot-id"> #created-740</span></h2><div class="pubdate">10 Oct at 12:00:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/740">https://github.com/qt4cg/qtspecs/pull/740</a></div><details><summary>QT4CG-047-01: Rename break-when to split-when, plus minor editorial cleanup</summary><div class="markup"><p>Fulfils action QT4CG-047-01 : the CG decided to rename break-when as split-when. Also applies a few minor editorial corrections in the same general area.</p>
</div></details></div>
<div class="toot" id="created-739"><h2>Pull request #739 created<span class="toot-id"> #created-739</span></h2><div class="pubdate">10 Oct at 11:56:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/739">https://github.com/qt4cg/qtspecs/pull/739</a></div><p>Apply review comment changes to the HTML DOM XDM mapping.</p></div>
<div class="toot" id="agenda-10-10"><h2>QT4 CG meeting 049 draft agenda<span class="toot-id"> #agenda-10-10</span></h2><div class="pubdate">09 Oct at 11:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/10-10">https://qt4cg.org/meeting/agenda/2023/10-10</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-738"><h2>Issue #738 created<span class="toot-id"> #created-738</span></h2><div class="pubdate">08 Oct at 22:04:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/738">https://github.com/qt4cg/qtspecs/issues/738</a></div><details><summary>FO: Why is fn:op under section "17.3 Dynamic loading"</summary><div class="markup"><p>FO: Why is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-op"><strong><code>fn:op</code></strong></a> under section <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dynamic-loading">"<strong>17.3 Dynamic loading</strong>"</a> ?</p>
<ol>
<li>
<p>Lexical substitution has little, if anything at all, to do with (dynamic) loading. Nothing is loaded from some external resource, as in the case of <strong><code>fn: load-xquery-module</code></strong> and <strong><code>fn:transform</code></strong>.</p>
</li>
<li>
<p>There is nothing dynamic about having a predefined function that has a predefined set of possible values. In fact this could be defined as a strictly/statically defined <strong><code>map(xs:string, function(item()*, item()*) as item()*)</code></strong> with all allowed possible keys and as their values - the corresponding functions.</p>
</li>
</ol>
<p>Taking this into account it is suggested to move <code>fn:op</code> to a section where it truly belongs. Maybe have in this section also other features of the language that are merely lexical substitution, as for example, function(s) for the creation of type-aliases.</p>
</div></details></div>
<div class="toot" id="created-737"><h2>Pull request #737 created<span class="toot-id"> #created-737</span></h2><div class="pubdate">07 Oct at 22:21:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/737">https://github.com/qt4cg/qtspecs/pull/737</a></div><details><summary>295: Boost the capability of recursive record types</summary><div class="markup"><p>Fix issue #295</p>
<p>The main changes are:</p>
<ul>
<li>In place of the special self-reference syntax "..", we now allow recursive use of type aliases, allowing types to be mutually recursive</li>
<li>We generalise the places that recursive references are allowed, for example the record type used by fn:random-number-generator is now legal</li>
<li>Subtyping rules for recursive record types are now defined (this was previously a gap in the specification). Acknowledgements to a John Snelson blog post for pointing me in the right direction.</li>
</ul>
</div></details></div>
<div class="toot" id="created-736"><h2>Pull request #736 created<span class="toot-id"> #created-736</span></h2><div class="pubdate">06 Oct at 21:33:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/736">https://github.com/qt4cg/qtspecs/pull/736</a></div><details><summary>730: Clarify (and correct) rules for maps as instances of function types</summary><div class="markup"><p>Fix issue #730</p>
<p>Note: the issue led to a wide-ranging discussion about possible enhancements to the type system, for example adding types for empty maps and arrays. I have ignored most of this, and have focussed on fixing the issue as raised (arising originally on the test suite), namely the incorrect use of <code>V?</code> to define a type that allows either an instance of the sequence type V or or an empty sequence.</p>
</div></details></div>
<div class="toot" id="minutes-10-03"><h2>QT4 CG meeting 048 draft minutes<span class="toot-id"> #minutes-10-03</span></h2><div class="pubdate">04 Oct at 14:50:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/10-03">https://qt4cg.org/meeting/minutes/2023/10-03</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-735"><h2>Issue #735 created<span class="toot-id"> #created-735</span></h2><div class="pubdate">02 Oct at 09:21:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/735">https://github.com/qt4cg/qtspecs/issues/735</a></div><details><summary>Local functions in XSLT</summary><div class="markup"><p>I propose that we should add local functions to XSLT: specifically, allowing an <code>xsl:function</code> declaration to appear within a sequence constructor, declaring a named function that is available for use only within the sequence constructor.</p>
<p>At present this can be achieved by declaring a local variable bound to an anonymous function, but it's clumsy to have to use completely different syntax for local and global functions, and functions defined in this way cannot be mutually recursive.</p>
<p>I propose that such functions should shadow any global functions with the same name, in the same way as happens with local variable declarations. I have an open mind as to whether shadowing of functions in reserved namespaces should be allowed.</p>
<p>The main difficulty is the scoping rules. We don't want the problems Javascript has with "hoisting". I propose that (a) all local function declarations must appear before any instructions (or local variable declarations, but not params) within the sequence constructor, and (b) these function declarations are in-scope throughout the sequence constructor including forwards references from the body of other functions declared earlier within the same sequence constructor.</p>
</div></details></div>
<div class="toot" id="created-734"><h2>Pull request #734 created<span class="toot-id"> #created-734</span></h2><div class="pubdate">30 Sep at 19:15:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/734">https://github.com/qt4cg/qtspecs/pull/734</a></div><details><summary>517: fn:chain</summary><div class="markup"><p>Added fn:chain.</p>
<p>Took much effort to ensure Unix-style line-endings are used.</p>
</div></details></div>
<div class="toot" id="closed-733"><h2>Issue #733 closed<span class="toot-id"> #closed-733</span></h2><div class="pubdate">30 Sep at 19:13:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/733">https://github.com/qt4cg/qtspecs/pull/733</a></div><p>517: fn:chain</p></div>
<div class="toot" id="created-733"><h2>Pull request #733 created<span class="toot-id"> #created-733</span></h2><div class="pubdate">30 Sep at 02:08:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/733">https://github.com/qt4cg/qtspecs/pull/733</a></div><details><summary>517: fn:chain</summary><div class="markup"><p>I added fn:chain, which has been discussed in https://github.com/qt4cg/qtspecs/issues/517</p>
</div></details></div>
<div class="toot" id="created-732"><h2>Pull request #732 created<span class="toot-id"> #created-732</span></h2><div class="pubdate">29 Sep at 16:55:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/732">https://github.com/qt4cg/qtspecs/pull/732</a></div><details><summary>731 Capturing accumulators: Add error conditions, revise streaming rules</summary><div class="markup"><p>Minor tweaks to the spec for capture=yes accumulator rules.</p>
<p>Fix #731</p>
</div></details></div>
<div class="toot" id="created-731"><h2>Issue #731 created<span class="toot-id"> #created-731</span></h2><div class="pubdate">29 Sep at 15:57:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/731">https://github.com/qt4cg/qtspecs/issues/731</a></div><details><summary>Capturing accumulators: a couple of minor errors/omissions</summary><div class="markup"><p>Two little things in the spec for capturing accumulators that we agreed last week:</p>
<p>(a) We should define an error code for use when the capture attribute is present but phase="start".</p>
<p>(b) The streamability rules are too strict. They say that the select attribute must be motionless or consuming, but this is not necessary, because the select attribute is applied to a snapshot tree, which is instantiated in memory and therefore does not need to be streamable.</p>
</div></details></div>
<div class="toot" id="agenda-10-03"><h2>QT4 CG meeting 048 draft agenda<span class="toot-id"> #agenda-10-03</span></h2><div class="pubdate">29 Sep at 13:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/10-03">https://qt4cg.org/meeting/agenda/2023/10-03</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-211"><h2>Issue #211 closed<span class="toot-id"> #closed-211</span></h2><div class="pubdate">29 Sep at 12:55:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/211">https://github.com/qt4cg/qtspecs/issues/211</a></div><p>XSLT streaming: capturing accumulators</p></div>
<div class="toot" id="closed-717"><h2>Issue #717 closed<span class="toot-id"> #closed-717</span></h2><div class="pubdate">29 Sep at 12:55:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/717">https://github.com/qt4cg/qtspecs/pull/717</a></div><p>211: add capturing accumulators to XSLT</p></div>
<div class="toot" id="created-730"><h2>Issue #730 created<span class="toot-id"> #created-730</span></h2><div class="pubdate">28 Sep at 17:43:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/730">https://github.com/qt4cg/qtspecs/issues/730</a></div><details><summary>Equivalence of map and function types</summary><div class="markup"><p>It is stated in XPath §3.6.4.2, and probably elsewhere, that</p>
<p><em>The function signature of a map matching type map(K, V), treated as a function, is function(xs:anyAtomicType) as V?</em></p>
<p>But V is a sequence type, not an item type, so you can't just tag a '?' onto the end of it. What is intended here by <code>V?</code> is a sequence type that is the union of <code>V</code> and <code>empty-sequence()</code>.</p>
</div></details></div>
<div class="toot" id="created-729"><h2>Issue #729 created<span class="toot-id"> #created-729</span></h2><div class="pubdate">28 Sep at 11:50:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/729">https://github.com/qt4cg/qtspecs/issues/729</a></div><details><summary>xsi:schemaLocation</summary><div class="markup"><p>The specifications (XQuery and XSLT) should say something about the effect of requesting validation on a document that contains <code>xsi:schemaLocation</code> and/or <code>xsi:noNamespaceSchemaLocation</code> attributes. At present XQuery says nothing, and XSLT says very little.</p>
<p>XQuery 3.1 says: <em>A validate expression can be used to validate a document node or an element node with respect to the [in-scope schema definitions], using the schema validation process defined in [[XML Schema 1.0]] or [[XML Schema 1.1]].</em> This doesn't really answer the question. The "with respect to" phrase could be read as implying that ONLY the in-scope schema definitions are used. Particular problems occur if xsi:schemaLocation refers to a schema document that attempts to override or redefine the schema components that have been statically imported.</p>
<p>XSLT 3.0 says nothing of interest about what schema (=set of schema components) is used when validation is requested, though it does mention in passing that <code>xsi:schemaLocation</code> attributes might be interpreted in some way by a schema processor.</p>
<p>If we look to the behaviour of Saxon as a reference implementation, then we'll quickly find fault. There's a configuration option to control whether <code>xsi:schemaLocation</code> attributes are considered or ignored; if they are considered, then the schema components referenced are added to a global pool of schema components which are used not only to validate the document in question, but to validate any subsequent documents. We're in the process of redesigning this to do something that makes more sense.</p>
</div></details></div>
<div class="toot" id="created-728"><h2>Pull request #728 created<span class="toot-id"> #created-728</span></h2><div class="pubdate">28 Sep at 11:24:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/728">https://github.com/qt4cg/qtspecs/pull/728</a></div><details><summary>52 Allow record(*)</summary><div class="markup"><p>Fix #52.
Implements decision made at meeting 046.</p>
</div></details></div>
<div class="toot" id="created-727"><h2>Pull request #727 created<span class="toot-id"> #created-727</span></h2><div class="pubdate">27 Sep at 17:38:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/727">https://github.com/qt4cg/qtspecs/pull/727</a></div><details><summary>725 Add clarification note for load-xquery-module</summary><div class="markup"><p>Add a note to clarify the behaviour of load-xquery-module.</p>
<p>Fix #725</p>
</div></details></div>
<div class="toot" id="closed-724"><h2>Issue #724 closed<span class="toot-id"> #closed-724</span></h2><div class="pubdate">27 Sep at 16:13:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/724">https://github.com/qt4cg/qtspecs/pull/724</a></div><p>PR 717 with merge conflicts resolved</p></div>
<div class="toot" id="closed-723"><h2>Issue #723 closed<span class="toot-id"> #closed-723</span></h2><div class="pubdate">27 Sep at 15:30:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/723">https://github.com/qt4cg/qtspecs/pull/723</a></div><p>Updated PR for capturing accumulators</p></div>
<div class="toot" id="closed-726"><h2>Issue #726 closed<span class="toot-id"> #closed-726</span></h2><div class="pubdate">27 Sep at 09:41:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/726">https://github.com/qt4cg/qtspecs/pull/726</a></div><p>PR 723 with merge conflicts resolved</p></div>
<div class="toot" id="created-726"><h2>Pull request #726 created<span class="toot-id"> #created-726</span></h2><div class="pubdate">27 Sep at 09:22:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/726">https://github.com/qt4cg/qtspecs/pull/726</a></div><p>PR 723 with merge conflicts resolved</p></div>
<div class="toot" id="created-725"><h2>Issue #725 created<span class="toot-id"> #created-725</span></h2><div class="pubdate">27 Sep at 09:14:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/725">https://github.com/qt4cg/qtspecs/issues/725</a></div><details><summary>Clarification to load-xquery-module</summary><div class="markup"><p>Add a clarification note to load-xquery-module, to correct a misunderstanding by a (very knowledgeable) user: see https://saxonica.plan.io/issues/6209</p>
<p>The function load-query-module does not modify the static or dynamic context in any way. In particular, the variables and functions that are loaded from the query module are not added to the static or dynamic context of the calling code. They are accessible only via the map that is returned from the function call.</p>
</div></details></div>
<div class="toot" id="created-724"><h2>Pull request #724 created<span class="toot-id"> #created-724</span></h2><div class="pubdate">27 Sep at 08:50:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/724">https://github.com/qt4cg/qtspecs/pull/724</a></div><p>PR 717 with merge conflicts resolved</p></div>
<div class="toot" id="minutes-09-26"><h2>QT4 CG meeting 047 draft minutes<span class="toot-id"> #minutes-09-26</span></h2><div class="pubdate">26 Sep at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/09-26">https://qt4cg.org/meeting/minutes/2023/09-26</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-722"><h2>Issue #722 closed<span class="toot-id"> #closed-722</span></h2><div class="pubdate">26 Sep at 17:06:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/722">https://github.com/qt4cg/qtspecs/pull/722</a></div><p>This is a test. This is only a test.</p></div>
<div class="toot" id="created-723"><h2>Pull request #723 created<span class="toot-id"> #created-723</span></h2><div class="pubdate">26 Sep at 16:56:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/723">https://github.com/qt4cg/qtspecs/pull/723</a></div><details><summary>Updated PR for capturing accumulators</summary><div class="markup"><p>Updated to take account of comments</p>
</div></details></div>
<div class="toot" id="created-722"><h2>Pull request #722 created<span class="toot-id"> #created-722</span></h2><div class="pubdate">26 Sep at 16:50:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/722">https://github.com/qt4cg/qtspecs/pull/722</a></div><details><summary>This is a test. This is only a test.</summary><div class="markup"><p>Had this been a real emergency, we would have fled in terror and you would not have been informed.</p>
<p>DO NOT MERGE THIS! :-)</p>
</div></details></div>
<div class="toot" id="closed-721"><h2>Issue #721 closed<span class="toot-id"> #closed-721</span></h2><div class="pubdate">26 Sep at 16:49:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/721">https://github.com/qt4cg/qtspecs/pull/721</a></div><p>Attempt to fix the problem with PRE elements in autodiffs</p></div>
<div class="toot" id="created-721"><h2>Pull request #721 created<span class="toot-id"> #created-721</span></h2><div class="pubdate">26 Sep at 16:48:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/721">https://github.com/qt4cg/qtspecs/pull/721</a></div><details><summary>Attempt to fix the problem with PRE elements in autodiffs</summary><div class="markup"><p>Maybe I'm more cleverer today than I was last time I looked into this.</p>
</div></details></div>
<div class="toot" id="closed-663"><h2>Issue #663 closed<span class="toot-id"> #closed-663</span></h2><div class="pubdate">26 Sep at 16:13:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/663">https://github.com/qt4cg/qtspecs/issues/663</a></div><p>Calling xsl:original() with keywords</p></div>
<div class="toot" id="closed-674"><h2>Issue #674 closed<span class="toot-id"> #closed-674</span></h2><div class="pubdate">26 Sep at 16:13:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/674">https://github.com/qt4cg/qtspecs/pull/674</a></div><p>663: Describe how calls to xsl:original with keywords work</p></div>
<div class="toot" id="closed-570"><h2>Issue #570 closed<span class="toot-id"> #closed-570</span></h2><div class="pubdate">26 Sep at 16:12:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/570">https://github.com/qt4cg/qtspecs/issues/570</a></div><p>XSLT: Built-in template rules for maps and arrays</p></div>
<div class="toot" id="closed-718"><h2>Issue #718 closed<span class="toot-id"> #closed-718</span></h2><div class="pubdate">26 Sep at 16:12:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/718">https://github.com/qt4cg/qtspecs/pull/718</a></div><p>Add on-no-match="shallow-copy-all"</p></div>
<div class="toot" id="agenda-09-26"><h2>QT4 CG meeting 047 draft agenda<span class="toot-id"> #agenda-09-26</span></h2><div class="pubdate">25 Sep at 10:55:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/09-26">https://qt4cg.org/meeting/agenda/2023/09-26</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-720"><h2>Issue #720 created<span class="toot-id"> #created-720</span></h2><div class="pubdate">25 Sep at 09:47:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/720">https://github.com/qt4cg/qtspecs/issues/720</a></div><details><summary>From Records to Objects</summary><div class="markup"><p>It has become idiomatic to use maps, and record type definitions, to declare a collection of functions; so for example the random-number-generator object offers a "method" <code>next()</code> that can be called using the syntax <code>$rng?next()</code>.</p>
<p>The problem is that it's not possible, within the XPath/XQuery language, to implement such a function with implicit access to the object on which it is invoked. The implementation of the function does not have access to any kind of <code>$this</code> variable.</p>
<p>This issue considers how we can move forwards from supporting simple records to introduce object capabilities, in an incremental and compatible way.</p>
<p>Here are three steps in that direction:</p>
<ol>
<li>Where a named record type is declared, also create a corresponding constructor function. So if you declare</li>
</ol>
<p><code>declare item type my:loc as record(longitude as xs:double, latitude as xs:double)</code></p>
<p>you also get a constructor function allowing my:loc(180, 180), allowing both positional or keyword arguments corresponding to the field names,</p>
<ol start="2">
<li>
<p>Allow default values to be defined in the record type, which act as default values for the parameters in the constructor function.</p>
</li>
<li>
<p>Allow functions that are defined as part of a record type access to a variable $this. The constructor function provides an implicit binding of this variable to the record/map/object that is being instantiated.</p>
</li>
<li>
<p>Allow self-reference to a named record type (and its constructor function) within the record definition.</p>
</li>
</ol>
<p>So you can now do:</p>
<pre><code>declare type my:counter as record (
   value as xs:integer,
   increment := fn() as my:counter {my:counter($this?value + 1)}
)
</code></pre>
<p>and then</p>
<pre><code>let $x := my:counter(0)
return $x?increment()?value
</code></pre>
<p>which returns 1.</p>
</div></details></div>
<div class="toot" id="created-719"><h2>Pull request #719 created<span class="toot-id"> #created-719</span></h2><div class="pubdate">21 Sep at 20:21:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/719">https://github.com/qt4cg/qtspecs/pull/719</a></div><details><summary>413: Spec for CSV-related functions</summary><div class="markup"><p>This PR contains error fixes (typos, examples that contradicted the spec text), some (hopefully) improved language and one breaking change.</p>
<p>The current draft uses the type <code>map(xs:integer, xs:string)</code> for the <code>column-names</code> option to <code>fn:csv-to-xdm</code> and <code>fn:csv-to-xml</code>. This PR flips that to <code>map(xs:string, xs:integer)</code>. It turns out that the examples were already using this, and it seems to me that having the <code>names</code> entry in the <code>csv-columns-record</code> record type be the transposed version of the <code>column-names</code> option that creates it, rather than be the same thing, is counterproductive.</p>
<p>I can think of some examples (a CSV split into several chunks, with only the first containing the headers) where being able to feed the <code>names</code> entry right back into another invocation of <code>fn:csv-to-xdm</code> would be useful. If nothing else it's confusing and not obvious, or I wouldn't have messed up the examples, and somebody would have noticed during the review process...</p>
</div></details></div>
<div class="toot" id="created-718"><h2>Pull request #718 created<span class="toot-id"> #created-718</span></h2><div class="pubdate">21 Sep at 16:39:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/718">https://github.com/qt4cg/qtspecs/pull/718</a></div><details><summary>Add on-no-match="shallow-copy-all"</summary><div class="markup"><p>Enable recursive descent transformation with template rules for maps and arrays.</p>
<p>Fix #570</p>
</div></details></div>
<div class="toot" id="created-717"><h2>Pull request #717 created<span class="toot-id"> #created-717</span></h2><div class="pubdate">21 Sep at 10:36:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/717">https://github.com/qt4cg/qtspecs/pull/717</a></div><details><summary>211: add capturing accumulators to XSLT</summary><div class="markup"><p>Adds the attribute capture="yes" to xsl:accumulator-rule. This has been available as a Saxon extension for some time and makes many accumulators much easier to implement.</p>
<p>Fix #211</p>
</div></details></div>
<div class="toot" id="created-716"><h2>Issue #716 created<span class="toot-id"> #created-716</span></h2><div class="pubdate">20 Sep at 02:34:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/716">https://github.com/qt4cg/qtspecs/issues/716</a></div><details><summary>Generators in XPath</summary><div class="markup"><h1>What is a generator?</h1>
<p>Generators are well known and provided out of the box in many programming languages. Per Wikipedia:</p>
<p>“In&nbsp;<a href="https://en.wikipedia.org/wiki/Computer_science">computer science</a>,  a&nbsp;<strong>generator</strong>&nbsp;is a&nbsp;<a href="https://en.wikipedia.org/wiki/Subroutine">routine</a>&nbsp;that can be used to control the&nbsp;<a href="https://en.wikipedia.org/wiki/Iteration">iteration</a>&nbsp;behaviour of a&nbsp;<a href="https://en.wikipedia.org/wiki/Control_flow#Loops">loop</a>. All generators are also&nbsp;<a href="https://en.wikipedia.org/wiki/Iterator">iterators</a>.<a href="https://en.wikipedia.org/wiki/Generator_(computer_programming)#cite_note-1">[1]</a>&nbsp;A generator is very similar to a function that returns an array, in that a generator has parameters, can be called, and generates a sequence of values.
However, instead of building an array containing all the values and returning them all at once, a generator yields the values one at a time, which requires less memory and allows the caller to get started processing the first few values immediately. In short, a generator&nbsp;<em>looks like</em>&nbsp;a function but&nbsp;<em>behaves like</em>&nbsp;an&nbsp;<a href="https://en.wikipedia.org/wiki/Iterator">iterator</a>.”</p>
<hr>
<h1>The goal of this proposal (major use-cases)</h1>
<p>A generator in XPath should be a tool to easily implement the solutions to the following use-cases:</p>
<ol>
<li>
<p>Processing a huge collection whose members may not all be needed.<br>
A generator will produce only the next member of the collection and only on demand basis.</p>
</li>
<li>
<p>Handling a collection containing unknown or infinite number of members.
When requested the next member of the collection the generator will always produce it, if the collection still contains any members. It is the responsibility of the caller to issue only the necessary number of requests for the really needed next members.</p>
</li>
</ol>
<p>What is achieved in both cases:</p>
<ul>
<li>A (next) member is produced only on request. No time is spent on producing all members of the collection.</li>
<li>A (next) member is produced only on request. No memory is consumed to store all members of the collection.</li>
</ul>
<p>A good problem that is based on these use-cases is to generate a collection of the first N members that have some wanted properties,  and are generated from other collection(s), when it is not known what the size of the original input collections would be in order for the desired number of N members to be discovered.</p>
<p>For example: <strong><em>Produce the first 1 000 000 (1M) prime numbers</em></strong>.</p>
<p>Sometimes we may not even know if N such wanted members actually exist, for example: <strong><em>Produce the first 2 sequences of 28 prime numbers where <a href="https://en.wikipedia.org/wiki/Primes_in_arithmetic_progression#Largest_known_primes_in_AP">the primes in each of the sequences form an arithmetic progression</a>.</em></strong></p>
<hr>
<h1>The Proposal</h1>
<p>A generator is defined as (and synonym for):</p>
<pre><code class="language-xq">let $generator as record
                   (initialized as xs:boolean,
                    endReached as xs:boolean,
                    getCurrent as function(..) as item()*,
                    moveNext as function(..) as .. ,
                    *  ) 
</code></pre>
<p>A generator is an extensible <a href="https://qt4cg.org/pr/715/xquery-40/xpath-40.html#id-record-test"><strong><em>record</em></strong> </a>.</p>
<p>It has four fixed-named keys, and any other map-keys, as required to hold the internal state of that specific generator.</p>
<p>Here is the meaning of  the four fixed/named keys:</p>
<ul>
<li>
<p><strong><em>initialized</em></strong> is a boolean. When a generator <code>$gen</code>  is initially instantiated, <code>$gen?initialized</code> is <code>false()</code>. Any call to <code>$gen?getCurrent()</code> raises an error. In order to get the first value of the represented collection, the caller must call <code>$gen?moveNext()</code></p>
</li>
<li>
<p><strong><em>endReached</em></strong> is a boolean. If after a call to <code>moveNext()</code> the value of the returned generator's <code>endReached</code> key is <code>true()</code> then calling <code>moveNext()</code> and/or <code>getCurrent()</code> on this generator raises an error.</p>
</li>
<li>
<p><strong><em>getCurrent</em></strong> is a function of zero arguments. It must only be called if the values of <code>initialized</code> is <code>true()</code> and the value of <code>endReached</code> is <code>false()</code>, otherwise an error must be raised. This function produces the current member of the collection after the last call to <code>moveNext</code>, if this call didn't return a generator whose <code>endReached</code> value was <code>true()</code></p>
</li>
<li>
<p><strong><em>moveNext</em></strong>  is a function of zero arguments. When called on a generator whose <code>endReached</code> value is <code>false()</code> then it produces the next (state of the) generator. including a possibly <code>true()</code> value of <code>endReached</code> and if this value is still <code>false()</code>, then calling <code>getCurrent()</code> produces the value of the next member of the collection.</p>
</li>
</ul>
<h1>Examples of operations on generators</h1>
<p>The following examples are written in pseudo-code as at the time of writing there was no available implementation of records. And also, the code for recursion in pure XPath makes any such example longer than necessary for grasping its meaning.</p>
<h2>The Empty Generator</h2>
<pre><code class="language-xq">emptyGenerator() {
             map{
                 initialized : true(),
                 endReached: true(),
                 getCurrent: function($this as map(*)) {error()},
                 moveNext: function($this as map(*)) {error()}
                }
              }
</code></pre>
<h2>Take the first N members of the collection</h2>
<pre><code class="language-xq">take($gen as generator, $n as xs:integer) as generator
{
  let $gen := if(not($gen?initialized)) then $gen?moveNext()
                      else $gen,
      return
         if( $gen?endReached or $n eq 0) then emptyGenerator()
            else map{
                     "initialized": true(),
                     "endReached": false(),
                     "getCurrent": $gen?getCurrent,
                     "moveNext": take($gen?moveNext(), $n -1)
                   }
}
</code></pre>
<h2>Skip the first N members from the collection</h2>
<pre><code class="language-xq">skip($gen as generator, $n as xs:integer) as generator
{
  if($n eq 0) then $gen
     else
     {
         let $gen := if(not($gen?initialized)) then $gen?moveNext()
                       else $gen
           return
             if(not($gen?endReached) then skip($gen?moveNext(), $n -1)
               else $gen
     }             
}
</code></pre>
<h2>Subrange of size N starting at the M-th member</h2>
<pre><code class="language-xq">subrange($gen as generator, $m as xs:integer, $n as xs:integer) as generator
{
  take(skip($gen, $m -1), $n)
}
</code></pre>
<h2>Head of a generator</h2>
<pre><code class="language-xq">head($gen as generator)
{
  take($gen, 1)?getCurrent()
}
</code></pre>
<h2>Tail of a generator</h2>
<pre><code class="language-xq">tail($gen as generator)
{
  skip($gen, 1)
}
</code></pre>
<h2>At index N</h2>
<pre><code class="language-xq">at($ind as xs:integer)
{
  subrange($ind, 1)?getCurrent()
}
</code></pre>
<h2>For Each</h2>
<pre><code class="language-xq">for-each($gen as generator, $fun as function(*))
{
   map:put($gen, "getCurrent", function() { $fun($gen?getCurrent()) }  )                              
}
</code></pre>
<h2>For Each Pair</h2>
<pre><code class="language-xq">for-each-pair($gen1 as generator, $gen2 as generator, $fun as function(*))
{
   let $gen1 := if(not($gen1?initialized)) then $gen1?moveNext()
                  else $gen1,
       $gen2 := if(not($gen2?initialized)) then $gen2?moveNext()
                  else $gen2,
    return
      if($gen1?endReached or $gen2?endReached) then map:put($gen1, "endReached", true())
        else map:put(map:put($gen1, "getCurrent", function() { $fun($gen1?getCurrent(), $gen2?getCurrent()) } ) ,
                     "moveNext", function() { for-each-pair(skip($gen1, 1), skip($gen2, 1), $fun)}
                    )                             
}
</code></pre>
<h2>Filter</h2>
<pre><code class="language-xq">filter($gen as generator, $pred as function(item()*) as xs:boolean)
{
     let $getNextGoodValue := function($gen as map(*), $pred as function(item()*) as xs:boolean)
         {
            let $mapResult := iterate-while(
                                            $gen,
                                            function($gen) { not($pred($gen?getCurrent($gen))) },
                                            function($gen) { $gen?moveNext($gen) }
                                            )   
            return $mapResult?getCurrent($mapResult)                     
         },
       $gen := if($gen?initialized) then $gen 
                      else $gen?moveNext($gen)
        return
          map {
               "initialized": true(),
               "endReached":  $gen?endReached,
               "getCurrent": function($this as map(*)) { $getNextGoodValue($this?inputGen, $pred) },
               "moveNext":   function($this as map(*))
                             {    let $nextGoodValue := $getNextGoodValue($this?inputGen?moveNext($this?inputGen), $pred),
                                      $nextGen := iterate-while(
                                                                $this?inputGen?moveNext($this?inputGen),
                                                                function($gen) { not($pred($gen?getCurrent($gen))) },
                                                                function($gen) { $gen?moveNext($gen) }
                                                                )
                                    return
                                      map {
                                            "initialized": $nextGen?initialized,
                                            "endReached":  $nextGen?endReached,
                                            "getCurrent" : function($x) {$nextGoodValue},
                                            "moveNext" :   $this?moveNext,
                                            "inputGen" :   $nextGen
                                           }
                             },
               "inputGen" : $gen
              }
        }
</code></pre>
<p><strong>Here are some other useful functions on generators -- with just their signature and summary</strong>:</p>
<ul>
<li>
<p><strong>concat($gen1 as generator , $gen2 as generator )</strong> - produces a generator that behaves as <code>$gen1</code> until <code>$gen1.endReached</code> becomes <code>true()</code>,  and then behaves as <code>$gen2</code></p>
</li>
<li>
<p><strong>append($gen as generator, $value as item()*)</strong> - produces a generator that behaves as <code>$gen</code> until <code>$gen.endReached</code> becomes <code>true()</code>,  and then as a generator that has only the single value <code>value</code>.</p>
</li>
<li>
<p><strong>prepend($gen as generator, $value as item()*)</strong> - produces a generator whose first value is <code>value</code> and then behaves as <code>$gen</code>.</p>
</li>
<li>
<p><strong>some($gen as generator) as xs:boolean</strong> - Produces <code>true()</code> if <code>$gen</code> has at least one value, and <code>false()</code> otherwise.</p>
</li>
<li>
<p><strong>some($gen as generator, $pred as function(item()*) as xs:boolean) as xs:boolean</strong> - Produces <code>true()</code> if <code>$gen</code> has at least one value for which $pred($thisValue) is true(), and <code>false()</code> otherwise.</p>
</li>
<li>
<p><strong>ofType($gen as generator, $type as type)</strong>  - Produces a new generator from <code>$gen</code> that contains all values from <code>$gen</code> of type <code>type</code> -- for this we need to have added to the language the <strong>type</strong> object.</p>
</li>
<li>
<p><strong>skipWhile($gen as generator, $pred as function(item()*) as xs:boolean)</strong>  - Produces a new generator from <code>$gen</code> by skipping all starting values for which <code>$pred($theValue)</code> is <code>true()</code>.</p>
</li>
<li>
<p><strong>takeWhile($gen as generator, $pred as function(item()*) as xs:boolean)</strong>  - Produces a new generator from <code>$gen</code> which contains all starting values of <code>$gen</code> for which <code>$pred($theValue)</code> is <code>true()</code>.</p>
</li>
<li>
<p><strong>toArray($gen as generator)</strong> - Produces an array that contains all values that are contained in <code>$gen</code>.</p>
</li>
<li>
<p><strong>toSequence($gen as generator)</strong> - Produces a sequence that contains all values that are contained in <code>$gen</code>. Values of <code>$gen</code> that are sequences themselves are flattened.</p>
</li>
<li>
<p><strong>toMap($gen as generator)</strong> - If the values in $gen are all key-value pairs, produces a map that contains exactly all the key-value pairs from <code>$gen</code>.</p>
</li>
</ul>
<hr>
<p>These and many other useful functions on generators can and should be added to every generator upon construction.</p>
<p>Thus, it would be good to have an explicit constructor function for a generator:</p>
<pre><code class="language-xq">     construct-generator($record as 
                               record( initialized as xs:boolean,
                                       endReached as xs:boolean,
                                       getCurrent as function(..) as item()*,
                                       moveNext as function(..) as .. ,
                                      )
                         ) as generator
</code></pre>
</div></details></div>
<div class="toot" id="created-715"><h2>Pull request #715 created<span class="toot-id"> #created-715</span></h2><div class="pubdate">19 Sep at 23:12:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/715">https://github.com/qt4cg/qtspecs/pull/715</a></div><details><summary>372 Rollback the default namespace changes</summary><div class="markup"><p>Implements the CG decision to roll back the changes that introduced two separate default namespaces for elements and types.</p>
<p>Fix #372</p>
</div></details></div>
<div class="toot" id="created-714"><h2>Issue #714 created<span class="toot-id"> #created-714</span></h2><div class="pubdate">19 Sep at 21:19:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/714">https://github.com/qt4cg/qtspecs/issues/714</a></div><details><summary>Function annotations in XSLT</summary><div class="markup"><p>I propose that the following attributes on an <code>xsl:function</code> should be accessible as annotations, for example in a call on function-annotations:</p>
<ul>
<li>visibility</li>
<li>streamability</li>
<li>new-each-time</li>
<li>cache</li>
</ul>
<p>plus any extension attribute in a user-defined namespace, for example <code>&lt;xsl:function saxon:debug="yes"/&gt;</code> should have the annotation <code>%saxon:debug("yes")</code>. The value is always a single string, the actual attribute value as written.</p>
</div></details></div>
<div class="toot" id="closed-703"><h2>Issue #703 closed<span class="toot-id"> #closed-703</span></h2><div class="pubdate">19 Sep at 16:26:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/703">https://github.com/qt4cg/qtspecs/pull/703</a></div><p>129 (1): XPath and XQuery changes for introduction of context value</p></div>
<div class="toot" id="closed-701"><h2>Issue #701 closed<span class="toot-id"> #closed-701</span></h2><div class="pubdate">19 Sep at 16:26:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/701">https://github.com/qt4cg/qtspecs/issues/701</a></div><p>fn:concat: Support for 0 or more arguments</p></div>
<div class="toot" id="closed-702"><h2>Issue #702 closed<span class="toot-id"> #closed-702</span></h2><div class="pubdate">19 Sep at 16:25:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/702">https://github.com/qt4cg/qtspecs/pull/702</a></div><p>701: fn:concat: Support for 0 or more arguments</p></div>
<div class="toot" id="closed-696"><h2>Issue #696 closed<span class="toot-id"> #closed-696</span></h2><div class="pubdate">19 Sep at 16:25:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/696">https://github.com/qt4cg/qtspecs/pull/696</a></div><p>566: Rework query parameters on build-uri/parse-uri</p></div>
<div class="toot" id="closed-694"><h2>Issue #694 closed<span class="toot-id"> #closed-694</span></h2><div class="pubdate">19 Sep at 16:23:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/694">https://github.com/qt4cg/qtspecs/pull/694</a></div><p>XQFO minor edits, with new examples and notes, 2 through 4.6</p></div>
<div class="toot" id="closed-687"><h2>Issue #687 closed<span class="toot-id"> #closed-687</span></h2><div class="pubdate">19 Sep at 16:23:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/687">https://github.com/qt4cg/qtspecs/issues/687</a></div><p>Constructor functions for user-defined types</p></div>
<div class="toot" id="closed-690"><h2>Issue #690 closed<span class="toot-id"> #closed-690</span></h2><div class="pubdate">19 Sep at 16:23:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/690">https://github.com/qt4cg/qtspecs/pull/690</a></div><p>687 Clarify constructor functions for user-defined types</p></div>
<div class="toot" id="closed-668"><h2>Issue #668 closed<span class="toot-id"> #closed-668</span></h2><div class="pubdate">19 Sep at 16:23:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/668">https://github.com/qt4cg/qtspecs/issues/668</a></div><p>Definition of HTML case-insensitive collation</p></div>
<div class="toot" id="closed-680"><h2>Issue #680 closed<span class="toot-id"> #closed-680</span></h2><div class="pubdate">19 Sep at 16:23:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/680">https://github.com/qt4cg/qtspecs/pull/680</a></div><p>668 define case insensitive collation normatively</p></div>
<div class="toot" id="created-713"><h2>Issue #713 created<span class="toot-id"> #created-713</span></h2><div class="pubdate">19 Sep at 16:22:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/713">https://github.com/qt4cg/qtspecs/issues/713</a></div><details><summary>Annotations: Editorial notes</summary><div class="markup"><p>Copied from https://github.com/qt4cg/qtspecs/pull/710#pullrequestreview-1630129066:</p>
<blockquote>
<p>For avoidance of doubt, we should say in XQuery 4.6.2.4 (Named Function References) that the function created by a named function reference has its annotations taken from the function definition. There are other places where we are not explicit about the annotations of a function item, for example with partial function application. We should add a note that in XPath and XSLT, it is not possible to define function annotations, so this function will always return an empty result. (However, we should consider giving user-defined functions in XSLT annotations based on their attributes, e.g. visibility and streamability).</p>
</blockquote>
<p>…and my complementary note in the PR thread:</p>
<blockquote>
<p>I decided to merge the PR without changes, and not add the reference to XPath and XSLT, because the function may also return results for XQuery functions imported via fn:load-xquery-module.</p>
</blockquote>
<p>Additional notes from today’s meeting:</p>
<ul>
<li>For annotations without values, we could assign <code>true()</code> as a default value.</li>
<li>Examples could be added to <code>fn:function-annotations</code> to demonstrate how to check for annotations without values (or with values whose EBV is <code>false()</code>: <code>0</code>, <code>""</code>, etc.).</li>
<li>Dimitre suggested restructuring the spec for features that are not available in XPath.</li>
<li>Maybe annotations would also be helpful in XPath.</li>
</ul>
<p>Feel free everyone to add more comments.</p>
</div></details></div>
<div class="toot" id="closed-36"><h2>Issue #36 closed<span class="toot-id"> #closed-36</span></h2><div class="pubdate">19 Sep at 16:12:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/36">https://github.com/qt4cg/qtspecs/issues/36</a></div><p>fn:function-annotations (Allow support for user-defined annotations)</p></div>
<div class="toot" id="closed-710"><h2>Issue #710 closed<span class="toot-id"> #closed-710</span></h2><div class="pubdate">19 Sep at 16:12:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/710">https://github.com/qt4cg/qtspecs/pull/710</a></div><p>36: fn:function-annotations</p></div>
<div class="toot" id="created-712"><h2>Issue #712 created<span class="toot-id"> #created-712</span></h2><div class="pubdate">19 Sep at 13:50:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/712">https://github.com/qt4cg/qtspecs/issues/712</a></div><details><summary>array:sort: to be aligned with fn:sort</summary><div class="markup"><p>Related: #623. And an editorial note:</p>
<p>https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-sort</p>
<p>I think the type for the 3rd argument of <code>fn:sort</code>…</p>
<pre><code>$key  as&nbsp;(function(item()) as xs:anyAtomicType*)+  :=&nbsp;fn:data#1
</code></pre>
<p>…should be changed to zero-or-more:</p>
<pre><code>$key  as&nbsp;(function(item()) as xs:anyAtomicType*)*  :=&nbsp;fn:data#1
</code></pre>
<p>While it will be rare to encounter queries with <code>key := ()</code>, there seems to be no urgent reason to enforce at least one sort key. The change would also be in alignment with the corresponding rule (with the current signature, <code>$key</code> cannot be empty), which says:</p>
<blockquote>
<p>The number of sort key definitions is determined by the number of function items supplied in the <code>$key</code> argument. If the argument is absent or empty, the default is a single sort key definition using the function <code>data#1</code>.</p>
</blockquote>
</div></details></div>
<div class="toot" id="created-711"><h2>Issue #711 created<span class="toot-id"> #created-711</span></h2><div class="pubdate">19 Sep at 09:22:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/711">https://github.com/qt4cg/qtspecs/issues/711</a></div><details><summary>Using annotations for navigation of JSON trees</summary><div class="markup"><p>This issue develops ideas presented in issue #596, which itself is a continuation of ideas raised in issue #341, issue #350, and elsewhere. It's related to the requirements presented in issue #262 and issue #297.</p>
<p>Firstly, I propose a change to the data model so that annotations can be attached to any item [or perhaps any value?], not only to a function. The annotations are a map of type <code>map{xs:QName, item()*}</code>. Some general principles:</p>
<ul>
<li>Annotations on an item do not affect the result of any operation on that item unless otherwise specified.</li>
<li>Operations that are described as returning a result that contains items that are present in one of the operation's operands retain the annotations of those items, unless otherwise specified. (So for example $a[C] returns a sequence of items from $a in which the annotations are preserved).</li>
<li>Operations that construct "new" items (for example $a + $b) return an item with no annotations, unless otherwise specified.</li>
<li>The function <code>annotations($x)</code> (replacing <code>function-annotations($x)</code>) returns the annotations of an item.</li>
<li>The function annotate($x, key, value) returns a "clone" of $x with an additional annotation. (A clone of an item differs from the original only in having different annotations. All operations other than annotation-sensitive operations produce exactly the same result on the clone and the original - including tests for node identity.)</li>
<li>To avoid confusion, the term "type annotation" is replaced by "type label".</li>
</ul>
<p>Secondly, we use annotations to aid navigation of JTrees (a term I use to describe trees of arrays and maps such as might be produced by parsing JSON).</p>
<p>We introduce a component of the static context <code>tracked=true|false</code>, defaulting to false. The construct <code>tracked{expression}</code> evaluates an expression and its subexpressions in tracked mode. In tracked mode any operator or function that performs selection within an array or map (for example the lookup operator, the <code>map:get</code> and <code>array:get</code> function, using the map/array as a function item, or the <code>array:head()</code> and <code>array:foot()</code> and <code>map:find()</code> functions) annotates the items in its result with two properties: "container" whose value is the map or array from which the item was selected, and "key" which is the key or array index of the selected value within that container. The effect is that if an item was found in a JTree using a tracked expression, the annotations on the resulting item can be used in effect to navigate upwards within the tree that was searched.</p>
<p>Note that this is not a new idea: in effect, the result of a tracked selection is a <strong>zipper</strong> data structure, as described in https://en.wikipedia.org/wiki/Zipper_(data_structure).</p>
<p>A further exploitation of the idea allows us to introduce deep update of JTree structures. For example, <code>modify(root:=$a, selection:=fn{?x?y?z,} change:=fn{.+1})</code> can evaluate the <code>selection</code> argument in tracked mode, apply the <code>change</code> function to the resulting items, and then navigate back using the <code>container</code> annotation to create modified versions of all traversed containing JTrees, eventually returning a modified version of the <code>root</code> tree.</p>
</div></details></div>
<div class="toot" id="agenda-09-19"><h2>QT4 CG meeting 046 draft agenda<span class="toot-id"> #agenda-09-19</span></h2><div class="pubdate">18 Sep at 14:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/09-19">https://qt4cg.org/meeting/agenda/2023/09-19</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-673"><h2>Issue #673 closed<span class="toot-id"> #closed-673</span></h2><div class="pubdate">18 Sep at 13:49:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/673">https://github.com/qt4cg/qtspecs/pull/673</a></div><p>HTML namespace changes</p></div>
<div class="toot" id="created-710"><h2>Pull request #710 created<span class="toot-id"> #created-710</span></h2><div class="pubdate">17 Sep at 21:08:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/710">https://github.com/qt4cg/qtspecs/pull/710</a></div><details><summary>36: fn:function-annotations</summary><div class="markup"><p>@michaelhkay Again, some hints might need to be added for XPath (?).</p>
</div></details></div>
<div class="toot" id="created-709"><h2>Issue #709 created<span class="toot-id"> #created-709</span></h2><div class="pubdate">17 Sep at 18:24:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/709">https://github.com/qt4cg/qtspecs/issues/709</a></div><details><summary>(Un)Checked Evaluation</summary><div class="markup"><p>Based on https://github.com/qt4cg/qtspecs/issues/707#issuecomment-1721596055 and the comments following in that thread:</p>
<blockquote>
<p>I've been thinking recently about adding <code>checked{}</code> and <code>unchecked{}</code> modes. For example</p>
<p>&lt;xsl:apply-templates select="checked{.//item}"/&gt;</p>
<p>would throw an error if there are no items. The mode of execution would propagate downwards, so <code>checked{a/b/c/d}</code> would be able to tell you that a <code>b</code> was found, but it had no <code>c</code> children.</p>
<p><code>checked{item[22]}</code> would have the effect of making sequences behave more like arrays, with bound checking; conversely <code>unchecked{item?22}</code> would return an empty sequence instead of throwing an error.</p>
</blockquote>
</div></details></div>
<div class="toot" id="created-708"><h2>Issue #708 created<span class="toot-id"> #created-708</span></h2><div class="pubdate">17 Sep at 08:56:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/708">https://github.com/qt4cg/qtspecs/issues/708</a></div><details><summary>Toward a design for generators</summary><div class="markup"><h2>Motivation</h2>
<p>The motivations for this are to explore the creation of sequences where the next item in the sequence is determined by evaluating a function on the current state of a system. These sequence generators have an initial starting value and state. They can also stop when some condition is met.</p>
<p>The motivating example here is the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-random-number-generator">fn:random-number-generator</a> function, where:</p>
<ol>
<li><code>let $rnd := fn:random-number-generator()</code> initializes a new random number sequence with the default seed as its state;</li>
<li><code>let $value := $rnd?number</code> returns the current value of the sequence;</li>
<li><code>let $rnd := $rnd?next()</code> returns the state and value of the next item in the sequence.</li>
</ol>
<p>This has all the properties needed for a forward (left-to-right) generating sequence. To make it a generalized generator sequence, the <code>number</code> field should be renamed <code>value</code>.</p>
<p>NOTE: The <code>fn:random-number-generator</code> function defines an infinite sequence as it has no termination/end of sequence condition.</p>
<h2>Sequence Generators as Record Types</h2>
<p>Therefore, a forward generator sequence could look like this:</p>
<pre><code>declare item-type sequence-generator as record(
    value as item(),
    next as function() as record(value, next, *)?,
    *
);

declare function generated-sequence() as sequence-generator?;
</code></pre>
<p>If calling <code>?next()</code> on a sequence above returns the empty sequence then there are no more values in that sequence.</p>
<p>If the <code>generated-sequence()</code> returns the empty sequence then there are no items in the sequence.</p>
<p>NOTE: This does not currently define reversible sequence support. A <code>reversed</code> property could be provided that returns a <code>sequence-generator</code> that operates on the sequence from right to left. I haven't figured out exactly how this should look, but reversed generator sequences may be better investigated as a separate issue.</p>
<p>NOTE: An implementation can process this sequence iteratively if needed.</p>
<h3>Analysis</h3>
<p>While this allows generator sequence types to be created, they are -- like <code>fn:random-number-generator()</code> cumbersome to use. This does have the advantage of being backward compatible with <code>fn:random-number-generator()</code>, though.</p>
<p>The problem comes when trying to make these work like sequences. The subtype and function coercion rules should be doable. The other sequence operations like filtering are more complicated to define properly.</p>
<p>However, this has the same issues that allowing <code>array()</code> in <code>fn:*</code> functions has -- how do you differentiate the use cases where the user is working on a sequence of generators, or the generated sequences?</p>
<blockquote>
<p>NOTE: You can't extend the functions to take a <code>(sequence-type | item()*)</code> parameter as a <code>sequence-type</code> is a subtype of <code>item()</code> which matches <code>item()*</code>. If the functions were to be extended to handle these, then <code>fn:head(fn:random-number-generator())</code> would return a number instead of a map.</p>
</blockquote>
<h2>Sequence Generator Function</h2>
<p>The Kotlin language has a <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.sequences/generate-sequence.html">generateSequence</a> function that takes a next function, an optional seed value or construction function, and returns a lazy sequence over that. -- Internally, it is building a Java iterator that produces values from calling the next function. The sequence will terminate when the next value is null.</p>
<p>I propose that -- in addition to the <code>sequence-generator</code> type above -- XPath defines the following function:</p>
<pre><code>declare function fn:sequence($generator as sequence-generator) as item()*;
</code></pre>
<p>This solves the issues in the <em>Analysis</em> section above, and is analogous to <code>array:values</code>. It is implementation defined how the sequence is constructed. -- This allows an implementer to appropriately map the generator to their internal sequence implementation in order to provide lazy evaluation and other operations.</p>
<p>There should also be the following helper function for random numbers:</p>
<pre><code>declare function fn:random-numbers(
    $seed as xs:anyAtomicType? := ()
) as xs:double* {
    fn:random-number-generator() =&gt; fn:sequence()
};
</code></pre>
<p>The user-defined sequences then become e.g.:</p>
<pre><code>let $generator as sequence-generator := map {
    value : 1,
    next : function () { () }
}
return fn:sequence($generator)
</code></pre>
</div></details></div>
<div class="toot" id="closed-299"><h2>Issue #299 closed<span class="toot-id"> #closed-299</span></h2><div class="pubdate">17 Sep at 00:02:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/299">https://github.com/qt4cg/qtspecs/issues/299</a></div><p>Short-circuiting functions, function-arity guards and lazy hints</p></div>
<div class="toot" id="created-707"><h2>Issue #707 created<span class="toot-id"> #created-707</span></h2><div class="pubdate">15 Sep at 16:59:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/707">https://github.com/qt4cg/qtspecs/issues/707</a></div><details><summary>Dynamic Function Calls: Processing Empty Sequences</summary><div class="markup"><p>A fundamental – and brilliant – property of XPath is that many operations tolerate empty sequences: Instead of throwing an error, the empty result is passed on unchanged to the next operation. While this is unrewardingly confusing for binary operations (<code>() + 1</code>, <code>() eq 5</code>), it’s wonderful for pipelines:</p>
<pre><code class="language-xquery">(: paths :)
$nodes / a / b / c
(: lookups :)
$data ? 1 ? 2 ? 3
(: simple map operators :)
$data ! do(.) ! something(.)
(: arrow operator works differently, but the syntax is similar:  :)
$data =&gt; do() =&gt; something()
</code></pre>
<p>As far as I can judge, it would be a very simple and user-friendly addition if we extended dynamic function calls to return an empty sequence (instead of raising an error) if the base expression is an empty sequence. This way, the following expressions would all run through:</p>
<pre><code class="language-xquery">let $map := map { 'giovanni': map { 'city': 'roma' } }
return $map('andrea')('city'),
let $data := ()
return $data(1)(2)(3),
()(123),
()()
</code></pre>
<p>Many people use parentheses instead of the lookup operator for accessing maps &amp; arrays, and the proposed change would make the syntax more interchangeable. I believe it would also be useful for function items in general.</p>
</div></details></div>
<div class="toot" id="created-706"><h2>Issue #706 created<span class="toot-id"> #created-706</span></h2><div class="pubdate">15 Sep at 14:45:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/706">https://github.com/qt4cg/qtspecs/issues/706</a></div><details><summary>FLWOR: for member $m1 in $a1, member $m2 in $a2</summary><div class="markup"><p>Currently, the <code>member</code> keyword must always be placed directly after the <code>for</code> clause:</p>
<pre><code class="language-xquery">(: valid :)
for $a in 1 to 10
for $m member $m in $array

(: invalid :)
for $a in 1 to 10, member $m in $array
</code></pre>
<p>In addition, the keyword applies to all other bindings in the same <code>for</code> clause:</p>
<pre><code class="language-xquery">for member $m1 in $array1, $m2 in $array2
</code></pre>
<p>My feeling is that this syntax is a bit odd, as other keywords (<code>allowing empty</code>, <code>at</code>) only refer to the currently bound variable. Next, the <code>member</code> syntax would differ from the semantics of XQuery Full Text: The <code>score</code> keyword is placed before the variable name, and can be used more than once (or omitted):</p>
<pre><code class="language-xquery">let score $s1 := $data1, score $s2 := $data2
</code></pre>
<p>I think we should change this. It would also simplify the grammar:</p>
<pre><code>InitialClause     ::=  ForClause | LetClause | WindowClause
ForClause         ::=  "for" ForBinding ("," ForBinding)*
ForBinding        ::=  (SimpleForBinding | ForMemberBinding) PositionalVar? "in" ExprSingle
SimpleForBinding  ::=  VarBinding AllowingEmpty?
ForMemberBinding  ::=  "member" VarBinding
AllowingEmpty     ::=  "allowing" "empty"
PositionalVar     ::=  "at" "$" VarName
VarBinding        ::=  "$" VarName TypeDeclaration?
</code></pre>
<p>And one more motivation for changing is that map bindings will be easier to define (see <a href="https://github.com/qt4cg/qtspecs/issues/31#issuecomment-1721400625">#31</a>).</p>
</div></details></div>
<div class="toot" id="created-705"><h2>Issue #705 created<span class="toot-id"> #created-705</span></h2><div class="pubdate">15 Sep at 07:08:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/705">https://github.com/qt4cg/qtspecs/issues/705</a></div><details><summary>Function Coercion: Function Arities</summary><div class="markup"><p>In <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-function-coercion">4.6.4 Function Coercion</a>, a rule was added to support functions with an arity lower than the expected one:</p>
<blockquote>
<p>If F has lower arity than the expected type, then F is wrapped in a new function that declares and ignores the additional argument; the following steps are then applied to this new function.</p>
</blockquote>
<p>If I got it right, this is the resulting 4.0 behavior:</p>
<p><strong>Spoiler:</strong> I probably got it wrong, see the next comment.</p>
<pre><code class="language-xquery">declare function local:function($a) { };
declare variable $function := function($a) { };

(: now legal :)
filter    (1984, true#0)
$function (1984, 'ignored')
fn { }    (1984, 'ignored')
map { }   (1984, 'ignored')
true#0    ('ignored')
sum(?, ())(1984, 'ignored')

(: still illegal :)
local:function(1984, 'ignored')

(: still legal: RHS items will be supplied one by one :)
map { }(1984, 'processed')     
</code></pre>
<p>Maybe some more examples should be added in the corresponding sections that refer to function coercion.</p>
<p>The new rule is powerful and allows for greater flexibility (see #516 and other issues), but the behavior may also be unexpected. We should probably document that:</p>
<ul>
<li>It may go unnoticed that a passed on argument will be ignored. In other words, we reduce type safety by allowing users to supply more arguments than will be processed.</li>
<li>It makes a difference whether the invoked function is static or dynamic (dynamic functions will now provide less type safety than static functions).</li>
</ul>
</div></details></div>
<div class="toot" id="created-704"><h2>Issue #704 created<span class="toot-id"> #created-704</span></h2><div class="pubdate">14 Sep at 12:26:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/704">https://github.com/qt4cg/qtspecs/issues/704</a></div><details><summary>Context Value Expression → Context Value Reference</summary><div class="markup"><p>The specification defines Variable References for accessing values bound to a variable, and we should rename the equivalent operation for accessing the context from “Context Value Expression” to “Context Value Reference” (even more so if we should decide to introduce a Context Value Declaration later on, as discussed in #755).</p>
<p>Related: https://github.com/qt4cg/qtspecs/pull/703#issuecomment-1719345430</p>
</div></details></div>
<div class="toot" id="created-703"><h2>Pull request #703 created<span class="toot-id"> #created-703</span></h2><div class="pubdate">14 Sep at 11:43:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/703">https://github.com/qt4cg/qtspecs/pull/703</a></div><details><summary>129 (1): XPath and XQuery changes for introduction of context value</summary><div class="markup"><p>Fix #129 This replaces the previous attempt from several months ago, which had too many conflicts to be salvageable.</p>
<p>This is a wide-ranging and pervasive change, and I would like the changes to be applied promptly and incrementally to reduce the risk of conflicts, even if further work is needed later. This first PR addresses the XQuery and XPath language specifications. Further changes (in subsequent PRs) are needed for F+O and for XSLT. There are also a couple of minor changes affecting Serialization (but none affecting the data model).</p>
</div></details></div>
<div class="toot" id="closed-368"><h2>Issue #368 closed<span class="toot-id"> #closed-368</span></h2><div class="pubdate">14 Sep at 11:38:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/368">https://github.com/qt4cg/qtspecs/pull/368</a></div><p>129: Context item generalized to context value</p></div>
<div class="toot" id="created-702"><h2>Pull request #702 created<span class="toot-id"> #created-702</span></h2><div class="pubdate">14 Sep at 09:29:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/702">https://github.com/qt4cg/qtspecs/pull/702</a></div><details><summary>701: fn:concat: Support for 0 or more arguments</summary><div class="markup"><p>Closes #701</p>
</div></details></div>
<div class="toot" id="created-701"><h2>Issue #701 created<span class="toot-id"> #created-701</span></h2><div class="pubdate">14 Sep at 09:08:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/701">https://github.com/qt4cg/qtspecs/issues/701</a></div><details><summary>fn:concat: Support for 0 or more arguments</summary><div class="markup"><p>With #161, we plan to introduce support for variadic functions.</p>
<p>The scope of this issue is much smaller and can be seen as a preparatory one; it’s about allowing the first two arguments of the function optional. I’ll create a little PR for it.</p>
</div></details></div>
<div class="toot" id="created-700"><h2>Issue #700 created<span class="toot-id"> #created-700</span></h2><div class="pubdate">14 Sep at 09:06:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/700">https://github.com/qt4cg/qtspecs/issues/700</a></div><details><summary>Operators for array mapping and filtering</summary><div class="markup"><p>With issue #129 generalising the context item to a context value, we have the opportunity to define context-based mapping and filtering operators for arrays that work in the same way as the <code>A!B</code> and <code>A[B]</code> operators for sequences.</p>
<p>I propose <code>A!!B</code> as a mapping operator for arrays. Unlike <code>!</code>, this does not flatten the result. The result is an array whose members correspond one-to-one with the members of <code>A</code>, each member of the result array being formed by evaluating <code>B</code> with the corresponding member of <code>A</code> as the context value.</p>
<p>For an array whose members are singletons, the expression <code>A!!B</code> has a similar effect to <code>A?*!B</code>, but (a) it is clearer, (b) it returns an array rather than a sequence, and (c) it performs no flattening. For the more general case, it can be used in place of the higher-order function call <code>A =&gt; array:for-each(fn{B})</code>.</p>
<p>I propose <code>A?[B]</code> as a filter operator for arrays. Unlike <code>A[B]</code>, this is not overloaded to perform index-based selection. The result is an array containing those members of <code>A</code> for which <code>B</code> has an effective boolean value of true, when evaluated with the corresponding member of <code>A</code> as the context value. The expression <code>$A?[B]</code> is equivalent to <code>$A =&gt; array:filter(fn{B})</code>.</p>
<p>For example, <code>$A?[exists(.)]</code> filters the array <code>$A</code> to retain only those members that are non-empty.</p>
</div></details></div>
<div class="toot" id="closed-645"><h2>Issue #645 closed<span class="toot-id"> #closed-645</span></h2><div class="pubdate">14 Sep at 08:49:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/645">https://github.com/qt4cg/qtspecs/issues/645</a></div><p>Editorial: Use `\n` instead of `\r\n` in XML documents</p></div>
<div class="toot" id="closed-697"><h2>Issue #697 closed<span class="toot-id"> #closed-697</span></h2><div class="pubdate">14 Sep at 08:49:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/697">https://github.com/qt4cg/qtspecs/pull/697</a></div><p>645: Use \n instead of \r\n in XML documents</p></div>
<div class="toot" id="created-699"><h2>Issue #699 created<span class="toot-id"> #created-699</span></h2><div class="pubdate">14 Sep at 08:44:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/699">https://github.com/qt4cg/qtspecs/issues/699</a></div><details><summary>GitHub: Signing</summary><div class="markup"><p>@ndw Sorry to keep you busy. I think we should disable the enforced signing of commits. We know the persons who send PRs, and currently we only have three persons (you, Reece, me) who sign their commits.</p>
<p>If signing is disabled, for example, also non-admins will be able to merge those PRs.</p>
</div></details></div>
<div class="toot" id="created-698"><h2>Issue #698 created<span class="toot-id"> #created-698</span></h2><div class="pubdate">14 Sep at 08:40:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/698">https://github.com/qt4cg/qtspecs/issues/698</a></div><details><summary>GitHub: Line Endings</summary><div class="markup"><p>@ndw I’ve copied your suggestion from https://github.com/qt4cg/qtspecs/issues/645#issuecomment-1657056816 to a new issue:</p>
<blockquote>
<p>we can tell git to fix the line endings in comments. I'll see about getting that setup.</p>
</blockquote>
<p>In addition, it would be great if line endings were not changed when editing files in place.</p>
<p><img src="https://github.com/qt4cg/qtspecs/assets/196589/ef3b9ccf-04a0-4c57-a696-62ed8522f824" alt="image"></p>
<p>Due to my changes in #645, all relevant files should now use Unix-style line endings, so this would be a sane default (e.g. if the modification of files leads to a mixture of \n and \r\n).</p>
</div></details></div>
<div class="toot" id="created-697"><h2>Pull request #697 created<span class="toot-id"> #created-697</span></h2><div class="pubdate">14 Sep at 08:35:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/697">https://github.com/qt4cg/qtspecs/pull/697</a></div><details><summary>645: Use \n instead of \r\n in XML documents</summary><div class="markup"><p>#645 (editorial)</p>
</div></details></div>
<div class="toot" id="created-696"><h2>Pull request #696 created<span class="toot-id"> #created-696</span></h2><div class="pubdate">13 Sep at 15:17:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/696">https://github.com/qt4cg/qtspecs/pull/696</a></div><details><summary>566: Rework query parameters on build-uri/parse-uri</summary><div class="markup"><p>Completes action QT4CG-042-02.</p>
<ol>
<li>Rework the query segments so that they're a simple map of key/value pairs.</li>
<li>Rename <code>query-segments</code> to <code>query-parameters</code>.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-692"><h2>Issue #692 closed<span class="toot-id"> #closed-692</span></h2><div class="pubdate">13 Sep at 14:30:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/692">https://github.com/qt4cg/qtspecs/pull/692</a></div><p>Use sequences instead of arrays in fn:parse-uri output</p></div>
<div class="toot" id="created-695"><h2>Issue #695 created<span class="toot-id"> #created-695</span></h2><div class="pubdate">12 Sep at 22:08:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/695">https://github.com/qt4cg/qtspecs/issues/695</a></div><details><summary>Step in RangeExpression</summary><div class="markup"><p>In the XPath specs, it seems that a simple modification from...</p>
<p>[34] | RangeExpr | ::= | AdditiveExpr&nbsp;( "to"&nbsp;AdditiveExpr&nbsp;)?
-- | -- | -- | --</p>
<p>...to...</p>
<p>[34] | RangeExpr | ::= | AdditiveExpr&nbsp;( "to"&nbsp;AdditiveExpr ("step" AdditiveExpr)?&nbsp;)?
-- | -- | -- | --</p>
<p>...would be nonintrusive, and bring some nice benefits customary in other PLs, allowing expressions such as <code>1 to 9 step 2</code> and <code>100 to -100 step -4</code>.</p>
<p>Thoughts?</p>
</div></details></div>
<div class="toot" id="created-694"><h2>Pull request #694 created<span class="toot-id"> #created-694</span></h2><div class="pubdate">12 Sep at 21:57:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/694">https://github.com/qt4cg/qtspecs/pull/694</a></div><details><summary>XQFO minor edits, with new examples and notes, 2 through 4.6</summary><div class="markup"><p>Minor edits here are motivated by clarity or localized consistency. In one case, the change of <code>0</code> to <code>0</code> to <code>0</code> to <code>9</code> appears to address an important typo.</p>
<p>I have introduced select examples, to illustrate points in the corresponding rules.</p>
<p>The notes I have introduced need some context. Option 9 for the primary format token is somewhat vague, and the attached note of clarification stokes the imagination. I have trimmed that note for clarity (without substantive changes) but introduced a set of notes later, to help caution developers on unexpected behaviors with option 9, and secondarily to caution processor implementers on the challenges inherent in supporting this option. If  I had my druthers, I would advocate deprecating option 9. It is--to use a technical term--squishy.</p>
<p>Spec editors: I am happy to pull back on any of this.</p>
</div></details></div>
<div class="toot" id="minutes-09-12"><h2>QT4 CG meeting 045 draft minutes<span class="toot-id"> #minutes-09-12</span></h2><div class="pubdate">12 Sep at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/09-12">https://qt4cg.org/meeting/minutes/2023/09-12</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-160"><h2>Issue #160 closed<span class="toot-id"> #closed-160</span></h2><div class="pubdate">12 Sep at 16:13:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/160">https://github.com/qt4cg/qtspecs/issues/160</a></div><p>Support named arguments on dynamic function calls</p></div>
<div class="toot" id="closed-672"><h2>Issue #672 closed<span class="toot-id"> #closed-672</span></h2><div class="pubdate">12 Sep at 16:12:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/672">https://github.com/qt4cg/qtspecs/pull/672</a></div><p>XFO minor edits, chap. 1</p></div>
<div class="toot" id="closed-671"><h2>Issue #671 closed<span class="toot-id"> #closed-671</span></h2><div class="pubdate">12 Sep at 16:12:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/671">https://github.com/qt4cg/qtspecs/issues/671</a></div><p>Switch expression without operand (analogous to XSLT choose)</p></div>
<div class="toot" id="closed-678"><h2>Issue #678 closed<span class="toot-id"> #closed-678</span></h2><div class="pubdate">12 Sep at 16:12:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/678">https://github.com/qt4cg/qtspecs/pull/678</a></div><p>671 switch sans operand</p></div>
<div class="toot" id="closed-669"><h2>Issue #669 closed<span class="toot-id"> #closed-669</span></h2><div class="pubdate">12 Sep at 16:12:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/669">https://github.com/qt4cg/qtspecs/issues/669</a></div><p>Typo in XSLT §26.4 - "appearing appearing"</p></div>
<div class="toot" id="closed-679"><h2>Issue #679 closed<span class="toot-id"> #closed-679</span></h2><div class="pubdate">12 Sep at 16:12:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/679">https://github.com/qt4cg/qtspecs/pull/679</a></div><p>669 - fix typo "appearing appearing"</p></div>
<div class="toot" id="closed-665"><h2>Issue #665 closed<span class="toot-id"> #closed-665</span></h2><div class="pubdate">12 Sep at 16:11:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/665">https://github.com/qt4cg/qtspecs/issues/665</a></div><p>Typo in fn:items-before and fn:items-ending-where</p></div>
<div class="toot" id="closed-681"><h2>Issue #681 closed<span class="toot-id"> #closed-681</span></h2><div class="pubdate">12 Sep at 16:11:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/681">https://github.com/qt4cg/qtspecs/pull/681</a></div><p>665: Fix typos in fn:items-XX functions</p></div>
<div class="toot" id="closed-637"><h2>Issue #637 closed<span class="toot-id"> #closed-637</span></h2><div class="pubdate">12 Sep at 16:11:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/637">https://github.com/qt4cg/qtspecs/issues/637</a></div><p>Annotation Values: Booleans</p></div>
<div class="toot" id="closed-682"><h2>Issue #682 closed<span class="toot-id"> #closed-682</span></h2><div class="pubdate">12 Sep at 16:11:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/682">https://github.com/qt4cg/qtspecs/pull/682</a></div><p>637: allow true() and false() as function annotation values</p></div>
<div class="toot" id="closed-90"><h2>Issue #90 closed<span class="toot-id"> #closed-90</span></h2><div class="pubdate">12 Sep at 16:11:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/90">https://github.com/qt4cg/qtspecs/issues/90</a></div><p>Simplified simplified stylesheets</p></div>
<div class="toot" id="closed-599"><h2>Issue #599 closed<span class="toot-id"> #closed-599</span></h2><div class="pubdate">12 Sep at 16:11:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/599">https://github.com/qt4cg/qtspecs/pull/599</a></div><p>90: Simplified stylesheets with no xsl:version</p></div>
<div class="toot" id="closed-93"><h2>Issue #93 closed<span class="toot-id"> #closed-93</span></h2><div class="pubdate">12 Sep at 16:10:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/93">https://github.com/qt4cg/qtspecs/issues/93</a></div><p>Support order by ascending/descending from a string value.</p></div>
<div class="toot" id="closed-623"><h2>Issue #623 closed<span class="toot-id"> #closed-623</span></h2><div class="pubdate">12 Sep at 16:10:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/623">https://github.com/qt4cg/qtspecs/pull/623</a></div><p>93: sort descending</p></div>
<div class="toot" id="closed-600"><h2>Issue #600 closed<span class="toot-id"> #closed-600</span></h2><div class="pubdate">12 Sep at 16:10:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/600">https://github.com/qt4cg/qtspecs/issues/600</a></div><p>fn:decode-from-uri: counterpart of fn-encode-to-uri</p></div>
<div class="toot" id="closed-631"><h2>Issue #631 closed<span class="toot-id"> #closed-631</span></h2><div class="pubdate">12 Sep at 16:10:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/631">https://github.com/qt4cg/qtspecs/pull/631</a></div><p>600: fn:decode-from-uri</p></div>
<div class="toot" id="created-693"><h2>Issue #693 created<span class="toot-id"> #created-693</span></h2><div class="pubdate">12 Sep at 14:30:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/693">https://github.com/qt4cg/qtspecs/issues/693</a></div><details><summary>QT4 Tests without counterpart in the specs</summary><div class="markup"><p>The following functions are not defined in the current spec:</p>
<ul>
<li><code>fn:unparcel</code>, <code>fn:parcel</code> → dropped</li>
<li><code>fn:xdm-to-json</code> → #576</li>
<li><code>fn:concat()</code> → see #701</li>
<li><code>fn:parts</code> → see #463</li>
<li><code>codepoints-to-string()</code>, etc. (sequence-values arguments)</li>
</ul>
</div></details></div>
<div class="toot" id="created-692"><h2>Pull request #692 created<span class="toot-id"> #created-692</span></h2><div class="pubdate">12 Sep at 14:21:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/692">https://github.com/qt4cg/qtspecs/pull/692</a></div><details><summary>Use sequences instead of arrays in fn:parse-uri output</summary><div class="markup"><p>Completes action QT4CG-042-01 on NW.</p>
<p>There is a corresponding PR against the test suite.</p>
</div></details></div>
<div class="toot" id="agenda-09-12"><h2>QT4 CG meeting 045 draft agenda<span class="toot-id"> #agenda-09-12</span></h2><div class="pubdate">11 Sep at 11:15:05 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/09-12">https://qt4cg.org/meeting/agenda/2023/09-12</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-691"><h2>Pull request #691 created<span class="toot-id"> #created-691</span></h2><div class="pubdate">08 Sep at 19:40:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/691">https://github.com/qt4cg/qtspecs/pull/691</a></div><details><summary>688 Semantics of local union types, enumeration types, etc</summary><div class="markup"><p>Fix #688.</p>
<p>This PR fleshes out the detailed semantics of local union types, enumeration types, and type aliases. It fills a number of gaps in the current specification but doesn't aim to change the overall intent.</p>
</div></details></div>
<div class="toot" id="created-690"><h2>Pull request #690 created<span class="toot-id"> #created-690</span></h2><div class="pubdate">08 Sep at 11:29:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/690">https://github.com/qt4cg/qtspecs/pull/690</a></div><details><summary>687 Clarify constructor functions for user-defined types</summary><div class="markup"><p>Clarifies the rules for constructor functions, especially for list and union types, and for types defined by means of type aliases rather than in an imported schema. Fix #687.</p>
</div></details></div>
<div class="toot" id="created-689"><h2>Issue #689 created<span class="toot-id"> #created-689</span></h2><div class="pubdate">08 Sep at 08:36:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/689">https://github.com/qt4cg/qtspecs/issues/689</a></div><details><summary>fn:stack-trace: keep, drop, replace with $err:stack-trace ?</summary><div class="markup"><p>The current specification contains a diagnostic function called <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-stack-trace"><code>fn:stack-trace</code></a>. Many other languages provide a similar function: The returned output can possibly help to understand which function calls led to an error during the evaluation of a code.</p>
<p>Still, I have strong doubts that it is a good decision to include this function in the standard:</p>
<p>The specification gives you a vast amount of freedom how to implement and optimize things. As a result, it’s completely feasible and reasonable to rewrite the following code…</p>
<pre><code class="language-xquery">declare function local:double($f) {
  $f * 2
};
(1 to 6) ! local:double(.)
</code></pre>
<p>…to <code>(1 to 6) ! (. * 2)</code> at compile time. If a user adds a <code>fn:stack-overflow</code> call in the function body, s·he would expect to find the function invocation of the original code representation in the output. As always, there are technical solutions to achieve this (store additional information in the evaluation tree on the original query; suppress optimizations when <code>fn:stack-trace</code> is found), but all of them can affect the runtime behavior and lead to different evaluation trees, hiding possible bugs in the implementation (which can be a reason to call <code>fn:stack-trace</code> at all).</p>
<p>A standard should provide a minimum amount of assurance that a function behaves similarly across different implementations. At this time, I don’t believe we can’t give that guarantee.</p>
<p>Related: #55, #686</p>
<p>– As an alternative, a stack trace could optionally be created by an implementation when an error is triggered.</p>
</div></details></div>
<div class="toot" id="created-688"><h2>Issue #688 created<span class="toot-id"> #created-688</span></h2><div class="pubdate">07 Sep at 17:33:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/688">https://github.com/qt4cg/qtspecs/issues/688</a></div><details><summary>Coercion rules for union types and enumeration types</summary><div class="markup"><p>The coercion rules for enumeration types have not been defined (there is a TODO in the spec).</p>
<p>For union types (including both schema-defined and locally-defined union types), the rules appear to need some further work. Given types <code>R1</code> and <code>R2</code> that are defined by restriction from <code>B1</code> and <code>B2</code>, if an atomic value <code>V</code> is an instance of <code>B1</code> that conforms to the rules of <code>R1</code>, then the relabelling coercion means it V will now be acceptable where the required type is <code>R1</code>. But if the required type is <code>union(R1, R2)</code>, the relabelling coercion is not invoked. This feels inconsistent, since <code>union(R1, R2)</code> might be expected to accept anything that <code>R1</code> accepts.</p>
<p>Test case FunctionCall-056 (currently failing) illlustrates the problem.</p>
</div></details></div>
<div class="toot" id="created-687"><h2>Issue #687 created<span class="toot-id"> #created-687</span></h2><div class="pubdate">07 Sep at 15:21:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/687">https://github.com/qt4cg/qtspecs/issues/687</a></div><details><summary>Constructor functions for user-defined types</summary><div class="markup"><p>This is a deficiency in the 3.1 F+O specification.</p>
<p>Constructor functions for user-defined types are very poorly described:</p>
<ol>
<li>
<p>It's unclear how anonymous types are handled. The spec says there is a constructor function for every simple type in the static context. That would include anonymous types. But constructor functions for anonymous types, if they exist, are essentially useless, because their names are not known.</p>
</li>
<li>
<p>The semantics of constructor functions for user-defined list and union types are described very vaguely, by analogy with built-in types; and the analogy points to the section on built-in atomic types which doesn't cover union and list types.</p>
</li>
<li>
<p>For a union type <code>U</code>, it says that the return type of the constructor U(x) is defined as <code>xs:anyAtomicType</code>. Why not define it as <code>U</code>? Perhaps this predates the ability to use union types as return types.</p>
</li>
</ol>
</div></details></div>
<div class="toot" id="created-686"><h2>Issue #686 created<span class="toot-id"> #created-686</span></h2><div class="pubdate">06 Sep at 21:28:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/686">https://github.com/qt4cg/qtspecs/issues/686</a></div><details><summary>XQFO presentation of diagnostic functions</summary><div class="markup"><p>From an informal discussion on Slack, I feel that clarity is needed in the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#diagnostics">Diagnostic tracing</a> section. The problem is that <code>fn:trace()</code> and <code>fn:log()</code> introduce the terms "trace output" with no definition or explanation, and this is easily confused with the primary output defined by the function signatures, and affects how readers think about the determinism of the functions. "The serialization of the trace output..." implies that the processor will necessarily serialize something, but I doubt that can or should be presumed. More needs to be said about the responsibilities of the processor in the contract for these functions.</p>
<p>In my opinion, this section would benefit from a brief preamble, providing context to set the stage for the rules. Some draft text for us to discuss:</p>
<blockquote>
<p>Diagnostic tracing functions provide a transfer of information, either from the processor to the dynamic context, or vice versa.</p>
<p>The function that transfers information from the processor to the dynamic context, <code>fn:stack-trace()</code>, returns a string that can be further processed and used in the XPath expression and elsewhere in a host language.</p>
<p>The functions that transfer information from the dynamic context to the processor, <code>fn:trace()</code> and <code>fn:log()</code>, each have two effects. The first effect, the output, pertains to the returned values, defined by the function signature and essential to the XPath expression. Such output is always deterministic. The second effect, processor behavior, concerns the way the processor handles the values bound to the parameters, supplied for diagnostic tracing. Processor behavior is always directed toward the user or environment that invoked the processor. Actions may include sending messages, serializing the values and writing them to a log file or database, or something else. Unlike the output (the first effect), the results of processor behavior are implementation-defined and nondeterministic with respect to order of the parameter values.</p>
</blockquote>
<p>The draft above attempts to avoid "output" to describe the processor-side diagnostics, so as to avoid potential confusion when dealing with the return-type defined in the signature. Where "trace output" appears in each of the rules, "processor behavior" can be used instead.</p>
<p>Questions:</p>
<ul>
<li>Any objections, corrections, or suggestions?</li>
<li>Any other examples of how a processor might use trace diagnostics?</li>
<li>Should a paragraph be added to explain briefly how <code>trace()</code> and <code>log()</code> differ from <code>xsl:message</code>? (E.g., a serialized tree should not be presumed.)</li>
<li>In the informal Balisage birds-of-a-feather discussion this summer, reservations were expressed by participants about the name <code>log()</code>. Is it possible to drop the function and simply extend the arity of <code>trace()</code> with a parameter <code>$return-input as xs:boolean? := true()</code>?</li>
</ul>
</div></details></div>
<div class="toot" id="closed-685"><h2>Issue #685 closed<span class="toot-id"> #closed-685</span></h2><div class="pubdate">06 Sep at 09:59:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/685">https://github.com/qt4cg/qtspecs/pull/685</a></div><p>Style fixes</p></div>
<div class="toot" id="created-685"><h2>Pull request #685 created<span class="toot-id"> #created-685</span></h2><div class="pubdate">06 Sep at 09:49:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/685">https://github.com/qt4cg/qtspecs/pull/685</a></div><details><summary>Style fixes</summary><div class="markup"><ol>
<li>Put the XSLT processor version comment at the end of the file instead of the beginning. Putting it before the <code>&lt;!DOCTYPE html&gt;</code> forces browsers into quirks mode.</li>
<li>Improve the XPath Functions stylesheets so that they don't put <code>div</code> elements inside <code>p</code> elements when outputting examples.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-684"><h2>Issue #684 closed<span class="toot-id"> #closed-684</span></h2><div class="pubdate">06 Sep at 09:17:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/684">https://github.com/qt4cg/qtspecs/pull/684</a></div><p>Ignore this PR</p></div>
<div class="toot" id="closed-683"><h2>Issue #683 closed<span class="toot-id"> #closed-683</span></h2><div class="pubdate">06 Sep at 09:14:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/683">https://github.com/qt4cg/qtspecs/pull/683</a></div><p>XQFO context/focus in/dependent functions clarification note</p></div>
<div class="toot" id="created-684"><h2>Pull request #684 created<span class="toot-id"> #created-684</span></h2><div class="pubdate">06 Sep at 08:37:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/684">https://github.com/qt4cg/qtspecs/pull/684</a></div><details><summary>Ignore this PR</summary><div class="markup"><p>This is just norm hacking about</p>
</div></details></div>
<div class="toot" id="created-683"><h2>Pull request #683 created<span class="toot-id"> #created-683</span></h2><div class="pubdate">06 Sep at 02:16:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/683">https://github.com/qt4cg/qtspecs/pull/683</a></div><details><summary>XQFO context/focus in/dependent functions clarification note</summary><div class="markup"><p>Added note clarifying the relationship between context and focus, for the purpose of illustrating the relationships between focus/context in/dependent functions. Wrapped with companion <code>&lt;note&gt;</code>s in a parent <code>&lt;notes&gt;</code>.</p>
</div></details></div>
<div class="toot" id="created-682"><h2>Pull request #682 created<span class="toot-id"> #created-682</span></h2><div class="pubdate">05 Sep at 20:12:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/682">https://github.com/qt4cg/qtspecs/pull/682</a></div><details><summary>637: allow true() and false() as function annotation values</summary><div class="markup"><p>Fix #637</p>
</div></details></div>
<div class="toot" id="closed-658"><h2>Issue #658 closed<span class="toot-id"> #closed-658</span></h2><div class="pubdate">05 Sep at 19:34:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/658">https://github.com/qt4cg/qtspecs/issues/658</a></div><p>Constructor Function: Parameter Name, Zero-Arity</p></div>
<div class="toot" id="created-681"><h2>Pull request #681 created<span class="toot-id"> #created-681</span></h2><div class="pubdate">05 Sep at 19:30:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/681">https://github.com/qt4cg/qtspecs/pull/681</a></div><details><summary>665: Fix typos in fn:items-XX functions</summary><div class="markup"><p>Fix #665</p>
</div></details></div>
<div class="toot" id="created-680"><h2>Pull request #680 created<span class="toot-id"> #created-680</span></h2><div class="pubdate">05 Sep at 17:52:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/680">https://github.com/qt4cg/qtspecs/pull/680</a></div><details><summary>668 define case insensitive collation normatively</summary><div class="markup"><p>Fix #668</p>
</div></details></div>
<div class="toot" id="minutes-09-05"><h2>QT4 CG meeting 044 draft minutes<span class="toot-id"> #minutes-09-05</span></h2><div class="pubdate">05 Sep at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/09-05">https://qt4cg.org/meeting/minutes/2023/09-05</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-679"><h2>Pull request #679 created<span class="toot-id"> #created-679</span></h2><div class="pubdate">05 Sep at 16:53:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/679">https://github.com/qt4cg/qtspecs/pull/679</a></div><details><summary>669 - fix typo "appearing appearing"</summary><div class="markup"><p>Fix #669</p>
</div></details></div>
<div class="toot" id="created-678"><h2>Pull request #678 created<span class="toot-id"> #created-678</span></h2><div class="pubdate">05 Sep at 16:43:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/678">https://github.com/qt4cg/qtspecs/pull/678</a></div><details><summary>671 switch sans operand</summary><div class="markup"><p>Fix #671</p>
</div></details></div>
<div class="toot" id="closed-619"><h2>Issue #619 closed<span class="toot-id"> #closed-619</span></h2><div class="pubdate">05 Sep at 16:04:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/619">https://github.com/qt4cg/qtspecs/pull/619</a></div><p>XDM ch. 6 minor edits</p></div>
<div class="toot" id="closed-633"><h2>Issue #633 closed<span class="toot-id"> #closed-633</span></h2><div class="pubdate">05 Sep at 16:04:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/633">https://github.com/qt4cg/qtspecs/pull/633</a></div><p>Edits ch. 4.1 through 4.15</p></div>
<div class="toot" id="closed-601"><h2>Issue #601 closed<span class="toot-id"> #closed-601</span></h2><div class="pubdate">05 Sep at 15:15:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/601">https://github.com/qt4cg/qtspecs/issues/601</a></div><p>fn:all → fn:every?</p></div>
<div class="toot" id="closed-640"><h2>Issue #640 closed<span class="toot-id"> #closed-640</span></h2><div class="pubdate">05 Sep at 15:15:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/640">https://github.com/qt4cg/qtspecs/pull/640</a></div><p>601: fn:all → fn:every?</p></div>
<div class="toot" id="created-675"><h2>Issue #675 created<span class="toot-id"> #created-675</span></h2><div class="pubdate">05 Sep at 14:55:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/675">https://github.com/qt4cg/qtspecs/issues/675</a></div><details><summary>XSLT streaming rules for new constructs</summary><div class="markup"><p>The XSLT spec has rules for the streamability of all system functions and XPath language constructs. These need updating for new 4.0 constructs.</p>
</div></details></div>
<div class="toot" id="closed-664"><h2>Issue #664 closed<span class="toot-id"> #closed-664</span></h2><div class="pubdate">05 Sep at 14:08:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/664">https://github.com/qt4cg/qtspecs/pull/664</a></div><p>663 xsl:original keywords</p></div>
<div class="toot" id="created-674"><h2>Pull request #674 created<span class="toot-id"> #created-674</span></h2><div class="pubdate">05 Sep at 14:07:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/674">https://github.com/qt4cg/qtspecs/pull/674</a></div><details><summary>663: Describe how calls to xsl:original with keywords work</summary><div class="markup"><p>Rework PR 664 (fix for 663) on new baseline</p>
<p>Fix #663.</p>
</div></details></div>
<div class="toot" id="created-673"><h2>Pull request #673 created<span class="toot-id"> #created-673</span></h2><div class="pubdate">05 Sep at 13:53:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/673">https://github.com/qt4cg/qtspecs/pull/673</a></div><details><summary>HTML namespace changes</summary><div class="markup"><p>This PR applies my action items for updating the HTML XDM mapping around namespaces and local names.</p>
<p>Note: this currently makes <code>dm:namespace-nodes</code> return an empty sequence. I'm not currently sure what the best approach is here.</p>
</div></details></div>
<div class="toot" id="created-672"><h2>Pull request #672 created<span class="toot-id"> #created-672</span></h2><div class="pubdate">04 Sep at 20:05:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/672">https://github.com/qt4cg/qtspecs/pull/672</a></div><details><summary>XFO minor edits, chap. 1</summary><div class="markup"><p>Most substantive change is the trimming of prose held over from before the revision of the diagrams.</p>
</div></details></div>
<div class="toot" id="created-671"><h2>Issue #671 created<span class="toot-id"> #created-671</span></h2><div class="pubdate">02 Sep at 19:37:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/671">https://github.com/qt4cg/qtspecs/issues/671</a></div><details><summary>Switch expression without operand (analogous to XSLT choose)</summary><div class="markup"><p>By syntax analogy with <code>switch</code>,</p>
<pre><code>choose
   test ($a &lt; $b) return "lesser"
   test ($a &gt; $b) return "greater"
   test ($a eq $b) return "equal"
   default return "Getting the default is hard to explain"
</code></pre>
<p>Something like</p>
<pre><code>ChooseExpr ::= "choose" ChooseTestClause+ "default" "return"&nbsp;ExprSingle
ChooseTestClause ::= "test"&nbsp;"(" Expr ")" "return"&nbsp;ExprSingle
</code></pre>
<p>I know I can do this by stringing if-then-else together, but would greatly appreciate the cleaner and more manageable syntax for those times when many tests are inescapable.</p>
</div></details></div>
<div class="toot" id="created-670"><h2>Issue #670 created<span class="toot-id"> #created-670</span></h2><div class="pubdate">02 Sep at 05:45:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/670">https://github.com/qt4cg/qtspecs/issues/670</a></div><details><summary>The trouble with XPath‘s fn:fold-right. A fix and Proposal for fn:fold-lazy</summary><div class="markup"><h1><strong>The trouble with XPath‘s fn:fold-right.</strong><br><strong>Laziness in XPath.</strong></h1>
<p><em>This article discusses the standard XPath 3.1 function <strong>fn:fold-right,</strong> its definition in the official Spec, its lack of apparent use-cases and its utter failure to reproduce the (lazy) behavior of Haskell’s <strong>foldr</strong> , which is presumed to be the motivation behind <strong>fn:fold-right</strong>.</em><br>
<em>The 2nd part of the article introduces the implementation of short-circuiting and generators, which together unprecedentedly provide laziness in XPath. Based on these, a new XPath function: <strong>fn:fold-lazy</strong>    is implemented, that utilizes laziness, similar to Haskell’s <strong>foldr</strong>. This behavior is demonstrated in specific examples</em></p>
<h2><strong>Introduction</strong></h2>
<p>Higher order functions were introduced into XPath starting with <a href="https://www.w3.org/TR/xpath-functions-30/#basic-hofs">version 3.0</a> in 2014 and later in <a href="https://www.w3.org/TR/xpath-functions-31/#higher-order-functions">version 3.1</a> in 2017.<br>
The definition of the standard function <a href="https://www.w3.org/TR/xpath-functions-31/#func-fold-right">fn:fold-right</a> closely mimics that of Haskell’s <a href="https://hackage.haskell.org/package/base-4.18.0.0/docs/Prelude.html#g:11">foldr</a>, and anyone acquainted with <strong>foldr</strong> can be left with the impression that <strong>fn:fold-right</strong> would have identical behavior (and hence use-cases) as Haskell’s <strong>foldr</strong>.</p>
<p>Unfortunately, there is a critical difference between the definitions of these two functions. Whereas the definition of <strong>foldr</strong> explicitly defines its behavior when provided with a function, lazy in its 1st argument – from <a href="https://hackage.haskell.org/package/base-4.18.0.0/docs/Prelude.html#g:11">Haskell’s definition of
foldr</a>:</p>
<p>“… <em>Note that since the head of the resulting expression is produced by an application of the operator to the first element of the list, given an operator lazy in its right argument,&nbsp;foldr&nbsp;can produce a terminating expression from an unbounded list.”</em></p>
<p>The XPath definition of <a href="https://www.w3.org/TR/xpath-functions-31/#func-fold-right">fn:fold-right</a> does not mention any laziness.</p>
<p>There is no official concept of “laziness” in XPath, thus <strong>fn:fold-right</strong> doesn’t cover some of the most important use-cases of Haskell’s <strong>foldr</strong> , which can successfully produce a result when passed an infinite (or having unlimited length) list.</p>
<p>This in fact makes <strong>fn:fold-right</strong> almost useless, and explains why even some  of the members of the XPath 3.1 WG have stated on occasions that they do not see why the function was introduced.</p>
<h2><strong>fn:fold-right gone wrong – example</strong></h2>
<p>This Haskell code:</p>
<pre><code class="language-hs">foldr (\x y -&gt; (if x == 0 then 0 else x*y)) 1 (map (\x -&gt; x - 15) [1 ..1000000])

foldr (\x y -&gt; (if x == 0 then 0 else x*y)) 1 (map (\x -&gt; x - 15) [1 ..10000000])

foldr (\x y -&gt; (if x == 0 then 0 else x*y)) 1 (map (\x -&gt; x - 15) [1 ..])
</code></pre>
<p>produces the product of all numbers in the following list, respectively:</p>
<p>[-14, -13, -12, -11, -10, -9, -8, -7, -6, -5, -4, -3, -2, -1, <strong>0</strong>, 1, 2, 3, …, 999985]</p>
<p>[-14, -13, -12, -11, -10, -9, -8, -7, -6, -5, -4, -3, -2, -1, <strong>0</strong>, 1, 2, 3, …, 9999985]</p>
<p>[-14, -13, -12, -11, -10, -9, -8, -7, -6, -5, -4, -3, -2, -1, <strong>0</strong>, 1, 2, 3, …, ] -- up to infinity.</p>
<p>Because all these <code>3</code> lists contain a zero as their 15th item, the expected result is <strong><code>0</code></strong> when evaluating any of these <code>3</code> expressions – even in the last case where the provided as argument list is infinite. And this is indeed what happens:</p>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/4e7cbbc7-543f-433a-bdb6-e25aa59d1172" alt="image"></p>
<p>Not only Haskell produces the correct result in all cases, but <em>regardless of the list’s length, the result is produced instantaneously</em>!</p>
<p>Now, let us evaluate this equivalent XPath expression with BaseX:</p>
<pre><code class="language-xq">let $product := function($input as array(xs:integer)) as xs:integer
                         { 
                           array:fold-right($input, 1, function($x as xs:integer, $y as xs:integer) as  xs:integer 
                                                               {if($x eq 0) then 0 else $x * $y}) 
                         },
    $ar := array { (1 to 36) ! function($x as xs:integer) as xs:integer {$x -15}(.)}
  return
     $product($ar)

</code></pre>
<p>Here we are passing a list containing just 36 integers. The result is quite unexpected and spectacular:</p>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/83a86918-deb3-4f4a-9b2f-38bab85d863f" alt="image"></p>
<p>Here is what happens:</p>
<ol>
<li>
<p>Even though when processing the 15th integer in the array the result is 0, the XPath processor continues to evaluate the RHS (right-hand side) until the last member of the array (<code>36</code>).</p>
</li>
<li>
<p>On “its way back” the XPath processor multiplies: <code>(36*35*34*33*32* …*6*5*4)*3</code>, and the result of the right-most multiplication is bigger than the maximum integer (or decimal) that this XPath processor supports.</p>
</li>
<li>
<p><strong>C r r r a s s h</strong> … As seen in the screenshot above.</p>
</li>
</ol>
<p>The root cause for this unfortunate behavior is that the XPath processor doesn’t support short-circuiting and laziness. And thus, <strong>fn:fold-right</strong> is useless even in the normal/trivial case of a collection (array) with only 36 members. Not to speak of collections containing millions of members, or even infinite ones…</p>
<p>Let us see what happens when evaluating similar expressions with another XPath processor: Saxon.</p>
<p>Saxon seems to produce the correct result, however it takes exponentially longer times when the length of the passed array is increased, leading to this one:</p>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/e0b9e34e-b58e-4100-a22a-48581be84072" alt="image"></p>
<p>It took 261 seconds for the evaluation to be done, but accessing the <code>15</code>th member of the array and short-circuiting to <code>0</code> should be almost instantaneous…<br>
So what happens in this case? The difference between BaseX and Saxon is that Saxon implements a “Big Integer” and thus can multiply almost <code>1 000 000</code> integers without getting a value that cannot be handled… But doing almost <code>1</code>M multiplications of big integers obviously takes time …</p>
<p>What is common in these two examples? Obviously, neither BaseX nor Saxon detects and performs short-circuiting. Why is this? What is the reason for this?</p>
<p>I asked a developer of BaseX if I could submit a bug about this behavior. His answer was shockingly unexpected: “<em>This is not a bug, because no requirement in the Specification has been violated</em>”.</p>
<p>Thus, the main cause of the common behavior of both XPath processors to handle the evaluation of these examples, is the specification of the function, which blatantly allows such crap to happen.</p>
<p>Now that we see this, let us try to provide the wanted, useful behavior writing our own function.</p>
<h2><strong>The fix: Step 1 – fn:fold-right in pure XPath</strong></h2>
<p>Before going in depth with our pure XPath solution, we need as a base a pure-XPath implementation of <strong>fn:fold-right</strong> .</p>
<pre><code class="language-xq"> let $fold-right-inner := function ($seq as item()*,
                                    $zero as item()*,
                                    $f as function(item(), item()*) as item()* ,
                                    $self as function(*)
                                   ) as item()*
{
  if(empty($seq)) then $zero
    else
      $f(head($seq), $self(tail($seq), $zero, $f, $self))
},

    $fold-right := function ($seq as item()*,
                             $zero as item()*,
                             $f as function(item(), item()*) as item()* 
                            ) as item()*
{
  $fold-right-inner($seq, $zero, $f, $fold-right-inner)
},
               
   $fAdd := function($x, $y)  {$x + $y},
   $fMult  := function($x, $y)  {$x * $y}
   
   return
     $fold-right((1 to 6) ! function($x){$x - 3}(.), 1, $fMult)
</code></pre>
<p>When we evaluate the above with any of the two XPath processors, the correct result is produced:</p>
<p>720</p>
<p>And we certainly do have exactly the same problems as the provided built-in <strong>fn:fold-right</strong> with a similar example:</p>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/b65e72b1-a5a6-4f73-b485-c316a05f3cc4" alt="image"></p>
<h2><strong>The fix: Step 2 – <code>$fold-right-sc</code> detecting and performing short-circuiting</strong></h2>
<p>Now that we have <strong><code>$fold-right</code></strong> as a base, let us add code to it so that it  will detect and perform short-circuiting. We will implement a function similar to <strong><code>$fold-right</code></strong> but having this signature:</p>
<pre><code class="language-xq">    $fold-right-sc := function ($seq as item()*,
                                $zero as item()*,
                                $f as function(item(), item()*) as item()*,
                                $fGetPartial as function(*)
                               ) as item()*
</code></pre>
<p>The last of the function’s parameters <code>$fGetPartial</code> returns a new function that is the partial application of <code>$f</code>, when its 1st argument is set to the current member of the input sequence <code>$seq</code>. The idea is that whenever short-circuiting is possible, <code>$fGetPartial</code> returns not a function having one argument (arity <code>1</code>), but a constant – a function with <code>0</code> arguments (arity <code>0</code>).</p>
<p>If the arity of the so produced partial application is <code>0</code>, then our code will immediately return with the value <code>$f($currentItem)</code>.</p>
<p>Here is the complete code of <code>$fold-right-sc</code>:</p>
<pre><code class="language-xq"> let $fold-right-sc-inner := function ($seq as item()*,
                                       $zero as item()*,
                                       $f as function(item(), item()*) as item()*,
                                       $fGetPartial as function(*),
                                       $self as function(*)
                                      ) as item()*
{
  if(empty($seq)) then $zero
    else
      if(function-arity($fGetPartial(head($seq), $zero)) eq 0)
        then $fGetPartial(head($seq), $zero) ()
        else $f(head($seq), $self(tail($seq), $zero, $f, $fGetPartial, $self))
},

    $fold-right-sc := function ($seq as item()*,
                                $zero as item()*,
                                $f as function(item(), item()*) as item()*,
                                $fGetPartial as function(*)
                               ) as item()*
{
  $fold-right-sc-inner($seq, $zero, $f, $fGetPartial, $fold-right-sc-inner)
},
               
   $fAdd := function($x, $y)  {$x + $y},
   $fMult  := function($x, $y)  {if($x eq 0) then 0 else $x * $y},
   $fMultGetPartial := function($x, $y)
   {
     if($x eq 0)
       then function() {0}
       else function($z) {$x * $z}
   }
   
   return
     $fold-right-sc((1 to 1000000) ! function($x){$x - 3}(.), 1, $fMult, $fMultGetPartial)

</code></pre>
<p><strong>Do note</strong>:</p>
<ol>
<li>
<p>If the current item (the head of the sequence) is <code>0</code>, then <code>$fMultGetPartial</code> returns a function with <code>0</code> arguments (constant) that produces <code>0</code>.</p>
</li>
<li>
<p><code>$fold-right-sc</code> (inner) treats differently a partial application of arity <code>0</code> from a partial application with arity <code>1</code>. In the former case it simply produces the expected constant value without recursing further. Here is the relevant code fragment</p>
</li>
</ol>
<pre><code class="language-xq">  if(empty($seq)) then $zero
    else
      if(function-arity($fGetPartial(head($seq), $zero)) eq 0)
        then $fGetPartial(head($seq), $zero) ()
        else $f(head($seq), $self(tail($seq), $zero, $f, $fGetPartial, $self))
</code></pre>
<p>And now BaseX has no problems with the evaluation, even though the input sequence is of size 1M. The complete evaluation takes just a fraction of a millisecond (0.04 ms):</p>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/3eec8eba-95e9-4ef4-bc4f-a1c5b9a3f0fc" alt="image"></p>
<p>With Saxon things are not so good. Even though Saxon produces the correct result, evaluating the expression with an input sequence of size 1M takes 0.5 seconds (half a second), and evaluating the expression with an input sequence of 10M takes 5 seconds (10 times as long):</p>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/087c279c-86b9-4b51-a086-eb7c3f85f802" alt="image"></p>
<p><img src="media/92f636bb9993afbd2fc75157f3024f75.png" alt=""></p>
<p>What is happening?</p>
<p>Even though Saxon performs much faster than the previous 261 seconds, due to  detecting the short-circuiting possibility and performing the short-circuit, Saxon still processes all 10M items when evaluating this subexpression (which obviously the more optimized BaseX doesn’t do in advance):</p>
<p><code>(1 to 10000000) ! function($x){$x - 3}(.)</code></p>
<p>Therefore, we have one remaining problem: How to prevent long sequences (or arrays) from being fully materialized before starting the evaluation of <code>$fold-right-sc</code> ?</p>
<h2><strong>The fix: Step 3 – replacing collections with generators</strong></h2>
<p>Generators are well known and provided out of the box in many programming languages. Per Wikipedia:</p>
<p>“In&nbsp;<a href="https://en.wikipedia.org/wiki/Computer_science">computer science</a>,  a&nbsp;<strong>generator</strong>&nbsp;is a&nbsp;<a href="https://en.wikipedia.org/wiki/Subroutine">routine</a>&nbsp;that can be used to control the&nbsp;<a href="https://en.wikipedia.org/wiki/Iteration">iteration</a>&nbsp;behaviour of a&nbsp;<a href="https://en.wikipedia.org/wiki/Control_flow#Loops">loop</a>. All generators are also&nbsp;<a href="https://en.wikipedia.org/wiki/Iterator">iterators</a>.<a href="https://en.wikipedia.org/wiki/Generator_(computer_programming)#cite_note-1">[1]</a>&nbsp;A generator is very similar to a function that returns an array, in that a generator has parameters, can be called, and generates a sequence of values.
However, instead of building an array containing all the values and returning them all at once, a generator yields the values one at a time, which requires less memory and allows the caller to get started processing the first few values immediately. In short, a generator&nbsp;<em>looks like</em>&nbsp;a function but&nbsp;<em>behaves like</em>&nbsp;an&nbsp;<a href="https://en.wikipedia.org/wiki/Iterator">iterator</a>.”</p>
<p>A full-fledged generator (such as implemented in C#) is an instance of a <a href="https://en.wikipedia.org/wiki/Finite-state_machine">Finite State Machine(FSM)</a>, and implementing it in full generality goes beyond the topic and goals of this article. Expect another article soon that will provide this.</p>
<p>Here we will implement a simple kind of generator, that when passed an integer index <code>$N</code>, produces the <code>$N</code>th item of a specific sequence. Although this is probably the simplest form of a generator, it can be useful in many cases and is a good illustrative solution to our current problem. The whole approach of replacing “something” with a function that must be called to produce this “something” is known as <a href="https://wiki.haskell.org/Lifting">“lifting”</a></p>
<p>First, we will add to our <code>$fold-right</code> just the use of generators, without the detection and performing of short-circuiting:</p>
<pre><code class="language-xq">let $fold-right-lifted-inner := function ($seqGen as function(xs:integer) as array(*),
                                    $index as xs:integer,
                                    $zero as item()*,
                                    $f as function(item(), item()*) as item()* ,
                                    $self as function(*)
                                   ) as item()*
                                {
                                  let $nextSeqResult := $seqGen($index),
                                      $isEndOfSeq :=  $nextSeqResult(1),
                                      $seqItem := $nextSeqResult(2)
                                    return
                                      if($isEndOfSeq) then $zero
                                        else
                                          $f($seqItem, $self($seqGen, $index+1, $zero, $f, $self))
                                },

    $fold-right-lifted := function ($seqGen as function(xs:integer) as array(*),
                                    $zero as item()*,
                                    $f as function(item(), item()*) as item()* 
                                  ) as item()*
                                  {
                                    $fold-right-lifted-inner($seqGen, 1, $zero, $f, $fold-right-lifted-inner)
                                  },
                                  
   $NaN := xs:double('NaN'),
   
   $fSeq1ToN := function($ind as xs:integer, $indStart as xs:integer, $indEnd as xs:integer) as array(*)
                {
                  if($ind lt  $indStart or $ind gt $indEnd)
                    then  array{true(), $NaN}
                    else array{false(), $ind}
                },
   $fSeq-1-6 := $fSeq1ToN(?, 1, 6),
               
   $fAdd := function($x, $y)  {$x + $y},
   $fMult  := function($x, $y)  {$x * $y}
   
   return
     $fold-right-lifted($fSeq-1-6, 1, $fMult) 
</code></pre>
<p>Here we see an example of a simple generator – the function <strong><code>$fSeq1ToN</code></strong>.</p>
<p>This function returns an array with two members: a Boolean, which if <code>true()</code> indicates the end of the sequence, and the 2nd member is the current head of the simulated sequence.<br>
The generator has two other parameters which are the values (inclusive) for the start-index and the end-index. Whenever the passed value of <code>$ind</code> is outside of this specified range, <strong><code>$fSeq1ToN</code></strong> returns a result array with its first member set to <code>true()</code> (the 2nd member of the result must be ignored in this case), which indicates end-of sequence.<br>
Otherwise it returns <code>array{false(), $ind}</code> . It is the responsibility of the caller to stop calling the generator:</p>
<pre><code class="language-xq">   $fSeq1ToN := function($ind as xs:integer, $indStart as xs:integer, $indEnd as xs:integer) as array(*)
                {
                  if($ind lt  $indStart or $ind gt $indEnd)
                    then  array{true(), $NaN}
                    else array{false(), $ind}
                }
</code></pre>
<p>Evaluating the complete XPath expression above produces the correct result both in BaseX and in Saxon: the product of the integers <code>1</code> to <code>6</code>:</p>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/adcee4dc-ddec-4f4c-9e29-1c754315e3d3" alt="image"></p>
<p>Now that we have successfully implemented the last missing piece of our complete  solution, let us put everything together:</p>
<h2><strong>The fix: Step 4 – putting it all together</strong></h2>
<p>Finally we can replace the input sequence in $fold-right-sc with a generator:</p>
<pre><code class="language-xq">let $fold-right-sc-lifted-inner := function ($seqGen as function(xs:integer) as array(*),
                                    $index as xs:integer,
                                    $zero as item()*,
                                    $f as function(item(), item()*) as item()* ,
                                    $fGetPartial as function(*),
                                    $self as function(*)
                                   ) as item()*
                                {
                                  let $nextSeqResult := $seqGen($index),
                                      $isEndOfSeq :=  $nextSeqResult(1),
                                      $seqItem := $nextSeqResult(2)
                                    return
                                      if($isEndOfSeq) then $zero
                                        else
                                          if(function-arity($fGetPartial($seqItem, $zero)) eq 0)
                                            then $fGetPartial($seqItem, $zero) ()
                                            else $f($seqItem, $self($seqGen, $index+1, $zero, $f, $fGetPartial, $self))
                                },

    $fold-right-sc-lifted := function ($seqGen as function(xs:integer) as array(*),
                                       $zero as item()*,
                                       $f as function(item(), item()*) as item()*,
                                       $fGetPartial as function(*) 
                                      ) as item()*
                                      {
                                         $fold-right-sc-lifted-inner($seqGen, 1, $zero, $f, $fGetPartial, $fold-right-sc-lifted-inner)
                                      },
                                  
   $NaN := xs:double('NaN'),
   
   $fSeq1ToN := function($ind as xs:integer, $indStart as xs:integer, $indEnd as xs:integer) as array(*)
                {
                  if($ind lt  $indStart or $ind gt $indEnd)
                    then  array{true(), $NaN}
                    else array{false(), $ind}
                },
   $fSeq-1-6 := $fSeq1ToN(?, 1, 6),
   $fSeq-1-1M := $fSeq1ToN(?, 1, 1000000),
   $fSeq-1-1M-minus-3 := function($n as xs:integer)
   {
     array{$fSeq-1-1M($n)(1), $fSeq-1-1M($n)(2) -3}
   },
               
   $fAdd := function($x, $y)  {$x + $y},
   $fMult  := function($x, $y)  {$x * $y},
   $fMultGetPartial := function($x, $y)
   {
     if($x eq 0)
       then function() {0}
       else function($z) {$x * $z}
   }
   
   return
     $fold-right-sc-lifted($fSeq-1-1M-minus-3, 1, $fMult, $fMultGetPartial) 
</code></pre>
<p>Now this expression (and even one involving a sequence of 10M items take <code>0</code> seconds to be evaluated in both BaseX and Saxon, producing the correct result <code>0</code>:</p>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/e00a1c4c-ee3a-473e-8386-c6fbf10b6d04" alt="image"></p>
<h2><br><strong>Summary</strong></h2>
<p>This article demonstrated the problems inherent to the standard XPath <strong>fn:fold-right</strong> and correctly determined the root causes for these problems: no short-circuiting and no collection generators.</p>
<p>Then a step-by-step solution was built that shows how to implement lazy evaluation in XPath based on short-circuiting and collection generators. This fixed the error raised by BaseX and dramatically reduced the evaluation time of
Saxon from <code>261</code> seconds to <code>0</code> seconds.</p>
<p>The new function produced can be called <strong><code>$fold-lazy</code></strong> and is a good candidate for inclusion in the XPath 4.0 standard functions.</p>
<p>A complete design and implementation of a general collection-generator will be published in a separate article.</p>
</div></details></div>
<div class="toot" id="closed-667"><h2>Issue #667 closed<span class="toot-id"> #closed-667</span></h2><div class="pubdate">29 Aug at 14:49:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/667">https://github.com/qt4cg/qtspecs/pull/667</a></div><p>XPath minor edits, 4.16 through end</p></div>
<div class="toot" id="closed-642"><h2>Issue #642 closed<span class="toot-id"> #closed-642</span></h2><div class="pubdate">29 Aug at 13:09:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/642">https://github.com/qt4cg/qtspecs/pull/642</a></div><p>561: Editorial (abbreviation fn=function, drop lambda syntax)</p></div>
<div class="toot" id="closed-646"><h2>Issue #646 closed<span class="toot-id"> #closed-646</span></h2><div class="pubdate">29 Aug at 12:39:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/646">https://github.com/qt4cg/qtspecs/pull/646</a></div><p>508: Editorial, examples revised (array:split, array:slice, others)</p></div>
<div class="toot" id="closed-627"><h2>Issue #627 closed<span class="toot-id"> #closed-627</span></h2><div class="pubdate">29 Aug at 12:38:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/627">https://github.com/qt4cg/qtspecs/pull/627</a></div><p>624: Adjusted function category descriptions</p></div>
<div class="toot" id="closed-662"><h2>Issue #662 closed<span class="toot-id"> #closed-662</span></h2><div class="pubdate">29 Aug at 12:36:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/662">https://github.com/qt4cg/qtspecs/pull/662</a></div><p>658b: changes to constructor functions</p></div>
<div class="toot" id="closed-656"><h2>Issue #656 closed<span class="toot-id"> #closed-656</span></h2><div class="pubdate">29 Aug at 12:36:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/656">https://github.com/qt4cg/qtspecs/pull/656</a></div><p>Better return type for map pair</p></div>
<div class="toot" id="closed-654"><h2>Issue #654 closed<span class="toot-id"> #closed-654</span></h2><div class="pubdate">29 Aug at 12:36:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/654">https://github.com/qt4cg/qtspecs/pull/654</a></div><p>Add covers-40 attribute to generated tests</p></div>
<div class="toot" id="closed-644"><h2>Issue #644 closed<span class="toot-id"> #closed-644</span></h2><div class="pubdate">29 Aug at 12:35:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/644">https://github.com/qt4cg/qtspecs/pull/644</a></div><p>Adjusted CSS to target classes, not element + classes</p></div>
<div class="toot" id="closed-643"><h2>Issue #643 closed<span class="toot-id"> #closed-643</span></h2><div class="pubdate">29 Aug at 12:35:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/643">https://github.com/qt4cg/qtspecs/pull/643</a></div><p>414, 546: Adjusted XDM description of xs:string, added coding</p></div>
<div class="toot" id="created-669"><h2>Issue #669 created<span class="toot-id"> #created-669</span></h2><div class="pubdate">20 Aug at 22:20:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/669">https://github.com/qt4cg/qtspecs/issues/669</a></div><details><summary>Typo in XSLT §26.4 - "appearing appearing"</summary><div class="markup"><p>The word "appearing" is doubled.</p>
</div></details></div>
<div class="toot" id="created-668"><h2>Issue #668 created<span class="toot-id"> #created-668</span></h2><div class="pubdate">18 Aug at 17:42:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/668">https://github.com/qt4cg/qtspecs/issues/668</a></div><details><summary>Definition of HTML case-insensitive collation</summary><div class="markup"><p>The semantics of the collation URI http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive are described (in F&amp;O section 5.3.4) are described by reference to the HTML5 "living spec". The cross-reference to a changing spec is inevitably fragile and I suggest we make it non-normative. I also suggest that we define the ordering implied by this collation rather than leaving it implementation defined.</p>
<p>A sufficient definition is: the comparison of two strings A and B under this collation delivers the same result as the comparison of ascii-lower-case(A) to ascii-lower-case(B) under the Unicode codepoint collation, where ascii-lower-case($S) function is translate($S, "ABCDEFGHIJKLMNOPQRSTUVWXYZ", "abcedfghijklmnopqrstuvwxyz").</p>
<p>Perhaps we should also consider defining a collation URI that is unicode-case-blind, with the same definition except that ascii-lower-case(X) is replaced by fn:lower-case(X).</p>
</div></details></div>
<div class="toot" id="created-667"><h2>Pull request #667 created<span class="toot-id"> #created-667</span></h2><div class="pubdate">18 Aug at 01:54:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/667">https://github.com/qt4cg/qtspecs/pull/667</a></div><details><summary>XPath minor edits, 4.16 through end</summary><div class="markup"><p>Various small edits. I added two simple examples to help readers quickly understand the difference between <code>=&gt;</code> and <code>=!&gt;</code> before going to more complex examples.</p>
</div></details></div>
<div class="toot" id="created-666"><h2>Issue #666 created<span class="toot-id"> #created-666</span></h2><div class="pubdate">17 Aug at 10:02:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/666">https://github.com/qt4cg/qtspecs/issues/666</a></div><details><summary>Polyfill function implementations</summary><div class="markup"><p>For transition purposes, it may be useful to provide or enable "polyfill" implementations of functions that are specified in QT40, but not yet available in all implementations. Currently this is not possible because the relevant namespaces are reserved.</p>
<p>I propose that we relax the rule on reserved function namespaces:</p>
<p>(a) in XQuery, if the function has an annotation along the lines `%polyfill('http://www.w3.org/2005/xpath-functions'), where the parameter indicates that the function should be injected into the specified namespace instead of the namespace of the containing module.</p>
<p>(b) in XSLT, if the attribute <code>xsl:function/@override-extension-function="no"</code> is present. A function is allowed to be in a reserved namespace if this attribute is present.</p>
<p>I've chosen syntax here that's already available in 3.0/3.1, to minimise the impact on existing processors. Of course, we can't retrospectively change the 3.0/3.1 specs to authorise older processors to make this work as intended. But we can suggest that they bend the rules.</p>
<p>In both cases, (a) if the annotation is present then the rules on reserved namespaces don't apply, and (b) the function declaration is ignored if the processor provides its own internal implementation of the function.</p>
<p>I'm proposing to publish polyfill implementations of many of the new functions (not the complex ones like parse-html!). But I don't intend to make this a QT4 deliverable, I'm thinking of doing it as an open source project in GitHub/Saxonica space.</p>
</div></details></div>
<div class="toot" id="created-665"><h2>Issue #665 created<span class="toot-id"> #created-665</span></h2><div class="pubdate">17 Aug at 08:51:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/665">https://github.com/qt4cg/qtspecs/issues/665</a></div><details><summary>Typo in fn:items-before and fn:items-ending-where</summary><div class="markup"><p>The specifications refer to $seq in place of $input.</p>
</div></details></div>
<div class="toot" id="created-664"><h2>Pull request #664 created<span class="toot-id"> #created-664</span></h2><div class="pubdate">16 Aug at 20:19:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/664">https://github.com/qt4cg/qtspecs/pull/664</a></div><details><summary>663 xsl:original keywords</summary><div class="markup"><p>Fix #663.</p>
<p>A simple fix, just specify that if xsl:original is called with keywords, the keywords used are those of the overridden function.</p>
</div></details></div>
<div class="toot" id="created-663"><h2>Issue #663 created<span class="toot-id"> #created-663</span></h2><div class="pubdate">15 Aug at 22:17:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/663">https://github.com/qt4cg/qtspecs/issues/663</a></div><details><summary>Calling xsl:original() with keywords</summary><div class="markup"><p>We need to define what happens if xsl:original() is called with keyword arguments.</p>
<p>The answer isn't trivial, because (for 3.0 compatibility reasons) an overriding function isn't required to use the same parameter keywords as the function it overrides.</p>
<p>Perhaps we should recognize that there are functions that do not support argument keywords. This might be the case, for example, with Java or C# extension functions.</p>
</div></details></div>
<div class="toot" id="created-662"><h2>Pull request #662 created<span class="toot-id"> #created-662</span></h2><div class="pubdate">15 Aug at 16:34:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/662">https://github.com/qt4cg/qtspecs/pull/662</a></div><details><summary>658b: changes to constructor functions</summary><div class="markup"><p>Changes argument name to "value", makes argument default to context item.</p>
</div></details></div>
<div class="toot" id="closed-661"><h2>Issue #661 closed<span class="toot-id"> #closed-661</span></h2><div class="pubdate">15 Aug at 16:32:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/661">https://github.com/qt4cg/qtspecs/pull/661</a></div><p>658: constructor functions</p></div>
<div class="toot" id="created-661"><h2>Pull request #661 created<span class="toot-id"> #created-661</span></h2><div class="pubdate">15 Aug at 16:16:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/661">https://github.com/qt4cg/qtspecs/pull/661</a></div><details><summary>658: constructor functions</summary><div class="markup"><p>Changes argument name of constructor functions to <code>value</code>, makes the argument optional, revises the way the <code>proto</code> markup is used to indicate emptyOk arguments.</p>
<p>Fix #658</p>
</div></details></div>
<div class="toot" id="closed-638"><h2>Issue #638 closed<span class="toot-id"> #closed-638</span></h2><div class="pubdate">15 Aug at 11:59:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/638">https://github.com/qt4cg/qtspecs/issues/638</a></div><p>Editorial: Avoid e.g.</p></div>
<div class="toot" id="created-660"><h2>Issue #660 created<span class="toot-id"> #created-660</span></h2><div class="pubdate">15 Aug at 10:03:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/660">https://github.com/qt4cg/qtspecs/issues/660</a></div><details><summary>Static functions, default parameters</summary><div class="markup"><p>In the current XQuery draft in <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-function-parameters">5.18.3 Function Parameters</a>, it’ stated that:</p>
<blockquote>
<p>If a parameter is optional, then all subsequent parameters in the list must also be optional. In other words, the parameter list includes zero or more required parameters followed by zero or more optional parameters.</p>
</blockquote>
<p>I would suggest raising <code>XPST0017</code> if that’s not the case.</p>
</div></details></div>
<div class="toot" id="created-659"><h2>Pull request #659 created<span class="toot-id"> #created-659</span></h2><div class="pubdate">14 Aug at 18:03:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/659">https://github.com/qt4cg/qtspecs/pull/659</a></div><details><summary>647: schema location hints</summary><div class="markup"><p>Fix #647</p>
<p>Note: Need to check that this builds successfully. In my working copy, the new text for "import schema" found its way into the "xquery-assembled.xml" file but not into the final HTML. I can't see any reason for this.</p>
</div></details></div>
<div class="toot" id="created-658"><h2>Issue #658 created<span class="toot-id"> #created-658</span></h2><div class="pubdate">14 Aug at 09:11:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/658">https://github.com/qt4cg/qtspecs/issues/658</a></div><details><summary>Constructor Function: Parameter Name, Zero-Arity</summary><div class="markup"><p>The parameter name for constructor functions is <code>$arg</code>: https://qt4cg.org/specifications/xpath-functions-40/Overview.html#constructor-functions</p>
<p>We should change it to <code>$value</code>, in alignment with the XQFO functions:</p>
<pre><code class="language-xquery">fn:string(value := 123),
xs:string(value := 123)
</code></pre>
</div></details></div>
<div class="toot" id="created-657"><h2>Issue #657 created<span class="toot-id"> #created-657</span></h2><div class="pubdate">10 Aug at 12:14:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/657">https://github.com/qt4cg/qtspecs/issues/657</a></div><details><summary>User-defined functions in main modules without `local` prefix</summary><div class="markup"><p>I wonder where this has been discussed before (but I can’t find it):</p>
<p>For simple scripts and main modules, the necessity to prefix all functions with a <code>local</code> prefix is cumbersome. Next, it’s counterintuitive as the prefix is not required for variable declarations:</p>
<pre><code class="language-xquery">declare function local:f() { 1 };
declare variable $x := 1;
$x + local:f()
</code></pre>
<p>It’s possible to use <code>declare default function namespace '...';</code>, but that’s doesn’t feel much easier:</p>
<pre><code class="language-xquery">declare default function namespace 'x';
declare function f() { 1 };
f()
</code></pre>
<p>I wonder if we can do one of the following things?</p>
<ol>
<li>Allow functions without namespace (<code>declare function x() {}</code>, <code>declare function Q{}x() {}</code>).</li>
<li>Assign functions without namespace to the default function namespace.</li>
</ol>
</div></details></div>
<div class="toot" id="created-656"><h2>Pull request #656 created<span class="toot-id"> #created-656</span></h2><div class="pubdate">09 Aug at 09:29:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/656">https://github.com/qt4cg/qtspecs/pull/656</a></div><details><summary>Better return type for map pair</summary><div class="markup"><p>Uses a record type (record(key, value)) for the return type of map:pair, to give more precision and to align with map:pairs() and map:of-pairs()</p>
</div></details></div>
<div class="toot" id="created-655"><h2>Issue #655 created<span class="toot-id"> #created-655</span></h2><div class="pubdate">09 Aug at 07:30:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/655">https://github.com/qt4cg/qtspecs/issues/655</a></div><details><summary>fn:sort-with: Comparators</summary><div class="markup"><p>See https://github.com/qt4cg/qtspecs/issues/93#issuecomment-1017937220:</p>
<blockquote>
<p>One solution to more powerful sorting would a variant of fn:sort that uses a comparator function. We've resisted this in the past because we can't trust a user-supplied comparator function to be well behaved (e.g. transitive). I wonder how serious an obstacle this is?</p>
</blockquote>
<p>We should try to trust; there are much more hidden pitfalls in the existing language.</p>
<p><code>fn:sort</code> could be extended with a <code>comparator</code> parameter with two arguments and returning <code>xs:boolean</code>:</p>
<pre><code class="language-xquery">(: returns John, Joe, Jim, Jack :)
sort(('Jack', 'Joe', 'Jim', 'John'), comparator := op('&gt;'))

(: returns -1, 2, -3 :)
sort((-3, -1, 2), comparator := fn($a, $b) { abs($a) &lt; abs($b) })
</code></pre>
<p>Obviously, if a comparator is supplied, other parameters (<code>collation(s)</code>, <code>key(s)</code>, <code>ascending</code>, see #623) must not be specified in parallel.</p>
</div></details></div>
<div class="toot" id="created-654"><h2>Pull request #654 created<span class="toot-id"> #created-654</span></h2><div class="pubdate">09 Aug at 06:37:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/654">https://github.com/qt4cg/qtspecs/pull/654</a></div><details><summary>Add covers-40 attribute to generated tests</summary><div class="markup"><p>Add covers-40 attribute to the generated test set for function keywords, to avoid failures in app-CatalogCheck test Catalog014</p>
</div></details></div>
<div class="toot" id="created-653"><h2>Issue #653 created<span class="toot-id"> #created-653</span></h2><div class="pubdate">07 Aug at 17:18:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/653">https://github.com/qt4cg/qtspecs/issues/653</a></div><details><summary>XQuery - option to suppress entity expansion</summary><div class="markup"><p>As an enabler for #652 (and for other reasons) I propose that XQuery should have an option to suppress recognition of entity references. This is appropriate for any context in which XQuery expressions are embedded in XML (including our own test suite), where entity expansion will have already been done before the XQuery text is parsed. With this change, any XPath expression becomes a valid and equivalent XQuery expression.</p>
<p>This could be done using a new prolog declaration such as</p>
<p><code>declare entity-expansion on|off;</code></p>
<p>If set to "off", <code>&amp;</code> is treated as a normal character in contexts such as string literals and direct element constructors, rather than signalling an entity reference. The default remains "on".</p>
</div></details></div>
<div class="toot" id="created-652"><h2>Issue #652 created<span class="toot-id"> #created-652</span></h2><div class="pubdate">07 Aug at 17:04:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/652">https://github.com/qt4cg/qtspecs/issues/652</a></div><details><summary>Defining a common function library for XPath, XSLT, and XQuery applications</summary><div class="markup"><p>This issue is motivated by Mary Holstege's talk at Balisage 2023: Adventures in Single-Sourcing XSLT and XQuery</p>
<p>https://www.balisage.net/Proceedings/vol28/html/Holstege01/BalisageVol28-Holstege01.html</p>
<p>It is also motivated by other issues that have been raised here proposing improved capabilities for writing applications in pure XPath.</p>
<p>I propose that we define a syntax for creating a module containing a set of function definitions that can be used to define a function library available to both XQuery and XSLT applications, and potentially also by pure XPath applications. A file should contain all the functions in one namespace. The format should be suitable for translation into other formats such as XSLT and XQuery, which means it should be in XML (though we could also consider JSON). We should provide XSLT stylesheets that convert libraries in this format into XSLT stylesheet modules or XQuery library modules.</p>
<p>Function signatures should be expressed in an XML syntax similar to <code>xsl:function</code> in XSLT.</p>
<p>Function bodies should generally be written in the form of a single XPath expression, though there should be fallback mechanisms to allow XSLT and XQuery implementations to be supplied in cases where XPath lacks sufficient expressive power.</p>
<p>There should be mechanisms to define the more important components of the static context, such as namespace bindings and dependencies on other function libraries.</p>
<p>We could consider using this format to publish "polyfill" implementations of many of the new XPath 4.0 functions.</p>
</div></details></div>
<div class="toot" id="created-651"><h2>Issue #651 created<span class="toot-id"> #created-651</span></h2><div class="pubdate">07 Aug at 16:48:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/651">https://github.com/qt4cg/qtspecs/issues/651</a></div><details><summary>fn:log → fn:message</summary><div class="markup"><p>I think we've made a mistake in the choice of name for this function. Without the namespace prefix, it looks far too much like a function that computes logarithms. Also, it would be nice in the future to find some way of allowing the math functions to be called without a namespace prefix, and this choice scuppers that possibility.</p>
<p>I think my choice would be fn:message.</p>
</div></details></div>
<div class="toot" id="created-650"><h2>Pull request #650 created<span class="toot-id"> #created-650</span></h2><div class="pubdate">06 Aug at 06:05:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/650">https://github.com/qt4cg/qtspecs/pull/650</a></div><details><summary>649: fix an xsl:fallback problem</summary><div class="markup"><p>Ensures that an xsl:fallback instruction is not processed in forwards compatibility mode, so that errors in the instruction are reported rather than being silently ignored; informally encourages adoption of the same rule in 3.0 and earlier processors where possible.</p>
<p>Fix #649</p>
</div></details></div>
<div class="toot" id="created-649"><h2>Issue #649 created<span class="toot-id"> #created-649</span></h2><div class="pubdate">05 Aug at 19:06:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/649">https://github.com/qt4cg/qtspecs/issues/649</a></div><details><summary>xsl:fallback</summary><div class="markup"><p>I made the mistake of writing a test that said:</p>
<pre><code>    &lt;xsl:array version="4.0"&gt;
      &lt;xsl:fallback select="array{1 to 10}"/&gt;
      &lt;xsl:sequence select="1 to 10"/&gt;
    &lt;/xsl:array&gt;
</code></pre>
<p>Now, the <code>xsl:fallback</code> instruction doesn't allow an <code>@select</code> attribute; and there's not much point in adding one, because xsl:fallback is only there for a processor implementing XSLT 1.0, 2.0, or 3.0, and such processors will ignore anything the XSLT 4.0 specification says.</p>
<p>However, we could supply some clarification of what such a processor is expected to do when it finds an <code>xsl:fallback</code> element with an unexpected <code>@select</code> attribute. At present, it seems that because we don't say anything else, the <code>xsl:fallback</code> element is itself evaluated in forwards compatibility mode, which means that the select attribute is ignored. Since the whole purpose of xsl:fallback is to provide code that an earlier XSLT processor can handle, I think it would make much more sense to say: "the effective version for an xsl:fallback element and its descendants, unless overridden with an explicit [xsl:]version attribute, is the version of the processor in use", so a 3.0 processor executing an <code>xsl:fallback</code> instruction in a 4.0 stylesheet reports a static error if it finds a construct like the above.</p>
<p>Although the 4.0 spec cannot dictate what a 3.0 processor does, we could add a non-normative note encouraging this interpretation.</p>
</div></details></div>
<div class="toot" id="created-648"><h2>Issue #648 created<span class="toot-id"> #created-648</span></h2><div class="pubdate">03 Aug at 09:23:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/648">https://github.com/qt4cg/qtspecs/issues/648</a></div><details><summary>Schema for FN namespace should block extension and substitution</summary><div class="markup"><p>Weird things can happen if the user defines a schema that imports the schema for the FN namespace and then adds members to its substutition groups or extends its complex types. We can prevent this happening by blocking substitution and extension. We should also specify that when we validate the input to fn:xml-to-json, xsi:schemaLocation must be disabled.</p>
</div></details></div>
<div class="toot" id="created-647"><h2>Issue #647 created<span class="toot-id"> #created-647</span></h2><div class="pubdate">01 Aug at 13:29:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/647">https://github.com/qt4cg/qtspecs/issues/647</a></div><details><summary>XQuery: import schema with multiple location hints</summary><div class="markup"><p>XQuery 3.1 clarified what is intended when an "import module" declaration provides multiple location hints - there's now a clear indication that the processor should expect to load multiple modules all with the same module namespace.</p>
<p>For "import schema" it's still completely vague what is intended, and there's no analogy in XSD or XSLT which only ever allow a single location URI to be supplied. Currently we say:</p>
<blockquote>
<p>The URILiterals that follow the at keyword are optional location hints, and can be interpreted or disregarded in an implementation-dependent way. Multiple location hints might be used to indicate more than one possible place to look for the schema or multiple physical resources to be assembled to form the schema.</p>
</blockquote>
<p>I propose changing this to:</p>
<blockquote>
<p>The URILiterals that follow the at keyword are optional location hints, intended to allow a processor to locate schema documents containing definitions of the required schema components in the target namespace. Processors may interpret or disregard these hints in an implementation-dependent way. The <em>recommended</em> default strategy is as follows (but this may be varied through user options):</p>
</blockquote>
<ul>
<li>All the location hints are dereferenced, treating them as relative URIs</li>
<li>If any location hint cannot be dereferenced, or fails to resolve to a valid schema document with the required target namespace, then that location hint is disregarded (optionally with a warning); but if none of the location hints can be resolved to a valid schema document with the required target namespace, then a static error is reported.</li>
<li>If multiple location hints are dereferenced, yielding multiple schema documents A, B, and C, then they should be treated as if there were a single schema document containing <code>xs:include</code> declarations referencing A, B, and C. This implies that the schema documents must together comprise a valid schema, for example there cannot be two different type definitions with the same name.</li>
<li>Notwithstanding the previous rule, if a processor is able to establish that two or more location hints refer to identical or equivalent schema documents, then the duplicates should be ignored.</li>
</ul>
<p>This text gives users and implementors alike a much better sense of what is intended, while still retaining flexibility for implementations to do something different.</p>
</div></details></div>
<div class="toot" id="created-646"><h2>Pull request #646 created<span class="toot-id"> #created-646</span></h2><div class="pubdate">26 Jul at 11:12:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/646">https://github.com/qt4cg/qtspecs/pull/646</a></div><details><summary>508: Editorial, examples revised (array:split, array:slice, others)</summary><div class="markup"><p>@ndw @michaelhkay I wonder what we should do with minor edits like this (which fixes an example)?
Should we merge them by ourselves, or wait for someone to approve and merge it?</p>
</div></details></div>
<div class="toot" id="created-645"><h2>Issue #645 created<span class="toot-id"> #created-645</span></h2><div class="pubdate">26 Jul at 07:09:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/645">https://github.com/qt4cg/qtspecs/issues/645</a></div><details><summary>Editorial: Use `\n` instead of `\r\n` in XML documents</summary><div class="markup"><p>If we use a consistent newline encoding in all XML documents, it will be easier to perform cleanups and to edit documents in the GitHub frontend. Most documents already use Unix-style newlines. If I am correct, only three documents need to be updated:</p>
<pre><code>specifications/xslt-xquery-serialization-40/src/errors.xml
specifications/xslt-xquery-serialization-40/src/ns-xslt-xquery-serialization.xml
specifications/xslt-xquery-serialization-40/src/xslt-xquery-serialization.xml
</code></pre>
</div></details></div>
<div class="toot" id="created-644"><h2>Pull request #644 created<span class="toot-id"> #created-644</span></h2><div class="pubdate">26 Jul at 03:02:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/644">https://github.com/qt4cg/qtspecs/pull/644</a></div><p>Adjusted CSS to target classes, not element + classes</p></div>
<div class="toot" id="created-643"><h2>Pull request #643 created<span class="toot-id"> #created-643</span></h2><div class="pubdate">26 Jul at 02:22:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/643">https://github.com/qt4cg/qtspecs/pull/643</a></div><details><summary>414, 546: Adjusted XDM description of xs:string, added coding</summary><div class="markup"><p>Per meeting today, made good on my comment in #546</p>
</div></details></div>
<div class="toot" id="created-642"><h2>Pull request #642 created<span class="toot-id"> #created-642</span></h2><div class="pubdate">25 Jul at 18:29:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/642">https://github.com/qt4cg/qtspecs/pull/642</a></div><details><summary>561: Editorial (abbreviation fn=function, drop lambda syntax)</summary><div class="markup"><p>Old <code>-&gt;</code> lambda syntax removed from various examples; minor unifications.</p>
<p>I believe it’s ready to merge; please jump in otherwise.</p>
</div></details></div>
<div class="toot" id="closed-634"><h2>Issue #634 closed<span class="toot-id"> #closed-634</span></h2><div class="pubdate">25 Jul at 18:12:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/634">https://github.com/qt4cg/qtspecs/pull/634</a></div><p>471: Quotes (missing cases)</p></div>
<div class="toot" id="minutes-07-25"><h2>QT4 CG meeting 043 draft minutes<span class="toot-id"> #minutes-07-25</span></h2><div class="pubdate">25 Jul at 16:50:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/07-25">https://qt4cg.org/meeting/minutes/2023/07-25</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-641"><h2>Issue #641 created<span class="toot-id"> #created-641</span></h2><div class="pubdate">25 Jul at 16:04:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/641">https://github.com/qt4cg/qtspecs/issues/641</a></div><details><summary>Serialization fallback.</summary><div class="markup"><p>I propose that we drop some serialization errors in favour of producing a fallback representation of the supplied value.</p>
<p>The rationale is that (a) serialization is often used in contexts like xsl:message where the primary purpose is diagnostic, and the last thing you want when producing diagnostics is a secondary error; and (b) seeing a fallback representation of an inappropriate value often shows you much more clearly what you have done wrong than any error message can do.</p>
<p>Compare with the <code>.toString()</code> method in Java and similar languages, which always outputs something even if it's not quite what you wanted.</p>
<p>I'm not proposing to change the principle that the output should always be syntactically valid (e.g. well formed XML or JSON).</p>
<p>I think some of the specific error conditions we might drop are:</p>
<ul>
<li>
<p>In sequence normalization rule 7, instead of raising an error when an attribute, namespace, or function (including a map or array) is encountered, serialize that item using the adaptive output method, treat the result as a text node, and insert the text node into sequence S6.</p>
</li>
<li>
<p>In the JSON output method: when a sequence of two or more items is encountered, instead of raising SERE0023, treat it as an array containing those items.</p>
</li>
</ul>
<p>Closely related, and perhaps best considered together: should the <code>fn:string()</code> function accept anything as input, and never raise an error?</p>
</div></details></div>
<div class="toot" id="closed-632"><h2>Issue #632 closed<span class="toot-id"> #closed-632</span></h2><div class="pubdate">25 Jul at 15:58:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/632">https://github.com/qt4cg/qtspecs/pull/632</a></div><p>SENR0001: Error description updated</p></div>
<div class="toot" id="closed-630"><h2>Issue #630 closed<span class="toot-id"> #closed-630</span></h2><div class="pubdate">25 Jul at 15:58:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/630">https://github.com/qt4cg/qtspecs/pull/630</a></div><p>XPath spec ch. 3 minor edits</p></div>
<div class="toot" id="closed-574"><h2>Issue #574 closed<span class="toot-id"> #closed-574</span></h2><div class="pubdate">25 Jul at 15:58:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/574">https://github.com/qt4cg/qtspecs/issues/574</a></div><p>fn:log: Trace and discard results</p></div>
<div class="toot" id="closed-629"><h2>Issue #629 closed<span class="toot-id"> #closed-629</span></h2><div class="pubdate">25 Jul at 15:58:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/629">https://github.com/qt4cg/qtspecs/pull/629</a></div><p>574: fn:log: Trace and discard results</p></div>
<div class="toot" id="closed-508"><h2>Issue #508 closed<span class="toot-id"> #closed-508</span></h2><div class="pubdate">25 Jul at 15:57:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/508">https://github.com/qt4cg/qtspecs/issues/508</a></div><p>New Map &amp; Array Functions: Inconsistencies</p></div>
<div class="toot" id="closed-609"><h2>Issue #609 closed<span class="toot-id"> #closed-609</span></h2><div class="pubdate">25 Jul at 15:57:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/609">https://github.com/qt4cg/qtspecs/pull/609</a></div><p>508: New Map &amp; Array Functions: Inconsistencies</p></div>
<div class="toot" id="closed-23"><h2>Issue #23 closed<span class="toot-id"> #closed-23</span></h2><div class="pubdate">25 Jul at 15:57:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/23">https://github.com/qt4cg/qtspecs/issues/23</a></div><p>Extending element and attribute tests to NameTest unions</p></div>
<div class="toot" id="closed-606"><h2>Issue #606 closed<span class="toot-id"> #closed-606</span></h2><div class="pubdate">25 Jul at 15:57:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/606">https://github.com/qt4cg/qtspecs/pull/606</a></div><p>Allow element(A|B) and attribute(A|B)</p></div>
<div class="toot" id="closed-602"><h2>Issue #602 closed<span class="toot-id"> #closed-602</span></h2><div class="pubdate">25 Jul at 15:57:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/602">https://github.com/qt4cg/qtspecs/issues/602</a></div><p>Semi-strict static typing: reporting implausible expressions</p></div>
<div class="toot" id="closed-603"><h2>Issue #603 closed<span class="toot-id"> #closed-603</span></h2><div class="pubdate">25 Jul at 15:57:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/603">https://github.com/qt4cg/qtspecs/pull/603</a></div><p>602 Implausible Expressions</p></div>
<div class="toot" id="closed-561"><h2>Issue #561 closed<span class="toot-id"> #closed-561</span></h2><div class="pubdate">25 Jul at 15:56:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/561">https://github.com/qt4cg/qtspecs/issues/561</a></div><p>Alias for `function` keyword; drop thin arrow syntax?</p></div>
<div class="toot" id="closed-589"><h2>Issue #589 closed<span class="toot-id"> #closed-589</span></h2><div class="pubdate">25 Jul at 15:56:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/589">https://github.com/qt4cg/qtspecs/pull/589</a></div><p>561: abbreviation fn=function, drop lambda syntax</p></div>
<div class="toot" id="closed-575"><h2>Issue #575 closed<span class="toot-id"> #closed-575</span></h2><div class="pubdate">25 Jul at 15:55:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/575">https://github.com/qt4cg/qtspecs/pull/575</a></div><p>359: fn:void: Absorb result of evaluated argument</p></div>
<div class="toot" id="closed-414"><h2>Issue #414 closed<span class="toot-id"> #closed-414</span></h2><div class="pubdate">25 Jul at 15:55:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/414">https://github.com/qt4cg/qtspecs/issues/414</a></div><p>Lift character set restriction of xs:string</p></div>
<div class="toot" id="closed-546"><h2>Issue #546 closed<span class="toot-id"> #closed-546</span></h2><div class="pubdate">25 Jul at 15:55:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/546">https://github.com/qt4cg/qtspecs/pull/546</a></div><p>414: Attempt to implement expanding the allowed character repertoire</p></div>
<div class="toot" id="closed-533"><h2>Issue #533 closed<span class="toot-id"> #closed-533</span></h2><div class="pubdate">25 Jul at 15:54:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/533">https://github.com/qt4cg/qtspecs/pull/533</a></div><p>413: Spec for CSV parsing with fn:parse-csv()</p></div>
<div class="toot" id="created-640"><h2>Pull request #640 created<span class="toot-id"> #created-640</span></h2><div class="pubdate">25 Jul at 15:38:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/640">https://github.com/qt4cg/qtspecs/pull/640</a></div><details><summary>601: fn:all → fn:every?</summary><div class="markup"><p>@ndw Should be ready to be merged</p>
</div></details></div>
<div class="toot" id="closed-514"><h2>Issue #514 closed<span class="toot-id"> #closed-514</span></h2><div class="pubdate">25 Jul at 15:30:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/514">https://github.com/qt4cg/qtspecs/issues/514</a></div><p>Lambda expression: Annotations</p></div>
<div class="toot" id="created-639"><h2>Issue #639 created<span class="toot-id"> #created-639</span></h2><div class="pubdate">25 Jul at 15:26:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/639">https://github.com/qt4cg/qtspecs/issues/639</a></div><details><summary>fn:void: Naming, Arguments</summary><div class="markup"><p>A new function <code>fn:void</code> was added to the spec (see #359 for details).</p>
<p>This issue can be used to discuss alternative names for the function, as was suggested by @dnovatchev.</p>
</div></details></div>
<div class="toot" id="created-638"><h2>Issue #638 created<span class="toot-id"> #created-638</span></h2><div class="pubdate">25 Jul at 14:35:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/638">https://github.com/qt4cg/qtspecs/issues/638</a></div><details><summary>Editorial: Avoid e.g.</summary><div class="markup"><p>Occurrences of <code>e.g.</code> should be replaced with alternatives, such as <code>(for example)</code>.</p>
<p>See https://github.com/qt4cg/qtspecs/pull/629#issuecomment-1649952964</p>
</div></details></div>
<div class="toot" id="created-637"><h2>Issue #637 created<span class="toot-id"> #created-637</span></h2><div class="pubdate">25 Jul at 13:35:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/637">https://github.com/qt4cg/qtspecs/issues/637</a></div><details><summary>Annotation Values: Booleans</summary><div class="markup"><p>Functions annotations in XQuery have become a popular feature to attach vendor-specific information (for unit testing, locking, RESTXQ, etc.) to functions.</p>
<p>Annotation values are limited to literals, though. It would often be helpful to supply boolean values, but we don’t have literals for that in the language.</p>
<p>I suggest enhancing the existing grammar…</p>
<pre><code>Annotation  ::=  "%"&nbsp;EQName&nbsp;("("&nbsp;Literal&nbsp;(","&nbsp;Literal)* ")")?
</code></pre>
<p>…and allowing the strings <code>false()</code> and <code>true()</code> as values:</p>
<pre><code>Annotation  ::=  "%"&nbsp;EQName&nbsp;("("&nbsp;AnnotationValue&nbsp;(","&nbsp;AnnotationValue)* ")")?
AnnotationValue  :=  Literal | "false()" | "true()"
</code></pre>
<p>The suggestion is upward compatible if we should decide later on that we want to allow arbitrary expressions for annotation values.</p>
</div></details></div>
<div class="toot" id="closed-636"><h2>Issue #636 closed<span class="toot-id"> #closed-636</span></h2><div class="pubdate">25 Jul at 07:25:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/636">https://github.com/qt4cg/qtspecs/issues/636</a></div><p>Ternary operator</p></div>
<div class="toot" id="created-636"><h2>Issue #636 created<span class="toot-id"> #created-636</span></h2><div class="pubdate">25 Jul at 03:53:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/636">https://github.com/qt4cg/qtspecs/issues/636</a></div><details><summary>Ternary operator</summary><div class="markup"><p>Per #171 the WG decided to allow the ternary operator. I'm looking at <a href="https://qt4cg.org/specifications/xquery-40/xpath-40-diff.html#id-conditionals">4.16 of the current version of XPath 4.0</a> and the ternary operator is presented as illustrative, but the operator does not appear to have been properly introduced and defined in the specs. The terms "ternary", "??", and "!!" appear only twice each, and in contexts that could be confused as being illustrative.</p>
<p>By my reading, the definition of <code>[11] ExprSingle</code> should be expanded to allow a new option, call it <code>TernaryOption</code>, and to the grammar should be new entry <code>TernaryOption ::= Expr "??" ExprSingle "!!" ExprSingle</code>. Does such a definition allow any ambiguous constructs?</p>
<p>I propose that 4.16 be subdivided into two subsections, the first one briefly introducing the ternary operator and the second handling if/then statements. Slight aside: the latter should also include a note pointing out how to avoid a then branch (and an example), a courtesy to developers who are overly accustomed to the unbraced approach as to not give the braced approach much thought.</p>
</div></details></div>
<div class="toot" id="created-635"><h2>Pull request #635 created<span class="toot-id"> #created-635</span></h2><div class="pubdate">24 Jul at 16:28:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/635">https://github.com/qt4cg/qtspecs/pull/635</a></div><details><summary>451: Schema compatibility</summary><div class="markup"><p>This PR addresses part (not all) of issue 451.</p>
<p>It recognises that an application may use more than one schema; for example in a pipeline using multiple stylesheets, it must be possible for the first stylesheet to produce valid output that is valid input to the second, without requiring that the two stylesheet have absolutely identical schema imports. It recognises that there are cases (for example involving substitution groups) where two schemas X and Y may both include the same type T, but produce different results when an element is validated against T. So it defines a concept of schema compatibility and defines its limitations, especially on the semantics of item types such as <code>element(*,T)</code> and <code>schema-element(E)</code>. The rules for schema compatibility between different modules of a query and between different packages in a stylesheet are tightened up and brought into line with each other.</p>
</div></details></div>
<div class="toot" id="created-634"><h2>Pull request #634 created<span class="toot-id"> #created-634</span></h2><div class="pubdate">24 Jul at 13:54:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/634">https://github.com/qt4cg/qtspecs/pull/634</a></div><details><summary>471: Quotes (missing cases)</summary><div class="markup"><p>See Matt’s comment in https://github.com/qt4cg/qtspecs/pull/533#issuecomment-1647945368</p>
</div></details></div>
<div class="toot" id="closed-389"><h2>Issue #389 closed<span class="toot-id"> #closed-389</span></h2><div class="pubdate">22 Jul at 15:38:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/389">https://github.com/qt4cg/qtspecs/issues/389</a></div><p>The fn:build-uri function needs to perform URI encoding for path and query segments</p></div>
<div class="toot" id="closed-556"><h2>Issue #556 closed<span class="toot-id"> #closed-556</span></h2><div class="pubdate">22 Jul at 15:35:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/556">https://github.com/qt4cg/qtspecs/issues/556</a></div><p>Serialization phase 5 note unclear</p></div>
<div class="toot" id="closed-621"><h2>Issue #621 closed<span class="toot-id"> #closed-621</span></h2><div class="pubdate">22 Jul at 13:41:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/621">https://github.com/qt4cg/qtspecs/pull/621</a></div><p>Removed chapter 4 from XDM</p></div>
<div class="toot" id="closed-626"><h2>Issue #626 closed<span class="toot-id"> #closed-626</span></h2><div class="pubdate">22 Jul at 13:41:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/626">https://github.com/qt4cg/qtspecs/pull/626</a></div><p>Adjusted serialization step 5 note</p></div>
<div class="toot" id="closed-625"><h2>Issue #625 closed<span class="toot-id"> #closed-625</span></h2><div class="pubdate">22 Jul at 13:40:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/625">https://github.com/qt4cg/qtspecs/pull/625</a></div><p>XPath minor edits, chh. 1-2</p></div>
<div class="toot" id="created-633"><h2>Pull request #633 created<span class="toot-id"> #created-633</span></h2><div class="pubdate">22 Jul at 03:35:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/633">https://github.com/qt4cg/qtspecs/pull/633</a></div><details><summary>Edits ch. 4.1 through 4.15</summary><div class="markup"><p>Note, this batch of edits includes a shift from "built-in" to "system" when describing functions, per edits made in XDM.</p>
</div></details></div>
<div class="toot" id="created-632"><h2>Pull request #632 created<span class="toot-id"> #created-632</span></h2><div class="pubdate">21 Jul at 21:18:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/632">https://github.com/qt4cg/qtspecs/pull/632</a></div><details><summary>SENR0001: Error description updated</summary><div class="markup"><p>Observed by @line-o:
https://xmlcom.slack.com/archives/C01GVC3JLHE/p1689946671105499</p>
</div></details></div>
<div class="toot" id="created-631"><h2>Pull request #631 created<span class="toot-id"> #created-631</span></h2><div class="pubdate">21 Jul at 17:46:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/631">https://github.com/qt4cg/qtspecs/pull/631</a></div><details><summary>600: fn:decode-from-uri</summary><div class="markup"><p>I did my best to define rules for a counterpart of the <code>fn:encode-for-uri</code> function, including various edge cases.</p>
<p>I’m convinced that the function has been requested often enough to justify its inclusion in the spec. I’m also aware that users may have different expectations regarding the details of the conversion rules. On the other hand, this discussion can be observed for other languages as well, and that’s mostly due to the… heterogeneous history of URIs, not the actual implementations. For example, <code>URLDecode.decode</code> in Java converts the plus character to a space, and JavaScript’s <code>decodeURI</code> adopts it unchanged. I decided to convert it as well, as <code>fn:encode-for-uri</code> encodes the plus sign to <code>%2B</code>.</p>
<p>@ndw My rules have largely been inspired by your decoding rules for <code>fn:parse-uri</code>. I hope these rules can be dropped and replaced with a reference to this new function (analogous to <code>fn:build-uri</code>, which references <code>fn:encode-for-uri</code>).</p>
</div></details></div>
<div class="toot" id="agenda-07-25"><h2>QT4 CG meeting 043 draft agenda<span class="toot-id"> #agenda-07-25</span></h2><div class="pubdate">21 Jul at 08:30:05 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/07-25">https://qt4cg.org/meeting/agenda/2023/07-25</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-630"><h2>Pull request #630 created<span class="toot-id"> #created-630</span></h2><div class="pubdate">21 Jul at 02:53:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/630">https://github.com/qt4cg/qtspecs/pull/630</a></div><details><summary>XPath spec ch. 3 minor edits</summary><div class="markup"><p>Minor edits to ch. 3 of XPath spec. Note, this PR includes an adjustment to the XDM spec, in the form of a cross-reference, because the terms "string value" and "typed value" are heavily used in XDM but defined only in XPath.</p>
</div></details></div>
<div class="toot" id="created-629"><h2>Pull request #629 created<span class="toot-id"> #created-629</span></h2><div class="pubdate">20 Jul at 16:36:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/629">https://github.com/qt4cg/qtspecs/pull/629</a></div><details><summary>574: fn:log: Trace and discard results</summary><div class="markup"><ul>
<li>New function <code>fn:log</code></li>
<li>Rules of <code>fn:trace</code> revised</li>
</ul>
</div></details></div>
<div class="toot" id="closed-620"><h2>Issue #620 closed<span class="toot-id"> #closed-620</span></h2><div class="pubdate">20 Jul at 07:25:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/620">https://github.com/qt4cg/qtspecs/pull/620</a></div><p>[616] Converted X Node to x node</p></div>
<div class="toot" id="closed-622"><h2>Issue #622 closed<span class="toot-id"> #closed-622</span></h2><div class="pubdate">20 Jul at 07:24:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/622">https://github.com/qt4cg/qtspecs/pull/622</a></div><p>XDM minor edits, back material</p></div>
<div class="toot" id="created-628"><h2>Issue #628 created<span class="toot-id"> #created-628</span></h2><div class="pubdate">20 Jul at 07:07:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/628">https://github.com/qt4cg/qtspecs/issues/628</a></div><details><summary>distinct-values and duplicate-values: order of results</summary><div class="markup"><p>I've noticed that a few tests have appeared in QT4tests distinct-values() that assume the order of results is "order of first appearance" (search for <code>assert-deep-eq</code>). We should either change the tests, or change the spec to require order of first appearance.</p>
<p>Since no implementors have objected to these tests, it seems likely that implementations are delivering results in "order of first appearance", and if that is the case, then I think it would be a convenience to users to guarantee this in the spec.</p>
<p>To allow for parallel implementations, we could say that the order is undefined if ordering mode is unordered.</p>
</div></details></div>
<div class="toot" id="created-627"><h2>Pull request #627 created<span class="toot-id"> #created-627</span></h2><div class="pubdate">20 Jul at 02:39:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/627">https://github.com/qt4cg/qtspecs/pull/627</a></div><details><summary>624: Adjusted function category descriptions</summary><div class="markup"><p>Attempted revision in light of #624. Perhaps not everything is exactly right, but it should be a step in the right direction.</p>
</div></details></div>
<div class="toot" id="created-626"><h2>Pull request #626 created<span class="toot-id"> #created-626</span></h2><div class="pubdate">20 Jul at 01:47:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/626">https://github.com/qt4cg/qtspecs/pull/626</a></div><details><summary>Adjusted serialization step 5 note</summary><div class="markup"><p>This brief edit addresses issue #556, which I've chosen to handle apophatically.</p>
</div></details></div>
<div class="toot" id="created-625"><h2>Pull request #625 created<span class="toot-id"> #created-625</span></h2><div class="pubdate">20 Jul at 01:09:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/625">https://github.com/qt4cg/qtspecs/pull/625</a></div><details><summary>XPath minor edits, chh. 1-2</summary><div class="markup"><p>All minor edits. Some edits are motivated by an attempt to address broken parallelism or some other form of localized inconsistency. Does not include questions about function descriptions, raised at #624.</p>
</div></details></div>
<div class="toot" id="created-624"><h2>Issue #624 created<span class="toot-id"> #created-624</span></h2><div class="pubdate">19 Jul at 22:56:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/624">https://github.com/qt4cg/qtspecs/issues/624</a></div><details><summary>XPath function definition clarification</summary><div class="markup"><p>In the XPath specs, 2.2, <a href="https://qt4cg.org/specifications/xquery-40/xpath-40-diff.html#dt-function-definition">function definitions</a>, the reader is informed that every (statically known) function definition takes one of three mutually exclusive categories: application, system, or external.</p>
<blockquote>
<p>[Definition: Application functions are function definitions written in a host language such as XQuery or XSLT whose semantics are defined in this family of specifications. Their behavior (including the rules determining the static and dynamic context) follows the rules for such functions in the relevant host language specification.]</p>
</blockquote>
<p>The first sentence appears to point to user-written functions in the host languages, and the second sentence appears to point to functions defined by the host language specifications. I assume that this category is meant to include both, and I propose the language be tightened up to make that clear. If my assumption is incorrect, then some other type of revision is needed.</p>
<p>Later on, when the term “built-in function” is introduced, it is not as clearly stated as it should be how that term maps onto the three-way division. It seems that “built-in function” encompasses all system functions and only those application functions that are defined by the specifications, and not user-written functions. Whatever the case, and whatever the best path of revision, this paragraph would be most effective if moved up with the tripartite category discussion.</p>
<p>The term "external function" is introduced here in the static context, with language that is highly suggestive of a definition. But the definition proper is reserved for the dynamic context, and in shorter, different prose that I think loses some of the considerations provided in the static context. I propose that the two passages be consolidated and located in the static context, where the two other types of functions are defined, with an xref in the dynamic context to the meaning of external function.</p>
<p>Down in the dynamic context:</p>
<blockquote>
<p>The dynamically known function definitions may include external functions.</p>
</blockquote>
<p>This sentence is a bit puzzling, because of course they are allowed to include all three types of functions -- none are forbidden, since, after all, the dynamically known functions are a superset of statically known ones. Perhaps the point is to drawn the reader's attention to those functions that are known dynamically but not statically? Perhaps this revision?: "Many of the function definitions known dynamically but not statically will be external functions, but they may include user-written application functions written in a host language, known only dynamically, e.g., through <code>fn:transform</code>."</p>
<p>Cumulatively the above points could go beyond mere minor touch-up, so comments are welcome before I attempt any edits.</p>
</div></details></div>
<div class="toot" id="closed-573"><h2>Issue #573 closed<span class="toot-id"> #closed-573</span></h2><div class="pubdate">19 Jul at 21:58:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/573">https://github.com/qt4cg/qtspecs/issues/573</a></div><p>Node construction functions</p></div>
<div class="toot" id="created-623"><h2>Pull request #623 created<span class="toot-id"> #created-623</span></h2><div class="pubdate">19 Jul at 16:51:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/623">https://github.com/qt4cg/qtspecs/pull/623</a></div><details><summary>93: sort descending</summary><div class="markup"><p>Enhances fn:sort to allow multiple major-to-minor sort keys each of which can independently specify a collation and an ascending/descending option.</p>
<p>Also includes infrastructure changes to allow occurrence indicators on function arguments or results that reference a named record type.</p>
<p>Similar changes will be needed for array:sort; to reduce the risk of rework I propose to make those changes after this PR has been reviewed and accepted.</p>
<p>Fix #93</p>
</div></details></div>
<div class="toot" id="created-622"><h2>Pull request #622 created<span class="toot-id"> #created-622</span></h2><div class="pubdate">19 Jul at 00:51:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/622">https://github.com/qt4cg/qtspecs/pull/622</a></div><details><summary>XDM minor edits, back material</summary><div class="markup"><p>Note, the example was invalid because of a failure to access the included xsd file.</p>
</div></details></div>
<div class="toot" id="created-621"><h2>Pull request #621 created<span class="toot-id"> #created-621</span></h2><div class="pubdate">18 Jul at 22:52:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/621">https://github.com/qt4cg/qtspecs/pull/621</a></div><details><summary>Removed chapter 4 from XDM</summary><div class="markup"><p>As noted in Slack, chapter 4 of the XDM specs is out of place. In this PR I have moved the very general material in chapter 4 to the preamble of chapter 6 (now 5), which provided the opportunity to orient the reader to the structure of that chapter.</p>
<p>Cross-references to chapter 4 have been search for and dealt with. The CSS deletion comes from my observation that there is no such class <code>infoset-mapping</code> in the resultant HTML file; section 4's <code>infoset-mapping</code> is an id.</p>
</div></details></div>
<div class="toot" id="created-620"><h2>Pull request #620 created<span class="toot-id"> #created-620</span></h2><div class="pubdate">18 Jul at 22:29:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/620">https://github.com/qt4cg/qtspecs/pull/620</a></div><details><summary>[616] Converted X Node to x node</summary><div class="markup"><p>Per #616 names of nodes have been set lowercase. This PR does not address the good suggestion that xrefs and styling be selectively applied. That is reserved for a future pass.</p>
</div></details></div>
<div class="toot" id="created-619"><h2>Pull request #619 created<span class="toot-id"> #created-619</span></h2><div class="pubdate">18 Jul at 21:28:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/619">https://github.com/qt4cg/qtspecs/pull/619</a></div><p>XDM ch. 6 minor edits</p></div>
<div class="toot" id="closed-615"><h2>Issue #615 closed<span class="toot-id"> #closed-615</span></h2><div class="pubdate">18 Jul at 16:17:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/615">https://github.com/qt4cg/qtspecs/pull/615</a></div><p>Xdm minor edits, chh. 3-5</p></div>
<div class="toot" id="closed-128"><h2>Issue #128 closed<span class="toot-id"> #closed-128</span></h2><div class="pubdate">18 Jul at 16:17:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/128">https://github.com/qt4cg/qtspecs/issues/128</a></div><p>fn:replace: Tweaks</p></div>
<div class="toot" id="closed-612"><h2>Issue #612 closed<span class="toot-id"> #closed-612</span></h2><div class="pubdate">18 Jul at 16:17:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/612">https://github.com/qt4cg/qtspecs/pull/612</a></div><p>128: fn:replace: Tweaks</p></div>
<div class="toot" id="closed-329"><h2>Issue #329 closed<span class="toot-id"> #closed-329</span></h2><div class="pubdate">18 Jul at 16:17:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/329">https://github.com/qt4cg/qtspecs/issues/329</a></div><p>Keyword parameters: Error codes</p></div>
<div class="toot" id="closed-611"><h2>Issue #611 closed<span class="toot-id"> #closed-611</span></h2><div class="pubdate">18 Jul at 16:16:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/611">https://github.com/qt4cg/qtspecs/pull/611</a></div><p>329: Keyword parameters: Error codes</p></div>
<div class="toot" id="closed-506"><h2>Issue #506 closed<span class="toot-id"> #closed-506</span></h2><div class="pubdate">18 Jul at 16:16:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/506">https://github.com/qt4cg/qtspecs/issues/506</a></div><p>fn:error: parameter names</p></div>
<div class="toot" id="closed-610"><h2>Issue #610 closed<span class="toot-id"> #closed-610</span></h2><div class="pubdate">18 Jul at 16:16:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/610">https://github.com/qt4cg/qtspecs/pull/610</a></div><p>506: fn:error: parameter names</p></div>
<div class="toot" id="closed-607"><h2>Issue #607 closed<span class="toot-id"> #closed-607</span></h2><div class="pubdate">18 Jul at 16:16:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/607">https://github.com/qt4cg/qtspecs/pull/607</a></div><p>XQFO Examples: Fixes, Formatting</p></div>
<div class="toot" id="closed-21"><h2>Issue #21 closed<span class="toot-id"> #closed-21</span></h2><div class="pubdate">18 Jul at 16:15:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/21">https://github.com/qt4cg/qtspecs/issues/21</a></div><p>New reserved function names</p></div>
<div class="toot" id="closed-605"><h2>Issue #605 closed<span class="toot-id"> #closed-605</span></h2><div class="pubdate">18 Jul at 16:15:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/605">https://github.com/qt4cg/qtspecs/pull/605</a></div><p>21: Revise appendix for reserved function names</p></div>
<div class="toot" id="closed-39"><h2>Issue #39 closed<span class="toot-id"> #closed-39</span></h2><div class="pubdate">18 Jul at 16:14:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/39">https://github.com/qt4cg/qtspecs/issues/39</a></div><p>URILiteral is defined in the EBNF grammar but not used</p></div>
<div class="toot" id="closed-604"><h2>Issue #604 closed<span class="toot-id"> #closed-604</span></h2><div class="pubdate">18 Jul at 16:14:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/604">https://github.com/qt4cg/qtspecs/pull/604</a></div><p>[Editorial] Drop the unused symbol URILiteral from the XPath grammar appendix</p></div>
<div class="toot" id="closed-123"><h2>Issue #123 closed<span class="toot-id"> #closed-123</span></h2><div class="pubdate">18 Jul at 16:14:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/123">https://github.com/qt4cg/qtspecs/issues/123</a></div><p>fn:duplicate-values</p></div>
<div class="toot" id="closed-614"><h2>Issue #614 closed<span class="toot-id"> #closed-614</span></h2><div class="pubdate">18 Jul at 16:14:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/614">https://github.com/qt4cg/qtspecs/pull/614</a></div><p>123: fn:duplicate-values</p></div>
<div class="toot" id="created-618"><h2>Issue #618 created<span class="toot-id"> #created-618</span></h2><div class="pubdate">18 Jul at 14:07:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/618">https://github.com/qt4cg/qtspecs/issues/618</a></div><details><summary>Symmetry: fn:html-doc, fn:csv-doc</summary><div class="markup"><p>If we keep <code>fn:html-parse</code> and if we add <code>fn:csv-parse</code>, we should also add <code>fn:html-doc</code> and <code>fn:csv-doc</code>.</p>
</div></details></div>
<div class="toot" id="created-617"><h2>Issue #617 created<span class="toot-id"> #created-617</span></h2><div class="pubdate">18 Jul at 07:42:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/617">https://github.com/qt4cg/qtspecs/issues/617</a></div><details><summary>Implicit constructor functions for record types and union types</summary><div class="markup"><p>See also Issue #397 and Issue #322, which this proposal may partially supersede.</p>
<p>I propose that when declaring a named record type in the static context, this should automatically create a constructor function definition for records of that type.</p>
<p>So in XQuery if you write</p>
<p><code>declare item type my:location as record(longitude: xs:double, latitude: xs:double);</code></p>
<p>then the static context acquires both a type (<code>let $loc as my:location := ....</code>) and a function which you can call with either positional or keyword arguments (<code>let $loc := my:position(-2.03, 50.95)</code> or <code>:= my:position(longitude := -2.03, latitude := 50.95)</code>.</p>
<p>The semantics of the function are roughly <code>map{longitude: -2.03, latitude: 50.95} treat as my:position</code>, except that the function arguments are first coerced to the required types (in this case the decimals are coerced to double).</p>
<p>If the record type is extensible, the constructor function does not provide any capability to set values for extension fields. I'm not sure yet whether it will be possible to distinguish fields set to an empty sequence from fields that are absent.</p>
<p>This is consistent with user-defined atomic types where you automatically get a constructor function.</p>
<p>Similarly for named union types. If you declare</p>
<p><code>declare item type my:binary as union(xs:hexBinary, xs:base64Binary)</code></p>
<p>then you should automatically get an arity-1 constructor function <code>my:binary($value)</code> with the same semantics as if <code>my:binary</code> were an XSD-defined union type (that is, the same semantics as <code>cast $value as union(xs:hexBinary, xs:base64Binary)</code>.</p>
</div></details></div>
<div class="toot" id="created-616"><h2>Issue #616 created<span class="toot-id"> #created-616</span></h2><div class="pubdate">18 Jul at 02:26:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/616">https://github.com/qt4cg/qtspecs/issues/616</a></div><details><summary>XDM: X Node vs. x node</summary><div class="markup"><p>At the risk of being branded a pedant....</p>
<p>Currently the XDM specs have a predilection for Attribute Node, Element Node, Comment Node, Document Node, Text Node, Processing Instruction Node, Namespace Node. But in a healthy minority of cases in the XDM specs, they are rendered lowercase.</p>
<p>To complicate matters further, the other specs, which rely upon the XDM specs for the definition of the terms, universally prefer the lowercase form, and they use the terms preponderantly more. A healthy sample of four of the terms across five of the specifications ("elective" excludes instances where that particular case is required, e.g., capitalization in headers):</p>
<p>Term | Spec | Capitalized | Electively Capitalized | Electively Noncapitalized
-- | -- | -- | -- | --
Attribute node | XDM | 71 | 41 | 18
Element node | XDM | 79 | 71 | 23
Comment node | XDM | 44 | 39 | 0
Document node | XDM | 55 | 48 | 10
Attribute node | Serialization | 0 | 0 | 15
Element node | Serialization | 0 | 0 | 39
Comment node | Serialization | 0 | 0 | 2
Document node | Serialization | 0 | 0 | 15
Attribute node | XQuery | 1 | 0 | 82
Element node | XQuery | 0 | 0 | 141
Comment node | XQuery | 0 | 0 | 9
Document node | XQuery | 2 | 0 | 50
Attribute node | XFO | 1 | 0 | 28
Element node | XFO | 1 | 0 | 67
Comment node | XFO | 1 | 0 | 4
Document node | XFO | 1 | 0 | 57
Attribute node | XSLT | 8 | 0 | 100
Element node | XSLT | 16 | 0 | 77
Comment node | XSLT | 1 | 0 | 6
Document node | XSLT | 12 | 0 | 144</p>
<p>Options:</p>
<ol>
<li>Do nothing.</li>
<li>Change all specs to capitalize these terms universally.</li>
<li>Change only XDM to capitalize these terms universally.</li>
<li>Determine a principle that would differentiate the contexts in which the term should be capitalized or not within XDM only.</li>
<li>Change all specs to uncapitalize these terms universally.</li>
</ol>
<p>My personal preference is no. 5. I do not see any passages in XDM where the reader would be confused by the term being uncapitalized (the minority cases being witnesses). Lowercase would bring XDM into conformity with the other specifications, and with how the term is commonly used outside the specs. Further, the XDM specs do not capitalize other terms it specially defines, e.g., accessor. And in all the specs, including XDM, the clear preference is to use the lowercase for the names in the raw (i.e., without "node"): element, attribute, namespace, etc.</p>
<p>I wanted to bring this to the group before doing any edits. I am happy to do the work, but do not want to do it if it is unwelcome, or if there is a clear preference for another option.</p>
</div></details></div>
<div class="toot" id="created-615"><h2>Pull request #615 created<span class="toot-id"> #created-615</span></h2><div class="pubdate">17 Jul at 21:52:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/615">https://github.com/qt4cg/qtspecs/pull/615</a></div><p>Xdm minor edits, chh. 3-5</p></div>
<div class="toot" id="agenda-07-18"><h2>QT4 CG meeting 042 draft agenda<span class="toot-id"> #agenda-07-18</span></h2><div class="pubdate">17 Jul at 13:00:05 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/07-18">https://qt4cg.org/meeting/agenda/2023/07-18</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-491"><h2>Issue #491 closed<span class="toot-id"> #closed-491</span></h2><div class="pubdate">17 Jul at 11:40:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/491">https://github.com/qt4cg/qtspecs/pull/491</a></div><p>Fix more examples in the FO 4.0 spec</p></div>
<div class="toot" id="created-614"><h2>Pull request #614 created<span class="toot-id"> #created-614</span></h2><div class="pubdate">17 Jul at 11:38:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/614">https://github.com/qt4cg/qtspecs/pull/614</a></div><details><summary>123: fn:duplicate-values</summary><div class="markup"><p>I decided to create a PR for the initial proposal of this function, as I came across at least two other use cases for it since the issue was created.</p>
<p>I believe that the <code>group by</code> clause is the best choice for more complex operations, such as advanced comparisons or creating histograms.</p>
</div></details></div>
<div class="toot" id="created-613"><h2>Issue #613 created<span class="toot-id"> #created-613</span></h2><div class="pubdate">17 Jul at 08:02:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/613">https://github.com/qt4cg/qtspecs/issues/613</a></div><details><summary>Allow "union" as synonym for "|" everywhere</summary><div class="markup"><p>It seems silly to allow "union" as a synonym for "|" in some places and not others. For example it's not allowed in a "case" clause of a typeswitch, nor in a catch clause of try/catch.</p>
<p>We've introduced the ability to write <code>child::(a|b)</code> as a synonym for <code>child::a | child::b</code>, but we don't allow <code>child::(a union b)</code> as a synonym for <code>child::a union child::b</code>.</p>
</div></details></div>
<div class="toot" id="created-612"><h2>Pull request #612 created<span class="toot-id"> #created-612</span></h2><div class="pubdate">16 Jul at 14:39:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/612">https://github.com/qt4cg/qtspecs/pull/612</a></div><p>128: fn:replace: Tweaks</p></div>
<div class="toot" id="created-611"><h2>Pull request #611 created<span class="toot-id"> #created-611</span></h2><div class="pubdate">16 Jul at 14:04:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/611">https://github.com/qt4cg/qtspecs/pull/611</a></div><p>329: Keyword parameters: Error codes</p></div>
<div class="toot" id="created-610"><h2>Pull request #610 created<span class="toot-id"> #created-610</span></h2><div class="pubdate">16 Jul at 13:51:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/610">https://github.com/qt4cg/qtspecs/pull/610</a></div><p>506: fn:error: parameter names</p></div>
<div class="toot" id="created-609"><h2>Pull request #609 created<span class="toot-id"> #created-609</span></h2><div class="pubdate">16 Jul at 13:36:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/609">https://github.com/qt4cg/qtspecs/pull/609</a></div><details><summary>508: New Map &amp; Array Functions: Inconsistencies</summary><div class="markup"><ol>
<li><code>map:of</code> renamed to <code>map:of-pairs</code> (as a hint that the input must match a specific format)</li>
<li><code>array:of</code> renamed to <code>array:of-members</code> (as a hint…)</li>
<li>add <code>map:pair</code> for creating a single pair</li>
<li>add <code>array:split</code> for decomposing arrays to singleton arrays</li>
</ol>
</div></details></div>
<div class="toot" id="created-608"><h2>Issue #608 created<span class="toot-id"> #created-608</span></h2><div class="pubdate">15 Jul at 14:25:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/608">https://github.com/qt4cg/qtspecs/issues/608</a></div><details><summary>Formatting Monospace (II)</summary><div class="markup"><p>Bugging you again, @ndw …</p>
<p>My feedback has been triggered by #607. I’ve moved various code examples into <code>eg</code> blocks. In principle, the result is promising, but it produces cases such as the following one (see https://qt4cg.org/pr/607/xpath-functions-40/Overview.html):</p>
<img src="https://github.com/qt4cg/qtspecs/assets/196589/d64fd37a-2918-487c-967c-08570208d6c8" width="500">
<p>Maybe the result is better to read if single-line and multi-line monospace is formatted identically (i.e., without lines at the top and bottom, and with a transparent background)?</p>
<p>Next, it would be fine if we could get rid of the scrollbars. Often, it’s not apparent from the rendering that the presentation includes results at all:</p>
<img src="https://github.com/qt4cg/qtspecs/assets/196589/b86d688b-fbdc-4a54-bd22-fa47e027dec2" width="500">
<p>We could possibly fix it by wrapping even more examples manually. That can be challenging, though, for example if long strings are used (such as <code>"http://www.w3.org/2013/collation/UCA?lang=en;alternate=blanked;strength=primary"</code>).</p>
<p>Finally, the formatting on mobile devices (here: an Android tablet with a Chrome renderer) differs from the desktop view: code blocks are rendered much smaller than the rest. – That’s just to mention it; I’d probably be annoyed if I was tasked with fixing that.</p>
<img src="https://github.com/qt4cg/qtspecs/assets/196589/b2dd898a-cd20-4ba2-a3d6-cc87c9e4e835" width="400">
</div></details></div>
<div class="toot" id="created-607"><h2>Pull request #607 created<span class="toot-id"> #created-607</span></h2><div class="pubdate">15 Jul at 11:57:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/607">https://github.com/qt4cg/qtspecs/pull/607</a></div><details><summary>XQFO Examples: Fixes, Formatting</summary><div class="markup"><p>This PR contains lots of fixes in the XQFO examples and improves the formatting of examples with nested arguments and multiline expressions.</p>
<p>It’s probably helpful to merge it as soon as possible to avoid conflicts with other PRs.</p>
</div></details></div>
<div class="toot" id="created-606"><h2>Pull request #606 created<span class="toot-id"> #created-606</span></h2><div class="pubdate">14 Jul at 17:15:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/606">https://github.com/qt4cg/qtspecs/pull/606</a></div><details><summary>Allow element(A|B) and attribute(A|B)</summary><div class="markup"><p>Fix #23</p>
</div></details></div>
<div class="toot" id="created-605"><h2>Pull request #605 created<span class="toot-id"> #created-605</span></h2><div class="pubdate">14 Jul at 15:12:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/605">https://github.com/qt4cg/qtspecs/pull/605</a></div><details><summary>21: Revise appendix for reserved function names</summary><div class="markup"><p>Fix #21</p>
</div></details></div>
<div class="toot" id="created-604"><h2>Pull request #604 created<span class="toot-id"> #created-604</span></h2><div class="pubdate">14 Jul at 14:23:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/604">https://github.com/qt4cg/qtspecs/pull/604</a></div><details><summary>[Editorial] Drop the unused symbol URILiteral from the XPath grammar appendix</summary><div class="markup"><p>Fix #39</p>
</div></details></div>
<div class="toot" id="created-603"><h2>Pull request #603 created<span class="toot-id"> #created-603</span></h2><div class="pubdate">13 Jul at 11:08:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/603">https://github.com/qt4cg/qtspecs/pull/603</a></div><details><summary>602 Implausible Expressions</summary><div class="markup"><p>Fix #602</p>
</div></details></div>
<div class="toot" id="created-602"><h2>Issue #602 created<span class="toot-id"> #created-602</span></h2><div class="pubdate">13 Jul at 06:55:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/602">https://github.com/qt4cg/qtspecs/issues/602</a></div><details><summary>Semi-strict static typing: reporting implausible expressions</summary><div class="markup"><p>Strict <em>static typing</em>, as originally defined for XQuery 1.0, was not a success, because it prohibits too many constructs that are perfectly reasonable to write. However, the alternative, pure <em>dynamic typing</em>, prevents a processor reporting many obvious errors at compile time. A compromise is <em>optimistic static typing</em>, where the processor is allowed to report a type error statically in the cases where it can be shown that evaluation of an expression is bound to fail at run-time.</p>
<p>Optimistic static typing has proved a reasonably successful compromise, but there are a number of cases where things that are obviously user mistakes cannot be reported as static errors.  I propose that a processor should be allowed (not required) to treat some of these conditions as static errors.</p>
<p>The first of these conditions is exemplified by passing an argument whose static type is <code>xs:integer*</code> to a function where the declared parameter type is <code>xs:string*</code>. Under optimistic static typing this cannot be reported as a static error, because it is not bound to fail; if the actual value at run-time turns out to be an empty sequence, the call will succeed. So the proposal is that where the inferred supplied type and the required sequence types are both emptiable (that is, occurrence indicator is "?" or "*"), but their respective item types are disjoint, the processor should be allowed to report a static error.</p>
<p>The second condition is what I call a <em>void path expression</em>. Specifically, if we know statically that the result of <code>$A/B</code>, or <code>$A!B</code>, or <code>$A?B</code> will be an empty sequence for any possible value of $A (given its inferred type), this almost certainly means the user has made a mistake, and we should be allowed to report a static error. This extends to the unary or implicit forms of these operators, based on the inferred type of the context item. This is most likely to occur with schema-aware code, where it should be possible to report a path such as A/B/C/D as incorrect if the schema does not allow such a path. But it also arises for example for <code>$A?B</code> if the inferred type of $A is a non-extensible record type and B is not one of its known fields; and it arises for inappropriate combinations of axes such as <code>@code/text()</code>.</p>
<p>Note that I'm not proposing (as XQuery 1.0 static typing did) that <em>any</em> expression whose result is bound to be empty is a static error; the rule is confined to a few specific operators.</p>
<p>Perhaps, for backwards compatibility and interoperability, we should require processors to provide an option to switch this kind of static error detection off. (For example, XSLT 1.0 code sometimes deliberately uses <code>/..</code> to represent an empty sequence, and this construct would be flagged under these rules.)</p>
</div></details></div>
<div class="toot" id="created-601"><h2>Issue #601 created<span class="toot-id"> #created-601</span></h2><div class="pubdate">13 Jul at 06:46:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/601">https://github.com/qt4cg/qtspecs/issues/601</a></div><details><summary>fn:all → fn:every?</summary><div class="markup"><p>Feedback we got (translated):</p>
<p>There are the <code>every</code> and <code>some</code> keywords, and there are the new functions <code>fn:some</code> and <code>fn:all</code>. They appear to be more or less similar, so it would be consistent if <code>fn:all</code> was renamed to <code>fn:every</code>.</p>
<p>If <code>fn:all</code> is called this way because there’s also <code>fn:all-different</code> and <code>fn:all-equal</code>, we should also have <code>fn:some-different</code> and <code>fn:some-equal</code>.</p>
</div></details></div>
<div class="toot" id="closed-585"><h2>Issue #585 closed<span class="toot-id"> #closed-585</span></h2><div class="pubdate">12 Jul at 08:23:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/585">https://github.com/qt4cg/qtspecs/issues/585</a></div><p>Editorial: dynamic function calls</p></div>
<div class="toot" id="closed-597"><h2>Issue #597 closed<span class="toot-id"> #closed-597</span></h2><div class="pubdate">11 Jul at 16:39:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/597">https://github.com/qt4cg/qtspecs/pull/597</a></div><p>Editorial fixes from #566</p></div>
<div class="toot" id="closed-588"><h2>Issue #588 closed<span class="toot-id"> #closed-588</span></h2><div class="pubdate">11 Jul at 16:39:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/588">https://github.com/qt4cg/qtspecs/issues/588</a></div><p>Incompleteness of xsl:sort specification</p></div>
<div class="toot" id="closed-595"><h2>Issue #595 closed<span class="toot-id"> #closed-595</span></h2><div class="pubdate">11 Jul at 16:39:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/595">https://github.com/qt4cg/qtspecs/pull/595</a></div><p>588: (Editorial, XSLT) minor clarifications regarding xsl:sort</p></div>
<div class="toot" id="closed-592"><h2>Issue #592 closed<span class="toot-id"> #closed-592</span></h2><div class="pubdate">11 Jul at 16:39:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/592">https://github.com/qt4cg/qtspecs/issues/592</a></div><p>XSLT §5.6 xsl:decimal-format - no explanation of exponent-separator</p></div>
<div class="toot" id="closed-594"><h2>Issue #594 closed<span class="toot-id"> #closed-594</span></h2><div class="pubdate">11 Jul at 16:39:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/594">https://github.com/qt4cg/qtspecs/pull/594</a></div><p>592: (XSLT, Editorial) Add missing description of exponent-separator</p></div>
<div class="toot" id="closed-591"><h2>Issue #591 closed<span class="toot-id"> #closed-591</span></h2><div class="pubdate">11 Jul at 16:38:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/591">https://github.com/qt4cg/qtspecs/issues/591</a></div><p>Show defaults in XSLT element templates</p></div>
<div class="toot" id="closed-593"><h2>Issue #593 closed<span class="toot-id"> #closed-593</span></h2><div class="pubdate">11 Jul at 16:38:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/593">https://github.com/qt4cg/qtspecs/pull/593</a></div><p>591: [XSLT, editorial] Add defaults to XSLT element syntax summaries</p></div>
<div class="toot" id="closed-343"><h2>Issue #343 closed<span class="toot-id"> #closed-343</span></h2><div class="pubdate">11 Jul at 16:38:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/343">https://github.com/qt4cg/qtspecs/issues/343</a></div><p>$collation argument: Unification</p></div>
<div class="toot" id="closed-590"><h2>Issue #590 closed<span class="toot-id"> #closed-590</span></h2><div class="pubdate">11 Jul at 16:38:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/590">https://github.com/qt4cg/qtspecs/pull/590</a></div><p>343: make $collation uniformly optional</p></div>
<div class="toot" id="closed-365"><h2>Issue #365 closed<span class="toot-id"> #closed-365</span></h2><div class="pubdate">11 Jul at 16:38:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/365">https://github.com/qt4cg/qtspecs/issues/365</a></div><p>switch, typeswitch: Optional braces</p></div>
<div class="toot" id="closed-587"><h2>Issue #587 closed<span class="toot-id"> #closed-587</span></h2><div class="pubdate">11 Jul at 16:38:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/587">https://github.com/qt4cg/qtspecs/pull/587</a></div><p>365: Allow braces in switch and typeswitch expressions</p></div>
<div class="toot" id="closed-586"><h2>Issue #586 closed<span class="toot-id"> #closed-586</span></h2><div class="pubdate">11 Jul at 16:37:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/586">https://github.com/qt4cg/qtspecs/pull/586</a></div><p>585: [Editorial] Rearrange text (and grammar) for dynamic function calls</p></div>
<div class="toot" id="closed-584"><h2>Issue #584 closed<span class="toot-id"> #closed-584</span></h2><div class="pubdate">11 Jul at 16:37:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/584">https://github.com/qt4cg/qtspecs/pull/584</a></div><p>Editorial: Correction to map:filter examples</p></div>
<div class="toot" id="closed-317"><h2>Issue #317 closed<span class="toot-id"> #closed-317</span></h2><div class="pubdate">11 Jul at 16:37:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/317">https://github.com/qt4cg/qtspecs/issues/317</a></div><p>fn:format-integer: $lang → $language ?</p></div>
<div class="toot" id="closed-578"><h2>Issue #578 closed<span class="toot-id"> #closed-578</span></h2><div class="pubdate">11 Jul at 16:37:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/578">https://github.com/qt4cg/qtspecs/pull/578</a></div><p>317: fn:format-integer: $lang → $language</p></div>
<div class="toot" id="closed-577"><h2>Issue #577 closed<span class="toot-id"> #closed-577</span></h2><div class="pubdate">11 Jul at 16:37:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/577">https://github.com/qt4cg/qtspecs/pull/577</a></div><p>Editorial: improve generator for keyword tests</p></div>
<div class="toot" id="closed-555"><h2>Issue #555 closed<span class="toot-id"> #closed-555</span></h2><div class="pubdate">11 Jul at 16:36:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/555">https://github.com/qt4cg/qtspecs/pull/555</a></div><p>464: Revised narrative of normalization steps for serialization</p></div>
<div class="toot" id="closed-547"><h2>Issue #547 closed<span class="toot-id"> #closed-547</span></h2><div class="pubdate">11 Jul at 16:35:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/547">https://github.com/qt4cg/qtspecs/pull/547</a></div><p>Action QT4CG-036-02: Further elaboration of the rules for function identity</p></div>
<div class="toot" id="closed-539"><h2>Issue #539 closed<span class="toot-id"> #closed-539</span></h2><div class="pubdate">11 Jul at 16:34:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/539">https://github.com/qt4cg/qtspecs/issues/539</a></div><p>FLOWR where clause with a "do when false" option</p></div>
<div class="toot" id="created-600"><h2>Issue #600 created<span class="toot-id"> #created-600</span></h2><div class="pubdate">10 Jul at 07:49:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/600">https://github.com/qt4cg/qtspecs/issues/600</a></div><details><summary>fn:decode-from-uri: counterpart of fn-encode-to-uri</summary><div class="markup"><p>Adopted from https://github.com/qt4cg/qtspecs/issues/566#issuecomment-1607397586:</p>
<p>The initial suggestion in #72 was to provide a function for decoding a URI. Maybe we should still think about adding a <code>fn:decode-uri</code> or <code>fn:decode-from-uri</code> function, in which we could tackle the open issues that need to be solved for <code>fn:parse-uri</code>. The current URI decoding rules could then be replaced with a reference to this new function.</p>
</div></details></div>
<div class="toot" id="created-599"><h2>Pull request #599 created<span class="toot-id"> #created-599</span></h2><div class="pubdate">09 Jul at 23:25:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/599">https://github.com/qt4cg/qtspecs/pull/599</a></div><details><summary>90: Simplified stylesheets with no xsl:version</summary><div class="markup"><p>Fix #90</p>
</div></details></div>
<div class="toot" id="closed-598"><h2>Issue #598 closed<span class="toot-id"> #closed-598</span></h2><div class="pubdate">09 Jul at 23:24:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/598">https://github.com/qt4cg/qtspecs/pull/598</a></div><p>Issue90 XSLT: simplified stylesheets with no xsl:version</p></div>
<div class="toot" id="created-598"><h2>Pull request #598 created<span class="toot-id"> #created-598</span></h2><div class="pubdate">09 Jul at 23:05:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/598">https://github.com/qt4cg/qtspecs/pull/598</a></div><details><summary>Issue90 XSLT: simplified stylesheets with no xsl:version</summary><div class="markup"><p>Fix #90. Allow simplified stylesheets with no xsl:version attribute (and therefore no XSL namespace declaration)</p>
</div></details></div>
<div class="toot" id="agenda-07-11"><h2>QT4 CG meeting 041 draft agenda<span class="toot-id"> #agenda-07-11</span></h2><div class="pubdate">07 Jul at 13:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/07-11">https://qt4cg.org/meeting/agenda/2023/07-11</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-597"><h2>Pull request #597 created<span class="toot-id"> #created-597</span></h2><div class="pubdate">07 Jul at 12:30:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/597">https://github.com/qt4cg/qtspecs/pull/597</a></div><details><summary>Editorial fixes from #566</summary><div class="markup"><p>This PR addresses some minor comments from issue #566. There are more substantive comments but I think they warrant discussion first.</p>
</div></details></div>
<div class="toot" id="created-596"><h2>Issue #596 created<span class="toot-id"> #created-596</span></h2><div class="pubdate">05 Jul at 07:45:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/596">https://github.com/qt4cg/qtspecs/issues/596</a></div><details><summary>Pinned values: Transforming Trees</summary><div class="markup"><h1>Pinned Values: Transforming JTrees</h1>
<p>This is a continuation of ideas raised in issue #341, issue #350, and elsewhere. It's related to the requirements presented in issue #262 and issue #297.</p>
<p>I have also presented ideas on transforming JSON trees at XML Prague and at Balisage, and I have tried out ideas over the years in Saxon extension functions. The proposal here owes a lot to those ideas, but consolidates them in a slightly different way.</p>
<p>I'll use the term JTree to refer to a tree structure of maps and arrays. The key difference between a JTree and a node tree (let's call it an XTree) is that the nodes in a JTree have no identity and no parent pointers.</p>
<p>As a result, some operations are remarkably difficult. Let's take one example:</p>
<p>Consider the JSON structure</p>
<pre><code>{ "cities": [
    {  "name" : "Paris",
       "size" : 300
    },
    {  "name" : "Berlin",
       "size" : 300
    }
]}
</code></pre>
<p>and suppose we want to return a modified version of this in which the size of Berlin is changed to 400. It would be nice to be able to write something like:</p>
<pre><code>modify($input, $input?cities[?name="Berlin"]?size, 400)
</code></pre>
<p>But of course, we can't do this. The result of the second argument is simply a number, 300, and we don't want to change all instances of the number 300 to 400, we only want to change one specific instance. Without value identity, the concept of "one specific instance" has no meaning.</p>
<p>I'll leave it as an exercise to the reader to work out how to do this transformation using our current XSLT and XQuery capabilities. It's far more difficult than it should be. In addition, the tree-walking approach in XSLT of applying template rules recursively is inefficient, because its cost typically depends on the size of the tree, not on the size of the modification. With immutable/persistent data structures underpinning XDM maps and arrays, it should be possible to perform this modification in constant time, regardless of the size of the tree.</p>
<p>My solution to this is that the expression in the second argument should return a <em>pinned value</em>. The pinned value behaves just like a plain integer 300 when used in operations such as arithmetic, but being pinned means that its location in the original JTree is retained, meaning that it becomes possible to replace it in the JTree with a different value.</p>
<h2>Data Model</h2>
<p>We need a change to the data model. Any value (any item or sequence) can have the property of being <em>pinned</em>. If a value is pinned, then it has a property called its <em>locus</em> which identifies its position within a JTree.</p>
<p>With a small number of exceptions, specifically noted below, the fact that a value is pinned and has a locus does not change the effect of any operations on the value. For example, the fact that an integer with value 300 is pinned does not change the result of any arithmetic or comparison operations on the number.</p>
<p>A <em>locus</em> may identify a value as being the root of a JTree, or it may identify its position within a JTree. In the latter case it has two basic properties called its <em>container</em> and its <em>slot</em>. The container is a pinned sequence, array, or map, and the slot identifies the value's position within the container: if the container is a sequence or an array, then the slot is an integer position; if the container is a map, then the slot is a key value.</p>
<h2>Operations on Pinned Values</h2>
<p>A value (any value) can be pinned as the root of a JTree using the function <code>fn:pin(value)</code>. This returns a value that is in every way identical to the original (including node identity, if it is a node or contains nodes) except for being pinned.</p>
<p>Some selected operations have their definition changed so that if the input is a pinned value, then the result is a pinned value. These are of two kinds:</p>
<ul>
<li>Operations that return an existing value unchanged generally retain the pinned property and the locus. For example if a value is bound to a variable, then the result of a variable reference will retain these properties.</li>
<li>Operations that select a value within a sequence, array, or map, when that sequence, array, or map is pinned, return a pinned value whose locus identifies the container and the value's slot within that container.</li>
</ul>
<p>So in the above example, if <code>$input</code> is pinned, the expression <code>$input?cities[?name="Berlin"]?size</code> returns an integer (300) whose locus is <code>(C, "size")</code>, where C is the map having name="Berlin". C in turn has a locus (A, 2) where A is the array of cities, and A has a locus (R, "cities") where R is the root of the JTree (the original <code>$input</code> value).</p>
<p>It now becomes possible to define the <code>modify</code> function as follows: The first argument is a value which must be pinned. The second argument must return a pinned value which must be within the tree identified by the first argument (that is, recursively finding the container must lead to this root). The result of the <code>modify()</code> function is formed by recursively replacing each container, all the way up to the root, with a new container in which the contents of the relevant slot are replaced.</p>
<h2>Feasibility</h2>
<p>Let's pause to ask ourselves two questions: is this reasonably feasible to implement, and is it realistically possible to expect users to understand what's going on?</p>
<h3>Implementation</h3>
<p>I've had an implementation of something rather similar in Saxon for years, and I don't think it's especially difficult. In effect we have a Java class <code>PinnedValue</code> which extends <code>Value</code> and which delegates nearly all operations (including "instance of") to a contained <code>Value</code>. The one thing you need to be careful of is assuming (for example) that if a value represents an XDM array, then it will be an instance of a Java class such as <code>XdmArray</code>. (The terminology in the current Saxon implementation is quite different, so don't expect to find this in the current code).</p>
<h3>Usability</h3>
<p>I think that basic features like the <code>modify()</code> function won't be too difficult to explain. We just have to explain that (a) you can only modify a JTree if the root is first pinned, and (b) the expression used in the second argument must use a restricted set of operations: basically, those that do downward selection of values within a container.</p>
<h2>Further Operations</h2>
<p>I've illustrated the benefits with one particular operation, a modify() function, but the feature opens up many other possibilities as well. Here are a few:</p>
<ul>
<li>For pinned values we can expose the container and slot properties through functions (or through custom syntax such as axes). For example this means that in XSLT, if you are doing a recursive traversal of a JTree, a template rule for processing a particular value has access to its ancestors in the same way as is possible for XTrees.</li>
<li>In addition derived properties of a pinned value can be exposed, for example the preceding and following "siblings" within an array (or indeed, within a sequence).</li>
</ul>
<p>I'll explore some additional use cases in further posts.</p>
</div></details></div>
<div class="toot" id="created-595"><h2>Pull request #595 created<span class="toot-id"> #created-595</span></h2><div class="pubdate">04 Jul at 21:31:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/595">https://github.com/qt4cg/qtspecs/pull/595</a></div><details><summary>588: (Editorial, XSLT) minor clarifications regarding xsl:sort</summary><div class="markup"><p>The main issue turned out to be spurious; there is in fact an explanation of the order attribute in the right place. But I made a couple of other minor editorial changes, including dropping the default for @data-type in the (non-normative) schema for XSLT 4.0 - the default of <code>data-type="text"</code> is inappropriate because it forces conversion, e.g. of dates to strings, and the default should be no conversion.</p>
<p>Fix #588.</p>
</div></details></div>
<div class="toot" id="created-594"><h2>Pull request #594 created<span class="toot-id"> #created-594</span></h2><div class="pubdate">04 Jul at 21:05:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/594">https://github.com/qt4cg/qtspecs/pull/594</a></div><details><summary>592: (XSLT, Editorial) Add missing description of exponent-separator</summary><div class="markup"><p>Fix #592</p>
</div></details></div>
<div class="toot" id="created-593"><h2>Pull request #593 created<span class="toot-id"> #created-593</span></h2><div class="pubdate">04 Jul at 15:40:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/593">https://github.com/qt4cg/qtspecs/pull/593</a></div><details><summary>591: [XSLT, editorial] Add defaults to XSLT element syntax summaries</summary><div class="markup"><p>Fix #591. Add default values to e:attribute entries in the XSLT syntax summaries; change the DTD to allow these; change the stylesheet to render them; add a paragraph to the Notation section to explain the conventions.</p>
</div></details></div>
<div class="toot" id="created-592"><h2>Issue #592 created<span class="toot-id"> #created-592</span></h2><div class="pubdate">04 Jul at 15:38:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/592">https://github.com/qt4cg/qtspecs/issues/592</a></div><details><summary>XSLT §5.6 xsl:decimal-format - no explanation of exponent-separator</summary><div class="markup"><p>This problem is inherited from XSLT 3.0</p>
<p>Section 5.6 gives a brief description of the purpose of every attribute of <code>xsl:decimal-format</code>, with the exception of <code>exponent-separator</code>.</p>
</div></details></div>
<div class="toot" id="created-591"><h2>Issue #591 created<span class="toot-id"> #created-591</span></h2><div class="pubdate">04 Jul at 14:06:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/591">https://github.com/qt4cg/qtspecs/issues/591</a></div><details><summary>Show defaults in XSLT element templates</summary><div class="markup"><p>This came out of issue #588, but is separable.</p>
<p>It would be useful in the element templates in the XSLT specification to show default values for attributes.</p>
</div></details></div>
<div class="toot" id="created-590"><h2>Pull request #590 created<span class="toot-id"> #created-590</span></h2><div class="pubdate">04 Jul at 10:14:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/590">https://github.com/qt4cg/qtspecs/pull/590</a></div><details><summary>343: make $collation uniformly optional</summary><div class="markup"><p>Fix #343</p>
</div></details></div>
<div class="toot" id="created-589"><h2>Pull request #589 created<span class="toot-id"> #created-589</span></h2><div class="pubdate">04 Jul at 09:04:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/589">https://github.com/qt4cg/qtspecs/pull/589</a></div><details><summary>561: abbreviation fn=function, drop lambda syntax</summary><div class="markup"><p>Allows "fn" as an abbreviation for "function", and drops the "thin-arrow" lambda function syntax. Fix #561.</p>
</div></details></div>
<div class="toot" id="created-588"><h2>Issue #588 created<span class="toot-id"> #created-588</span></h2><div class="pubdate">03 Jul at 15:14:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/588">https://github.com/qt4cg/qtspecs/issues/588</a></div><details><summary>Incompleteness of xsl:sort specification</summary><div class="markup"><p>These are problems inherited from XSLT 3.0.</p>
<p>The effect of the attribute <code>xsl:sort/@order</code> is never explained in the text; it is assumed that the meaning is obvious.</p>
<p>The only explicit statement that the default is "ascending" is in the schema-for-xslt40, which is non-normative.</p>
<p>The schema also gives a default of "text" for the data-type attribute, which is incorrect: when data-type is set to text, values will be cast to string before comparison, which is not what happens if the actual sort key values are numeric.</p>
<p>We have added prose to define what we mean by "effective value". This clarifies that the effective value of the order attribute, if omitted, is the default value. But we don't have a systematic and formal way of saying what the default value is. This affects the result of test merge-021, which depends on deciding whether the two xsl:merge-source elements have the same effective value for "order", when one is omitted and the other is set to "ascending".</p>
</div></details></div>
<div class="toot" id="created-587"><h2>Pull request #587 created<span class="toot-id"> #created-587</span></h2><div class="pubdate">02 Jul at 22:04:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/587">https://github.com/qt4cg/qtspecs/pull/587</a></div><details><summary>365: Allow braces in switch and typeswitch expressions</summary><div class="markup"><p>Fix #365</p>
</div></details></div>
<div class="toot" id="created-586"><h2>Pull request #586 created<span class="toot-id"> #created-586</span></h2><div class="pubdate">02 Jul at 21:32:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/586">https://github.com/qt4cg/qtspecs/pull/586</a></div><details><summary>585: [Editorial] Rearrange text (and grammar) for dynamic function calls</summary><div class="markup"><p>This PR is purely editorial. It addresses the problems described in issue #585, in particular, the syntax of dynamic function calls is now described before the semantics.</p>
</div></details></div>
<div class="toot" id="closed-159"><h2>Issue #159 closed<span class="toot-id"> #closed-159</span></h2><div class="pubdate">02 Jul at 18:16:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/159">https://github.com/qt4cg/qtspecs/issues/159</a></div><p>Support named arguments on static function calls</p></div>
<div class="toot" id="created-585"><h2>Issue #585 created<span class="toot-id"> #created-585</span></h2><div class="pubdate">30 Jun at 15:18:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/585">https://github.com/qt4cg/qtspecs/issues/585</a></div><details><summary>Editorial: dynamic function calls</summary><div class="markup"><p>Secion 4.4.2.1 describes the semantics of a dynamic function call, but there is no explanation of the syntax.</p>
<p>The syntax is defined in section 4.5.2.</p>
<p>It's rather odd for the syntax and semantics to be separated in this way, and in particular for the semantics to be explained first.</p>
<p>It's also rather odd that both sections claim to have definitions of the term "dynamic function call", and the definitions are different.</p>
<p>Furthermore the grammar productions in 4.5.2 reference, but don't include, PositionalArgumentList; instead they include ArgumentList which is not referenced. PositionalArgumentList is included under 4.23 Arrow Expressions.</p>
</div></details></div>
<div class="toot" id="created-584"><h2>Pull request #584 created<span class="toot-id"> #created-584</span></h2><div class="pubdate">29 Jun at 16:42:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/584">https://github.com/qt4cg/qtspecs/pull/584</a></div><details><summary>Editorial: Correction to map:filter examples</summary><div class="markup"><p>Corrects the syntax of the lambda functions in these two examples. Also improves the formatting.</p>
</div></details></div>
<div class="toot" id="created-583"><h2>Issue #583 created<span class="toot-id"> #created-583</span></h2><div class="pubdate">29 Jun at 14:44:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/583">https://github.com/qt4cg/qtspecs/issues/583</a></div><details><summary>array:replace(), etc</summary><div class="markup"><p>Some observations:</p>
<ol>
<li>array:replace would be more versatile if multiple positions could be specified, rather than just a single position.</li>
<li>if all positions are selected, the function becomes identical to array:for-each. So perhaps we should scrap array:replace and instead add an optional parameter <code>$positions as xs:integer*</code> to array:for-each. However, that could be confusing: people might imagine that the items at positions not present in the list are discarded, rather than being returned unchanged in the result. So I propose we don't do that.</li>
<li>if the function is useful on arrays, then it's also useful on sequences. But <code>fn:replace</code> does something completely different.</li>
<li>We have a similar function on maps called <code>map:substitute</code> (but it's not quite the same, because it processes every entry in the map).</li>
</ol>
<p>In the interests of alignment, I propose we have three functions:</p>
<p><code>fn:substitute($input as item()*, $positions as xs:positiveInteger*, $action as function(item()) as item())</code></p>
<p>equivalent to <code>for $it at $pos in $item return if ($pos = $positions) then $action($it) else $it</code></p>
<p><code>array:substitute($array as array(*), $positions as xs:positiveInteger*, $action as function(item()*) as item()*)</code></p>
<p>equivalent to <code>array{for member $it at $pos in $item return if ($pos = $positions) then $action($it) else $it}</code></p>
<p><code>map:substitute($map as map(*), $keys as xs:anyAtomicValue*, $action as function(anyAtomicValue, item()*) as item()*)</code></p>
<p>For the first two functions, we don't really need to allow the second argument to be omitted, because it would then be equivalent to the corresponding for-each() function. Unfortunately that's not quite true of map:for-each(), because it doesn't return a map. However if you want to do a functional replacement of every entry in a map, it can be done easily enough with</p>
<p><code>map:build(map:key-value-pairs($map), function{?key}, function{$action(?value)})</code></p>
<p>so we're not really losing anything.</p>
</div></details></div>
<div class="toot" id="closed-582"><h2>Issue #582 closed<span class="toot-id"> #closed-582</span></h2><div class="pubdate">29 Jun at 13:16:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/582">https://github.com/qt4cg/qtspecs/pull/582</a></div><p>Fix examples to be consistent with spec</p></div>
<div class="toot" id="created-582"><h2>Pull request #582 created<span class="toot-id"> #created-582</span></h2><div class="pubdate">29 Jun at 13:04:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/582">https://github.com/qt4cg/qtspecs/pull/582</a></div><details><summary>Fix examples to be consistent with spec</summary><div class="markup"><p>I know there are open comments on the actual spec, but in the short term, let's at least make the examples correct.</p>
</div></details></div>
<div class="toot" id="closed-581"><h2>Issue #581 closed<span class="toot-id"> #closed-581</span></h2><div class="pubdate">29 Jun at 12:44:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/581">https://github.com/qt4cg/qtspecs/pull/581</a></div><p>Fix schema error</p></div>
<div class="toot" id="created-581"><h2>Pull request #581 created<span class="toot-id"> #created-581</span></h2><div class="pubdate">29 Jun at 12:44:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/581">https://github.com/qt4cg/qtspecs/pull/581</a></div><details><summary>Fix schema error</summary><div class="markup"><p>I can't explain why this didn't turn up initially in my local testing. :-(</p>
</div></details></div>
<div class="toot" id="closed-580"><h2>Issue #580 closed<span class="toot-id"> #closed-580</span></h2><div class="pubdate">29 Jun at 12:34:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/580">https://github.com/qt4cg/qtspecs/pull/580</a></div><p>Automatically generate app/fo-spec-examples on build</p></div>
<div class="toot" id="created-580"><h2>Pull request #580 created<span class="toot-id"> #created-580</span></h2><div class="pubdate">29 Jun at 12:26:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/580">https://github.com/qt4cg/qtspecs/pull/580</a></div><details><summary>Automatically generate app/fo-spec-examples on build</summary><div class="markup"><p>This PR should update the build so that the test-suite <code>app/fo-spec-examples.xml</code> file is automatically build when the spec is published. The PR test won't tell us anything, so we'll have to merge it and see what happens...</p>
</div></details></div>
<div class="toot" id="closed-579"><h2>Issue #579 closed<span class="toot-id"> #closed-579</span></h2><div class="pubdate">29 Jun at 10:49:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/579">https://github.com/qt4cg/qtspecs/pull/579</a></div><p>Support role=wide on fos:examples</p></div>
<div class="toot" id="created-579"><h2>Pull request #579 created<span class="toot-id"> #created-579</span></h2><div class="pubdate">29 Jun at 10:37:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/579">https://github.com/qt4cg/qtspecs/pull/579</a></div><details><summary>Support role=wide on fos:examples</summary><div class="markup"><p>This is a purely style related change. It supports role=wide on fos:example elements. If an example is identified as "wide" then the presentaiton is in sequential rows of the table rather than adjacent columns. See, for example, <code>parse-uri()</code>.</p>
</div></details></div>
<div class="toot" id="created-578"><h2>Pull request #578 created<span class="toot-id"> #created-578</span></h2><div class="pubdate">28 Jun at 15:03:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/578">https://github.com/qt4cg/qtspecs/pull/578</a></div><details><summary>317: fn:format-integer: $lang → $language</summary><div class="markup"><p>Parameter name aligned with other functions (<code>fn:format-dateTime</code>, <code>fn:lang</code>, others).
Closes #317.</p>
</div></details></div>
<div class="toot" id="created-577"><h2>Pull request #577 created<span class="toot-id"> #created-577</span></h2><div class="pubdate">28 Jun at 14:50:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/577">https://github.com/qt4cg/qtspecs/pull/577</a></div><details><summary>Editorial: improve generator for keyword tests</summary><div class="markup"><p>Improves the stylesheet that generates the BuiltInKeywords.xml test set, using example values for arguments where appropriate, taking these from the function catalog.</p>
</div></details></div>
<div class="toot" id="created-576"><h2>Issue #576 created<span class="toot-id"> #created-576</span></h2><div class="pubdate">27 Jun at 20:03:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/576">https://github.com/qt4cg/qtspecs/issues/576</a></div><details><summary>JSON serialization: Sequences, INF/NaN, function items</summary><div class="markup"><p>As far as possible, the JSON serialization method should be aligned with the new fn:items-to-json() (aka xdm-to-json) function.</p>
<p>Firstly, the results should be the same when the input consists entirely of atomic values, or sequences, maps, and arrays consisting entirely of atomic values. This only requires one change: serializing a sequence of length &gt;1 should output the sequence as if it were an array, rather than raising an error. This is a compatible change.</p>
<p>Secondly, the new fn:items-to-json() function should have an option to output elements (for example elements appearing within maps or arrays) in the same way as the JSON serialization method does, by serializing the nodes to lexical XML or HTML contained within a JSON character string.</p>
<p>Finally, we should align the rules on how to output a function item (other than a map or array). We could either adopt the serialization approach (raise an error), or the items-to-json() approach (output some kind of placeholder saying "here be dragons") but they should be aligned.</p>
<p>Note that the two operations are still very different. items-to-json() is primarily about converting XML to JSON, while JSON serialization is primarily about turning maps and arrays into their JSON lexical form.</p>
</div></details></div>
<div class="toot" id="closed-361"><h2>Issue #361 closed<span class="toot-id"> #closed-361</span></h2><div class="pubdate">27 Jun at 16:10:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/361">https://github.com/qt4cg/qtspecs/issues/361</a></div><p>Named arguments: $input vs. $value</p></div>
<div class="toot" id="closed-562"><h2>Issue #562 closed<span class="toot-id"> #closed-562</span></h2><div class="pubdate">27 Jun at 16:10:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/562">https://github.com/qt4cg/qtspecs/pull/562</a></div><p>361: Named arguments: $input vs. $value</p></div>
<div class="toot" id="closed-567"><h2>Issue #567 closed<span class="toot-id"> #closed-567</span></h2><div class="pubdate">27 Jun at 16:09:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/567">https://github.com/qt4cg/qtspecs/issues/567</a></div><p>Errors in schema for XSLT</p></div>
<div class="toot" id="closed-568"><h2>Issue #568 closed<span class="toot-id"> #closed-568</span></h2><div class="pubdate">27 Jun at 16:09:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/568">https://github.com/qt4cg/qtspecs/pull/568</a></div><p>567: schema for xslt40</p></div>
<div class="toot" id="closed-569"><h2>Issue #569 closed<span class="toot-id"> #closed-569</span></h2><div class="pubdate">27 Jun at 16:09:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/569">https://github.com/qt4cg/qtspecs/pull/569</a></div><p>Minor editorial corrections, XDM chh. 1, 2</p></div>
<div class="toot" id="closed-106"><h2>Issue #106 closed<span class="toot-id"> #closed-106</span></h2><div class="pubdate">27 Jun at 16:08:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/106">https://github.com/qt4cg/qtspecs/issues/106</a></div><p>Decorators' support</p></div>
<div class="toot" id="closed-175"><h2>Issue #175 closed<span class="toot-id"> #closed-175</span></h2><div class="pubdate">27 Jun at 16:08:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/175">https://github.com/qt4cg/qtspecs/issues/175</a></div><p>In XQuery, allow a semicolon at the end of the module</p></div>
<div class="toot" id="closed-457"><h2>Issue #457 closed<span class="toot-id"> #closed-457</span></h2><div class="pubdate">27 Jun at 16:07:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/457">https://github.com/qt4cg/qtspecs/issues/457</a></div><p>Support parsing numeric, alphabetic, and additive number systems.</p></div>
<div class="toot" id="created-575"><h2>Pull request #575 created<span class="toot-id"> #created-575</span></h2><div class="pubdate">27 Jun at 14:05:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/575">https://github.com/qt4cg/qtspecs/pull/575</a></div><details><summary>359: fn:void: Absorb result of evaluated argument</summary><div class="markup"><p>#359: fn:void: Absorb result of evaluated argument</p>
</div></details></div>
<div class="toot" id="created-574"><h2>Issue #574 created<span class="toot-id"> #created-574</span></h2><div class="pubdate">27 Jun at 14:02:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/574">https://github.com/qt4cg/qtspecs/issues/574</a></div><details><summary>fn:log: Trace and discard results</summary><div class="markup"><p>See https://github.com/qt4cg/qtspecs/issues/359#issuecomment-1465971781</p>
<h2>fn:dump</h2>
<h3>Summary</h3>
<p>Outputs trace information and discards the result.</p>
<h3>Signature</h3>
<pre><code>fn:dump(
  $value  as item()*,	
  $label  as xs:string?  := ()
) as empty-sequence()
</code></pre>
<h3>Properties</h3>
<p>This function is ·deterministic·, ·context-independent·, and ·focus-independent·.</p>
<h3>Rules</h3>
<p>Similar to <code>fn:trace:</code>, the values of <code>$value</code>, converted to an <code>xs:string</code>, and <code>$label</code> (if supplied and non-empty) may be directed to a trace data set. The destination of the trace output is ·implementation-defined·. The format of the trace output is ·implementation-dependent·, as is the ordering of the output.</p>
<p>In contrast to <code>fn:trace</code>, the function returns an empty sequence.</p>
</div></details></div>
<div class="toot" id="created-573"><h2>Issue #573 created<span class="toot-id"> #created-573</span></h2><div class="pubdate">26 Jun at 16:53:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/573">https://github.com/qt4cg/qtspecs/issues/573</a></div><details><summary>Node construction functions</summary><div class="markup"><p>I propose introducing a set of functions that allow node construction in XPath. The basic functions are</p>
<pre><code>new-document($children as node()*)
new-element($name as QName, $content as node()*)
new-attribute($name as QName, $value as xs:string)
new-namespace($prefix as xs:string, $uri as xs:string)
new-comment($content as xs:string)
new-processing-instruction($name as xs:string, $content as xs:string)
new-text($content as xs:string)
</code></pre>
<p>The semantics would be essentially identical to the current node constructors in XQuery and/or the corresponding instructions in XSLT (there are very few differences: a few minor ones, like if there are multiple attributes with the same name, XSLT takes the last, while XQuery throws an error).</p>
<p>As always, it's difficult to know where to draw the line in functionality between XPath and XQuery. One of the guidelines I use is that if an addition to XPath is likely to be useful to XSLT users, then it's worth including. Clearly these functions are not strictly necessary in XSLT (they could easily be user-supplied as wrappers around XSLT instructions). But to take advantage of some of the other capabilities we're introducing in XPath, node construction functions are increasingly handy. Consider for example:</p>
<p><code>&lt;xsl:copy-of select="interleave(para, new-element(xs:QName(xhtml:br)))"/&gt;</code></p>
<p>That's a one-liner that replaces</p>
<pre><code>&lt;xsl:for-each select="para"&gt;
  &lt;xsl:if test="position() ne 1"&gt;&lt;br/&gt;&lt;/xsl:if&gt;
  &lt;xsl:copy-of select="."/&gt;
&lt;/xsl:for-each&gt;
</code></pre>
<p>The new functions are also useful in XQuery because although they duplicate existing syntax, the fact that they are functions rather than custom syntax makes them more versatile.</p>
<p>As with existing constructs in XQuery and XSLT, a naive implementation that follows the semantics literally (which involves copying a subtree when adding an element to a new parent) would be rather inefficient. However, I think that the same established optimizations are equally applicable, for example lazy tree construction and/or push-mode evaluation.</p>
</div></details></div>
<div class="toot" id="created-572"><h2>Issue #572 created<span class="toot-id"> #created-572</span></h2><div class="pubdate">26 Jun at 16:36:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/572">https://github.com/qt4cg/qtspecs/issues/572</a></div><details><summary>fn:evaluate-xpath() function</summary><div class="markup"><p>XSLT 3.0 introduced an instruction, xsl:evaluate, for dynamic evaluation of XPath expressions. But there is no way of doing this in XQuery.</p>
<p>It was done as an instruction in XSLT because functions at the time were not flexible enough to cope with a range of optional parameters. This situation has changed.</p>
<p>An <code>fn:evaluate()</code> function might operate successfully with the following parameters:</p>
<ul>
<li>xpath - the XPath expression as a string.</li>
<li>namespaces - the namespace bindings as a map from prefix to URI, defaulting to the namespace bindings in the static context of the caller</li>
<li>parameters - parameter values as a map from QName to value, defaulting to an empty map</li>
<li>context-item - the context item for evaluation, defaulting to the context item of the caller</li>
<li>options:
<ul>
<li>default collation</li>
<li>base URI</li>
<li>schema-aware = true/false</li>
<li>allow-external-access = true/false</li>
<li>cache = true/false (whether to cache compiled expressions for reuse)</li>
</ul>
</li>
</ul>
<p>Before <code>xsl:evaluate</code> as introduced, there was some concern in the WG about security and the risk of injection attacks. I think that the allow-external-access switch is sufficient for this: if you don't trust the expression, set it to false, and all dangerous things like access to external documents and other resources, use of extension functions, etc, is disabled.</p>
</div></details></div>
<div class="toot" id="agenda-06-27"><h2>QT4 CG meeting 040 draft agenda<span class="toot-id"> #agenda-06-27</span></h2><div class="pubdate">23 Jun at 10:55:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/06-27">https://qt4cg.org/meeting/agenda/2023/06-27</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-571"><h2>Issue #571 created<span class="toot-id"> #created-571</span></h2><div class="pubdate">23 Jun at 09:05:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/571">https://github.com/qt4cg/qtspecs/issues/571</a></div><details><summary>XSLT: xsl:for-each-group/@break-when</summary><div class="markup"><p>The new <code>@break-when</code> attribute on <code>xsl:for-each-group</code></p>
<p>(a) has not been reviewed by the CG</p>
<p>(b) is not mentioned in the changes appendix</p>
<p>(c) is not included in the schema-for-XSLT40</p>
</div></details></div>
<div class="toot" id="created-570"><h2>Issue #570 created<span class="toot-id"> #created-570</span></h2><div class="pubdate">23 Jun at 07:59:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/570">https://github.com/qt4cg/qtspecs/issues/570</a></div><details><summary>XSLT: Built-in template rules for maps and arrays</summary><div class="markup"><p>The current built-in template rules for maps and arrays do not work well for a recursive-descent traversal of a JSON-like tree of maps and arrays. The effect of on-no-match="shallow-copy" is to do a deep copy, and the effect of on-no-match="shallow-skip" is to do a deep skip. I therefore propose two new values for on-no-match, provisionally "shallow-copy-all" and "shallow-skip-all".</p>
<p>For more details see my Balisage 2022 paper: https://balisage.net/Proceedings/vol27/html/Kay01/BalisageVol27-Kay01.html</p>
<p>We do in fact have some test cases that use this syntax, see <code>attr/mode-4001</code> <em>et seq</em>, but it has never found its way into the spec.</p>
</div></details></div>
<div class="toot" id="created-569"><h2>Pull request #569 created<span class="toot-id"> #created-569</span></h2><div class="pubdate">23 Jun at 03:40:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/569">https://github.com/qt4cg/qtspecs/pull/569</a></div><details><summary>Minor editorial corrections, XDM chh. 1, 2</summary><div class="markup"><p>Minor corrections to XDM chapters 1, 2.</p>
<ul>
<li><code>expanded-QName</code> versus <code>expanded QName</code>. The latter outnumbered the former ca. 3:2, and is better, so I with with it.</li>
<li>some language pointing to tables &amp; lines, language rendered obsolete by @ndw 's nice new graphs, excised</li>
<li>other minor edits for clarity, consistency</li>
</ul>
</div></details></div>
<div class="toot" id="created-568"><h2>Pull request #568 created<span class="toot-id"> #created-568</span></h2><div class="pubdate">22 Jun at 20:15:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/568">https://github.com/qt4cg/qtspecs/pull/568</a></div><details><summary>567: schema for xslt40</summary><div class="markup"><p>This PR applies the errata to the XSLT 3.0 version of the schema, and extends the schema to support new syntax that has been introduced in XSLT 4.0.</p>
<p>Fix #567.</p>
</div></details></div>
<div class="toot" id="created-567"><h2>Issue #567 created<span class="toot-id"> #created-567</span></h2><div class="pubdate">22 Jun at 17:24:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/567">https://github.com/qt4cg/qtspecs/issues/567</a></div><details><summary>Errors in schema for XSLT</summary><div class="markup"><p>Erratum E10 for XSLT 3.0 notes a number of errors in the schema for XSLT 3.0. The errata can be found in the repository at https://github.com/w3c/qtspecs/blob/master/errata/xslt-30/errata.xml but they are not published or linked from the spec; they were produced by the XSL WG after publishing 3.0 and before the group disbanded.</p>
<p>The version of the schema found in the 3.0 repository does not include these corrections; therefore, neither does the one in the 4.0 repository.</p>
<p>There is another version of the schema in the xslt30test repository, and this one does include the corrections (as far as I can see).</p>
<p>However, new additions for changes needed for 4.0 have been applied inconsistently to the two versions.</p>
<p>There's therefore a pressing need to bring everything back into line. A good step would be to cut out the duplication: once we've got it clean, the build process should copy qtspecs/specifications/xslt-40/src/schema-for-xslt40.xsd to xslt40-test/tests/misc/catalog/schema-for-xslt40.xsd and we should only maintain the former.</p>
</div></details></div>
<div class="toot" id="created-566"><h2>Issue #566 created<span class="toot-id"> #created-566</span></h2><div class="pubdate">22 Jun at 11:31:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/566">https://github.com/qt4cg/qtspecs/issues/566</a></div><details><summary>fn:parse-uri, fn:build-uri: Feedback</summary><div class="markup"><p>Feedback on <code>fn:parse-uri</code> (thanks, @ndw, for the comprehensible rules in the spec):</p>
<ol>
<li>With the current rules, the port is not detected in <code>http://x:80</code>. Maybe <code>x:</code> is misinterpreted as the beginning of a Windows path?</li>
<li>The <em>uri decoding</em> should be revised. It’s currently possible to create strings with invalid Unicode characters: <code>parse-uri('%FF')</code>. With the current rules, the following expression returns <code>df83</code> and <code>dc00</code>:</li>
</ol>
<pre><code class="language-xquery">parse-uri('%FF00')
=!&gt; map:get('filepath')
=!&gt; string-to-codepoints()
=!&gt; format-integer('16^XX')
</code></pre>
<p>More to come (or not).</p>
</div></details></div>
<div class="toot" id="closed-560"><h2>Issue #560 closed<span class="toot-id"> #closed-560</span></h2><div class="pubdate">22 Jun at 11:23:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/560">https://github.com/qt4cg/qtspecs/issues/560</a></div><p>Formatting Monospace</p></div>
<div class="toot" id="closed-565"><h2>Issue #565 closed<span class="toot-id"> #closed-565</span></h2><div class="pubdate">22 Jun at 09:29:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/565">https://github.com/qt4cg/qtspecs/pull/565</a></div><p>More typographic changes</p></div>
<div class="toot" id="created-565"><h2>Pull request #565 created<span class="toot-id"> #created-565</span></h2><div class="pubdate">22 Jun at 09:21:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/565">https://github.com/qt4cg/qtspecs/pull/565</a></div><details><summary>More typographic changes</summary><div class="markup"><p>Further to #560, I'll just merge this if it passes.</p>
<ol>
<li>Make the <code>&lt;pre&gt;</code> font the same size as the other monospaced environments</li>
<li>Tighten up the spacing in function signatures</li>
<li>Make table-formatted examples use valign=top</li>
<li>Add subtle shading to table-formatted examples so the rows are easier to distinguish.</li>
</ol>
</div></details></div>
<div class="toot" id="created-564"><h2>Issue #564 created<span class="toot-id"> #created-564</span></h2><div class="pubdate">22 Jun at 07:54:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/564">https://github.com/qt4cg/qtspecs/issues/564</a></div><details><summary>Sorted maps</summary><div class="markup"><p>Based on a requirement from Michael Müller-Hillebrand on xsl-list.</p>
<p>We could define a variant of map:build() that constructs a sorted map. If a map is sorted, then:</p>
<ul>
<li>map:is-sorted() returns true.</li>
<li>map:keys() returns the keys in sorted order.</li>
<li>map:range(map, min, max) returns a sorted sub-map whose keys lie within a particular range</li>
<li>map:get-by-prefix() returns the values whose keys start with a given substring</li>
</ul>
</div></details></div>
<div class="toot" id="closed-563"><h2>Issue #563 closed<span class="toot-id"> #closed-563</span></h2><div class="pubdate">21 Jun at 12:15:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/563">https://github.com/qt4cg/qtspecs/pull/563</a></div><p>Style and other editorial fixes</p></div>
<div class="toot" id="created-563"><h2>Pull request #563 created<span class="toot-id"> #created-563</span></h2><div class="pubdate">21 Jun at 11:47:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/563">https://github.com/qt4cg/qtspecs/pull/563</a></div><details><summary>Style and other editorial fixes</summary><div class="markup"><p>This PR mostly attempts to fix #560 by making the formatting of code more consistent.</p>
<ol>
<li>I removed the reference to the W3C CSS and made a local copy</li>
<li>Added CSS variables for code parameters and tried to make use of them everywhere</li>
<li>I removed the use of "font:small" in index tables, so they're a little easier to read</li>
<li>I noticed and fixed two places where we had old-style type hierarchy diagrams</li>
</ol>
<p>These fixes aren't going to be visible in the PR build, so I'm just going to merge it.</p>
</div></details></div>
<div class="toot" id="created-562"><h2>Pull request #562 created<span class="toot-id"> #created-562</span></h2><div class="pubdate">21 Jun at 09:03:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/562">https://github.com/qt4cg/qtspecs/pull/562</a></div><details><summary>361: Named arguments: $input vs. $value</summary><div class="markup"><p>#361: Just an editorial one to get one more issue closed.</p>
</div></details></div>
<div class="toot" id="minutes-06-20"><h2>QT4 CG meeting 039 draft minutes<span class="toot-id"> #minutes-06-20</span></h2><div class="pubdate">20 Jun at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/06-20">https://qt4cg.org/meeting/minutes/2023/06-20</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-526"><h2>Issue #526 closed<span class="toot-id"> #closed-526</span></h2><div class="pubdate">20 Jun at 16:49:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/526">https://github.com/qt4cg/qtspecs/issues/526</a></div><p>load-xquery-module() needs changes to account for functions with an arity range</p></div>
<div class="toot" id="closed-548"><h2>Issue #548 closed<span class="toot-id"> #closed-548</span></h2><div class="pubdate">20 Jun at 16:49:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/548">https://github.com/qt4cg/qtspecs/issues/548</a></div><p>Space separation in lambda expressions</p></div>
<div class="toot" id="created-561"><h2>Issue #561 created<span class="toot-id"> #created-561</span></h2><div class="pubdate">20 Jun at 16:44:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/561">https://github.com/qt4cg/qtspecs/issues/561</a></div><details><summary>Alias for `function` keyword; drop thin arrow syntax?</summary><div class="markup"><p>See https://github.com/qt4cg/qtspecs/issues/548#issuecomment-1591023928 and the subsequent comments:</p>
<blockquote>
<p>[…] I would still be in favor to have <code>fn</code> or <code>f</code> as a plain alias for <code>function</code> (and optionally drop the thin arrow syntax), simply because function items and declarations can get so frequent:</p>
</blockquote>
<pre><code class="language-xquery">fn($a) { $a + 1 }
fn { . + 1 }
</code></pre>
</div></details></div>
<div class="toot" id="closed-552"><h2>Issue #552 closed<span class="toot-id"> #closed-552</span></h2><div class="pubdate">20 Jun at 16:41:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/552">https://github.com/qt4cg/qtspecs/pull/552</a></div><p>Editorial: Updates to back matter and status section of F+O spec</p></div>
<div class="toot" id="closed-559"><h2>Issue #559 closed<span class="toot-id"> #closed-559</span></h2><div class="pubdate">20 Jun at 16:39:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/559">https://github.com/qt4cg/qtspecs/pull/559</a></div><p>Minor editorial edits</p></div>
<div class="toot" id="closed-558"><h2>Issue #558 closed<span class="toot-id"> #closed-558</span></h2><div class="pubdate">20 Jun at 16:38:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/558">https://github.com/qt4cg/qtspecs/pull/558</a></div><p>Added fn:items-X cross-references</p></div>
<div class="toot" id="closed-316"><h2>Issue #316 closed<span class="toot-id"> #closed-316</span></h2><div class="pubdate">20 Jun at 16:38:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/316">https://github.com/qt4cg/qtspecs/issues/316</a></div><p>Function fn:differences</p></div>
<div class="toot" id="closed-551"><h2>Issue #551 closed<span class="toot-id"> #closed-551</span></h2><div class="pubdate">20 Jun at 16:38:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/551">https://github.com/qt4cg/qtspecs/pull/551</a></div><p>316: Drop the fn:differences function</p></div>
<div class="toot" id="closed-550"><h2>Issue #550 closed<span class="toot-id"> #closed-550</span></h2><div class="pubdate">20 Jun at 16:38:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/550">https://github.com/qt4cg/qtspecs/pull/550</a></div><p>548: require parens around lambda arguments</p></div>
<div class="toot" id="closed-549"><h2>Issue #549 closed<span class="toot-id"> #closed-549</span></h2><div class="pubdate">20 Jun at 16:37:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/549">https://github.com/qt4cg/qtspecs/pull/549</a></div><p>526 load xquery module</p></div>
<div class="toot" id="closed-82"><h2>Issue #82 closed<span class="toot-id"> #closed-82</span></h2><div class="pubdate">20 Jun at 16:36:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/82">https://github.com/qt4cg/qtspecs/issues/82</a></div><p>Should the mode attribute for apply-templates in templates of enclosed modes default to #current?</p></div>
<div class="toot" id="closed-112"><h2>Issue #112 closed<span class="toot-id"> #closed-112</span></h2><div class="pubdate">20 Jun at 16:36:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/112">https://github.com/qt4cg/qtspecs/issues/112</a></div><p>Abbreviate `map:function($someMap)` to `$someMap?function()`</p></div>
<div class="toot" id="closed-331"><h2>Issue #331 closed<span class="toot-id"> #closed-331</span></h2><div class="pubdate">20 Jun at 16:36:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/331">https://github.com/qt4cg/qtspecs/issues/331</a></div><p>Extend fn:path to support arrays and maps.</p></div>
<div class="toot" id="closed-376"><h2>Issue #376 closed<span class="toot-id"> #closed-376</span></h2><div class="pubdate">20 Jun at 16:35:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/376">https://github.com/qt4cg/qtspecs/issues/376</a></div><p>add documentation prefix attribute to xsl:stylesheet</p></div>
<div class="toot" id="closed-399"><h2>Issue #399 closed<span class="toot-id"> #closed-399</span></h2><div class="pubdate">20 Jun at 16:35:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/399">https://github.com/qt4cg/qtspecs/issues/399</a></div><p>fn:deep-equal: Using Multilevel Hierarchy and Abstraction when designing and specifying complex functions</p></div>
<div class="toot" id="closed-425"><h2>Issue #425 closed<span class="toot-id"> #closed-425</span></h2><div class="pubdate">20 Jun at 16:35:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/425">https://github.com/qt4cg/qtspecs/issues/425</a></div><p>Structural proposal (ThinLayer:tm:) : Add a layer of thin spec between XPath and the XPath Derived Language</p></div>
<div class="toot" id="created-560"><h2>Issue #560 created<span class="toot-id"> #created-560</span></h2><div class="pubdate">20 Jun at 09:23:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/560">https://github.com/qt4cg/qtspecs/issues/560</a></div><details><summary>Formatting Monospace</summary><div class="markup"><p>It would be great if we could further tweak and unify the representation of monospaced text. On my machine, I see…</p>
<ul>
<li><code>monospace</code> (13px) for the function signature (using <code>&lt;code&gt;</code> instead of <code>&lt;pre&gt;</code>, with increased line heights)</li>
<li><code>monospace</code> (11.7px) for <code>&lt;code&gt;</code></li>
<li><code>Menlo, Consolas, "DejaVu Sans Mono", ...</code> (13px) for <code>&lt;pre&gt;</code></li>
<li><code>Menlo, Consolas, "DejaVu Sans Mono", ...</code> (14,4px) for <code>&lt;pre&gt;</code> in examples</li>
</ul>
<p>…and I guess there are other cases. Would it be possible to use the same font style, size &amp; line height for monospaced text? Maybe a friendlier light grey color for all <code>&lt;pre&gt;</code> blocks, similar to the GitHub rendering.</p>
<hr>
<p><img src="https://github.com/qt4cg/qtspecs/assets/196589/7a3bdc02-b181-4370-b2ee-2a5ca2b05e04" alt="image"></p>
</div></details></div>
<div class="toot" id="created-559"><h2>Pull request #559 created<span class="toot-id"> #created-559</span></h2><div class="pubdate">19 Jun at 20:27:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/559">https://github.com/qt4cg/qtspecs/pull/559</a></div><details><summary>Minor editorial edits</summary><div class="markup"><p>The submitted edits are based upon a fresh reading of the serialization specs, and should all be relatively minor. Review would be appreciated, as small errors can have significant consequences.</p>
</div></details></div>
<div class="toot" id="created-558"><h2>Pull request #558 created<span class="toot-id"> #created-558</span></h2><div class="pubdate">19 Jun at 19:22:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/558">https://github.com/qt4cg/qtspecs/pull/558</a></div><details><summary>Added fn:items-X cross-references</summary><div class="markup"><p>This PR provides cross-references in the form of notes between members of the pairs <code>items-before()</code> &amp; <code>items-ending-where()</code> and <code>items-after()</code> &amp; <code>items-starting-where()</code>. The goal is a light editorial intervention to enhance function discovery. (Anticipating a user who, at any one of these spec descriptions, wonders how they might exclude/include the first matching item.)</p>
</div></details></div>
<div class="toot" id="agenda-06-20"><h2>QT4 CG meeting 039 draft agenda<span class="toot-id"> #agenda-06-20</span></h2><div class="pubdate">19 Jun at 10:55:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/06-20">https://qt4cg.org/meeting/agenda/2023/06-20</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-512"><h2>Issue #512 closed<span class="toot-id"> #closed-512</span></h2><div class="pubdate">19 Jun at 10:06:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/512">https://github.com/qt4cg/qtspecs/pull/512</a></div><p>256: Context for default function parameter expressions</p></div>
<div class="toot" id="closed-3"><h2>Issue #3 closed<span class="toot-id"> #closed-3</span></h2><div class="pubdate">19 Jun at 09:55:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/3">https://github.com/qt4cg/qtspecs/issues/3</a></div><p>Allow tokens in xsl:mode/@name</p></div>
<div class="toot" id="created-557"><h2>Issue #557 created<span class="toot-id"> #created-557</span></h2><div class="pubdate">17 Jun at 12:31:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/557">https://github.com/qt4cg/qtspecs/issues/557</a></div><details><summary>fn:unparsed-binary: accessing and manipulating binary types</summary><div class="markup"><p>Dear All,
When working with binary types currently one has to fall back to string conversions and/or extensions.
A few ideas on nice to have functions that operate on binary types:
-accessing a single byte at a specific position
-splitting binary data at byte boundary (aka binary-subsequence)
-converting to/from a sequence of byte(s)
-joining binary data together
-(optionally) loading data directly as (base64)binary (some extensions are using unparsed-text with proprietary decoding 'x-binarytobase64' to retrieve a base64 castable string)
-standard bit-wise operators and, or, xor, not, rshift, lshift</p>
<p>If considered, then each needs to be discussed in detail separately -ex. which type to support signed/unsigned, 8 bit etc.-, I merely intend as conversation starter in case others encountered similar issues/limitations.</p>
<p><em>p.s.: Not sure if this is the right channel to raise this issue, so feel free to close/move/split accordingly.</em></p>
</div></details></div>
<div class="toot" id="created-556"><h2>Issue #556 created<span class="toot-id"> #created-556</span></h2><div class="pubdate">16 Jun at 02:53:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/556">https://github.com/qt4cg/qtspecs/issues/556</a></div><details><summary>Serialization phase 5 note unclear</summary><div class="markup"><p><a href="https://qt4cg.org/specifications/xslt-xquery-serialization-40/Overview-diff.html#serphases">Section 4</a> of the Serialization spects ends with this note:</p>
<blockquote>
<p>Serialization is only defined in terms of encoding the result as a stream of octets. However, a <a href="https://qt4cg.org/specifications/xslt-xquery-serialization-40/Overview-diff.html#serializer">serializer</a> MAY provide an option that allows the encoding phase to be skipped, so that the result of serialization is a stream of Unicode characters.</p>
</blockquote>
<p>What is a stream of Unicode characters? AFAIK, Unicode characters cannot be streamed <em>an sich</em> but require some encoding. And how does would such a stream not consist of bytes/octets of one sort or another? A stream of what exactly?</p>
</div></details></div>
<div class="toot" id="created-555"><h2>Pull request #555 created<span class="toot-id"> #created-555</span></h2><div class="pubdate">16 Jun at 00:02:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/555">https://github.com/qt4cg/qtspecs/pull/555</a></div><details><summary>464: Revised narrative of normalization steps for serialization</summary><div class="markup"><p>This PR acts on #464 by revising the description of steps involved in normalizing a sequence that is input to serialization. I normally would wield a light editorial hand, but the issues raised in #464 as well as closer reading of the prose convinced me that a wholesale revision would be beneficial. For example, new sequences were described as if the reader already knew about them, but they are really only introduced as the last sentence in many steps.</p>
<p>I have capitalized on the original version of step 1's appeal to <code>array:flatten</code> to abbreviate the description for two of the steps.</p>
</div></details></div>
<div class="toot" id="closed-518"><h2>Issue #518 closed<span class="toot-id"> #closed-518</span></h2><div class="pubdate">15 Jun at 02:10:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/518">https://github.com/qt4cg/qtspecs/issues/518</a></div><p>transitive-closure() function</p></div>
<div class="toot" id="created-554"><h2>Issue #554 created<span class="toot-id"> #created-554</span></h2><div class="pubdate">15 Jun at 01:49:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/554">https://github.com/qt4cg/qtspecs/issues/554</a></div><details><summary>The Transitive Closure function produces an incomplete result, completeness/success and number of actual iterations must also be returned</summary><div class="markup"><p>@michaelhkay and CG members,</p>
<p>I initially reopened <strong><a href="https://github.com/qt4cg/qtspecs/issues/518">the original issue</a></strong>, because there is some useful and needed functionality that the PR and the text of the FO specification do not provide, and we missed to discuss this at the June 13th meeting.</p>
<p><strong>I believe that typically a developer would need to know if the "whole" TC was completely produced, or not, and maybe how many iterations were needed</strong>.</p>
<p>This can be provided if the result of the function was for example:</p>
<pre><code class="language-xq">map{ 
        "TC" : $thefinalTCNodeset,
        "WasTCComplete": $boolForTCCompletion,
        "NumberOfIterations: $someInteger
       }
</code></pre>
<p>One could argue that if <strong><em><code>$result? NumberOfIterations &lt; max</code></em></strong>, then we know that the complete TC was produced and thus we don't need the member "WasTCComplete".</p>
<p>However, this is not the case when <strong><em><code>$result? NumberOfIterations eq max</code></em></strong>. In this case both outcomes are possible: the complete TC was produced exactly in <code>max</code> iterations (so the value of <code>"WasTCComplete"</code>  must be <code>true()</code> ), or <code>max</code> iterations were performed and the <code>max + 1</code>st iteration produced additional nodes -- in this case <code>"WasTCComplete"</code> must be <code>false()</code>.</p>
<p><strong>Failure to produce the complete TC in many cases will be regarded as error, and the developer needs to be sure that this was (or this wasn't) the case</strong>.</p>
<p>thus, the current specification of this function needs additional work to accomodate the full needed functionality.</p>
</div></details></div>
<div class="toot" id="created-553"><h2>Issue #553 created<span class="toot-id"> #created-553</span></h2><div class="pubdate">15 Jun at 00:09:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/553">https://github.com/qt4cg/qtspecs/issues/553</a></div><details><summary>New function fn:substitute()</summary><div class="markup"><p>The discussion on the parse-csv() use cases suggests there would be value in a function</p>
<p><code>fn:substitute($value as item()*, $pos as xs:positiveInteger, $mangler as function(item()) as item()) as item()*</code></p>
<p>whose effect is to return the input sequence <code>$value</code> with the item at position <code>$pos</code> replaced by the result of invoking <code>$mangler</code> on that item.</p>
<p>This should be aligned with similar functions for maps and arrays.</p>
</div></details></div>
<div class="toot" id="created-552"><h2>Pull request #552 created<span class="toot-id"> #created-552</span></h2><div class="pubdate">14 Jun at 21:32:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/552">https://github.com/qt4cg/qtspecs/pull/552</a></div><details><summary>Editorial: Updates to back matter and status section of F+O spec</summary><div class="markup"><p>Mainly updates to the changes appendix. Also improve the status section, and correct the bibref to the EXSLT specs.</p>
</div></details></div>
<div class="toot" id="closed-256"><h2>Issue #256 closed<span class="toot-id"> #closed-256</span></h2><div class="pubdate">14 Jun at 20:10:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/256">https://github.com/qt4cg/qtspecs/issues/256</a></div><p>Function declarations: static and dynamic context for default parameter values</p></div>
<div class="toot" id="closed-275"><h2>Issue #275 closed<span class="toot-id"> #closed-275</span></h2><div class="pubdate">14 Jun at 20:08:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/275">https://github.com/qt4cg/qtspecs/issues/275</a></div><p>Problems with nt/xnt links to grammar terms</p></div>
<div class="toot" id="created-551"><h2>Pull request #551 created<span class="toot-id"> #created-551</span></h2><div class="pubdate">14 Jun at 20:04:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/551">https://github.com/qt4cg/qtspecs/pull/551</a></div><details><summary>316: Drop the fn:differences function</summary><div class="markup"><p>Fix #316</p>
<p>The draft specification for fn:differences was added to the spec before we had a review process in place. The spec is complex and incomplete; issue #316 points out some of the difficulties. This PR removes it from the spec.</p>
<p>Note that fn:deep-equal() now has a debug option which outputs diagnostic information in implementation-defined format; although not interoperable, this meets the main use case, which is to discover for diagnostic purposes why and in what way two values are not deep-equal to each other.</p>
</div></details></div>
<div class="toot" id="created-550"><h2>Pull request #550 created<span class="toot-id"> #created-550</span></h2><div class="pubdate">14 Jun at 08:47:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/550">https://github.com/qt4cg/qtspecs/pull/550</a></div><details><summary>548: require parens around lambda arguments</summary><div class="markup"><p>Require parentheses around the parameter list in a lambda expression, even when there is only one parameter, to avoid the problem of needing whitespace before the arrow. Resolves issue #548.</p>
</div></details></div>
<div class="toot" id="closed-327"><h2>Issue #327 closed<span class="toot-id"> #closed-327</span></h2><div class="pubdate">14 Jun at 00:03:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/327">https://github.com/qt4cg/qtspecs/issues/327</a></div><p>Tokenisation</p></div>
<div class="toot" id="closed-333"><h2>Issue #333 closed<span class="toot-id"> #closed-333</span></h2><div class="pubdate">13 Jun at 23:55:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/333">https://github.com/qt4cg/qtspecs/issues/333</a></div><p>Equality of function items</p></div>
<div class="toot" id="closed-382"><h2>Issue #382 closed<span class="toot-id"> #closed-382</span></h2><div class="pubdate">13 Jun at 23:49:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/382">https://github.com/qt4cg/qtspecs/issues/382</a></div><p>Improve whitespace handling in deep-equal</p></div>
<div class="toot" id="closed-536"><h2>Issue #536 closed<span class="toot-id"> #closed-536</span></h2><div class="pubdate">13 Jun at 23:49:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/536">https://github.com/qt4cg/qtspecs/issues/536</a></div><p>Re: Mathematical Operator Symbols</p></div>
<div class="toot" id="closed-513"><h2>Issue #513 closed<span class="toot-id"> #closed-513</span></h2><div class="pubdate">13 Jun at 23:48:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/513">https://github.com/qt4cg/qtspecs/issues/513</a></div><p>Arrow operator: Inline functions without parens</p></div>
<div class="toot" id="created-549"><h2>Pull request #549 created<span class="toot-id"> #created-549</span></h2><div class="pubdate">13 Jun at 23:46:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/549">https://github.com/qt4cg/qtspecs/pull/549</a></div><details><summary>526 load xquery module</summary><div class="markup"><p>Updates the spec of fn:load-query-module to handle functions with optional parameters. Resolves issue #526</p>
</div></details></div>
<div class="toot" id="minutes-06-13"><h2>QT4 CG meeting 038 draft minutes<span class="toot-id"> #minutes-06-13</span></h2><div class="pubdate">13 Jun at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/06-13">https://qt4cg.org/meeting/minutes/2023/06-13</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-521"><h2>Issue #521 closed<span class="toot-id"> #closed-521</span></h2><div class="pubdate">13 Jun at 16:34:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/521">https://github.com/qt4cg/qtspecs/pull/521</a></div><p>518: Add transitive-closure() function</p></div>
<div class="toot" id="closed-545"><h2>Issue #545 closed<span class="toot-id"> #closed-545</span></h2><div class="pubdate">13 Jun at 16:33:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/545">https://github.com/qt4cg/qtspecs/pull/545</a></div><p>513: after arrow operator, inline function no longer needs parens</p></div>
<div class="toot" id="closed-544"><h2>Issue #544 closed<span class="toot-id"> #closed-544</span></h2><div class="pubdate">13 Jun at 16:33:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/544">https://github.com/qt4cg/qtspecs/pull/544</a></div><p>536: disallow mixing of symbols in operator tokens</p></div>
<div class="toot" id="closed-543"><h2>Issue #543 closed<span class="toot-id"> #closed-543</span></h2><div class="pubdate">13 Jun at 16:32:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/543">https://github.com/qt4cg/qtspecs/pull/543</a></div><p>382 simplify rules for whitespace in fn:deep-equal</p></div>
<div class="toot" id="closed-542"><h2>Issue #542 closed<span class="toot-id"> #closed-542</span></h2><div class="pubdate">13 Jun at 16:32:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/542">https://github.com/qt4cg/qtspecs/pull/542</a></div><p>Fixes a simple error in the description of XSLT error XTSE4020</p></div>
<div class="toot" id="closed-541"><h2>Issue #541 closed<span class="toot-id"> #closed-541</span></h2><div class="pubdate">13 Jun at 16:32:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/541">https://github.com/qt4cg/qtspecs/pull/541</a></div><p>Fix typo in XPath §2.4.5 - E1 should be tagged as code not as var.</p></div>
<div class="toot" id="created-548"><h2>Issue #548 created<span class="toot-id"> #created-548</span></h2><div class="pubdate">13 Jun at 07:55:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/548">https://github.com/qt4cg/qtspecs/issues/548</a></div><details><summary>Space separation in lambda expressions</summary><div class="markup"><p>Currently the expression <code>$a -&gt; {$a+1}</code> requires a space before the arrow, because the hyphen is otherwise tokenized as part of the variable name.</p>
<p>Not only is this a very easy trap to fall into, it also tends to result in poor diagnostics because we're in lookahead territory where we are also considering an alternative parse along the lines <code>$a- &gt; EXPR</code> (where the variable name is <code>a-</code>), and this parse only gets disqualified because an expression can't begin with <code>{</code>.</p>
<p>If we later introduce expressions that start with <code>{</code>, writing <code>$a-&gt;{3}</code> with no space would no longer be an error, it would just mean something completely different from what you intended.</p>
<p>One solution, not a very pretty one, is to require parentheses around the argument list even when there is only a single argument. Almost as inconvenient as requiring the space, but with better diagnostics if you forget.</p>
<p>Another solution might be to restrict the parameter name so it can't contain a hyphen. The problem with that is that the tokenization becomes sensitive to the grammatical context, which is not totally unexplored territory, but complicates the fact that we're already in lookahead territory where we are looking at alternative parses. (The Saxon implementation already does the lookahead by retokenizing, so it's not impossible.)</p>
<p>Would it be too horrendous to contemplate a backwards-incompatible change to say variable names cannot end in a hyphen, anywhere? Perhaps with a mode bit for compatibility? After all, all this complication is caused by the need to cater for something which no sane user ever does.</p>
</div></details></div>
<div class="toot" id="created-547"><h2>Pull request #547 created<span class="toot-id"> #created-547</span></h2><div class="pubdate">12 Jun at 15:24:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/547">https://github.com/qt4cg/qtspecs/pull/547</a></div><details><summary>Action QT4CG-036-02: Further elaboration of the rules for function identity</summary><div class="markup"><p>Following review and acceptance of the proposal introducing the concept of function identity (PR #525, Issue #520) this PR makes some refinements in response to comments raised during the review, especially in the following areas:</p>
<ul>
<li>clarification as regards named function references to context-dependent functions</li>
<li>relationship to (in)determinacy of a function</li>
<li>avoiding the phrase "new function item"</li>
<li>stating that the identity of a function item such as fn:count#1 applies even across execution scopes, e.g. calls to fn:transform.</li>
</ul>
</div></details></div>
<div class="toot" id="created-546"><h2>Pull request #546 created<span class="toot-id"> #created-546</span></h2><div class="pubdate">12 Jun at 13:28:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/546">https://github.com/qt4cg/qtspecs/pull/546</a></div><details><summary>414: Attempt to implement expanding the allowed character repertoire</summary><div class="markup"><p>Fix #414</p>
<p>This PR addresses ACTION QT4CG-036-01 on me.</p>
</div></details></div>
<div class="toot" id="agenda-06-13"><h2>QT4 CG meeting 038 draft agenda<span class="toot-id"> #agenda-06-13</span></h2><div class="pubdate">11 Jun at 18:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/06-13">https://qt4cg.org/meeting/agenda/2023/06-13</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-545"><h2>Pull request #545 created<span class="toot-id"> #created-545</span></h2><div class="pubdate">09 Jun at 20:52:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/545">https://github.com/qt4cg/qtspecs/pull/545</a></div><details><summary>513: after arrow operator, inline function no longer needs parens</summary><div class="markup"><p>Resolves issue #513 by removing the requirement for an inline function expression on the RHS of an arrow operator to be enclosed in parentheses.</p>
</div></details></div>
<div class="toot" id="created-544"><h2>Pull request #544 created<span class="toot-id"> #created-544</span></h2><div class="pubdate">09 Jun at 16:51:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/544">https://github.com/qt4cg/qtspecs/pull/544</a></div><details><summary>536: disallow mixing of symbols in operator tokens</summary><div class="markup"><p>As proposed in issue #536, this change disallows mixing of ordinary and full-width angle brackets in the same token.</p>
</div></details></div>
<div class="toot" id="created-543"><h2>Pull request #543 created<span class="toot-id"> #created-543</span></h2><div class="pubdate">09 Jun at 15:24:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/543">https://github.com/qt4cg/qtspecs/pull/543</a></div><details><summary>382 simplify rules for whitespace in fn:deep-equal</summary><div class="markup"><p>My previous attempt to make a pull request for this change got lost somewhere in the process; here is a renewed attempt. The changes are in response to comments made during the review of the orginal deep-equal() proposal, recorded in issue #382</p>
</div></details></div>
<div class="toot" id="closed-497"><h2>Issue #497 closed<span class="toot-id"> #closed-497</span></h2><div class="pubdate">09 Jun at 11:44:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/497">https://github.com/qt4cg/qtspecs/issues/497</a></div><p>https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-map-pairs has wrong function syntax order</p></div>
<div class="toot" id="created-542"><h2>Pull request #542 created<span class="toot-id"> #created-542</span></h2><div class="pubdate">09 Jun at 11:36:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/542">https://github.com/qt4cg/qtspecs/pull/542</a></div><details><summary>Fixes a simple error in the description of XSLT error XTSE4020</summary><div class="markup"><p>A comment to issue #82 identified this typo.</p>
</div></details></div>
<div class="toot" id="created-541"><h2>Pull request #541 created<span class="toot-id"> #created-541</span></h2><div class="pubdate">09 Jun at 11:34:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/541">https://github.com/qt4cg/qtspecs/pull/541</a></div><details><summary>Fix typo in XPath §2.4.5 - E1 should be tagged as code not as var.</summary><div class="markup"><p>A trivial markup error that leads to the meta-variable E1 being wrongly rendered.</p>
</div></details></div>
<div class="toot" id="closed-66"><h2>Issue #66 closed<span class="toot-id"> #closed-66</span></h2><div class="pubdate">09 Jun at 11:27:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/66">https://github.com/qt4cg/qtspecs/issues/66</a></div><p>ThinArrowTarget should use FunctionBody</p></div>
<div class="toot" id="closed-78"><h2>Issue #78 closed<span class="toot-id"> #closed-78</span></h2><div class="pubdate">09 Jun at 11:26:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/78">https://github.com/qt4cg/qtspecs/issues/78</a></div><p>Specify strict order of evaluation for a subexpression </p></div>
<div class="toot" id="closed-98"><h2>Issue #98 closed<span class="toot-id"> #closed-98</span></h2><div class="pubdate">09 Jun at 10:22:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/98">https://github.com/qt4cg/qtspecs/issues/98</a></div><p>Support ignoring whitespace/indentation differences in fn:deep-equal.</p></div>
<div class="toot" id="closed-125"><h2>Issue #125 closed<span class="toot-id"> #closed-125</span></h2><div class="pubdate">09 Jun at 10:20:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/125">https://github.com/qt4cg/qtspecs/issues/125</a></div><p>array:partition → fn:partition: empty results; examples</p></div>
<div class="toot" id="closed-384"><h2>Issue #384 closed<span class="toot-id"> #closed-384</span></h2><div class="pubdate">09 Jun at 09:20:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/384">https://github.com/qt4cg/qtspecs/issues/384</a></div><p>Definition of "effective value" in XSLT</p></div>
<div class="toot" id="closed-418"><h2>Issue #418 closed<span class="toot-id"> #closed-418</span></h2><div class="pubdate">09 Jun at 09:18:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/418">https://github.com/qt4cg/qtspecs/issues/418</a></div><p>array and map attribute in xsl:iterate and xsl:for-each-group</p></div>
<div class="toot" id="closed-503"><h2>Issue #503 closed<span class="toot-id"> #closed-503</span></h2><div class="pubdate">09 Jun at 09:14:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/503">https://github.com/qt4cg/qtspecs/issues/503</a></div><p>Reinstate focus functions</p></div>
<div class="toot" id="closed-381"><h2>Issue #381 closed<span class="toot-id"> #closed-381</span></h2><div class="pubdate">09 Jun at 09:13:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/381">https://github.com/qt4cg/qtspecs/issues/381</a></div><p>Deep-equal comparisons without errors</p></div>
<div class="toot" id="closed-520"><h2>Issue #520 closed<span class="toot-id"> #closed-520</span></h2><div class="pubdate">09 Jun at 09:11:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/520">https://github.com/qt4cg/qtspecs/issues/520</a></div><p>Function identity</p></div>
<div class="toot" id="closed-530"><h2>Issue #530 closed<span class="toot-id"> #closed-530</span></h2><div class="pubdate">09 Jun at 09:09:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/530">https://github.com/qt4cg/qtspecs/issues/530</a></div><p>Escaping of forward slash in JSON output method</p></div>
<div class="toot" id="created-540"><h2>Issue #540 created<span class="toot-id"> #created-540</span></h2><div class="pubdate">08 Jun at 09:24:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/540">https://github.com/qt4cg/qtspecs/issues/540</a></div><details><summary>Add fn:system-property() to XQuery</summary><div class="markup"><p>XSLT has specific additions to the XPath function library to facilitate identifying the running implementation:</p>
<ul>
<li>https://www.w3.org/TR/xslt-30/#func-system-property</li>
<li>https://www.w3.org/TR/xslt-30/#func-available-system-properties</li>
</ul>
<p>These would be useful for XQuery too. There should be something better than the fragile sadness of
https://github.com/AndrewSales/XQS/blob/461a90a8e2f49d9ef646ff6940c6962f18c0f43a/port.xqm#L3-L12</p>
</div></details></div>
<div class="toot" id="created-539"><h2>Issue #539 created<span class="toot-id"> #created-539</span></h2><div class="pubdate">06 Jun at 20:20:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/539">https://github.com/qt4cg/qtspecs/issues/539</a></div><details><summary>FLOWR where clause with a "do when false" option</summary><div class="markup"><p>This is a request for an enhancement.</p>
<p>Fairly often, I'll have a query arranged as</p>
<p>let $step1 := <em>do some processing</em>
where exists($step1)
let $step2 := <em>processing based on step1</em>
where exists($step2)</p>
<p>and so on.</p>
<p>This is a convenient pattern until I want to emit some sort of message about where the process stops.</p>
<p>It would be convenient to have</p>
<p>where <em>expression</em> else <em>expression</em></p>
<p>with the else as an optional extension of the where clause to allow emitting information about which where clause the FLOWR expression stopped on.</p>
<p>It might be more congruent to the style of the language as</p>
<p>where <em>expression</em> return <em>expression</em></p>
<p>but then again having multiple return keywords isn't obviously a good thing.</p>
</div></details></div>
<div class="toot" id="minutes-06-06"><h2>QT4 CG meeting 037 draft minutes<span class="toot-id"> #minutes-06-06</span></h2><div class="pubdate">06 Jun at 17:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/06-06">https://qt4cg.org/meeting/minutes/2023/06-06</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-531"><h2>Issue #531 closed<span class="toot-id"> #closed-531</span></h2><div class="pubdate">06 Jun at 16:06:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/531">https://github.com/qt4cg/qtspecs/issues/531</a></div><p>grammar production LambdaParams has "(" and ")" incorrectly under the choice</p></div>
<div class="toot" id="closed-532"><h2>Issue #532 closed<span class="toot-id"> #closed-532</span></h2><div class="pubdate">06 Jun at 16:06:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/532">https://github.com/qt4cg/qtspecs/pull/532</a></div><p>fix error in LambdaParams rule</p></div>
<div class="toot" id="closed-534"><h2>Issue #534 closed<span class="toot-id"> #closed-534</span></h2><div class="pubdate">06 Jun at 16:06:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/534">https://github.com/qt4cg/qtspecs/pull/534</a></div><p>530: escape solidus in JSON</p></div>
<div class="toot" id="closed-535"><h2>Issue #535 closed<span class="toot-id"> #closed-535</span></h2><div class="pubdate">06 Jun at 16:06:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/535">https://github.com/qt4cg/qtspecs/pull/535</a></div><p>Editorial: add an entry to the changes appendix</p></div>
<div class="toot" id="created-538"><h2>Pull request #538 created<span class="toot-id"> #created-538</span></h2><div class="pubdate">06 Jun at 13:25:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/538">https://github.com/qt4cg/qtspecs/pull/538</a></div><details><summary>480: Attempt to allow xs:string to be 'promoted to' xs:anyURI</summary><div class="markup"><p>I think it might be a little cheeky to call it "promotion" in both directions, but this really has more to do with a kind of conversion, so I'm willing to let it slide.</p>
<p>If accepted, this PR resolves ACTION QT4CG-035-03.</p>
</div></details></div>
<div class="toot" id="closed-537"><h2>Issue #537 closed<span class="toot-id"> #closed-537</span></h2><div class="pubdate">05 Jun at 16:27:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/537">https://github.com/qt4cg/qtspecs/pull/537</a></div><p>Editorial: present F&amp;O examples as tables.</p></div>
<div class="toot" id="created-537"><h2>Pull request #537 created<span class="toot-id"> #created-537</span></h2><div class="pubdate">05 Jun at 14:28:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/537">https://github.com/qt4cg/qtspecs/pull/537</a></div><details><summary>Editorial: present F&amp;O examples as tables.</summary><div class="markup"><p>This is a purely editorial change to the stylesheet that formats examples in the F&amp;O spec; it changes the presentation to be a two-column table containing expressions and results. The intention is to reduce clutter and to improve the readability where code samples (either expressions or results) need multi-line rendition.</p>
<p>In the vast majority of cases the change is clearly (IMHO) an improvement, but further tweaking is possible:</p>
<ul>
<li>There may be scope for tailoring the CSS (for example, I don't like the fact that table cells are centred vertically).</li>
<li>Some of the tables (e.g. parse-uri examples) take too much horizontal space; the code should be edited to reduce the line length</li>
<li>Examples are sometimes introduced with a free-standing paragraph tag rather than with fo:preamble, which separates the introduction from the code into a separate table row.</li>
<li>Some of the examples that were designed for inline rendition could usefully take advantage of the opportunity to turn them into multi-line code samples.</li>
</ul>
</div></details></div>
<div class="toot" id="agenda-06-06"><h2>QT4 CG meeting 037 draft agenda<span class="toot-id"> #agenda-06-06</span></h2><div class="pubdate">05 Jun at 09:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/06-06">https://qt4cg.org/meeting/agenda/2023/06-06</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-536"><h2>Issue #536 created<span class="toot-id"> #created-536</span></h2><div class="pubdate">03 Jun at 15:41:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/536">https://github.com/qt4cg/qtspecs/issues/536</a></div><details><summary>Re: Mathematical Operator Symbols</summary><div class="markup"><p>#460</p>
<p><code>=!&gt;</code> is not mentioned in A 3.3</p>
<p>Also, I do not think it makes sense to allow mixing both characters in one operator, like in <code>＜&lt;</code>. It combines the disadvantages of <code>&lt;&lt;</code> and <code>＜＜</code> without any advantages</p>
</div></details></div>
<div class="toot" id="created-535"><h2>Pull request #535 created<span class="toot-id"> #created-535</span></h2><div class="pubdate">03 Jun at 14:22:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/535">https://github.com/qt4cg/qtspecs/pull/535</a></div><p>Editorial: add an entry to the changes appendix</p></div>
<div class="toot" id="created-534"><h2>Pull request #534 created<span class="toot-id"> #created-534</span></h2><div class="pubdate">31 May at 17:27:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/534">https://github.com/qt4cg/qtspecs/pull/534</a></div><details><summary>530: escape solidus in JSON</summary><div class="markup"><p>Add <code>escape-solidus</code> serialization parameter for the JSON output method.</p>
</div></details></div>
<div class="toot" id="created-533"><h2>Pull request #533 created<span class="toot-id"> #created-533</span></h2><div class="pubdate">31 May at 15:58:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/533">https://github.com/qt4cg/qtspecs/pull/533</a></div><details><summary>413: Spec for CSV parsing with fn:parse-csv()</summary><div class="markup"><p>This is a spec proposal for <code>fn:parse-csv()</code> from #413.</p>
<p>I've tried to cover off most of what was discussed in that issue, but I have avoided dealing with backlash escapes (per @ChristianGruen's early comment), sticking with the RFC 4180 quoting approach.</p>
<p>There are some issues with the structure where I tried to follow the existing structure of chapter 15, but that leaves the function definition in 15.4 separated by a lot of text before the wider format discussion in 15.7. The split between function def and context affects the JSON and HTML parsing functions too, so I have avoided trying to fix that as well in this PR.</p>
<p>If this meets with approval, I'll squash commits and rebase before merging.</p>
</div></details></div>
<div class="toot" id="created-532"><h2>Pull request #532 created<span class="toot-id"> #created-532</span></h2><div class="pubdate">31 May at 07:30:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/532">https://github.com/qt4cg/qtspecs/pull/532</a></div><details><summary>fix error in LambdaParams rule</summary><div class="markup"><p>fixes https://github.com/qt4cg/qtspecs/issues/531#issue-1733539612</p>
<p>LambdaParam | "(" | (LambdaParam ("," LambdaParam)<em>)? | ")" should be:
LambdaParam | ( "(" (LambdaParam ("," LambdaParam)</em>)? ")" )</p>
</div></details></div>
<div class="toot" id="created-531"><h2>Issue #531 created<span class="toot-id"> #created-531</span></h2><div class="pubdate">31 May at 07:14:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/531">https://github.com/qt4cg/qtspecs/issues/531</a></div><details><summary>grammar production LambdaParams has "(" and ")" incorrectly under the choice</summary><div class="markup"><p>The grammar production
<code>LambdaParams ::= LambdaParam  |  "("  |  (LambdaParam  (","  LambdaParam)*)?  |  ")"</code>
should be
<code>LambdaParams ::= LambdaParam  |  ("(" (LambdaParam  (","  LambdaParam)*)? ")")</code></p>
</div></details></div>
<div class="toot" id="created-530"><h2>Issue #530 created<span class="toot-id"> #created-530</span></h2><div class="pubdate">31 May at 06:00:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/530">https://github.com/qt4cg/qtspecs/issues/530</a></div><details><summary>Escaping of forward slash in JSON output method</summary><div class="markup"><p>The fact that we escape forward slash in the JSON output method has proved unpopular with quite a few users.</p>
<p>The rationale for doing it is discussed at https://stackoverflow.com/questions/1580647/json-why-are-forward-slashes-escaped</p>
<p>The short summary is that it's only needed when JSON is inserted into an HTML <code>script</code> element, and then only when immediately followed by <code>&gt;</code>.</p>
<p>There's a workaround using character maps but it's really clumsy.</p>
<p>I don't want to escape forward slashes by default in the xdm-to-json() function because they appear so often in namespaces and it adds an awful lot of visual clutter. That means that our JSON formatter needs an option to suppress this escaping, which means we might as well provide user control over it as an output property...</p>
<p>Adding a new output property just for this purpose is rather heavyweight both in the specs and in our implementation, but I can't think of a better solution. So I propose adding <code>escape-solidus</code>, values yes/no, default (for compatibility) yes.</p>
<p>Yes, someone will ask about the name. Surely no-one calls it a solidus? Well, Unicode does, and I think we should use the official name. And it avoids arguing about whether it should be slash or forwards-slash or forward-slash. At least I'm not proposing virgule.</p>
</div></details></div>
<div class="toot" id="closed-367"><h2>Issue #367 closed<span class="toot-id"> #closed-367</span></h2><div class="pubdate">30 May at 22:19:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/367">https://github.com/qt4cg/qtspecs/issues/367</a></div><p>Focus for RHS of thin arrow expressions</p></div>
<div class="toot" id="minutes-05-30"><h2>QT4 CG meeting 036 draft minutes<span class="toot-id"> #minutes-05-30</span></h2><div class="pubdate">30 May at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/05-30">https://qt4cg.org/meeting/minutes/2023/05-30</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-524"><h2>Issue #524 closed<span class="toot-id"> #closed-524</span></h2><div class="pubdate">30 May at 16:17:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/524">https://github.com/qt4cg/qtspecs/pull/524</a></div><p>503: reinstate focus functions</p></div>
<div class="toot" id="closed-525"><h2>Issue #525 closed<span class="toot-id"> #closed-525</span></h2><div class="pubdate">30 May at 16:17:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/525">https://github.com/qt4cg/qtspecs/pull/525</a></div><p>520: add function identity and use it in deep-equal</p></div>
<div class="toot" id="closed-519"><h2>Issue #519 closed<span class="toot-id"> #closed-519</span></h2><div class="pubdate">30 May at 16:16:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/519">https://github.com/qt4cg/qtspecs/pull/519</a></div><p>237: Revise tokenisation appendix</p></div>
<div class="toot" id="closed-527"><h2>Issue #527 closed<span class="toot-id"> #closed-527</span></h2><div class="pubdate">30 May at 16:16:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/527">https://github.com/qt4cg/qtspecs/pull/527</a></div><p>Editorial: more corrections to F+O examples</p></div>
<div class="toot" id="created-529"><h2>Pull request #529 created<span class="toot-id"> #created-529</span></h2><div class="pubdate">29 May at 11:22:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/529">https://github.com/qt4cg/qtspecs/pull/529</a></div><details><summary>528: revision of json(), and renaming to elements-to-maps()</summary><div class="markup"><p>Revises the detail of the proposed json() function, including a name change to xdm-to-json().</p>
<p>The proposed changes give us a starting point for implementation, but I would expect there might be further tweaks to the spec once we try applying the function to real examples.</p>
</div></details></div>
<div class="toot" id="agenda-05-30"><h2>QT4 CG meeting 036 draft agenda<span class="toot-id"> #agenda-05-30</span></h2><div class="pubdate">29 May at 07:53:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/05-30">https://qt4cg.org/meeting/agenda/2023/05-30</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-528"><h2>Issue #528 created<span class="toot-id"> #created-528</span></h2><div class="pubdate">28 May at 20:08:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/528">https://github.com/qt4cg/qtspecs/issues/528</a></div><details><summary>fn:elements-to-maps (before: Review of the fn:json() function)</summary><div class="markup"><p>I've been writing tests for the fn:json function, whose spec I haven't read for quite a while, so it's an opportunity (a) to request WG review of the spec, and (b) for some minor comments.</p>
<ol>
<li>I think a better name for the function might be <code>fn:to-json</code>. Any other suggestions?</li>
<li>Where we specify that a JSON object should be output with particular properties, I think we should be consistent about whether or not we prescribe the order. Writing tests is a lot easier if the order is always prescribed!</li>
<li>Document nodes: it would be better to output both the document URI and the base URI where available.</li>
<li>Under "The children of the element are processed as follows" there are four rules. In the case where an element has just one element node child, I think rule 4 should apply rather than rule 3.</li>
<li>Under Processing-Instruction nodes: typo "A JSON object with a two properties".</li>
<li>The section starting "Strings are escaped as follows" should be promoted up a level.</li>
<li>Representing functions: I propose a different set of rules. (a) for a function that is a reference to a built-in or user-defined function definition, output "Q{uri}local#arity". (b) for an anonymous function, output "#anonymous-function". The rationale is that the JSON output here isn't going to be useful except as a placeholder to indicate that a function item is present.</li>
<li>We might want to be more prescriptive about how numbers are formatted (or to provide user options)</li>
<li>Like many XML-to-JSON libraries, there's the problem that two instances of the same element type might be output very differently depending on which children are present. For example the representation of a book with two authors might be very different from a book with one author. I would suggest that rather than the boolean <code>element-map</code> option, we allow the options to include a list of element names for which <code>object</code> representation rather than <code>array</code> representation is to be used.</li>
</ol>
</div></details></div>
<div class="toot" id="created-527"><h2>Pull request #527 created<span class="toot-id"> #created-527</span></h2><div class="pubdate">28 May at 10:24:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/527">https://github.com/qt4cg/qtspecs/pull/527</a></div><details><summary>Editorial: more corrections to F+O examples</summary><div class="markup"><p>Fixes errors in the fn:replace examples, updates elsewhere to reflect changes to the syntax of lambda expressions and focus functions.</p>
</div></details></div>
<div class="toot" id="created-526"><h2>Issue #526 created<span class="toot-id"> #created-526</span></h2><div class="pubdate">26 May at 21:22:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/526">https://github.com/qt4cg/qtspecs/issues/526</a></div><details><summary>load-xquery-module() needs changes to account for functions with an arity range</summary><div class="markup"><p>The spec of <code>load-xquery-module()</code> assumes that each function declaration in a query module has a single integer arity; this doesn't allow for default parameters which mean it now has an arity range.</p>
<p>Because the returned map contains function items, which always have a fixed arity, I think it needs to contain one entry for each arity in the arity range. This involves evaluating the defaults for any parameters that have a default value defined; if the default value is context dependent, this is going to have to use the context of the <code>load-xquery-module()</code> function call, which isn't very meaningful, but I can't see what else to do.</p>
<p>An alternative is to only include one function item in the result, corresponding to the maximum arity.</p>
<p>If we introduce sequence-variadic functions, the arity range becomes infinite, which makes both of these ideas problematic. But presumably sequence-variadic functions will be callable with all the values supplied in a single array?</p>
</div></details></div>
<div class="toot" id="created-525"><h2>Pull request #525 created<span class="toot-id"> #created-525</span></h2><div class="pubdate">26 May at 09:27:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/525">https://github.com/qt4cg/qtspecs/pull/525</a></div><details><summary>520: add function identity and use it in deep-equal</summary><div class="markup"><p>I believe this PR resolves issues</p>
<p>issue #520 - function identity
issue #333 - equality of function items
issue #381 - deep-equal comparison without errors</p>
<p>The PR introduces a concept of function identity in the data model, and for all expressions that create functions, explains what the identity of the returned function is.</p>
<p>The concept of function identity is used initially in two places: in fn:deep-equal(), when the operands include function items; and in the F+O prose defining the concept of determinism, which in turn is relied on by the definition of memo functions in XSLT.</p>
<p>I had hoped to go further and address issue #119, generalising what kinds of values are allowed as keys in maps, but as explained in a comment on that issue, I hit obstacles.</p>
</div></details></div>
<div class="toot" id="created-524"><h2>Pull request #524 created<span class="toot-id"> #created-524</span></h2><div class="pubdate">25 May at 10:09:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/524">https://github.com/qt4cg/qtspecs/pull/524</a></div><details><summary>503: reinstate focus functions</summary><div class="markup"><p>This PR reinstates "focus functions", using the syntax <code>function{EXPR}</code> rather than <code>-&gt;{EXPR}</code>. If accepted, this resolves issue #503.</p>
</div></details></div>
<div class="toot" id="created-523"><h2>Issue #523 created<span class="toot-id"> #created-523</span></h2><div class="pubdate">24 May at 23:28:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/523">https://github.com/qt4cg/qtspecs/issues/523</a></div><details><summary>Dealing with component name conflicts with library packages</summary><div class="markup"><h2>Override with visibility='hidden'</h2>
<pre><code class="language-xml">&lt;override&gt;
   &lt;template name='foo' visibility='hidden'/&gt;
&lt;/override&gt;
</code></pre>
<p>This change allows the using package to override a component without running into a potential naming conflict with another component in the using package or in another used package. Because the visibility is hidden, the component is not invokable from the using package.</p>
<h2>Accept with alias</h2>
<pre><code class="language-xml">&lt;accept component='template' names='foo' aliases='fu'/&gt;
</code></pre>
<p>This change allows the using package to accept components but with a different name.</p>
</div></details></div>
<div class="toot" id="closed-522"><h2>Issue #522 closed<span class="toot-id"> #closed-522</span></h2><div class="pubdate">24 May at 07:48:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/522">https://github.com/qt4cg/qtspecs/pull/522</a></div><p>function-catalog.xml: Original line endings reverted (modified by GitHub’s 'direct edit' feature)</p></div>
<div class="toot" id="created-522"><h2>Pull request #522 created<span class="toot-id"> #created-522</span></h2><div class="pubdate">24 May at 07:48:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/522">https://github.com/qt4cg/qtspecs/pull/522</a></div><details><summary>function-catalog.xml: Original line endings reverted (modified by GitHub’s 'direct edit' feature)</summary><div class="markup"><p>I learned it’s NOT advisable to use GitHub’s features to directly edit files in the browser. The newlines of <code>function-catalog.xml</code> of the original file seem to be changed.</p>
<p>This PR is restoring the original newlines.
Sorry for that.</p>
</div></details></div>
<div class="toot" id="created-521"><h2>Pull request #521 created<span class="toot-id"> #created-521</span></h2><div class="pubdate">23 May at 18:50:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/521">https://github.com/qt4cg/qtspecs/pull/521</a></div><p>518: Add transitive-closure() function</p></div>
<div class="toot" id="minutes-05-23"><h2>QT4 CG meeting 035 draft minutes<span class="toot-id"> #minutes-05-23</span></h2><div class="pubdate">23 May at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/05-23">https://qt4cg.org/meeting/minutes/2023/05-23</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-504"><h2>Issue #504 closed<span class="toot-id"> #closed-504</span></h2><div class="pubdate">23 May at 16:18:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/504">https://github.com/qt4cg/qtspecs/issues/504</a></div><p>Merge map:keys and map:keys-where</p></div>
<div class="toot" id="closed-515"><h2>Issue #515 closed<span class="toot-id"> #closed-515</span></h2><div class="pubdate">23 May at 16:18:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/515">https://github.com/qt4cg/qtspecs/pull/515</a></div><p>504: Merge map:keys and map:keys-where</p></div>
<div class="toot" id="closed-396"><h2>Issue #396 closed<span class="toot-id"> #closed-396</span></h2><div class="pubdate">23 May at 16:15:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/396">https://github.com/qt4cg/qtspecs/pull/396</a></div><p>333: Deep-equal, no failure when comparing functions</p></div>
<div class="toot" id="created-520"><h2>Issue #520 created<span class="toot-id"> #created-520</span></h2><div class="pubdate">23 May at 11:58:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/520">https://github.com/qt4cg/qtspecs/issues/520</a></div><details><summary>Function identity</summary><div class="markup"><p>To make deep-equal error-free for all arguments (issue #333), and to support the introduction of sets (issue #34), we need to be able to test whether two functions are "the same function". This is a proposed pragmatic solution.</p>
<p>We change the data model for functions so that functions, like nodes, have an identity that is acquired when the function is created; two functions are identical if and only if they have the same identity.</p>
<p>In general any expression that returns a new function allocates it an identity that is different from all other existing functions (as with nodes). However:</p>
<ul>
<li>Repeated evaluation of a function reference such as count#1 returns the same function each time, provided that the target function is context-free.</li>
<li>Optimizers are allowed to rewrite expressions (for example by loop-lifting, etc) so that expressions that would in principle return distinct functions actually return the same function, provided the optimizer can determine that the two functions are equivalent in all respects other than their identity. For example if the expression <code>contains(?, 'xxx')</code> appears in a loop, the expression can be lifted out of the loop so there is no requirement that it returns different functions each time (as there is with nodes)</li>
</ul>
<p>Benefits of this approach:</p>
<ul>
<li>identical($x, $x) is always true (function identity survives binding to variables)</li>
<li>functions obtained by repeated evaluation of the same expression in the same context are likely to return identical results in cases that are simple enough for an optimizer to analyse</li>
<li>the results are likely to be reasonably intuitive</li>
<li>optimisers aren't constrained by rules on identity to restrict the rewrites they can attempt</li>
</ul>
<p>This does mean that expressions that return functions become a little impure - but only in the same way that expressions that create nodes are a little impure. The impurity is well understood and tolerated.</p>
<p>Maps and arrays do not have identity as a property separate from their content.</p>
</div></details></div>
<div class="toot" id="created-519"><h2>Pull request #519 created<span class="toot-id"> #created-519</span></h2><div class="pubdate">23 May at 10:50:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/519">https://github.com/qt4cg/qtspecs/pull/519</a></div><details><summary>237: Revise tokenisation appendix</summary><div class="markup"><p>This PR is an extensive revision to the rules for tokenisation that corrects a number of errors:</p>
<ul>
<li>The problem mentioned in issue 237, namely the lack of clarity in the "longest token rule". This PR fixes this by clarifying what this rule means and where it applies. In particular it tackles the issue of "complex terminals" such as element constructor expressions and string templates where a symbol that is a single token at one level (in the sense that whitespace is constrained) also contains enclosed expressions.</li>
<li>Some productions/tokens were misclassified or omitted from the relevant lists of tokens in the appendix. This has been fixed in part by using general rules in the grammar2spec stylesheet to generate lists of tokens, rather than relying on annotations in the grammar file.</li>
</ul>
<p>The PR includes changes to the grammar2spec stylesheet.</p>
</div></details></div>
<div class="toot" id="created-518"><h2>Issue #518 created<span class="toot-id"> #created-518</span></h2><div class="pubdate">22 May at 16:45:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/518">https://github.com/qt4cg/qtspecs/issues/518</a></div><details><summary>transitive-closure() function</summary><div class="markup"><p>I've just found myself writing, yet again, a transitive closure function, and I feel we could add this to the spec.</p>
<p>I'm afraid it's another case where we really need set operations and therefore a universal equality operator. For the moment I'll just define it over nodes, which shelves the problem.</p>
<p><code>fn:transitive-closure($start as node()*, $step as function($node as node()) as node()*) as node()*</code></p>
<p>returns the set of all nodes reachable from a node in $start by zero or more applications of the $step function, in document order with duplicates removed.</p>
<p>Can probably define it formally something like</p>
<pre><code>let $next-iteration := $start =!&gt; $step()
return if (empty($next-iteration except $start))
           then $start
           else transitive-closure($start | $next-iteration, $step)
</code></pre>
</div></details></div>
<div class="toot" id="created-517"><h2>Issue #517 created<span class="toot-id"> #created-517</span></h2><div class="pubdate">21 May at 01:43:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/517">https://github.com/qt4cg/qtspecs/issues/517</a></div><details><summary>fn:chain (before: fn:multi-compose)</summary><div class="markup"><h1><strong>FO: fn:multi-compose : Evaluate a chain of functions</strong></h1>
<p>As per Wikipedia:</p>
<p>" In&nbsp;<a href="https://en.wikipedia.org/wiki/Mathematics">mathematics</a>,&nbsp;<strong>function composition</strong>&nbsp;is an operation&nbsp; ∘ &nbsp;that takes two&nbsp;<a href="https://en.wikipedia.org/wiki/Function_(mathematics)">functions</a>&nbsp;<em>f</em>&nbsp;and&nbsp;<em>g</em>, and produces a function&nbsp;</p>
<p><em>h</em>&nbsp;=&nbsp;<em>g</em>&nbsp; ∘  <em>f</em>&nbsp;such that&nbsp;<em>h</em>(<em>x</em>) =&nbsp;<em>g</em>(<em>f</em>(<em>x</em>)).</p>
<p>In this operation, the function&nbsp;<em>g</em>&nbsp;is&nbsp;<a href="https://en.wikipedia.org/wiki/Function_application">applied</a>&nbsp;to the result of applying the function&nbsp;<em>f</em>&nbsp;to&nbsp;<em>x</em>. That is, the functions&nbsp;</p>
<p><em>f</em> :&nbsp;<em>X</em>&nbsp;→&nbsp;<em>Y</em>&nbsp;and&nbsp;<em>g</em> :&nbsp;<em>Y</em>&nbsp;→&nbsp;<em>Z</em>&nbsp;</p>
<p>are&nbsp;<strong>composed</strong>&nbsp;to yield a function that maps&nbsp;<em>x</em>&nbsp;in&nbsp;<a href="https://en.wikipedia.org/wiki/Domain_of_a_function">domain</a>&nbsp;<em>X</em>&nbsp;to&nbsp;<em>g</em>(<em>f</em>(<em>x</em>))&nbsp;in&nbsp;<a href="https://en.wikipedia.org/wiki/Codomain">codomain</a>&nbsp;<em>Z</em>.</p>
<p>Intuitively, if&nbsp;<em>z</em>&nbsp;is a function of&nbsp;<em>y</em>, and&nbsp;<em>y</em>&nbsp;is a function of&nbsp;<em>x</em>, then&nbsp;<em>z</em>&nbsp;is a function of&nbsp;<em>x</em>.</p>
<p>The resulting&nbsp;<em>composite</em>&nbsp;function is denoted&nbsp;<em>g</em> ∘ <em>f</em>&nbsp;:&nbsp;<em>X</em>&nbsp;→&nbsp;<em>Z</em>, defined by:</p>
<p>&nbsp;(<em>g</em> ∘ <em>f</em> )(<em>x</em>) =&nbsp;<em>g</em>(<em>f</em>(<em>x</em>))&nbsp;for all&nbsp;<em>x</em>&nbsp;in&nbsp;<em>X</em>
"</p>
<hr>
<p>In this Proposal we generalize function composition to the case when a sequence of functions are composed together, so that the last one is applied on an argument $x, then  the last-but-one is applied on the result of this application, and so on … until finally the first function in the sequence is applied on the result produced so far.</p>
<p>This is an effective way of chaining a sequence of functions together, and we don’t need to invent or use any special operators or syntax, but we just pass this sequence of functions as argument to <strong><em>fn:multi-compose</em></strong>.</p>
<p><strong>fn:multi-compose := function($funs as function(*)*, $x)</strong></p>
<p><strong>Here is an XPath 3.0 implementation of fn:multi-compose</strong>:</p>
<pre><code class="language-xq">let $apply := function($f, $x) {fn:apply($f, [$x])},
    $multi-compose := function($funs as function(*)*, $x)
                  {
                    fold-right($funs, $x, $apply)
                  },
    (: The functions $incr and $times are needed just to show this example :) 
    $incr := function($x) {op("+")(?, $x)},
    $times := function($y) {op("*")(?, $y)}                 
                  
 return
   $multi-compose(($times(5), $incr(1)), 2)
</code></pre>
<p>As wanted, the result of evaluating this is</p>
<p>15: (2 +1) * 5</p>
<h2>Remarks</h2>
<ol>
<li>
<p>In this implementation the type of the 2nd (last) argument of <strong><em>$multi-compose</em></strong> and <strong><em>$apply</em></strong> is <code>item()*</code> (any) and as such it is omitted. In case the function to be applied first, needs  more than one argument, all of its arguments must be presented in the function call as a single sequence , and are passed (in order) as the members of a single array, as already implemented by the standard <strong><a href="https://www.w3.org/TR/xpath-functions-31/#func-apply">fn:apply</a></strong>.</p>
</li>
<li>
<p>It is a dynamic error if any of the function applications produces a result which does not belong to the Domain of the function immediately preceding it in the function sequence.</p>
</li>
</ol>
</div></details></div>
<div class="toot" id="closed-181"><h2>Issue #181 closed<span class="toot-id"> #closed-181</span></h2><div class="pubdate">20 May at 18:32:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/181">https://github.com/qt4cg/qtspecs/issues/181</a></div><p>HOF Sequence Functions with Positional Arguments</p></div>
<div class="toot" id="created-516"><h2>Issue #516 created<span class="toot-id"> #created-516</span></h2><div class="pubdate">20 May at 18:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/516">https://github.com/qt4cg/qtspecs/issues/516</a></div><details><summary>Add position argument to HOF callbacks</summary><div class="markup"><p>The coercion rules now allow a supplied function item to have lower arity than the signature of the declared type; the effect is that the information supplied in the additional arguments is ignored.</p>
<p>One of the intended use cases for this was to allow existing higher-order functions to be extended while retaining backwards compatibility. For example, in <code>fn:filter</code>, we can change the required type of the predicate function from <code>function(item()) as xs:boolean</code> to <code>function(item(), xs:positiveInteger) as xs:boolean</code>, with the second argument supplying the position of the item being tested. A function that isn't interested in the position can just ignore it, so existing calls will continue to work.</p>
<p>I propose that we add a position argument to the callbacks for:</p>
<pre><code>fn:filter
fn:for-each
fn:for-each-pair
fn:partition
fn:items-after
fn:items-before
fn:items-starting-where
fn:items-ending-where
array:filter
array:for-each
array:for-each-pair
</code></pre>
<p>Other candidates include</p>
<pre><code>fn:all
fn:some
fn:index-where
array:index-where
</code></pre>
<p>but I suggest we leave these unless someone can think of a use case.</p>
</div></details></div>
<div class="toot" id="agenda-05-23"><h2>QT4 CG meeting 035 draft agenda<span class="toot-id"> #agenda-05-23</span></h2><div class="pubdate">20 May at 10:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/05-23">https://qt4cg.org/meeting/agenda/2023/05-23</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-471"><h2>Issue #471 closed<span class="toot-id"> #closed-471</span></h2><div class="pubdate">20 May at 10:04:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/471">https://github.com/qt4cg/qtspecs/issues/471</a></div><p>Unify formatting (function calls, code blocks, quotes) in the specification</p></div>
<div class="toot" id="closed-511"><h2>Issue #511 closed<span class="toot-id"> #closed-511</span></h2><div class="pubdate">20 May at 10:04:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/511">https://github.com/qt4cg/qtspecs/pull/511</a></div><p>471: &lt;code&gt; elements, simple/typographic quotes</p></div>
<div class="toot" id="created-515"><h2>Pull request #515 created<span class="toot-id"> #created-515</span></h2><div class="pubdate">20 May at 09:57:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/515">https://github.com/qt4cg/qtspecs/pull/515</a></div><p>504: Merge map:keys and map:keys-where</p></div>
<div class="toot" id="created-514"><h2>Issue #514 created<span class="toot-id"> #created-514</span></h2><div class="pubdate">20 May at 08:44:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/514">https://github.com/qt4cg/qtspecs/issues/514</a></div><details><summary>Lambda expression: Annotations</summary><div class="markup"><p><strong>Edit 2023-05-21:</strong> Feedback was incorporated.</p>
<p>In the current grammar rules, there are subtle differences in the <code>InlineFunctionExpr</code> and <code>LambdaExpr</code> rules that we should dissolve.</p>
<p>Annotations are not supported in lambda expressions, which I believe is an unnecessary restriction:</p>
<pre><code class="language-xquery">(: currently legal :)
let $delete-texts := %updating function($nodes) { delete nodes $nodes//text() }
return $delete-texts(//city)

(: currently illegal :)
let $delete-texts := %updating ($nodes) -&gt; { delete nodes $nodes//text() }
return $delete-texts(//city)
</code></pre>
<p>It should suffice to extend one rule in the grammar:</p>
<pre><code>(: old :)
LambdaExpr  ::=  LambdaParams "-&gt;" EnclosedExpr
(: new :)
LambdaExpr  ::=  Annotation* LambdaParams "-&gt;" EnclosedExpr
</code></pre>
<hr>
<p>We could also type declarations (as @michaelhkay has indicated below, though, this might not be as simple to realize as I hoped):</p>
<pre><code class="language-xquery">(: currently legal :)
let $find-john := function($node as node()) as xs:boolean { contains($node, 'john') }
return $find-john($node)

(: currently illegal :)
let $find-john := ($node as node()) as xs:boolean -&gt; { contains($node, 'john') }
return $find-john($node)
</code></pre>
<p>The type declarations cannot be allowed if parentheses are omitted (unless we make them mandatory):</p>
<pre><code class="language-xquery">(: without parens :)
$i -&gt; { ... }

(: parens :)
($i as xs:int) as xs:int -&gt; { ... }
</code></pre>
<p>These are the current grammar rules:</p>
<pre><code>FunctionItemExpr    ::=  NamedFunctionRef | InlineFunctionExpr | LambdaExpr
InlineFunctionExpr  ::=  Annotation* "function" FunctionSignature FunctionBody
FunctionSignature   ::=  "(" ParamList? ")" TypeDeclaration?
ParamList           ::=  Param ("," Param)*
Param               ::=  "$" EQName TypeDeclaration?
FunctionBody        ::=  EnclosedExpr
LambdaExpr          ::=  LambdaParams "-&gt;" EnclosedExpr
LambdaParams        ::=  LambdaParam | "(" | (LambdaParam ("," LambdaParam)*)? | ")"
LambdaParam         ::=  "$" VarName
</code></pre>
<p>As the <code>InlineFunctionExpr</code> and <code>LambdaExpr</code> both generate anonymous functions, we shouldn’t make a difference, and this is what I would recommend:</p>
<pre><code>FunctionItemExpr    ::=  NamedFunctionRef | InlineFunctionExpr
InlineFunctionExpr  ::=  Annotation* (InlineFunction | LambdaFunction) FunctionBody
InlineFunction      ::=  "function" FunctionSignature
LambdaFunction      ::=  (Param | FunctionSignature)) "-&gt;"
FunctionSignature   ::=  "(" ParamList? ")" TypeDeclaration?
ParamList           ::=  TypedParam ("," TypedParam)*
TypedParam          ::=  Param TypeDeclaration?
Param               ::=  "$" VarName
</code></pre>
<p>Disclaimer: I could have raised this earlier, but I didn’t want to prolong the ongoing discussion on the open pull requests.</p>
</div></details></div>
<div class="toot" id="created-513"><h2>Issue #513 created<span class="toot-id"> #created-513</span></h2><div class="pubdate">20 May at 08:00:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/513">https://github.com/qt4cg/qtspecs/issues/513</a></div><details><summary>Arrow operator: Inline functions without parens</summary><div class="markup"><p>See also https://github.com/qt4cg/qtspecs/issues/435#issuecomment-1508228624: If an inline function expression is used as the right-hand operand of the arrow operators, parentheses must be used:</p>
<pre><code class="language-xquery">(: now :)
$seq =&gt; (function($x) { ... })()
(: desirable :)
$seq =&gt; function($x) { ... }()
</code></pre>
<p>This could be changed by adding the <code>InlineFunctionExpr</code> to the <code>ArrowDynamicFunction</code> rule:</p>
<blockquote>
<p>[115]  SequenceArrowTarget  ::=  "=&gt;" ((ArrowStaticFunction ArgumentList) | (ArrowDynamicFunction PositionalArgumentList))
[151]  ArrowStaticFunction  ::=  EQName
[152]  ArrowDynamicFunction  ::=  VarRef | ParenthesizedExpr | <code>InlineFunctionExpr</code>
[142]  ArgumentList  ::=  "(" ((PositionalArguments ("," KeywordArguments)?) | KeywordArguments)? ")"
[143]  PositionalArgumentList  ::=  "(" PositionalArguments? ")"</p>
</blockquote>
<p>It will be best to tackle this after we’ve resolved #503, and we’ll have to check if the simplification doesn’t cause ambiguities.</p>
</div></details></div>
<div class="toot" id="closed-53"><h2>Issue #53 closed<span class="toot-id"> #closed-53</span></h2><div class="pubdate">19 May at 20:01:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/53">https://github.com/qt4cg/qtspecs/issues/53</a></div><p>Allow function keyword inline functions without parameters</p></div>
<div class="toot" id="closed-436"><h2>Issue #436 closed<span class="toot-id"> #closed-436</span></h2><div class="pubdate">19 May at 20:00:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/436">https://github.com/qt4cg/qtspecs/issues/436</a></div><p>Allow inline function expressions in arrow operator call chains</p></div>
<div class="toot" id="closed-435"><h2>Issue #435 closed<span class="toot-id"> #closed-435</span></h2><div class="pubdate">19 May at 20:00:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/435">https://github.com/qt4cg/qtspecs/issues/435</a></div><p>Remove the inlined function expression variant of the thin arrow operator</p></div>
<div class="toot" id="created-512"><h2>Pull request #512 created<span class="toot-id"> #created-512</span></h2><div class="pubdate">19 May at 14:47:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/512">https://github.com/qt4cg/qtspecs/pull/512</a></div><details><summary>256: Context for default function parameter expressions</summary><div class="markup"><p>This is a renewed attempt to tackle issue 256, which concerns how to define the static and dynamic context for default value expressions for optional function parameters in XQuery and XSLT. The resolution is to define the static and dynamic context for these expressions in detail.</p>
<p>To make this work, some refinement of the static and dynamic context definitions is needed:</p>
<ul>
<li>default collation is moved from the static context to the dynamic context, with a note that it is always known statically except in the case when defining the default for a function parameter.</li>
<li>static base URI (in the static context) and executable base URI (in the dynamic context) are now formally separated; previously we fudged this by saying they could be different, but without recognizing separate context components</li>
<li>the base URI for resolving relative collation URIs is now implementation defined. This allows implementors to use either the compile-time or run-time base URI, or some other URI defined using a processor API.</li>
</ul>
</div></details></div>
<div class="toot" id="created-511"><h2>Pull request #511 created<span class="toot-id"> #created-511</span></h2><div class="pubdate">19 May at 13:10:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/511">https://github.com/qt4cg/qtspecs/pull/511</a></div><details><summary>471: &lt;code&gt; elements, simple/typographic quotes</summary><div class="markup"><p>That was a work-intensive one, as expected, but I’m optimistic that the PR improves the overall situation.
I’ll be happy to see subsequent PRs if I missed something (e.g., I didn’t touch <code>ebnf.xml</code>).</p>
<p>Closes #471</p>
</div></details></div>
<div class="toot" id="closed-509"><h2>Issue #509 closed<span class="toot-id"> #closed-509</span></h2><div class="pubdate">19 May at 09:08:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/509">https://github.com/qt4cg/qtspecs/pull/509</a></div><p>471 (2): Remove more fn: prefixes</p></div>
<div class="toot" id="closed-510"><h2>Issue #510 closed<span class="toot-id"> #closed-510</span></h2><div class="pubdate">19 May at 09:08:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/510">https://github.com/qt4cg/qtspecs/pull/510</a></div><p>471 (3): Render false/true/NaN/INF/-INF/+INF as code</p></div>
<div class="toot" id="closed-375"><h2>Issue #375 closed<span class="toot-id"> #closed-375</span></h2><div class="pubdate">19 May at 08:48:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/375">https://github.com/qt4cg/qtspecs/pull/375</a></div><p>256: Context for default parameter values</p></div>
<div class="toot" id="closed-507"><h2>Issue #507 closed<span class="toot-id"> #closed-507</span></h2><div class="pubdate">19 May at 08:06:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/507">https://github.com/qt4cg/qtspecs/pull/507</a></div><p>125: Rename array:partition as fn:partition</p></div>
<div class="toot" id="closed-505"><h2>Issue #505 closed<span class="toot-id"> #closed-505</span></h2><div class="pubdate">18 May at 17:25:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/505">https://github.com/qt4cg/qtspecs/pull/505</a></div><p>418: Correct and expand an XSLT example</p></div>
<div class="toot" id="closed-447"><h2>Issue #447 closed<span class="toot-id"> #closed-447</span></h2><div class="pubdate">18 May at 17:24:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/447">https://github.com/qt4cg/qtspecs/pull/447</a></div><p>435, 53, 436: lambda expressions, thin arrows</p></div>
<div class="toot" id="closed-410"><h2>Issue #410 closed<span class="toot-id"> #closed-410</span></h2><div class="pubdate">18 May at 16:57:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/410">https://github.com/qt4cg/qtspecs/issues/410</a></div><p>Converting doubles to decimals, fractional digits</p></div>
<div class="toot" id="closed-455"><h2>Issue #455 closed<span class="toot-id"> #closed-455</span></h2><div class="pubdate">18 May at 16:57:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/455">https://github.com/qt4cg/qtspecs/pull/455</a></div><p>410: Converting doubles to decimals, fractional digits</p></div>
<div class="toot" id="closed-483"><h2>Issue #483 closed<span class="toot-id"> #closed-483</span></h2><div class="pubdate">18 May at 16:53:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/483">https://github.com/qt4cg/qtspecs/pull/483</a></div><p>452: window: make 'start' and 'when' optional</p></div>
<div class="toot" id="created-510"><h2>Pull request #510 created<span class="toot-id"> #created-510</span></h2><div class="pubdate">18 May at 16:14:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/510">https://github.com/qt4cg/qtspecs/pull/510</a></div><details><summary>471 (3): Render false/true/NaN/INF/-INF/+INF as code</summary><div class="markup"><p><code>NaN</code>, <code>INF</code>, <code>-INF</code> and <code>+INF</code> was easy, boolean values were trickier:</p>
<ul>
<li>I used <code>&lt;code&gt;</code> for “The result/value/option/property is true/false”, “is set to true/false” and similar.</li>
<li>I didn’t tag “This is true/false”, “The condition is true/false”  and similar.</li>
</ul>
<p>I hope there won’t be too many conflicts if this is directly merged after #509.</p>
</div></details></div>
<div class="toot" id="created-509"><h2>Pull request #509 created<span class="toot-id"> #created-509</span></h2><div class="pubdate">18 May at 12:38:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/509">https://github.com/qt4cg/qtspecs/pull/509</a></div><details><summary>471 (2): Remove more fn: prefixes</summary><div class="markup"><p>I’ve removed additional <code>fn:</code> prefixes from examples and <code>eg</code> code blocks. I have kept prefixes in the rules and formal code snippets untouched.</p>
<p>In the initial comment of #471, I have listed the remaining cleanups for which I want to prepare PRs.
I’ll wait until this and possibly some other PRs have been merged.</p>
</div></details></div>
<div class="toot" id="created-508"><h2>Issue #508 created<span class="toot-id"> #created-508</span></h2><div class="pubdate">17 May at 12:53:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/508">https://github.com/qt4cg/qtspecs/issues/508</a></div><details><summary>New Map &amp; Array Functions: Inconsistencies</summary><div class="markup"><h3>XQFO 3.1</h3>
<p>…provides the following functions/constructs for creating and accessing maps &amp; arrays:</p>
<p>Maps | Singleton Maps
:--- | :---
Decompose | –
Compose | <code>map:merge($maps)</code>
Create single | <code>map:entry($key, $value)</code><br><code>map { $key: $value }</code>
Extract keys | <code>map:keys($map)</code>
Extract values (flat) | <code>$map?*</code>
<strong>Arrays</strong> | <strong>Singleton Arrays</strong>
Decompose | –
Compose | <code>array:join($arrays)</code>
Create single | <code>[ $value ]</code>
Extract values (flat) | –</p>
<h3>XQFO 4.0 Draft</h3>
<p>…provides new functions for singletons and map representations:</p>
<p>Maps | Singleton Maps | Pairs (Key-Value Pair Maps)
:--- | :--- | :---
Decompose | <strong><code>map:entries($map)</code></strong> | <strong><code>map:pairs($map)</code></strong>
Compose | <code>map:merge($maps)</code> | <strong><code>map:of($pairs)</code></strong>
Create single | <code>map:entry($key, $value)</code><br><code>map { $key: $value }</code> | –<br><strong><code>map { 'key': $key, 'value': $value }</code></strong>
Extract keys | <code>map:keys($map)</code> | <strong><code>$pairs?key</code></strong>
Extract values (flat) | <strong><code>map:values($map)</code></strong><br><code>$map?*</code> | <strong><code>$pairs?value</code></strong>
<strong>Arrays</strong> | <strong>Singleton Arrays</strong> | <strong>Members (Value Maps)</strong>
Decompose | – | <strong><code>array:members($array)</code></strong>
Compose | <code>array:join($arrays)</code> | <strong><code>array:of($members)</code></strong>
Create single | <code>[ $value ]</code> | <strong><code>array { 'value': $value }</code></strong>
Extract values (flat) | <strong><code>array:values($array)</code></strong> | <strong><code>$members?value</code></strong></p>
<p>The following terminology can be derived from the function names:</p>
<ul>
<li>A key-value pair map with a single map pair is called a <strong>Pair</strong>.</li>
<li>A value map with a single array member is called a <strong>Member</strong>.</li>
<li>A singleton map is called an <strong>Entry</strong> (due to <code>map:entry</code>)</li>
<li>We have no name for a singleton array.</li>
</ul>
<h3>Complete the Picture</h3>
<p>I believe we should:</p>
<ol>
<li>rename <code>map:of</code> to <code>map:of-pairs</code> or <code>map:merge-pairs</code> (as a hint that singletons are not the expected input)</li>
<li>rename <code>array:of</code> to <code>array:of-members</code> or <code>array:join-members</code> (as a hint…)</li>
<li>add <code>map:pair</code> for creating a single pair</li>
<li>add <code>array:split</code> (<code>array:tokenize</code>, …?) for decomposing arrays to singleton arrays</li>
</ol>
<p>I’m not sure if we should add array functions for creating singletons or value maps; we also have <code>array:build</code>.</p>
</div></details></div>
<div class="toot" id="created-507"><h2>Pull request #507 created<span class="toot-id"> #created-507</span></h2><div class="pubdate">17 May at 11:38:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/507">https://github.com/qt4cg/qtspecs/pull/507</a></div><details><summary>125: Rename array:partition as fn:partition</summary><div class="markup"><p>Reworked this PR to deal with merge conflicts. Technical change was already accepted. Made a correction to the "equivalent expression" published in the spec, which has now been tested (and was found wanting...)</p>
</div></details></div>
<div class="toot" id="closed-454"><h2>Issue #454 closed<span class="toot-id"> #closed-454</span></h2><div class="pubdate">17 May at 09:23:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/454">https://github.com/qt4cg/qtspecs/pull/454</a></div><p>125: array:partition</p></div>
<div class="toot" id="created-506"><h2>Issue #506 created<span class="toot-id"> #created-506</span></h2><div class="pubdate">17 May at 09:08:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/506">https://github.com/qt4cg/qtspecs/issues/506</a></div><details><summary>fn:error: parameter names</summary><div class="markup"><p>We should rename the <code>$error-object</code> parameter to <code>$value</code>, as it will be bound to <code>$err:value</code> later on:</p>
<pre><code class="language-xquery">try {
  error(value := 123)
} catch * {
  $err:value
}
</code></pre>
<p>Next, “object” is rarely used in the specs.</p>
</div></details></div>
<div class="toot" id="closed-467"><h2>Issue #467 closed<span class="toot-id"> #closed-467</span></h2><div class="pubdate">17 May at 08:20:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/467">https://github.com/qt4cg/qtspecs/issues/467</a></div><p>map:keys-where: Return Keys That Match a Predicate</p></div>
<div class="toot" id="created-505"><h2>Pull request #505 created<span class="toot-id"> #created-505</span></h2><div class="pubdate">17 May at 08:14:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/505">https://github.com/qt4cg/qtspecs/pull/505</a></div><details><summary>418: Correct and expand an XSLT example</summary><div class="markup"><p>Makes a further correction to an example identified in issue #418, and adds to the example giving an alternative solution</p>
</div></details></div>
<div class="toot" id="created-504"><h2>Issue #504 created<span class="toot-id"> #created-504</span></h2><div class="pubdate">17 May at 07:46:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/504">https://github.com/qt4cg/qtspecs/issues/504</a></div><details><summary>Merge map:keys and map:keys-where</summary><div class="markup"><p>I propose that we merge <code>map:keys</code> and <code>map:keys-where</code> into a single function, with <code>map:keys#1</code> behaving like it does now, and <code>map:keys#2</code> taking over from <code>map:keys-where#2</code>. Effectively the default for the second argument becomes <code>true#0</code>.</p>
</div></details></div>
<div class="toot" id="closed-30"><h2>Issue #30 closed<span class="toot-id"> #closed-30</span></h2><div class="pubdate">17 May at 06:16:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/30">https://github.com/qt4cg/qtspecs/issues/30</a></div><p>Improve the discoverability and parseability of the mathematical operator symbols</p></div>
<div class="toot" id="closed-204"><h2>Issue #204 closed<span class="toot-id"> #closed-204</span></h2><div class="pubdate">17 May at 06:16:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/204">https://github.com/qt4cg/qtspecs/issues/204</a></div><p>Non-ascii alternative operator symbols</p></div>
<div class="toot" id="closed-460"><h2>Issue #460 closed<span class="toot-id"> #closed-460</span></h2><div class="pubdate">17 May at 06:15:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/460">https://github.com/qt4cg/qtspecs/issues/460</a></div><p>Mathematical Operator Symbols</p></div>
<div class="toot" id="closed-485"><h2>Issue #485 closed<span class="toot-id"> #closed-485</span></h2><div class="pubdate">17 May at 06:13:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/485">https://github.com/qt4cg/qtspecs/issues/485</a></div><p>Predeclared namespaces in XQuery</p></div>
<div class="toot" id="closed-443"><h2>Issue #443 closed<span class="toot-id"> #closed-443</span></h2><div class="pubdate">17 May at 06:12:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/443">https://github.com/qt4cg/qtspecs/issues/443</a></div><p>@select on xsl:matching-substring and xsl:non-matching-substring</p></div>
<div class="toot" id="closed-32"><h2>Issue #32 closed<span class="toot-id"> #closed-32</span></h2><div class="pubdate">17 May at 06:12:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/32">https://github.com/qt4cg/qtspecs/issues/32</a></div><p>try/catch: New variable for all error information</p></div>
<div class="toot" id="closed-452"><h2>Issue #452 closed<span class="toot-id"> #closed-452</span></h2><div class="pubdate">17 May at 06:11:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/452">https://github.com/qt4cg/qtspecs/issues/452</a></div><p>window: make 'start' and 'when' optional</p></div>
<div class="toot" id="created-503"><h2>Issue #503 created<span class="toot-id"> #created-503</span></h2><div class="pubdate">16 May at 23:09:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/503">https://github.com/qt4cg/qtspecs/issues/503</a></div><details><summary>Reinstate focus functions</summary><div class="markup"><p>As a result of accepting PR #447, we have lost the ability to write simple "focus functions" that take the context item as an implicit argument, for example <code>sort(//emp, (), -&gt;{@salary})</code>.</p>
<p>The new status quo is that people have to write <code>sort(//emp, (), $e-&gt;{$e/@salary})</code> which feels clumsy in comparison.</p>
<p>This issue examines options for reinstating such a capability, and perhaps making it more powerful.</p>
<p>A reason for dropping the syntax was that it didn't play well with the "thin arrow" operator in pipelines, but we have now changed the symbol for that to <code>=!&gt;</code> so the objection no longer applies so strongly.</p>
<p>Ideally we want something that not only replaces focus functions (arity one arguments accepting an argument of type item()), but also meets some or all of the following additional requirements:</p>
<ul>
<li>
<p>Works well on the RHS of the <code>=&gt;</code> and <code>=!&gt;</code> operators, in a construct that we might write as <code>$list =!&gt; {.+1}()</code>.</p>
</li>
<li>
<p>Also allows arity-one functions whose argument is a sequence (<code>item()*</code>)</p>
</li>
</ul>
<p>This becomes a lot easier if we can solve issue #129 which generalises the context item to a context value. Let's assume we do that, and keep an open mind for the moment as to whether the generalized context value is referenced as <code>.</code> or <code>~</code>. I'll use <code>~</code> for now. So we want a compact notation for functions of arity one in which the function body refers to the argument value as <code>~</code>. For aesthetic reasons, because it's going to be used on the RHS of an arrow operator, we really don't want to introduce it with a leading arrow like the previous syntax <code>-&gt;{.+1}</code>. Use of "bare braces" (simply <code>{~+1}</code>) is very tempting, but I think there is a good argument for leaving that part of the syntactic space unused, for extensibility and for diagnostics. I think my preference is for <code>fn{~+1}</code>. Using a keyword (such as map, array, validate) before a braced expression is a uniform device and keeps the grammar coherent.</p>
<p>So in a callback such as fn:sort, we can write <code>sort(//emp, (), fn{@salary})</code>, and in a pipeline we can write <code>$list =!&gt; fn{.+1}()</code>. (To allow this, all we need to do is to generalise what's allowed as an <code>ArrowDynamicFunction</code>).</p>
<p>A separate question is whether we can (and should) allow the empty argument list to be omitted. I think I'm persuaded by the arguments that it's better to keep it, as a visual signal that the function is being applied, not just returned.</p>
</div></details></div>
<div class="toot" id="minutes-05-16"><h2>QT4 CG meeting 034 draft minutes<span class="toot-id"> #minutes-05-16</span></h2><div class="pubdate">16 May at 17:33:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/05-16">https://qt4cg.org/meeting/minutes/2023/05-16</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-478"><h2>Issue #478 closed<span class="toot-id"> #closed-478</span></h2><div class="pubdate">16 May at 16:17:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/478">https://github.com/qt4cg/qtspecs/pull/478</a></div><p>467: map:keys-where</p></div>
<div class="toot" id="closed-481"><h2>Issue #481 closed<span class="toot-id"> #closed-481</span></h2><div class="pubdate">16 May at 16:15:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/481">https://github.com/qt4cg/qtspecs/issues/481</a></div><p>When we have array:build and map:build, then why do we also need array:of and map:of ?</p></div>
<div class="toot" id="closed-466"><h2>Issue #466 closed<span class="toot-id"> #closed-466</span></h2><div class="pubdate">16 May at 16:12:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/466">https://github.com/qt4cg/qtspecs/pull/466</a></div><p>460: Fix math symbols</p></div>
<div class="toot" id="closed-487"><h2>Issue #487 closed<span class="toot-id"> #closed-487</span></h2><div class="pubdate">16 May at 16:12:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/487">https://github.com/qt4cg/qtspecs/pull/487</a></div><p>485: Predeclare the prefixes math, map, array, and err</p></div>
<div class="toot" id="closed-489"><h2>Issue #489 closed<span class="toot-id"> #closed-489</span></h2><div class="pubdate">16 May at 16:12:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/489">https://github.com/qt4cg/qtspecs/pull/489</a></div><p>443: Allow select attribute on xsl:[non-]matching-substring</p></div>
<div class="toot" id="closed-492"><h2>Issue #492 closed<span class="toot-id"> #closed-492</span></h2><div class="pubdate">16 May at 16:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/492">https://github.com/qt4cg/qtspecs/pull/492</a></div><p>Fix examples, change filepath definition slightly</p></div>
<div class="toot" id="closed-493"><h2>Issue #493 closed<span class="toot-id"> #closed-493</span></h2><div class="pubdate">16 May at 16:11:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/493">https://github.com/qt4cg/qtspecs/pull/493</a></div><p>32: try/catch: New variable for all error information</p></div>
<div class="toot" id="closed-500"><h2>Issue #500 closed<span class="toot-id"> #closed-500</span></h2><div class="pubdate">16 May at 09:15:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/500">https://github.com/qt4cg/qtspecs/issues/500</a></div><p>Fix errant typographic quotes in XPath Data Model</p></div>
<div class="toot" id="closed-502"><h2>Issue #502 closed<span class="toot-id"> #closed-502</span></h2><div class="pubdate">16 May at 09:15:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/502">https://github.com/qt4cg/qtspecs/pull/502</a></div><p>Fix typographic quotes in XPath Data Model</p></div>
<div class="toot" id="created-502"><h2>Pull request #502 created<span class="toot-id"> #created-502</span></h2><div class="pubdate">16 May at 08:22:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/502">https://github.com/qt4cg/qtspecs/pull/502</a></div><details><summary>Fix typographic quotes in XPath Data Model</summary><div class="markup"><p>Close #500</p>
<p>On closer inspection, there were only a few places where typographic quotes <em>were not</em> used in prose. I've fixed those. I think the DM spec could probably use an editorial pass to add <code>code</code> around some literals, but I'm not doing that in this PR.</p>
<p>I've left typographic quotes around code and literals because I don't think straight quotes would be an improvement: the literal <code>“&lt;code&gt;3&lt;/code&gt;”</code> doesn't need straight quotes because the quotes are not part of the literal.</p>
</div></details></div>
<div class="toot" id="created-501"><h2>Issue #501 created<span class="toot-id"> #created-501</span></h2><div class="pubdate">15 May at 09:05:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/501">https://github.com/qt4cg/qtspecs/issues/501</a></div><details><summary>Error handling: Rethrow errors; finally block</summary><div class="markup"><h3>Re-throw errors</h3>
<p>In https://github.com/qt4cg/qtspecs/pull/493, a function/expression was suggested to re-throw errors:</p>
<pre><code class="language-xquery">try {
  (: wild stuff :)
} catch * {
  module:log($err:description),
  rethrow($err:map)
}
</code></pre>
<h4>Alternatives</h4>
<ul>
<li>Use and extend the existing error function: <code>fn:error(rethrow := $err:map)</code></li>
<li>Use an expression: <code>throw $err:map</code></li>
</ul>
<p>In principle, the error information can also be constructed by the user. If we extend <code>fn:error</code> to also accept a map, it could be used to both throw and re-throw errors:</p>
<pre><code class="language-xquery">try {
  1 + &lt;empty/&gt;
} catch * {
  (: ... :)
  fn:error($err:map)
}
</code></pre>
<p>Missing information in the map could be added as if <code>fn:error</code> is raised.</p>
<pre><code class="language-xquery">let $map := map { 'column-number': 12, 'line-number': 3 }
return fn:error(xs:QName('oob'), 'Out of bounds', map := $map)
</code></pre>
<h3>Finally clause</h3>
<p>It can be helpful to have a code block that is always executed, even if errors occur:</p>
<pre><code class="language-xquery">let $tmp := file:create-temp-file()
return try {
  (: I/O stuff :)
} finally {
  file:delete($tmp)
}
</code></pre>
</div></details></div>
<div class="toot" id="created-500"><h2>Issue #500 created<span class="toot-id"> #created-500</span></h2><div class="pubdate">15 May at 08:46:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/500">https://github.com/qt4cg/qtspecs/issues/500</a></div><details><summary>Fix errant typographic quotes in XPath Data Model</summary><div class="markup"><p>In a comment on #471, @ChristianGruen observes that there are some errant typographic quotes in code examples in the XPath Data Model specification. I assume these are errors, mostly likely on my part, and should be corrected.</p>
</div></details></div>
<div class="toot" id="closed-499"><h2>Issue #499 closed<span class="toot-id"> #closed-499</span></h2><div class="pubdate">15 May at 08:21:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/499">https://github.com/qt4cg/qtspecs/pull/499</a></div><p>Use natural language sort order for glossary</p></div>
<div class="toot" id="created-499"><h2>Pull request #499 created<span class="toot-id"> #created-499</span></h2><div class="pubdate">14 May at 18:50:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/499">https://github.com/qt4cg/qtspecs/pull/499</a></div><details><summary>Use natural language sort order for glossary</summary><div class="markup"><p>This is a small stylesheet change which has the effect that the glossary in the XQuery specification (and elsewhere) now uses natural language sort order, so upper-case terms like <code>Gregorian</code> and <code>NaN</code> now appear in their proper alphabetic sequence.</p>
</div></details></div>
<div class="toot" id="agenda-05-12"><h2>QT4 CG meeting 034 draft agenda<span class="toot-id"> #agenda-05-12</span></h2><div class="pubdate">12 May at 17:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/05-12">https://qt4cg.org/meeting/agenda/2023/05-12</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-48"><h2>Issue #48 closed<span class="toot-id"> #closed-48</span></h2><div class="pubdate">12 May at 12:20:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/48">https://github.com/qt4cg/qtspecs/pull/48</a></div><p>Create a schema-for-xslt40.xsd file for the current draft spec.</p></div>
<div class="toot" id="closed-494"><h2>Issue #494 closed<span class="toot-id"> #closed-494</span></h2><div class="pubdate">12 May at 09:39:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/494">https://github.com/qt4cg/qtspecs/pull/494</a></div><p>Remove legacy materials from the working master branch</p></div>
<div class="toot" id="closed-495"><h2>Issue #495 closed<span class="toot-id"> #closed-495</span></h2><div class="pubdate">12 May at 09:07:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/495">https://github.com/qt4cg/qtspecs/issues/495</a></div><p>separator example in https://qt4cg.org/specifications/xslt-40/Overview-diff.html#for-each-separator has xsl:sequence-of instead of xsl:sequence element</p></div>
<div class="toot" id="closed-498"><h2>Issue #498 closed<span class="toot-id"> #closed-498</span></h2><div class="pubdate">12 May at 09:07:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/498">https://github.com/qt4cg/qtspecs/pull/498</a></div><p>Fix typo, replace sequence-of with sequence</p></div>
<div class="toot" id="created-498"><h2>Pull request #498 created<span class="toot-id"> #created-498</span></h2><div class="pubdate">12 May at 08:07:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/498">https://github.com/qt4cg/qtspecs/pull/498</a></div><details><summary>Fix typo, replace sequence-of with sequence</summary><div class="markup"><p>Fix #495</p>
</div></details></div>
<div class="toot" id="created-497"><h2>Issue #497 created<span class="toot-id"> #created-497</span></h2><div class="pubdate">12 May at 08:03:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/497">https://github.com/qt4cg/qtspecs/issues/497</a></div><details><summary>https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-map-pairs has wrong function syntax order</summary><div class="markup"><p>In https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-map-pairs the explanation of the new function <code>map:pairs</code> is given as:</p>
<pre><code>map:for-each($map, ($k, $v) -&gt; {map{"key":$k, "value":$v}})
</code></pre>
<p>I think the right syntax would be <code>map:for-each($map, -&gt; ($k, $v) {map{"key":$k, "value":$v}})</code>.</p>
</div></details></div>
<div class="toot" id="closed-496"><h2>Issue #496 closed<span class="toot-id"> #closed-496</span></h2><div class="pubdate">12 May at 08:01:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/496">https://github.com/qt4cg/qtspecs/pull/496</a></div><p>Ignore legacy directories entirely</p></div>
<div class="toot" id="created-496"><h2>Pull request #496 created<span class="toot-id"> #created-496</span></h2><div class="pubdate">12 May at 08:00:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/496">https://github.com/qt4cg/qtspecs/pull/496</a></div><details><summary>Ignore legacy directories entirely</summary><div class="markup"><p>This PR is supposed to fix the action that builds PRs so that it ignores directories we never edit.</p>
</div></details></div>
<div class="toot" id="created-495"><h2>Issue #495 created<span class="toot-id"> #created-495</span></h2><div class="pubdate">12 May at 07:37:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/495">https://github.com/qt4cg/qtspecs/issues/495</a></div><details><summary>separator example in https://qt4cg.org/specifications/xslt-40/Overview-diff.html#for-each-separator has xsl:sequence-of instead of xsl:sequence element</summary><div class="markup"><p>While looking through the XSLT 4 draft spec, I have found the following example in https://qt4cg.org/specifications/xslt-40/Overview-diff.html#for-each-separator:</p>
<pre><code>&lt;xsl:for-each select="6, 3, 9" separator="|"&gt;
   &lt;xsl:sort select="."/&gt;
   &lt;xsl:sequence-of select="., .+1"/&gt;
&lt;/xsl:for-each&gt;
</code></pre>
<p><code>xsl:sequence-of</code> should be <code>xsl:sequence</code>.</p>
</div></details></div>
<div class="toot" id="created-494"><h2>Pull request #494 created<span class="toot-id"> #created-494</span></h2><div class="pubdate">11 May at 17:41:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/494">https://github.com/qt4cg/qtspecs/pull/494</a></div><details><summary>Remove legacy materials from the working master branch</summary><div class="markup"><p>This is <em>intended to be</em> an entirely uninteresting change. This PR removes a whole bunch of historical artifacts from the <code>master</code> branch, things like the requirements and use-cases documents that we aren't maintaining for QT4, the errata which don't apply to QT4, etc.</p>
<p>I will push a separate branch, <code>legacy-documentation</code>, to the repository that contains all of the the files removed by this PR so that the aren't lost and can easily be recovered. (I won't do that as a PR, I'll just push it to the repository.)</p>
<p>In the meantime, I think this trimmed down master branch works just fine and it's a lot simpler and easier to explain.</p>
<p>This PR <em>does</em> remove support for the legacy ant builds, but I doubt they've worked for a while now.</p>
</div></details></div>
<div class="toot" id="created-493"><h2>Pull request #493 created<span class="toot-id"> #created-493</span></h2><div class="pubdate">11 May at 13:24:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/493">https://github.com/qt4cg/qtspecs/pull/493</a></div><p>32: try/catch: New variable for all error information</p></div>
<div class="toot" id="created-492"><h2>Pull request #492 created<span class="toot-id"> #created-492</span></h2><div class="pubdate">11 May at 12:09:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/492">https://github.com/qt4cg/qtspecs/pull/492</a></div><details><summary>Fix examples, change filepath definition slightly</summary><div class="markup"><p>This PR fixes the examples in the <code>parse-uri()</code> function. It also makes a small change to the <code>filepath</code> property, eliding it when the scheme is known not to be file.</p>
</div></details></div>
<div class="toot" id="created-491"><h2>Pull request #491 created<span class="toot-id"> #created-491</span></h2><div class="pubdate">11 May at 11:37:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/491">https://github.com/qt4cg/qtspecs/pull/491</a></div><details><summary>Fix more examples in the FO 4.0 spec</summary><div class="markup"><p>Further corrections to example code in the F+O specification, found by testing (app-spec-examples in the test suite).</p>
</div></details></div>
<div class="toot" id="created-490"><h2>Issue #490 created<span class="toot-id"> #created-490</span></h2><div class="pubdate">10 May at 22:03:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/490">https://github.com/qt4cg/qtspecs/issues/490</a></div><details><summary>Control over schema validation in parse-xml(), doc(), etc.</summary><div class="markup"><p>I'm struggling with a problem with the stylesheet that generates QT4 tests from the examples in the function catalog, and I think it's an example of a more general problem in schema-aware processing.</p>
<p>The spec gives this example (for json-to-xml):</p>
<pre><code>The expression json-to-xml('{"x": "\\", "y": "\u0025"}', map{'escape': true()}) returns 
(with whitespace added for legibility):

&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;string escaped="true" key="x"&gt;\\&lt;/string&gt;
  &lt;string key="y"&gt;%&lt;/string&gt;
&lt;/map&gt;
</code></pre>
<p>But the test we actually generate expects the result:</p>
<pre><code>&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
    &lt;string escaped="true" key="x" escaped-key="false"&gt;\\&lt;/string&gt;
    &lt;string key="y" escaped="false" escaped-key="false"&gt;%&lt;/string&gt;
&lt;/map&gt;
</code></pre>
<p>and the test is failing because the result produced by Saxon correctly excludes the <code>escaped-key="false"</code> attributes which the test is expecting. How did the attributes get there?</p>
<p>The answer is that the stylesheet is doing <code>parse-xml()</code> followed by some transformation to normalise whitespace, followed by <code>serialize()</code>. The <code>parse-xml()</code> call is invoking schema validation, which adds default attributes.</p>
<p>We probably don't want schema validation here; if we do want it, we probably don't want default attribute values to be expanded. But parse-xml() doesn't give us the choice. It says it's implementation-defined and it gives no options for the user to control it. Saxon provides configuration-level options but they aren't fine-grained enough to use here.</p>
<p>Without being able to control this, the only option seems to be for the stylesheet to transform the result to take out the defaulted attributes that the schema processor has added.</p>
<p>We need options on functions like <code>doc()</code> and <code>parse-xml()</code> to control whether and how schema validation is performed.</p>
<p>One of the options we need whenever we do validation is probably "validate+strip" - validate the input, report errors if it's invalid, but return the untyped data that was supplied to the validator, not the type-annotated data with expanded defaults.</p>
</div></details></div>
<div class="toot" id="created-489"><h2>Pull request #489 created<span class="toot-id"> #created-489</span></h2><div class="pubdate">10 May at 10:50:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/489">https://github.com/qt4cg/qtspecs/pull/489</a></div><p>443: Allow select attribute on xsl:[non-]matching-substring</p></div>
<div class="toot" id="closed-488"><h2>Issue #488 closed<span class="toot-id"> #closed-488</span></h2><div class="pubdate">10 May at 10:46:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/488">https://github.com/qt4cg/qtspecs/pull/488</a></div><p>433: Allow select attribute on xsl:[non-]matching-substring</p></div>
<div class="toot" id="created-488"><h2>Pull request #488 created<span class="toot-id"> #created-488</span></h2><div class="pubdate">10 May at 09:26:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/488">https://github.com/qt4cg/qtspecs/pull/488</a></div><details><summary>433: Allow select attribute on xsl:[non-]matching-substring</summary><div class="markup"><p>Allow a <code>select</code> attribute on <code>xsl:[non-]matching-substring</code> in place of the contained sequence constructor.</p>
</div></details></div>
<div class="toot" id="closed-484"><h2>Issue #484 closed<span class="toot-id"> #closed-484</span></h2><div class="pubdate">10 May at 08:01:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/484">https://github.com/qt4cg/qtspecs/pull/484</a></div><p>Update FO test generation stylesheet</p></div>
<div class="toot" id="closed-486"><h2>Issue #486 closed<span class="toot-id"> #closed-486</span></h2><div class="pubdate">10 May at 08:00:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/486">https://github.com/qt4cg/qtspecs/pull/486</a></div><p>Fix some errors in examples, as revealed by testing</p></div>
<div class="toot" id="created-487"><h2>Pull request #487 created<span class="toot-id"> #created-487</span></h2><div class="pubdate">10 May at 07:59:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/487">https://github.com/qt4cg/qtspecs/pull/487</a></div><details><summary>485: Predeclare the prefixes math, map, array, and err</summary><div class="markup"><p>In 3.1 XQuery processors were allowed to predeclare these prefixes; in 4.0 they are now required to do so.</p>
</div></details></div>
<div class="toot" id="created-486"><h2>Pull request #486 created<span class="toot-id"> #created-486</span></h2><div class="pubdate">09 May at 23:22:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/486">https://github.com/qt4cg/qtspecs/pull/486</a></div><details><summary>Fix some errors in examples, as revealed by testing</summary><div class="markup"><p>Corrects errors in examples; changes other examples to make them testable. Further test failures remain to be investigated (some may be bugs in the Saxon implementation; others require improvements to the test generation mechanism).</p>
</div></details></div>
<div class="toot" id="created-485"><h2>Issue #485 created<span class="toot-id"> #created-485</span></h2><div class="pubdate">09 May at 20:30:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/485">https://github.com/qt4cg/qtspecs/issues/485</a></div><details><summary>Predeclared namespaces in XQuery</summary><div class="markup"><p>XQuery defines that the prefixes xml, xs, xsi, fn, and local are predeclared, and states:</p>
<p>Additional predeclared namespace prefixes may be added to the [statically known namespaces]) by an implementation.</p>
<p>I propose that we add map, array, and math to this list, so that these can be used interoperably without pre-declaring them. It is already permitted for an implementation to do this, but it is not required. The change is backwards compatible, because user-defined namespace declarations override predeclared declarations.</p>
</div></details></div>
<div class="toot" id="created-484"><h2>Pull request #484 created<span class="toot-id"> #created-484</span></h2><div class="pubdate">09 May at 19:56:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/484">https://github.com/qt4cg/qtspecs/pull/484</a></div><details><summary>Update FO test generation stylesheet</summary><div class="markup"><p>Updates the stylesheet that generates tests from examples in the FO spec; plus supply a missing record definition in the function catalog so that it becomes ID/IDREF valid.</p>
</div></details></div>
<div class="toot" id="closed-63"><h2>Issue #63 closed<span class="toot-id"> #closed-63</span></h2><div class="pubdate">09 May at 18:31:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/63">https://github.com/qt4cg/qtspecs/issues/63</a></div><p>fn:slice, array:slice: Signatures, Examples</p></div>
<div class="toot" id="closed-477"><h2>Issue #477 closed<span class="toot-id"> #closed-477</span></h2><div class="pubdate">09 May at 18:31:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/477">https://github.com/qt4cg/qtspecs/pull/477</a></div><p>63: array:slice (editorial)</p></div>
<div class="toot" id="closed-29"><h2>Issue #29 closed<span class="toot-id"> #closed-29</span></h2><div class="pubdate">09 May at 18:31:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/29">https://github.com/qt4cg/qtspecs/issues/29</a></div><p>array:values (resolved: map:values, map:entries)</p></div>
<div class="toot" id="closed-473"><h2>Issue #473 closed<span class="toot-id"> #closed-473</span></h2><div class="pubdate">09 May at 18:27:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/473">https://github.com/qt4cg/qtspecs/issues/473</a></div><p>NaN ne NaN</p></div>
<div class="toot" id="closed-321"><h2>Issue #321 closed<span class="toot-id"> #closed-321</span></h2><div class="pubdate">09 May at 18:26:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/321">https://github.com/qt4cg/qtspecs/issues/321</a></div><p>relax $input in fn:serialize</p></div>
<div class="toot" id="closed-325"><h2>Issue #325 closed<span class="toot-id"> #closed-325</span></h2><div class="pubdate">09 May at 18:25:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/325">https://github.com/qt4cg/qtspecs/issues/325</a></div><p>Operator precedence table needs updating</p></div>
<div class="toot" id="closed-482"><h2>Issue #482 closed<span class="toot-id"> #closed-482</span></h2><div class="pubdate">09 May at 18:24:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/482">https://github.com/qt4cg/qtspecs/pull/482</a></div><p>473: NaN Comparisons (bug fix)</p></div>
<div class="toot" id="closed-476"><h2>Issue #476 closed<span class="toot-id"> #closed-476</span></h2><div class="pubdate">09 May at 18:24:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/476">https://github.com/qt4cg/qtspecs/pull/476</a></div><p>29: array:values</p></div>
<div class="toot" id="closed-475"><h2>Issue #475 closed<span class="toot-id"> #closed-475</span></h2><div class="pubdate">09 May at 18:23:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/475">https://github.com/qt4cg/qtspecs/pull/475</a></div><p>471: fn: prefix removed from function calls in the examples</p></div>
<div class="toot" id="closed-472"><h2>Issue #472 closed<span class="toot-id"> #closed-472</span></h2><div class="pubdate">09 May at 18:23:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/472">https://github.com/qt4cg/qtspecs/pull/472</a></div><p>321: Add new note and examples demonstrating adaptive serialization method</p></div>
<div class="toot" id="closed-468"><h2>Issue #468 closed<span class="toot-id"> #closed-468</span></h2><div class="pubdate">09 May at 18:23:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/468">https://github.com/qt4cg/qtspecs/pull/468</a></div><p>325 Update operator precedence table</p></div>
<div class="toot" id="closed-462"><h2>Issue #462 closed<span class="toot-id"> #closed-462</span></h2><div class="pubdate">09 May at 18:22:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/462">https://github.com/qt4cg/qtspecs/pull/462</a></div><p>434: Added examples for parse-integer()</p></div>
<div class="toot" id="created-483"><h2>Pull request #483 created<span class="toot-id"> #created-483</span></h2><div class="pubdate">08 May at 09:05:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/483">https://github.com/qt4cg/qtspecs/pull/483</a></div><p>452: window: make 'start' and 'when' optional</p></div>
<div class="toot" id="created-482"><h2>Pull request #482 created<span class="toot-id"> #created-482</span></h2><div class="pubdate">07 May at 20:05:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/482">https://github.com/qt4cg/qtspecs/pull/482</a></div><details><summary>473: NaN Comparisons (bug fix)</summary><div class="markup"><p>Drops the incorrect statement suggesting that NaN xx NaN is always false, for all six operators xx. In fact NaN ne NaN is true, as statements elsewhere in the spec make clear. Specifically, the operator mapping appendix of the XPath/XQuery language spec makes clear that <code>X ne Y</code> maps to <code>not(op:numeric-equal(X, Y))</code>.</p>
</div></details></div>
<div class="toot" id="created-481"><h2>Issue #481 created<span class="toot-id"> #created-481</span></h2><div class="pubdate">07 May at 18:43:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/481">https://github.com/qt4cg/qtspecs/issues/481</a></div><details><summary>When we have array:build and map:build, then why do we also need array:of and map:of ?</summary><div class="markup"><p>Looking at the current specification of the pairs of functions: (<strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-array-build">array:build</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-array-of">array:of</a></em></strong>) and (<strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-map-build">map:build</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-map-of">map:of</a></em></strong>), it is impossible not to notice that the second function in each of these pairs is a weak duplicate of the first.</p>
<p>Also, the examples provided for <strong><em>array:build</em></strong> and <strong><em>array:of</em></strong>, seem to have a good deal of common content / duplication / overlap.</p>
<p>Another issue is that <strong><em>array:of</em></strong> requires as input a sequence of  <strong>value records</strong>, whose definition is challenging to understand (and whose meaning seems to be solely to represent a sequence of sequences), and what is also really challenging is how to construct this argument to <strong><em>array:of</em></strong>. If this is unnatural and challenging, one would probably prefer to use just <strong><em>array:build</em></strong>.</p>
<p>Is there an example where it is possible to construct an array (or a map) with <strong><em>array:of</em></strong> (or with <strong><em>map:of</em></strong>) but it is impossible (or significantly more difficult) to construct the same array/map with the function <strong><em>array:build</em></strong> (or with <strong><em>map:build</em></strong>)?</p>
<p>If there are no such significant and convincing examples, then why do we need the <strong><em>xxx:of</em></strong> functions?</p>
<p>Thus the question naturally arises:  "<strong><em>Why is the function <code>xxx:of</code> necessary at all?</em></strong>"</p>
</div></details></div>
<div class="toot" id="created-480"><h2>Issue #480 created<span class="toot-id"> #created-480</span></h2><div class="pubdate">07 May at 18:22:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/480">https://github.com/qt4cg/qtspecs/issues/480</a></div><details><summary>Allow type promotion of xs:string to xs:anyURI</summary><div class="markup"><p>If it hasn't already been considered and ruled out, I'd like to propose adding a type promotion rule to XPath 4 that would allow <code>xs:string</code> to be type-promoted to <code>xs:anyURI</code>, so that functions with parameters whose types are declared as <code>xs:anyURI</code> can directly take <code>xs:string</code> values, without having to first cast these to <code>xs:anyURI</code>.</p>
<p>This would empower function authors to select <code>xs:anyURI</code> as a type - signaling that they’re expecting a URI - without forcing users of the function into explicitly casting their string-typed URIs.</p>
<p>The motivation behind this proposal is that many eXist users are frustrated when using the eXist extension functions that properly declare parameters as <code>xs:anyURI</code>. If this proposal isn’t adopted, that’s ok; we’ll just eliminate the use of <code>xs:anyURI</code> in our functions, as proposed in https://github.com/eXist-db/exist/issues/4632. But this would a bit unfortunate for authors of functions who see the use of <code>xs:anyURI</code> as a proper expression of intent in their functions.</p>
<p>The change would be to https://www.w3.org/TR/xpath-31/#promotion - and I guess would be a 3rd item, called "String type promotion", saying:</p>
<blockquote>
<p>A value of type <code>xs:string</code> can be promoted to the type <code>xs:anyURI</code>. The result of this promotion is created by casting the original value to the type <code>xs:anyURI</code>.</p>
</blockquote>
</div></details></div>
<div class="toot" id="created-479"><h2>Issue #479 created<span class="toot-id"> #created-479</span></h2><div class="pubdate">07 May at 11:33:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/479">https://github.com/qt4cg/qtspecs/issues/479</a></div><details><summary>fn:deep-equal: Input order</summary><div class="markup"><p>#383 is about the specific order of children of element nodes.</p>
<p>I think we should also provide an option to ignore the top-level order of the input items:</p>
<pre><code class="language-xquery">(: returns true: both input arguments contain the same items, but in a different order :)
deep-equal(
  (1 to 10),
  reverse(1 to 10),
  map { 'unordered': true() }
)

(: returns false: the compared elements are different :)
deep-equal(
  &lt;a&gt;&lt;b/&gt;&lt;c/&gt;&lt;/a&gt;,
  &lt;a&gt;&lt;c/&gt;&lt;b/&gt;&lt;/a&gt;,
  map { 'unordered': true() }
)

(: returns false: the second sequence contains duplicates :)
deep-equal(
  (1, 2),
  (2, 1, 1),
  map { 'unordered': true() }
)
</code></pre>
</div></details></div>
<div class="toot" id="created-478"><h2>Pull request #478 created<span class="toot-id"> #created-478</span></h2><div class="pubdate">07 May at 10:53:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/478">https://github.com/qt4cg/qtspecs/pull/478</a></div><p>467: map:keys-where</p></div>
<div class="toot" id="created-477"><h2>Pull request #477 created<span class="toot-id"> #created-477</span></h2><div class="pubdate">07 May at 10:04:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/477">https://github.com/qt4cg/qtspecs/pull/477</a></div><p>63: array:slice (editorial)</p></div>
<div class="toot" id="created-476"><h2>Pull request #476 created<span class="toot-id"> #created-476</span></h2><div class="pubdate">07 May at 09:59:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/476">https://github.com/qt4cg/qtspecs/pull/476</a></div><p>29: array:values</p></div>
<div class="toot" id="closed-423"><h2>Issue #423 closed<span class="toot-id"> #closed-423</span></h2><div class="pubdate">05 May at 17:49:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/423">https://github.com/qt4cg/qtspecs/issues/423</a></div><p>[XSLT 4.0] 2.2 Notation is incomplete</p></div>
<div class="toot" id="created-475"><h2>Pull request #475 created<span class="toot-id"> #created-475</span></h2><div class="pubdate">05 May at 16:02:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/475">https://github.com/qt4cg/qtspecs/pull/475</a></div><details><summary>471: fn: prefix removed from function calls in the examples</summary><div class="markup"><p>#471: I’ve removed the <code>fn:</code> prefixes from the function calls in the examples.</p>
<p>I have left pretty much all <code>true</code>/<code>false</code> strings untouched, since I’m not sure what would be the most consistent approach to clean them up. It will be better anyway to create a separate PR for that.</p>
</div></details></div>
<div class="toot" id="closed-474"><h2>Issue #474 closed<span class="toot-id"> #closed-474</span></h2><div class="pubdate">05 May at 13:14:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/474">https://github.com/qt4cg/qtspecs/pull/474</a></div><p>Per comments on #465, improve presentation of multi-line expressions</p></div>
<div class="toot" id="closed-465"><h2>Issue #465 closed<span class="toot-id"> #closed-465</span></h2><div class="pubdate">05 May at 12:16:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/465">https://github.com/qt4cg/qtspecs/pull/465</a></div><p>80: fn:iterate-while: Examples revised</p></div>
<div class="toot" id="created-474"><h2>Pull request #474 created<span class="toot-id"> #created-474</span></h2><div class="pubdate">05 May at 11:52:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/474">https://github.com/qt4cg/qtspecs/pull/474</a></div><details><summary>Per comments on #465, improve presentation of multi-line expressions</summary><div class="markup"><p>This PR addresses points raised in the comments on #465.</p>
<p>If an <code>fos:expression</code> element is a code block, nest an <code>eg</code> inside it:</p>
<pre><code class="language-xml">               &lt;fos:expression&gt;&lt;eg&gt;&lt;![CDATA[let $input := 3936256
return fn:iterate-while(
  $input,
  function($result) { abs($result * $result - $input) &gt;= 0.0000000001 },
  function($guess) { ($guess + $input div $guess) div 2 }
)]]&gt;&lt;/eg&gt;&lt;/fos:expression&gt;
</code></pre>
<p>I found four examples where an <code>fos:expression</code> contained more than one newline and I added <code>eg</code> wrappers in those cases.</p>
<p>There are many more <code>fos:expression</code> elements that contain a single newline, but automatically formatting them as code blocks was often unsuccessful. Many of those cases seem to be just newlines entered for authoring convenience.</p>
<p>I also fixed the CSS for code blocks and attempte to remove trailing newlines from code blocks.</p>
</div></details></div>
<div class="toot" id="created-473"><h2>Issue #473 created<span class="toot-id"> #created-473</span></h2><div class="pubdate">04 May at 17:18:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/473">https://github.com/qt4cg/qtspecs/issues/473</a></div><details><summary>NaN ne NaN</summary><div class="markup"><p>It seems that ever since 2.0, the section in Functions and Operators "Comparison Operators on Numeric Values" (currently §4.3) has stated "If either, or both, operands are NaN, false is returned."</p>
<p>This is incorrect. If the operator is <code>ne</code>, then the correct result is true.</p>
<p>(And editorially, the first two commas in this sentence should be dropped).</p>
</div></details></div>
<div class="toot" id="created-472"><h2>Pull request #472 created<span class="toot-id"> #created-472</span></h2><div class="pubdate">04 May at 15:21:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/472">https://github.com/qt4cg/qtspecs/pull/472</a></div><details><summary>321: Add new note and examples demonstrating adaptive serialization method</summary><div class="markup"><p>Per <a href="https://github.com/qt4cg/qtspecs/issues/321">Issue 321</a>, I've added a new note and two additional simple examples noting the adaptive serialization method to draw attention to this feature in the existing specs.</p>
</div></details></div>
<div class="toot" id="created-471"><h2>Issue #471 created<span class="toot-id"> #created-471</span></h2><div class="pubdate">04 May at 13:03:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/471">https://github.com/qt4cg/qtspecs/issues/471</a></div><details><summary>Unify formatting (function calls, code blocks, quotes) in the specification</summary><div class="markup"><p><strong>Todos (2023-05-18)</strong>:</p>
<ul>
<li>[x] Initial cleanup of <code>fn:</code> prefixes → <a href="https://github.com/qt4cg/qtspecs/pull/475">#475</a></li>
<li>[x] Remove more <code>fn:</code> prefixes → <a href="https://github.com/qt4cg/qtspecs/pull/509">#509</a>
<ul>
<li><code>fn:</code> prefixes in examples that raise an error.</li>
<li><code>fn:</code> prefixes in <code>eg</code> code blocks</li>
<li>other documents: <code>expressions.xml</code>, <code>query-examples.xml</code>, …</li>
</ul>
</li>
<li>[x] Render <code>false</code>, <code>true</code>, <code>NaN</code>, <code>INF</code>, <code>+INF</code> as code → <a href="https://github.com/qt4cg/qtspecs/pull/510">#510</a></li>
<li>[x] Render string values as code and use quotes: <code>"yes"</code>, <code>"true"</code>, <code>"0"</code> → <a href="https://github.com/qt4cg/qtspecs/pull/511">#511</a></li>
<li>[x] Omit quotes for single characters: <code>\b</code>, <code>\f</code>, … → <a href="https://github.com/qt4cg/qtspecs/pull/511">#511</a></li>
<li>[x] Rewrite simple to typographic quotes → <a href="https://github.com/qt4cg/qtspecs/pull/511">#511</a></li>
</ul>
<hr>
<p>Inspired by https://github.com/qt4cg/qtspecs/pull/454#issuecomment-1534633089 ff.</p>
<p>The syntax of the examples in the XQFO specification is inconsistent. Sometimes, functions in the standard function namespace have an <code>fn</code> prefix…</p>
<ul>
<li><code>fn:fold-right(1 to 5, "", fn:concat(?, ".", ?))</code></li>
<li><code>fn:substring("motor car", 6)</code></li>
</ul>
<p>…sometimes they don’t…</p>
<ul>
<li><code>data(123)</code></li>
<li><code>concat("http://www.example.com/", encode-for-uri("~bébé"))</code></li>
</ul>
<p>…sometimes it’s both:</p>
<ul>
<li><code>fn:fold-right(1 to 5, "$zero", concat("$f(", ?, ", ", ?, ")"))</code></li>
<li><code>fn:concat(01, 02, 03, 04, true())</code></li>
<li><code>fn:tokenize(fn:unparsed-text($href), '\r\n|\r|\n')[not(position()=last() and .='')]</code></li>
</ul>
<p>Should we drop or keep the prefix – or doesn’t it really matter? If there’s interest, I can create a PR (I’d tend to drop the prefixes).</p>
<p>In addition, there doesn’t seem to be a consistent rule for representing booleans. We have:</p>
<p>Syntax | Comment
--- | ---
…returns false | mostly used in the rules (seems appropriate to me)
…returns <code>false</code> | used in the rules; maybe we should use replace it with the first syntax?
…the result is <code>fn:false()</code> | used in the rules; maybe we should use replace it with the first syntax?
…returns <code>false()</code> | mostly used in the examples (seems appropriate to me)</p>
</div></details></div>
<div class="toot" id="created-470"><h2>Pull request #470 created<span class="toot-id"> #created-470</span></h2><div class="pubdate">04 May at 11:34:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/470">https://github.com/qt4cg/qtspecs/pull/470</a></div><details><summary>369: add fixed-prefixes attribute in XSLT</summary><div class="markup"><p>A solution to some of the problems identified in issue #369. This proposal affects XSLT only.</p>
</div></details></div>
<div class="toot" id="created-469"><h2>Issue #469 created<span class="toot-id"> #created-469</span></h2><div class="pubdate">04 May at 07:09:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/469">https://github.com/qt4cg/qtspecs/issues/469</a></div><details><summary>array:of-members, map:of-pairs: Signatures, Examples</summary><div class="markup"><p>Just trivia:</p>
<p>a) The parameter name of <code>array:of-members</code> is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-array-of"><code>$input</code></a>.
&nbsp;&nbsp;&nbsp;&nbsp;<code>$members</code> may be a better choice (or we should change <code>map:of-pairs($pairs)</code> to <code>map:of-pairs($input)</code>).</p>
<p>b) The type of <code>$pairs</code> is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-map-of"><code>record(key as xs:anyAtomicType, value as item()*, *)*</code></a>.
&nbsp;&nbsp;&nbsp;&nbsp;Shouldn’t it be <code>record(key as xs:anyAtomicType, value as item()*)*</code> (without the trailing <code>, *</code>)?
&nbsp;&nbsp;&nbsp;&nbsp;If the current syntax is correct, an explanatory comment could be helpful.</p>
<p>c) ~One <code>map:of</code> example needs to be fixed: <code>map:of((map:entry(0, "no"), map:entry(1, "yes")))</code>.~ See #607</p>
<p>See #508 for the proposal to rename <code>map:of</code> to <code>map:of-pairs</code>.</p>
</div></details></div>
<div class="toot" id="created-468"><h2>Pull request #468 created<span class="toot-id"> #created-468</span></h2><div class="pubdate">03 May at 21:59:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/468">https://github.com/qt4cg/qtspecs/pull/468</a></div><details><summary>325 Update operator precedence table</summary><div class="markup"><p>Add "otherwise" and thin arrow to the table. Editorial.</p>
</div></details></div>
<div class="toot" id="created-467"><h2>Issue #467 created<span class="toot-id"> #created-467</span></h2><div class="pubdate">03 May at 11:09:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/467">https://github.com/qt4cg/qtspecs/issues/467</a></div><details><summary>map:keys-where: Return Keys That Match a Predicate</summary><div class="markup"><p><strong>Edit, 23/05/17:</strong> Reopened to discuss <code>map:keys($map, $predicate)</code> as an alternative.</p>
<hr>
<h3>Motivation</h3>
<p>We have <code>fn:index-where</code> and <code>array:index-where</code> to locate items/members in a sequence/an array that match a specific predicate, and we could introduce an equivalent function for maps. A recent use case can be found in https://github.com/qt4cg/qtspecs/issues/413#issuecomment-1531288167d.</p>
<h3>Proposal</h3>
<h4>Summary</h4>
<p>Returns keys of map entries for which the value matches a supplied predicate.</p>
<h4>Signature</h4>
<pre><code class="language-xquery">map:keys-where(
  $map        as map(*),
  $predicate  as function(item()*) as xs:boolean
) as xs:anyAtomicValue*
</code></pre>
<h4>Properties</h4>
<p>This function is ·deterministic·, ·context-independent·, and ·focus-independent·.</p>
<h4>Rules</h4>
<p>The function takes any ·map· as its <code>$map</code> argument and applies the supplied function to the value of each map entry. The function supplied as <code>$predicate</code> takes the value of the corresponding map entry as an argument, and the result is a sequence containing the keys of those entries for which the function returns true.</p>
<p>More formally, the function returns the result of the expression:</p>
<pre><code class="language-xquery">map:for-each(
  $map,
  function($key, $value) {
    if($predicate($value)) then $key else ()
  }
)
</code></pre>
<h4>Examples</h4>
<pre><code class="language-xquery">let $numbers := map { 0: 'zero', 1: 'one', 2: 'two', 3: 'three' }
return map:keys-where($numbers, function($string) { $string = 'two' })
</code></pre>
<h3>Comments</h3>
<ul>
<li><strong>Edit (2023-05-04):</strong> Renamed from <code>map:key-where</code> to <code>map:keys-where</code>.</li>
<li>Similar functions (<code>index-of</code>, <code>index-where</code>) use the singular form.</li>
<li>An alternative would be to add an optional <code>$predicate</code> function argument to <code>map:keys</code>.</li>
<li>If we decide to introduce a shorter syntax (see <a href="https://github.com/qt4cg/qtspecs/issues/129">#129</a> and <a href="https://github.com/qt4cg/qtspecs/issues/129">#436</a>), we could have:</li>
</ul>
<pre><code class="language-xquery">map:keys-where($numbers, { . = 'two ' })
</code></pre>
</div></details></div>
<div class="toot" id="created-466"><h2>Pull request #466 created<span class="toot-id"> #created-466</span></h2><div class="pubdate">02 May at 23:36:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/466">https://github.com/qt4cg/qtspecs/pull/466</a></div><details><summary>460: Fix math symbols</summary><div class="markup"><p>(1) drops the mathematical operator symbols appendix, which allowed an extensive range of non-ASCII characters as synonyms for language keywords, (2) retains × and ÷ as synonyms for multiplication and division, (3) allows full-width <code>&lt;</code> and <code>&gt;</code> in operator symbols in place of the usual ASCII characters, to avoid the need for XML escaping.</p>
</div></details></div>
<div class="toot" id="minutes-05-02"><h2>QT4 CG meeting 033 draft minutes<span class="toot-id"> #minutes-05-02</span></h2><div class="pubdate">02 May at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/05-02">https://qt4cg.org/meeting/minutes/2023/05-02</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-449"><h2>Issue #449 closed<span class="toot-id"> #closed-449</span></h2><div class="pubdate">02 May at 16:27:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/449">https://github.com/qt4cg/qtspecs/pull/449</a></div><p>Actions from review of PR #420</p></div>
<div class="toot" id="closed-456"><h2>Issue #456 closed<span class="toot-id"> #closed-456</span></h2><div class="pubdate">02 May at 16:26:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/456">https://github.com/qt4cg/qtspecs/pull/456</a></div><p>Revises numeric literal syntax</p></div>
<div class="toot" id="closed-458"><h2>Issue #458 closed<span class="toot-id"> #closed-458</span></h2><div class="pubdate">02 May at 16:26:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/458">https://github.com/qt4cg/qtspecs/pull/458</a></div><p>Update parse-integer and format-integer following review</p></div>
<div class="toot" id="closed-224"><h2>Issue #224 closed<span class="toot-id"> #closed-224</span></h2><div class="pubdate">02 May at 16:25:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/224">https://github.com/qt4cg/qtspecs/issues/224</a></div><p>Infrastructure changes/improvements</p></div>
<div class="toot" id="closed-461"><h2>Issue #461 closed<span class="toot-id"> #closed-461</span></h2><div class="pubdate">02 May at 16:25:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/461">https://github.com/qt4cg/qtspecs/pull/461</a></div><p>Make code more visually distinct</p></div>
<div class="toot" id="created-465"><h2>Pull request #465 created<span class="toot-id"> #created-465</span></h2><div class="pubdate">02 May at 12:37:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/465">https://github.com/qt4cg/qtspecs/pull/465</a></div><details><summary>80: fn:iterate-while: Examples revised</summary><div class="markup"><p>This PR is editorial. I’ve reformatted the examples for <code>fn:iterate-while</code>…</p>
<p><img src="https://user-images.githubusercontent.com/196589/235667578-896f8ef3-8d11-49fb-81b5-352d522a99a3.png" alt="image"></p>
<p>…to make them better readable.</p>
</div></details></div>
<div class="toot" id="agenda-05-02"><h2>QT4 CG meeting 033 draft agenda<span class="toot-id"> #agenda-05-02</span></h2><div class="pubdate">01 May at 17:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/05-02">https://qt4cg.org/meeting/agenda/2023/05-02</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-464"><h2>Issue #464 created<span class="toot-id"> #created-464</span></h2><div class="pubdate">29 Apr at 21:01:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/464">https://github.com/qt4cg/qtspecs/issues/464</a></div><details><summary>Serialization sequence normalization step 3 needs clarification</summary><div class="markup"><p>The specifications currently read:</p>
<blockquote>
<p>If the item-separator serialization parameter is absent, then for each subsequence of adjacent strings in S2, copy a single string to the new sequence equal to the values of the strings in the subsequence concatenated in order, each separated by a single space. Copy all other items to the new sequence. Otherwise, copy each item in S2 to the new sequence, inserting between each pair of items a string whose value is equal to the value of the item-separator parameter. The new sequence is S3.</p>
</blockquote>
<p>As written ("If...then.... Otherwise...."), this implies that the process whereby a block of adjacent strings are joined into a single string is performed only when the item separator parameter is absent. I.e., if the item-separator parameter is not absent, it will not be used to string-join adjacent groups of strings. Perhaps that is as intended, but I want to make sure.</p>
<p>Also, as written, this implies that when the parameter is absent, the sequence begins by finding all subsequences of adjacent strings, performing concatenation. Then all non-strings are added to the sequence. That seems wrong, because it appears to advise the processor to rearrange the sequence of input items.</p>
<p>I propose a revision along these lines:</p>
<blockquote>
<p>Copy each item in S2 to a new sequence. If a given pair of adjacent items are both strings, then separate them with a string whose value is equal to the value of the item-separator parameter or is a single space if the item-separator parameter is absent. If a given pair of adjacent items are not both strings, insert between each pair of items a string whose value is equal to the value of the item-separator parameter. Once this is finished, take each adjacent group of strings and concatenate them into a single string. The new sequence is S3.</p>
</blockquote>
<p>My revision is based upon what I imagine happens, but implementers will know better than I.</p>
<p>I am working on some editorial touch-ups of the Serialization specifications, and can incorporate comments/suggestions made in this thread in that larger enterprise.</p>
</div></details></div>
<div class="toot" id="created-463"><h2>Issue #463 created<span class="toot-id"> #created-463</span></h2><div class="pubdate">28 Apr at 20:09:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/463">https://github.com/qt4cg/qtspecs/issues/463</a></div><details><summary>fn:parts() - extract the parts of a (not-really) atomic value</summary><div class="markup"><p>We have a whole raft of functions to extract the parts of date, time, and duration values: month-from-dateTime(), etc etc.</p>
<p>These aren't particularly convenient to use, for example getting multiple components of a duration is clumsy; and there are gaps, for example there are no functions to extract the parts of a <code>gMonthDay</code>.</p>
<p>I propose a general-purpose function <code>fn:parts()</code> which turns any of these composite atomic values into a map, enabling you to replace a call on <code>get-month-from-dateTime($value)</code> with <code>parts($value)?month</code>.</p>
<p>So far this dupllicates existing functionality perhaps with a bit of added convenience. However, the mechanism is much more extensible and flexible than what we have now:</p>
<ul>
<li>we can apply it to atomic types that currently have no decomposition operators, such as gMonthDay</li>
<li>we can easily add additional components such as <code>day-of-week</code> or <code>quarter</code> or <code>day-of-year</code> or <code>julian-day</code> that are currently not available, or only available clumsily using format-dateTime().</li>
<li>the parts() function is polymorphic, so the same code can be used to get the year (say) from a date, a dateTime, or a gYearMonth.</li>
</ul>
</div></details></div>
<div class="toot" id="created-462"><h2>Pull request #462 created<span class="toot-id"> #created-462</span></h2><div class="pubdate">27 Apr at 23:19:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/462">https://github.com/qt4cg/qtspecs/pull/462</a></div><details><summary>434: Added examples for parse-integer()</summary><div class="markup"><p>Supplemental examples related to pr #434 .</p>
</div></details></div>
<div class="toot" id="created-461"><h2>Pull request #461 created<span class="toot-id"> #created-461</span></h2><div class="pubdate">27 Apr at 11:56:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/461">https://github.com/qt4cg/qtspecs/pull/461</a></div><details><summary>Make code more visually distinct</summary><div class="markup"><p>Close #224</p>
<p>Thanks @ChristianGruen for the reminder that this was still open!</p>
</div></details></div>
<div class="toot" id="created-460"><h2>Issue #460 created<span class="toot-id"> #created-460</span></h2><div class="pubdate">27 Apr at 10:57:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/460">https://github.com/qt4cg/qtspecs/issues/460</a></div><details><summary>Mathematical Operator Symbols</summary><div class="markup"><p>Appendix B.3 of the specification proposes a set of non-ASCII symbols that can be used in place of language keywords, for example "∃" for "some" and "∀" for "every".</p>
<p>I haven't detected a great deal of enthusiasm for this idea, and I can see it causing some confusion, partly because Unicode offers such a wide choice of symbols some of which are visually very similar.</p>
<p>I propose retaining a much smaller set of these symbols:</p>
<ul>
<li>
<p>"÷" (xF7) for "div" because the symbol is widely recognised and "div" here is pretty ugly</p>
</li>
<li>
<p>"≺" (x227A) and "≻" (x227B) as alternatives to "&lt;" and "&gt;" in all operator symbols (other than XML markup contexts) that use these characters: for readability in contexts, especially XSLT, where the "&lt;" and "&gt;" characters need to be escaped</p>
</li>
</ul>
</div></details></div>
<div class="toot" id="closed-4"><h2>Issue #4 closed<span class="toot-id"> #closed-4</span></h2><div class="pubdate">27 Apr at 10:32:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/4">https://github.com/qt4cg/qtspecs/issues/4</a></div><p>[XPath] [XQuery] Better names for ThinArrowTarget and FatArrowTarget</p></div>
<div class="toot" id="closed-59"><h2>Issue #59 closed<span class="toot-id"> #closed-59</span></h2><div class="pubdate">27 Apr at 10:27:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/59">https://github.com/qt4cg/qtspecs/issues/59</a></div><p>[FO] fn:replace no longer has the 3 an 4 argument variants</p></div>
<div class="toot" id="created-459"><h2>Issue #459 created<span class="toot-id"> #created-459</span></h2><div class="pubdate">27 Apr at 07:29:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/459">https://github.com/qt4cg/qtspecs/issues/459</a></div><details><summary>Eager and lazy evaluation</summary><div class="markup"><p>In #359, different approaches were discussed for eager and lazy evaluation. This issue could be used to</p>
<ol>
<li>clarify if we have the same notion of eagerness and laziness, and</li>
<li>define language constructs for how eager/lazy evaluation.</li>
</ol>
</div></details></div>
<div class="toot" id="created-458"><h2>Pull request #458 created<span class="toot-id"> #created-458</span></h2><div class="pubdate">26 Apr at 17:35:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/458">https://github.com/qt4cg/qtspecs/pull/458</a></div><details><summary>Update parse-integer and format-integer following review</summary><div class="markup"><p>Following review and acceptance of the parse-integer and format-integer functions, make changes suggested during the review. See actions QT4G-032-03 to -06.</p>
</div></details></div>
<div class="toot" id="created-457"><h2>Issue #457 created<span class="toot-id"> #created-457</span></h2><div class="pubdate">26 Apr at 06:32:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/457">https://github.com/qt4cg/qtspecs/issues/457</a></div><details><summary>Support parsing numeric, alphabetic, and additive number systems.</summary><div class="markup"><p>This proposal is based on the work done in https://www.w3.org/TR/css-counter-styles-3/ when defining CSS rules for formatting the numbers in list items.</p>
<p>The idea is to define 3 parsing strategies:</p>
<ol>
<li><code>numeric</code> -- number-like systems such as decimal;</li>
<li><code>alphabetic</code> -- alphabetical-like systems such as spreadsheet columns (A, B, ..., Z, AA, AB, ...)</li>
<li><code>additive</code> -- systems like roman and hebrew where the symbol represents a fixed value that is added together</li>
</ol>
<p>Parsing these, we have 3 properties:</p>
<ol>
<li><code>system as enum("numeric", "alphabetic", "additive") := "numeric"</code> -- which of the parsing strategies (number systems) to use;</li>
<li><code>symbols as xs:string := "0123456789"</code> -- the list of characters used to represent a digit;</li>
<li><code>additive-symbols as map(xs:integer, xs:string) := map {}</code> -- a map of the symbols in an additive system with the corresponding value of that symbol.</li>
</ol>
<p>Consideration 1 -- Should these also allow any whitespace and optional "+"/"-" symbols like the radix-based parse-integer?</p>
<p>Consideration 2 -- Should we define decimal format options for these, so the decimal format name can format/represent other number systems (binary, hex, hebrew, tamil, roman numerals, etc.). -- Note: this would make <code>system</code>, <code>symbols</code>, and <code>additive-symbols</code> properties of the decimal format object with the above defaults. The formatting would work in the same way as it is defined in the CSS Counter Styles specification.</p>
<h2>Design 1 -- Separate functions</h2>
<pre><code>fn:parse-numeric-integer($value as xs:string,
                         $symbols as xs:string := "0123456789") as xs:integer

fn:parse-alphabetic-integer($value as xs:string,
                            $symbols as xs:string := "ABCDEFGHIJKLMNOPQRSTUVWXYZ") as xs:integer

fn:parse-additive-integer($value as xs:string,
                          $additive-symbols as map(xs:integer, xs:string)) as xs:integer
</code></pre>
<h2>Design 2 -- Combined functions</h2>
<pre><code>fn:parse-integer($value as xs:string,
                 $system as xs:string := "numeric",
                 $symbols as xs:string := "0123456789",
                 $additive-symbols as map(xs:integer, xs:string) := map {}) as xs:integer

fn:parse-integer($value as xs:string,
                 $radix as xs:integer) as xs:integer
</code></pre>
</div></details></div>
<div class="toot" id="created-456"><h2>Pull request #456 created<span class="toot-id"> #created-456</span></h2><div class="pubdate">25 Apr at 18:55:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/456">https://github.com/qt4cg/qtspecs/pull/456</a></div><details><summary>Revises numeric literal syntax</summary><div class="markup"><p>Following actions from review on 25 Apri 2023 (QT4CG-032-02), revises the new syntax of numeric literals to disallow trailing underscores. Also adds more notes and examples.</p>
</div></details></div>
<div class="toot" id="minutes-04-25"><h2>QT4 CG meeting 032 draft minutes<span class="toot-id"> #minutes-04-25</span></h2><div class="pubdate">25 Apr at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/04-25">https://qt4cg.org/meeting/minutes/2023/04-25</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-429"><h2>Issue #429 closed<span class="toot-id"> #closed-429</span></h2><div class="pubdate">25 Apr at 16:32:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/429">https://github.com/qt4cg/qtspecs/issues/429</a></div><p>Hexadecimal and binary literals</p></div>
<div class="toot" id="closed-241"><h2>Issue #241 closed<span class="toot-id"> #closed-241</span></h2><div class="pubdate">25 Apr at 16:32:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/241">https://github.com/qt4cg/qtspecs/issues/241</a></div><p>Functions integer-to-string and string-to-integer with radix</p></div>
<div class="toot" id="closed-434"><h2>Issue #434 closed<span class="toot-id"> #closed-434</span></h2><div class="pubdate">25 Apr at 16:31:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/434">https://github.com/qt4cg/qtspecs/pull/434</a></div><p>Functions to parse and format hex integers</p></div>
<div class="toot" id="closed-433"><h2>Issue #433 closed<span class="toot-id"> #closed-433</span></h2><div class="pubdate">25 Apr at 16:31:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/433">https://github.com/qt4cg/qtspecs/pull/433</a></div><p>Add hex and binary literals and allow underscores</p></div>
<div class="toot" id="created-455"><h2>Pull request #455 created<span class="toot-id"> #created-455</span></h2><div class="pubdate">25 Apr at 13:40:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/455">https://github.com/qt4cg/qtspecs/pull/455</a></div><details><summary>410: Converting doubles to decimals, fractional digits</summary><div class="markup"><p>@michaelhkay In this PR, I tried to undo the changes that were introduced to make comparisons transitive. I haven’t made any changes to <code>distinct-values</code> and <code>group by</code>, because I am uncertain if I have spotted all the relevant parts of the specification. Maybe/hopefully we can address them in a next step.</p>
<p>Any feedback is welcome.</p>
</div></details></div>
<div class="toot" id="closed-293"><h2>Issue #293 closed<span class="toot-id"> #closed-293</span></h2><div class="pubdate">24 Apr at 12:48:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/293">https://github.com/qt4cg/qtspecs/issues/293</a></div><p>Error in fn:doc-available specification</p></div>
<div class="toot" id="closed-430"><h2>Issue #430 closed<span class="toot-id"> #closed-430</span></h2><div class="pubdate">24 Apr at 12:48:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/430">https://github.com/qt4cg/qtspecs/pull/430</a></div><p>fn:doc et al, error handling: inconsistencies. Closes #293</p></div>
<div class="toot" id="created-454"><h2>Pull request #454 created<span class="toot-id"> #created-454</span></h2><div class="pubdate">24 Apr at 12:42:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/454">https://github.com/qt4cg/qtspecs/pull/454</a></div><details><summary>125: array:partition</summary><div class="markup"><p>This PR revisits array:partition, with extra editorial clarification of the spec; including but not confined to fixing issue #125.</p>
<p>I suggest we schedule this PR for discussion since we have not previously discussed it.</p>
<p>One question for the group is what the name of the function should be (including the choice of namespace).</p>
<p>Another is whether the polarity of the callback function should be changed (from <code>break-when</code> to <code>continue-when</code> or similar).</p>
<p>We could also consider returning an array of sequences rather than a sequence of arrays. (But in my view sequences of arrays are rather easier to manage at the moment.)</p>
</div></details></div>
<div class="toot" id="closed-453"><h2>Issue #453 closed<span class="toot-id"> #closed-453</span></h2><div class="pubdate">24 Apr at 11:17:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/453">https://github.com/qt4cg/qtspecs/pull/453</a></div><p>Fix issue #86 (incorrect default timezone format)</p></div>
<div class="toot" id="created-453"><h2>Pull request #453 created<span class="toot-id"> #created-453</span></h2><div class="pubdate">24 Apr at 11:00:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/453">https://github.com/qt4cg/qtspecs/pull/453</a></div><details><summary>Fix issue #86 (incorrect default timezone format)</summary><div class="markup"><p>Trivial bug fix.</p>
</div></details></div>
<div class="toot" id="closed-89"><h2>Issue #89 closed<span class="toot-id"> #closed-89</span></h2><div class="pubdate">24 Apr at 10:49:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/89">https://github.com/qt4cg/qtspecs/issues/89</a></div><p>[XQuery] DirPIConstructor permits ':' in the PI name.</p></div>
<div class="toot" id="agenda-04-25"><h2>QT4 CG meeting 032 draft agenda<span class="toot-id"> #agenda-04-25</span></h2><div class="pubdate">24 Apr at 09:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/04-25">https://qt4cg.org/meeting/agenda/2023/04-25</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-452"><h2>Issue #452 created<span class="toot-id"> #created-452</span></h2><div class="pubdate">21 Apr at 23:09:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/452">https://github.com/qt4cg/qtspecs/issues/452</a></div><details><summary>window: make 'start' and 'when' optional</summary><div class="markup"><p>Every time I use <code>tumbling window</code>, I write <code>start when true()</code>.    If start would be optional, default to true, that would be easier</p>
</div></details></div>
<div class="toot" id="closed-450"><h2>Issue #450 closed<span class="toot-id"> #closed-450</span></h2><div class="pubdate">20 Apr at 13:50:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/450">https://github.com/qt4cg/qtspecs/pull/450</a></div><p>Fix issue #418 (editorial corrections)</p></div>
<div class="toot" id="closed-438"><h2>Issue #438 closed<span class="toot-id"> #closed-438</span></h2><div class="pubdate">20 Apr at 13:49:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/438">https://github.com/qt4cg/qtspecs/issues/438</a></div><p>What are the "non-whitespace control characters"?</p></div>
<div class="toot" id="closed-442"><h2>Issue #442 closed<span class="toot-id"> #closed-442</span></h2><div class="pubdate">20 Apr at 13:49:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/442">https://github.com/qt4cg/qtspecs/pull/442</a></div><p>Attempt to clearify XML serialization of control characters</p></div>
<div class="toot" id="created-451"><h2>Issue #451 created<span class="toot-id"> #created-451</span></h2><div class="pubdate">20 Apr at 06:51:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/451">https://github.com/qt4cg/qtspecs/issues/451</a></div><details><summary>Multiple Schemas</summary><div class="markup"><p>There are many situations in which a single transformation wants to deal with multiple schemas: for example when transforming from v1 of some industry standard to v2 of the same standard, or when processing a collection of input documents each of which references its own schema using <code>xsi:schemaLocation</code>.</p>
<p>This is currently possible only if the schemas are compatible (that is, if the union of the schemas is itself a valid schema). And even where it is possible, validation against the union of S1 and S2 may produce a different outcome from validation against S2, for example because a strict wildcard allows content that S2 would not allow. Substitution groups are a particular problem: if v1 and v2 have elements with different substitution group membership, then validating against the union of v1 and v2 allows the union of the substitution groups, which means that you haven't actually verified that the result document is valid against v2.</p>
<p>The problem is confounded by considerations that are outside the scope of the spec. What happens when you run two different stylesheets against the same source document? If the source document has been validated against S1, this means that both stylesheets must use schemas that are supersets of S1. The way this requirement is managed in Saxon is to introduce the concept of a Configuration in which transformations run; a Configuration has a single schema, and all source documents and stylesheets within the Configuration must use compatible subsets of this schema. A source document validated using one Configuration cannot be used in a different Configuration, because the type annotations would be meaningless against a different schema.</p>
<p>My proposal is to introduce the idea of a named schema (that is, a named collection of schema components). When we do <code>xsl:import-schema</code>, we can give the imported schema a name, and there is no requirement that the components in this schema should be compatible with the components in any other schema. When we refer to a schema type (for example in <code>$s cast as QName</code>) we should be able to qualify the type name with a schema name (we can postpone discussions of syntax, let's say <code>cast as my:part-number§v1</code> for now). When we request validation, we should be able to nominate the schema to be used for validation, for example <code>&lt;xsl:element name="e" validation="strict" schema="v2"&gt;</code>.</p>
<p>The trickiest part is handling source documents, mainly because validation of source documents (especially those read using doc() or collection()) is at present almost entirely implementation-defined. I believe that we need explicit options to request validation of source documents against a specific schema. There should also be an option to validate a document against the schema identified in its own <code>xsi:schemaLocation</code>, in which case there should be no requirement that that schema is compatible with any schema known statically to the stylesheet.</p>
</div></details></div>
<div class="toot" id="closed-49"><h2>Issue #49 closed<span class="toot-id"> #closed-49</span></h2><div class="pubdate">19 Apr at 15:09:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/49">https://github.com/qt4cg/qtspecs/issues/49</a></div><p>[XQuery] The 'member' keyword is still present on ForMemberBinding</p></div>
<div class="toot" id="closed-74"><h2>Issue #74 closed<span class="toot-id"> #closed-74</span></h2><div class="pubdate">19 Apr at 15:06:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/74">https://github.com/qt4cg/qtspecs/issues/74</a></div><p>[FO] Support parsing HTML</p></div>
<div class="toot" id="closed-87"><h2>Issue #87 closed<span class="toot-id"> #closed-87</span></h2><div class="pubdate">19 Apr at 15:04:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/87">https://github.com/qt4cg/qtspecs/issues/87</a></div><p>[XSL] Support for "master files"</p></div>
<div class="toot" id="closed-109"><h2>Issue #109 closed<span class="toot-id"> #closed-109</span></h2><div class="pubdate">19 Apr at 15:02:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/109">https://github.com/qt4cg/qtspecs/issues/109</a></div><p>[xslt4] xsl:note for structured documentation</p></div>
<div class="toot" id="closed-113"><h2>Issue #113 closed<span class="toot-id"> #closed-113</span></h2><div class="pubdate">19 Apr at 14:59:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/113">https://github.com/qt4cg/qtspecs/issues/113</a></div><p>[xslt] Constructing arrays</p></div>
<div class="toot" id="closed-239"><h2>Issue #239 closed<span class="toot-id"> #closed-239</span></h2><div class="pubdate">19 Apr at 14:55:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/239">https://github.com/qt4cg/qtspecs/issues/239</a></div><p>Terminology concerning function items and their access to static and dynamic context</p></div>
<div class="toot" id="closed-373"><h2>Issue #373 closed<span class="toot-id"> #closed-373</span></h2><div class="pubdate">19 Apr at 14:52:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/373">https://github.com/qt4cg/qtspecs/issues/373</a></div><p>apparent copy/paste error in annotation documentation of simple type yes-or-no-or-maybe</p></div>
<div class="toot" id="created-450"><h2>Pull request #450 created<span class="toot-id"> #created-450</span></h2><div class="pubdate">19 Apr at 14:50:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/450">https://github.com/qt4cg/qtspecs/pull/450</a></div><p>Fix issue #418 (editorial corrections)</p></div>
<div class="toot" id="created-449"><h2>Pull request #449 created<span class="toot-id"> #created-449</span></h2><div class="pubdate">19 Apr at 13:52:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/449">https://github.com/qt4cg/qtspecs/pull/449</a></div><details><summary>Actions from review of PR #420</summary><div class="markup"><p>Actions from review of PR #420 (QT4CG-031-01, -02); new functions <code>map:entries()</code> and <code>map:values()</code> from issue #29</p>
</div></details></div>
<div class="toot" id="closed-445"><h2>Issue #445 closed<span class="toot-id"> #closed-445</span></h2><div class="pubdate">19 Apr at 07:59:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/445">https://github.com/qt4cg/qtspecs/pull/445</a></div><p>Editorial updates to XSLT spec</p></div>
<div class="toot" id="created-448"><h2>Issue #448 created<span class="toot-id"> #created-448</span></h2><div class="pubdate">19 Apr at 05:43:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/448">https://github.com/qt4cg/qtspecs/issues/448</a></div><details><summary>Support extended dateTime formats of ISO-8601:2019?</summary><div class="markup"><p>The ISO 8601:2019 <a href="https://www.iso.org/obp/ui#iso:std:iso:8601:-2:ed-1:v1:en:term:3.1.1.4">standard</a> supports extended dateTime formats including support for uncertain or approximate times and new quantifiers. Apparently, the extension are documented in <a href="https://www.loc.gov/standards/datetime/">Extended Date/Time Format (EDTF) Specification</a> from the US LoC.</p>
</div></details></div>
<div class="toot" id="created-447"><h2>Pull request #447 created<span class="toot-id"> #created-447</span></h2><div class="pubdate">18 Apr at 23:24:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/447">https://github.com/qt4cg/qtspecs/pull/447</a></div><details><summary>435, 53, 436: lambda expressions, thin arrows</summary><div class="markup"><p>Addresses issue 436 by introducing syntax similar to Java, C#, and JS for anonymous inline functions (lamda expressions). This involves finding a new symbol for the existing "thin arrow" operator; it also gives an opportunity to show how lambda expressions can be used in pipelines.</p>
<p>Some points for WG consideration:</p>
<p>(a) Do we really want the curly braces around the function body to be mandatory?</p>
<p>(b) What symbol should we use for the mapping arrow? I've used <code>=!&gt;</code> as it suggests to me the combination of function application and sequence mapping.</p>
<p>(c) Should we reinstate the special syntax for arity-one "focus functions" (<code>-&gt;{@salary})</code> ) which is dropped in this proposal</p>
<p>(d) I haven't necessarily worked through all the changes to examples needed, e.g.. in the XSLT and F+O specs.</p>
</div></details></div>
<div class="toot" id="closed-437"><h2>Issue #437 closed<span class="toot-id"> #closed-437</span></h2><div class="pubdate">18 Apr at 19:33:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/437">https://github.com/qt4cg/qtspecs/issues/437</a></div><p>xsl:where-populated and table with header</p></div>
<div class="toot" id="minutes-04-18"><h2>QT4 CG meeting 031 draft minutes<span class="toot-id"> #minutes-04-18</span></h2><div class="pubdate">18 Apr at 18:03:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/04-18">https://qt4cg.org/meeting/minutes/2023/04-18</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-357"><h2>Issue #357 closed<span class="toot-id"> #closed-357</span></h2><div class="pubdate">18 Apr at 17:10:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/357">https://github.com/qt4cg/qtspecs/issues/357</a></div><p>Representing key-value pairs</p></div>
<div class="toot" id="closed-420"><h2>Issue #420 closed<span class="toot-id"> #closed-420</span></h2><div class="pubdate">18 Apr at 17:10:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/420">https://github.com/qt4cg/qtspecs/pull/420</a></div><p>Issue 357 Map composition and decomposition</p></div>
<div class="toot" id="closed-446"><h2>Issue #446 closed<span class="toot-id"> #closed-446</span></h2><div class="pubdate">18 Apr at 17:10:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/446">https://github.com/qt4cg/qtspecs/pull/446</a></div><p>Fix merge conflicts in PR #420</p></div>
<div class="toot" id="created-446"><h2>Pull request #446 created<span class="toot-id"> #created-446</span></h2><div class="pubdate">18 Apr at 17:01:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/446">https://github.com/qt4cg/qtspecs/pull/446</a></div><details><summary>Fix merge conflicts in PR #420</summary><div class="markup"><p>Close #420
Close #357</p>
</div></details></div>
<div class="toot" id="created-445"><h2>Pull request #445 created<span class="toot-id"> #created-445</span></h2><div class="pubdate">18 Apr at 16:54:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/445">https://github.com/qt4cg/qtspecs/pull/445</a></div><details><summary>Editorial updates to XSLT spec</summary><div class="markup"><p>This PR fixes editorial issues in the XSLT 4.0 spec: issue #373, issue #384, issue #423. It also updates the XSD schema for XSLT 4.0 to incorporate most of the syntax changes that have been made to date (though further checking is needed), and updates some 3.0/3.1 references to 4.0 references.</p>
</div></details></div>
<div class="toot" id="closed-444"><h2>Issue #444 closed<span class="toot-id"> #closed-444</span></h2><div class="pubdate">18 Apr at 16:31:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/444">https://github.com/qt4cg/qtspecs/pull/444</a></div><p>Resolve merge conflict for PR 420</p></div>
<div class="toot" id="created-444"><h2>Pull request #444 created<span class="toot-id"> #created-444</span></h2><div class="pubdate">18 Apr at 16:29:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/444">https://github.com/qt4cg/qtspecs/pull/444</a></div><details><summary>Resolve merge conflict for PR 420</summary><div class="markup"><p>Close #420
Close #357</p>
</div></details></div>
<div class="toot" id="created-443"><h2>Issue #443 created<span class="toot-id"> #created-443</span></h2><div class="pubdate">18 Apr at 15:40:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/443">https://github.com/qt4cg/qtspecs/issues/443</a></div><details><summary>@select on xsl:matching-substring and xsl:non-matching-substring</summary><div class="markup"><p>In the spirit of making <code>@select</code> or<code> &lt;sequence constructor&gt;</code> the norm, I think the children of <code>xsl:analyze-string</code> have perhaps been overlooked.</p>
</div></details></div>
<div class="toot" id="created-442"><h2>Pull request #442 created<span class="toot-id"> #created-442</span></h2><div class="pubdate">18 Apr at 12:42:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/442">https://github.com/qt4cg/qtspecs/pull/442</a></div><details><summary>Attempt to clearify XML serialization of control characters</summary><div class="markup"><p>Fix #438</p>
<p>Clarify that the control characters #x1 through X1f and #x7f through #x9f must be output as character references except for the whitespace characters #x9, #xA, #xD, and #85.</p>
</div></details></div>
<div class="toot" id="closed-439"><h2>Issue #439 closed<span class="toot-id"> #closed-439</span></h2><div class="pubdate">18 Apr at 10:45:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/439">https://github.com/qt4cg/qtspecs/issues/439</a></div><p>ExprSingle no longer allows OrExpr</p></div>
<div class="toot" id="closed-440"><h2>Issue #440 closed<span class="toot-id"> #closed-440</span></h2><div class="pubdate">18 Apr at 10:45:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/440">https://github.com/qt4cg/qtspecs/pull/440</a></div><p>Fix bug #439 - grammar for ExprSingle</p></div>
<div class="toot" id="closed-441"><h2>Issue #441 closed<span class="toot-id"> #closed-441</span></h2><div class="pubdate">18 Apr at 10:45:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/441">https://github.com/qt4cg/qtspecs/pull/441</a></div><p>Make XSLT function formatting consistent with F&amp;O formatting</p></div>
<div class="toot" id="created-441"><h2>Pull request #441 created<span class="toot-id"> #created-441</span></h2><div class="pubdate">18 Apr at 10:44:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/441">https://github.com/qt4cg/qtspecs/pull/441</a></div><details><summary>Make XSLT function formatting consistent with F&amp;O formatting</summary><div class="markup"><p>Resolves action QT4CG-023-01, I believe. This is a minimal sort of fix, not an attempt to refactor everything.</p>
</div></details></div>
<div class="toot" id="created-440"><h2>Pull request #440 created<span class="toot-id"> #created-440</span></h2><div class="pubdate">18 Apr at 10:13:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/440">https://github.com/qt4cg/qtspecs/pull/440</a></div><details><summary>Fix bug #439 - grammar for ExprSingle</summary><div class="markup"><p>Simple bug fix, shouldn't need any meeting time.</p>
</div></details></div>
<div class="toot" id="created-439"><h2>Issue #439 created<span class="toot-id"> #created-439</span></h2><div class="pubdate">18 Apr at 09:03:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/439">https://github.com/qt4cg/qtspecs/issues/439</a></div><details><summary>ExprSingle no longer allows OrExpr</summary><div class="markup"><p>The grammar for ExprSingle seems to have been accidentally changed so it no longer allows an OrExpr as one of the alternatives.</p>
</div></details></div>
<div class="toot" id="created-438"><h2>Issue #438 created<span class="toot-id"> #created-438</span></h2><div class="pubdate">15 Apr at 08:56:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/438">https://github.com/qt4cg/qtspecs/issues/438</a></div><details><summary>What are the "non-whitespace control characters"?</summary><div class="markup"><p>In Section 5, XML Serialization, we find:</p>
<blockquote>
<p>A consequence of this rule is that certain characters MUST be output as character references, to ensure that they survive the round trip through serialization and parsing. Specifically, CR, NEL and LINE SEPARATOR characters in text nodes MUST be output respectively as "&amp;#xD;", "&amp;#x85;", and "&amp;#x2028;", or their equivalents; while CR, NL, TAB, NEL and LINE SEPARATOR characters in attribute nodes MUST be output respectively as "&amp;#xD;", "&amp;#xA;", "&amp;#x9;", "&amp;#x85;", and "&amp;#x2028;", or their equivalents. In addition, the non-whitespace control characters #x1 through #x1F and #x7F through #x9F in text nodes and attribute nodes MUST be output as character references.
(The reference to "non-whitespace control characters" appears in a few other places as well, but for basically the same purpose.)</p>
</blockquote>
<p>But what <strong>are</strong> the "non-whitespace control characters"? The spec doesn't say. I think it means <em>all</em> of the C0 and C1 control characters except CR, NL, TAB, and NEL. The fact that vertical tab and line feed might be considered "white space" doesn't really matter anyway since none of the other C0 control characters are allowed in XML 1.0 anyway (encoded or otherwise).</p>
<p>XML 1.0 doesn't actually care about the C1 control characters. There's no reason to encode them, but it does no harm, I suppose. You'd have to encode the C0 and C1 control characters for an XML 1.1 parser, but none of those exist.</p>
<p>I wonder if it might be a little clearer to say</p>
<blockquote>
<p>A consequence of this rule is that certain characters MUST be output as character references, to ensure that they survive the round trip through serialization and parsing. Specifically, CR, NEL and LINE SEPARATOR characters in text nodes MUST be output respectively as "&amp;#xD;", "&amp;#x85;", and "&amp;#x2028;", or their equivalents; while CR, NL, TAB, NEL and LINE SEPARATOR characters in attribute nodes MUST be output respectively as "&amp;#xD;", "&amp;#xA;", "&amp;#x9;", "&amp;#x85;", and "&amp;#x2028;", or their equivalents. In addition, the other control characters #x1 through #x1F (except  #x9, #xA, and #xD) and #x7F through #x9F (except #x85) in text nodes and attribute nodes MUST be output as character references.</p>
</blockquote>
</div></details></div>
<div class="toot" id="agenda-04-18"><h2>QT4 CG meeting 031 draft agenda<span class="toot-id"> #agenda-04-18</span></h2><div class="pubdate">14 Apr at 10:50:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/04-18">https://qt4cg.org/meeting/agenda/2023/04-18</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-437"><h2>Issue #437 created<span class="toot-id"> #created-437</span></h2><div class="pubdate">13 Apr at 14:26:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/437">https://github.com/qt4cg/qtspecs/issues/437</a></div><details><summary>xsl:where-populated and table with header</summary><div class="markup"><p>Dear all,</p>
<p>I just discover the use of xsl:where-populated but was surprised it cover only a narrow use case of single level of wrapping</p>
<p>My use case is about table and I have to wrap thing into a table with header</p>
<pre><code class="language-xml">&lt;table ... bunch of attributes'
    &lt;thead ....&gt;
    &lt;xsl:for-each ... &gt;
       &lt;tr&gt;  
          &lt;xsl:for-each ... &gt;
              &lt;td&gt;...&lt;/td&gt;
         &lt;/xsl:for-each&gt;
     &lt;/tr&gt;
   &lt;/xsl:for-each&gt;
&lt;/table&gt;
</code></pre>
<p>How can I do that with  xsl:where-populated ?</p>
</div></details></div>
<div class="toot" id="created-436"><h2>Issue #436 created<span class="toot-id"> #created-436</span></h2><div class="pubdate">11 Apr at 17:19:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/436">https://github.com/qt4cg/qtspecs/issues/436</a></div><details><summary>Allow inline function expressions in arrow operator call chains</summary><div class="markup"><p>It can be useful to create inline functions for simple operations (e.g. adding 1 to a number) to be used in arrow operator call chains.</p>
<p>The current proposal uses <code>-&gt; { ... }</code> for just the thin arrow operator.</p>
<p>This proposal is split into two parts:</p>
<ol>
<li>restructure the grammar to make the function call usage simpler to follow;</li>
<li>introduce the ability to use inline functions in thin/fat arrow contexts.</li>
</ol>
<h2>Part 1 -- Simplify the Grammar</h2>
<p>I suggest changing the grammar to:</p>
<pre><code>FatArrowTarget           ::= "=&gt;" ( ArrowFunctionCall | ArrowDynamicFunctionCall )
ThinArrowTarget          ::= "-&gt;" ( ArrowFunctionCall | ArrowDynamicFunctionCall )
ArrowFunctionCall        ::= EQName ArgumentList
ArrowDynamicFunctionCall ::= ( VarRef | ParenthesizedExpr ) PositionalArgumentList
</code></pre>
<p>That is, I've grouped the function name/reference with the argument list.</p>
<h2>Part 2 -- Allow Inline Functions</h2>
<pre><code>FatArrowTarget          ::= "=&gt;" ( ArrowFunctionCall | ArrowDynamicFunctionCall | ArrowInlineFunctionCall )
ThinArrowTarget         ::= "-&gt;" ( ArrowFunctionCall | ArrowDynamicFunctionCall | ArrowInlineFunctionCall )
ArrowInlineFunctionCall ::= ( "function" | "fun" ) EnclosedExpr
</code></pre>
<p>Note: here, <code>"fun"</code> is a placeholder for whichever name/symbol we choose in https://github.com/qt4cg/qtspecs/issues/53.</p>
<p>This then allows expressions like <code>(1, 2, 3) -&gt; function { . + 1 }</code> and <code>(1, 2, 3) =&gt; fun { ~ = 1 }</code> (see also https://github.com/qt4cg/qtspecs/issues/129) without overloading the meaning of <code>-&gt;</code>.</p>
</div></details></div>
<div class="toot" id="minutes-04-11"><h2>QT4 CG meeting 030 draft minutes<span class="toot-id"> #minutes-04-11</span></h2><div class="pubdate">11 Apr at 17:17:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/04-11">https://qt4cg.org/meeting/minutes/2023/04-11</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-435"><h2>Issue #435 created<span class="toot-id"> #created-435</span></h2><div class="pubdate">11 Apr at 16:33:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/435">https://github.com/qt4cg/qtspecs/issues/435</a></div><details><summary>Remove the inlined function expression variant of the thin arrow operator</summary><div class="markup"><p>This proposal is to remove the third bullet/variant from the thin arrow operator so that the new inline function syntax (<code>-&gt; { ... }</code>) cannot be used within the arrow expressions.</p>
<p>This makes the thin/fat arrows consistent in behaviour with each other, with the exception of how they pass the value to the expressions:</p>
<ol>
<li>thin arrow operators pass the values in the sequence one at a time to the associated function;</li>
<li>fat arrow operators pass all the values in the sequence to the associated function in a single call.</li>
</ol>
<h2>Changes</h2>
<ol>
<li>Update the syntax:</li>
</ol>
<pre><code>[46] FatArrowTarget  ::= "=&gt;" ((ArrowStaticFunction ArgumentList) | (ArrowDynamicFunction PositionalArgumentList)) 	
[47] ThinArrowTarget ::= "-&gt;" ((ArrowStaticFunction ArgumentList) | (ArrowDynamicFunction PositionalArgumentList))
</code></pre>
<ol start="2">
<li>Remove the text for the inline function variant:</li>
</ol>
<blockquote>
<p>If the arrow is followed by an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#doc-xpath40-EnclosedExpr">EnclosedExpr</a>:</p>
<p>Given a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#doc-xpath40-UnaryExpr">UnaryExpr</a> U, and an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#doc-xpath40-EnclosedExpr">EnclosedExpr</a> {E}, the expression U -&gt; {E} is equivalent to the expression (U) ! (E).</p>
<p>For example, the expression $x -&gt; {.+1} is equivalent to ($x)!(.+1).</p>
</blockquote>
<ol start="3">
<li>Remove/update the associated examples, e.g. to use <code>let $f := function ($x) { $x + 1 } return $x -&gt; f() -&gt; $f()</code>.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-390"><h2>Issue #390 closed<span class="toot-id"> #closed-390</span></h2><div class="pubdate">11 Apr at 16:16:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/390">https://github.com/qt4cg/qtspecs/issues/390</a></div><p>Should parsing and building URIs attempt to special case Windows URIs for UNC names?</p></div>
<div class="toot" id="closed-415"><h2>Issue #415 closed<span class="toot-id"> #closed-415</span></h2><div class="pubdate">11 Apr at 16:16:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/415">https://github.com/qt4cg/qtspecs/pull/415</a></div><p>Revise parse/build URI functions for UNC names</p></div>
<div class="toot" id="agenda-04-11"><h2>QT4 CG meeting 030 draft agenda<span class="toot-id"> #agenda-04-11</span></h2><div class="pubdate">09 Apr at 19:35:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/04-11">https://qt4cg.org/meeting/agenda/2023/04-11</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-434"><h2>Pull request #434 created<span class="toot-id"> #created-434</span></h2><div class="pubdate">07 Apr at 11:57:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/434">https://github.com/qt4cg/qtspecs/pull/434</a></div><details><summary>Functions to parse and format hex integers</summary><div class="markup"><p>Addresses issue #241 by providing functions to parse and format integers in any number base from 2 to 36.</p>
</div></details></div>
<div class="toot" id="created-433"><h2>Pull request #433 created<span class="toot-id"> #created-433</span></h2><div class="pubdate">07 Apr at 09:56:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/433">https://github.com/qt4cg/qtspecs/pull/433</a></div><details><summary>Add hex and binary literals and allow underscores</summary><div class="markup"><p>Addresses issue #429. The grammar is extended to allow hex and binary integer literals, and all numeric literals may contain underscores for readability.</p>
</div></details></div>
<div class="toot" id="closed-432"><h2>Issue #432 closed<span class="toot-id"> #closed-432</span></h2><div class="pubdate">07 Apr at 07:43:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/432">https://github.com/qt4cg/qtspecs/pull/432</a></div><p>fix attribute name : it is diff instead of role</p></div>
<div class="toot" id="created-432"><h2>Pull request #432 created<span class="toot-id"> #created-432</span></h2><div class="pubdate">06 Apr at 20:01:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/432">https://github.com/qt4cg/qtspecs/pull/432</a></div><p>fix attribute name : it is diff instead of role</p></div>
<div class="toot" id="closed-417"><h2>Issue #417 closed<span class="toot-id"> #closed-417</span></h2><div class="pubdate">06 Apr at 15:51:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/417">https://github.com/qt4cg/qtspecs/pull/417</a></div><p>Fix residual reference to op:A2S which is no longer defined</p></div>
<div class="toot" id="closed-315"><h2>Issue #315 closed<span class="toot-id"> #closed-315</span></h2><div class="pubdate">06 Apr at 15:51:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/315">https://github.com/qt4cg/qtspecs/issues/315</a></div><p>fn:transform inconsistency: initial-mode</p></div>
<div class="toot" id="closed-427"><h2>Issue #427 closed<span class="toot-id"> #closed-427</span></h2><div class="pubdate">06 Apr at 15:51:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/427">https://github.com/qt4cg/qtspecs/pull/427</a></div><p>Change fn:transform to use the stylesheet's default mode</p></div>
<div class="toot" id="closed-280"><h2>Issue #280 closed<span class="toot-id"> #closed-280</span></h2><div class="pubdate">06 Apr at 15:50:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/280">https://github.com/qt4cg/qtspecs/issues/280</a></div><p>Why is resolve-uri forbidden from resolving against a URI that contains a fragment identifier?</p></div>
<div class="toot" id="closed-426"><h2>Issue #426 closed<span class="toot-id"> #closed-426</span></h2><div class="pubdate">06 Apr at 15:50:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/426">https://github.com/qt4cg/qtspecs/pull/426</a></div><p>Resolve #280 by allowing a fragid</p></div>
<div class="toot" id="closed-428"><h2>Issue #428 closed<span class="toot-id"> #closed-428</span></h2><div class="pubdate">06 Apr at 12:05:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/428">https://github.com/qt4cg/qtspecs/pull/428</a></div><p>Fix problem in rendering empty &lt;xnt&gt; elements</p></div>
<div class="toot" id="closed-431"><h2>Issue #431 closed<span class="toot-id"> #closed-431</span></h2><div class="pubdate">06 Apr at 12:05:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/431">https://github.com/qt4cg/qtspecs/pull/431</a></div><p>Fix problem rendering xnt elements</p></div>
<div class="toot" id="created-431"><h2>Pull request #431 created<span class="toot-id"> #created-431</span></h2><div class="pubdate">06 Apr at 12:05:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/431">https://github.com/qt4cg/qtspecs/pull/431</a></div><details><summary>Fix problem rendering xnt elements</summary><div class="markup"><p>Close #428</p>
<p>Hi @michaelhkay . I took a slightly different approach. For unknown reasons long since lost in the mists of time the 'etc' files that act as databases for cross-spec references stored <code>nt</code> elements. That's weird because the <code>nt</code> elements are supposed to point to <code>prod</code> elements. I expect someone (let's be candid, probably me) got confused by the fact that <code>nt</code> elements have a <code>def</code> attribute and thought they were definitions. They're not. I've changed things so that the <code>prod</code> elements are now stored in the database. There's only going to ever be one of those.</p>
<p>I had to tidy up a few things to make that work, and we can't abandon support for <code>nt</code> files in 'etc' documents because we have existing files that don't get regenerated.</p>
<p>I also cleaned up the cross-reference error to <code>StringLiteral</code> in the XSLT spec and patched over a problem with a few link in the XQuery specifications.</p>
<p>There's no useful information from PR formatting of PRs that change the stylesheets, so I'm just going to cross my fingers and merge this. Please pull the latest and let me know if you see any problems!</p>
</div></details></div>
<div class="toot" id="created-430"><h2>Pull request #430 created<span class="toot-id"> #created-430</span></h2><div class="pubdate">06 Apr at 09:32:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/430">https://github.com/qt4cg/qtspecs/pull/430</a></div><details><summary>fn:doc et al, error handling: inconsistencies. Closes #293</summary><div class="markup"><p>Resolves action item QT4CG-029-04.</p>
</div></details></div>
<div class="toot" id="created-429"><h2>Issue #429 created<span class="toot-id"> #created-429</span></h2><div class="pubdate">05 Apr at 17:04:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/429">https://github.com/qt4cg/qtspecs/issues/429</a></div><details><summary>Hexadecimal and binary literals</summary><div class="markup"><p>Without wanting to challenge our weekly burn-down chart too much, I wonder whether it would be a big deal to support hexadecimal and binary literals in XPath? Examples:</p>
<pre><code class="language-xquery">(: decimal :)     1, 255,
(: hexadecimal :) 0x1, 0X00Ff,
(: binary :)      0b1, 0B11111111, 
</code></pre>
<p>The main question is probably if it conflicts with the existing grammar?</p>
</div></details></div>
<div class="toot" id="created-428"><h2>Pull request #428 created<span class="toot-id"> #created-428</span></h2><div class="pubdate">05 Apr at 16:21:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/428">https://github.com/qt4cg/qtspecs/pull/428</a></div><details><summary>Fix problem in rendering empty &lt;xnt&gt; elements</summary><div class="markup"><p>In the F&amp;O spec, function <code>parse-QName</code>,  there is a link to <code>BracedURILiteral</code> repeated 6 times. This happens when an <code>&lt;xnt&gt;</code> element is written with empty content. There are 6 entries in the /etc/ XP40 file for the relevant grammar symbol, and each of them is output. I haven't tried to eliminate the redundancy in the /etc/XP40 file, I have simply changed the code for processing <code>&lt;xnt&gt;</code> so it only considers the first one.</p>
</div></details></div>
<div class="toot" id="closed-411"><h2>Issue #411 closed<span class="toot-id"> #closed-411</span></h2><div class="pubdate">05 Apr at 14:19:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/411">https://github.com/qt4cg/qtspecs/pull/411</a></div><p>Remove the note from the parse-html unparsed-entity sections.</p></div>
<div class="toot" id="created-427"><h2>Pull request #427 created<span class="toot-id"> #created-427</span></h2><div class="pubdate">05 Apr at 14:17:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/427">https://github.com/qt4cg/qtspecs/pull/427</a></div><details><summary>Change fn:transform to use the stylesheet's default mode</summary><div class="markup"><p>Close #315</p>
</div></details></div>
<div class="toot" id="created-426"><h2>Pull request #426 created<span class="toot-id"> #created-426</span></h2><div class="pubdate">04 Apr at 21:01:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/426">https://github.com/qt4cg/qtspecs/pull/426</a></div><details><summary>Resolve #280 by allowing a fragid</summary><div class="markup"><p>Fix #280</p>
<p>(Based off the right branch this time. I hope.)</p>
</div></details></div>
<div class="toot" id="closed-424"><h2>Issue #424 closed<span class="toot-id"> #closed-424</span></h2><div class="pubdate">04 Apr at 21:01:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/424">https://github.com/qt4cg/qtspecs/pull/424</a></div><p>Allow fn:resolve-uri to resolve against a base URI that includes a fragment identifier</p></div>
<div class="toot" id="created-425"><h2>Issue #425 created<span class="toot-id"> #created-425</span></h2><div class="pubdate">04 Apr at 20:09:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/425">https://github.com/qt4cg/qtspecs/issues/425</a></div><details><summary>Structural proposal (ThinLayer:tm:) : Add a layer of thin spec between XPath and the XPath Derived Language</summary><div class="markup"><p>XPath is ubiquitous and is used even in places where we have no idea
On the other hand XPath is very useful to us as the centerpiece of XSLT, XQuery</p>
<p>In order to allow people to have a more expanded use of XPath without to have to get the whole XSLT, XQuery story, it is perhaps the time to consider adding a thin layer of spec in order to have</p>
<ol>
<li>XPath</li>
<li>Some typing definition mechanism</li>
<li>Some function definition mechanism</li>
</ol>
<p>The idea is also to better integrate this with all Validation technologies (XSD, Relax NG, NVDL, JSONSchema, etc.) and allow EXPath, EXQuery and other to have a standard way to use all this around</p>
<p>We also want people that want to use only XPath (for example in LinQ or inside SQL) to have a broader capacity to interact with XML (instead of being limited to XPath 1.0 with namespaces)</p>
<p>I will try to add more and more precision to this proposal along the line, but I feel it is good enough to be a first stone to break and allow people to help drive this initiative</p>
<p>For the moment the name of this new beast is <strong>XPathWithCustomizableTypesAndFunctions</strong> in our proposal call XPath Next https://github.com/XPath-Next/XPath-Next/blob/first-draft/spec.md</p>
</div></details></div>
<div class="toot" id="minutes-04-04"><h2>QT4 CG meeting 029 draft minutes<span class="toot-id"> #minutes-04-04</span></h2><div class="pubdate">04 Apr at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/04-04">https://qt4cg.org/meeting/minutes/2023/04-04</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-424"><h2>Pull request #424 created<span class="toot-id"> #created-424</span></h2><div class="pubdate">04 Apr at 17:12:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/424">https://github.com/qt4cg/qtspecs/pull/424</a></div><details><summary>Allow fn:resolve-uri to resolve against a base URI that includes a fragment identifier</summary><div class="markup"><p>Fix #280</p>
</div></details></div>
<div class="toot" id="created-423"><h2>Issue #423 created<span class="toot-id"> #created-423</span></h2><div class="pubdate">04 Apr at 14:24:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/423">https://github.com/qt4cg/qtspecs/issues/423</a></div><details><summary>[XSLT 4.0] 2.2 Notation is incomplete</summary><div class="markup"><p>"language" and "prefixes" are used in the definition of element but not defined here</p>
<p>On the other hand,  "nmtokens" is defined but not used</p>
</div></details></div>
<div class="toot" id="closed-22"><h2>Issue #22 closed<span class="toot-id"> #closed-22</span></h2><div class="pubdate">04 Apr at 11:32:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/22">https://github.com/qt4cg/qtspecs/issues/22</a></div><p>[XPath] Allowing multiple let clauses in LetExpr and for clauses in ForExpr</p></div>
<div class="toot" id="closed-416"><h2>Issue #416 closed<span class="toot-id"> #closed-416</span></h2><div class="pubdate">04 Apr at 10:23:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/416">https://github.com/qt4cg/qtspecs/pull/416</a></div><p>NCName is usually lowercase in attribute  type for the rest of the spec</p></div>
<div class="toot" id="closed-422"><h2>Issue #422 closed<span class="toot-id"> #closed-422</span></h2><div class="pubdate">04 Apr at 10:22:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/422">https://github.com/qt4cg/qtspecs/pull/422</a></div><p>Fix syntax in examples</p></div>
<div class="toot" id="created-422"><h2>Pull request #422 created<span class="toot-id"> #created-422</span></h2><div class="pubdate">04 Apr at 09:58:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/422">https://github.com/qt4cg/qtspecs/pull/422</a></div><details><summary>Fix syntax in examples</summary><div class="markup"><p>attribute namespace-uri corrected to namespace
xsl:sequence-of corrected to xsl:sequence</p>
</div></details></div>
<div class="toot" id="closed-419"><h2>Issue #419 closed<span class="toot-id"> #closed-419</span></h2><div class="pubdate">04 Apr at 09:37:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/419">https://github.com/qt4cg/qtspecs/pull/419</a></div><p>fix few syntax issues in the XSLT 4.0 examples </p></div>
<div class="toot" id="created-421"><h2>Issue #421 created<span class="toot-id"> #created-421</span></h2><div class="pubdate">04 Apr at 09:36:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/421">https://github.com/qt4cg/qtspecs/issues/421</a></div><details><summary>Make sure the build system syntax checks the syntax of examples</summary><div class="markup"><p>Apparently the code is lying around somewhere...</p>
</div></details></div>
<div class="toot" id="created-420"><h2>Pull request #420 created<span class="toot-id"> #created-420</span></h2><div class="pubdate">04 Apr at 09:26:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/420">https://github.com/qt4cg/qtspecs/pull/420</a></div><details><summary>Issue 357 Map composition and decomposition</summary><div class="markup"><p>This PR addresses the issues concerned with map composition and decomposition in issue #357. It adds a function to decompose a map into key-value pairs (map:key-value-pairs), and its inverse (map:of). It adds explanatory material to F+O to explain how these functions relate to each other, and it adds examples to the XSLT spec to show how the interwork with the xsl:array, xsl:map, and xsl:for-each instructions. Note: the map functions have been sorted alphabetically, so the changes will appear more extensive than they are.</p>
</div></details></div>
<div class="toot" id="created-419"><h2>Pull request #419 created<span class="toot-id"> #created-419</span></h2><div class="pubdate">04 Apr at 08:29:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/419">https://github.com/qt4cg/qtspecs/pull/419</a></div><p>fix few syntax issues in the XSLT 4.0 examples </p></div>
<div class="toot" id="created-418"><h2>Issue #418 created<span class="toot-id"> #created-418</span></h2><div class="pubdate">04 Apr at 08:22:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/418">https://github.com/qt4cg/qtspecs/issues/418</a></div><details><summary>array and map attribute in xsl:iterate and xsl:for-each-group</summary><div class="markup"><p>It seems there is still some places where we can still spot some remnant peices of attribute array and attribute map in the spec</p>
<p>You can find this sentence at two places</p>
<blockquote>
<p>, or constructed from the expressions in the array or map attributes.</p>
</blockquote>
<p>Also there is some examples</p>
<ul>
<li>Example: Grouping entries in a Map</li>
<li>Example: Processing an array using xsl:iterate</li>
</ul>
</div></details></div>
<div class="toot" id="created-417"><h2>Pull request #417 created<span class="toot-id"> #created-417</span></h2><div class="pubdate">03 Apr at 21:56:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/417">https://github.com/qt4cg/qtspecs/pull/417</a></div><details><summary>Fix residual reference to op:A2S which is no longer defined</summary><div class="markup"><p>The changes made to redefine array functions in terms of <code>array:members</code> and <code>array:of</code> rather than <code>op:A2S</code> and <code>op:S2A</code> weren't applied to array:get because that was the subject of a separate PR to add the <code>fallback</code> option. This PR corrects the omission.</p>
</div></details></div>
<div class="toot" id="closed-403"><h2>Issue #403 closed<span class="toot-id"> #closed-403</span></h2><div class="pubdate">03 Apr at 21:25:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/403">https://github.com/qt4cg/qtspecs/pull/403</a></div><p>Michaelhkay actions 2023 02 01</p></div>
<div class="toot" id="created-416"><h2>Pull request #416 created<span class="toot-id"> #created-416</span></h2><div class="pubdate">03 Apr at 17:48:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/416">https://github.com/qt4cg/qtspecs/pull/416</a></div><p>NCName is usually lowercase in attribute  type for the rest of the spec</p></div>
<div class="toot" id="created-415"><h2>Pull request #415 created<span class="toot-id"> #created-415</span></h2><div class="pubdate">03 Apr at 16:39:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/415">https://github.com/qt4cg/qtspecs/pull/415</a></div><details><summary>Revise parse/build URI functions for UNC names</summary><div class="markup"><p>Fix #398
Fix #390</p>
<p>This PR attempts to address the questions raised in issues 389 and 390:</p>
<ol>
<li>It adds a <code>unc-path</code> option that is used to guide the parsing and construction of URIs that represent Windows UNC paths</li>
<li>It adds a <code>filepath</code> property to the result of <code>parse-uri</code>. This property represents the local path part of the URI. For file: URIs, this is the local path.</li>
<li>It addresses the use of "<code>|</code>" in URIs to represent the ":" in Windows filenames</li>
<li>It clarifies that percent-decoding a path also involves intepreting the result as a UTF-8 sequence</li>
<li>It clarifies that percend-decoding and encoding apply to the query parts of a URI as well.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-300"><h2>Issue #300 closed<span class="toot-id"> #closed-300</span></h2><div class="pubdate">02 Apr at 12:58:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/300">https://github.com/qt4cg/qtspecs/issues/300</a></div><p>[F+O] Ambiguity regarding Unicode normalization (editorial)</p></div>
<div class="toot" id="agenda-04-04"><h2>QT4 CG meeting 029 draft agenda<span class="toot-id"> #agenda-04-04</span></h2><div class="pubdate">31 Mar at 16:35:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/04-04">https://qt4cg.org/meeting/agenda/2023/04-04</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-414"><h2>Issue #414 created<span class="toot-id"> #created-414</span></h2><div class="pubdate">31 Mar at 08:04:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/414">https://github.com/qt4cg/qtspecs/issues/414</a></div><details><summary>Lift character set restriction of xs:string</summary><div class="markup"><p>Adopted from https://github.com/qt4cg/qtspecs/issues/413#issuecomment-1491469514</p>
<blockquote>
<p>I guess that raises the question of whether it is still appropriate to restrict the character set of xs:string to that of XML 1.0. Are there any benefits in doing so?</p>
</blockquote>
<p>I believe that would simplify things a lot, in particular when working with input/output functions.</p>
</div></details></div>
<div class="toot" id="minutes-03-28"><h2>QT4 CG meeting 028 draft minutes<span class="toot-id"> #minutes-03-28</span></h2><div class="pubdate">30 Mar at 16:50:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/03-28">https://qt4cg.org/meeting/minutes/2023/03-28</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-404"><h2>Issue #404 closed<span class="toot-id"> #closed-404</span></h2><div class="pubdate">30 Mar at 15:52:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/404">https://github.com/qt4cg/qtspecs/pull/404</a></div><p>Rework changes from action-qt4cg-019-01 to resolve persistent conflicts.</p></div>
<div class="toot" id="closed-398"><h2>Issue #398 closed<span class="toot-id"> #closed-398</span></h2><div class="pubdate">30 Mar at 15:52:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/398">https://github.com/qt4cg/qtspecs/issues/398</a></div><p>User-defined functions clashing with constructor functions</p></div>
<div class="toot" id="closed-406"><h2>Issue #406 closed<span class="toot-id"> #closed-406</span></h2><div class="pubdate">30 Mar at 15:51:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/406">https://github.com/qt4cg/qtspecs/pull/406</a></div><p>Revise xsl:array instruction and examples</p></div>
<div class="toot" id="closed-408"><h2>Issue #408 closed<span class="toot-id"> #closed-408</span></h2><div class="pubdate">30 Mar at 15:51:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/408">https://github.com/qt4cg/qtspecs/pull/408</a></div><p>Fix issue #398 (clash with constructor functions)</p></div>
<div class="toot" id="created-413"><h2>Issue #413 created<span class="toot-id"> #created-413</span></h2><div class="pubdate">30 Mar at 14:08:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/413">https://github.com/qt4cg/qtspecs/issues/413</a></div><details><summary>New function: parse-csv()</summary><div class="markup"><p>I propose a new function parse-csv() that accepts a CSV string (such as might be read from a CSV file using unparsed-text()). CSV is as defined in RFC 4180; implementations may be liberal in what they accept, and may define additional options.</p>
<p>An options parameter includes the option header=true|false to indicate whether the first line should be taken as containing column headings.</p>
<p>The result of the function is a sequence of maps, one map per row of the CSV file (excluding the header). Each map contains one entry per column, the key being taken from the column header if present, or an integer 1...n if not.</p>
</div></details></div>
<div class="toot" id="created-412"><h2>Pull request #412 created<span class="toot-id"> #created-412</span></h2><div class="pubdate">28 Mar at 22:12:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/412">https://github.com/qt4cg/qtspecs/pull/412</a></div><details><summary>409, QT4CG-027-01: xsl:next-match</summary><div class="markup"><p>Clarifies the rules for xsl:next-match, especially for 4.0 type patterns, but also clarifying the exposition of rules unchanged since 3.0 or 2.0 (see issue 409)</p>
</div></details></div>
<div class="toot" id="created-411"><h2>Pull request #411 created<span class="toot-id"> #created-411</span></h2><div class="pubdate">28 Mar at 11:51:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/411">https://github.com/qt4cg/qtspecs/pull/411</a></div><details><summary>Remove the note from the parse-html unparsed-entity sections.</summary><div class="markup"><p>This applies the review action:</p>
<blockquote>
<p>RD to remove the note in 15.5.15 of functions and operators.</p>
</blockquote>
</div></details></div>
<div class="toot" id="agenda-03-28"><h2>QT4 CG meeting 028 draft agenda<span class="toot-id"> #agenda-03-28</span></h2><div class="pubdate">27 Mar at 13:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-28">https://qt4cg.org/meeting/agenda/2023/03-28</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-410"><h2>Issue #410 created<span class="toot-id"> #created-410</span></h2><div class="pubdate">27 Mar at 10:37:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/410">https://github.com/qt4cg/qtspecs/issues/410</a></div><details><summary>Converting doubles to decimals, fractional digits</summary><div class="markup"><p>Adopted from a previous discussion on Slack: The result of the following computation…</p>
<pre><code class="language-xquery">&lt;x&gt;2&lt;/x&gt; + .1
</code></pre>
<p>…is serialized as <code>2.1</code>. If the result is cast to a decimal via <code>xs:decimal(&lt;x&gt;2&lt;/x&gt; + .1)</code>, <code>2.100000000000000088817841970012523233890533447265625</code> is returned, which feels counterintuitive.</p>
<p>Can we possibly change the conversion rules without compromising backward-compatibility?</p>
</div></details></div>
<div class="toot" id="created-409"><h2>Issue #409 created<span class="toot-id"> #created-409</span></h2><div class="pubdate">26 Mar at 11:13:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/409">https://github.com/qt4cg/qtspecs/issues/409</a></div><details><summary>XSLT: xsl:next-match and xsl:apply-imports interaction with on-multiple-match</summary><div class="markup"><p>(This is an oversight in the XSLT 3.0 specification.)</p>
<p>It is possible for <code>xsl:next-match</code> or <code>xsl:apply-imports</code> to encounter a conflict - two template rules with the same precedence and priority. In this situation it should do exactly what <code>xsl:apply-templates</code> does when it encounters a conflict, for example it should follow the rules of <code>xsl:mode/@on-multiple-match</code>.</p>
<p>This is all fairly obvious, but it should be stated explicitly (and tested). The spec is written as if conflicts can only occur when finding the first matching rule, and not when finding next-match rules.</p>
</div></details></div>
<div class="toot" id="closed-392"><h2>Issue #392 closed<span class="toot-id"> #closed-392</span></h2><div class="pubdate">24 Mar at 11:00:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/392">https://github.com/qt4cg/qtspecs/issues/392</a></div><p>Partial function application: Placeholders with keywords</p></div>
<div class="toot" id="created-408"><h2>Pull request #408 created<span class="toot-id"> #created-408</span></h2><div class="pubdate">24 Mar at 10:29:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/408">https://github.com/qt4cg/qtspecs/pull/408</a></div><details><summary>Fix issue #398 (clash with constructor functions)</summary><div class="markup"><p>Add clarification to XSLT and XQuery specs to say that a used-defined function must not clash with a constructor function for an imported atomic type.</p>
</div></details></div>
<div class="toot" id="created-407"><h2>Issue #407 created<span class="toot-id"> #created-407</span></h2><div class="pubdate">23 Mar at 11:39:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/407">https://github.com/qt4cg/qtspecs/issues/407</a></div><details><summary>XSLT-specific context properties used in function items</summary><div class="markup"><p>I just stumbled across the fact that current-group#0 doesn't work: see the note in 14.2.1 that says:</p>
<blockquote>
<p>Like other XSLT extensions to the dynamic evaluation context, the [current group] is not retained as part of the closure of a function value. This means that the expression current-group#0 is valid and returns a function value, but any invocation of this function will fail with a dynamic error [see [ERR XTDE1061].</p>
</blockquote>
<p>This restriction is unnecessary and we should remove it. As people become more accustomed to using function items, they don't want to hit restrictions like this, and there's really no good implementation reason for it.</p>
</div></details></div>
<div class="toot" id="created-406"><h2>Pull request #406 created<span class="toot-id"> #created-406</span></h2><div class="pubdate">22 Mar at 18:03:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/406">https://github.com/qt4cg/qtspecs/pull/406</a></div><details><summary>Revise xsl:array instruction and examples</summary><div class="markup"><p>This PR revises the design of the xsl:array instruction to align it with the recently agreed specs for the functions <code>array:members</code> and <code>array:of</code>. The <code>composite</code> attribute and the <code>xsl:array-member</code> instruction are dropped; instead the instruction takes a <code>use</code> attribute which is an expression used to compute each array member value from the corresponding item in the value of the select expression or sequence constructor.</p>
</div></details></div>
<div class="toot" id="closed-360"><h2>Issue #360 closed<span class="toot-id"> #closed-360</span></h2><div class="pubdate">21 Mar at 18:12:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/360">https://github.com/qt4cg/qtspecs/pull/360</a></div><p>Issue 314 array composition and decomposition</p></div>
<div class="toot" id="closed-405"><h2>Issue #405 closed<span class="toot-id"> #closed-405</span></h2><div class="pubdate">21 Mar at 18:12:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/405">https://github.com/qt4cg/qtspecs/pull/405</a></div><p>MK PR #360 with merge conflicts resolved (array compositionand decomposition)</p></div>
<div class="toot" id="created-405"><h2>Pull request #405 created<span class="toot-id"> #created-405</span></h2><div class="pubdate">21 Mar at 18:01:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/405">https://github.com/qt4cg/qtspecs/pull/405</a></div><details><summary>MK PR #360 with merge conflicts resolved (array compositionand decomposition)</summary><div class="markup"><p>Close #360</p>
<p>This PR is the same as 360 but fixes merge conflicts.</p>
<p>Accepted at <a href="https://qt4cg.org/meeting/minutes/2023/03-21.html#pr-360">meeting 027</a></p>
<p>Close https://github.com/qt4cg/qtspecs/issues/314</p>
</div></details></div>
<div class="toot" id="closed-400"><h2>Issue #400 closed<span class="toot-id"> #closed-400</span></h2><div class="pubdate">21 Mar at 17:19:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/400">https://github.com/qt4cg/qtspecs/issues/400</a></div><p>Priorities for type-based patterns</p></div>
<div class="toot" id="closed-401"><h2>Issue #401 closed<span class="toot-id"> #closed-401</span></h2><div class="pubdate">21 Mar at 17:18:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/401">https://github.com/qt4cg/qtspecs/pull/401</a></div><p>Issue 400: ranking of type patterns</p></div>
<div class="toot" id="closed-395"><h2>Issue #395 closed<span class="toot-id"> #closed-395</span></h2><div class="pubdate">21 Mar at 17:17:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/395">https://github.com/qt4cg/qtspecs/pull/395</a></div><p>Make the (non-)hierarchical nature of URIs explicit</p></div>
<div class="toot" id="closed-394"><h2>Issue #394 closed<span class="toot-id"> #closed-394</span></h2><div class="pubdate">21 Mar at 17:17:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/394">https://github.com/qt4cg/qtspecs/pull/394</a></div><p>Minor correction to fn:parse-uri</p></div>
<div class="toot" id="closed-393"><h2>Issue #393 closed<span class="toot-id"> #closed-393</span></h2><div class="pubdate">21 Mar at 17:16:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/393">https://github.com/qt4cg/qtspecs/pull/393</a></div><p>Clarify explanations of functions/function items</p></div>
<div class="toot" id="closed-391"><h2>Issue #391 closed<span class="toot-id"> #closed-391</span></h2><div class="pubdate">21 Mar at 17:16:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/391">https://github.com/qt4cg/qtspecs/pull/391</a></div><p>addressed typographical errors; adjusted Unicode character discussion…</p></div>
<div class="toot" id="agenda-03-21"><h2>QT4 CG meeting 027 draft agenda<span class="toot-id"> #agenda-03-21</span></h2><div class="pubdate">21 Mar at 10:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-21">https://qt4cg.org/meeting/agenda/2023/03-21</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-336"><h2>Issue #336 closed<span class="toot-id"> #closed-336</span></h2><div class="pubdate">20 Mar at 16:00:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/336">https://github.com/qt4cg/qtspecs/pull/336</a></div><p>Action QT4CG-019-01 (type of $pattern in fn:tokenize())</p></div>
<div class="toot" id="created-404"><h2>Pull request #404 created<span class="toot-id"> #created-404</span></h2><div class="pubdate">20 Mar at 15:59:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/404">https://github.com/qt4cg/qtspecs/pull/404</a></div><details><summary>Rework changes from action-qt4cg-019-01 to resolve persistent conflicts.</summary><div class="markup"><p>I reworked these (purely editorial) changes based on the current master to try and resolve the conflicts once and for all.</p>
</div></details></div>
<div class="toot" id="created-403"><h2>Pull request #403 created<span class="toot-id"> #created-403</span></h2><div class="pubdate">20 Mar at 15:26:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/403">https://github.com/qt4cg/qtspecs/pull/403</a></div><p>Michaelhkay actions 2023 02 01</p></div>
<div class="toot" id="created-402"><h2>Issue #402 created<span class="toot-id"> #created-402</span></h2><div class="pubdate">20 Mar at 00:31:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/402">https://github.com/qt4cg/qtspecs/issues/402</a></div><details><summary>XSLT patterns: intersect and except</summary><div class="markup"><p>I would like to propose making an incompatible change to the semantics of XSLT patterns using the "except" and "intersect" operators, so that they have their intuitive meaning.</p>
<p>Consider the pattern <code>p except appendix//p</code>. Anyone writing this probably imagines that this will match any <code>p</code> element that does not have an <code>appendix</code> as an ancestor. The intuitive meaning of <code>A except B</code> is to match anything that matches<code>A</code> unless it also matches <code>B</code>.</p>
<p>The actual meaning in the XSLT 3.1 specification is that it matches any node <code>$N</code> that has an ancestor <code>$A</code> such that the result of the XPath expression <code>$A//(p except appendix//p)</code> includes <code>$N</code>.</p>
<p>Consider the XML</p>
<pre><code>&lt;appendix&gt;
  &lt;div&gt;
     &lt;p&gt;...&lt;/p&gt;
  &lt;/div&gt;
&lt;/appendix&gt;
</code></pre>
<p>The <code>&lt;p&gt;</code> element here has an ancestor (the <code>&lt;div&gt;</code> element) where the result of <code>$A//(p except appendix//p)</code> includes the <code>&lt;p&gt;</code> element. So despite having an ancestor <code>appendix</code> this element matches the pattern <code>p except appendix//p</code>. This is not only a counter-intuitive result, it also makes such patterns useless in practice.</p>
<p>Patterns using <code>intersect</code> suffer the same problem, though it is much harder to construct a plausible example.</p>
<p>Patterns that only use the child or attribute axis, for example <code>@* except @code</code>, or <code>* except note</code>, don't suffer from this problem and will retain the same meaning as in 3.1.</p>
<p>The required effect can be achieved by writing <code>p except p[ancestor::appendix]</code>. Because the pattern <code>p[ancestor::appendix]</code> is equivalent to <code>appendix//p</code>, people are very likely to imagine that <code>p except p[ancestor::appendix]</code> is equivalent to <code>p except appendix//p</code>.</p>
<p>Making any incompatible change to the language semantics should be done only with a very strong justification, but I believe that it is justified in this instance. The existing semantics are not only counter-intuitive, they are also sufficiently useless that it is extremely unlikely anyone has existing working code, other than artificial test cases, that relies on the current semantics.</p>
</div></details></div>
<div class="toot" id="closed-387"><h2>Issue #387 closed<span class="toot-id"> #closed-387</span></h2><div class="pubdate">19 Mar at 11:10:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/387">https://github.com/qt4cg/qtspecs/pull/387</a></div><p>Add compatibility notes for fn:namespace-uri-for-prefix</p></div>
<div class="toot" id="closed-385"><h2>Issue #385 closed<span class="toot-id"> #closed-385</span></h2><div class="pubdate">19 Mar at 11:09:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/385">https://github.com/qt4cg/qtspecs/pull/385</a></div><p>Actions QT4CG-025-07 / -08</p></div>
<div class="toot" id="closed-378"><h2>Issue #378 closed<span class="toot-id"> #closed-378</span></h2><div class="pubdate">19 Mar at 11:06:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/378">https://github.com/qt4cg/qtspecs/pull/378</a></div><p>Update the localName and unparsed entity reference notes for parse-html</p></div>
<div class="toot" id="created-401"><h2>Pull request #401 created<span class="toot-id"> #created-401</span></h2><div class="pubdate">15 Mar at 22:02:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/401">https://github.com/qt4cg/qtspecs/pull/401</a></div><details><summary>Issue 400: ranking of type patterns</summary><div class="markup"><p>Proposes how to handle type-based match patterns (record tests, in particular) in the absence of explicit priorities, basing the decision on the type hierarchy. Note: user-defined priorities are always considered before any inferred selectivity rules. Also fixes some grammar problems with type patterns. See Issue #400.</p>
</div></details></div>
<div class="toot" id="created-400"><h2>Issue #400 created<span class="toot-id"> #created-400</span></h2><div class="pubdate">15 Mar at 08:13:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/400">https://github.com/qt4cg/qtspecs/issues/400</a></div><details><summary>Priorities for type-based patterns</summary><div class="markup"><p>XSLT §6.6 currently has a big TODO:</p>
<p>TODO: define default priorities for type patterns, as suggested in https://www.saxonica.com/papers/xmlprague-2020mhk.pdf section 6.5.1</p>
<p>We need to plug this gap. [Note: it's worth reading that cited section as it points out some of the difficulties].</p>
<p>I'm going to suggest an alternative approach. Rather than allocating a numeric priority to patterns such as <code>record(lat, long)</code>, we allocate them a relative priority -- called their <code>selectivity</code> -- based on the subtype relationship among types. This is a partial ordering. So we extend the rule that currently orders patterns by (1) import precedence, (2) priority, (3) declaration order, to become instead (1) import precedence, (2) selectivity, (3) priority, (4) declaration order.</p>
<p>Type-based patterns (such as <code>type(xs:integer)</code>, <code>record(lat, long)</code>) are defined to have higher selectivity than any non-type-based pattern; all the latter (that is, all XSLT 3.1 patterns) are defined to have equal selectivity, which means the rules for discriminating among 3.1 patterns are unchanged.</p>
<p>For type-based patterns, we define that a pattern based on type T has higher selectivity than a pattern based on type U if T is a subtype of U. If neither is a subtype of the other, then they have equal selectivity.</p>
<p>The type pattern <code>type(T)</code> followed by one or more predicates is deemed to have higher selectivity than type(T) with no predicates, but apart from this, the predicates are ignored. Explicit numeric priorities can be used to define an ordering among type patterns that have the same selectivity.</p>
</div></details></div>
<div class="toot" id="created-399"><h2>Issue #399 created<span class="toot-id"> #created-399</span></h2><div class="pubdate">15 Mar at 03:31:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/399">https://github.com/qt4cg/qtspecs/issues/399</a></div><details><summary>fn:deep-equal: Using Multilevel Hierarchy and Abstraction when designing and specifying complex functions</summary><div class="markup"><p>Whenever a function is too-complex, its precise and clear specification becomes problematic and the complexity results in huge volume of text that is difficult to fathom, understand and the correctness of whose meaning becomes less and less obvious.</p>
<p>Solving this problem would benefit all groups of readers, be they future implementors or just curious XPath enthusiasts.</p>
<p>Here I present one well-known and successfully tried in practice solution, which the Romans summarized in the phrase: "<strong><em>Divide et Impera</em></strong>" ("Divide and conquer")</p>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Philip-ii-of-macedon.jpg/330px-Philip-ii-of-macedon.jpg">
<p>Below is one possible splitting of the functionality of <strong><a href="https://qt4cg.org/pr/395/xpath-functions-40/autodiff.html#func-deep-equal">fn:deep-equal</a></strong> into different smaller and simpler functions on 5 levels, each level possibly dispatching to a function on  another level. The intermediate-level functions each have their own value and could be used independently of <strong>fn:deep-equal</strong> and of each other. Even though there is the possibility of recursion, we can still get a simple picture and immediate understanding of this functionality, just playing with the following collapsible/expandable representation (click on the corresponding arrow), which fits on a single screen:</p>
<h2>(writing the full specification from this animated picture is left as an exercise for the reader 😂</h2>
<details>
    <summary>deep-equal-sequence</summary>
	  <blockquote>
          <details>
				 <summary>deep-equal-item</summary>
					  <blockquote>
	  					  <p>deep-equal-atomic</p>
						  <details>
								<summary>deep-equal-map</summary>
								  <blockquote>
										  <p>deep-equal-atomic</p>
										  <p>deep-equal-sequence</p>
								  </blockquote>
						  </details>
						  <details>
							  <summary>deep-equal-array</summary>
								  <blockquote>
										  <p>deep-equal-sequence</p>
								  </blockquote>
						  </details>
						  <details>
							  <summary>deep-equal-node</summary>
								  <blockquote>
										  <p>deep-equal-document</p>
										  <details>										  
											  <summary>deep-equal-element</summary>
												  <blockquote>
													  <p>deep-equal-attribute</p>
													  <p>deep-equal-NS</p>
													  <p>deep-equal-PI</p>
													  <p>deep-equal-comment</p>
													  <p>deep-equal-text-node</p>
												  </blockquote>
										  </details>										  
										  <p>deep-equal-attribute</p>
										  <p>deep-equal-NS</p>
										  <p>deep-equal-PI</p>
										  <p>deep-equal-comment</p>
										  <p>deep-equal-text-node</p>
								  </blockquote>
						  </details>
					  </blockquote>
		  </details>
	  </blockquote>
  </details>
</div></details></div>
<div class="toot" id="created-398"><h2>Issue #398 created<span class="toot-id"> #created-398</span></h2><div class="pubdate">14 Mar at 23:39:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/398">https://github.com/qt4cg/qtspecs/issues/398</a></div><details><summary>User-defined functions clashing with constructor functions</summary><div class="markup"><p>There is no explicit rule in either XQuery or XSLT that a user-defined function must not clash (in name and arity) with a constructor function for an imported atomic type. It's implicit in the rule that you can't have two conflicting functions in the static context, but it would be helpful to say so explicitly and define an error code.</p>
<p>I have added tests to the XSLT3 and XQuery3 test suites.</p>
<p>See also Saxon bug 5921 - https://saxonica.plan.io/issues/5921</p>
</div></details></div>
<div class="toot" id="created-397"><h2>Issue #397 created<span class="toot-id"> #created-397</span></h2><div class="pubdate">14 Mar at 21:46:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/397">https://github.com/qt4cg/qtspecs/issues/397</a></div><details><summary>Type names</summary><div class="markup"><p>The draft specifications propose the introduction of item type declarations that can associate a name with an item type. The feature probably still needs some work, which this issue aims to explore.</p>
<p>The main purpose of introducing named item types is that the ItemType for a record structure or a function signature can become quite complex and lengthy, and you don't want to have to repeat them every time they are used because it means you have to make the same change everywhere when a change occurs. Another motivation is to allow type definitions (for example, of records or functions) to be recursive.</p>
<p>I considered allowing named sequence types rather than just item types, but the rules for where you can and can't have an occurrence indicator get complicated, so I pulled back from that.</p>
<p>It seems natural to say:</p>
<ul>
<li>Item type names are QNames</li>
<li>In XPath, type names (and their mapping to item types) appear in the static context</li>
<li>In XQuery, type names follow the conventions for global variables and function declarations. That suggests they can appear either in the main module or a library module; in a library module they must be in the namespace of the module; they can be annotated as %public or %private; an <code>import module</code> declaration makes the name visible in the importing module.</li>
<li>In XSLT, a name declared in a module is automatically available throughout the stylesheet package, and can be exposed to other packages using the same visibility mechanisms as other stylesheet components. However, I don't think it makes sense to allow a type name to be overridden, either using import precedence or using xsl:override.</li>
</ul>
<p>The question then arises, should item type names be in the same "symbol space" as named atomic and union types? There seem to be several options here:</p>
<p>(a) Item type names are in a different symbol space from atomic types; the are no rules barring the same name being used for a named item type and an atomic type, and they are disambiguated by requiring item type names to be distinguished using some kind of marker syntax such as <code>type(name)</code>, rather than just a bare name.
(b) Item type names are in the same symbol space as atomic types, which means there must be a rule that an item type name must not be the same as an atomic type name that is visible in the same place. We could try and define this rule for individual names, or at the level of namespaces (if there are any atomic/union types in a particular namespace in the static context of any module, then there must be no declared type names in that namespace in that module, either declared in that module or imported from another module).
(c) Atomic type names "shadow" item type names, or vice versa: if the same name is used for both, then one of them takes precedence. Probably not a good idea.</p>
<p>I'm inclined to go for (b). Note that a simple rule that item type names can't be in a reserved namespace will prevent conflict for all non-schema-aware applications, since those applications only access atomic types in the <code>xs</code> namespace.</p>
<p>Now, what about circular definitions?</p>
<p>There are legitimate circular definitions, like <code>declare item type LIST = record(payload as item()*, next? as LIST)</code>, and there are "impossible" definitions, like <code>declare item type THING = THING</code>. Do we have to define the rules needed to ban "impossible" definitions, or can we just leave it that the determination of whether something is an instance of THING is non-terminating? I think we probably need to define the rules, which will require careful thought.</p>
<p>Where can item type names be used? The simple answer is: anywhere an ItemType is allowed. But what about contexts that only allow some ItemTypes and not others? For example, (a) "cast as", (b) as arguments of a LocalUnionType, (c) as the key type in a map type. (The solution in the current draft is that the syntax allows any ItemType to be used in these contexts, and there are semantic rules to constrain what kind of item types are allowed).</p>
<p>If we allow <code>$v cast as my:X</code> where <code>my:X</code> is a declared item type name, should we also allow the constructor function  <code>my:X($v)</code>? That would presumably also mean that item type names and function names cannot overlap.</p>
<p>Should we define any "built-in" item type names? We've been defining built-in functions (such as build-uri and parse-uri) whose signatures use record type definitions. Should we define built-in names for these record definitions?</p>
<p>An editorial issue: I think it's becoming increasingly difficult to get away with overloading the word <code>ItemType</code> to mean both the abstract concept of an item type, and the specific BNF construct used to define it. Same for <code>SequenceType</code>. I think we should probably move to having a defined term "item type" and a BNF construct such as <code>ItemTypeDesignator</code> to represent the two separate meanings.</p>
</div></details></div>
<div class="toot" id="minutes-03-14"><h2>QT4 CG meeting 026 draft minutes<span class="toot-id"> #minutes-03-14</span></h2><div class="pubdate">14 Mar at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/03-14">https://qt4cg.org/meeting/minutes/2023/03-14</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-396"><h2>Pull request #396 created<span class="toot-id"> #created-396</span></h2><div class="pubdate">13 Mar at 18:04:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/396">https://github.com/qt4cg/qtspecs/pull/396</a></div><details><summary>333: Deep-equal, no failure when comparing functions</summary><div class="markup"><p>Refines the spec of fn:deep-equal so it no longer fails when comparing function items, rather it returns a result which in general is implementation-dependent, though it must be false unless the functions are provably equivalent.</p>
</div></details></div>
<div class="toot" id="created-395"><h2>Pull request #395 created<span class="toot-id"> #created-395</span></h2><div class="pubdate">13 Mar at 11:50:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/395">https://github.com/qt4cg/qtspecs/pull/395</a></div><details><summary>Make the (non-)hierarchical nature of URIs explicit</summary><div class="markup"><p>The <code>fn:parse-uri</code> function will parse hierarchical or non-hierarchical URIs, however, the parse cannot be reversed if the <code>fn:build-uri</code> function doesn't know whether the scheme is hierarchical. Consider <code>fn:parse-uri("querty:abc")</code>:</p>
<pre><code>map {
  "path":"abc",
  "scheme":"querty",
  "path-segments":["abc"],
  "uri":"querty:abc"
}
</code></pre>
<p>When <code>fn:build-uri</code> parses that map, it produces: <code>querty://abc</code> because the scheme is not known to be non-hierarchical.</p>
<p>This PR changes <code>fn:parse-uri</code> so that it records whether or not the URI was hierarchical and <code>fn:build-uri</code> to use that information.</p>
<p>It's possible that we could finesse this by setting the <code>authority</code> to the empty string for hierarchical URIs, but it seems clearer to be explicit.</p>
<p>This PR also fixes a bug. Previously, if the <code>scheme</code> was not present when building a URI, the URI began with <code>//</code>. That's an error. If the scheme isn't present, there should be no <em>scheme separator</em>.</p>
</div></details></div>
<div class="toot" id="closed-320"><h2>Issue #320 closed<span class="toot-id"> #closed-320</span></h2><div class="pubdate">13 Mar at 11:07:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/320">https://github.com/qt4cg/qtspecs/pull/320</a></div><p>Issue 98 - add options parameter to fn:deep-equal</p></div>
<div class="toot" id="created-394"><h2>Pull request #394 created<span class="toot-id"> #created-394</span></h2><div class="pubdate">13 Mar at 10:08:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/394">https://github.com/qt4cg/qtspecs/pull/394</a></div><details><summary>Minor correction to fn:parse-uri</summary><div class="markup"><p>The <code>fn:parse-uri()</code> function recognizes "URIs" of the form <code>c:/path/to/thing</code> as implicitly being <code>file:</code> URIs. This small change adds a leading "/" to make the fact that it is a path explicit.</p>
</div></details></div>
<div class="toot" id="closed-25"><h2>Issue #25 closed<span class="toot-id"> #closed-25</span></h2><div class="pubdate">13 Mar at 09:54:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/25">https://github.com/qt4cg/qtspecs/issues/25</a></div><p>[XPath] `%variadic("sequence")` does not allow specifying some argument values in the variadic sequence, and in one case even not the variadic sequence itself</p></div>
<div class="toot" id="closed-26"><h2>Issue #26 closed<span class="toot-id"> #closed-26</span></h2><div class="pubdate">13 Mar at 09:52:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/26">https://github.com/qt4cg/qtspecs/issues/26</a></div><p>[XPath]A value in the last row (for "sequence-variadic" functions) of the table "Number of Arguments allowed in a Function Call" is incorrect</p></div>
<div class="toot" id="closed-54"><h2>Issue #54 closed<span class="toot-id"> #closed-54</span></h2><div class="pubdate">13 Mar at 09:51:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/54">https://github.com/qt4cg/qtspecs/issues/54</a></div><p>[XPath] [XQuery] Keyword arguments don't work with all parameters/keys in static functions.</p></div>
<div class="toot" id="closed-47"><h2>Issue #47 closed<span class="toot-id"> #closed-47</span></h2><div class="pubdate">13 Mar at 09:48:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/47">https://github.com/qt4cg/qtspecs/issues/47</a></div><p>[XPath] [XQuery] Allow argument placeholders on keyword arguments</p></div>
<div class="toot" id="agenda-03-14"><h2>QT4 CG meeting 026 draft agenda<span class="toot-id"> #agenda-03-14</span></h2><div class="pubdate">13 Mar at 08:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-14">https://qt4cg.org/meeting/agenda/2023/03-14</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-386"><h2>Issue #386 closed<span class="toot-id"> #closed-386</span></h2><div class="pubdate">13 Mar at 09:26:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/386">https://github.com/qt4cg/qtspecs/pull/386</a></div><p>Action QT4CG-025-05 (markup typo)</p></div>
<div class="toot" id="created-393"><h2>Pull request #393 created<span class="toot-id"> #created-393</span></h2><div class="pubdate">12 Mar at 22:07:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/393">https://github.com/qt4cg/qtspecs/pull/393</a></div><details><summary>Clarify explanations of functions/function items</summary><div class="markup"><p>This PR is purely editorial in the sense that it does not attempt to make any changes that would affect an implementation. It's intended to clear up ambiguity and lack of clarity in the description of operations on functions, in particular the way that a function item captures static and dynamic context. It addresses issues #239 and issue #392.</p>
</div></details></div>
<div class="toot" id="created-392"><h2>Issue #392 created<span class="toot-id"> #created-392</span></h2><div class="pubdate">12 Mar at 18:56:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/392">https://github.com/qt4cg/qtspecs/issues/392</a></div><details><summary>Partial function application: Placeholders with keywords</summary><div class="markup"><p>It's clear that the following is allowed:</p>
<p><code>format-date(current-date(), '[Y]-[M]-[D]', place:=?, language:=?, calendar:="AD")</code></p>
<p>The resulting function item takes two arguments (place and language) but in what order? Is it the order of parameters in the original function definition, or the order in which they appear in the partial function application?</p>
<p>I think it should be the latter, but this needs to be made explicit in the spec.</p>
<p>Note that this doesn't only apply to optional parameters as in the above example, it applies equally, for example to</p>
<p><code>starts-with(substring=?, value=?)</code></p>
<p>While we're on the subject, we should also ask whether</p>
<p><code>concat(value83 := ?)</code></p>
<p>is legal, and if so, what it means.</p>
</div></details></div>
<div class="toot" id="created-391"><h2>Pull request #391 created<span class="toot-id"> #created-391</span></h2><div class="pubdate">11 Mar at 05:25:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/391">https://github.com/qt4cg/qtspecs/pull/391</a></div><details><summary>addressed typographical errors; adjusted Unicode character discussion…</summary><div class="markup"><p>… for internal local consistency, clarity</p>
<p>This being my first PR, I opted to include beyond the typos I noted in #289 another small block of hopefully uncontroversial edits as a test balloon.</p>
</div></details></div>
<div class="toot" id="closed-278"><h2>Issue #278 closed<span class="toot-id"> #closed-278</span></h2><div class="pubdate">10 Mar at 18:04:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/278">https://github.com/qt4cg/qtspecs/issues/278</a></div><p>array bound checking</p></div>
<div class="toot" id="closed-289"><h2>Issue #289 closed<span class="toot-id"> #closed-289</span></h2><div class="pubdate">10 Mar at 18:03:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/289">https://github.com/qt4cg/qtspecs/pull/289</a></div><p>Proposal to add fallback behaviour to map:get and array:get</p></div>
<div class="toot" id="created-390"><h2>Issue #390 created<span class="toot-id"> #created-390</span></h2><div class="pubdate">10 Mar at 17:59:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/390">https://github.com/qt4cg/qtspecs/issues/390</a></div><details><summary>Should parsing and building URIs attempt to special case Windows URIs for UNC names?</summary><div class="markup"><p>Depending on the platform and language APIs involved, we see <code>file:</code> URIs encoded in a variety of different ways. It doesn't help that there's no official RFC for <code>file:</code> URIs.</p>
<ul>
<li><code>file:/path/part</code> is a <code>file:</code> URI with no host and a path of <code>/path/part</code>.</li>
<li><code>file:///path.part</code> is a <code>file:</code> URI with an explicitly empty host and a path of <code>/path/part</code>.</li>
<li><code>file://path/part</code> is a <code>file:</code> URI with an authority of <code>path</code> and a path of <code>/part</code>. I think one common way to interpret this is as if it was <code>file:/part</code>. That is, in <code>file:</code> URIs, although a different host is possible, it's often just ignored.</li>
<li><code>c:\path\part</code> is most usefully interpreted as <code>file:/c:/path/part</code>, a <code>file:</code> URI with no host and a path of <code>/c:/path/part</code>. These are only going to be useful on a Windows system, so it isn't a problem to treat them the same way on all platforms. (Aside: I don't actually know if the path part should be <code>c:/path/part</code> instead, but it's currently got the leading slash in <code>fn:parse-uri()</code>.)</li>
</ul>
<p>And then there's this: <code>file:////name/path/part</code>.</p>
<p>One interpretation is, "look, we accept <code>file:/</code> and <code>file:///</code> so let's just accept <code>file://</code> and <code>file://///////</code>, etc. as the same." And I think that's generally right, with the single special exception of <code>file:////</code>. The problem is that on Windows, this is a very common way to encode the URI for a UNC path, that is: <code>\\name\path\part</code> which is a Windows UNC path for <code>\path\part</code> on a host named <code>name</code> (via whatever networking protocol backs UNC).</p>
<p>You'd think that this should be <code>file://name/path/part</code>, but I think because browsers and maybe other tools just discard the authority part of a <code>file:</code> URI (or maybe because these are <em>paths</em> in some Windows sense?), that's not how they're encoded.</p>
<blockquote>
<p>Aside: Yes, I'm sure you also see <code>file:\\\\name\path\part</code> and <code>file:c:\path\part</code> and other forms as well. Those are out of scope, they're simply, flatly, completely wrong. You can't use <code>\</code> as a delimiter in a URI. RFC 3986 is authoritative on this point. Step one of dealing with random strings we think should be URIs is replacing all <code>\</code> with <code>/</code> because RFC 3986.</p>
</blockquote>
<p>It's problematic to deal with <code>file:////</code> as a special case, but it's also problematic to leave out support for a common pattern on a widely deployed operating system.</p>
<p>Recognizing four slashes after <code>file:</code> and treating that specially isn't hard. The hard part is how do we encode this in the map that <code>fn:parse-uri</code> produces bearing in mind that the result should round-trip if you push it back through <code>fn:build-uri</code>.</p>
<p>Consider <code>file:////uncname/path/part</code></p>
<p>Today, that is parsed as:</p>
<pre><code>map {
  "uri": "file:////uncname/path/part",
  "scheme": "file",
  "authority": "uncname",
  "host": "uncname",
  "path": "/path/to/file",
  "path-segments": array { "", "path", "to", "file" }
}
</code></pre>
<p>and that doesn’t round trip. If you feed that to <code>fn:build-uri</code>, you get <code>file://uncname/path/part</code> and that absolutely doesn’t mean the same thing on a Windows machine.</p>
<p>We could encode the slashes in the <code>authority</code> in which case we also have to encode them in the <code>host</code> because in the presence of <code>host</code>, the <code>authority</code> isn’t used to by <code>fn:build-uri()</code>:</p>
<pre><code>map {
  "uri": "file:////uncname/path/part",
  "scheme": "file",
  "authority": "////uncname",
  "host": "////uncname",
  "path": "/path/to/file",
  "path-segments": array { "", "path", "to", "file" }
}
</code></pre>
<p>It kind of works, but it’s really ugly and it means we have a host value that is a complete kludge. It doesn’t match the RFC rules for hostnames at all.</p>
<p>The other option that occurs to me is to add a “unc-path” property to the map:</p>
<pre><code>map {
  "unc-path": true(),
  "uri": "file:////uncname/path/part",
  "scheme": "file",
  "authority": "uncname",
  "host": "uncname",
  "path": "/path/to/file",
  "path-segments": array { "", "path", "to", "file" }
}
</code></pre>
<p>That works but it introduces all sorts of possibilities for incoherent data, such as an <code>https:</code> URI with a <code>unc-path</code> flag set to <code>true()</code>.</p>
<p>What’s the right answer?</p>
<ol>
<li>Ignore the UNC path special case, it’s the users problem to deal with them.</li>
<li>Recognize them, encode the details in the <code>authority</code> and <code>host</code>.</li>
<li>Recognize them, use a special property like <code>unc-path</code>.</li>
<li>Recognize them, and do this other much better idea I have: ________________</li>
</ol>
</div></details></div>
<div class="toot" id="created-389"><h2>Issue #389 created<span class="toot-id"> #created-389</span></h2><div class="pubdate">09 Mar at 09:31:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/389">https://github.com/qt4cg/qtspecs/issues/389</a></div><details><summary>The fn:build-uri function needs to perform URI encoding for path and query segments</summary><div class="markup"><p>The <code>fn:parse-uri</code> function describes decoding, but the <code>fn:build-uri</code> function fails to encode.</p>
</div></details></div>
<div class="toot" id="closed-388"><h2>Issue #388 closed<span class="toot-id"> #closed-388</span></h2><div class="pubdate">08 Mar at 16:35:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/388">https://github.com/qt4cg/qtspecs/pull/388</a></div><p>Update the example background color in serialization</p></div>
<div class="toot" id="created-388"><h2>Pull request #388 created<span class="toot-id"> #created-388</span></h2><div class="pubdate">08 Mar at 16:25:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/388">https://github.com/qt4cg/qtspecs/pull/388</a></div><details><summary>Update the example background color in serialization</summary><div class="markup"><p>This PR completes my action to fix the dark blue background in examples in the serialization spec. I've made them the same as the examples in the XSLT spec which seem to have been satisfactory.</p>
</div></details></div>
<div class="toot" id="closed-328"><h2>Issue #328 closed<span class="toot-id"> #closed-328</span></h2><div class="pubdate">07 Mar at 21:08:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/328">https://github.com/qt4cg/qtspecs/issues/328</a></div><p>Switch Cases: Lift single-item restriction on operands</p></div>
<div class="toot" id="closed-28"><h2>Issue #28 closed<span class="toot-id"> #closed-28</span></h2><div class="pubdate">07 Mar at 21:05:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/28">https://github.com/qt4cg/qtspecs/pull/28</a></div><p>[XPath] Support multiple clauses in ForExpr and LetExpr.</p></div>
<div class="toot" id="created-387"><h2>Pull request #387 created<span class="toot-id"> #created-387</span></h2><div class="pubdate">07 Mar at 21:03:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/387">https://github.com/qt4cg/qtspecs/pull/387</a></div><details><summary>Add compatibility notes for fn:namespace-uri-for-prefix</summary><div class="markup"><p>Action QT4CG-024-01</p>
</div></details></div>
<div class="toot" id="created-386"><h2>Pull request #386 created<span class="toot-id"> #created-386</span></h2><div class="pubdate">07 Mar at 20:32:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/386">https://github.com/qt4cg/qtspecs/pull/386</a></div><p>Action QT4CG-025-05 (markup typo)</p></div>
<div class="toot" id="created-385"><h2>Pull request #385 created<span class="toot-id"> #created-385</span></h2><div class="pubdate">07 Mar at 20:15:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/385">https://github.com/qt4cg/qtspecs/pull/385</a></div><details><summary>Actions QT4CG-025-07 / -08</summary><div class="markup"><p>Improves termdef markup; adds error code; updates change history appendix.</p>
</div></details></div>
<div class="toot" id="closed-344"><h2>Issue #344 closed<span class="toot-id"> #closed-344</span></h2><div class="pubdate">07 Mar at 17:22:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/344">https://github.com/qt4cg/qtspecs/pull/344</a></div><p>Issue 22: allow "for"/"let" keyword to be repeated in XPath</p></div>
<div class="toot" id="closed-307"><h2>Issue #307 closed<span class="toot-id"> #closed-307</span></h2><div class="pubdate">07 Mar at 17:20:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/307">https://github.com/qt4cg/qtspecs/issues/307</a></div><p>Parsing and building URIs comments and queries</p></div>
<div class="toot" id="closed-347"><h2>Issue #347 closed<span class="toot-id"> #closed-347</span></h2><div class="pubdate">07 Mar at 17:20:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/347">https://github.com/qt4cg/qtspecs/pull/347</a></div><p>Attempt to clarify fn:parse-uri and fn:build-uri</p></div>
<div class="toot" id="closed-355"><h2>Issue #355 closed<span class="toot-id"> #closed-355</span></h2><div class="pubdate">07 Mar at 17:19:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/355">https://github.com/qt4cg/qtspecs/pull/355</a></div><p>Action QT4CG-022-02 - add to imp-def-feature appendix</p></div>
<div class="toot" id="closed-370"><h2>Issue #370 closed<span class="toot-id"> #closed-370</span></h2><div class="pubdate">07 Mar at 17:19:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/370">https://github.com/qt4cg/qtspecs/issues/370</a></div><p>Bump XSLT version</p></div>
<div class="toot" id="closed-345"><h2>Issue #345 closed<span class="toot-id"> #closed-345</span></h2><div class="pubdate">07 Mar at 17:18:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/345">https://github.com/qt4cg/qtspecs/issues/345</a></div><p>Missing rule for matching atomic values against atomic types</p></div>
<div class="toot" id="closed-363"><h2>Issue #363 closed<span class="toot-id"> #closed-363</span></h2><div class="pubdate">07 Mar at 17:18:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/363">https://github.com/qt4cg/qtspecs/pull/363</a></div><p>Fix issue #345 - missing rules for type matching</p></div>
<div class="toot" id="closed-364"><h2>Issue #364 closed<span class="toot-id"> #closed-364</span></h2><div class="pubdate">07 Mar at 17:18:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/364">https://github.com/qt4cg/qtspecs/pull/364</a></div><p>Generalize switch expressions in XQuery (issue #328)</p></div>
<div class="toot" id="closed-371"><h2>Issue #371 closed<span class="toot-id"> #closed-371</span></h2><div class="pubdate">07 Mar at 17:17:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/371">https://github.com/qt4cg/qtspecs/pull/371</a></div><p>Issue 370: forwards and backwards compatibility for 4.0</p></div>
<div class="toot" id="minutes-03-07"><h2>QT4 CG meeting 025 draft minutes<span class="toot-id"> #minutes-03-07</span></h2><div class="pubdate">07 Mar at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/03-07">https://qt4cg.org/meeting/minutes/2023/03-07</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-147"><h2>Issue #147 closed<span class="toot-id"> #closed-147</span></h2><div class="pubdate">07 Mar at 17:13:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/147">https://github.com/qt4cg/qtspecs/issues/147</a></div><p>Terse syntax for map entries</p></div>
<div class="toot" id="closed-60"><h2>Issue #60 closed<span class="toot-id"> #closed-60</span></h2><div class="pubdate">07 Mar at 17:13:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/60">https://github.com/qt4cg/qtspecs/issues/60</a></div><p>[FO] fn:namespace-uri-for-prefix no longer supports passing a prefix by string</p></div>
<div class="toot" id="closed-45"><h2>Issue #45 closed<span class="toot-id"> #closed-45</span></h2><div class="pubdate">07 Mar at 17:13:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/45">https://github.com/qt4cg/qtspecs/issues/45</a></div><p>Second parameter of fn:sum must be neutral element for +</p></div>
<div class="toot" id="created-384"><h2>Issue #384 created<span class="toot-id"> #created-384</span></h2><div class="pubdate">06 Mar at 16:24:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/384">https://github.com/qt4cg/qtspecs/issues/384</a></div><details><summary>Definition of "effective value" in XSLT</summary><div class="markup"><p>The term "effective value" is defined in XSLT with a rather narrow definition in the context of attribute value templates. The term is used throughout the spec (sometimes hyperlinked, sometimes not) in a much more general sense, for example the "effective value" of an attribute is the explicit value given to the attribute, or the value after basic normalization such as whitespace stripping, or the default value if the attribute is not present.</p>
<p>This affects the determination of the correct result for test merge-021, where it is a little ambiguous whether two <code>xsl:merge-source/@order</code> attribute have the same "effective value" given that one is defaulted.</p>
</div></details></div>
<div class="toot" id="agenda-03-07"><h2>QT4 CG meeting 025 draft agenda<span class="toot-id"> #agenda-03-07</span></h2><div class="pubdate">05 Mar at 11:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-07">https://qt4cg.org/meeting/agenda/2023/03-07</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-383"><h2>Issue #383 created<span class="toot-id"> #created-383</span></h2><div class="pubdate">28 Feb at 17:21:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/383">https://github.com/qt4cg/qtspecs/issues/383</a></div><details><summary>fn:deep-equal: Order of child elements (unordered-elements)</summary><div class="markup"><p>At <a href="https://qt4cg.org/meeting/minutes/2023/02-28.html">meeting 024</a> where PR https://github.com/qt4cg/qtspecs/pull/320 was accepted, there remained an open question of how best to specify that in some circumstances the comparisons should be made without regard to the order of (some) children.</p>
<p>Can the name of the option be improved?</p>
<p>Should the option support wildcard names?</p>
</div></details></div>
<div class="toot" id="created-382"><h2>Issue #382 created<span class="toot-id"> #created-382</span></h2><div class="pubdate">28 Feb at 17:19:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/382">https://github.com/qt4cg/qtspecs/issues/382</a></div><details><summary>Improve whitespace handling in deep-equal</summary><div class="markup"><p>At <a href="https://qt4cg.org/meeting/minutes/2023/02-28.html">meeting 024</a> where PR https://github.com/qt4cg/qtspecs/pull/320 was accepted, there remained an open question of how to deal with whitespace.</p>
<p>The current options can be seen as having somewhat overlapping domains. Can this be improved?</p>
</div></details></div>
<div class="toot" id="created-381"><h2>Issue #381 created<span class="toot-id"> #created-381</span></h2><div class="pubdate">28 Feb at 17:18:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/381">https://github.com/qt4cg/qtspecs/issues/381</a></div><details><summary>Deep-equal comparisons without errors</summary><div class="markup"><p>At <a href="https://qt4cg.org/meeting/minutes/2023/02-28.html">meeting 024</a> where PR #320 was accepted, there remained an open question of how to deal with errors.</p>
<p>On the one hand, in order for <code>fn:deep-equal</code> to be most easily used as a comparison function in the many contexts where a comparison function is required, it would be best if it simply returned <code>false()</code> rather than raising an error when incomparably items are encountered.</p>
<p>On the other hand, making "return false()" the default will mean that it is possible to construct items that are not equal to themselves, which will certainly violate the expectations of some users.</p>
<p>This conflict needs to be resolved somehow.</p>
</div></details></div>
<div class="toot" id="minutes-02-28"><h2>QT4 CG meeting 024 draft minutes<span class="toot-id"> #minutes-02-28</span></h2><div class="pubdate">28 Feb at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-28">https://qt4cg.org/meeting/minutes/2023/02-28</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-377"><h2>Issue #377 closed<span class="toot-id"> #closed-377</span></h2><div class="pubdate">28 Feb at 14:49:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/377">https://github.com/qt4cg/qtspecs/issues/377</a></div><p>Published XQuery 4.0 spec renders XML predefined entities instead of literal characters</p></div>
<div class="toot" id="closed-380"><h2>Issue #380 closed<span class="toot-id"> #closed-380</span></h2><div class="pubdate">28 Feb at 14:49:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/380">https://github.com/qt4cg/qtspecs/pull/380</a></div><p>Removed CDATA sections around markup</p></div>
<div class="toot" id="created-380"><h2>Pull request #380 created<span class="toot-id"> #created-380</span></h2><div class="pubdate">28 Feb at 14:23:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/380">https://github.com/qt4cg/qtspecs/pull/380</a></div><details><summary>Removed CDATA sections around markup</summary><div class="markup"><p>Fix #377</p>
<p>I took a minimal approach here. I've removed CDATA sections where the section contained an <code>&amp;</code> but not a <code>&lt;</code>.</p>
<ol>
<li>If the section contains <code>&lt;</code>, then it's  (presumably) necessary to escape the markup</li>
<li>If the section <em>does not</em> contain an <code>&amp;</code>, then it's irrelevant. But not removing it limits the number of places changed by the script</li>
</ol>
</div></details></div>
<div class="toot" id="created-379"><h2>Issue #379 created<span class="toot-id"> #created-379</span></h2><div class="pubdate">28 Feb at 12:09:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/379">https://github.com/qt4cg/qtspecs/issues/379</a></div><details><summary>Namespace handling in parse-html</summary><div class="markup"><p>The HTML5/"Living Standard" specification has two modes when it comes to handling namespaces:</p>
<ol>
<li>For XHTML content the document is parsed as XML with full namespace support.</li>
<li>For HTML content, it has pseudo-namespace support.</li>
</ol>
<p>For example, the HTML parsing algorithm:</p>
<ol>
<li>places html, svg, and mathml elements in their corresponding namespaces.</li>
<li>allows certain element/attribute tag names (e.g. <code>xlink:href</code>) to be parsed as QNames.</li>
</ol>
<p>From the XSLT/XQuery perspective, this affects the data model. Specifically, how to model and specify the node-names and the set of namespaces associated with a given element node.</p>
</div></details></div>
<div class="toot" id="created-378"><h2>Pull request #378 created<span class="toot-id"> #created-378</span></h2><div class="pubdate">28 Feb at 08:55:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/378">https://github.com/qt4cg/qtspecs/pull/378</a></div><details><summary>Update the localName and unparsed entity reference notes for parse-html</summary><div class="markup"><p>This PR applies the following changes:</p>
<ul>
<li>[x] QT4CG-021-03: RD to change must to will in DOM notes about lowercase</li>
<li>[x] QT4CG-021-04: RD to revise and move the note about unrecognized entities</li>
</ul>
</div></details></div>
<div class="toot" id="created-377"><h2>Issue #377 created<span class="toot-id"> #created-377</span></h2><div class="pubdate">28 Feb at 07:22:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/377">https://github.com/qt4cg/qtspecs/issues/377</a></div><details><summary>Published XQuery 4.0 spec renders XML predefined entities instead of literal characters</summary><div class="markup"><p>When rendered in the browser, XML examples in the <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html">XQuery 4.0 specification</a> show, for example, '<code>&amp;lt;</code>' instead of '<code>&lt;</code>':</p>
<p><img src="https://user-images.githubusercontent.com/2734234/221782371-1d119a80-72b3-4ede-b9c9-0b2b464533c0.png" alt="Screenshot 2023-02-28 at 07 21 49"></p>
</div></details></div>
<div class="toot" id="created-376"><h2>Issue #376 created<span class="toot-id"> #created-376</span></h2><div class="pubdate">27 Feb at 17:16:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/376">https://github.com/qt4cg/qtspecs/issues/376</a></div><details><summary>add documentation prefix attribute to xsl:stylesheet</summary><div class="markup"><p>Although the addition of xsl:note is very welcome, i had been hoping for something like the xsl:stylesheet attribute extension-element-prefixes, e.g. ignored-element-prefixes.</p>
<p>The specification would be something like,
Elements and attributes associated with an ignored element prefix are not treated as direct constructors, and are removed when the stylesheet is compiled. For such an element, this is equivalent to having an xsl:use-when attribute with value false on the element; for attributes, they are simply discarded along with their value.</p>
<p>It is not an error for a prefix to be listed both as an ignored element prefix and as an extension element prefix; the result is implementation dependent in this case, but MUST not result in neither an extension being invoked nor the element or attribute being ignored.</p>
<p>Ignored elements may appear anywhere in the input tree, and ignored attributes may appear on any element.</p>
<p>Example:</p>
<pre><code>&lt;xsl:template match="city/park" css:module="main"&gt;
  &lt;css:rule&gt;
    color: green;
    trees: tall;
  &lt;/xsl:rule&gt;
  &lt;div class="park"&gt;
    &lt;xsl:apply-templates /&gt;
  &lt;/div&gt;
&lt;/xsl:template&gt;
</code></pre>
</div></details></div>
<div class="toot" id="created-375"><h2>Pull request #375 created<span class="toot-id"> #created-375</span></h2><div class="pubdate">27 Feb at 17:03:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/375">https://github.com/qt4cg/qtspecs/pull/375</a></div><details><summary>256: Context for default parameter values</summary><div class="markup"><p>This is an attempt to resolve issue #256 by providing details of the static and dynamic context for evaluating default parameter values, including providing a mechanism for accessing parts of the static and dynamic context of the caller.</p>
<p>If this PR is accepted we will need to follow up with (a) similar changes to XSLT, and (b) use of the new notation in the signatures of standard functions and operators that have context-dependent default values for parameters.</p>
<p>Note that the PR also breaks up the rather unwieldy sections for Function Declarations and Variable Declarations into more manageable subsections, which has involved some re-ordering; some of the change marking may therefore be spurious.</p>
</div></details></div>
<div class="toot" id="created-374"><h2>Issue #374 created<span class="toot-id"> #created-374</span></h2><div class="pubdate">27 Feb at 10:11:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/374">https://github.com/qt4cg/qtspecs/issues/374</a></div><details><summary>Can't view the XSD for XSLT in the browser</summary><div class="markup"><p>If you attempt to open <code>https://qt4cg.org/specifications/xslt-40/schema-for-xslt40.xsd</code> in the browser (in Firefox), you'll get:</p>
<pre><code>Error loading stylesheet: An unknown error has occurred (805303f4)
http://www.w3.org/2008/09/xsd.xsl
</code></pre>
<p>In a Chrome-derived browser I get a blank screen on which even the context menu doesn't work. Digging about in the inspect window leads me to</p>
<pre><code>Unsafe attempt to load URL http://www.w3.org/2008/09/xsd.xsl from frame with URL
https://qt4cg.org/specifications/xslt-40/schema-for-xslt40.xsd. Domains, protocols and ports must match.
</code></pre>
<p>I conclude that the problem is trying to load the XSL for XSD from a different domain. Boo. I guess we should copy those stylesheets to <code>qt4cg.org</code>, or remove the stylesheet PI, or ignore the whole thing on the assumption that we'll eventually publish these specifications in some W3C location and the probem will go away. Maybe.</p>
</div></details></div>
<div class="toot" id="created-373"><h2>Issue #373 created<span class="toot-id"> #created-373</span></h2><div class="pubdate">27 Feb at 09:29:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/373">https://github.com/qt4cg/qtspecs/issues/373</a></div><details><summary>apparent copy/paste error in annotation documentation of simple type yes-or-no-or-maybe</summary><div class="markup"><p>The XSD 1.1 schema for XSLT 3 and the one for XSLT 4 (at https://qt4cg.org/specifications/xslt-40/schema-for-xslt40.xsd) has an error in the annotation/documentation section of the simple type <code>yes-or-no-or-maybe</code> as it there says <code>One of the values "yes" or "no" or "omit".</code>. I think that should be <code>One of the values "yes" or "no" or "maybe"</code>, the error probably exists as someone copied the text from the <code>yes-or-no-or-omit</code> type declaration and forgot to adapt the description.</p>
</div></details></div>
<div class="toot" id="created-372"><h2>Issue #372 created<span class="toot-id"> #created-372</span></h2><div class="pubdate">26 Feb at 23:06:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/372">https://github.com/qt4cg/qtspecs/issues/372</a></div><details><summary>Separate default namespace for elements from the default namespace for types</summary><div class="markup"><p>Currently the static context provides a "default namespace for elements and types". It's not at all clear why these should be the same. For types, the vast majority of QNames representing types are in the XML Schema namespace, which is never used for elements.</p>
<p>In the current 4.0 drafts the two default namespaces are separated; but this has not been reviewed or agreed by the CG. This issue is raised for discussion of the change, and I will also review the design to see whether it still make sense.</p>
<p>Some observations on the current text for XQuery:</p>
<ol>
<li>In section 2.2.1 (static context) it would be good to give a bit more detail (if only as a forwards reference) about the circumstances in which the default element namespace and the default type namespace are used.</li>
<li>In 3.4 Sequence Types the sentence "[Lexical QNames]appearing in a [sequence type] have their prefixes expanded to namespace URIs by means of the [statically known namespaces] and (where applicable) the [default element namespace] or [default type namespace]" is rather inelegantly worded. If there is a prefix, then the statically known namespaces are used; if there is none, then the relevant default namespace is used, and it would be nice to explain more clearly which one applies.</li>
<li>In 3.6 Item Types, we need to be clearer about references to named/declared item types, and about how the names are resolved. Do we really want these names to be in the same symbol space as atomic types? Perhaps we should have a rule that Item Types (like functions) must be in a namespace and this must not be the same as an imported schema namespace.</li>
<li>In 5.14, Default namespace declaration, there seems to be duplication between the two paragraphs starting "for backwards compatibility reasons"</li>
<li>Appendix C.1 (much though I dislike it) should say something about the initialisation of the default namespaces for elements and for types.</li>
</ol>
<p>Note that issue #65 talks of the need for different default namespaces for input and output elements. I think that's a separate issue.</p>
<p>Observations on the current text for XSLT:</p>
<ol>
<li>In 5.1.2.1 the paragraph "The [xsl:]xpath-default-namespace attribute must be in the [XSLT namespace] if and only if its parent element is not in the XSLT namespace needs to be generalised to [xsl:]default-element-namespace. In fact, this rule should move to the parent section 5.1.2, which needs an introduction.</li>
</ol>
</div></details></div>
<div class="toot" id="created-371"><h2>Pull request #371 created<span class="toot-id"> #created-371</span></h2><div class="pubdate">24 Feb at 16:59:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/371">https://github.com/qt4cg/qtspecs/pull/371</a></div><details><summary>Issue 370: forwards and backwards compatibility for 4.0</summary><div class="markup"><p>This is essentially editorial; it updates the XSLT rules for forwards and backwards compatible processing to acknowledge the fact that the current version is now 4.0.</p>
</div></details></div>
<div class="toot" id="created-370"><h2>Issue #370 created<span class="toot-id"> #created-370</span></h2><div class="pubdate">24 Feb at 16:18:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/370">https://github.com/qt4cg/qtspecs/issues/370</a></div><details><summary>Bump XSLT version</summary><div class="markup"><p>There are various places where the XSLT spec refers to XSLT 3.0 where it should now refer to 4.0.</p>
</div></details></div>
<div class="toot" id="agenda-02-28"><h2>QT4 CG meeting 024 draft agenda<span class="toot-id"> #agenda-02-28</span></h2><div class="pubdate">24 Feb at 08:25:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/02-28">https://qt4cg.org/meeting/agenda/2023/02-28</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-19"><h2>Issue #19 closed<span class="toot-id"> #closed-19</span></h2><div class="pubdate">22 Feb at 21:34:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/19">https://github.com/qt4cg/qtspecs/issues/19</a></div><p>[xslt] annotation-prefixes</p></div>
<div class="toot" id="closed-84"><h2>Issue #84 closed<span class="toot-id"> #closed-84</span></h2><div class="pubdate">22 Feb at 21:32:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/84">https://github.com/qt4cg/qtspecs/issues/84</a></div><p>Proposal : allow ignorable &lt;xsl:div&gt; wrapper for documentation or organize the code</p></div>
<div class="toot" id="closed-189"><h2>Issue #189 closed<span class="toot-id"> #closed-189</span></h2><div class="pubdate">22 Feb at 21:29:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/189">https://github.com/qt4cg/qtspecs/issues/189</a></div><p>Adopt the coercion rules for variables in XQuery</p></div>
<div class="toot" id="closed-352"><h2>Issue #352 closed<span class="toot-id"> #closed-352</span></h2><div class="pubdate">22 Feb at 21:24:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/352">https://github.com/qt4cg/qtspecs/issues/352</a></div><p>The @array attribute of xsl:for-each-group is no more</p></div>
<div class="toot" id="closed-354"><h2>Issue #354 closed<span class="toot-id"> #closed-354</span></h2><div class="pubdate">22 Feb at 10:08:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/354">https://github.com/qt4cg/qtspecs/pull/354</a></div><p>Combine multiple signatures of XSLT functions to use defaults</p></div>
<div class="toot" id="closed-353"><h2>Issue #353 closed<span class="toot-id"> #closed-353</span></h2><div class="pubdate">22 Feb at 10:07:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/353">https://github.com/qt4cg/qtspecs/pull/353</a></div><p>Issue109 xsl note</p></div>
<div class="toot" id="closed-362"><h2>Issue #362 closed<span class="toot-id"> #closed-362</span></h2><div class="pubdate">22 Feb at 10:06:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/362">https://github.com/qt4cg/qtspecs/pull/362</a></div><p>Drop obsolete note in XSLT regarding for-each-group/@array</p></div>
<div class="toot" id="minutes-02-21"><h2>QT4 CG meeting 023 draft minutes<span class="toot-id"> #minutes-02-21</span></h2><div class="pubdate">22 Feb at 09:53:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-21">https://qt4cg.org/meeting/minutes/2023/02-21</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-369"><h2>Issue #369 created<span class="toot-id"> #created-369</span></h2><div class="pubdate">21 Feb at 17:44:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/369">https://github.com/qt4cg/qtspecs/issues/369</a></div><details><summary>Namespaces for Functions</summary><div class="markup"><p>What problem are we trying to solve? Essentially, I think "namespace clutter".</p>
<p>Namespace clutter manifests itself in several different ways.</p>
<ul>
<li>Firstly, declaration clutter in source code. Here's the start of a module in an XSLT Stylesheet of medium complexity:</li>
</ul>
<pre><code>&lt;xsl:stylesheet 
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    xmlns:xs="http://www.w3.org/2001/XMLSchema" 
    exclude-result-prefixes="#all"
    version="3.0" 
    xmlns="http://ns.saxonica.com/xslt/export" 
    xmlns:doc="http://www.saxonica.com/ns/documentation"
    xmlns:map="http://www.w3.org/2005/xpath-functions/map" 
    xmlns:ex="http://ns.saxonica.com/xslt/export" 
    xmlns:f="MyFunctions" 
    xmlns:t="MyTypes"
    expand-text="true"&gt;
</code></pre>
<p>Eight namespace declarations here, of which 3 are concerned with functions; and  Wit can get a lot worse than that.</p>
<ul>
<li>Secondly, namespace clutter in the static and dynamic context. The namespace bindings shown above don't disappear when the code is compiled; even with exclude-result-prefixes="yes", they have to hang around at run-time just in case someone tries to resolve a QName dynamically. Preserving the namespace context in the expression tree through optimization rewrites is a significant cost that has no user benefit; very rarely are they actually going to use the namespace context at run time.</li>
<li>Thirdly, prefix clutter in the executable code. Writing <code>math:cos(math:cos($x))</code> is just so clumsy compared with <code>cos(cos($x))</code>.</li>
</ul>
<p>I think there are a number of things we can do to reduce this.</p>
<p>First, separate out the namespace context for static resolution of function names as a separate part of the static context, used only for this purpose. Ensure that there is no functionality that depends on knowing this part of the static context at run time, so it can be discarded by the compiler as soon as function names are resolved. Then provide source syntax for binding function prefixes to function namespaces in XSLT and XQuery to populate this part of the static context; there is no reason this has to be done using XML namespace declarations. There is also no reason for having different bindings in force in different parts of a single module. And once we've separated these declarations from XML namespace declarations, there's no reason why we can't provide default bindings. We could also allow bindings to have cross-module scope to reduce duplicated code. Note: the xsl:function-library proposal in the current XSLT 4.0 draft tries to achieve some of these things.</p>
<p>Second, allow functions to be referenced by local name alone where the reference is unambiguous; and perhaps provide some aliasing mechanisms to make more existing names unambiguous.</p>
<p>We've explored a third idea, which is to introduce some kind of polymorphism where function names have local scope and are distinguished by the types of objects to which they are applied. I think that given our type system, this is very hard to achieve and I haven't seen any very satisfactory proposals. We also need to remember that there are considerable costs if we start resolving function names dynamically at run time. I wouldn't rule out making progress in this direction, but I'm not optimistic of coming up with a workable solution. There might be some simple things we could do, like having a single function <code>size()</code> that performs the work of both <code>map:size()</code> and <code>array:size()</code> depending on the argument.</p>
</div></details></div>
<div class="toot" id="closed-318"><h2>Issue #318 closed<span class="toot-id"> #closed-318</span></h2><div class="pubdate">21 Feb at 17:02:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/318">https://github.com/qt4cg/qtspecs/issues/318</a></div><p>Serialization HTML/XHTML output methods: meta elements and the charset attribute</p></div>
<div class="toot" id="created-368"><h2>Pull request #368 created<span class="toot-id"> #created-368</span></h2><div class="pubdate">21 Feb at 10:34:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/368">https://github.com/qt4cg/qtspecs/pull/368</a></div><details><summary>129: Context item generalized to context value</summary><div class="markup"><p>This is a first cut proposal to generalize the context item to a context value, allowing (for example) array predicates.</p>
<p>The proposal covers XPath and XQuery only at this stage; it doesn't address the consequences for XSLT.</p>
<p>Careful review requested!</p>
<p>Addresses issue #129 and issue #367.</p>
</div></details></div>
<div class="toot" id="created-367"><h2>Issue #367 created<span class="toot-id"> #created-367</span></h2><div class="pubdate">21 Feb at 00:06:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/367">https://github.com/qt4cg/qtspecs/issues/367</a></div><details><summary>Focus for RHS of thin arrow expressions</summary><div class="markup"><p>We define <code>A -&gt; F(B, C)</code> as being equivalent to <code>A ! F(., B, C)</code> which means that B and C are evaluated with a focus based on the current item in A, not with the outer focus. This is different from the <code>=&gt;</code> operator. For example if the $E is an element E, with several children called F, then</p>
<p><code>namespace-uri(.) -&gt; fn:QName(name())</code></p>
<p>has a different effect from</p>
<p><code>namespace-uri(.) =&gt; fn:QName(name())</code></p>
<p>whereas it might reasonably be expected that in the case where the LHS produces a single value, the two operators are equivalent. We can't change the meaning of <code>=&gt;</code> because it's defined in 3.1. So should we change the meaning of <code>-&gt;</code> to fall into line?</p>
<p>We could do this easily enough by defining <code>A -&gt; F(B, C)</code> as equivalent to <code>for $a in A return F($a, B, C)</code>.  I think that as well as being more consistent with <code>=&gt;</code>, the result is probably more intuitive. (We could also define it as equivalent to <code>let $f := F(?, B, C) return A ! $f(.)</code>)</p>
<p>For the expression <code>A -&gt; {B}</code>, and for the proposed <code>A =&gt; {B}</code>, I don't think we have any choice other than evaluating B with an inner focus based on A. But at least we can do it consistently for both operators.</p>
</div></details></div>
<div class="toot" id="created-366"><h2>Issue #366 created<span class="toot-id"> #created-366</span></h2><div class="pubdate">20 Feb at 18:43:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/366">https://github.com/qt4cg/qtspecs/issues/366</a></div><details><summary>Support xsl:use-package with xsl:package-location</summary><div class="markup"><p>Unless I am misreading the specs (which I do commonly enough), there is currently no way for an XSLT writer using <code>xsl:use-package</code> to indicate where the package is to be found, except outside the XSLT environment. I propose to allow <code>xsl:use-package</code> to contain zero or more <code>xsl:package-location</code> children. I propose the addition of an element and not an attribute, because a package may be in multiple locations, and need nuance, as noted below.</p>
<p>Attributes:</p>
<ul>
<li><code>@href</code>, on the model of <code>xsl:import</code> and <code>xsl:include</code>, would specify by relative or absolute URI where the package is.</li>
<li><code>@priority</code> (default 0) would provide a mechanism to indicate whether the specified <code>xsl:package-location</code> should override (value greater than 0), or simply provide a fallback for (less than or equal to 0), the preconfigured place the package should be retrieved from.</li>
<li><code>@use-when</code> would allow a developer to manage different versions of a package for different cases.</li>
</ul>
<p>Other attributes given to <code>xsl:package-location</code> would need discussion.</p>
</div></details></div>
<div class="toot" id="created-365"><h2>Issue #365 created<span class="toot-id"> #created-365</span></h2><div class="pubdate">20 Feb at 16:41:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/365">https://github.com/qt4cg/qtspecs/issues/365</a></div><details><summary>switch, typeswitch: Optional braces</summary><div class="markup"><p>The indentation of switch expressions is often a mess. Now that we allow curly braces for <code>if</code>, it would be nice to also allow optional braces for <code>switch</code> and <code>typeswitch</code>:</p>
<pre><code class="language-xquery">typeswitch($item) {
  case xs:numeric return 'number'
  default return '...'
},
switch($item) {
  case 0 to 9 return 'single digit'
  default return '...'
}
</code></pre>
<p>The current syntax is:</p>
<pre><code class="language-xquery">typeswitch($item)
  case xs:numeric return 'number'
  default return '...',

switch($item)
  case 0 to 9 return 'single digit'
  default return '...'
</code></pre>
</div></details></div>
<div class="toot" id="created-364"><h2>Pull request #364 created<span class="toot-id"> #created-364</span></h2><div class="pubdate">20 Feb at 15:43:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/364">https://github.com/qt4cg/qtspecs/pull/364</a></div><p>Generalize switch expressions in XQuery (issue #328)</p></div>
<div class="toot" id="closed-337"><h2>Issue #337 closed<span class="toot-id"> #closed-337</span></h2><div class="pubdate">20 Feb at 14:38:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/337">https://github.com/qt4cg/qtspecs/issues/337</a></div><p>Local union and enum types: and the definition of generalised atomic types</p></div>
<div class="toot" id="created-363"><h2>Pull request #363 created<span class="toot-id"> #created-363</span></h2><div class="pubdate">20 Feb at 13:07:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/363">https://github.com/qt4cg/qtspecs/pull/363</a></div><p>Fix issue #345 - missing rules for type matching</p></div>
<div class="toot" id="created-362"><h2>Pull request #362 created<span class="toot-id"> #created-362</span></h2><div class="pubdate">20 Feb at 12:12:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/362">https://github.com/qt4cg/qtspecs/pull/362</a></div><details><summary>Drop obsolete note in XSLT regarding for-each-group/@array</summary><div class="markup"><p>Fixes issue #352</p>
</div></details></div>
<div class="toot" id="created-361"><h2>Issue #361 created<span class="toot-id"> #created-361</span></h2><div class="pubdate">20 Feb at 11:38:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/361">https://github.com/qt4cg/qtspecs/issues/361</a></div><details><summary>Named arguments: $input vs. $value</summary><div class="markup"><p>Great effort has been made in unifying the parameter names of the XQFO standard; thanks for that!</p>
<p>I believe to remember that:</p>
<ul>
<li><code>$value</code>, <code>$values</code>, <code>$value1</code>, etc. is used for atomic/atomized arguments, whereas</li>
<li><code>$input</code>, <code>$input1</code>, etc. is used for input, mostly of type <code>item()</code>, that is processed unchanged.</li>
<li><code>$uri</code> is used for arguments that could have been defined as items of type <code>xs:anyURI</code>.</li>
</ul>
<p>I believe the following argument names need to be double-checked (if not, It may be that I haven’t fully grasped how the naming rules are supposed to work):</p>
<p>Function | Currently | Presumably | Justification
--- | --- | --- | ---
<code>array:slice</code> | <code>$input</code> | <code>$array</code> | Alignment with <code>array:size</code> et al.
<code>trace</code> | <code>$value</code> | <code>$input</code> | Argument is not atomized
<code>json</code> | <code>$input</code> | <code>$value</code> | Argument is atomized
<code>string</code> | <code>$item</code> | <code>$value</code>  | <code>$item</code> is used nowhere else
<code>expanded-QName</code> | <code>$qname</code> | <code>$value</code> | Alignment with <code>prefix-from-QName</code> et al.
<code>resolve-QName</code> | <code>$qname</code> | <code>$value</code> | Alignment with <code>prefix-from-QName</code> et al.
<code>parse-QName</code> | <code>$eqname</code> | <code>$value</code> | Alignment with <code>parse-xml</code> et al.
<code>parse-json</code> | <code>$json</code> | <code>$value</code> | Alignment with <code>parse-xml</code> et al.
<code>json-to-xml</code> | <code>$json</code> | <code>$value</code> | Alignment with <code>parse-xml</code> et al.
<code>char</code> | <code>$name</code> | <code>$value</code> | Input may also be codepoint values, etc.
<code>namespace-uri-for-prefix</code> | <code>$prefix</code> | <code>$value</code> | <code>$prefix</code> is used nowhere else
<code>resolve-uri</code> | <code>$relative</code> | <code>$uri</code> | Absolute URIs are legal as well
<code>array:append</code> | <code>$add</code> | <code>$member</code> | Alignment with <code>array:put</code></p>
<p>And we should probably pay particular attention to the naming conventions when adding new functions.</p>
</div></details></div>
<div class="toot" id="created-360"><h2>Pull request #360 created<span class="toot-id"> #created-360</span></h2><div class="pubdate">20 Feb at 11:24:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/360">https://github.com/qt4cg/qtspecs/pull/360</a></div><details><summary>Issue 314 array composition and decomposition</summary><div class="markup"><p>This PR addresses parts of issue 29, issue 113, and issue 314 relating to the composition and decomposition of arrays.</p>
<p>It introduces two functions <code>array:of</code> for array composition, and <code>array:members</code> for decomposition, and defines all other array functions in terms of these two primitives (replacing the internal functions <code>op:A2S</code> and <code>op:S2A</code>). The items in the decomposed form of an array are called "value records", singleton maps of the form <code>map{'value': $value}</code></p>
<p>The function <code>array:from-sequence</code> is renamed <code>array:build</code> to reflect its symmetry with <code>map:build</code>.</p>
<p>Question for the group: should we have a new function for constructing a "value record", or is the syntax <code>map{'value': $value}</code> adequate for the purpose?</p>
</div></details></div>
<div class="toot" id="created-359"><h2>Issue #359 created<span class="toot-id"> #created-359</span></h2><div class="pubdate">20 Feb at 09:53:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/359">https://github.com/qt4cg/qtspecs/issues/359</a></div><details><summary>fn:void: Absorb result of evaluated argument</summary><div class="markup"><h3>Summary</h3>
<p>Absorb the result of the evaluated argument.</p>
<h3>Signature</h3>
<pre><code class="language-xquery">fn:void(
  $input as item()*
) as empty-sequence()
</code></pre>
<h3>Motivation</h3>
<p>Developers tend to get creative if they want to suppress the result of an expression. The reason is that there is no simply solution to do this properly. Some constructs I have seen in practice:</p>
<pre><code class="language-xquery">let $unused := EXPRESSION
return 'ok'

EXPRESSION[position() = 10000], 'ok'

let $result := 'ok'
return if(exists(EXPRESSION)) then $result else $result
</code></pre>
<p>Cases like this are frequent in nondeterministic code. Think e.g. of side-effecting functions of the EXPath HTTP-Client and File Modules: The function results are not always relevant for the invoking application, or already known.</p>
<p>The function is also helpful during development and for testing code. <code>fn:void#1</code> and <code>fn:identity#1</code> can both be passed on to functions to either return or ignore the result of their arguments. The function can potentially be used to measure the runtime performance of an expression (but an implementation should not be prevented from discarding the function call if the argument expression is deterministic).</p>
</div></details></div>
<div class="toot" id="created-358"><h2>Issue #358 created<span class="toot-id"> #created-358</span></h2><div class="pubdate">19 Feb at 23:55:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/358">https://github.com/qt4cg/qtspecs/issues/358</a></div><details><summary>serialization indent whitespace</summary><div class="markup"><p>There could be an option to control whether the serialization indents with space or tabs, and how many of them (e.g.  2 or 4 spaces )</p>
<p>Related: https://github.com/qt4cg/qtspecs/issues/101</p>
<p>A user request: https://github.com/benibela/xidel/issues/100</p>
</div></details></div>
<div class="toot" id="created-357"><h2>Issue #357 created<span class="toot-id"> #created-357</span></h2><div class="pubdate">18 Feb at 16:07:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/357">https://github.com/qt4cg/qtspecs/issues/357</a></div><details><summary>Representing key-value pairs</summary><div class="markup"><p>A map can be decomposed into, or composed from, a sequence of key-value pairs (KVPs).</p>
<p>There are two natural representations of a key-value pair (K, V): it can be represented as a singleton map (<code>map{ K: V }</code>) or as a "doubleton" map (<code>map{ 'key': K, 'value': V}</code>).</p>
<p>This issue examines how well either of these representations is currently supported, which of them is preferable, and how this support should be improved.</p>
<p>I'll consider the following basic operations: constructing a KVP from a key and a value, assembling a map from a set of KVPs, decomposing a map into a sequence of KVPs, extracting the key from a KVP, and extracting the value from a KVP.</p>
<p><strong>Singleton Representation</strong></p>
<p>Constructing a KVP from a key and a value:</p>
<pre><code>map{ $key : $value }
map:entry($key, $value)
&lt;xsl:map:entry key="$key" select="$value"/&gt;
</code></pre>
<p>Assembling a map from a set of KVPs</p>
<pre><code>map:merge($kvps)
&lt;xsl:map&gt;
</code></pre>
<p>Decomposing a map into a sequence of KVPs:</p>
<p><code>map:for-each($map, map:entry#2)</code></p>
<p>Extracting the key from a KVP:</p>
<p><code>map:keys($kvp)</code></p>
<p>Extracting the value from a KVP:</p>
<p><code>$kvp?*</code></p>
<p><strong>Doubleton Representation</strong></p>
<p>Constructing a KVP from a key and a value:</p>
<pre><code>map{ 'key': $key, 'value': $value }
</code></pre>
<p>Assembling a map from a set of KVPs</p>
<p><code>map:build($kvps, -&gt;{?key}, -&gt;{?value})</code></p>
<p>Decomposing a map into a sequence of KVPs:</p>
<p><code>map:for-each($map, -&gt;($K, $V){map{ 'key': $key, 'value': $value })</code></p>
<p>Extracting the key from a KVP:</p>
<p><code>$kvp?key</code></p>
<p>Extracting the value from a KVP:</p>
<p><code>$kvp?value</code></p>
<p><strong>Analysis</strong></p>
<p>The singleton representation is better supported at present, and it makes sense therefore to fill in the gaps that currently make it awkward. The main attraction of the doubleton representation is the ease of extracting the key and the value using <code>$kvp?key</code> and <code>$kvp?value</code>. The equivalents for the singleton representation (<code>map:keys($kvp)</code> and <code>$kvp?*</code>) feel clumsy and unintuitive; however, it's not at all obvious what would be better, short of introducing new custom syntax, which seems over-the-top. The best idea I can come up with is to have two functions <code>map:key($kvp)</code> and <code>map:value($kvp)</code> which require $kvp to be a singleton map. But I hate the namespace prefixes...</p>
<p>The other thing needed to "fill the gaps" is a function <code>map:entries($map)</code> equivalent to <code>map:for-each($map, map:entry#2)</code>.</p>
<p>What if we chose to go the other way, and improve support for the doubleton representation?</p>
<p>We could add <code>map:key-value-pair($key, $value)</code> to create  KVP, and <code>map:of($kvps)</code> to build a map from a set of KVPs, and <code>map:key-value-pairs($map)</code> to decompose a map. The trickiest problem is what to do about XSLT, where the 3.0 instructions <code>&lt;xsl:map&gt;</code> and <code>&lt;xsl:map-entry&gt;</code> use the singleton representation.</p>
</div></details></div>
<div class="toot" id="created-356"><h2>Issue #356 created<span class="toot-id"> #created-356</span></h2><div class="pubdate">18 Feb at 00:21:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/356">https://github.com/qt4cg/qtspecs/issues/356</a></div><details><summary>array:leaves</summary><div class="markup"><h1>1. Issues</h1>
<p>There are at least two issues with the definition of the function <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-flatten"><strong><code>array:flatten</code></strong></a>:</p>
<ol>
<li>
<p>Unlike most other functions on arrays (such as <strong><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-put">array:put</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-replace">array:replace</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-append">array:append</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-slice">array:slice</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-subarray">array:subarray</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-remove">array:remove</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-insert-before">array:insert-before</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-tail">array:tail</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-trunk">array:trunk</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-reverse">array:reverse</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-join">array:join</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-for-each">array:for-each</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-filter">array:filter</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-for-each-pair">array:for-each-pair</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-sort">array:sort</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-partition">array:partition</a></strong>) , which produce an array as their result, <strong>this function produces only a sequence</strong></p>
</li>
<li>
<p><strong>This function is not lossless</strong> -- any members that are the empty sequence or the empty array are not represented in the returned result.</p>
</li>
</ol>
<h1>2. Suggested solution(s)</h1>
<p>We want to have a function that is similar to the wrongly defined one, but produces its contents as an array, and is lossless. There are two obvious ways to do this:</p>
<ol>
<li>
<p>Correct the specification of   <strong><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-flatten"><code>array:flatten</code></a></strong> so that its result is an array and it represents the empty sequences and empty arrays as the same members of its result.</p>
</li>
<li>
<p>Add to the Specification a new function: <strong><code>array:leaves</code></strong> that produces an array as its result and that is lossless.
<strong>array:leaves</strong> returns an array whose members are exactly all the leaves of the input array, by the order of their appearance. By definition leaves are all, and at any depth, members that are not an array except when they are the empty array. Thus () (the empty sequence) and [] (the empty array) are leaves by definition.</p>
</li>
</ol>
<p><strong><em>Solution 2. will not cause any compatibility issues</em></strong>.</p>
<h1>3. Examples</h1>
<p>The expression <strong><code>array:leaves([1, (), [4, 6], 5, 3])</code></strong> returns <strong><code>[1, (),  4, 6, 5, 3]</code></strong>.</p>
<p>The expression <strong><code>array:leaves([1, 2, 5], [[10, 11], 12], [], 13)</code></strong> returns <strong><code>[1, 2, 5, 10, 11, 12, [], 13]</code></strong>.</p>
</div></details></div>
<div class="toot" id="agenda-02-21"><h2>QT4 CG meeting 023 draft agenda<span class="toot-id"> #agenda-02-21</span></h2><div class="pubdate">17 Feb at 17:49:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/02-21">https://qt4cg.org/meeting/agenda/2023/02-21</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-355"><h2>Pull request #355 created<span class="toot-id"> #created-355</span></h2><div class="pubdate">16 Feb at 21:41:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/355">https://github.com/qt4cg/qtspecs/pull/355</a></div><details><summary>Action QT4CG-022-02 - add to imp-def-feature appendix</summary><div class="markup"><p>Adds entries to the implementation-defined-features appendix of the serialization spec, corresponding to the option to generate <code>&lt;meta charset="XXX"&gt;</code> for HTML5.</p>
</div></details></div>
<div class="toot" id="created-354"><h2>Pull request #354 created<span class="toot-id"> #created-354</span></h2><div class="pubdate">16 Feb at 18:30:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/354">https://github.com/qt4cg/qtspecs/pull/354</a></div><details><summary>Combine multiple signatures of XSLT functions to use defaults</summary><div class="markup"><p>This PR addresses issue 69, by modifying those XSLT built-in functions that currently have multiple signatures, to use a single signature with parameter defaults instead.</p>
<p>The changes however don't currently render correctly. The XSLT processing pipeline needs to be changed to pick up the changes that were made to the F+O stylesheets to render parameter defaults correctly. I haven't yet managed to work out where this is done.</p>
</div></details></div>
<div class="toot" id="created-353"><h2>Pull request #353 created<span class="toot-id"> #created-353</span></h2><div class="pubdate">16 Feb at 17:22:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/353">https://github.com/qt4cg/qtspecs/pull/353</a></div><details><summary>Issue109 xsl note</summary><div class="markup"><p>Addresses issue #109 and issue #87. Unfortunately the PR also includes the unrelated commits for issue 22.</p>
</div></details></div>
<div class="toot" id="created-352"><h2>Issue #352 created<span class="toot-id"> #created-352</span></h2><div class="pubdate">16 Feb at 14:58:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/352">https://github.com/qt4cg/qtspecs/issues/352</a></div><details><summary>The @array attribute of xsl:for-each-group is no more</summary><div class="markup"><p>There is a note in XSLT §14.2 concerning the @array attribute of xsl:for-each-group, but this attribute has been dropped.</p>
</div></details></div>
<div class="toot" id="closed-351"><h2>Issue #351 closed<span class="toot-id"> #closed-351</span></h2><div class="pubdate">16 Feb at 08:48:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/351">https://github.com/qt4cg/qtspecs/pull/351</a></div><p>Another attempt to build off the merge-base branch</p></div>
<div class="toot" id="created-351"><h2>Pull request #351 created<span class="toot-id"> #created-351</span></h2><div class="pubdate">16 Feb at 08:48:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/351">https://github.com/qt4cg/qtspecs/pull/351</a></div><p>Another attempt to build off the merge-base branch</p></div>
<div class="toot" id="closed-341"><h2>Issue #341 closed<span class="toot-id"> #closed-341</span></h2><div class="pubdate">16 Feb at 00:17:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/341">https://github.com/qt4cg/qtspecs/issues/341</a></div><p>[XPath] Error-free selection operator for maps or arrays, or finite-domain functions</p></div>
<div class="toot" id="created-350"><h2>Issue #350 created<span class="toot-id"> #created-350</span></h2><div class="pubdate">16 Feb at 00:11:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/350">https://github.com/qt4cg/qtspecs/issues/350</a></div><details><summary>CompPath (Composite-objects path) Expressions</summary><div class="markup"><h1>CompPath (Composite-objects path) Expressions</h1>
<p>As initially discussed in issue #341, we were exploring different ways to provide an XPath-like language to traverse in depth composite objects such as maps and arrays and select their members at any depth.
While working on this, the idea of an XPath-like language for composite items started to emerge and here we present this idea in a more or less crystalized form.</p>
<h2>1. Root Component</h2>
<p>Any CompPath expression must start off a composite item (of type map or array, or of other future composite item type (maybe set? )  ).
This can be a literal composite item or a reference to a variable whose value is a composite item.</p>
<p>Examples:</p>
<pre><code class="language-xq">
(: Literal composite items: :)
[1, 2, 3]

[1, [2,  3]]?2

{"x":1, "y" : map{ "z": 2}}

{"x":1, "y" : map{ "z": 2}} ?y

(: Variables containing composite items: :)
let $comp1 := [1, [2, 3]],
 $comp2 :=$comp1 ?2,
 $comp3 := {"x":1, "y" : map{ "z": 2}},
 $comp4 := $comp3 ?y
</code></pre>
<p>In the above examples all literal expressions and all variables (<strong><code>$comp1, $comp2, $comp3, $comp4</code></strong>) may serve as the root component for a CompPath expression.</p>
<h2>2. The component-path operator (\)</h2>
<p>The component-path operator "\" is used to build expressions for locating members at any depth within component trees. Its left-hand side expression must return a result that is a composite item or else this result is represented as such by wrapping it into an array.</p>
<p>The operator returns an array, the values of whose members are composite items themselves or any such value may be a non-composite "leaf" in the root-component tree).</p>
<p>Each operation E1\E2 is evaluated as follows: Expression E1 is evaluated, and the result is wrapped in an array A1. If any member of A1 is not a composite item, a type error is raised.
Each member of A1 serves in turn  to provide an inner "composite-focus" (the member as the "composite-context-item" or <strong><code>.</code></strong>, its index in A1 as the "composite-context-position" or <strong><code>index()</code></strong>, the set of keys of the composite-context-item as the "composite-keyset" or <strong><code>keys()</code></strong> and the size of this member as the "composite-context-size" (specified as one of: <strong><code>size()</code></strong>, or <strong><code>array-size()</code></strong> or <strong><code>key-size()</code></strong>) ) for the evaluation of E2. The result of each evaluation of  E2, if it isn't a single composite item, is wrapped in a single array. The arrays resulting from all the evaluations of E2 are wrapped  in a single array and this single array is the result of the evaluation.</p>
<p>E2 is typically a function over the <em>context-focus</em>  and its results will be the set of the next step composite-context-items (used as the left-hand-side of the next in chain composite-step-expression (see below)), or these results would be the final results of evaluation if this is the last-in chain composite-step-expression.</p>
<h2>3. Composite-Steps</h2>
<p>A <strong>composite-step</strong> is a part of a composite-path-expression that generates an array and filters its members by zero or more predicates. A <strong>composite-step-expression</strong> is either a <em>CompositeAxisStep</em> or a <em>CompositePostfixExpression</em>.</p>
<h2>4. Composite-Axes</h2>
<p>The following axes are defined for traversing a composite-item tree:</p>
<ul>
<li>The <strong><code>child-member::</code></strong> axis contains the members of the composite-context-item.</li>
<li>The  <strong><code>value-member::</code></strong>  axis contains the members of the composite-context-item that are not composite themselves.</li>
<li>The  <strong><code>node-member::</code></strong>  axis contains the members of the composite-context-item that are nodes.</li>
<li>The <strong><code>descendant-member::</code></strong> axis is defined as the transitive closure of the <strong><code>child-member::</code></strong> axis; it contains the descendent-members of the composite-context-item (the child members of the composite-context-item, and their child-members, ... and so on).</li>
<li>The <strong><code>self::</code></strong> axis contains just the composite-context-item.</li>
<li>The <strong><code>descendant-member-or-self::</code></strong> contains the composite-context-item and all of its descendent-members.</li>
<li>The <strong><code>following-sibling-member::</code></strong> axis contains the members of the immediate container of the composite-context-item that follow it. For any two members <strong><em>mem1</em></strong> and <strong><em>mem2</em></strong> of a composite item <strong><em>Comp</em></strong>, by definition <strong><em>mem2</em></strong> follows <strong><em>mem1</em></strong> if and only if <strong><em>Comp</em></strong> is an array and the index of <strong><em>mem2</em></strong> in <strong><em>Comp</em></strong> is greater than that of <strong><em>mem1</em></strong>, or if <strong><em>Comp</em></strong> is a map, then the key of <strong><em>mem2</em></strong> is greater than that of <strong><em>mem1</em></strong>.</li>
<li>The <strong><code>preceding-sibling-member::</code></strong> axis contains the members of the immediate container of the composite-context-item that precede it. For any two members <strong><em>mem1</em></strong> and <strong><em>mem2</em></strong> of a composite item <strong><em>Comp</em></strong>, by definition <strong><em>mem1</em></strong> precedes <strong><em>mem2</em></strong> if and only if <strong><em>Comp</em></strong> is an array and the index of <strong><em>mem2</em></strong> in <strong><em>Comp</em></strong> is greater than that of <strong><em>mem1</em></strong>, or if <strong><em>Comp</em></strong> is a map, then the key of <strong><em>mem2</em></strong> is greater than that of <strong><em>mem1</em></strong>.</li>
</ul>
<p>For example, <strong><code>following-sibling-member::5</code></strong> means all members of the composite-context-item with index &gt; 5,
and <strong><code>preceding-sibling-member::5</code></strong> means all members of the composite-context-item with index &lt; 5</p>
<p><strong>Note</strong>: If the immediate container of the composite-context-item is a map whose key-values cannot be ordered, then specifying either of the <strong><code>following-sibling-member::</code></strong> or <strong><code>preceding-sibling-member::</code></strong> axes on this composite-context-item must raise a type error. (Obviously, these two axes are meaningful only for composite items, whose members are ordered, such as the array).</p>
<p>If the composite-axis name is omitted from a composite-axis step, the default axis is <strong><code>child-member::</code></strong></p>
<h2>5. Composite Axis Steps</h2>
<p>A composite axis step completely resembles the ordinary axis step in XPath. It consists of three parts:</p>
<ol>
<li>The composite axis  (<strong><code>child-member::</code></strong>, <strong><code>descendant-member::</code></strong>, <strong><code>value-member::</code></strong>, <strong><code>node-member::</code></strong>, <strong><code>following-sibling-member::</code></strong>, <strong><code>preceding-sibling-member::</code></strong>, <strong><code>self::</code></strong>, or the <strong><code>descendant-member-or-self::</code></strong> axis)</li>
<li>The member test</li>
<li>The composite-predicates</li>
</ol>
<h2>6. Member Tests</h2>
<p>A member test is a condition on the key-name, index, or kind (<em>composite</em>, <em>map</em>, <em>array</em> or <em>value</em>, <em>node</em>, or (any) <em>member</em>). A member test determines which members contained by a copmosite-axis are selected by a composite-step.</p>
<p>As such, a member test is either an <em>identifier-test</em> (key-name or index) or a <em>kind-test</em> (<em>composite</em>, <em>map</em>, <em>array</em>,  <em>value</em>, or <em>member</em>)).</p>
<p>Examples of member identifiers:</p>
<ul>
<li>
<p>A string specifies a name of a key, whose value will be selected. For example: <strong><code>\child-member::X</code></strong> selects from the composite-context-item the value corresponding to its key which has the name "X".</p>
</li>
<li>
<p><strong><code>\child-member::3</code></strong> selects from the composite-context-item the value of its 3rd member, if it is an array or the value corresponding to its key <strong><code>3</code></strong>, if it is a map.</p>
</li>
<li>
<p><strong><code>following-sibling-member::3</code></strong> selects from the composite-content-item (which is most-likely an array) all of its members having index greater than 3.</p>
</li>
<li>
<p><strong><code>preceding-sibling-member::3</code></strong> selects from the composite-content-item (which is most-likely an array) all of its members having index less than 3.</p>
</li>
<li>
<p><strong><code>\descendant-member-or-self::X</code></strong> selects from the composite-context-item (that must be a map) and from all its descendant-members, the values corresponding to their key named "X", if these descendents have a key named "X".</p>
</li>
<li>
<p>Similarly <strong><code>\5</code></strong> is equivalent to <strong><code>\child-member::5</code></strong> and selects from the composite-context-item that is an array the value of its 5th member. This will also select the value corresponding to the key <strong><code>5</code></strong> from the composite-context-item if it is a map, because on the <strong><code>child-member::</code></strong> axis both maps and arrays may be selected.</p>
</li>
<li>
<p><strong><code>\X</code></strong> is equivalent to <strong><code>\child-member::X</code></strong> and selects from the composite-context-item (that must be a map), the value corresponding to its key which has the name "X".</p>
<p>There is also the pseudo-operator <code>\\</code> . This is an abbreviation for:</p>
<p><strong><code>\descendant-member-or-self::member()\</code></strong></p>
<p>Thus, <strong><code>\\X</code></strong> means: "(Deep) Select all members of the root-component that are the corresponding values of keys equal to 'X' "</p>
</li>
<li>
<p>We may use a <strong><em>kind test</em></strong> as part of the previous example, if we want to select only a specific kind of members of the composite-context-item.
<strong><code>\array()</code></strong>  In this example, although we are on the <strong><code>child-member::</code></strong> axis, we want to select only members of the composite-context-item that are arrays.</p>
</li>
<li>
<p><strong><code>\map()</code></strong>  In this example, although we are on the <strong><code>child-member::</code></strong> axis, we want to select only members of the composite-context-item that are maps.</p>
</li>
<li>
<p><strong><code>\value()</code></strong>  In this example we want to select only members of the composite-context-item that are not composite items themselves.</p>
</li>
<li>
<p><strong><code>\node()</code></strong>  In this example we want to select only members of the composite-context-item that are nodes.</p>
</li>
<li>
<p><strong><code>\member()</code></strong>  In this example we want to select all members of the composite-context-item, regardless whether they are maps, arrays, or values.</p>
</li>
</ul>
<h3>6.1 Wildcards</h3>
<p>The <strong><code>*</code></strong> wildcard can be used instead of a member identifier. Its meaning is to select all existing members of the composite-context-item, that is possibly selected by a specific axis and limited by a specific member kind-test.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong><code>\*</code></strong>  (: (Shallow) Selects all members of the composite-context-item :)</li>
<li><strong><code>\map()\*</code></strong>  (: Selects from the composite-context-item all values that correspond to a key of any map-member of the composite-context item :)</li>
<li><strong><code>\array()\*</code></strong>  (: Selects from the composite-context-item all members of all its members that are arrays :)</li>
<li><strong><code>\\*</code></strong>  (: (Deep) Select all members of the composite tree rooted by the root-component :)</li>
</ul>
<h2>7. Predicates</h2>
<p>As defined above, a <strong>composite-step</strong> has three parts: <em>composite-axis</em> (can be omitted and then a default axis is used), <em>member test</em>, and an optional <em>list of composite-predicates</em>.</p>
<p>A <strong><em>composite-predicate</em></strong> in a composite-step is an expression used as a <em>filter</em> applied on the members of the composite-context-item that are already selected by the axis and member tests of the axis step, and not filtered out by any preceding composite-predicates in the <em>composite-predicates-list</em>. The composite-predicate may be any XPath expression and is written within double square brackets.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong><code>\*[[3]]</code></strong>  (: Selects any member of the composite-context-item, that is an array and has a 3rd member or any member of the composite-context-item, that is a map and has a key <strong>3</strong> :)
This is a shorthand for: <strong><code>\*[[array-size() ge 3 or 3 = keys()]]</code></strong></li>
<li><strong><code>\array()[[3]]</code></strong> (: Selects those array members of the composite-context-item that have a 3rd member :)
This is a shorthand for: <strong><code>\*[[size() ge 3]]</code></strong></li>
<li><strong><code>\*[[size() eq 7]]</code></strong>  (: Selects those members whose array-size() or key-size() is exactly 7:)
This is a shorthand for: <strong><code>\composite::*[[self::map() and key-size() eq 7 or self::array() and array-size() eq 7]]</code></strong></li>
<li><strong><code>\*[[X]]</code></strong>  (: Selects any member of the composite-context-item, that is a map and has a key <strong>X</strong>  :)</li>
<li><strong><code>\map()[[X]]</code></strong> (: Selects any map member of the composite-context-item, that has a key <strong>X</strong>  :)
The above two expressions are a shorthand for: <strong><code>\*[['X' = keys()]]</code></strong></li>
<li><strong><code>\value()[[. gt 0]]</code></strong> (: Selects any value (non-composite member) of the composite-context-item, that is a positive number :)</li>
</ul>
<h2>8. Mixing CompPath and XPath expressions</h2>
<p>CompPath and XPath expressions can be used as parts of a single expression:</p>
<ul>
<li>
<p>A CompPath expression may be appended at the end of any XPath expression that produces a composite-object .</p>
</li>
<li>
<p>An XPath expression may be appended at the end of any CompPath expression. When doing this,</p>
<p><strong><code>CompPathExpr / XPathExpr</code></strong></p>
<p>is equivalent to:</p>
<p><strong><code>CompPathExpr\node::* / XPathExpr</code></strong></p>
<p>And this:</p>
<p><strong><code>CompPathExpr ! XPathExpr</code></strong>  (:  Note: also causes ordering and deduplication of the nodes! :)</p>
<p>is equivalent to:</p>
<p><strong><code>CompPathExpr\value::* !  XPathExpr</code></strong>  (: Note: No ordering or deduplication, can be applied on any item, not just on nodes :)</p>
</li>
<li>
<p>A CompPath expression may be substituted for the expected argument of any XPath expression, for example:
<strong><code>count(MyCompPathExpr)</code></strong></p>
</li>
<li>
<p>Any XPath expression that produces a composite item can be used as the composite-root for any CompPath expression</p>
</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-xq">let $myBooks := 
&lt;books&gt;
 &lt;book name="Tom Sawyer"&gt;
   &lt;author&gt;Mark Twain&lt;/author&gt;
 &lt;/book&gt;
 &lt;book name="Wuthering Heights"&gt;
   &lt;author&gt;Emily Brontë&lt;/author&gt;
 &lt;/book&gt;
 &lt;book name="Jane Eyre"&gt;
   &lt;author&gt;Charlotte Brontë&lt;/author&gt;
 &lt;/book&gt;
 &lt;book name="Adventures of Huckleberry Finn"&gt;
   &lt;author&gt;Mark Twain&lt;/author&gt;
 &lt;/book&gt;
&lt;/books&gt;,
$map1 := map {"science-works": map{"Einstein": "Special Theory of relativity",
                                  "Darwin" : "On the Origin of Species"
                                 },
             "literature" : map{"19the Century": $myBooks}
            }
return
  $map1\literature\\*/book[author eq 'Mark Twain']
</code></pre>
<p>Evaluating this mixed CompPath and XPath expression produces the correct result:</p>
<pre><code class="language-xq">&lt;book name="Tom Sawyer"&gt;
  &lt;author&gt;Mark Twain&lt;/author&gt;
&lt;/book&gt;
&lt;book name="Adventures of Huckleberry Finn"&gt;
  &lt;author&gt;Mark Twain&lt;/author&gt;
&lt;/book&gt;
</code></pre>
</div></details></div>
<div class="toot" id="closed-349"><h2>Issue #349 closed<span class="toot-id"> #closed-349</span></h2><div class="pubdate">15 Feb at 18:04:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/349">https://github.com/qt4cg/qtspecs/pull/349</a></div><p>Revert PR change; it doesn't work in this context</p></div>
<div class="toot" id="created-349"><h2>Pull request #349 created<span class="toot-id"> #created-349</span></h2><div class="pubdate">15 Feb at 18:04:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/349">https://github.com/qt4cg/qtspecs/pull/349</a></div><p>Revert PR change; it doesn't work in this context</p></div>
<div class="toot" id="closed-348"><h2>Issue #348 closed<span class="toot-id"> #closed-348</span></h2><div class="pubdate">15 Feb at 17:46:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/348">https://github.com/qt4cg/qtspecs/pull/348</a></div><p>Attempt to build PR with merge-base version of master</p></div>
<div class="toot" id="created-348"><h2>Pull request #348 created<span class="toot-id"> #created-348</span></h2><div class="pubdate">15 Feb at 17:46:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/348">https://github.com/qt4cg/qtspecs/pull/348</a></div><details><summary>Attempt to build PR with merge-base version of master</summary><div class="markup"><p>This PR changes the CI <code>build-pr.yml</code> script so that it checks out the version of master that the branch started from, rather than the current version of master, for building the specifications.</p>
<ul>
<li>Pro: we won't get build failures when the current master can't build the old version (for example, when images have been removed)</li>
<li>Con: we won't get any features from the current master, such as stylesheet updates</li>
</ul>
<p>Since failing builds are more troublesome than formatting issues, I'm going to say the pros outweigh the cons.</p>
</div></details></div>
<div class="toot" id="created-347"><h2>Pull request #347 created<span class="toot-id"> #created-347</span></h2><div class="pubdate">15 Feb at 14:06:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/347">https://github.com/qt4cg/qtspecs/pull/347</a></div><details><summary>Attempt to clarify fn:parse-uri and fn:build-uri</summary><div class="markup"><p>Fix #307</p>
</div></details></div>
<div class="toot" id="closed-346"><h2>Issue #346 closed<span class="toot-id"> #closed-346</span></h2><div class="pubdate">15 Feb at 10:11:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/346">https://github.com/qt4cg/qtspecs/pull/346</a></div><p>Remove dagger from record cross-references</p></div>
<div class="toot" id="created-346"><h2>Pull request #346 created<span class="toot-id"> #created-346</span></h2><div class="pubdate">15 Feb at 10:10:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/346">https://github.com/qt4cg/qtspecs/pull/346</a></div><details><summary>Remove dagger from record cross-references</summary><div class="markup"><p>Record types are better supported by the stylesheets so the dagger is simply a distraction.</p>
</div></details></div>
<div class="toot" id="created-345"><h2>Issue #345 created<span class="toot-id"> #created-345</span></h2><div class="pubdate">14 Feb at 22:52:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/345">https://github.com/qt4cg/qtspecs/issues/345</a></div><details><summary>Missing rule for matching atomic values against atomic types</summary><div class="markup"><p>In XPath §3.6.2 we have forgotten to state the obvious rule:</p>
<p>"An Atomic Value AV matches a generalized atomic type GAT if the type annotation of AV (call it T) satisfies the condition derives-from(T, GAT)."</p>
<p>At the same time it would a good idea to clarify whether locally-declared union and enum types fall within the definition of "schema types" (I think they should do so.)</p>
</div></details></div>
<div class="toot" id="closed-342"><h2>Issue #342 closed<span class="toot-id"> #closed-342</span></h2><div class="pubdate">14 Feb at 17:24:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/342">https://github.com/qt4cg/qtspecs/pull/342</a></div><p>Issue318 meta elements</p></div>
<div class="toot" id="minutes-02-14"><h2>QT4 CG meeting 022 draft minutes<span class="toot-id"> #minutes-02-14</span></h2><div class="pubdate">14 Feb at 17:12:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-14">https://qt4cg.org/meeting/minutes/2023/02-14</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-338"><h2>Issue #338 closed<span class="toot-id"> #closed-338</span></h2><div class="pubdate">09 Feb at 17:30:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/338">https://github.com/qt4cg/qtspecs/pull/338</a></div><p>Add ednote per action QT4CG-016-02</p></div>
<div class="toot" id="created-344"><h2>Pull request #344 created<span class="toot-id"> #created-344</span></h2><div class="pubdate">09 Feb at 17:06:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/344">https://github.com/qt4cg/qtspecs/pull/344</a></div><details><summary>Issue 22: allow "for"/"let" keyword to be repeated in XPath</summary><div class="markup"><p>Addresses the proposal in issue 22 to allow repetition of the "let" or "for" keyword in a ForExpr or LetExpr. (It does not, however, allow "for" and "let" to be mixed).</p>
</div></details></div>
<div class="toot" id="created-343"><h2>Issue #343 created<span class="toot-id"> #created-343</span></h2><div class="pubdate">09 Feb at 12:47:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/343">https://github.com/qt4cg/qtspecs/issues/343</a></div><details><summary>$collation argument: Unification</summary><div class="markup"><p>In the function set of the XQFO current specification, the type of the <code>$collation</code> parameter is sometimes <code>xs:string</code> and sometimes <code>xs:string?</code>, depending on the position of the parameter. Examples:</p>
<h4>Mandatory</h4>
<pre><code class="language-xquery">fn:distinct-values($values as&nbsp;xs:anyAtomicType*, $collation as fn:default-collation())&nbsp;as&nbsp;xs:anyAtomicType*
fn:index-of($input | as&nbsp;xs:anyAtomicType*, $search | as&nbsp;xs:anyAtomicType, $collation as&nbsp;xs:string)&nbsp;as&nbsp;xs:integer*
</code></pre>
<h4>Optional</h4>
<pre><code class="language-xquery">fn:sort($input as&nbsp;item()*, $collation as&nbsp;xs:string?, $key as&nbsp;function(item()) as xs:anyAtomicType*
fn:lowest($input as item()*, $collation as xs:string?, $key as&nbsp;function(item()) as xs:anyAtomicType*)&nbsp;as&nbsp;item()*
</code></pre>
<p>I think we should always allow an empty sequence.</p>
</div></details></div>
<div class="toot" id="created-342"><h2>Pull request #342 created<span class="toot-id"> #created-342</span></h2><div class="pubdate">09 Feb at 12:27:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/342">https://github.com/qt4cg/qtspecs/pull/342</a></div><details><summary>Issue318 meta elements</summary><div class="markup"><p>Revises the rules for serializing meta elements to take account of new HTML5 syntax.</p>
<p>Resolves issue #318</p>
</div></details></div>
<div class="toot" id="closed-18"><h2>Issue #18 closed<span class="toot-id"> #closed-18</span></h2><div class="pubdate">09 Feb at 11:01:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/18">https://github.com/qt4cg/qtspecs/issues/18</a></div><p>[DM31] Function types do not form a hierarchy</p></div>
<div class="toot" id="closed-58"><h2>Issue #58 closed<span class="toot-id"> #closed-58</span></h2><div class="pubdate">08 Feb at 16:20:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/58">https://github.com/qt4cg/qtspecs/issues/58</a></div><p>[XQuery] String Value Templates</p></div>
<div class="toot" id="closed-107"><h2>Issue #107 closed<span class="toot-id"> #closed-107</span></h2><div class="pubdate">08 Feb at 16:11:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/107">https://github.com/qt4cg/qtspecs/issues/107</a></div><p>Allow self::(a|b|c)</p></div>
<div class="toot" id="closed-234"><h2>Issue #234 closed<span class="toot-id"> #closed-234</span></h2><div class="pubdate">08 Feb at 11:45:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/234">https://github.com/qt4cg/qtspecs/issues/234</a></div><p>If Without Else</p></div>
<div class="toot" id="closed-330"><h2>Issue #330 closed<span class="toot-id"> #closed-330</span></h2><div class="pubdate">08 Feb at 08:35:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/330">https://github.com/qt4cg/qtspecs/pull/330</a></div><p>Update fn:parse-html to apply review feedback.</p></div>
<div class="toot" id="created-341"><h2>Issue #341 created<span class="toot-id"> #created-341</span></h2><div class="pubdate">08 Feb at 01:50:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/341">https://github.com/qt4cg/qtspecs/issues/341</a></div><details><summary>[XPath] Error-free selection operator for maps or arrays, or finite-domain functions</summary><div class="markup"><p>In March 2021 Jarno Elovirta raised on the <strong><em>#general channel</em></strong> of the XML.com Slack the problem that the existing map or array lookup operator "<strong>?</strong>" prevents a free traversal of a nested mapp/array object. For example, this expression results in error:</p>
<pre><code class="language-xq">[
  map {"k0": 1}, 
  map{"k0": [1, 2, 3]}
]  ?* ?("k0")  ?*
</code></pre>
<p><strong>[XPTY0004] Input of lookup operator must be map or array: 1.</strong></p>
<hr>
<p>There are three possible types of reaction to this problem:</p>
<ol>
<li>
<p>Do nothing</p>
</li>
<li>
<p>Relax the semantics of the map/array lookup operator "<strong>?</strong>" so that it can be applied on items of non-map/non-array type and in such case produce the empty sequence.</p>
</li>
<li>
<p>Introduce a similar operator to "<strong>?</strong>" that will behave as it, but instead of producing an error when applied on items of non-map/non-array type it produces the empty sequence.</p>
</li>
</ol>
<p>Obviously, we are not advocating the 1st choice above, or otherwise we wouldn't be raising any issue 😄</p>
<p>Choice 2 could be implemented, but this would have a few drawbacks:</p>
<ul>
<li>it would bring a certain degree of backwards incompatibility</li>
<li>"silently returning nothing" is really difficult to debug or even notice unexpected results, as pointed out by @michaelhkay</li>
</ul>
<p><strong>This proposal is to choose alternative 3. above</strong>.</p>
<p>Why is it better than the 2nd one?</p>
<ul>
<li>No incompatibility can be introduced, as this is a new operator.</li>
<li>The user has intentionally chosen this operator over the "?" operator, and this means that the user is well aware of the new, sometimes tricky to observe/explain/debug behavior, but the user doesn't mind these effects and is ready to deal with them.</li>
</ul>
<h2>Definition</h2>
<p>By definition the operator <strong>"-&gt;"</strong> with left-hand-side any expression <strong><em>E</em></strong> and right-hand-side a literal string  <strong><em>X</em></strong>:</p>
<p>&nbsp;&nbsp;&nbsp;<strong><code>E -&gt; X</code></strong></p>
<p>is lexically expanded to:</p>
<p>&nbsp;&nbsp;&nbsp;<strong><code>E[. instance of map(*) or . instance of array(*)]?X </code></strong></p>
<h2>Example</h2>
<p>With the original expression provided by Jarno Elovirta, but now using the <strong>"-&gt;"</strong> operator:</p>
<pre><code class="language-xq">[
  map {"k0": 1}, 
  map{"k0": [1, 2, 3]}
]  -&gt;* -&gt;("k0")  -&gt;*
</code></pre>
<p>its evaluation produces the expected result (all the values within just one of the leaves of the tree), and no error:</p>
<p><strong><code>1, 2, 3</code></strong></p>
<p>That is, <strong><code>1 -&gt;*</code></strong>  produces the empty sequence and no error.</p>
<p><strong>Note</strong>:</p>
<p>Of course, the above example can be rewritten to this equivalent XPath 3.0 expression and will get the wanted result, but literally no one, myself included, will ever write this:</p>
<pre><code class="language-xq">[
 map {"k0": 1}, 
 map{"k0": [1, 2, 3]}
] [. instance of map(*) or . instance of array(*)]      ?*
           [. instance of map(*) or . instance of array(*)]      ?k0
                                [. instance of map(*) or . instance of array(*)]   ?*
</code></pre>
<p><img src="https://user-images.githubusercontent.com/10605892/217432167-5f7fbff0-3d8d-48a3-a27d-5f62cb77c3dc.png" alt="image"></p>
<h2>Thus <strong><em><code>this is all about making it possible/feasible and empowering our users!</code></em></strong></h2>
</div></details></div>
<div class="toot" id="created-340"><h2>Issue #340 created<span class="toot-id"> #created-340</span></h2><div class="pubdate">07 Feb at 22:02:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/340">https://github.com/qt4cg/qtspecs/issues/340</a></div><details><summary>fn:format-number: Specifying decimal format</summary><div class="markup"><p>It would be nice if the decimal format for <code>fn:format-number</code> could also be supplied via an additional argument. The current syntax is:</p>
<pre><code class="language-xquery">(: result: 12.345,67 :)
declare decimal-format de decimal-separator = ',' grouping-separator = '.';

format-number(
  value := 12345.67,
  picture := '#.##0,00',
  decimal-format-name := 'de'
)
</code></pre>
<p>The syntax could be enhanced as follows:</p>
<pre><code class="language-xquery">format-number(
  value := 12345.67,
  picture := '#.##0,00',
  format := map { 'decimal-separator': ',', 'grouping-separator': '.' }
)
</code></pre>
<p>If both <code>decimal-format-name</code> and <code>format</code> are supplied, an error should be raised.</p>
<p><strong>Edit 2023-05-02, adopted from a comment further below:</strong></p>
<p>Next, language-specific default settings would be sensible. The existing syntax could be used:</p>
<pre><code class="language-xquery">format-number(12345.67, '#.##0,00', 'de')
</code></pre>
<p>As known from the other functions for formatting numbers and dates, it could be up to the implementation to decide which languages are supported. The defaults could be overwritten by custom decimal-format declarations in the prolog to ensure that a setting is applied, even if an implementation does not support it.</p>
</div></details></div>
<div class="toot" id="minutes-02-07"><h2>QT4 CG meeting 021 draft minutes<span class="toot-id"> #minutes-02-07</span></h2><div class="pubdate">07 Feb at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-07">https://qt4cg.org/meeting/minutes/2023/02-07</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-339"><h2>Issue #339 created<span class="toot-id"> #created-339</span></h2><div class="pubdate">07 Feb at 13:46:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/339">https://github.com/qt4cg/qtspecs/issues/339</a></div><details><summary>The constraints on document-uri are too...constraining</summary><div class="markup"><p>The XPath data model imposes the following constraints on the document-uri property:</p>
<blockquote>
<p>If the <code>document-uri</code> is not the empty sequence, then the following constraint must hold: the node returned by evaluating <code>fn:doc()</code> with the document-uri as its argument must return the document node that provided the value of the <code>document-uri</code> property.</p>
<p>In other words, for any Document Node <code>$arg</code>, either <code>fn:document-uri($arg)</code> must return the empty sequence or <code>fn:doc(fn:document-uri($arg))</code> must return <code>$arg</code>.</p>
</blockquote>
<p>This contraint turns out to be inconvenient whenever the larger environment doesn’t enforce a 1:1 mapping between URIs and documents.</p>
<p>For example, in a browser context, a JavaScript function that returns different versions of the same document over time cannot identify those documents with the same document-uri.</p>
<p>In XProc, a <code>p:add-attribute</code> step that returns a copy of its input document with one additional attribute, cannot identify the output document with the same document-uri as the input document.</p>
<p>Given that the document URI is often necessary to evaluate relative URI references within a document, the constraints imposed in the data model are too strict.</p>
</div></details></div>
<div class="toot" id="created-338"><h2>Pull request #338 created<span class="toot-id"> #created-338</span></h2><div class="pubdate">07 Feb at 13:33:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/338">https://github.com/qt4cg/qtspecs/pull/338</a></div><details><summary>Add ednote per action QT4CG-016-02</summary><div class="markup"><p>This is a purely editorial change. Unless someone objects over the next few days, I'm just going to merge it in.</p>
</div></details></div>
<div class="toot" id="agenda-02-07"><h2>QT4 CG meeting 021 draft agenda<span class="toot-id"> #agenda-02-07</span></h2><div class="pubdate">04 Feb at 15:09:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/02-07">https://qt4cg.org/meeting/agenda/2023/02-07</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-337"><h2>Issue #337 created<span class="toot-id"> #created-337</span></h2><div class="pubdate">02 Feb at 00:52:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/337">https://github.com/qt4cg/qtspecs/issues/337</a></div><details><summary>Local union and enum types: and the definition of generalised atomic types</summary><div class="markup"><p>We need to review the proposed specs for local union and enum types, and decide whether or not to proceed with them.</p>
<p>I note that the definitions of <strong>generalized atomic type</strong> and <strong>pure union type</strong> say they must be "schema-defined", which appears to exclude locally-defined union and enum types.</p>
<p>I wonder if the definition of local enum types should be aligned more closely with an XSD type derived from xs:string by restricting with an enum facet. Now that we allow down-casting in the coercion rules, the objections to this seem to disappear.</p>
<p><code>cast</code> and <code>castable</code> should also probably pay more attention to these types.</p>
</div></details></div>
<div class="toot" id="created-336"><h2>Pull request #336 created<span class="toot-id"> #created-336</span></h2><div class="pubdate">01 Feb at 12:48:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/336">https://github.com/qt4cg/qtspecs/pull/336</a></div><details><summary>Action QT4CG-019-01 (type of $pattern in fn:tokenize())</summary><div class="markup"><p>Also, update the fos:history record for a number of functions.</p>
</div></details></div>
<div class="toot" id="closed-308"><h2>Issue #308 closed<span class="toot-id"> #closed-308</span></h2><div class="pubdate">01 Feb at 12:13:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/308">https://github.com/qt4cg/qtspecs/pull/308</a></div><p>Improve the legends in the diagrams</p></div>
<div class="toot" id="closed-335"><h2>Issue #335 closed<span class="toot-id"> #closed-335</span></h2><div class="pubdate">01 Feb at 12:13:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/335">https://github.com/qt4cg/qtspecs/pull/335</a></div><p>Rework type hierarchy diagrams as styled lists</p></div>
<div class="toot" id="created-335"><h2>Pull request #335 created<span class="toot-id"> #created-335</span></h2><div class="pubdate">01 Feb at 12:13:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/335">https://github.com/qt4cg/qtspecs/pull/335</a></div><details><summary>Rework type hierarchy diagrams as styled lists</summary><div class="markup"><p>Close #308</p>
<p>This proposal was accepted at meeting 020 on 31 January 2023.</p>
<p>The PR won't format correctly because there are style changes, so I'm just going to merge this. I have fixed the diagrams in both the data model specification and f&amp;o.</p>
</div></details></div>
<div class="toot" id="closed-205"><h2>Issue #205 closed<span class="toot-id"> #closed-205</span></h2><div class="pubdate">01 Feb at 10:18:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/205">https://github.com/qt4cg/qtspecs/issues/205</a></div><p>Make higher-order-function support mandatory</p></div>
<div class="toot" id="closed-221"><h2>Issue #221 closed<span class="toot-id"> #closed-221</span></h2><div class="pubdate">01 Feb at 10:18:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/221">https://github.com/qt4cg/qtspecs/issues/221</a></div><p>Expose op:same-key() as a user-visible function</p></div>
<div class="toot" id="closed-324"><h2>Issue #324 closed<span class="toot-id"> #closed-324</span></h2><div class="pubdate">01 Feb at 10:17:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/324">https://github.com/qt4cg/qtspecs/pull/324</a></div><p>Proposed syntax and semantics for string templates</p></div>
<div class="toot" id="closed-326"><h2>Issue #326 closed<span class="toot-id"> #closed-326</span></h2><div class="pubdate">01 Feb at 10:17:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/326">https://github.com/qt4cg/qtspecs/pull/326</a></div><p>Issue 205: make support for higher-order functions mandatory</p></div>
<div class="toot" id="closed-319"><h2>Issue #319 closed<span class="toot-id"> #closed-319</span></h2><div class="pubdate">01 Feb at 10:17:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/319">https://github.com/qt4cg/qtspecs/pull/319</a></div><p>Issue 221: op:same-key becomes fn:atomic-equal</p></div>
<div class="toot" id="created-334"><h2>Issue #334 created<span class="toot-id"> #created-334</span></h2><div class="pubdate">01 Feb at 09:17:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/334">https://github.com/qt4cg/qtspecs/issues/334</a></div><details><summary>Transient properties: a new approach to deep selection and update in maps and arrays</summary><div class="markup"><p>After exploring many alternatives, I have come to the conclusion that we can't solve the problem of deep navigation and transformation of JSON structures without a data model change.</p>
<p>Most of the problems boil down to this: JSON trees do not have parent pointers, therefore after navigating down to a leaf node of the tree, we cannot get any information from higher up the tree. The solution to this (the "zipper" model) is to retain transient information about how a particular node in the tree was reached, so that we can retrace our steps and revisit nodes that were passed en route.</p>
<p>The change I propose is quite minor, but powerful: Any XDM value can be augmented with a set of transient properties represented as a set of key-value pairs. These properties are ignored (and typically dropped) by all operations on a value, except where otherwise specified. For the purpose of exposition, I'll use the syntax <code>$value¶name</code> to refer to the transient <code>name</code> property of <code>$value</code>.</p>
<p>We'll change the semantics of <code>map:get()</code> and <code>array:get()</code>, and the associated lookup operators, so that the resulting values have transient properties indicating how they were selected. For example, given</p>
<p><code>let $name := $person?firstName</code></p>
<p>the resulting value (perhaps the string "Michael") will be augmented with transient properties</p>
<ul>
<li>¶parent - the map from which the value was selected (retaining its own transient properties if any)</li>
<li>¶key - the key used to make the selection, here "firstName"</li>
</ul>
<p>and derived properties:</p>
<ul>
<li>¶ancestors - the transitive closure of ¶parent</li>
<li>¶root - the last ¶ancestor</li>
<li>¶path - a string representation of the path used to select the value</li>
</ul>
<p>We can also define other "downward selection" operations such as <code>map:find</code>, and <code>array:foot</code> to retain these transient properties. So for example <code>map:find($json, 'firstname')[.='Michael']¶parent?surname</code> now finds the surnames of anyone named 'Michael', at any depth of the tree.</p>
<p>If we turn back to the use cases in my 2016 paper on transforming JSON</p>
<p>https://www.saxonica.com/papers/xmlprague-2016mhk.pdf</p>
<p>The first use case (bulk update) relied on matching items expressed in XML as</p>
<p><code>match="map[array[@key='tags']/string='ice']/number[@key='price']/text()"</code></p>
<p>which couldn't be done in JSON because of the inability to match based on ancestor context. With the new transient properties we can match this as</p>
<p><code>match="type(xs:integer)[¶key = 'price'][¶parent?tags?* = 'ice']"</code></p>
<p>In the second use case (hierarchic inversion), we can again get properties of parent or ancestor maps</p>
<p><code>$students ! map:put("course", ¶parent?name)</code></p>
<p>I think we can also use this to define deep update operations. But I'll leave that investigation until later.</p>
<p>Note: transient properties potentially have many other applications, for example we might use them to solve our problems with <code>document-uri()</code>. But exploring that would be a distraction here. The nice thing about transient properties is that they give a lot of potential for augmenting existing functionality with full backwards compatibility, because we can define existing operations to return results with additional transient properties that all existing operations will ignore. If we were so minded, for example, we could have different functions/operators return "quiet NaN" and "signalling NaN" by adding a transient property to the NaN value returned.</p>
</div></details></div>
<div class="toot" id="created-333"><h2>Issue #333 created<span class="toot-id"> #created-333</span></h2><div class="pubdate">01 Feb at 00:34:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/333">https://github.com/qt4cg/qtspecs/issues/333</a></div><details><summary>Equality of function items</summary><div class="markup"><p>The question of equality of function items arises in the discussion of determinism of functions and memo functions in XSLT - see F&amp;O 3.1 section 1.7.4, and came up again today in the context of fn:deep-equal.</p>
<p>1.7.4 makes a brave attempt to describe situations under which two functions are "identical", though leaving implementations room for flexibility. I think we can build on this and improve it, by describing more situations in which the result is predictable.</p>
<p>The data model describes the properties of a function item, and we can say that two function items are equivalent if all their properties are the same.</p>
<p>The properties that cause problems are the "implementation" and the "closure", and in both cases I think we can find ways of doing a comparison.</p>
<p>For the implementation, we can define this by reference to the way in which the implementation property is set. For function items constructed by reference to static functions (e.g. <code>my:func#3</code> or <code>function-lookup(my:func, 3)</code>) then they have the same implementation if and only if they are constructed by reference to the same static function. Similarly for function items constructed by evaluating an inline function expression. Other ways of constructing a function item, such as partial application, essentially create a new function with the same implementation as an existing function and a different closure.</p>
<p>For the closure (ignoring for the moment functions that include parts of the dynamic context in their closure), this is essentially just a set of variable bindings and it's not too difficult to say that functions are identical if these sets of variable bindings are identical.</p>
</div></details></div>
<div class="toot" id="created-332"><h2>Issue #332 created<span class="toot-id"> #created-332</span></h2><div class="pubdate">31 Jan at 18:51:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/332">https://github.com/qt4cg/qtspecs/issues/332</a></div><details><summary>Add a namespace uris option to fn:path</summary><div class="markup"><p>The output of <code>fn;path</code> using namespaces is very verbose as it is specified to use the <code>Q{uri}name</code> syntax. It would be useful if it was extended to take a namespace prefix to uri map.</p>
<ol>
<li>Add a second <code>$namespaces</code> parameter that has the type <code>map(union(xs:NCName, enum('')), xs:anyURI)</code> (the same as fn:in-scope-namespaces) -- this will have a default value of <code>map{}</code> to preserve the existing behaviour.</li>
<li>If the namespace uri is in the map, use the given prefix. If that prefix is "" then just use the local name.</li>
<li>If the namespace uri is not in the map, use the <code>Q{uri}name</code> syntax.</li>
</ol>
<p>This allows for things like <code>fn:path($e, namespaces := fn:in-scope-namespaces())</code>.</p>
</div></details></div>
<div class="toot" id="created-331"><h2>Issue #331 created<span class="toot-id"> #created-331</span></h2><div class="pubdate">31 Jan at 18:43:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/331">https://github.com/qt4cg/qtspecs/issues/331</a></div><details><summary>Extend fn:path to support arrays and maps.</summary><div class="markup"><p>Currently, <code>fn:path</code> is defined for nodes. This means it is not possible to use it with arrays or maps (e.g. to determine the path to a JSON item when a comparison fails).</p>
<p>As such, I recommend:</p>
<ol>
<li>changing the type to <code>item()</code></li>
<li>If the value is a node use the current logic.</li>
<li>If the value is in an array, use <code>?n</code> where n is the nth item of the array where the item is located.</li>
<li>If the value is in a map, use <code>?name</code> or <code>?"name"</code> where name is the key name of the map where the item is located.</li>
<li>If the value is an atomic item, or the root of a map/array structure, use <code>.</code>.</li>
</ol>
<p>Example: <code>.?4?user?name</code></p>
</div></details></div>
<div class="toot" id="minutes-01-31"><h2>QT4 CG meeting 020 draft minutes<span class="toot-id"> #minutes-01-31</span></h2><div class="pubdate">31 Jan at 17:12:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-31">https://qt4cg.org/meeting/minutes/2023/01-31</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-330"><h2>Pull request #330 created<span class="toot-id"> #created-330</span></h2><div class="pubdate">31 Jan at 12:56:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/330">https://github.com/qt4cg/qtspecs/pull/330</a></div><details><summary>Update fn:parse-html to apply review feedback.</summary><div class="markup"><p>This PR applies the following review comments:</p>
<ul>
<li>[x] QT4CG-016-03: RD to add a note clarifying “known character encoding”</li>
<li>[x] QT4CG-016-04: RD to add a note clarifying the “<em>”/”</em>” html/version combination</li>
<li>[x] QT4CG-016-05: RD to add a “todo” noting the dependency on keyword arguments</li>
<li>[x] QT4CG-016-06: RD to reword the introduction to mapping to clarify who’s doing the mapping</li>
<li>[ ] QT4CG-016-08: RD to clarify how namespace comparisons are performed.</li>
<li>[x] QT4CG-016-09: RD to add a note stating that the local name should always be lowercase</li>
<li>[x] QT4CG-016-10: RD to consider how to clarify parsed entity parsing.</li>
</ul>
</div></details></div>
<div class="toot" id="created-329"><h2>Issue #329 created<span class="toot-id"> #created-329</span></h2><div class="pubdate">30 Jan at 11:45:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/329">https://github.com/qt4cg/qtspecs/issues/329</a></div><details><summary>Keyword parameters: Error codes</summary><div class="markup"><p>I’ve read the current specification twice, and I have checked the existing qt4 tests, but I’m still confused by the exact meaning of the new error codes for keyword arguments, <code>XPST0141</code> and <code>XPST0142</code>. Things are getting particularly tricky if we consider partial function applications.</p>
<p>My proposal would be to stick with the existing error code <code>XPST0017</code> for functions that cannot be matched.</p>
<p>Initial suggestion (obsolete):</p>
<ol>
<li>use the existing error code <code>XPST0017</code> for all cases in which a function cannot be chosen as the available arguments (both positional and keyword-based) don’t match the function definition, and</li>
<li>only raise a new error code (<code>XPST0141</code>, possibly) if a keyword argument has been specified more than once (as this can be done without checking the function definitions).</li>
</ol>
</div></details></div>
<div class="toot" id="created-328"><h2>Issue #328 created<span class="toot-id"> #created-328</span></h2><div class="pubdate">30 Jan at 10:05:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/328">https://github.com/qt4cg/qtspecs/issues/328</a></div><details><summary>Switch Cases: Lift single-item restriction on operands</summary><div class="markup"><h2>Motivation</h2>
<p><a href="https://www.w3.org/TR/xquery-31/#id-switch">XQuery switch cases</a> have a peculiar restriction: The operand of a single case must yield an empty sequence or a single item. There seem to be no (obvious) reasons why this restriction exists, so I believe we should lift it and allow arbitrary sequences.</p>
<p>A similar extension is planned for Java 12 (<a href="http://openjdk.java.net/jeps/325">JEP 325: Switch Expressions</a>). The required changes in XQuery are simpler, though, as the 3.1 grammar already supports arbitrary expressions as operands.</p>
<h2>Examples</h2>
<pre><code class="language-xquery">switch($value)
  case 1
  case 2
  case 3
  case 4
  case 5
    return 'small'
  default
    return 'big'
</code></pre>
<p>Proposed syntax:</p>
<pre><code class="language-xquery">switch($value)
  case 1 to 5
    return 'small'
  default
    return 'big'
</code></pre>
<h2>Required Changes</h2>
<p>The <a href="https://www.w3.org/TR/xquery-31/#id-switch">current matching rules</a> could be rephrased as follows:</p>
<ol>
<li>The SwitchCaseOperand is evaluated.</li>
<li>The resulting value is atomized.</li>
<li>The case matches if the value is empty and if the value of the switch expression is empty as well.</li>
<li>Otherwise, the atomized value of the switch operand expression is compared with each item of the atomized value of the SwitchCaseOperand using <code>fn:deep-equal</code>, with the default collation from the static context.</li>
</ol>
<h2>References</h2>
<ul>
<li>Original Proposal: https://github.com/expath/xpath-ng/pull/12</li>
<li>Discussion on Slack: https://xmlcom.slack.com/archives/C011NLXE4DU/p1675006336963479</li>
</ul>
</div></details></div>
<div class="toot" id="agenda-01-31"><h2>QT4 CG meeting 020 draft agenda<span class="toot-id"> #agenda-01-31</span></h2><div class="pubdate">30 Jan at 08:47:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-31">https://qt4cg.org/meeting/agenda/2023/01-31</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-327"><h2>Issue #327 created<span class="toot-id"> #created-327</span></h2><div class="pubdate">30 Jan at 08:42:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/327">https://github.com/qt4cg/qtspecs/issues/327</a></div><details><summary>Tokenisation</summary><div class="markup"><p>The rule in A.2</p>
<blockquote>
<p>When tokenizing, the longest possible match that is consistent with the EBNF is used.</p>
</blockquote>
<p>needs clarifying. It could be read as suggesting that if taking the longest match turns out to lead to a syntax error, the tokenisation should be re-attempted using a shorter match. I don't think that has ever been intended. So what exactly does the qualifier "that is consistent with the EBNF" actually mean?</p>
<p>Possibly related, A.2.2 Terminal Delimitation states:</p>
<blockquote>
<p>Terminal symbols that are not used exclusively in [/* ws: explicit */] productions are of two kinds: delimiting and non-delimiting.</p>
</blockquote>
<p>But (at least in the XQuery version) the list of delimiting tokens includes a number that are indeed used exclusively in ws:explicit productions, for example a number of tokens containing back-ticks, and <code>]]&gt;</code>.</p>
<p>I think we need to be clearer that tokens used in ws:explicit productions are recognised only when parsing the production that uses them. For example given the expression <code>A[B[C]]&gt;3</code>, we should not recognise <code>]]&gt;</code> as a token under the longest-token rule. I think that's probably what the "consistent with the EBNF" rule is intended to convey.</p>
</div></details></div>
<div class="toot" id="created-326"><h2>Pull request #326 created<span class="toot-id"> #created-326</span></h2><div class="pubdate">29 Jan at 22:45:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/326">https://github.com/qt4cg/qtspecs/pull/326</a></div><p>Issue 205: make support for higher-order functions mandatory</p></div>
<div class="toot" id="created-325"><h2>Issue #325 created<span class="toot-id"> #created-325</span></h2><div class="pubdate">29 Jan at 22:03:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/325">https://github.com/qt4cg/qtspecs/issues/325</a></div><details><summary>Operator precedence table needs updating</summary><div class="markup"><p>The <code>otherwise</code> and <code>-&gt;</code> operators (and maybe others) are missing from the non-normative precedence table in Appendix A.4.</p>
</div></details></div>
<div class="toot" id="created-324"><h2>Pull request #324 created<span class="toot-id"> #created-324</span></h2><div class="pubdate">29 Jan at 18:23:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/324">https://github.com/qt4cg/qtspecs/pull/324</a></div><details><summary>Proposed syntax and semantics for string templates</summary><div class="markup"><p>See issue #58.</p>
<p>I would recommend reviewing the XQuery version of the spec first, since it contains additional notes contrasting string templates and the existing string constructors. The section on string constructors has moved, but is unchanged except for the addition of this note.</p>
</div></details></div>
<div class="toot" id="created-323"><h2>Issue #323 created<span class="toot-id"> #created-323</span></h2><div class="pubdate">27 Jan at 21:56:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/323">https://github.com/qt4cg/qtspecs/issues/323</a></div><details><summary>add select attribute to xsl:text</summary><div class="markup"><p>Although xsl:text select="socks" would be the same as xsl:value-of select="socks" in implementation terms, users of XSLT 2 and later, even people who have been using XSLT 2 or 3 for some time, are often surprised to learn that xsl:value-of makes a text node, and that they need to use xsl:sequence to return something else.</p>
<p>So it'd be great to have them use xsl:text instead of xsl:value-of, where text nodes are wanted, because then introducing xsl:sequence is a small step.</p>
<p>Of course, beginners also often use value-of where they should be using apply-templates, e.g. to handle mixed content! But again, using xsl:text reduces that temptation.</p>
<p>We do have value templates now, <a href="xsl:text">xsl:text</a>{ .... }&lt;/xsl:text&gt;, which mitigates the need slightly, but i think only slightly, because the select= analogy is very compelling.</p>
</div></details></div>
<div class="toot" id="created-322"><h2>Issue #322 created<span class="toot-id"> #created-322</span></h2><div class="pubdate">26 Jan at 10:10:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/322">https://github.com/qt4cg/qtspecs/issues/322</a></div><details><summary>Map construction in XSLT: xsl:record instruction</summary><div class="markup"><p>Constructing maps in XSLT often involves code rather like this:</p>
<pre><code>            &lt;xsl:map&gt;
               &lt;xsl:map-entry key="'author'" select="string(AUTHOR)"/&gt;
               &lt;xsl:map-entry key="'title'" select="string(TITLE)"/&gt;
               &lt;xsl:map-entry key="'price'" select="xs:decimal(PRICE)"/&gt;
               &lt;xsl:map-entry key="'publisher'" select="string(../@name)"/&gt;
           &lt;/xsl:map&gt;
</code></pre>
<p>The alternative using XPath is also rather ugly:</p>
<pre><code>&lt;xsl:sequence select="map{'author': string(AUTHOR),
                                                 'title':string(TITLE), 
                                                 'price': xs:decimal(PRICE), 
                                                 'publisher':string(../@name)}"/&gt;
</code></pre>
<p>(the fact  that it is creating a map doesn't stand out; the <code>xsl:sequence</code> is a distraction because there's no sequence involved; and many users dislike long multi-line XPath expressions because of formatting problems in their editing tools)</p>
<p>I propose a new instruction xsl:record which allows:</p>
<pre><code>            &lt;xsl:record author="string(AUTHOR)"
                                title="string(TITLE)" 
                                price="xs:decimal(PRICE)" 
                                publisher="string(../@name)"/&gt;
</code></pre>
<p>This is rather like literal result elements in that the attributes are user-defined rather than system-defined. Unlike LREs, the values are general expressions rather than AVTs, because the values are not necessarily strings. The instruction can only be used where the keys (field names) take the form of NCNames.</p>
<p>If variable entries are required, or entries whose keys are not NCNames, they can appear as child instructions:</p>
<pre><code>            &lt;xsl:record author="string(AUTHOR)"
                                title="string(TITLE)" 
                                price="xs:decimal(PRICE)" 
                                publisher="string(../@name)"&gt;
              &lt;xsl:if test="@private"&gt;
                  &lt;xsl:map-entry name="'private entry'" select="true()"/&gt;
              &lt;/xsl:if&gt;
          &lt;/xsl:record&gt;
</code></pre>
<p>Follow the tradition of LREs, duplicates are resolved as "last one wins".</p>
<p>If "standard attributes" such as <code>[xsl:]version</code> are required, they must be in the XSLT namespace, as with LREs.</p>
</div></details></div>
<div class="toot" id="created-321"><h2>Issue #321 created<span class="toot-id"> #created-321</span></h2><div class="pubdate">26 Jan at 04:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/321">https://github.com/qt4cg/qtspecs/issues/321</a></div><details><summary>relax $input in fn:serialize</summary><div class="markup"><p>Relevant specifications:
https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-serialize</p>
<p>Would it be possible to relax the strictures on <code>$input</code> (first parameter) of <code>fn:serialize()</code>?</p>
<ol>
<li>The specifications do not explicitly forbid <code>map(*)</code> or <code>array(*)</code> as input, but in practice, when these are supplied, Saxon rejects them. Developers (or at least this one) who work with arrays and maps often need to render them in string output or messages, if only for diagnostics. If there is something really prohibitively wrong with those two items as input to <code>fn:serialize()</code>, then the specifications should say so.</li>
<li>Attributes are forbidden, but it is unclear why. They get serialized fine in the context of a parent, why not alone?</li>
<li>Namespace nodes are forbidden; see previous point.</li>
</ol>
<p>(No doubt there must have been discussion on points 2-3, but the rationale is not clear from the specs.)</p>
<p>Perhaps the question is that the details of what the serialization should look like is contestable. I think the answer there is simply, pick one. I think we'll happily live with whatever is chosen.</p>
<p>For the serialization of maps and arrays, I'll point as one possible model my <a href="https://github.com/textalign/TAN-2021/blob/9d2215e36da1f64bddad9daddfc5aa2242e17c81/functions/maps/TAN-fn-maps-extended.xsl#L58">tan:map-to-xml()</a> and <a href="https://github.com/textalign/TAN-2021/blob/9d2215e36da1f64bddad9daddfc5aa2242e17c81/functions/arrays/TAN-fn-arrays-extended.xsl#L66">tan:array-to-xml()</a>, which have been indispensable for daily troubleshooting.</p>
</div></details></div>
<div class="toot" id="created-320"><h2>Pull request #320 created<span class="toot-id"> #created-320</span></h2><div class="pubdate">25 Jan at 18:58:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/320">https://github.com/qt4cg/qtspecs/pull/320</a></div><details><summary>Issue 98 - add options parameter to fn:deep-equal</summary><div class="markup"><p>This proposal adds an options parameter to fn:deep-equal, giving much more detailed control over how the comparison is performed (while remaining backwards compatible by default).</p>
<p>This proposal is a first draft and I would request careful review, it's not one to pass through "on the nod".</p>
</div></details></div>
<div class="toot" id="created-319"><h2>Pull request #319 created<span class="toot-id"> #created-319</span></h2><div class="pubdate">25 Jan at 16:20:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/319">https://github.com/qt4cg/qtspecs/pull/319</a></div><details><summary>Issue 221: op:same-key becomes fn:atomic-equal</summary><div class="markup"><p>The proposal renames op:same-key as fn:atomic-equal, thus making it directly available to applications.</p>
</div></details></div>
<div class="toot" id="closed-294"><h2>Issue #294 closed<span class="toot-id"> #closed-294</span></h2><div class="pubdate">25 Jan at 14:56:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/294">https://github.com/qt4cg/qtspecs/issues/294</a></div><p>fn:remove removing multiple items</p></div>
<div class="toot" id="created-318"><h2>Issue #318 created<span class="toot-id"> #created-318</span></h2><div class="pubdate">25 Jan at 11:36:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/318">https://github.com/qt4cg/qtspecs/issues/318</a></div><details><summary>Serialization HTML/XHTML output methods: meta elements and the charset attribute</summary><div class="markup"><p>HTML5 introduces the ability to write</p>
<p><code>&lt;meta charset="utf-8"/&gt;</code></p>
<p>in place of</p>
<p><code>&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/&gt;</code></p>
<p>The serialization spec (for HTML and XHTML output methods) ignores this.</p>
<p>(a) it requires the serializer to add a <code>meta</code> element in the second form rather than the first.</p>
<p>(b) when removing existing <code>meta</code> elements, it requires the second form to be deleted, but not the first. This may result in invalid (X)HTML in which both elements are present.</p>
</div></details></div>
<div class="toot" id="closed-309"><h2>Issue #309 closed<span class="toot-id"> #closed-309</span></h2><div class="pubdate">24 Jan at 17:20:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/309">https://github.com/qt4cg/qtspecs/pull/309</a></div><p>Drop ternary conditionals, as agreed on 2023-01-17</p></div>
<div class="toot" id="closed-310"><h2>Issue #310 closed<span class="toot-id"> #closed-310</span></h2><div class="pubdate">24 Jan at 17:20:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/310">https://github.com/qt4cg/qtspecs/pull/310</a></div><p>Fix outstanding issues from PR 304</p></div>
<div class="toot" id="closed-312"><h2>Issue #312 closed<span class="toot-id"> #closed-312</span></h2><div class="pubdate">24 Jan at 17:20:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/312">https://github.com/qt4cg/qtspecs/pull/312</a></div><p>Minor editorial improvements</p></div>
<div class="toot" id="closed-313"><h2>Issue #313 closed<span class="toot-id"> #closed-313</span></h2><div class="pubdate">24 Jan at 17:19:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/313">https://github.com/qt4cg/qtspecs/pull/313</a></div><p>Issue 294: fn:remove()</p></div>
<div class="toot" id="created-317"><h2>Issue #317 created<span class="toot-id"> #created-317</span></h2><div class="pubdate">24 Jan at 17:16:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/317">https://github.com/qt4cg/qtspecs/issues/317</a></div><details><summary>fn:format-integer: $lang → $language ?</summary><div class="markup"><p>A minor inconsistency in the XQFO specification: The third parameter of <code>fn:format-integer</code> is named <code>$lang</code>…</p>
<p>https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-format-integer</p>
<p>…whereas all other language parameters are named <code>$language</code>.</p>
</div></details></div>
<div class="toot" id="minutes-01-24"><h2>QT4 CG meeting 019 draft minutes<span class="toot-id"> #minutes-01-24</span></h2><div class="pubdate">24 Jan at 17:11:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-24">https://qt4cg.org/meeting/minutes/2023/01-24</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-316"><h2>Issue #316 created<span class="toot-id"> #created-316</span></h2><div class="pubdate">23 Jan at 16:23:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/316">https://github.com/qt4cg/qtspecs/issues/316</a></div><details><summary>Function fn:differences</summary><div class="markup"><p>I didn't see any issues thread devoted <code>fn:differences()</code>, so am opening this one. Please respond with xrefs to anything relevant.</p>
<p>Draft here:
https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-differences</p>
<p>IMO, this function seems overly complicated for both users and implementors. The specs provide difficult reading. But it is the first function to try to address the desideratum for differencing. Something like it is needed methinks.</p>
<p>My suggestion would be to simplify the function as a straightforward string comparison, i.e., change the signature to something like <code>fn:differences($input1 as xs:string, $input2 as xs:string) as OUTPUT</code> where <code>OUTPUT</code> is either a tree structure (like the output of <code>fn:analyze-string()</code>) or a sequence of records (e.g., <code>(is-in-1 as xs:boolean, is-in-2 as xs:boolean, fragment as xs:string)</code>).</p>
<p>Such a change would make the function more tractable for both users and implementers. The user, would need to cast each sequence to a string, and in so doing will be able to (be compelled to) make fine-grained decisions on things such as normalization. Processor implementers have far simpler input, and they can choose the difference algorithm that makes best sense at the moment.</p>
<p>One counterargument might be that the resultant output would be difficult to correlate to the original sequences. Ostensibly, one wants to do things such as decide whether to drop certain items in sequence 1 or sequence 2. My response is that the current draft results in output that suffers from the same problem. Navigating the map to correlate it to the original sequence sounds daunting. With my suggestion, there are ways around this, through auxiliary functions or arity expansions that normalize the output.</p>
<p>But I don't want to get postprocessing output here, which would be tangential to the main question, i.e., how <code>fn:differences()</code> should be constructed in a way conducive to both users and implementers.</p>
</div></details></div>
<div class="toot" id="closed-311"><h2>Issue #311 closed<span class="toot-id"> #closed-311</span></h2><div class="pubdate">23 Jan at 11:46:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/311">https://github.com/qt4cg/qtspecs/pull/311</a></div><p>Stylesheet fix to mark optional fields in record definitions</p></div>
<div class="toot" id="closed-62"><h2>Issue #62 closed<span class="toot-id"> #closed-62</span></h2><div class="pubdate">21 Jan at 00:16:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/62">https://github.com/qt4cg/qtspecs/issues/62</a></div><p>[FO] The parameter types for fn:unique and array:partition are incorrectly specified.</p></div>
<div class="toot" id="closed-71"><h2>Issue #71 closed<span class="toot-id"> #closed-71</span></h2><div class="pubdate">21 Jan at 00:14:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/71">https://github.com/qt4cg/qtspecs/issues/71</a></div><p>[XSLT] Use of multiple predicates: order of evaluation</p></div>
<div class="toot" id="closed-171"><h2>Issue #171 closed<span class="toot-id"> #closed-171</span></h2><div class="pubdate">20 Jan at 23:44:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/171">https://github.com/qt4cg/qtspecs/issues/171</a></div><p>XPath ternary conditional operator</p></div>
<div class="toot" id="created-315"><h2>Issue #315 created<span class="toot-id"> #created-315</span></h2><div class="pubdate">18 Jan at 14:58:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/315">https://github.com/qt4cg/qtspecs/issues/315</a></div><details><summary>fn:transform inconsistency: initial-mode</summary><div class="markup"><p>The <code>fn:transform</code> specification in F+O says that if no initial-mode is supplied, the unnamed mode is used.</p>
<p>The XSLT 3.0 specification says that if no initial mode is supplied, then the default mode is used if one has been specified, or the unnamed mode is used if not.</p>
<p>I think the XSLT 3.0 spec should win here: it makes more sense if a default has been declared that it should actually be used.</p>
<p>(Thanks to Amanda Galtman for pointing this out.)</p>
</div></details></div>
<div class="toot" id="created-314"><h2>Issue #314 created<span class="toot-id"> #created-314</span></h2><div class="pubdate">18 Jan at 09:24:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/314">https://github.com/qt4cg/qtspecs/issues/314</a></div><details><summary>Basic Operations on Maps and Arrays</summary><div class="markup"><h1>Manipulating Arrays and Maps</h1>
<p>This is an outline of proposed new facilities designed to make processing of maps and arrays easier. The basic facilities needed for transformation of maps and arrays are the ability to decompose them into their parts, manipulate the parts, and the compose new arrays and maps from these parts.</p>
<p>Further background is in my 2022 Balisage paper, https://balisage.net/Proceedings/vol27/html/Kay01/BalisageVol27-Kay01.html</p>
<p>This proposal considers only the "shallow" operations on maps and arrays. Further proposals for deep search and update of nested structures are to be expected.</p>
<h2>Basics</h2>
<p>A map entry is an item used to represent a key-value pair in a map; it is an item of type <code>record(key as xs:anyAtomicType, value as item()*)</code>, aliased in this proposal as <code>type(map-entry)</code>.</p>
<p>Note: <em>an alternative representation for key-value pairs is as a singleton map, and that's the representation used by the existing map:entry() function and by the xsl:map-entry instruction. A representation as <code>record(key, value)</code> is rather more convenient to enable extraction of the key and value, but does create some compatibility issues...</em></p>
<p>An array entry is an item used to represent a member of an array; it is an item of type <code>record(value as item()*)</code>, aliased in this proposal as <code>type(array-entry)</code>.</p>
<h2>Decomposing Maps and Arrays</h2>
<p>The function <code>map:entries($map)</code> returns a sequence of map entries, in unpredictable order, representing the contents of the supplied map. It is equivalent to <code>map:for-each($map, -&gt;($k, $v){map:entry($k, $v)})</code>.</p>
<p>The function <code>array:entries($array)</code> returns a sequence of array entries, in array order, representing the members of the supplied array. It is equivalent to <code>array:for-each($array, -&gt;($v){array:entry($v)})</code>.</p>
<h2>Constructing Maps and Arrays</h2>
<p>The function <code>map:of($entries as type(map-entry)*) as map(*)</code> constructs a map from a sequence of map entries. A second parameter, <code>$options</code>, is available to control handling of duplicates, as with <code>map:merge()</code>. The function is equivalent to <code>map:merge($entries!map{'key':?key, 'value':?value})</code>.</p>
<p>The function <code>array:of($entries as type(array-entry)*) as array(*)</code> constructs an array from a sequence of array entries. It is equivalent to <code>array:fold-left($entries, [], array:append#2)</code>.</p>
<p>The function <code>map:entry($key, $value) as type(map-entry)</code> is equivalent to <code>map{'key':$key, 'value':$value}</code>. <em>Problem: we already have a function map:entry() in 3.1 that does something different. Need to change the terminology...</em></p>
<p>The function <code>array:entry($value) as type(array-entry)</code> is equivalent to <code>map{'value':$value}</code>.</p>
<h2>Filtering Maps and Arrays</h2>
<p>The construct <code>$map?[PREDICATE]</code> is equivalent to <code>map:of(map:entries($map)[PREDICATE])</code>. For example, given a map in which the keys are dates, <code>$map?[year-from-date(?key)=2023]</code> returns a map containing those entries in which the key is a date in 2023.</p>
<p>The construct <code>$array?[PREDICATE]</code> is equivalent to <code>array:of(array:entries($array)[PREDICATE])</code>. For example, <code>$array?[1]</code> selects the first item in the array (as a single-member array), while <code>$array?[exists(?value)]</code> returns an array containing all those entries in the input array that are not empty. If <code>$array</code> is an array of maps, then <code>$array?[?value?name='John']</code> selects those members of the array that are maps having <code>?name='John'</code>.</p>
<h2>Mapping Maps and Arrays</h2>
<p>The construct <code>$map!!EXPR</code> evaluates <code>EXPR</code> once for each entry in <code>$map</code> and returns the result as a flattened sequence. For example <code>map:of($map!!map:entry(?key, ?value+1))</code> returns a map in which each value has been incremented by one.</p>
<p>The construct <code>$array!!EXPR</code> evaluates <code>EXPR</code> once for each entry in <code>$array</code>, and returns the result as a flattened sequence. For example, <code>array:of($array!!array:entry(?value+1))</code> returns an array in which every value has been incremented by one.</p>
<h2>FLWOR Expressions</h2>
<p>The for-member clause <code>for member $m in $array</code> is equivalent to <code>for $sys:var in array:entries($array) let $m := $sys:var?value</code>.</p>
<p>The for-entry clause <code>for entry ($k, $v) in $map</code> is equivalent to <code>for $sys:var in map:entries($map) let $k := $sys:var?key, $v := $sys:var?value</code>.</p>
<h2>XSLT</h2>
<p>Iteration over maps and arrays is achieved using <code>&lt;xsl:for-each select="array:entries()"&gt;</code> and <code>&lt;xsl:for-each select="map:entries()"&gt;</code> directly.</p>
<p>Construction of maps uses the existing instructions <code>&lt;xsl:map&gt;</code> and <code>&lt;xsl:map-entry&gt;</code>. There is an inconvenience here in that the <code>&lt;xsl:map-entry&gt;</code> instruction returns a singleton map (<code>map{key:value}</code>) rather than a map entry as defined in this proposal (<code>map{'key':key, 'value':value}</code>)..</p>
<p>Construction of arrays uses the new instructions <code>&lt;xsl:array&gt;</code> and <code>&lt;xsl:array-entry&gt;</code>. The <code>xsl:array-entry</code> instruction is defined to construct an array entry as defined in this proposal.</p>
<h2>Use Cases</h2>
<p>To be supplied.</p>
</div></details></div>
<div class="toot" id="created-313"><h2>Pull request #313 created<span class="toot-id"> #created-313</span></h2><div class="pubdate">17 Jan at 22:53:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/313">https://github.com/qt4cg/qtspecs/pull/313</a></div><details><summary>Issue 294: fn:remove()</summary><div class="markup"><p>Allow remove() to remove several items, aligning it with array:remove() and map:remove()</p>
</div></details></div>
<div class="toot" id="created-312"><h2>Pull request #312 created<span class="toot-id"> #created-312</span></h2><div class="pubdate">17 Jan at 22:25:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/312">https://github.com/qt4cg/qtspecs/pull/312</a></div><details><summary>Minor editorial improvements</summary><div class="markup"><ul>
<li>Issue 300 (clarification about results being normalized)</li>
<li>Action QT4CG-018-02 (explaining signature notation)</li>
<li>Action QT4CG-018-04 (explaining numeric predicates on ancestor unions)</li>
</ul>
</div></details></div>
<div class="toot" id="created-311"><h2>Pull request #311 created<span class="toot-id"> #created-311</span></h2><div class="pubdate">17 Jan at 21:39:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/311">https://github.com/qt4cg/qtspecs/pull/311</a></div><p>Stylesheet fix to mark optional fields in record definitions</p></div>
<div class="toot" id="created-310"><h2>Pull request #310 created<span class="toot-id"> #created-310</span></h2><div class="pubdate">17 Jan at 21:27:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/310">https://github.com/qt4cg/qtspecs/pull/310</a></div><details><summary>Fix outstanding issues from PR 304</summary><div class="markup"><p>See https://github.com/qt4cg/qtsp…ecs/pull/304#issuecomment-1378532583 - but excluding item 3 because that's a stylesheet change.</p>
</div></details></div>
<div class="toot" id="created-309"><h2>Pull request #309 created<span class="toot-id"> #created-309</span></h2><div class="pubdate">17 Jan at 19:20:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/309">https://github.com/qt4cg/qtspecs/pull/309</a></div><details><summary>Drop ternary conditionals, as agreed on 2023-01-17</summary><div class="markup"><p>We agreed today to drop ternary conditional expressions from the proposal; this PR implements that change.</p>
</div></details></div>
<div class="toot" id="minutes-01-17"><h2>QT4 CG meeting 018 draft minutes<span class="toot-id"> #minutes-01-17</span></h2><div class="pubdate">17 Jan at 16:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-17">https://qt4cg.org/meeting/minutes/2023/01-17</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-286"><h2>Issue #286 closed<span class="toot-id"> #closed-286</span></h2><div class="pubdate">17 Jan at 17:14:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/286">https://github.com/qt4cg/qtspecs/pull/286</a></div><p>Spec changes to allow child::(a|b|c) - Issue 107</p></div>
<div class="toot" id="closed-290"><h2>Issue #290 closed<span class="toot-id"> #closed-290</span></h2><div class="pubdate">17 Jan at 17:14:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/290">https://github.com/qt4cg/qtspecs/pull/290</a></div><p>Fix issue #18 (function type hierarchy)</p></div>
<div class="toot" id="closed-35"><h2>Issue #35 closed<span class="toot-id"> #closed-35</span></h2><div class="pubdate">17 Jan at 17:13:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/35">https://github.com/qt4cg/qtspecs/issues/35</a></div><p>[FO]The `union ( | )`, `itersect`, `except`  and `combine (,)` operators are not mentioned in the F &amp; O. Have not the best categorization in the XPath spec.</p></div>
<div class="toot" id="closed-288"><h2>Issue #288 closed<span class="toot-id"> #closed-288</span></h2><div class="pubdate">17 Jan at 17:13:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/288">https://github.com/qt4cg/qtspecs/issues/288</a></div><p>Error in fn:path specification</p></div>
<div class="toot" id="closed-257"><h2>Issue #257 closed<span class="toot-id"> #closed-257</span></h2><div class="pubdate">17 Jan at 17:13:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/257">https://github.com/qt4cg/qtspecs/issues/257</a></div><p>Improving the styling/presentation/prepresentation of the record types in the F&amp;O spec</p></div>
<div class="toot" id="closed-70"><h2>Issue #70 closed<span class="toot-id"> #closed-70</span></h2><div class="pubdate">17 Jan at 17:13:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/70">https://github.com/qt4cg/qtspecs/issues/70</a></div><p>[FO] Built-in function changes to support default values</p></div>
<div class="toot" id="closed-291"><h2>Issue #291 closed<span class="toot-id"> #closed-291</span></h2><div class="pubdate">17 Jan at 17:13:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/291">https://github.com/qt4cg/qtspecs/issues/291</a></div><p>DTD validity of F&amp;O spec</p></div>
<div class="toot" id="closed-304"><h2>Issue #304 closed<span class="toot-id"> #closed-304</span></h2><div class="pubdate">17 Jan at 17:13:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/304">https://github.com/qt4cg/qtspecs/pull/304</a></div><p>Mike's content changes from PR 292</p></div>
<div class="toot" id="closed-284"><h2>Issue #284 closed<span class="toot-id"> #closed-284</span></h2><div class="pubdate">17 Jan at 17:12:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/284">https://github.com/qt4cg/qtspecs/pull/284</a></div><p>Add grammar for "if (test) then {expr}" with no else</p></div>
<div class="toot" id="created-308"><h2>Pull request #308 created<span class="toot-id"> #created-308</span></h2><div class="pubdate">15 Jan at 17:05:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/308">https://github.com/qt4cg/qtspecs/pull/308</a></div><details><summary>Improve the legends in the diagrams</summary><div class="markup"><p>This PR completes my action QT4CG-015-03: NW to make sure the direction of the arrow is in the legends</p>
<p>I also made sure the legends aren't too wide. I still have more work to do for the other actions.</p>
</div></details></div>
<div class="toot" id="closed-259"><h2>Issue #259 closed<span class="toot-id"> #closed-259</span></h2><div class="pubdate">15 Jan at 16:46:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/259">https://github.com/qt4cg/qtspecs/pull/259</a></div><p>Issue #74 - add the fn:parse-html function</p></div>
<div class="toot" id="agenda-01-17"><h2>QT4 CG meeting 018 draft agenda<span class="toot-id"> #agenda-01-17</span></h2><div class="pubdate">15 Jan at 15:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-17">https://qt4cg.org/meeting/agenda/2023/01-17</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-306"><h2>Issue #306 closed<span class="toot-id"> #closed-306</span></h2><div class="pubdate">15 Jan at 16:17:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/306">https://github.com/qt4cg/qtspecs/pull/306</a></div><p>fn:char - editors actions from 2023-01-10</p></div>
<div class="toot" id="created-307"><h2>Issue #307 created<span class="toot-id"> #created-307</span></h2><div class="pubdate">15 Jan at 15:42:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/307">https://github.com/qt4cg/qtspecs/issues/307</a></div><details><summary>Parsing and building URIs comments and queries</summary><div class="markup"><ol>
<li>fn:build-uri states:</li>
</ol>
<blockquote>
<p>If the scheme key is present in the map, the URI begins with the value of that key concatenated with //, otherwise it begins //.</p>
</blockquote>
<p>a. Shouldn't the concatenation be <code>://</code> so e.g. <code>http</code> becomes <code>http://</code>?
b. How are non-heirarchical schemes handled like <code>urn</code>, and <code>mailto</code>?</p>
<ol start="2">
<li>RFC 3986 allows IPv6 and IPvFuture addresses that contain <code>:</code> characters, e.g. <code>http://[::1]:80</code>.</li>
</ol>
<p>My understanding of fn:parse-uri is that this will fail to parse.</p>
<ol start="3">
<li>RFC 3986 states that for userinfo, the <code>user:password</code> form is deprecated.</li>
</ol>
<p>Browsers will reject this due to the security risk, and the RFC suggests that applications should not render the password (the part after the <code>:</code>) in clear text. -- Should fn:build-uri follow suite, or (along with fn:parse-uri) have an option to control the behaviour (keep, remove, invalid), where if the option is invalid, it will throw an fn:error?</p>
<ol start="4">
<li>RFC 3986 suggests that the port should be omitted if it matches the default for the scheme</li>
</ol>
<p>Should fn:build-uri have this behaviour?</p>
</div></details></div>
<div class="toot" id="created-306"><h2>Pull request #306 created<span class="toot-id"> #created-306</span></h2><div class="pubdate">10 Jan at 21:23:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/306">https://github.com/qt4cg/qtspecs/pull/306</a></div><details><summary>fn:char - editors actions from 2023-01-10</summary><div class="markup"><p>Changes to the new fn:char function (issue #121) as follows:</p>
<ul>
<li>Action QT4CG-017-01 clarifies the definition of formats #nnn and #xnnn.</li>
<li>Action QT4CG-017-02 changes the order of the rules</li>
<li>In discussion it was asked whether any HTML5 entity names refer to strings comprising more than one character. On investigation it appears that they do, and the spec has been revised to allow for this.</li>
<li>added history/status information</li>
</ul>
</div></details></div>
<div class="toot" id="closed-121"><h2>Issue #121 closed<span class="toot-id"> #closed-121</span></h2><div class="pubdate">10 Jan at 17:20:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/121">https://github.com/qt4cg/qtspecs/issues/121</a></div><p>[FO] fn:nl, fn:tab, fn:cr</p></div>
<div class="toot" id="minutes-01-10"><h2>QT4 CG meeting 017 draft minutes<span class="toot-id"> #minutes-01-10</span></h2><div class="pubdate">10 Jan at 16:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-10">https://qt4cg.org/meeting/minutes/2023/01-10</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-261"><h2>Issue #261 closed<span class="toot-id"> #closed-261</span></h2><div class="pubdate">10 Jan at 17:19:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/261">https://github.com/qt4cg/qtspecs/pull/261</a></div><p>Proposed fn:char function - see issue 121</p></div>
<div class="toot" id="created-305"><h2>Issue #305 created<span class="toot-id"> #created-305</span></h2><div class="pubdate">09 Jan at 17:50:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/305">https://github.com/qt4cg/qtspecs/issues/305</a></div><details><summary>parse-xml() and whitespace stripping</summary><div class="markup"><p>There seems to be nothing in either the XSLT spec or in F+O that says explicitly whether stylesheet-defined space stripping rules (xsl:strip-space and xsl:preserve-space) apply to documents loaded using <code>fn:parse-xml</code> (or, by extension, <code>parse-html</code>).</p>
<p>The spec says that these rules apply to "source trees" defined as "any tree provided as input to the transformation. This includes the document containing the [global context item] if any, documents containing nodes present in the [initial match selection], documents containing nodes supplied as the values of [stylesheet parameters], documents obtained from the results of functions such as [document], [doc], and [collection]...".</p>
<p>I guess one reasonable interpretation is that the "such as" includes <code>parse-xml()</code>. But it goes rather against the grain that the behaviour of parse-xml() should be affected by the containing stylesheet declarations, when there is no mention of such a context-dependency in the function specification; in this, parse-xml() is rather different from doc() which deliberately says very little about how the XDM instance returned relates to the URI supplied as input.</p>
</div></details></div>
<div class="toot" id="closed-292"><h2>Issue #292 closed<span class="toot-id"> #closed-292</span></h2><div class="pubdate">09 Jan at 09:43:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/292">https://github.com/qt4cg/qtspecs/pull/292</a></div><p>Merge signatures with optional params</p></div>
<div class="toot" id="created-304"><h2>Pull request #304 created<span class="toot-id"> #created-304</span></h2><div class="pubdate">09 Jan at 09:32:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/304">https://github.com/qt4cg/qtspecs/pull/304</a></div><details><summary>Mike's content changes from PR 292</summary><div class="markup"><p>I teased apart some of the omnibus PR #292. I've commited the schema and stylesheet changes. This PR covers the remaining prose changes.</p>
<p>Mike writes:</p>
<blockquote>
<p>I regret that this has turned into a bit of an omnibus PR. The main changes are:</p>
<ul>
<li>Fix validity issues with the function catalog and its schema (Issue 291)</li>
<li>Convert all functions to use a single signature with optional parameters (Issue 70)</li>
<li>Extend the function catalog to handle record definitions (Issue 257)</li>
<li>Fix the (trivial) bug with properties of fn:path (Issue 288)</li>
<li>Add introductory text concerning the handling of operators (Issue 35)</li>
</ul>
</blockquote>
<p>Fix #291
Fix #70
Fix #257
Fix #288
Fix #35</p>
</div></details></div>
<div class="toot" id="closed-303"><h2>Issue #303 closed<span class="toot-id"> #closed-303</span></h2><div class="pubdate">09 Jan at 07:38:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/303">https://github.com/qt4cg/qtspecs/pull/303</a></div><p>Mike's proposed schema and stylesheet changes</p></div>
<div class="toot" id="created-303"><h2>Pull request #303 created<span class="toot-id"> #created-303</span></h2><div class="pubdate">09 Jan at 07:32:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/303">https://github.com/qt4cg/qtspecs/pull/303</a></div><details><summary>Mike's proposed schema and stylesheet changes</summary><div class="markup"><p>These are the schema and stylesheet changes from PR #292. They don't break the build and on casual inspection they seem fine, so I'm just going to accept them.</p>
</div></details></div>
<div class="toot" id="agenda-01-10"><h2>QT4 CG meeting 017 draft agenda<span class="toot-id"> #agenda-01-10</span></h2><div class="pubdate">06 Jan at 16:02:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-10">https://qt4cg.org/meeting/agenda/2023/01-10</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-300"><h2>Issue #300 created<span class="toot-id"> #created-300</span></h2><div class="pubdate">06 Jan at 16:19:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/300">https://github.com/qt4cg/qtspecs/issues/300</a></div><details><summary>[F+O] Ambiguity regarding Unicode normalization (editorial)</summary><div class="markup"><p>In §1.7.1 the paragraph</p>
<blockquote>
<p>Unless explicitly stated, the xs:string values returned by the
functions in this document are not normalized in the sense of
[Character Model for the World Wide Web 1.0: Fundamentals].</p>
</blockquote>
<p>is a little bit ambiguous for my taste. By "are not normalized" it means "no action is taken to normalize the strings", it doesn't mean "the strings will not be in normalized form".</p>
<p>I suggest: "Unless explicitly stated, the functions in this document operate on strings as sequences of codepoints and do not attempt to convert input strings, or produce output strings, in Unicode normalized form. Unicode normalization occurs only when explicitly requested, for example by use of the <code>fn:normalize-unicode</code> function."</p>
<p>At the same time we might update the reference to point to "Character Model for the World Wide Web: String Matching", revised in 2021, though it is still only a Working Group Note. See https://www.w3.org/TR/charmod-norm/#unicodeNormalization</p>
</div></details></div>
<div class="toot" id="closed-281"><h2>Issue #281 closed<span class="toot-id"> #closed-281</span></h2><div class="pubdate">02 Jan at 18:12:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/281">https://github.com/qt4cg/qtspecs/issues/281</a></div><p>XPath: Short-circuiting Functions and Lazy Evaluation Hints</p></div>
<div class="toot" id="created-299"><h2>Issue #299 created<span class="toot-id"> #created-299</span></h2><div class="pubdate">02 Jan at 18:08:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/299">https://github.com/qt4cg/qtspecs/issues/299</a></div><details><summary>Short-circuiting functions, function-arity guards and lazy hints</summary><div class="markup"><h1><strong>I. Shortcutting and lazy hints</strong></h1>
<p>Let us have this expression:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*) as function(item()*) as item()*
             {  (: Some code here :) }
  return
    $f($x) ($y)
</code></pre>
<p>Evaluating&nbsp;<strong><code>$f($x)</code></strong>&nbsp;produces a function. The&nbsp;<strong>actual arity</strong>&nbsp;of this resulting function can be any number&nbsp;<strong><code>N &gt;= 0</code></strong> :</p>
<ul>
<li>
<p>If&nbsp;<strong><code>N &gt; 1</code></strong>&nbsp;there would be arity mismatch error, as only one argument&nbsp;<code>$y</code>&nbsp;is provided in the expression.</p>
</li>
<li>
<p>If&nbsp;<strong><code>N = 1</code></strong>&nbsp;the final function call can be evaluated, and the argument&nbsp;<code>$y</code>   must be evaluated,  or</p>
</li>
<li>
<p><strong>If <code>N = 0</code>, then  <code>$y</code> is unneeded and can safely be ignored</strong> according to the updated <strong>“<a href="https://qt4cg.org/pr/279/xquery-40/xpath-40.html#id-coercion-rules">Coercion Rules / Function Coercion</a>”</strong> in Xpath 4.0.</p>
</li>
</ul>
<p><strong>Because a possibility exists to be able to ignore the evaluation of&nbsp;<code>$y</code>, it is logical to delay the evaluation of&nbsp;<code>$y</code>&nbsp;until the actual arity of&nbsp;<code>$f($x)</code>&nbsp;is known</strong>.</p>
<p>The current XPath 4.0 evaluation rules do not require an implementation to base its decision whether or not to evaluate&nbsp;<code>$y</code> on the actual arity of the function produced by <code>$f($x)</code>, thus at present an implementation could decide to evaluate <code>$y</code> regardless of the actual arity of the function produced by <code>$f($x)</code>.</p>
<p><strong>This is where a&nbsp;<em>lazy</em>&nbsp;hint comes</strong>: it indicates to the XPath processor that <em><strong>it is logical to make the decision about evaluation of&nbsp;<code>$y</code>&nbsp;based on the actual arity of the function returned by&nbsp;<code>$f($x)</code></strong></em>.</p>
<p>A rewrite of the above expression using a <strong><em><em>lazy</em></em></strong>&nbsp;hint looks like this:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*) as function(item()*) as item()*
             {  (: Some code here :) }  
  return
    $f($x) (lazy $y)
</code></pre>
<p>Here is one example of a function with short-cutting and calling it with a <strong><em>lazy</em></strong> hint:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
             {
                let $partial := function($x as xs:boolean) as function(xs:boolean) as  xs:boolean
                                {
                                  if(not($x)) then -&gt;(){false()}
                                              else -&gt;($t) {$t}
                                }
                 return $partial($x)($y)
             }
  return
     $fAnd($x (: possibly false() :), lazy&nbsp;$SomeVeryComplexAndSlowComputedExpression)
</code></pre>
<p><strong>Without the <strong><em>lazy</em></strong>&nbsp;hint in the above example, it is perfectly possible that an XPath implementation, unrestricted by the current rules, would evaluate <em><code>$SomeVeryComplexAndSlowComputedExpression</code></em> - something that is unneeded and could be avoided completely</strong>.</p>
<h2>Formal syntax and semantics</h2>
<ol>
<li>
<p>The <strong><em>lazy</em></strong> keyword should immediately precede any argument in a function call. If specified, it means that <strong><em>it is logical to make the decision about evaluation of this argument based on the actual arity of the function in this function call</em></strong>.</p>
<p>Based on this definition, it follows that <strong><em><code>lazy $argK</code></em></strong> implies <strong><em>lazy</em></strong> for all arguments following <code>$argK</code> in the function call. Thus specifying more than one <strong><em>lazy</em></strong> hint within a given function call is redundant and an implementation may report this redundancy to the user.</p>
<p>The scope of a <strong><em>lazy</em></strong> keyword specified on an argument is this and all following arguments of (only) the current function call.</p>
</li>
<li>
<p>It is possible to specify a <strong><em>lazy</em></strong> keyword that is in force for the respective argument(s) of all function calls of the given function. To do this, the <strong><em>lazy</em></strong> keyword must  be  specified immediately preceding a parameter name in the function definition of that function.</p>
<p>For example, if the function <strong><code>$f</code></strong> is specified as:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, lazy $arg2 as item()*, $arg3 as item()*, $arg4 as item()* ) 
          { (: some code here:) }
  return
     $someExpression
</code></pre>
<p>Then any call of <strong><code>$f</code></strong> in its definition scope that has the form:</p>
<pre><code class="language-xq">$f($x, $y, $z, $t)
</code></pre>
<p>is equivalent to:</p>
<pre><code class="language-xq">$f($x, lazy $y, $z, $t)
</code></pre>
</li>
<li>
<p>It is possible to specify the <strong><em>lazy</em></strong> keyword immediately preceding a function definition. This instructs the XPath processor that any call of this function is only necessary to be evaluated if the function is actually called during the evaluation of the expression that contains this function call.</p>
<p>For example:</p>
<pre><code class="language-xq">let $complexComputation := lazy function($x, $y) {$x + $y}, (: Make it as complex as you want ... :)
     $someCondition := function()
        {
            let $date := current-date()
              return
                  month-from-date($date) eq 2
                and 
                 day-from-date($date) eq 29 
       }
  return if($someCondition()) 
           then $complexComputation(2, 3)
           else 0
</code></pre>
<p>Specifying the <strong><em>lazy</em></strong> keyword in the function definition for <code>$complexComputation</code> can save significant computing resources, because the programmer knows that <code>$someCondition()</code> is true during only a single day in any 4-years period.</p>
</li>
</ol>
<h1><strong>II.fn:lazy</strong></h1>
<h2>Summary</h2>
<p>Applied on a single argument that can be any <em>expression</em>. Lazily returns its argument <em>expression</em>.</p>
<h2>Signature</h2>
<pre><code class="language-xq">lazy fn:lazy( 
        $expression as item()*
) as item()*
</code></pre>
<h2>Properties</h2>
<p>This function is <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-deterministic">deterministic</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-context-independent">context-independent</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-focus-independent">focus-independent</a></em></strong></p>
<h2>Rules</h2>
<p>The semantics of the function is strictly defined below:</p>
<pre><code class="language-xq">let $lazyFunction := lazy fn:identity#1
   return
      (: AnyExpression here :)
</code></pre>
<p>Any expression <strong><code>Q</code></strong> of the form:</p>
<p><strong><em><code>Q(E1, lazy(E2))</code></em></strong></p>
<p>where <strong><code>E1</code></strong> and <strong><code>E2</code></strong> are subexpressions of <strong><code>Q</code></strong>, must be evaluated by the Processor in two steps:</p>
<ol>
<li>
<p>Substitute the expression</p>
<p><strong><em><code>Q(E1, lazy(E2))</code></em></strong></p>
<p>with:</p>
<p><strong><em><code>Q(E1, ?) (lazy E2)</code></em></strong></p>
</li>
<li>
<p>Evaluate the latter according to the rules for a <strong><em>lazy</em></strong> argument</p>
</li>
</ol>
<h2>Example</h2>
<p>We can use almost the same example as above, but here <code>$complexComputation</code> is defined without the <strong><em>lazy</em></strong> keyword and thus is not a <strong><em>lazy</em></strong> function. To have <code>$complexComputation</code> evaluated lazily, we call the <code>lazy()</code> function, passing <code>$complexComputation</code>  to it:</p>
<pre><code class="language-xq">let $complexComputation := (: no lazy here :) function($x, $y) {$x + $y}, (: Make it as complex as you want ... :)
     $someCondition := function()
        {
            let $date := current-date()
              return
                  month-from-date($date) eq 2
                and 
                 day-from-date($date) eq 29 
       }
  return 
        $someCondition() and lazy( $complexComputation(2, 3))
</code></pre>
<p>Here the expression <strong><code>Q</code></strong> is:</p>
<p><strong><em><code>$someCondition() and lazy( $complexComputation(2, 3))</code></em></strong></p>
<p>This  is the same as:</p>
<p><strong><em><code>fn:op("and")($someCondition(), lazy( $complexComputation(2, 3))</code></em></strong></p>
<p>According to the Rules above, the processor converts this to:</p>
<p><strong><em><code>fn:op("and")($someCondition(), ?) (lazy( $complexComputation(2, 3)) )</code></em></strong></p>
<p><code>$someCondition()</code> is evaluated and if its value is <code>false()</code>,   then the expression to be evaluated is:</p>
<p><strong><em><code>fn:op("and")(false(), ?) (lazy( $complexComputation(2, 3)) )</code></em></strong></p>
<p>As <strong><em><code>fn:op("and")(false(), ?)</code></em></strong> by definition is <strong><em><code>function() {false()}</code></em></strong>. then the final result <strong><code>false()</code></strong> is produced and the unnecessary argument <strong><em><code>$complexComputation(2, 3)</code></em></strong> is not evaluated at all.</p>
<h1><strong>III. A function's arity is a guard for its arguments</strong></h1>
<p>Let us have a  function <strong><code>$f</code></strong> defined as below:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*, …, $argN as item()*)
   as function(item()*, item()*, …, item()*) as item()*
     {
       if($cond0($arg1))       then -&gt; () { 123 }
        else if($cond1($arg1)) then -&gt; ($Z1 as item()*) {$Z1}
        else if($cond2($arg1)) then -&gt; ($Z1 as item()*, $Z2 as item()*) {$Z1 + $Z2}
        (:    .        .        .        .         .        .        .         .  :)
        else if($condK($arg1)) then -&gt; ($Z1 as item()*, $Z2 as item()*, …, $Zk as item()*)
                                       {$Z1 + $Z2 + … + $Zk}
        else ()
     }
  return
     $f($y1, $y2, …, $yN) ($z1, $z2, …, $zk)
</code></pre>
<p>A call to <strong><code>$f</code></strong> returns a function whose arity may be any of the numbers: 0, 1, …, K.</p>
<p>Depending on the arity of the returned function (0, 1, …, K), the last (K, K-1,  K-2, …, 2, 1, 0) arguments of the function call:</p>
<p><strong><em><code>$f($y1, $y2,  .  .  . , $yN) ($z1, $z2, .  .  . , $zk)</code></em></strong></p>
<p><strong>are unneeded and it is logical that they would not need to be evaluated</strong>.</p>
<p><strong>So, the actual arity of the result of calling <strong><code>$f</code></strong> is a guard for the arguments of a call to this function-result</strong>.</p>
<p>Thus, one more bullet needs to be added to [2.4.5 Guarded Expressions] https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-guarded-expressions), specifying an additional guard-type:</p>
<ul>
<li>In an expression of the type <code>E(A1, A2, ..., AN)</code> any of the arguments <code>A</code><sub>K</sub> is guarded by the condition
<code>actual-arity(E) ge K</code>. This rule has the consequence that if the actual arity of <code>E()</code> is less than <code>K</code> then if any argument <code>Am</code> (where <code>m &gt;= K</code>) is evaluated, this must not raise a dynamic error. An implementation may base on the actual arity of <code>E()</code> its decision for the evaluation of the arguments.</li>
</ul>
</div></details></div>
<div class="toot" id="created-298"><h2>Issue #298 created<span class="toot-id"> #created-298</span></h2><div class="pubdate">02 Jan at 15:36:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/298">https://github.com/qt4cg/qtspecs/issues/298</a></div><details><summary>Abstract supertype for map and array</summary><div class="markup"><p>I've been wondering whether there would be any mileage in introducing an abstract super type for map() and array(), perhaps called lookup(). This would basically treat an array as a map with integer keys.</p>
<p>This would allow a cleaner type signature for map:find() and any future functions such as xx:search() that work both on maps and arrays. It might simplify the description of the lookup operator "?". For functions that already exist in both the map and array namespaces, such as get(), we could introduce a unified function in the fn namespace with the cosmetic benefit of reducing the need for namespace prefixes and namespace declarations.</p>
<p>I'm still keen to find a better way of doing iteration, filtering, mapping, and construction of maps and arrays, and I think this might be a useful stepping stone.</p>
</div></details></div></div></article></main></body></html>