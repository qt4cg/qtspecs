<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses in 2024</title></head><body><main><article><h1>@qt4cg statuses in 2024</h1><p>This page displays status
              updates
              about the QT4 CG project from 2024.</p><p>See also <a href="../">recent statuses</a>.</p><div class="toots">
<div class="toot" id="created-1458"><h2>Issue #1458 created<span class="toot-id"> #created-1458</span></h2><div class="pubdate">19 Sep at 08:04:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1458">https://github.com/qt4cg/qtspecs/issues/1458</a></div><details><summary>Arguments that have a default value but don't accept ()</summary><div class="markup"><p>The following functions define an argument that has a default value, but don't allow () to be supplied explicitly:</p>
<pre><code>lang
id
element-with-id
idref
parse-html
</code></pre>
<p>As determined by running the following query against the function catalog:</p>
<p><code>//*:arg[@default and not(ends-with(@type,'?') or ends-with(@type, '*'))]/(ancestor::*:function/(@prefix||':'||@name))</code></p>
<p>There are others which this query doesn't pick up, mainly where the defaultable argument is a function, including:</p>
<p>array:build
map:build
array:get
map:get
fn:highest
fn:lowest</p>
</div></details></div>
<div class="toot" id="closed-1224"><h2>Issue #1224 closed<span class="toot-id"> #closed-1224</span></h2><div class="pubdate">18 Sep at 21:57:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1224">https://github.com/qt4cg/qtspecs/issues/1224</a></div><p>Attribute priority for xsl:accumulator-rule</p></div>
<div class="toot" id="closed-409"><h2>Issue #409 closed<span class="toot-id"> #closed-409</span></h2><div class="pubdate">18 Sep at 21:49:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/409">https://github.com/qt4cg/qtspecs/issues/409</a></div><p>XSLT: xsl:next-match and xsl:apply-imports interaction with on-multiple-match</p></div>
<div class="toot" id="closed-296"><h2>Issue #296 closed<span class="toot-id"> #closed-296</span></h2><div class="pubdate">18 Sep at 21:34:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/296">https://github.com/qt4cg/qtspecs/issues/296</a></div><p>Default namespace for elements; especially in the context of HTML</p></div>
<div class="toot" id="created-1457"><h2>Issue #1457 created<span class="toot-id"> #created-1457</span></h2><div class="pubdate">18 Sep at 12:36:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1457">https://github.com/qt4cg/qtspecs/issues/1457</a></div><details><summary>Common name for maps &amp; arrays</summary><div class="markup"><p>Past thoughts:</p>
<ul>
<li>https://github.com/qt4cg/qtspecs/issues/826#issuecomment-1821359131</li>
<li>https://github.com/qt4cg/qtspecs/issues/1456#issuecomment-2358257374 ff.</li>
</ul>
<p>Copied from Michael:</p>
<blockquote>
<p>It would be great if we could agree on a collective term for "maps and arrays". "Structured item" feels too generic to me. I've toyed with terms like "tabulation", "tabula", "composition", "dataset", "compendium", "aggregate".
Perhaps "combo"? It's best to have a word that stands out from the crowd if we can't find one whose meaning is self-explanatory.</p>
</blockquote>
</div></details></div>
<div class="toot" id="closed-1381"><h2>Issue #1381 closed<span class="toot-id"> #closed-1381</span></h2><div class="pubdate">18 Sep at 11:56:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1381">https://github.com/qt4cg/qtspecs/issues/1381</a></div><p>fn:parse-uri: Observations (cont.)</p></div>
<div class="toot" id="closed-1387"><h2>Issue #1387 closed<span class="toot-id"> #closed-1387</span></h2><div class="pubdate">18 Sep at 11:56:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1387">https://github.com/qt4cg/qtspecs/issues/1387</a></div><p>fn:build-uri: Observations</p></div>
<div class="toot" id="created-1456"><h2>Issue #1456 created<span class="toot-id"> #created-1456</span></h2><div class="pubdate">17 Sep at 22:30:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1456">https://github.com/qt4cg/qtspecs/issues/1456</a></div><details><summary>Filtering by type in lookup expressions</summary><div class="markup"><p>We have dropped the syntax <code>??type(T)</code> for filtering the results of lookup expressions, because of problems with syntax ambiguity. This issue seeks an alternative.</p>
<p>Although selection by type also makes sense with shallow lookup, it is most relevant with deep lookup. The main need arises with intermediate steps of a path such as <code>?? X ?? Y</code> which gives a dynamic error if X selects something that is not a map or array. This is consistent at one level with <code>// X // Y</code>, except that <code>// X</code> can never select something that isn't a node.</p>
<p>The main problems with filtering using an <code>[. instance of record(p, q)]</code> predicate is that it's very long-winded. For example, if we want to select only those members of a selected array that are sequences of a particular record type, without flattening everything else, we have to write something like <code>?? values::* ?[. instance of record(p, q)+] ? *</code>, which is a bit of a nightmare.</p>
<p>Starting from the end goal, I would like to be able to write something close to <code>??record(first, last)</code> to select all the items of this record type at any depth. We know that syntax doesn't work, because <code>??NCName</code> is already taken. That's also true for <code>??items::record(first, last)</code>, unless we change the rules for what can appear after <code>::</code>.</p>
<p>Also, there's another syntax hazard: what we want here is a SequenceType, not an ItemType, and that means that it can contain a trailing <code>?</code> occurrence indicator, which is easily confused with the next lookup operator in a path.</p>
<p>Looking at it from all angles, I do feel the best solution is to prefix the <code>record(first, last)</code> with a marker character so that we know we've got a type filter here. Characters that might do the job include <code>@</code>, <code>#</code>, <code>$</code>, <code>%</code>, <code>^</code>, <code>~</code>. Of these, my preference remains <code>~</code>, for three reasons:</p>
<p>(a) it's currently unused: overloading a different symbol is more likely to cause visual confusion
(b) one of the traditional uses of <code>~</code> is to indicate a "matches" or "is kind of like" relationship.
(c) there's a mnemonic association between "tilde" and "type" (compare "at" and "attribute")</p>
</div></details></div>
<div class="toot" id="closed-1324"><h2>Issue #1324 closed<span class="toot-id"> #closed-1324</span></h2><div class="pubdate">17 Sep at 21:27:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1324">https://github.com/qt4cg/qtspecs/issues/1324</a></div><p>Executable specifications</p></div>
<div class="toot" id="closed-1335"><h2>Issue #1335 closed<span class="toot-id"> #closed-1335</span></h2><div class="pubdate">17 Sep at 21:25:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1335">https://github.com/qt4cg/qtspecs/issues/1335</a></div><p>Data Model primitives for Maps and Arrays</p></div>
<div class="toot" id="created-1455"><h2>Pull request #1455 created<span class="toot-id"> #created-1455</span></h2><div class="pubdate">17 Sep at 21:03:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1455">https://github.com/qt4cg/qtspecs/pull/1455</a></div><details><summary>1445 Drop number-formatter option, retain string value</summary><div class="markup"><p>Fix #1445</p>
</div></details></div>
<div class="toot" id="created-1454"><h2>Pull request #1454 created<span class="toot-id"> #created-1454</span></h2><div class="pubdate">17 Sep at 18:29:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1454">https://github.com/qt4cg/qtspecs/pull/1454</a></div><details><summary>1449 Relax rules on multiple xsl:includes</summary><div class="markup"><p>Fix #1449</p>
</div></details></div>
<div class="toot" id="created-1453"><h2>Pull request #1453 created<span class="toot-id"> #created-1453</span></h2><div class="pubdate">17 Sep at 17:47:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1453">https://github.com/qt4cg/qtspecs/pull/1453</a></div><details><summary>Fix typo in load-xquery-module example</summary><div class="markup"><p>Fix #1451</p>
</div></details></div>
<div class="toot" id="closed-1372"><h2>Issue #1372 closed<span class="toot-id"> #closed-1372</span></h2><div class="pubdate">17 Sep at 16:17:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1372">https://github.com/qt4cg/qtspecs/issues/1372</a></div><p>Unknown option: FORG0013 → XPTY0004</p></div>
<div class="toot" id="closed-1431"><h2>Issue #1431 closed<span class="toot-id"> #closed-1431</span></h2><div class="pubdate">17 Sep at 16:17:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1431">https://github.com/qt4cg/qtspecs/pull/1431</a></div><p>1372 Unknown option: FORG0013 → XPTY0004</p></div>
<div class="toot" id="closed-1379"><h2>Issue #1379 closed<span class="toot-id"> #closed-1379</span></h2><div class="pubdate">17 Sep at 16:14:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1379">https://github.com/qt4cg/qtspecs/issues/1379</a></div><p>Circular dependencies: XQDY0054 vs. XPST0008 vs. optional errors</p></div>
<div class="toot" id="closed-1432"><h2>Issue #1432 closed<span class="toot-id"> #closed-1432</span></h2><div class="pubdate">17 Sep at 16:14:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1432">https://github.com/qt4cg/qtspecs/pull/1432</a></div><p>1379 Initializing expression: Allow self references</p></div>
<div class="toot" id="closed-1364"><h2>Issue #1364 closed<span class="toot-id"> #closed-1364</span></h2><div class="pubdate">17 Sep at 16:09:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1364">https://github.com/qt4cg/qtspecs/pull/1364</a></div><p>1314 Change to type() syntax to fix ambiguity</p></div>
<div class="toot" id="closed-1314"><h2>Issue #1314 closed<span class="toot-id"> #closed-1314</span></h2><div class="pubdate">17 Sep at 16:09:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1314">https://github.com/qt4cg/qtspecs/issues/1314</a></div><p>Ambiguity in XPath EBNF - Lookup with TypeQualifier vs DynamicFunctionCall</p></div>
<div class="toot" id="closed-1414"><h2>Issue #1414 closed<span class="toot-id"> #closed-1414</span></h2><div class="pubdate">17 Sep at 16:07:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1414">https://github.com/qt4cg/qtspecs/pull/1414</a></div><p>XSLT spec abstract, introduction</p></div>
<div class="toot" id="closed-1389"><h2>Issue #1389 closed<span class="toot-id"> #closed-1389</span></h2><div class="pubdate">17 Sep at 16:05:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1389">https://github.com/qt4cg/qtspecs/issues/1389</a></div><p>fn:while-do: Optional error: will not terminate</p></div>
<div class="toot" id="closed-1440"><h2>Issue #1440 closed<span class="toot-id"> #closed-1440</span></h2><div class="pubdate">17 Sep at 16:04:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1440">https://github.com/qt4cg/qtspecs/pull/1440</a></div><p>1387 Another tweak to build-uri</p></div>
<div class="toot" id="created-1452"><h2>Issue #1452 created<span class="toot-id"> #created-1452</span></h2><div class="pubdate">17 Sep at 14:55:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1452">https://github.com/qt4cg/qtspecs/issues/1452</a></div><details><summary>Links from the agendas/minutes to the dashboard don't redirect when the PR is no longer on the dashboard</summary><div class="markup"><p>Could they?</p>
<p>S.M.O.P. I suppose.</p>
</div></details></div>
<div class="toot" id="created-1451"><h2>Issue #1451 created<span class="toot-id"> #created-1451</span></h2><div class="pubdate">17 Sep at 13:33:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1451">https://github.com/qt4cg/qtspecs/issues/1451</a></div><details><summary>Minor syntax errors in FO examples</summary><div class="markup"><p>The example for <code>fn-load-xquery-module</code> contains I think an errant semicolon:</p>
<pre><code>let $expr := "2 + 2"
let $module := `xquery version "4.0"; 
                module namespace dyn="http://example.com/dyn";
                declare %public variable $dyn:value := {$expr};`
let $exec := load-xquery-module("http://example.com/dyn", 
                                {'content':$module}); 
let $variables := $exec?variables
return $variables(QName("http://example.com/dyn", "value"))
</code></pre>
<p>The semicolon after the third <code>let</code> is not permitted by the grammar - it only appears as a separator in <code>Version</code>, <code>Module</code> and <code>Prolog</code>. Removing that semicolon permits a parse under the current grammar.</p>
</div></details></div>
<div class="toot" id="closed-832"><h2>Issue #832 closed<span class="toot-id"> #closed-832</span></h2><div class="pubdate">17 Sep at 11:32:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/832">https://github.com/qt4cg/qtspecs/pull/832</a></div><p>77 Lookup returning path selection</p></div>
<div class="toot" id="created-1450"><h2>Issue #1450 created<span class="toot-id"> #created-1450</span></h2><div class="pubdate">17 Sep at 10:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1450">https://github.com/qt4cg/qtspecs/issues/1450</a></div><details><summary>Syntax of computed element and attribute constructors</summary><div class="markup"><p>The syntax of computed element and attribute constructors causes parsing problems, and problems in extending the grammar (for example it restricts the contexts in which bare-brace map constructors can appear).</p>
<p>In the syntax <code>element|attribute _name_ { _content-expression_ }</code> I propose that:</p>
<p>(a) it should be possible to use a <code>StringTemplate</code> in place of the <em>name</em>. This will normally just be the name enclosed in backticks but interpolated expressions are allowed.</p>
<p>(b) reserved names should be disallowed. This is a backwards-incompatible change. The reserved names are the non-delimiting terminal symbols listed in A.3.2. We should add a warning that additional names might be reserved in future versions, and advise use of backticks.</p>
</div></details></div>
<div class="toot" id="created-1449"><h2>Issue #1449 created<span class="toot-id"> #created-1449</span></h2><div class="pubdate">17 Sep at 07:41:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1449">https://github.com/qt4cg/qtspecs/issues/1449</a></div><details><summary>Discussion: include/import of files.</summary><div class="markup"><p>I don't especially do this.</p>
<p>a) because the environment that we run XSLT in (95% of the time) doesnt support it
b) because its too rigid to use (maybe I'm doing it wrong).</p>
<p>Motivation:</p>
<p>I have 'module' List.xsl lets say that models lists, and has a function (in psuedo XPath so you can see the types)
(a module contains constructors and ideally all functions related to, here, a list)</p>
<p><code>function tryHead($xs as list()) as maybe() </code></p>
<p>I have 'module' Maybe.xsl lets say that models Maybe</p>
<p><code>function toList($xs as maybe()) as list() </code></p>
<p>So Maybe.xsl needs to know about List.xsl and List.xsl needs to know about Maybe.xsl</p>
<p>if I use xsl:include or xsl:import (in saxon) I get:</p>
<p><code>The stylesheet module includes/imports itself directly or indirectly</code></p>
<p>(which I'm happy reflects the correct behaviour given the spec - i.e. I don't think this is a bug in the implementation)</p>
<p>Given that I CAN write this cycle in a single file, without restrictions on the order of the constructs (i.e. this isnt a restriction of the language itself - this isnt alway true in other languages), it seems less than ideal that I can't freely compose files in order to replicate the situation an allow decomposition into logical files.</p>
<p>(I expect this is a consequence of the rules around priority of templates, which I am broadly ignorant of, and to be honest, largely not directly concerned with - I don't use this to 'compose' templates, but to write 'function' libraries)</p>
<p>(MK has answered a question in stack overflow related to this, which solved the issue by reorganising the files, which is what I currently do, but its not ideal that I cannot decompose and test code in isolation)</p>
<p>Is this worth resolving?</p>
<p>Many years ago I was a C programmer, and I remember a similar issue that was resolved with #define, whereby header files were imported something like this (excuse my made up C syntax)</p>
<pre><code>#ifndef _Maybe_
#include "Maybe.h"
#endifndef
</code></pre>
<p>and then Maybe.h would define <code>_Maybe_</code>, this would mean, if you followed the idiom, that the file was included by the preprocessor, at most once (I'm not suggesting this mechanism is directly applicable, just that this is a common issue elsewhere).</p>
</div></details></div>
<div class="toot" id="created-1448"><h2>Issue #1448 created<span class="toot-id"> #created-1448</span></h2><div class="pubdate">16 Sep at 16:53:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1448">https://github.com/qt4cg/qtspecs/issues/1448</a></div><details><summary>Operations on the dateTime family of types</summary><div class="markup"><p>Now that we support choice types in function signatures, we can easily generalize functions such as <code>year-from-dateTime</code> to work on all types in the dateTime family (specifically dateTime, date, time, gYear, gYearMonth, gMonth, gMonthDay, gDay). A request for a component that is not present in the value returns ().</p>
<p>We can apply this to all seven X-from-dateTime() functions.</p>
<p>Of course this makes the X-from-date() and X-from-time() versions redundant, but that's not a problem.</p>
</div></details></div>
<div class="toot" id="created-1447"><h2>Pull request #1447 created<span class="toot-id"> #created-1447</span></h2><div class="pubdate">16 Sep at 16:35:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1447">https://github.com/qt4cg/qtspecs/pull/1447</a></div><details><summary>1446 Rephrase conformance rule on xs:dateTime limits</summary><div class="markup"><p>Fix #1446</p>
</div></details></div>
<div class="toot" id="created-1446"><h2>Issue #1446 created<span class="toot-id"> #created-1446</span></h2><div class="pubdate">16 Sep at 14:32:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1446">https://github.com/qt4cg/qtspecs/issues/1446</a></div><details><summary>Limits on xs:dateTime</summary><div class="markup"><p>Section 9.1.1 says</p>
<p>All minimally conforming processors must support positive year values with a minimum of 4 digits (i.e., YYYY)</p>
<p>The word "minimum" here is ambiguous.</p>
<p>I suggest</p>
<p>All minimally conforming processors must support year values in the range 1 to 9999.</p>
<p>For bonus points, drop the use of the undefined term "minimally conforming", and link instead to something defined in section 1.2 Conformance.</p>
</div></details></div>
<div class="toot" id="created-1445"><h2>Issue #1445 created<span class="toot-id"> #created-1445</span></h2><div class="pubdate">16 Sep at 11:34:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1445">https://github.com/qt4cg/qtspecs/issues/1445</a></div><details><summary>fn:xml-to-json: `number-formatter` option</summary><div class="markup"><p>I try to, but I don’t get happy with the <code>number-formatter</code> option of <code>fn:xml-to-json</code>. It results in a lot of special-casing at serialization time for a very special case. More generally, …</p>
<ul>
<li>The option would be much more helpful for outputting maps and arrays as JSON with at serialization time, but it is not available as standard serialization parameter.</li>
<li><code>fn:xml-to-json</code> represents numbers as text nodes, so numbers already have a string representation. If needed, they could easily be preprocessed before being serialized as JSON.</li>
</ul>
<p>I imagine that the major use cases for the option will be:</p>
<ul>
<li>to avoid scientific representation for doubles, and</li>
<li>to be able to serialize <code>INF</code> and <code>NaN</code>.</li>
</ul>
<p>Couldn’t we simply allow numeric string values (i.e., the children of <code>fn:number</code> elements) to be output without changes?</p>
<pre><code class="language-xquery">'1000000' =&gt; json-to-xml() =&gt; xml-to-json()  (: 1000000 instead of 1.0E6 :)
xml-to-json(&lt;fn:number&gt;INF&lt;/fn:number&gt;)      (: INF instead of error :)
</code></pre>
<p>We already have the <code>number-parser</code> option, which allows us to generate a string representation for numbers that will be suitable for being converted back with <code>fn:xml-to-json</code>. For other cases, the XML source can easily be updated before being passed to <code>fn:xml-to-json</code>.</p>
<p>If we really want to keep the option, …</p>
<ol>
<li>We should add examples for its usage in the spec.</li>
<li>We need more tests.</li>
<li>I would suggest using the function type <code>(fn(xs:untypedAtomic) as xs:untypedAtomic)?</code>, similar as for <code>fn:replace</code> and <code>fn:json-to-xml</code> (this would allow things like <code>xml-to-json($input, { 'number-formatter': fn { . + 1 } })</code>).</li>
<li>We should also add it as a general serialization parameter to be able to write:</li>
</ol>
<pre><code class="language-xquery">serialize(xs:double('NaN'), {
  'method': 'json',
  'number-formatter': fn($n) { if(is-NaN($n)) then '"NaN"' else $n }
})
</code></pre>
<p>If it’s too much hassle to introduce it as a general serialization parameter, we should at least provide it for <code>fn:serialize</code>.</p>
</div></details></div>
<div class="toot" id="created-1444"><h2>Pull request #1444 created<span class="toot-id"> #created-1444</span></h2><div class="pubdate">16 Sep at 10:42:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1444">https://github.com/qt4cg/qtspecs/pull/1444</a></div><details><summary>Implement improvement to bibligraphy entry for IEEE 802.3</summary><div class="markup"><p>Thank you, Wendell.</p>
</div></details></div>
<div class="toot" id="closed-1443"><h2>Issue #1443 closed<span class="toot-id"> #closed-1443</span></h2><div class="pubdate">16 Sep at 10:29:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1443">https://github.com/qt4cg/qtspecs/pull/1443</a></div><p>CSS tweaks for productions</p></div>
<div class="toot" id="created-1443"><h2>Pull request #1443 created<span class="toot-id"> #created-1443</span></h2><div class="pubdate">16 Sep at 10:29:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1443">https://github.com/qt4cg/qtspecs/pull/1443</a></div><details><summary>CSS tweaks for productions</summary><div class="markup"><ol>
<li>Make the productions a little easier to read by removing the border and background on <code>code</code> elements in production tables.</li>
<li>Make the background color for production notes a little less ... intense.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-1441"><h2>Issue #1441 closed<span class="toot-id"> #closed-1441</span></h2><div class="pubdate">16 Sep at 10:27:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1441">https://github.com/qt4cg/qtspecs/pull/1441</a></div><p>1396 Improve presentation of grammar rules</p></div>
<div class="toot" id="created-1442"><h2>Pull request #1442 created<span class="toot-id"> #created-1442</span></h2><div class="pubdate">15 Sep at 10:12:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1442">https://github.com/qt4cg/qtspecs/pull/1442</a></div><details><summary>1394 Add new default priority rules</summary><div class="markup"><p>Adds rules for the default priority of new match pattern options such as <code>element(p:*)</code> and <code>element(p|q)</code>.</p>
<p>Fix #1394</p>
</div></details></div>
<div class="toot" id="created-1441"><h2>Pull request #1441 created<span class="toot-id"> #created-1441</span></h2><div class="pubdate">14 Sep at 18:13:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1441">https://github.com/qt4cg/qtspecs/pull/1441</a></div><details><summary>1396 Improve presentation of grammar rules</summary><div class="markup"><p>Improves the presentation of grammar rules.</p>
<ul>
<li>Production numbers are dropped</li>
<li>The width of the RHS column is increased so there is less line wrapping</li>
<li>The summary EBNF is alphabetically sorted</li>
</ul>
</div></details></div>
<div class="toot" id="closed-1185"><h2>Issue #1185 closed<span class="toot-id"> #closed-1185</span></h2><div class="pubdate">14 Sep at 08:39:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1185">https://github.com/qt4cg/qtspecs/pull/1185</a></div><p>1179 array:values, map:values → array:get, map:get</p></div>
<div class="toot" id="created-1440"><h2>Pull request #1440 created<span class="toot-id"> #created-1440</span></h2><div class="pubdate">12 Sep at 16:03:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1440">https://github.com/qt4cg/qtspecs/pull/1440</a></div><details><summary>1387 Another tweak to build-uri</summary><div class="markup"><p>In #1387 @ChristianGruen observes that the <code>+</code> seems to be a special case in the <code>tel:</code> scheme. In fact, I think we concluded that the special case is that you shouldn't encode the path segment of a non-hierarchical URI.</p>
<p>This PR attempts to implement that.</p>
</div></details></div>
<div class="toot" id="closed-1269"><h2>Issue #1269 closed<span class="toot-id"> #closed-1269</span></h2><div class="pubdate">12 Sep at 11:26:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1269">https://github.com/qt4cg/qtspecs/issues/1269</a></div><p>Could the labeling of grammar productions be improved?</p></div>
<div class="toot" id="created-1439"><h2>Pull request #1439 created<span class="toot-id"> #created-1439</span></h2><div class="pubdate">11 Sep at 06:54:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1439">https://github.com/qt4cg/qtspecs/pull/1439</a></div><details><summary>1235 Function Identity: Treating function items with identical bodies</summary><div class="markup"><p>Closes #1235</p>
</div></details></div>
<div class="toot" id="created-1438"><h2>Pull request #1438 created<span class="toot-id"> #created-1438</span></h2><div class="pubdate">11 Sep at 06:33:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1438">https://github.com/qt4cg/qtspecs/pull/1438</a></div><details><summary>1322 fn:collation-available (editorial)</summary><div class="markup"><p>Closes #1322</p>
</div></details></div>
<div class="toot" id="created-1437"><h2>Pull request #1437 created<span class="toot-id"> #created-1437</span></h2><div class="pubdate">11 Sep at 06:24:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1437">https://github.com/qt4cg/qtspecs/pull/1437</a></div><details><summary>1325 Variadic System Functions limited to `fn:concat`</summary><div class="markup"><p>Closes #1325</p>
</div></details></div>
<div class="toot" id="created-1436"><h2>Pull request #1436 created<span class="toot-id"> #created-1436</span></h2><div class="pubdate">11 Sep at 06:02:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1436">https://github.com/qt4cg/qtspecs/pull/1436</a></div><details><summary>1323 Function parameters names: $href → $uri</summary><div class="markup"><p>Closes #1323</p>
</div></details></div>
<div class="toot" id="created-1435"><h2>Pull request #1435 created<span class="toot-id"> #created-1435</span></h2><div class="pubdate">11 Sep at 05:37:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1435">https://github.com/qt4cg/qtspecs/pull/1435</a></div><details><summary>1421 fn:unix-time: Revisions</summary><div class="markup"><p>Closes #1421</p>
</div></details></div>
<div class="toot" id="created-1434"><h2>Pull request #1434 created<span class="toot-id"> #created-1434</span></h2><div class="pubdate">11 Sep at 05:26:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1434">https://github.com/qt4cg/qtspecs/pull/1434</a></div><details><summary>1373 XQFO: Editorial</summary><div class="markup"><p>Closes #1373</p>
</div></details></div>
<div class="toot" id="created-1433"><h2>Pull request #1433 created<span class="toot-id"> #created-1433</span></h2><div class="pubdate">11 Sep at 05:09:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1433">https://github.com/qt4cg/qtspecs/pull/1433</a></div><details><summary>1422 fn:hash: Revision</summary><div class="markup"><p>Closes #1422</p>
</div></details></div>
<div class="toot" id="created-1432"><h2>Pull request #1432 created<span class="toot-id"> #created-1432</span></h2><div class="pubdate">11 Sep at 04:47:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1432">https://github.com/qt4cg/qtspecs/pull/1432</a></div><details><summary>1379 Initializing expression: Allow self references</summary><div class="markup"><p>With function declarations, recursive functions can be declared:</p>
<pre><code class="language-xquery">declare function local:factorial($x) {
  if($x &gt; 1) then $x + local:factorial($x - 1) else $x
};
local:factorial(5)
</code></pre>
<p>We should allow the same for variable declarations:</p>
<pre><code class="language-xquery">declare variable $factorial := fn($x) {
  if($x &gt; 1) then $x + $factorial($x - 1) else $x
};
$factorial(5)
</code></pre>
<p>I believe it is sufficient to simplify the definition of <em>initializing expressions</em> and drop the exception “other than the variable being declared”.</p>
<p>Related: https://www.w3.org/Bugs/Public/show_bug.cgi?id=15791 (the static dependency check was given up before due to <code>fn:function-lookup</code>).</p>
<p>Closes #1379</p>
</div></details></div>
<div class="toot" id="created-1431"><h2>Pull request #1431 created<span class="toot-id"> #created-1431</span></h2><div class="pubdate">11 Sep at 04:26:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1431">https://github.com/qt4cg/qtspecs/pull/1431</a></div><details><summary>1372 Unknown option: FORG0013 → XPTY0004</summary><div class="markup"><p>Closes #1372</p>
</div></details></div>
<div class="toot" id="minutes-09-10"><h2>QT4 CG meeting 089 draft minutes<span class="toot-id"> #minutes-09-10</span></h2><div class="pubdate">10 Sep at 16:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/09-10">https://qt4cg.org/meeting/minutes/2024/09-10</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1209"><h2>Issue #1209 closed<span class="toot-id"> #closed-1209</span></h2><div class="pubdate">10 Sep at 17:26:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1209">https://github.com/qt4cg/qtspecs/pull/1209</a></div><p>1183 Add transient mode and the transient{} expression</p></div>
<div class="toot" id="closed-1426"><h2>Issue #1426 closed<span class="toot-id"> #closed-1426</span></h2><div class="pubdate">10 Sep at 16:35:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1426">https://github.com/qt4cg/qtspecs/issues/1426</a></div><p>Byte ordering of CRC-32 hash result</p></div>
<div class="toot" id="closed-1428"><h2>Issue #1428 closed<span class="toot-id"> #closed-1428</span></h2><div class="pubdate">10 Sep at 16:35:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1428">https://github.com/qt4cg/qtspecs/pull/1428</a></div><p>1426 Add notes on endianness of CRC-32</p></div>
<div class="toot" id="closed-1348"><h2>Issue #1348 closed<span class="toot-id"> #closed-1348</span></h2><div class="pubdate">10 Sep at 16:32:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1348">https://github.com/qt4cg/qtspecs/issues/1348</a></div><p>Grammar rules: redundancies</p></div>
<div class="toot" id="closed-1360"><h2>Issue #1360 closed<span class="toot-id"> #closed-1360</span></h2><div class="pubdate">10 Sep at 16:32:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1360">https://github.com/qt4cg/qtspecs/pull/1360</a></div><p>1348 Some grammar simplifications</p></div>
<div class="toot" id="closed-1391"><h2>Issue #1391 closed<span class="toot-id"> #closed-1391</span></h2><div class="pubdate">10 Sep at 16:30:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1391">https://github.com/qt4cg/qtspecs/issues/1391</a></div><p>Annotations: duplicate names</p></div>
<div class="toot" id="closed-1393"><h2>Issue #1393 closed<span class="toot-id"> #closed-1393</span></h2><div class="pubdate">10 Sep at 16:30:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1393">https://github.com/qt4cg/qtspecs/pull/1393</a></div><p>1391 Change function-annotations to return a sequence</p></div>
<div class="toot" id="closed-1411"><h2>Issue #1411 closed<span class="toot-id"> #closed-1411</span></h2><div class="pubdate">10 Sep at 16:27:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1411">https://github.com/qt4cg/qtspecs/issues/1411</a></div><p>uri-structure-record gives type of path-segments property as xs:string?, not xs:string*</p></div>
<div class="toot" id="closed-1412"><h2>Issue #1412 closed<span class="toot-id"> #closed-1412</span></h2><div class="pubdate">10 Sep at 16:27:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1412">https://github.com/qt4cg/qtspecs/pull/1412</a></div><p>Fix typo in uri-structure-record</p></div>
<div class="toot" id="closed-1413"><h2>Issue #1413 closed<span class="toot-id"> #closed-1413</span></h2><div class="pubdate">10 Sep at 16:23:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1413">https://github.com/qt4cg/qtspecs/pull/1413</a></div><p>Dispose of action QT4CG-080-05, add absolute to parse-uri</p></div>
<div class="toot" id="closed-1408"><h2>Issue #1408 closed<span class="toot-id"> #closed-1408</span></h2><div class="pubdate">10 Sep at 16:20:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1408">https://github.com/qt4cg/qtspecs/issues/1408</a></div><p>The description of XPTY0117 still refers to the "function conversion rules"</p></div>
<div class="toot" id="closed-1417"><h2>Issue #1417 closed<span class="toot-id"> #closed-1417</span></h2><div class="pubdate">10 Sep at 16:20:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1417">https://github.com/qt4cg/qtspecs/pull/1417</a></div><p>1408 Fix reference to "function conversion rules" in XPTY0117</p></div>
<div class="toot" id="closed-1415"><h2>Issue #1415 closed<span class="toot-id"> #closed-1415</span></h2><div class="pubdate">10 Sep at 16:16:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1415">https://github.com/qt4cg/qtspecs/issues/1415</a></div><p>xsl:item-type needs to be added to the list of XSLT declaration components</p></div>
<div class="toot" id="closed-1418"><h2>Issue #1418 closed<span class="toot-id"> #closed-1418</span></h2><div class="pubdate">10 Sep at 16:16:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1418">https://github.com/qt4cg/qtspecs/pull/1418</a></div><p>1415 Add to lists of XSLT declarations and instructions</p></div>
<div class="toot" id="closed-1419"><h2>Issue #1419 closed<span class="toot-id"> #closed-1419</span></h2><div class="pubdate">10 Sep at 16:13:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1419">https://github.com/qt4cg/qtspecs/pull/1419</a></div><p>1337bis Replace a few remaining occurrences of "atomic value"</p></div>
<div class="toot" id="closed-1423"><h2>Issue #1423 closed<span class="toot-id"> #closed-1423</span></h2><div class="pubdate">10 Sep at 16:09:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1423">https://github.com/qt4cg/qtspecs/pull/1423</a></div><p>1387b Clarify parse-uri/build-uri encoding rules, and remove options</p></div>
<div class="toot" id="closed-1388"><h2>Issue #1388 closed<span class="toot-id"> #closed-1388</span></h2><div class="pubdate">10 Sep at 16:08:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1388">https://github.com/qt4cg/qtspecs/pull/1388</a></div><p>1387 Clarify the encoding rules</p></div>
<div class="toot" id="closed-1385"><h2>Issue #1385 closed<span class="toot-id"> #closed-1385</span></h2><div class="pubdate">10 Sep at 16:07:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1385">https://github.com/qt4cg/qtspecs/issues/1385</a></div><p>Quantifier expressions: optional positional argument</p></div>
<div class="toot" id="closed-1424"><h2>Issue #1424 closed<span class="toot-id"> #closed-1424</span></h2><div class="pubdate">10 Sep at 16:07:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1424">https://github.com/qt4cg/qtspecs/issues/1424</a></div><p>Typo in XQuery spec: expresssions</p></div>
<div class="toot" id="closed-1425"><h2>Issue #1425 closed<span class="toot-id"> #closed-1425</span></h2><div class="pubdate">10 Sep at 16:06:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1425">https://github.com/qt4cg/qtspecs/pull/1425</a></div><p>1424 Fix typo</p></div>
<div class="toot" id="created-1430"><h2>Pull request #1430 created<span class="toot-id"> #created-1430</span></h2><div class="pubdate">09 Sep at 10:46:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1430">https://github.com/qt4cg/qtspecs/pull/1430</a></div><details><summary>1427 Add element-number function</summary><div class="markup"><p>Fix #1427</p>
</div></details></div>
<div class="toot" id="created-1429"><h2>Pull request #1429 created<span class="toot-id"> #created-1429</span></h2><div class="pubdate">08 Sep at 15:43:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1429">https://github.com/qt4cg/qtspecs/pull/1429</a></div><details><summary>1403 Align type tests</summary><div class="markup"><p>fixes #1403</p>
<p>Allow Array and Map tests to omit the asterisk to match any array or map.</p>
<ul>
<li><code>array()</code> &lt;&gt; <code>array(*)</code></li>
<li><code>map()</code> &lt;&gt; <code>map(*)</code></li>
</ul>
</div></details></div>
<div class="toot" id="created-1428"><h2>Pull request #1428 created<span class="toot-id"> #created-1428</span></h2><div class="pubdate">07 Sep at 21:35:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1428">https://github.com/qt4cg/qtspecs/pull/1428</a></div><details><summary>1426 Add notes on endianness of CRC-32</summary><div class="markup"><p>Fix #1426 (partially; it would also be good to have a better citation to IEEE 802.3)</p>
</div></details></div>
<div class="toot" id="created-1427"><h2>Issue #1427 created<span class="toot-id"> #created-1427</span></h2><div class="pubdate">07 Sep at 08:27:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1427">https://github.com/qt4cg/qtspecs/issues/1427</a></div><details><summary>Add a function equivalent to xsl:number</summary><div class="markup"><p>I propose adding a function to perform node numbering in a manner analogous to xsl:number (but without the formatting aspects, which can be handled using format-integer, and without multi-level numbering).</p>
<p>I envisage a function along the following lines:</p>
<pre><code>node-number($node as element(), 
                         $from as (document-node()|element()), 
                         $count as fn($node as element()) as xs:boolean?)
   as xs:integer
</code></pre>
<p>The function returns the number of element nodes that satisfy all the following conditions:</p>
<ul>
<li>they are descendants of $from</li>
<li>they are preceding-or-self nodes of $node</li>
<li>they satisfy the $count predicate</li>
</ul>
<p>$node defaults to the context node. $from defaults to the parent of $node. $count defaults to a function that returns true for an element that has the same name as $node, false otherwise.</p>
<p>With no arguments, node-number() applied to (say) a <code>&lt;p&gt;</code> element returns the number of preceding-sibling <code>&lt;p&gt;</code> elements plus one. <em>[Not quite. Under this definition, it would also count <code>&lt;p&gt;</code> elements that are descendants of a preceding-sibling element]</em></p>
<p>The rationale for this proposal is (a) to make the core functionality of xsl:number available in environments other than XSLT, and (b) within XSLT, to make it available in contexts such as a predicate of a match pattern where it is currently difficult or impossible to invoke <code>xsl:number</code> except by wrapping it in a user-defined variable or function.</p>
</div></details></div>
<div class="toot" id="created-1426"><h2>Issue #1426 created<span class="toot-id"> #created-1426</span></h2><div class="pubdate">06 Sep at 17:48:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1426">https://github.com/qt4cg/qtspecs/issues/1426</a></div><details><summary>Byte ordering of CRC-32 hash result</summary><div class="markup"><p>Test case hash-str-034 takes a 150,000-character string consisting of 50,000 repetitions of the string "ABC", and computes its CRC-32 hash value.</p>
<p>On Java the result comes back as decimal 105475755, which we translate to 0x06496EAB</p>
<p>On C# the result comes back as a 4-byte array AB 6E 49 06. My guess is we need to reverse the byte order, but I'd like to understand why...</p>
<p>I guess we need to say something about byte ordering, but what?</p>
<p>I tried to find the definitive specification. We simply point to IEEE 802.3 without a specific URI or section or version number. 802.3 actually appears to be a large family of standards. Can we do better than that?</p>
<p>I'm interested to know whether the specification actually defines the result to be a 32-bit (unsigned?) integer rather than an array of four bytes. If that's the case, then our spec needs to say how the 32-bit integer is converted to a sequence of 4 octets, which is what fn:hash actually returns. The C# example shows that there's more than one way of doing it.</p>
</div></details></div>
<div class="toot" id="created-1425"><h2>Pull request #1425 created<span class="toot-id"> #created-1425</span></h2><div class="pubdate">04 Sep at 12:56:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1425">https://github.com/qt4cg/qtspecs/pull/1425</a></div><details><summary>1424 Fix typo</summary><div class="markup"><p>Close #1424</p>
<p>Thank you, Amanda.</p>
</div></details></div>
<div class="toot" id="created-1424"><h2>Issue #1424 created<span class="toot-id"> #created-1424</span></h2><div class="pubdate">04 Sep at 12:25:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1424">https://github.com/qt4cg/qtspecs/issues/1424</a></div><details><summary>Typo in XQuery spec: expresssions</summary><div class="markup"><p>The XQuery 3.1 spec and XQuery 4.0 draft spec both have an extra "s" in the word expressions, showing it as <code>expresssions</code>. The typo occurs in the C.1 Static Context Components section.</p>
<p>I know this repo is only for 4.0 work. Should I make a separate issue in the https://github.com/w3c/qtspecs repo?</p>
</div></details></div>
<div class="toot" id="created-1423"><h2>Pull request #1423 created<span class="toot-id"> #created-1423</span></h2><div class="pubdate">04 Sep at 10:01:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1423">https://github.com/qt4cg/qtspecs/pull/1423</a></div><details><summary>1387b Clarify parse-uri/build-uri encoding rules, and remove options</summary><div class="markup"><p>This is a slightly more radical alternative to #1388</p>
<p>In addition to clarifying the encoding rules (maintaining slightly different rules for path segments, query parameters, and fragment identifiers), it removes the <code>path-separator</code> and <code>query-separator</code> options.</p>
</div></details></div>
<div class="toot" id="created-1422"><h2>Issue #1422 created<span class="toot-id"> #created-1422</span></h2><div class="pubdate">04 Sep at 09:17:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1422">https://github.com/qt4cg/qtspecs/issues/1422</a></div><details><summary>`fn:hash`: Revision</summary><div class="markup"><p>We should make the algorithm argument in the the function signature of <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-hash"><code>fn:hash</code></a> explicit and change the signature from…</p>
<pre><code class="language-xquery">fn:hash(
  $value    as (xs:string | xs:hexBinary | xs:base64Binary)?,	
  $options  as map(*)?  := {}
) as xs:hexBinary?
</code></pre>
<p>…to:</p>
<pre><code class="language-xquery">fn:hash(
  $value      as (xs:string | xs:hexBinary | xs:base64Binary)?,	
  $algorithm  as xs:string? := 'MD5',
  $options    as map(*)?  := {}
) as xs:hexBinary?
</code></pre>
<p>It will happen often enough that the function is used for algorithms other than MD5:</p>
<pre><code class="language-xquery">(: OLD :) hash("ABC", { "algorithm": "CRC-32" })
(: NEW :) hash("ABC", "CRC-32")
</code></pre>
</div></details></div>
<div class="toot" id="created-1421"><h2>Issue #1421 created<span class="toot-id"> #created-1421</span></h2><div class="pubdate">04 Sep at 09:05:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1421">https://github.com/qt4cg/qtspecs/issues/1421</a></div><details><summary>`fn:unix-time`: Revisions</summary><div class="markup"><p>In yesterday’s meeting, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-unix-time"><code>fn:unix-time</code></a> was added to the spec. It was proposed to…</p>
<ol>
<li>drop support for negative values and</li>
<li>change the function name to <code>fn:unix-dateTime</code>.</li>
</ol>
<p>I sympathize with both suggestions. What do others think?</p>
</div></details></div>
<div class="toot" id="closed-1420"><h2>Issue #1420 closed<span class="toot-id"> #closed-1420</span></h2><div class="pubdate">04 Sep at 08:27:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1420">https://github.com/qt4cg/qtspecs/pull/1420</a></div><p>Markup fix</p></div>
<div class="toot" id="created-1420"><h2>Pull request #1420 created<span class="toot-id"> #created-1420</span></h2><div class="pubdate">04 Sep at 08:27:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1420">https://github.com/qt4cg/qtspecs/pull/1420</a></div><details><summary>Markup fix</summary><div class="markup"><p>There's a markup error in the hash function that breaks the automatic test build. This PR fixes that.</p>
<p>(I'm just going to merge this straight away.)</p>
</div></details></div>
<div class="toot" id="created-1419"><h2>Pull request #1419 created<span class="toot-id"> #created-1419</span></h2><div class="pubdate">03 Sep at 20:03:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1419">https://github.com/qt4cg/qtspecs/pull/1419</a></div><details><summary>1337bis Replace a few remaining occurrences of "atomic value"</summary><div class="markup"><p>Replace a few remaining occurrences of "atomic value" with "atomic item".</p>
</div></details></div>
<div class="toot" id="created-1418"><h2>Pull request #1418 created<span class="toot-id"> #created-1418</span></h2><div class="pubdate">03 Sep at 19:36:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1418">https://github.com/qt4cg/qtspecs/pull/1418</a></div><details><summary>1415 Add to lists of XSLT declarations and instructions</summary><div class="markup"><p>Fix #1415</p>
<p>Adds xsl:item-type to the list of declarations.
Adds xsl:array. xsl:map, and xsl:map-entry to the list of instructions.</p>
</div></details></div>
<div class="toot" id="created-1417"><h2>Pull request #1417 created<span class="toot-id"> #created-1417</span></h2><div class="pubdate">03 Sep at 19:25:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1417">https://github.com/qt4cg/qtspecs/pull/1417</a></div><details><summary>1408 Fix reference to "function conversion rules" in XPTY0117</summary><div class="markup"><p>Fix #1408</p>
</div></details></div>
<div class="toot" id="created-1416"><h2>Issue #1416 created<span class="toot-id"> #created-1416</span></h2><div class="pubdate">03 Sep at 18:39:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1416">https://github.com/qt4cg/qtspecs/issues/1416</a></div><details><summary>Key-value pairs: built-in record type `pair`</summary><div class="markup"><p>A built-in record type should be defined for <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-key-value-pair-map">key-value pair maps</a>, which currently defined as follows…</p>
<blockquote>
<p>A key-value pair map is a map containing two entries, one (with the key <code>"key"</code>) containing the key part of a key value pair, the other (with the key <code>"value"</code>) containing the value part of a key value pair.</p>
</blockquote>
<p>…as we can expect them to be used more often in the future. Would it be possible/make sense to assign the record type to the <code>xs</code> namespace (<code>xs:pair</code>)?</p>
<p>In addition, we should…</p>
<ul>
<li>use it consistently in the text (XQFO, deep lookups, etc.),</li>
<li>replace existing <code>record(key as xs:anyAtomicType, value as item()*)</code> references with <code>xs:pair</code>, and</li>
<li>rename <code>$input</code> or <code>$map</code> arguments to <code>$pair</code>.</li>
</ul>
<p>Examples for function signatures to be updated:</p>
<pre><code class="language-xquery">map:of-pairs(
  $pairs    as xs:pair*,
  $combine  as fn(item()*, item()*) as item()* := fn:op(',')
) as map(*)

map:pair(
  $key    as xs:anyAtomicType,
  $value  as item()*	
) as xs:pair

map:pairs(
  $map  as map(*)	
) as xs:pair*
</code></pre>
<p>We could add numerous other record types, but maybe we can handle those in separate issue and keep this one focused on key/value pairs.</p>
</div></details></div>
<div class="toot" id="closed-1343"><h2>Issue #1343 closed<span class="toot-id"> #closed-1343</span></h2><div class="pubdate">03 Sep at 18:27:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1343">https://github.com/qt4cg/qtspecs/issues/1343</a></div><p>Drop the static typing feature</p></div>
<div class="toot" id="closed-1344"><h2>Issue #1344 closed<span class="toot-id"> #closed-1344</span></h2><div class="pubdate">03 Sep at 18:27:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1344">https://github.com/qt4cg/qtspecs/pull/1344</a></div><p>1343 Drop the static typing feature</p></div>
<div class="toot" id="closed-1337"><h2>Issue #1337 closed<span class="toot-id"> #closed-1337</span></h2><div class="pubdate">03 Sep at 18:23:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1337">https://github.com/qt4cg/qtspecs/issues/1337</a></div><p>Atomic value → atomic item</p></div>
<div class="toot" id="closed-1361"><h2>Issue #1361 closed<span class="toot-id"> #closed-1361</span></h2><div class="pubdate">03 Sep at 18:23:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1361">https://github.com/qt4cg/qtspecs/pull/1361</a></div><p>1337 Atomic value becomes atomic item</p></div>
<div class="toot" id="closed-959"><h2>Issue #959 closed<span class="toot-id"> #closed-959</span></h2><div class="pubdate">03 Sep at 17:20:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/959">https://github.com/qt4cg/qtspecs/issues/959</a></div><p>Milliseconds ↔ xs:dayTimeDuration, Unix time ↔ xs:dateTime</p></div>
<div class="toot" id="closed-1358"><h2>Issue #1358 closed<span class="toot-id"> #closed-1358</span></h2><div class="pubdate">03 Sep at 17:20:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1358">https://github.com/qt4cg/qtspecs/pull/1358</a></div><p>959 fn:unix-time</p></div>
<div class="toot" id="closed-1321"><h2>Issue #1321 closed<span class="toot-id"> #closed-1321</span></h2><div class="pubdate">03 Sep at 17:17:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1321">https://github.com/qt4cg/qtspecs/issues/1321</a></div><p>Leading lone slash</p></div>
<div class="toot" id="closed-1367"><h2>Issue #1367 closed<span class="toot-id"> #closed-1367</span></h2><div class="pubdate">03 Sep at 17:17:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1367">https://github.com/qt4cg/qtspecs/pull/1367</a></div><p>1321 leading lone slash</p></div>
<div class="toot" id="closed-1401"><h2>Issue #1401 closed<span class="toot-id"> #closed-1401</span></h2><div class="pubdate">03 Sep at 17:14:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1401">https://github.com/qt4cg/qtspecs/issues/1401</a></div><p>Casting from duration to string</p></div>
<div class="toot" id="closed-1409"><h2>Issue #1409 closed<span class="toot-id"> #closed-1409</span></h2><div class="pubdate">03 Sep at 17:14:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1409">https://github.com/qt4cg/qtspecs/pull/1409</a></div><p>1401 Rewrite of F+O section 20, Casting</p></div>
<div class="toot" id="closed-1368"><h2>Issue #1368 closed<span class="toot-id"> #closed-1368</span></h2><div class="pubdate">03 Sep at 17:14:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1368">https://github.com/qt4cg/qtspecs/issues/1368</a></div><p>Further improvements to BuiltInKeywords test needed</p></div>
<div class="toot" id="closed-1316"><h2>Issue #1316 closed<span class="toot-id"> #closed-1316</span></h2><div class="pubdate">03 Sep at 17:11:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1316">https://github.com/qt4cg/qtspecs/issues/1316</a></div><p>XPath: type declarations in quantified expressions</p></div>
<div class="toot" id="closed-1384"><h2>Issue #1384 closed<span class="toot-id"> #closed-1384</span></h2><div class="pubdate">03 Sep at 17:11:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1384">https://github.com/qt4cg/qtspecs/pull/1384</a></div><p>1316 Type declarations in quantified expressions</p></div>
<div class="toot" id="closed-1228"><h2>Issue #1228 closed<span class="toot-id"> #closed-1228</span></h2><div class="pubdate">03 Sep at 17:08:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1228">https://github.com/qt4cg/qtspecs/pull/1228</a></div><p>– Adding the BLAKE3 hashing algorithm to fn:hash</p></div>
<div class="toot" id="closed-1193"><h2>Issue #1193 closed<span class="toot-id"> #closed-1193</span></h2><div class="pubdate">03 Sep at 17:05:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1193">https://github.com/qt4cg/qtspecs/issues/1193</a></div><p>Parsing Functions: Empty input</p></div>
<div class="toot" id="closed-1231"><h2>Issue #1231 closed<span class="toot-id"> #closed-1231</span></h2><div class="pubdate">03 Sep at 17:05:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1231">https://github.com/qt4cg/qtspecs/pull/1231</a></div><p>1193 Parsing Functions: Empty input</p></div>
<div class="toot" id="closed-1339"><h2>Issue #1339 closed<span class="toot-id"> #closed-1339</span></h2><div class="pubdate">03 Sep at 17:02:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1339">https://github.com/qt4cg/qtspecs/issues/1339</a></div><p>Drop unordered mode</p></div>
<div class="toot" id="closed-1342"><h2>Issue #1342 closed<span class="toot-id"> #closed-1342</span></h2><div class="pubdate">03 Sep at 17:02:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1342">https://github.com/qt4cg/qtspecs/pull/1342</a></div><p>1339 Deprecate ordering mode declaration</p></div>
<div class="toot" id="closed-1350"><h2>Issue #1350 closed<span class="toot-id"> #closed-1350</span></h2><div class="pubdate">03 Sep at 16:58:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1350">https://github.com/qt4cg/qtspecs/issues/1350</a></div><p>unparsed-text-available() signature</p></div>
<div class="toot" id="closed-1352"><h2>Issue #1352 closed<span class="toot-id"> #closed-1352</span></h2><div class="pubdate">03 Sep at 16:58:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1352">https://github.com/qt4cg/qtspecs/pull/1352</a></div><p>1350 Fix signature for unparsed-text-available</p></div>
<div class="toot" id="closed-1347"><h2>Issue #1347 closed<span class="toot-id"> #closed-1347</span></h2><div class="pubdate">03 Sep at 16:56:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1347">https://github.com/qt4cg/qtspecs/issues/1347</a></div><p>The escape-solidus option should apply to xml-to-json</p></div>
<div class="toot" id="closed-1353"><h2>Issue #1353 closed<span class="toot-id"> #closed-1353</span></h2><div class="pubdate">03 Sep at 16:56:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1353">https://github.com/qt4cg/qtspecs/pull/1353</a></div><p>1347 Add escape-solidus option to xml-to-json function</p></div>
<div class="toot" id="closed-1346"><h2>Issue #1346 closed<span class="toot-id"> #closed-1346</span></h2><div class="pubdate">03 Sep at 16:54:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1346">https://github.com/qt4cg/qtspecs/issues/1346</a></div><p>Typos in fn:format-number</p></div>
<div class="toot" id="closed-1359"><h2>Issue #1359 closed<span class="toot-id"> #closed-1359</span></h2><div class="pubdate">03 Sep at 16:53:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1359">https://github.com/qt4cg/qtspecs/pull/1359</a></div><p>1346 Fix minor typos in format-number</p></div>
<div class="toot" id="closed-1369"><h2>Issue #1369 closed<span class="toot-id"> #closed-1369</span></h2><div class="pubdate">03 Sep at 16:50:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1369">https://github.com/qt4cg/qtspecs/issues/1369</a></div><p>fn:round: `rounding-mode` → `mode`?</p></div>
<div class="toot" id="closed-1370"><h2>Issue #1370 closed<span class="toot-id"> #closed-1370</span></h2><div class="pubdate">03 Sep at 16:50:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1370">https://github.com/qt4cg/qtspecs/pull/1370</a></div><p>1369 fn:round: rounding-mode → mode</p></div>
<div class="toot" id="closed-1320"><h2>Issue #1320 closed<span class="toot-id"> #closed-1320</span></h2><div class="pubdate">03 Sep at 16:47:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1320">https://github.com/qt4cg/qtspecs/issues/1320</a></div><p>fn:parse-uri: Observations</p></div>
<div class="toot" id="closed-1380"><h2>Issue #1380 closed<span class="toot-id"> #closed-1380</span></h2><div class="pubdate">03 Sep at 16:47:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1380">https://github.com/qt4cg/qtspecs/pull/1380</a></div><p>1320 Attempt to resolve a bug in parse-uri</p></div>
<div class="toot" id="closed-1374"><h2>Issue #1374 closed<span class="toot-id"> #closed-1374</span></h2><div class="pubdate">03 Sep at 16:44:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1374">https://github.com/qt4cg/qtspecs/issues/1374</a></div><p>Duplicate keys in map constructor</p></div>
<div class="toot" id="closed-1383"><h2>Issue #1383 closed<span class="toot-id"> #closed-1383</span></h2><div class="pubdate">03 Sep at 16:44:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1383">https://github.com/qt4cg/qtspecs/pull/1383</a></div><p>1374 - allow static error for duplicate keys</p></div>
<div class="toot" id="closed-1382"><h2>Issue #1382 closed<span class="toot-id"> #closed-1382</span></h2><div class="pubdate">03 Sep at 16:41:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1382">https://github.com/qt4cg/qtspecs/issues/1382</a></div><p>Missing XSLT error code</p></div>
<div class="toot" id="closed-1386"><h2>Issue #1386 closed<span class="toot-id"> #closed-1386</span></h2><div class="pubdate">03 Sep at 16:41:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1386">https://github.com/qt4cg/qtspecs/pull/1386</a></div><p>1382 add error code XTSE4040</p></div>
<div class="toot" id="closed-1390"><h2>Issue #1390 closed<span class="toot-id"> #closed-1390</span></h2><div class="pubdate">03 Sep at 16:41:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1390">https://github.com/qt4cg/qtspecs/pull/1390</a></div><p>1368 built in keywords improvements</p></div>
<div class="toot" id="closed-1398"><h2>Issue #1398 closed<span class="toot-id"> #closed-1398</span></h2><div class="pubdate">03 Sep at 16:38:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1398">https://github.com/qt4cg/qtspecs/pull/1398</a></div><p>1397 Add missing change log entry for constructor functions</p></div>
<div class="toot" id="closed-1397"><h2>Issue #1397 closed<span class="toot-id"> #closed-1397</span></h2><div class="pubdate">03 Sep at 16:38:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1397">https://github.com/qt4cg/qtspecs/issues/1397</a></div><p>Missing change log entry for zero-arity constructor functions</p></div>
<div class="toot" id="closed-1395"><h2>Issue #1395 closed<span class="toot-id"> #closed-1395</span></h2><div class="pubdate">03 Sep at 16:36:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1395">https://github.com/qt4cg/qtspecs/issues/1395</a></div><p>Choice item types: subtyping</p></div>
<div class="toot" id="closed-1400"><h2>Issue #1400 closed<span class="toot-id"> #closed-1400</span></h2><div class="pubdate">03 Sep at 16:36:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1400">https://github.com/qt4cg/qtspecs/pull/1400</a></div><p>1395 Revise rules for subtyping of choice item types</p></div>
<div class="toot" id="closed-1402"><h2>Issue #1402 closed<span class="toot-id"> #closed-1402</span></h2><div class="pubdate">03 Sep at 16:33:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1402">https://github.com/qt4cg/qtspecs/pull/1402</a></div><p>Update schema for XSLT 4.0 to include agreed syntax changes</p></div>
<div class="toot" id="closed-1405"><h2>Issue #1405 closed<span class="toot-id"> #closed-1405</span></h2><div class="pubdate">03 Sep at 16:30:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1405">https://github.com/qt4cg/qtspecs/pull/1405</a></div><p>1404 Change fn:invisible-xml grammar parameter to xs:string?</p></div>
<div class="toot" id="closed-1404"><h2>Issue #1404 closed<span class="toot-id"> #closed-1404</span></h2><div class="pubdate">03 Sep at 16:30:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1404">https://github.com/qt4cg/qtspecs/issues/1404</a></div><p>Invisible-xml function: why is $grammar of type item()?</p></div>
<div class="toot" id="closed-917"><h2>Issue #917 closed<span class="toot-id"> #closed-917</span></h2><div class="pubdate">03 Sep at 16:29:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/917">https://github.com/qt4cg/qtspecs/issues/917</a></div><p>Better support for typed maps</p></div>
<div class="toot" id="closed-1371"><h2>Issue #1371 closed<span class="toot-id"> #closed-1371</span></h2><div class="pubdate">03 Sep at 16:29:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1371">https://github.com/qt4cg/qtspecs/issues/1371</a></div><p>(type)switch: braces after `case` keyword</p></div>
<div class="toot" id="closed-1399"><h2>Issue #1399 closed<span class="toot-id"> #closed-1399</span></h2><div class="pubdate">03 Sep at 16:27:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1399">https://github.com/qt4cg/qtspecs/issues/1399</a></div><p>XSLT fixed-namespaces - contradictory statements</p></div>
<div class="toot" id="closed-1406"><h2>Issue #1406 closed<span class="toot-id"> #closed-1406</span></h2><div class="pubdate">03 Sep at 16:27:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1406">https://github.com/qt4cg/qtspecs/pull/1406</a></div><p>1399 clarify fixed-namespaces spec</p></div>
<div class="toot" id="created-1415"><h2>Issue #1415 created<span class="toot-id"> #created-1415</span></h2><div class="pubdate">03 Sep at 11:11:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1415">https://github.com/qt4cg/qtspecs/issues/1415</a></div><details><summary>xsl:item-type needs to be added to the list of XSLT declaration components</summary><div class="markup"><p>https://qt4cg.org/specifications/xslt-40/Overview.html#dt-declaration needs <code>xsl:item-type</code> adding</p>
</div></details></div>
<div class="toot" id="created-1414"><h2>Pull request #1414 created<span class="toot-id"> #created-1414</span></h2><div class="pubdate">03 Sep at 02:22:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1414">https://github.com/qt4cg/qtspecs/pull/1414</a></div><details><summary>XSLT spec abstract, introduction</summary><div class="markup"><p>As currently written, preliminary parts of the the XSLT specs are out of sync with other specs, or have inconsistencies.</p>
<ul>
<li>The section called Abstract mostly describes what's different in 4.0. That despite a section shortly later specially devoted to the topic.</li>
<li>The section called Abstract does not lead with its best foot forward: the language does a <em>lot</em> more than XML-to-XML transforms.</li>
<li>The section called "What is XSLT?" never answers the question posed in the header.</li>
<li>The section called "What is XSLT?" begins with a sentence that both repeats earlier material and is not germane to the header.</li>
</ul>
<p>In the attached PR, I have proposed moving several paragraphs. I have not intentionally edited them. I have also taken a stab at defining XSLT. I have tried to calibrate the Abstract so that it is both sparing, in the spirit of the XQFO abstract.</p>
<p>I don't think that what I've put in here is any way finalized. But I hope it is a step in the right direction, and a good basis for further refinement.</p>
</div></details></div>
<div class="toot" id="created-1413"><h2>Pull request #1413 created<span class="toot-id"> #created-1413</span></h2><div class="pubdate">02 Sep at 16:00:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1413">https://github.com/qt4cg/qtspecs/pull/1413</a></div><details><summary>Dispose of action QT4CG-080-05, add absolute to parse-uri</summary><div class="markup"><p>This PR disposes of my action to add <code>absolute</code> to the output of <code>fn:parse-uri</code>.</p>
<p>The rules that define an absolute URI: "has a scheme", "does not have a fragment identifier", "is a hierarchical scheme" don't fit neatly into a single place, so there are two different places where the setting is considered.</p>
<p>Because of this, I think it's simpler to set <code>absolute</code> to <code>true</code> when the URI is absolute, but not to <code>false</code> when it isn't. That could be rectified with a bit more prose.</p>
</div></details></div>
<div class="toot" id="created-1412"><h2>Pull request #1412 created<span class="toot-id"> #created-1412</span></h2><div class="pubdate">02 Sep at 15:39:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1412">https://github.com/qt4cg/qtspecs/pull/1412</a></div><details><summary>Fix typo in uri-structure-record</summary><div class="markup"><p>Fix #1411</p>
</div></details></div>
<div class="toot" id="created-1411"><h2>Issue #1411 created<span class="toot-id"> #created-1411</span></h2><div class="pubdate">31 Aug at 11:05:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1411">https://github.com/qt4cg/qtspecs/issues/1411</a></div><details><summary>uri-structure-record gives type of path-segments property as xs:string?, not xs:string*</summary><div class="markup"><p>The current spec <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#uri-structure-record">defines <code>uri-structure-record</code></a> as having a</p>
<pre><code>path-segments? 	as xs:string?
</code></pre>
<p>property, which doesn't make sense and also contradicts the example given later:</p>
<blockquote>
<p>The unescaped form is easily accessible from path-segments:</p>
<pre><code>("", "path", "to", "a/b")
</code></pre>
</blockquote>
<p>It should be <code>xs:string*</code>.</p>
</div></details></div>
<div class="toot" id="closed-1410"><h2>Issue #1410 closed<span class="toot-id"> #closed-1410</span></h2><div class="pubdate">30 Aug at 16:53:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1410">https://github.com/qt4cg/qtspecs/pull/1410</a></div><p>Ignore this PR</p></div>
<div class="toot" id="created-1410"><h2>Pull request #1410 created<span class="toot-id"> #created-1410</span></h2><div class="pubdate">30 Aug at 09:58:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1410">https://github.com/qt4cg/qtspecs/pull/1410</a></div><details><summary>Ignore this PR</summary><div class="markup"><p>Just testing</p>
</div></details></div>
<div class="toot" id="created-1409"><h2>Pull request #1409 created<span class="toot-id"> #created-1409</span></h2><div class="pubdate">29 Aug at 11:32:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1409">https://github.com/qt4cg/qtspecs/pull/1409</a></div><details><summary>1401 Rewrite of F+O section 20, Casting</summary><div class="markup"><p>Fix #1401</p>
<p>The main changes are:</p>
<ul>
<li>The three derived types xs:integer, xs:dayTimeDuration, and xs:yearMonthDuration are no longer treated as primitive for the purpose of this section. They are now treated as derived types, but given special status where necessary as "quasi-primitive".</li>
<li>In places where the F+O rules give the same result as the canonical representation in XSD 1.1, we now defer to XSD 1.1 rather than replicating the rules. Many of the rules originate with XPath 2.0, which was published before XSD 1.1, but which anticipated some of the changes in XSD 1.1, for example the use of a seven-component model for dates/times, and a two-component model for durations. XPath 3.0/3.1 failed to take advantage of the resulting opportunity for rationalisation.</li>
<li>Generally the language is a bit less terse, with more notes and examples</li>
<li>The rules have more to say about the type annotation of the result. In some places the spec appeared to imply that the type annotation on the result must be the target type; in others it appeared to imply that the type annotation must be unchanged from the source (for example 19.1.1 "If ST is xs:string or a type derived from xs:string, TV is SV. [presumably with unchanged type annotation]). The spec is now hopefully clearer that the result TV MUST be an instance of TT and MAY be an instance of some other type derived from TT, especially in the case where the value is unchanged.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1408"><h2>Issue #1408 created<span class="toot-id"> #created-1408</span></h2><div class="pubdate">29 Aug at 11:11:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1408">https://github.com/qt4cg/qtspecs/issues/1408</a></div><details><summary>The description of XPTY0117 still refers to the "function conversion rules"</summary><div class="markup"><p>The description of XPTY0117 still refers to the "function conversion rules" rather than the "coercion rules".</p>
</div></details></div>
<div class="toot" id="created-1407"><h2>Issue #1407 created<span class="toot-id"> #created-1407</span></h2><div class="pubdate">29 Aug at 09:58:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1407">https://github.com/qt4cg/qtspecs/issues/1407</a></div><details><summary>Improve the spec prose and table of content layout for types</summary><div class="markup"><p>This has been discussed on Slack. The key points are:</p>
<ol>
<li>The terminology in the table of content is mixed (Union Types vs Function Tests), focused on the grammar not the organisation.</li>
<li>The test sections (Function Test, etc.) lack definitions and overviews of the item types like is done with the other types, such as choice item types.</li>
</ol>
<p>I also think the other sections like the <strong>Subtype Relationships</strong> are largely fine as they are as they are dealing with specific rules around subtypes, coercion, etc.</p>
<p>So I propose:</p>
<ol>
<li>Adding an overview of what the function types/tests, etc. are like is done with the union types, etc.</li>
<li>Adding a note to the maps overview similar to "A map is a function of the form <code>function (xs:string) as item()*</code> that can be passed a key name and returns the value of that key entry."</li>
<li>Adding a note to the arrays overview similar to "An array is a function of the form <code>function (xs:integer) as item()*</code> that returns the items of the array at the specified index, or raises a FO.... error if the index is out of bounds."</li>
</ol>
<p>I also propose renaming and reorganizing parts of the table of contents as follows (omitting unaffected sections):</p>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-types">3 Types</a>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-sequencetype-syntax">3.1 Sequence Types</a>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-sequence-type-examples">3.1.1 Examples of Sequence Types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-sequencetype-matching">3.1.2 Sequence Type Matching</a></li>
</ul>
</li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-matching-item">3.2 Item Types</a>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#general-item-types">3.2.1 General item types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-atomic-types">3.2.2 Atomic Types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-union-types">3.2.3 Union Types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-namespace-sensitive">3.2.4 Namespace-sensitive Types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-choice-item-types">3.2.5 Δ Choice Item Types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-enumeration-types">3.2.6 Δ Enumeration Types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#node-types">3.2.7 Δ Node Types</a>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-simple-node-tests">3.2.7.1 Simple Nodes</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-element-test">3.2.7.2 Δ Elements</a>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-schema-element-test">3.2.7.2.1 Schema Elements</a></li>
</ul>
</li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-attribute-test">3.2.7.3 Δ Attributes</a>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-schema-attribute-test">3.2.7.3.1 Schema Attributes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-function-test">3.2.8 Δ Function Types</a> ~ NOTE: Covers the current 3.2.8.1 Δ Function Test section.</li>
<li>3.2.9 Maps and Records
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-map-test">3.2.9.1 Map Types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-record-test">3.2.9.2 Δ Record Types</a>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-recursive-record-tests">3.2.9.2.1 Recursive Record Tests</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-array-test">3.2.10 Array Types</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>And to make the heading names in the subtype section consistent:</p>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-sequencetype-subtype">3.3 Δ Subtype Relationships</a>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-seqtype-subtype">3.3.1 Subtypes of Sequence Types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-itemtype-subtype">3.3.2 Subtypes of Item Types</a>
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-general">3.3.2.1 General Rules</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-choice">3.3.2.2 Choice Item Types</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-atomic">3.3.2.3 Atomic and Union Types</a></li>
<li>3.3.2.4 Nodes
<ul>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-nodes">3.3.2.4.1 General Rules</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-elements">3.3.2.4.1 Elements</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-attributes">3.3.2.4.1 Attributes</a></li>
</ul>
</li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-functions">3.3.2.5 Functions</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-maps">3.3.2.6 Maps</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-arrays">3.3.2.7 Arrays</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-item-subtype-records">3.3.2.8 Records</a></li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-itemtype-subtype-aliases">3.3.2.9 Named Items</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div></details></div>
<div class="toot" id="created-1406"><h2>Pull request #1406 created<span class="toot-id"> #created-1406</span></h2><div class="pubdate">28 Aug at 13:50:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1406">https://github.com/qt4cg/qtspecs/pull/1406</a></div><details><summary>1399 clarify fixed-namespaces spec</summary><div class="markup"><p>Fix #1399.</p>
<p>The only change is to remove a sentence from <code>&lt;note&gt;...&lt;/note&gt;</code> markup.</p>
</div></details></div>
<div class="toot" id="created-1405"><h2>Pull request #1405 created<span class="toot-id"> #created-1405</span></h2><div class="pubdate">28 Aug at 06:24:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1405">https://github.com/qt4cg/qtspecs/pull/1405</a></div><p>1404 Change fn:invisible-xml grammar parameter to xs:string?</p></div>
<div class="toot" id="created-1404"><h2>Issue #1404 created<span class="toot-id"> #created-1404</span></h2><div class="pubdate">27 Aug at 21:12:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1404">https://github.com/qt4cg/qtspecs/issues/1404</a></div><details><summary>Invisible-xml function: why is $grammar of type item()?</summary><div class="markup"><p>In the <code>invisible-xml</code> function, the $grammar argument has type <code>item()?</code>. There's no evident reason why it isn't <code>xs:string?</code>; there's no clue in the specification or example what it might mean to supply something that isn't a string (or an empty sequence).</p>
<p>Note that declaring it as <code>item()</code> rather than <code>xs:string?</code> suppresses atomization of the supplied value.</p>
</div></details></div>
<div class="toot" id="created-1403"><h2>Issue #1403 created<span class="toot-id"> #created-1403</span></h2><div class="pubdate">27 Aug at 15:51:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1403">https://github.com/qt4cg/qtspecs/issues/1403</a></div><details><summary>Align AnyMapTest, AnyArrayTest and with ElementTest</summary><div class="markup"><p>I always wondered why ElementTests for <em>any element</em> can be written as <code>element()</code> which is equivalent to <code>element(*)</code> but <code>as map()</code> and <code>as array()</code> are not permitted and always have to include the asterisk (<code>map(*)</code>) .</p>
<p>This is still the case even in XPath4 and I think we should have a look, if this can be omitted.
It does not add any value IMHO, but maybe I am overlooking something important.</p>
<p>https://qt4cg.org/specifications/xquery-40/xquery-40.html#doc-xquery40-ElementTest
https://qt4cg.org/specifications/xquery-40/xquery-40.html#doc-xquery40-ArrayTest
https://qt4cg.org/specifications/xquery-40/xquery-40.html#doc-xquery40-MapTest</p>
<p>The "fix" would be as simple as</p>
<pre><code>[255]   AnyMapTest   ::=  "map" "(" "*"? ")"
</code></pre>
<pre><code>[265]   AnyArrayTest ::=  "array" "(" "*"? ")"
</code></pre>
<p>-- update after comment from @michaelhkay --</p>
<p>The same does <em>not apply</em> to FunctionTest as <code>as function()</code> specifies a zero-arity function wheras <code>as function(*)</code> matches functions of any arity.</p>
</div></details></div>
<div class="toot" id="created-1402"><h2>Pull request #1402 created<span class="toot-id"> #created-1402</span></h2><div class="pubdate">25 Aug at 11:18:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1402">https://github.com/qt4cg/qtspecs/pull/1402</a></div><details><summary>Update schema for XSLT 4.0 to include agreed syntax changes</summary><div class="markup"><p>Updates the schema for XSLT 4.0 stylesheets to accommodate changes recently agreed:</p>
<ul>
<li>Support for xsl:function/@variadic</li>
<li>Support for extensions to decimal-format properties, for example <code>percent="%:pc"</code>.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1401"><h2>Issue #1401 created<span class="toot-id"> #created-1401</span></h2><div class="pubdate">23 Aug at 10:18:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1401">https://github.com/qt4cg/qtspecs/issues/1401</a></div><details><summary>Casting from duration to string</summary><div class="markup"><p>We've just been examining the rules for casting from duration / dayTimeDuration / yearMonthDuration to string (F+O section 20.1.1) and they are fairly impenetrable: I think we could do better.</p>
<ul>
<li>We use the phrase "canonical representation as defined in XSD 1.1 part 2"; a more specific reference would be helpful. Mentioning the function <code>·durationCanonicalMap·</code> would take readers straight to the right place.</li>
<li>The actual XSD spec has one or two typos, and uses some notations that might not be immediately obvious to every reader, for example <code>|m|</code> to mean <code>abs(m)</code>.</li>
</ul>
<p>I think the best answer to this is to add non-normative examples, which are badly missing from this whole section.</p>
<p>This would probably require splitting of 20.1.1 into subsections. Alternatively, we could add examples to the string() function, which would have the benefit that we have validation machinery to check that the examples under a specific function are correct; we could point to these examples from 20.1.1.</p>
</div></details></div>
<div class="toot" id="closed-1366"><h2>Issue #1366 closed<span class="toot-id"> #closed-1366</span></h2><div class="pubdate">22 Aug at 20:36:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1366">https://github.com/qt4cg/qtspecs/issues/1366</a></div><p>In the EBNF, use explicit separator syntax</p></div>
<div class="toot" id="created-1400"><h2>Pull request #1400 created<span class="toot-id"> #created-1400</span></h2><div class="pubdate">22 Aug at 18:49:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1400">https://github.com/qt4cg/qtspecs/pull/1400</a></div><details><summary>1395 Revise rules for subtyping of choice item types</summary><div class="markup"><p>Corrects/clarifies the rules for determining whether A is a subtype of B when either or both is a choice item type.</p>
<p>Fix #1395</p>
</div></details></div>
<div class="toot" id="created-1399"><h2>Issue #1399 created<span class="toot-id"> #created-1399</span></h2><div class="pubdate">22 Aug at 14:41:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1399">https://github.com/qt4cg/qtspecs/issues/1399</a></div><details><summary>XSLT fixed-namespaces - contradictory statements</summary><div class="markup"><p>We say:</p>
<blockquote>
<p>Any one of the strings xsl, xml, xs, xsi, fn, math, map, array, err. This has the effect of binding that particular namespace prefix to the [reserved namespace] with which it is conventionally associated, whether or not the [native namespace bindings] contain a binding for this prefix.</p>
</blockquote>
<blockquote>
<p>Note: ...</p>
</blockquote>
<blockquote>
<p>If the namespace prefix is explicitly bound to a different namespace, for example xmlns:math="java:java.util.Math", then that binding takes precedence.</p>
</blockquote>
<p>Given</p>
<p><code>&lt;xsl:stylsheet fixed-namespaces="math" xmlns:math="java:java.util.Math"&gt;</code></p>
<p>The normative statement implies that "java" is bound to <code>http://www.w3.org/2005/xpath-functions/math</code>, while the note implies it is bound to <code>"java:java.util.Math"</code> -- which surely makes more sense. I suspect the intended reading of the normative sentence is "whether or not the [native namespace bindings] contain this binding; but it needs clarifying/correcting.</p>
</div></details></div>
<div class="toot" id="created-1398"><h2>Pull request #1398 created<span class="toot-id"> #created-1398</span></h2><div class="pubdate">22 Aug at 08:59:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1398">https://github.com/qt4cg/qtspecs/pull/1398</a></div><details><summary>1397 Add missing change log entry for constructor functions</summary><div class="markup"><p>Fix #1397</p>
</div></details></div>
<div class="toot" id="created-1397"><h2>Issue #1397 created<span class="toot-id"> #created-1397</span></h2><div class="pubdate">22 Aug at 08:18:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1397">https://github.com/qt4cg/qtspecs/issues/1397</a></div><details><summary>Missing change log entry for zero-arity constructor functions</summary><div class="markup"><p>We've changed constructor functions to allow arity zero, but there is no change log entry for this.</p>
<p>Issue #658, PR #662</p>
</div></details></div>
<div class="toot" id="created-1396"><h2>Issue #1396 created<span class="toot-id"> #created-1396</span></h2><div class="pubdate">21 Aug at 23:45:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1396">https://github.com/qt4cg/qtspecs/issues/1396</a></div><details><summary>Rendition of EBNF syntax scraps</summary><div class="markup"><p>In the EBNF syntax tabulation, the column width available for the RHS of productions is rather limited, leading to excessive line wrapping, especially where the entire syntax is displayed in Appendix A.</p>
<p>I haven't been entirely successful in sorting this out, but record my experiments here.</p>
<p>(a) In the CSS stylesheet qtspecs.css line 169, change the padding from 30px to 10px</p>
<p>(b) remove all the non-breaking spaces that are inserted after the production number and around the <code>::=</code> operator. (Search for <code>::=</code> in xmlspec-2016.xsl</p>
<p>(c) get rid of the tbody element that surrounds each tr by putting the productions in a prodgroup, achieved by adding a prodgroup element around the line <code>&lt;prodrecap id="BNF-Grammar-prods" ref="BNF-Grammar-prods"/&gt;</code> (line 43 of ebnf.xml)</p>
<p>Unfortunately this doesn't seem to allocate extra width to the columns, it merely creates extra whitespace to the right of the table. I can't work out why that is happening.</p>
<p>Another step would be to remove the final right-hand column containing comments, instead moving the comments to be under the RHS of the production. But the logic here is complex...</p>
<p>Finally, a pragmatic move would be to reduce the length of the longest production names, such as <code>FunctionSignatureWithDefaults</code>, which bloat the width of the LH column.</p>
</div></details></div>
<div class="toot" id="closed-1315"><h2>Issue #1315 closed<span class="toot-id"> #closed-1315</span></h2><div class="pubdate">21 Aug at 22:19:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1315">https://github.com/qt4cg/qtspecs/issues/1315</a></div><p>12 div-3</p></div>
<div class="toot" id="created-1395"><h2>Issue #1395 created<span class="toot-id"> #created-1395</span></h2><div class="pubdate">21 Aug at 16:57:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1395">https://github.com/qt4cg/qtspecs/issues/1395</a></div><details><summary>Choice item types: subtyping</summary><div class="markup"><p>We say: [with the example changed for clarity]</p>
<blockquote>
<p>3.3.2.2 Choice Item Types</p>
<p>[1] If B is a [choice item type], then A ⊆ B is true if A ⊆ M is true for some item type M among the alternatives of B.</p>
<p>[2] If A is a [choice item type], then A ⊆ B is true if M ⊆ B is true for every item type M among the alternatives of A.</p>
<p>Note:</p>
<p>Because an [enumeration type] is defined as a choice type of singleton enumerations, these rules have the consequence, for example, that enum("P", "Q") is a subtype of enum("P", "Q", "R").</p>
</blockquote>
<p>Now, the first condition [1] doesn't hold: <code>enum("P", "Q")</code> is not a subtype of <code>enum("P")</code>, nor of <code>enum("Q")</code>, nor of <code>enum("R")</code>.</p>
<p>But the second condition [2] does hold: <code>enum("P")</code> and <code>enum("Q")</code> are both subtypes of <code>enum("P", "Q", "R")</code>, under rule [1].</p>
<p>So the rules are far from clear when both A and B are choice item types.</p>
<p>I think it probably needs a combined rule.</p>
<p>(i) if both A and B are choice item types, then A ⊆ B is true if every item type a among the alternatives of A satisfies a ⊆ b for some item type b among the alternatives of B.</p>
<p>The existing two rules are really just special cases of that for singleton choices.</p>
</div></details></div>
<div class="toot" id="created-1394"><h2>Issue #1394 created<span class="toot-id"> #created-1394</span></h2><div class="pubdate">20 Aug at 16:26:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1394">https://github.com/qt4cg/qtspecs/issues/1394</a></div><details><summary>XSLT Default priority for `element(p:*)` etc</summary><div class="markup"><p>There are new possibilities for node tests used as XSLT patterns, for example <code>element(p:*)</code>, <code>element(*:local)</code>, <code>element(p:*, T)</code>, <code>element(*:local, T)</code>. These need to have default priorities assigned.</p>
</div></details></div>
<div class="toot" id="created-1393"><h2>Pull request #1393 created<span class="toot-id"> #created-1393</span></h2><div class="pubdate">19 Aug at 10:48:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1393">https://github.com/qt4cg/qtspecs/pull/1393</a></div><details><summary>1391 Change function-annotations to return a sequence</summary><div class="markup"><p>Fix #1391</p>
<ul>
<li>Changes the data model to clarify exactly what the annotations of a function item are</li>
<li>Clarifies the XQuery description of what effect annotations in the query prolog have</li>
<li>Changes the fn:function-annotations function to return a sequence of key value pairs in which there can be duplicate keys.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1392"><h2>Issue #1392 created<span class="toot-id"> #created-1392</span></h2><div class="pubdate">18 Aug at 20:57:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1392">https://github.com/qt4cg/qtspecs/issues/1392</a></div><details><summary>`element(a|b)` vs `(element(a)|element(b))`</summary><div class="markup"><p>We have introduced two syntax extensions which achieve the same effect:</p>
<p><code>element(a|b)</code> vs <code>(element(a)|element(b))</code></p>
<p>Do we actually want both?</p>
<p>If we do, I would suggest that we define <code>element(a|b)</code> as a shorthand for <code>(element(a)|element(b))</code>.</p>
<p>Are they actually equivalent? I think it's fairly clear that they match the same items. It's less clear what the subtyping rules have to say. I think each is a subtype of the other, which means they are substitutable for each other in a function signature, but it needs a lot of digging in the spec to demonstrate this. Are they equivalent from the point of view of coercion rules? I think they probably are, because no coercion actually takes place when the required type is a node type.</p>
<p>So I think there's no technical bug here just a lack of clarity. It would be easier (assuming we want to retain the syntax at all) if we defined <code>element(a|b)</code> as a shorthand for <code>(element(a)|element(b))</code>.</p>
<p>Minor editorial issues:</p>
<ul>
<li>In 3.2.7.2 example 5 is incorrect -- <code>element(xhtml:*|svg:*|mathml|*)</code> - the last <code>|</code> should be <code>:</code>.</li>
<li>In the changes section of 3.2.7.2, the <code>element(A|B)</code> syntax is not mentioned.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1391"><h2>Issue #1391 created<span class="toot-id"> #created-1391</span></h2><div class="pubdate">16 Aug at 19:54:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1391">https://github.com/qt4cg/qtspecs/issues/1391</a></div><details><summary>Annotations: duplicate names</summary><div class="markup"><p>The function <code>fn:function-annotations</code> returns a map from QNames to values, which rather assumes that a function cannot have two annotations with the same name. But there is nothing in either the data model or the XQuery language spec that imposes this restriction.</p>
</div></details></div>
<div class="toot" id="created-1390"><h2>Pull request #1390 created<span class="toot-id"> #created-1390</span></h2><div class="pubdate">16 Aug at 17:18:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1390">https://github.com/qt4cg/qtspecs/pull/1390</a></div><details><summary>1368 built in keywords improvements</summary><div class="markup"><p>Rewrite of stylesheet for generating keyword tests</p>
</div></details></div>
<div class="toot" id="created-1389"><h2>Issue #1389 created<span class="toot-id"> #created-1389</span></h2><div class="pubdate">15 Aug at 09:02:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1389">https://github.com/qt4cg/qtspecs/issues/1389</a></div><details><summary>fn:while-do: Optional error: will not terminate</summary><div class="markup"><p>In many cases, a compiler may detect that a <code>fn:while-do</code> or <code>fn:do-until</code> function call will not terminate. Trivial examples:</p>
<pre><code class="language-xquery">while-do((), true#0, identity#1)
while-do((), exists#1, fn($c) { $c, $c }
</code></pre>
<p>We should add a fixed error code that an implementation sʜᴏᴜʟᴅ (or ᴍᴀʏ?) raise when it encounters such a case. The error can be raised statically (e.g., as the result of type checks) or dynamically (when the input is not known at compile time). We could reuse <code>XQDY0054</code>.</p>
<p>In principle, the error code could also be used to reject non-terminating recursive functions:</p>
<pre><code class="language-xquery">declare function local:rec() { local:rec() };
local:rec()

declare function local:duplicate($input) {
  if(exists($input)) then $input else local:duplicate(($input, $input))
};
local:duplicate(())

let $oh := fn($my) { $my($my) }
return $oh($oh)

(: if we legalize this, see #1379 :)
declare variable $rec := fn() { $rec };
$rec()
</code></pre>
</div></details></div>
<div class="toot" id="created-1388"><h2>Pull request #1388 created<span class="toot-id"> #created-1388</span></h2><div class="pubdate">14 Aug at 10:26:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1388">https://github.com/qt4cg/qtspecs/pull/1388</a></div><details><summary>1387 Clarify the encoding rules</summary><div class="markup"><p>I decided to put this in a separte PR so that it can be reviewed in isolation. I don't expect it to be controversial, exactly, but it may require adjustment.</p>
</div></details></div>
<div class="toot" id="created-1387"><h2>Issue #1387 created<span class="toot-id"> #created-1387</span></h2><div class="pubdate">13 Aug at 15:55:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1387">https://github.com/qt4cg/qtspecs/issues/1387</a></div><details><summary>fn:build-uri: Observations</summary><div class="markup"><p>@ndw I’ll again start with a single test case, <a href="https://github.com/qt4cg/qt4tests/blob/b5c9431b6e5c7e24729a4de19aac1754b0b34c4a/fn/build-uri.xml#L296-L314">fn-build-uri-from-parse-020</a>:</p>
<pre><code class="language-xml">&lt;test-case name="fn-build-uri-from-parse-020"&gt;
    &lt;description&gt;Builds an example from the specification&lt;/description&gt;
    &lt;created by="Norm Tovey-Walsh" on="2023-03-10"/&gt;
    &lt;test&gt;fn:build-uri(map {
  "uri": "ldap://[2001:db8::7]/c=GB?objectClass?one",
  "scheme": "ldap",
  "authority": "[2001:db8::7]",
  "host": "[2001:db8::7]",
  "path": "/c=GB",
  "query": "objectClass?one",
  "query-parameters": map {
    "": "objectClass?one"
  },
  "path-segments": ("", "c=GB")
})&lt;/test&gt;
    &lt;result&gt;
      &lt;assert-eq&gt;"ldap://[2001:db8::7]/c=GB?objectClass?one"&lt;/assert-eq&gt;
    &lt;/result&gt;
  &lt;/test-case&gt;
</code></pre>
<p>I would expect <code>ldap://[2001:db8::7]/c=GB?=objectClass%3Fone</code> as result, as the spec says…</p>
<blockquote>
<p>If the <code>query-parameters</code> key exists in the map, its value must be a map. A sequence of strings is constructed from the values in the map. For each key and each <em>value</em> associated with that <em>key</em> in turn:</p>
<ul>
<li>If the <em>key</em> is the empty string, the string constructed is the <em>value</em> encoded with <code>encode-for-uri</code>.</li>
</ul>
</blockquote>
<p>…and <code>encode-for-uri('?')</code> gives us <code>%3F</code>. How do you handle that in your code?</p>
</div></details></div>
<div class="toot" id="created-1386"><h2>Pull request #1386 created<span class="toot-id"> #created-1386</span></h2><div class="pubdate">13 Aug at 10:43:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1386">https://github.com/qt4cg/qtspecs/pull/1386</a></div><details><summary>1382 add error code XTSE4040</summary><div class="markup"><p>Fix #1382</p>
</div></details></div>
<div class="toot" id="created-1385"><h2>Issue #1385 created<span class="toot-id"> #created-1385</span></h2><div class="pubdate">13 Aug at 09:04:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1385">https://github.com/qt4cg/qtspecs/issues/1385</a></div><details><summary>Quantifier expressions: optional positional argument</summary><div class="markup"><p>This has been requested multiple times before (albeit not in this repository): What about adding a positional argument to quantifier expressions? It it simple to implement, and it would allow us to do things like…</p>
<pre><code class="language-xquery">every $item at $pos in $input satisfies $item = $pos * 2
</code></pre>
<p>…which would be equivalent to…</p>
<pre><code class="language-xquery">every($input, fn($item, $pos) { $item = $pos * 2 })
</code></pre>
<p>…and much better to read than e.g.…</p>
<pre><code class="language-xquery">not((for $item at $pos in $input return $item = $pos * 2) = false())
</code></pre>
</div></details></div>
<div class="toot" id="created-1384"><h2>Pull request #1384 created<span class="toot-id"> #created-1384</span></h2><div class="pubdate">13 Aug at 08:49:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1384">https://github.com/qt4cg/qtspecs/pull/1384</a></div><details><summary>1316 Type declarations in quantified expressions</summary><div class="markup"><p>Fix #1316</p>
<ol>
<li>Quantified expressions now allow a type declaration in both XQuery and XPath</li>
<li>A type declaration now induces coercion of the supplied value to the required type</li>
</ol>
</div></details></div>
<div class="toot" id="created-1383"><h2>Pull request #1383 created<span class="toot-id"> #created-1383</span></h2><div class="pubdate">12 Aug at 21:44:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1383">https://github.com/qt4cg/qtspecs/pull/1383</a></div><details><summary>1374 - allow static error for duplicate keys</summary><div class="markup"><p>Fix #1374</p>
</div></details></div>
<div class="toot" id="created-1382"><h2>Issue #1382 created<span class="toot-id"> #created-1382</span></h2><div class="pubdate">12 Aug at 17:15:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1382">https://github.com/qt4cg/qtspecs/issues/1382</a></div><details><summary>Missing XSLT error code</summary><div class="markup"><p>§2.7.4 says:</p>
<p>If R has an as attribute, the SequenceType S declared by R must be a subtype of T, according to the relationship subtype(S, T) defined in [].</p>
<p>There is no allocated error code, I propose to allocate XTSE4040.</p>
</div></details></div>
<div class="toot" id="created-1381"><h2>Issue #1381 created<span class="toot-id"> #created-1381</span></h2><div class="pubdate">12 Aug at 15:09:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1381">https://github.com/qt4cg/qtspecs/issues/1381</a></div><details><summary>fn:parse-uri: Observations (cont.)</summary><div class="markup"><p>The rules for <code>fn:parse-uri</code> say:</p>
<blockquote>
<p>If the fragment is the empty string, it is discarded and the fragment is the empty sequence.</p>
</blockquote>
<p>However, the result of <a href="https://github.com/qt4cg/qt4tests/blob/4659dfdcc92ac57c9a7f482a1ec9f3f509020f52/fn/parse-uri.xml#L746-L762">fn-parse-uri-043</a> contains an empty fragment string:</p>
<pre><code class="language-xml">&lt;test-case name="fn-parse-uri-043"&gt;
    &lt;description&gt;Parses a URI ending in "#"&lt;/description&gt;
    &lt;created by="Michael Kay" on="2023-10-27"/&gt;
    &lt;test&gt;fn:parse-uri("https://qt4cg.org/specifications/xpath-functions-40/Overview.html#")&lt;/test&gt;
    &lt;result&gt;
      &lt;assert-deep-eq&gt;map {
        "authority": "qt4cg.org",
        "fragment": "",
        "host": "qt4cg.org",
        "path": "/specifications/xpath-functions-40/Overview.html",
        "path-segments": ("", "specifications", "xpath-functions-40", "Overview.html"),
        "scheme": "https",
        "hierarchical": true(),
        "uri": "https://qt4cg.org/specifications/xpath-functions-40/Overview.html#"
        }&lt;/assert-deep-eq&gt;
    &lt;/result&gt;
  &lt;/test-case&gt;
</code></pre>
<p>I assume the tests should be updated?</p>
<p>With regard to the spec, I would suggest adding the normalization rule to query parameters:</p>
<blockquote>
<p>If the <em>query</em> is the empty string, it is discarded and the <em>query</em> is the empty sequence.</p>
</blockquote>
</div></details></div>
<div class="toot" id="created-1380"><h2>Pull request #1380 created<span class="toot-id"> #created-1380</span></h2><div class="pubdate">12 Aug at 12:50:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1380">https://github.com/qt4cg/qtspecs/pull/1380</a></div><details><summary>1320 Attempt to resolve a bug in parse-uri</summary><div class="markup"><p>Fix #1320</p>
<p>(A speculative PR in the hope that my proposed resolution is acceptable.)</p>
</div></details></div>
<div class="toot" id="created-1379"><h2>Issue #1379 created<span class="toot-id"> #created-1379</span></h2><div class="pubdate">12 Aug at 11:30:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1379">https://github.com/qt4cg/qtspecs/issues/1379</a></div><details><summary>Circular dependencies: XQDY0054 vs. XPST0008 vs. optional errors</summary><div class="markup"><p>It remains a challenge (for me) to understand how the specification expects implementations to handle circular dependencies. Sorry in advance for mixing up the specification, tests and the behavior of Saxon (it basically demonstrates my confusion):</p>
<h3>Error Codes</h3>
<p>The definition of <code>err:XPST0008</code> is:</p>
<blockquote>
<p>It is a <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#dt-static-error">static error</a> if an expression refers to an element name, attribute name, schema type name, namespace prefix, or variable name that is not defined in the <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#dt-static-context">static context</a>, except for an ElementName in an <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#doc-xquery40-ElementTest">ElementTest</a> or an AttributeName in an <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#doc-xquery40-AttributeTest">AttributeTest</a>.</p>
</blockquote>
<p>The definition of <code>err:XQDY0054</code> is:</p>
<blockquote>
<p>It is a <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#dt-dynamic-error">dynamic error</a> if a cycle is encountered in the definition of a module’s dynamic context components, for example because of a cycle in variable declarations.</p>
</blockquote>
<h3>Queries</h3>
<p>The following test case <a href="https://github.com/qt4cg/qt4tests/blob/4659dfdcc92ac57c9a7f482a1ec9f3f509020f52/prod/VarDecl.xml#L1527C21-L1537">K-InternalVariablesWith-15b</a> expects <code>XPST0008</code> as error:</p>
<pre><code class="language-xquery">declare variable $var1 := $var1;
true()
</code></pre>
<p>I would expect <code>XQDY0054</code> as error, and <code>true()</code> to be a valid alternative, as <code>$var1</code> is indeed defined in the static context. Think of a similar query (for which I would as well expect <code>XQDY0054</code> or <code>true()</code> to be correct results):</p>
<pre><code class="language-xquery">declare variable $var1 := $var2;
declare variable $var2 := $var1;
true()
</code></pre>
<p>Saxon outputs  the following error for the first query…</p>
<blockquote>
<p>[XPST0008] Circular definition of global variable: $var1 uses $var1.</p>
</blockquote>
<p>…which is confusing in itself, as the error code and the message do not really match. The output of the second query is consistent:</p>
<blockquote>
<p>[XQDY0054] Circular definition of global variable: $var2 uses $var1, which uses $var2.</p>
</blockquote>
<p>Another test case that expects <code>XQDY0054</code> is <a href="https://github.com/qt4cg/qt4tests/blob/4659dfdcc92ac57c9a7f482a1ec9f3f509020f52/prod/VarDecl.xml#L1582-L1591">K-InternalVariablesWith-17a</a>:</p>
<pre><code class="language-xquery">declare variable $var := local:func1();
declare function local:func1() { local:func2($var) };
declare function local:func2($arg2) { 1 };
true()
</code></pre>
<p>Again, I would expect <code>true()</code> to be a valid alternative, in <code>K-InternalVariablesWith-17</code> (the original XQuery 1.0 test), the rational for reporting an error was…</p>
<blockquote>
<p>A prolog variable having a circular dependency, by having a variable reference in a call site argument. This is an error even though the variable isn't used, because implementations cannot skip reporting static errors.</p>
</blockquote>
<p>…but we now have a dynamic error.</p>
<h3>Suggestions</h3>
<ol>
<li><code>XPST0008</code> should only be raised if no declaration exists for that variable in the query prolog.</li>
<li><code>XQDY0054</code> should be optional for cases in which the affected code is never evaluated.</li>
</ol>
<p>I would like to hear some feedback on this, and I will be happy to move the corresponding questions to <code>qt4tests</code> and/or the Saxon bug tracker if we believe that the spec is comprehensive enough.</p>
</div></details></div>
<div class="toot" id="closed-1376"><h2>Issue #1376 closed<span class="toot-id"> #closed-1376</span></h2><div class="pubdate">12 Aug at 10:09:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1376">https://github.com/qt4cg/qtspecs/issues/1376</a></div><p>User defined operators</p></div>
<div class="toot" id="created-1378"><h2>Pull request #1378 created<span class="toot-id"> #created-1378</span></h2><div class="pubdate">12 Aug at 10:07:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1378">https://github.com/qt4cg/qtspecs/pull/1378</a></div><details><summary>1375 bugs in pattern syntax</summary><div class="markup"><ol>
<li>Changes the pattern syntax to allow any EQName to be used for function calls; the constraints on which functions can be called are defined outside the actual grammar.</li>
<li>Reinstate root() as a permitted function</li>
<li>Allow <code>doc()/id()</code> without requiring parentheses around the second function call</li>
<li>Stylesheet changes to point external spec references at the 4.0 specs rather than 3.0.</li>
</ol>
<p>Fix #1375</p>
</div></details></div>
<div class="toot" id="closed-1377"><h2>Issue #1377 closed<span class="toot-id"> #closed-1377</span></h2><div class="pubdate">12 Aug at 08:50:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1377">https://github.com/qt4cg/qtspecs/pull/1377</a></div><p>Fix inconsistent definition of return-type-ref-occurs</p></div>
<div class="toot" id="created-1377"><h2>Pull request #1377 created<span class="toot-id"> #created-1377</span></h2><div class="pubdate">12 Aug at 08:50:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1377">https://github.com/qt4cg/qtspecs/pull/1377</a></div><details><summary>Fix inconsistent definition of return-type-ref-occurs</summary><div class="markup"><p>The DTD defines it as a IDREF type which it clearly isn't.</p>
</div></details></div>
<div class="toot" id="created-1376"><h2>Issue #1376 created<span class="toot-id"> #created-1376</span></h2><div class="pubdate">12 Aug at 07:35:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1376">https://github.com/qt4cg/qtspecs/issues/1376</a></div><details><summary>User defined operators</summary><div class="markup"><p>This came up on stack overflow and is probable worth a few comments on.</p>
<p>The motivation was actually to implement something called applicative style programming, but the essence of it, is it requires operators.</p>
<p><a href="https://stackoverflow.com/questions/78851758/user-defined-xpath-operators-in-xslt/78856925?noredirect=1#comment139036715_78856925">stack overflow question</a></p>
<p>The simplest (to me) mechanism is the one used in Haskell (to turn a function into an operator) whereby</p>
<p><a href="https://wiki.haskell.org/Infix_operator">haskell backtick mechanism</a></p>
<pre><code>Prelude&gt; let concatPrint x y = putStrLn $ (++) x y
Prelude&gt; concatPrint "a" "b"
ab
Prelude&gt; "a" `concatPrint` "b"
ab

</code></pre>
<p>the 1st line defines a function
the 2nd line calls the function
the 3rd line uses the function as a operator by wrapping it in backticks.</p>
<p>I don't believe anything 'clever' happens its simply a mechanical rewriting of the expressions before its parsed.
As Haskell is curried it generalises naturally to n parameters, in XPath you'd probably restrict it to two (and  maybe one) parameters.</p>
</div></details></div>
<div class="toot" id="created-1375"><h2>Issue #1375 created<span class="toot-id"> #created-1375</span></h2><div class="pubdate">11 Aug at 15:52:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1375">https://github.com/qt4cg/qtspecs/issues/1375</a></div><details><summary>XSLT: names of functions in pattern</summary><div class="markup"><p>The spec says</p>
<blockquote>
<p>In a [FunctionCallP], the EQName used for the function name must have local part doc, id, element-with-id, key, or root, and must use the [standard function namespace] either explicitly or implicitly.</p>
</blockquote>
<p>But the grammar does not allow an EQName, it only allows:</p>
<pre><code>[10]  FunctionCallP  ::=  OuterFunctionName&nbsp;&nbsp;....
[11]  OuterFunctionName  ::=  "doc" | "id" | "element-with-id" | "key" |&nbsp;&nbsp;URIQualifiedName

</code></pre>
<p>For example the grammar does not allow <code>fn:doc('a:xml')</code> when fn is bound to the conventional namespace.</p>
<p>Also: the XSLT 3.0 grammar allows the <code>root()</code> pattern, but the 4.0 grammar does not.</p>
</div></details></div>
<div class="toot" id="created-1374"><h2>Issue #1374 created<span class="toot-id"> #created-1374</span></h2><div class="pubdate">10 Aug at 13:32:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1374">https://github.com/qt4cg/qtspecs/issues/1374</a></div><details><summary>Duplicate keys in map constructor</summary><div class="markup"><p>We say (concerning map constructors)</p>
<p>If two or more entries have the [same key value] then a dynamic error is raised [[err:XQDY0137].</p>
<p>I think we should say:</p>
<p>if every MapKeyExpr is a Literal then this error SHOULD be reported as a static error.</p>
</div></details></div>
<div class="toot" id="closed-1365"><h2>Issue #1365 closed<span class="toot-id"> #closed-1365</span></h2><div class="pubdate">08 Aug at 17:02:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1365">https://github.com/qt4cg/qtspecs/issues/1365</a></div><p>Occurrence indicator meaning "exactly one"</p></div>
<div class="toot" id="created-1373"><h2>Issue #1373 created<span class="toot-id"> #created-1373</span></h2><div class="pubdate">07 Aug at 15:31:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1373">https://github.com/qt4cg/qtspecs/issues/1373</a></div><details><summary>XQFO: Editorial</summary><div class="markup"><ul>
<li>Wrong example: <code>hash("password123" || $salt, "sha-1234567")</code></li>
<li>The following test lacks a <code>use="v-deep-equal-at"</code> attribute:</li>
</ul>
<pre><code class="language-xquery">deep-equal(
  $at//name[@first="Bob"], 
  $at//name[@last="Barker"],
  options := { 'items-equal': op('is') } 
)
</code></pre>
<ul>
<li><code>graphemes($crlf)</code>: Result should be <code>char('\r') || char('\n')</code> instead of <code>$crlf</code> (otherwise, test doesn’t work)</li>
<li>fix <code>fn:unix-time</code> example: <code>1969-12-31T23:59:59.999Z</code> (thanks @johnlumley)</li>
<li>TODO for <code>fn:replicate</code> can be dropped</li>
<li><code>fn:parse-uri</code>: Remove example for <code>FOUR0002</code>.</li>
</ul>
<p>…to be continued</p>
</div></details></div>
<div class="toot" id="created-1372"><h2>Issue #1372 created<span class="toot-id"> #created-1372</span></h2><div class="pubdate">07 Aug at 15:09:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1372">https://github.com/qt4cg/qtspecs/issues/1372</a></div><details><summary>Unknown option: FORG0013 → XPTY0004</summary><div class="markup"><p>I would suggest dropping https://qt4cg.org/specifications/xpath-functions-40/Overview.html#ERRFORG0013 and replacing it with a type error, <code>XPTY0004</code>. This way, it can be perfomed during the type checks (which may also be the best solution if we define options as records).</p>
<p>I’ll be glad to create the PR for the spec and the tests.</p>
</div></details></div>
<div class="toot" id="created-1371"><h2>Issue #1371 created<span class="toot-id"> #created-1371</span></h2><div class="pubdate">07 Aug at 12:16:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1371">https://github.com/qt4cg/qtspecs/issues/1371</a></div><details><summary>(type)switch: braces after `case` keyword</summary><div class="markup"><p>As suggested by Pieter Lamers in https://app.slack.com/client/T011VK9115Z/C01GVC3JLHE, we could alternatively allow curly braces in <code>case</code> clauses:</p>
<pre><code class="language-xquery">switch($n) {
  case 1  { 'one' }
  case 2  { 'two' }
  default { 'dunno' }
}
</code></pre>
<p>This would be in aligment with the new syntax alternative for <code>if</code> expressions: <code>if($n) { 'one' } else { 'two '}</code>.</p>
</div></details></div>
<div class="toot" id="created-1370"><h2>Pull request #1370 created<span class="toot-id"> #created-1370</span></h2><div class="pubdate">05 Aug at 14:08:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1370">https://github.com/qt4cg/qtspecs/pull/1370</a></div><details><summary>1369 fn:round: rounding-mode → mode</summary><div class="markup"><p>Closes #1369</p>
<p>…no need to update any tests.</p>
</div></details></div>
<div class="toot" id="created-1369"><h2>Issue #1369 created<span class="toot-id"> #created-1369</span></h2><div class="pubdate">05 Aug at 13:39:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1369">https://github.com/qt4cg/qtspecs/issues/1369</a></div><details><summary>fn:round: `rounding-mode` → `mode`?</summary><div class="markup"><p>We could rename the new <code>$rounding-mode</code> parameter of <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-round"><code>fn:round</code></a> to <code>$mode</code> (analogous to <code>$precision</code>, which isn’t <code>$rounding-precision</code>).</p>
<p>If it sounds reasonable, it’s very probable I’d be able to take charge of this.</p>
</div></details></div>
<div class="toot" id="created-1368"><h2>Issue #1368 created<span class="toot-id"> #created-1368</span></h2><div class="pubdate">05 Aug at 11:23:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1368">https://github.com/qt4cg/qtspecs/issues/1368</a></div><details><summary>Further improvements to BuiltInKeywords test needed</summary><div class="markup"><ol>
<li>The test generated for fn:seconds() is incorrect (can't handle required type xs:decimal?)</li>
<li>An incorrect argument is supplied for fn:pin()</li>
</ol>
</div></details></div>
<div class="toot" id="created-1367"><h2>Pull request #1367 created<span class="toot-id"> #created-1367</span></h2><div class="pubdate">04 Aug at 00:35:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1367">https://github.com/qt4cg/qtspecs/pull/1367</a></div><details><summary>1321 leading lone slash</summary><div class="markup"><p>Fix #1321</p>
<p>Fixed as suggested in the issue. I have added a list of tokens that can appear at the start of a RelativePathExpr, produced by analyzing the grammar using a custom stylesheet leading-tokens.xsl which is available for reuse, but not integrated into the build.</p>
</div></details></div>
<div class="toot" id="created-1366"><h2>Issue #1366 created<span class="toot-id"> #created-1366</span></h2><div class="pubdate">02 Aug at 10:50:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1366">https://github.com/qt4cg/qtspecs/issues/1366</a></div><details><summary>In the EBNF, use explicit separator syntax</summary><div class="markup"><p>We could pick up the <code>++</code> and <code>**</code> operators from Invisible XML for defining "a sequence of [one|zero] or more Xs separated by Ys".</p>
<p>So for example</p>
<p><code>Annotation ::= "%"&nbsp;&nbsp;EQName&nbsp;("("&nbsp;&nbsp;AnnotationValue&nbsp;(","&nbsp;AnnotationValue)* ")")?</code></p>
<p>changes to</p>
<p><code>Annotation ::= "%"&nbsp;&nbsp;EQName&nbsp;("("&nbsp;&nbsp;(AnnotationValue&nbsp;++ ",") ")")?</code></p>
<p>and</p>
<p><code>TypedFunctionTest ::= ("function" | "fn") "(" (SequenceType ("," SequenceType)*)? ")" "as" SequenceType</code></p>
<p>becomes</p>
<p><code>TypedFunctionTest ::= ("function" | "fn") "(" (SequenceType ** ",") ")" "as" SequenceType</code></p>
<p>Note that there is an impact on anyone who uses the machine-readable XML version of our grammar. However, the current version could easily be generated by preprocessing.</p>
</div></details></div>
<div class="toot" id="created-1365"><h2>Issue #1365 created<span class="toot-id"> #created-1365</span></h2><div class="pubdate">02 Aug at 10:05:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1365">https://github.com/qt4cg/qtspecs/issues/1365</a></div><details><summary>Occurrence indicator meaning "exactly one"</summary><div class="markup"><p>There are several reasons it would be good to have an occurrence indicator meaning "exactly one".</p>
<ol>
<li>It's generally a good idea if there is explicit syntax that's equivalent to the default: it enables you to write code that is more explicit about the fact that you have chosen the default option; it makes code generation easier.</li>
<li>Sometimes you need to write an ItemType in parentheses to avoid a following <code>?</code> or <code>*</code> being interpreted as an occurrence indicator. Having an explicit occurrence indicator for "exactly one" would avoid this need.</li>
<li>It makes it clear that you are writing a SequenceType, not an ItemType.</li>
</ol>
<p>I don't expect this to be used very often, but I think it would be useful to allow it. I propose using U+00B9, superscript 1.</p>
<p>For example, <code>as="xs:integer¹"</code></p>
<p>We can now write:</p>
<p><code>function($a, $b) as xs:integer¹ *</code></p>
<p>to mean a sequence of functions each returning a single integer; while writing</p>
<p><code>array(xs:integer¹ )</code></p>
<p>just serves to remind the reader that  the array entries must be single integers.</p>
</div></details></div>
<div class="toot" id="closed-1014"><h2>Issue #1014 closed<span class="toot-id"> #closed-1014</span></h2><div class="pubdate">02 Aug at 10:02:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1014">https://github.com/qt4cg/qtspecs/issues/1014</a></div><p>Predicates, sequences of numbers: Feedback</p></div>
<div class="toot" id="created-1364"><h2>Pull request #1364 created<span class="toot-id"> #created-1364</span></h2><div class="pubdate">02 Aug at 09:58:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1364">https://github.com/qt4cg/qtspecs/pull/1364</a></div><details><summary>1314 Change to type() syntax to fix ambiguity</summary><div class="markup"><p>Fix #1314</p>
</div></details></div>
<div class="toot" id="created-1363"><h2>Issue #1363 created<span class="toot-id"> #created-1363</span></h2><div class="pubdate">02 Aug at 09:00:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1363">https://github.com/qt4cg/qtspecs/issues/1363</a></div><details><summary>map:get and array:get</summary><div class="markup"><p>I find the callback/fallback arguments to <code>map:get</code> and <code>array:get</code> rather unsatisfactory. They complicate the specification, and the use cases and examples are tenuous. I don't think they offer a great deal of convenience over alternative ways of achieving the same effect.</p>
<p>I would like to propose scrapping these arguments, reverting to the 3.1 specification, and adding a new pair of functions <code>map:try-get()</code> and <code>array:try-get()</code> with a return type of <code>record(found as xs:boolean, value? as item()*)</code>.</p>
<p>The specification for map:try-get($map, $key) is</p>
<pre><code>if (map:contains($map, $key))
then {"found":true(), "value":map:get($map, $key)}
else {"found":false()}
</code></pre>
<p>The specification for array:try-get($array, $index) is</p>
<pre><code>if ($index = 1 to array:size($array))
then {"found":true(), "value":array:get($map, $index)}
else {"found":false()}
</code></pre>
<p>Though it would probably be better to define it the other way around, that is define <code>*:get</code> in terms of <code>*:try-get</code>.</p>
<p>The name <code>try-get</code> comes from C#. I'm not immensely enthusiastic about it, but it will get some name recognition. I would probably prefer <code>test-get</code>.</p>
<p>One of the aims, of course, is to enable you to find whether a value exists and get the value in a single call to the map (so the key only gets hashed once, for example). This benefit will only materialise if <code>?found</code> and <code>?value</code> are implemented without requiring another full map lookup, that is if access to fixed fields in simple record types is optimised. That's a challenge we leave to implementors. We're not quite there yet in Saxon - we do have a map implementation in which the fields occupy fixed slot positions, but the static inferencing to reference fields by slot number isn't quite there yet.</p>
</div></details></div>
<div class="toot" id="closed-1362"><h2>Issue #1362 closed<span class="toot-id"> #closed-1362</span></h2><div class="pubdate">02 Aug at 07:51:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1362">https://github.com/qt4cg/qtspecs/pull/1362</a></div><p>Update version of DeltaXML</p></div>
<div class="toot" id="created-1362"><h2>Pull request #1362 created<span class="toot-id"> #created-1362</span></h2><div class="pubdate">02 Aug at 07:51:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1362">https://github.com/qt4cg/qtspecs/pull/1362</a></div><details><summary>Update version of DeltaXML</summary><div class="markup"><p>This (should!) fix the diffs</p>
</div></details></div>
<div class="toot" id="created-1361"><h2>Pull request #1361 created<span class="toot-id"> #created-1361</span></h2><div class="pubdate">02 Aug at 07:45:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1361">https://github.com/qt4cg/qtspecs/pull/1361</a></div><details><summary>1337 Atomic value becomes atomic item</summary><div class="markup"><p>Fix #1337</p>
<p>I was half-expecting this change to have repercussions, but in practice it seems very clean.</p>
<p>There are probably more places that should change, e.g. use "xs:boolean item" rather than "xs:boolean value", but we can deal with them as we come to them.</p>
</div></details></div>
<div class="toot" id="created-1360"><h2>Pull request #1360 created<span class="toot-id"> #created-1360</span></h2><div class="pubdate">01 Aug at 21:41:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1360">https://github.com/qt4cg/qtspecs/pull/1360</a></div><details><summary>1348 Some grammar simplifications</summary><div class="markup"><p>Fix #1348</p>
<p>Makes some simplifications to the grammar rules, including some of those suggested.</p>
<p>I've avoided removing productions that are referenced by name in the prose of the spec; these names provide a useful handle to relate the syntax to the semantics.</p>
<p>I would love to introduce BNF for a comma-separated list. Invisible XML uses</p>
<p><code>XX ** ","</code></p>
<p>for zero or more occurrences of XX, separated by ",", and</p>
<p><code>XX ++ ","</code></p>
<p>for one or more occurrences of XX, separated by ",", and</p>
</div></details></div>
<div class="toot" id="closed-1356"><h2>Issue #1356 closed<span class="toot-id"> #closed-1356</span></h2><div class="pubdate">01 Aug at 20:13:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1356">https://github.com/qt4cg/qtspecs/issues/1356</a></div><p>Names of private functions in XQuery library modules</p></div>
<div class="toot" id="created-1359"><h2>Pull request #1359 created<span class="toot-id"> #created-1359</span></h2><div class="pubdate">01 Aug at 20:12:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1359">https://github.com/qt4cg/qtspecs/pull/1359</a></div><details><summary>1346 Fix minor typos in format-number</summary><div class="markup"><p>Fix #1346</p>
</div></details></div>
<div class="toot" id="created-1358"><h2>Pull request #1358 created<span class="toot-id"> #created-1358</span></h2><div class="pubdate">01 Aug at 09:29:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1358">https://github.com/qt4cg/qtspecs/pull/1358</a></div><details><summary>959 fn:unix-time</summary><div class="markup"><p>Closes #959</p>
</div></details></div>
<div class="toot" id="created-1357"><h2>Issue #1357 created<span class="toot-id"> #created-1357</span></h2><div class="pubdate">01 Aug at 08:36:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1357">https://github.com/qt4cg/qtspecs/issues/1357</a></div><details><summary>Rendering of new vs. updated features</summary><div class="markup"><p>In previous versions of the XQFO drafts, it was possible to differentiate between NEW and UPDATED functions. It would be nice if this distinction could be preserved:</p>
<p><img width="300" src="https://github.com/user-attachments/assets/dbb7f726-55de-4a6a-9eaa-c39c50689776">&nbsp;&nbsp;&nbsp;&nbsp;<img width="300" src="https://github.com/user-attachments/assets/074b4863-481d-482a-b608-ce24184e159f"></p>
</div></details></div>
<div class="toot" id="created-1356"><h2>Issue #1356 created<span class="toot-id"> #created-1356</span></h2><div class="pubdate">31 Jul at 23:36:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1356">https://github.com/qt4cg/qtspecs/issues/1356</a></div><details><summary>Names of private functions in XQuery library modules</summary><div class="markup"><p>Is there any good reason for the rule that the name of a private function or variable declared in a library module must be in the target namespace of the module? I think it makes sense to allow:</p>
<ul>
<li>private functions to be in any non-reserved namespace</li>
<li>private variables to be in any non-reserved namespace or in no namespace</li>
</ul>
<p>The reason I ask is that I'm looking at what the rule should be for item type declarations.</p>
</div></details></div>
<div class="toot" id="closed-1354"><h2>Issue #1354 closed<span class="toot-id"> #closed-1354</span></h2><div class="pubdate">31 Jul at 19:05:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1354">https://github.com/qt4cg/qtspecs/pull/1354</a></div><p>1202 Change Log for F&amp;O spec</p></div>
<div class="toot" id="closed-1202"><h2>Issue #1202 closed<span class="toot-id"> #closed-1202</span></h2><div class="pubdate">31 Jul at 19:05:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1202">https://github.com/qt4cg/qtspecs/issues/1202</a></div><p>XQFO: Rendering of new/updated functions</p></div>
<div class="toot" id="created-1355"><h2>Pull request #1355 created<span class="toot-id"> #created-1355</span></h2><div class="pubdate">31 Jul at 16:41:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1355">https://github.com/qt4cg/qtspecs/pull/1355</a></div><details><summary>1351 Add "declare record" in XQuery</summary><div class="markup"><p>This PR does the following:</p>
<ul>
<li>Renames MapTest, ArrayTest, RecordTest, FunctionTest to MapType, etc (suggested in #1351 and elsewhere)</li>
<li>Changes the XQuery item type declaration syntax to "declare type NNNN" rather than "declare item type" or "declare item-type", and fixes examples accordingly (also in #1351)</li>
<li>Provides a separate syntax for declaring record types (as proposed in issue #1277). This declaration creates both a named item type and a constructor function for items of that type, with provision for default values. Only this kind of record type can be recursive.</li>
</ul>
<p>I haven't yet taken on board the suggestion of changing the data model so that records are maps with a type annotation. I'm not totally opposed to the idea, but it's a significant change that needs more exploration, in particular the impact on all the map-related functions.</p>
<p>Fix #1351
Fix #1277</p>
<p>Follow-up work is needed to make equivalent changes for XSLT.</p>
</div></details></div>
<div class="toot" id="created-1354"><h2>Pull request #1354 created<span class="toot-id"> #created-1354</span></h2><div class="pubdate">31 Jul at 10:56:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1354">https://github.com/qt4cg/qtspecs/pull/1354</a></div><details><summary>1202 Change Log for F&amp;O spec</summary><div class="markup"><p>Fix #1202</p>
<p>Since the changes are purely editorial but are likely to cause conflicts with technical changes, I would request an expedited review.</p>
</div></details></div>
<div class="toot" id="created-1353"><h2>Pull request #1353 created<span class="toot-id"> #created-1353</span></h2><div class="pubdate">30 Jul at 17:25:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1353">https://github.com/qt4cg/qtspecs/pull/1353</a></div><details><summary>1347 Add escape-solidus option to xml-to-json function</summary><div class="markup"><p>Fix #1347</p>
</div></details></div>
<div class="toot" id="created-1352"><h2>Pull request #1352 created<span class="toot-id"> #created-1352</span></h2><div class="pubdate">30 Jul at 16:53:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1352">https://github.com/qt4cg/qtspecs/pull/1352</a></div><details><summary>1350 Fix signature for unparsed-text-available</summary><div class="markup"><p>Fix #1350</p>
</div></details></div>
<div class="toot" id="created-1351"><h2>Issue #1351 created<span class="toot-id"> #created-1351</span></h2><div class="pubdate">30 Jul at 09:21:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1351">https://github.com/qt4cg/qtspecs/issues/1351</a></div><details><summary>declare item type → item-type</summary><div class="markup"><p><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-recursive-record-tests">3.2.8.4 Recursive Record Tests</a> presents the following declaration:</p>
<pre><code class="language-xquery">declare item type my:list as record(value as item()*, next? as my:list);
</code></pre>
<p>It should probably be <code>declare item-type</code>.</p>
<p>Personally, I would prefer to just use <code>declare type</code> (I guess we do not plan to introduce “sequence type” declarations?).</p>
</div></details></div>
<div class="toot" id="created-1350"><h2>Issue #1350 created<span class="toot-id"> #created-1350</span></h2><div class="pubdate">30 Jul at 08:54:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1350">https://github.com/qt4cg/qtspecs/issues/1350</a></div><details><summary>unparsed-text-available() signature</summary><div class="markup"><p>The $options parameter of unparsed-text-available() should have the same item type as in unparsed-text(), that is either a string or a map.</p>
</div></details></div>
<div class="toot" id="created-1349"><h2>Issue #1349 created<span class="toot-id"> #created-1349</span></h2><div class="pubdate">29 Jul at 20:40:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1349">https://github.com/qt4cg/qtspecs/issues/1349</a></div><details><summary>Nothing</summary><div class="markup"><p>In the Data Model we are missing an important concept - the concept of <strong><em>Nothing</em></strong>.</p>
<p>It has been believed that the type <code>item()*</code> is sufficient to express all results that can be produced or expressed in the evaluation of an XPath expression.</p>
<p>In reality, there are XPath expressions whose result cannot be expressed unambiguously. Consider:</p>
<pre><code class="language-xq">array:values([ (), 1, (2 to 4), [ 5 ] ])
</code></pre>
<p>According to the <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-array-values">F&amp;O 4.0 specification</a></em></strong>, the result must be:</p>
<p><code>(1, 2, 3, 4, [ 5 ])</code></p>
<p>And here the value  of the first array member - <code>()</code> -  is not returned.</p>
<p>Thus, in the general case, <code>array:size($ar)</code> is not equal to <code>count(array:values($ar))</code>,</p>
<p>and <code>array:size($ar) - count(array:values($ar))</code> can be any non-negative integer.</p>
<p><img src="https://github.com/user-attachments/assets/4d29bed7-f287-465c-90b6-fd431602c94b" alt="image"></p>
<p>At present there isn't a way in XPath to represent the <strong><em>lack of value</em></strong>. The empty sequence <code>()</code> <strong>is</strong> a value and thus using it to represent the <strong><em>lack of value</em></strong> is wrong. Also, if the <strong>lack of value</strong> is represented by <code>()</code> then this is completely lost/destroyed/vanishes when concatenated with other sequences.</p>
<p>The expression:</p>
<p><code>deep-equal([ ], [ () ])</code></p>
<p>evaluates to <code>false()</code>, because the first array-argument has no members (contains <strong><em>nothing</em></strong>), and the second array-argument has one member - the value <code>()</code>.</p>
<p>Thus, <code>()</code> is not <strong><em>nothing</em></strong>.</p>
<p>It is time for us to be able to represent <strong><em>nothing</em></strong>  in an explicit way.</p>
<p>We need a type <em><strong><code>nothing</code></strong></em>, or maybe <strong><em><code>xs:nothing</code></em></strong> that tells us that an expression may not evaluate to any value, even not to <strong><code>()</code></strong>.</p>
<p>Then we will be able to express correctly the type of a lookup expression as    <strong>item()* | nothing</strong></p>
</div></details></div>
<div class="toot" id="created-1348"><h2>Issue #1348 created<span class="toot-id"> #created-1348</span></h2><div class="pubdate">25 Jul at 09:18:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1348">https://github.com/qt4cg/qtspecs/issues/1348</a></div><details><summary>Grammar rules: redundancies</summary><div class="markup"><p>I’m a humble user of our grammar rules, and I’m definitely not an expert when it comes to their definition (my main obstacle is that changes to the XQuery grammar rules need to be compatible with the XPath and possibly XSLT grammars).</p>
<p>What made it difficult for me to read them in the past were the numerous redundancies (with some of them attached). Is this just “history”, or are there particular reasons for preserving or even enforcing redundance? I noticed that, sometimes, symbol names are used in the prose, but I failed to detect any reasonable pattern.</p>
<p>Do we believe it would be helpful to clean up the grammar rules, or does it rather feel out of scope?</p>
<pre><code class="language-python"># currently
ParamWithDefault ::="$" EQName TypeDeclaration? (":=" StandaloneExpr)?
Param ::= "$" EQName TypeDeclaration?
# could be
ParamWithDefault ::= Param (":=" StandaloneExpr)?`
Param ::= "$" EQName TypeDeclaration?

# currently
SchemaAttributeTest ::= "schema-attribute" "(" AttributeDeclaration ")" 
AttributeDeclaration ::= AttributeName 
AttributeName ::= EQName 
# could be
SchemaAttributeTest ::= "schema-attribute" "(" EQName ")" 

# currently
WindowVars ::= ("$" CurrentItem)? PositionalVar? ("previous" "$" PreviousItem)? ("next" "$" NextItem)?
CurrentItem ::= EQName
PreviousItem ::= EQName
NextItem ::= EQName
LetBinding ::= "$" VarName TypeDeclaration? ":=" StandaloneExpr
PositionalVar ::= "at" "$" VarName
VarName ::= EQName
VarRef ::= "$" VarName
# could be
WindowVars ::= ("$" EQName)? PositionalVar? ("previous" Var)? ("next" Var)?
LetBinding ::= Var TypeDeclaration? ":=" StandaloneExpr
PositionalVar ::= "at" Var
VarRef ::= Var
Var := "$" EQName

# currently
MapConstructorEntry ::= MapKeyExpr ":" MapValueExpr
MapKeyExpr ::= ExprSingle
MapValueExpr ::= StandaloneExpr
# could be
MapConstructorEntry ::= ExprSingle ":" StandaloneExpr

# currently
ForwardAxis ::= ("child" "::") | ("descendant" "::") | ("attribute" "::") | ("self" "::") |
  ("descendant-or-self" "::") | ("following-sibling" "::") | ("following" "::")
# could be
ForwardAxis ::= ("attribute" | "child" | "descendant" | "descendant-or-self" |
  "following" | "following-sibling" | "self") "::"

# currently
CompNamespaceConstructor ::= "namespace" (Prefix | EnclosedPrefixExpr) EnclosedURIExpr
Prefix ::= NCName
EnclosedPrefixExpr ::= EnclosedExpr
# could be
CompNamespaceConstructor ::= "namespace" (NCName | EnclosedExpr) EnclosedURIExpr

# currently
Argument ::= StandaloneExpr | ArgumentPlaceholder
ArgumentPlaceholder ::= "?"
# could be
Argument ::= StandaloneExpr | "?"
</code></pre>
<p>…and so on.</p>
<p>PS: If we tweak the grammar, I would propose to rename <code>ExprSingle</code> to <code>SingleExpr</code>.</p>
</div></details></div>
<div class="toot" id="created-1347"><h2>Issue #1347 created<span class="toot-id"> #created-1347</span></h2><div class="pubdate">25 Jul at 08:49:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1347">https://github.com/qt4cg/qtspecs/issues/1347</a></div><details><summary>The escape-solidus option should apply to xml-to-json</summary><div class="markup"><p>Recently, we added an <code>escape-solidus</code> option to <code>fn:serialize()</code>. That option should apply to <code>fn:xml-to-json()</code> as well.</p>
<p>It's not immediately obvious to me if there are other serialize options that should apply as well.</p>
</div></details></div>
<div class="toot" id="created-1346"><h2>Issue #1346 created<span class="toot-id"> #created-1346</span></h2><div class="pubdate">25 Jul at 08:33:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1346">https://github.com/qt4cg/qtspecs/issues/1346</a></div><details><summary>Typos in fn:format-number</summary><div class="markup"><p>In the rules section of fn:format-number, in the para starting "In the table", the word "rendition" is in the wrong font (use <code>term</code> markup).</p>
<p>In the options table, the notation <code>xs:string (: matching '.(:.*)?' :)</code> is flawed because a comment cannot contain the characters <code>(:</code>. Simplest answer to this is to just write <code>xs:string matching '.(:.*)?'</code> - it's intended for the human reader after all, not for machine execution.</p>
</div></details></div>
<div class="toot" id="created-1345"><h2>Issue #1345 created<span class="toot-id"> #created-1345</span></h2><div class="pubdate">25 Jul at 08:33:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1345">https://github.com/qt4cg/qtspecs/issues/1345</a></div><details><summary>Bare brace ambiguity resolution in practice</summary><div class="markup"><p>I have applied the new bare brace grammar rules to two existing projects, and (if I’m correct) all of the the following constructs cannot be parsed anymore (with the order reflecting my sense of urgency):</p>
<ol>
<li>Simple maps: <code>$data ! {}</code></li>
<li>Sequence arrow: <code>{} =&gt; map:size()</code></li>
<li>Predicates: <code>{ 'x': 1 }[map:keys(.) = 'x']</code></li>
<li>Return clause: <code>let $x := ... return {}</code></li>
<li>Paths: <code>&lt;a/&gt;/{}</code></li>
<li>Instance of: <code>{} instance of record(x)</code></li>
<li>If expression: <code>if($x) then { $x: $y } else {}</code></li>
</ol>
<p>I think we should try hard to tweak the grammar for some of these.</p>
<p>I didn’t manage to construct an ambiguous example with <code>return</code> and <code>{}</code>; could someone help me?</p>
<p>Related: #1309</p>
</div></details></div>
<div class="toot" id="created-1344"><h2>Pull request #1344 created<span class="toot-id"> #created-1344</span></h2><div class="pubdate">24 Jul at 21:12:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1344">https://github.com/qt4cg/qtspecs/pull/1344</a></div><details><summary>1343 Drop the static typing feature</summary><div class="markup"><p>Fix #1343</p>
</div></details></div>
<div class="toot" id="created-1343"><h2>Issue #1343 created<span class="toot-id"> #created-1343</span></h2><div class="pubdate">24 Jul at 17:04:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1343">https://github.com/qt4cg/qtspecs/issues/1343</a></div><details><summary>Drop the static typing feature</summary><div class="markup"><p>Since XQuery 3.0, the effect of the static typing feature has been almost entirely implementation defined. Since there is no interoperability when this feature is in effect, there seems very little point leaving it as an optional feature in the spec. In any case, I think user experience of processors that attempt to implement the static typing feature has been rather negative, and most of the processors that implemented it have been left to languish and are unlikely to be upgraded to 4.0.</p>
</div></details></div>
<div class="toot" id="minutes-07-23"><h2>QT4 CG meeting 087 draft minutes<span class="toot-id"> #minutes-07-23</span></h2><div class="pubdate">23 Jul at 17:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/07-23">https://qt4cg.org/meeting/minutes/2024/07-23</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1329"><h2>Issue #1329 closed<span class="toot-id"> #closed-1329</span></h2><div class="pubdate">23 Jul at 16:11:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1329">https://github.com/qt4cg/qtspecs/issues/1329</a></div><p>load-xquery-module supplying content</p></div>
<div class="toot" id="closed-1333"><h2>Issue #1333 closed<span class="toot-id"> #closed-1333</span></h2><div class="pubdate">23 Jul at 16:11:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1333">https://github.com/qt4cg/qtspecs/pull/1333</a></div><p>1329 Add content option to load-xquery-module</p></div>
<div class="toot" id="closed-1309"><h2>Issue #1309 closed<span class="toot-id"> #closed-1309</span></h2><div class="pubdate">23 Jul at 16:08:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1309">https://github.com/qt4cg/qtspecs/issues/1309</a></div><p>Dangling else syntax ambiguity</p></div>
<div class="toot" id="closed-1327"><h2>Issue #1327 closed<span class="toot-id"> #closed-1327</span></h2><div class="pubdate">23 Jul at 16:08:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1327">https://github.com/qt4cg/qtspecs/pull/1327</a></div><p>1309 bare brace ambiguities</p></div>
<div class="toot" id="closed-1331"><h2>Issue #1331 closed<span class="toot-id"> #closed-1331</span></h2><div class="pubdate">23 Jul at 16:05:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1331">https://github.com/qt4cg/qtspecs/pull/1331</a></div><p>1324 Introduce markup for executable specs</p></div>
<div class="toot" id="closed-1317"><h2>Issue #1317 closed<span class="toot-id"> #closed-1317</span></h2><div class="pubdate">23 Jul at 16:00:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1317">https://github.com/qt4cg/qtspecs/issues/1317</a></div><p>Record Test Subtype Relationship</p></div>
<div class="toot" id="closed-1332"><h2>Issue #1332 closed<span class="toot-id"> #closed-1332</span></h2><div class="pubdate">23 Jul at 16:00:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1332">https://github.com/qt4cg/qtspecs/pull/1332</a></div><p>1317 Fix the record subtyping rules</p></div>
<div class="toot" id="closed-1263"><h2>Issue #1263 closed<span class="toot-id"> #closed-1263</span></h2><div class="pubdate">23 Jul at 15:59:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1263">https://github.com/qt4cg/qtspecs/pull/1263</a></div><p>1224 Add xsl:accumulator-rule/@priority attribute</p></div>
<div class="toot" id="closed-1326"><h2>Issue #1326 closed<span class="toot-id"> #closed-1326</span></h2><div class="pubdate">23 Jul at 15:58:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1326">https://github.com/qt4cg/qtspecs/issues/1326</a></div><p>Misleading summary for concat() - "string value"</p></div>
<div class="toot" id="closed-1328"><h2>Issue #1328 closed<span class="toot-id"> #closed-1328</span></h2><div class="pubdate">23 Jul at 15:58:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1328">https://github.com/qt4cg/qtspecs/pull/1328</a></div><p>1326 wording improvements for concat and string-join</p></div>
<div class="toot" id="created-1342"><h2>Pull request #1342 created<span class="toot-id"> #created-1342</span></h2><div class="pubdate">23 Jul at 13:56:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1342">https://github.com/qt4cg/qtspecs/pull/1342</a></div><details><summary>1339 Deprecate ordering mode declaration</summary><div class="markup"><p>The "declare ordering mode" declaration, and the <code>ordered{}</code> and <code>unordered{}</code> declarations are retained for compatibility, but are deprecated and no longer have any effect.</p>
<p>Fix #1339</p>
</div></details></div>
<div class="toot" id="created-1341"><h2>Issue #1341 created<span class="toot-id"> #created-1341</span></h2><div class="pubdate">22 Jul at 21:11:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1341">https://github.com/qt4cg/qtspecs/issues/1341</a></div><details><summary>Remove the `$position`  argument from the `$action` function passed to folds</summary><div class="markup"><p><strong>The <code>$position</code>  argument, passed to the <code>$action</code>-function-argument of the folds is unnecessary and artificial</strong>:</p>
<ol>
<li>The addition of this argument resulted from the <strong><em>automatic</em></strong>  adding this position-aware <code>$action</code>-function-argument to all functions processing sequences and producing result based on their values.</li>
<li>In doing so, no further analysis was made on the specifics of the fold functions.</li>
<li>Though this issue has been raised again and again for months, no single and meaningful use-case has been provided.</li>
<li>This addition departs away from the original meaning of folds as has been well-established by the developers community. Whether or not one needs to produce a variety of folds, such as <em>sum, min, max, average, product, all / none / some / any</em> - in all these cases the position of the individual items does not matter.</li>
<li>One bad consequence of this change is that it makes it more difficult for the reader to grasp the meaning of a particular fold-function, and even to wonder if the spec talks about the same fold functions that the reader thought he knew well.</li>
<li>This change results in unnecessarily complex documentation and testing.</li>
<li>Users have expressed their dismay over the resulting complexity. To quote @benibela: <a href="https://github.com/qt4cg/qtspecs/pull/1296#issuecomment-2226997813">"<em>Too many variables make the code hard too read. And the implementation becomes slow, when it has to handle too many arguments. Especially with function coercion adding further type checks</em>" </a>.
And @michaelhkay himself: "<em><a href="https://github.com/qt4cg/qtspecs/pull/1296#issuecomment-2186435979">I'm inclined to propose dropping the position argument for both fold and scan. It complicates the specification and the use cases are unconvincing. I believe it has been incorrectly specified (for fold-left, the first time $action is called, the value supplied for $pos is 2, whereas for fold-right it is count($input)-1; and the "Error conditions" section talks of $action being applied to 2 arguments). For the -right forms in particular, the semantics are mind-bending enough without introducing this complication.</a></em>"</li>
<li>It is very easy to make an accidental mistake and pass a 2-arg. <code>$action</code> function when a 3-arg. function was meant (or the other way around).</li>
<li>The giant think-tank of Microsoft gives us a good example of a better solution. They never added position-aware overloads to any folds or fold related methods of the Enumerable class. All the following methods do not have position-aware action-function arguments:</li>
</ol>
<ul>
<li>
<p><strong><em><a href="url">Aggregate</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.all?view=net-8.0">All</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.any?view=net-8.0">Any</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.average?view=net-8.0">Average</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.first?view=net-8.0">First</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.firstordefault?view=net-8.0">FirstOrDefault</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.last?view=net-8.0">Last</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.lastordefault?view=net-8.0">LastOrDefault</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.max?view=net-8.0">Max</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.maxby?view=net-8.0">MaxBy</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.min?view=net-8.0">Min</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.minby?view=net-8.0">MinBy</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.zip?view=net-8.0">Zip</a></em></strong></p>
<p>This is not an accidental mistake, as Microsoft added to other Enumerable methods overloads that do require position-aware <code>$action</code>-function arguments:</p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.select?view=net-8.0#system-linq-enumerable-select-2(system-collections-generic-ienumerable((-0))-system-func((-0-system-int32-1)))">Select</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.selectmany?view=net-8.0">SelectMany</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.skipwhile?view=net-8.0">SkipWhile</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.takewhile?view=net-8.0">TakeWhile</a></em></strong></p>
</li>
<li>
<p><strong><em><a href="https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=net-8.0#system-linq-enumerable-where-1(system-collections-generic-ienumerable((-0))-system-func((-0-system-int32-system-boolean)))">Where</a></em></strong></p>
</li>
</ul>
<ol start="10">
<li>Last and probably most important: <a href="https://github.com/qt4cg/qtspecs/pull/1296#issuecomment-2194049829"><strong>@michaelhkay gave us a general and an elegant and very readable way</strong></a> of expressing any fold that needs positional information as a 2-step operation where the 1st step creates a map with entries: <code>{"position": $input[$pos]}</code> and then a fold-operation that only has a non-position-aware <code>$action</code>-function argument, and has this map as input.</li>
</ol>
<p><strong>Proposed solution</strong>:</p>
<ol>
<li>Leave the folds unchanged - in order to preserve their original, established meaning and avoid introducing inadequate complexity.</li>
<li>If deemed really necessary, define separate functions that can take as parameter a position-aware <code>$action</code>-function.</li>
</ol>
</div></details></div>
<div class="toot" id="created-1340"><h2>Issue #1340 created<span class="toot-id"> #created-1340</span></h2><div class="pubdate">22 Jul at 12:04:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1340">https://github.com/qt4cg/qtspecs/issues/1340</a></div><details><summary>Namespace nodes and the namespace axis</summary><div class="markup"><p>It would be nice to bring XSLT, XPath, and XQuery into line here.</p>
<p>The current state of play seems to be:</p>
<p>XQuery: the namespace axis is not supported. Namespace nodes can be constructed, but they exist only as detached orphans; they can never be attached to a parent element.</p>
<p>XPath: the namespace axis is deprecated and support is optional. There is no mechanism for constructing namespace nodes.</p>
<p>XSLT: the namespace axis is mandatory. Namespace nodes can be constructed and can be attached to elements.</p>
<p>I believe that the only reason for the differences is that XQuery implementors were concerned that it would be difficult to implement namespace nodes efficiently. I think XSLT has clearly demonstrated that this concern is unjustified.</p>
<p>However, there are implementation complexities, primarily around the fact that namespace nodes have identity and parentage, so if a namespace is declared on a root element, then every element in the document has a namespace node for this namespace, and these have distinct identity. To implement this efficiently, the implementation has to instantiate namespace nodes lazily on demand, and then has to ensure that if the "same" namespace node is instantiated again, it has the same "identity".</p>
<p>I suggest a solution along the following lines, applied to all three languages:</p>
<p>(a) the namespace axis is supported and delivers namespace nodes</p>
<p>(b) operations that depend on the ordering, identity, or parentage of namespace nodes are deprecated and implementation-defined.</p>
<p>(c) the data model says that the in-scope namespaces of an element are in the form of a (prefix, URI) map. The semantics of the namespace axis are described in terms of constructing transient namespace nodes from this map.</p>
</div></details></div>
<div class="toot" id="created-1339"><h2>Issue #1339 created<span class="toot-id"> #created-1339</span></h2><div class="pubdate">22 Jul at 11:40:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1339">https://github.com/qt4cg/qtspecs/issues/1339</a></div><details><summary>Drop unordered mode</summary><div class="markup"><p>Is there any evidence that unordered mode is useful, or that any implementations actually take note of it (by delivering a different result if unordered mode is set)?</p>
<p>If not, could we drop it? I would suggest continuing to recognize the syntax, marking it deprecated, and saying it has no effect.</p>
<p>It's not doing a great deal of harm, but there are a lot of places where our examples in the spec assume ordered mode, but the examples don't explicitly call out this assumption. Similarly, a great many QT3 test cases would fail on an implementation that sets unordered mode by default.</p>
</div></details></div>
<div class="toot" id="created-1338"><h2>Issue #1338 created<span class="toot-id"> #created-1338</span></h2><div class="pubdate">22 Jul at 11:05:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1338">https://github.com/qt4cg/qtspecs/issues/1338</a></div><details><summary>Arrays and maps: Members, entries, values, contents, pairs, …</summary><div class="markup"><p>With version 4.0, we are adding a lot of promising and powerful new map and array features. This is a big step forward, compared to the obvious limitations of 3.1.</p>
<p>Some aspects of the 3.1 design have made it difficult (or impossible) to fully adjust array and maps, but (in my opinion) the old overall concept was impressively consistent – and it is definitely a big challenge to achieve a 4.0 design that is not too fragmented.</p>
<p>To me, this becomes particularly evident in the case of arrays. The following example sums up the items of all members of an array. For the cumbersome 3.1 solution…</p>
<pre><code class="language-xquery">for $pos in 1 to array:size($array)
return sum($array($pos))
</code></pre>
<p>…we now have at least several (roughly?) equivalent options to do this; for example…</p>
<ol>
<li><code>for member $m in $array return sum($m)</code></li>
<li><code>array:members($array) ! sum(?value)</code></li>
<li><code>$array?entry::* ! sum(?value)</code></li>
<li><code>$array?value::* ! sum(.)</code></li>
</ol>
<p>…which is great – but the downside is that we have introduced a terminological jungle. The examples above could imply that:</p>
<ul>
<li>for 1., an <em>array member</em> is a sequence (which it indeed is);</li>
<li>for 2., an <em>array member</em> is a map;</li>
<li>for 3., an <em>array</em> has entries (but there is no <code>array:entries</code>);</li>
<li>for 4., an <em>array</em> has values (which is true, but <code>array:value</code> returns a different structure).</li>
</ul>
<p>Next, with the current proposals, <code>$array:content::1</code> gives us the sequence-concatenated version of the first member of an array. Similar observations can be made with maps: <code>map:entries($map)</code> returns singleton maps, whereas <code>$map?entry::*</code> is actually equivalent to <code>map:pairs</code>.</p>
<p>The fundamental obstacle are clear have already been discussed a lot, but I think that with each new concept, we should try really hard not to blur terminology, and work with terms that users can assign to the underlying concepts without too much guessing or trial’n’error.</p>
<p>My general suggestions would be to…</p>
<ol>
<li>align the new lookup terminology and the builtin functions, and</li>
<li>omit, rename or drop builtin functions that do not rely on the existing or arising terminology.</li>
</ol>
<p>My concrete proposals (maybe followed by others) would be to…</p>
<ol>
<li>As we already have <code>map:pairs</code>, <code>$map-or-array?entry::*</code> should become <code>$map-or-array?pair::*</code>, and we should add a <code>array:pairs</code> function, and probably <code>array:of-pairs</code> (see #832). We shouldn’t do it the other way round and rename <code>map:pairs</code> to <code>map:entries</code>, as the existing <code>map:entry</code> function returns a singleton map.</li>
<li>If we keep calling the sequence-concatenated result “content”, we should include it in the definition of sequence-concatenation. In addition, <code>(array|map):values</code> should be renamed to <code>(array|map):contents</code> (see #1179).</li>
<li>Due to the existence of <code>array:value::*</code>, we should make clear what an “array value” is, how it it positions itself in relation to an “array member”, and we should add <code>map:values</code> and <code>array:values</code> for equivalent results.</li>
<li>Due to the existence of <code>array:key::*</code>, we should add a <code>array:keys</code> function (which returns a dense integer range). <code>1&nbsp;to&nbsp;array:size($array)</code> could then be written as <code>array:keys($array)</code>.</li>
<li>As we have <code>map:entries</code> and <code>map:merge</code>, we could add equivalent <code>array:entries</code> and <code>array:merge</code> functions.</li>
<li>I would suggesting dropping <code>array:members</code>/<code>array:of-members</code> in favor of either <code>array:split</code>/<code>array:join</code>, <code>array:pairs</code>/<code>array:of-pairs</code> (see 1.) or <code>array:entries</code>/<code>array:merge</code> (see 5). I have a strong conviction that an “array member“ should not be a map; an “array pair” or ”array entry” certainly could.</li>
</ol>
<p>One might question if we should really introduce map terminology for arrays. I think we have no other chance if we want to treat maps and arrays identically with lookup key specifiers, and it may help us later on to treat both data structures as similar as possible.</p>
</div></details></div>
<div class="toot" id="created-1337"><h2>Issue #1337 created<span class="toot-id"> #created-1337</span></h2><div class="pubdate">22 Jul at 08:55:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1337">https://github.com/qt4cg/qtspecs/issues/1337</a></div><details><summary>Atomic value → atomic item</summary><div class="markup"><p>I liked @michaelhkay’s proposal in https://github.com/qt4cg/qtspecs/issues/826#issuecomment-1821359131:</p>
<blockquote>
<p>• The term "atomic item" (or just atom?) replaces "atomic value".</p>
</blockquote>
<p>I often used “atomic items” in the past (although it’s no defined term at the moment) as it seemed more intuitive to me.</p>
</div></details></div>
<div class="toot" id="created-1336"><h2>Issue #1336 created<span class="toot-id"> #created-1336</span></h2><div class="pubdate">22 Jul at 08:10:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1336">https://github.com/qt4cg/qtspecs/issues/1336</a></div><details><summary>Editorial: fos record descriptions within xmlspec prose</summary><div class="markup"><p>In the F+O spec, the <code>uri-structure-record</code> appearing in section 6.6, and various other similar record descriptions, are defined using the <code>fos</code> namespace markup in xpath-functions.xml. Normally the <code>fos</code> XML vocabulary is confined to function-catalog.xml, and is converted to the usual xmlspec vocabulary by the <code>merge-function-specs</code> stylesheet.</p>
<p>Using this vocabulary directly within an xmlspec document means that the document doesn't validate against its DTD, and that the <code>fos</code> islands aren't validated against the fos.xsd schema.</p>
<p>A better approach here might be to use XInclude to insert text from a separate, schema-validated, document.</p>
</div></details></div>
<div class="toot" id="closed-31"><h2>Issue #31 closed<span class="toot-id"> #closed-31</span></h2><div class="pubdate">21 Jul at 21:48:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/31">https://github.com/qt4cg/qtspecs/issues/31</a></div><p>Extend FLWOR expressions to maps</p></div>
<div class="toot" id="closed-1160"><h2>Issue #1160 closed<span class="toot-id"> #closed-1160</span></h2><div class="pubdate">21 Jul at 21:31:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1160">https://github.com/qt4cg/qtspecs/issues/1160</a></div><p>fn:is-collation-available</p></div>
<div class="toot" id="closed-1334"><h2>Issue #1334 closed<span class="toot-id"> #closed-1334</span></h2><div class="pubdate">21 Jul at 21:22:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1334">https://github.com/qt4cg/qtspecs/issues/1334</a></div><p>map:build parameter keywords</p></div>
<div class="toot" id="created-1335"><h2>Issue #1335 created<span class="toot-id"> #created-1335</span></h2><div class="pubdate">20 Jul at 09:51:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1335">https://github.com/qt4cg/qtspecs/issues/1335</a></div><details><summary>Data Model primitives for Maps and Arrays</summary><div class="markup"><p>In principle we ought to be able to define all operations on maps and arrays in terms of the primitives defined in the Data Model spec.</p>
<p>Currently the data model defines the primitives as <code>dm:map-entries</code>, <code>dm:array-size</code>, and <code>dm:array-get</code>.</p>
<p>This is a workable set for retrieval functions, though it's not necessarily an ideal set. But what is missing is any primitives for map and array construction.</p>
<p>I think we need to regard the empty array and empty map as given, and then define array:append and map:put as primitives.</p>
<p>Since <code>dm:map-entries()</code> isn't the same as the user-visible <code>map:entries()</code> it might be a good idea to rename it.</p>
<p>Another way of defining the primitives would be to make iteration primitive, so the primitives become</p>
<p><code>dm:for-each-map-entry($map, fn($key, $value)) </code>
and</p>
<p><code>dm:for-each-array-member($array, fn($position, $value))</code></p>
<p>This has some merit in that (a) maps and arrays are treated symmetrically, and (b) there are only 2 primitives rather than 3.</p>
</div></details></div>
<div class="toot" id="created-1334"><h2>Issue #1334 created<span class="toot-id"> #created-1334</span></h2><div class="pubdate">20 Jul at 06:58:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1334">https://github.com/qt4cg/qtspecs/issues/1334</a></div><details><summary>map:build parameter keywords</summary><div class="markup"><p>Currently <code>$keys, $value</code>. Both should be plural.</p>
</div></details></div>
<div class="toot" id="created-1333"><h2>Pull request #1333 created<span class="toot-id"> #created-1333</span></h2><div class="pubdate">19 Jul at 16:43:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1333">https://github.com/qt4cg/qtspecs/pull/1333</a></div><details><summary>1329 Add content option to load-xquery-module</summary><div class="markup"><p>Fix #1329</p>
</div></details></div>
<div class="toot" id="created-1332"><h2>Pull request #1332 created<span class="toot-id"> #created-1332</span></h2><div class="pubdate">19 Jul at 16:11:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1332">https://github.com/qt4cg/qtspecs/pull/1332</a></div><details><summary>1317 Fix the record subtyping rules</summary><div class="markup"><p>Fix as proposed in the issue.</p>
<p>Fix #1317</p>
</div></details></div>
<div class="toot" id="created-1331"><h2>Pull request #1331 created<span class="toot-id"> #created-1331</span></h2><div class="pubdate">19 Jul at 15:42:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1331">https://github.com/qt4cg/qtspecs/pull/1331</a></div><details><summary>1324 Introduce markup for executable specs</summary><div class="markup"><p>This PR does the following:</p>
<ol>
<li>Makes schema changes for the function catalog to allow an executable specification of a function to be marked up as such.</li>
<li>Uses this markup initially for functions in the array namespace.</li>
<li>Makes stylesheet changes to render this markup in the published spec.</li>
<li>Commits an XSLT stylesheet (not yet integrated into the build system) that runs against the function catalog to produce an XQuery module whose effect is to declare functions based on the "executable specifications" and run the published executable examples against these functions, checking that they produce the expected result. The "success" output of this query (which runs with no source document) is an XML document containing an empty element <code>&lt;result/&gt;</code>. (If it has content, this will relate to tests that failed).</li>
</ol>
<p>To get this to work, I had to tweak a couple of functions (array:sort and array:get) where Saxon has not yet implemented the required functionality. Although the test query is using the implementations from the spec, not those from Saxon, these implementations make calls on other functions where the Saxon implementation is used. For example array:fold-left calls fn:fold-left and this currently uses the Saxon implementation of fn:fold-left.</p>
<p>The query binds a dummy namespace to the <code>array</code> prefix to avoid problems with reserved namespaces. There are a couple of "core" functions that have no executable specification -- notably array:of-members() -- and the generated query contains an implementation of these that maps the function in the dummy array namespace to the function in the true array namespace.</p>
<p>This is phase 1. Most of the machinery is in place. It now needs to be applied to executable specifications of functions in other namespaces.</p>
<p>The stylesheet has no Saxon dependencies, but it does include a couple of template rules to exclude specific functions/tests that Saxon does not currently implement. The stylesheet could be made portable across implementations by moving these exception cases to an overriding stylesheet module.</p>
<p>I did find a few examples of supposedly executable code that needed fixing; hopefully these will show up in the diff version.</p>
</div></details></div>
<div class="toot" id="created-1330"><h2>Issue #1330 created<span class="toot-id"> #created-1330</span></h2><div class="pubdate">19 Jul at 14:26:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1330">https://github.com/qt4cg/qtspecs/issues/1330</a></div><details><summary>$fallback argument of map:get() and array:get() should allow () to be supplied</summary><div class="markup"><p>As a general rule, if an argument is optional then it should accept an empty sequence.</p>
</div></details></div>
<div class="toot" id="created-1329"><h2>Issue #1329 created<span class="toot-id"> #created-1329</span></h2><div class="pubdate">19 Jul at 07:29:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1329">https://github.com/qt4cg/qtspecs/issues/1329</a></div><details><summary>load-xquery-module supplying content</summary><div class="markup"><p>I propose to provide an additional option</p>
<p><code>content as xs:string</code></p>
<p>for fn:load-xquery-module. The effect is to supply the content of the XQuery library module as a string. If supplied, the location-hints option is ignored.</p>
<p>Use case: I'm writing code that attempts to test the XQuery examples in the specification. This requires some kind of capability for dynamic XQuery execution, and this seems the simplest way of doing it.</p>
</div></details></div>
<div class="toot" id="created-1328"><h2>Pull request #1328 created<span class="toot-id"> #created-1328</span></h2><div class="pubdate">18 Jul at 22:11:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1328">https://github.com/qt4cg/qtspecs/pull/1328</a></div><details><summary>1326 wording improvements for concat and string-join</summary><div class="markup"><p>Very minor editorial improvements.</p>
<p>Fix #1326</p>
</div></details></div>
<div class="toot" id="created-1327"><h2>Pull request #1327 created<span class="toot-id"> #created-1327</span></h2><div class="pubdate">18 Jul at 20:56:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1327">https://github.com/qt4cg/qtspecs/pull/1327</a></div><details><summary>1309 bare brace ambiguities</summary><div class="markup"><p>Fix #1309</p>
<p>The proposal restructures the grammar so a bare brace map constructor (that is, one without the "map" keyword) can be used only where this causes no ambiguity, for example as a function argument.</p>
</div></details></div>
<div class="toot" id="created-1326"><h2>Issue #1326 created<span class="toot-id"> #created-1326</span></h2><div class="pubdate">17 Jul at 15:57:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1326">https://github.com/qt4cg/qtspecs/issues/1326</a></div><details><summary>Misleading summary for concat() - "string value"</summary><div class="markup"><p>The summary of fn:concat says that it concatenates the string values of its arguments. This isn't strictly correct: if a node is supplied as an argument, the node is atomized and the typed value is cast to a string, which doesn't necessarily give you the same result. For example (a) if the node is an attribute whose type is list, the result is the elements of the list without space separation, and (b) if the node is an element with element-only content, concat() fails although string() would succeed.</p>
<p>In 3.1, supplying a list-valued attribute would fail because the required type of each argument was <code>xs:anyAtomicType?</code>. It now succeeds because the required type is <code>xs:anyAtomicType?</code> - but perhaps it doesn't have the desired effect?</p>
<p>We should clarify these points with notes and examples. Also affects the <code>||</code> operator.</p>
</div></details></div>
<div class="toot" id="created-1325"><h2>Issue #1325 created<span class="toot-id"> #created-1325</span></h2><div class="pubdate">16 Jul at 18:50:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1325">https://github.com/qt4cg/qtspecs/issues/1325</a></div><details><summary>Variadic System Functions: Principles?</summary><div class="markup"><p>In the current spec, the following functions are variadic:</p>
<ul>
<li><code>fn:concat</code></li>
<li><code>fn:codepoints-to-string</code></li>
<li><code>fn:distinct-ordered-nodes</code></li>
</ul>
<p>The advantage of the variadic representation is that a user can omit additional parentheses; the drawback is that the function cannot be enhanced with parameters later on. In my point of view, <code>fn:distinct-ordered-nodes</code> might be a candidate for that in the future (on the other hand, it will only be used by a very small user group one or the other way).</p>
<p>Other candidates for variadicity could be (among others):</p>
<ul>
<li><code>fn:count</code></li>
<li><code>fn:exists</code>, <code>fn:empty</code></li>
<li><code>fn:head</code>, <code>fn:tail</code>, <code>fn:trunk</code>, <code>fn:foot</code></li>
<li><code>fn:one-or-more</code>, <code>fn:exactly-one</code>, <code>fn:zero-or-one</code></li>
<li><code>fn:innermost</code>, <code>fn:outermost</code>, <code>fn:unordered</code>, <code>fn:reverse</code></li>
<li><code>fn:boolean</code>, <code>fn:not</code></li>
<li><code>fn:identity</code></li>
<li><code>fn:data</code>, <code>fn:has-children</code> (the 0-arity case would need to be preserved due to its special semantics)</li>
</ul>
<p>Note that function calls like <code>fn:exactly-one(E1, E2)</code> can be reasonable in practice, as <code>E1</code> may return an empty sequence.</p>
<p>I wonder if we can define a principle which functions should be variadic?</p>
</div></details></div>
<div class="toot" id="minutes-07-16"><h2>QT4 CG meeting 086 draft minutes<span class="toot-id"> #minutes-07-16</span></h2><div class="pubdate">16 Jul at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/07-16">https://qt4cg.org/meeting/minutes/2024/07-16</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-1324"><h2>Issue #1324 created<span class="toot-id"> #created-1324</span></h2><div class="pubdate">16 Jul at 16:10:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1324">https://github.com/qt4cg/qtspecs/issues/1324</a></div><details><summary>Executable specifications</summary><div class="markup"><p>For a number of functions we have provided executable specifications: that is, we have provided an XQuery function declaration that claims to be a conformant implementation of the function being specified.</p>
<p>We should add machinery to ensure that these reference implementations are correct: that is, that they compile, that they correctly run the examples in the spec, and that they can be used to run the tests for the relevant function in the test suite.</p>
<p>There are one or two cases where we have been doing this in an ad-hoc way by having additional test cases in the test suite that use the reference implementation (or a copy of it!) in place of the real function; but this is clumsy and the process should be automated.</p>
<p>It can be tied in with the mechanism that currently generates test cases from the examples in the spec.</p>
<p>We should probably handle several levels:</p>
<p>(a) There are cases where the reference implementation can be a simple XPath expression: for example the function <code>fn:local-name($x)</code> delivers <code>fn:local-name-from-QName(fn:node-name($x))</code>.</p>
<p>(b) In other cases a full XQuery function declaration is needed, especially where it makes use of a supporting helper function.</p>
<p>Ideally the reference implementation should use 3.1 syntax only (to make it easily testable on 3.1 implementations); but not if this sacrifices clarity, given that the primary audience is the human reader.</p>
</div></details></div>
<div class="toot" id="closed-1244"><h2>Issue #1244 closed<span class="toot-id"> #closed-1244</span></h2><div class="pubdate">16 Jul at 16:03:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1244">https://github.com/qt4cg/qtspecs/pull/1244</a></div><p>566-partial Rewrite parse-uri</p></div>
<div class="toot" id="closed-1272"><h2>Issue #1272 closed<span class="toot-id"> #closed-1272</span></h2><div class="pubdate">16 Jul at 16:02:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1272">https://github.com/qt4cg/qtspecs/issues/1272</a></div><p>Add xsl:value-of/@as attribute</p></div>
<div class="toot" id="created-1323"><h2>Issue #1323 created<span class="toot-id"> #created-1323</span></h2><div class="pubdate">16 Jul at 13:11:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1323">https://github.com/qt4cg/qtspecs/issues/1323</a></div><details><summary>Function parameters names: $uri vs. $href</summary><div class="markup"><p>I was asked about the difference between the function parameter names <code>$href</code> and <code>$uri</code>…</p>
<ul>
<li><code>fn:doc($href)</code> (“Retrieves a document using a URI supplied as an <code>xs:string</code>…”); <code>fn:unparsed-text($href)</code>; others</li>
<li><code>fn:collection($uri)</code>, <code>fn:uri-collection($uri)</code>; others</li>
</ul>
<p>…and I couldn’t give a convincing answer. At least in BaseX, both <code>fn:doc</code> and <code>fn:collection</code> can be used interchangeably to address single resources (but things change when the target contains multiple resources).</p>
<p>Would it be reasonable to rename <code>$href</code> to <code>$uri</code>, or are there reasons why we need to differ those two?</p>
<p>If we rename the parameter, <code>fn:resolve-uri</code> may be the only function using <code>$href</code> (maybe even here, <code>$uri</code> could work?).</p>
</div></details></div>
<div class="toot" id="created-1322"><h2>Issue #1322 created<span class="toot-id"> #created-1322</span></h2><div class="pubdate">16 Jul at 13:00:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1322">https://github.com/qt4cg/qtspecs/issues/1322</a></div><details><summary>fn:collation-available (editorial)</summary><div class="markup"><p>Minor observations:</p>
<ol>
<li>As the function input is a plain URI, I would propose to rename <code>$collation</code> to <code>$uri</code> (see <code>fn:collection</code> and other functions).</li>
<li>I believe we should make <code>fn:collation-available($uri, ())</code> and <code>fn:collation-available($uri)</code> equivalent. Could we change the default value of <code>$usage</code> to <code>()</code>?</li>
<li>It would be helpful to have (successul and failing) examples for the <code>$usage</code> argument added to the specification. Maybe things get easier once test cases exist.</li>
</ol>
</div></details></div>
<div class="toot" id="created-1321"><h2>Issue #1321 created<span class="toot-id"> #created-1321</span></h2><div class="pubdate">15 Jul at 23:56:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1321">https://github.com/qt4cg/qtspecs/issues/1321</a></div><details><summary>Leading lone slash</summary><div class="markup"><p>PR #1313 clarifies how tokenization of direct constructors works.</p>
<p>As a result we should rephrase the section on "leading lone slash" in A.1.2. This currently says (inter alia)</p>
<blockquote>
<p>the &lt; token could be either an operator or the start of a [DirectConstructor]</p>
</blockquote>
<p>But we now speak of <strong>terminals</strong> rather than <strong>tokens</strong>, and a DirectConstructor is a terminal, whereas the <code>&lt;</code> character that appears at the start of a DirectConstructor is not a terminal.</p>
<p>The revised formulation affects the interpretation of examples like <code>/ &lt; 5</code> (test cases PathExpr-5 and PathExpr-8) which I believe are now valid in XP40 and XQ40 (<code>&lt;</code> as a character can appear at the start of a RelativePathExpr, but <code>&lt;</code> as a token/terminal can't).</p>
<p>The rule currently talks of a "token that can appear at the start of a RelativePathExpr" without enumerating the tokens/terminals that can do so. It would be helpful to both implementors and users (and test authors) if we could enumerate them - I believe we can construct a list by conducting a suitable query against the grammar.</p>
</div></details></div>
<div class="toot" id="closed-1266"><h2>Issue #1266 closed<span class="toot-id"> #closed-1266</span></h2><div class="pubdate">15 Jul at 14:07:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1266">https://github.com/qt4cg/qtspecs/pull/1266</a></div><p>1158 Add array mapping operator</p></div>
<div class="toot" id="created-1320"><h2>Issue #1320 created<span class="toot-id"> #created-1320</span></h2><div class="pubdate">11 Jul at 11:30:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1320">https://github.com/qt4cg/qtspecs/issues/1320</a></div><details><summary>fn:parse-uri: Observations</summary><div class="markup"><p>@ndw I decided to only give feedback on the first test that fails; maybe it makes things easier. Next, I chose this repository (instead of <code>qt4tests</code>), as you are the better person to judge if bugs are to be fixed in the tests or the spec.</p>
<p>The test case <a href="https://github.com/qt4cg/qt4tests/blob/5b0750b035d336040b4944dba6225e50bd004839/fn/parse-uri.xml#L239-L253">fn-parse-uri-012</a> uses <code>fn:parse-uri("file:///c:/path/to/file")</code> and returns:</p>
<pre><code class="language-xquery">{
  "uri": "file:///c:/path/to/file",
  "scheme": "file",
  "hierarchical": true(),
  "path": "/c:/path/to/file",
  "filepath": "c:/path/to/file",
  "path-segments": ("", "c:", "path", "to", "file")
}
</code></pre>
<p>Following the current rules, I would have expected <code>filepath</code> to be <code>/c:/path/to/file</code>:</p>
<pre><code>If URI matches `^([a-zA-Z][A-Za-z0-9\+\-\.]*):(.*)$`:
• SCHEME: file
• STRING: ///c:/path/to/file

If the scheme is known to be file and the string matches "^/*(/[a-zA-Z][:|].*)$":
• STRING: /c:/path/to/file

If the scheme is file or the empty sequence, and filepath is the empty sequence, filepath is also the whole string:
• FILEPATH: /c:/path/to/file
</code></pre>
<p>Would you propose to revise the test or the specification?</p>
</div></details></div>
<div class="toot" id="minutes-07-09"><h2>QT4 CG meeting 085 draft minutes<span class="toot-id"> #minutes-07-09</span></h2><div class="pubdate">09 Jul at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/07-09">https://qt4cg.org/meeting/minutes/2024/07-09</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1158"><h2>Issue #1158 closed<span class="toot-id"> #closed-1158</span></h2><div class="pubdate">09 Jul at 16:26:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1158">https://github.com/qt4cg/qtspecs/issues/1158</a></div><p>Simple mapping operator for arrays</p></div>
<div class="toot" id="created-1319"><h2>Issue #1319 created<span class="toot-id"> #created-1319</span></h2><div class="pubdate">09 Jul at 16:20:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1319">https://github.com/qt4cg/qtspecs/issues/1319</a></div><details><summary>Specification Documents: Editors and Contributors</summary><div class="markup"><p>I have noticed that the headers of the specification documents of previous versions of the languages contain more than one editor. In some EXPath documents, both editors and contributors are listed (with editors doing the majority of the work).</p>
<p>As various people have now been contributing to the new specifications and the documents for the last months and years already, would it make sense (and would it match with the current W3 conventions) to name more than one person in the header? In either case, it should certainly made clear that Michael Kay has contributed the very vast majority of the contents.</p>
</div></details></div>
<div class="toot" id="closed-1306"><h2>Issue #1306 closed<span class="toot-id"> #closed-1306</span></h2><div class="pubdate">09 Jul at 16:15:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1306">https://github.com/qt4cg/qtspecs/pull/1306</a></div><p>46 Add @as attribute to xsl:sequence</p></div>
<div class="toot" id="closed-1262"><h2>Issue #1262 closed<span class="toot-id"> #closed-1262</span></h2><div class="pubdate">09 Jul at 16:12:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1262">https://github.com/qt4cg/qtspecs/pull/1262</a></div><p>1160 Add collation-available() function</p></div>
<div class="toot" id="closed-1311"><h2>Issue #1311 closed<span class="toot-id"> #closed-1311</span></h2><div class="pubdate">09 Jul at 16:08:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1311">https://github.com/qt4cg/qtspecs/issues/1311</a></div><p>Tokenization and element constructors</p></div>
<div class="toot" id="closed-1313"><h2>Issue #1313 closed<span class="toot-id"> #closed-1313</span></h2><div class="pubdate">09 Jul at 16:08:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1313">https://github.com/qt4cg/qtspecs/pull/1313</a></div><p>1311 Tokenizing after &lt;</p></div>
<div class="toot" id="closed-566"><h2>Issue #566 closed<span class="toot-id"> #closed-566</span></h2><div class="pubdate">09 Jul at 15:03:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/566">https://github.com/qt4cg/qtspecs/issues/566</a></div><p>fn:parse-uri, fn:build-uri: Feedback</p></div>
<div class="toot" id="created-1318"><h2>Issue #1318 created<span class="toot-id"> #created-1318</span></h2><div class="pubdate">09 Jul at 08:30:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1318">https://github.com/qt4cg/qtspecs/issues/1318</a></div><details><summary>Function Coercion: Records, Maps, Arrays</summary><div class="markup"><p><strong>Conclusion (2024-09-11):</strong> We should then add coercion rules for arrays and maps as well: If <code>$v as xs:int+</code> is successful for <code>(1, 2)</code>, <code>$v as array(xs:int)</code> should be successful for <code>[ 1, 2 ]</code>.</p>
<hr>
<p>I like to question the coercion rule that encompasses record tests:</p>
<blockquote>
<ol start="6">
<li>If <em>R</em> is a <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#doc-xquery40-RecordTest">RecordTest</a> and <em>J</em> is a map, then J is converted to a new map as follows:</li>
</ol>
</blockquote>
<blockquote>
<ul>
<li>The keys in the supplied map are unchanged.</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>In any map entry whose key is an <code>xs:string</code> equal to the name of one of the field declarations in R, the corresponding value is converted to the required type defined by that field declaration, by applying the coercion rules recursively (but with XPath 1.0 compatibility mode treated as false).</li>
</ul>
</blockquote>
<p>I would like us to drop this rule. I believe that both the instance checks and the conversions of large maps can get very expensive. In addition, it may even require recursive rebuilds of map structures if a supplied record test includes nested record tests.</p>
<p>I think it’s completely fair to expect users to deliver maps in a way that matches record definitions, and it could even be counterintuitive if map updates take place as a consequence of a simple function call.</p>
<p>If we want to stick to that coercion rule, we should also define coercion rules for maps and arrays.</p>
</div></details></div>
<div class="toot" id="created-1317"><h2>Issue #1317 created<span class="toot-id"> #created-1317</span></h2><div class="pubdate">08 Jul at 11:18:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1317">https://github.com/qt4cg/qtspecs/issues/1317</a></div><details><summary>Record Test Subtype Relationship</summary><div class="markup"><p>For a subtype relationship between record tests, <code>A ⊆ B</code>, I am trying to understand the impact of the extensibility of <code>A</code>, where <code>B</code> is extensible, but I can't spot any.</p>
<p>The cases of extensible and non-extensible <code>A</code> are distinguished in <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-item-subtype-records">3.3.2.10 Record Tests</a>, points 5 and 6. The only difference between those, apart from <code>A</code>'s extensibility, is the first one saying</p>
<blockquote>
<p>For every field that is declared in B but not in A, the declared type in B is item()*.</p>
</blockquote>
<p>while the second one has</p>
<blockquote>
<p>Every field that is declared in B with a type other than item()* is also declared in A.</p>
</blockquote>
<p>So the first one asks for a type of <code>item(*)</code> when a declaration is missing, and the second one allows a missing declaration only for a type of <code>item(*)</code>. How can that not be the same?</p>
</div></details></div>
<div class="toot" id="agenda-07-09"><h2>QT4 CG meeting 085 draft agenda<span class="toot-id"> #agenda-07-09</span></h2><div class="pubdate">08 Jul at 10:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/07-09">https://qt4cg.org/meeting/agenda/2024/07-09</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1316"><h2>Issue #1316 created<span class="toot-id"> #created-1316</span></h2><div class="pubdate">06 Jul at 14:49:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1316">https://github.com/qt4cg/qtspecs/issues/1316</a></div><details><summary>XPath: type declarations in quantified expressions</summary><div class="markup"><p>We have added type declarations to XPath "for" and "let" expressions, but not to "some" and "every", where they remain XQuery-only. This seems a needless inconsistency.</p>
</div></details></div>
<div class="toot" id="created-1315"><h2>Issue #1315 created<span class="toot-id"> #created-1315</span></h2><div class="pubdate">04 Jul at 13:29:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1315">https://github.com/qt4cg/qtspecs/issues/1315</a></div><details><summary>12 div-3</summary><div class="markup"><p>Revisiting an old issue here: should <code>12 div-3</code> parse?</p>
<p>Under the new 4.0 tokenization rules, it certainly doesn't.</p>
<p>But under Michael Dyck's interpretation of the 3.1 rules, it does parse; and accordingly we made it parse in Saxon: see https://saxonica.plan.io/issues/2715 .</p>
<p>Michael D's reasoning is at</p>
<p>https://lists.w3.org/Archives/Public/public-xsl-query/2016Mar/0037.html</p>
<p>He argued that the the longest token "consistent with the EBNF" is <code>div</code> (because <code>div-3</code> is not consistent with the EBNF), and that the rule requiring a space between an NCName and a hyphen does not apply because <code>div</code> in this context is a keyword, not an NCName.</p>
<p>Specifically, in existing XPath processors, does it parse?</p>
<p>I'm going to defend the new rules in 4.0 here, in which tokenization is independent of syntactic context. I think that's a much clearer definition. But in the interests of full disclosure, the CG might like to note that this may be incompatible with the way some people have interpreted the 3.1 rules</p>
<p>Incidentally, removing the tweak that makes Saxon able to parse <code>12 div-3</code> doesn't break any test cases.</p>
</div></details></div>
<div class="toot" id="minutes-07-02"><h2>QT4 CG meeting 084 draft minutes<span class="toot-id"> #minutes-07-02</span></h2><div class="pubdate">02 Jul at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/07-02">https://qt4cg.org/meeting/minutes/2024/07-02</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-729"><h2>Issue #729 closed<span class="toot-id"> #closed-729</span></h2><div class="pubdate">02 Jul at 16:09:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/729">https://github.com/qt4cg/qtspecs/issues/729</a></div><p>xsi:schemaLocation</p></div>
<div class="toot" id="closed-1254"><h2>Issue #1254 closed<span class="toot-id"> #closed-1254</span></h2><div class="pubdate">02 Jul at 16:09:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1254">https://github.com/qt4cg/qtspecs/pull/1254</a></div><p>729 Add rules for use of xsi:schemaLocation during validation</p></div>
<div class="toot" id="closed-1161"><h2>Issue #1161 closed<span class="toot-id"> #closed-1161</span></h2><div class="pubdate">02 Jul at 16:07:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1161">https://github.com/qt4cg/qtspecs/issues/1161</a></div><p>More changes to drop the requirement for document-uri() uniqueness</p></div>
<div class="toot" id="closed-1265"><h2>Issue #1265 closed<span class="toot-id"> #closed-1265</span></h2><div class="pubdate">02 Jul at 16:07:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1265">https://github.com/qt4cg/qtspecs/pull/1265</a></div><p>1161 Further revision of document-uri constraints</p></div>
<div class="toot" id="closed-1289"><h2>Issue #1289 closed<span class="toot-id"> #closed-1289</span></h2><div class="pubdate">02 Jul at 16:05:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1289">https://github.com/qt4cg/qtspecs/issues/1289</a></div><p>Delete XQuery Appendix J</p></div>
<div class="toot" id="closed-1293"><h2>Issue #1293 closed<span class="toot-id"> #closed-1293</span></h2><div class="pubdate">02 Jul at 16:05:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1293">https://github.com/qt4cg/qtspecs/pull/1293</a></div><p>1289 Delete XQuery Appendix J</p></div>
<div class="toot" id="created-1314"><h2>Issue #1314 created<span class="toot-id"> #created-1314</span></h2><div class="pubdate">01 Jul at 16:39:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1314">https://github.com/qt4cg/qtspecs/issues/1314</a></div><details><summary>Ambiguity in XPath EBNF - Lookup with TypeQualifier vs DynamicFunctionCall</summary><div class="markup"><p>Additional to https://github.com/qt4cg/qtspecs/issues/1050
An additional ambiguity occurs in one of the deep lookup examples:</p>
<pre><code>$tree ??$from ??type(record(to, distance))[?to=$to] ?distance
</code></pre>
<p>which can be simplified to</p>
<pre><code>$tree ??type(foo)
</code></pre>
<p>where there is ambiguity between a <code>LookupExpr</code> with <code>TypeQualifier</code> and a <code>DynamicFunctionCall</code> on a function named <code>type</code>. That is, <code>type</code> should perhaps be one of the restrictions on function name to avoid this ambiguity.</p>
<p>Whether something more fundamental is needed on the productions around [74],[75] and [84]-[88] I'm not sure, but certainly <code>type</code> can appear either as a keyword for <code>TypeQualifier</code> (consuming the bracketed type) or a value of an <code>NCName</code> (with the bracketed section being a higher-level <code>PositionalArgumentList</code>), both being part of a<code> KeySpecifier</code>.</p>
</div></details></div>
<div class="toot" id="created-1313"><h2>Pull request #1313 created<span class="toot-id"> #created-1313</span></h2><div class="pubdate">01 Jul at 15:59:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1313">https://github.com/qt4cg/qtspecs/pull/1313</a></div><details><summary>1311 Tokenizing after &lt;</summary><div class="markup"><p>Fix #1311</p>
<p>Defines precise rules for tokenization in the presence of direct element and PI constructors.</p>
<p>I chose to make the rules independent of the syntactic context.</p>
</div></details></div>
<div class="toot" id="created-1312"><h2>Issue #1312 created<span class="toot-id"> #created-1312</span></h2><div class="pubdate">01 Jul at 07:24:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1312">https://github.com/qt4cg/qtspecs/issues/1312</a></div><details><summary>Productions missing ws:explicit</summary><div class="markup"><p>Some lexical productions including</p>
<p>Digits, DecDigit, HexDigits,  HexDigit, BinaryDigits, BinaryDigit</p>
<p>are missing the ws:explicit annotation</p>
</div></details></div>
<div class="toot" id="created-1311"><h2>Issue #1311 created<span class="toot-id"> #created-1311</span></h2><div class="pubdate">30 Jun at 22:02:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1311">https://github.com/qt4cg/qtspecs/issues/1311</a></div><details><summary>Tokenization and element constructors</summary><div class="markup"><p>The new rules in Appendix A.3 on tokenization are, I believe, a great improvement on what went before. But I think there is one thing missing: they claim that the rules allow you to identify boundaries between tokens unambiguously independently of the syntactic context, but in the case of a token starting with <code>&lt;</code>, this isn't true: to distinguish whether <code>&lt;</code> represents a less-than-operator (or <code>&lt;=</code> operator) or whether it is the start of an element constructor, you need some context information.</p>
<p>Saxon's tokenization is still based on the principles outlined in the XPath 1.0 spec where tokens are disambiguated based on the immediately preceding and following tokens; this is becoming increasingly unviable. Most cases can be handled instead by moving the disambiguation into the parser rather than the tokenizer, but this relies on being able to find token boundaries without knowledge of context (as described in the 4.0 spec), which appears to be possible in all cases except <code>&lt;</code>.</p>
<p>Essentially we need to add an exception to the rule: <em>"If the current position is not the end of the input, then return the longest [literal terminal]( or [variable terminal] that can be matched starting at the current position..."</em></p>
<p>I think the exception might be formulated as follows:</p>
<p><em>In XQuery, when the next character is <code>&lt;</code> and this is immediately followed by an NCNameStart character (for example <code>X</code>) the next token could be either a less than operator, or a DirElemConstructor. The "longest terminal" rule cannot reliably distinguish these cases. Instead, the decision must take into account the syntactic context. A DirElemConstructor can only appear where the parser is expecting to read an expression, while the less-than operator can never appear where the parser is expecting an expression. This aspect of the syntactic context therefore needs to be communicated from the parser to the tokenizer.</em></p>
<p>Alternatively, the two cases might be distinguished by backtracking. The tokenizer could attempt to interpret the text following the <code>&lt;</code> character as a DirElemConstructor, and revert to the alternative interpretation if this fails.</p>
<p>Note: this was not explained clearly in 3.1. Perhaps it was covered by the quixotic phrase "the longest token consistent with the EBNF".</p>
</div></details></div>
<div class="toot" id="created-1310"><h2>Issue #1310 created<span class="toot-id"> #created-1310</span></h2><div class="pubdate">30 Jun at 02:38:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1310">https://github.com/qt4cg/qtspecs/issues/1310</a></div><p>add fn:match-groups() function</p></div>
<div class="toot" id="created-1309"><h2>Issue #1309 created<span class="toot-id"> #created-1309</span></h2><div class="pubdate">27 Jun at 19:53:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1309">https://github.com/qt4cg/qtspecs/issues/1309</a></div><details><summary>Dangling else syntax ambiguity</summary><div class="markup"><p>I think this is ambiguous, or at any rate, involves arbitrary lookahead:</p>
<p><code>if (a = b) then if (c = d) {23} else {}</code></p>
<p>You only get a successful parse if you associate the "else" with the first "if", but you can't do that until you know that there isn't going to be a second "else".</p>
<p>Again, it's the fact that an expression can now begin with a left curly brace that's the culprit.</p>
</div></details></div>
<div class="toot" id="created-1308"><h2>Issue #1308 created<span class="toot-id"> #created-1308</span></h2><div class="pubdate">27 Jun at 16:41:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1308">https://github.com/qt4cg/qtspecs/issues/1308</a></div><details><summary>fn:apply argument names</summary><div class="markup"><p>The narrative of fn:apply repeatedly refers to <code>$array</code> where <code>$arguments</code> is intended.</p>
</div></details></div>
<div class="toot" id="closed-1303"><h2>Issue #1303 closed<span class="toot-id"> #closed-1303</span></h2><div class="pubdate">27 Jun at 13:54:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1303">https://github.com/qt4cg/qtspecs/pull/1303</a></div><p>Recognize 'fn' as well as 'function' in signatures</p></div>
<div class="toot" id="created-1307"><h2>Issue #1307 created<span class="toot-id"> #created-1307</span></h2><div class="pubdate">27 Jun at 07:54:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1307">https://github.com/qt4cg/qtspecs/issues/1307</a></div><details><summary>For symmetry, add functions array:scan-left and array:scan-right</summary><div class="markup"><p>The fold-left and fold-right functions are defined both for sequences and arrays; symmetry demands that the same should apply to scan-left and scan-right.</p>
</div></details></div>
<div class="toot" id="closed-1281"><h2>Issue #1281 closed<span class="toot-id"> #closed-1281</span></h2><div class="pubdate">26 Jun at 08:51:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1281">https://github.com/qt4cg/qtspecs/issues/1281</a></div><p>invisible-xml() return type</p></div>
<div class="toot" id="closed-1294"><h2>Issue #1294 closed<span class="toot-id"> #closed-1294</span></h2><div class="pubdate">26 Jun at 08:47:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1294">https://github.com/qt4cg/qtspecs/pull/1294</a></div><p>46 Add xsl:item and xsl:sequence/@as</p></div>
<div class="toot" id="created-1306"><h2>Pull request #1306 created<span class="toot-id"> #created-1306</span></h2><div class="pubdate">26 Jun at 07:43:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1306">https://github.com/qt4cg/qtspecs/pull/1306</a></div><details><summary>46 Add @as attribute to xsl:sequence</summary><div class="markup"><p>Revised PR that drops the proposed xsl:item instruction</p>
</div></details></div>
<div class="toot" id="closed-1287"><h2>Issue #1287 closed<span class="toot-id"> #closed-1287</span></h2><div class="pubdate">25 Jun at 21:11:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1287">https://github.com/qt4cg/qtspecs/issues/1287</a></div><p>Missing error conditions for fn:parse-xml()</p></div>
<div class="toot" id="closed-1288"><h2>Issue #1288 closed<span class="toot-id"> #closed-1288</span></h2><div class="pubdate">25 Jun at 21:11:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1288">https://github.com/qt4cg/qtspecs/pull/1288</a></div><p>1287 Define parse-xml error conditions</p></div>
<div class="toot" id="closed-1298"><h2>Issue #1298 closed<span class="toot-id"> #closed-1298</span></h2><div class="pubdate">25 Jun at 20:45:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1298">https://github.com/qt4cg/qtspecs/issues/1298</a></div><p>In change markup, handle multiple issue or PR numbers</p></div>
<div class="toot" id="created-1305"><h2>Issue #1305 created<span class="toot-id"> #created-1305</span></h2><div class="pubdate">25 Jun at 19:22:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1305">https://github.com/qt4cg/qtspecs/issues/1305</a></div><details><summary>Almost all functions in FO that must process multiple string items, can have as a parameter only a single collation</summary><div class="markup"><p><strong>The problem</strong>:</p>
<p>At present the only XPath 4 function (that I am aware of) that can process multiple strings and use multiple collations (a specific collation for a specific string comparison) is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-sort"><strong><code>fn:sort</code></strong></a>.</p>
<p>Some very important functions, such as <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-deep-equal"><strong><code>fn:deep-equal</code></strong></a> and <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-compare"><strong><code>fn:compare</code></strong></a> can have only one collation as a parameter.</p>
<p>This means that when we are comparing sequences of items which contain multiple strings each of which could need to be handled in a specific collation, we are not able to provide all such collations (but are providing just a single collation) to the comparing function - <code>fn:deep-equal</code> or <code>fn:compare</code>.</p>
<p>The end result is that all string comparisons will be done using that single collation and may not produce the correct result (that would be produced if the particular comparison was done with the particular collation).</p>
<p><strong>Possible solutions</strong>.</p>
<p>It is difficult to provide a solution to this problem and the list below is open ended:</p>
<ol>
<li>
<p>Add a <strong><code>collation</code></strong> property to the type <code>xs:string</code>.
Then we would specify the type as <strong><code>(xs:string, collation-name?)</code></strong></p>
</li>
<li>
<p>Make <code>fn:deep-equal</code> and <code>fn:compare</code> accept not a single collation but a sequence of collation-names.
In this case a pair of strings will be compared once for every collation that is specified. The idea is that the sequence of collations would be provided ordered by decreasing specificity. The first result that is produced at least twice in this process (something like voting) would be the result of the comparison. In case of a tie, the comparison done with the collation that is earliest (supposed to be more specific) will have higher priority.</p>
</li>
<li>
<p>Leave this as it is at present, but add to the specification a warning to the user that specifying a single collation-name may not be what they want.</p>
</li>
<li>
<p>Remove from <code>fn:sort</code> the multiple-collations parameter and allow only a single collation.</p>
</li>
</ol>
</div></details></div>
<div class="toot" id="minutes-06-25"><h2>QT4 CG meeting 083 draft minutes<span class="toot-id"> #minutes-06-25</span></h2><div class="pubdate">25 Jun at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/06-25">https://qt4cg.org/meeting/minutes/2024/06-25</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1096"><h2>Issue #1096 closed<span class="toot-id"> #closed-1096</span></h2><div class="pubdate">25 Jun at 16:17:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1096">https://github.com/qt4cg/qtspecs/issues/1096</a></div><p>Effect of atomization on array:index-of()</p></div>
<div class="toot" id="closed-1295"><h2>Issue #1295 closed<span class="toot-id"> #closed-1295</span></h2><div class="pubdate">25 Jun at 16:17:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1295">https://github.com/qt4cg/qtspecs/pull/1295</a></div><p>1096 Redefine array:index-of to use deep-equal for comparisons</p></div>
<div class="toot" id="closed-1285"><h2>Issue #1285 closed<span class="toot-id"> #closed-1285</span></h2><div class="pubdate">25 Jun at 16:16:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1285">https://github.com/qt4cg/qtspecs/issues/1285</a></div><p>Appendix H of F&amp;O should mention change for unrecognised option parameters</p></div>
<div class="toot" id="closed-1286"><h2>Issue #1286 closed<span class="toot-id"> #closed-1286</span></h2><div class="pubdate">25 Jun at 16:16:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1286">https://github.com/qt4cg/qtspecs/pull/1286</a></div><p>Updated list of incompatibilities in F+O</p></div>
<div class="toot" id="closed-1291"><h2>Issue #1291 closed<span class="toot-id"> #closed-1291</span></h2><div class="pubdate">25 Jun at 16:12:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1291">https://github.com/qt4cg/qtspecs/issues/1291</a></div><p>Change obsolete notes on rounding</p></div>
<div class="toot" id="closed-1292"><h2>Issue #1292 closed<span class="toot-id"> #closed-1292</span></h2><div class="pubdate">25 Jun at 16:12:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1292">https://github.com/qt4cg/qtspecs/pull/1292</a></div><p>Fix issue 1291 (rounding)</p></div>
<div class="toot" id="closed-1253"><h2>Issue #1253 closed<span class="toot-id"> #closed-1253</span></h2><div class="pubdate">25 Jun at 16:09:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1253">https://github.com/qt4cg/qtspecs/issues/1253</a></div><p>XSLT: add xsl:switch to list of instructions within which whitespace is ignored</p></div>
<div class="toot" id="closed-1255"><h2>Issue #1255 closed<span class="toot-id"> #closed-1255</span></h2><div class="pubdate">25 Jun at 16:09:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1255">https://github.com/qt4cg/qtspecs/pull/1255</a></div><p>1253 whitespace in xsl:switch</p></div>
<div class="toot" id="closed-1282"><h2>Issue #1282 closed<span class="toot-id"> #closed-1282</span></h2><div class="pubdate">25 Jun at 16:06:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1282">https://github.com/qt4cg/qtspecs/pull/1282</a></div><p>Revise fn:invisible-xml</p></div>
<div class="toot" id="closed-1304"><h2>Issue #1304 closed<span class="toot-id"> #closed-1304</span></h2><div class="pubdate">25 Jun at 16:03:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1304">https://github.com/qt4cg/qtspecs/pull/1304</a></div><p>Fixed typo in the example of scan-right</p></div>
<div class="toot" id="closed-1290"><h2>Issue #1290 closed<span class="toot-id"> #closed-1290</span></h2><div class="pubdate">25 Jun at 07:39:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1290">https://github.com/qt4cg/qtspecs/pull/1290</a></div><p>Fix keyword tests to treat "fn" = "function"</p></div>
<div class="toot" id="closed-1302"><h2>Issue #1302 closed<span class="toot-id"> #closed-1302</span></h2><div class="pubdate">25 Jun at 04:24:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1302">https://github.com/qt4cg/qtspecs/pull/1302</a></div><p>Stylesheet fix for 1298</p></div>
<div class="toot" id="created-1304"><h2>Pull request #1304 created<span class="toot-id"> #created-1304</span></h2><div class="pubdate">24 Jun at 17:19:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1304">https://github.com/qt4cg/qtspecs/pull/1304</a></div><details><summary>Fixed typo in the example of scan-right</summary><div class="markup"><p>Fixed a minor typo in one of the examples for fn:scan-right</p>
</div></details></div>
<div class="toot" id="closed-1297"><h2>Issue #1297 closed<span class="toot-id"> #closed-1297</span></h2><div class="pubdate">24 Jun at 17:06:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1297">https://github.com/qt4cg/qtspecs/pull/1297</a></div><p>Minor correction to fn:scan-right  - typo</p></div>
<div class="toot" id="created-1303"><h2>Pull request #1303 created<span class="toot-id"> #created-1303</span></h2><div class="pubdate">24 Jun at 16:10:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1303">https://github.com/qt4cg/qtspecs/pull/1303</a></div><details><summary>Recognize 'fn' as well as 'function' in signatures</summary><div class="markup"><p>Stylesheet changes to the stylesheet that generates tests for all parameter keywords in system functions. The changes recognize <code>fn(</code> in function signatures indicating that the generated test case needs to supply a function as the argument value.</p>
</div></details></div>
<div class="toot" id="created-1302"><h2>Pull request #1302 created<span class="toot-id"> #created-1302</span></h2><div class="pubdate">24 Jun at 15:57:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1302">https://github.com/qt4cg/qtspecs/pull/1302</a></div><details><summary>Stylesheet fix for 1298</summary><div class="markup"><p>Changes stylesheet to handle case where a change log entry refers to multiple issues or PRs. See "Lookup Expressions" in XQuery for an example.</p>
</div></details></div>
<div class="toot" id="closed-1301"><h2>Issue #1301 closed<span class="toot-id"> #closed-1301</span></h2><div class="pubdate">24 Jun at 15:51:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1301">https://github.com/qt4cg/qtspecs/pull/1301</a></div><p>1298 links to multiple issues</p></div>
<div class="toot" id="created-1301"><h2>Pull request #1301 created<span class="toot-id"> #created-1301</span></h2><div class="pubdate">24 Jun at 15:50:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1301">https://github.com/qt4cg/qtspecs/pull/1301</a></div><details><summary>1298 links to multiple issues</summary><div class="markup"><p>Changes stylesheet so that where a change entry refers to multiple issues or PRs, the links to each one are rendered correctly. (For an example, see "Lookup Expressions" in XQuery.)</p>
</div></details></div>
<div class="toot" id="agenda-06-25"><h2>QT4 CG meeting 083 draft agenda<span class="toot-id"> #agenda-06-25</span></h2><div class="pubdate">24 Jun at 14:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/06-25">https://qt4cg.org/meeting/agenda/2024/06-25</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-1300"><h2>Issue #1300 closed<span class="toot-id"> #closed-1300</span></h2><div class="pubdate">24 Jun at 11:10:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1300">https://github.com/qt4cg/qtspecs/pull/1300</a></div><p>Commit the updated tests to the tests repository</p></div>
<div class="toot" id="created-1300"><h2>Pull request #1300 created<span class="toot-id"> #created-1300</span></h2><div class="pubdate">24 Jun at 11:10:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1300">https://github.com/qt4cg/qtspecs/pull/1300</a></div><details><summary>Commit the updated tests to the tests repository</summary><div class="markup"><p>Yes, it looks like that worked.</p>
</div></details></div>
<div class="toot" id="closed-1299"><h2>Issue #1299 closed<span class="toot-id"> #closed-1299</span></h2><div class="pubdate">24 Jun at 10:58:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1299">https://github.com/qt4cg/qtspecs/pull/1299</a></div><p>Attempt to rework how the test repository is updated</p></div>
<div class="toot" id="created-1299"><h2>Pull request #1299 created<span class="toot-id"> #created-1299</span></h2><div class="pubdate">24 Jun at 10:58:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1299">https://github.com/qt4cg/qtspecs/pull/1299</a></div><details><summary>Attempt to rework how the test repository is updated</summary><div class="markup"><p>This test will only work if I merge it, so ...</p>
</div></details></div>
<div class="toot" id="created-1298"><h2>Issue #1298 created<span class="toot-id"> #created-1298</span></h2><div class="pubdate">24 Jun at 08:03:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1298">https://github.com/qt4cg/qtspecs/issues/1298</a></div><details><summary>In change markup, handle multiple issue or PR numbers</summary><div class="markup"><p>In change markup we sometimes use multiple issue or PR numbers, for example</p>
<p><code>&lt;change issue="123 456" PR="789 799"&gt;</code></p>
<p>but the stylesheet is not currently recognizing this and generating multiple links.</p>
</div></details></div>
<div class="toot" id="created-1297"><h2>Pull request #1297 created<span class="toot-id"> #created-1297</span></h2><div class="pubdate">24 Jun at 01:15:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1297">https://github.com/qt4cg/qtspecs/pull/1297</a></div><details><summary>Minor correction to fn:scan-right  - typo</summary><div class="markup"><p>In the first example the expression was:</p>
<pre><code>scan-right(1 to 5, 0, op('+'))
</code></pre>
<p>but must be:</p>
<pre><code>scan-right(1 to 10, 0, op('+'))
</code></pre>
</div></details></div>
<div class="toot" id="created-1296"><h2>Pull request #1296 created<span class="toot-id"> #created-1296</span></h2><div class="pubdate">23 Jun at 22:57:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1296">https://github.com/qt4cg/qtspecs/pull/1296</a></div><details><summary>982 Rewrite of scan-left and scan-right</summary><div class="markup"><p>Fix #982</p>
<ol>
<li>
<p>The "equivalent expression" is replaced with one that is much shorter and hopefully easier to understand, though hopelessly inefficient as an actual implementation.</p>
</li>
<li>
<p>The result no longer includes the zero value. This seems simpler, and is consistent with other expositions I have read, e.g. of the Scala functions.</p>
</li>
<li>
<p>The signature of scan-left and scan-right is now identical to fold-left and fold-right, which apart from having the virtue of consistency, makes it much easier to specify one in terms of the other. The change is that the callback function now allows a position argument.</p>
</li>
</ol>
</div></details></div>
<div class="toot" id="closed-1048"><h2>Issue #1048 closed<span class="toot-id"> #closed-1048</span></h2><div class="pubdate">23 Jun at 19:51:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1048">https://github.com/qt4cg/qtspecs/issues/1048</a></div><p>fn:format-number: relax restrictions on exponent-separator (possibly minus-sign, percent, per-mille)</p></div>
<div class="toot" id="created-1295"><h2>Pull request #1295 created<span class="toot-id"> #created-1295</span></h2><div class="pubdate">23 Jun at 19:48:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1295">https://github.com/qt4cg/qtspecs/pull/1295</a></div><details><summary>1096 Redefine array:index-of to use deep-equal for comparisons</summary><div class="markup"><p>Fix #1096</p>
<p>Using deep-equal for comparisons seems a reasonable default that avoids the atomization problem.</p>
<p>Note, I would personally be quite happy to drop the function as an alternative resolution.</p>
</div></details></div>
<div class="toot" id="created-1294"><h2>Pull request #1294 created<span class="toot-id"> #created-1294</span></h2><div class="pubdate">23 Jun at 18:47:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1294">https://github.com/qt4cg/qtspecs/pull/1294</a></div><details><summary>46 Add xsl:item and xsl:sequence/@as</summary><div class="markup"><p>Fix #46</p>
<p>Fix #1272</p>
</div></details></div>
<div class="toot" id="created-1293"><h2>Pull request #1293 created<span class="toot-id"> #created-1293</span></h2><div class="pubdate">23 Jun at 17:24:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1293">https://github.com/qt4cg/qtspecs/pull/1293</a></div><details><summary>1289 Delete XQuery Appendix J</summary><div class="markup"><p>Fix #1289</p>
</div></details></div>
<div class="toot" id="created-1292"><h2>Pull request #1292 created<span class="toot-id"> #created-1292</span></h2><div class="pubdate">23 Jun at 15:59:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1292">https://github.com/qt4cg/qtspecs/pull/1292</a></div><details><summary>Fix issue 1291 (rounding)</summary><div class="markup"><p>Delete an obsolete note.</p>
<p>Make the spec consistent with regard to the keyword "to-even" vs "half-to-even".</p>
<p>Fix #1291</p>
</div></details></div>
<div class="toot" id="created-1291"><h2>Issue #1291 created<span class="toot-id"> #created-1291</span></h2><div class="pubdate">23 Jun at 15:44:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1291">https://github.com/qt4cg/qtspecs/issues/1291</a></div><details><summary>Change obsolete notes on rounding</summary><div class="markup"><p>There are a couple of non-normative notes on rounding that don't reflect the latest changes to the spec.</p>
<p>In addition, the specification has been left inconsistent as to whether the option for rounding to even is written as "to-even" or "half-to-even". The latter spelling was intended.</p>
</div></details></div>
<div class="toot" id="closed-1245"><h2>Issue #1245 closed<span class="toot-id"> #closed-1245</span></h2><div class="pubdate">23 Jun at 15:39:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1245">https://github.com/qt4cg/qtspecs/issues/1245</a></div><p>fn:format-dateTime: Properties</p></div>
<div class="toot" id="closed-1264"><h2>Issue #1264 closed<span class="toot-id"> #closed-1264</span></h2><div class="pubdate">23 Jun at 15:39:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1264">https://github.com/qt4cg/qtspecs/pull/1264</a></div><p>1245 Correct properties of format-DT function family</p></div>
<div class="toot" id="closed-1236"><h2>Issue #1236 closed<span class="toot-id"> #closed-1236</span></h2><div class="pubdate">23 Jun at 15:36:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1236">https://github.com/qt4cg/qtspecs/issues/1236</a></div><p>QT4CG-078-01 fn:unparsed-text-lines, normalize newlines</p></div>
<div class="toot" id="created-1290"><h2>Pull request #1290 created<span class="toot-id"> #created-1290</span></h2><div class="pubdate">23 Jun at 14:42:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1290">https://github.com/qt4cg/qtspecs/pull/1290</a></div><details><summary>Fix keyword tests to treat "fn" = "function"</summary><div class="markup"><p>When generating keyword tests for higher-order functions, the parameter type now generally uses "fn" rather than "function", which causes the stylesheet to generate incorrect tests.</p>
</div></details></div>
<div class="toot" id="created-1289"><h2>Issue #1289 created<span class="toot-id"> #created-1289</span></h2><div class="pubdate">22 Jun at 11:57:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1289">https://github.com/qt4cg/qtspecs/issues/1289</a></div><details><summary>Delete XQuery Appendix J</summary><div class="markup"><p>Appendix J contains examples of XQuery applications. It already acknowledges that some of these could significantly benefit from using new features in versions 3.0 and 3.1. I think it has now served its purpose and it's time to remove it.</p>
</div></details></div>
<div class="toot" id="created-1288"><h2>Pull request #1288 created<span class="toot-id"> #created-1288</span></h2><div class="pubdate">21 Jun at 16:47:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1288">https://github.com/qt4cg/qtspecs/pull/1288</a></div><details><summary>1287 Define parse-xml error conditions</summary><div class="markup"><p>Fix #1287</p>
</div></details></div>
<div class="toot" id="created-1287"><h2>Issue #1287 created<span class="toot-id"> #created-1287</span></h2><div class="pubdate">20 Jun at 18:43:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1287">https://github.com/qt4cg/qtspecs/issues/1287</a></div><details><summary>Missing error conditions for fn:parse-xml()</summary><div class="markup"><p>I propose to define:</p>
<p>FODC0007 - DTD or schema validation was requested in <code>parse-xml()</code>, and the XML was found to be invalid.</p>
<p>FODC0008 - Invalid value for the schema-validation option of <code>parse-xml()</code> (for example, "Type XXX" where XXX is an invalid QName or a QName that does not refer to a known type.</p>
</div></details></div>
<div class="toot" id="minutes-06-18"><h2>QT4 CG meeting 082 draft minutes<span class="toot-id"> #minutes-06-18</span></h2><div class="pubdate">18 Jun at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/06-18">https://qt4cg.org/meeting/minutes/2024/06-18</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1274"><h2>Issue #1274 closed<span class="toot-id"> #closed-1274</span></h2><div class="pubdate">18 Jun at 16:27:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1274">https://github.com/qt4cg/qtspecs/issues/1274</a></div><p>Further refinement of fn:round()</p></div>
<div class="toot" id="closed-1275"><h2>Issue #1275 closed<span class="toot-id"> #closed-1275</span></h2><div class="pubdate">18 Jun at 16:27:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1275">https://github.com/qt4cg/qtspecs/pull/1275</a></div><p>1274 Further rounding modes</p></div>
<div class="toot" id="closed-1268"><h2>Issue #1268 closed<span class="toot-id"> #closed-1268</span></h2><div class="pubdate">18 Jun at 16:25:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1268">https://github.com/qt4cg/qtspecs/pull/1268</a></div><p>QT4CG-077-03 Add note on document order across documents</p></div>
<div class="toot" id="closed-1270"><h2>Issue #1270 closed<span class="toot-id"> #closed-1270</span></h2><div class="pubdate">18 Jun at 16:17:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1270">https://github.com/qt4cg/qtspecs/pull/1270</a></div><p>QT4CG-081-01 Add cross refererence from fn:round-half-to-even</p></div>
<div class="toot" id="closed-1276"><h2>Issue #1276 closed<span class="toot-id"> #closed-1276</span></h2><div class="pubdate">18 Jun at 16:14:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1276">https://github.com/qt4cg/qtspecs/pull/1276</a></div><p>QT4CG-081-03 parse-xml-[fragment]: $options should be optional</p></div>
<div class="toot" id="closed-1278"><h2>Issue #1278 closed<span class="toot-id"> #closed-1278</span></h2><div class="pubdate">18 Jun at 16:12:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1278">https://github.com/qt4cg/qtspecs/issues/1278</a></div><p>Line endings in unparsed-text-lines()</p></div>
<div class="toot" id="closed-1279"><h2>Issue #1279 closed<span class="toot-id"> #closed-1279</span></h2><div class="pubdate">18 Jun at 16:12:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1279">https://github.com/qt4cg/qtspecs/pull/1279</a></div><p>1278 - line endings in unparsed-text-lines</p></div>
<div class="toot" id="closed-1267"><h2>Issue #1267 closed<span class="toot-id"> #closed-1267</span></h2><div class="pubdate">18 Jun at 16:07:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1267">https://github.com/qt4cg/qtspecs/issues/1267</a></div><p>fn:apply() - contradiction in spec</p></div>
<div class="toot" id="closed-1280"><h2>Issue #1280 closed<span class="toot-id"> #closed-1280</span></h2><div class="pubdate">18 Jun at 16:07:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1280">https://github.com/qt4cg/qtspecs/pull/1280</a></div><p>1267 fn:apply contradictions</p></div>
<div class="toot" id="created-1286"><h2>Pull request #1286 created<span class="toot-id"> #created-1286</span></h2><div class="pubdate">18 Jun at 10:58:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1286">https://github.com/qt4cg/qtspecs/pull/1286</a></div><details><summary>Updated list of incompatibilities in F+O</summary><div class="markup"><p>Added an incompatibility regarding unrecognized option values.</p>
<p>Removed an incompatibility regarding normalisation of line endings in unparsed-text().</p>
<p>Fix #1285</p>
</div></details></div>
<div class="toot" id="created-1285"><h2>Issue #1285 created<span class="toot-id"> #created-1285</span></h2><div class="pubdate">17 Jun at 16:31:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1285">https://github.com/qt4cg/qtspecs/issues/1285</a></div><details><summary>Appendix H of F&amp;O should mention change for unrecognised option parameters</summary><div class="markup"><p>We have made a change to the option parameter conventions so that unrecognised options are no longer ignored, they are now rejected. We should document this in Appendix H as a backwards incompatibility.</p>
</div></details></div>
<div class="toot" id="created-1284"><h2>Issue #1284 created<span class="toot-id"> #created-1284</span></h2><div class="pubdate">17 Jun at 16:28:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1284">https://github.com/qt4cg/qtspecs/issues/1284</a></div><details><summary>Build issue: Unsupported specref to  [streamability-fn-distinct-ordered-nodes]</summary><div class="markup"><p>I <em>think</em> the problem is that there's no "streamibility of fn:distinct-ordered-nodes" section. The expanded versions of the XSLT 4.0 specification all contain generated links to such a section, but there's no such section.</p>
<p>Editorial oversight, or should that function <em>not</em> generate the specref for some reason?</p>
</div></details></div>
<div class="toot" id="created-1283"><h2>Pull request #1283 created<span class="toot-id"> #created-1283</span></h2><div class="pubdate">17 Jun at 15:56:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1283">https://github.com/qt4cg/qtspecs/pull/1283</a></div><details><summary>77b Update expressions</summary><div class="markup"><p>This PR is the result of splitting PR #832 into two parts; this part extracts update expressions into a separate proposal, for ease of review.</p>
</div></details></div>
<div class="toot" id="created-1282"><h2>Pull request #1282 created<span class="toot-id"> #created-1282</span></h2><div class="pubdate">17 Jun at 15:47:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1282">https://github.com/qt4cg/qtspecs/pull/1282</a></div><details><summary>Revise fn:invisible-xml</summary><div class="markup"><ol>
<li>Resolve <code>QT4CG-080-04</code>: NW to revise p:invisible-xml, fix #991</li>
<li>Resolve <code>QT4CG-081-04</code>: NW to update the function signature of fn:invisible-xml</li>
<li>Resolve <code>QT4CG-081-04</code>: NW to describe why the grammar option can be empty on fn:invisible-xml</li>
</ol>
</div></details></div>
<div class="toot" id="created-1281"><h2>Issue #1281 created<span class="toot-id"> #created-1281</span></h2><div class="pubdate">17 Jun at 11:23:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1281">https://github.com/qt4cg/qtspecs/issues/1281</a></div><details><summary>invisible-xml() return type</summary><div class="markup"><p>It has been pointed out that the return type of <code>fn:invisible-xml()</code>, currently <code>fn(xs:string) as item()</code>, could be more precisely given as <code>fn(xs:string) as document-node()</code>.</p>
</div></details></div>
<div class="toot" id="created-1280"><h2>Pull request #1280 created<span class="toot-id"> #created-1280</span></h2><div class="pubdate">17 Jun at 07:52:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1280">https://github.com/qt4cg/qtspecs/pull/1280</a></div><details><summary>1267 fn:apply contradictions</summary><div class="markup"><p>Fix #1267</p>
</div></details></div>
<div class="toot" id="created-1279"><h2>Pull request #1279 created<span class="toot-id"> #created-1279</span></h2><div class="pubdate">17 Jun at 05:41:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1279">https://github.com/qt4cg/qtspecs/pull/1279</a></div><details><summary>1278 - line endings in unparsed-text-lines</summary><div class="markup"><p>Fix #1278</p>
</div></details></div>
<div class="toot" id="created-1278"><h2>Issue #1278 created<span class="toot-id"> #created-1278</span></h2><div class="pubdate">16 Jun at 21:28:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1278">https://github.com/qt4cg/qtspecs/issues/1278</a></div><details><summary>Line endings in unparsed-text-lines()</summary><div class="markup"><p>The status quo text says:</p>
<blockquote>
<p>The $options argument is interpreted in the same way as the $options argument of [fn:unparsed-text]. In particular, for backwards compatibility, the supplied argument may be either a string (the name of an encoding) or a map.</p>
<p>If the normalize-newlines option is set to true, then the single character U+000A (NEWLINE) , the single character U+000D (CARRIAGE RETURN) , and the character pair (U+000D (CARRIAGE RETURN) , U+000A (NEWLINE) ) are all recognized as line delimiters for the purpose of splitting the text into lines. If the option is set to false, then only the single character U+000A (NEWLINE) is recognized.</p>
<p>The result of the function is the same as the result of the expression:</p>
<p>(fn:unparsed-text($href, map:put($options, 'normalize-newlines', true()))
=&gt; fn:tokenize('\n'))
[not(position()=last() and .='')]</p>
</blockquote>
<p>There's clearly an inconsistency here. In unparsed-text, the default for normalize-newlines is false. But the equivalent expression ignores the supplied value and uses normalize-newlines=true. The second paragraph says that setting normalize-newlines to false means that only NL is recognized, but the equivalent expression contradicts this.</p>
<p>I think the answer is to disallow the normalize-newlines option entirely, and recognize all three line endings as in 3.1.</p>
</div></details></div>
<div class="toot" id="created-1277"><h2>Issue #1277 created<span class="toot-id"> #created-1277</span></h2><div class="pubdate">16 Jun at 18:52:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1277">https://github.com/qt4cg/qtspecs/issues/1277</a></div><details><summary>Declare named record types</summary><div class="markup"><p>Raised in response to action QT4CG-063-06.</p>
<p>Currently named item types are simply an alias - except when they declare a record type, in which case they have some magic properties by allowing the record type to be recursive, and by the fact that they implicitly create constructor functions.</p>
<p>We would also like to refine these constructor functions for example by allowing default values for fields to be defined.</p>
<p>It might therefore make sense to define a separate construct for declaring named record types (in both XQuery and XSLT), and perhaps putting these in a separate category in the static context.</p>
<p>We might also consider introducing some built-in named record types, for example for key-value pairs, so that users can conveniently construct instances of these record types without explicitly declaring them. These would presumably be in the fn namespace.</p>
</div></details></div>
<div class="toot" id="created-1276"><h2>Pull request #1276 created<span class="toot-id"> #created-1276</span></h2><div class="pubdate">16 Jun at 18:05:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1276">https://github.com/qt4cg/qtspecs/pull/1276</a></div><details><summary>QT4CG-081-03 parse-xml-[fragment]: $options should be optional</summary><div class="markup"><p>Changes the function signature of parse-xml and parse-xml-fragment so the $options argument can be set to an empty sequence.</p>
</div></details></div>
<div class="toot" id="created-1275"><h2>Pull request #1275 created<span class="toot-id"> #created-1275</span></h2><div class="pubdate">14 Jun at 10:54:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1275">https://github.com/qt4cg/qtspecs/pull/1275</a></div><details><summary>1274 Further rounding modes</summary><div class="markup"><p>Fix #1274</p>
</div></details></div>
<div class="toot" id="created-1274"><h2>Issue #1274 created<span class="toot-id"> #created-1274</span></h2><div class="pubdate">14 Jun at 09:44:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1274">https://github.com/qt4cg/qtspecs/issues/1274</a></div><details><summary>Further refinement of fn:round()</summary><div class="markup"><p>I've been adding tests and an implementation of the changes to fn:round() which now allow control of midpoint rounding, and this generates some thoughts.</p>
<p>Firstly, we're using the rounding modes "floor" and "ceiling" with a different meaning from Java class RoundingMode, which may confuse some users. In our spec, these only affect handling of midpoint values, whereas in Java they affect all values, for example rounding 1.7 with rounding mode "floor" gives 1.0.</p>
<p>Secondly, the function library only offers <code>fn:floor()</code> and <code>fn:ceiling()</code> to an integer. There's no way, for example, of rounding 1.9997 to 1.999 (which happens to be what we do in <code>format-time()</code>).</p>
<p>So I propose that we extend the set of rounding modes to:</p>
<ul>
<li>floor - towards negative infinity</li>
<li>ceiling - towards positive infinity</li>
<li>toward-zero - towards zero (i.e. truncate)</li>
<li>away-from-zero - away from zero</li>
<li>half-to-floor - to nearest, or floor if at midpoint</li>
<li>half-to-ceiling - to nearest, or ceiling if at midpoint</li>
<li>half-toward-zero - to nearest, or toward zero if at midpoint</li>
<li>half-away-from-zero - to nearest, or away from zero if at midpoint</li>
<li>half-to-even - to nearest, or to even if at midpoint</li>
</ul>
</div></details></div>
<div class="toot" id="created-1273"><h2>Issue #1273 created<span class="toot-id"> #created-1273</span></h2><div class="pubdate">13 Jun at 16:49:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1273">https://github.com/qt4cg/qtspecs/issues/1273</a></div><details><summary>Generalize for-each-pair to work with any number of input sequences</summary><div class="markup"><p>Inspired by https://stackoverflow.com/questions/78614003</p>
<p>fn:for-each-pair is great when you want to select corresponding items from two input sequences. But what if there are more than two?</p>
<p>We could provide</p>
<p><code>for-corresponding-items($input-sequences as array(item*)), $action as function(item()*))</code></p>
<p>For example</p>
<pre><code>for-corresponding-items([(1,2,3), ("a","b","c"), (true(), false(), true())],
       fn{ array{.} }
)
</code></pre>
<p>returns <code>[1, "a", true()], [2, "b", false()], [3, "c", true()]</code></p>
</div></details></div>
<div class="toot" id="created-1272"><h2>Issue #1272 created<span class="toot-id"> #created-1272</span></h2><div class="pubdate">12 Jun at 08:27:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1272">https://github.com/qt4cg/qtspecs/issues/1272</a></div><details><summary>Add xsl:value-of/@as attribute</summary><div class="markup"><p>It has been suggested that we should add an @as attribute to xsl:value-of.</p>
<p>The intent is to use this when returning a function result:</p>
<pre><code>&lt;xsl:function name="f:incr"&gt;
  &lt;xsl:param name="x" as="xs:integer"/&gt;
  &lt;xsl:value-of select="$x+1" as="xs:integer"/&gt;
&lt;/xsl:function&gt;
</code></pre>
<p>In the absense of the @as attribute, the instruction constructs a text node as now. If @as is added, the effect of the instruction is to evaluate the select expression and coerce the result to the specified type.</p>
<p>There are a number of questions of detail. What do we do about the @separator and @disable-output-escaping attributes? Do we allow <code>as="text()"</code> so that there is an explicit way of getting the default behavior?</p>
<p>More generally, will this actually make users' lives easier? It might read better than <code>xsl:sequence</code> in this situation, but it isn't any more discoverable. Users who write code by copy-and-paste will still write xsl:value-of without realising the significance of the @as attribute.</p>
</div></details></div>
<div class="toot" id="created-1271"><h2>Issue #1271 created<span class="toot-id"> #created-1271</span></h2><div class="pubdate">12 Jun at 06:42:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1271">https://github.com/qt4cg/qtspecs/issues/1271</a></div><details><summary>Schema validation in XPath</summary><div class="markup"><p>In PR #1257 we added an options parameter to parse-xml() which includes the ability to request schema validation. We should make it clear what happens if this option is used in a non-schema-aware processor.</p>
<p>XPath does not have the XQuery validate expression but it can now request validation by calling <code>serialize() =&gt; parse-xml()</code>. This doesn't seem very satisfactory - either XPath shouldn't have a validation capability, or it should do it properly.</p>
<p>This will also affect other functions such as doc() if we add options for schema validation.</p>
</div></details></div>
<div class="toot" id="created-1270"><h2>Pull request #1270 created<span class="toot-id"> #created-1270</span></h2><div class="pubdate">11 Jun at 20:38:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1270">https://github.com/qt4cg/qtspecs/pull/1270</a></div><p>QT4CG-081-01 Add cross refererence from fn:round-half-to-even</p></div>
<div class="toot" id="closed-1248"><h2>Issue #1248 closed<span class="toot-id"> #closed-1248</span></h2><div class="pubdate">11 Jun at 20:19:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1248">https://github.com/qt4cg/qtspecs/issues/1248</a></div><p>for member allowing empty</p></div>
<div class="toot" id="closed-1241"><h2>Issue #1241 closed<span class="toot-id"> #closed-1241</span></h2><div class="pubdate">11 Jun at 16:27:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1241">https://github.com/qt4cg/qtspecs/issues/1241</a></div><p>Node constructor vs. otherwise/map constructor</p></div>
<div class="toot" id="closed-1259"><h2>Issue #1259 closed<span class="toot-id"> #closed-1259</span></h2><div class="pubdate">11 Jun at 16:27:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1259">https://github.com/qt4cg/qtspecs/pull/1259</a></div><p>1241 Add constraint to resolve node constructor ambiguity</p></div>
<div class="toot" id="closed-1246"><h2>Issue #1246 closed<span class="toot-id"> #closed-1246</span></h2><div class="pubdate">11 Jun at 16:25:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1246">https://github.com/qt4cg/qtspecs/issues/1246</a></div><p>fn:json-to-xml: `number-parser` option</p></div>
<div class="toot" id="closed-1258"><h2>Issue #1258 closed<span class="toot-id"> #closed-1258</span></h2><div class="pubdate">11 Jun at 16:25:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1258">https://github.com/qt4cg/qtspecs/pull/1258</a></div><p>1246 Revert incompatibility in json-to-xml number formatting</p></div>
<div class="toot" id="closed-305"><h2>Issue #305 closed<span class="toot-id"> #closed-305</span></h2><div class="pubdate">11 Jun at 16:23:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/305">https://github.com/qt4cg/qtspecs/issues/305</a></div><p>parse-xml() and whitespace stripping</p></div>
<div class="toot" id="closed-1257"><h2>Issue #1257 closed<span class="toot-id"> #closed-1257</span></h2><div class="pubdate">11 Jun at 16:23:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1257">https://github.com/qt4cg/qtspecs/pull/1257</a></div><p>305 Add options parameter for parse-xml and parse-xml-fragment</p></div>
<div class="toot" id="closed-1187"><h2>Issue #1187 closed<span class="toot-id"> #closed-1187</span></h2><div class="pubdate">11 Jun at 16:21:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1187">https://github.com/qt4cg/qtspecs/issues/1187</a></div><p>Decimal rounding</p></div>
<div class="toot" id="closed-1260"><h2>Issue #1260 closed<span class="toot-id"> #closed-1260</span></h2><div class="pubdate">11 Jun at 16:21:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1260">https://github.com/qt4cg/qtspecs/pull/1260</a></div><p>1187 Add midpoint-rounding option to fn:round()</p></div>
<div class="toot" id="closed-991"><h2>Issue #991 closed<span class="toot-id"> #closed-991</span></h2><div class="pubdate">11 Jun at 16:19:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/991">https://github.com/qt4cg/qtspecs/issues/991</a></div><p>Invisible-xml - missing details</p></div>
<div class="toot" id="closed-1256"><h2>Issue #1256 closed<span class="toot-id"> #closed-1256</span></h2><div class="pubdate">11 Jun at 16:19:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1256">https://github.com/qt4cg/qtspecs/pull/1256</a></div><p>991 Fix editorial details in fn:invisible-xml</p></div>
<div class="toot" id="closed-1250"><h2>Issue #1250 closed<span class="toot-id"> #closed-1250</span></h2><div class="pubdate">11 Jun at 16:17:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1250">https://github.com/qt4cg/qtspecs/pull/1250</a></div><p>1048 Extended decimal format properties</p></div>
<div class="toot" id="closed-1249"><h2>Issue #1249 closed<span class="toot-id"> #closed-1249</span></h2><div class="pubdate">11 Jun at 16:15:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1249">https://github.com/qt4cg/qtspecs/pull/1249</a></div><p>31 Introduce "for key $k value $v in $map"</p></div>
<div class="toot" id="closed-1119"><h2>Issue #1119 closed<span class="toot-id"> #closed-1119</span></h2><div class="pubdate">11 Jun at 16:15:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1119">https://github.com/qt4cg/qtspecs/issues/1119</a></div><p>Declare namespace bindings in XPath</p></div>
<div class="toot" id="closed-1055"><h2>Issue #1055 closed<span class="toot-id"> #closed-1055</span></h2><div class="pubdate">11 Jun at 16:14:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1055">https://github.com/qt4cg/qtspecs/issues/1055</a></div><p>xsl:variable/@as - simplifying the language - attempt 2</p></div>
<div class="toot" id="closed-955"><h2>Issue #955 closed<span class="toot-id"> #closed-955</span></h2><div class="pubdate">11 Jun at 16:14:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/955">https://github.com/qt4cg/qtspecs/issues/955</a></div><p>Options parameters as record types</p></div>
<div class="toot" id="closed-954"><h2>Issue #954 closed<span class="toot-id"> #closed-954</span></h2><div class="pubdate">11 Jun at 16:14:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/954">https://github.com/qt4cg/qtspecs/issues/954</a></div><p>Establish a default value for the XSLT fixed-namespaces attribute</p></div>
<div class="toot" id="closed-745"><h2>Issue #745 closed<span class="toot-id"> #closed-745</span></h2><div class="pubdate">11 Jun at 16:14:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/745">https://github.com/qt4cg/qtspecs/issues/745</a></div><p>Support for inline (anonymous) xslt functions</p></div>
<div class="toot" id="closed-557"><h2>Issue #557 closed<span class="toot-id"> #closed-557</span></h2><div class="pubdate">11 Jun at 16:14:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/557">https://github.com/qt4cg/qtspecs/issues/557</a></div><p>fn:unparsed-binary: accessing and manipulating binary types</p></div>
<div class="toot" id="closed-379"><h2>Issue #379 closed<span class="toot-id"> #closed-379</span></h2><div class="pubdate">11 Jun at 16:14:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/379">https://github.com/qt4cg/qtspecs/issues/379</a></div><p>Namespace handling in parse-html</p></div>
<div class="toot" id="closed-1181"><h2>Issue #1181 closed<span class="toot-id"> #closed-1181</span></h2><div class="pubdate">11 Jun at 16:13:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1181">https://github.com/qt4cg/qtspecs/pull/1181</a></div><p>296 Allow default-namespace=##any</p></div>
<div class="toot" id="closed-266"><h2>Issue #266 closed<span class="toot-id"> #closed-266</span></h2><div class="pubdate">11 Jun at 16:13:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/266">https://github.com/qt4cg/qtspecs/issues/266</a></div><p>Add an option on xsl:copy-of to copy a subtree with a change of namespace</p></div>
<div class="toot" id="closed-168"><h2>Issue #168 closed<span class="toot-id"> #closed-168</span></h2><div class="pubdate">11 Jun at 16:13:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/168">https://github.com/qt4cg/qtspecs/issues/168</a></div><p>XSLT Extension Instructions invoking Named Templates</p></div>
<div class="toot" id="closed-111"><h2>Issue #111 closed<span class="toot-id"> #closed-111</span></h2><div class="pubdate">11 Jun at 16:13:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/111">https://github.com/qt4cg/qtspecs/issues/111</a></div><p>FLWOR tracing</p></div>
<div class="toot" id="closed-1013"><h2>Issue #1013 closed<span class="toot-id"> #closed-1013</span></h2><div class="pubdate">11 Jun at 16:12:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1013">https://github.com/qt4cg/qtspecs/issues/1013</a></div><p>[XSLT] Need to say what happens when a capturing accumulator rule matches a non-element node</p></div>
<div class="toot" id="closed-1015"><h2>Issue #1015 closed<span class="toot-id"> #closed-1015</span></h2><div class="pubdate">11 Jun at 16:12:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1015">https://github.com/qt4cg/qtspecs/pull/1015</a></div><p>1013 [XSLT] Clarify effect of accumulator capture on non-element nodes</p></div>
<div class="toot" id="closed-956"><h2>Issue #956 closed<span class="toot-id"> #closed-956</span></h2><div class="pubdate">11 Jun at 16:09:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/956">https://github.com/qt4cg/qtspecs/pull/956</a></div><p>850-partial Editorial improvements to parse-html()</p></div>
<div class="toot" id="closed-920"><h2>Issue #920 closed<span class="toot-id"> #closed-920</span></h2><div class="pubdate">11 Jun at 16:06:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/920">https://github.com/qt4cg/qtspecs/issues/920</a></div><p>The rules for the "tail position" of a sequence constructor need to take account of xsl:switch</p></div>
<div class="toot" id="closed-921"><h2>Issue #921 closed<span class="toot-id"> #closed-921</span></h2><div class="pubdate">11 Jun at 16:06:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/921">https://github.com/qt4cg/qtspecs/pull/921</a></div><p>920 Allow xsl:break and xsl:next-iteration within branch of xsl:switch</p></div>
<div class="toot" id="created-1269"><h2>Issue #1269 created<span class="toot-id"> #created-1269</span></h2><div class="pubdate">11 Jun at 16:05:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1269">https://github.com/qt4cg/qtspecs/issues/1269</a></div><details><summary>Could the labeling of grammar productions be improved?</summary><div class="markup"><p>There was some discussion at <a href="https://qt4cg.org/meeting/minutes/2024/06-11.html">meeting 081</a> about whether the labeling of grammar productions could be improved. The current numbering isn't stable, but may have useful implications. The productions appear in snippets, sometimes more than once in different places.</p>
<p>Could we do better? How?</p>
</div></details></div>
<div class="toot" id="created-1268"><h2>Pull request #1268 created<span class="toot-id"> #created-1268</span></h2><div class="pubdate">11 Jun at 14:54:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1268">https://github.com/qt4cg/qtspecs/pull/1268</a></div><p>QT4CG-077-03 Add note on document order across documents</p></div>
<div class="toot" id="created-1267"><h2>Issue #1267 created<span class="toot-id"> #created-1267</span></h2><div class="pubdate">11 Jun at 13:58:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1267">https://github.com/qt4cg/qtspecs/issues/1267</a></div><details><summary>fn:apply() - contradiction in spec</summary><div class="markup"><p>The spec says:</p>
<blockquote>
<p>The arity of the supplied function $function must be the same as the size of the array $array.</p>
<p>The effect of calling fn:apply($f, [$a, $b, $c, ...]) is the same as the effect of the dynamic function call $f($a, $b, $c, ....). For example, the function conversion rules are applied to the supplied arguments in the usual way.</p>
</blockquote>
<p>These two rules appear contradictory. If the function conversion rules (should be: coercion rules) are applied in the usual way, then it is possible to supply excess arguments, which will be ignored.</p>
<p>If excess arguments can be supplied then the example <code>apply($f, array:subarray([ "a", "b", "c", "d", "e", "f" ], 1, function-arity($f)))</code> becomes meaningless, since the same effect can be achieved with <code>apply($f, [ "a", "b", "c", "d", "e", "f" ])</code>.</p>
<p>(Also, we could now write <code>apply($f, [ "a", "b", "c", "d", "e", "f" ]?[1 to function-arity($f)])</code>)</p>
</div></details></div>
<div class="toot" id="created-1266"><h2>Pull request #1266 created<span class="toot-id"> #created-1266</span></h2><div class="pubdate">11 Jun at 08:18:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1266">https://github.com/qt4cg/qtspecs/pull/1266</a></div><details><summary>1158 Add array mapping operator</summary><div class="markup"><p>Fix #1158</p>
</div></details></div>
<div class="toot" id="created-1265"><h2>Pull request #1265 created<span class="toot-id"> #created-1265</span></h2><div class="pubdate">11 Jun at 07:21:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1265">https://github.com/qt4cg/qtspecs/pull/1265</a></div><details><summary>1161 Further revision of document-uri constraints</summary><div class="markup"><p>Fix #1161</p>
</div></details></div>
<div class="toot" id="created-1264"><h2>Pull request #1264 created<span class="toot-id"> #created-1264</span></h2><div class="pubdate">10 Jun at 21:49:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1264">https://github.com/qt4cg/qtspecs/pull/1264</a></div><details><summary>1245 Correct properties of format-DT function family</summary><div class="markup"><p>Fix #1245</p>
<p>Note: since any of the last three arguments can now be present but set to (), the relevant context dependency becomes independent of arity, so the rules can be simplified.</p>
</div></details></div>
<div class="toot" id="created-1263"><h2>Pull request #1263 created<span class="toot-id"> #created-1263</span></h2><div class="pubdate">10 Jun at 17:04:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1263">https://github.com/qt4cg/qtspecs/pull/1263</a></div><details><summary>1224 Add xsl:accumulator-rule/@priority attribute</summary><div class="markup"><p>Fix #1224</p>
</div></details></div>
<div class="toot" id="created-1262"><h2>Pull request #1262 created<span class="toot-id"> #created-1262</span></h2><div class="pubdate">10 Jun at 16:37:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1262">https://github.com/qt4cg/qtspecs/pull/1262</a></div><details><summary>1160 Add collation-available() function</summary><div class="markup"><p>New function collation-available()</p>
<p>Existing function fn:collation() no longer fails if the constructed collation URI is unavailable.</p>
</div></details></div>
<div class="toot" id="agenda-06-11"><h2>QT4 CG meeting 081 draft agenda<span class="toot-id"> #agenda-06-11</span></h2><div class="pubdate">10 Jun at 12:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/06-11">https://qt4cg.org/meeting/agenda/2024/06-11</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1261"><h2>Issue #1261 created<span class="toot-id"> #created-1261</span></h2><div class="pubdate">10 Jun at 09:49:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1261">https://github.com/qt4cg/qtspecs/issues/1261</a></div><details><summary>Add decimal-divide function</summary><div class="markup"><p>Introduce a decimal-divide function that</p>
<p>(a) defines the precision of the required result, perhaps with rounding options
(b) returns both the quotient and the remainder in a single operation (as a map/record)</p>
</div></details></div>
<div class="toot" id="created-1260"><h2>Pull request #1260 created<span class="toot-id"> #created-1260</span></h2><div class="pubdate">10 Jun at 09:46:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1260">https://github.com/qt4cg/qtspecs/pull/1260</a></div><details><summary>1187 Add midpoint-rounding option to fn:round()</summary><div class="markup"><p>Fix #1187</p>
</div></details></div>
<div class="toot" id="created-1259"><h2>Pull request #1259 created<span class="toot-id"> #created-1259</span></h2><div class="pubdate">10 Jun at 09:04:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1259">https://github.com/qt4cg/qtspecs/pull/1259</a></div><details><summary>1241 Add constraint to resolve node constructor ambiguity</summary><div class="markup"><p>Fix #1241</p>
</div></details></div>
<div class="toot" id="created-1258"><h2>Pull request #1258 created<span class="toot-id"> #created-1258</span></h2><div class="pubdate">10 Jun at 08:26:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1258">https://github.com/qt4cg/qtspecs/pull/1258</a></div><details><summary>1246 Revert incompatibility in json-to-xml number formatting</summary><div class="markup"><p>Fix #1246</p>
</div></details></div>
<div class="toot" id="created-1257"><h2>Pull request #1257 created<span class="toot-id"> #created-1257</span></h2><div class="pubdate">10 Jun at 06:09:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1257">https://github.com/qt4cg/qtspecs/pull/1257</a></div><details><summary>305 Add options parameter for parse-xml and parse-xml-fragment</summary><div class="markup"><p>Fix #305</p>
</div></details></div>
<div class="toot" id="created-1256"><h2>Pull request #1256 created<span class="toot-id"> #created-1256</span></h2><div class="pubdate">09 Jun at 08:47:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1256">https://github.com/qt4cg/qtspecs/pull/1256</a></div><details><summary>991 Fix editorial details in fn:invisible-xml</summary><div class="markup"><p>Fix #991</p>
</div></details></div>
<div class="toot" id="created-1255"><h2>Pull request #1255 created<span class="toot-id"> #created-1255</span></h2><div class="pubdate">08 Jun at 21:48:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1255">https://github.com/qt4cg/qtspecs/pull/1255</a></div><details><summary>1253 whitespace in xsl:switch</summary><div class="markup"><p>Fix #1253</p>
</div></details></div>
<div class="toot" id="created-1254"><h2>Pull request #1254 created<span class="toot-id"> #created-1254</span></h2><div class="pubdate">08 Jun at 21:33:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1254">https://github.com/qt4cg/qtspecs/pull/1254</a></div><details><summary>729 Add rules for use of xsi:schemaLocation during validation</summary><div class="markup"><p>Fix #729</p>
</div></details></div>
<div class="toot" id="created-1253"><h2>Issue #1253 created<span class="toot-id"> #created-1253</span></h2><div class="pubdate">08 Jun at 20:27:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1253">https://github.com/qt4cg/qtspecs/issues/1253</a></div><details><summary>XSLT: add xsl:switch to list of instructions within which whitespace is ignored</summary><div class="markup"><p>Add <code>xsl:switch</code> to the list in 3.13.1 rule 5.</p>
</div></details></div>
<div class="toot" id="minutes-06-04"><h2>QT4 CG meeting 080 draft minutes<span class="toot-id"> #minutes-06-04</span></h2><div class="pubdate">06 Jun at 08:50:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/06-04">https://qt4cg.org/meeting/minutes/2024/06-04</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-1252"><h2>Issue #1252 created<span class="toot-id"> #created-1252</span></h2><div class="pubdate">05 Jun at 12:33:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1252">https://github.com/qt4cg/qtspecs/issues/1252</a></div><details><summary>Add a new function `fn:html-doc`</summary><div class="markup"><h2>Motivation</h2>
<p>The current specification has functions to retrieve <em>and</em> parse XML (<code>fn:doc#1</code>), and JSON (<code>fn:json-doc#1</code>) but <em>not</em> for html.</p>
<p>For convenience and consistency I propose to add <code>fn:html-doc($href as xs:string?) as document-node()?</code> to be added to the spec.</p>
<h2>Justification</h2>
<p>Parsing an html document after retrieving it from a source is a very common use-case.</p>
<p>@cedporter raised the question if we also want to have <code>fn:csv-doc#1</code> or maybe instead of adding specialised functions to retrieve and parse a document per data format rather extend <code>fn:doc</code> with an option to parse the retrieved document as being in a certain format (xml, json, html or csv).</p>
</div></details></div>
<div class="toot" id="closed-871"><h2>Issue #871 closed<span class="toot-id"> #closed-871</span></h2><div class="pubdate">05 Jun at 10:23:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/871">https://github.com/qt4cg/qtspecs/pull/871</a></div><p>Action qt4 cg 027 01 next match</p></div>
<div class="toot" id="closed-1216"><h2>Issue #1216 closed<span class="toot-id"> #closed-1216</span></h2><div class="pubdate">05 Jun at 08:50:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1216">https://github.com/qt4cg/qtspecs/issues/1216</a></div><p>Detailed comments on math:e, sinh(), cosh(), tanh()</p></div>
<div class="toot" id="closed-1230"><h2>Issue #1230 closed<span class="toot-id"> #closed-1230</span></h2><div class="pubdate">05 Jun at 08:50:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1230">https://github.com/qt4cg/qtspecs/pull/1230</a></div><p>1216 Detailed comments on math:e, sinh(), cosh(), tanh()</p></div>
<div class="toot" id="closed-1233"><h2>Issue #1233 closed<span class="toot-id"> #closed-1233</span></h2><div class="pubdate">05 Jun at 08:50:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1233">https://github.com/qt4cg/qtspecs/pull/1233</a></div><p>517 Major edits to fn:chain, clarification only</p></div>
<div class="toot" id="closed-814"><h2>Issue #814 closed<span class="toot-id"> #closed-814</span></h2><div class="pubdate">04 Jun at 12:37:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/814">https://github.com/qt4cg/qtspecs/issues/814</a></div><p>XSLT: Rules for on-no-match="shallow-copy-all"</p></div>
<div class="toot" id="closed-774"><h2>Issue #774 closed<span class="toot-id"> #closed-774</span></h2><div class="pubdate">04 Jun at 12:35:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/774">https://github.com/qt4cg/qtspecs/issues/774</a></div><p>What should be percent-encoded in a URI?</p></div>
<div class="toot" id="created-1251"><h2>Issue #1251 created<span class="toot-id"> #created-1251</span></h2><div class="pubdate">04 Jun at 08:56:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1251">https://github.com/qt4cg/qtspecs/issues/1251</a></div><details><summary>Allow sequence constructor in extension instructions that are implemented with named templates</summary><div class="markup"><p>This is follow up of #168</p>
<p>I would like to extend https://qt4cg.org/specifications/xslt-40/Overview.html#invoking-templates-with-extension-instructions  and allow sequence constructor inside extension instruction. I'm using such instructions in my code and it would be nice to be able to rewrite them to pure XSLT 4.0 code. Sequence constructor could be mapped to predefined parameter name. E.g.</p>
<pre><code class="language-xml">&lt;t:_&gt;Hello world.&lt;/t:_&gt;
</code></pre>
<p>Would be translated to</p>
<pre><code class="language-xml">&lt;xsl:call-template name="t:_"&gt;
  &lt;xsl:with-param name="xsl:input"&gt;Hello world.&lt;/xsl:with-param&gt;
&lt;/xsl:call-template&gt;
</code></pre>
</div></details></div>
<div class="toot" id="created-1250"><h2>Pull request #1250 created<span class="toot-id"> #created-1250</span></h2><div class="pubdate">02 Jun at 23:53:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1250">https://github.com/qt4cg/qtspecs/pull/1250</a></div><p>1048 Extended decimal format properties</p></div>
<div class="toot" id="created-1249"><h2>Pull request #1249 created<span class="toot-id"> #created-1249</span></h2><div class="pubdate">01 Jun at 18:42:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1249">https://github.com/qt4cg/qtspecs/pull/1249</a></div><details><summary>31 Introduce "for key $k value $v in $map"</summary><div class="markup"><p>Implements ForClause / ForExpression iterating over entries in maps.</p>
<p>Note that the feature is described differently in XP and XQ - I have made some starter attempts to reconverge the two specs, but there is more to be done. (However, the change involved reordering sections, which will adversely affect the diff version).</p>
</div></details></div>
<div class="toot" id="created-1248"><h2>Issue #1248 created<span class="toot-id"> #created-1248</span></h2><div class="pubdate">01 Jun at 18:24:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1248">https://github.com/qt4cg/qtspecs/issues/1248</a></div><details><summary>for member allowing empty</summary><div class="markup"><p>The XQuery spec says:</p>
<blockquote>
<p>The allowing empty option is available only when processing sequences, not when processing arrays.</p>
</blockquote>
<p>It also says "This option is not available with "for member"</p>
<p>But then it gives an example:</p>
<p><code>for member $x allowing empty in []</code></p>
<p>Logically, on grounds of orthogonality, I think we should allow it. (However, there is a justification for NOT allowing it, namely that there's no "null" value to which we can bind the range variable in this case).</p>
</div></details></div>
<div class="toot" id="agenda-06-04"><h2>QT4 CG meeting 080 draft agenda<span class="toot-id"> #agenda-06-04</span></h2><div class="pubdate">31 May at 11:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/06-04">https://qt4cg.org/meeting/agenda/2024/06-04</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1247"><h2>Issue #1247 created<span class="toot-id"> #created-1247</span></h2><div class="pubdate">31 May at 10:44:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1247">https://github.com/qt4cg/qtspecs/issues/1247</a></div><details><summary>`??type(T)` in lookup expressions - shortcuts</summary><div class="markup"><p>We've introduced the syntax <code>??type(T)</code> in lookup expressions to allow selection of items of a particular type.</p>
<p>The most common usages for T are to select a record type or an array type. It would be useful to provide shortcut syntax for such cases: <code>??record(longitude, latitude, *)</code> as a shortcut for <code>??type(record(longitude, latitude, *))</code>, <code>??array(xs:integer)</code> as a shortcut for <code>??type(array(xs:integer))</code>.</p>
<p>Note this aligns with syntax for XSLT pattern matching where for most item types (with the notable exception of atomic types) the <code>type()</code> wrapper can be omitted.</p>
</div></details></div>
<div class="toot" id="created-1246"><h2>Issue #1246 created<span class="toot-id"> #created-1246</span></h2><div class="pubdate">29 May at 13:18:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1246">https://github.com/qt4cg/qtspecs/issues/1246</a></div><details><summary>fn:json-to-xml: `number-parser` option</summary><div class="markup"><p>With #973, the <code>number-parser</code> option was added to <code>fn:json-to-xml</code>. It has been reported back to us that the current definition introduces a backward incompatibility:</p>
<pre><code class="language-xquery">json-to-xml('1234567')
</code></pre>
<p>…now returns:</p>
<pre><code class="language-xquery">&lt;number xmlns="http://www.w3.org/2005/xpath-functions"&gt;1.234567E6&lt;/number&gt;
</code></pre>
<p>Before, we got:</p>
<pre><code class="language-xquery">&lt;number xmlns="http://www.w3.org/2005/xpath-functions"&gt;1234567&lt;/number&gt;
</code></pre>
<p>I’m convinced that the <code>number-parser</code> option is am important addition for <code>fn:json-to-xml</code> – I’ve already seen its application in practice – but I think we’ll need to change the default, which currently <code>xs:double#1</code>.</p>
<p>It seems sufficient to me to change <code>xs:double#1</code> to <code>identity#1</code>.</p>
<p>As a side note, <a href="https://www.w3.org/TR/xpath-functions-31/#json-to-xml-mapping">17.4.2 XML Representation of JSON</a> still states that:</p>
<blockquote>
<p>The <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-json-to-xml">fn:json-to-xml</a> function creates an element whose string value is lexically the same as the JSON representation of the number.</p>
</blockquote>
<p>…which means that the semantics of <code>number-parser</code> have not been incorporated in this section yet (my fault).</p>
</div></details></div>
<div class="toot" id="minutes-05-28"><h2>QT4 CG meeting 079 draft minutes<span class="toot-id"> #minutes-05-28</span></h2><div class="pubdate">28 May at 17:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/05-28">https://qt4cg.org/meeting/minutes/2024/05-28</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-1245"><h2>Issue #1245 created<span class="toot-id"> #created-1245</span></h2><div class="pubdate">28 May at 16:02:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1245">https://github.com/qt4cg/qtspecs/issues/1245</a></div><details><summary>fn:format-dateTime: Properties</summary><div class="markup"><p>The <strong>Properties</strong> of <code>fn:format-dateTime</code> say:</p>
<blockquote>
<p>The two-argument form of this function is ·deterministic·, ·context-dependent·, and ·focus-independent·. It depends on default calendar, and default language, and default place, and implicit timezone.
The five-argument form of this function is ·deterministic·, ·context-dependent·, and ·focus-independent·. It depends on implicit timezone, and namespaces.</p>
</blockquote>
<p>They fail to mention the new three- and four-argument form.</p>
<p>The same applies to <code>fn:format-date</code> and <code>fn:format-time</code>.</p>
</div></details></div>
<div class="toot" id="closed-1108"><h2>Issue #1108 closed<span class="toot-id"> #closed-1108</span></h2><div class="pubdate">28 May at 15:56:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1108">https://github.com/qt4cg/qtspecs/pull/1108</a></div><p>566-partial Describe a less aggressive %-encoding for fn:build-uri</p></div>
<div class="toot" id="closed-1232"><h2>Issue #1232 closed<span class="toot-id"> #closed-1232</span></h2><div class="pubdate">28 May at 15:56:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1232">https://github.com/qt4cg/qtspecs/issues/1232</a></div><p>Rendition of RFC2119 terms</p></div>
<div class="toot" id="closed-1237"><h2>Issue #1237 closed<span class="toot-id"> #closed-1237</span></h2><div class="pubdate">28 May at 15:56:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1237">https://github.com/qt4cg/qtspecs/pull/1237</a></div><p>1232 consistent rendition of rfc2119 terms</p></div>
<div class="toot" id="closed-894"><h2>Issue #894 closed<span class="toot-id"> #closed-894</span></h2><div class="pubdate">28 May at 15:55:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/894">https://github.com/qt4cg/qtspecs/issues/894</a></div><p>Errors in forming function items</p></div>
<div class="toot" id="closed-908"><h2>Issue #908 closed<span class="toot-id"> #closed-908</span></h2><div class="pubdate">28 May at 15:55:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/908">https://github.com/qt4cg/qtspecs/issues/908</a></div><p>Function identity: documentation, nondeterminism</p></div>
<div class="toot" id="closed-1000"><h2>Issue #1000 closed<span class="toot-id"> #closed-1000</span></h2><div class="pubdate">28 May at 15:55:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1000">https://github.com/qt4cg/qtspecs/issues/1000</a></div><p>XQFO Code in the Rules sections</p></div>
<div class="toot" id="closed-1242"><h2>Issue #1242 closed<span class="toot-id"> #closed-1242</span></h2><div class="pubdate">28 May at 15:54:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1242">https://github.com/qt4cg/qtspecs/issues/1242</a></div><p>XSLT: system-property('xsl:xpath-version')</p></div>
<div class="toot" id="closed-1243"><h2>Issue #1243 closed<span class="toot-id"> #closed-1243</span></h2><div class="pubdate">28 May at 15:54:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1243">https://github.com/qt4cg/qtspecs/pull/1243</a></div><p>Change required result of system-property(...version)</p></div>
<div class="toot" id="closed-1098"><h2>Issue #1098 closed<span class="toot-id"> #closed-1098</span></h2><div class="pubdate">28 May at 14:44:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1098">https://github.com/qt4cg/qtspecs/pull/1098</a></div><p>566-partial Editorial improvements for parse-uri</p></div>
<div class="toot" id="created-1244"><h2>Pull request #1244 created<span class="toot-id"> #created-1244</span></h2><div class="pubdate">28 May at 14:44:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1244">https://github.com/qt4cg/qtspecs/pull/1244</a></div><details><summary>566-partial Rewrite parse-uri</summary><div class="markup"><p>What happened was, I discovered I'd messed with the code in two different branches.</p>
<p>In the course of trying to straighten that out, I came to the conclusion that the <em>real</em> difficulty in parsing URIs is what to do about all the special cases around <code>file:</code>. And that the approach I'd taken in the previous draft was unnecessarily complicated.</p>
<p>I think this is better.</p>
</div></details></div>
<div class="toot" id="agenda-05-28"><h2>QT4 CG meeting 079 draft agenda<span class="toot-id"> #agenda-05-28</span></h2><div class="pubdate">27 May at 11:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/05-28">https://qt4cg.org/meeting/agenda/2024/05-28</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1243"><h2>Pull request #1243 created<span class="toot-id"> #created-1243</span></h2><div class="pubdate">26 May at 14:53:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1243">https://github.com/qt4cg/qtspecs/pull/1243</a></div><details><summary>Change required result of system-property(...version)</summary><div class="markup"><p>Fix #1242</p>
</div></details></div>
<div class="toot" id="created-1242"><h2>Issue #1242 created<span class="toot-id"> #created-1242</span></h2><div class="pubdate">26 May at 13:35:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1242">https://github.com/qt4cg/qtspecs/issues/1242</a></div><details><summary>XSLT: system-property('xsl:xpath-version')</summary><div class="markup"><p>In XSLT 4.0 it should be required that <code>system-property('xsl:xpath-version')</code> returns 4.0</p>
</div></details></div>
<div class="toot" id="created-1241"><h2>Issue #1241 created<span class="toot-id"> #created-1241</span></h2><div class="pubdate">26 May at 08:05:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1241">https://github.com/qt4cg/qtspecs/issues/1241</a></div><details><summary>Node constructor vs. otherwise/map constructor</summary><div class="markup"><p>I wonder whether we should care that the following expression could be interpreted in two ways:</p>
<pre><code class="language-xquery">&lt;🤔/&gt; ! (element otherwise {})
</code></pre>
<p>The result could either be <code>&lt;otherwise/&gt;</code> or an empty map.</p>
<p>If we say it’s an edge case that we can ignore, it would be fine for me.</p>
<p>Before <code>otherwise</code> was introduced, we used <code>?:</code> in our implementation, analogous to Kotlin’s <a href="https://kotlinlang.org/docs/null-safety.html#elvis-operator">Elvis operator</a>. JavaScript now has <code>??</code> (which is no option for us).</p>
</div></details></div>
<div class="toot" id="created-1240"><h2>Issue #1240 created<span class="toot-id"> #created-1240</span></h2><div class="pubdate">23 May at 16:34:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1240">https://github.com/qt4cg/qtspecs/issues/1240</a></div><details><summary>$sequence-of-maps ? info()</summary><div class="markup"><p>We're increasingly using the design pattern where maps contain entries that are function items. If <code>$map</code> is a map and it has an entry <code>info</code> that is a zero-arity function, then <code>$map ? info()</code> invokes the function. This looks appealingly as if it's a method application applying the method <code>info()</code> on the object <code>$map</code>, but that's not actually what's really going on underneath. What is really happening is that we evaluate <code>($map ? info)</code> which yields a function item, and then we dynamically call this function.</p>
<p>Now what if <code>$maps</code> is a sequence of maps each of which has an <code>info</code> field? This parses as <code>($maps ? info)()</code>. <code>$maps ? info</code> returns a sequence of function items, and a dynamic function call can't be applied to a sequence of functions items. Instead you have to write <code>($maps ? info)!.()</code> which feels fairly bizarre.</p>
<p>Should we allow the LHS of a dynamic function call to be a sequence? On the whole, I don't tend to like operations to do implicit mapping over one of the arguments, but I feel like this might warrant an exception. The justification is that a dynamic function call is a postfix expression, and all the other postfix expressions accept a sequence on the LHS. Thoughts please.</p>
</div></details></div>
<div class="toot" id="created-1239"><h2>Issue #1239 created<span class="toot-id"> #created-1239</span></h2><div class="pubdate">23 May at 06:56:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1239">https://github.com/qt4cg/qtspecs/issues/1239</a></div><details><summary>XSLT xsl:next-match with select attribute</summary><div class="markup"><p>The ability of <code>xsl:next-match</code> to apply a sequence of template rules to the same item is limited by the fact that the item in question cannot be changed in any way. For example, if I want a template rule that matches an array to sort the array and then continue processing using the next rule for arrays, it's not possible; applying templates to the new array will sort it again, ad infinitum, while doing next-match is only possible on the original array, not the new sorted version.</p>
<p>I propose that xsl:next-match should have a select attribute. The effect is to process the selected items using the current mode, considering only the template rules that are lower in ranking order than the current template rule.</p>
<p>Alternatively or in addition, we could drop the rule that instructions that change the context item also clear the current mode. This would enable, for example, xsl:next-match to be used within xsl:for-each. However, it's possible that the results here could be confusing: we need to look at use cases.</p>
</div></details></div>
<div class="toot" id="created-1238"><h2>Issue #1238 created<span class="toot-id"> #created-1238</span></h2><div class="pubdate">23 May at 06:30:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1238">https://github.com/qt4cg/qtspecs/issues/1238</a></div><details><summary>XSLT on-no-match="shallow-copy-all" - revised rules</summary><div class="markup"><p>The work on deep lookup with modifiers enables an improved set of rules for processing trees of maps and arrays using a mode with <code>on-no-match="shallow-copy-all"</code>.</p>
<p>Recall that the intent is that if the user writes no template rules at all in such a mode, the effect is to recursively copy the entire structure without change. But it should be as easy as possible for the user to add template rules to override this processing for a selected part of the structure.</p>
<p>With this in mind, the proposed built-in rules are as follows:</p>
<p>For an array with no additional information available, we split it up into array members in a way that makes it possible to override
the processing for a specific array member:</p>
<pre><code>&lt;xsl:template match="array(*)"&gt;
  &lt;xsl:array use="?member"&gt;
     &lt;xsl:apply-templates select="for member $m at $pos in . 
                  return {"array-member":true(), "index": $pos, "member": $m}"
                                          mode="#current"/&gt;
  &lt;/xsl:array&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>The field 'array-member' here is a dummy, provided simply to make it easier to match these records at the next level of processing.</p>
<p>For the array members, when represented in this way, the items in the array member are processed one-by-one to produce
a new array member:</p>
<pre><code>&lt;xsl:template match="record(array-member as xs:boolean, index as xs:integer, member as item()*)"&gt;
     &lt;xsl:map:entry key="'member'"&gt;
        &lt;xsl:apply-templates select="for $item at $pos in ?member
                                                          return {"array-member-item":true(), 
                                                                       "index": ?index, 
                                                                       "member": ?member, 
                                                                       "item": $item,
                                                                       "position": $pos }"
                                            mode="#current"/&gt;
    &lt;/xsl:map:entry&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>The new array members are delivered as singleton maps, in the form expected by the match="array(*)" template given above.</p>
<p>For the individual items within each array member, the default is simply to apply-templates to the item:</p>
<pre><code>&lt;xsl:template match="record(array-member-item as ..., index as ..., member as ..., item as item(), position as ...)"&gt;
   &lt;xsl:apply-templates select="?item" mode="#current"/&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>Similarly for a map with no additional information, we reconstruct the map by applying templates to its individual entries:</p>
<pre><code>&lt;xsl:template match="map(*)"&gt;
  &lt;xsl:map on-duplicates="op(',')"&gt;
     &lt;xsl:apply-templates select="for entry ($k, $v) in . 
                                                        return {"map-entry":true(), "key": $k, "value": $v}"
                                          mode="#current"/&gt;
  &lt;/xsl:array&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>The built in processing for a map entry represented in this way is to reconstruct the map entry by applying templates to its individual items:</p>
<pre><code>&lt;xsl:template match="record(map-entry as xs:boolean, key as xs:anyAtomicType, value as item()*)"&gt;
     &lt;xsl:map:entry key="$key"&gt;
        &lt;xsl:apply-templates select="for $item at $pos in ?value
                                                          return {"map-entry-item":true(), 
                                                                       "key": ?key, 
                                                                       "value": ?value, 
                                                                       "item": $item,
                                                                       "position": $pos }"
                                            mode="#current"/&gt;
    &lt;/xsl:map:entry&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>For the individual items within each map entry, the default is simply to apply-templates to the item:</p>
<pre><code>&lt;xsl:template match="record(map-entry-item as ..., key as ..., value as ..., item as item(), position as ...)"&gt;
   &lt;xsl:apply-templates select="?item" mode="#current"/&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>And of course the fallback processing for items not in the above list is to return them unchanged:</p>
<pre><code>&lt;xsl:template match="item()"&gt;
   &lt;xsl:sequence select="."/&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>This allows user-written template rules to intervene at any of these levels, and to have access to contextual information about the item they are processing. For example to rename map entries with key "comment" to have key "note" instead, use:</p>
<pre><code>&lt;xsl:template match="record(map-entry, *)[?key = 'comment']"&gt;
   &lt;xsl:map-entry key="'note'" select="?value"/&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>There's one more refinement I would like, which is to provide access to the selection path for each map and array entry. I think this can be done by ensuring that within the template, items are labeled so that the function call selection-path(?value) or selection-path(?item) delivers the required result.</p>
</div></details></div>
<div class="toot" id="closed-1146"><h2>Issue #1146 closed<span class="toot-id"> #closed-1146</span></h2><div class="pubdate">22 May at 19:21:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1146">https://github.com/qt4cg/qtspecs/issues/1146</a></div><p>Identifying 4.0 Changes</p></div>
<div class="toot" id="created-1237"><h2>Pull request #1237 created<span class="toot-id"> #created-1237</span></h2><div class="pubdate">22 May at 18:57:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1237">https://github.com/qt4cg/qtspecs/pull/1237</a></div><details><summary>1232 consistent rendition of rfc2119 terms</summary><div class="markup"><p>Fix #1232</p>
</div></details></div>
<div class="toot" id="created-1236"><h2>Issue #1236 created<span class="toot-id"> #created-1236</span></h2><div class="pubdate">22 May at 12:52:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1236">https://github.com/qt4cg/qtspecs/issues/1236</a></div><details><summary>QT4CG-078-01 fn:unparsed-text-lines, normalize newlines</summary><div class="markup"><p>I think we should offer <code>normalize-newlines</code> only for <code>fn:unparsed-text</code>:</p>
<ul>
<li>It should never affect the result of <code>fn:unparsed-text-available</code>.</li>
<li>I doubt (after further consideration) that it’s really helpful for <code>fn:unparsed-text-lines</code>. The default should work just fine for nearly all users. If someone really needs to do more sophisticated string processing, it’s still possible to use <code>fn:unparsed-text</code> and modify the result.</li>
</ul>
<p>I have commited some test that (more or less) reflect the status quo: https://github.com/qt4cg/qt4tests/commit/68d40455f2404c379fdccddc1d524648ae4c8803</p>
</div></details></div>
<div class="toot" id="closed-1189"><h2>Issue #1189 closed<span class="toot-id"> #closed-1189</span></h2><div class="pubdate">22 May at 10:06:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1189">https://github.com/qt4cg/qtspecs/issues/1189</a></div><p>Function: distinct document order</p></div>
<div class="toot" id="closed-1180"><h2>Issue #1180 closed<span class="toot-id"> #closed-1180</span></h2><div class="pubdate">22 May at 10:05:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1180">https://github.com/qt4cg/qtspecs/issues/1180</a></div><p>fn:unparsed-text: `cache` option</p></div>
<div class="toot" id="closed-1172"><h2>Issue #1172 closed<span class="toot-id"> #closed-1172</span></h2><div class="pubdate">22 May at 10:01:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1172">https://github.com/qt4cg/qtspecs/issues/1172</a></div><p>Iterating maps: Positional access</p></div>
<div class="toot" id="closed-1214"><h2>Issue #1214 closed<span class="toot-id"> #closed-1214</span></h2><div class="pubdate">22 May at 09:46:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1214">https://github.com/qt4cg/qtspecs/issues/1214</a></div><p>fn:hash, CRC-32: Describe output</p></div>
<div class="toot" id="created-1235"><h2>Issue #1235 created<span class="toot-id"> #created-1235</span></h2><div class="pubdate">22 May at 08:56:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1235">https://github.com/qt4cg/qtspecs/issues/1235</a></div><details><summary>Function Identity: Treating function items with identical bodies</summary><div class="markup"><p>(One) requirement resulting from #908 (in particular, https://github.com/qt4cg/qtspecs/issues/908#issuecomment-1891524815):</p>
<p>The following examples reflect the status quo:</p>
<p># | Function | Result
-- | -- | --
1 | <code>deep-equal(&lt;a/&gt;, &lt;a/&gt;)</code> | <code>true</code>
2 | <code>let $f := fn { &lt;a/&gt; } return deep-equal($f, $f)</code> | <code>true</code>
3 | <code>deep-equal(fn { 1 }, fn { 1 })</code> | <code>true</code> or <code>false</code>
4 | <code>deep-equal(fn { &lt;a/&gt; }, fn { &lt;a/&gt; })</code> | <code>false</code></p>
<h4>Notes</h4>
<ol>
<li>The result is <code>true</code> (regardless of the identity of the compared nodes).</li>
<li>The result is <code>true</code> (regardless of the identity of the nodes that result from evaluating the functions)</li>
<li>The result is allowed to be <code>true</code> or <code>false</code>, depending on the optimization strategies of a processor.</li>
<li>Only in this case, the result must currently be <code>false</code>.</li>
</ol>
<p>We should allow <code>deep-equal</code> to return <code>true</code> for function items that have the same arguments and bodies. An implementation should be allowed to use the same internal representation for multiple occurrences of such functions.</p>
</div></details></div>
<div class="toot" id="closed-812"><h2>Issue #812 closed<span class="toot-id"> #closed-812</span></h2><div class="pubdate">22 May at 08:34:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/812">https://github.com/qt4cg/qtspecs/issues/812</a></div><p>Coercion Rules: Unifications</p></div>
<div class="toot" id="closed-358"><h2>Issue #358 closed<span class="toot-id"> #closed-358</span></h2><div class="pubdate">22 May at 08:15:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/358">https://github.com/qt4cg/qtspecs/issues/358</a></div><p>serialization indent whitespace</p></div>
<div class="toot" id="closed-101"><h2>Issue #101 closed<span class="toot-id"> #closed-101</span></h2><div class="pubdate">22 May at 08:15:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/101">https://github.com/qt4cg/qtspecs/issues/101</a></div><p>fn:serialize line breaks</p></div>
<div class="toot" id="created-1234"><h2>Issue #1234 created<span class="toot-id"> #created-1234</span></h2><div class="pubdate">22 May at 08:15:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1234">https://github.com/qt4cg/qtspecs/issues/1234</a></div><details><summary>Seralization Parameters: Indentation, Whitespace, Newlines</summary><div class="markup"><p>Summary of #358 and #101:</p>
<p>Parameter | Description | Values
--- | --- | ---
<code>indent-unit</code> | Character sequence to use for indentation. | Pattern: <code>(\\t\| +)</code><br>Examples: (<code>"\t"</code>, <code>" "</code>, <code>"    "</code>)
<code>indent-attributes</code> | Indent multiple attributes<br>(similar: <a href="http://api.html-tidy.org/tidy/quickref_5.0.0.html#indent-attributes">HTML Tidy’s configuration option</a>).<br>Should be used with spaces as indentation characters. | <code>"yes"</code>, <code>"no"</code>
<code>line-ending</code> | Newline character. | <code>"\r\n"</code>, <code>"\n"</code>, <code>"\r"</code>, …</p>
<p>If no parameter is specified, the default of the implementation is used.</p>
</div></details></div>
<div class="toot" id="created-1233"><h2>Pull request #1233 created<span class="toot-id"> #created-1233</span></h2><div class="pubdate">22 May at 02:32:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1233">https://github.com/qt4cg/qtspecs/pull/1233</a></div><details><summary>517 Major edits to fn:chain, clarification only</summary><div class="markup"><p>@dnovatchev For your review. The current version of <code>fn:chain</code> in the specs has unnecessary verbiage, is out of sync with other comparable spec entries, and has passages that cry out for clarity and concision. I do not think I have made any edits that change any substantive points. A summary:</p>
<ul>
<li>Summary simplified</li>
<li>Rules: prose for the recursive process brought into conformity with other functions in the specs that describe recursive processes.</li>
<li>Error conditions: two entries, and clarification of the conditions when they are triggered.</li>
<li>Former note 1 deleted (excessively wordy, introduces unfamiliar or unnecessary terms/concepts).</li>
<li>Former notes 3 and 4 moved to rules, distilled into more concise prose.</li>
<li>Former note 5 (now 2) recast to convey what I think was your original intent, and allows the reader to more quickly compare <code>fn:chain</code> to two comparable methods.</li>
</ul>
<p>Signature, properties, XPath rule, and examples are unchanged.</p>
</div></details></div>
<div class="toot" id="closed-1192"><h2>Issue #1192 closed<span class="toot-id"> #closed-1192</span></h2><div class="pubdate">21 May at 20:55:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1192">https://github.com/qt4cg/qtspecs/issues/1192</a></div><p>Allow "fn" as abbreviation for "function" in ItemType syntax</p></div>
<div class="toot" id="created-1232"><h2>Issue #1232 created<span class="toot-id"> #created-1232</span></h2><div class="pubdate">21 May at 20:54:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1232">https://github.com/qt4cg/qtspecs/issues/1232</a></div><details><summary>Rendition of RFC2119 terms</summary><div class="markup"><p>The specs use consistent markup for RFC 2119 terms (<em>must</em>, <em>should</em>, <em>may</em>) but the rendition differs between specs.</p>
<p>XQuery/XPath and XDM use bold text, XSLT and F&amp;O use small caps, serialization uses bold caps.</p>
<p>I propose using small caps throughout.</p>
</div></details></div>
<div class="toot" id="minutes-05-21"><h2>QT4 CG meeting 078 draft minutes<span class="toot-id"> #minutes-05-21</span></h2><div class="pubdate">21 May at 18:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/05-21">https://qt4cg.org/meeting/minutes/2024/05-21</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1229"><h2>Issue #1229 closed<span class="toot-id"> #closed-1229</span></h2><div class="pubdate">21 May at 16:57:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1229">https://github.com/qt4cg/qtspecs/pull/1229</a></div><p>Rework record descriptions per ACTION QT4CG-070-01</p></div>
<div class="toot" id="closed-1211"><h2>Issue #1211 closed<span class="toot-id"> #closed-1211</span></h2><div class="pubdate">21 May at 16:36:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1211">https://github.com/qt4cg/qtspecs/pull/1211</a></div><p>QT4CG-076-01 Add examples of coercions</p></div>
<div class="toot" id="closed-1208"><h2>Issue #1208 closed<span class="toot-id"> #closed-1208</span></h2><div class="pubdate">21 May at 16:33:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1208">https://github.com/qt4cg/qtspecs/issues/1208</a></div><p>Reserved Function Names: item, empty-sequence</p></div>
<div class="toot" id="closed-1212"><h2>Issue #1212 closed<span class="toot-id"> #closed-1212</span></h2><div class="pubdate">21 May at 16:33:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1212">https://github.com/qt4cg/qtspecs/pull/1212</a></div><p>1208 correct details of formerly-reserved function names</p></div>
<div class="toot" id="closed-1213"><h2>Issue #1213 closed<span class="toot-id"> #closed-1213</span></h2><div class="pubdate">21 May at 16:30:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1213">https://github.com/qt4cg/qtspecs/pull/1213</a></div><p>1199 Add ellipsis markup for arguments in variadic functions</p></div>
<div class="toot" id="closed-1199"><h2>Issue #1199 closed<span class="toot-id"> #closed-1199</span></h2><div class="pubdate">21 May at 16:30:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1199">https://github.com/qt4cg/qtspecs/issues/1199</a></div><p>In F+O function signatures, show some indication that a function is variadic.</p></div>
<div class="toot" id="closed-1207"><h2>Issue #1207 closed<span class="toot-id"> #closed-1207</span></h2><div class="pubdate">21 May at 16:27:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1207">https://github.com/qt4cg/qtspecs/issues/1207</a></div><p>Array filter: Positional access</p></div>
<div class="toot" id="closed-1217"><h2>Issue #1217 closed<span class="toot-id"> #closed-1217</span></h2><div class="pubdate">21 May at 16:27:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1217">https://github.com/qt4cg/qtspecs/pull/1217</a></div><p>1207 Allow numeric predicates when filtering arrays</p></div>
<div class="toot" id="closed-1219"><h2>Issue #1219 closed<span class="toot-id"> #closed-1219</span></h2><div class="pubdate">21 May at 16:24:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1219">https://github.com/qt4cg/qtspecs/pull/1219</a></div><p>1218 Drop use of union(A,B) syntax</p></div>
<div class="toot" id="closed-1218"><h2>Issue #1218 closed<span class="toot-id"> #closed-1218</span></h2><div class="pubdate">21 May at 16:24:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1218">https://github.com/qt4cg/qtspecs/issues/1218</a></div><p>Residual references to union(A, B)</p></div>
<div class="toot" id="closed-934"><h2>Issue #934 closed<span class="toot-id"> #closed-934</span></h2><div class="pubdate">21 May at 16:20:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/934">https://github.com/qt4cg/qtspecs/issues/934</a></div><p>String comparison in deep-equal</p></div>
<div class="toot" id="closed-1167"><h2>Issue #1167 closed<span class="toot-id"> #closed-1167</span></h2><div class="pubdate">21 May at 16:20:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1167">https://github.com/qt4cg/qtspecs/issues/1167</a></div><p>Merge $collation into $options parameter of fn:deep-equal()</p></div>
<div class="toot" id="closed-1191"><h2>Issue #1191 closed<span class="toot-id"> #closed-1191</span></h2><div class="pubdate">21 May at 16:20:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1191">https://github.com/qt4cg/qtspecs/pull/1191</a></div><p>1167, 934 deep equal merge collations param</p></div>
<div class="toot" id="closed-1197"><h2>Issue #1197 closed<span class="toot-id"> #closed-1197</span></h2><div class="pubdate">21 May at 16:18:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1197">https://github.com/qt4cg/qtspecs/pull/1197</a></div><p>1192 Allow fn as abbreviation for function</p></div>
<div class="toot" id="closed-1116"><h2>Issue #1116 closed<span class="toot-id"> #closed-1116</span></h2><div class="pubdate">21 May at 16:15:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1116">https://github.com/qt4cg/qtspecs/issues/1116</a></div><p>unparsed-text() end-of-line normalization</p></div>
<div class="toot" id="closed-1117"><h2>Issue #1117 closed<span class="toot-id"> #closed-1117</span></h2><div class="pubdate">21 May at 16:15:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1117">https://github.com/qt4cg/qtspecs/pull/1117</a></div><p>1116 Add options param to unparsed-text</p></div>
<div class="toot" id="closed-1223"><h2>Issue #1223 closed<span class="toot-id"> #closed-1223</span></h2><div class="pubdate">21 May at 16:11:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1223">https://github.com/qt4cg/qtspecs/pull/1223</a></div><p>Minor: fixed URL</p></div>
<div class="toot" id="closed-1222"><h2>Issue #1222 closed<span class="toot-id"> #closed-1222</span></h2><div class="pubdate">21 May at 16:09:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1222">https://github.com/qt4cg/qtspecs/pull/1222</a></div><p>1214 hash examples</p></div>
<div class="toot" id="closed-116"><h2>Issue #116 closed<span class="toot-id"> #closed-116</span></h2><div class="pubdate">21 May at 16:07:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/116">https://github.com/qt4cg/qtspecs/issues/116</a></div><p>Clarify the fn:transform function() wrt multiple top-level elements</p></div>
<div class="toot" id="closed-652"><h2>Issue #652 closed<span class="toot-id"> #closed-652</span></h2><div class="pubdate">21 May at 16:07:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/652">https://github.com/qt4cg/qtspecs/issues/652</a></div><p>Defining a common function library for XPath, XSLT, and XQuery applications</p></div>
<div class="toot" id="closed-1220"><h2>Issue #1220 closed<span class="toot-id"> #closed-1220</span></h2><div class="pubdate">21 May at 16:05:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1220">https://github.com/qt4cg/qtspecs/pull/1220</a></div><p>73 copy&amp;paste typo in fn:graphemes (combining diaeresis should be ZWJ)</p></div>
<div class="toot" id="created-1231"><h2>Pull request #1231 created<span class="toot-id"> #created-1231</span></h2><div class="pubdate">21 May at 12:19:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1231">https://github.com/qt4cg/qtspecs/pull/1231</a></div><details><summary>1193 Parsing Functions: Empty input</summary><div class="markup"><p>Issue: #1193 (covers only the obvious 4.0 inconsistencies)</p>
</div></details></div>
<div class="toot" id="created-1230"><h2>Pull request #1230 created<span class="toot-id"> #created-1230</span></h2><div class="pubdate">21 May at 11:38:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1230">https://github.com/qt4cg/qtspecs/pull/1230</a></div><details><summary>1216 Detailed comments on math:e, sinh(), cosh(), tanh()</summary><div class="markup"><p>Issue: #1216</p>
</div></details></div>
<div class="toot" id="created-1229"><h2>Pull request #1229 created<span class="toot-id"> #created-1229</span></h2><div class="pubdate">20 May at 16:46:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1229">https://github.com/qt4cg/qtspecs/pull/1229</a></div><details><summary>Rework record descriptions per ACTION QT4CG-070-01</summary><div class="markup"><p>I think this PR completes the work I started before and that we reviewed briefly some time ago.</p>
<p>Note: because this PR involves changes to the schemas and the stylesheets, the PR build is going to be...funky. I don't know if the diffs will be useful either. There are no (intentional) technical changes in this PR. You can preview the built result by look at https://qt4cgtest.nwalsh.com/branch/action-qt4cg-70-01/xpath-functions-40/Overview.html</p>
<p>A few notes:</p>
<ol>
<li>Instead of just reusing <code>fos:options</code>, I added <code>fos:record-description</code> with a very similar content model.</li>
<li>I couldn't completely remove some of the <code>&lt;fos:type&gt;</code> elements defined in the globals section at the top of the <code>function-catalog.xml</code> because it causes IDREF failures when that file is parsed.</li>
<li>I tinkered a bit with the styling, and moved a bunch of inline table styles into CSS</li>
</ol>
</div></details></div>
<div class="toot" id="agenda-05-21"><h2>QT4 CG meeting 078 draft agenda<span class="toot-id"> #agenda-05-21</span></h2><div class="pubdate">20 May at 11:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/05-21">https://qt4cg.org/meeting/agenda/2024/05-21</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-1221"><h2>Issue #1221 closed<span class="toot-id"> #closed-1221</span></h2><div class="pubdate">19 May at 20:07:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1221">https://github.com/qt4cg/qtspecs/issues/1221</a></div><p>new function - fn:tail-recurse a function to allow users to hand roll their recursion and guarentee tail recursion.</p></div>
<div class="toot" id="created-1228"><h2>Pull request #1228 created<span class="toot-id"> #created-1228</span></h2><div class="pubdate">19 May at 17:56:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1228">https://github.com/qt4cg/qtspecs/pull/1228</a></div><details><summary>– Adding the BLAKE3 hashing algorithm to fn:hash</summary><div class="markup"><p>This is a resubmission of the original https://github.com/qt4cg/qtspecs/pull/1226.
No new changes, this is fixing a pure git-technical issue.</p>
<p>Now the PR is submitted from a dedicated feature-branch and does not depend on any other branch</p>
</div></details></div>
<div class="toot" id="created-1227"><h2>Pull request #1227 created<span class="toot-id"> #created-1227</span></h2><div class="pubdate">19 May at 17:47:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1227">https://github.com/qt4cg/qtspecs/pull/1227</a></div><details><summary>150 PR resubmission for fn ranks</summary><div class="markup"><p>This is a resubmission of the original <a href="https://github.com/qt4cg/qtspecs/pull/1027">PR 1027 for function fn:ranks</a>.
No new changes, this is fixing a pure git-technical issue.</p>
<p>Now the PR is submitted from a dedicated feature-branch and not from <em>master</em></p>
</div></details></div>
<div class="toot" id="closed-1226"><h2>Issue #1226 closed<span class="toot-id"> #closed-1226</span></h2><div class="pubdate">19 May at 17:05:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1226">https://github.com/qt4cg/qtspecs/pull/1226</a></div><p>Add the BLAKE3 hashing algorithm to fn:hash</p></div>
<div class="toot" id="closed-1027"><h2>Issue #1027 closed<span class="toot-id"> #closed-1027</span></h2><div class="pubdate">19 May at 17:02:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1027">https://github.com/qt4cg/qtspecs/pull/1027</a></div><p>150 fn:ranks</p></div>
<div class="toot" id="created-1226"><h2>Pull request #1226 created<span class="toot-id"> #created-1226</span></h2><div class="pubdate">18 May at 22:33:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1226">https://github.com/qt4cg/qtspecs/pull/1226</a></div><details><summary>Add the BLAKE3 hashing algorithm to fn:hash</summary><div class="markup"><p>This PR adds the <strong>BLAKE3</strong> hashing algorithm as one of the hashing algorithms in <strong><code>fn:hash</code></strong></p>
<p>This comes from a different branch than the one that contains the PR for <strong><code>fn:ranks</code></strong>, thus both PRs must be active and independent of each other.</p>
</div></details></div>
<div class="toot" id="created-1225"><h2>Issue #1225 created<span class="toot-id"> #created-1225</span></h2><div class="pubdate">18 May at 08:33:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1225">https://github.com/qt4cg/qtspecs/issues/1225</a></div><details><summary>Generalization of Deep Updates</summary><div class="markup"><p><strong>Note:</strong> This is a discussion issue, as I cannot contribute something substantial so far.</p>
<h3>Observations</h3>
<p>Our current development to support updates in the languages may come as a surprise to developers:</p>
<ul>
<li>The XQuery core specification (which includes <strong>X</strong> in its name) will include constructs for updating <strong>Maps</strong> and <strong>Arrays</strong>.</li>
<li>To update <strong>XML</strong>, an implementation must support the XQuery Update (XQUF) specification.</li>
</ul>
<p>I think we should…</p>
<ol>
<li>either embed map/array updates in XQUF, or</li>
<li>support a modified subset of XQUF in our core specs (while remaining fully compatible with XQUF).</li>
</ol>
<p>I believe 2. is more realistic. By providing a simplified syntax, we could tackle some of the shortcomings of XQUF, such as its verbosity, and seemingly unnecessary restrictions:</p>
<h3>XQUF: Verbosity</h3>
<p>The <em>Transform</em> expression (or <em>Copy Modify</em> expression, as it’s called in 3.0) has a cumbersome and wordy syntax for doing very trivial things:</p>
<pre><code class="language-xquery">copy $node := &lt;a&gt;&lt;b/&gt;&lt;/a&gt;
modify delete node $node/b
return $node
</code></pre>
<p>The 3.0 <em>Transform With</em> syntax is a bit simpler, it utilizes the context item:</p>
<pre><code class="language-xquery">&lt;a&gt;&lt;b/&gt;&lt;/a&gt; transform with {
  delete node ./b
}
</code></pre>
<p>It resulted from the BaseX <code>update</code> syntax…</p>
<pre><code class="language-xquery">&lt;a&gt;&lt;b/&gt;&lt;/a&gt; update {
  delete node ./b
}
</code></pre>
<p>…which comes with an ambiguity that forbids its unchanged adoption: <code>element update {}</code> could be both an element constructor and an update statement. I think that dropping the curly braces (and, optionally, using parentheses) would resolve this issue.</p>
<h3>XQUF: Restrictions</h3>
<p>The XQUF syntax is very powerful, but it has some restrictions that require the use of FLWOR expressions when addressing multiple nodes. For example, the following statement is illegal…</p>
<pre><code class="language-xquery">replace //village with &lt;village/&gt;
</code></pre>
<p>…if the target is not a single node, which means that you have to write…</p>
<pre><code class="language-xquery">for $v in //village
return replace $v with &lt;village/&gt;
</code></pre>
<p>…or…</p>
<pre><code class="language-xquery">(: only supported in BaseX :)
//village ! (replace . with &lt;village/&gt;)
</code></pre>
<p>I’m pretty sure it would be safe to drop the restriction, which also exists for other update expressions, such as <code>insert nodes NODES into SINGLE-NODE</code> or <code>rename node NODE as 'NAME'</code> (<code>delete nodes NODES</code> is legal). Allowing multiple targets would greatly reduce the number of iterations required within update blocks in practice.</p>
<h3>XQuery Update <em>light</em></h3>
<p>I think the new update syntax should meet the following requirements (among others):</p>
<ul>
<li>Compatible with the XQUF node semantics.</li>
<li>Similar syntax for supported input types.</li>
<li>Chaining of update operations.</li>
</ul>
<p>First, we would need to decide on a syntax that would be applicable to both maps/arrays and nodes. We could:</p>
<ol>
<li>Build on the proposal in <a href="https://github.com/qt4cg/qtspecs/pull/832">#832</a>, which introduces a new syntax for maps and arrays, and  extend it for nodes:</li>
</ol>
<pre><code class="language-xquery">update map   INPUT-MAP   { ... }
update array INPUT-ARRAY { ... }
update node  INPUT-NODE  { ... }
</code></pre>
<ol start="2">
<li>Build on XQUF 3.0:</li>
</ol>
<pre><code class="language-xquery">INPUT-MAP   transform with { ... }
INPUT-ARRAY transform with { ... }
INPUT-NODE  transform with { ... }
</code></pre>
<ol start="3">
<li>Build on BaseX (allowing multiple input items and chains):</li>
</ol>
<pre><code class="language-xquery">INPUT-MAPS   update (...) update (...)
INPUT-ARRAYS update (...) update (...)
INPUT-NODES  update (...) update (...)
</code></pre>
<p>Syntax 2. and 3. is challenging, as the type of the input can only be evaluated at time (and for XQUF it has to be determined statically whether an expression is an updating or non-updating).</p>
<p>As we currently have a proposal for 1., I will stick to that syntax, but allow an optional plural form for <code>map</code> and <code>array</code> (inspired by XQUF), and use chains. Within the the update block, we could now use the short syntax also for nodes without the <code>node</code>/<code>nodes</code> keywords:</p>
<pre><code class="language-xquery">update map $country-map {
  delete ??entry:city
},
update maps $country-maps update {
  rename ?entry:village as 'city'
},

update node $country-node {
  delete //city
},
update nodes $country-nodes {
  insert &lt;lakes/&gt; into .,
  insert &lt;mountains/&gt; into .
} {
  insert &lt;lake/&gt; into //lakes
)
</code></pre>
<h3>Semantics</h3>
<ul>
<li>Note that for XQUF update expressions it makes a difference whether multiple expressions are defined with the same block or in a subsequent block – which is why I think chains are essential.</li>
<li>Even though the syntax would be similar for node and map/array updates, the inherent semantics would differ a lot – which is something, however, users would not need to care about too much: Node updates would greatly rely on XQUF, whereas map/array updates would be based on the new proposal.</li>
</ul>
<p>I’m looking forward to everyone’s opinions.</p>
</div></details></div>
<div class="toot" id="created-1224"><h2>Issue #1224 created<span class="toot-id"> #created-1224</span></h2><div class="pubdate">18 May at 02:27:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1224">https://github.com/qt4cg/qtspecs/issues/1224</a></div><details><summary>Attribute priority for xsl:accumulator-rule</summary><div class="markup"><p>I propose that XSLT <code>xsl:accumulator-rule</code> be allowed to take attribute <code>priority</code>, to allow users to be more declarative in their accumulator rules. Even accumulators with two or three rules might require simple overshadowing: a default rule for the majority of nodes, with accommodation for certain exceptions. An explicitly declared priority rather than document order will allows users to better express their intentions, and processor-generated warnings about duplicate matches will be more meaningful.</p>
<p>Because the current rules stipulate that among multiple rules the last one in document order wins, I think that backward compatibility prevents us from using the default priority rules for templates (i.e., allotting -0.5, 0, 0.25 scores based on match pattern types). Rather, in this case, every accumulator rule is assumed to have priority 0, unless otherwise specified. If a node matches more than one rule of the same priority level, the last one wins. This simpler version of priority (assume zero, and if you know multiple matches will overlap, use <code>@priority</code>) is one that many developers have come to use for templates.</p>
</div></details></div>
<div class="toot" id="closed-1188"><h2>Issue #1188 closed<span class="toot-id"> #closed-1188</span></h2><div class="pubdate">18 May at 01:40:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1188">https://github.com/qt4cg/qtspecs/issues/1188</a></div><p>fn:hash: Editorial</p></div>
<div class="toot" id="created-1223"><h2>Pull request #1223 created<span class="toot-id"> #created-1223</span></h2><div class="pubdate">18 May at 01:38:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1223">https://github.com/qt4cg/qtspecs/pull/1223</a></div><details><summary>Minor: fixed URL</summary><div class="markup"><p>Fixes link to Unicode TR29</p>
</div></details></div>
<div class="toot" id="created-1222"><h2>Pull request #1222 created<span class="toot-id"> #created-1222</span></h2><div class="pubdate">18 May at 01:31:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1222">https://github.com/qt4cg/qtspecs/pull/1222</a></div><details><summary>1214 hash examples</summary><div class="markup"><p>addresses #1214</p>
</div></details></div>
<div class="toot" id="created-1221"><h2>Issue #1221 created<span class="toot-id"> #created-1221</span></h2><div class="pubdate">17 May at 13:40:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1221">https://github.com/qt4cg/qtspecs/issues/1221</a></div><details><summary>new function - fn:tail-recurse a function to allow users to hand roll their recursion and guarentee tail recursion.</summary><div class="markup"><p>Motivation:</p>
<ul>
<li>I as a user of XPath want to write a recursive function.</li>
<li>I write the function,</li>
<li>I run it,</li>
<li>it causes a stack overflow</li>
</ul>
<p>So,</p>
<ul>
<li>I don't believe tail recursion detection is part of the spec thus an implementation may not implement it</li>
<li>tail recursion detection I suspect is hard, and I suspect there are cases that are tail recursion that an implementation doesnt  detect</li>
</ul>
<p>Tail recursion is not an uncommon problem in other languages, in imperative languages I would simply implement the algorithm using a 'while' loop, creating the 'body' of the while loop is my problem, but once I've done it, I KNOW that in all implementations my algorithm will be executed tail recursively (imperative code is FULL of loops, stack overloads are not an issue).</p>
<p>An example</p>
<p>I want to implement a power function in C# I know how to write it recursively, but C# doesn't support tail recursion, so I have to turn it into a loop. I could do this in an ad hoc way using a while loop, but I could also write the loop once, and then ask the developer to pass in a function that defines the body of the loop</p>
<p>in C# that function could have the type (i.e. it takes a state and either returns a new state or null, a null would indicte the end of the 'loop')</p>
<p><code>State? recurse(State state)</code></p>
<p>and the library function that executes it have the signature:</p>
<p><code>State TailRecurse&lt;State&gt;(Func&lt;State,State?&gt; f, State state) </code></p>
<p>a complete example of how this would appear in C# would be:
(note C# has a nuance w.r.t. the higher kinded type '?' and so the signature of TailRecurse below is slightly weaker than the one above).</p>
<pre><code>var toPower3 = TailRecursion.Power2(3);
var result = TailRecursion.TailRecurse(toPower3, (0, 2));

Console.WriteLine(result.Value.Item2);

class TailRecursion
{
    // actually we want, but because of a quirk in C# around the '?' higher kinded type we have to write the signature symetrically (I think).
    //public static State TailRecurse&lt;State&gt;(Func&lt;State, State?&gt; f, State state)
    public static State TailRecurse&lt;State&gt;(Func&lt;State?,State?&gt; f, State state)
    {
        while (true)
        {
            var result = f(state);
            if (result == null)
            {
                return state;
            }
            state = result;
        }
    }

    public static Func&lt;(int,int)?,(int,int)?&gt; Power2(int n)
    {
        return powerAndX =&gt;
        {
            if (powerAndX.Value.Item1 &gt; n)
            {
                return null;
            }
            return (powerAndX.Value.Item1 + 1, powerAndX.Value.Item2 * powerAndX.Value.Item2);
        };
    }
}
</code></pre>
<p>in XSLT I could write this function</p>
<pre><code>&lt;xsl:function name="kooks:pow" as="xs:integer"&gt;
    &lt;xsl:param name="x" as ="xs:integer"/&gt;
    &lt;xsl:param name="n" as ="xs:integer"/&gt;
    &lt;xsl:choose&gt;
        &lt;xsl:when test="$n = 0"&gt;
            &lt;xsl:sequence select="$x"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;
            &lt;xsl:sequence select="$x * kooks:pow($x,$n - 1)"/&gt;
        &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
&lt;/xsl:function&gt;
</code></pre>
<p>I know its tail recursive, but my environment may not for whatever reason detect it (I would hope it does, but I could be doing something much more complex, that IS tail recursive but the environment simply doesn't see it).</p>
<p>I can't write a loop in XPath etc, it doesnt exist, so I can't escape like I do in C# or scala, in F# (which also doesnt support while loops), I would have to write a function that I was sure F# detected as tail recursive and then path the 'body' of the while loop as a function.</p>
<p>in XSLT this could look like this (basically the same as the C# example)</p>
<p>here the C# signature
<code>State TailRecurse&lt;State&gt;(Func&lt;State,State?&gt; f, State state) </code>
has been translated by using <code>item()*</code> for state an <code>array(*)</code> for State?, where an empty array corresponds to null/none, and an array with 1 element corresponds to 'some' State.</p>
<p>This function IS tail recursive in a very simple way that I think all implementations would detect as such, and thus (if it does) I can pass any function I like and be confident it is processed tail recursively - I can of course do this now, I use saxon, (even though I'm wrestling with it to detect tail recursion for some bizarre reason which is probably my fault) I think it would ideally be a library function and (using a loop) allow non tail recursive environments to support tail recursion, or allow me to simply do the detection myself.</p>
<pre><code>    &lt;xsl:function name="kooks:tailRecurse"&gt;
        &lt;xsl:param name="unfolder" as="function(item()*) as array(*)"/&gt;
        &lt;xsl:param name="state" as="item()*"/&gt;
        &lt;xsl:variable name="newState" select="$unfolder($state)"/&gt;
        &lt;xsl:choose&gt;
            &lt;!-- loop returns null/none - end of recurstion --&gt;
            &lt;xsl:when test="array:size($newState) = 0"&gt;
                &lt;xsl:sequence select="$state"/&gt;
            &lt;/xsl:when&gt;
            &lt;!-- else, unpack the state and loop again --&gt;
            &lt;xsl:otherwise&gt;
                &lt;xsl:sequence select="kooks:tailRecurse($unfolder,array:get($newState,1))"/&gt;
            &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;        
    &lt;/xsl:function&gt;

</code></pre>
<p>For environments that don't do tail recursion detection, they can simple implement the analogous code to the C# example in their implementation i.e. map it to a while loop.</p>
<p>In both cases I think this is hopefully trivial for the implementor of the language.</p>
<p>Here's a complete example, with tailRecurse defined as above, that would guarentee (in an environment that detected it correctly) that any passed function is processed.</p>
<pre><code>&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:array="http://www.w3.org/2005/xpath-functions/array"
    xmlns:map="http://www.w3.org/2005/xpath-functions/map"
    exclude-result-prefixes="xs"
    version="3.0"
    xmlns:kooks="http://www.kookerella.com"&gt;
    
    &lt;!-- (state -&gt; Maybe state) -&gt; state -&gt; state --&gt; 
    &lt;xsl:function name="kooks:tailRecurse"&gt;
        &lt;xsl:param name="unfolder" as="function(item()*) as array(*)"/&gt;
        &lt;xsl:param name="state" as="item()*"/&gt;
        &lt;xsl:variable name="newState" select="$unfolder($state)"/&gt;
        &lt;xsl:choose&gt;
            &lt;!-- loop returns null/none - end of recurstion --&gt;
            &lt;xsl:when test="array:size($newState) = 0"&gt;
                &lt;xsl:sequence select="$state"/&gt;
            &lt;/xsl:when&gt;
            &lt;!-- else, unpack the state and loop again --&gt;
            &lt;xsl:otherwise&gt;
                &lt;xsl:sequence select="kooks:tailRecurse($unfolder,array:get($newState,1))"/&gt;
            &lt;/xsl:otherwise&gt;
        &lt;/xsl:choose&gt;        
    &lt;/xsl:function&gt;
    
    &lt;xsl:function name="kooks:powUnfolder" as="function(item()*) as array(*)"&gt;
        &lt;xsl:param name="x" as="xs:integer"/&gt;
        &lt;xsl:param name="n" as="xs:integer"/&gt;
        &lt;xsl:sequence select="function($state) {
                if (map:get($state,'power') &gt;= $n)
                (: we're done so return null/none :)
                then array {}
                else
                (: else calculate the next power and loop again :)
                    let $newState := map { 
                        'power': map:get($state,'power') + 1,
                        'result': map:get($state,'result') * $x
                        }
                    return array { $newState }
            }"/&gt;
    &lt;/xsl:function&gt;
    
    &lt;xsl:template match="/"&gt;
        &lt;twoToThePower4&gt;
            &lt;xsl:variable name="seed" select="map { 'power':0,'result':1 }"/&gt;
            &lt;xsl:sequence select="map:get(kooks:tailRecurse(kooks:powUnfolder(2,4),$seed),'result')"/&gt;
        &lt;/twoToThePower4&gt;
    &lt;/xsl:template&gt;    
&lt;/xsl:stylesheet&gt;
</code></pre>
<p>I suspect these lines are not obvious.</p>
<pre><code>            &lt;xsl:variable name="seed" select="map { 'power':0,'result':1 }"/&gt;
            &lt;xsl:sequence select="map:get(kooks:tailRecurse(kooks:powUnfolder(2,4),$seed),'result')"/&gt;
</code></pre>
<p>The first line says anything to the power 0 is 1, the second line says, I want the 'result of 2 to the power 4.</p>
<p>Note its VERY similar to xsl:iterate, but that requires an sequence to drive it, this is just general recursion.</p>
</div></details></div>
<div class="toot" id="closed-73"><h2>Issue #73 closed<span class="toot-id"> #closed-73</span></h2><div class="pubdate">15 May at 11:12:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/73">https://github.com/qt4cg/qtspecs/issues/73</a></div><p>Split a string by graphemes</p></div>
<div class="toot" id="created-1220"><h2>Pull request #1220 created<span class="toot-id"> #created-1220</span></h2><div class="pubdate">15 May at 09:32:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1220">https://github.com/qt4cg/qtspecs/pull/1220</a></div><details><summary>73 copy&amp;paste typo in fn:graphemes (combining diaeresis should be ZWJ)</summary><div class="markup"><p>I wonder which font I need to use in order to see U+1F476 U+200D U+1F6D1 as a single grapheme. When I naively put the character sequence into an HTML page, the two glyphs will be rendered individually. How can we make sure that the grapheme will be rendered as intended for most people when they read the spec?</p>
</div></details></div>
<div class="toot" id="created-1219"><h2>Pull request #1219 created<span class="toot-id"> #created-1219</span></h2><div class="pubdate">14 May at 20:41:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1219">https://github.com/qt4cg/qtspecs/pull/1219</a></div><details><summary>1218 Drop use of union(A,B) syntax</summary><div class="markup"><p>Fix #1218</p>
</div></details></div>
<div class="toot" id="created-1218"><h2>Issue #1218 created<span class="toot-id"> #created-1218</span></h2><div class="pubdate">14 May at 20:18:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1218">https://github.com/qt4cg/qtspecs/issues/1218</a></div><details><summary>Residual references to union(A, B)</summary><div class="markup"><p>The XQuery spec has 10 uses of the obsolete syntax <code>union(A, B)</code>, and the F&amp;O spec has another 6. XSLT has 7, and XDM has two.</p>
</div></details></div>
<div class="toot" id="minutes-05-14"><h2>QT4 CG meeting 077 draft minutes<span class="toot-id"> #minutes-05-14</span></h2><div class="pubdate">14 May at 18:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/05-14">https://qt4cg.org/meeting/minutes/2024/05-14</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-1217"><h2>Pull request #1217 created<span class="toot-id"> #created-1217</span></h2><div class="pubdate">14 May at 17:58:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1217">https://github.com/qt4cg/qtspecs/pull/1217</a></div><details><summary>1207 Allow numeric predicates when filtering arrays</summary><div class="markup"><p>Fix #1207</p>
<p>Also a minor change: <code>$V[23, "fred"]</code> now throws FORG0006 rather than XPTY0004. This keeps it compatible with 3.1 (in case anyone is catching the errors), and is more uniform: it seems unreasonable for <code>$V[23, "fred"]</code> and <code>$V["fred", 23]</code> to throw different errors.</p>
</div></details></div>
<div class="toot" id="created-1216"><h2>Issue #1216 created<span class="toot-id"> #created-1216</span></h2><div class="pubdate">14 May at 16:37:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1216">https://github.com/qt4cg/qtspecs/issues/1216</a></div><details><summary>Detailed comments on math:e, sinh(), cosh(), tanh()</summary><div class="markup"><p>I should have made these comments before we accepted the proposal, but it's only minor details.</p>
<p>In the example given for <code>math:e</code>, the explanation of the example as a compound interest calculation seems a bit simplistic. There are all sorts of assumptions here about the initial investment, the frequency at which interest is calculated, etc. It might be better just to give the expression and the result and not attempt an interpretation.</p>
<p>According to IEEE 754-2008 table 9.1, <code>sinh()</code> can produce overflow or underflow, <code>cosh()</code> can produce overflow, and <code>tanh()</code> can produce underflow. We seem to be catering for exceptions that cannot occur?</p>
<p>The example results should perhaps be tagged as approximate to ensure that they pass automated testing.</p>
<p>We should perhaps be referencing IEEE 754-2019 (though I'm reluctant to purchase a copy...)</p>
</div></details></div>
<div class="toot" id="closed-1195"><h2>Issue #1195 closed<span class="toot-id"> #closed-1195</span></h2><div class="pubdate">14 May at 16:31:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1195">https://github.com/qt4cg/qtspecs/issues/1195</a></div><p>Hash Function: CRC-32</p></div>
<div class="toot" id="closed-1206"><h2>Issue #1206 closed<span class="toot-id"> #closed-1206</span></h2><div class="pubdate">14 May at 16:31:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1206">https://github.com/qt4cg/qtspecs/pull/1206</a></div><p>1195 Hash Function: CRC-32</p></div>
<div class="toot" id="closed-1196"><h2>Issue #1196 closed<span class="toot-id"> #closed-1196</span></h2><div class="pubdate">14 May at 16:28:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1196">https://github.com/qt4cg/qtspecs/issues/1196</a></div><p>Math Functions: `math:e`, `math:sinh`, `math:cosh`, `math:tanh`</p></div>
<div class="toot" id="closed-1205"><h2>Issue #1205 closed<span class="toot-id"> #closed-1205</span></h2><div class="pubdate">14 May at 16:28:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1205">https://github.com/qt4cg/qtspecs/pull/1205</a></div><p>1196 Math Functions: math:e, math:sinh, math:cosh, math:tanh</p></div>
<div class="toot" id="closed-1204"><h2>Issue #1204 closed<span class="toot-id"> #closed-1204</span></h2><div class="pubdate">14 May at 16:24:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1204">https://github.com/qt4cg/qtspecs/pull/1204</a></div><p>1203 Define out-of-range conditions in CSV get function</p></div>
<div class="toot" id="closed-1203"><h2>Issue #1203 closed<span class="toot-id"> #closed-1203</span></h2><div class="pubdate">14 May at 16:24:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1203">https://github.com/qt4cg/qtspecs/issues/1203</a></div><p>CSV parsing: in call of get($R, $Z), what if $R is out of range</p></div>
<div class="toot" id="closed-1215"><h2>Issue #1215 closed<span class="toot-id"> #closed-1215</span></h2><div class="pubdate">14 May at 16:24:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1215">https://github.com/qt4cg/qtspecs/pull/1215</a></div><p>Fix ID/IDREF typo</p></div>
<div class="toot" id="created-1215"><h2>Pull request #1215 created<span class="toot-id"> #created-1215</span></h2><div class="pubdate">14 May at 16:24:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1215">https://github.com/qt4cg/qtspecs/pull/1215</a></div><details><summary>Fix ID/IDREF typo</summary><div class="markup"><p>I'm not sure how this slipped past the PR build checks...</p>
</div></details></div>
<div class="toot" id="created-1214"><h2>Issue #1214 created<span class="toot-id"> #created-1214</span></h2><div class="pubdate">14 May at 16:21:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1214">https://github.com/qt4cg/qtspecs/issues/1214</a></div><details><summary>fn:hash, CRC-32: Describe output</summary><div class="markup"><p>In the <a href="https://qt4cg.org/meeting/minutes/2024/05-14.html">QT4 CG Meeting 077</a> it was suggested that the binary output of the newly added <code>CRC-32</code> algorithm should be further described.</p>
</div></details></div>
<div class="toot" id="closed-1198"><h2>Issue #1198 closed<span class="toot-id"> #closed-1198</span></h2><div class="pubdate">14 May at 16:17:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1198">https://github.com/qt4cg/qtspecs/pull/1198</a></div><p>1189 distinct document order</p></div>
<div class="toot" id="closed-1068"><h2>Issue #1068 closed<span class="toot-id"> #closed-1068</span></h2><div class="pubdate">14 May at 16:15:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1068">https://github.com/qt4cg/qtspecs/pull/1068</a></div><p>73 fn:graphemes</p></div>
<div class="toot" id="closed-1200"><h2>Issue #1200 closed<span class="toot-id"> #closed-1200</span></h2><div class="pubdate">14 May at 16:12:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1200">https://github.com/qt4cg/qtspecs/pull/1200</a></div><p>QT4CG-075-02 Define the term sequence concatenation</p></div>
<div class="toot" id="closed-146"><h2>Issue #146 closed<span class="toot-id"> #closed-146</span></h2><div class="pubdate">14 May at 16:09:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/146">https://github.com/qt4cg/qtspecs/issues/146</a></div><p>fn:apply with last two arguments (array, map) for the positional and keyword args in a func-call</p></div>
<div class="toot" id="closed-162"><h2>Issue #162 closed<span class="toot-id"> #closed-162</span></h2><div class="pubdate">14 May at 16:09:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/162">https://github.com/qt4cg/qtspecs/issues/162</a></div><p>Support unbounded variadic functions on map parameter keys</p></div>
<div class="toot" id="closed-369"><h2>Issue #369 closed<span class="toot-id"> #closed-369</span></h2><div class="pubdate">14 May at 16:08:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/369">https://github.com/qt4cg/qtspecs/issues/369</a></div><p>Namespaces for Functions</p></div>
<div class="toot" id="closed-572"><h2>Issue #572 closed<span class="toot-id"> #closed-572</span></h2><div class="pubdate">14 May at 16:08:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/572">https://github.com/qt4cg/qtspecs/issues/572</a></div><p>fn:evaluate-xpath() function</p></div>
<div class="toot" id="closed-1190"><h2>Issue #1190 closed<span class="toot-id"> #closed-1190</span></h2><div class="pubdate">14 May at 16:08:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1190">https://github.com/qt4cg/qtspecs/pull/1190</a></div><p>1188 XQFO hash</p></div>
<div class="toot" id="created-1213"><h2>Pull request #1213 created<span class="toot-id"> #created-1213</span></h2><div class="pubdate">14 May at 14:58:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1213">https://github.com/qt4cg/qtspecs/pull/1213</a></div><details><summary>1199 Add ellipsis markup for arguments in variadic functions</summary><div class="markup"><p>Fix #1199</p>
</div></details></div>
<div class="toot" id="closed-1210"><h2>Issue #1210 closed<span class="toot-id"> #closed-1210</span></h2><div class="pubdate">14 May at 14:37:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1210">https://github.com/qt4cg/qtspecs/issues/1210</a></div><p>An edge case with coercion in 1.0 compatibility mode</p></div>
<div class="toot" id="created-1212"><h2>Pull request #1212 created<span class="toot-id"> #created-1212</span></h2><div class="pubdate">14 May at 11:45:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1212">https://github.com/qt4cg/qtspecs/pull/1212</a></div><details><summary>1208 correct details of formerly-reserved function names</summary><div class="markup"><p>Fix #1208</p>
</div></details></div>
<div class="toot" id="created-1211"><h2>Pull request #1211 created<span class="toot-id"> #created-1211</span></h2><div class="pubdate">14 May at 10:38:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1211">https://github.com/qt4cg/qtspecs/pull/1211</a></div><details><summary>QT4CG-076-01 Add examples of coercions</summary><div class="markup"><p>Added examples of coercion rules in action, as requested.</p>
<p>Note to reviewers: the XPath spec contains addition paragraphs explaining the effect of the 1.0 compatibility rules.</p>
</div></details></div>
<div class="toot" id="created-1210"><h2>Issue #1210 created<span class="toot-id"> #created-1210</span></h2><div class="pubdate">13 May at 16:31:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1210">https://github.com/qt4cg/qtspecs/issues/1210</a></div><details><summary>An edge case with coercion in 1.0 compatibility mode</summary><div class="markup"><p>XPath 3.1 says</p>
<blockquote>
<p>In a static function call, if [XPath 1.0 compatibility mode] is true and an argument of a static function is not of the expected type, then the following conversions are applied sequentially to the argument value V:</p>
</blockquote>
<p>In 4.0, we have dropped the phrase <em>and [the supplied value] is not of the expected type</em>. One effect of this omission is that when the expected type is <code>xs:string?</code> and the supplied value is <code>()</code>, we now apply the <code>string()</code> function which means we supply <code>""</code> rather than <code>()</code> as the coerced value.</p>
</div></details></div>
<div class="toot" id="created-1209"><h2>Pull request #1209 created<span class="toot-id"> #created-1209</span></h2><div class="pubdate">13 May at 14:49:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1209">https://github.com/qt4cg/qtspecs/pull/1209</a></div><details><summary>1183 Add transient mode and the transient{} expression</summary><div class="markup"><p>Fix #1183</p>
</div></details></div>
<div class="toot" id="agenda-05-14"><h2>QT4 CG meeting 077 draft agenda<span class="toot-id"> #agenda-05-14</span></h2><div class="pubdate">13 May at 13:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/05-14">https://qt4cg.org/meeting/agenda/2024/05-14</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="minutes-05-07"><h2>QT4 CG meeting 076 draft minutes<span class="toot-id"> #minutes-05-07</span></h2><div class="pubdate">13 May at 13:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/05-07">https://qt4cg.org/meeting/minutes/2024/05-07</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-1208"><h2>Issue #1208 created<span class="toot-id"> #created-1208</span></h2><div class="pubdate">13 May at 10:13:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1208">https://github.com/qt4cg/qtspecs/issues/1208</a></div><details><summary>Reserved Function Names: item, empty-sequence</summary><div class="markup"><p>The keywords <code>item</code> and <code>empty-sequence</code> have been dropped from the list of reversed function names:</p>
<ul>
<li>https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-reserved-fn-names</li>
<li>https://www.w3.org/TR/2017/REC-xquery-31-20170321/#id-reserved-fn-names</li>
</ul>
<p>A note exists only for the dropped <code>map</code> and <code>array</code> keywords.</p>
</div></details></div>
<div class="toot" id="created-1207"><h2>Issue #1207 created<span class="toot-id"> #created-1207</span></h2><div class="pubdate">13 May at 10:03:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1207">https://github.com/qt4cg/qtspecs/issues/1207</a></div><details><summary>Array filter: Positional access</summary><div class="markup"><p>I apologize for warming up an already accepted feature, but I have mixed feelings about the deviating rules for filters and array filters. People can do…</p>
<pre><code class="language-xquery">for $n in $numbers[1 to 5]
return $n + 1
</code></pre>
<p>…but they won’t be able to do…</p>
<pre><code class="language-xquery">for member $n in $numbers?[1 to 5]
return $n + 1
</code></pre>
<p>Of course you can always use <code>array:subarray</code>, <code>array:slice</code>, etc., but from the perspective of symmetry and usability, it’s just not obvious why positions are exclusively allowed for sequences. Even if we regard numeric predicates as a design error, we should rather <em>deliberately repeat other people’s mistakes</em>…</p>
</div></details></div>
<div class="toot" id="created-1206"><h2>Pull request #1206 created<span class="toot-id"> #created-1206</span></h2><div class="pubdate">13 May at 08:28:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1206">https://github.com/qt4cg/qtspecs/pull/1206</a></div><details><summary>1195 Hash Function: CRC-32</summary><div class="markup"><p>Issue: #1195</p>
</div></details></div>
<div class="toot" id="created-1205"><h2>Pull request #1205 created<span class="toot-id"> #created-1205</span></h2><div class="pubdate">13 May at 07:31:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1205">https://github.com/qt4cg/qtspecs/pull/1205</a></div><details><summary>1196 Math Functions: math:e, math:sinh, math:cosh, math:tanh</summary><div class="markup"><p>Issue: #1196</p>
</div></details></div>
<div class="toot" id="created-1204"><h2>Pull request #1204 created<span class="toot-id"> #created-1204</span></h2><div class="pubdate">11 May at 18:44:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1204">https://github.com/qt4cg/qtspecs/pull/1204</a></div><details><summary>1203 Define out-of-range conditions in CSV get function</summary><div class="markup"><p>Fix #1203</p>
</div></details></div>
<div class="toot" id="created-1203"><h2>Issue #1203 created<span class="toot-id"> #created-1203</span></h2><div class="pubdate">11 May at 18:01:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1203">https://github.com/qt4cg/qtspecs/issues/1203</a></div><details><summary>CSV parsing: in call of get($R, $Z), what if $R is out of range</summary><div class="markup"><p>In the description of the <code>?get($R, $Z)</code> callback function, it is stated what happens if $Z doesn't identify an actual column (error when $Z is a string, return "" when it is an integer), but it's not stated what happens when $R (the row number) is out of range.</p>
<p>The existing text could also be improved because it talks of "the argument" to the function, when there are two.</p>
<p>The Saxon implementation currently returns "" and I proposed to say that unless anyone objects.</p>
</div></details></div>
<div class="toot" id="created-1202"><h2>Issue #1202 created<span class="toot-id"> #created-1202</span></h2><div class="pubdate">10 May at 11:58:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1202">https://github.com/qt4cg/qtspecs/issues/1202</a></div><details><summary>XQFO: Rendering of new/updated functions</summary><div class="markup"><p>It’s not always clear in the XQFO draft what has been updated when a function is marked as such. In the attached examples (there are several cases), either the <code>Changed</code> section is missing, or the renderer fails to detect that the function has not actually changed:</p>
<hr>
<p><img src="https://github.com/qt4cg/qtspecs/assets/196589/0c616f31-278a-4147-9266-8d8f5d51378d" alt="image"></p>
</div></details></div>
<div class="toot" id="closed-1201"><h2>Issue #1201 closed<span class="toot-id"> #closed-1201</span></h2><div class="pubdate">09 May at 05:13:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1201">https://github.com/qt4cg/qtspecs/pull/1201</a></div><p>Update the Saxonica EE repo</p></div>
<div class="toot" id="created-1201"><h2>Pull request #1201 created<span class="toot-id"> #created-1201</span></h2><div class="pubdate">09 May at 05:13:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1201">https://github.com/qt4cg/qtspecs/pull/1201</a></div><details><summary>Update the Saxonica EE repo</summary><div class="markup"><p>This should be harmless and I would have thought unnecessary, but there were reports of trouble reading Saxon EE 12.2 from Maven. This PR just updates the maven EE repo URI. The old URI redirects to the new one, but maybe that's causing a problem somehow?</p>
</div></details></div>
<div class="toot" id="closed-1162"><h2>Issue #1162 closed<span class="toot-id"> #closed-1162</span></h2><div class="pubdate">08 May at 18:09:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1162">https://github.com/qt4cg/qtspecs/issues/1162</a></div><p>Revert strict type for positional variables (xs:integer → xs:positiveInteger)</p></div>
<div class="toot" id="closed-1165"><h2>Issue #1165 closed<span class="toot-id"> #closed-1165</span></h2><div class="pubdate">08 May at 18:07:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1165">https://github.com/qt4cg/qtspecs/issues/1165</a></div><p>[Editorial] References to numeric codepoints in prose: consistency</p></div>
<div class="toot" id="created-1200"><h2>Pull request #1200 created<span class="toot-id"> #created-1200</span></h2><div class="pubdate">08 May at 17:36:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1200">https://github.com/qt4cg/qtspecs/pull/1200</a></div><details><summary>QT4CG-075-02 Define the term sequence concatenation</summary><div class="markup"><p>Purely editorial</p>
</div></details></div>
<div class="toot" id="created-1199"><h2>Issue #1199 created<span class="toot-id"> #created-1199</span></h2><div class="pubdate">08 May at 14:29:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1199">https://github.com/qt4cg/qtspecs/issues/1199</a></div><details><summary>In F+O function signatures, show some indication that a function is variadic.</summary><div class="markup"><p>Currently the markup indicates that a function is variadic, but this is not flagged in the displayed signature.</p>
</div></details></div>
<div class="toot" id="created-1198"><h2>Pull request #1198 created<span class="toot-id"> #created-1198</span></h2><div class="pubdate">08 May at 14:28:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1198">https://github.com/qt4cg/qtspecs/pull/1198</a></div><details><summary>1189 distinct document order</summary><div class="markup"><p>Add distinct-document-order function.</p>
<p>(Somehow this PR also includes changes to XSLT examples consequent on allowing "fn" as a synonym for "function")</p>
</div></details></div>
<div class="toot" id="created-1197"><h2>Pull request #1197 created<span class="toot-id"> #created-1197</span></h2><div class="pubdate">08 May at 13:30:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1197">https://github.com/qt4cg/qtspecs/pull/1197</a></div><details><summary>1192 Allow fn as abbreviation for function</summary><div class="markup"><p>Brings function tests into line with inline function syntax</p>
</div></details></div>
<div class="toot" id="created-1196"><h2>Issue #1196 created<span class="toot-id"> #created-1196</span></h2><div class="pubdate">08 May at 10:58:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1196">https://github.com/qt4cg/qtspecs/issues/1196</a></div><details><summary>Math Functions: `math:e`, `math:sinh`, `math:cosh`, `math:tanh`</summary><div class="markup"><p>The functions <code>math:e</code>, <code>math:sinh</code>, <code>math:cosh</code> and <code>math:tanh</code> might have been missed in the past, and would be simple to add.</p>
</div></details></div>
<div class="toot" id="created-1195"><h2>Issue #1195 created<span class="toot-id"> #created-1195</span></h2><div class="pubdate">08 May at 10:47:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1195">https://github.com/qt4cg/qtspecs/issues/1195</a></div><details><summary>Hash Function: CRC-32</summary><div class="markup"><p>I discovered only now that <code>fn:hash</code> mentions that the function can also be used for computing cyclic redundancy checks.</p>
<p>Shouldn’t we add the basic <code>CRC-32</code> algorithm to the list of mandatory algorithms?</p>
</div></details></div>
<div class="toot" id="created-1194"><h2>Issue #1194 created<span class="toot-id"> #created-1194</span></h2><div class="pubdate">08 May at 09:10:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1194">https://github.com/qt4cg/qtspecs/issues/1194</a></div><details><summary>New function fn:query()</summary><div class="markup"><p>I propose a new function <code>fn:query()</code> to perform dynamic XQuery/XPath evaluation: a similar role to fn:transform() and xsl:evaluate.</p>
<p>I propose a design based on the design of fn:invisible-xml() - fn:query should take a query string as its argument, and return a function item that can be called to evaluate the query.</p>
<p>The fn:query() function will need an options map to supply significant aspects of the static context, for example the base URI. But I don't think we need to support everything. Public functions in the calling module should probably be made available automatically, in which case we don't need to support "import module".</p>
<p>The dynamic evaluation function will need an options map to supply significant aspects of the dynamic context, notably the context value and values of external parameters. The query result should be returned in "raw" (ie. unserialized) form.</p>
<p>Perhaps there should be an option language="xpath" to say that the "query" is actually an XPath expression; some implementations might find that easier to support, especially when the processor is itself an XPath processor.</p>
<p>(Motivation: Saxon has a pair of ancient extension functions <code>saxon:compile-query</code> and <code>saxon:query</code> and the design needs modernising, and bridging across to additional platforms. We might as well get it into the standard if we're doing that.)</p>
</div></details></div>
<div class="toot" id="closed-1143"><h2>Issue #1143 closed<span class="toot-id"> #closed-1143</span></h2><div class="pubdate">07 May at 18:24:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1143">https://github.com/qt4cg/qtspecs/issues/1143</a></div><p>Coercion Rules for Choice Item Types</p></div>
<div class="toot" id="closed-1148"><h2>Issue #1148 closed<span class="toot-id"> #closed-1148</span></h2><div class="pubdate">07 May at 18:24:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1148">https://github.com/qt4cg/qtspecs/pull/1148</a></div><p>1143 Coercion rules: handle choice types before atomization</p></div>
<div class="toot" id="closed-1184"><h2>Issue #1184 closed<span class="toot-id"> #closed-1184</span></h2><div class="pubdate">07 May at 17:44:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1184">https://github.com/qt4cg/qtspecs/pull/1184</a></div><p>1165-Use Unicode-style character references</p></div>
<div class="toot" id="closed-1171"><h2>Issue #1171 closed<span class="toot-id"> #closed-1171</span></h2><div class="pubdate">07 May at 16:08:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1171">https://github.com/qt4cg/qtspecs/issues/1171</a></div><p>Predicates returning xs:boolean vs. xs:boolean?</p></div>
<div class="toot" id="closed-1182"><h2>Issue #1182 closed<span class="toot-id"> #closed-1182</span></h2><div class="pubdate">07 May at 16:06:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1182">https://github.com/qt4cg/qtspecs/pull/1182</a></div><p>1171 Change predicate callbacks to allow empty return value</p></div>
<div class="toot" id="closed-1170"><h2>Issue #1170 closed<span class="toot-id"> #closed-1170</span></h2><div class="pubdate">07 May at 16:05:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1170">https://github.com/qt4cg/qtspecs/issues/1170</a></div><p>Editorial: fn:index-where; parentheses; …</p></div>
<div class="toot" id="closed-1186"><h2>Issue #1186 closed<span class="toot-id"> #closed-1186</span></h2><div class="pubdate">07 May at 16:05:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1186">https://github.com/qt4cg/qtspecs/pull/1186</a></div><p>1170 Editorial: fn:index-where</p></div>
<div class="toot" id="created-1193"><h2>Issue #1193 created<span class="toot-id"> #created-1193</span></h2><div class="pubdate">07 May at 14:34:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1193">https://github.com/qt4cg/qtspecs/issues/1193</a></div><details><summary>Parsing Functions: Empty input</summary><div class="markup"><p>I was asked why some of the parsing functions allow empty input and others don’t:</p>
<p>Function | Input
--- | ---
<code>fn:parse-integer</code> | <code>xs:string</code>
<code>fn:parse-uri</code> | <code>xs:string</code>
<code>fn:parse-ietf-date</code> | <code>xs:string?</code>
<code>fn:parse-QName</code> | <code>xs:string</code>
<code>fn:parse-xml</code> | <code>xs:string?</code>
<code>fn:parse-xml-fragment</code> | <code>xs:string?</code>
<code>fn:parse-html</code> | <code>(xs:string \| xs:hexBinary \| xs:base64Binary)?</code>
<code>fn:parse-json</code> | <code>xs:string?</code>
<code>fn:parse-csv</code> | <code>xs:string?</code></p>
<p>I would assume there is no rationale behind this, and that we should always allow empty input.</p>
</div></details></div>
<div class="toot" id="created-1192"><h2>Issue #1192 created<span class="toot-id"> #created-1192</span></h2><div class="pubdate">07 May at 10:11:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1192">https://github.com/qt4cg/qtspecs/issues/1192</a></div><details><summary>Allow "fn" as abbreviation for "function" in ItemType syntax</summary><div class="markup"><p>The syntax for inline functions is, by design, similar to the syntax for function tests. So it's confusing that you can abbreviate "function" to "fn" in the first case but not the second.</p>
<p>Open question: what about "declare function" in the XQuery prolog? My instinct is to leave that as it is.</p>
</div></details></div>
<div class="toot" id="created-1191"><h2>Pull request #1191 created<span class="toot-id"> #created-1191</span></h2><div class="pubdate">06 May at 22:14:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1191">https://github.com/qt4cg/qtspecs/pull/1191</a></div><details><summary>1167, 934 deep equal merge collations param</summary><div class="markup"><p>Fix #934 String comparisons in fn:deep-equal
Fix #1167 Merge $collation and $options params of fn:deep-equal</p>
</div></details></div>
<div class="toot" id="created-1190"><h2>Pull request #1190 created<span class="toot-id"> #created-1190</span></h2><div class="pubdate">06 May at 15:09:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1190">https://github.com/qt4cg/qtspecs/pull/1190</a></div><details><summary>1188 XQFO hash</summary><div class="markup"><p>Fixed description</p>
</div></details></div>
<div class="toot" id="created-1189"><h2>Issue #1189 created<span class="toot-id"> #created-1189</span></h2><div class="pubdate">06 May at 10:43:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1189">https://github.com/qt4cg/qtspecs/issues/1189</a></div><details><summary>Function: distinct document order</summary><div class="markup"><p>The nodes resulting from path traversals are normalized by restoring document order and removing duplicates. There are use cases where this operation needs to be enforced, for which people do things like…</p>
<pre><code class="language-xquery">$nodes/.
$nodes/self::node()
$nodes union ()
$nodes except ()
</code></pre>
<p>…which all look arcane to occasional readers, and are prone to be accidentally optimized away.</p>
<p>It would be sensible to have a helper function that makes this operation explicit, so that users have some clue that something intentional is going on. Some articles called this postprocessing step <em>distinct document order</em>, which is why we added <code>util:ddo</code> in the past – but I would love to find a both canonical and catchier name for it.</p>
</div></details></div>
<div class="toot" id="agenda-05-07"><h2>QT4 CG meeting 076 draft agenda<span class="toot-id"> #agenda-05-07</span></h2><div class="pubdate">06 May at 09:55:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/05-07">https://qt4cg.org/meeting/agenda/2024/05-07</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1188"><h2>Issue #1188 created<span class="toot-id"> #created-1188</span></h2><div class="pubdate">06 May at 08:58:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1188">https://github.com/qt4cg/qtspecs/issues/1188</a></div><details><summary>fn:hash: Editorial</summary><div class="markup"><p>The summary of <code>fn:hash</code> says…</p>
<blockquote>
<p>Returns a string representation of the results from a specified hash, checksum, or cyclic redundancy check function upon the input.</p>
</blockquote>
<p>…but the latest version returns a <code>xs:hexBinary</code> value.</p>
</div></details></div>
<div class="toot" id="created-1187"><h2>Issue #1187 created<span class="toot-id"> #created-1187</span></h2><div class="pubdate">04 May at 10:55:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1187">https://github.com/qt4cg/qtspecs/issues/1187</a></div><details><summary>Decimal rounding</summary><div class="markup"><p>This is in response to a bug/feature request from a Saxon user: see https://saxonica.plan.io/issues/6408</p>
<p>Currently</p>
<p>(a) the round() function gives no control over rounding mode (towards zero, towards positive infinity, etc etc).</p>
<p>(b) decimal division leaves it entirely implementation-defined what the precision of the result should be, let alone what rounding is applied to attain that precision.</p>
<p>This can cause difficulties for users where, for example, financial accounting standards mandate a particular rounding mode.</p>
<p>Is this something we want to address?</p>
</div></details></div>
<div class="toot" id="created-1186"><h2>Pull request #1186 created<span class="toot-id"> #created-1186</span></h2><div class="pubdate">02 May at 11:17:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1186">https://github.com/qt4cg/qtspecs/pull/1186</a></div><details><summary>1170 Editorial: fn:index-where</summary><div class="markup"><p>Issue: 1170</p>
<ul>
<li>Editorial, 2 characters added</li>
<li>“2. Redundant parens in function signatures“ is obsolete (https://github.com/qt4cg/qtspecs/pull/1182/files#diff-7625c07ae8131ff65c3caa677b188ed2b9b66237312d11c05a2fa2838c6f5c67R21233)</li>
</ul>
</div></details></div>
<div class="toot" id="created-1185"><h2>Pull request #1185 created<span class="toot-id"> #created-1185</span></h2><div class="pubdate">02 May at 11:07:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1185">https://github.com/qt4cg/qtspecs/pull/1185</a></div><details><summary>1179 array:values, map:values → array:get, map:get</summary><div class="markup"><p>Issue: #1179</p>
</div></details></div>
<div class="toot" id="created-1184"><h2>Pull request #1184 created<span class="toot-id"> #created-1184</span></h2><div class="pubdate">01 May at 21:14:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1184">https://github.com/qt4cg/qtspecs/pull/1184</a></div><details><summary>1165-Use Unicode-style character references</summary><div class="markup"><p>Currently only affects F+O.</p>
<p>New element <code>&lt;char&gt;U+xxxx&lt;/char&gt;</code> is supported in the DTD and XSLT. It is automatically expanded to include the character name and glyph. I was hoping to get the Unicode character names directly from the Unicode database, but that's a bit unwieldy, so I created a little file (in the style directory) containing the names of the characters that we actually use.</p>
</div></details></div>
<div class="toot" id="created-1183"><h2>Issue #1183 created<span class="toot-id"> #created-1183</span></h2><div class="pubdate">01 May at 20:24:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1183">https://github.com/qt4cg/qtspecs/issues/1183</a></div><details><summary>transient() - a function to make functions nondeterministic</summary><div class="markup"><p>I propose a function <code>transient()</code> which takes a function as input and returns a function that is functionally identical, but which relaxes the requirement for determinism.</p>
<p>For example, <code>transient(current-dateTime#0)</code> returns a function that returns a date and time, but is not required to return the same date and time on every call, while <code>transient(doc#1)</code> returns a function that dereferences an XML document URI, but is not required to return the same document every time it is called with the same URI.</p>
<p>A valid implementation, of course, could return the supplied function unchanged - the transient() function gives the implementation the freedom to relax the rules, but does not require it to do so.</p>
<p><code>transient()</code> seems like a more friendly name than <code>nondeterministic()</code>.</p>
</div></details></div>
<div class="toot" id="created-1182"><h2>Pull request #1182 created<span class="toot-id"> #created-1182</span></h2><div class="pubdate">30 Apr at 23:39:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1182">https://github.com/qt4cg/qtspecs/pull/1182</a></div><details><summary>1171 Change predicate callbacks to allow empty return value</summary><div class="markup"><p>Return type changes from <code>xs:boolean</code> to <code>xs:boolean?</code></p>
</div></details></div>
<div class="toot" id="created-1181"><h2>Pull request #1181 created<span class="toot-id"> #created-1181</span></h2><div class="pubdate">30 Apr at 22:00:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1181">https://github.com/qt4cg/qtspecs/pull/1181</a></div><details><summary>296 Allow default-namespace=##any</summary><div class="markup"><p>Allows the default namespace for elements and types to have the special value "##any", which causes unprefixed QNames to match elements in any namespace. Use cases include:</p>
<ul>
<li>Casual ad-hoc XPath queries, where over-retrieval isn't a problem</li>
<li>Use with HTML, where it can be unpredictable whether elements will be in a namespace, and where users are accustomed to browser behaviour with its "wilful violation" of the XPath 1.0 specification</li>
<li>Any environment where multiple namespaces are in use for variants of what is essentially the same vocabulary of element names (for example, where the XML designer has made the mistake of versioning the namespace URI)</li>
</ul>
</div></details></div>
<div class="toot" id="closed-161"><h2>Issue #161 closed<span class="toot-id"> #closed-161</span></h2><div class="pubdate">30 Apr at 20:02:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/161">https://github.com/qt4cg/qtspecs/issues/161</a></div><p>Support unbounded variadic functions on sequence parameters</p></div>
<div class="toot" id="closed-1137"><h2>Issue #1137 closed<span class="toot-id"> #closed-1137</span></h2><div class="pubdate">30 Apr at 20:02:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1137">https://github.com/qt4cg/qtspecs/pull/1137</a></div><p>161 Variadic functions</p></div>
<div class="toot" id="created-1180"><h2>Issue #1180 created<span class="toot-id"> #created-1180</span></h2><div class="pubdate">30 Apr at 18:04:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1180">https://github.com/qt4cg/qtspecs/issues/1180</a></div><details><summary>fn:unparsed-text: `cache` option</summary><div class="markup"><p>In #1117, we discussed the pros and cons of a <code>deterministic</code> option for <code>fn:unparsed-text</code>.</p>
<p>I would suggest  making the function strictly nondeterministic, but adding a <code>cache</code> option:</p>
<ul>
<li>That way we don’t equate determinism with caching, which can in fact be different things. For example, an implementation might decide to do deterministic things at compile time, whereas it might be better to cache data only when it’s actually requested.</li>
<li>The meaning of the option will be easier to explain to non-experts (…and avoid confusion among experts).</li>
</ul>
</div></details></div>
<div class="toot" id="minutes-04-30"><h2>QT4 CG meeting 075 draft minutes<span class="toot-id"> #minutes-04-30</span></h2><div class="pubdate">30 Apr at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/04-30">https://qt4cg.org/meeting/minutes/2024/04-30</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1086"><h2>Issue #1086 closed<span class="toot-id"> #closed-1086</span></h2><div class="pubdate">30 Apr at 16:22:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1086">https://github.com/qt4cg/qtspecs/issues/1086</a></div><p>array:values spec cleanup</p></div>
<div class="toot" id="closed-1087"><h2>Issue #1087 closed<span class="toot-id"> #closed-1087</span></h2><div class="pubdate">30 Apr at 16:22:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1087">https://github.com/qt4cg/qtspecs/pull/1087</a></div><p>1086 Editorial changes to array:values</p></div>
<div class="toot" id="closed-1166"><h2>Issue #1166 closed<span class="toot-id"> #closed-1166</span></h2><div class="pubdate">30 Apr at 16:16:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1166">https://github.com/qt4cg/qtspecs/issues/1166</a></div><p>Invalid option keys: the rule is unclear</p></div>
<div class="toot" id="closed-1168"><h2>Issue #1168 closed<span class="toot-id"> #closed-1168</span></h2><div class="pubdate">30 Apr at 16:16:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1168">https://github.com/qt4cg/qtspecs/pull/1168</a></div><p>1166 Clarify rule on invalid option keys</p></div>
<div class="toot" id="closed-1173"><h2>Issue #1173 closed<span class="toot-id"> #closed-1173</span></h2><div class="pubdate">30 Apr at 16:12:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1173">https://github.com/qt4cg/qtspecs/issues/1173</a></div><p>array:build, map:build: Positional access</p></div>
<div class="toot" id="closed-1174"><h2>Issue #1174 closed<span class="toot-id"> #closed-1174</span></h2><div class="pubdate">30 Apr at 16:12:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1174">https://github.com/qt4cg/qtspecs/pull/1174</a></div><p>1173 array:build, map:build: Positional access</p></div>
<div class="toot" id="closed-1177"><h2>Issue #1177 closed<span class="toot-id"> #closed-1177</span></h2><div class="pubdate">30 Apr at 16:10:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1177">https://github.com/qt4cg/qtspecs/pull/1177</a></div><p>1162 Positional variables are xs:integer not xs:positiveInteger</p></div>
<div class="toot" id="closed-553"><h2>Issue #553 closed<span class="toot-id"> #closed-553</span></h2><div class="pubdate">30 Apr at 16:08:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/553">https://github.com/qt4cg/qtspecs/issues/553</a></div><p>New function fn:substitute()</p></div>
<div class="toot" id="created-1179"><h2>Issue #1179 created<span class="toot-id"> #created-1179</span></h2><div class="pubdate">30 Apr at 16:02:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1179">https://github.com/qt4cg/qtspecs/issues/1179</a></div><details><summary>Editorial: `array:values`, `map:values`</summary><div class="markup"><p>Triggered by #1087:</p>
<ol>
<li>Align <code>map:values</code> with <code>array:values</code></li>
<li>Revise notes.</li>
<li>Rename the functions.</li>
</ol>
<p>@michaelhkay You suggested that <code>content</code> might be a better name – rather than <code>item</code> – for retrieving the sequence-concatenation of values in map lookups in https://github.com/qt4cg/qtspecs/issues/1169#issuecomment-2074378446. Should we rename the functions to <code>array:contents</code>, <code>map:contents</code> or use <code>array:items</code> and <code>map:items</code>?</p>
</div></details></div>
<div class="toot" id="closed-1178"><h2>Issue #1178 closed<span class="toot-id"> #closed-1178</span></h2><div class="pubdate">30 Apr at 16:00:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1178">https://github.com/qt4cg/qtspecs/pull/1178</a></div><p>1146 Add inline change markup in the XPath/XQuery spec</p></div>
<div class="toot" id="created-1178"><h2>Pull request #1178 created<span class="toot-id"> #created-1178</span></h2><div class="pubdate">28 Apr at 22:51:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1178">https://github.com/qt4cg/qtspecs/pull/1178</a></div><details><summary>1146 Add inline change markup in the XPath/XQuery spec</summary><div class="markup"><p>There is more work to be done to ensure the change log entries are complete, but this is a good start.</p>
</div></details></div>
<div class="toot" id="closed-1159"><h2>Issue #1159 closed<span class="toot-id"> #closed-1159</span></h2><div class="pubdate">27 Apr at 20:40:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1159">https://github.com/qt4cg/qtspecs/issues/1159</a></div><p>Filter operator for arrays</p></div>
<div class="toot" id="created-1177"><h2>Pull request #1177 created<span class="toot-id"> #created-1177</span></h2><div class="pubdate">27 Apr at 20:36:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1177">https://github.com/qt4cg/qtspecs/pull/1177</a></div><details><summary>1162 Positional variables are xs:integer not xs:positiveInteger</summary><div class="markup"><p>Reverts a change that made the type xs:positiveInteger as the impact of the change was not fully explored, and the same change was not made elsewhere e.g. to the argument type of array:get() or the return type of fn:position().</p>
<p>Note: the use of xs:positiveInteger has been retained for row and column numbers in the CSV functions, and for codepoints in the fn:char() function.</p>
</div></details></div>
<div class="toot" id="created-1176"><h2>Issue #1176 created<span class="toot-id"> #created-1176</span></h2><div class="pubdate">26 Apr at 03:15:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1176">https://github.com/qt4cg/qtspecs/issues/1176</a></div><details><summary>Use fn:parse-uri to check whether a filepath is relative or absolute</summary><div class="markup"><p>I have a question about the new function <code>fn:parse-uri()</code>. A common use case is to check whether a file path is absolute or relative. For example, I want to check whether the file path <code>images/img1.png</code> is relative and can therefore be converted to an absolute file path using <code>resolve-uri()</code>. Or I want to check whether <code>$base</code> is absolute and can therefore be used as the second argument in <code>resolve-uri()</code>.</p>
<p>How would I use a <code>uri-structure-record</code> map determined as a result of<code> fn:parse-uri ()</code> to decide whether it is a relative or absolute file path?<br>
Greetings, Frank</p>
</div></details></div>
<div class="toot" id="created-1175"><h2>Issue #1175 created<span class="toot-id"> #created-1175</span></h2><div class="pubdate">25 Apr at 18:18:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1175">https://github.com/qt4cg/qtspecs/issues/1175</a></div><details><summary>XPath: Optional parameters in the definition of an inline function</summary><div class="markup"><p>This is a proposal to extend the definition of an inline-function item with the ability to specify a set of optional/keyword-value parameters, following the sequence of positional parameters of the function.</p>
<p>This is very similar to what we already have for static function definitions: https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-function-definition and https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-static-functions</p>
<p>While a <strong>static function definition</strong> has the following parts:</p>
<ul>
<li>
<p>The function name, which is an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-expanded-qname">expanded QName</a>.</p>
</li>
<li>
<p>A (possibly empty) list of required parameters, each having:</p>
</li>
<li>
<p>a parameter name (an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-expanded-qname">expanded QName</a>)</p>
</li>
<li>
<p>a required type (a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-type">sequence type</a>)</p>
</li>
<li>
<p>A (possibly empty) list of optional parameters, each having:</p>
</li>
<li>
<p>a parameter name (an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-expanded-qname">expanded QName</a>)</p>
</li>
<li>
<p>a required type (a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-type">sequence type</a>)</p>
</li>
<li>
<p>a default value expression (an expression: see <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-expressions">4 Expressions</a>)</p>
</li>
<li>
<p>A return type (a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-type">sequence type</a>)</p>
</li>
<li>
<p>A (possibly empty) set of function annotations</p>
</li>
<li>
<p>A body. The function body contains the logic that enables the function result to be computed from the supplied arguments and information in the static and dynamic context.</p>
</li>
</ul>
<p>For an <strong>inline function definition</strong> we will have:</p>
<ul>
<li>
<p>A name of a variable to contain the function item being defined.</p>
</li>
<li>
<p>A (possibly empty) list of required parameters, each having:</p>
</li>
<li>
<p>a parameter name (an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-expanded-qname">expanded QName</a>)</p>
</li>
<li>
<p>an optional type (a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-type">sequence type</a>)</p>
</li>
<li>
<p>A (possibly empty) list of optional parameters, each having:</p>
</li>
<li>
<p>a parameter name (an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-expanded-qname">expanded QName</a>)</p>
</li>
<li>
<p>an optional type (a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-type">sequence type</a>)</p>
</li>
<li>
<p>a default value expression (an expression: see <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-expressions">4 Expressions</a>)</p>
</li>
<li>
<p>An optional return type (a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-type">sequence type</a>)</p>
</li>
<li>
<p>A body. The function body contains the logic that enables the function result to be computed from the supplied arguments and information in the static and dynamic context.</p>
</li>
</ul>
<p><strong>What is accomplished by introducing optional parameters</strong>?</p>
<p>The answer is the same as for the effect of having optional parameters in a static function definition: increased <strong><em>brevity</em></strong>, <strong><em>conciseness</em></strong> and <strong><em>clarity</em></strong> .</p>
<pre><code class="language-xq">let $myFun := fn($pos1, $pos2, $posK, $kw1 := expr1, $kw2 := expr2, ...,  $kwN := exprN) { (: Some expression :)} 
</code></pre>
<p>replaces what would otherwise be a set of <code>N! + 1</code> separate inline function definitions, each of which must be assigned to a separate variable.</p>
<p>Similarly to the static function calls, with this new feature a call to such an inline function must provide values for all positional arguments, followed by an optional set (meaning in any order) of assignments of values to specific keyword-valued (optional) arguments. The rules for an inline function call are similar to those for a call to a static function - the provided values for the positional arguments must precede all other provided values and the values for the optional arguments may be provided in any order.</p>
<p>Here is a short example of an inline function definition and calling it:</p>
<pre><code class="language-xq">let $incr := fn($arg1, $increment := 1) {$arg1 + $increment }
 return
  (
   $incr(5),
   $incr(5, increment := 2),
   $incr(5, increment := 3)
 )
</code></pre>
<p>produces:</p>
<p><code>6, 7, 8</code></p>
</div></details></div>
<div class="toot" id="created-1174"><h2>Pull request #1174 created<span class="toot-id"> #created-1174</span></h2><div class="pubdate">24 Apr at 12:45:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1174">https://github.com/qt4cg/qtspecs/pull/1174</a></div><details><summary>1173 array:build, map:build: Positional access</summary><div class="markup"><p>Issue: #1173</p>
</div></details></div>
<div class="toot" id="closed-1110"><h2>Issue #1110 closed<span class="toot-id"> #closed-1110</span></h2><div class="pubdate">24 Apr at 12:40:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1110">https://github.com/qt4cg/qtspecs/issues/1110</a></div><p>New error codes</p></div>
<div class="toot" id="created-1173"><h2>Issue #1173 created<span class="toot-id"> #created-1173</span></h2><div class="pubdate">24 Apr at 10:13:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1173">https://github.com/qt4cg/qtspecs/issues/1173</a></div><details><summary>array:build, map:build: Positional access</summary><div class="markup"><p><code>array:build</code> seems to be the only function (for iterating over ordered input) for which the HOF parameters lacks a positional parameter:</p>
<pre><code class="language-xquery">array:build(
  $input   as item()*,	
  $action  as function(item()) as item()*  := fn:identity#1
) as array(*)

(: should be :)
array:build(
  $input   as item()*,	
  $action  as function(item(), xs:integer) as item()*  := fn:identity#1
) as array(*)
</code></pre>
</div></details></div>
<div class="toot" id="created-1172"><h2>Issue #1172 created<span class="toot-id"> #created-1172</span></h2><div class="pubdate">24 Apr at 10:08:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1172">https://github.com/qt4cg/qtspecs/issues/1172</a></div><details><summary>Iterating maps: Positional access</summary><div class="markup"><p>With the new filter expression for maps, the context position is available. To be consistent, if we want to provide positional access for unordered data, we should…</p>
<ul>
<li>either provide this for map functions  as well (<code>map:filter</code>, <code>map:for-each</code>), or</li>
<li>don’t provide it for map predicates at all.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1171"><h2>Issue #1171 created<span class="toot-id"> #created-1171</span></h2><div class="pubdate">24 Apr at 10:02:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1171">https://github.com/qt4cg/qtspecs/issues/1171</a></div><details><summary>Predicates returning xs:boolean vs. xs:boolean?</summary><div class="markup"><p>In <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-filter-maps-and-arrays">4.13.4  Filter Expressions for Maps and Arrays</a>, the type of the predicate expression <code>FILTER</code> is <code>xs:boolean?</code>.</p>
<p>To be consistent, we should either relax the types of the predicate/filter functions (for <code>fn:filter</code>, etc.) or stick with <code>xs:boolean</code>.</p>
</div></details></div>
<div class="toot" id="created-1170"><h2>Issue #1170 created<span class="toot-id"> #created-1170</span></h2><div class="pubdate">24 Apr at 07:31:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1170">https://github.com/qt4cg/qtspecs/issues/1170</a></div><details><summary>Editorial: fn:index-where; parentheses; …</summary><div class="markup"><h4>1. fn:index-where, array:index-where</h4>
<blockquote>
<p>Returns the position in an input ...</p>
</blockquote>
<p>→ positions</p>
<h4>2. Redundant parens in function signatures</h4>
<pre><code>as (function(xs:anyAtomicType, item()*) as xs:boolean)
...
</code></pre>
</div></details></div>
<div class="toot" id="created-1169"><h2>Issue #1169 created<span class="toot-id"> #created-1169</span></h2><div class="pubdate">24 Apr at 06:35:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1169">https://github.com/qt4cg/qtspecs/issues/1169</a></div><details><summary>Maps &amp; Arrays: Consistency &amp; Terminology</summary><div class="markup"><p>After the introduction of #1094 and #1159, and before adding more map/array operations, I think it’s time to get more serious about consistency and terminology. The current drafts employ a variety of terms that are not clearly defined, or separated from each other. We now have at least…</p>
<blockquote>
<p>items, members, pairs, keys, values, entries</p>
</blockquote>
<p>…which are sometimes used for maps, for arrays, or for both data structures. A first attempt to clean up, with reducing the overall effort:</p>
<ol>
<li>
<p>A minor one: The modifier for lookups should be in singular form, analagous to node axes: <code>item</code>, <code>key</code>, <code>value</code>, <code>pair</code>.</p>
</li>
<li>
<p>While I first advocated the orthogonality principle for axes in lookup expressions, I now think we should stick to the existing terminology. Otherwise, we would need to revise many other existing parts of the spec. My suggestion would be to:</p>
</li>
</ol>
<ul>
<li>introduce <code>member</code> for arrays</li>
<li>only allow <code>key</code>, <code>value</code> and <code>pair</code> for maps</li>
<li>allow <code>items</code> for both maps and arrays</li>
</ul>
<p>This would make it symmetric with a) the current terminology for maps and arrays, and b) enhanced <code>for</code> clauses, i.e. <code>for member $m</code> and <code>for key $k value $v</code>.</p>
<p>The reverse approach would be to drop <code>for member $m</code> and to also allow <code>for key $k value $v</code> for arrays (with <code>for value</code> replacing <code>for member</code>). In addition, we could have <code>for pair</code>.</p>
<ol start="3">
<li>
<p>With the introduction of the <code>item</code> axis, <code>map:values</code> and <code>arrays:values</code> should be renamed to <code>map:items</code> and <code>array:items</code>. → <code>map:contents</code> and <code>array:contents</code>, see <a href="https://github.com/qt4cg/qtspecs/issues/1179">#1179</a></p>
</li>
<li>
<p>I would suggest dropping <code>array:members</code> and <code>array:of-members</code>. The names don’t imply we’ll deal with records, and it’s not in line with <code>for member $m</code> either. If we want to keep these functions, we could rename them to <code>array:pairs</code> and <code>array:of-pairs</code> and add the integer positions as keys, and we should introduce and consistently use the term <code>pair</code> for maps and arrays.</p>
</li>
</ol>
<p>Closely related: #826</p>
</div></details></div>
<div class="toot" id="closed-1125"><h2>Issue #1125 closed<span class="toot-id"> #closed-1125</span></h2><div class="pubdate">23 Apr at 22:48:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1125">https://github.com/qt4cg/qtspecs/pull/1125</a></div><p>1094 Enhanced lookup expressions</p></div>
<div class="toot" id="closed-1094"><h2>Issue #1094 closed<span class="toot-id"> #closed-1094</span></h2><div class="pubdate">23 Apr at 22:48:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1094">https://github.com/qt4cg/qtspecs/issues/1094</a></div><p>Axis steps in lookup expressions</p></div>
<div class="toot" id="minutes-04-23"><h2>QT4 CG meeting 074 draft minutes<span class="toot-id"> #minutes-04-23</span></h2><div class="pubdate">23 Apr at 17:10:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/04-23">https://qt4cg.org/meeting/minutes/2024/04-23</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1135"><h2>Issue #1135 closed<span class="toot-id"> #closed-1135</span></h2><div class="pubdate">23 Apr at 16:04:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1135">https://github.com/qt4cg/qtspecs/issues/1135</a></div><p>Definition of focus functions</p></div>
<div class="toot" id="closed-1157"><h2>Issue #1157 closed<span class="toot-id"> #closed-1157</span></h2><div class="pubdate">23 Apr at 16:04:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1157">https://github.com/qt4cg/qtspecs/pull/1157</a></div><p>1135 Correction to definition of focus functions</p></div>
<div class="toot" id="closed-1163"><h2>Issue #1163 closed<span class="toot-id"> #closed-1163</span></h2><div class="pubdate">23 Apr at 16:01:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1163">https://github.com/qt4cg/qtspecs/pull/1163</a></div><p>1159 Add filter expressions for maps and arrays</p></div>
<div class="toot" id="closed-235"><h2>Issue #235 closed<span class="toot-id"> #closed-235</span></h2><div class="pubdate">23 Apr at 15:59:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/235">https://github.com/qt4cg/qtspecs/issues/235</a></div><p>Add multiple=true() option to fn:parse-json and fn:json-doc</p></div>
<div class="toot" id="closed-1155"><h2>Issue #1155 closed<span class="toot-id"> #closed-1155</span></h2><div class="pubdate">23 Apr at 15:59:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1155">https://github.com/qt4cg/qtspecs/issues/1155</a></div><p>Glossary formatting</p></div>
<div class="toot" id="closed-1164"><h2>Issue #1164 closed<span class="toot-id"> #closed-1164</span></h2><div class="pubdate">23 Apr at 15:59:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1164">https://github.com/qt4cg/qtspecs/pull/1164</a></div><p>1155 Consistency of glossaries</p></div>
<div class="toot" id="created-1168"><h2>Pull request #1168 created<span class="toot-id"> #created-1168</span></h2><div class="pubdate">22 Apr at 23:15:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1168">https://github.com/qt4cg/qtspecs/pull/1168</a></div><details><summary>1166 Clarify rule on invalid option keys</summary><div class="markup"><p>An error is raised for an option key unless (a) it is listed in the specification, or (b) it is recognized by the implementation, or (c) it is a QName with a non-absent namespace.</p>
<p>Also clarified the rule about accepting an array in place of a sequence (I'm not sure whether this is something that we actually do, and certainly it doesn't happen unless the parameter explicitly allows an array.)</p>
<p>Fix #1166</p>
</div></details></div>
<div class="toot" id="created-1167"><h2>Issue #1167 created<span class="toot-id"> #created-1167</span></h2><div class="pubdate">22 Apr at 17:08:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1167">https://github.com/qt4cg/qtspecs/issues/1167</a></div><details><summary>Merge $collation into $options parameter of fn:deep-equal()</summary><div class="markup"><p>To avoid the ugly third parameter to deep-equal which will almost always be set to (), merge $collation into the $options parameter, whose type becomes <code>(map(*) | xs:string)?</code> for backwards compatibility.</p>
<p>The same idea is being applied to unparsed-text and can probably be done elsewhere.</p>
</div></details></div>
<div class="toot" id="created-1166"><h2>Issue #1166 created<span class="toot-id"> #created-1166</span></h2><div class="pubdate">22 Apr at 14:42:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1166">https://github.com/qt4cg/qtspecs/issues/1166</a></div><details><summary>Invalid option keys: the rule is unclear</summary><div class="markup"><p>PR #1059 introduced the rule:</p>
<blockquote>
<p>If an option is not described in the specification, if it is not supported by the implementation and if its name is in no namespace, a type error [err:FORG0013] must be raised.</p>
</blockquote>
<p>and this has proved its worth in finding quite a few errors in the test suite!</p>
<p>However, it's not entirely clear what it means.</p>
<p>Entries in the options map can have keys of any type. I suspect this rule is intended to apply to (a) keys of type xs:string, and (b) strings of type xs:QName where the namespace URI is absent.</p>
<p>Alternatively, perhaps it should apply to ALL option keys other than a QName in a non-null namespace?</p>
</div></details></div>
<div class="toot" id="agenda-04-23"><h2>QT4 CG meeting 074 draft agenda<span class="toot-id"> #agenda-04-23</span></h2><div class="pubdate">22 Apr at 13:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/04-23">https://qt4cg.org/meeting/agenda/2024/04-23</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1165"><h2>Issue #1165 created<span class="toot-id"> #created-1165</span></h2><div class="pubdate">22 Apr at 11:06:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1165">https://github.com/qt4cg/qtspecs/issues/1165</a></div><details><summary>[Editorial] References to numeric codepoints in prose: consistency</summary><div class="markup"><p>A quick glance in F+O finds:</p>
<pre><code> \n (newline, x0A)
π (x3C0)
the glyph ≂̸ which is expressed using the two codepoints #x2242 #x0338
A format token of &amp;#x661; (Arabic-Indic digit one)
the format token &amp;#x2460; (circled digit one, ①)
the actual Unicode character COMBINING DIARESIS (Unicode codepoint U+0308) or &amp;#x0308;
The Latin small letter dotless i (ı, U+0131, used in Turkish)
the Unicode replacement character (U+FFFD)
CRLF (U+000D, U+000A), LF (U+000A), or CR (U+000D)
comma "," (U+002C)
the Unicode quotation mark " (U+0022)
a single newline (U+000A) character
</code></pre>
<p>I feel we could do better...</p>
</div></details></div>
<div class="toot" id="closed-700"><h2>Issue #700 closed<span class="toot-id"> #closed-700</span></h2><div class="pubdate">21 Apr at 22:47:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/700">https://github.com/qt4cg/qtspecs/issues/700</a></div><p>Operators for array mapping and filtering</p></div>
<div class="toot" id="created-1164"><h2>Pull request #1164 created<span class="toot-id"> #created-1164</span></h2><div class="pubdate">21 Apr at 22:16:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1164">https://github.com/qt4cg/qtspecs/pull/1164</a></div><details><summary>1155 Consistency of glossaries</summary><div class="markup"><p>Use a common style for all glossaries.</p>
<p>Add a glossary to F+O.</p>
<p>Fix #1155</p>
</div></details></div>
<div class="toot" id="created-1163"><h2>Pull request #1163 created<span class="toot-id"> #created-1163</span></h2><div class="pubdate">19 Apr at 20:39:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1163">https://github.com/qt4cg/qtspecs/pull/1163</a></div><p>1159 Add filter expressions for maps and arrays</p></div>
<div class="toot" id="created-1162"><h2>Issue #1162 created<span class="toot-id"> #created-1162</span></h2><div class="pubdate">18 Apr at 10:19:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1162">https://github.com/qt4cg/qtspecs/issues/1162</a></div><details><summary>Revert strict type for positional variables (xs:integer → xs:positiveInteger)</summary><div class="markup"><p>I feel that the decision to change <code>xs:integer</code> to <code>xs:positiveInteger</code> was a bit hasty (https://github.com/qt4cg/qtspecs/pull/1131#issuecomment-2051379262):</p>
<p>To be consistent, numerous other expressions and functions would need to be rewritten as well to use stricter types (arbitrary examples: the <code>count</code> clause; <code>$err:line-number</code> in the catch clause; the result type of <code>fn:string-to-codepoints</code>; positions in <code>array:get</code>, <code>fn:parse-integer</code>, etc.; the position parameter in HOF functions, and so on and on). We haven’t done so yet, and I seriously wonder what exactly we would win from the stricter types. In many cases, it would be reasonable to also define a strict upper limit, which is not possible with our types anyway.</p>
<p>Implementations may build heavily on the fact that <code>xs:integer</code> has been the default type for integer values in previous versions of the languages. For example, we use cached instances for the most small integer values, or we rewrite constructs with <code>xs:integer</code> to other constructs accepting the same type.</p>
<p>For all these challenges, as always, technical solutions exist, but the question is if there aren’t more interesting things to focus on than on such corner cases. Queries like <code>count(1 to 1000000000000)</code> are not supported by all implementations either although they may appear trivial to the ordinary user (by coincidence, it’s supported by BaseX, but I doubt it has been used a lot).</p>
<p>In short, I would like us to revert the change in https://github.com/qt4cg/qtspecs/pull/1131/commits/bba6e4f1067e0ef0779688622a58320a5298d440 and stick with <code>xs:integer</code>. If people feel bad about it, I would suggest discussing strict types in a much broader and general way.</p>
</div></details></div>
<div class="toot" id="created-1161"><h2>Issue #1161 created<span class="toot-id"> #created-1161</span></h2><div class="pubdate">18 Apr at 07:49:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1161">https://github.com/qt4cg/qtspecs/issues/1161</a></div><details><summary>More changes to drop the requirement for document-uri() uniqueness</summary><div class="markup"><p>Issue #898 was about dropping this constraint that document-uri()s had to be unique and PR #905 was adopted to resolve it. However, I see that the the XPath specification still contains the following note:</p>
<blockquote>
<p>Note:</p>
<p>This means that given a document node $N, the result of fn:doc(fn:document-uri($N)) is $N will always be true, unless fn:document-uri($N) is an empty sequence.</p>
</blockquote>
<p>I don't believe that applies any longer, so it should be removed.</p>
<p>It's possible that we need to finesse the description of <em>available documents</em> as well. The current description was clearly written from the perspective that document URIs would be unique and there'd be a 1:1 mapping from URIs to documents.</p>
</div></details></div>
<div class="toot" id="minutes-04-16"><h2>QT4 CG meeting 073 draft minutes<span class="toot-id"> #minutes-04-16</span></h2><div class="pubdate">16 Apr at 17:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/04-16">https://qt4cg.org/meeting/minutes/2024/04-16</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-1160"><h2>Issue #1160 created<span class="toot-id"> #created-1160</span></h2><div class="pubdate">16 Apr at 17:38:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1160">https://github.com/qt4cg/qtspecs/issues/1160</a></div><details><summary>fn:is-collation-available</summary><div class="markup"><p>The new function <strong><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-collation">fn:collation</a></strong> raises an error [<a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#ERRFOCH0002">err:FOCH0002</a>]  in the case when the requested collation is not supported. Or, if the <code>fallback</code> key's value is <code>true()</code>, then the implementation chooses "the most similar supported collation" - which could be perceived as arbitrary and unexpected by the code developer.</p>
<p>This might be OK if the language has try/catch capabilities and <code>fallback="no"</code>  is specified, but may not be the best outcome in a pure XPath evaluation.</p>
<p>A solution to this problem is to provide a function <strong>fn:is-collation-available</strong> that accepts the same argument (<code>$options</code> map) as <code>fn:collation</code>, and also could accept a string argument whose value is the URI of the collation. This function produces a boolean, <code>true()</code> meaning that the collation is available and can be constructed and used, <code>false()</code> - otherwise.</p>
<p><strong>Signature</strong></p>
<p><code>fn:is-collation-available( $descriptor  as&nbsp;xs:string | map(*)  )&nbsp;as&nbsp;xs:boolean</code></p>
</div></details></div>
<div class="toot" id="closed-1140"><h2>Issue #1140 closed<span class="toot-id"> #closed-1140</span></h2><div class="pubdate">16 Apr at 16:31:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1140">https://github.com/qt4cg/qtspecs/issues/1140</a></div><p>Use $target instead of $search for indexing functions</p></div>
<div class="toot" id="closed-1141"><h2>Issue #1141 closed<span class="toot-id"> #closed-1141</span></h2><div class="pubdate">16 Apr at 16:31:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1141">https://github.com/qt4cg/qtspecs/pull/1141</a></div><p>1140 Replace 'search' with 'target' for indexing functions</p></div>
<div class="toot" id="closed-1147"><h2>Issue #1147 closed<span class="toot-id"> #closed-1147</span></h2><div class="pubdate">16 Apr at 16:28:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1147">https://github.com/qt4cg/qtspecs/pull/1147</a></div><p>QT4CG-072-01 Clarify schema type terminology</p></div>
<div class="toot" id="closed-1142"><h2>Issue #1142 closed<span class="toot-id"> #closed-1142</span></h2><div class="pubdate">16 Apr at 16:25:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1142">https://github.com/qt4cg/qtspecs/issues/1142</a></div><p>fn:deep-equal: items-equal</p></div>
<div class="toot" id="closed-1150"><h2>Issue #1150 closed<span class="toot-id"> #closed-1150</span></h2><div class="pubdate">16 Apr at 16:25:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1150">https://github.com/qt4cg/qtspecs/pull/1150</a></div><p>1142 Drop restriction disallowing items-equal with unordered</p></div>
<div class="toot" id="closed-1138"><h2>Issue #1138 closed<span class="toot-id"> #closed-1138</span></h2><div class="pubdate">16 Apr at 16:22:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1138">https://github.com/qt4cg/qtspecs/issues/1138</a></div><p>format-number arguments</p></div>
<div class="toot" id="closed-1151"><h2>Issue #1151 closed<span class="toot-id"> #closed-1151</span></h2><div class="pubdate">16 Apr at 16:22:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1151">https://github.com/qt4cg/qtspecs/pull/1151</a></div><p>1138 Merge format and format-name params of format-number</p></div>
<div class="toot" id="closed-1152"><h2>Issue #1152 closed<span class="toot-id"> #closed-1152</span></h2><div class="pubdate">16 Apr at 16:18:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1152">https://github.com/qt4cg/qtspecs/pull/1152</a></div><p>1146 Inline change log</p></div>
<div class="toot" id="closed-115"><h2>Issue #115 closed<span class="toot-id"> #closed-115</span></h2><div class="pubdate">16 Apr at 16:12:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/115">https://github.com/qt4cg/qtspecs/issues/115</a></div><p>Lookup operator on arrays of maps</p></div>
<div class="toot" id="closed-298"><h2>Issue #298 closed<span class="toot-id"> #closed-298</span></h2><div class="pubdate">16 Apr at 16:12:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/298">https://github.com/qt4cg/qtspecs/issues/298</a></div><p>Abstract supertype for map and array</p></div>
<div class="toot" id="closed-397"><h2>Issue #397 closed<span class="toot-id"> #closed-397</span></h2><div class="pubdate">16 Apr at 16:12:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/397">https://github.com/qt4cg/qtspecs/issues/397</a></div><p>Type names</p></div>
<div class="toot" id="closed-836"><h2>Issue #836 closed<span class="toot-id"> #closed-836</span></h2><div class="pubdate">16 Apr at 16:12:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/836">https://github.com/qt4cg/qtspecs/issues/836</a></div><p>Add support for CSV 'dialect' features covered by the OKFN's Frictionless Data CSV spec in `fn:parse-csv` and related functions</p></div>
<div class="toot" id="closed-1115"><h2>Issue #1115 closed<span class="toot-id"> #closed-1115</span></h2><div class="pubdate">16 Apr at 16:12:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1115">https://github.com/qt4cg/qtspecs/issues/1115</a></div><p>XSLT - ability to call a function from xslt (not just xpath)</p></div>
<div class="toot" id="closed-1154"><h2>Issue #1154 closed<span class="toot-id"> #closed-1154</span></h2><div class="pubdate">16 Apr at 16:10:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1154">https://github.com/qt4cg/qtspecs/issues/1154</a></div><p>[xsl:item-type] error in sample</p></div>
<div class="toot" id="closed-1156"><h2>Issue #1156 closed<span class="toot-id"> #closed-1156</span></h2><div class="pubdate">16 Apr at 16:10:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1156">https://github.com/qt4cg/qtspecs/pull/1156</a></div><p>Fix error in XSLT example</p></div>
<div class="toot" id="closed-1084"><h2>Issue #1084 closed<span class="toot-id"> #closed-1084</span></h2><div class="pubdate">16 Apr at 16:10:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1084">https://github.com/qt4cg/qtspecs/issues/1084</a></div><p>Incorrect rendition of option defaults</p></div>
<div class="toot" id="closed-1149"><h2>Issue #1149 closed<span class="toot-id"> #closed-1149</span></h2><div class="pubdate">16 Apr at 16:10:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1149">https://github.com/qt4cg/qtspecs/pull/1149</a></div><p>1084 Add fos:default-description to support prose descriptions of defaults</p></div>
<div class="toot" id="created-1159"><h2>Issue #1159 created<span class="toot-id"> #created-1159</span></h2><div class="pubdate">15 Apr at 22:41:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1159">https://github.com/qt4cg/qtspecs/issues/1159</a></div><details><summary>Filter operator for arrays</summary><div class="markup"><p>I propose to provide <code>?[...]</code> as a filter operator for arrays.</p>
<p>For example,</p>
<pre><code>let $array := [(1,2,3), (4,5,6,7)]
return $array?[count(.) = 4]
</code></pre>
<p>returns</p>
<p><code>[(4,5,6,7)]</code></p>
<p>I propose that the operator should work exactly like the familiar <code>[]</code> for sequences in its handling of numeric and boolean predicate values. So for example $array?[2,1] in the above example returns <code>[(4,5,6,7), (1,2,3)]</code>. The result is always an array (which may be a little surprising). This means that <code>$array?[3]</code> has the same effect as <code>[$array?3]</code> or <code>[$array(3)]</code>.</p>
</div></details></div>
<div class="toot" id="created-1158"><h2>Issue #1158 created<span class="toot-id"> #created-1158</span></h2><div class="pubdate">15 Apr at 22:33:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1158">https://github.com/qt4cg/qtspecs/issues/1158</a></div><details><summary>Simple mapping operator for arrays</summary><div class="markup"><p>I propose to provide <code>!!</code> as a simple mapping operator for arrays.</p>
<p>For example <code>[(1,2,3), (4.5.6)]!!count(.)</code> returns <code>[3, 3]</code>.</p>
<p>The expression on the LHS must be an array.</p>
<p>The expression on the RHS is evaluated once for every member of the array, with that member as the context value, with the context position set to the position of that member in the array, and with the context size set to the array size.</p>
<p>The result is returned as an array which will always be the same size as the input array.</p>
<p>Note in passing that this provides a solution (though perhaps a clumsy solution) to issue #755, in that the example expression</p>
<p><code>(0 to 4) ~ count(.)</code></p>
<p>can now be written as <code>[(0 to 4)]!!count(.)?*</code></p>
</div></details></div>
<div class="toot" id="created-1157"><h2>Pull request #1157 created<span class="toot-id"> #created-1157</span></h2><div class="pubdate">15 Apr at 17:23:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1157">https://github.com/qt4cg/qtspecs/pull/1157</a></div><details><summary>1135 Correction to definition of focus functions</summary><div class="markup"><p>Fix #1135</p>
</div></details></div>
<div class="toot" id="created-1156"><h2>Pull request #1156 created<span class="toot-id"> #created-1156</span></h2><div class="pubdate">15 Apr at 17:06:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1156">https://github.com/qt4cg/qtspecs/pull/1156</a></div><details><summary>Fix error in XSLT example</summary><div class="markup"><p>Fix #1154</p>
</div></details></div>
<div class="toot" id="agenda-04-16"><h2>QT4 CG meeting 073 draft agenda<span class="toot-id"> #agenda-04-16</span></h2><div class="pubdate">15 Apr at 12:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/04-16">https://qt4cg.org/meeting/agenda/2024/04-16</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1155"><h2>Issue #1155 created<span class="toot-id"> #created-1155</span></h2><div class="pubdate">15 Apr at 12:05:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1155">https://github.com/qt4cg/qtspecs/issues/1155</a></div><details><summary>Glossary formatting</summary><div class="markup"><p>The format of the glossary for the data model spec differs needlessly from the other specifications. (Note, linking from the glossary entry to the place where the term is defined seems useful.)</p>
</div></details></div>
<div class="toot" id="created-1154"><h2>Issue #1154 created<span class="toot-id"> #created-1154</span></h2><div class="pubdate">14 Apr at 19:41:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1154">https://github.com/qt4cg/qtspecs/issues/1154</a></div><details><summary>[xsl:item-type] error in sample</summary><div class="markup"><p>Here : https://qt4cg.org/specifications/xslt-40/Overview-diff.html#named-item-types</p>
<p>First sample is</p>
<pre><code>&lt;xsl:item-type name="cx:complex" as="record(r as xs:double, i as xs:double)"/&gt;

&lt;xsl:variable name="i" as="cx:complex" select="cx:number(0, 1)"/&gt;
</code></pre>
<p><code>xsl:variable/@select</code> should probably be <code>cx:complex(0, 1)</code> instead of <code>cx:number</code></p>
</div></details></div>
<div class="toot" id="created-1153"><h2>Issue #1153 created<span class="toot-id"> #created-1153</span></h2><div class="pubdate">14 Apr at 15:05:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1153">https://github.com/qt4cg/qtspecs/issues/1153</a></div><details><summary>XSLT: debugging template rule selection</summary><div class="markup"><p>The biggest headache when debugging XSLT stylesheets is working out which template rules have been invoked in response to an <code>xsl:apply-templates</code> instruction (I'm hitting this frustration right now with the qtspecs build stylesheets...). The <code>xsl:message</code> instruction is unhelpful here, because if the "wrong" template rule is firing, you don't know where to add the message. And the only other standardised debugging aids are <code>fn:trace()</code> and <code>xsl:assert</code>, which don't help either.</p>
<p>I propose an attribute on <code>xsl:apply-templates</code>, <code>xsl:apply-imports</code>, and <code>xsl:next-match</code>: trace=yes|no. If enabled, execution of the instruction causes a message to be output (as if by xsl:message) identifying the rule that is invoked, in an implementation-defined way. In the case that a built-in template rule is invoked, the message should indicate this, and any implicit apply-templates performed by the built-in rule should be evaluated as if it specified trace="yes". It is "recommended" that the message output should identify the stylesheet module, line number, match pattern, and mode, if the information is available, and should also include a representation of the item that is being processed by the instruction, for example the node kind and name.</p>
</div></details></div>
<div class="toot" id="created-1152"><h2>Pull request #1152 created<span class="toot-id"> #created-1152</span></h2><div class="pubdate">13 Apr at 07:35:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1152">https://github.com/qt4cg/qtspecs/pull/1152</a></div><details><summary>1146 Inline change log</summary><div class="markup"><p>This is a first cut at changes to introduce an inline change log - changes shown at the start of each affected section, with a flag in the TOC to indicate which sections have changed.</p>
<p>It is currently applied, for demonstration purposes, to changes made in the serialization spec.</p>
<p>More specifically:</p>
<ul>
<li>Added the <code>changes</code> and <code>change</code> elements to the DTD; <code>changes</code> is an optional element that follows <code>head</code> within any section</li>
<li>Changed the XSLT stylesheets and CSS to render the <code>changes</code> element, and to add a flag to the TOC entry if a <code>changes</code> element is present</li>
<li>Added specimen <code>changes</code> elements to the seriallization spec</li>
</ul>
<p>There's a lot more to be done:</p>
<ul>
<li>Generate an aggregated list of changes in an appendix</li>
<li>Improve the CSS rendition</li>
<li>Toggle change markings on and off; browse forward and backward through changed sections</li>
<li>Add the <code>changes</code> data to the other specs</li>
</ul>
</div></details></div>
<div class="toot" id="created-1151"><h2>Pull request #1151 created<span class="toot-id"> #created-1151</span></h2><div class="pubdate">12 Apr at 18:14:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1151">https://github.com/qt4cg/qtspecs/pull/1151</a></div><details><summary>1138 Merge format and format-name params of format-number</summary><div class="markup"><p>close #1138</p>
<p>Note, the proposal could do with further editorial work to use standard <code>options</code> markup to define the options available.</p>
</div></details></div>
<div class="toot" id="created-1150"><h2>Pull request #1150 created<span class="toot-id"> #created-1150</span></h2><div class="pubdate">12 Apr at 17:51:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1150">https://github.com/qt4cg/qtspecs/pull/1150</a></div><details><summary>1142 Drop restriction disallowing items-equal with unordered</summary><div class="markup"><p>Allows the use of an items-equal callback even when comparisons are unordered, despite the fact that this may have atrocious performance.</p>
<p>close #1142</p>
</div></details></div>
<div class="toot" id="created-1149"><h2>Pull request #1149 created<span class="toot-id"> #created-1149</span></h2><div class="pubdate">12 Apr at 14:53:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1149">https://github.com/qt4cg/qtspecs/pull/1149</a></div><details><summary>1084 Add fos:default-description to support prose descriptions of defaults</summary><div class="markup"><p>Close #1084</p>
<p>This won't render correctly in the PR, but hopefully the diff is clear enough to decide if this is the approach we want to take.</p>
</div></details></div>
<div class="toot" id="created-1148"><h2>Pull request #1148 created<span class="toot-id"> #created-1148</span></h2><div class="pubdate">12 Apr at 14:45:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1148">https://github.com/qt4cg/qtspecs/pull/1148</a></div><details><summary>1143 Coercion rules: handle choice types before atomization</summary><div class="markup"><p>Fix #1143</p>
</div></details></div>
<div class="toot" id="created-1147"><h2>Pull request #1147 created<span class="toot-id"> #created-1147</span></h2><div class="pubdate">12 Apr at 14:12:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1147">https://github.com/qt4cg/qtspecs/pull/1147</a></div><details><summary>QT4CG-072-01 Clarify schema type terminology</summary><div class="markup"><p>Responding to an action from the review of PR #1132, this editorial PR attempts to improve the definitions and usage of terms such as "schema type", "atomic type", "pure union type", "generalized atomic type".</p>
</div></details></div>
<div class="toot" id="closed-796"><h2>Issue #796 closed<span class="toot-id"> #closed-796</span></h2><div class="pubdate">12 Apr at 11:41:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/796">https://github.com/qt4cg/qtspecs/issues/796</a></div><p>allow explicit type expressions in XPath variable bindings</p></div>
<div class="toot" id="closed-1131"><h2>Issue #1131 closed<span class="toot-id"> #closed-1131</span></h2><div class="pubdate">12 Apr at 11:41:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1131">https://github.com/qt4cg/qtspecs/pull/1131</a></div><p>796,231 - Extend XPath for and let expressions</p></div>
<div class="toot" id="created-1146"><h2>Issue #1146 created<span class="toot-id"> #created-1146</span></h2><div class="pubdate">12 Apr at 08:57:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1146">https://github.com/qt4cg/qtspecs/issues/1146</a></div><details><summary>Identifying 4.0 Changes</summary><div class="markup"><p>The list of changes in an appendix is (a) difficult to maintain (with a tendency to cause Git conflicts) and (b) remote from the places in the spec where the changes actually arise. At the same time, automated diff markup tends to give a lot of unwanted detail, highlighting changes that are purely editorial.</p>
<p>I propose that we try out an alternative approach. Each section/subsection with significant changes should start with an info box listing the changes, headed "Changes in 4.0". This should be rendered with a distinct colour or border to make it recognisable, and it should be possible to toggle whether the changes are shown or hidden. Changes that represent an incompatibility should be specially marked, perhaps with a device such as a warning triangle. A Δ marker (or colour highlighting) could appear in the table of contents against any section that has a <code>changes</code> entry.</p>
<p>Internally, the changes should be identified with custom markup: I suggest an optional <code>&lt;changes&gt;</code> element immediately after <code>&lt;head&gt;</code>, with a sequence of <code>&lt;change&gt;</code> children, each of which should contain administrative metadata (such as a link to the issue and/or PR) as well as user-readable text.</p>
<p>For changes to F+O functions, corresponding elements should be added to the FOS catalog schema; this should replace (or generate) the current "History" section.</p>
</div></details></div>
<div class="toot" id="closed-1145"><h2>Issue #1145 closed<span class="toot-id"> #closed-1145</span></h2><div class="pubdate">12 Apr at 08:19:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1145">https://github.com/qt4cg/qtspecs/issues/1145</a></div><p>Array Decomposition</p></div>
<div class="toot" id="closed-1144"><h2>Issue #1144 closed<span class="toot-id"> #closed-1144</span></h2><div class="pubdate">12 Apr at 08:18:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1144">https://github.com/qt4cg/qtspecs/issues/1144</a></div><p>Sequence Decomposition</p></div>
<div class="toot" id="created-1145"><h2>Issue #1145 created<span class="toot-id"> #created-1145</span></h2><div class="pubdate">12 Apr at 07:54:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1145">https://github.com/qt4cg/qtspecs/issues/1145</a></div><details><summary>Array Decomposition</summary><div class="markup"><p>This proposal allows arrays to be decomposed and assigned to separate variables in a single declaration within a for or let expression binding.</p>
<p>Given an array such as <code>[1, 2, 3]</code>, the values within that array cannot easily be extracted. With the current version of XPath and XQuery, they need to be assigned to a temporary variable first. For example:</p>
<pre><code>let $result := get-camera-point()
let $x := $result?(1)
let $y := $result?(2)
let $z := $result?(3)
return "(" || $x || "," || $y || "," || $z || ")"
</code></pre>
<p>This proposal would allow this to be written more concisely as:</p>
<pre><code>let [$x, $y, $z] := get-camera-point()
return "(" || $x || "," || $y || "," || $z || ")"
</code></pre>
<p>These are equivalent in this proposal, except that <code>$result</code> is not a statically known variable binding in the array decomposition let clause.</p>
<blockquote>
<p>Note: The older syntax in <a href="https://github.com/expath/xpath-ng/pull/8">XPath-NG</a> was:</p>
<p>let $[x, y, z] := get-camera-point()
return "(" || $x || "," || $y || "," || $z || ")"</p>
</blockquote>
<p>For each variable declaration in the array decomposition at index <code>N</code>, and <code>$expr</code> being the result of the for/let expression, then <code>$expr?(N)</code> is the value bound to the variable declaration as a new variable binding. If the value does not exist, an <code>err:FOAY0001</code> (array index out of bounds) error will be raised.</p>
<p>An array decomposition can be used in any for or let clause binding to decompose the items in an array. If the type of the for or let clause binding expression is not a sequence, an <code>err:XPTY0004</code> error is raised.</p>
<h3>Assigning the rest of an array</h3>
<p>It can be useful to only extract part of an array (e.g. the heading of a table), and store the rest of the items in another variable. For example:</p>
<pre><code>let $(heading as array(xs:string), rows as array(xs:string)...) :=
    load-csv("test.csv")
</code></pre>
<p>If there are no items remaining in the array the result is an empty array.</p>
<h3>Influences</h3>
<p>Tuple decomposition is found in various languages such as Python, Scala, and C#. These languages also have support for tuple types.</p>
<p>Python has support for specifying that a variable is assigned the remaining values in the tuple.</p>
<h2>Use Cases</h2>
<p>There are many cases where fixed size sequences may be used such as points, complex and rational numbers, sin/cos, and mul/div. This makes extracting data from these simpler, and may also be used to aid readability by assigning descriptive names to each of the items in the sequence.</p>
<h2>Examples</h2>
<p>Extracting values from an array:</p>
<pre><code>declare function sincos($angle as xs:double?) {
    [ math:sin($angle), math:cos($angle) ]
};

let $angle := math:pi()
let [$sin, $cos] := sincos($angle)
return $sin || "," || $cos
</code></pre>
</div></details></div>
<div class="toot" id="created-1144"><h2>Issue #1144 created<span class="toot-id"> #created-1144</span></h2><div class="pubdate">12 Apr at 07:47:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1144">https://github.com/qt4cg/qtspecs/issues/1144</a></div><details><summary>Sequence Decomposition</summary><div class="markup"><p>This proposal allows sequences to be decomposed and assigned to separate variables in a single declaration within a for or let expression binding.</p>
<p>Given a sequence such as <code>(1, 2, 3)</code>, the values within that sequence cannot easily be extracted. With the current version of XPath and XQuery, they need to be assigned to a temporary variable first. For example:</p>
<pre><code>let $result := get-camera-point()
let $x := $result[1]
let $y := $result[2]
let $z := $result[3]
return "(" || $x || "," || $y || "," || $z || ")"
</code></pre>
<p>This proposal would allow this to be written more concisely as:</p>
<pre><code>let ($x, $y, $z) := get-camera-point()
return "(" || $x || "," || $y || "," || $z || ")"
</code></pre>
<p>These are equivalent in this proposal, except that <code>$result</code> is not a statically known variable binding in the sequence decomposition let clause.</p>
<blockquote>
<p>Note: The older syntax in <a href="https://github.com/expath/xpath-ng/pull/8">XPath-NG</a> was:</p>
<p>let $(x, y, z) := get-camera-point()
return "(" || $x || "," || $y || "," || $z || ")"</p>
</blockquote>
<p>For each variable declaration in the sequence decomposition at index <code>N</code>, and <code>$expr</code> being the result of the for/let expression, then <code>$expr[N]</code> is the value bound to the variable declaration as a new variable binding. If the value does not exist, an empty sequence is bound to the variable.</p>
<p>A sequence decomposition can be used in any for or let clause binding to decompose the items in a sequence. If the type of the for or let clause binding expression is not a sequence, an <code>err:XPTY0004</code> error is raised.</p>
<h3>Assigning the rest of a sequence</h3>
<p>It can be useful to only extract part of a sequence or array (e.g. the heading of a table), and store the rest of the items in another variable. For example:</p>
<pre><code>let $(heading, rows ...) := fn:parse-csv("test.csv")
</code></pre>
<p>If there are no items remaining in the sequence the result is an empty sequence.</p>
<h3>Influences</h3>
<p>Tuple decomposition is found in various languages such as Python, Scala, and C#. These languages also have support for tuple types.</p>
<p>Python has support for specifying that a variable is assigned the remaining values in the tuple.</p>
<h2>Use Cases</h2>
<p>There are many cases where fixed size sequences may be used such as points, complex and rational numbers, sin/cos, and mul/div. This makes extracting data from these simpler, and may also be used to aid readability by assigning descriptive names to each of the items in the sequence.</p>
<h2>Examples</h2>
<p>Extracting values from a sequence:</p>
<pre><code>declare function sincos($angle as xs:double?) {
    math:sin($angle), math:cos($angle)
};

let $angle := math:pi()
let ($sin, $cos) := sincos($angle)
return $sin || "," || $cos
</code></pre>
</div></details></div>
<div class="toot" id="closed-983"><h2>Issue #983 closed<span class="toot-id"> #closed-983</span></h2><div class="pubdate">12 Apr at 06:33:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/983">https://github.com/qt4cg/qtspecs/issues/983</a></div><p>fn:reduce (or fn:fold without initial value)</p></div>
<div class="toot" id="created-1143"><h2>Issue #1143 created<span class="toot-id"> #created-1143</span></h2><div class="pubdate">11 Apr at 21:52:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1143">https://github.com/qt4cg/qtspecs/issues/1143</a></div><details><summary>Coercion Rules for Choice Item Types</summary><div class="markup"><p>The proposal that we accepted for choice item types (PR #1132) invokes atomization only if the choice type is a generalised atomic type, that is, if all alternatives in the choice are atomic.</p>
<p>This makes it tricky to take advantage of choice types for extending existing functions in a backwards-compatible way. For example, we might want to change the second argument of fn:unparsed-text from <code>$encoding as xs:string</code> to <code>$options as (xs:string | map(*))</code>. But under the current rules, this means the supplied value of the $encoding argument will no longer be atomized.</p>
<p>I propose to change this by effectively promoting rule 3 to appear before rule 2. Rule 2 is the atomization rule, and rule 3 is the new rule:</p>
<blockquote>
<p>If R is a [choice item type] <em>that is not a [generalized atomic type]</em>, then the following rules are applied with R set to each of the alternatives in the choice item type, in order, until an alternative is found that does not result in a type error; a type error is raised only if all alternatives fail.</p>
</blockquote>
<p>The phrase in italics is deleted.</p>
<p>The effect is that if the required type is <code>(xs:string | map(*))</code> then we first try converting the supplied argument as if the required type were <code>xs:string</code> (including atomization), and if that fails we try converting it as if the required type were map(*).</p>
</div></details></div>
<div class="toot" id="closed-231"><h2>Issue #231 closed<span class="toot-id"> #closed-231</span></h2><div class="pubdate">11 Apr at 21:35:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/231">https://github.com/qt4cg/qtspecs/issues/231</a></div><p>for expression: "at" keyword</p></div>
<div class="toot" id="closed-1139"><h2>Issue #1139 closed<span class="toot-id"> #closed-1139</span></h2><div class="pubdate">11 Apr at 21:34:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1139">https://github.com/qt4cg/qtspecs/issues/1139</a></div><p>let clause: function coercion</p></div>
<div class="toot" id="closed-788"><h2>Issue #788 closed<span class="toot-id"> #closed-788</span></h2><div class="pubdate">11 Apr at 21:31:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/788">https://github.com/qt4cg/qtspecs/issues/788</a></div><p>New function fn:annotate()</p></div>
<div class="toot" id="closed-1105"><h2>Issue #1105 closed<span class="toot-id"> #closed-1105</span></h2><div class="pubdate">11 Apr at 21:20:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1105">https://github.com/qt4cg/qtspecs/issues/1105</a></div><p>Casting to numerical type from strings with underscores</p></div>
<div class="toot" id="closed-67"><h2>Issue #67 closed<span class="toot-id"> #closed-67</span></h2><div class="pubdate">11 Apr at 21:18:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/67">https://github.com/qt4cg/qtspecs/issues/67</a></div><p>Allow optional parameters and keyword arguments on map and sequence variadic functions.</p></div>
<div class="toot" id="closed-132"><h2>Issue #132 closed<span class="toot-id"> #closed-132</span></h2><div class="pubdate">11 Apr at 21:17:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/132">https://github.com/qt4cg/qtspecs/issues/132</a></div><p>Clarify if redirects should be followed</p></div>
<div class="toot" id="closed-613"><h2>Issue #613 closed<span class="toot-id"> #closed-613</span></h2><div class="pubdate">11 Apr at 21:16:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/613">https://github.com/qt4cg/qtspecs/issues/613</a></div><p>Allow "union" as synonym for "|" everywhere</p></div>
<div class="toot" id="closed-666"><h2>Issue #666 closed<span class="toot-id"> #closed-666</span></h2><div class="pubdate">11 Apr at 21:16:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/666">https://github.com/qt4cg/qtspecs/issues/666</a></div><p>Polyfill function implementations</p></div>
<div class="toot" id="closed-713"><h2>Issue #713 closed<span class="toot-id"> #closed-713</span></h2><div class="pubdate">11 Apr at 21:15:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/713">https://github.com/qt4cg/qtspecs/issues/713</a></div><p>Annotations: Editorial notes</p></div>
<div class="toot" id="closed-834"><h2>Issue #834 closed<span class="toot-id"> #closed-834</span></h2><div class="pubdate">11 Apr at 21:14:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/834">https://github.com/qt4cg/qtspecs/issues/834</a></div><p>Add creation function for `csv-row-record` type</p></div>
<div class="toot" id="created-1142"><h2>Issue #1142 created<span class="toot-id"> #created-1142</span></h2><div class="pubdate">11 Apr at 11:51:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1142">https://github.com/qt4cg/qtspecs/issues/1142</a></div><details><summary>fn:deep-equal: items-equal</summary><div class="markup"><p>The current spec says about <code>items-equal</code> that…</p>
<blockquote>
<p>If this option is present then the <code>ordered</code> option MUST be <code>true</code> and the <code>unordered-elements</code> option MUST be an empty sequence.</p>
</blockquote>
<p>I doesn’t say what is going to happen if <code>ordered</code> is <code>false</code> or if <code>unordered-elements</code> is non-empty.</p>
<p>My preference would be to allow all combinations; we could then do things like:</p>
<pre><code class="language-xquery">deep-equal(
  (1, 2, 3),
  (3.1, 2.1, 1.1),
  { 'ordered': false(), 'items-equal': fn($a, $b) { xs:integer($a) = xs:integer($b) } }
)
</code></pre>
<p>It may imply O(n²), but it’s very simple to formulate other XPath expressions with the same complexity, such as <code>$huge1[. = $huge2]</code>.</p>
</div></details></div>
<div class="toot" id="created-1141"><h2>Pull request #1141 created<span class="toot-id"> #created-1141</span></h2><div class="pubdate">10 Apr at 09:07:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1141">https://github.com/qt4cg/qtspecs/pull/1141</a></div><details><summary>1140 Replace 'search' with 'target' for indexing functions</summary><div class="markup"><p>Close #1140</p>
<p>Having created the issue, per my outstanding action, I thought I'd take a quick look to see how extensive the change would be. AFAICT (though I confess to not looking exceedingly carefully), only two functions are effected. Here, for your consideration, is a PR that resolves the issue.</p>
</div></details></div>
<div class="toot" id="created-1140"><h2>Issue #1140 created<span class="toot-id"> #created-1140</span></h2><div class="pubdate">10 Apr at 08:59:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1140">https://github.com/qt4cg/qtspecs/issues/1140</a></div><details><summary>Use $target instead of $search for indexing functions</summary><div class="markup"><p>Back in February, when we discussed <code>array:index-of</code>, DN observed that the argument name <code>$search</code> could be interpreted as performing some sort of action. The alternative <code>$target</code> was proposed instead as being more "noun like".</p>
</div></details></div>
<div class="toot" id="minutes-04-09"><h2>QT4 CG meeting 072 draft minutes<span class="toot-id"> #minutes-04-09</span></h2><div class="pubdate">09 Apr at 17:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/04-09">https://qt4cg.org/meeting/minutes/2024/04-09</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1093"><h2>Issue #1093 closed<span class="toot-id"> #closed-1093</span></h2><div class="pubdate">09 Apr at 16:32:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1093">https://github.com/qt4cg/qtspecs/pull/1093</a></div><p>1091 Add fn:collation function</p></div>
<div class="toot" id="closed-1091"><h2>Issue #1091 closed<span class="toot-id"> #closed-1091</span></h2><div class="pubdate">09 Apr at 16:32:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1091">https://github.com/qt4cg/qtspecs/issues/1091</a></div><p>Convenience function to construct a collation URI</p></div>
<div class="toot" id="closed-99"><h2>Issue #99 closed<span class="toot-id"> #closed-99</span></h2><div class="pubdate">09 Apr at 16:29:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/99">https://github.com/qt4cg/qtspecs/issues/99</a></div><p>Functions that determine equality of two sequences or equality of two arrays</p></div>
<div class="toot" id="closed-1063"><h2>Issue #1063 closed<span class="toot-id"> #closed-1063</span></h2><div class="pubdate">09 Apr at 16:29:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1063">https://github.com/qt4cg/qtspecs/issues/1063</a></div><p>deep-equal() - option to compare functions liberally</p></div>
<div class="toot" id="closed-1120"><h2>Issue #1120 closed<span class="toot-id"> #closed-1120</span></h2><div class="pubdate">09 Apr at 16:29:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1120">https://github.com/qt4cg/qtspecs/pull/1120</a></div><p>99v2 deep equal with callback</p></div>
<div class="toot" id="closed-122"><h2>Issue #122 closed<span class="toot-id"> #closed-122</span></h2><div class="pubdate">09 Apr at 16:26:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/122">https://github.com/qt4cg/qtspecs/issues/122</a></div><p>Support general union sequence types</p></div>
<div class="toot" id="closed-1132"><h2>Issue #1132 closed<span class="toot-id"> #closed-1132</span></h2><div class="pubdate">09 Apr at 16:26:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1132">https://github.com/qt4cg/qtspecs/pull/1132</a></div><p>122 Choice item types (generalizing local union types)</p></div>
<div class="toot" id="closed-1112"><h2>Issue #1112 closed<span class="toot-id"> #closed-1112</span></h2><div class="pubdate">09 Apr at 16:23:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1112">https://github.com/qt4cg/qtspecs/pull/1112</a></div><p>1110-partial New error codes</p></div>
<div class="toot" id="closed-1118"><h2>Issue #1118 closed<span class="toot-id"> #closed-1118</span></h2><div class="pubdate">09 Apr at 16:20:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1118">https://github.com/qt4cg/qtspecs/issues/1118</a></div><p>Use new map{} syntax in adaptive output method</p></div>
<div class="toot" id="closed-1123"><h2>Issue #1123 closed<span class="toot-id"> #closed-1123</span></h2><div class="pubdate">09 Apr at 16:20:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1123">https://github.com/qt4cg/qtspecs/pull/1123</a></div><p>1118 Drop the "map" keyword in adaptive serialization output</p></div>
<div class="toot" id="closed-1128"><h2>Issue #1128 closed<span class="toot-id"> #closed-1128</span></h2><div class="pubdate">09 Apr at 16:17:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1128">https://github.com/qt4cg/qtspecs/pull/1128</a></div><p>1020 Further notes on the consequences of function coercion</p></div>
<div class="toot" id="closed-1133"><h2>Issue #1133 closed<span class="toot-id"> #closed-1133</span></h2><div class="pubdate">09 Apr at 16:14:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1133">https://github.com/qt4cg/qtspecs/issues/1133</a></div><p>fn:filter why predicate as map(*)</p></div>
<div class="toot" id="closed-1134"><h2>Issue #1134 closed<span class="toot-id"> #closed-1134</span></h2><div class="pubdate">09 Apr at 16:14:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1134">https://github.com/qt4cg/qtspecs/pull/1134</a></div><p>1133 Correct map:filter callback signature</p></div>
<div class="toot" id="created-1139"><h2>Issue #1139 created<span class="toot-id"> #created-1139</span></h2><div class="pubdate">09 Apr at 11:00:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1139">https://github.com/qt4cg/qtspecs/issues/1139</a></div><details><summary>let clause: function coercion</summary><div class="markup"><p>@michaelhkay I should be careful (as I regularly miss changes and additions in the 4.0 drafts), but it seems that the application of the function coercion rules for typed <code>let</code> clauses (https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-binding-rules) is not mentioned in the list of substantive changes at the end of the document. Would it be useful to add it, or does this change fall into a different category?</p>
</div></details></div>
<div class="toot" id="agenda-04-09"><h2>QT4 CG meeting 072 draft agenda<span class="toot-id"> #agenda-04-09</span></h2><div class="pubdate">08 Apr at 11:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/04-09">https://qt4cg.org/meeting/agenda/2024/04-09</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1138"><h2>Issue #1138 created<span class="toot-id"> #created-1138</span></h2><div class="pubdate">07 Apr at 23:01:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1138">https://github.com/qt4cg/qtspecs/issues/1138</a></div><details><summary>format-number arguments</summary><div class="markup"><p>Given the availability of choice item types, I propose that we merge the <code>format</code> and <code>format-name</code> parameters of <code>fn:format-number</code> into a single parameter of type <code>(xs:string | xs:QName | map(*))</code>. This seems a better design when parameters are mutually exclusive and perform a related role.</p>
</div></details></div>
<div class="toot" id="created-1137"><h2>Pull request #1137 created<span class="toot-id"> #created-1137</span></h2><div class="pubdate">07 Apr at 15:27:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1137">https://github.com/qt4cg/qtspecs/pull/1137</a></div><details><summary>161 Variadic functions</summary><div class="markup"><p>Fix #161</p>
<p>This proposal attempts to do the minimum necessary to allow the variable-arity nature of the fn:concat function to be reproduced for other functions including user-defined functions. The idea is that fn:concat should no longer be treated as a special case.</p>
<p>The proposal is deliberately less ambitious than some of the ideas discussed in the referenced issue. It's generally easier to get something into the language if we take smaller steps.</p>
<p>For an overview see section 4.5.3 of the XQuery spec.</p>
</div></details></div>
<div class="toot" id="created-1136"><h2>Issue #1136 created<span class="toot-id"> #created-1136</span></h2><div class="pubdate">07 Apr at 11:34:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1136">https://github.com/qt4cg/qtspecs/issues/1136</a></div><details><summary>Defining names for parameters on typed function tests</summary><div class="markup"><p>When defining the type of a higher-order function parameter, you cannot currently specify the names of the parameters of that higher-order function.</p>
<p>Allowing this can be useful for variou reasons:</p>
<ol>
<li>documenting the parameter names in the function signature -- this makes it clear looking at the function in an IDE, etc. what the parameters are;</li>
<li>making the specs clearer by referring to the parameters by name;</li>
<li>allowing a processor to provide better error messages by referring to the parameters names, e.g. when there is a type conversion error;</li>
<li>allowing a user to reference the parameter by name if we enable this to resolve named keyword argments (which is currently being discussed in #1114).</li>
</ol>
<p>Thus, you could declare e.g. <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-index-where">index-where</a> like this:</p>
<pre><code class="language-xquery">declare function fn:index-where(
  $input as&nbsp;item()*,
  $predicate as&nbsp;function(
    $item as item(),
    $position as xs:integer
  ) as xs:boolean
)&nbsp;as&nbsp;xs:integer* {
  (: ... :)
};
</code></pre>
</div></details></div>
<div class="toot" id="created-1135"><h2>Issue #1135 created<span class="toot-id"> #created-1135</span></h2><div class="pubdate">06 Apr at 12:08:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1135">https://github.com/qt4cg/qtspecs/issues/1135</a></div><details><summary>Definition of focus functions</summary><div class="markup"><p>§5.4.2.6 states</p>
<blockquote>
<p>The expression function { EXPR } (or fn { EXPR }) is a syntactic shorthand for the expression function($Z as item()<em>) as item()</em> { $Z ! (EXPR) }, where $Z is a variable name that is otherwise unused. Note that the function body (EXPR) is evaluated with a [fixed focus]: the context position and context size will always be 1 (one).</p>
</blockquote>
<p>This is no longer true now since generalization of the context item to context value. EXPR is evaluated once with the entire sequence $Z as the context value, it is not evaluated once for each item in $Z.</p>
<p>We have no direct way of expressing this in the absence of a resolution to issue #755.</p>
</div></details></div>
<div class="toot" id="created-1134"><h2>Pull request #1134 created<span class="toot-id"> #created-1134</span></h2><div class="pubdate">05 Apr at 15:45:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1134">https://github.com/qt4cg/qtspecs/pull/1134</a></div><details><summary>1133 Correct map:filter callback signature</summary><div class="markup"><p>Fix #1133</p>
</div></details></div>
<div class="toot" id="created-1133"><h2>Issue #1133 created<span class="toot-id"> #created-1133</span></h2><div class="pubdate">05 Apr at 15:23:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1133">https://github.com/qt4cg/qtspecs/issues/1133</a></div><details><summary>fn:filter why predicate as map(*)</summary><div class="markup"><p><code>fn:filter</code> is defined like this :</p>
<pre><code>map:filter(
  $map as map(*),	
  $predicate as function(xs:anyAtomicType, item()*) as map(*)	
) as map(*)
</code></pre>
<p>Why the predicate function is not returning a <code>xs:boolean</code> ?</p>
</div></details></div>
<div class="toot" id="created-1132"><h2>Pull request #1132 created<span class="toot-id"> #created-1132</span></h2><div class="pubdate">05 Apr at 11:26:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1132">https://github.com/qt4cg/qtspecs/pull/1132</a></div><details><summary>122 Choice item types (generalizing local union types)</summary><div class="markup"><p>Fix #122.</p>
<p>Allows the new item type syntax <code>(A | B)</code>, replacing <code>union(A, B)</code>; the alternatives are no longer restricted to be atomic types. The choice item type is a generalized atomic type if and only if all the alternatives are generalized atomic types.</p>
<p>Note that #122 also proposed unions of sequence types. While that is also viable, I found that unions of item types handled pretty well all practical use cases, and it seems excessive to offer both. Unions of item types proved (a) more useful (b) easier to combine with the existing feature of local union types, and (c) easier to handle in the coercion rules. Providing both is also tricky to handle in the grammar.</p>
</div></details></div>
<div class="toot" id="closed-1044"><h2>Issue #1044 closed<span class="toot-id"> #closed-1044</span></h2><div class="pubdate">04 Apr at 08:51:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1044">https://github.com/qt4cg/qtspecs/issues/1044</a></div><p>CSV row delimiter - allowed values</p></div>
<div class="toot" id="closed-1104"><h2>Issue #1104 closed<span class="toot-id"> #closed-1104</span></h2><div class="pubdate">04 Apr at 08:49:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1104">https://github.com/qt4cg/qtspecs/issues/1104</a></div><p>TypeTest expressions</p></div>
<div class="toot" id="created-1131"><h2>Pull request #1131 created<span class="toot-id"> #created-1131</span></h2><div class="pubdate">31 Mar at 22:29:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1131">https://github.com/qt4cg/qtspecs/pull/1131</a></div><details><summary>796,231 - Extend XPath for and let expressions</summary><div class="markup"><p>Fix #796
Fix #231</p>
<p>Extends "for" and "let" expressions in XPath to allow a larger subset of XQuery FLWOR expression syntax. Specifically:</p>
<ul>
<li>Allow positional variables (<code>at $pos</code>)</li>
<li>Allow type declarations (<code>as type</code>)</li>
<li>Allow let/for clauses to be mixed without an intervening <code>return</code>.</li>
</ul>
</div></details></div>
<div class="toot" id="closed-1122"><h2>Issue #1122 closed<span class="toot-id"> #closed-1122</span></h2><div class="pubdate">28 Mar at 14:10:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1122">https://github.com/qt4cg/qtspecs/issues/1122</a></div><p>Rendering xspecref</p></div>
<div class="toot" id="closed-1130"><h2>Issue #1130 closed<span class="toot-id"> #closed-1130</span></h2><div class="pubdate">28 Mar at 14:10:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1130">https://github.com/qt4cg/qtspecs/pull/1130</a></div><p>Fix xspecref to production</p></div>
<div class="toot" id="created-1130"><h2>Pull request #1130 created<span class="toot-id"> #created-1130</span></h2><div class="pubdate">28 Mar at 14:10:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1130">https://github.com/qt4cg/qtspecs/pull/1130</a></div><details><summary>Fix xspecref to production</summary><div class="markup"><p>Fix #1122</p>
<p>This is (apparently) the first use of an <code>xspecref</code> to a production.</p>
</div></details></div>
<div class="toot" id="closed-1129"><h2>Issue #1129 closed<span class="toot-id"> #closed-1129</span></h2><div class="pubdate">28 Mar at 13:22:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1129">https://github.com/qt4cg/qtspecs/pull/1129</a></div><p>Fix Norm's affiliation</p></div>
<div class="toot" id="created-1129"><h2>Pull request #1129 created<span class="toot-id"> #created-1129</span></h2><div class="pubdate">28 Mar at 13:22:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1129">https://github.com/qt4cg/qtspecs/pull/1129</a></div><details><summary>Fix Norm's affiliation</summary><div class="markup"><p>Someone preparing a QT4 status talk for a conference observed that my affiliation on the data model spec was out-of-date.</p>
<p>I'm just going to merge this one without any fanfare.</p>
</div></details></div>
<div class="toot" id="created-1128"><h2>Pull request #1128 created<span class="toot-id"> #created-1128</span></h2><div class="pubdate">28 Mar at 11:07:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1128">https://github.com/qt4cg/qtspecs/pull/1128</a></div><details><summary>1020 Further notes on the consequences of function coercion</summary><div class="markup"><p>Adds further notes an examples explaining the consequences of function coercion, especially when applied to maps and arrays. The new notes make it clear that test case MapTest-058 is incorrect; a map, once coerced to a function, cannot be used as a map.</p>
</div></details></div>
<div class="toot" id="created-1127"><h2>Issue #1127 created<span class="toot-id"> #created-1127</span></h2><div class="pubdate">28 Mar at 00:59:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1127">https://github.com/qt4cg/qtspecs/issues/1127</a></div><details><summary>Binary resources</summary><div class="markup"><p>We have some functions that accept binary input (parse-html, parse-csv) and others that don't (parse-xml, parse-json). There seems to be no obvious justification for the inconsistency.</p>
<p>Related to this:</p>
<p>(a) we have no functions to convert (encode/decode) between binary and string given an encoding</p>
<p>(b) we have no function to read a binary resource from a URI</p>
<p>Both of these are available in the EXPath bin library but should perhaps be promoted to the main spec.</p>
</div></details></div>
<div class="toot" id="closed-1039"><h2>Issue #1039 closed<span class="toot-id"> #closed-1039</span></h2><div class="pubdate">28 Mar at 00:24:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1039">https://github.com/qt4cg/qtspecs/issues/1039</a></div><p>Allow dynamic collations in XQuery "order by" and "group by"</p></div>
<div class="toot" id="closed-1092"><h2>Issue #1092 closed<span class="toot-id"> #closed-1092</span></h2><div class="pubdate">28 Mar at 00:24:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1092">https://github.com/qt4cg/qtspecs/pull/1092</a></div><p>1039 Add notes referring to fn:collation-key</p></div>
<div class="toot" id="closed-1100"><h2>Issue #1100 closed<span class="toot-id"> #closed-1100</span></h2><div class="pubdate">27 Mar at 23:59:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1100">https://github.com/qt4cg/qtspecs/pull/1100</a></div><p>99 fn:equal() function to compare sequences and arrays</p></div>
<div class="toot" id="closed-1113"><h2>Issue #1113 closed<span class="toot-id"> #closed-1113</span></h2><div class="pubdate">27 Mar at 22:18:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1113">https://github.com/qt4cg/qtspecs/issues/1113</a></div><p>Misleading rendering BiDi text in parse-integer example</p></div>
<div class="toot" id="closed-1126"><h2>Issue #1126 closed<span class="toot-id"> #closed-1126</span></h2><div class="pubdate">27 Mar at 14:34:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1126">https://github.com/qt4cg/qtspecs/pull/1126</a></div><p>1060 Minor fixes</p></div>
<div class="toot" id="created-1126"><h2>Pull request #1126 created<span class="toot-id"> #created-1126</span></h2><div class="pubdate">27 Mar at 14:34:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1126">https://github.com/qt4cg/qtspecs/pull/1126</a></div><details><summary>1060 Minor fixes</summary><div class="markup"><p>Whitespace, variable names, tests</p>
</div></details></div>
<div class="toot" id="closed-1121"><h2>Issue #1121 closed<span class="toot-id"> #closed-1121</span></h2><div class="pubdate">27 Mar at 14:13:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1121">https://github.com/qt4cg/qtspecs/pull/1121</a></div><p>1060 Formatting</p></div>
<div class="toot" id="created-1125"><h2>Pull request #1125 created<span class="toot-id"> #created-1125</span></h2><div class="pubdate">27 Mar at 12:26:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1125">https://github.com/qt4cg/qtspecs/pull/1125</a></div><details><summary>1094 Enhanced lookup expressions</summary><div class="markup"><p>Fix #1094</p>
<p>Lookup expressions (both deep and shallow) are enhanced in two ways:</p>
<p>(a) the syntax is extended to provide options that avoid flattening the result. For example <code>$V?pairs::K</code> delivers the result as a sequence of key-value pairs.</p>
<p>(b) a new KeySpecifier format is provided to filter the results by type. For example <code>$V??type(record(first, last))</code> selects all items in the recursive content that are of type <code>record(first, last)</code>. This replaces the previous syntax <code>$V??*::record(first, last)</code> which caused ambiguities with occurrence indicators.</p>
</div></details></div>
<div class="toot" id="closed-859"><h2>Issue #859 closed<span class="toot-id"> #closed-859</span></h2><div class="pubdate">27 Mar at 09:21:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/859">https://github.com/qt4cg/qtspecs/issues/859</a></div><p>Syntax problem with type-qualified wildcards in lookup expressions</p></div>
<div class="toot" id="closed-1106"><h2>Issue #1106 closed<span class="toot-id"> #closed-1106</span></h2><div class="pubdate">27 Mar at 09:21:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1106">https://github.com/qt4cg/qtspecs/pull/1106</a></div><p>859 lookup syntax problems</p></div>
<div class="toot" id="created-1124"><h2>Issue #1124 created<span class="toot-id"> #created-1124</span></h2><div class="pubdate">27 Mar at 08:46:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1124">https://github.com/qt4cg/qtspecs/issues/1124</a></div><details><summary>Formatting XPath/XQuery: Preferences, Conventions</summary><div class="markup"><p>In #1060, the formatting of code examples in the spec was unified. This issue is about discussing the formatting rules and (ideally) to define conventions for newly added code. If we don’t manage to define rules, the existing specs should provide enough examples for all syntactical constructs to be inspired by.</p>
<p>To start with, one suggestion in <a href="https://qt4cg.org/meeting/minutes/2024/03-26.html">yesterday’s meeting</a> was to choose a more compact presentation. Empty maps, empty arrays, and functions with an empty body are currently formatted as follows:</p>
<pre><code class="language-xquery">map { }, { },
array { }, [ ],
function { }, fn { }, fn($x) { }
</code></pre>
<p>We could remove the inner whitespace:</p>
<pre><code class="language-xquery">map {}, {},
array {}, [],
function {}, fn {}, fn($x) {}
</code></pre>
</div></details></div>
<div class="toot" id="created-1123"><h2>Pull request #1123 created<span class="toot-id"> #created-1123</span></h2><div class="pubdate">27 Mar at 08:36:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1123">https://github.com/qt4cg/qtspecs/pull/1123</a></div><details><summary>1118 Drop the "map" keyword in adaptive serialization output</summary><div class="markup"><p>Close #1118</p>
</div></details></div>
<div class="toot" id="created-1122"><h2>Issue #1122 created<span class="toot-id"> #created-1122</span></h2><div class="pubdate">27 Mar at 08:33:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1122">https://github.com/qt4cg/qtspecs/issues/1122</a></div><details><summary>Rendering xspecref</summary><div class="markup"><p>xspecref markup in the serialization spec is being rendered incorrectly. See for example</p>
<p><code>&lt;xspecref spec="XP40" ref="doc-xpath40-MapConstructor"/&gt;</code></p>
<p>in section 10, which renders as</p>
<p>A [map item] is serialized using the syntax of a [Section ] ^XP40 without ...</p>
<p>where the link to the referenced section works correctly, but the section title is not displayed.</p>
</div></details></div>
<div class="toot" id="created-1121"><h2>Pull request #1121 created<span class="toot-id"> #created-1121</span></h2><div class="pubdate">27 Mar at 08:24:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1121">https://github.com/qt4cg/qtspecs/pull/1121</a></div><details><summary>1060 Formatting</summary><div class="markup"><p>Minor editorial fixes (examples, typos). I’ll merge this after a while if no one objects.</p>
</div></details></div>
<div class="toot" id="created-1120"><h2>Pull request #1120 created<span class="toot-id"> #created-1120</span></h2><div class="pubdate">26 Mar at 23:44:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1120">https://github.com/qt4cg/qtspecs/pull/1120</a></div><details><summary>99v2 deep equal with callback</summary><div class="markup"><p>A second attempt to address issue #99</p>
<p>Replaces PR #1100</p>
<p>Fix #99
Fix #1063</p>
<p>In response to comments during the review of #1100, this PR abandons the proposed fn:equal() function and instead adds a callback option to fn:deep-equal. This can potentially be used to compare any pair of items (including maps and arrays) if desired.</p>
</div></details></div>
<div class="toot" id="created-1119"><h2>Issue #1119 created<span class="toot-id"> #created-1119</span></h2><div class="pubdate">26 Mar at 22:01:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1119">https://github.com/qt4cg/qtspecs/issues/1119</a></div><details><summary>Declare namespace bindings in XPath</summary><div class="markup"><p>We have dropped the proposed "with" expression, which was in the spec but never reviewed by the WG.</p>
<p>We need to reconsider the requirement: do we need some kind of construct to declare namespace prefixes, and perhaps other parts of the static context, in XPath?</p>
<p>One thought here is that when XPath expressions are issued from a host language such as Javascript or Python, the typical pattern is to have lots of small independent XPath expressions within a program. It doesn't make sense for each such expression to have its own boilerplate to establish the context, which will usually be the same for each expression. Rather it makes sense for the XPath invocation API to supply a reference to a context object which is set up once and reused. However, this doesn't mean that there's no room for XPath syntax to establish the context. For example, one might envisage a program doing</p>
<pre><code>XPath engine = new XPath();
engine.setStaticContext("declare namespace abc='http://abc.uri'; pqr = 'http://pqr.uri");
engine.evaluate("//x/@y");
</code></pre>
<p>so the syntax for creating the static context would be decoupled from the expression syntax.</p>
</div></details></div>
<div class="toot" id="closed-711"><h2>Issue #711 closed<span class="toot-id"> #closed-711</span></h2><div class="pubdate">26 Mar at 21:52:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/711">https://github.com/qt4cg/qtspecs/issues/711</a></div><p>Using annotations for navigation of JSON trees</p></div>
<div class="toot" id="closed-1070"><h2>Issue #1070 closed<span class="toot-id"> #closed-1070</span></h2><div class="pubdate">26 Mar at 21:31:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1070">https://github.com/qt4cg/qtspecs/issues/1070</a></div><p>Concise syntax for map construction</p></div>
<div class="toot" id="closed-1071"><h2>Issue #1071 closed<span class="toot-id"> #closed-1071</span></h2><div class="pubdate">26 Mar at 21:31:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1071">https://github.com/qt4cg/qtspecs/pull/1071</a></div><p>1070 Bare Brace map constructor syntax</p></div>
<div class="toot" id="created-1118"><h2>Issue #1118 created<span class="toot-id"> #created-1118</span></h2><div class="pubdate">26 Mar at 21:30:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1118">https://github.com/qt4cg/qtspecs/issues/1118</a></div><details><summary>Use new map{} syntax in adaptive output method</summary><div class="markup"><p>Should the adaptive output method be changed to use the new bare-brace syntax when serializing maps, dropping the <code>map</code> keyword?</p>
</div></details></div>
<div class="toot" id="closed-1019"><h2>Issue #1019 closed<span class="toot-id"> #closed-1019</span></h2><div class="pubdate">26 Mar at 17:26:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1019">https://github.com/qt4cg/qtspecs/issues/1019</a></div><p>XQFO: Unknown option parameters</p></div>
<div class="toot" id="closed-1059"><h2>Issue #1059 closed<span class="toot-id"> #closed-1059</span></h2><div class="pubdate">26 Mar at 17:26:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1059">https://github.com/qt4cg/qtspecs/pull/1059</a></div><p>1019 XQFO: Unknown option parameters</p></div>
<div class="toot" id="closed-1077"><h2>Issue #1077 closed<span class="toot-id"> #closed-1077</span></h2><div class="pubdate">26 Mar at 17:23:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1077">https://github.com/qt4cg/qtspecs/pull/1077</a></div><p>Correct the status of new language features</p></div>
<div class="toot" id="closed-1074"><h2>Issue #1074 closed<span class="toot-id"> #closed-1074</span></h2><div class="pubdate">26 Mar at 17:20:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1074">https://github.com/qt4cg/qtspecs/pull/1074</a></div><p>Confirm status of provisional functions</p></div>
<div class="toot" id="closed-1097"><h2>Issue #1097 closed<span class="toot-id"> #closed-1097</span></h2><div class="pubdate">26 Mar at 17:17:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1097">https://github.com/qt4cg/qtspecs/pull/1097</a></div><p>566-partial Fix colon issue in URI parsing</p></div>
<div class="toot" id="closed-1107"><h2>Issue #1107 closed<span class="toot-id"> #closed-1107</span></h2><div class="pubdate">26 Mar at 17:14:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1107">https://github.com/qt4cg/qtspecs/issues/1107</a></div><p>Grammar discrepancy on fn:pin() examples</p></div>
<div class="toot" id="closed-1060"><h2>Issue #1060 closed<span class="toot-id"> #closed-1060</span></h2><div class="pubdate">26 Mar at 17:14:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1060">https://github.com/qt4cg/qtspecs/issues/1060</a></div><p>Formatting XPath/XQuery</p></div>
<div class="toot" id="closed-1078"><h2>Issue #1078 closed<span class="toot-id"> #closed-1078</span></h2><div class="pubdate">26 Mar at 17:14:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1078">https://github.com/qt4cg/qtspecs/pull/1078</a></div><p>1060 Formatting XPath/XQuery</p></div>
<div class="toot" id="closed-1076"><h2>Issue #1076 closed<span class="toot-id"> #closed-1076</span></h2><div class="pubdate">26 Mar at 17:10:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1076">https://github.com/qt4cg/qtspecs/pull/1076</a></div><p>1075 Drop 'with' expressions</p></div>
<div class="toot" id="closed-1075"><h2>Issue #1075 closed<span class="toot-id"> #closed-1075</span></h2><div class="pubdate">26 Mar at 17:10:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1075">https://github.com/qt4cg/qtspecs/issues/1075</a></div><p>Drop "with" expressions</p></div>
<div class="toot" id="closed-1109"><h2>Issue #1109 closed<span class="toot-id"> #closed-1109</span></h2><div class="pubdate">26 Mar at 02:17:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1109">https://github.com/qt4cg/qtspecs/issues/1109</a></div><p>Discrepancies in fn:hash() published examples</p></div>
<div class="toot" id="created-1117"><h2>Pull request #1117 created<span class="toot-id"> #created-1117</span></h2><div class="pubdate">26 Mar at 00:04:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1117">https://github.com/qt4cg/qtspecs/pull/1117</a></div><details><summary>1116 Add options param to unparsed-text</summary><div class="markup"><p>Reverts the change to unparsed-text and unparsed-text-lines so they no longer normalise line endings by default.</p>
<p>Instead an options parameter is added to select this as a non-default behaviour.</p>
<p>At the same time, we add an option to control whether the function is deterministic (that is, returns the same content if called repeatedly with the same URI). In 3.1 the spec stated that implementations might provide an option to do this, but did not provide an interoperable way of setting this option. For compatibility, the default is still to be deterministic.</p>
<p>Fix #1116</p>
</div></details></div>
<div class="toot" id="created-1116"><h2>Issue #1116 created<span class="toot-id"> #created-1116</span></h2><div class="pubdate">25 Mar at 15:43:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1116">https://github.com/qt4cg/qtspecs/issues/1116</a></div><details><summary>unparsed-text() end-of-line normalization</summary><div class="markup"><p>I'm uncomfortable with the backwards-incompatible change we have made to <code>unparsed-text()</code> which now normalizes line endings.</p>
<p>I think it's unlikely that there are many users who care about the difference between LF and CRLF line endings and want to preserve that difference; but I think it's very likely that there are users who have written application code that expects the line ending to be CRLF, where the application will break if the line ending changes.</p>
<p>I would be more comfortable with the change if there were an option setting to revert to the 3.1 behaviour. But my preference would be to add the option and keep the default compatible with 3.1.</p>
<p>Also, for users who want to treat the file as a sequence of lines, we already introduced <code>unparsed-text-lines()</code> so they don't have to worry about different representations of line endings.</p>
</div></details></div>
<div class="toot" id="agenda-03-26"><h2>QT4 CG meeting 071 draft agenda<span class="toot-id"> #agenda-03-26</span></h2><div class="pubdate">25 Mar at 14:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/03-26">https://qt4cg.org/meeting/agenda/2024/03-26</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1115"><h2>Issue #1115 created<span class="toot-id"> #created-1115</span></h2><div class="pubdate">25 Mar at 14:11:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1115">https://github.com/qt4cg/qtspecs/issues/1115</a></div><details><summary>XSLT - ability to call a function from xslt (not just xpath)</summary><div class="markup"><p>I don't think this is possible in 3.0 and I don't think its yet suggested (whats the easiest way to find out)....if it has then close.</p>
<p>I wonder in passing many times why I ever use</p>
<p><code>&lt;xsl:call-template.../&gt;</code></p>
<p>when functions exist?
I never use the data context inside a named template...feels dangerous.</p>
<p>So the only reason I do it, is because I can embed literal XML elements e.g.</p>
<pre><code>&lt;xsl:call-template name='foo'&gt;
   &lt;xsl:with-param name='barElement' as='element(barElement)'&gt;
     &lt;barElement/&gt;
   &lt;xsl:with-param/&gt;


</code></pre>
<p>but if I could do</p>
<pre><code>&lt;xsl:call-function name='foo'&gt;
   &lt;xsl:with-param name='barElement' as='element(barElement)'&gt;
     &lt;barElement/&gt;
   &lt;xsl:with-param/&gt;

</code></pre>
<p>then i would use functions always in preference to named templates.</p>
<p>motivation</p>
<ul>
<li>language simplification (though you'd have to keep named templates for legacy)</li>
<li>you explicitly remove the data context (which I think is error prone in practice).</li>
<li>if people used functions in preference to named templates then you would be able to use more of your code directly from x-path expressions.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1114"><h2>Issue #1114 created<span class="toot-id"> #created-1114</span></h2><div class="pubdate">25 Mar at 13:32:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1114">https://github.com/qt4cg/qtspecs/issues/1114</a></div><details><summary>Partial function application: Keywords and placeholders</summary><div class="markup"><p>The test suite contains test cases – <a href="https://github.com/qt4cg/qt4tests/blob/e633f879db71b4bac91ac304fa13fd28619d0e1b/prod/FunctionCall.xml#L1178-L1240">FunctionCall-414 … FunctionCall-417</a> – for partially applied functions with keywords and placeholders:</p>
<pre><code class="language-xml">&lt;test-case name="FunctionCall-414" covers-40="keywords"&gt;
  &lt;description&gt;Use of keyword arguments with placeholders on user-defined function&lt;/description&gt;
  &lt;created by="Michael Kay" on="2023-03-13"/&gt;
  &lt;modified by="Michael Kay" on="2023-12-13" change="do what the description says"/&gt;
  &lt;dependency type="spec" value="XQ40+"/&gt;
  &lt;test&gt;&lt;![CDATA[
     declare function local:diff ($s as xs:integer, $t as xs:integer) as xs:integer { 
        $s - $t
     };  
     local:diff(s := 12, t := ?)(8)
  ]]&gt;&lt;/test&gt;
  &lt;result&gt;
    &lt;assert-eq&gt;4&lt;/assert-eq&gt;
  &lt;/result&gt;
&lt;/test-case&gt;
...
</code></pre>
<p>I didn’t find information on this feature combination in the spec; is it already covered? If yes, is it also possible to partially apply function items with keywords?…</p>
<pre><code class="language-xquery">declare function local:f($s, $t) { $s - $t };
local:f#2(s := 12, t := ?)(8),
local:f(?, ?)(s := 12, t := ?)(8)
...
</code></pre>
<p>If 2x yes, I can try to add some more test cases (for example, I assume that <code>$f(t := 12, ?)</code> is illegal, as arguments without keywords probably need to be placed first).</p>
</div></details></div>
<div class="toot" id="created-1113"><h2>Issue #1113 created<span class="toot-id"> #created-1113</span></h2><div class="pubdate">25 Mar at 10:40:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1113">https://github.com/qt4cg/qtspecs/issues/1113</a></div><details><summary>Misleading rendering BiDi text in parse-integer example</summary><div class="markup"><p>In fuction index one example of fn:parse-integer() is using parameters containing arabic letters. This leads to wrong display of parameters as 1st and 2nd parameter look like switched because browser renders both of them from left to right. It is this example:</p>
<pre><code>&lt;fos:test&gt;
               &lt;fos:expression&gt;&lt;eg&gt;translate('٢٠٢٣', '٠١٢٣٤٥٦٧٨٩', '0123456789')
=&gt; parse-integer()&lt;/eg&gt;&lt;/fos:expression&gt;
               &lt;fos:result&gt;2023&lt;/fos:result&gt;
            &lt;/fos:test&gt;
</code></pre>
<p>This looks confusing. I don't know what will be the best fix. Maybe storing '٠١٢٣٤٥٦٧٨٩' into variable would help and prevent the issue.</p>
</div></details></div>
<div class="toot" id="created-1112"><h2>Pull request #1112 created<span class="toot-id"> #created-1112</span></h2><div class="pubdate">25 Mar at 08:15:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1112">https://github.com/qt4cg/qtspecs/pull/1112</a></div><details><summary>1110-partial New error codes</summary><div class="markup"><p>Issue: #1110.</p>
<ul>
<li><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-hash">fn:hash</a>: I added <code>FOHA0001</code> as error code.</li>
<li><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-op">fn:op</a>: I used <code>XPTY0004</code> as error code, as the allowed operators could also be defined as string enumeration.</li>
<li><a href="https://qt4cg.org/specifications/xquery-40/xquery-40-diff.html#id-map-test">XQuery, Map Test</a>: Not included in this PR.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1111"><h2>Issue #1111 created<span class="toot-id"> #created-1111</span></h2><div class="pubdate">24 Mar at 08:40:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1111">https://github.com/qt4cg/qtspecs/issues/1111</a></div><details><summary>xsl:pipeline</summary><div class="markup"><p>In XSLT 3.0 it is not possible to write a multi-phase streaming transformation, where two are more phases each operate in streaming mode and the result of one phase is piped into the next. Such transformations can only be written as multiple stylesheets, coordinated by some calling application.</p>
<p>A non-streamed multiphase transformation typically uses variables for the intermediate results:</p>
<pre><code>&lt;xsl:variable name="temp1"&gt;
   &lt;xsl:apply-templates mode="phase1"/&gt;
&lt;/xsl:variable&gt;
&lt;xsl:variable name="temp2"&gt;
   &lt;xsl:apply-templates select="$temp1" mode="phase2"/&gt;
&lt;/xsl:variable&gt;
&lt;xsl:apply-templates select="$temp2"/&gt;
</code></pre>
<p>This cannot be streamed because variables cannot hold streamed nodes.</p>
<p>The idea is to allow this to be written:</p>
<pre><code>&lt;xsl:pipeline streamable="yes"&gt;
   &lt;xsl:apply-templates mode="phase1"/&gt;
   &lt;xsl:apply-templates select="." mode="phase2"/&gt;
   &lt;xsl:apply-templates select="." mode="phase3"/&gt;
&lt;/xsl:pipeline&gt;
</code></pre>
<p>where each instruction in the pipeline takes as its context value the result of the previous instruction.</p>
<p>Even when no streaming is involved, the xsl:pipeline instruction brings usability benefits: it's much clearer to the reader what is going on.</p>
<p>(Triggered by a support request from a user wanting to make an existing pipelined transformation streamable; but the idea was considered and "postponed to v.next" during XSLT 3.0 development. The replacement of "context item" by "context value" removes one of the obstacles.)</p>
</div></details></div>
<div class="toot" id="created-1110"><h2>Issue #1110 created<span class="toot-id"> #created-1110</span></h2><div class="pubdate">23 Mar at 17:40:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1110">https://github.com/qt4cg/qtspecs/issues/1110</a></div><details><summary>New error codes</summary><div class="markup"><p>The XQFO spec includes various “[TODO: error code]” comments. Should we add error codes when finalizing PRs, or does a master plan exist to add them at the very end?</p>
</div></details></div>
<div class="toot" id="created-1109"><h2>Issue #1109 created<span class="toot-id"> #created-1109</span></h2><div class="pubdate">23 Mar at 15:46:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1109">https://github.com/qt4cg/qtspecs/issues/1109</a></div><details><summary>Discrepancies in fn:hash() published examples</summary><div class="markup"><p>In the third example:</p>
<p><code>hash("") </code></p>
<p>the expected result has a spurious trailing letter "o". That's trivial and I will fix it.</p>
<p>In the seventh example:</p>
<p><code>hash(serialize($doc), map{"algorithm": "sha-1"}) </code></p>
<p>I am getting a completely different result, which I suspect is because I am getting a different result from <code>serialize()</code>. Perhaps the difference is something like a trailing newline, I don't know.</p>
<p>In my case the result of <code>serialize($doc)</code> is the 14-character string <code>"&lt;doc&gt;abc&lt;/doc&gt;"</code>, which I believe is correct, but I suspect there might be other results of <code>serialize($doc)</code> that would also be conformant with the spec.</p>
</div></details></div>
<div class="toot" id="created-1108"><h2>Pull request #1108 created<span class="toot-id"> #created-1108</span></h2><div class="pubdate">22 Mar at 17:06:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1108">https://github.com/qt4cg/qtspecs/pull/1108</a></div><details><summary>566-partial Describe a less aggressive %-encoding for fn:build-uri</summary><div class="markup"><p>My proposal seemed to meet with general approval, so here is my attempt to implement it in the spec.</p>
</div></details></div>
<div class="toot" id="created-1107"><h2>Issue #1107 created<span class="toot-id"> #created-1107</span></h2><div class="pubdate">22 Mar at 16:27:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1107">https://github.com/qt4cg/qtspecs/issues/1107</a></div><details><summary>Grammar discrepancy on fn:pin() examples</summary><div class="markup"><p>I'm probably getting the wrong end of the stick, but I can't see how the example for <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-pin">fn:pin():</a></p>
<pre><code>pin(["a","b","c"])?1 =&gt; label()?parent =&gt; array:foot()
</code></pre>
<p>meets the current EBNF. (I know bits of this area may be in flux, so this may be just for the record .)</p>
<pre><code>pin(["a","b","c"])?1 =&gt; label()
</code></pre>
<p>meets the production for <code>ArrowExpr</code>, and the RHS of an <code>ArrowExpr</code> is, in this case, an <code>ArrowStaticFunction</code> <code>ArgumentList</code> pair, which doesn't encompass the subsequent lookup.</p>
<p>But for <code>LookupExpr</code> to include the <code>?parent</code> requires <code>PostfixExpr</code> as its first term, and <code>PostfixExpr</code> can only include <code>ArrowExpr</code> via <code>PrimaryExpr/ParenthesizedExpr</code>, i.e. with brackets.</p>
</div></details></div>
<div class="toot" id="closed-1052"><h2>Issue #1052 closed<span class="toot-id"> #closed-1052</span></h2><div class="pubdate">21 Mar at 12:51:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1052">https://github.com/qt4cg/qtspecs/issues/1052</a></div><p>parse-csv() - simplify output</p></div>
<div class="toot" id="created-1106"><h2>Pull request #1106 created<span class="toot-id"> #created-1106</span></h2><div class="pubdate">21 Mar at 12:41:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1106">https://github.com/qt4cg/qtspecs/pull/1106</a></div><details><summary>859 lookup syntax problems</summary><div class="markup"><p>Fix the syntax ambiguity identified in issue #859 by dropping the troublesome construct.</p>
<p>It is hoped something else will be introduced in its place.</p>
<p>Fix #859</p>
</div></details></div>
<div class="toot" id="created-1105"><h2>Issue #1105 created<span class="toot-id"> #created-1105</span></h2><div class="pubdate">21 Mar at 11:53:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1105">https://github.com/qt4cg/qtspecs/issues/1105</a></div><details><summary>Casting to numerical type from strings with underscores</summary><div class="markup"><p>The <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#prod-xpath40-Digits">Digits</a> production now permits underscores as separators in long numerical character sequences.
However in casting to numerical types, either by operator or by function:</p>
<pre><code>'12_345_678' as xs:integer
number('12.345_678')
</code></pre>
<p>am I correct that this should fail according to <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#casting-from-strings">Casting from xs:string and xs:untypedAtomic</a>, even though a static resolution/rewrite would be possible?</p>
</div></details></div>
<div class="toot" id="created-1104"><h2>Issue #1104 created<span class="toot-id"> #created-1104</span></h2><div class="pubdate">21 Mar at 10:06:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1104">https://github.com/qt4cg/qtspecs/issues/1104</a></div><details><summary>TypeTest expressions</summary><div class="markup"><p>Our current status quo text allows the result of a lookup expression to be filtered by type:</p>
<p><code>[[1,2], [3,4], 5, 6]?*::array(*)?1</code></p>
<p>and issue #859 points out that this doesn't work because of a syntax ambiguity involving occurrence indicators ('?' is both an occurrence indicator and a lookup operator).</p>
<p>This issue addresses that problem by re-examining the requirements, and pulling in a number of other issues at the same time.</p>
<p>In path expressions we have a shorthand syntax for selecting nodes, called the node test, and the proposed syntax <code>::array(*)</code> was modelled on this. Node tests have a considerable overlap with types, but there are limitations. For example the <code>self</code> axis is often used to turn a node test into a general predicate, but <code>[self::XX]</code> can only be used to test elements, not attributes. However, the popularity of node tests and the self axis illustrates the need for a concise filtering operation.</p>
<p>Of course it's always possible to write <code>[. instance of array(*)]</code> but this gets extremely verbose.</p>
<p>In XSLT 3.0, template rules matching maps and arrays could only be written as <code>match=".[. instance of array(*)]"</code>, which gets really ugly, so we have proposed an alternative in 4.0. Specifically, you can match any type using <code>match="type(ItemType)"</code>, and for many types such as arrays and maps you can abbreviate this to, for example <code>match="array(*)"</code>. But this feels clumsy because the type() wrapper is sometimes needed and sometimes not.</p>
<p>I would like to propose an expression that has concise syntax, whose effect is equivalent to <code>. instance of T</code>. I propose to use the <code>~</code> symbol. This is available as both a binary and unary operator, so we can define a binary form <code>$z ~ T</code> which is syntactic shorthand for <code>$z instance of T</code>, and a unary form <code>~T</code> which is shorthand for <code>. ~ T</code>.</p>
<p>First, in the case of lookup expressions, we can now write:</p>
<p><code>[[1,2], [3,4], 5, 6]?*[~array(*)]?1</code></p>
<p>TypeTests will often be used within predicates in this way, and of course the usage is completely general.</p>
<p>Here's an example used for array:filter: <code>array:filter($array, fn{~xs:integer+})</code> which selects all members of the array comprising one or more integers.</p>
<p>In XSLT 4.0 the syntax <code>~T</code> replaces the current TypePattern, giving a much more uniform way of matching items by type.</p>
<p>In XPath and XSLT conditionals the construct can be used as an equivalent to XQuery's TypeswitchExpr:</p>
<pre><code>&lt;xsl:choose&gt;
  &lt;xsl:when test="~xs:integer"&gt;...&lt;/xsl:when&gt;
  &lt;xsl:when test="~xs:string"&gt;...&lt;/xsl:when&gt;
  ...
&lt;/xsl:choose&gt;
</code></pre>
<p>The choice of tilde for this operator is motivated by:</p>
<ul>
<li>There are not many symbols available</li>
<li>Tilde has many different uses in mathematics and computing, some of which represent a boolean test applied to a value (for example testing whether it is similar to another value or whether it matches some pattern), which is not dissimilar to this proposed usage</li>
<li>The alliteration between "tilde" and "type" has some mnemonic value (cf. the use of <code>@</code> for the attribute axis).</li>
</ul>
</div></details></div>
<div class="toot" id="created-1103"><h2>Issue #1103 created<span class="toot-id"> #created-1103</span></h2><div class="pubdate">19 Mar at 18:24:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1103">https://github.com/qt4cg/qtspecs/issues/1103</a></div><details><summary>CSV Parsing - handling line ending normalization</summary><div class="markup"><p>During discussion of PR #1066 there was much debate about how best to handle normalization of (typically CRLF) line endings.</p>
<p>Perhaps it's very unlikely that CRLF line endings will make it as far as the parse-csv() function, because they will already have been normalized for example by unparsed-text(). But data can also be read in other ways, for example bin:read-binary() or sql:query() extension functions, or passed in as a string-valued parameter to a transformation.</p>
<p>Perhaps we should have a separate mechanism for normalizing line endings in any data, independent of CSV parsing? (But perhaps it's important to retain CRLF in quoted strings?)</p>
<p>Perhaps CSV parsing should normalise CRLF unconditionally, without needing to set a special option for it?</p>
</div></details></div>
<div class="toot" id="closed-1101"><h2>Issue #1101 closed<span class="toot-id"> #closed-1101</span></h2><div class="pubdate">19 Mar at 18:21:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1101">https://github.com/qt4cg/qtspecs/issues/1101</a></div><p>XQuery: Normalize line endings</p></div>
<div class="toot" id="closed-1089"><h2>Issue #1089 closed<span class="toot-id"> #closed-1089</span></h2><div class="pubdate">19 Mar at 17:49:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1089">https://github.com/qt4cg/qtspecs/issues/1089</a></div><p>Rounding when casting string to date/time or duration types</p></div>
<div class="toot" id="closed-1090"><h2>Issue #1090 closed<span class="toot-id"> #closed-1090</span></h2><div class="pubdate">19 Mar at 17:49:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1090">https://github.com/qt4cg/qtspecs/pull/1090</a></div><p>1089 Add rounding rules for casting string to duration etc</p></div>
<div class="toot" id="closed-1079"><h2>Issue #1079 closed<span class="toot-id"> #closed-1079</span></h2><div class="pubdate">19 Mar at 17:46:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1079">https://github.com/qt4cg/qtspecs/issues/1079</a></div><p>Editorial: XSLT, Applying Template Rules, Examples</p></div>
<div class="toot" id="closed-1083"><h2>Issue #1083 closed<span class="toot-id"> #closed-1083</span></h2><div class="pubdate">19 Mar at 17:46:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1083">https://github.com/qt4cg/qtspecs/pull/1083</a></div><p>1079 Change book used in example</p></div>
<div class="toot" id="closed-1050"><h2>Issue #1050 closed<span class="toot-id"> #closed-1050</span></h2><div class="pubdate">19 Mar at 17:43:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1050">https://github.com/qt4cg/qtspecs/issues/1050</a></div><p>Potential (low-risk) Ambiguities in XPath EBNF</p></div>
<div class="toot" id="closed-1081"><h2>Issue #1081 closed<span class="toot-id"> #closed-1081</span></h2><div class="pubdate">19 Mar at 17:43:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1081">https://github.com/qt4cg/qtspecs/pull/1081</a></div><p>1050 Fix ItemType grammar ambiguity</p></div>
<div class="toot" id="closed-1080"><h2>Issue #1080 closed<span class="toot-id"> #closed-1080</span></h2><div class="pubdate">19 Mar at 17:40:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1080">https://github.com/qt4cg/qtspecs/pull/1080</a></div><p>1036 Rephrase the rules for number-parser with liberal JSON</p></div>
<div class="toot" id="closed-1036"><h2>Issue #1036 closed<span class="toot-id"> #closed-1036</span></h2><div class="pubdate">19 Mar at 17:40:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1036">https://github.com/qt4cg/qtspecs/issues/1036</a></div><p>parse-json: liberal parsing</p></div>
<div class="toot" id="closed-1102"><h2>Issue #1102 closed<span class="toot-id"> #closed-1102</span></h2><div class="pubdate">19 Mar at 17:40:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1102">https://github.com/qt4cg/qtspecs/pull/1102</a></div><p>Fix broken idref to escaped-crlf in test generation</p></div>
<div class="toot" id="created-1102"><h2>Pull request #1102 created<span class="toot-id"> #created-1102</span></h2><div class="pubdate">19 Mar at 17:40:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1102">https://github.com/qt4cg/qtspecs/pull/1102</a></div><details><summary>Fix broken idref to escaped-crlf in test generation</summary><div class="markup"><p>It appears that <code>escaped-crlf-3</code> might have been intended. @michaelhkay ?</p>
</div></details></div>
<div class="toot" id="closed-1073"><h2>Issue #1073 closed<span class="toot-id"> #closed-1073</span></h2><div class="pubdate">19 Mar at 17:33:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1073">https://github.com/qt4cg/qtspecs/pull/1073</a></div><p>XQFO (editorial)</p></div>
<div class="toot" id="closed-757"><h2>Issue #757 closed<span class="toot-id"> #closed-757</span></h2><div class="pubdate">19 Mar at 17:32:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/757">https://github.com/qt4cg/qtspecs/issues/757</a></div><p>Function families</p></div>
<div class="toot" id="closed-463"><h2>Issue #463 closed<span class="toot-id"> #closed-463</span></h2><div class="pubdate">19 Mar at 17:32:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/463">https://github.com/qt4cg/qtspecs/issues/463</a></div><p>fn:parts() - extract the parts of a (not-really) atomic value</p></div>
<div class="toot" id="closed-448"><h2>Issue #448 closed<span class="toot-id"> #closed-448</span></h2><div class="pubdate">19 Mar at 17:31:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/448">https://github.com/qt4cg/qtspecs/issues/448</a></div><p>Support extended dateTime formats of ISO-8601:2019?</p></div>
<div class="toot" id="closed-283"><h2>Issue #283 closed<span class="toot-id"> #closed-283</span></h2><div class="pubdate">19 Mar at 17:31:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/283">https://github.com/qt4cg/qtspecs/issues/283</a></div><p>Enumeration types</p></div>
<div class="toot" id="closed-218"><h2>Issue #218 closed<span class="toot-id"> #closed-218</span></h2><div class="pubdate">19 Mar at 17:31:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/218">https://github.com/qt4cg/qtspecs/issues/218</a></div><p>Function library for maps with composite keys: and thoughts on encapsulation</p></div>
<div class="toot" id="closed-119"><h2>Issue #119 closed<span class="toot-id"> #closed-119</span></h2><div class="pubdate">19 Mar at 17:31:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/119">https://github.com/qt4cg/qtspecs/issues/119</a></div><p>Allow a map's key value to be any sequence</p></div>
<div class="toot" id="closed-33"><h2>Issue #33 closed<span class="toot-id"> #closed-33</span></h2><div class="pubdate">19 Mar at 17:31:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/33">https://github.com/qt4cg/qtspecs/issues/33</a></div><p>JSON Parsing &amp; Serialization: Numbers</p></div>
<div class="toot" id="closed-883"><h2>Issue #883 closed<span class="toot-id"> #closed-883</span></h2><div class="pubdate">19 Mar at 17:30:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/883">https://github.com/qt4cg/qtspecs/issues/883</a></div><p>Improve return type for fn:load-xquery-module()</p></div>
<div class="toot" id="minutes-03-19"><h2>QT4 CG meeting 070 draft minutes<span class="toot-id"> #minutes-03-19</span></h2><div class="pubdate">19 Mar at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/03-19">https://qt4cg.org/meeting/minutes/2024/03-19</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1072"><h2>Issue #1072 closed<span class="toot-id"> #closed-1072</span></h2><div class="pubdate">19 Mar at 17:29:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1072">https://github.com/qt4cg/qtspecs/pull/1072</a></div><p>883 Return type of load-xquery-module</p></div>
<div class="toot" id="closed-1066"><h2>Issue #1066 closed<span class="toot-id"> #closed-1066</span></h2><div class="pubdate">19 Mar at 17:27:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1066">https://github.com/qt4cg/qtspecs/pull/1066</a></div><p>1052 Simplify the results of parse-csv</p></div>
<div class="toot" id="created-1101"><h2>Issue #1101 created<span class="toot-id"> #created-1101</span></h2><div class="pubdate">19 Mar at 13:04:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1101">https://github.com/qt4cg/qtspecs/issues/1101</a></div><details><summary>XQuery: Normalize line endings</summary><div class="markup"><p>Various tests, such as <a href="https://github.com/qt4cg/qt4tests/blob/c4210d9d22e756a05dfb54a0ca06fae159fe0bbc/misc/XMLEdition.xml#L132-L140"><code>line-ending-Q002</code></a>, validate if line ending are normalized when parsing the input:</p>
<pre><code class="language-xml">&lt;test-case name="line-ending-Q002"&gt;
  &lt;description&gt;Normalization of line endings in XQuery&lt;/description&gt;
  &lt;created by="Michael Kay" on="2011-11-24"/&gt;
  &lt;dependency type="spec" value="XQ10+"/&gt;
  &lt;test&gt;deep-equal(string-to-codepoints('&amp;#xd;&amp;#xa;'), (10))&lt;/test&gt;
  &lt;result&gt;
    &lt;assert-true/&gt;
  &lt;/result&gt;
&lt;/test-case&gt;
</code></pre>
<p>I cannot find a corresponding note in the current <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html">XQuery 4 draft</a>. Should we add it?</p>
<p>I would welcome this normalization. I assume that no one over the last decades has missed carriage return in XML?</p>
</div></details></div>
<div class="toot" id="closed-1099"><h2>Issue #1099 closed<span class="toot-id"> #closed-1099</span></h2><div class="pubdate">19 Mar at 12:35:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1099">https://github.com/qt4cg/qtspecs/pull/1099</a></div><p>Build fixes</p></div>
<div class="toot" id="created-1100"><h2>Pull request #1100 created<span class="toot-id"> #created-1100</span></h2><div class="pubdate">19 Mar at 12:21:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1100">https://github.com/qt4cg/qtspecs/pull/1100</a></div><details><summary>99 fn:equal() function to compare sequences and arrays</summary><div class="markup"><p>Fix issue #99</p>
<p>Introduces a function fn:equal() that compares two arbitrary values (sequences, maps, arrays, etc), with a callback for comparing "leaf" items in the structure.</p>
</div></details></div>
<div class="toot" id="created-1099"><h2>Pull request #1099 created<span class="toot-id"> #created-1099</span></h2><div class="pubdate">19 Mar at 12:17:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1099">https://github.com/qt4cg/qtspecs/pull/1099</a></div><details><summary>Build fixes</summary><div class="markup"><p>I had a brain cramp when I wrote the <code>build.gradle</code> file for this repository. This PR fixes that.</p>
<p>It also adds a <code>nobreak</code> attribute to the <code>code</code> element. The intent, not yet implemented, is that you can say</p>
<pre><code>&lt;code nobreak="true"&gt;some long, but not unreasonably long expression&lt;/code&gt;
</code></pre>
<p>and the stylesheet will prevent a line break in the middle of the expression.</p>
</div></details></div>
<div class="toot" id="created-1098"><h2>Pull request #1098 created<span class="toot-id"> #created-1098</span></h2><div class="pubdate">19 Mar at 12:14:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1098">https://github.com/qt4cg/qtspecs/pull/1098</a></div><details><summary>566-partial Editorial improvements for parse-uri</summary><div class="markup"><ol>
<li>Add a note clarifying that the fragment identifier should be (1) URI decoded and (2) ignored if it's the empty string.</li>
<li>Reworked a bit of the description in order to avoid an ambiguity in how <code>///abc</code> should be parsed. (The current spec can be satisfied either by parsing it as <code>//(/abc)()</code> or <code>//()/abc</code> and only the former is intended.)</li>
</ol>
</div></details></div>
<div class="toot" id="created-1097"><h2>Pull request #1097 created<span class="toot-id"> #created-1097</span></h2><div class="pubdate">18 Mar at 16:22:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1097">https://github.com/qt4cg/qtspecs/pull/1097</a></div><details><summary>566-partial Fix colon issue in URI parsing</summary><div class="markup"><p>In the course of reviewing the tests for <code>fn:parse-uri</code>, I discovered (or perhaps more correctly, @ChristianGruen discovered) that the rules for matching Windows drive letters are inconsistent. This PR fixes that inconsistency.</p>
</div></details></div>
<div class="toot" id="created-1096"><h2>Issue #1096 created<span class="toot-id"> #created-1096</span></h2><div class="pubdate">18 Mar at 15:36:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1096">https://github.com/qt4cg/qtspecs/issues/1096</a></div><details><summary>Effect of atomization on array:index-of()</summary><div class="markup"><p>What is the expected result of the expression:</p>
<p><code>array:index-of( [[1,2], [3,4]],  [3,4] )</code></p>
<p>It seems that the second argument is atomised (because its declared type is atomic), but the first argument is not.</p>
<p>So both members of the array have count=1, whereas $search has count=2, so nothing matches, so the result is ().</p>
<p>Now, what if we write:</p>
<p><code>array:index-of( [[1,2], (3,4)],  [3,4] )</code></p>
<p>This time it seems that the second member of the array matches, so the result is 2.</p>
<p>This doesn't feel right. One solution would be to say that each member of the array is itself atomised. But that seems to lead to other surprises with other examples of nested arrays.</p>
<p>An alternative would be to atomize neither argument (which would mean changing the function signature). But then we would need to use a different comparison operation.</p>
<p>We seem to be back where we started -- I was unhappy about introducing this function because of the difficulty of defining a good comparison operation for it to use.</p>
</div></details></div>
<div class="toot" id="agenda-03-19"><h2>QT4 CG meeting 070 draft agenda<span class="toot-id"> #agenda-03-19</span></h2><div class="pubdate">18 Mar at 14:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/03-19">https://qt4cg.org/meeting/agenda/2024/03-19</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-1095"><h2>Issue #1095 closed<span class="toot-id"> #closed-1095</span></h2><div class="pubdate">18 Mar at 11:44:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1095">https://github.com/qt4cg/qtspecs/issues/1095</a></div><p>Collation: caseblind → Standardize or replace with `html-ascii-case-insensitive`?</p></div>
<div class="toot" id="created-1095"><h2>Issue #1095 created<span class="toot-id"> #created-1095</span></h2><div class="pubdate">18 Mar at 11:20:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1095">https://github.com/qt4cg/qtspecs/issues/1095</a></div><details><summary>Collation: caseblind → Standardize or replace with `html-ascii-case-insensitive`?</summary><div class="markup"><p>Various test cases use the artificial <code>http://www.w3.org/2010/09/qt-fots-catalog/collation/caseblind</code> collation. It seems that most (all) of them could also be written with the <code>http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive</code>.</p>
<p>Could we replace the tests with the standardized collation, or should we rather try to standardize the caseblind variant?</p>
</div></details></div>
<div class="toot" id="created-1094"><h2>Issue #1094 created<span class="toot-id"> #created-1094</span></h2><div class="pubdate">18 Mar at 09:25:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1094">https://github.com/qt4cg/qtspecs/issues/1094</a></div><details><summary>Axis steps in lookup expressions</summary><div class="markup"><p>This issue picks up where issue #341, issue #350, issue #596, issue #960 etc left off - an attempt to find better syntax and semantics for navigation within JTrees (by which I mean trees of maps and arrays). The problems we are addressing are well aired in those previous issues. There are new opportunities for improving navigation within pinned trees, where upwards navigation becomes possible.</p>
<p>Firstly I propose that the existing constructs <code>?*</code>, <code>?key</code>, and <code>?1</code> be treated as abbreviations for <code>?content::*</code>, <code>?content::key</code>, and <code>?content::1</code> respectively. The content axis delivers a flattened sequence of items.</p>
<p>Then I propose we introduce an <code>entry</code> axis. <code>?entry::*</code>, <code>?entry::key</code>, and <code>?entry::1</code> deliver their results as a sequence of key value pairs, in the style of <code>map:pairs()</code>. Arrays for this purpose are treated as maps with integer keys. For example if <code>$A</code> is <code>[(1,2), (3,4)]</code> then <code>$A?entry::*</code> delivers <code>(map{'key':1, 'value':(1,2)}, map{'key':2 'value':(3,4)}</code>.</p>
<p>This applies equally to the deep lookup operator. <code>$A??entry::*</code> returns all the key-value pairs within the JTree rooted at $A, recursively.</p>
<p>We could also consider a <code>value</code> axis which delivers a sequence of arrays containing the values, losing the associated keys.</p>
<p>If values are labelled, as a result of being found by navigating a pinned JTree. then upwards navigation is also possible. For an item in a pinned tree,</p>
<ul>
<li>
<p><code>containing-entry::*</code> delivers the containing entry as a key-value pair. Duplicates are eliminated.</p>
</li>
<li>
<p><code>owner::*</code> delivers the immediately containing map or array as identified by the label</p>
</li>
<li>
<p><code>ownership::*</code> delivers the transitive closure of the <code>owner::*</code> axis.</p>
</li>
<li>
<p><code>peer::*</code> delivers <code>owner::*/entry::*</code></p>
</li>
<li>
<p><code>following-member::*</code> delivers the subarray of the containing array that follows the current entry</p>
</li>
<li>
<p><code>preceding-member::*</code> delivers the subarray of the containing array thay precedes the current entry</p>
</li>
</ul>
<p>Of course, improved names for these concepts are welcomed!</p>
<p>In these examples I have used <code>*</code> to select everything on the relevant axis. This can always be replaced by a key specifier K that selects the item only if it is labelled with a key K. So for example ownership::address selects the containing maps and arrays that are themselves in a map entry with key "address".</p>
<p>I think we also need a convenient way to filter the selection by type (see issue #859 for a problem with the current syntax). I propose</p>
<p><code>??content::[record(longitude, latitude)]</code></p>
<p>to select all items in the recursive content that match type <code>record(longitude, latitude)</code></p>
<p>Similarly</p>
<p><code>??entry::[array(xs:integer)+]</code></p>
<p>to select all entries where the value is an array of integers.</p>
<p>Finally, responding to issue #341, I propose that lookup operators should be error free: rather than reporting errors, they should return nothing.</p>
</div></details></div>
<div class="toot" id="created-1093"><h2>Pull request #1093 created<span class="toot-id"> #created-1093</span></h2><div class="pubdate">17 Mar at 16:08:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1093">https://github.com/qt4cg/qtspecs/pull/1093</a></div><details><summary>1091 Add fn:collation function</summary><div class="markup"><p>Fix #1091</p>
</div></details></div>
<div class="toot" id="created-1092"><h2>Pull request #1092 created<span class="toot-id"> #created-1092</span></h2><div class="pubdate">17 Mar at 09:30:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1092">https://github.com/qt4cg/qtspecs/pull/1092</a></div><details><summary>1039 Add notes referring to fn:collation-key</summary><div class="markup"><p>Fix #1039</p>
<p>Rather than adding a new feature to the language, we add notes to "order by" and "group by" explaining how the requirement can be met using the fn:collation-key() function.</p>
</div></details></div>
<div class="toot" id="closed-334"><h2>Issue #334 closed<span class="toot-id"> #closed-334</span></h2><div class="pubdate">16 Mar at 21:51:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/334">https://github.com/qt4cg/qtspecs/issues/334</a></div><p>Transient properties: a new approach to deep selection and update in maps and arrays</p></div>
<div class="toot" id="closed-86"><h2>Issue #86 closed<span class="toot-id"> #closed-86</span></h2><div class="pubdate">16 Mar at 21:40:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/86">https://github.com/qt4cg/qtspecs/issues/86</a></div><p>Fallback for named timezones </p></div>
<div class="toot" id="closed-64"><h2>Issue #64 closed<span class="toot-id"> #closed-64</span></h2><div class="pubdate">16 Mar at 21:36:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/64">https://github.com/qt4cg/qtspecs/issues/64</a></div><p>Specify optional parameters to create bounded variadic functions</p></div>
<div class="toot" id="closed-56"><h2>Issue #56 closed<span class="toot-id"> #closed-56</span></h2><div class="pubdate">16 Mar at 21:18:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/56">https://github.com/qt4cg/qtspecs/issues/56</a></div><p>Allow item-type to be matched within its definition scope</p></div>
<div class="toot" id="created-1091"><h2>Issue #1091 created<span class="toot-id"> #created-1091</span></h2><div class="pubdate">16 Mar at 15:16:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1091">https://github.com/qt4cg/qtspecs/issues/1091</a></div><details><summary>Convenience function to construct a collation URI</summary><div class="markup"><p>I propose a convenience function to construct a collation URI: for example</p>
<p>collation({'lang':'fr'})</p>
<p>returns a collation URI suitable for French.</p>
<p>If the property names supplied are those that are defined for UCA collation names, the result will be the corresponding UCA collation URI; alternatively, implementation-defined property names can be included.</p>
</div></details></div>
<div class="toot" id="created-1090"><h2>Pull request #1090 created<span class="toot-id"> #created-1090</span></h2><div class="pubdate">15 Mar at 15:53:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1090">https://github.com/qt4cg/qtspecs/pull/1090</a></div><details><summary>1089 Add rounding rules for casting string to duration etc</summary><div class="markup"><p>Fix #1089</p>
</div></details></div>
<div class="toot" id="created-1089"><h2>Issue #1089 created<span class="toot-id"> #created-1089</span></h2><div class="pubdate">15 Mar at 15:35:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1089">https://github.com/qt4cg/qtspecs/issues/1089</a></div><details><summary>Rounding when casting string to date/time or duration types</summary><div class="markup"><p>F+O section 21.2 describes rules for rounding when strings are cast to xs:decimal. The same rules should apply when casting to a dateTime, time, or duration, in the case where the number of digits in the fractional seconds part exceeds the precision supported by the implementation.</p>
</div></details></div>
<div class="toot" id="closed-1082"><h2>Issue #1082 closed<span class="toot-id"> #closed-1082</span></h2><div class="pubdate">15 Mar at 14:50:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1082">https://github.com/qt4cg/qtspecs/issues/1082</a></div><p>Inconsistency in underscore in numeric literal grammar</p></div>
<div class="toot" id="closed-1088"><h2>Issue #1088 closed<span class="toot-id"> #closed-1088</span></h2><div class="pubdate">15 Mar at 14:50:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1088">https://github.com/qt4cg/qtspecs/pull/1088</a></div><p>1082 Fix numeric literal grammar</p></div>
<div class="toot" id="created-1088"><h2>Pull request #1088 created<span class="toot-id"> #created-1088</span></h2><div class="pubdate">15 Mar at 13:07:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1088">https://github.com/qt4cg/qtspecs/pull/1088</a></div><details><summary>1082 Fix numeric literal grammar</summary><div class="markup"><p>Fix #1082</p>
<p>Also adds some notes and examples</p>
</div></details></div>
<div class="toot" id="created-1087"><h2>Pull request #1087 created<span class="toot-id"> #created-1087</span></h2><div class="pubdate">15 Mar at 11:44:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1087">https://github.com/qt4cg/qtspecs/pull/1087</a></div><details><summary>1086 Editorial changes to array:values</summary><div class="markup"><p>Fix #1086</p>
</div></details></div>
<div class="toot" id="created-1086"><h2>Issue #1086 created<span class="toot-id"> #created-1086</span></h2><div class="pubdate">15 Mar at 10:40:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1086">https://github.com/qt4cg/qtspecs/issues/1086</a></div><details><summary>array:values spec cleanup</summary><div class="markup"><p>The rules for array:values say:</p>
<blockquote>
<p>The function concatenates the members of $array and returns them as a sequence. The values are returned in their original order. Arrays contained within members are returned unchanged.</p>
<p>The effect of the function is equivalent to $array?*.</p>
</blockquote>
<p>This is all a bit too vague.</p>
<ul>
<li>the values are not concatenated, at least not in the sense of concat()</li>
<li>it doesn't return the members, it returns their sequence concatenation</li>
<li>the phrase "arrays contained within members" is unclear. The examples reveal that this rule is intended to include arrays that ARE members.</li>
<li>the equivalent expression <code>$array?*</code> allows $array to be things that <code>array:values()</code> doesn't allow (like an empty sequence).</li>
</ul>
<p>More subtly, the introduction to section 19.1 says:</p>
<blockquote>
<p>All functionality on arrays is defined in terms of two primitives:</p>
<p>The function [array:members] decomposes an array to a sequence of value records.
The function [array:of-members] composes an array from a sequence of value records.</p>
</blockquote>
<p>and the spec for array:values doesn't conform to this guideline.</p>
<p>Try:</p>
<p>The function returns the sequence-concatenation of the members of $array, retaining order. More formally, the effect of the function is equivalent to the expression <code>array:members($array)?value</code>.</p>
<p>and add to the notes:</p>
<p>Unlike array:flatten, the function does not apply recursively to nested arrays.</p>
</div></details></div>
<div class="toot" id="created-1085"><h2>Issue #1085 created<span class="toot-id"> #created-1085</span></h2><div class="pubdate">14 Mar at 22:07:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1085">https://github.com/qt4cg/qtspecs/issues/1085</a></div><details><summary>Parameters to fn:sort</summary><div class="markup"><p>An interesting suggestion made in passing in the thread discussing fn:ranks(). It would be possible to combine the <code>collation</code> argument and the <code>ascending/descending</code> argument of <code>fn:sort</code> into a single argument, whose value is an optional "ascending|descending" keyword followed by an optional collation URI (whitespace-separated, presumably).</p>
<p>This might seem a little bizarre at first sight, but having a list of collation URIs followed by a list of sort key functions followed by a list of ascending/descending keywords is also a little bizarre, and it would have two advantages - it would make better use of the second argument which is currently nearly always set to <code>()</code>, and it would put the two parts of the order specification (the collation and its direction) in closer proximity. After all, they are used in combination to decide whether one value precedes or follows another.</p>
<p>I'm not 100% convinced by the idea, but it seems worth considering. What do people think?</p>
</div></details></div>
<div class="toot" id="created-1084"><h2>Issue #1084 created<span class="toot-id"> #created-1084</span></h2><div class="pubdate">13 Mar at 18:29:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1084">https://github.com/qt4cg/qtspecs/issues/1084</a></div><details><summary>Incorrect rendition of option defaults</summary><div class="markup"><p>In the F&amp;O spec, when rendering the default value of an option, code font is being used for narrative prose: see for example defaults for the <code>delivery-format</code> and <code>base-output-uri</code> options of <code>fn:transform</code></p>
</div></details></div>
<div class="toot" id="created-1083"><h2>Pull request #1083 created<span class="toot-id"> #created-1083</span></h2><div class="pubdate">13 Mar at 17:58:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1083">https://github.com/qt4cg/qtspecs/pull/1083</a></div><details><summary>1079 Change book used in example</summary><div class="markup"><p>Changed the example to a book by a reputable author.</p>
<p>Fix #1079</p>
</div></details></div>
<div class="toot" id="created-1082"><h2>Issue #1082 created<span class="toot-id"> #created-1082</span></h2><div class="pubdate">13 Mar at 17:35:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1082">https://github.com/qt4cg/qtspecs/issues/1082</a></div><details><summary>Inconsistency in underscore in numeric literal grammar</summary><div class="markup"><p><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-numeric-literals">Numeric Literals</a> describes permitting underscores to be used as separators in sequences of digits within long numbers. The first interpretation rule says underscores are first stripped out.</p>
<p>But the grammar provided appears to me to be inconsistent.</p>
<pre><code>IntegerLiteral	   ::=   	Digits
DecimalLiteral	   ::=   	("." Digits) | (Digits "." [0-9]*)
DoubleLiteral	   ::=   	(("." Digits) | (Digits ("." [0-9]*)?)) [eE] [+-]? Digits
Digits	           ::=   	DecDigit ((DecDigit | "_")* DecDigit)?
DecDigit	   ::=   	[0-9]
</code></pre>
<p><code>Digits</code> permits underscores in the grammar, which works in the integer portion of the numeric literal, but when the value exceeds 1 the fractional part is described as <code>[0-9]*</code>. If underscore stripping is a 'pre-parsing' step, then <code>Digits</code> need not mention it at all.</p>
<p>On the other hand if the grammar is defining the sequence of characters that are permitted, then the fractional section in the grammar should also permit underscores, which it plainly does not in the presence of an integer part. (The test <code>seconds-010</code> uses such in an expansion of π.)</p>
<p>An alternative formulation that I think does describe underscores in fractional parts might be:</p>
<pre><code> DecimalLiteral	   ::=   	("." Digits) | (Digits "." Digits?) 
</code></pre>
<p>and similarly for <code>DoubleLiteral</code>. I know this isn't a game-changer, but for those generating grammars, consistency certainly helps.</p>
</div></details></div>
<div class="toot" id="created-1081"><h2>Pull request #1081 created<span class="toot-id"> #created-1081</span></h2><div class="pubdate">13 Mar at 16:26:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1081">https://github.com/qt4cg/qtspecs/pull/1081</a></div><details><summary>1050 Fix ItemType grammar ambiguity</summary><div class="markup"><p>Two alternatives in the grammar were both EQNames, distinguished semantically. This ambiguity in the grammar is now fixed (no living XPath expressions are harmed by this change).</p>
<p>Fix #1050</p>
</div></details></div>
<div class="toot" id="created-1080"><h2>Pull request #1080 created<span class="toot-id"> #created-1080</span></h2><div class="pubdate">13 Mar at 15:42:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1080">https://github.com/qt4cg/qtspecs/pull/1080</a></div><details><summary>1036 Rephrase the rules for number-parser with liberal JSON</summary><div class="markup"><p>Rephrasing as suggested in the issue.</p>
<p>Fix #1036</p>
</div></details></div>
<div class="toot" id="created-1079"><h2>Issue #1079 created<span class="toot-id"> #created-1079</span></h2><div class="pubdate">13 Mar at 14:45:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1079">https://github.com/qt4cg/qtspecs/issues/1079</a></div><details><summary>Editorial: XSLT, Applying Template Rules, Examples</summary><div class="markup"><p>This guy is all around. Do we really need him in our specs as well? 😏</p>
<p>https://qt4cg.org/pr/1078/xslt-40/Overview.html#applying-templates</p>
<pre><code class="language-xquery">  "Title": "How to Win Elections",
  "Authors": [ "...
</code></pre>
</div></details></div>
<div class="toot" id="created-1078"><h2>Pull request #1078 created<span class="toot-id"> #created-1078</span></h2><div class="pubdate">13 Mar at 14:20:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1078">https://github.com/qt4cg/qtspecs/pull/1078</a></div><details><summary>1060 Formatting XPath/XQuery</summary><div class="markup"><p>Editorial; closes #1060.</p>
<p>This PR attempts to unify the presentation of XPath and XQuery code. It’s not complete, but it should definitely improve the status quo.</p>
<p>The chosen formatting and indentation rules can certainly be discussed. My major objective was consistency: I selected rules that were used frequently enough in the given documents.</p>
<p>Apart from the presentation stuff, this PR fixes various minor bugs in the rules and examples.</p>
</div></details></div>
<div class="toot" id="created-1077"><h2>Pull request #1077 created<span class="toot-id"> #created-1077</span></h2><div class="pubdate">13 Mar at 12:50:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1077">https://github.com/qt4cg/qtspecs/pull/1077</a></div><details><summary>Correct the status of new language features</summary><div class="markup"><p>This PR corrects the status of certain language features that the change appendix in the spec incorrectly describes as having not been accepted by the WG., The features in question are:</p>
<blockquote>
<p>The rules for reporting type errors during static analysis have been changed
so that a processor has more freedom to report errors in respect of constructs that
are evidently wrong, such as <code>@price/@value</code>, even though dynamic evaluation
is defined to return an empty sequence rather than an error.</p>
</blockquote>
<p>This change has in fact been discussed and accepted by the group.  See PRs #603 and #884.</p>
<blockquote>
<pre><code>Record types are added as a new kind of ItemType, constraining
  the value space of maps.
</code></pre>
</blockquote>
<p>Record types have become a fundamental feature of much of our work, with many additional capabilities relying on them. They became an official part of the spec with the closure of issue #172.</p>
<blockquote>
<pre><code>Local union types are added as a new kind of ItemType, constraining
  the value space of atomic values.
</code></pre>
</blockquote>
<blockquote>
<p>Enumeration types are added as a new kind of <code>ItemType</code>, constraining
the value space of strings.</p>
</blockquote>
<p>Local union types and enumeration types became an official part of the spec with the acceptance of PR #691</p>
<blockquote>
<p>The lookup operator <code>?</code> can now be followed by a string literal, for cases where
map keys are strings other than NCNames.</p>
</blockquote>
<p>These changes were endorsed by acceptance of PR #926.</p>
<blockquote>
<p>The rules for value comparisons when comparing values of different types (for example, decimal and double)
have changed to be transitive. A decimal value is no longer converted to double, instead the double is converted
to a decimal without loss of precision. This may affect compatibility in edge cases involving comparison of
values that are numerically very close.</p>
</blockquote>
<p>We still have open issues regarding comparison, conversion, and promotion of numeric values. See for example issue #986. So we may yet decide to roll back these changes. For practical purposes it's sensible to treat the current text as status quo, since so many individual changes have been made that unwinding can only be treated as a new issue.</p>
<blockquote>
<p>A <code>for member</code> clause is added to FLWOR expressions to allow iteration over
an array.</p>
</blockquote>
<p>The current specification of <code>for member</code> results from the acceptance of PR #752.</p>
</div></details></div>
<div class="toot" id="created-1076"><h2>Pull request #1076 created<span class="toot-id"> #created-1076</span></h2><div class="pubdate">13 Mar at 12:02:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1076">https://github.com/qt4cg/qtspecs/pull/1076</a></div><details><summary>1075 Drop 'with' expressions</summary><div class="markup"><p>Proposes dropping "with" expressions from the spec.</p>
<p>Fix #1075</p>
</div></details></div>
<div class="toot" id="created-1075"><h2>Issue #1075 created<span class="toot-id"> #created-1075</span></h2><div class="pubdate">13 Mar at 11:50:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1075">https://github.com/qt4cg/qtspecs/issues/1075</a></div><details><summary>Drop "with" expressions</summary><div class="markup"><p>The current draft includes a proposal for a "with" expression to establish the namespace context for an XPath expression. This has never been reviewed or accepted by the group. See §4.1 of the language specifications.</p>
<p>I propose to raise a PR that drops this feature, in order to force discussion as to whether we want it in its current form, or to replace it with something better, or to drop it entirely.</p>
</div></details></div>
<div class="toot" id="created-1074"><h2>Pull request #1074 created<span class="toot-id"> #created-1074</span></h2><div class="pubdate">13 Mar at 11:42:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1074">https://github.com/qt4cg/qtspecs/pull/1074</a></div><details><summary>Confirm status of provisional functions</summary><div class="markup"><p>The purpose of this PR is to bring the current F&amp;O draft specification into a state where it is confirmed as the current status quo accepted by the CG.</p>
<p>The following functions (mainly new, some amended) that have been present in the draft for some while, but with caveats about their status, are confirmed as part of the status quo:</p>
<ul>
<li>fn:slice</li>
<li>fn:format-number</li>
<li>fn:stack-trace</li>
<li>map:filter</li>
<li>map:replace</li>
<li>array:replace</li>
</ul>
<p>The following functions are dropped (for the time being):</p>
<ul>
<li>fn:json</li>
<li>map:substitute</li>
</ul>
<p>The actual PR essentially changes text that alludes to the status of these functions, it does not change the actual specifications.</p>
<p>The current state of qt4tests in relation to these functions is:</p>
<p>fn:slice - OK
fn:format-number - missing tests for recent changes
fn:stack-trace - no tests
map:filter - OK
map:replace - no tests
array:replace - no tests
fn:json - no tests
map:substitute - no tests</p>
</div></details></div>
<div class="toot" id="created-1073"><h2>Pull request #1073 created<span class="toot-id"> #created-1073</span></h2><div class="pubdate">13 Mar at 09:01:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1073">https://github.com/qt4cg/qtspecs/pull/1073</a></div><details><summary>XQFO (editorial)</summary><div class="markup"><p>Examples fixed.</p>
</div></details></div>
<div class="toot" id="created-1072"><h2>Pull request #1072 created<span class="toot-id"> #created-1072</span></h2><div class="pubdate">13 Mar at 00:51:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1072">https://github.com/qt4cg/qtspecs/pull/1072</a></div><details><summary>883 Return type of load-xquery-module</summary><div class="markup"><p>Use a record type for the return type of the function.</p>
<p>Fix #883</p>
</div></details></div>
<div class="toot" id="created-1071"><h2>Pull request #1071 created<span class="toot-id"> #created-1071</span></h2><div class="pubdate">12 Mar at 22:10:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1071">https://github.com/qt4cg/qtspecs/pull/1071</a></div><details><summary>1070 Bare Brace map constructor syntax</summary><div class="markup"><p>Makes the keyword "map" in map constructors optional.</p>
<p>Fix #1070</p>
</div></details></div>
<div class="toot" id="minutes-03-12"><h2>QT4 CG meeting 069 draft minutes<span class="toot-id"> #minutes-03-12</span></h2><div class="pubdate">12 Mar at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/03-12">https://qt4cg.org/meeting/minutes/2024/03-12</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-220"><h2>Issue #220 closed<span class="toot-id"> #closed-220</span></h2><div class="pubdate">12 Mar at 17:18:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/220">https://github.com/qt4cg/qtspecs/issues/220</a></div><p>Encapsulation</p></div>
<div class="toot" id="closed-262"><h2>Issue #262 closed<span class="toot-id"> #closed-262</span></h2><div class="pubdate">12 Mar at 17:18:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/262">https://github.com/qt4cg/qtspecs/issues/262</a></div><p>Navigation in deep-structured arrays</p></div>
<div class="toot" id="closed-274"><h2>Issue #274 closed<span class="toot-id"> #closed-274</span></h2><div class="pubdate">12 Mar at 17:17:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/274">https://github.com/qt4cg/qtspecs/issues/274</a></div><p>What would it take/would it be possible to build a module repository for QT?</p></div>
<div class="toot" id="closed-295"><h2>Issue #295 closed<span class="toot-id"> #closed-295</span></h2><div class="pubdate">12 Mar at 17:17:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/295">https://github.com/qt4cg/qtspecs/issues/295</a></div><p>Extend support for self-reference in record types</p></div>
<div class="toot" id="closed-314"><h2>Issue #314 closed<span class="toot-id"> #closed-314</span></h2><div class="pubdate">12 Mar at 17:17:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/314">https://github.com/qt4cg/qtspecs/issues/314</a></div><p>Basic Operations on Maps and Arrays</p></div>
<div class="toot" id="closed-825"><h2>Issue #825 closed<span class="toot-id"> #closed-825</span></h2><div class="pubdate">12 Mar at 17:17:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/825">https://github.com/qt4cg/qtspecs/issues/825</a></div><p>array:members-at</p></div>
<div class="toot" id="closed-829"><h2>Issue #829 closed<span class="toot-id"> #closed-829</span></h2><div class="pubdate">12 Mar at 17:17:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/829">https://github.com/qt4cg/qtspecs/issues/829</a></div><p>fn:boolean: EBV support for more item types</p></div>
<div class="toot" id="closed-960"><h2>Issue #960 closed<span class="toot-id"> #closed-960</span></h2><div class="pubdate">12 Mar at 17:17:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/960">https://github.com/qt4cg/qtspecs/issues/960</a></div><p>Should ??KS flatten the results</p></div>
<div class="toot" id="closed-961"><h2>Issue #961 closed<span class="toot-id"> #closed-961</span></h2><div class="pubdate">12 Mar at 17:17:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/961">https://github.com/qt4cg/qtspecs/issues/961</a></div><p>Simulating Objects: Performance</p></div>
<div class="toot" id="closed-1037"><h2>Issue #1037 closed<span class="toot-id"> #closed-1037</span></h2><div class="pubdate">12 Mar at 17:16:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1037">https://github.com/qt4cg/qtspecs/issues/1037</a></div><p>fn:json-to-xml: 'number-parser' option</p></div>
<div class="toot" id="closed-1058"><h2>Issue #1058 closed<span class="toot-id"> #closed-1058</span></h2><div class="pubdate">12 Mar at 17:15:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1058">https://github.com/qt4cg/qtspecs/pull/1058</a></div><p>1037 fn:json-to-xml: 'number-parser' option</p></div>
<div class="toot" id="agenda-03-12"><h2>QT4 CG meeting 069 draft agenda<span class="toot-id"> #agenda-03-12</span></h2><div class="pubdate">11 Mar at 14:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/03-12">https://qt4cg.org/meeting/agenda/2024/03-12</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1070"><h2>Issue #1070 created<span class="toot-id"> #created-1070</span></h2><div class="pubdate">08 Mar at 23:10:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1070">https://github.com/qt4cg/qtspecs/issues/1070</a></div><details><summary>Concise syntax for map construction</summary><div class="markup"><p>It has been suggested that we should allow a "bare braces" syntax for map construction. This would reduce visual clutter especially when defining options arguments, as in</p>
<p><code>serialize($result, map{"method": "adaptive", "indent": true()})</code></p>
<p>I believe there are no syntactic obstacles to dropping the "map" keyword. The main reason it is there was because there was competition for the construct with people doing so-called scripting extensions who wanted "bare braces" to represent blocks of statements.</p>
<p>Allowing <code>{"method": "adaptive"}</code> would align with JSON.</p>
<p>But I think we should go a step further and drop the quotes:</p>
<p><code>{method: "adaptive"}</code></p>
<p>except that we could allow a string literal if the key isn't an NCName, as with record type syntax.</p>
<p>Could we do this and still allow computed or non-string keys? I don't think we need to, the existing syntax remains available.</p>
<p>So I propose we allow:</p>
<p><code>serialize($result, {method: "adaptive", indent: true()})</code></p>
<p>While we're about it, is there any enthusiasm for allowing</p>
<p><code>serialize($result, {method: "adaptive", indent: ✅})</code>  (: U+2705 :)</p>
</div></details></div>
<div class="toot" id="closed-596"><h2>Issue #596 closed<span class="toot-id"> #closed-596</span></h2><div class="pubdate">08 Mar at 22:45:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/596">https://github.com/qt4cg/qtspecs/issues/596</a></div><p>Pinned values: Transforming Trees</p></div>
<div class="toot" id="created-1069"><h2>Issue #1069 created<span class="toot-id"> #created-1069</span></h2><div class="pubdate">08 Mar at 03:58:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1069">https://github.com/qt4cg/qtspecs/issues/1069</a></div><details><summary>fn:ucd</summary><div class="markup"><p>This issue floats the idea of a new function, <code>fn:ucd</code> (for Unicode character database).</p>
<p>The working signature would be <code>fn:ucd($codepoint as xs:positiveInteger) as map(*)?</code>.  In the returned map, each entry would have a key that is a Unicode property name (full or abbreviated) and a value that reflects the property of <code>$character</code> in the Unicode character database.</p>
<p>What would users get? Access to a deep store of character data not otherwise (easily) available, such as name, name alias, bidirectional properties, age (when it entered Unicode), breaks (word, sentence, grapheme), scripts, and dozens of other properties. See <a href="https://www.unicode.org/reports/tr44/#Property_Index">Unicode TR 44</a>. Although many properties are of specialized interest, I think most people would find at least a few of these properties of significance.</p>
<p>Can't we already do this with regular expressions? Well, no. Category escapes in XPath regular expressions, e.g., <code>\p{Lm}</code>, are based upon general categories, but the properties mentioned above cut across these general categories. For example, general category <code>Pd</code> dash is not coterminous with the property <code>Dash</code>. Property <code>Quotation_Mark</code> crosses many subcategories of <code>P</code> Punctuation.</p>
<p>A few use cases:</p>
<p><strong>Extrapolation</strong>
<code>string-to-codepoints('ɑϞ') ! ('U+' || dec-to-hex(.) || ': ' || ucd(.)('Name'))</code> would return <code>('U+251: LATIN SMALL LETTER ALPHA', 'U+3DE: GREEK LETTER KOPPA')</code></p>
<p><strong>Filtering</strong>
<code>if (some $i in string-to-codepoints($text) satisfies ucd($i)('Soft_Dotted')) then...</code></p>
<p><strong>Annotating</strong></p>
<pre><code>&lt;div class="{myfunc:most-frequent((string-to-codepoints($text) ! ucd(.)('Script')))}"&gt;
    &lt;xsl:value-of select="$text"/&gt;
&lt;/div&gt;
</code></pre>
<p>might produce</p>
<pre><code>&lt;div class="Syriac"&gt;ܡܠܟܘܬܐ ܕܫܡܝܐ ܐܝܬܝܗ̇. ܠܐ ܚܫܘܫܘܬܐ ܕܢܦܫܐ܆ ܥܡ ܝܕܥܬܐ ܕܫܪܪܐ ܕܗܠܝܢ ܕܐܝܬܝܗܝܢ&lt;/div&gt;
</code></pre>
<p>And so forth. I can think of dozens of different types of operations where <code>fn:ucd</code> might be significant.</p>
<p>Thoughts?</p>
</div></details></div>
<div class="toot" id="created-1068"><h2>Pull request #1068 created<span class="toot-id"> #created-1068</span></h2><div class="pubdate">08 Mar at 01:51:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1068">https://github.com/qt4cg/qtspecs/pull/1068</a></div><details><summary>73 fn:graphemes</summary><div class="markup"><p>First draft of <code>fn:graphemes</code>, in response to discussion at #73 .</p>
<p>A battery of tests will be submitted as a PR to the qt4tests repository.</p>
</div></details></div>
<div class="toot" id="closed-1067"><h2>Issue #1067 closed<span class="toot-id"> #closed-1067</span></h2><div class="pubdate">07 Mar at 13:48:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1067">https://github.com/qt4cg/qtspecs/issues/1067</a></div><p>fn:deep-equal: significant children</p></div>
<div class="toot" id="created-1067"><h2>Issue #1067 created<span class="toot-id"> #created-1067</span></h2><div class="pubdate">07 Mar at 12:22:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1067">https://github.com/qt4cg/qtspecs/issues/1067</a></div><details><summary>fn:deep-equal: significant children</summary><div class="markup"><p>The current rules of <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-deep-equal">fn:deep-equal</a> are:</p>
<blockquote>
<p>e. Let <code>significant-children($parent)</code> be the sequence of nodes obtained by applying the following steps to the children of <code>$parent</code>, in turn:
&nbsp;&nbsp;i. Comment nodes are discarded if the option <code>comments</code> is false.
&nbsp;&nbsp;ii. Processing instruction nodes are discarded if the option <code>processing-instructions</code> is false.
&nbsp;&nbsp;iii. Adjacent text nodes are merged.
…
…the sequence <code>significant-children($i1)</code> is deep-equal to the sequence <code>significant-children($i2)</code>.</p>
</blockquote>
<p>If my interpretation is correct, the following expression is now expected to return <code>true</code>…</p>
<pre><code class="language-xquery">deep-equal(
  &lt;e&gt;A&lt;!----&gt;B&lt;/e&gt;,
  &lt;e&gt;AB&lt;/e&gt;
)
</code></pre>
<p>…and we need to update various test cases (e.g. <a href="https://github.com/qt4cg/qt4tests/blob/af7640a513bd7bda9f301a0cc8334a58bb5ea78e/fn/deep-equal.xml#L2390-L2398">K2-SeqDeepEqualFunc-22</a>).</p>
</div></details></div>
<div class="toot" id="created-1066"><h2>Pull request #1066 created<span class="toot-id"> #created-1066</span></h2><div class="pubdate">06 Mar at 22:03:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1066">https://github.com/qt4cg/qtspecs/pull/1066</a></div><details><summary>1052 Simplify the results of parse-csv</summary><div class="markup"><p>Changes parse-csv to deliver the results in a simpler format:</p>
<p>(a) the result structure is less deeply nested: one record with four entries
(b) the actual data is delivered as a sequence of arrays of strings, closely aligned with the result of <code>csv-to-arrays</code></p>
<p>The rules in the spec have also been rearranged to reflect this, so the rules are now organised according to the values delivered for each of these four fields.</p>
<p>The examples in the spec are changed to reflect the new output format; in addition they have been editorially reorganized so each example is more self-contained, avoiding the need for extensive scrolling to find the values of variables referenced in each example.</p>
<p>Fix issue #1052</p>
</div></details></div>
<div class="toot" id="created-1065"><h2>Issue #1065 created<span class="toot-id"> #created-1065</span></h2><div class="pubdate">06 Mar at 12:34:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1065">https://github.com/qt4cg/qtspecs/issues/1065</a></div><details><summary>fn:format-number: further notes</summary><div class="markup"><p>This issue summarizes suggestions for <code>fn:format-number</code> from the <a href="https://qt4cg.org/meeting/minutes/2024/03-05.html">QT4 Meeting 068</a> that have not yet been incorporated into the current draft:</p>
<ol>
<li>The <a href="https://cldr.unicode.org/translation/number-currency-formats/number-and-currency-patterns">Unicode Common Locale Data Repository</a> (CLDR) should be referenced; it has recommendations for all of the languages in Unicode and some variants.</li>
<li>We could consider introducing an options map so that we can just add more things later (such as e.g. an option for using the default decimal format for parsing the picture string, see https://github.com/qt4cg/qtspecs/issues/1048#issuecomment-1978869499).</li>
</ol>
</div></details></div>
<div class="toot" id="closed-919"><h2>Issue #919 closed<span class="toot-id"> #closed-919</span></h2><div class="pubdate">06 Mar at 12:06:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/919">https://github.com/qt4cg/qtspecs/issues/919</a></div><p>Should predicate callbacks use EBV?</p></div>
<div class="toot" id="closed-944"><h2>Issue #944 closed<span class="toot-id"> #closed-944</span></h2><div class="pubdate">06 Mar at 12:04:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/944">https://github.com/qt4cg/qtspecs/issues/944</a></div><p>Coercion rules: implicit types</p></div>
<div class="toot" id="closed-1047"><h2>Issue #1047 closed<span class="toot-id"> #closed-1047</span></h2><div class="pubdate">06 Mar at 12:02:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1047">https://github.com/qt4cg/qtspecs/issues/1047</a></div><p>Incorrect note for `fn:some` and `fn:every`</p></div>
<div class="toot" id="closed-1064"><h2>Issue #1064 closed<span class="toot-id"> #closed-1064</span></h2><div class="pubdate">06 Mar at 09:56:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1064">https://github.com/qt4cg/qtspecs/pull/1064</a></div><p>340-editorial fn:format-number</p></div>
<div class="toot" id="created-1064"><h2>Pull request #1064 created<span class="toot-id"> #created-1064</span></h2><div class="pubdate">06 Mar at 09:56:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1064">https://github.com/qt4cg/qtspecs/pull/1064</a></div><details><summary>340-editorial fn:format-number</summary><div class="markup"><p>…an addendum to the editorial change I made yesterday; will be merged in a minute.</p>
</div></details></div>
<div class="toot" id="closed-1054"><h2>Issue #1054 closed<span class="toot-id"> #closed-1054</span></h2><div class="pubdate">06 Mar at 09:45:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1054">https://github.com/qt4cg/qtspecs/issues/1054</a></div><p>Spec fn:message #id using old name fn:log</p></div>
<div class="toot" id="closed-1057"><h2>Issue #1057 closed<span class="toot-id"> #closed-1057</span></h2><div class="pubdate">06 Mar at 09:45:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1057">https://github.com/qt4cg/qtspecs/pull/1057</a></div><p>1054 Spec fn:message #id using old name fn:log</p></div>
<div class="toot" id="created-1063"><h2>Issue #1063 created<span class="toot-id"> #created-1063</span></h2><div class="pubdate">05 Mar at 23:20:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1063">https://github.com/qt4cg/qtspecs/issues/1063</a></div><details><summary>deep-equal() - option to compare functions liberally</summary><div class="markup"><p>We have changed deep-equal() so it no longer automatically treats functions as not equal.</p>
<p>However, it is still in practice infeasible to use deep-equal() for comparison of test results that include function items because it is not in general possible to supply an expected result that compares true to the function item actually returned. Since comparison of test results is an important use case for deep-equal, this is a serious limitation. It affects our own process that checks that output from examples in the spec is correct: the examples for parse-csv, for example, are artificially adjusted to make test comparison feasible by eliminating the function items in the result, which reduces the pedagogical value of the examples.</p>
<p>There should be an option such as <code>strict-function-comparison=true|false</code>. If set to false, then the function properties such as name, arity, and signature are compared, but the function body is ignored and assumed equal.</p>
</div></details></div>
<div class="toot" id="minutes-03-05"><h2>QT4 CG meeting 068 draft minutes<span class="toot-id"> #minutes-03-05</span></h2><div class="pubdate">05 Mar at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/03-05">https://qt4cg.org/meeting/minutes/2024/03-05</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1053"><h2>Issue #1053 closed<span class="toot-id"> #closed-1053</span></h2><div class="pubdate">05 Mar at 17:19:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1053">https://github.com/qt4cg/qtspecs/pull/1053</a></div><p>1047 Default predicate for some#1 and every#1</p></div>
<div class="toot" id="closed-1046"><h2>Issue #1046 closed<span class="toot-id"> #closed-1046</span></h2><div class="pubdate">05 Mar at 17:16:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1046">https://github.com/qt4cg/qtspecs/pull/1046</a></div><p>1038 take-while predicate no longer uses EBV</p></div>
<div class="toot" id="closed-413"><h2>Issue #413 closed<span class="toot-id"> #closed-413</span></h2><div class="pubdate">05 Mar at 17:14:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/413">https://github.com/qt4cg/qtspecs/issues/413</a></div><p>New function: parse-csv()</p></div>
<div class="toot" id="closed-1017"><h2>Issue #1017 closed<span class="toot-id"> #closed-1017</span></h2><div class="pubdate">05 Mar at 17:13:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1017">https://github.com/qt4cg/qtspecs/issues/1017</a></div><p>Change csv-to-xml() to produce an XHTML table</p></div>
<div class="toot" id="closed-1043"><h2>Issue #1043 closed<span class="toot-id"> #closed-1043</span></h2><div class="pubdate">05 Mar at 17:13:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1043">https://github.com/qt4cg/qtspecs/issues/1043</a></div><p>CSV parsing - "blank" rows</p></div>
<div class="toot" id="closed-1051"><h2>Issue #1051 closed<span class="toot-id"> #closed-1051</span></h2><div class="pubdate">05 Mar at 17:13:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1051">https://github.com/qt4cg/qtspecs/pull/1051</a></div><p>1043 Clarification of CSV edge cases</p></div>
<div class="toot" id="closed-340"><h2>Issue #340 closed<span class="toot-id"> #closed-340</span></h2><div class="pubdate">05 Mar at 17:08:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/340">https://github.com/qt4cg/qtspecs/issues/340</a></div><p>fn:format-number: Specifying decimal format</p></div>
<div class="toot" id="closed-1049"><h2>Issue #1049 closed<span class="toot-id"> #closed-1049</span></h2><div class="pubdate">05 Mar at 17:00:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1049">https://github.com/qt4cg/qtspecs/pull/1049</a></div><p>340-partial fn:format-number: Specifying decimal format</p></div>
<div class="toot" id="closed-1061"><h2>Issue #1061 closed<span class="toot-id"> #closed-1061</span></h2><div class="pubdate">05 Mar at 12:54:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1061">https://github.com/qt4cg/qtspecs/issues/1061</a></div><p>discussion - language pragmas</p></div>
<div class="toot" id="created-1062"><h2>Pull request #1062 created<span class="toot-id"> #created-1062</span></h2><div class="pubdate">05 Mar at 12:05:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1062">https://github.com/qt4cg/qtspecs/pull/1062</a></div><details><summary>150bis revised proposal for fn:ranks</summary><div class="markup"><p>This proposal is an amended/alternative proposal for the fn:ranks function, taking into account the work done on the original issue #150 and the PR #1027 and the comments raised. Acknowledgements to the original author for the idea and for a lot of good work on examples etc.</p>
<p>It amends the previous proposal as follows:</p>
<p>(a) the signature and the semantics are aligned with fn:sort. This adds some functionality (multiple sort keys, ascending/descending) and also removes some complexity (two different collations for comparing input items and result items)</p>
<p>(b) the style of exposition is changed editorially for consistency with other functions</p>
</div></details></div>
<div class="toot" id="created-1061"><h2>Issue #1061 created<span class="toot-id"> #created-1061</span></h2><div class="pubdate">05 Mar at 10:10:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1061">https://github.com/qt4cg/qtspecs/issues/1061</a></div><details><summary>discussion - language pragmas</summary><div class="markup"><p>The motivation is introducing breaking changes into the language that may have value, but not enough value to justify a breaking change.</p>
<p>Haskell uses language pragmas for this, and actually most (well, a lot) Haskell code does not use the base specification, and quite common constructs (GADTs, multi param type classes) require extensions.</p>
<p>Haskell devs are used to this, it may require some referring to the the top of the file to change the pragmas but its a working solution to introducing optional things that may be breaking changes.</p>
<p>Thoughts?</p>
<p>Benefits</p>
<ul>
<li>allows breaking changes to be introduced</li>
</ul>
<p>Costs</p>
<ul>
<li>developers may have to refer to the language pragma to correctly understand the code</li>
<li>implementation explosion, extensions may not be independent and interact causing an explosion of combinations of extensions (though i think its reasonable for an implementation to just implement combinations that are practical).</li>
</ul>
<p>I'm biased, I want to introduce breaking changes, but am thwarted by the versioning strategy.</p>
</div></details></div>
<div class="toot" id="created-1060"><h2>Issue #1060 created<span class="toot-id"> #created-1060</span></h2><div class="pubdate">04 Mar at 17:57:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1060">https://github.com/qt4cg/qtspecs/issues/1060</a></div><details><summary>Formatting XPath/XQuery</summary><div class="markup"><p>I got reminded today that the specification documents are kind of “wild”, because all code snippets use a different formatting:</p>
<ul>
<li>The indentation is inconsistent (the tendency seems to be 2 spaces, in accordance with the function signatures). Repeatedly, indentations are used that don’t seem to follow any conventions at all.</li>
<li>Sometimes, <code>function</code>, <code>map</code> and <code>array</code> keywords are followed by a space, sometimes not. My preference would be not be too stingy; we have enough space.</li>
<li>Sometimes, the <code>return</code> keyword starts in a new line, sometimes it’s attached to the previous line.</li>
</ul>
<p>This is certainly something we cannot finalize too early, but I think we shouldn’t be too erratic in an official document, even though it’s “just code”.</p>
<p>Related: #1000.</p>
</div></details></div>
<div class="toot" id="created-1059"><h2>Pull request #1059 created<span class="toot-id"> #created-1059</span></h2><div class="pubdate">04 Mar at 15:32:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1059">https://github.com/qt4cg/qtspecs/pull/1059</a></div><details><summary>1019 XQFO: Unknown option parameters</summary><div class="markup"><p>Issue: #1019</p>
</div></details></div>
<div class="toot" id="created-1058"><h2>Pull request #1058 created<span class="toot-id"> #created-1058</span></h2><div class="pubdate">04 Mar at 14:37:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1058">https://github.com/qt4cg/qtspecs/pull/1058</a></div><details><summary>1037 fn:json-to-xml: 'number-parser' option</summary><div class="markup"><p>Issue: #1037</p>
</div></details></div>
<div class="toot" id="created-1057"><h2>Pull request #1057 created<span class="toot-id"> #created-1057</span></h2><div class="pubdate">04 Mar at 14:31:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1057">https://github.com/qt4cg/qtspecs/pull/1057</a></div><details><summary>1054 Spec fn:message #id using old name fn:log</summary><div class="markup"><p>Issue: #1054</p>
</div></details></div>
<div class="toot" id="closed-1056"><h2>Issue #1056 closed<span class="toot-id"> #closed-1056</span></h2><div class="pubdate">04 Mar at 12:30:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1056">https://github.com/qt4cg/qtspecs/issues/1056</a></div><p>Simplifying match templates</p></div>
<div class="toot" id="created-1056"><h2>Issue #1056 created<span class="toot-id"> #created-1056</span></h2><div class="pubdate">01 Mar at 13:53:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1056">https://github.com/qt4cg/qtspecs/issues/1056</a></div><details><summary>Simplifying match templates</summary><div class="markup"><p>I like match templates a lot, I think they are a USP for XSLT, but I find using them quite clumsy e.g.</p>
<ul>
<li>priority rules are quite subtle (I couldn't tell you what they are not, and I tend to make them explicit)</li>
<li>because each match sits in a different template they tend to sort of drift around in the spaghetti of the code</li>
<li>they don't naturally extend to nested local matches....everything exists at the top level.</li>
</ul>
<p>If you compare this with main stream functional match expressions then they are quite syntactically different, and I think the mainstream syntax is probably a bit simpler (and much more familiar)
(I can see this potentially extending to lots of subsequent things but I'll keep it to the headline)</p>
<p>I think something like</p>
<pre><code>&lt;xsl:template mode="foo" as="xs:string"&gt;
    &lt;xsl:match select="Foo"&gt;
        &lt;xsl:sequence select="'this is a foo'"/&gt;
    &lt;/xsl:match&gt;
    &lt;xsl:match select="Bar"&gt;
        &lt;xsl:sequence select="'this is a bar'"/&gt;
    &lt;/xsl:match&gt;
    &lt;xsl:match&gt;
        &lt;xsl:sequence select="'this is something else'"/&gt;
    &lt;/xsl:match&gt;
&lt;/xsl:template&gt;
</code></pre>
<ul>
<li>templates are matched in sequence (as is the norm), no opaque priority rules</li>
<li>if nothing is matched then nothing is returned...I have effectively a catchall match above.</li>
<li>everything is cohesive, the template contains all matches....no secret ones hidden at the bottom of the file.</li>
</ul>
<p>there's lots of holes here,</p>
<ul>
<li>how does this interact with existing match templates?</li>
<li>are the a different syntax for the same thing?</li>
<li>how do they work with includes and imports?</li>
</ul>
<p>my guesses are...they ARE just different syntax for the existing infrastructure...because thats the smallest change.
and then the other questions are answered by how the above syntax maps into "priority" but tbh, as I barely know how the current priority rules work, I can't really give a sensible guess.</p>
<p>tbh, if this is just different syntax then secret matches CAN exist elsewhere in the spaghetti, but at least the programmer does have a construct to not do that, rather than the default contract to lack cohesion from the outset.</p>
</div></details></div>
<div class="toot" id="created-1055"><h2>Issue #1055 created<span class="toot-id"> #created-1055</span></h2><div class="pubdate">01 Mar at 13:20:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1055">https://github.com/qt4cg/qtspecs/issues/1055</a></div><details><summary>xsl:variable/@as - simplifying the language - attempt 2</summary><div class="markup"><p>I've thought about it.</p>
<p>The key issue I had which genuinely caused me years of confusion (I didnt understand it so I ignored it, and dealt with it by typeing random xslt code)....this....</p>
<pre><code>            &lt;xsl:variable name="presentationMediaElement" as="element(urn:presentationMedia)"&gt;
                &lt;presentationMedia/&gt;
            &lt;/xsl:variable&gt;
</code></pre>
<p>if I don't declare the "as" then it does something different and confusing (it assumes its a document element <strong>I think</strong>, though I NEVER want it to do this).</p>
<p>so for stylesheets declared as version "4.0"+, can we make the default interpretation of that its an element?</p>
<p>Does this breaks backwards compatability with v1? tbh, the code is already incompatible because the equivalent 1.0 code requires <code>node-set</code>, its already broken, so I suggest making the fix simple to understand.</p>
<p>why is this so irksome to me?
because for me its <strong>incredibly</strong> confusing</p>
<p>its confusing because (and i didnt express this well the last time), it makes a type declaration have inconsistent behaviours.</p>
<p>In languages with OO (is it reynolds?) type systems this also happens  BUT in an OO type system an expression has a type than can be cast to a <strong>subtype</strong> and a subtype is very special because everything that is true of the supertype (in the constained type logic) is true of the subtype (you can express this in terms of set/class membership in a universe if thats how you think about these things).</p>
<p>but in this case, this isnt the case....the two interpretations are disjoint, this isnt a cast.</p>
<p>So the concrete proposal is uniquely define the semantics of.</p>
<pre><code>             &lt;xsl:variable name="presentationMediaElement"&gt;
                &lt;presentationMedia/&gt;
            &lt;/xsl:variable&gt;
</code></pre>
<p>to be</p>
<pre><code>            &lt;xsl:variable name="presentationMediaElement" as="element(urn:presentationMedia)"&gt;
                &lt;presentationMedia/&gt;
            &lt;/xsl:variable&gt;
</code></pre>
<p>from 4.0 onwards.</p>
<p>(ironically, personally i will probably still put the "as" clause in, but if i were trying to learn the language today I'd understand this on day 1, not day 1000).</p>
<p>P.S.</p>
<p>I have a suspicion I still dont fully understand it, but i'm sure someone will point that out in due course.</p>
</div></details></div>
<div class="toot" id="created-1054"><h2>Issue #1054 created<span class="toot-id"> #created-1054</span></h2><div class="pubdate">01 Mar at 10:50:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1054">https://github.com/qt4cg/qtspecs/issues/1054</a></div><details><summary>Spec fn:message #id using old name fn:log</summary><div class="markup"><ul>
<li>https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-message</li>
<li>https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-log</li>
</ul>
</div></details></div>
<div class="toot" id="closed-1018"><h2>Issue #1018 closed<span class="toot-id"> #closed-1018</span></h2><div class="pubdate">29 Feb at 10:11:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1018">https://github.com/qt4cg/qtspecs/issues/1018</a></div><p>Output of parse-csv()</p></div>
<div class="toot" id="created-1053"><h2>Pull request #1053 created<span class="toot-id"> #created-1053</span></h2><div class="pubdate">29 Feb at 10:06:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1053">https://github.com/qt4cg/qtspecs/pull/1053</a></div><details><summary>1047 Default predicate for some#1 and every#1</summary><div class="markup"><p>Changes the default predicate for <code>fn:some#1</code> and <code>fn:every#1</code> to be <code>fn:boolean#1</code>, which takes the EBV of the items in the input sequence. The previous use of <code>fn:identity#1</code> caused some unexpected behaviour.</p>
</div></details></div>
<div class="toot" id="created-1052"><h2>Issue #1052 created<span class="toot-id"> #created-1052</span></h2><div class="pubdate">29 Feb at 08:41:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1052">https://github.com/qt4cg/qtspecs/issues/1052</a></div><details><summary>parse-csv() - simplify output</summary><div class="markup"><p>Currently parse-csv produces a structure like this:</p>
<pre><code>map {
  "columns": map {
      "names": map{"one":1, "two":2},
      "fields": ("one", "two")
   }
  "rows":  (
     map{
        "fields": ("aaa", "bbb"),
        "field" fn($col){$this?fields[$col]}
    },
   map{
        "fields": ("ccc", "ddd"),
        "field" fn($col){$this?fields[$col]}
    }
 )
}
</code></pre>
<p>There are a number of ways this could be improved.</p>
<ul>
<li>The structure is needlessly different from the return value of maps-to-arrays(). Users will get confused between the two representations, and will find it hard to switch from one to the other. For example, one delivers rows as sequences, the other delivers rows as arrays.</li>
<li>There are too many levels in the structure; the expressions to select within it are unnecessarily complicated, and users will get poor diagnostics when they get it wrong.</li>
<li>In this example (with two columns) for each row there is one map, one sequence, one function, and two strings - five values in all. The output of <code>csv-to-arrays</code> has only three objects (one array and two strings). However hard an optimized implementation tries to reduce the overhead, the space occupied by a million-row parsed CSV is likely to be larger than needed.</li>
<li>The use of sequences rather than arrays means that no JSON-serialization of the structure is possible</li>
</ul>
<p>I propose using a flatter structure, like this pseudo-code sketch:</p>
<pre><code>map {
      "column-index": map{"one":1, "two":2},
      "columns": ["one", "two"]
      "rows": (
         ["aaa", "bbb"],
         ["ccc", "ddd"]
     )
     "get": fn($row, $col){$this?rows[$row]($col)}
     "size": fn(){count($this?rows)}
}
</code></pre>
<p>This doesn't meet all the objections outlined above; for example it represents rows as a sequence of arrays, which is consistent with <code>csv-to-arrays</code>, but not JSON-serializable. But I think it's a considerable improvement.</p>
</div></details></div>
<div class="toot" id="created-1051"><h2>Pull request #1051 created<span class="toot-id"> #created-1051</span></h2><div class="pubdate">28 Feb at 23:58:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1051">https://github.com/qt4cg/qtspecs/pull/1051</a></div><details><summary>1043 Clarification of CSV edge cases</summary><div class="markup"><p>Gives a more precise definition of blank rows and empty fields, and generally adds detail on how edge cases should be handled.</p>
<p>Fix #1043.</p>
</div></details></div>
<div class="toot" id="closed-1038"><h2>Issue #1038 closed<span class="toot-id"> #closed-1038</span></h2><div class="pubdate">28 Feb at 22:23:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1038">https://github.com/qt4cg/qtspecs/issues/1038</a></div><p>Backwards incompatibility caused by use of EBV in callback functions</p></div>
<div class="toot" id="created-1050"><h2>Issue #1050 created<span class="toot-id"> #created-1050</span></h2><div class="pubdate">28 Feb at 16:02:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1050">https://github.com/qt4cg/qtspecs/issues/1050</a></div><details><summary>Potential (low-risk) Ambiguities in XPath EBNF</summary><div class="markup"><p>After demonstrating <code>iXML</code> XPath grammar production at the meeting of 27th Feburary, it seemed worth recording some of the ambiguity issues encountered, if only so others might be aware of possible pitfalls.</p>
<p>Please note that the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#lexical-structure">Lexical Structure</a> notes in the spec <em>do</em> resolve these ambiguities, by extra-grammatical interpretations, most notably the choice of <em>longest conforming match</em>, but for grammar/parsers which don't specify or support this, such as <a href="https://invisiblexml.org/">InvisibleXML</a>, ambiguities might arise, though there may be ameliorating changes to the resulting grammar that will resolve them. <strong>I am not advocating changes to the specification EBNF</strong>  but merely noting where such problems might occur from my implementation experience, and potentially suggesting some workarounds.</p>
<p>Here are a couple of cases:</p>
<h3>TypeName / AtomicOrUnionType</h3>
<p>The rule for <code>ItemType </code>is ~</p>
<blockquote>
<p><code>ItemType ::= ... TypeName| .... | AtomicOrUnionType |  ... </code></p>
</blockquote>
<p>where both <code>TypeName </code>and <code>AtomicOrUnionType</code> resolve solely to the <code>EQName </code>production. The grammar interpretation notes suggests (I think) that it binds to <code>TypeName</code> if such exists in the current static context, which is an extra-grammatical concept, but I may be mistaken.</p>
<h3>StringTemplate</h3>
<p>The productions for StringTemplate are:</p>
<pre><code>[106]   	StringTemplate	             ::=   	"`" (StringTemplateFixedPart | StringTemplateVariablePart)* "`"	
[107]   	StringTemplateFixedPart	     ::=   	((Char - ('{' | '}' | '`')) | "{{" | "}}" | "``")*
[108]   	StringTemplateVariablePart   ::=   	EnclosedExpr 
</code></pre>
<p>where it relies on <em>longest match</em> semantics to avoid ambiguity. (If this was not the case a potential infinity of empty  <code>StringTemplateFixedPart</code> productions could be satisfied, or any sequential partitions of a sequence of characters.)</p>
<p>An alternative (recursive and more cumbersome) formulation, which avoids the ambiguity is (in an iXML grammar for compactness):</p>
<pre><code>               StringTemplate: -"`", StringTemplateContent?, -"`".
       -StringTemplateContent: StringTemplateFixedPart |
                               StringTemplateVariablePart |
                               StringTemplateVariablePart, StringTemplateContent |
                               StringTemplateFixedPart, StringTemplateVariablePart, StringTemplateContent?.
      StringTemplateFixedPart: ("{{"; "}}"; "``"; ~["`{}"])+.
</code></pre>
<p><code>StringTemplateVariablePart</code> remains unchanged. (iXML doesn't support character set subtraction, so <code>~["``{}"]</code> (<em>any character except...</em>) is used for the <code>Char -  ....</code> term.) By allowing a fixed part only to be followed by a variable part, this effectively permits the content either to be empty, or a sequence of parts such that <code>StringTemplateVariablePart</code> terms can be consecutive, but not <code>StringTemplateFixedPart</code> and it seems to work effectively, at least in my iXML parser.</p>
<p>Reactions, corrections, remarks, praise and brickbats welcome.
I'll document any more as I find them.
John</p>
</div></details></div>
<div class="toot" id="created-1049"><h2>Pull request #1049 created<span class="toot-id"> #created-1049</span></h2><div class="pubdate">28 Feb at 13:46:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1049">https://github.com/qt4cg/qtspecs/pull/1049</a></div><details><summary>340-partial fn:format-number: Specifying decimal format</summary><div class="markup"><p>The PR introduces an additional <code>$format</code> argument to <code>fn:format-number</code>, which allows you to override decimal formats with custom properties.</p>
<p>Next, we may need to clarify if the current specification already allows processors to provide custom decimal formats (https://github.com/qt4cg/qtspecs/issues/340#issuecomment-1968856655). It’s not part of this PR.</p>
</div></details></div>
<div class="toot" id="created-1048"><h2>Issue #1048 created<span class="toot-id"> #created-1048</span></h2><div class="pubdate">28 Feb at 11:14:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1048">https://github.com/qt4cg/qtspecs/issues/1048</a></div><details><summary>fn:format-number: relax restrictions on exponent-separator (possibly minus-sign, percent, per-mille)</summary><div class="markup"><p>The current rules for decimal formats are too restrictive (i.e., too much focused on Anglo-Saxon formatting rules). The most prominent case is the Arabic exponent-separator „character“, which consists of two characters: <code>عر</code> (https://www.localeplanet.com/icu/ar/). The exponent separator of other locales is not restricted to a single character either. For example, <code>se-NO</code> uses <code>·10^</code>.</p>
<p>When we include the ICU library in the analysis, we also find <code>minus-sign</code>, <code>percent</code> and <code>per-mille</code> properties that are longer than 1 character. Examples:</p>
<ul>
<li>The <code>minus-sign</code> character for <code>he</code> consists of <code>200e</code> and <code>002d</code> (<code>200e</code> is the Left-to-Right Mark).</li>
<li>The Arabic <code>percent</code> character consists of <code>066a</code> and <code>061c</code> (<code>061c</code> is the “Arabic Letter Mark”).</li>
<li>The <code>per-mille</code> property of <code>en-US-posix</code> is <code>0/00</code>.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1047"><h2>Issue #1047 created<span class="toot-id"> #created-1047</span></h2><div class="pubdate">28 Feb at 10:13:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1047">https://github.com/qt4cg/qtspecs/issues/1047</a></div><details><summary>Incorrect note for `fn:some` and `fn:every`</summary><div class="markup"><p><code>fn:some</code> and <code>fn:every</code> state (non-normatively):</p>
<blockquote>
<p>"If the second argument is omitted or an empty sequence, the first argument must be a sequence of xs:boolean values.".</p>
</blockquote>
<p>I don't think this note is correct. If the default predicate <code>identity#1</code> is used, it is coerced to the required type <code>function(item()) as xs:boolean</code>, so the effective predicate is <code>fn($x as item()) as xs:boolean {identity($x)}</code>. This atomises the result of calling <code>identity($x)</code> and casts the result to <code>xs:boolean</code>. Therefore expressions such as <code>some([true()])</code> and <code>some(&lt;a&gt;true&lt;/a&gt;)</code> return true, not an error.</p>
</div></details></div>
<div class="toot" id="created-1046"><h2>Pull request #1046 created<span class="toot-id"> #created-1046</span></h2><div class="pubdate">28 Feb at 09:55:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1046">https://github.com/qt4cg/qtspecs/pull/1046</a></div><details><summary>1038 take-while predicate no longer uses EBV</summary><div class="markup"><p>See issue #1038, which pointed out compatibility problems with using EBV for callback predicates, as proposed in issue #919.</p>
<p>In specifying <code>fn:take-while</code> we anticipated acceptance of the proposal to use EBV for predicate callbacks; now that we have decided not to make that change, this PR brings <code>take-while</code> into alignment with other functions using a predicate callback.</p>
</div></details></div>
<div class="toot" id="closed-1016"><h2>Issue #1016 closed<span class="toot-id"> #closed-1016</span></h2><div class="pubdate">27 Feb at 17:31:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1016">https://github.com/qt4cg/qtspecs/issues/1016</a></div><p>Editorial comments on fn:parse-csv()</p></div>
<div class="toot" id="closed-1042"><h2>Issue #1042 closed<span class="toot-id"> #closed-1042</span></h2><div class="pubdate">27 Feb at 17:30:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1042">https://github.com/qt4cg/qtspecs/pull/1042</a></div><p>1016 Editorial cleanup - csv-to-arrays</p></div>
<div class="toot" id="closed-236"><h2>Issue #236 closed<span class="toot-id"> #closed-236</span></h2><div class="pubdate">27 Feb at 17:28:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/236">https://github.com/qt4cg/qtspecs/issues/236</a></div><p>map:build: sequence of keys</p></div>
<div class="toot" id="closed-1041"><h2>Issue #1041 closed<span class="toot-id"> #closed-1041</span></h2><div class="pubdate">27 Feb at 17:28:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1041">https://github.com/qt4cg/qtspecs/pull/1041</a></div><p>236 map:build: sequence of keys</p></div>
<div class="toot" id="closed-988"><h2>Issue #988 closed<span class="toot-id"> #closed-988</span></h2><div class="pubdate">27 Feb at 17:22:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/988">https://github.com/qt4cg/qtspecs/pull/988</a></div><p>960 Pinned and labeled values</p></div>
<div class="toot" id="minutes-02-27"><h2>QT4 CG meeting 067 draft minutes<span class="toot-id"> #minutes-02-27</span></h2><div class="pubdate">27 Feb at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/02-27">https://qt4cg.org/meeting/minutes/2024/02-27</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-485"><h2>Issue #485 closed<span class="toot-id"> #closed-485</span></h2><div class="pubdate">27 Feb at 17:19:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/485">https://github.com/qt4cg/qtspecs/issues/485</a></div><p>Predeclared namespaces in XQuery</p></div>
<div class="toot" id="closed-1040"><h2>Issue #1040 closed<span class="toot-id"> #closed-1040</span></h2><div class="pubdate">27 Feb at 17:18:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1040">https://github.com/qt4cg/qtspecs/pull/1040</a></div><p>485 Predeclared namespaces in XQuery: output</p></div>
<div class="toot" id="closed-1029"><h2>Issue #1029 closed<span class="toot-id"> #closed-1029</span></h2><div class="pubdate">27 Feb at 17:14:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1029">https://github.com/qt4cg/qtspecs/issues/1029</a></div><p>Make argument of fn:void optional</p></div>
<div class="toot" id="closed-1032"><h2>Issue #1032 closed<span class="toot-id"> #closed-1032</span></h2><div class="pubdate">27 Feb at 17:14:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1032">https://github.com/qt4cg/qtspecs/pull/1032</a></div><p>1029 Make argument of fn:void optional</p></div>
<div class="toot" id="closed-1033"><h2>Issue #1033 closed<span class="toot-id"> #closed-1033</span></h2><div class="pubdate">27 Feb at 17:09:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1033">https://github.com/qt4cg/qtspecs/pull/1033</a></div><p>QT4CG-066-01 Add note that whitespace and comments in regexen are lexical constructs</p></div>
<div class="toot" id="closed-356"><h2>Issue #356 closed<span class="toot-id"> #closed-356</span></h2><div class="pubdate">27 Feb at 17:08:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/356">https://github.com/qt4cg/qtspecs/issues/356</a></div><p>array:leaves</p></div>
<div class="toot" id="closed-843"><h2>Issue #843 closed<span class="toot-id"> #closed-843</span></h2><div class="pubdate">27 Feb at 17:08:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/843">https://github.com/qt4cg/qtspecs/issues/843</a></div><p>Standard, array &amp; map functions: Equivalencies</p></div>
<div class="toot" id="closed-872"><h2>Issue #872 closed<span class="toot-id"> #closed-872</span></h2><div class="pubdate">27 Feb at 17:08:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/872">https://github.com/qt4cg/qtspecs/issues/872</a></div><p>Symmetry: fn:items-at → fn:get</p></div>
<div class="toot" id="closed-990"><h2>Issue #990 closed<span class="toot-id"> #closed-990</span></h2><div class="pubdate">27 Feb at 17:08:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/990">https://github.com/qt4cg/qtspecs/issues/990</a></div><p>Transitive closure on non-nodes</p></div>
<div class="toot" id="closed-1007"><h2>Issue #1007 closed<span class="toot-id"> #closed-1007</span></h2><div class="pubdate">27 Feb at 17:08:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1007">https://github.com/qt4cg/qtspecs/issues/1007</a></div><p>How to invert a predicate function</p></div>
<div class="toot" id="closed-1030"><h2>Issue #1030 closed<span class="toot-id"> #closed-1030</span></h2><div class="pubdate">27 Feb at 17:07:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1030">https://github.com/qt4cg/qtspecs/issues/1030</a></div><p>allow pattern matches in axis expression</p></div>
<div class="toot" id="closed-1034"><h2>Issue #1034 closed<span class="toot-id"> #closed-1034</span></h2><div class="pubdate">27 Feb at 17:05:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1034">https://github.com/qt4cg/qtspecs/pull/1034</a></div><p>QT4CG-066-xx Add note regarding absence of drop-while / skip-while</p></div>
<div class="toot" id="closed-1024"><h2>Issue #1024 closed<span class="toot-id"> #closed-1024</span></h2><div class="pubdate">27 Feb at 17:00:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1024">https://github.com/qt4cg/qtspecs/issues/1024</a></div><p>Precedence of `otherwise` operator</p></div>
<div class="toot" id="closed-1031"><h2>Issue #1031 closed<span class="toot-id"> #closed-1031</span></h2><div class="pubdate">27 Feb at 17:00:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1031">https://github.com/qt4cg/qtspecs/pull/1031</a></div><p>1024 Change precedence of 'otherwise' operator</p></div>
<div class="toot" id="closed-1003"><h2>Issue #1003 closed<span class="toot-id"> #closed-1003</span></h2><div class="pubdate">27 Feb at 17:00:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1003">https://github.com/qt4cg/qtspecs/pull/1003</a></div><p>919 Use EBV in boolean callbacks</p></div>
<div class="toot" id="created-1045"><h2>Issue #1045 created<span class="toot-id"> #created-1045</span></h2><div class="pubdate">26 Feb at 13:22:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1045">https://github.com/qt4cg/qtspecs/issues/1045</a></div><details><summary>Functions to manage namespace usage</summary><div class="markup"><p>Prior to saving XML generated in XQuery I often tweak the namespace usage.
This makes the XML lighter and clearer for the casual reader and is sometimes mandated by users and systems.
I think providing builtin solutions for these cases would ease these tasks.</p>
<p>Common cases are:</p>
<ol>
<li>
<p>Remove unused prefixes
Example: the function presented at https://stackoverflow.com/questions/23002655/xquery-how-to-remove-unused-namespace-in-xml-node</p>
</li>
<li>
<p>Make a namespace the default wherever it is used.
Example: <code>functx:change-element-ns-deep($nodes,$targetns,"")</code><br>
See  http://www.xqueryfunctions.com/xq/functx_change-element-ns-deep.html</p>
</li>
<li>
<p>Remove the use of all/some namespaces
Example: BaseX https://docs.basex.org/wiki/Utility_Module#util:strip-namespaces</p>
</li>
</ol>
<p>A somewhat related issue https://github.com/qt4cg/qtspecs/issues/266</p>
</div></details></div>
<div class="toot" id="agenda-02-27"><h2>QT4 CG meeting 067 draft agenda<span class="toot-id"> #agenda-02-27</span></h2><div class="pubdate">26 Feb at 11:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/02-27">https://qt4cg.org/meeting/agenda/2024/02-27</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1044"><h2>Issue #1044 created<span class="toot-id"> #created-1044</span></h2><div class="pubdate">26 Feb at 10:50:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1044">https://github.com/qt4cg/qtspecs/issues/1044</a></div><details><summary>CSV row delimiter - allowed values</summary><div class="markup"><p>Section 15.4.2.1 says:</p>
<blockquote>
<p>The row delimiter defaults to matching any of CRLF (
), LF (
), or CR (
). Valid values for the row delimiter are a single Unicode character, or one of CRLF, LF, or CR, that has not been marked for use as the column delimiter. Implementations must raise [[err:FOCV0002](] if the row-delimiter option is set to a multi-character string other than CRLF (
)</p>
</blockquote>
<ol>
<li>It's not entirely clear to me what this is saying. Are alternative row delimiters other than newline delimiters allowed (<code>row-delimiter:('|','/')</code>?</li>
<li>The statement in this section doesn't align with the error conditions appearing in the actual function specs, which says: "A dynamic error [[err:FOCV0002] occurs if one or more of the values for field-delimiter or quote-character are specified and are not a single character." - no mention here of the row-delimiter.</li>
</ol>
</div></details></div>
<div class="toot" id="created-1043"><h2>Issue #1043 created<span class="toot-id"> #created-1043</span></h2><div class="pubdate">26 Feb at 08:59:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1043">https://github.com/qt4cg/qtspecs/issues/1043</a></div><details><summary>CSV parsing - "blank" rows</summary><div class="markup"><p>The CSV parsing specification states "A blank row is represented as an empty array.".</p>
<ol>
<li>
<p>It's not clear what "blank" means here. Does it depend on the whitespace-trimming option?</p>
</li>
<li>
<p>It would be more logical to return an array containing a single zero-length string, since any other line containing no field delimiter is considered to contain one field.</p>
</li>
<li>
<p>Alternatively, it might make sense to ignore the row entirely.</p>
</li>
</ol>
</div></details></div>
<div class="toot" id="created-1042"><h2>Pull request #1042 created<span class="toot-id"> #created-1042</span></h2><div class="pubdate">26 Feb at 00:11:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1042">https://github.com/qt4cg/qtspecs/pull/1042</a></div><details><summary>1016 Editorial cleanup - csv-to-arrays</summary><div class="markup"><p>The changes here are almost entirely editorial, reordering material, removing duplication and changing some of the language for consistency with the rest of the spec. There is one substantive change - the function <code>csv-to-simple-rows</code> is renamed <code>csv-to-arrays</code>.</p>
<p>Fix #1016</p>
</div></details></div>
<div class="toot" id="created-1041"><h2>Pull request #1041 created<span class="toot-id"> #created-1041</span></h2><div class="pubdate">23 Feb at 10:47:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1041">https://github.com/qt4cg/qtspecs/pull/1041</a></div><details><summary>236 map:build: sequence of keys</summary><div class="markup"><p>Issue: #236</p>
</div></details></div>
<div class="toot" id="created-1040"><h2>Pull request #1040 created<span class="toot-id"> #created-1040</span></h2><div class="pubdate">23 Feb at 09:23:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1040">https://github.com/qt4cg/qtspecs/pull/1040</a></div><details><summary>485 Predeclared namespaces in XQuery: output</summary><div class="markup"><p>Issue: #485</p>
</div></details></div>
<div class="toot" id="created-1039"><h2>Issue #1039 created<span class="toot-id"> #created-1039</span></h2><div class="pubdate">22 Feb at 09:42:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1039">https://github.com/qt4cg/qtspecs/issues/1039</a></div><details><summary>Allow dynamic collations in XQuery "order by" and "group by"</summary><div class="markup"><p>I propose that in "order by" and "group by" clauses, the keyword "collation" should be followed by an expression rather than by a URILiteral.</p>
<p>The only problem this causes is if the expression depends on variables in the tuple stream, because obviously the collation must be selected for the tuple stream as a whole, not for each individual tuple.</p>
<p>We can solve this problem by amending the rules for the scope of variables bound in FLWOR expressions (§4.15.1 rule 1) so that collation expressions are excluded from the scope; or perhaps (it might be simpler) to make it a static error if the collation expression refers to a variable bound in the containing FLWOR expression.</p>
<p>If the syntax allows a general expression then a simple <code>"quoted-string"</code> will be interpreted as a <code>StringLiteral</code> rather than a <code>URILiteral</code>. As far as I'm aware the two things are syntactically and semantically identical so this isn't a problem.</p>
</div></details></div>
<div class="toot" id="created-1038"><h2>Issue #1038 created<span class="toot-id"> #created-1038</span></h2><div class="pubdate">21 Feb at 21:03:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1038">https://github.com/qt4cg/qtspecs/issues/1038</a></div><details><summary>Backwards incompatibility caused by use of EBV in callback functions</summary><div class="markup"><p>Changing fn:filter and similar functions that existed in 3.1 to use the EBV of the callback function's result has introduced a backwards incompatibility. In 3.1, the function conversion rules were used to convert the callback function's result to <code>xs:boolean</code>. This involves atomization. If the callback returned the untyped node <code>&lt;a&gt;false&lt;/a&gt;</code>, this is atomised as <code>false()</code>, but its EBV is <code>true()</code>.</p>
<p>Revealed by test case fn:filter-006.</p>
<p>I think it's unlikely to happen much in practice, but it's a bit nasty. Perhaps we shouldn't make the change to use EBV for functions that existed in 3.1?</p>
<p>Perhaps we should even consider reverting the change entirely. It's not exactly essential.</p>
</div></details></div>
<div class="toot" id="created-1037"><h2>Issue #1037 created<span class="toot-id"> #created-1037</span></h2><div class="pubdate">21 Feb at 17:22:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1037">https://github.com/qt4cg/qtspecs/issues/1037</a></div><details><summary>fn:json-to-xml: 'number-parser' option</summary><div class="markup"><p>A function supplied via the <code>number-parser</code> option of <code>fn:json-to-xml</code> is now allowed to return zero or <del>more</del> <strong>one</strong> items (see #973). Analogous to the <code>action</code> argument of <code>fn:replace</code>, the result should be converted to a string by invoking <code>fn:string</code> on the result. An example:</p>
<pre><code class="language-xquery">json-to-xml('-1', map { 'number-parser': abs#1 })
→ &lt;fn:number&gt;1&lt;/fn:number&gt;

json-to-xml('1', map { 'number-parser': fn { true#0 } })
→ err:FOTY0013
</code></pre>
<p>No change is required for <code>fn:parse-json</code>.</p>
</div></details></div>
<div class="toot" id="created-1036"><h2>Issue #1036 created<span class="toot-id"> #created-1036</span></h2><div class="pubdate">21 Feb at 13:19:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1036">https://github.com/qt4cg/qtspecs/issues/1036</a></div><details><summary>parse-json: liberal parsing</summary><div class="markup"><p>I noticed that some new test cases (<a href="https://github.com/qt4cg/qt4tests/blob/1859042e97f5d2ce4917bd3eef7beae4e5f64171/fn/parse-json.xml#L960-L973"><code>fn-parse-json-712</code></a>, <code>fn-parse-json-716</code>, possibly others) rely on specific liberal parsing rules.</p>
<p>@michaelhkay Do you think that it could make sense to formalize some of those rules, or should we rather fix the test cases?</p>
</div></details></div>
<div class="toot" id="closed-1005"><h2>Issue #1005 closed<span class="toot-id"> #closed-1005</span></h2><div class="pubdate">21 Feb at 10:29:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1005">https://github.com/qt4cg/qtspecs/issues/1005</a></div><p>regular expressions - whitespace</p></div>
<div class="toot" id="closed-709"><h2>Issue #709 closed<span class="toot-id"> #closed-709</span></h2><div class="pubdate">21 Feb at 10:29:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/709">https://github.com/qt4cg/qtspecs/issues/709</a></div><p>(Un)Checked Evaluation</p></div>
<div class="toot" id="closed-459"><h2>Issue #459 closed<span class="toot-id"> #closed-459</span></h2><div class="pubdate">21 Feb at 10:28:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/459">https://github.com/qt4cg/qtspecs/issues/459</a></div><p>Eager and lazy evaluation</p></div>
<div class="toot" id="closed-135"><h2>Issue #135 closed<span class="toot-id"> #closed-135</span></h2><div class="pubdate">21 Feb at 10:28:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/135">https://github.com/qt4cg/qtspecs/issues/135</a></div><p>Arrays' counterparts for functions on sequences, and vice versa</p></div>
<div class="toot" id="closed-94"><h2>Issue #94 closed<span class="toot-id"> #closed-94</span></h2><div class="pubdate">21 Feb at 10:28:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/94">https://github.com/qt4cg/qtspecs/issues/94</a></div><p>Functions that determine if a given sequence is a subsequence of another sequence</p></div>
<div class="toot" id="closed-43"><h2>Issue #43 closed<span class="toot-id"> #closed-43</span></h2><div class="pubdate">21 Feb at 10:28:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/43">https://github.com/qt4cg/qtspecs/issues/43</a></div><p>Support standard and user-defined composite values using item type definitions</p></div>
<div class="toot" id="closed-1001"><h2>Issue #1001 closed<span class="toot-id"> #closed-1001</span></h2><div class="pubdate">20 Feb at 23:53:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1001">https://github.com/qt4cg/qtspecs/issues/1001</a></div><p>fn:subsequence-where: equivalent `fn:slice` expression</p></div>
<div class="toot" id="closed-1020"><h2>Issue #1020 closed<span class="toot-id"> #closed-1020</span></h2><div class="pubdate">20 Feb at 23:51:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1020">https://github.com/qt4cg/qtspecs/issues/1020</a></div><p>When to apply the coercion rules</p></div>
<div class="toot" id="created-1035"><h2>Issue #1035 created<span class="toot-id"> #created-1035</span></h2><div class="pubdate">20 Feb at 19:04:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1035">https://github.com/qt4cg/qtspecs/issues/1035</a></div><details><summary>Add default values for parameters in constructor functions for records</summary><div class="markup"><p>We have added implicit constructor functions for named record types; we should allow the parameters in these functions to take explicit default values.</p>
<p>For example</p>
<p><code>declare item type my:complex as record(r as xs:double, i as xs:double := 0)</code></p>
<p>At the same time we might consider introducing fixed values, for example</p>
<p><code>declare item type my:rectangle as record(height, width, area ::= function($rect){$rect?height * $rect?width))</code></p>
<p>in which (a) the area function must NOT be supplied as an argument to the constructor function call, and (b) a map in which the area field is different from this fixed value is not a valid instance of the <code>my:rectangle</code> record type.</p>
</div></details></div>
<div class="toot" id="created-1034"><h2>Pull request #1034 created<span class="toot-id"> #created-1034</span></h2><div class="pubdate">20 Feb at 18:56:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1034">https://github.com/qt4cg/qtspecs/pull/1034</a></div><details><summary>QT4CG-066-xx Add note regarding absence of drop-while / skip-while</summary><div class="markup"><p>In response to comments noted in the minutes of meeting 066, and made in writing against PR #1008, add a note justifying the absence of drop-while or skip-while functions.</p>
</div></details></div>
<div class="toot" id="created-1033"><h2>Pull request #1033 created<span class="toot-id"> #created-1033</span></h2><div class="pubdate">20 Feb at 18:44:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1033">https://github.com/qt4cg/qtspecs/pull/1033</a></div><details><summary>QT4CG-066-01 Add note that whitespace and comments in regexen are lexical constructs</summary><div class="markup"><p>Adds a note explaining why whitespace and comments are not explicit in the regex grammar; see action QT4CG-066-01</p>
</div></details></div>
<div class="toot" id="created-1032"><h2>Pull request #1032 created<span class="toot-id"> #created-1032</span></h2><div class="pubdate">20 Feb at 18:25:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1032">https://github.com/qt4cg/qtspecs/pull/1032</a></div><details><summary>1029 Make argument of fn:void optional</summary><div class="markup"><p>Allows the use of <code>fn:void#0</code> when required.</p>
<p>Fix #1029</p>
</div></details></div>
<div class="toot" id="created-1031"><h2>Pull request #1031 created<span class="toot-id"> #created-1031</span></h2><div class="pubdate">20 Feb at 18:07:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1031">https://github.com/qt4cg/qtspecs/pull/1031</a></div><details><summary>1024 Change precedence of 'otherwise' operator</summary><div class="markup"><p>Changes the precedence of the <code>otherwise</code> operator so that <code>@price otherwise @cost * 2</code> now means <code>@price otherwise (@cost * 2)</code> rather than <code>(@price otherwise @cost) * 2</code>.</p>
<p>Fix #1024</p>
</div></details></div>
<div class="toot" id="minutes-02-20"><h2>QT4 CG meeting 066 draft minutes<span class="toot-id"> #minutes-02-20</span></h2><div class="pubdate">20 Feb at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/02-20">https://qt4cg.org/meeting/minutes/2024/02-20</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-999"><h2>Issue #999 closed<span class="toot-id"> #closed-999</span></h2><div class="pubdate">20 Feb at 17:25:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/999">https://github.com/qt4cg/qtspecs/issues/999</a></div><p>regular expression addition - comments</p></div>
<div class="toot" id="closed-1022"><h2>Issue #1022 closed<span class="toot-id"> #closed-1022</span></h2><div class="pubdate">20 Feb at 17:25:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1022">https://github.com/qt4cg/qtspecs/pull/1022</a></div><p>999 Allow comments in regular expressions</p></div>
<div class="toot" id="closed-1028"><h2>Issue #1028 closed<span class="toot-id"> #closed-1028</span></h2><div class="pubdate">20 Feb at 17:22:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1028">https://github.com/qt4cg/qtspecs/pull/1028</a></div><p>960(partial) Recognize alternative representation of JSON null</p></div>
<div class="toot" id="closed-617"><h2>Issue #617 closed<span class="toot-id"> #closed-617</span></h2><div class="pubdate">20 Feb at 17:19:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/617">https://github.com/qt4cg/qtspecs/issues/617</a></div><p>Implicit constructor functions for record types and union types</p></div>
<div class="toot" id="closed-953"><h2>Issue #953 closed<span class="toot-id"> #closed-953</span></h2><div class="pubdate">20 Feb at 17:19:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/953">https://github.com/qt4cg/qtspecs/pull/953</a></div><p>617 Define record constructors</p></div>
<div class="toot" id="closed-1002"><h2>Issue #1002 closed<span class="toot-id"> #closed-1002</span></h2><div class="pubdate">20 Feb at 17:16:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1002">https://github.com/qt4cg/qtspecs/issues/1002</a></div><p>Reinstate subsequence-before</p></div>
<div class="toot" id="closed-1008"><h2>Issue #1008 closed<span class="toot-id"> #closed-1008</span></h2><div class="pubdate">20 Feb at 17:16:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1008">https://github.com/qt4cg/qtspecs/pull/1008</a></div><p>1002 Add fn:take-while function (replacing subsequence-before)</p></div>
<div class="toot" id="closed-655"><h2>Issue #655 closed<span class="toot-id"> #closed-655</span></h2><div class="pubdate">20 Feb at 17:13:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/655">https://github.com/qt4cg/qtspecs/issues/655</a></div><p>fn:sort-with: Comparators</p></div>
<div class="toot" id="closed-795"><h2>Issue #795 closed<span class="toot-id"> #closed-795</span></h2><div class="pubdate">20 Feb at 17:13:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/795">https://github.com/qt4cg/qtspecs/pull/795</a></div><p>655 fn:sort-with</p></div>
<div class="toot" id="closed-1023"><h2>Issue #1023 closed<span class="toot-id"> #closed-1023</span></h2><div class="pubdate">20 Feb at 17:09:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1023">https://github.com/qt4cg/qtspecs/pull/1023</a></div><p>1020 explain consequences of function coercion</p></div>
<div class="toot" id="closed-1025"><h2>Issue #1025 closed<span class="toot-id"> #closed-1025</span></h2><div class="pubdate">20 Feb at 17:04:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1025">https://github.com/qt4cg/qtspecs/pull/1025</a></div><p>1001 Fix incorrect operator precedence in subsequence-where</p></div>
<div class="toot" id="created-1030"><h2>Issue #1030 created<span class="toot-id"> #created-1030</span></h2><div class="pubdate">20 Feb at 14:37:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1030">https://github.com/qt4cg/qtspecs/issues/1030</a></div><details><summary>allow pattern matches in axis expression</summary><div class="markup"><p>There's a danger that this already exists, and that i dont know about it, but i dont think it does.</p>
<p>Consider this SO question.</p>
<p>https://stackoverflow.com/questions/78027093/selecting-preceding-cousins-inclusing-siblings</p>
<p>the questioner is writing this</p>
<p><code>/root/level1/level2[@id='6']/preceding::level2[parent::level1[parent::root]][1]</code></p>
<p>eeek...look at the nasty nested predicates</p>
<p>when he/she wants to write this</p>
<p><code>/root/level1/level2[@id='6']/preceding::(root/level/level2)[1]</code></p>
<p>there is an answer on the question which sort of shows how horrific the problem is in general.</p>
<p>(its a problem that crops up quite a lot for me)</p>
</div></details></div>
<div class="toot" id="created-1029"><h2>Issue #1029 created<span class="toot-id"> #created-1029</span></h2><div class="pubdate">20 Feb at 09:50:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1029">https://github.com/qt4cg/qtspecs/issues/1029</a></div><details><summary>Make argument of fn:void optional</summary><div class="markup"><p>If you want to supply a function that always returns an empty sequence, fn:void#0 would be useful; but currently there is no arity-zero variant.</p>
<p>Example: <code>map:build(...., combine:=fn:void#0)</code> returns a map in which any key that occurs more than once in the input is mapped to an empty sequence.</p>
<p>The first argument of <code>fn:void</code> should default to an empty sequence.</p>
</div></details></div>
<div class="toot" id="agenda-02-20"><h2>QT4 CG meeting 066 draft agenda<span class="toot-id"> #agenda-02-20</span></h2><div class="pubdate">19 Feb at 14:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/02-20">https://qt4cg.org/meeting/agenda/2024/02-20</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1028"><h2>Pull request #1028 created<span class="toot-id"> #created-1028</span></h2><div class="pubdate">19 Feb at 11:34:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1028">https://github.com/qt4cg/qtspecs/pull/1028</a></div><details><summary>960(partial) Recognize alternative representation of JSON null</summary><div class="markup"><p>Defines an option in parse-json and json-doc to define a representation for JSON null, defaulting to <code>()</code> as currently used. Selecting a different value may be useful because it bypasses the problem that the <code>?</code> and <code>??</code> operators flatten the results, causing <code>()</code> to be elided.</p>
<p>Suggests use of the QName <code>fn:null</code> as an alternative representation; and changes the JSON serialization method to recognize this QName as a representation of null.</p>
</div></details></div>
<div class="toot" id="created-1027"><h2>Pull request #1027 created<span class="toot-id"> #created-1027</span></h2><div class="pubdate">17 Feb at 22:21:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1027">https://github.com/qt4cg/qtspecs/pull/1027</a></div><details><summary>150 fn:ranks</summary><div class="markup"><p>As proposed and discussed  here: https://github.com/qt4cg/qtspecs/issues/150</p>
</div></details></div>
<div class="toot" id="created-1026"><h2>Issue #1026 created<span class="toot-id"> #created-1026</span></h2><div class="pubdate">17 Feb at 09:44:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1026">https://github.com/qt4cg/qtspecs/issues/1026</a></div><details><summary>XSLT match patterns on pinned maps and arrays</summary><div class="markup"><p>Given that <code>&lt;xsl:apply-templates select="pin(.)??course?code"/&gt;</code> will select items that are labeled with their position in the containing tree of maps and arrays, it should be possible to match the selected items with a match pattern of the form</p>
<p><code>match="?course?code"</code></p>
<p>that operates in a similar way to patterns such as <code>course/code</code> in XML.</p>
<p>Perhaps the pinning of the map should be done automatically by the <code>xsl:apply-templates</code> instruction.</p>
</div></details></div>
<div class="toot" id="created-1025"><h2>Pull request #1025 created<span class="toot-id"> #created-1025</span></h2><div class="pubdate">13 Feb at 21:25:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1025">https://github.com/qt4cg/qtspecs/pull/1025</a></div><details><summary>1001 Fix incorrect operator precedence in subsequence-where</summary><div class="markup"><p>Fixes the "equivalent expression" to subsequence-where.</p>
<p>Fix issue #1001</p>
</div></details></div>
<div class="toot" id="created-1024"><h2>Issue #1024 created<span class="toot-id"> #created-1024</span></h2><div class="pubdate">13 Feb at 21:10:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1024">https://github.com/qt4cg/qtspecs/issues/1024</a></div><details><summary>Precedence of `otherwise` operator</summary><div class="markup"><p>I made a mistake when specifying subsequence-where, caused by misunderstanding the precedence of the <code>otherwise</code> operator: see issue #1001.</p>
<p>In the expression</p>
<pre><code>let $start := index-where($input, $from)[1] 
              otherwise count($input) + 1
</code></pre>
<p>I failed to realise that <code>otherwise</code> binds more tightly than <code>+</code>.</p>
<p>I'm opening the issue to solicit views as to whether we have got this right.</p>
<p>One might take the view that the closest thing to <code>otherwise</code> in other familiar language is the ternary conditional operator, which has lower precedence than anything else including <code>and</code> and <code>or</code>; but then, its first operand is a boolean expression while it's relatively unlikely that the operands of <code>otherwise</code> will be boolean. I'm therefore thinking that it might be best to put it between 'eq' and '||`, so</p>
<p><code>$a eq $b otherwise $c || $d</code></p>
<p>parses as</p>
<p><code>$a eq ($b otherwise ($c || $d))</code></p>
</div></details></div>
<div class="toot" id="closed-827"><h2>Issue #827 closed<span class="toot-id"> #closed-827</span></h2><div class="pubdate">13 Feb at 20:04:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/827">https://github.com/qt4cg/qtspecs/issues/827</a></div><p>map:empty, map:exists ← array:empty, array:exists</p></div>
<div class="toot" id="closed-779"><h2>Issue #779 closed<span class="toot-id"> #closed-779</span></h2><div class="pubdate">13 Feb at 20:02:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/779">https://github.com/qt4cg/qtspecs/issues/779</a></div><p>Hash/checksum function</p></div>
<div class="toot" id="closed-978"><h2>Issue #978 closed<span class="toot-id"> #closed-978</span></h2><div class="pubdate">13 Feb at 17:21:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/978">https://github.com/qt4cg/qtspecs/pull/978</a></div><p>948 Reflected the comments of the CG on the specification of scan-left and scan-right</p></div>
<div class="toot" id="minutes-02-13"><h2>QT4 CG meeting 065 draft minutes<span class="toot-id"> #minutes-02-13</span></h2><div class="pubdate">13 Feb at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/02-13">https://qt4cg.org/meeting/minutes/2024/02-13</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-720"><h2>Issue #720 closed<span class="toot-id"> #closed-720</span></h2><div class="pubdate">13 Feb at 17:18:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/720">https://github.com/qt4cg/qtspecs/issues/720</a></div><p>From Records to Objects</p></div>
<div class="toot" id="closed-985"><h2>Issue #985 closed<span class="toot-id"> #closed-985</span></h2><div class="pubdate">13 Feb at 17:18:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/985">https://github.com/qt4cg/qtspecs/pull/985</a></div><p>720 Add lookup arrow expressions (method invocations)</p></div>
<div class="toot" id="closed-949"><h2>Issue #949 closed<span class="toot-id"> #closed-949</span></h2><div class="pubdate">13 Feb at 17:15:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/949">https://github.com/qt4cg/qtspecs/issues/949</a></div><p>Partial Function Applications: Allow return of function name</p></div>
<div class="toot" id="closed-972"><h2>Issue #972 closed<span class="toot-id"> #closed-972</span></h2><div class="pubdate">13 Feb at 17:15:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/972">https://github.com/qt4cg/qtspecs/pull/972</a></div><p>949 Partial Function Applications: Allow return of function name</p></div>
<div class="toot" id="closed-42"><h2>Issue #42 closed<span class="toot-id"> #closed-42</span></h2><div class="pubdate">13 Feb at 17:13:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/42">https://github.com/qt4cg/qtspecs/issues/42</a></div><p>Relax type incompatibility in order by clause (impl. dep. instead of XPST0004)</p></div>
<div class="toot" id="closed-55"><h2>Issue #55 closed<span class="toot-id"> #closed-55</span></h2><div class="pubdate">13 Feb at 17:13:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/55">https://github.com/qt4cg/qtspecs/issues/55</a></div><p>Provide an XML version of the stack trace</p></div>
<div class="toot" id="closed-79"><h2>Issue #79 closed<span class="toot-id"> #closed-79</span></h2><div class="pubdate">13 Feb at 17:12:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/79">https://github.com/qt4cg/qtspecs/issues/79</a></div><p>fn:deep-normalize-space($e as node())</p></div>
<div class="toot" id="closed-989"><h2>Issue #989 closed<span class="toot-id"> #closed-989</span></h2><div class="pubdate">13 Feb at 17:12:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/989">https://github.com/qt4cg/qtspecs/issues/989</a></div><p>character sequence constructor 'a' to 'z'</p></div>
<div class="toot" id="closed-994"><h2>Issue #994 closed<span class="toot-id"> #closed-994</span></h2><div class="pubdate">13 Feb at 17:12:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/994">https://github.com/qt4cg/qtspecs/issues/994</a></div><p>Invoking maps &amp; arrays: allow sequences?</p></div>
<div class="toot" id="closed-1009"><h2>Issue #1009 closed<span class="toot-id"> #closed-1009</span></h2><div class="pubdate">13 Feb at 17:08:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1009">https://github.com/qt4cg/qtspecs/issues/1009</a></div><p>QT4CG-064-03, QT4CG-064-04: Examples, Return type of `fallback`</p></div>
<div class="toot" id="closed-1010"><h2>Issue #1010 closed<span class="toot-id"> #closed-1010</span></h2><div class="pubdate">13 Feb at 17:08:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1010">https://github.com/qt4cg/qtspecs/pull/1010</a></div><p>1009 Examples, Return type of parse-json:fallback</p></div>
<div class="toot" id="closed-916"><h2>Issue #916 closed<span class="toot-id"> #closed-916</span></h2><div class="pubdate">13 Feb at 15:33:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/916">https://github.com/qt4cg/qtspecs/pull/916</a></div><p>720 Allow methods in maps with access to $this</p></div>
<div class="toot" id="created-1023"><h2>Pull request #1023 created<span class="toot-id"> #created-1023</span></h2><div class="pubdate">13 Feb at 12:39:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1023">https://github.com/qt4cg/qtspecs/pull/1023</a></div><details><summary>1020 explain consequences of function coercion</summary><div class="markup"><p>Adds explanatory material to explain my interpretation of the spec and the consequences on backwards compatibility. No change to the spec is proposed. (To review the PR, I suggest reading the change markings in the XQuery spec.)</p>
<p>Fix issue #1020</p>
</div></details></div>
<div class="toot" id="created-1022"><h2>Pull request #1022 created<span class="toot-id"> #created-1022</span></h2><div class="pubdate">13 Feb at 11:51:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1022">https://github.com/qt4cg/qtspecs/pull/1022</a></div><details><summary>999 Allow comments in regular expressions</summary><div class="markup"><p>Fix #999</p>
</div></details></div>
<div class="toot" id="created-1021"><h2>Issue #1021 created<span class="toot-id"> #created-1021</span></h2><div class="pubdate">12 Feb at 12:46:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1021">https://github.com/qt4cg/qtspecs/issues/1021</a></div><details><summary>Extend `fn:doc`, `fn:collection` and `fn:uri-collection` with options maps</summary><div class="markup"><p><code>fn:doc</code>, <code>fn:collection</code> and <code>fn:uri-collection</code> currently expect only a single argument, a URI.</p>
<p>There is no way of adding additional parameters to those functions.</p>
<p>Several implementations of XPath have worked around that limitation by</p>
<ol>
<li>passing of parameters via query string as part of the URI:</li>
</ol>
<ul>
<li>see https://www.saxonica.com/documentation10/index.html#!sourcedocs/collections</li>
<li>exist-db's implementation of <code>uri-collection</code> works similarly</li>
</ul>
<ol start="2">
<li>create custom functions in other namespaces to add an options map as a second parameter</li>
</ol>
<ul>
<li><code>saxon:doc</code> in Saxon https://www.saxonica.com/documentation10/index.html#!changes/extensions/9.7-9.8</li>
<li><code>fetch:doc</code> in baseX https://docs.basex.org/wiki/Fetch_Module#fetch:doc</li>
</ul>
<p>While both approaches do work well, they do fall flat in terms of interoperability and discoverability.
A script written for Saxon leveraging <code>saxon:doc</code> will not work on baseX in vice versa even though they offer options with some overlap.
And a developer looking at the language specification will not discover that these options even exist.</p>
<p>I would like to add a second signature to the above functions with an options map as a second argument.</p>
<pre><code class="language-xquery">fn:doc($href as xs:string?) as document-node()?
fn:doc($href as xs:string?, $options as map(xs:string, *)? := ()) as document-node()?
</code></pre>
<p>NOTE: Looking at the other two functions below I believe the first parameter should be defined as <code>$href as xs:string? := ()</code></p>
<pre><code class="language-xquery">fn:collection( $uri as&nbsp;xs:string? :=&nbsp;())&nbsp;as&nbsp;item()*
fn:collection( $uri as&nbsp;xs:string? :=&nbsp;(), $options as map(xs:string, *)? := ())&nbsp;as&nbsp;item()*
</code></pre>
<pre><code class="language-xquery">fn:uri-collection( $uri as&nbsp;xs:string? :=&nbsp;())&nbsp;as&nbsp;xs:anyURI*
fn:uri-collection( $uri as&nbsp;xs:string? :=&nbsp;(), $options as map(xs:string, *)? := ())&nbsp;as&nbsp;xs:anyURI*
</code></pre>
<p>Since a lot of those options depend on the current runtime most of them will be "free" options.
This will also help us get to a specification quickly and circumvent long infighting about some very specific details.</p>
<p>I do see, however, a good chance of specifying a small set of options that would work across implementations.</p>
<h2>Possible standard options</h2>
<h3>For <code>fn:doc</code></h3>
<ul>
<li><code>validation</code>: wether and how to validate the input files against a schema</li>
<li><code>whitespace</code>: (<code>strip-space</code>, <code>stripws</code>) what to do with whitespace in the input document</li>
<li><code>parser</code>: could be used to define a different parser (for html documents)</li>
</ul>
<h3>For <code>collection</code> and <code>uri-collection</code> I see the following:</h3>
<ul>
<li><code>recurse</code>: traverse collection trees down into its subcollections</li>
<li><code>stable</code>: this is already vaguely mentioned in the spec and would benefit from a clearer specification</li>
<li><code>type</code>: (aka <code>media-type</code> or <code>content-type</code>) while the allowed values will be implementation defined the key should be standardised</li>
</ul>
<p>This would bring the above functions to follow a pattern developers are already familiar with (see <code>fn:serialize</code> and others)</p>
<p>Thanks for initial input by @ChristianGruen, Liam Quin and @michaelhkay</p>
</div></details></div>
<div class="toot" id="agenda-02-13"><h2>QT4 CG meeting 065 draft agenda<span class="toot-id"> #agenda-02-13</span></h2><div class="pubdate">12 Feb at 11:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/02-13">https://qt4cg.org/meeting/agenda/2024/02-13</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1020"><h2>Issue #1020 created<span class="toot-id"> #created-1020</span></h2><div class="pubdate">11 Feb at 23:56:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1020">https://github.com/qt4cg/qtspecs/issues/1020</a></div><details><summary>When to apply the coercion rules</summary><div class="markup"><p>The rules for function calling say that the coercion rules are applied to the values supplied as function arguments; they are also applied in other circumstances such as when binding values to variables. The coercion rules are applied (as far as the spec is concerned) whether or not the supplied value already matches the required type.</p>
<p>Saxon has always attempted to optimise this process: if the supplied value is already an instance of the required type, no coercion takes place.</p>
<p>I have discovered at least one case where this assumption is incorrect: the coercion rules are not idempotent in the case where the supplied value matches the required type. This case concerns function coercion, exemplified by the new test case FunctionCall-058: if the expected type of a callback parameter is <code>function(xs:integer) as xs:boolean</code>, and the supplied value for the callback is a function that accepts <code>xs:decimal</code>, then the coercion rules say that a call to the supplied function that supplies an <code>xs:decimal</code> must be rejected as a type error even though the supplied function accepts it.</p>
<p>Note that this means we have introduced a rather subtle backwards incompatibility. In XQuery 3.1, coercion was not applied to variable bindings, so the following would work (the supplied function matches the declared type of the variable):</p>
<pre><code>declare variable $f as function(xs:integer) as xs:boolean 
              := function($x as item()) as xs:boolean {string($x)};
return $f("banana");
</code></pre>
<p>(see new tests VarDecl065/066)</p>
<p>In 4.0 I believe this is supposed to throw a type error, because the supplied function is wrapped in a wrapper function that checks that the supplied argument is an integer.</p>
<p>We have extended the coercion rules considerably in 4.0, and we need to be confident that there are no other similar cases where the coercion rules are no longer idempotent.</p>
</div></details></div>
<div class="toot" id="created-1019"><h2>Issue #1019 created<span class="toot-id"> #created-1019</span></h2><div class="pubdate">11 Feb at 15:23:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1019">https://github.com/qt4cg/qtspecs/issues/1019</a></div><details><summary>XQFO: Unknown option parameters</summary><div class="markup"><p>The current <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#option-parameter-conventions">option parameter conventions</a> are:</p>
<blockquote>
<ol start="4">
<li>It is not an error if the options map contains options with names other than those described in this specification. Implementations MAY attach an ·implementation-defined· meaning to such entries, and MAY define errors that arise if such entries are present with invalid values. Implementations MUST ignore such entries unless they have a specific ·implementation-defined· meaning. Implementations that define additional options in this way SHOULD use values of type <code>xs:QName</code> as the option names, using an appropriate namespace.</li>
</ol>
</blockquote>
<p>The obvious consequence is that wrongly typed or unsupported options are not reported as such:</p>
<pre><code class="language-xquery">serialize($node, map { 'format': 'html' })
</code></pre>
<p>I think we should still allow proprietary options, but raise errors when an option is neither defined in the specification nor supported by the given implementation. On the one hand, this will help users to spot typos (e.g., <code>byte-order-mask</code> or instead of <code>byte-order-mark</code>). On the other hand, options that are supported by one implementation will be rejected, which feels reasonable to me, as options usually change either the result, or the way how the input is treated.</p>
<p>If we believe that this change is too disruptive, we could tolerate entries with <code>xs:QName</code> keys.</p>
</div></details></div>
<div class="toot" id="created-1018"><h2>Issue #1018 created<span class="toot-id"> #created-1018</span></h2><div class="pubdate">11 Feb at 07:01:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1018">https://github.com/qt4cg/qtspecs/issues/1018</a></div><details><summary>Output of parse-csv()</summary><div class="markup"><p>I propose making some simplifications to the output of parse-csv() to make it more amenable to processing.</p>
<ol>
<li>Represent each row as a map, rather than as a structure with a data field and an accessor function. Note that implementations worried about memory usage can devise a custom map implementation optimised for the case where many maps have the same regular structure. (cf recent thread about Javascript "shapes")</li>
<li>The key for a field in this map should be an integer if (i) column-names is set to false, or (ii) the column in question does not have a unique header name; in other cases it should be the name from the header.</li>
<li>Replace the top-level <code>columns</code> record with a simple array of field names. It's easy enough to map names to positions using index-of.</li>
</ol>
<p>I also propose changing the name to <code>csv-to-maps</code> for consistency with <code>csv-to-table</code> and <code>csv-to-arrays</code>.</p>
<p>We should advocate use of csv-to-arrays where data is to be accessed positionally, and csv-to-maps where it is to be accessed by column names, and optimise the design accordingly.</p>
<p>Looking at a use case, the first example (§15.4.7.1) would be unnecessary if as proposed we change csv-to-xml to generate XHTML directly, But if it were needed, it would change from</p>
<pre><code>let $csv := fn:parse-csv(`name,city{$crlf}Bob,Berlin`)
return &lt;table&gt;
   &lt;thead&gt;{
      for $column in $csv?columns?fields
         return &lt;th&gt;{ $column }&lt;/th&gt;
   }&lt;/thead&gt;
   &lt;tbody&gt;{
      for $row in $csv?rows return &lt;tr&gt;
         { for $field in $row?fields return &lt;td&gt;{ $field }&lt;/td&gt; }
      &lt;/tr&gt;
   }&lt;/tbody&gt;
&lt;/table&gt;
</code></pre>
<p>to</p>
<pre><code>let $csv := fn:parse-csv(`name,city{$crlf}Bob,Berlin`)
return &lt;table&gt;
   &lt;thead&gt;{
      for $column in $csv?columns
         return &lt;th&gt;{ $column }&lt;/th&gt;
   }&lt;/thead&gt;
   &lt;tbody&gt;{
      for $row in $csv?rows return &lt;tr&gt;
         { for $column in $csv?columns return &lt;td&gt;{ $row?$column }&lt;/td&gt; }
      &lt;/tr&gt;
   }&lt;/tbody&gt;
&lt;/table&gt;

</code></pre>
</div></details></div>
<div class="toot" id="created-1017"><h2>Issue #1017 created<span class="toot-id"> #created-1017</span></h2><div class="pubdate">11 Feb at 06:20:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1017">https://github.com/qt4cg/qtspecs/issues/1017</a></div><details><summary>Change csv-to-xml() to produce an XHTML table</summary><div class="markup"><p>I propose (a) renaming <code>csv-to-xml</code> as <code>csv-to-table</code>, and (b) changing the output to be an XHTML table. Specifically, instead of outputting</p>
<pre><code>&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
   &lt;columns&gt;
      &lt;column&gt;name&lt;/column&gt;
      &lt;column&gt;city&lt;/column&gt;
   &lt;/columns&gt;
   &lt;rows&gt;
      &lt;row&gt;
         &lt;field column="name"&gt;Bob&lt;/field&gt;
         &lt;field column="city"&gt;Berlin&lt;/field&gt;
      &lt;/row&gt;
      &lt;row&gt;
         &lt;field column="name"&gt;Alice&lt;/field&gt;
         &lt;field column="city"&gt;Aachen&lt;/field&gt;
      &lt;/row&gt;
   &lt;/rows&gt;
&lt;/csv&gt;
</code></pre>
<p>it should output:</p>
<pre><code>&lt;table xmlns="http://www.w3.org/1999/xhtml"&gt;
   &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;name&lt;/th&gt;
          &lt;th&gt;city&lt;/th&gt;
      &lt;/tr&gt;
   &lt;/thead&gt;
   &lt;tbody&gt;
      &lt;tr&gt;
         &lt;td title="name"&gt;Bob&lt;/td&gt;
         &lt;td title="city"&gt;Berlin&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
         &lt;td title="name"&gt;Alice&lt;/td&gt;
         &lt;td title="city"&gt;Aachen&lt;/td&gt;
      &lt;/tr&gt;
   &lt;/thead&gt;
&lt;/table&gt;
</code></pre>
<h3>Benefits:</h3>
<p>(a) the data is just as easy to manipulate or transform as the current output
(b) it can be copied directly into HTML transformation output if required
(c) it is familiar to users
(d) we don't have to write, test, and document a schema
(e) there may well be libraries that can perform further transformations on the structure, for example conversion to other table representations, extraction to spreadsheet formats, etc.</p>
</div></details></div>
<div class="toot" id="created-1016"><h2>Issue #1016 created<span class="toot-id"> #created-1016</span></h2><div class="pubdate">10 Feb at 21:02:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1016">https://github.com/qt4cg/qtspecs/issues/1016</a></div><details><summary>Editorial comments on fn:parse-csv()</summary><div class="markup"><p>(a) The spec says:</p>
<blockquote>
<p>The first argument is CSV data, as defined in ..., in the form of a sequence of xs:string values.</p>
</blockquote>
<p>But in fact, the argument is a single (optional) xs:string value, not a sequence.</p>
<p>(b) The spec says:</p>
<blockquote>
<p>If $csv is the empty sequence, implementations must return a parsed-csv-structure-record whose rows entry is the empty sequence.</p>
<p>If $csv is the empty sequence, but column name extraction has been requested, or explicit column names have been supplied, then the parsed-csv-structure-record returned by implementations must have a rows entry whose value is the empty sequence.</p>
</blockquote>
<p>The second paragraph seems to add nothing to the first.</p>
<p>(c) And the phrase "<em>implementations must return XXX</em>" is unidiomatic. The normal form of words is "<em>the function returns XXX</em>".</p>
<p>(d) The grammar of the sentence "Handling of delimiters, and whitespace trimming, are handled using..." is inelegant.</p>
<p>(e) References to the record type names (such as parsed-csv-structure-record) should be hyperlinked.</p>
</div></details></div>
<div class="toot" id="created-1015"><h2>Pull request #1015 created<span class="toot-id"> #created-1015</span></h2><div class="pubdate">09 Feb at 12:52:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1015">https://github.com/qt4cg/qtspecs/pull/1015</a></div><details><summary>1013 [XSLT] Clarify effect of accumulator capture on non-element nodes</summary><div class="markup"><p>Adds a sentence saying that when an accumulator rule with capture="yes" matches a non-element node, the capture attribute has no effect.</p>
<p>Fix #1013</p>
</div></details></div>
<div class="toot" id="created-1014"><h2>Issue #1014 created<span class="toot-id"> #created-1014</span></h2><div class="pubdate">08 Feb at 13:43:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1014">https://github.com/qt4cg/qtspecs/issues/1014</a></div><details><summary>Predicates, sequences of numbers: Feedback</summary><div class="markup"><p>Feedback on #996:</p>
<h3>Successful result: early exit</h3>
<p>If the EBV is computed, and if the first item is a node, the remaining items are ignored:</p>
<pre><code class="language-xquery">'OK'[ &lt;a/&gt;, 1, 'x' ]  →  'OK'
</code></pre>
<p>I would suggest doing the same for predicates that start with a number:</p>
<ul>
<li>If a comparison is successful, an implementation should be allowed to skip the remaining comparisons.</li>
<li>If <code>$seq</code> starts with a number, <code>E[$seq]</code> and <code>E[position() = $seq]</code> will become equivalent:</li>
</ul>
<pre><code class="language-xquery">$seq[1 to 100, 'x']
$seq[position() = (1 to 100, 'x')]
</code></pre>
<p>Obviously, an error still needs to be raised if a comparisons leads to a type error.</p>
<h3>Error Codes</h3>
<p>If we don’t equate <code>E[$seq]</code> and <code>E[position() = $seq]</code>, it would be useful to stick with <code>FORG0006</code> (instead of <code>XPTY0004</code>) [1]:</p>
<ul>
<li>It would be confusing to get <code>FORG0006</code> for <code>E['x', 1]</code> and <code>XPTY0004</code> for <code>E[1, 'x']</code>.</li>
<li>If a processor uses unified implementations for EBV and predicate checks, it leads to additional effort just because the error code differs.</li>
</ul>
<p>If we use different error codes, existing tests need to be revised ([2], maybe others).</p>
<p>[1] https://github.com/qt4cg/qtspecs/pull/996/files#diff-b37a92a9eb3ab9ba48a00de9627a1124466b9c86ecb2b4989d04be3942c597a6R8240
[2] https://github.com/qt4cg/qt4tests/blob/70e52c690a26bbeee0641af14ccb319a2cc98081/prod/Predicate.xml#L1158-L1165</p>
</div></details></div>
<div class="toot" id="closed-1012"><h2>Issue #1012 closed<span class="toot-id"> #closed-1012</span></h2><div class="pubdate">08 Feb at 10:50:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1012">https://github.com/qt4cg/qtspecs/pull/1012</a></div><p>Fix some incorrect examples in the F&amp;O spec</p></div>
<div class="toot" id="created-1013"><h2>Issue #1013 created<span class="toot-id"> #created-1013</span></h2><div class="pubdate">08 Feb at 09:14:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1013">https://github.com/qt4cg/qtspecs/issues/1013</a></div><details><summary>[XSLT] Need to say what happens when a capturing accumulator rule matches a non-element node</summary><div class="markup"><p>The option capture="yes" has been added to <code>xsl:accumulator-rule</code>; its purpose is to indicate that the entire subtree under an element is to be captured during streamed processing of the document, and is made available as an in-memory tree once the element end tag has been processed.</p>
<p>We need to say what happens when such a rule matches a node other than an element. I think it makes sense for the capture="yes" to be ignored, optionally with a warning.</p>
</div></details></div>
<div class="toot" id="created-1012"><h2>Pull request #1012 created<span class="toot-id"> #created-1012</span></h2><div class="pubdate">08 Feb at 00:57:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1012">https://github.com/qt4cg/qtspecs/pull/1012</a></div><details><summary>Fix some incorrect examples in the F&amp;O spec</summary><div class="markup"><p>No issue raised; the errors are revealed by the generated QT4 tests.</p>
</div></details></div>
<div class="toot" id="created-1011"><h2>Issue #1011 created<span class="toot-id"> #created-1011</span></h2><div class="pubdate">07 Feb at 20:52:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1011">https://github.com/qt4cg/qtspecs/issues/1011</a></div><details><summary>fn:transform() improvements</summary><div class="markup"><ol>
<li>The spec talks about how to invoke an XSLT 1.0, 2.0, or 3.0 processor, but not a 4.0 processor.</li>
<li>There is no way of supplying a source document in a way that allows streaming. Saxon has added a <code>source-location</code> parameter for this purpose; this should be in the standard.</li>
<li>If the stylesheet is to read streamed input, then there also needs to be control over whether and how it does schema validation.</li>
<li>When calling from XSLT, the best default for <code>base-output-uri</code> is probably the value of <code>current-output-uri()</code>. The default is currently implementation-defined, but we should recommend this possibility.</li>
<li>The post-process option was added with the aspiration that it would enable secondary result documents (xsl:result-document output) to be written directly (e.g. to filestore) as a side-effect. However, it fails to achieve this. There should probably be an option to request this even though we cannot define its semantics precisely.</li>
</ol>
</div></details></div>
<div class="toot" id="created-1010"><h2>Pull request #1010 created<span class="toot-id"> #created-1010</span></h2><div class="pubdate">07 Feb at 16:09:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1010">https://github.com/qt4cg/qtspecs/pull/1010</a></div><details><summary>1009 Examples, Return type of parse-json:fallback</summary><div class="markup"><p>Issue: #1009</p>
<p>I’ve used this PR to fix some other buggy examples in the XQFO spec.</p>
</div></details></div>
<div class="toot" id="created-1009"><h2>Issue #1009 created<span class="toot-id"> #created-1009</span></h2><div class="pubdate">07 Feb at 13:59:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1009">https://github.com/qt4cg/qtspecs/issues/1009</a></div><details><summary>QT4CG-064-03, QT4CG-064-04: Examples, Return type of `fallback`</summary><div class="markup"><p>Thanks for the attentive inspection of #975.</p>
<p>The type <code>xs:untypedAtomic</code> for the <code>fallback</code> function of <code>fn:parse-json</code> made no sense indeed: JSON escape sequence can never be converted to numbers. The return type will be <code>xs:anyAtomicType</code> instead of <code>item()</code> (the result will be converted to a string).</p>
<p>I’ll revise the rules and add some examples.</p>
</div></details></div>
<div class="toot" id="closed-977"><h2>Issue #977 closed<span class="toot-id"> #closed-977</span></h2><div class="pubdate">07 Feb at 13:09:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/977">https://github.com/qt4cg/qtspecs/pull/977</a></div><p>Ignore this, it's just a test</p></div>
<div class="toot" id="created-1008"><h2>Pull request #1008 created<span class="toot-id"> #created-1008</span></h2><div class="pubdate">07 Feb at 11:12:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1008">https://github.com/qt4cg/qtspecs/pull/1008</a></div><details><summary>1002 Add fn:take-while function (replacing subsequence-before)</summary><div class="markup"><p>Adds function <code>fn:take-while</code>, replacing/reinstating previously proposed <code>items-before()</code> and <code>subsequence-before()</code>.</p>
<p>Fix #1002</p>
</div></details></div>
<div class="toot" id="created-1007"><h2>Issue #1007 created<span class="toot-id"> #created-1007</span></h2><div class="pubdate">07 Feb at 09:45:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1007">https://github.com/qt4cg/qtspecs/issues/1007</a></div><details><summary>How to invert a predicate function</summary><div class="markup"><p>It's nice to be able to write</p>
<p><code>index-where($in, contains(?, 'e'))</code></p>
<p>to select all the items that contain an 'e'.</p>
<p>What should we write in order to select all the items that do not contain an 'e'? All formulations seem a bit clumsy in comparison:</p>
<p><code>index-where($in, fn{not(contains(., 'e'))})</code>
<code>index-where($in, chain((contains(?, 'e'), not#1))</code></p>
<p>Perhaps this is a sufficiently common requirement that it would be helpful to allow</p>
<p><code>index-where($in, inverse(contains(?, 'e')))</code></p>
<p>where <code>inverse($predicate)</code> is defined as <code>fn($it, $pos){not($predicate($it, $pos))}</code></p>
</div></details></div>
<div class="toot" id="created-1006"><h2>Issue #1006 created<span class="toot-id"> #created-1006</span></h2><div class="pubdate">07 Feb at 07:34:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1006">https://github.com/qt4cg/qtspecs/issues/1006</a></div><details><summary>regular expression addition - word boundaries</summary><div class="markup"><p>Could we provide support for the regex character sequence <code>\b</code> for matching word boundaries?</p>
<p>It’s already supported by some processors via vendor-specific flags, and would be very helpful even if didn’t over the full Unicode range.</p>
</div></details></div>
<div class="toot" id="created-1005"><h2>Issue #1005 created<span class="toot-id"> #created-1005</span></h2><div class="pubdate">07 Feb at 07:26:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1005">https://github.com/qt4cg/qtspecs/issues/1005</a></div><details><summary>regular expressions - whitespace</summary><div class="markup"><p>There is some confusion about the rationale for defining the multi-character escape for whitespaces in a <a href="https://xmlcom.slack.com/archives/C011NLXE4DU/p1707158555769749">recent discussion</a> on Slack:</p>
<ul>
<li><code>\s</code> is limited to <code>[#x20\t\n\r]</code></li>
<li>In contrast, <code>\w\</code> covers <code>[#x0000-#x10FFFF]-[\p{P}\p{Z}\p{C}]</code>, i.e., considers the full Unicode range</li>
</ul>
<p>Do we know the reason?</p>
<p>I assume it’s both too late and out of scope to change that in our specs, but maybe we can improve the XQFO spec and…</p>
<ul>
<li>mention why <code>\s</code> does not include <code>\p{Zs}</code> or <code>\p{Z}</code></li>
<li>add an example for looking up non-breaking spaces… for example:</li>
</ul>
<pre><code class="language-xquery">matches(
  string-join(('my', 'pleasure'), char(0xA0)),
  '\p{Z}'
)
</code></pre>
</div></details></div>
<div class="toot" id="closed-1004"><h2>Issue #1004 closed<span class="toot-id"> #closed-1004</span></h2><div class="pubdate">07 Feb at 06:56:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1004">https://github.com/qt4cg/qtspecs/pull/1004</a></div><p>fn:char updated as agreed 2024-02-06: drop the form char('#x20')</p></div>
<div class="toot" id="created-1004"><h2>Pull request #1004 created<span class="toot-id"> #created-1004</span></h2><div class="pubdate">07 Feb at 06:43:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1004">https://github.com/qt4cg/qtspecs/pull/1004</a></div><details><summary>fn:char updated as agreed 2024-02-06: drop the form char('#x20')</summary><div class="markup"><p>The forms char('#32`) and char('#x20') are dropped.</p>
</div></details></div>
<div class="toot" id="closed-963"><h2>Issue #963 closed<span class="toot-id"> #closed-963</span></h2><div class="pubdate">07 Feb at 06:41:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/963">https://github.com/qt4cg/qtspecs/issues/963</a></div><p>Errors in forming function items (continued)</p></div>
<div class="toot" id="closed-888"><h2>Issue #888 closed<span class="toot-id"> #closed-888</span></h2><div class="pubdate">07 Feb at 06:41:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/888">https://github.com/qt4cg/qtspecs/issues/888</a></div><p>Reclassify XPDY0002 as a type error</p></div>
<div class="toot" id="closed-992"><h2>Issue #992 closed<span class="toot-id"> #closed-992</span></h2><div class="pubdate">07 Feb at 06:41:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/992">https://github.com/qt4cg/qtspecs/pull/992</a></div><p>888, 963: Error handling for unsatisfied context dependencies</p></div>
<div class="toot" id="created-1003"><h2>Pull request #1003 created<span class="toot-id"> #created-1003</span></h2><div class="pubdate">07 Feb at 00:05:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1003">https://github.com/qt4cg/qtspecs/pull/1003</a></div><details><summary>919 Use EBV in boolean callbacks</summary><div class="markup"><p>Changes functions with a $predicate callback function to use the effective boolean value of the result, mainly to allow things like <code>index-where(*, fn{self::x})</code>.</p>
<p>Fix #919</p>
</div></details></div>
<div class="toot" id="minutes-02-06"><h2>QT4 CG meeting 064 draft minutes<span class="toot-id"> #minutes-02-06</span></h2><div class="pubdate">06 Feb at 18:00:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/02-06">https://qt4cg.org/meeting/minutes/2024/02-06</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-187"><h2>Issue #187 closed<span class="toot-id"> #closed-187</span></h2><div class="pubdate">06 Feb at 17:50:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/187">https://github.com/qt4cg/qtspecs/issues/187</a></div><p>Add a 'while' clause to FLWOR expressions</p></div>
<div class="toot" id="closed-943"><h2>Issue #943 closed<span class="toot-id"> #closed-943</span></h2><div class="pubdate">06 Feb at 17:49:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/943">https://github.com/qt4cg/qtspecs/pull/943</a></div><p>187 Add FLWOR expression while clause</p></div>
<div class="toot" id="closed-260"><h2>Issue #260 closed<span class="toot-id"> #closed-260</span></h2><div class="pubdate">06 Feb at 17:46:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/260">https://github.com/qt4cg/qtspecs/issues/260</a></div><p>array:index-of</p></div>
<div class="toot" id="closed-968"><h2>Issue #968 closed<span class="toot-id"> #closed-968</span></h2><div class="pubdate">06 Feb at 17:46:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/968">https://github.com/qt4cg/qtspecs/pull/968</a></div><p>260 array:index-of</p></div>
<div class="toot" id="closed-969"><h2>Issue #969 closed<span class="toot-id"> #closed-969</span></h2><div class="pubdate">06 Feb at 17:43:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/969">https://github.com/qt4cg/qtspecs/pull/969</a></div><p>843-partial Standard, array &amp; map functions: Equivalencies</p></div>
<div class="toot" id="closed-973"><h2>Issue #973 closed<span class="toot-id"> #closed-973</span></h2><div class="pubdate">06 Feb at 17:40:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/973">https://github.com/qt4cg/qtspecs/issues/973</a></div><p>fn:parse-json, fn:json-to-xml: `number-parser`, `fallback`</p></div>
<div class="toot" id="closed-975"><h2>Issue #975 closed<span class="toot-id"> #closed-975</span></h2><div class="pubdate">06 Feb at 17:40:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/975">https://github.com/qt4cg/qtspecs/pull/975</a></div><p>973 fn:parse-json, fn:json-to-xml: number-parser, fallback</p></div>
<div class="toot" id="closed-984"><h2>Issue #984 closed<span class="toot-id"> #closed-984</span></h2><div class="pubdate">06 Feb at 17:37:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/984">https://github.com/qt4cg/qtspecs/pull/984</a></div><p>959-partial Add fn:seconds function</p></div>
<div class="toot" id="closed-993"><h2>Issue #993 closed<span class="toot-id"> #closed-993</span></h2><div class="pubdate">06 Feb at 17:34:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/993">https://github.com/qt4cg/qtspecs/pull/993</a></div><p>989 (partial) Allow char() to take integer argument</p></div>
<div class="toot" id="closed-830"><h2>Issue #830 closed<span class="toot-id"> #closed-830</span></h2><div class="pubdate">06 Feb at 17:31:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/830">https://github.com/qt4cg/qtspecs/issues/830</a></div><p>Revise appendix D.4 of F+O: Illustrative user-written functions</p></div>
<div class="toot" id="closed-997"><h2>Issue #997 closed<span class="toot-id"> #closed-997</span></h2><div class="pubdate">06 Feb at 17:31:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/997">https://github.com/qt4cg/qtspecs/pull/997</a></div><p>830 Drop F+O appendix D.4</p></div>
<div class="toot" id="closed-816"><h2>Issue #816 closed<span class="toot-id"> #closed-816</span></h2><div class="pubdate">06 Feb at 17:28:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/816">https://github.com/qt4cg/qtspecs/issues/816</a></div><p>Predicates: Support for numeric sequences </p></div>
<div class="toot" id="closed-996"><h2>Issue #996 closed<span class="toot-id"> #closed-996</span></h2><div class="pubdate">06 Feb at 17:28:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/996">https://github.com/qt4cg/qtspecs/pull/996</a></div><p>816 Allow a predicate in a filter expression to be a sequence of numbers</p></div>
<div class="toot" id="closed-995"><h2>Issue #995 closed<span class="toot-id"> #closed-995</span></h2><div class="pubdate">06 Feb at 17:25:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/995">https://github.com/qt4cg/qtspecs/pull/995</a></div><p>937 (fn:hash) revised in light of CG feedback</p></div>
<div class="toot" id="closed-628"><h2>Issue #628 closed<span class="toot-id"> #closed-628</span></h2><div class="pubdate">06 Feb at 17:22:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/628">https://github.com/qt4cg/qtspecs/issues/628</a></div><p>distinct-values and duplicate-values: order of results</p></div>
<div class="toot" id="closed-987"><h2>Issue #987 closed<span class="toot-id"> #closed-987</span></h2><div class="pubdate">06 Feb at 17:22:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/987">https://github.com/qt4cg/qtspecs/pull/987</a></div><p>628 Define result order for distinct-values and duplicate-values</p></div>
<div class="toot" id="closed-911"><h2>Issue #911 closed<span class="toot-id"> #closed-911</span></h2><div class="pubdate">06 Feb at 17:19:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/911">https://github.com/qt4cg/qtspecs/issues/911</a></div><p>Type "Promotion" in the coercion rules</p></div>
<div class="toot" id="closed-980"><h2>Issue #980 closed<span class="toot-id"> #closed-980</span></h2><div class="pubdate">06 Feb at 17:19:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/980">https://github.com/qt4cg/qtspecs/pull/980</a></div><p>911 Coercion to allow double to decimal etc</p></div>
<div class="toot" id="closed-966"><h2>Issue #966 closed<span class="toot-id"> #closed-966</span></h2><div class="pubdate">06 Feb at 17:14:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/966">https://github.com/qt4cg/qtspecs/issues/966</a></div><p>Rewrite spec of deep lookup operator: edits</p></div>
<div class="toot" id="closed-979"><h2>Issue #979 closed<span class="toot-id"> #closed-979</span></h2><div class="pubdate">06 Feb at 17:14:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/979">https://github.com/qt4cg/qtspecs/pull/979</a></div><p>966 Minor fixes to deep lookup </p></div>
<div class="toot" id="closed-964"><h2>Issue #964 closed<span class="toot-id"> #closed-964</span></h2><div class="pubdate">06 Feb at 17:12:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/964">https://github.com/qt4cg/qtspecs/issues/964</a></div><p>fn:has-attributes</p></div>
<div class="toot" id="closed-970"><h2>Issue #970 closed<span class="toot-id"> #closed-970</span></h2><div class="pubdate">06 Feb at 17:11:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/970">https://github.com/qt4cg/qtspecs/issues/970</a></div><p>XQFO: Context item → value</p></div>
<div class="toot" id="closed-971"><h2>Issue #971 closed<span class="toot-id"> #closed-971</span></h2><div class="pubdate">06 Feb at 17:11:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/971">https://github.com/qt4cg/qtspecs/pull/971</a></div><p>970 XQFO: Context item → value</p></div>
<div class="toot" id="created-1002"><h2>Issue #1002 created<span class="toot-id"> #created-1002</span></h2><div class="pubdate">06 Feb at 10:10:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1002">https://github.com/qt4cg/qtspecs/issues/1002</a></div><details><summary>Reinstate subsequence-before</summary><div class="markup"><p>There's a question on StackOverflow today:</p>
<p>https://stackoverflow.com/questions/77944304/</p>
<p>that makes me think dropping <code>subsequence-before</code> might have been a mistake (the replacement, <code>subsequence-where</code>, doesn't allow the end condition to be exclusive).</p>
<p>The question is how to find all the consecutive <code>list</code> elements that follow a given <code>para</code> element. That would be solved with <code>subsequence-before(following-sibling::*, fn{not(self::list)})</code>. Doing it with <code>subsequence-where</code> is much harder - you need to drop the final element in the result if it is not a <code>list</code> element, while also taking into account that the result might be empty.</p>
<p>I would like to propose reinstating subsequence-before; or perhaps inverting the predicate and naming it <code>subsequence-while()</code>, so it becomes <code>subsequence-while(following-sibling::*, fn{self::list})</code> assuming we accept the proposal in issue #919 to allow a callback predicate to use EBV.</p>
</div></details></div>
<div class="toot" id="created-1001"><h2>Issue #1001 created<span class="toot-id"> #created-1001</span></h2><div class="pubdate">05 Feb at 13:32:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1001">https://github.com/qt4cg/qtspecs/issues/1001</a></div><details><summary>fn:subsequence-where: equivalent `fn:slice` expression</summary><div class="markup"><p>I probably should have tagged #940 with »Request Changes«, as I believe the equivalent expression with <code>fn:slice</code> needs to be fixed (or removed if it turns out to be too quirky): https://github.com/qt4cg/qtspecs/pull/940#issuecomment-1919399348.</p>
</div></details></div>
<div class="toot" id="agenda-02-06"><h2>QT4 CG meeting 064 draft agenda<span class="toot-id"> #agenda-02-06</span></h2><div class="pubdate">05 Feb at 12:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/02-06">https://qt4cg.org/meeting/agenda/2024/02-06</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-940"><h2>Issue #940 closed<span class="toot-id"> #closed-940</span></h2><div class="pubdate">05 Feb at 12:19:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/940">https://github.com/qt4cg/qtspecs/pull/940</a></div><p>878 Add subsequence-where function</p></div>
<div class="toot" id="created-1000"><h2>Issue #1000 created<span class="toot-id"> #created-1000</span></h2><div class="pubdate">04 Feb at 08:34:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1000">https://github.com/qt4cg/qtspecs/issues/1000</a></div><details><summary>XQFO Code in the Rules sections</summary><div class="markup"><p>In #978, it’s being discussed what is the best language for presenting code in the Rules sections of the XQFO specification. Currently, XPath is used for compact equivalencies, for example…</p>
<pre><code class="language-xquery">(: array:size :)
count(array:members($array))

(: fn:remove :)
$input[not(position() = $positions)].
</code></pre>
<p>...while XQuery is used for more complex expressions, including function declarations, or when the XPath representation would be syntactically more complex. Examples:</p>
<pre><code class="language-xquery">(: fn:deep-equal :)
declare function equal-strings(
  $string1   as xs:string,
  $string2   as xs:string, 
  $collation as xs:string,
  $options   as map(*)
) as xs:boolean {
  let $n1 := if ($options?whitespace = "normalize"))
             then normalize-unicode(?, $options?normalization-form) 
             else identity#1
  let $n2 := if ($options?normalize-space)
             then normalize-space#1 
             else identity#1               
  return compare($n1($n2($string1)), $n1($n2($string2)), $collation) eq 0    
}

(: fn:index-where :)
for $item at $pos in $input
where $predicate($item, $pos)
return $pos

(: …flatten, fold-left, while-do, others :)
</code></pre>
<p>Finally, we have many cases in which XPath/XQuery code is omitted, either because the presented feature is basic enough, because the equivalent code would get too complicated, or (e.g., for <code>fn:doc</code>) because it does not provide means to express the feature.</p>
<p>We should strive for consistency and decide which language(s) the majority of us believes is the best choice…</p>
<ol>
<li>XPath &amp; XQuery (what we currently have)</li>
<li>XPath only</li>
<li>XPath, XQuery and XSLT (whatever seems most appropriate)</li>
<li>Other pseudocode</li>
<li>Don’t use pseudocode at all  if it is too complex to be represented with moderately simple XPath code</li>
</ol>
</div></details></div>
<div class="toot" id="created-999"><h2>Issue #999 created<span class="toot-id"> #created-999</span></h2><div class="pubdate">04 Feb at 04:00:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/999">https://github.com/qt4cg/qtspecs/issues/999</a></div><details><summary>regular expression addition - comments</summary><div class="markup"><p>The original Perl regular expression syntax allows comments with the x flag. They use # to introduce comments up to a newline.</p>
<p>Maybe we could support XPath-style comments in regular expressions, such as <code>(:#.......#:)</code> when the x flag is present?</p>
<p>Today i use <code>(?:comment: stuff here )?</code> but this requires that "stuff here" can be compiled into a regular expression!</p>
</div></details></div>
<div class="toot" id="created-998"><h2>Issue #998 created<span class="toot-id"> #created-998</span></h2><div class="pubdate">04 Feb at 03:57:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/998">https://github.com/qt4cg/qtspecs/issues/998</a></div><details><summary>regular expression addition - lookbehind assertions and lookahead assertions</summary><div class="markup"><p>look-ahead assertions are i think the most useful things not found in qt regular expressions, and also look-behind.</p>
<p>This lets you do things like</p>
<pre><code>  replace( ., '
     / ( [^/]+ ) (*positive_lookahead: /)
    ', '...', 'x')
</code></pre>
<p>replacing components between /..../ but not consuming the trailing /, so that
/a/b/c/d/ comes out as /../../../../</p>
<p>Perl uses
(?=pattern), (*pla:pattern), (*positive_lookahead:pattern)
(?!pattern), (*nla:pattern), (*negative_lookahead:pattern)
to match only if the pattern is (or is not) followed by a match to pattern,</p>
<p>and
(?&lt;=pattern), \K, (*plb:pattern), (*popsitive_lookbehind:pattern)
(?&lt;!pattern), (*nlb:pattern), (*negative_lookbehind:pattern)
for zero-width look-behind assertions.</p>
<p>Note, libpcre (and older Perl version) restrict lookbehind assertions to fixed length. You can write
(?&lt;=dog|cat) food
to match " food" preceded by "dog" or "cat", but you cannot write
(?&lt;=dogs?|cats?) barking</p>
<p>\C is also forbidden, as are capturing subgroups. But the facility is still very useful, and reduces the need for repeated substitutions.</p>
<p>I propose adding only the first form in each case, not the newer "*" forms, which are less widely supported.</p>
</div></details></div>
<div class="toot" id="created-997"><h2>Pull request #997 created<span class="toot-id"> #created-997</span></h2><div class="pubdate">03 Feb at 22:29:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/997">https://github.com/qt4cg/qtspecs/pull/997</a></div><details><summary>830 Drop F+O appendix D.4</summary><div class="markup"><p>This PR drops the non-normative appendix D.4, which contained illustrative user-written functions. It was a very patchy and disorganised collection of functions which were primarily there because someone had proposed adding a function to the standard library and the WG had turned down the suggestion on the grounds that users could easily write the function themselves. It's not worth the effort of rewriting the appendix to take 4.0 enhancements into account.</p>
<p>Fix #830</p>
</div></details></div>
<div class="toot" id="created-996"><h2>Pull request #996 created<span class="toot-id"> #created-996</span></h2><div class="pubdate">03 Feb at 18:16:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/996">https://github.com/qt4cg/qtspecs/pull/996</a></div><details><summary>816 Allow a predicate in a filter expression to be a sequence of numbers</summary><div class="markup"><p>Fix #816</p>
</div></details></div>
<div class="toot" id="created-995"><h2>Pull request #995 created<span class="toot-id"> #created-995</span></h2><div class="pubdate">03 Feb at 03:34:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/995">https://github.com/qt4cg/qtspecs/pull/995</a></div><details><summary>937 (fn:hash) revised in light of CG feedback</summary><div class="markup"><p>This revises #937 (catalyzed by #779) in light CG discussion that approved the PR.</p>
<ul>
<li>Output is now <code>xs:hexBinary?</code></li>
<li>Second parameter <code>$algorithm</code> replaced with an option map. In the specs I avoided <code>fos:values/fos:value</code>, because this would disallow for case/space normalization, and it would effectively disallow any implement-defined algorithms not on the list of three algorithms, and trigger the dynamic error described in rule 6 in the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#option-parameter-conventions">option parameter conventions</a>.</li>
<li>Options map has only one option. It doesn't make sense to provide an option changing the kind of output.</li>
<li>I think this is the first example of an options map where the <code>fos:meaning</code> has rich text (paragraphs, unordered lists). It builds and renders fine locally.</li>
<li>Extra note on the output format.</li>
<li>Examples are expressed as chained functions, to illustrate how to get the customary string values.</li>
</ul>
</div></details></div>
<div class="toot" id="created-994"><h2>Issue #994 created<span class="toot-id"> #created-994</span></h2><div class="pubdate">02 Feb at 20:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/994">https://github.com/qt4cg/qtspecs/issues/994</a></div><details><summary>Invoking maps &amp; arrays: allow sequences?</summary><div class="markup"><p>Can’t we support integer sequences as arguments in dynamic function calls on maps and arrays?</p>
<p>The following query is already valid…</p>
<pre><code class="language-xquery">[ 3, 4, 5 ] ? (2, 1)
</code></pre>
<p>…but the number of users who are able to decode this syntax is very limited. It would be easier to allow:</p>
<pre><code class="language-xquery">[ 3, 4, 5 ](2, 1)
</code></pre>
<p>I would expect the results to be returned in the supplied order (<code>4</code> and <code>3</code>).</p>
</div></details></div>
<div class="toot" id="created-993"><h2>Pull request #993 created<span class="toot-id"> #created-993</span></h2><div class="pubdate">02 Feb at 18:39:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/993">https://github.com/qt4cg/qtspecs/pull/993</a></div><details><summary>989 (partial) Allow char() to take integer argument</summary><div class="markup"><p>Addresses the use case in issue #989. (But leave the issue open for now).</p>
<p>Discussion point: should we drop the options <code>char("#32")</code> and <code>char("#x20")</code> as they now seem redundant?</p>
</div></details></div>
<div class="toot" id="created-992"><h2>Pull request #992 created<span class="toot-id"> #created-992</span></h2><div class="pubdate">02 Feb at 18:17:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/992">https://github.com/qt4cg/qtspecs/pull/992</a></div><details><summary>888, 963: Error handling for unsatisfied context dependencies</summary><div class="markup"><p>Fix #963 by providing more detail on the expected error handling for partial function application.</p>
<p>Fix #888 by making XPDY0002 a type error rather than a dynamic error.</p>
</div></details></div>
<div class="toot" id="created-991"><h2>Issue #991 created<span class="toot-id"> #created-991</span></h2><div class="pubdate">02 Feb at 17:52:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/991">https://github.com/qt4cg/qtspecs/issues/991</a></div><details><summary>Invisible-xml - missing details</summary><div class="markup"><p>The spec for invisible-xml doesn't say whether the parsing function returns an element node or a document node.</p>
<p>It should also say, for completeness, that the parsing function is "nondeterministic with respect to node identity" - that is, if you parse the same input twice, its undefined whether you get the same node twice, or different nodes.</p>
</div></details></div>
<div class="toot" id="created-990"><h2>Issue #990 created<span class="toot-id"> #created-990</span></h2><div class="pubdate">02 Feb at 10:20:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/990">https://github.com/qt4cg/qtspecs/issues/990</a></div><details><summary>Transitive closure on non-nodes</summary><div class="markup"><p>In PR #988 I inadvertently used the transitive-closure function to process non-nodes; that's not supported by the current specification of the function.</p>
<p>The only difficulty in extending it is how to define a suitable identity comparator so we know when to terminate. Probably this should be done using a callback, defaulting to <code>op('is')</code>. In the use case of PR #988, the comparator could be supplied as <code>false#0</code> - the step function is acyclic, so we can treat all items reached as distinct.</p>
</div></details></div>
<div class="toot" id="created-989"><h2>Issue #989 created<span class="toot-id"> #created-989</span></h2><div class="pubdate">01 Feb at 12:19:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/989">https://github.com/qt4cg/qtspecs/issues/989</a></div><details><summary>character sequence constructor 'a' to 'z'</summary><div class="markup"><p>Although you can write 'a' to 'z' as</p>
<pre><code class="language-xpath">   (string-to-codepoints('a') to string-to-codepoints('z') ! codepoints-to-string()
</code></pre>
<p>i’m not sure this is easily discoverable.</p>
<p>Note, 'a' to 'z' is obviously dependent on the current collation - if you're using EBCDIC may the dogs help you. I’m assuming, however, any two Unicode characters could appear in the string literals, and it’d be an error to have more than one character in either string.</p>
<p>This means 'ċ' to 'ŗ’ would be an error, not equivalent to 'c' to 'r' (taking the first character of each string), since those are not precomposed forms.</p>
<p>Mostly, i tend to write this because of other languages - e.g. Perl has 'a' .. 'ÿ' or whatever, as does Ruby.</p>
<p>ICU in Python has UnicodeSet('[[:Ll:]&amp;[:Latin:]]') which is powerful but grokhard (&amp; here is intersect i think).</p>
<p>Although 'a' to 'z' is probably what i've seen &amp; used most often, 'a' to 'f' and '0' to '9' are also obvious candidates.</p>
</div></details></div>
<div class="toot" id="created-988"><h2>Pull request #988 created<span class="toot-id"> #created-988</span></h2><div class="pubdate">01 Feb at 11:59:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/988">https://github.com/qt4cg/qtspecs/pull/988</a></div><details><summary>960 Pinned and labeled values</summary><div class="markup"><p>This PR introduces the concepts of pinned and labelled values and the way in which they can be used to obtain additional information about the results of a deep lookup or map/array navigation operation. The changes at this stage are confined to a new section in the data model spec introducing the concept of labeled items, and a new section in the XPath language spec showing how these are used when navigating maps and arrays. This is a first step; if the WG approves of the general approach, there will be a lot more detail to add in due course.</p>
<p>The PR addresses a number of open issues:</p>
<p>Issue #960 - flattening of results from $map??KS
Issue #711 - using annotations for navigation of JSON trees
Issue #596 - pinned values: transforming trees
Issue #350 - CompPath (composite objects path) expressions
Issue #334 - Transient properties: selection and update in maps and arrays
Issue #262 - navigation in deep-structured arrays
Issue #108 - template match using values of tunnel parameters</p>
<p>It does not claim to resolve them all, but I believe it provides the groundwork for doing so.</p>
</div></details></div>
<div class="toot" id="created-987"><h2>Pull request #987 created<span class="toot-id"> #created-987</span></h2><div class="pubdate">31 Jan at 22:45:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/987">https://github.com/qt4cg/qtspecs/pull/987</a></div><details><summary>628 Define result order for distinct-values and duplicate-values</summary><div class="markup"><p>Fix #628</p>
</div></details></div>
<div class="toot" id="created-986"><h2>Issue #986 created<span class="toot-id"> #created-986</span></h2><div class="pubdate">31 Jan at 17:07:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/986">https://github.com/qt4cg/qtspecs/issues/986</a></div><details><summary>Numeric Comparisons</summary><div class="markup"><p>We've been trying to change the semantics of numeric comparison without breaking existing applications. As a result, the current status quo is very messy. Let's review where we are.</p>
<p>The eq/lt operators, given mixed operand types, convert decimal operands to double and compare as double. No change from 3.1. This comparison is not transitive in edge cases. The <code>=</code> and <code>&lt;</code> operators are defined in terms of <code>eq</code> and <code>lt</code>.</p>
<p>Map key comparisons compare as "infinite precision decimal". No change from 3.1. This comparison is now exposed as fn:atomic-equal().</p>
<p>deep-equal() refers to atomic-equal(), which is a change in behaviour from 3.1.</p>
<p>distinct-values() refers to deep-equal(), which is a change in behaviour - deliberate, because it needs to be transitive.</p>
<p>index-of() refers to eq. No change from 3.1.</p>
<p>compare() has been newly introduced; like atomic-equal() it uses infinite precision decimal for comparison.</p>
<p>sort() uses compare(). This is a change from 3.1; again needed because transitivity is important.</p>
<p>min() and max() use compare(). This is a change from 3.1.</p>
<p>The new highest() and lowest() functions use sort().</p>
<p>XSLT for-each-group refers to distinct-values().</p>
<p>XSLT xsl:sort currently refers to numeric-compare() and will presumably change to use compare().</p>
<p>XSLT xsl:merge refers to xsl:sort</p>
<p>XQuery "group by" refers to deep-equal()</p>
<p>XQuery "order by" refers to compare()</p>
<p>So:</p>
<ul>
<li>Nearly everything now uses decimal comparison where the operands are of mixed type</li>
<li>There are many different ways that we say this - it's often indirect. There are only two comparison methods, but you have to follow a chain of references to work out which one applies.</li>
<li>The two exceptions that still do comparison the 3.1 way (converting both operands to xs:double) are (a) the eq/lt/=/&lt; operators, and (b) the index-of and array:index-of functions.</li>
</ul>
<p>There are definitely things that now break. For example I was working on tests yesterday with assertions in the form deep-equal(nodes/number(.), (8.2, 5.4, 6.5)) - that is, comparing doubles to decimals. The nodes actually contain the strings "8.2", "5.4", "6.5". The test was failing because converting the string "8.2" to a double and then converting the double to a decimal does not produce the decimal value 8.2.</p>
<p>This mixed bag really doesn't seem acceptable. What options do we have?</p>
<ol>
<li>Be bold: make everything uniformly use transitive comparisons, and accept that some user code will break.</li>
<li>Be timid: use transitive comparisons only where it really matters (distinct-values, grouping, sorting) and use promotion to double everywhere else.</li>
<li>Compromise: introduce a compatibility mode, or a context option that allows users to control the behaviour, or another set of comparison operators.</li>
</ol>
<p>Any other ideas?</p>
</div></details></div>
<div class="toot" id="created-985"><h2>Pull request #985 created<span class="toot-id"> #created-985</span></h2><div class="pubdate">31 Jan at 12:29:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/985">https://github.com/qt4cg/qtspecs/pull/985</a></div><details><summary>720 Add lookup arrow expressions (method invocations)</summary><div class="markup"><p>Fix #720.</p>
<p>Replaces #916.</p>
</div></details></div>
<div class="toot" id="closed-948"><h2>Issue #948 closed<span class="toot-id"> #closed-948</span></h2><div class="pubdate">31 Jan at 10:10:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/948">https://github.com/qt4cg/qtspecs/issues/948</a></div><p>fn:scan-left and fn:scan-right - produce accumulation of results</p></div>
<div class="toot" id="created-984"><h2>Pull request #984 created<span class="toot-id"> #created-984</span></h2><div class="pubdate">31 Jan at 10:00:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/984">https://github.com/qt4cg/qtspecs/pull/984</a></div><details><summary>959-partial Add fn:seconds function</summary><div class="markup"><p>Issue: #959</p>
</div></details></div>
<div class="toot" id="created-983"><h2>Issue #983 created<span class="toot-id"> #created-983</span></h2><div class="pubdate">31 Jan at 09:30:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/983">https://github.com/qt4cg/qtspecs/issues/983</a></div><details><summary>fn:reduce (or fn:fold without initial value)</summary><div class="markup"><p>Various languages (Kotlin, F#, Haskell, Rust, Scala, others) offer two functions for what we summarize as folds: one that accepts an initial value and another one that consumes the first item of the input as initial value. The first function is usually called <code>fold</code>, the latter is called <code>reduce</code>, but some languages (like JavaScript) pack the functionality into a single function.</p>
<p>We have the same options:</p>
<ol>
<li>We could tweak <code>fn:fold-left</code> and <code>fn:fold-right</code> in a way that the <code>zero</code> argument is ignored if it’s not explicitly supplied:</li>
</ol>
<pre><code class="language-xquery">fold-left(1 to 5, action := op('*'))
</code></pre>
<p>However, the behavior would then differ from <code>fold-left(1 to 5, (), action := op('*'))</code>, which is something we tried to avoid in more recent functions (there are functions like <code>fn:name</code>, though, that behave similarly: <code>fn:name(())</code> and <code>fn:name()</code> does something different).</p>
<ol start="2">
<li>We could also introduce a separate function <code>fn:reduce</code> (or 2 variants, resp. 4 if we include arrays):</li>
</ol>
<pre><code class="language-xquery">fn:reduce(
  $input   as item()*,
  $action  as function(item()*, item()) as item()*
) as item()*
</code></pre>
<p>This would allow us to do  <code>reduce(1 to 5, op('*'))</code>, and for some people, a reduce function will be more familiar than a fold.</p>
<p>On Wikipedia, there’s a good summary on <a href="https://en.wikipedia.org/wiki/Fold_(higher-order_function)#In_various_languages">folds in various languages</a>.</p>
</div></details></div>
<div class="toot" id="created-982"><h2>Issue #982 created<span class="toot-id"> #created-982</span></h2><div class="pubdate">31 Jan at 08:57:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/982">https://github.com/qt4cg/qtspecs/issues/982</a></div><details><summary>scan-left, scan-right: position argument, array functions</summary><div class="markup"><p>We have added an optional position argument to nearly all callback functions that are invoked once for each item in a sequence. This argument is omitted from the new scan-left and scan-right functions. It should be added for consistency.</p>
<p>One of the proposed use cases for scan-left and scan-right is for debugging calls on fold-left and fold-right. This use case requires that the callback functions in the two cases are compatible.</p>
<p>Background note: the optional position argument is modelled on Javascript, where it is permitted in all the common higher-order functions such as <code>filter</code>, <code>forEach</code>, <code>reduce</code> and <code>reduceRight</code> (which are the Javascript equivalent of fold-left and fold-right). Javascript doesn't appear to offer an equivalent of <code>scan-left</code> and <code>scan-right</code>.</p>
</div></details></div>
<div class="toot" id="created-981"><h2>Issue #981 created<span class="toot-id"> #created-981</span></h2><div class="pubdate">31 Jan at 00:34:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/981">https://github.com/qt4cg/qtspecs/issues/981</a></div><details><summary>Identify optional arguments in callback functions</summary><div class="markup"><p>It was pointed out today that is not obvious, looking at a function signature like</p>
<pre><code>fn:filter(
  $input as&nbsp;item()*, | &nbsp;
  $predicate as&nbsp;function(item(), xs:integer) as xs:boolean | &nbsp;
)&nbsp;as&nbsp;item()*
</code></pre>
<p>that the second argument of the <code>$predicate</code> function is optional.</p>
<p>At least in the documentation, it would be useful to capture this in some way. Being "optional" here means that it makes sense, semantically, to supply an arity-1 function, in which case the caller will not supply the second argument.</p>
<p>Perhaps it would also be useful to go beyond documentation, and attach some syntax and semantics to it. Specifically, if the signature of the callback function indicates that the first N arguments are required, then supplying a function item of arity less than N will result in a type error.</p>
</div></details></div>
<div class="toot" id="created-980"><h2>Pull request #980 created<span class="toot-id"> #created-980</span></h2><div class="pubdate">30 Jan at 23:59:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/980">https://github.com/qt4cg/qtspecs/pull/980</a></div><details><summary>911 Coercion to allow double to decimal etc</summary><div class="markup"><p>Fix #911 The coercion rules are changed to allow implicit casts among numeric types, for example a double can be supplied where the required type is decimal. (The term "promotion" is now used only for operators, where the two operands must be converted to a common type.)</p>
</div></details></div>
<div class="toot" id="created-979"><h2>Pull request #979 created<span class="toot-id"> #created-979</span></h2><div class="pubdate">30 Jan at 23:11:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/979">https://github.com/qt4cg/qtspecs/pull/979</a></div><details><summary>966 Minor fixes to deep lookup </summary><div class="markup"><p>Fix #966</p>
<p>Apply suggestions in Christian Grün's comments on PR #927.</p>
</div></details></div>
<div class="toot" id="created-978"><h2>Pull request #978 created<span class="toot-id"> #created-978</span></h2><div class="pubdate">30 Jan at 21:14:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/978">https://github.com/qt4cg/qtspecs/pull/978</a></div><details><summary>948 Reflected the comments of the CG on the specification of scan-left and scan-right</summary><div class="markup"><p>Reflected the comments of the CG on the specification of scan-left and scan-right</p>
</div></details></div>
<div class="toot" id="created-977"><h2>Pull request #977 created<span class="toot-id"> #created-977</span></h2><div class="pubdate">30 Jan at 17:42:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/977">https://github.com/qt4cg/qtspecs/pull/977</a></div><details><summary>Ignore this, it's just a test</summary><div class="markup"><p>I'm trying to work out why sometimes PR succeeds when it contains markup errors...</p>
</div></details></div>
<div class="toot" id="closed-976"><h2>Issue #976 closed<span class="toot-id"> #closed-976</span></h2><div class="pubdate">30 Jan at 17:32:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/976">https://github.com/qt4cg/qtspecs/pull/976</a></div><p>Fix markup errors with fos:notes</p></div>
<div class="toot" id="created-976"><h2>Pull request #976 created<span class="toot-id"> #created-976</span></h2><div class="pubdate">30 Jan at 17:32:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/976">https://github.com/qt4cg/qtspecs/pull/976</a></div><p>Fix markup errors with fos:notes</p></div>
<div class="toot" id="minutes-01-30"><h2>QT4 CG meeting 063 draft minutes<span class="toot-id"> #minutes-01-30</span></h2><div class="pubdate">30 Jan at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/01-30">https://qt4cg.org/meeting/minutes/2024/01-30</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-957"><h2>Issue #957 closed<span class="toot-id"> #closed-957</span></h2><div class="pubdate">30 Jan at 17:00:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/957">https://github.com/qt4cg/qtspecs/pull/957</a></div><p>948 Added fn:scan-left and fn:scan-right</p></div>
<div class="toot" id="closed-965"><h2>Issue #965 closed<span class="toot-id"> #closed-965</span></h2><div class="pubdate">30 Jan at 16:59:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/965">https://github.com/qt4cg/qtspecs/pull/965</a></div><p>XQFO: minor edits and bug fixes</p></div>
<div class="toot" id="created-975"><h2>Pull request #975 created<span class="toot-id"> #created-975</span></h2><div class="pubdate">29 Jan at 16:32:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/975">https://github.com/qt4cg/qtspecs/pull/975</a></div><details><summary>973 fn:parse-json, fn:json-to-xml: number-parser, fallback</summary><div class="markup"><p>Issue: #973.</p>
<p>In addition, I fixed the description for the <code>fallback</code> option <code>fn:parse-json</code>, as it seemed incomplete to me:</p>
<blockquote>
<p>The function is called when the JSON input contains a special character (as defined under the escape option) that is valid according to the JSON grammar, whether the special character is represented in the input directly or as an escape sequence.</p>
</blockquote>
</div></details></div>
<div class="toot" id="closed-974"><h2>Issue #974 closed<span class="toot-id"> #closed-974</span></h2><div class="pubdate">29 Jan at 12:32:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/974">https://github.com/qt4cg/qtspecs/issues/974</a></div><p>Rules for context-dependent function references in XSLT (e.g. regex-group#1)</p></div>
<div class="toot" id="agenda-01-30"><h2>QT4 CG meeting 063 draft agenda<span class="toot-id"> #agenda-01-30</span></h2><div class="pubdate">29 Jan at 12:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/01-30">https://qt4cg.org/meeting/agenda/2024/01-30</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-974"><h2>Issue #974 created<span class="toot-id"> #created-974</span></h2><div class="pubdate">29 Jan at 12:25:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/974">https://github.com/qt4cg/qtspecs/issues/974</a></div><details><summary>Rules for context-dependent function references in XSLT (e.g. regex-group#1)</summary><div class="markup"><p>I'm not sure where we are on this one.</p>
<p>Does regex-group#1 capture the "current matching substrings" component of the dynamic context?</p>
<p>XSLT 4.0 test case analyze-string-101 suggests that it does, and that this represents a change from 3.0 -- there are separate versions of the test with different expected results for the two cases.</p>
<p>But §5.4 of the XSLT 4.0 spec still ends with the sentence:</p>
<p><code>This rule does not extend to the XSLT extensions to the dynamic context defined in this section. If a dynamic function call is made that depends on the XSLT part of the dynamic context (for example, regex-group#1(2)), then the relevant components of the context are cleared as described in the table above.</code></p>
<p>I suspect this sentence should have been deleted, but need to track down the history.</p>
</div></details></div>
<div class="toot" id="created-973"><h2>Issue #973 created<span class="toot-id"> #created-973</span></h2><div class="pubdate">29 Jan at 12:24:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/973">https://github.com/qt4cg/qtspecs/issues/973</a></div><details><summary>fn:parse-json, fn:json-to-xml: `number-parser`, `fallback`</summary><div class="markup"><ol>
<li>See #33: <code>number-parser</code> option needs to be added to <code>fn:json-to-xml</code>.</li>
<li>Similar to <code>fn:replace</code>, I would suggest using <code>function(xs:untypedAtomic) as item()?)</code> as signature for both the <code>fallback</code> and the <code>number-parser</code> option, and (for <code>fallback</code>) to invoke <code>fn:string#1</code> on the result. This way, explicit casts in the code get obsolete. Queries like the following one…</li>
</ol>
<pre><code class="language-xquery">parse-json(
  '-123',
  map { 'number-parser': fn($n) { $n =&gt; number() =&gt; abs() }
)
</code></pre>
<p>…can then be simplified to <code>parse-json('-123', abs#1)</code>.</p>
</div></details></div>
<div class="toot" id="created-972"><h2>Pull request #972 created<span class="toot-id"> #created-972</span></h2><div class="pubdate">29 Jan at 11:28:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/972">https://github.com/qt4cg/qtspecs/pull/972</a></div><details><summary>949 Partial Function Applications: Allow return of function name</summary><div class="markup"><p>Issue: #949. The major change is the rule for the <code>name</code> property of partial function applications for static function calls.</p>
<p>In addition, I have unified the presentation of the different function item expressions.</p>
<p>Affects test cases like <code>xqhof40</code> (which need to be fixed with or without this PR).</p>
</div></details></div>
<div class="toot" id="created-971"><h2>Pull request #971 created<span class="toot-id"> #created-971</span></h2><div class="pubdate">29 Jan at 10:20:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/971">https://github.com/qt4cg/qtspecs/pull/971</a></div><details><summary>970 XQFO: Context item → value</summary><div class="markup"><p>Issue: #970</p>
</div></details></div>
<div class="toot" id="created-970"><h2>Issue #970 created<span class="toot-id"> #created-970</span></h2><div class="pubdate">28 Jan at 10:38:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/970">https://github.com/qt4cg/qtspecs/issues/970</a></div><details><summary>XQFO: Context item → value</summary><div class="markup"><p>Resulting from #129 (related: #755): Many rules in the XQFO spec still refer to the context item, which is currently defined as follows:</p>
<blockquote>
<p>When the context value is a single item, it can also be referred to as the context item; when it is a single node, it can also be referred to as the context node.</p>
</blockquote>
<p>We need to make clear what’s going to happen if the context value is not a single item:</p>
<ul>
<li>In many cases, this can simply be done by replacing “context item” with “context value”.</li>
<li>In some cases (e.g. for <code>fn:string#0</code>), we should specify that an error is raised (usually <code>XPTY0004</code>) if the input is not a single item.</li>
</ul>
</div></details></div>
<div class="toot" id="closed-878"><h2>Issue #878 closed<span class="toot-id"> #closed-878</span></h2><div class="pubdate">25 Jan at 08:42:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/878">https://github.com/qt4cg/qtspecs/issues/878</a></div><p>Proposed extension to subsequence</p></div>
<div class="toot" id="created-969"><h2>Pull request #969 created<span class="toot-id"> #created-969</span></h2><div class="pubdate">24 Jan at 18:19:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/969">https://github.com/qt4cg/qtspecs/pull/969</a></div><details><summary>843-partial Standard, array &amp; map functions: Equivalencies</summary><div class="markup"><p>Issue: #843</p>
<p>Maybe we should keep the issue open after merging this PR.</p>
</div></details></div>
<div class="toot" id="created-968"><h2>Pull request #968 created<span class="toot-id"> #created-968</span></h2><div class="pubdate">24 Jan at 17:57:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/968">https://github.com/qt4cg/qtspecs/pull/968</a></div><details><summary>260 array:index-of</summary><div class="markup"><p>Issue: #260</p>
</div></details></div>
<div class="toot" id="created-967"><h2>Issue #967 created<span class="toot-id"> #created-967</span></h2><div class="pubdate">24 Jan at 13:22:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/967">https://github.com/qt4cg/qtspecs/issues/967</a></div><details><summary>XPath Appendix I: Comparisons</summary><div class="markup"><p>Adopted from https://github.com/qt4cg/qtspecs/issues/260#issuecomment-1908033129</p>
<blockquote>
<p>It would be useful if all functions that perform comparison included a cross-reference to the new XPath Appendix I; and I note that appendix doesn't seem to mention index-of.</p>
</blockquote>
<p>@michaelhkay I’ve taken the liberty of assigning this to you, as I wasn’t sure what this is about.</p>
</div></details></div>
<div class="toot" id="closed-874"><h2>Issue #874 closed<span class="toot-id"> #closed-874</span></h2><div class="pubdate">24 Jan at 09:51:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/874">https://github.com/qt4cg/qtspecs/pull/874</a></div><p>878 Proposed extension to subsequence</p></div>
<div class="toot" id="created-966"><h2>Issue #966 created<span class="toot-id"> #created-966</span></h2><div class="pubdate">23 Jan at 20:23:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/966">https://github.com/qt4cg/qtspecs/issues/966</a></div><details><summary>Rewrite spec of deep lookup operator: edits</summary><div class="markup"><p>@michaelhkay I've created a little new issue to keep track of the 3 minor suggestions that I made in the PR that we merged today: https://github.com/qt4cg/qtspecs/pull/927</p>
</div></details></div>
<div class="toot" id="created-965"><h2>Pull request #965 created<span class="toot-id"> #created-965</span></h2><div class="pubdate">23 Jan at 18:20:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/965">https://github.com/qt4cg/qtspecs/pull/965</a></div><p>XQFO: minor edits and bug fixes</p></div>
<div class="toot" id="closed-818"><h2>Issue #818 closed<span class="toot-id"> #closed-818</span></h2><div class="pubdate">23 Jan at 17:52:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/818">https://github.com/qt4cg/qtspecs/issues/818</a></div><p>Foxpath integration</p></div>
<div class="toot" id="closed-693"><h2>Issue #693 closed<span class="toot-id"> #closed-693</span></h2><div class="pubdate">23 Jan at 17:52:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/693">https://github.com/qt4cg/qtspecs/issues/693</a></div><p>QT4 Tests without counterpart in the specs</p></div>
<div class="toot" id="closed-639"><h2>Issue #639 closed<span class="toot-id"> #closed-639</span></h2><div class="pubdate">23 Jan at 17:52:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/639">https://github.com/qt4cg/qtspecs/issues/639</a></div><p>fn:void: Naming, Arguments</p></div>
<div class="toot" id="closed-937"><h2>Issue #937 closed<span class="toot-id"> #closed-937</span></h2><div class="pubdate">23 Jan at 17:50:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/937">https://github.com/qt4cg/qtspecs/pull/937</a></div><p>779 hash function</p></div>
<div class="toot" id="closed-946"><h2>Issue #946 closed<span class="toot-id"> #closed-946</span></h2><div class="pubdate">23 Jan at 17:46:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/946">https://github.com/qt4cg/qtspecs/issues/946</a></div><p>fn:iterate-while → fn:while-do, fn:do-until</p></div>
<div class="toot" id="closed-962"><h2>Issue #962 closed<span class="toot-id"> #closed-962</span></h2><div class="pubdate">23 Jan at 17:46:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/962">https://github.com/qt4cg/qtspecs/pull/962</a></div><p>946 fn:iterate-while → fn:while-do, fn:do-until</p></div>
<div class="toot" id="closed-951"><h2>Issue #951 closed<span class="toot-id"> #closed-951</span></h2><div class="pubdate">23 Jan at 17:42:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/951">https://github.com/qt4cg/qtspecs/issues/951</a></div><p>Parameters with default values: fn:lang, fn:id, fn:idref, fn:element-with-id</p></div>
<div class="toot" id="closed-958"><h2>Issue #958 closed<span class="toot-id"> #closed-958</span></h2><div class="pubdate">23 Jan at 17:41:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/958">https://github.com/qt4cg/qtspecs/pull/958</a></div><p>951 Parameters with default values: fn:lang, fn:id, fn:idref, fn:element-id</p></div>
<div class="toot" id="closed-945"><h2>Issue #945 closed<span class="toot-id"> #closed-945</span></h2><div class="pubdate">23 Jan at 17:38:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/945">https://github.com/qt4cg/qtspecs/issues/945</a></div><p>Module import: apparent contradiction</p></div>
<div class="toot" id="closed-952"><h2>Issue #952 closed<span class="toot-id"> #closed-952</span></h2><div class="pubdate">23 Jan at 17:38:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/952">https://github.com/qt4cg/qtspecs/pull/952</a></div><p>945 module import contradiction</p></div>
<div class="toot" id="closed-950"><h2>Issue #950 closed<span class="toot-id"> #closed-950</span></h2><div class="pubdate">23 Jan at 17:34:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/950">https://github.com/qt4cg/qtspecs/pull/950</a></div><p>Minor edits (examples, rules)</p></div>
<div class="toot" id="closed-939"><h2>Issue #939 closed<span class="toot-id"> #closed-939</span></h2><div class="pubdate">23 Jan at 17:31:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/939">https://github.com/qt4cg/qtspecs/issues/939</a></div><p>Remove fn:numeric-compare</p></div>
<div class="toot" id="closed-941"><h2>Issue #941 closed<span class="toot-id"> #closed-941</span></h2><div class="pubdate">23 Jan at 17:31:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/941">https://github.com/qt4cg/qtspecs/pull/941</a></div><p>939 Remove fn:numeric-compare</p></div>
<div class="toot" id="closed-936"><h2>Issue #936 closed<span class="toot-id"> #closed-936</span></h2><div class="pubdate">23 Jan at 17:28:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/936">https://github.com/qt4cg/qtspecs/pull/936</a></div><p>877 revised rules for op:binary-less-than</p></div>
<div class="toot" id="closed-861"><h2>Issue #861 closed<span class="toot-id"> #closed-861</span></h2><div class="pubdate">23 Jan at 17:25:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/861">https://github.com/qt4cg/qtspecs/issues/861</a></div><p>Precise meaning of $E??KS</p></div>
<div class="toot" id="closed-927"><h2>Issue #927 closed<span class="toot-id"> #closed-927</span></h2><div class="pubdate">23 Jan at 17:25:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/927">https://github.com/qt4cg/qtspecs/pull/927</a></div><p>861 Rewrite spec of deep lookup operator</p></div>
<div class="toot" id="minutes-01-23"><h2>QT4 CG meeting 062 draft minutes<span class="toot-id"> #minutes-01-23</span></h2><div class="pubdate">23 Jan at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/01-23">https://qt4cg.org/meeting/minutes/2024/01-23</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-964"><h2>Issue #964 created<span class="toot-id"> #created-964</span></h2><div class="pubdate">23 Jan at 12:30:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/964">https://github.com/qt4cg/qtspecs/issues/964</a></div><details><summary>fn:has-attributes</summary><div class="markup"><p>Trivial (motivated by a user request):</p>
<p>As there is an <code>fn:has-children</code> function, it seems surprising that there is no <code>fn:has-attributes</code> function.</p>
<p>I would suggest…</p>
<ul>
<li>adding this function to the spec, or</li>
<li>indicating in a note (for <code>fn:has-children</code>) why this function is missing.</li>
</ul>
</div></details></div>
<div class="toot" id="created-963"><h2>Issue #963 created<span class="toot-id"> #created-963</span></h2><div class="pubdate">23 Jan at 08:29:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/963">https://github.com/qt4cg/qtspecs/issues/963</a></div><details><summary>Errors in forming function items (continued)</summary><div class="markup"><p>In #894, the following rule was added to the definition of <strong>Named Function References</strong>:</p>
<blockquote>
<p>An error is raised if the identified function depends on components of the static or dynamic context that are not present, or that have unsuitable values. […] <code>DC0001</code> is raised for the call <code>fn:id#1</code> if the context item is not a node in a tree that is rooted at a document node.</p>
</blockquote>
<p>We should be consistent and add this rule to <strong>Partial Function Applications</strong> and <strong>Inline Function Expressions</strong> as well. Perhaps such rules could be defined just once for all affected function item constructors in the parent section?</p>
<p>Also, the error code doesn’t seem to be properly defined in the spec, it shows <code>[ERROR errorref DC0001 NOT FOUND]</code> (maybe that’s intentional at this editing stage.)</p>
</div></details></div>
<div class="toot" id="agenda-01-23"><h2>QT4 CG meeting 062 draft agenda<span class="toot-id"> #agenda-01-23</span></h2><div class="pubdate">22 Jan at 14:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/01-23">https://qt4cg.org/meeting/agenda/2024/01-23</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-962"><h2>Pull request #962 created<span class="toot-id"> #created-962</span></h2><div class="pubdate">20 Jan at 14:24:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/962">https://github.com/qt4cg/qtspecs/pull/962</a></div><details><summary>946 fn:iterate-while → fn:while-do, fn:do-until</summary><div class="markup"><p>My first thought was to name the second function <code>fn:do-while</code>, but <code>fn:do-until</code> with an inversed predicate seemed more appropriate to me.</p>
<p>Issue: #946</p>
</div></details></div>
<div class="toot" id="created-961"><h2>Issue #961 created<span class="toot-id"> #created-961</span></h2><div class="pubdate">20 Jan at 10:11:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/961">https://github.com/qt4cg/qtspecs/issues/961</a></div><details><summary>Simulating Objects: Performance</summary><div class="markup"><p>Related to #953, #917 and #916, I wonder whether we are aware enough of the essential differences when we think of objects in a functional language:</p>
<ul>
<li>Mutable objects are extremely efficient, as an update is a simple main-memory value change.</li>
<li>Immutable data structures need to be fully copied if a single value changes. As a result, the update of a map with, let’s say, 1 string and 50 functions would be a new map with 1 string and 50 functions. Even with efficient immutable map implementations that we have, I doubt that it makes sense to create full copies with 1+50 entries, of which only 1 string will be different.</li>
<li>Imagine a FLWOR expression that creates 1000 of such maps, with possibly 1 value that’s different in each instance. We don’t need 1000 copies of 50 functions; the memory consumption would be much smaller if we only stored relevant values.</li>
</ul>
<p>This thread is not about premature optimization; I just want to be sure we think about the obstacles when using maps for objects. Maybe the solutions are already on the horizon; maybe we could tackle some of the concerns with the definition of default values…</p>
<pre><code class="language-xquery">declare record person(
  name   as xs:string,
  title  := (),
  full   := fn { string-join((?title, ?name), ' ') }
);
</code></pre>
<p>…and maps with type annotations. If we don’t materialize defaults, the embedded annotation would indeed need to effect functions like <code>map:get</code>, as questioned by Michael in https://github.com/qt4cg/qtspecs/pull/953#issuecomment-1896078605.</p>
</div></details></div>
<div class="toot" id="created-960"><h2>Issue #960 created<span class="toot-id"> #created-960</span></h2><div class="pubdate">19 Jan at 16:24:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/960">https://github.com/qt4cg/qtspecs/issues/960</a></div><details><summary>Should ??KS flatten the results</summary><div class="markup"><p>Currently the result of <code>??KS</code> (like <code>?KS</code>) is flattened. So if you do <code>??dimensions</code> and the value of each <code>dimensions</code> entry is a sequence of zero or more numbers, the result munges them all together into a single sequence (dropping any empty values in the process).</p>
<p>Should we change this, for example to return a sequence of arrays, or an array of sequences?</p>
<p>This makes life a bit more difficult in the simple case where all the values are singletons -- and notably, when constructing a path such as <code>??A??B??C</code> -- but it makes it possible to handle the more general case where they aren't all singletons.</p>
</div></details></div>
<div class="toot" id="created-959"><h2>Issue #959 created<span class="toot-id"> #created-959</span></h2><div class="pubdate">18 Jan at 17:06:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/959">https://github.com/qt4cg/qtspecs/issues/959</a></div><details><summary>Milliseconds ↔ xs:dayTimeDuration, Unix time ↔ xs:dateTime</summary><div class="markup"><p>We should extend the constructor functions to convert integers (millisecond, and the Unix time, starting from <code>1970-01-01T00:00:00Z</code>) to <code>xs:dayTimeDuration</code> and <code>xs:dateTime</code> instances…</p>
<pre><code class="language-xquery">xs:dateTime(12345),
xs:dayTimeDuration(12345)
</code></pre>
<p>…and it should be possible to convert the values back to integers.</p>
<p>Related: https://docs.basex.org/wiki/Conversion_Module#Dates_and_Durations</p>
</div></details></div>
<div class="toot" id="created-958"><h2>Pull request #958 created<span class="toot-id"> #created-958</span></h2><div class="pubdate">18 Jan at 13:39:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/958">https://github.com/qt4cg/qtspecs/pull/958</a></div><details><summary>951 Parameters with default values: fn:lang, fn:id, fn:idref, fn:element-id</summary><div class="markup"><p>Editorial (#951): Reverts the changes made in #901 for 4 context-dependent functions.</p>
</div></details></div>
<div class="toot" id="created-957"><h2>Pull request #957 created<span class="toot-id"> #created-957</span></h2><div class="pubdate">18 Jan at 01:31:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/957">https://github.com/qt4cg/qtspecs/pull/957</a></div><details><summary>948 Added fn:scan-left and fn:scan-right</summary><div class="markup"><p>As discussed at https://github.com/qt4cg/qtspecs/issues/948</p>
</div></details></div>
<div class="toot" id="created-956"><h2>Pull request #956 created<span class="toot-id"> #created-956</span></h2><div class="pubdate">17 Jan at 17:41:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/956">https://github.com/qt4cg/qtspecs/pull/956</a></div><details><summary>850-partial Editorial improvements to parse-html()</summary><div class="markup"><p>Related to issue #850, but doesn't close it entirely.</p>
</div></details></div>
<div class="toot" id="created-955"><h2>Issue #955 created<span class="toot-id"> #created-955</span></h2><div class="pubdate">17 Jan at 12:00:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/955">https://github.com/qt4cg/qtspecs/issues/955</a></div><details><summary>Options parameters as record types</summary><div class="markup"><p>In the new parse-html() function, the content of the options parameter is described using a record type. This differs from other functions, that describe the type as map(*), and have a statement that "the option parameter conventions apply".</p>
<p>Ideally we should use record types for all options parameters. However we need to check carefully that this does not affect edge-case compatibility, for example implicit conversions or the acceptability of extensions. If we can't do that then we should bring parse-html() into line with other functions such as parse-json().</p>
</div></details></div>
<div class="toot" id="created-954"><h2>Issue #954 created<span class="toot-id"> #created-954</span></h2><div class="pubdate">17 Jan at 00:45:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/954">https://github.com/qt4cg/qtspecs/issues/954</a></div><details><summary>Establish a default value for the XSLT fixed-namespaces attribute</summary><div class="markup"><p>The newly-defined <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#fixed-namespaces"><strong>fixed-namespaces</strong> attribute</a> on the <em><code>xsl:stylesheet</code></em> element is a huge positive step towards improving programmer's productivity by removing the need to provide up to 9 namespace declarations in every stylesheet module, thus reducing unnecessary cluttering, simplifying and slimming the code and increasing its readability.</p>
<p>It seems like an accidental omission that the current text doesn't specify a default value for this attribute. If there is a well-chosen default value, this would even further decrease the requirements for the programmer to engage in such a non-problem-solving activity as entering memorized strings, and would prevent errors such as either not providing the correct values for the namespace-uris or forgetting to specify this new attribute.</p>
<p>One obvious candidate for a default value of the <strong>fixed-namespaces</strong> attribute is <code>#standard</code>, which means that without having to press even a single additional key, the XSLT programmer gets all standard namespaces automatically bound to the well-known prefixes:</p>
<p><code>xsl</code> <code>xml</code> <code>xs</code> <code>xsi</code> <code>fn</code>  <code>math</code> <code>map</code> <code>array</code> <code>err</code></p>
<h3>Proposal:</h3>
<p>Please, augment the current text by specifying that the default value for the <strong>fixed-namespaces</strong> attribute is <code>#standard</code></p>
</div></details></div>
<div class="toot" id="created-953"><h2>Pull request #953 created<span class="toot-id"> #created-953</span></h2><div class="pubdate">16 Jan at 23:10:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/953">https://github.com/qt4cg/qtspecs/pull/953</a></div><details><summary>617 Define record constructors</summary><div class="markup"><p>Fix #617</p>
<p>Note that this is a first step. Noticeably we can't yet use these constructor functions to create records that have methods. It's nevertheless a big step forward.</p>
</div></details></div>
<div class="toot" id="created-952"><h2>Pull request #952 created<span class="toot-id"> #created-952</span></h2><div class="pubdate">16 Jan at 18:52:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/952">https://github.com/qt4cg/qtspecs/pull/952</a></div><details><summary>945 module import contradiction</summary><div class="markup"><p>Soem editorial clarifications regarding XQuery module import and schema import.</p>
<p>Fix #945</p>
</div></details></div>
<div class="toot" id="closed-928"><h2>Issue #928 closed<span class="toot-id"> #closed-928</span></h2><div class="pubdate">16 Jan at 17:33:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/928">https://github.com/qt4cg/qtspecs/pull/928</a></div><p>Minor edits through ch. 15</p></div>
<div class="toot" id="closed-947"><h2>Issue #947 closed<span class="toot-id"> #closed-947</span></h2><div class="pubdate">16 Jan at 17:30:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/947">https://github.com/qt4cg/qtspecs/pull/947</a></div><p>Reorganise F+O chapter 15 [editorial]</p></div>
<div class="toot" id="closed-530"><h2>Issue #530 closed<span class="toot-id"> #closed-530</span></h2><div class="pubdate">16 Jan at 17:26:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/530">https://github.com/qt4cg/qtspecs/issues/530</a></div><p>Escaping of forward slash in JSON output method</p></div>
<div class="toot" id="closed-942"><h2>Issue #942 closed<span class="toot-id"> #closed-942</span></h2><div class="pubdate">16 Jan at 17:26:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/942">https://github.com/qt4cg/qtspecs/pull/942</a></div><p>530 Fix typo, escape-solidus not escape-uri-attributes</p></div>
<div class="toot" id="closed-880"><h2>Issue #880 closed<span class="toot-id"> #closed-880</span></h2><div class="pubdate">16 Jan at 17:26:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/880">https://github.com/qt4cg/qtspecs/pull/880</a></div><p>872 Symmetry: fn:items-at → fn:get</p></div>
<div class="toot" id="minutes-01-16"><h2>QT4 CG meeting 061 draft minutes<span class="toot-id"> #minutes-01-16</span></h2><div class="pubdate">16 Jan at 17:25:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2024/01-16">https://qt4cg.org/meeting/minutes/2024/01-16</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-930"><h2>Issue #930 closed<span class="toot-id"> #closed-930</span></h2><div class="pubdate">16 Jan at 17:23:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/930">https://github.com/qt4cg/qtspecs/issues/930</a></div><p>Obsolete comment under fn:deep-equal()</p></div>
<div class="toot" id="closed-933"><h2>Issue #933 closed<span class="toot-id"> #closed-933</span></h2><div class="pubdate">16 Jan at 17:23:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/933">https://github.com/qt4cg/qtspecs/pull/933</a></div><p>930 drop obsolete note about comments and PIs</p></div>
<div class="toot" id="closed-932"><h2>Issue #932 closed<span class="toot-id"> #closed-932</span></h2><div class="pubdate">16 Jan at 17:20:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/932">https://github.com/qt4cg/qtspecs/pull/932</a></div><p>931 Add rules for duration precision</p></div>
<div class="toot" id="closed-931"><h2>Issue #931 closed<span class="toot-id"> #closed-931</span></h2><div class="pubdate">16 Jan at 17:20:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/931">https://github.com/qt4cg/qtspecs/issues/931</a></div><p>Precision of duration arithmetic</p></div>
<div class="toot" id="closed-737"><h2>Issue #737 closed<span class="toot-id"> #closed-737</span></h2><div class="pubdate">16 Jan at 17:17:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/737">https://github.com/qt4cg/qtspecs/pull/737</a></div><p>295: Boost the capability of recursive record types</p></div>
<div class="toot" id="created-951"><h2>Issue #951 created<span class="toot-id"> #created-951</span></h2><div class="pubdate">16 Jan at 13:58:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/951">https://github.com/qt4cg/qtspecs/issues/951</a></div><details><summary>Parameters with default values: fn:lang, fn:id, fn:idref, fn:element-with-id</summary><div class="markup"><p>Since #895, absent optional arguments and empty sequences in built-in functions are treated identically. Exceptions are functions that already had different rules for such cases (e.g., <code>fn:node(())</code> always returns an empty sequence, no matter what the context is).</p>
<p>I noticed we should also exclude <code>fn:lang</code>, <code>fn:id</code>, <code>fn:idref</code>, and <code>fn:element-with-id</code>: Otherwise, a compiler won’t be able to statically assess if a function call is dependent on the context.</p>
</div></details></div>
<div class="toot" id="created-950"><h2>Pull request #950 created<span class="toot-id"> #created-950</span></h2><div class="pubdate">16 Jan at 11:53:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/950">https://github.com/qt4cg/qtspecs/pull/950</a></div><details><summary>Minor edits (examples, rules)</summary><div class="markup"><ul>
<li>Examples were fixed.</li>
<li>The equivalent expression for <code>map:values</code> was changed to <code>$map?*</code>.</li>
</ul>
</div></details></div>
<div class="toot" id="created-949"><h2>Issue #949 created<span class="toot-id"> #created-949</span></h2><div class="pubdate">16 Jan at 11:21:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/949">https://github.com/qt4cg/qtspecs/issues/949</a></div><details><summary>Partial Function Applications: Allow return of function name</summary><div class="markup"><p>Without wanting to revive #889, an important observation I picked up is that named function references and “partially applied functions without applications” can be considered identical. That is, there should be no reason to distinguish between <code>count#1</code> and <code>count(?)</code>.</p>
<p>Currently, however, partially applied functions are currently defined to lose the reference to the original function and its arity (and some Qt4 tests ensure that this is the case: https://github.com/qt4cg/qt4tests/blob/8649941e0e695ff8fb4cb27c52e99590cc88126f/misc/HigherOrderFunctions.xml#L1933).</p>
<p>From a user perspective, I see no reason why the two cases should be treated differently, and I would argue that we should either treat them identically or (at least) allow implementations to treat them identically, i.e., allowing an implementation to return <code>count</code> for <code>function-name(count(?))</code>.</p>
</div></details></div>
<div class="toot" id="created-948"><h2>Issue #948 created<span class="toot-id"> #created-948</span></h2><div class="pubdate">15 Jan at 18:59:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/948">https://github.com/qt4cg/qtspecs/issues/948</a></div><details><summary>fn:scan-left and fn:scan-right - produce accumulation of results</summary><div class="markup"><h1>fn:scan-left and fn:scan-right - produce accumulation of results</h1>
<p>In XPath 4.0 so far we still don't have a convenient way to express the functionality of producing a series of accumulated (accrued) results when applying a folding function over a collection (sequence, array, ...) of items. The general use-case for this is the task to produce a sequence of running totals when applying an operation over a sequence of data points: <strong>produce the partial sums of loan payments</strong> over fixed periods, <strong>produce the compounded amounts  of a deposit</strong> with fixed interest rate over years, ..., etc.</p>
<p>Two functions (shamelessly borrowed from Haskell):</p>
<ul>
<li><strong>fn:scan-left</strong></li>
<li><strong>fn:scan-right</strong></li>
</ul>
<hr>
<h2>fn:scan-left</h2>
<p>This function has a similar signature to that of <strong><em><code>fn:fold-left</code></em></strong> and produces the same final result, however it produces the complete (ordered) sequence of all partial results from every new value the accumulator gets during the evaluation of <strong><em><code>fn:fold-left</code></em></strong>.</p>
<h3>Signature</h3>
<pre><code class="language-xq">fn:scan-left($input	as item()*,	
             $zero	as item()*,	
             $action	as function(item()*, item()) as item()*	
) as array(*)*
</code></pre>
<h3>Properties</h3>
<p>This function is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-deterministic">·deterministic·</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-context-independent">·context-independent·</a>, and <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-focus-independent">·focus-independent·</a>.</p>
<h3>Rules</h3>
<p>The function is equivalent to the following implementation in XPath(return clause added for completeness):</p>
<pre><code class="language-xq">let $scan-left-inner := function($seq as item()*, 
                                 $zero as item(), 
                                 $fun as function(item()*, item()) as item()*,
                                 $self as function(*)
                               ) as array(*)*                               
{
  let $result := [$zero]
   return
     if(empty($seq)) then $result
       else
         (
           $result, $self(tail($seq), $fun($zero, head($seq)), $fun, $self)  
         )
},

$scan-left := function($seq as item()*, 
                       $zero as item(), 
                       $fun as function(item()*, item()) as item()*
                     ) as array(*)*  
{
  $scan-left-inner($seq, $zero, $fun, $scan-left-inner)
}  

  return
    $scan-left(1 to 10, 0, op('+'))
</code></pre>
<h3>Examples:</h3>
<pre><code class="language-xq"> $scan-left(1 to 10, 0, op('+'))
</code></pre>
<p>produces:</p>
<pre><code class="language-xq">[0]
[1]
[3]
[6]
[10]
[15]
[21]
[28]
[36]
[45]
[55]
</code></pre>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/603c0584-31bb-431f-b928-875058111128" alt="image"></p>
<h2>fn:scan-right</h2>
<p>This function has a similar signature to that of <strong><em><code>fn:fold-right</code></em></strong> and produces the same final result, however it produces the complete (ordered) sequence of all partial results from every new value the accumulator gets during the evaluation of <strong><em><code>fn:fold-right</code></em></strong>.</p>
<h3>Signature</h3>
<pre><code class="language-xq">fn:scan-right($input	as item()*,	
              $zero	as item()*,	
              $action	as function(item()*, item()) as item()*	
) as array(*)*
</code></pre>
<h3>Properties</h3>
<p>This function is <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-deterministic">·deterministic·</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-context-independent">·context-independent·</a>, and <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-focus-independent">·focus-independent·</a>.</p>
<h3>Rules</h3>
<p>The function is equivalent to the following implementation in XPath(return clause added for completeness):</p>
<pre><code class="language-xq">let  $scan-right-inner := function($seq as item()*,
                                   $zero as item()*,
                                   $f as function(item(), item()*) as item()*,                          
                                   $self as function(*)
                                  ) as array(*)*
{
    if(empty($seq)) then [$zero]
      else
        let $rightResult := $self(tail($seq), $zero, $f, $self)
         return
            ([$f(head($seq), head($rightResult))], $rightResult)
},

$scan-right := function($seq as item()*,
                        $zero as item()*,
                        $f as function(item(), item()*) as item()*
                       ) as array(*)*
{
  $scan-right-inner($seq, $zero, $f, $scan-right-inner)
}   

return
  $scan-right(1 to 10, 0, op('+'))  
</code></pre>
<h3>Examples:</h3>
<pre><code class="language-xq"> $scan-right(1 to 10, 0, op('+'))
</code></pre>
<p>produces:</p>
<pre><code class="language-xq">[55]
[54]
[52]
[49]
[45]
[40]
[34]
[27]
[19]
[10]
[0]
</code></pre>
<p><img src="https://github.com/qt4cg/qtspecs/assets/10605892/68f5010d-133d-4bcf-8096-609a3d26697f" alt="image"></p>
</div></details></div>
<div class="toot" id="agenda-01-16"><h2>QT4 CG meeting 061 draft agenda<span class="toot-id"> #agenda-01-16</span></h2><div class="pubdate">15 Jan at 14:40:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2024/01-16">https://qt4cg.org/meeting/agenda/2024/01-16</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-899"><h2>Issue #899 closed<span class="toot-id"> #closed-899</span></h2><div class="pubdate">15 Jan at 15:21:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/899">https://github.com/qt4cg/qtspecs/issues/899</a></div><p>Simplifying the language - types have behaviour.</p></div>
<div class="toot" id="created-947"><h2>Pull request #947 created<span class="toot-id"> #created-947</span></h2><div class="pubdate">15 Jan at 10:39:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/947">https://github.com/qt4cg/qtspecs/pull/947</a></div><details><summary>Reorganise F+O chapter 15 [editorial]</summary><div class="markup"><p>This PR reorganizes the subsections of F+O chapter 15 (the XML/HTML/JSON/CSV/IXML chapter). There is no change to content apart from a couple of introductory sentences. I'm planning to do some fine-grained work on the content in due course, but to make that easier to review it seems best to do the top-level reorganisation first. I'm therefore hoping that this PR will go through quickly "on the nod" so I can use it as a baseline for the detail changes.</p>
</div></details></div>
<div class="toot" id="created-946"><h2>Issue #946 created<span class="toot-id"> #created-946</span></h2><div class="pubdate">12 Jan at 16:10:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/946">https://github.com/qt4cg/qtspecs/issues/946</a></div><details><summary>fn:iterate-while → fn:while-do, fn:do-until</summary><div class="markup"><p>First feedback shows that <code>fn:iterate-while</code> is helpful, but the name needs to be improved: It implies that the first iteration occurs before the invocation of the test… Which could sometimes be helpful, too.</p>
<p>I suggest renaming the function to <code>fn:while-do</code> (“do” is commonly used when while loops are specified), and adding <code>fn:do-until</code>.</p>
</div></details></div>
<div class="toot" id="created-945"><h2>Issue #945 created<span class="toot-id"> #created-945</span></h2><div class="pubdate">12 Jan at 15:41:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/945">https://github.com/qt4cg/qtspecs/issues/945</a></div><details><summary>Module import: apparent contradiction</summary><div class="markup"><p>XQuery 5.12 paragraph 2 says:</p>
<blockquote>
<p>If a module A imports module B, the static context of module A will contain the [in-scope schema definitions]... of module B.</p>
</blockquote>
<p>Paragraph 10 says:</p>
<blockquote>
<p>A [module import] imports only functions, variable declarations, and item type declaratons; it does not import other objects from the imported modules, such as [in-scope schema definitions] or [statically known namespaces].</p>
</blockquote>
<p>They can't both be right, surely?</p>
</div></details></div>
<div class="toot" id="created-944"><h2>Issue #944 created<span class="toot-id"> #created-944</span></h2><div class="pubdate">12 Jan at 11:18:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/944">https://github.com/qt4cg/qtspecs/issues/944</a></div><details><summary>Coercion rules: implicit types</summary><div class="markup"><p>Since 2.0, the coercion rules (formerly function conversion rules) have allowed implicit conversion from decimal to double, decimal to float, and float to double on function calls; other conversions such as double to decimal or float to decimal are not allowed. This has never made very much sense because in some implementations, decimal to float is a lossy conversion whereas float to decimal is not.</p>
<p>One option would be to allow conversion from any numeric type to any other.</p>
<p>The main caveat here is that I don't think it makes sense to allow a double such as 1.5e0 to be supplied where the required type is xs:integer. We have introduced new conversions that make it possible to supply a decimal where an integer is expected, but only if the decimal is in the value space of integer.</p>
<p>A possible formulation would be:</p>
<p>If the required type is a numeric type (that is, xs:decimal, xs:double, xs:float, or any type derived from these), and if the supplied value is a numeric value, then the supplied value is cast to the required primitive type, and if the result is in the value space of the actual required type it is then relabelled as an instance of the actual required type (if not, the conversion fails).</p>
<p>This means that supplying 1.0e0 for an argument expecting xs:integer (or xs:positiveInteger, etc) would work (it would cast to xs:decimal and then relabel as xs:integer), but supplying 1.1e0 would fail.</p>
</div></details></div>
<div class="toot" id="created-943"><h2>Pull request #943 created<span class="toot-id"> #created-943</span></h2><div class="pubdate">11 Jan at 10:28:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/943">https://github.com/qt4cg/qtspecs/pull/943</a></div><details><summary>187 Add FLWOR expression while clause</summary><div class="markup"><p>Fix #187</p>
</div></details></div>
<div class="toot" id="created-942"><h2>Pull request #942 created<span class="toot-id"> #created-942</span></h2><div class="pubdate">10 Jan at 16:42:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/942">https://github.com/qt4cg/qtspecs/pull/942</a></div><details><summary>530 Fix typo, escape-solidus not escape-uri-attributes</summary><div class="markup"><p>Fix #530.</p>
<p>On half a dozen occasions, <code>escape-uri-attributes</code> is used where <code>escape-solidus</code> is clearly intended.</p>
</div></details></div>
<div class="toot" id="closed-886"><h2>Issue #886 closed<span class="toot-id"> #closed-886</span></h2><div class="pubdate">10 Jan at 14:28:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/886">https://github.com/qt4cg/qtspecs/issues/886</a></div><p>Binary map keys</p></div>
<div class="toot" id="created-941"><h2>Pull request #941 created<span class="toot-id"> #created-941</span></h2><div class="pubdate">10 Jan at 12:20:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/941">https://github.com/qt4cg/qtspecs/pull/941</a></div><details><summary>939 Remove fn:numeric-compare</summary><div class="markup"><p>Issue: #939</p>
</div></details></div>
<div class="toot" id="created-940"><h2>Pull request #940 created<span class="toot-id"> #created-940</span></h2><div class="pubdate">10 Jan at 12:05:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/940">https://github.com/qt4cg/qtspecs/pull/940</a></div><details><summary>878 Add subsequence-where function</summary><div class="markup"><p>Supersedes PR #874</p>
<p>Following discussion of PR #874 which proposed an extended subsequence() function with options to define the start and end position by predicates, this new PR proposes instead a subsequence-where() function that allows the start and end position to be defined by predicates, leaving the existing subsequence() function unchanged.</p>
<p>The items-before/after/starting-where/ending-where quartet are dropped.</p>
<p>The new function is inclusive at both ends. To start at the item after the one that matches the start condition, apply tail() to the result. To finish before the item that matches the end condition, apply trunk() to the result.</p>
</div></details></div>
<div class="toot" id="closed-893"><h2>Issue #893 closed<span class="toot-id"> #closed-893</span></h2><div class="pubdate">10 Jan at 11:55:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/893">https://github.com/qt4cg/qtspecs/issues/893</a></div><p>fn:compare: Support for arbitrary atomic types</p></div>
<div class="toot" id="closed-918"><h2>Issue #918 closed<span class="toot-id"> #closed-918</span></h2><div class="pubdate">10 Jan at 09:19:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/918">https://github.com/qt4cg/qtspecs/pull/918</a></div><p>Minor cx through chap. 14</p></div>
<div class="toot" id="created-939"><h2>Issue #939 created<span class="toot-id"> #created-939</span></h2><div class="pubdate">10 Jan at 09:12:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/939">https://github.com/qt4cg/qtspecs/issues/939</a></div><details><summary>Remove fn:numeric-compare</summary><div class="markup"><p>Related action: <a href="https://qt4cg.org/meeting/minutes/2024/01-09.html">QT4CG-060-04</a></p>
<p>@michaelhkay I proposed to merge <code>fn:numeric-compare</code> into <code>fn:compare</code> in #866; your response was:</p>
<blockquote>
<p>Folding fn:numeric-compare into fn:compare is more feasible, but you've then got one function that does two different jobs; there's no type safety to ensure that the arguments have compatible types, and you need ad-hoc rules to say which combinations of arguments are valid and which aren't. The merit of two separate functions is that each is a total function over the domain implied by its signature.</p>
</blockquote>
<p>Do you think the concerns are still relevant, or should we tackle this?</p>
</div></details></div>
<div class="toot" id="created-938"><h2>Issue #938 created<span class="toot-id"> #created-938</span></h2><div class="pubdate">10 Jan at 04:30:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/938">https://github.com/qt4cg/qtspecs/issues/938</a></div><details><summary>Canonical serialization</summary><div class="markup"><p>This issue picks up suggestions from #779 regarding canonical serialization, and solicits from the community group input on if such a function is desirable, and what such a function might look like.</p>
<p>In the context of #779, the idea was that two XML documents with different physical representations, but semantically equivalent, could be serialized to a canonical form, with a hash value applied to each confirming identity. Of course, with canonical operation, a simple string comparison would be sufficient, absent any hashing.</p>
<p>XML Signature was suggested as one approach, with some hesitation. I would like to suggest, instead, that we look to implement <a href="https://www.w3.org/TR/xml-c14n/">Canonical XML Version 1.1</a> (herein <strong>CX1.1</strong>), perhaps with map options that calibrate how CX1.1 is implemented. I have no experience using CX1.1, so user input is welcome.</p>
<p>Another point of discussion is whether this merits a new function, e.g., <code>fn:canonical-serialize</code>, or should be built upon <code>fn:serialize</code>. A problem with the latter option, is that such an approach makes no sense without the <code>method</code> option specified as <code>xml</code>. Another approach would be to go deeper, into the serialization spec, and expand the <code>xml</code> method to ensure a canonical option.</p>
<p>I believe that this function would be extremely useful. When preparing test suites, output could be saved as secondary documents as canonical XML, and any subsequent regression tests could adjust comparanda to canonical XML, and very precise node-wise comparisons could be made.</p>
<p>I look forward to everyone's input.</p>
</div></details></div>
<div class="toot" id="created-937"><h2>Pull request #937 created<span class="toot-id"> #created-937</span></h2><div class="pubdate">10 Jan at 04:03:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/937">https://github.com/qt4cg/qtspecs/pull/937</a></div><details><summary>779 hash function</summary><div class="markup"><p>First draft of hash function, proposed in #779.</p>
<p>Error message left as to-do item; guidance from editors appreciated.</p>
<p>I opted to leave out wrapper/cryptographic functionality, such as salting, and to demonstrate via example how it could be done by a developer on their own. In my opinion what we need here is a simple atomic function that can be incorporated into other molecular functions.</p>
<p>I may tinker with the prose description up to CG discussion, so comments are welcome.</p>
</div></details></div>
<div class="toot" id="created-936"><h2>Pull request #936 created<span class="toot-id"> #created-936</span></h2><div class="pubdate">10 Jan at 02:30:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/936">https://github.com/qt4cg/qtspecs/pull/936</a></div><details><summary>877 revised rules for op:binary-less-than</summary><div class="markup"><p>Rule 3 for <code>op:binary-less-than</code> was a bit of a mess (see #877), and needed to be expressed as a recursive operation.</p>
<p>My proposed revision depends of phraseology drawn from <code>fn:decode-from-uri</code>, <code>fn:deep-equal</code>, and 5.3.2 Unicode Codepoint Collation (here slightly adjusted from unordered to ordered list).</p>
</div></details></div>
<div class="toot" id="closed-876"><h2>Issue #876 closed<span class="toot-id"> #closed-876</span></h2><div class="pubdate">10 Jan at 01:24:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/876">https://github.com/qt4cg/qtspecs/issues/876</a></div><p>Placement of fn:in-scope-namespaces(), fn:in-scope-prefixes(), fn:namespace-uri-for-prefix()</p></div>
<div class="toot" id="closed-909"><h2>Issue #909 closed<span class="toot-id"> #closed-909</span></h2><div class="pubdate">09 Jan at 17:54:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/909">https://github.com/qt4cg/qtspecs/pull/909</a></div><p>893 fn:compare: Support for arbitrary atomic types</p></div>
<div class="toot" id="closed-860"><h2>Issue #860 closed<span class="toot-id"> #closed-860</span></h2><div class="pubdate">09 Jan at 17:51:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/860">https://github.com/qt4cg/qtspecs/issues/860</a></div><p>Unary Lookup when the context value is a sequence</p></div>
<div class="toot" id="closed-926"><h2>Issue #926 closed<span class="toot-id"> #closed-926</span></h2><div class="pubdate">09 Jan at 17:51:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/926">https://github.com/qt4cg/qtspecs/pull/926</a></div><p>860 Editorial rearrangement of spec for shallow lookup</p></div>
<div class="toot" id="closed-780"><h2>Issue #780 closed<span class="toot-id"> #closed-780</span></h2><div class="pubdate">09 Jan at 17:42:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/780">https://github.com/qt4cg/qtspecs/issues/780</a></div><p>format-number() etc incompatibility</p></div>
<div class="toot" id="closed-925"><h2>Issue #925 closed<span class="toot-id"> #closed-925</span></h2><div class="pubdate">09 Jan at 17:42:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/925">https://github.com/qt4cg/qtspecs/pull/925</a></div><p>780 Document incompatibility in format-number etc</p></div>
<div class="toot" id="closed-935"><h2>Issue #935 closed<span class="toot-id"> #closed-935</span></h2><div class="pubdate">09 Jan at 17:41:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/935">https://github.com/qt4cg/qtspecs/pull/935</a></div><p>Fix the fo test catalog</p></div>
<div class="toot" id="created-935"><h2>Pull request #935 created<span class="toot-id"> #created-935</span></h2><div class="pubdate">09 Jan at 17:41:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/935">https://github.com/qt4cg/qtspecs/pull/935</a></div><details><summary>Fix the fo test catalog</summary><div class="markup"><p>A duplicate name was introduced.</p>
</div></details></div>
<div class="toot" id="closed-648"><h2>Issue #648 closed<span class="toot-id"> #closed-648</span></h2><div class="pubdate">09 Jan at 17:36:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/648">https://github.com/qt4cg/qtspecs/issues/648</a></div><p>Schema for FN namespace should block extension and substitution</p></div>
<div class="toot" id="closed-924"><h2>Issue #924 closed<span class="toot-id"> #closed-924</span></h2><div class="pubdate">09 Jan at 17:36:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/924">https://github.com/qt4cg/qtspecs/pull/924</a></div><p>648 Disallow user modifications to schema for FN namespace</p></div>
<div class="toot" id="closed-913"><h2>Issue #913 closed<span class="toot-id"> #closed-913</span></h2><div class="pubdate">09 Jan at 17:30:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/913">https://github.com/qt4cg/qtspecs/issues/913</a></div><p>XQFO: under/unused variable apparatus</p></div>
<div class="toot" id="closed-923"><h2>Issue #923 closed<span class="toot-id"> #closed-923</span></h2><div class="pubdate">09 Jan at 17:30:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/923">https://github.com/qt4cg/qtspecs/pull/923</a></div><p>913-new-examples-for-local-name-etc</p></div>
<div class="toot" id="closed-915"><h2>Issue #915 closed<span class="toot-id"> #closed-915</span></h2><div class="pubdate">09 Jan at 17:27:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/915">https://github.com/qt4cg/qtspecs/issues/915</a></div><p>[Editorial] Incorrect terminology: function implementation is now function body</p></div>
<div class="toot" id="closed-922"><h2>Issue #922 closed<span class="toot-id"> #closed-922</span></h2><div class="pubdate">09 Jan at 17:27:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/922">https://github.com/qt4cg/qtspecs/pull/922</a></div><p>915 function body terminology</p></div>
<div class="toot" id="closed-914"><h2>Issue #914 closed<span class="toot-id"> #closed-914</span></h2><div class="pubdate">09 Jan at 17:23:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/914">https://github.com/qt4cg/qtspecs/pull/914</a></div><p>XQFO minor edits</p></div>
<div class="toot" id="closed-912"><h2>Issue #912 closed<span class="toot-id"> #closed-912</span></h2><div class="pubdate">09 Jan at 17:20:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/912">https://github.com/qt4cg/qtspecs/pull/912</a></div><p>XQFO: Minor edits</p></div>
<div class="toot" id="closed-906"><h2>Issue #906 closed<span class="toot-id"> #closed-906</span></h2><div class="pubdate">09 Jan at 17:17:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/906">https://github.com/qt4cg/qtspecs/issues/906</a></div><p>fn:deep-equal: unordered → ordered</p></div>
<div class="toot" id="closed-907"><h2>Issue #907 closed<span class="toot-id"> #closed-907</span></h2><div class="pubdate">09 Jan at 17:17:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/907">https://github.com/qt4cg/qtspecs/pull/907</a></div><p>906 fn:deep-equal: unordered → ordered</p></div>
<div class="toot" id="closed-898"><h2>Issue #898 closed<span class="toot-id"> #closed-898</span></h2><div class="pubdate">09 Jan at 17:14:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/898">https://github.com/qt4cg/qtspecs/issues/898</a></div><p>Drop the requirement for document-uri() uniqueness</p></div>
<div class="toot" id="closed-905"><h2>Issue #905 closed<span class="toot-id"> #closed-905</span></h2><div class="pubdate">09 Jan at 17:14:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/905">https://github.com/qt4cg/qtspecs/pull/905</a></div><p>898 - relax the constraints on document-uri</p></div>
<div class="toot" id="closed-821"><h2>Issue #821 closed<span class="toot-id"> #closed-821</span></h2><div class="pubdate">09 Jan at 17:11:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/821">https://github.com/qt4cg/qtspecs/issues/821</a></div><p>Annotations: Make default namespace explicit</p></div>
<div class="toot" id="closed-904"><h2>Issue #904 closed<span class="toot-id"> #closed-904</span></h2><div class="pubdate">09 Jan at 17:11:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/904">https://github.com/qt4cg/qtspecs/pull/904</a></div><p>821 Annotations: Make default namespace explicit</p></div>
<div class="toot" id="closed-895"><h2>Issue #895 closed<span class="toot-id"> #closed-895</span></h2><div class="pubdate">09 Jan at 17:07:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/895">https://github.com/qt4cg/qtspecs/issues/895</a></div><p>Parameters with default values: allow empty sequences</p></div>
<div class="toot" id="closed-901"><h2>Issue #901 closed<span class="toot-id"> #closed-901</span></h2><div class="pubdate">09 Jan at 17:07:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/901">https://github.com/qt4cg/qtspecs/pull/901</a></div><p>895 Parameters with default values: allow empty sequences</p></div>
<div class="toot" id="created-934"><h2>Issue #934 created<span class="toot-id"> #created-934</span></h2><div class="pubdate">08 Jan at 18:00:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/934">https://github.com/qt4cg/qtspecs/issues/934</a></div><details><summary>String comparison in deep-equal</summary><div class="markup"><p>The code showing how strings should be compared in deep-equal has gone awry, it doesn't match the prose. In equal-strings(), the lines</p>
<pre><code>let $n1 := if ($options?whitespace = "normalize"))
             then normalize-unicode(?, $options?normalization-form) 
             else identity#1
  let $n2 := if ($options?normalize-space)
             then normalize-space#1 
             else identity#1      
</code></pre>
<p>should read:</p>
<pre><code>let $n1 := if ($options?whitespace = 'normalize')
             then normalize-space#1 
             else identity#1    
let $n2 := if ($options?normalization-form))
             then normalize-unicode(?, $options?normalization-form) 
             else identity#1
  
</code></pre>
<p>Actually, the whole thing can now be expressed more concisely using fn:chain:</p>
<pre><code>declare function equal-strings(
  $string1   as xs:string,
  $string2   as xs:string, 
  $collation as xs:string,
  $options   as map(*)
) as xs:boolean {
  let $norm := fn:chain(?,
                        (normalize-unicode(?, $options?normalization-form)[$options?whitespace = "normalize"],
                         normalize-space#1[$options?normalize-space]))          
  return compare($norm($string1), $norm($string2), $collation) eq 0    
}
</code></pre>
</div></details></div>
<div class="toot" id="created-933"><h2>Pull request #933 created<span class="toot-id"> #created-933</span></h2><div class="pubdate">08 Jan at 12:49:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/933">https://github.com/qt4cg/qtspecs/pull/933</a></div><details><summary>930 drop obsolete note about comments and PIs</summary><div class="markup"><p>Fix #930</p>
<p>The note is obsolete because adjacent text nodes are now combined after stripping comments and PIs.</p>
</div></details></div>
<div class="toot" id="created-932"><h2>Pull request #932 created<span class="toot-id"> #created-932</span></h2><div class="pubdate">08 Jan at 12:42:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/932">https://github.com/qt4cg/qtspecs/pull/932</a></div><details><summary>931 Add rules for duration precision</summary><div class="markup"><p>Fix #931</p>
<p>Adds rules for the precision of durations and operations on durations, analogous to the existing rules for dates/times.</p>
</div></details></div>
<div class="toot" id="created-931"><h2>Issue #931 created<span class="toot-id"> #created-931</span></h2><div class="pubdate">07 Jan at 10:21:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/931">https://github.com/qt4cg/qtspecs/issues/931</a></div><details><summary>Precision of duration arithmetic</summary><div class="markup"><p>We specify that dates/times are manipulated at least to millisecond precision, but we have no similar statement for durations.</p>
<p>See https://stackoverflow.com/questions/77752844</p>
<p>michael.hor257k points out:</p>
<blockquote>
<p>The 2.0 specification states: "The result is obtained by casting $arg to an xs:dayTimeDuration ... and then computing the seconds component as described in 10.3.2.3 Canonical representation." And then: "The canonical representation of xs:dayTimeDuration restricts ... the value of the seconds component to xs:decimal valued from 0.0 to 59.999... ", with reference to XML Schema Part 2: Datatypes which mandates "a minimum fractional second precision of milliseconds or three decimal digits". None of this appears in the 3.0 spec, though the examples still show a decimal digit being extracted. –</p>
</blockquote>
</div></details></div>
<div class="toot" id="closed-929"><h2>Issue #929 closed<span class="toot-id"> #closed-929</span></h2><div class="pubdate">07 Jan at 10:19:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/929">https://github.com/qt4cg/qtspecs/issues/929</a></div><p>map:values() - Would it be better to return an array?</p></div>
<div class="toot" id="created-930"><h2>Issue #930 created<span class="toot-id"> #created-930</span></h2><div class="pubdate">06 Jan at 17:13:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/930">https://github.com/qt4cg/qtspecs/issues/930</a></div><details><summary>Obsolete comment under fn:deep-equal()</summary><div class="markup"><p>The notes for fn:deep-equal() include the paragraph:</p>
<blockquote>
<p>By default, the contents of comments and processing instructions are significant only if these nodes appear directly as items in the two sequences being compared. The content of a comment or processing instruction that appears as a descendant of an item in one of the sequences being compared does not affect the result. However, the presence of a comment or processing instruction, if it causes a text node to be split into two text nodes, may affect the result.</p>
</blockquote>
<p>This is no longer true: we fixed it so that adjacent text nodes are merged after stripping comments and PIs.</p>
</div></details></div>
<div class="toot" id="created-929"><h2>Issue #929 created<span class="toot-id"> #created-929</span></h2><div class="pubdate">06 Jan at 08:34:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/929">https://github.com/qt4cg/qtspecs/issues/929</a></div><details><summary>map:values() - Would it be better to return an array?</summary><div class="markup"><p>The new function <code>map:values()</code> returns the values present in a map, flattened into a sequence.</p>
<p>This loses information if the values are not all singletons.</p>
<p>Would it be better to return an array?</p>
<p>That is, to return <code>array:build(map:pairs($map), fn{?value}))</code></p>
</div></details></div>
<div class="toot" id="created-928"><h2>Pull request #928 created<span class="toot-id"> #created-928</span></h2><div class="pubdate">06 Jan at 02:47:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/928">https://github.com/qt4cg/qtspecs/pull/928</a></div><details><summary>Minor edits through ch. 15</summary><div class="markup"><p>Light edits here for consistency, clarity. I didn't touch the CSV prose much, knowing it is subject to major revisions.</p>
</div></details></div>
<div class="toot" id="created-927"><h2>Pull request #927 created<span class="toot-id"> #created-927</span></h2><div class="pubdate">04 Jan at 18:14:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/927">https://github.com/qt4cg/qtspecs/pull/927</a></div><details><summary>861 Rewrite spec of deep lookup operator</summary><div class="markup"><p>Fix #861</p>
<p>This is a complete rewrite of the spec for deep-lookup, hopefully clarifying some edge cases and fixing bugs, but not intended to introduce any major changes.</p>
</div></details></div>
<div class="toot" id="created-926"><h2>Pull request #926 created<span class="toot-id"> #created-926</span></h2><div class="pubdate">04 Jan at 12:55:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/926">https://github.com/qt4cg/qtspecs/pull/926</a></div><details><summary>860 Editorial rearrangement of spec for shallow lookup</summary><div class="markup"><p>Rearranges the spec for lookup expressions so that unary lookup is now defined in terms of postfix lookup, not the other way around; this simplifies the rules when the context value is not a singleton, or when the key specifier expression is context-dependent.</p>
<p>Fix #860</p>
</div></details></div>
<div class="toot" id="created-925"><h2>Pull request #925 created<span class="toot-id"> #created-925</span></h2><div class="pubdate">03 Jan at 23:39:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/925">https://github.com/qt4cg/qtspecs/pull/925</a></div><details><summary>780 Document incompatibility in format-number etc</summary><div class="markup"><p>Fix #780</p>
<p>Changes the XSLT and F+O specs to document a minor incompatibility arising from the change to functions such as <code>format-number()</code> to accept an argument of type <code>union(xs:string, xs:QName)</code> rather than <code>xs:string</code>.</p>
<p>In addition, in XSLT, all such functions now accept <code>union(xs:string, xs:QName)</code> rather than <code>union(xs:QName, xs:string)</code>. This is primarily to make them all consistent.</p>
</div></details></div>
<div class="toot" id="created-924"><h2>Pull request #924 created<span class="toot-id"> #created-924</span></h2><div class="pubdate">03 Jan at 19:59:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/924">https://github.com/qt4cg/qtspecs/pull/924</a></div><details><summary>648 Disallow user modifications to schema for FN namespace</summary><div class="markup"><p>Fix #648</p>
</div></details></div>
<div class="toot" id="closed-889"><h2>Issue #889 closed<span class="toot-id"> #closed-889</span></h2><div class="pubdate">03 Jan at 19:34:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/889">https://github.com/qt4cg/qtspecs/issues/889</a></div><p>Rename "Named Function Reference"</p></div>
<div class="toot" id="created-923"><h2>Pull request #923 created<span class="toot-id"> #created-923</span></h2><div class="pubdate">02 Jan at 23:02:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/923">https://github.com/qt4cg/qtspecs/pull/923</a></div><details><summary>913-new-examples-for-local-name-etc</summary><div class="markup"><p>I have created new (executable) examples for functions name, local-name, namespace-uri, node-name, count, number.</p>
<p>There are of course many other functions that would benefit from the same treatment.</p>
<p>Fix #913</p>
</div></details></div>
<div class="toot" id="created-922"><h2>Pull request #922 created<span class="toot-id"> #created-922</span></h2><div class="pubdate">01 Jan at 21:23:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/922">https://github.com/qt4cg/qtspecs/pull/922</a></div><details><summary>915 function body terminology</summary><div class="markup"><p>Fix #915</p>
</div></details></div>
<div class="toot" id="created-921"><h2>Pull request #921 created<span class="toot-id"> #created-921</span></h2><div class="pubdate">01 Jan at 20:14:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/921">https://github.com/qt4cg/qtspecs/pull/921</a></div><details><summary>920 Allow xsl:break and xsl:next-iteration within branch of xsl:switch</summary><div class="markup"><p>Allow xsl:break and xsl:next-iteration within branch of xsl:switch</p>
<p>Fix #920</p>
</div></details></div></div></article></main></body></html>