<item>
   <title>Issue #2381 created</title>
   <pubDate>2026-01-13T13:37:43Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/2381</link>
   <guid>https://qt4cg.org/@qt4cg/2026/#created-2381</guid>
   <description>&lt;div&gt;&lt;p&gt;Add facility to serialize binary values as url-safe base64 encoded strings&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;In XQuery 3.1 there are two XDM types to represent binary values &lt;code&gt;xs:base64binary&lt;/code&gt; and &lt;code&gt;xs:hexBinary&lt;/code&gt;.
The current draft adds binary literals as an additional option.&lt;/p&gt;
&lt;p&gt;Thus, it is possible to base64 encode any value by casting a xs:base64binary to a xs:string.&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;xs:base64Binary(xs:hexBinary("fb")) =&amp;gt; xs:string()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There is no standard way to serialize those binary values to the URL safe variant of that encoding described in &lt;a href="https://datatracker.ietf.org/doc/html/rfc4648#section-5"&gt;section 5 of RFC 4648&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The simplest workaround is replacing the unsafe characters of the alphabet (&lt;code&gt;+&lt;/code&gt; and &lt;code&gt;/&lt;/code&gt;) and dropping the padding at the end with&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;xs:base64Binary(xs:hexBinary("fb")) =&amp;gt; translate("+/=", "-_")
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This of course will only work for relatively small binary values. In order for processors to offer a performant and efficient way I see several options.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;adding new type &lt;code&gt;xs:base64BinaryUrlSafe&lt;/code&gt; whose string representation uses the adapted alphabet with &lt;code&gt;-&lt;/code&gt; and &lt;code&gt;_&lt;/code&gt; and does not add padding at the end&lt;/li&gt;
&lt;li&gt;a new function in fn namespace &lt;code&gt;fn:encode-base64-url-safe($data as (xs:string | xs:base64Binary | xs:hexBinary)) as xs:string&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;a new function in bin namespace &lt;code&gt;bin:encode-base64-url-safe($data as (xs:string | xs:base64Binary | xs:hexBinary)) as xs:string&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;add an &lt;strong&gt;output option&lt;/strong&gt; that will serialize all binary values to base64 url-safe when cast to strings&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Addendum&lt;/p&gt;
&lt;p&gt;I am also wondering why binary values cannot be created from numeric literals. Especially now that we have the binary notation for integer literals and the xs:integer type is unbounded this would be a perfectly fine literal notation to create binary values from. At least as suitable as string literals that are currently allowed.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;xs:hexBinary(0xfb)&lt;/code&gt; and &lt;code&gt;xs:base64Binary(0b11111111)&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
