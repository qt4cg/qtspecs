<item>
   <title>Issue #123 created</title>
   <pubDate>2022-08-09T17:33:59Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/123</link>
   <guid>https://qt4cg.org/@qt4cg/2022/#created-123</guid>
   <description>&lt;div&gt;&lt;p&gt;fn:duplicate-values&lt;/p&gt;&lt;div class="markup"&gt;&lt;h3&gt;Motivation&lt;/h3&gt;
&lt;p&gt;The new function &lt;code&gt;fn:unique&lt;/code&gt; can be used for consistency checks (e.g., to verify if IDs are distinct). Often, however, developers rather need to find the actual values that exist more than once. A &lt;code&gt;fn:duplicate-values&lt;/code&gt; (or &lt;code&gt;fn:duplicates&lt;/code&gt;) function could fill that gap.&lt;/p&gt;
&lt;h3&gt;Summary&lt;/h3&gt;
&lt;p&gt;Returns values that appear more than once in a sequence. Values are compared according to the rules of the &lt;code&gt;fn:distinct-values&lt;/code&gt; function.&lt;/p&gt;
&lt;h3&gt;Signatures&lt;/h3&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;fn:duplicate-values(
  $values     as xs:anyAtomicType*
) as xs:anyAtomicType*

fn:duplicate-values(
  $values     as xs:anyAtomicType*,
  $collation  as xs:string
) as xs:anyAtomicType*
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Use Case&lt;/h3&gt;
&lt;p&gt;Find the values of duplicate IDs in a sequence:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;let $ids := duplicate-values(//@id)
where exists($ids)
return error((), 'Duplicate IDs found: ' || string-join($ids, ', '))
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Examples&lt;/h3&gt;
&lt;p&gt;Query | Result
--- | ---
&lt;code&gt;fn:duplicate-values((1, '2', 3.0))&lt;/code&gt; | &lt;em&gt;empty sequence&lt;/em&gt;
&lt;code&gt;fn:duplicate-values(('id1', 'id10', 'id1'))&lt;/code&gt; | &lt;code&gt;id1&lt;/code&gt;
&lt;code&gt;fn:duplicate-values((1, 1 to 2, 1 to 3))&lt;/code&gt; | &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;
&lt;code&gt;fn:duplicate-values((1, 1.0, 1e0))&lt;/code&gt; | &lt;code&gt;1&lt;/code&gt; (as with &lt;code&gt;fn:distinct-values&lt;/code&gt;, items may be of different type)
&lt;code&gt;fn:duplicate-values(1 to 1000000000000000000)&lt;/code&gt; | &lt;em&gt;empty sequence&lt;/em&gt;
&lt;code&gt;fn:duplicate-values(())&lt;/code&gt; | &lt;em&gt;empty sequence&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Equivalent Expression&lt;/h3&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;for $group in $values
group by $value := $group (: collation 'value of $collation' :)
where count($group) &amp;gt; 1
return $value
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Advantages vs. Drawbacks&lt;/h3&gt;
&lt;p&gt;+ simple and intuitive to understand as proposed
+ behavior analogous to &lt;code&gt;distinct-values&lt;/code&gt;
– narrow focus (similar as &lt;code&gt;distinct-values&lt;/code&gt;)
– “yet another convenience function”&lt;/p&gt;
&lt;p&gt;Maybe it boils down to if we want to have more easy-to-use convenience functions, or if we rather wish to keep the set of functions limited.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
