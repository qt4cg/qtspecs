<item>
   <title>Issue #236 created</title>
   <pubDate>2022-11-11T12:37:17Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/236</link>
   <guid>https://qt4cg.org/@qt4cg/2022/#created-236</guid>
   <description>&lt;div&gt;&lt;p&gt;map:group-by or map:build with a sequence of keys&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;In resolving PR #203 to address issue #151, the group decided not to immediately address all of the concerns raised by Martin Honnen in &lt;a href="https://lists.w3.org/Archives/Public/public-xslt-40/2022Oct/0035.html"&gt;an email discussion&lt;/a&gt; where he wrote:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;When map:group-by was introduced I found the restriction of a single key
instead of a sequence of keys unnecessarily restrictive (some people on
Slack agreed), the same appears in my view to be the case for the new
map:build, I think it could be easily adapted to handle a sequence of
keys by using e.g.

  fold-left($input, map{}, -&amp;gt;($map, $next) {

   fold-left($key($next), $map, -&amp;gt;($map, $key) {
    let $nextValue := $value($next) return
    if (map:contains($map, $key))
    then map:put($map, $key, $combine($map($key), $nextValue))
    else map:put($map, $key, $nextValue)})
  }
)

as the implementation body/definition of the result of

map:build(
$input    as item()*,
$key    as function(item()) as xs:anyAtomicType*    := fn:identity#1,
$value    as function(item()) as item()*    := fn:identity#1,
$combine    as function(item()*, item()*) as item()*    := fn:op(',')
) as map(*)


Use case in my view is the classical example of the XSLT 3 spec where in
e.g.

&amp;lt;titles&amp;gt;
     &amp;lt;title&amp;gt;A Beginner's Guide to &amp;lt;ix&amp;gt;Java&amp;lt;/ix&amp;gt;&amp;lt;/title&amp;gt;
     &amp;lt;title&amp;gt;Learning &amp;lt;ix&amp;gt;XML&amp;lt;/ix&amp;gt;&amp;lt;/title&amp;gt;
     &amp;lt;title&amp;gt;Using &amp;lt;ix&amp;gt;XML&amp;lt;/ix&amp;gt; with &amp;lt;ix&amp;gt;Java&amp;lt;/ix&amp;gt;&amp;lt;/title&amp;gt;
&amp;lt;/titles&amp;gt;

you want to group the "title" elements by the "ix" child elements, with
the proposed change above that would give e.g.

map {
   "Java": (&amp;lt;title&amp;gt;A Beginner's Guide to &amp;lt;ix&amp;gt;Java&amp;lt;/ix&amp;gt;
&amp;lt;/title&amp;gt;, &amp;lt;title&amp;gt;Using &amp;lt;ix&amp;gt;XML&amp;lt;/ix&amp;gt; with &amp;lt;ix&amp;gt;Java&amp;lt;/ix&amp;gt;
&amp;lt;/title&amp;gt;),
   "XML": (&amp;lt;title&amp;gt;Learning &amp;lt;ix&amp;gt;XML&amp;lt;/ix&amp;gt;
&amp;lt;/title&amp;gt;, &amp;lt;title&amp;gt;Using &amp;lt;ix&amp;gt;XML&amp;lt;/ix&amp;gt; with &amp;lt;ix&amp;gt;Java&amp;lt;/ix&amp;gt;
&amp;lt;/title&amp;gt;)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We'll come back to this later.&lt;/p&gt;
&lt;p&gt;Creating this issue satisfies &lt;a href="https://qt4cg.org/meeting/minutes/2022/10-18.html#pr-map-build"&gt;action QT4CG-008-05 on NW&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
