<item>
   <title>Issue #2180 created</title>
   <pubDate>2025-09-04T15:08:09Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/2180</link>
   <guid>https://qt4cg.org/@qt4cg/2025/#created-2180</guid>
   <description>&lt;div&gt;&lt;p&gt;Clarify `$array/attribute(id)` vs `$array/type(attribute(id))`&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;I am creating test JAxes-326 which does&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;         let $xml := parse-xml("&amp;lt;doc&amp;gt;&amp;lt;p id='a17'/&amp;gt;&amp;lt;p id='a18'/&amp;gt;&amp;lt;/doc&amp;gt;")
         let $array := [$xml//p[@id='a17'], $xml//@id[.='a18']]
         return $array/type(attribute(id)) =&amp;gt; string()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That is, it constructs an array whose members are element or attribute nodes&lt;/p&gt;
&lt;p&gt;I think that if we write &lt;code&gt;$array/attribute(id)&lt;/code&gt; then the following rule kicks into play:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If the axis name is omitted from an [axis step], the default axis is child, with two exceptions: (1) if the [NodeTest] in an axis step contains an [AttributeTest] or [SchemaAttributeTest] then the default axis is attribute;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That is, this is equivalent to &lt;code&gt;$array/attribute::id&lt;/code&gt;, and the attribute axis from a JNode is always empty.&lt;/p&gt;
&lt;p&gt;Whereas if we write&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$array/type(attribute(id))&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;then the default axis is child, we are selecting the members of the array whose type is attribute(id), so the query returns "a18".&lt;/p&gt;
&lt;p&gt;A note to clarify this case, and perhaps more generally to clarify how path expressions that mix JNodes and XNodes work, would be helpful.&lt;/p&gt;
&lt;p&gt;ยง4.6.4.5 says&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;For the most commonly encountered types, this syntax can be abbreviated: for example node(), text(), array(*), and record(x, y) can be written directly without the enclosing type(...).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;and this perhaps needs expanding to explain that for attribute(), and perhaps also for other XNode tests, this equivalence might not apply.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
