<item>
   <title>Issue #1946 created</title>
   <pubDate>2025-04-22T16:27:12Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/1946</link>
   <guid>https://qt4cg.org/@qt4cg/2025/#created-1946</guid>
   <description>&lt;div&gt;&lt;p&gt;We need examples of a record with an entry that is a %method and invoking this method with the result it must produce&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;We have two new great features in XPath 4.0 - the &lt;strong&gt;record&lt;/strong&gt; and &lt;strong&gt;%method&lt;/strong&gt; entries of a map.&lt;/p&gt;
&lt;p&gt;It is natural to combine the two and have a record, one of whose entries is a method.&lt;/p&gt;
&lt;p&gt;Unfortunately, at present there is no such example in the relevant Specs, and this leaves the reader trying to guess even the syntax of the specific record definition.&lt;/p&gt;
&lt;p&gt;Therefore, we need at least one such example, to help readers and implementors in this.&lt;/p&gt;
&lt;p&gt;BaseX did a great job in implementing both records and  %method map-entries, and I constructed the following example, which is syntactically correct, but results in error (due to function coercion - explained in a separate issue here: https://github.com/qt4cg/qtspecs/issues/1938).&lt;/p&gt;
&lt;p&gt;This code:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xq"&gt;declare namespace t = "my:t";
declare record t:location 
   ( longitude as xs:integer,
     latitude as xs:integer,
     myFun2 as %method fn() as xs:integer,
     *
   );
   
   let $r := t:location(longitude := 25, latitude := 10, myFun2 := %method fn() {?longitude + ?latitude}
                        )
     return ($r, $r?myFun2())
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When executed with BaseX, raises an error: &lt;strong&gt;&lt;em&gt;[XPDY0002] .: Context value is undefined.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We need the specification to provide a similar example, and what the result should be.&lt;/p&gt;
&lt;p&gt;In particular:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Must the return type of the method myFun2 (above) be specified or can it be omitted? BaseX raises a syntax error if this is specified as: &lt;code&gt;myFun2 as %method fn()&lt;/code&gt; : "&lt;strong&gt;&lt;em&gt;Expecting 'as', found ','&lt;/em&gt;&lt;/strong&gt; ?&lt;/li&gt;
&lt;li&gt;If the method entry is specified as having a particular type (such as: &lt;code&gt;as xs:integer&lt;/code&gt;) then can the corresponding function, provided in the construction of this record omit the function type (such as &lt;code&gt;myFun2 := %method fn() {?longitude + ?latitude}&lt;/code&gt;) , even though it is clear that the type of the result is &lt;code&gt;xs:integer&lt;/code&gt; ?&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
