<item>
   <title>Issue #2275 created</title>
   <pubDate>2025-11-03T18:28:14Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/2275</link>
   <guid>https://qt4cg.org/@qt4cg/2025/#created-2275</guid>
   <description>&lt;div&gt;&lt;p&gt;Change record constructor, to simplify updates&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;Copied from https://github.com/qt4cg/qtspecs/issues/1953#issuecomment-2830012997 and updated:&lt;/p&gt;
&lt;p&gt;The value of the current record constructor is pretty limited when it comes to updating existing records – and it is fairly ugly to use repeated &lt;code&gt;map:put&lt;/code&gt; calls. With extensible records, it is already possible to pass an existing record to the constructor as last argument…&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;declare namespace geo = 'geo';
declare record geo:coord(x, y, *);

let $coord := geo:coord(0, 0, { 'z': 7 })
return geo:coord(3, 5, $coord)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This gives us:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-json"&gt;{ "x": 3, "y": 5, "z": 7 }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, the use cases for this variant are limited, and all mandatory arguments need to be supplied, even if they don’t change.&lt;/p&gt;
&lt;p&gt;I propose to change the constructor, and define the first argument as a container for an existing record. This way, the same result as above could be achieved with the following code:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;let $coord := geo:coord({ 'z': 7 }, 3, 0)
return geo:coord($coord, y := 5)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If all mandatory record arguments are supplied via keywords in the constructor call, the first argument can also be omitted:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;geo:coord(x := 3, y := 5)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The generated constructor function could be something like:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;declare function geo:coord(
  $record as map(*)? := {},
  $x := (),
  $y := ()
) as geo:coord {
  map:merge((
    { 'x': $x otherwise $record?x },
    { 'y': $y otherwise $record?y },
    $record
  ), { 'duplicates': 'use-first' })
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Challenges might be intricacies like the explicit assignment of empty sequences, but I think that the advantages would prevail. The syntax could also be used more easily for chaining:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;geo:coord({ 'z': 7 }, 0, 0)
=&amp;gt; geo:coord(x := 3)
=&amp;gt; geo:coord(y := 5)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
