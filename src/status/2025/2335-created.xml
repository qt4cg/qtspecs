<item>
   <title>Issue #2335 created</title>
   <pubDate>2025-12-06T13:45:55Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/2335</link>
   <guid>https://qt4cg.org/@qt4cg/2025/#created-2335</guid>
   <description>&lt;div&gt;&lt;p&gt;Make `jnode()` like `element()`&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;Is it possible to make the &lt;a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#doc-xpath40-JNodeType"&gt;&lt;code&gt;JNodeType&lt;/code&gt;&lt;/a&gt; form similar to &lt;a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#doc-xpath40-ElementTest"&gt;&lt;code&gt;ElementTest&lt;/code&gt;&lt;/a&gt; and &lt;a href="https://qt4cg.org/specifications/xslt-40/Overview.html#jnode-patterns"&gt;&lt;code&gt;JNodePattern&lt;/code&gt;&lt;/a&gt; (in XSLT)?&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ElementTest&lt;/code&gt; has the form:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-abnf"&gt;ElementTest 	::= 	"element" "(" (NameTestUnion ("," TypeName "?"?)?)? ")"
NameTestUnion 	::= 	(NameTest ++ "|")
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And &lt;code&gt;JNodePattern&lt;/code&gt; currently has the form:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-abnf"&gt;JNodePattern ::="jnode" "(" JNodePatternSelector "," JNodePatternContent ")" Predicate*
JNodePatternSelector 	::= 	"*" | NCName | Constant
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But &lt;code&gt;JNodeType&lt;/code&gt; has the form:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-abnf"&gt;JNodeType 	::= 	"jnode" "(" SequenceType? ")"
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I think, &lt;strong&gt;this introduces an inconsistency&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The expected forms are:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-abnf"&gt;JNodePattern ::= JNodeType Predicate*
JNodeType 	::= 	"jnode" "(" (JNodePatternSelector ("," JNodePatternContent )? )? ")"
JNodePatternContent 	::= 	"*" | SequenceType
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Probably, &lt;code&gt;JNodePatternContent&lt;/code&gt; is not needed, since &lt;code&gt;JNodePattern&lt;/code&gt; &lt;code&gt;jnode()&lt;/code&gt; should be equal to &lt;code&gt;jnode(*,*)&lt;/code&gt; in the current spec. Then, &lt;code&gt;SequenceType&lt;/code&gt; should be used instead of &lt;code&gt;JNodePatternContent&lt;/code&gt; in &lt;code&gt;JNodeType&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-abnf"&gt;JNodePattern ::= JNodeType Predicate*
JNodeType 	::= 	"jnode" "(" (JNodePatternSelector ("," SequenceType )? )? ")"
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This form is not only more consistent, but also it provides a more concise way to select GNodes by matching both their &lt;em&gt;selector&lt;/em&gt; property and their &lt;code&gt;jnode()&lt;/code&gt; type:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$g / jnode( foo )&lt;/code&gt; will be equivalent to &lt;code&gt;$g / foo [ self::jnode() ]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$g / jnode( foo, xs:integer )&lt;/code&gt; will be equivalent to &lt;code&gt;$g / foo [ self::jnode() ][ jnode-content() instance of xs:integer ]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$g / jnode( *, xs:integer )&lt;/code&gt; will be equivalent to &lt;code&gt;$g / jnode() [ jnode-content() instance of xs:integer ]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Probably, &lt;code&gt;JNodePatternSelector&lt;/code&gt; can be changed to &lt;code&gt;JNodeSelectorUnion&lt;/code&gt; to support unions like &lt;code&gt;NameTestUnion&lt;/code&gt; in &lt;code&gt;ElementTest&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-abnf"&gt;JNodeType 	::= 	"jnode" "(" (JNodeSelectorUnion ("," SequenceType )? )? ")"
JNodeSelectorUnion ::= JNodeSelector ++ "|"
JNodeSelector ::= "*" | NCName | Constant
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Side note: It appears that despite of the name &lt;code&gt;ElementTest&lt;/code&gt;, an expression of the &lt;code&gt;ElementTest&lt;/code&gt; production represents a &lt;strong&gt;type&lt;/strong&gt;, the same as &lt;code&gt;JNodeType&lt;/code&gt;.&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;This topic was also discussed a bit in &lt;a href="https://github.com/qt4cg/qtspecs/issues/2099#issuecomment-3104549916"&gt;#2099 (comment)&lt;/a&gt;, and the analogy was mentioned in &lt;a href="https://github.com/qt4cg/qtspecs/issues/2150#issue-3295735972:~:text=An%20analogy%20with%20element%28N%2C%20T%29%20might%20suggest%20match%3D%22jnode%28K%2C%20V%29%22%20where%20K%20constrains%20the%20selector%20property%20of%20the%20JNode%2C%20and%20V%20constrains%20its%20content%20property%2E"&gt;#2150&lt;/a&gt;: "An analogy with &lt;code&gt;element(N, T)&lt;/code&gt; might suggest &lt;code&gt;match="jnode(K, V)"&lt;/code&gt; where &lt;code&gt;K&lt;/code&gt; constrains the selector property of the JNode, and &lt;code&gt;V&lt;/code&gt; constrains its content property".&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
