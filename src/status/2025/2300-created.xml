<item>
   <title>Issue #2300 created</title>
   <pubDate>2025-11-17T15:35:43Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/2300</link>
   <guid>https://qt4cg.org/@qt4cg/2025/#created-2300</guid>
   <description>&lt;div&gt;&lt;p&gt;`fn:doc`: determinism rules&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;I think the rules for &lt;code&gt;fn:doc&lt;/code&gt; must be stabilized with regard to determinism.&lt;/p&gt;
&lt;p&gt;First, the function properties say:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This function is ·deterministic·, ·context-dependent·, and ·focus-independent·. It depends on available documents, and executable base URI.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is outdated (it does not apply if the &lt;code&gt;stable&lt;/code&gt; option is enabled), but this can possibly be fixed along with #1459.&lt;/p&gt;
&lt;p&gt;Next, the text says:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;By default, this function is ·deterministic·. Two calls on this function return the same document node if the same URI Reference (after resolution to an absolute URI Reference) is supplied to both calls.
…
Note: This equivalence applies only because the two calls on the &lt;code&gt;fn:doc&lt;/code&gt; function have the same options and the same static and dynamic context, to the extent this is relevant.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This implies that the function will be deterministic if the options are the same; but we should at least exclude the &lt;code&gt;stable: false&lt;/code&gt; case. Next, it implies that &lt;code&gt;fn:doc($doc, { 'include': true() }) is fn:doc($doc, { 'include': true() })&lt;/code&gt; &lt;strong&gt;MUST&lt;/strong&gt; return &lt;code&gt;true()&lt;/code&gt;, but we could be more clear.&lt;/p&gt;
&lt;p&gt;Maybe it is easier to define the function as ·nondeterministic· by default, and describe the cases in which it will be deterministic?&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
