<item>
   <title>Issue #1934 created</title>
   <pubDate>2025-04-14T14:26:24Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/1934</link>
   <guid>https://qt4cg.org/@qt4cg/2025/#created-1934</guid>
   <description>&lt;div&gt;&lt;p&gt;Supporting RELAX NG validation&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;At &lt;a href="https://qt4cg.org/meeting/minutes/2025/04-08.html"&gt;meeting 116&lt;/a&gt;, the question was raised: why don't we support RELAX NG validation?&lt;/p&gt;
&lt;p&gt;I think that's a good question. Further, I think we should, if we can work out the technical details and arrive at consensus.&lt;/p&gt;
&lt;p&gt;The good news is that it's &lt;em&gt;a lot&lt;/em&gt; simpler than XSD validation. For those not familiar with RELAX NG, the 50,000 foot summary is that it's (more-or-less) regular expressions over trees. The grammar defines a number of patterns, including at least one designated as a start pattern. If the document matches (any one of the) start pattern(s), then it's valid. A trivial example looks like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;start = doc

doc =
    element doc {
        attribute date { xsd:date },
        p+
    }

p =
    element p {
        text
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(RELAX NG also has an XML syntax, but the "compact syntax" is isomorphic and many people find it easier to read.)&lt;/p&gt;
&lt;p&gt;A couple of things to note: the "p" in "p+" in the doc pattern is a reference to the "p" pattern, not to the element named "p". And although the date attribute has to conform to an &lt;code&gt;xsd:date&lt;/code&gt;, that &lt;em&gt;does not&lt;/em&gt; do any type assignment. RELAX NG allows user-defined data types; I suggest we make that an implementation-defined feature. Since no type assignment is performed, it doesn't really matter.&lt;/p&gt;
&lt;p&gt;How might we add support for RELAX NG validation? A sketch...&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Add to the static context a set of RELAX NG patterns. Initally empty, these are patterns that can match the document element during RELAX NG validation. (The union of all of the "start" patterns from all of the imported RELAX NG grammars.) There's no user-access to these patterns, so we don't technically need to add them to the data model, though I suppose we could.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;In XQuery, allow schema import to import RELAX NG grammars. This has no effect except that the start patterns defined in that grammar are added to the start patterns in the static context. It is an error to specify “fixed” or “default element namespace” if the imported schema is a RELAX NG grammar.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Add “relax-ng” as a &lt;code&gt;ValidationMode&lt;/code&gt; in &lt;code&gt;ValidateExpr&lt;/code&gt;. It is an error to also specify a “type”.&lt;/p&gt;
&lt;p&gt;If RELAX NG validation is requested, the patterns in the static context are used to attempt to validate the document. If one succeeds, the validated document is returned. If none succeed, that’s an error.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;In XSLT, allow schema import to import RELAX NG grammars.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;Details about role, TBD&lt;/li&gt;
&lt;li&gt;Details about literal schema elements, TBD&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="5"&gt;
&lt;li&gt;
&lt;p&gt;In XSLT, on elements that have a validation attribute, allow the value “relax-ng” with semantics analagous to the validate expression in XQuery.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;In the F&amp;amp;O functions that have “dtd-validation” and “xsd-validation” options, add a boolean “relax-ng” validation option. If true, validation is done with the patterns in the static context.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;There's one small wrinkle, the &lt;a href="https://relaxng.org/compatibility-20011203.html"&gt;RELAX NG DTD Compatibility&lt;/a&gt; specification defines some annotations that allow a RELAX NG grammar to return default attributes. That means RELAX NG validation &lt;em&gt;can&lt;/em&gt; return a different document than was validated, but I'm not sure how important that support is in 2025 if there were strong objections.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
