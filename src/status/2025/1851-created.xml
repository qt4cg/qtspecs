<item>
   <title>Issue #1851 created</title>
   <pubDate>2025-02-26T15:42:11Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/1851</link>
   <guid>https://qt4cg.org/@qt4cg/2025/#created-1851</guid>
   <description>&lt;div&gt;&lt;p&gt;Questions on `fn:atomic-type-annotation`&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;These questions came up while working on &lt;code&gt;fn:atomic-type-annotation&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;what is the &lt;code&gt;variety&lt;/code&gt; of &lt;code&gt;xs:anySimpleType&lt;/code&gt;?&lt;/li&gt;
&lt;li&gt;should not &lt;code&gt;constructor&lt;/code&gt; be absent in an &lt;code&gt;fn:schema-type-record&lt;/code&gt; describing &lt;code&gt;xs:QName&lt;/code&gt;?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here are the detailed observations:&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;fn:schema-type-record?variety&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Consider the following query:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;  (
    &amp;lt;x&amp;gt;42&amp;lt;/x&amp;gt;
    =&amp;gt; fn:atomic-type-annotation()
  )
  ?base-type()
  ?base-type()
  ?variety
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;My interpretation is as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the &lt;code&gt;x&lt;/code&gt; element node is atomized to a value of type &lt;code&gt;xs:untypedAtomic&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;so &lt;code&gt;fn:atomic-type-annotation&lt;/code&gt; returns the information for &lt;code&gt;xs:untypedAtomic&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;the base type of that is &lt;code&gt;xs:anyAtomicType&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;the base type of that is &lt;code&gt;xs:anySimpleType&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;per &lt;a href="https://www.w3.org/TR/xmlschema11-1/#sec-anySimpleType"&gt;XML schema 1.1, 3.16.7.1 xs:anySimpleType&lt;/a&gt;, the &lt;code&gt;{variety}&lt;/code&gt; of &lt;code&gt;xs:anySimpleType&lt;/code&gt; is absent,&lt;/li&gt;
&lt;li&gt;so &lt;code&gt;variety&lt;/code&gt; should be absent in an &lt;code&gt;fn:schema-type-record&lt;/code&gt; describing &lt;code&gt;xs:anySimpleType&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;the result thus should be an empty sequence.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;According to the &lt;a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#schema-type-record"&gt;current spec&lt;/a&gt;, &lt;code&gt;variety&lt;/code&gt; must always be present with a value of type &lt;code&gt;enum("atomic", "list", "union", "empty", "simple", "element-only", "mixed")&lt;/code&gt;, but also correspond to the &lt;code&gt;{variety}&lt;/code&gt; of the simple type in the XSD component model.&lt;/p&gt;
&lt;p&gt;Should not &lt;code&gt;variety&lt;/code&gt; be optional, and omitted for &lt;code&gt;xs:anySimpleType&lt;/code&gt;?&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;fn:schema-type-record?constructor&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;The spec says this about &lt;code&gt;constructor&lt;/code&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The field is absent for complex types and for the abstract types xs:anyAtomicType, xs:anySimpleType, and xs:NOTATION. It is also absent for all namespace-sensitive types, that is, types derived from xs:QName or xs:NOTATION.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The formulation does not include &lt;code&gt;xs:QName&lt;/code&gt;, but should not its constructor be absent for the same reasons as for the types derived from it?&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
