<item>
   <title>Issue #1948 created</title>
   <pubDate>2025-04-23T14:43:55Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/1948</link>
   <guid>https://qt4cg.org/@qt4cg/2025/#created-1948</guid>
   <description>&lt;div&gt;&lt;p&gt;fn:element-to-map: Tests&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;My feedback is based on the latest version PR (#1906) and the latest test cases (https://github.com/qt4cg/qt4tests/pull/223). I decided to list my observations in this repository, as I am not sure whether itâ€™s the tests or the spec that may possibly need to be revised:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;element-to-map-017&lt;/code&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;As discussed in the last meeting (see also https://github.com/qt4cg/qtspecs/pull/1906#issuecomment-2821502378), the &lt;code&gt;xsi:type&lt;/code&gt; attribute should already be ignored in the choice of the conversion plan, in order to choose a plan that does not include attributes:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;element-to-map(parse-xml('&amp;lt;a xmlns="http://a.com/" xsi:type="xs:integer"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"&amp;gt;2&amp;lt;/a&amp;gt;')/*)
Result: { "Q{http://a.com/}a": 2 }
Expect: { "Q{http://a.com/}a": { "#content": "2" } }
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start="2"&gt;
&lt;li&gt;&lt;code&gt;element-to-map-401&lt;/code&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I would expect the &lt;code&gt;record&lt;/code&gt; layout to be also applied for the &lt;code&gt;b&lt;/code&gt; child node:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;element-to-map(parse-xml('&amp;lt;a id="3"&amp;gt;&amp;lt;b/&amp;gt;&amp;lt;/a&amp;gt;')/a, {'plan': {'a': {'layout': 'empty'},
  '*': {'layout': 'record'}, '@id': {'type': 'numeric'} }})
Result: { "a": { "@id": 3, "b": { } } }
Expect: { "a": { "@id": 3, "b": "" } }
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;code&gt;element-to-map-420&lt;/code&gt; and others:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;As discussed in the meeting, &lt;code&gt;list&lt;/code&gt; layouts require a &lt;code&gt;child&lt;/code&gt; key:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;element-to-map(parse-xml('&amp;lt;a id="zz"&amp;gt;&amp;lt;b/&amp;gt;&amp;lt;b/&amp;gt;&amp;lt;c/&amp;gt;&amp;lt;/a&amp;gt;')/a, {'plan':{'a':{'layout':'list'}}})
Error : XPTY0004: Missing key 'child' (node: a).
Expect: FOJS0008
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start="4"&gt;
&lt;li&gt;&lt;code&gt;element-to-map-511&lt;/code&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I would expect the &lt;code&gt;mixed&lt;/code&gt; layout to be also applied for the &lt;code&gt;a&lt;/code&gt; child node:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;element-to-map(parse-xml('&amp;lt;a&amp;gt;The &amp;lt;i&amp;gt;short&amp;lt;/i&amp;gt; introduction&amp;lt;/a&amp;gt;')/a, {'plan': {'a': {'layout':'simple'}, '*': {'layout':'mixed'} }})
Result: { "a": [ "The ", { "i": [ "short" ] }, " introduction" ] }
Expect: { "a": array { ("The ", { "i": "short" }, " introduction") } }
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
