<!DOCTYPE HTML>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>XSLT Streaming Version 4.0</title>
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <link rel="stylesheet" type="text/css" href="css/w3c-base.css">
      <link rel="stylesheet" href="css/qtspecs.css">
      <link rel="stylesheet" href="css/xslt-xquery-serialization-40.css">
   </head>
   <body>
      <div class="head">
         <p><a href="https://www.w3.org/"><img src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" alt="W3C" height="48" width="72"></a></p>
         
         <h1><a id="title"></a>XSLT Streaming Version 4.0</h1>
         
         <h2><a id="w3c-doctype"></a>W3C Editor's Draft 5 Sept 2025</h2>
         <dl>
            <dt>This version:</dt>
            <dd><a href="https://qt4cg.org/pr/2487/xslt-streaming-40//">https://qt4cg.org/pr/2487/xslt-streaming-40/</a></dd>
            <dt>Latest version:</dt>
            <dd>
               <a href="https://qt4cg.org/specifications/xslt-streaming-40/">https://qt4cg.org/specifications/xslt-streaming-40/</a>
               </dd>
            <dt>Most recent Recommendation of XSL Transformations (XSLT):</dt>
            <dd>
               <a href="https://www.w3.org/TR/xslt-30/">https://www.w3.org/TR/xslt-30/</a>
               </dd>
            <dt>Editor:</dt>
            <dd>Michael Kay, Saxonica <a href="http://www.saxonica.com/">&lt;http://www.saxonica.com/&gt;</a></dd>
         </dl>
         <p>Please check the <a href="https://www.w3.org/XML/2017/qt-errata/xslt-xquery-serialization-40-errata.html"><strong>errata</strong></a> for any errors or issues reported since publication.</p>
         <p>See also <a href="https://www.w3.org/2003/03/Translations/byTechnology?technology=xslt-xquery-serialization-40"><strong>translations</strong></a>.</p>
         <p>This document is also available in these non-normative formats: <a href="xslt-streaming-40.xml">Specification in XML format</a>.</p>
         <p class="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>&nbsp;©&nbsp;2025&nbsp;<a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p>
         <hr>
      </div>
      <div>
         
         <h2><a id="abstract"></a>Abstract</h2>
         <p>This document defines the streaming feature of XSLT 4.0.</p>
         <p>The earlier XSLT 3.0 specification integrated the definition of streaming
  into the main language specification, although streaming was always an optional feature.
  In this version, the specification has been modularised so that streaming features
  are described separately. This has been done in order to make the set of specification
  documents more manageable both for editors and for readers.</p>
      </div>
      <div>
         
         <h2><a id="status"></a>Status of this Document</h2>
         <p><em>This section describes the status of this document at the time of its publication.
               Other documents may supersede this document.</em></p>
         <p>This document is a working draft developed and maintained by a W3C Community Group,
            the <a href="https://www.w3.org/community/xslt-40/">XQuery and XSLT Extensions Community Group</a>
            unofficially known as QT4CG (where "QT" denotes Query and Transformation). This draft
            is work in progress and should not be considered either stable or complete.
            Standard W3C copyright and patent conditions apply.</p>
         <p>The community group welcomes comments on the specification. Comments are best submitted
         as issues on the group's <a href="https://github.com/qt4cg/qtspecs/issues">GitHub repository</a>.</p>
         <p>The community group maintains two extensive test suites, 
            one oriented to XQuery and XPath, the other to XSLT.
         These can be found at <a href="https://github.com/qt4cg/qt4tests">qt4tests</a> and
         <a href="https://github.com/qt4cg/xslt40-test">xslt40-test</a> respectively. New tests,
         or suggestions for correcting existing tests, are welcome. The test suites include extensive metadata
         describing the conditions for applicability of each test case as well as the expected results. They
         do not include any test drivers for executing the tests: each implementation is expected to provide
         its own test driver.</p>
         <p>At the time of writing this specification does not fully describe the streamability of all
       new constructs introduced in XSLT 4.0 and XPath 4.0. This remains a work in progress.</p>
         <div class="dedication" id="dedication">
            <h3>Dedication</h3>
            <p>The publications of this community group 
<a href="../xquery-40/xpath-40.html#dedication">are dedicated</a> to our co-chair,
Michael Sperberg-McQueen&nbsp;(1954–2024).</p>
         </div>
      </div>
      <nav id="toc">
         
         <h2><a id="contents"></a>Table of Contents<span class="expalltoc collapsed"> ▶</span></h2>
         <ol class="toc">
            <li>
               <details>
                  <summary><a href="#intro"><span class="secno">1 </span><span class="content toc-chg">Introduction</span></a><span class="exptoc collapsed"></span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#terminology"><span class="secno">1.1 </span><span class="content">Terminology</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#Concepts"><span class="secno">2 </span><span class="content">Concepts</span></a><span class="exptoc collapsed"></span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#streaming-concepts"><span class="secno">2.1 </span><span class="content">Streaming</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#streamed-validation"><span class="secno">2.2 </span><span class="content">Streamed Validation</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#initiating-streaming"><span class="secno">2.3 </span><span class="content">Initiating a Streamed Transformation</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#streaming-non-xml"><span class="secno">2.4 </span><span class="content">Streaming of non-XML data</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#model-for-streaming"><span class="secno">2.5 </span><span class="content">Data Model for Streaming</span></a><span class="exptoc collapsed"></span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#streamed-documents"><span class="secno">2.5.1 </span><span class="content">Streamed Documents</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streaming-other-types"><span class="secno">2.5.2 </span><span class="content">Maps and Arrays</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#streamability"><span class="secno">3 </span><span class="content">Streamability Analysis Principles</span></a><span class="exptoc collapsed"></span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#streamability-guarantees"><span class="secno">3.1 </span><span class="content">Streamability Guarantees</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#operand-roles"><span class="secno">3.2 </span><span class="content">Operand Roles</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#operand-usage"><span class="secno">3.3 </span><span class="content">Operand Usage</span></a><span class="exptoc collapsed"></span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#type-determined-usage"><span class="secno">3.3.1 </span><span class="content">Type-determined Usage</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#streamability-properties"><span class="secno">3.4 </span><span class="content">Streamability Properties</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#determining-static-type"><span class="secno">3.5 </span><span class="content toc-chg">Determining the Static Type of a Construct</span></a><span class="exptoc collapsed"></span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#static-type-of-xpath-expressions"><span class="secno">3.5.1 </span><span class="content">Static Type Inference for XPath Expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#static-type-of-steps"><span class="secno">3.5.2 </span><span class="content">Static Type of an Axis Step</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#static-type-of-current-function"><span class="secno">3.5.3 </span><span class="content">Static Type of a Call to current</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#notes-on-schema-aware-analysis"><span class="secno">3.5.4 </span><span class="content">Schema-Aware Streamability Analysis</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#determining-context-item-type"><span class="secno">3.6 </span><span class="content">Determining the Context Item Type</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#operand-roles-and-usage"><span class="secno">3.7 </span><span class="content">The Effect of Operand Usage</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#posture"><span class="secno">3.8 </span><span class="content">Posture</span></a><span class="exptoc collapsed"></span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#id-choice-operand-groups"><span class="secno">3.8.1 </span><span class="content">Choice Operand Groups</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#determining-context-posture"><span class="secno">3.8.2 </span><span class="content">Determining the Context Posture</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#sweep"><span class="secno">3.9 </span><span class="content">Sweep</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#general-streamability-rules"><span class="secno">3.10 </span><span class="content">General Streamability Rules</span></a><span class="exptoc collapsed"></span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#general-streamability-examples"><span class="secno">3.10.1 </span><span class="content">Examples of the General Streamability Rules</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#streaming-source-documents"><span class="secno">4 </span><span class="content">Streaming Source Documents</span></a><span class="exptoc collapsed"></span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#source-document-streamability"><span class="secno">4.1 </span><span class="content">Streamability of xsl:source-document</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#stream-examples"><span class="secno">4.2 </span><span class="content">Examples of xsl:source-document</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#streamable-templates"><span class="secno">5 </span><span class="content">Streamable Templates</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#streaming-with-xsl-iterate"><span class="secno">6 </span><span class="content">Streaming with xsl:iterate</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#handling-empty-input"><span class="secno">7 </span><span class="content">Handling Empty Input</span></a><span class="exptoc collapsed"></span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#evaluating-on-empty"><span class="secno">7.1 </span><span class="content">Streamed Evaluation of xsl:on-empty and xsl:on-non-empty</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#streamability-of-stylesheet-functions"><span class="secno">8 </span><span class="content">Streamable Stylesheet Functions</span></a><span class="exptoc collapsed"></span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#streamable-stylesheet-functions"><span class="secno">8.1 </span><span class="content">Classifying Stylesheet Functions</span></a><span class="exptoc collapsed"></span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#category-unclassified"><span class="secno">8.1.1 </span><span class="content">Streamability Category: unclassified</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#category-absorbing"><span class="secno">8.1.2 </span><span class="content">Streamability Category: absorbing</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#category-inspection"><span class="secno">8.1.3 </span><span class="content">Streamability Category: inspection</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#category-filter"><span class="secno">8.1.4 </span><span class="content">Streamability Category: filter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#category-shallow-descent"><span class="secno">8.1.5 </span><span class="content">Streamability Category: shallow-descent</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#category-deep-descent"><span class="secno">8.1.6 </span><span class="content">Streamability Category: deep-descent</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#category-ascent"><span class="secno">8.1.7 </span><span class="content">Streamability Category: ascent</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#streamability-of-attribute-sets"><span class="secno">9 </span><span class="content">Streamable Attribute Sets</span></a><span class="exptoc collapsed"></span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#classifying-attribute-sets"><span class="secno">9.1 </span><span class="content">Classifying Attribute Sets</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#streamable-merging"><span class="secno">10 </span><span class="content">Streamable Merging</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#streamability-of-accumulators"><span class="secno">11 </span><span class="content">Streamable Accumulators</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#streamability-of-constructs"><span class="secno">12 </span><span class="content">Streamability of Specific Constructs</span></a><span class="exptoc collapsed"></span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#maps-streaming"><span class="secno">12.1 </span><span class="content">Maps and Streaming</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#keys-and-streaming"><span class="secno">12.2 </span><span class="content">Keys and Streaming</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#grounded-consuming-constructs"><span class="secno">12.3 </span><span class="content">Grounded Consuming Constructs</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#classifying-sequence-constructors"><span class="secno">12.4 </span><span class="content">Classifying Sequence Constructors</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#classifying-instructions"><span class="secno">12.5 </span><span class="content">Classifying Instructions</span></a><span class="exptoc collapsed"></span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#streamability-literal-result-elements"><span class="secno">12.5.1 </span><span class="content">Streamability of Literal Result Elements</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-extension-instructions"><span class="secno">12.5.2 </span><span class="content">Streamability of extension instructions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-analyze-string"><span class="secno">12.5.3 </span><span class="content">Streamability of xsl:analyze-string</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-apply-imports"><span class="secno">12.5.4 </span><span class="content">Streamability of xsl:apply-imports</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-apply-templates"><span class="secno">12.5.5 </span><span class="content">Streamability of xsl:apply-templates</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-assert"><span class="secno">12.5.6 </span><span class="content">Streamability of xsl:assert</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-attribute"><span class="secno">12.5.7 </span><span class="content">Streamability of xsl:attribute</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-break"><span class="secno">12.5.8 </span><span class="content">Streamability of xsl:break</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-call-template"><span class="secno">12.5.9 </span><span class="content">Streamability of xsl:call-template</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-choose"><span class="secno">12.5.10 </span><span class="content">Streamability of xsl:choose</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-comment"><span class="secno">12.5.11 </span><span class="content">Streamability of xsl:comment</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-copy"><span class="secno">12.5.12 </span><span class="content">Streamability of xsl:copy</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-copy-of"><span class="secno">12.5.13 </span><span class="content">Streamability of xsl:copy-of</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-document"><span class="secno">12.5.14 </span><span class="content">Streamability of xsl:document</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-element"><span class="secno">12.5.15 </span><span class="content">Streamability of xsl:element</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-evaluate"><span class="secno">12.5.16 </span><span class="content">Streamability of xsl:evaluate</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-fallback"><span class="secno">12.5.17 </span><span class="content">Streamability of xsl:fallback</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-for-each"><span class="secno">12.5.18 </span><span class="content">Streamability of xsl:for-each</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-for-each-group"><span class="secno">12.5.19 </span><span class="content">Streamability of xsl:for-each-group</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-fork"><span class="secno">12.5.20 </span><span class="content">Streamability of xsl:fork</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-if"><span class="secno">12.5.21 </span><span class="content">Streamability of xsl:if</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-iterate"><span class="secno">12.5.22 </span><span class="content">Streamability of xsl:iterate</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-map"><span class="secno">12.5.23 </span><span class="content toc-chg">Streamability of xsl:map</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-map-entry"><span class="secno">12.5.24 </span><span class="content">Streamability of xsl:map-entry</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-merge"><span class="secno">12.5.25 </span><span class="content">Streamability of xsl:merge</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-message"><span class="secno">12.5.26 </span><span class="content">Streamability of xsl:message</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-namespace"><span class="secno">12.5.27 </span><span class="content">Streamability of xsl:namespace</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-next-iteration"><span class="secno">12.5.28 </span><span class="content">Streamability of xsl:next-iteration</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-next-match"><span class="secno">12.5.29 </span><span class="content">Streamability of xsl:next-match</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-number"><span class="secno">12.5.30 </span><span class="content">Streamability of xsl:number</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-on-empty"><span class="secno">12.5.31 </span><span class="content">Streamability of xsl:on-empty</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-on-non-empty"><span class="secno">12.5.32 </span><span class="content">Streamability of xsl:on-non-empty</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-perform-sort"><span class="secno">12.5.33 </span><span class="content">Streamability of xsl:perform-sort</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-processing-instruction"><span class="secno">12.5.34 </span><span class="content">Streamability of xsl:processing-instruction</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-record"><span class="secno">12.5.35 </span><span class="content">Streamability of xsl:record</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-result-document"><span class="secno">12.5.36 </span><span class="content">Streamability of xsl:result-document</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-sequence"><span class="secno">12.5.37 </span><span class="content">Streamability of xsl:sequence</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-stream"><span class="secno">12.5.38 </span><span class="content">Streamability of xsl:source-document</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-switch"><span class="secno">12.5.39 </span><span class="content">Streamability of xsl:switch</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-text"><span class="secno">12.5.40 </span><span class="content">Streamability of xsl:text</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-try"><span class="secno">12.5.41 </span><span class="content">Streamability of xsl:try</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-value-of"><span class="secno">12.5.42 </span><span class="content">Streamability of xsl:value-of</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-variable"><span class="secno">12.5.43 </span><span class="content">Streamability of xsl:variable</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-xsl-where-populated"><span class="secno">12.5.44 </span><span class="content">Streamability of xsl:where-populated</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#classifying-vts"><span class="secno">12.6 </span><span class="content">Classifying Value Templates</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#classifying-expressions"><span class="secno">12.7 </span><span class="content">Classifying Expressions</span></a><span class="exptoc collapsed"></span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-for-expressions"><span class="secno">12.7.1 </span><span class="content">Streamability of for Expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-quantified-expressions"><span class="secno">12.7.2 </span><span class="content">Streamability of Quantified Expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-if-expressions"><span class="secno">12.7.3 </span><span class="content">Streamability of if expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-union-expressions"><span class="secno">12.7.4 </span><span class="content">Streamability of union, intersect, and
                                             except Expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-instance-of-expressions"><span class="secno">12.7.5 </span><span class="content">Streamability of instance of Expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-treat-as-expressions"><span class="secno">12.7.6 </span><span class="content">Streamability of treat as Expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-simple-mapping-expressions"><span class="secno">12.7.7 </span><span class="content">Streamability of Simple Mapping Expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-path-expressions"><span class="secno">12.7.8 </span><span class="content">Streamability of Path Expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-axis-steps"><span class="secno">12.7.9 </span><span class="content">Streamability of Axis Steps</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-filter-expressions"><span class="secno">12.7.10 </span><span class="content">Streamability of Filter Expressions</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-dynamic-function-calls"><span class="secno">12.7.11 </span><span class="content">Streamability of Dynamic Function Calls</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-variable-references"><span class="secno">12.7.12 </span><span class="content">Streamability of Variable References</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-context-item-expression"><span class="secno">12.7.13 </span><span class="content">Streamability of the Context Item Expression</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-function-calls"><span class="secno">12.7.14 </span><span class="content">Streamability of Static Function Calls</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-named-function-ref"><span class="secno">12.7.15 </span><span class="content">Streamability of Named Function References</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-inline-functions"><span class="secno">12.7.16 </span><span class="content">Streamability of Inline Function Declarations</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-map-constructors"><span class="secno">12.7.17 </span><span class="content">Streamability of Map Constructors</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-of-lookup-expressions"><span class="secno">12.7.18 </span><span class="content">Streamability of Lookup Expressions</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#classifying-built-in-functions"><span class="secno">12.8 </span><span class="content">Classifying Calls to Built-In Functions</span></a><span class="exptoc collapsed"></span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-accumulator-after"><span class="secno">12.8.1 </span><span class="content">Streamability of the accumulator-after Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-accumulator-before"><span class="secno">12.8.2 </span><span class="content">Streamability of the accumulator-before Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-current"><span class="secno">12.8.3 </span><span class="content">Streamability of the current Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-current-group"><span class="secno">12.8.4 </span><span class="content">Streamability of the current-group Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-current-grouping-key"><span class="secno">12.8.5 </span><span class="content">Streamability of the current-grouping-key
                                             Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-current-merge-group"><span class="secno">12.8.6 </span><span class="content">Streamability of the current-merge-group
                                             Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-current-merge-key"><span class="secno">12.8.7 </span><span class="content">Streamability of the current-merge-key Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-current-merge-key-array"><span class="secno">12.8.8 </span><span class="content">Streamability of the current-merge-key-array Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-distinct-ordered-nodes"><span class="secno">12.8.9 </span><span class="content">Streamability of the distinct-ordered-nodes Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-fold-left"><span class="secno">12.8.10 </span><span class="content">Streamability of the fold-left Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-fold-right"><span class="secno">12.8.11 </span><span class="content">Streamability of the fold-right Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-foot"><span class="secno">12.8.12 </span><span class="content">Streamability of the foot Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-for-each"><span class="secno">12.8.13 </span><span class="content">Streamability of the for-each Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-for-each-pair"><span class="secno">12.8.14 </span><span class="content">Streamability of the for-each-pair Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-function-lookup"><span class="secno">12.8.15 </span><span class="content">Streamability of the function-lookup Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-innermost"><span class="secno">12.8.16 </span><span class="content">Streamability of the innermost Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-last"><span class="secno">12.8.17 </span><span class="content">Streamability of the last Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-outermost"><span class="secno">12.8.18 </span><span class="content">Streamability of the outermost Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-position"><span class="secno">12.8.19 </span><span class="content">Streamability of the position Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-reverse"><span class="secno">12.8.20 </span><span class="content">Streamability of the reverse Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-root"><span class="secno">12.8.21 </span><span class="content">Streamability of the root Function</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#streamability-fn-trunk"><span class="secno">12.8.22 </span><span class="content">Streamability of the trunk Function</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#classifying-patterns"><span class="secno">12.9 </span><span class="content">Classifying Patterns</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#streamability-analysis-examples"><span class="secno">12.10 </span><span class="content">Examples of Streamability Analysis</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#streamability-with-1.0"><span class="secno">12.11 </span><span class="content">Streamability and 1.0 Compatibility Mode</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#conformance"><span class="secno">13 </span><span class="content">Conformance</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#references"><span class="secno">A </span><span class="content">References</span></a><span class="exptoc collapsed"></span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#normative-references"><span class="secno">A.1 </span><span class="content">Normative References</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#other-references"><span class="secno">A.2 </span><span class="content">Other References</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#error-summary"><span class="secno">B </span><span class="content">Summary of Error Conditions</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#revision-log"><span class="secno">C </span><span class="content">Change Log</span></a></summary>
               </details>
            </li>
         </ol>
      </nav>
      <hr>
      <div class="body">
         <div class="div1">
            
            <h2><a id="intro"></a>1 <a href="#intro" style="text-decoration: none">Introduction</a></h2>
            <div class="changes">
               <p class="changesHeading">
        Changes in 4.0
        (<a href="#determining-static-type">next</a>)</p>
               <ol>
                  <li>
                     <p>Use the arrows to browse significant changes since the 3.1 version of this specification.</p>
                  </li>
                  <li>
                     <p>Sections with significant changes are marked Δ in the table of contents.</p>
                  </li>
               </ol>
            </div>
            <p>This document defines the streaming feature of the XSLT 4.0 language: see
<a href="#xslt-40">[XSLT 4.0]</a>.</p>
            <p>Streaming is an optional feature of the XSLT language that enables documents
  to be transformed that are too large to be held in memory. Stylesheets that aim
  to achieve streamed processing must adhere to contraints (called streamability rules)
  that are defined in this specification.</p>
            <div class="div2">
               
               <h3><a id="terminology"></a>1.1 <a href="#terminology" style="text-decoration: none">Terminology</a></h3>
               <p>In this specification the phrases <span class="verb">must</span>, <span class="verb">must
                  not</span>, <span class="verb">should</span>, <span class="verb">should not</span>,
                  <span class="verb">may</span>, <span class="verb">required</span>, and
                  <span class="verb">recommended</span>, when used in normative
                  text and rendered in small capitals, are to be interpreted as described in
                  <a href="#rfc2119">[RFC2119]</a>.</p>
               <p>Where the phrase <span class="verb">must</span>, <span class="verb">must not</span>, or
                  <span class="verb">required</span> relates to the behavior of the XSLT processor, then an
               implementation is not conformant unless it behaves as specified, subject to the more
               detailed rules in <a href="#conformance"><b>13 Conformance</b></a>. </p>
               <p>Where the phrase <span class="verb">must</span>, <span class="verb">must not</span>, or
                  <span class="verb">required</span> relates to a stylesheet then the processor
                  <span class="verb">must</span> enforce this constraint on stylesheets by raising an
               error if the constraint is not satisfied.</p>
               <p>Where the phrase <span class="verb">should</span>, <span class="verb">should not</span>, or
                  <span class="verb">recommended</span> relates to a stylesheet then a processor
                  <span class="verb">may</span> produce warning messages if the constraint is not
               satisfied, but <span class="verb">must not</span> treat this as an error.</p>
               <p>
               <a id="dt-implementation-defined" title="implementation-defined"><span class="definition">[Definition:&nbsp;</span></a>In this
                  specification, the term <b>implementation-defined</b> refers to a feature
                  where the implementation is allowed some flexibility, and where the choices made
                  by the implementation <span class="verb">must</span> be described in documentation that
                  accompanies any conformance claim.<span class="definition">]</span>
            </p>
               <p>
               <a id="dt-implementation-dependent" title="implementation-dependent"><span class="definition">[Definition:&nbsp;</span></a>The term
                     <b>implementation-dependent</b> refers to a feature where the behavior
                     <span class="verb">may</span> vary from one implementation to another, and where the
                  vendor is not expected to provide a full specification of the behavior.<span class="definition">]</span>
               (This might apply, for example, to limits on the size of source documents that can be
               transformed.)</p>
               <p>In all cases where this specification leaves the behavior implementation-defined or
               implementation-dependent, the implementation has the option of providing mechanisms
               that allow the user to influence the behavior.</p>
               <p>A paragraph labeled as a <b>Note</b> or described as an <b>example</b> is
               non-normative.</p>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="Concepts"></a>2 <a href="#Concepts" style="text-decoration: none">Concepts</a></h2>
            <div class="div2">
               
               <h3><a id="streaming-concepts"></a>2.1 <a href="#streaming-concepts" style="text-decoration: none">Streaming</a></h3>
               <p><a id="dt-streaming" title="streaming"><span class="definition">[Definition:&nbsp;</span></a>The term <b>streaming</b> refers to
                  a manner of processing in which XML documents (such as source and result documents)
                  are not represented by a complete tree of nodes occupying memory proportional to
                  document size, but instead are processed “on the fly” as a sequence of events,
                  similar in concept to the stream of events notified by an XML parser to represent
                  markup in lexical XML.<span class="definition">]</span></p>
               <p><a id="dt-streamed-document" title="streamed document"><span class="definition">[Definition:&nbsp;</span></a>A <b>streamed
                     document</b> is a <a href="https://qt4cg.org/specifications/xslt-40/#dt-source-tree">source tree</a><sup><small>XT</small></sup> that
                  is processed using streaming, that is, without constructing a complete tree of
                  nodes in memory.<span class="definition">]</span></p>
               <p><a id="dt-streamed-node" title="streamed node"><span class="definition">[Definition:&nbsp;</span></a>A <b>streamed
                     node</b> is a node in a <a title="streamed document" class="termref" href="#dt-streamed-document">streamed
                     document</a>.<span class="definition">]</span></p>
               <p>Many processors implementing earlier versions of this specification adopted an
               architecture that allowed streaming of the <a href="https://qt4cg.org/specifications/xslt-40/#dt-result-tree">result
                  tree</a><sup><small>XT</small></sup> directly to a serializer, without first materializing the complete
               result tree in memory. Streaming of the <a href="https://qt4cg.org/specifications/xslt-40/#dt-source-tree">source
                  tree</a><sup><small>XT</small></sup>, however, has proved to be more difficult without subsetting the
               language. This has created a situation where documents exceeding the capacity of
               virtual memory could not be transformed. XSLT 3.0 therefore introduced facilities
               allowing stylesheets to be written in a way that makes streaming of source documents
               possible, without excessive reliance on processor-specific optimization
               techniques.</p>
               <p>Streaming achieves two important objectives: it allows large documents to be
               transformed without requiring correspondingly large amounts of memory; and it allows
               the processor to start producing output before it has finished receiving its input,
               thus reducing latency.</p>
               <p>This specification does not attempt to legislate precisely which implementation
               techniques fall under the definition of streaming, and which do not. A number of
               techniques are available that reduce memory requirements, while still requiring a
               degree of buffering, or allocation of memory to partial results. A stylesheet that
               requests streaming of a source document is indicating that the processor should avoid
               assuming that the entire source document will fit in memory; in return, the
               stylesheet must be written in a way that makes streaming possible. This specification
               does not attempt to describe the algorithms that the processor should actually use,
               or to impose quantitative constraints on the resources that these algorithms should
               consume.</p>
               <p>Nothing in the XSLT specification prevents a processor using streaming whenever it sees an
               opportunity to do so. However, experience has shown that in order to achieve
               streaming, it is often necessary to write stylesheet code in such a way as to make
               this possible. Therefore, XSLT provides explicit constructs allowing the
               stylesheet author to request streaming, and defines explicit static constraints on
               the structure of the code which are designed to make streaming possible.</p>
               <p>A processor that claims conformance with the streaming option offers a guarantee that
               when streaming is requested for a source document, and when the stylesheet conforms
               to the rules that make the processing <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, then
               an algorithm will be adopted in which memory consumption is either completely
               independent of document size, or increases only very slowly as document size
               increases, allowing documents to be processed that are orders-of-magnitude larger
               than the physical memory available. A processor that does not claim conformance with
               the streaming option must still process a stylesheet and deliver the correct results,
               but is not required to use streaming algorithms, and may therefore fail with
               out-of-memory errors when presented with large source documents.</p>
               <p>Apart from the fact that there are constructs to request streaming, and rules that
               must be followed to guarantee that streaming is possible, the language has been
               designed so there are as few differences as possible between streaming and
               non-streaming evaluation. The semantics of the language continue to be expressed in
               terms of the XDM data model, which is substantively unchanged; but readers must take
               care to observe that when terms like “node” and “axis” are used, the concepts are
               completely abstract and may have no direct representation in the run-time execution
               environment.</p>
               <p>Streamed processing of a document can be initiated in one of three ways:</p>
               <ul>
                  <li>
                     <p>The <a href="https://qt4cg.org/specifications/xslt-40/#dt-initial-mode">initial mode</a><sup><small>XT</small></sup> can be declared as a
                        <a href="https://qt4cg.org/specifications/xslt-40/#dt-streamable-mode">streamable mode</a><sup><small>XT</small></sup>. In this case
                     the <a href="https://qt4cg.org/specifications/xslt-40/#dt-initial-match-selection">initial match selection</a><sup><small>XT</small></sup> will generally be a document node (or
                        sequence of document nodes), supplied by the calling application in
                     a form that allows streaming (that is, in some form other than a tree in
                     memory; for example, as a reference to a push or pull XML parser primed to
                     deliver a stream of events). The type of
                        these nodes can be constrained by using the attribute
                           <code>on-no-match="fail"</code> on the <a href="https://qt4cg.org/specifications/xslt-40/#dt-initial-mode">initial mode</a><sup><small>XT</small></sup>,
                        and using this mode only for processing the top-level nodes.
                     </p>
                  </li>
                  <li>
                     <p>Streamed processing of any document can be initiated using the
                        <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction. This has an attribute  
                        <code>href</code> whose value is the URI of a document to be processed,
                     and an attribute <code>streamable</code> that
                     indicates whether it is to be processed using
                     streaming; the actual processing to be applied is defined by the
                     instructions written as children of the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a>
                     instruction. </p>
                  </li>
                  <li>
                     <p>Streamed merging of a set of input documents can be initiated using the
                        <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> instruction.</p>
                  </li>
               </ul>
               <p>The rules for streamability, which are defined in detail in <a href="#streamability"><b>3 Streamability Analysis Principles</b></a>, impose two main constraints:</p>
               <ul>
                  <li>
                     <p>The only nodes reachable from the node that is currently being processed are
                     its attributes and namespaces, its ancestors and their attributes and
                     namespaces, and its descendants and their attributes and namespaces. The
                     siblings of the node, and the siblings of its ancestors, are not reachable in
                     the tree, and any attempt to use their values is a 
                    <a href="https://qt4cg.org/specifications/xslt-40/#dt-static-error">static error</a><sup><small>XT</small></sup>. </p>
                  </li>
                  <li>
                     <p>When processing a given node in the tree, each descendant node can only be
                     visited once. Essentially this allows two styles of processing: either visit
                     each of the children once, and then process that child with the same
                     restrictions applied; or process all the descendants in a single pass, in which
                     case it is not possible while processing a descendant to make any further
                     downward selection.</p>
                  </li>
               </ul>
               <p>The second restriction, that only one visit to the children is
               allowed, means that XSLT code that was not designed with streaming in mind will often
               need to be rewritten to make it streamable. In many cases it is possible to do this
               using a technique sometimes called <em>windowing</em> or <em>burst-mode
                  streaming</em> (note this is not quite the same meaning as
                  <em>windowing</em> in XQuery 3.0). Many XML documents consist of a large
               number of elements, each of manageable size, representing transactions or business
               objects where each such element can be processed independently: in such cases, an
               effective design pattern is to write a streaming transformation that takes a snapshot
               of each element in turn, processing the snapshot using the full power of the XSLT
               language. Each snapshot is a tree built in memory and is therefore fully navigable.
               For details see the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-snapshot"><code>snapshot</code></a> and <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a>
               functions.</p>
               <p>The new facility of <em>accumulators</em> allows applications
               complete control over how much information is retained (and by implication, how much
               memory is required) in the course of a pass over a <a title="streamed document" class="termref" href="#dt-streamed-document">streamed document</a>. An accumulator computes a value for every node in a
               streamed document: or more accurately, two values, one for the first visit to a node
               (before visiting its descendants), and a second value for the second visit to the
               node (after visiting the descendants). The computation is structured in such a way
               that the value for a given node can depend only on the value for the previous node in
               document order together with the data available when positioned at the current node
               (for example, the attribute values). Based on the well-established fold operation of
               functional programming languages, accumulators provide the convenience and economy of
               mutable variables while remaining within the constraints of a purely declarative
               processing model.</p>
               <p>When streaming is initiated, for example using the
                  <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction, it is necessary to declare which
               accumulators are applicable to the streamed document.</p>
               <p>Streaming applications often fall into one of the following categories:</p>
               <ul>
                  <li>
                     <p>Aggregation applications, where a single aggregation operation (perhaps
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-count"><code>count</code></a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-sum"><code>sum</code></a>,
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-exists"><code>exists</code></a>, or <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-distinct-values"><code>distinct-values</code></a>) is
                     applied to a set of elements selected from the streamed source document by
                     means of a path expression.</p>
                  </li>
                  <li>
                     <p>Record-at-a-time applications, where the source document consists of a long
                     sequence of elements with similar structure (“records”), and each “record” is
                     processed using the same logic, independently of any other “records”. This kind
                     of processing is facilitated using the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-snapshot"><code>snapshot</code></a> and
                        <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a> function mentioned earlier.</p>
                  </li>
                  <li>
                     <p>Grouping applications, where the output follows the structure of the input,
                     except that an extra layer of hierarchy is added. For example, the input might
                     be a flat series of banking transactions in date/time order, and the output
                     might contain the same transactions grouped by date.</p>
                  </li>
                  <li>
                     <p>Accumulator applications, which are the same as record-at-a-time applications,
                     except that the processing of one “record” might depend on data encountered
                     earlier in the document. A classic example is processing a sequence of banking
                     transactions in which the input transaction contains a debit or credit amount,
                     and the output adds a running total (the account balance). The
                        <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> instruction has been introduced to facilitate
                     this style of processing.</p>
                  </li>
                  <li>
                     <p>Isomorphic transformations, in which there is an ordered (often largely
                     one-to-one) relationship between the nodes of the source tree and the nodes of
                     the result tree: for example, transformations that involve only the renaming or
                     selective deletion of nodes, or scalar manipulations of the values held in the
                     leaf nodes. Such transformations are most conveniently expressed using
                     recursive application of template rules. This is possible with a streamed input
                     document only if all the template rules adhere to the constraints required for
                     streamability. To enforce these rules, while still allowing unrestricted
                     processing of other documents within the same transformation, all streaming
                     evaluation must be carried out using a specific 
                    <a href="https://qt4cg.org/specifications/xslt-40/#dt-mode">mode</a><sup><small>XT</small></sup>, which is declared 
                    to be a streaming mode by means of an
                        <a href="../../xslt-40/Overview.html#xsl:mode">xsl:mode</a> declaration in the stylesheet.</p>
                  </li>
               </ul>
               <p>There are important classes of application in which streaming is possible only if
               multiple streams can be processed in parallel. This specification therefore provides
               facilities:</p>
               <ol class="enumar">
                  <li>
                     <p>allowing multiple sorted input sequences to be merged into one sorted output
                     sequence (the <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> instruction)</p>
                  </li>
                  <li>
                     <p>allowing multiple output sequences to be generated during a single pass of an
                     input sequence (the <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a> instruction).</p>
                  </li>
               </ol>
               <p>These facilities have been designed in such a way that they can readily be
               implemented using streaming, that is, without materializing the input or output
               sequences in memory.</p>
            </div>
            <div class="div2">
               
               <h3><a id="streamed-validation"></a>2.2 <a href="#streamed-validation" style="text-decoration: none">Streamed Validation</a></h3>
               <p>Streaming can be combined with schema-aware processing: that is, the streamed input to a transformation 
               can be subjected to on-the-fly validation, a process which typically accepts an input stream from the 
               XML parser and delivers an output stream (of type-annotated nodes) to the transformation processor. 
               The XSD specification is designed so that validation is, with one or two exceptions, a streamable process. 
               The exceptions include:
            </p>
               <ul>
                  <li>
                     <p>There may be a need to allocate memory to hold keys, in order to enforce uniqueness and 
                  referential integrity constraints (<code>xs:unique</code>, <code>xs:key</code>, <code>xs:keyref</code>).
               </p>
                  </li>
                  <li>
                     <p>In XSD 1.1, assertions can be defined by means of XPath expressions. These are not constrained 
                  to be streamable; in the general case, any subtree of the document that is validated using an assertion 
                  may need to be buffered in memory while the assertion is processed.
               </p>
                  </li>
               </ul>
               <p>Applications that need to run in finite memory may therefore need to avoid these XSD features, 
               or to use them with care.
            </p>
               <p>XSD is designed so that the intended type of an element (the “governing type”) can be determined as soon 
               as the start tag of the element is encountered: the process of validation checks whether the content of 
               the element actually conforms to this type, and by the time the end tag is encountered, the process will 
               have established either that the element is valid against the governing type, or that it is invalid. 
            </p>
               <p>By default, dynamic errors occurring during streamed processing are fatal: they typically cause the 
               transformation to fail immediately. XSLT 3.0 introduced the ability to catch dynamic errors and recover 
               from them. Schema invalidity, however, is treated as a dynamic error of the instruction that 
               processes the entire input stream, so after a validation failure, no further processing of that input stream 
               is possible.
            </p>
               <p>In consequence, a streamed validator that is running in tandem with a streamed transformation 
               can present the transformer with element nodes that carry a provisional type annotation representing 
               the type that the element will have if it turns out to be valid. As soon as a node is encountered that 
               violates this assumption, the validator should stop the flow of data to the transformer, so that the 
               transformer never sees invalid data. This allows the stylesheet code to be compiled with the assumption 
               of type-safety: at run-time, all nodes seen by the transformation will conform to their XSLT-declared types
               (for example, a type declared implicitly using <code>match="schema-element(invoice)"</code> on an 
               <a href="../../xslt-40/Overview.html#xsl:template">xsl:template</a> element).
            </p>
               <p>A streamed transformation that only accesses part of the input document (for example, a header
               at the start of a document) is not required to continue reading once the data it needs 
               has been read. This means that XML well-formedness or validity errors occurring in the unread part 
               of the input stream may go undetected.
            </p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>The analysis of guaranteed streamability (see <a href="#streamability"><b>3 Streamability Analysis Principles</b></a>)
             takes no account of information that might be obtained from a schema-aware
             static analysis of the stylesheet. Implementations may, however, be able to use
             streaming strategies for stylesheets that are not guaranteed-streamable, by
             taking advantage of such information. For example, an implementation might be
             able to treat the expression <code>.//title</code> as <a title="striding" class="termref" href="#dt-striding">striding</a> rather than <a title="crawling" class="termref" href="#dt-crawling">crawling</a> if it can
             establish from knowledge of the schema that two <code>title</code> elements
             will never be nested one inside the other.</p>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="initiating-streaming"></a>2.3 <a href="#initiating-streaming" style="text-decoration: none">Initiating a Streamed Transformation</a></h3>
               <p>With a streamable processor, the <a href="https://qt4cg.org/specifications/xslt-40/#dt-initial-match-selection">initial match selection</a><sup><small>XT</small></sup>&gt; can consist
                  of streamed nodes, but the <a href="https://qt4cg.org/specifications/xslt-40/#dt-global-context-item">global context item</a><sup><small>XT</small></sup> is always <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                  because it is available to all global variables and there is no control over the sequence of processing.</p>
               <p>If the initial mode is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>,
                     then a streaming processor <span class="verb">should</span> allow some or all of the items
                     in the <a href="https://qt4cg.org/specifications/xslt-40/#dt-initial-match-selection">initial match selection</a><sup><small>XT</small></sup> to be nodes supplied in streamable form,
                     and any nodes that are supplied in this form <span class="verb">must</span> then be processed using streaming.</p>
               <p>Since the <a href="https://qt4cg.org/specifications/xslt-40/#dt-global-context-item">global context item</a><sup><small>XT</small></sup> cannot be a streamed node,
                  in cases where the transformation is to proceed by applying streamable templates
                  to a streamed input document, the <a href="https://qt4cg.org/specifications/xslt-40/#dt-global-context-item">global context item</a><sup><small>XT</small></sup> must
                  either be absent, or must be something that differs from the 
                    <a href="https://qt4cg.org/specifications/xslt-40/#dt-initial-match-selection">initial match selection</a><sup><small>XT</small></sup>.</p>
            </div>
            <div class="div2">
               
               <h3><a id="streaming-non-xml"></a>2.4 <a href="#streaming-non-xml" style="text-decoration: none">Streaming of non-XML data</a></h3>
               <p>The facilities in this specification designed to enable large data sets to be processed in a streaming
            manner are oriented almost entirely to XML data. This does not mean that there is never a requirement
            to stream non-XML data, or that the Working Group has ignored this requirement; rather, the Working Group
            has concluded that for the most part, streaming of non-XML data can be achieved by implementations without
            the need for specific language features in XSLT.</p>
               <p>To make streamed processing of unparsed text files easier, the function <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-unparsed-text-lines"><code>unparsed-text-lines</code></a>
            has been introduced. This is not only more convenient for stylesheet authors than reading the entire input
            using the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-unparsed-text"><code>unparsed-text</code></a> function and then tokenizing the result, it is also easier for implementations
            to optimize, allowing each line of text to be discarded from memory after it has been processed.</p>
               <p>For all functions that access external data, including <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-document"><code>document</code></a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-doc"><code>doc</code></a>,
            <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-collection"><code>collection</code></a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-unparsed-text"><code>unparsed-text</code></a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-unparsed-text-lines"><code>unparsed-text-lines</code></a>,
            and <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-json-doc"><code>json-doc</code></a>, the requirements on determinism can now
            be relaxed using <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a> configuration options. This is significant
            because it means that when a transformation reads the same external resource more than once, it becomes
            legitimate for the contents of the resource to be different on different invocations, and this eliminates
            the need for the processor to cache the contents of the resource in memory.</p>
               <p>In the XDM data model, every value is a sequence, and (as with most functional programming languages),
            processing of sequences of items is pervasive throughout the XSLT and XPath languages and their function
            library. Good performance of a functional programming language often depends on sequence-based operations
            being pipelined, and being evaluated in a lazy fashion (that is, many operations process items in a sequence
            one at a time, in order; and many operations can deliver a result without processing the entire sequence).
            The semantics of XSLT and XPath permit pipelined and lazy evaluation (for example, the error handling semantics
            are carefully written to ensure this), but they do not require it: the details are left to implementations.
            Pipelined processing of a sequence is not the same thing as streamed processing of a tree, and where the XSLT
            specification talks of operations being “guaranteed streamable”, this is always referring to processing of
            trees, not of sequences.</p>
               <p>The facilities for streaming of XML trees include operations such as <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a>
            and <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-snapshot"><code>snapshot</code></a> which are able to take a sequence of streamed nodes as input, 
               and produce a sequence of in-memory (unstreamed) nodes as output. It is also possible to generate
               a sequence of strings or other atomic items through the process of <a href="https://qt4cg.org/specifications/xslt-40/#dt-atomization">atomization</a><sup><small>XT</small></sup>.
               The actual memory usage of a streamed
            XSLT application may depend significantly on whether the processing of the resulting sequence of in-memory
            nodes or atomic items is pipelined or not. The specification, however, has nothing to say on this matter: 
            it is considered an area where implementers can exercise their discretion and ingenuity.</p>
               <p>Streaming of JSON input receives little attention in this specification. One can envisage an implementation
            of the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-json-to-xml"><code>json-to-xml</code></a> function in which the XML delivered by the function consists of
            streamed nodes; but the Working Group has not researched the feasibility of such an implementation in any detail.</p>
            </div>
            <div class="div2">
               
               <h3><a id="model-for-streaming"></a>2.5 <a href="#model-for-streaming" style="text-decoration: none">Data Model for Streaming</a></h3>
               <div class="div3">
                  
                  <h4><a id="streamed-documents"></a>2.5.1 <a href="#streamed-documents" style="text-decoration: none">Streamed Documents</a></h4>
                  <p>The data model for nodes in a document that is being streamed is no different from
               the standard XDM data model, in that it contains the same objects (nodes) with the
               same properties and relationships. The facilities for streaming do not change the
               data model; instead they impose rules that limit the ability of stylesheets to
               navigate the data model.</p>
                  <p>A useful way to visualize streaming is to suppose that at any point in time, there is
               a current position in the streamed input document which may be the start or end of
               the document, the start or end tag of an element, or a text, comment, or processing
               instruction node. From this position, the stylesheet has access to the following
               information: </p>
                  <ul>
                     <li>
                        <p>Properties intrinsic to the node, such as its name, its base URI, its type
                     annotation, and its <code>is-id</code> and <code>is-idref</code>
                     properties.</p>
                     </li>
                     <li>
                        <p>The ancestors of the node (but navigation downwards from the ancestors is not
                     permitted).</p>
                     </li>
                     <li>
                        <p>The attributes of the node, and the attributes of its ancestors. For each such
                     attribute, all the properties of the node including its string value and typed
                     value are available, but there are limitations that restrict navigation from
                     the attribute node to other nodes in the document.</p>
                     </li>
                     <li>
                        <p>The in-scope namespace bindings of the node.</p>
                     </li>
                     <li>
                        <p>In the case of attributes, text nodes, comments, and processing instructions,
                     the string value and typed value of the node.</p>
                     </li>
                     <li>
                        <p>In the case of element nodes, whether or not the element has children. This
                     information is obtained by calling the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-has-children"><code>has-children</code></a>
                     function. This implies that the processor performs look-ahead (limited to a
                     single token) to determine whether the start tag is immediately followed by a
                     matching end tag.</p>
                     </li>
                     <li>
                        <p>In the case of document nodes, details of unparsed entities in the document.
                     This information is obtained by calling the
                        <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-unparsed-entity-uri"><code>unparsed-entity-uri</code></a> and
                        <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-unparsed-entity-public-id"><code>unparsed-entity-public-id</code></a> functions. A processor might
                     enable this by reading the DTD as soon as the document is opened. Since
                     comments and processing instructions that precede the DOCTYPE declaration are
                     available as children of the document node, this also implies that a streaming
                     processor needs sufficient memory to hold these comments and processing
                     instructions until the start tag of the first element is encountered.
                     Information about unparsed entities remains available for the duration of
                     processing, in the same way as attributes of ancestor elements.</p>
                     </li>
                  </ul>
                  <p>The children and other descendants of a node are not accessible except as a
               by-product of changing the current position in the document. The same applies to
               properties of an element or document node that require examination of the
               node’s descendants, that is, the string value and typed value. This is
               enforced by means of a rule that only one expression requiring downward navigation
               from a node is permitted.</p>
                  <p>Information about the type of a node is in general
               considered a property intrinsic to the node, and is available without advancing the
               input stream. There is an exception for an expression of the form <code>(/) instance
                  of document-node(element(invoice))</code>. This is not guaranteed streamable,
               because it requires reading ahead to check that the document node has only one
               element child. However, a processor that knows that the parser delivering the
               document stream is only capable of delivering well-formed documents may use this
               knowledge (along with the limited look-ahead needed to get the name of the outermost
               element) to make this expression streamable.</p>
                  <p>A streaming processor is not
                  required to read any more of the source document than is needed to
               generate correct stylesheet output. It is not required to read the full source
               document merely in order to satisfy the requirement imposed by the XML Recommendation
               that an XML Processor must report violations of well-formedness in the input.</p>
                  <p>More detailed rules are defined in <a href="#streamability"><b>3 Streamability Analysis Principles</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streaming-other-types"></a>2.5.2 <a href="#streaming-other-types" style="text-decoration: none">Maps and Arrays</a></h4>
                  <p>Maps and arrays were first introduced in XPath 3.1.</p>
                  <p>Streaming facilities in this specification are, for the most part, relevant 
                  only to streamed processing of XML trees, and not to other structures such as 
                  sequences, maps and arrays, which will typically be held in memory unless 
                  the processor is capable of avoiding this.
               </p>
                  <p>Maps, however, play an important role in enabling streamed applications
               to be written. For example, a map can be used as the data structure maintained
               by an accumulator (see <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#accumulators">19 Accumulators</a>) to remember information
               that has been retrieved from a streamed document, given that it is not possible to
               revisit the same nodes later. There is also a special streamability rule for
               map constructor expressions (see <a href="#maps-streaming"><b>12.1 Maps and Streaming</b></a>) that allows
               such an expression to make multiple downward selections in the streamed input
               document: for example one can write <code>{ 'authors': data(author), 'editors': data(editor) }</code>,
               which gathers the values of these two elements, or sets of elements, from the input
               stream, regardless what order they appear in — even if they are interleaved.</p>
                  <p>The rules for creating maps and arrays are designed to ensure that the 
                  entries in a map, and the members of an array, cannot contain nodes from 
                  a streamed document. This is achieved by the way in which the streamability 
                  properties of the relevant expressions and functions are defined.
               </p>
                  <p>By contrast, sequences can and often do contain nodes from streamed documents, 
                  and a major purpose of the rules for streamability is to make this possible.
               </p>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="streamability"></a>3 <a href="#streamability" style="text-decoration: none">Streamability Analysis Principles</a></h2>
            <p>This section describes the principles used to determine
            properties of <a title="construct" class="termref" href="#dt-construct">constructs</a> in the 
           <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet">stylesheet</a><sup><small>XT</small></sup> that are used
           in the analysis of streamability. Specifically, it introduces
           the concepts of the <a title="posture" class="termref" href="#dt-posture">posture</a> and
               <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a construct, which enable the streamability of
            the stylesheet to be assessed.</p>
            <p>These properties are used, for example, to determine the streamability
            of:</p>
            <ul>
               <li>
                  <p><a href="https://qt4cg.org/specifications/xslt-40/#dt-template-rule">Template rules</a><sup><small>XT</small></sup>: see <a href="#streamable-templates"><b>5 Streamable Templates</b></a></p>
               </li>
               <li>
                  <p>The <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction: see <a href="#streaming-source-documents"><b>4 Streaming Source Documents</b></a></p>
               </li>
               <li>
                  <p><a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">Attribute sets</a><sup><small>XT</small></sup>: see <a href="#streamability-of-attribute-sets"><b>9 Streamable Attribute Sets</b></a></p>
               </li>
               <li>
                  <p><a href="https://qt4cg.org/specifications/xslt-40/#dt-accumulator">Accumulators</a><sup><small>XT</small></sup>: see <a href="#streamability-of-accumulators"><b>11 Streamable Accumulators</b></a></p>
               </li>
               <li>
                  <p><a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">Stylesheet functions</a><sup><small>XT</small></sup>: see <a href="#streamable-stylesheet-functions"><b>8.1 Classifying Stylesheet Functions</b></a></p>
               </li>
               <li>
                  <p>The <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> instruction: see <a href="#streamable-merging"><b>10 Streamable Merging</b></a></p>
               </li>
            </ul>
            <p>In each case, the conditions for constructs to be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> are defined in terms of these properties. The result
            of this analysis in turn (see <a href="#streamability-guarantees"><b>3.1 Streamability Guarantees</b></a>) imposes rules
            on how the constructs are handled by processors that implement the <a title="streaming feature" class="termref" href="#dt-streaming-feature">streaming feature</a>. The analysis has no effect on the behavior of
            processors that do not implement this feature.</p>
            <p>The analysis is relevant to constructs such as streamable template rules and the
               <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction that process a single streamed input
            document. The <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> instruction, which processes multiple streamed
            inputs, has its own rules.</p>
            <p>The rules in this section operate on the expression tree (more properly, construct tree)
            that is typically output by the XSLT and XPath parser. For the most part, the rules
            depend only on identifying the syntactic constructs that are present.</p>
            <p>The rules in this section generally consider each <a href="https://qt4cg.org/specifications/xslt-40/#dt-component">component</a><sup><small>XT</small></sup> in the stylesheet (and in the case of 
           <a href="https://qt4cg.org/specifications/xslt-40/#dt-template-rule">template rules</a><sup><small>XT</small></sup>, each template rule) in isolation.
            The exception is that where a component contains references to other components (such as
            global variables, functions, or named templates), then information from the signature of
            the referenced component is sometimes used. This is invariably information that cannot
            be changed if a component is overridden in a different 
           <a href="https://qt4cg.org/specifications/xslt-40/#dt-package">package</a><sup><small>XT</small></sup>. 
           The analysis thus requires as a pre-condition that function calls
            and calls on named templates have been resolved to the extent that the corresponding
            function/template signature is known. </p>
            <p>The detailed way in which the construct tree is derived from the lexical form of the
            stylesheet is not described in this specification. There are many ways in which the tree
            can be optimized without affecting the result of the rules in this section: for example,
            a sequence constructor containing a single instruction can be replaced by that
            instruction, and a parenthesized expression can be replaced by its content.</p>
            <p><a id="dt-construct" title="construct"><span class="definition">[Definition:&nbsp;</span></a>The term <b>construct</b> refers to
               the union of the following: a <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, 
           an <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instruction</a><sup><small>XT</small></sup>, an 
           <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">attribute set</a><sup><small>XT</small></sup>, a 
             <a href="https://qt4cg.org/specifications/xslt-40/#dt-value-template">value
                  template</a><sup><small>XT</small></sup>, an <a href="https://qt4cg.org/specifications/xslt-40/#dt-expression">expression</a><sup><small>XT</small></sup>, or a
                  <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup>.<span class="definition">]</span></p>
            <p>These <a title="construct" class="termref" href="#dt-construct">constructs</a> are classified into
               <b>construct kinds</b>: in particular, 
            <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instructions</a><sup><small>XT</small></sup> are 
            classified according to the name of the XSLT instruction,
            and <a href="https://qt4cg.org/specifications/xslt-40/#dt-expression">expressions</a><sup><small>XT</small></sup> are classified according to the
            most specific production in the XPath grammar that the expression satisfies. (This
            means, for example, that <code>2+2</code> is classified as an <code>AdditiveExpr</code>,
            rather than say as a <code>UnionExpr</code>; although it also satisfies the production
            rule for <code>UnionExpr</code>, <code>AdditiveExpr</code> is more specific.)</p>
            <div class="div2">
               
               <h3><a id="streamability-guarantees"></a>3.1 <a href="#streamability-guarantees" style="text-decoration: none">Streamability Guarantees</a></h3>
               <p>Certain constructs allow a stylesheet author to declare that a construct is
               streamable. Specifically:</p>
               <ul>
                  <li>
                     <p>Specifying <code>streamable="yes"</code> on <a href="../../xslt-40/Overview.html#xsl:mode">xsl:mode</a> declares
                     that all template rules in that mode (and all
                        template rules that specify <code>mode="#all"</code>) are
                     streamable;</p>
                  </li>
                  <li>
                     <p>Specifying <code>streamable="yes"</code> on 
                     <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> declares that its
                     contained sequence constructor is streamable;</p>
                  </li>
                  <li>
                     <p>Specifying <code>streamable="yes"</code> on <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a>
                     declares that the <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet function</a><sup><small>XT</small></sup> in question is
                     streamable;</p>
                  </li>
                  <li>
                     <p>Specifying <code>streamable="yes"</code> on <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a>
                     declares that the attribute set in question is streamable;</p>
                  </li>
                  <li>
                     <p>Specifying <code>streamable="yes"</code> 
                     (explicitly or implicitly) on <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> declares
                     that the merging process is streamable with respect to that particular input.</p>
                  </li>
                  <li>
                     <p>Specifying <code>streamable="yes"</code> on <a href="../../xslt-40/Overview.html#xsl:accumulator">xsl:accumulator</a>
                     declares that the accumulator can be evaluated on a streamed document.</p>
                  </li>
               </ul>
               <p><a id="dt-declared-streamable" title="declared-streamable"><span class="definition">[Definition:&nbsp;</span></a>The above constructs (template rules belonging to a
                  mode declared with <code>streamable="yes"</code>; and <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a>,
                     <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a>, <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a>,
               <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a>, and <a href="../../xslt-40/Overview.html#xsl:accumulator">xsl:accumulator</a>  elements specifying
                     <code>streamable="yes"</code>) are said to be
                  <b>declared-streamable</b>.<span class="definition">]</span></p>
               <p>In each case the construct in question is said to be
                  <b>guaranteed-streamable</b> if it satisfies two conditions:</p>
               <ol class="enumar">
                  <li>
                     <p>The construct is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>.</p>
                  </li>
                  <li>
                     <p>Streamability analysis following the rules defined in this specification
                     determines that streamed processing is possible (the detailed conditions vary
                     from one construct to another).</p>
                  </li>
               </ol>
               <p><a id="dt-guaranteed-streamable" title="guaranteed-streamable"><span class="definition">[Definition:&nbsp;</span></a>A
                     <b>guaranteed-streamable</b> construct is a <a title="construct" class="termref" href="#dt-construct">construct</a> that is declared to be streamable and that follows the
                  particular rules for that construct to make streaming possible, as defined by the
                  analysis in this specification.<span class="definition">]</span></p>
               <p>For a streaming processor, that is, a processor that claims conformance with the
                  <a title="streaming feature" class="termref" href="#dt-streaming-feature">streaming feature</a>:</p>
               <ol class="enumar">
                  <li>
                     <p>If a construct is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> and
                  the input is provided in streamable form, then the input <span class="verb">must</span> be processed using streaming.</p>
                     <div class="note">
                        <p class="prefix"><b>Note:</b></p>
                        <p>The requirement to process the input using streaming
                  does not apply if the processor is able to determine that this would convey no benefit:
                  for example, if the input is supplied as a tree in memory. However, this does not remove
                  the requirement to verify that the relevant stylesheet constructs are <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                     </div>
                  </li>
                  <li>
                     <p>If a construct is declared as streamable but is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> (that is, if it fails to satisfy the
                     conditions for streamability defined in this specification), then the processor
                        <span class="verb">must</span> be prepared to do any one of the following at user
                     option:</p>
                     <ol class="enumla">
                        <li>
                           <p>Raise a static error <span class="error">[see <a href="#err-XTSE3430">ERR XTSE3430</a>]</span></p>
                        </li>
                        <li>
                           <p>Process the stylesheet as if it were a non-streaming processor (see
                           below)</p>
                        </li>
                        <li>
                           <p>Process the stylesheet with streaming if it is able to do so, or raise a
                           static error <span class="error">[see <a href="#err-XTSE3430">ERR XTSE3430</a>]</span> if it is not
                           able to do so.</p>
                        </li>
                     </ol>
                  </li>
               </ol>
               <p><a id="err-XTSE3430"><span class="error">[ERR XTSE3430] </span></a>It is a <a href="https://qt4cg.org/specifications/xslt-40/#dt-static-error">static error</a><sup><small>XT</small></sup> if a <a href="https://qt4cg.org/specifications/xslt-40/#dt-package">package</a><sup><small>XT</small></sup> contains a construct that is
                     declared to be streamable but which is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, unless the user has indicated that the
                     processor is to handle this situation by processing the stylesheet without
                     streaming or by making use of processor extensions to the streamability rules
                     where available.</p>
               <p>For a non-streaming processor, the processor <span class="verb">must</span> evaluate the construct
               delivering the same results as if execution used streaming, but with no constraints
               on the evaluation strategy. (Processing <span class="verb">may</span>, of
               course, fail due to insufficient memory being available, or for other reasons.)
                  A non-streaming processor is <span class="verb">not
                     required</span> to assess whether constructs are <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, or to apply restrictions such as the rules
                  for where calls on the functions <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-before"><code>accumulator-before</code></a> and
                     <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> may appear. However, a non-streaming
                  processor <span class="verb">must</span> enforce the constraint implied by a
                     <code>use-accumulators</code> attribute restricting which accumulators can be
                  used with a particular document.</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>This specification does not attempt to legislate precisely what constitutes
                  evaluation “using streaming”. The most important test is that the amount of memory
                  needed should be for practical purposes independent of the size of the source
                  document, and in particular that the finite size of memory available should not
                  impose a limit on the size of source document that can be processed.</p>
                  <p>The rules are designed to ensure that streaming processors can analyze
                  streamability using rules different from those in this specification, provided
                  that all constructs that are <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> according
                  to this specification are actually streamable by the implementation. Furthermore,
                  non-streaming processors are not required to analyze streamability at all.</p>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="operand-roles"></a>3.2 <a href="#operand-roles" style="text-decoration: none">Operand Roles</a></h3>
               <p><a id="dt-operand-role" title="operand role"><span class="definition">[Definition:&nbsp;</span></a>For every construct kind, there is a
               set of zero or more <b>operand roles</b>.<span class="definition">]</span> For example, an
               <code>AdditiveExpr</code> has two operand roles, referred to as the left-hand operand
            and the right-hand operand, while an <code>IfExpr</code> has three, referred to as the
            condition, the then-clause, and the else-clause. A function call with three arguments
            has three operand roles, called the first, second, and third arguments. The names of the
            operand roles for each construct kind are not formally listed, but should be clear from
            the context.</p>
               <p><a id="dt-operand" title="operand"><span class="definition">[Definition:&nbsp;</span></a>In an actual instance of a construct, there will
               be a number of <b>operands</b>. Each operand is itself a <a title="construct" class="termref" href="#dt-construct">construct</a>; the construct tree can be defined as the transitive relation
            between constructs and their operands.<span class="definition">]</span> Each operand is associated with exactly one of
            the operand roles for the construct type. There may be operand roles where the operand
            is optional (for example, the <code>separator</code> attribute of the
               <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instruction), and there may be operand roles that can
            be occupied by multiple operands (for example, the <code>xsl:when/@test</code> condition
            in <a href="../../xslt-40/Overview.html#xsl:choose">xsl:choose</a>, or the arguments of the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-concat"><code>concat</code></a>
            function).</p>
               <p>Operand roles have a number of properties used in the analysis:</p>
               <ul>
                  <li>
                     <p>The <a href="https://qt4cg.org/specifications/xslt-40/#dt-required-type">required type</a><sup><small>XT</small></sup> of the <a title="operand" class="termref" href="#dt-operand">operand</a>. This is
                  explicit in the case of function calls (the required type is defined in the
                  function signature of the corresponding function). In other cases it is implicit
                  in the detailed rules for the construct in question. In practice streamability
                  analysis makes only modest use of the required type; the main case where it is
                  relevant is for a function or template call, where knowing that the required type
                  is atomic enables the inference that the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> for a
                  supplied node is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                  </li>
                  <li>
                     <p><a id="dt-operand-usage" title="operand usage"><span class="definition">[Definition:&nbsp;</span></a>The <b>operand
                     usage</b>. This gives information, in the case where the operand value
                     contains nodes, about how those nodes are used. The operand usage takes one of
                     the values <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, <a title="inspection" class="termref" href="#dt-inspection">inspection</a>,
                        <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, or <a title="navigation" class="termref" href="#dt-navigation">navigation</a>.<span class="definition">]</span>
                  The meanings of these terms are explained in <a href="#operand-roles"><b>3.2 Operand Roles</b></a>. 
                 If the required type of the <a title="operand" class="termref" href="#dt-operand">operand</a>
                  does not permit nodes to be supplied (for example
                     because the required type is a function item or a map), then the
                  operand usage is <a title="inspection" class="termref" href="#dt-inspection">inspection</a>, because the only run-time
                  operation on a supplied node will be to inspect it, discover it is a node, and
                  raise a type error.</p>
                     <p>In the particular case where the required type is atomic, and any supplied nodes
                  are atomized, the operand usage will be <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, because
                     <a href="https://qt4cg.org/specifications/xslt-40/#dt-atomization">atomize</a><sup><small>XT</small></sup> is a special case of absorption.</p>
                  </li>
                  <li>
                     <p><a id="dt-higher-order-operand" title="higher-order operand"><span class="definition">[Definition:&nbsp;</span></a>Whether or not
                     the <a title="operand" class="termref" href="#dt-operand">operand</a> is <b>higher-order</b>. For this purpose
                     an operand <var>O</var> of a construct <var>C</var> is higher-order if the
                     semantics of <var>C</var> potentially require <var>O</var> to be evaluated more
                     than once during a single evaluation of <var>C</var>.<span class="definition">]</span> More
                  specifically, <var>O</var> is a <b>higher-order</b> operand of <var>C</var>
                  if any of the following conditions is true:</p>
                     <ul>
                        <li>
                           <p>The <a href="https://qt4cg.org/specifications/xslt-40/#dt-context-item">context item</a><sup><small>XT</small></sup> for evaluation of <var>O</var> is
                        different from the context item for evaluation of <var>C</var>.</p>
                        </li>
                        <li>
                           <p><var>C</var> is an <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instruction</a><sup><small>XT</small></sup> and <var>O</var> is a
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup> (as with the <code>from</code> and
                           <code>count</code> attributes of <a href="../../xslt-40/Overview.html#xsl:number">xsl:number</a>, and the
                           <code>group-starting-with</code> and <code>group-ending-with</code>
                        attributes of <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a>).</p>
                        </li>
                        <li>
                           <p><var>C</var> is an XPath <code>for</code>, <code>some</code>, or
                           <code>every</code> expression and <var>O</var> is the expression in its
                           <code>return</code> or <code>satisfies</code> clause.</p>
                        </li>
                        <li>
                           <p><var>C</var> is an inline function declaration and <var>O</var> is the
                        expression in its body.</p>
                        </li>
                     </ul>
                  </li>
               </ul>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>There is one known case where this definition makes
         an operand higher-order even though it is only evaluated once: specifically, the sequence
         constructor contained in the body of an <a href="../../xslt-40/Overview.html#xsl:copy">xsl:copy</a> instruction that has a 
            <code>select</code> attribute. See <a href="#streamability-xsl-copy"><b>12.5.12 Streamability of xsl:copy</b></a> for further details.</p>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="operand-usage"></a>3.3 <a href="#operand-usage" style="text-decoration: none">Operand Usage</a></h3>
               <p>An <a title="operand role" class="termref" href="#dt-operand-role">operand role</a> gives information about the <a title="operand" class="termref" href="#dt-operand">operands</a> of a particular kind of construct. The two
               important properties of an operand role are the required type and the operand
               usage.</p>
               <p>The <a title="operand usage" class="termref" href="#dt-operand-usage">usage</a> of an operand role is relevant
               only when the value of an <a title="operand" class="termref" href="#dt-operand">operand</a> supplied in that role is a
               node, or a sequence that contains nodes. It is one of the following:</p>
               <ul>
                  <li>
                     <p><a id="dt-absorption" title="absorption"><span class="definition">[Definition:&nbsp;</span></a>An operand usage of
                           <b>absorption</b> indicates that the construct reads the subtree(s)
                        rooted at a supplied node(s).<span class="definition">]</span> Examples are constructs that atomize
                     their <a title="operand" class="termref" href="#dt-operand">operands</a>, or that obtain the string
                     value of a supplied node, or that copy the supplied node to a new tree. Another
                     example is the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-deep-equal"><code>deep-equal</code></a> function, which compares the
                     subtrees rooted at the nodes supplied in its first two arguments.</p>
                  </li>
                  <li>
                     <p><a id="dt-inspection" title="inspection"><span class="definition">[Definition:&nbsp;</span></a>An operand usage of
                           <b>inspection</b> indicates that the construct accesses properties
                        of a supplied node that are available without reading its subtree.<span class="definition">]</span>
                     Examples are functions such as <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-name"><code>name</code></a> and
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-base-uri"><code>base-uri</code></a>, and the <code>instance of</code> expression
                     which tests the type of a node (or other item), or functions such as
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-count"><code>count</code></a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-exists"><code>exists</code></a>, and
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-boolean"><code>boolean</code></a> which are only interested in the existence of
                     the node, and not in its properties.</p>
                  </li>
                  <li>
                     <p><a id="dt-transmission" title="transmission"><span class="definition">[Definition:&nbsp;</span></a>An operand usage of
                           <b>transmission</b> indicates that the construct will (potentially)
                        return a supplied node as part of its result to the calling construct (that
                        is, to its parent in the construct tree).<span class="definition">]</span> It also indicates that
                     document order is preserved: if the input is in document order, then the result
                     must be in document order. An example is a filter expression, where nodes in
                     the base expression (the expression being filtered) will typically appear in
                     the result of the filter expression, in their original order.</p>
                  </li>
                  <li>
                     <p><a id="dt-navigation" title="navigation"><span class="definition">[Definition:&nbsp;</span></a>An operand usage of
                           <b>navigation</b> indicates that the construct may navigate freely
                        from the supplied node to other nodes in the same tree, in a way that is not
                        constrained by the streamability rules.<span class="definition">]</span> This covers several cases:
                     cases where it is known that the construct performs impermissible navigation
                     (for example, the <a href="../../xslt-40/Overview.html#xsl:number">xsl:number</a> instruction) or reordering (the
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-reverse"><code>reverse</code></a> function), or that require look-ahead (the
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-innermost"><code>innermost</code></a> function) and also cases where the analysis
                     is unable to determine what use is made of the node, for example because it is
                     passed as an argument to a user-defined function, or retained in a
                     variable.</p>
                  </li>
               </ul>
               <p>The concept of operand usage is not used for all
                  constructs (for example, it is not used in the analysis of path expressions).
                  Where it is used, the assignment of operand usages to each operand role
               of a construct is defined in the relevant subsection of
              <a href="#streamability-of-constructs"><b>12 Streamability of Specific Constructs</b></a>.</p>
               <div class="div3">
                  
                  <h4><a id="type-determined-usage"></a>3.3.1 <a href="#type-determined-usage" style="text-decoration: none">Type-determined Usage</a></h4>
                  <p><a id="dt-type-determined-usage" title="type-determined usage"><span class="definition">[Definition:&nbsp;</span></a>The
                  <b>type-determined usage</b> of an <a title="operand" class="termref" href="#dt-operand">operand</a> is as
               follows: if the required type (ignoring occurrence indicator) is
                  <code>fn(*)</code> or a subtype thereof, then <a title="inspection" class="termref" href="#dt-inspection">inspection</a>; if the required type (ignoring occurrence indicator) is an atomic or union type, then <a title="absorption" class="termref" href="#dt-absorption">absorption</a>; otherwise <a title="navigation" class="termref" href="#dt-navigation">navigation</a>.<span class="definition">]</span></p>
                  <p><a id="dt-type-adjusted-posture-and-sweep" title="type-adjusted posture and sweep"><span class="definition">[Definition:&nbsp;</span></a>The <b>type-adjusted posture and
                  sweep</b> of a construct <var>C</var>, with respect to a type <var>T</var>, are
               the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> established by applying
               the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> to a construct <var>D</var> whose
               single operand is the construct <var>C</var>, where the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of <var>C</var> in <var>D</var> is the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the required type
               <var>T</var>.<span class="definition">]</span></p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>In effect, the type-adjusted posture and sweep are the posture and sweep of the
               implicit expression formed to apply the <a href="https://qt4cg.org/specifications/xslt-40/#dt-coercion-rules">coercion rules</a><sup><small>XT</small></sup>
               to the argument of a function or template call, or to the result of a function or
               template, given knowledge of the required type. For example, an expression such as
                  <code>discount</code> in the function call <code>abs(discount)</code>, which would
               otherwise be <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, becomes
                  <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a> because of the
               implicit atomization triggered by the coercion rules.</p>
                  </div>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="streamability-properties"></a>3.4 <a href="#streamability-properties" style="text-decoration: none">Streamability Properties</a></h3>
               <p>The process of determining whether a construct is streamable reduces to determining
            properties of the constructs in the construct tree. The properties in question (which
            are described in greater detail in subsequent sections) are:</p>
               <ol class="enumar">
                  <li>
                     <p>The <b>static type</b> of the construct. When the construct is evaluated,
                  its value will always be an instance of this type. The value is a <a title="U-type" class="termref" href="#dt-utype">U-type</a>; although type
                  inferencing is capable of determining information about the cardinality as well as
                  the item type, the streamability analysis makes no use of this.</p>
                  </li>
                  <li>
                     <p>The <b>context item type</b>: that is, the static type of the <a href="https://qt4cg.org/specifications/xslt-40/#dt-context-item">context item</a><sup><small>XT</small></sup> potentially used as input to the construct. When the
                  construct is evaluated, the context item used to evaluate the construct (if it is
                  used at all) will be an instance of this type.</p>
                  </li>
                  <li>
                     <p><a id="dt-posture" title="posture"><span class="definition">[Definition:&nbsp;</span></a>The <b>posture</b> of the
                     expression. This captures information about the way in which the streamed input
                     document is positioned on return from evaluating the construct. The posture
                     takes one of the values <a title="climbing" class="termref" href="#dt-climbing">climbing</a>, <a title="striding" class="termref" href="#dt-striding">striding</a>, <a title="crawling" class="termref" href="#dt-crawling">crawling</a>, <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, or <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.<span class="definition">]</span> The meanings of these terms are
                  explained in <a href="#posture"><b>3.8 Posture</b></a>.</p>
                  </li>
                  <li>
                     <p><a id="dt-context-posture" title="context posture"><span class="definition">[Definition:&nbsp;</span></a>The <b>context
                        posture</b>. This captures information about how the <a href="https://qt4cg.org/specifications/xslt-40/#dt-context-item">context item</a><sup><small>XT</small></sup> used as input to the construct is positioned
                     relative to the streamed input. The <b>context posture</b> of a construct
                     C is the posture of the expression whose value sets the focus for the
                     evaluation of C.<span class="definition">]</span> Rules for determining the
                     context posture of any construct are given in <a href="#determining-context-posture"><b>3.8.2 Determining the Context Posture</b></a>.</p>
                  </li>
                  <li>
                     <p>The <b>sweep</b> of the construct. The sweep of a construct gives
                  information about whether and how the evaluation of the construct changes the
                  current position in a streamed input document. The possible values are <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>. These terms are explained in <a href="#sweep"><b>3.9 Sweep</b></a>.</p>
                  </li>
               </ol>
               <p>The values of these properties for a top-level construct such as the body of a template
            rule determine whether the construct is streamable.</p>
               <p>The values of these properties are not independent. For example, if the static type is
            atomic, then the posture will always be grounded; if the sweep is free-ranging, then the
            posture will always be roaming.</p>
               <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a
               <a title="construct" class="termref" href="#dt-construct">construct</a>, as defined above, are calculated in relation to a
            particular streamed input document. If there is more than one streamed input document,
            then a construct that is motionless with respect to one streamed input might be
            consuming with respect to another. In practice, though, the streamability analysis is
            only ever concerned with one particular streamed input at a time; constructs are
            analyzed in relation to the innermost containing <a href="../../xslt-40/Overview.html#xsl:template">xsl:template</a>,
               <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a>, <a href="../../xslt-40/Overview.html#xsl:accumulator">xsl:accumulator</a>, or
               <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element, and this container implicitly defines the
            streamed input document that is relevant. The streamed input document affecting a
            construct is always the document that contains the context item for evaluation of that
               construct.</p>
            </div>
            <div class="div2">
               
               <h3><a id="determining-static-type"></a>3.5 <a href="#determining-static-type" style="text-decoration: none">Determining the Static Type of a Construct</a></h3>
               <div class="changes">
                  <p class="changesHeading">
        Changes in 4.0
        (<a href="#streamability-xsl-map">next</a> | <a href="#intro">previous</a>)</p>
                  <ol>
                     <li>
                        <p>
                  The static typing rules have been updated to take account of new constructs in XPath 4.0.
               <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/675">675</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2011">2011</a>&nbsp;18 May 2025]</i></p>
                     </li>
                  </ol>
               </div>
               <p><a id="dt-static-type" title="static type"><span class="definition">[Definition:&nbsp;</span></a>The <b>static type</b> of a
                     <a title="construct" class="termref" href="#dt-construct">construct</a> is such that all values
                  produced by evaluating the construct will conform to that type. The static type of
                  a construct comprises a <a title="U-type" class="termref" href="#dt-utype">U-type</a> and a cardinality.
                  A cardinality is a range of integers (from <code>min</code> to <code>max</code>).<span class="definition">]</span></p>
               <p><a id="dt-utype" title="U-type"><span class="definition">[Definition:&nbsp;</span></a>A <b>U-type</b> is a set of <a title="fundamental item type" class="termref" href="#dt-fundamental-item-type">fundamental item types</a>.<span class="definition">]</span></p>
               <p><a id="dt-fundamental-item-type" title="fundamental item type"><span class="definition">[Definition:&nbsp;</span></a>There are 29
                     <b>fundamental item types</b>: the 7 node kinds defined in <a href="#xpath-datamodel-40">[XDM 4.0]</a> (element, attribute, etc.), the 19 primitive atomic
                  types defined in <a href="#xmlschema-2">[XML Schema Part 2]</a>, plus the types
                     <code>fn(*)</code>, <code>xs:untypedAtomic</code>, and <code>JNode</code>. The fundamental
                  item types are disjoint, and every item is an instance of exactly one of
                  them.<span class="definition">]</span></p>
               <p>More specifically, the fundamental item types are:</p>
               <ul>
                  <li>
                     <p><code>document-node()</code>, <code>element()</code>, <code>attribute()</code>,
                        <code>text()</code>, <code>comment()</code>,
                        <code>processing-instruction()</code>, <code>namespace-node()</code>;</p>
                  </li>
                  <li>
                     <p><code>xs:boolean</code>, <code>xs:double</code>, <code>xs:decimal</code>,
                        <code>xs:float</code>, <code>xs:string</code>, <code>xs:dateTime</code>,
                        <code>xs:date</code>, <code>xs:time</code>, <code>xs:gYear</code>,
                        <code>xs:gYearMonth</code>, <code>xs:gMonth</code>,
                        <code>xs:gMonthDay</code>, <code>xs:gDay</code>, <code>xs:anyURI</code>,
                        <code>xs:QName</code>, <code>xs:NOTATION</code>,
                        <code>xs:base64Binary</code>, <code>xs:hexBinary</code>,
                        <code>xs:duration</code></p>
                  </li>
                  <li>
                     <p><code>fn(*)</code></p>
                  </li>
                  <li>
                     <p><code>xs:untypedAtomic</code></p>
                  </li>
                  <li>
                     <p><code>JNode</code></p>
                  </li>
               </ul>
               <p>TODO: extend the analysis to include JNodes.</p>
               <p>A value <var>V</var> (in general, a sequence) is an instance of a <a title="U-type" class="termref" href="#dt-utype">U-type</a>
               <var>U</var> if every item in <var>V</var> is an instance of one of the <a title="fundamental item type" class="termref" href="#dt-fundamental-item-type">fundamental item types</a> in <var>U</var>.
               For example, the sequence <code>(23, "Paris")</code> is an instance of the U-type
                  <code>U{xs:string, xs:decimal, xs:date}</code> because both items in the sequence
               belong to item types in this U-type. </p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>It is a consequence of this rule that the empty sequence, <code>()</code>, is an
                  instance of every U-type.</p>
               </div>
               <p>A <a title="U-type" class="termref" href="#dt-utype">U-type</a> is represented in this specification using the notation
                  <var>U{t1, t2, t3, ...}</var> where <code>t1, t2, t3, ...</code> are the names of
               the fundamental item types making up the U-type. The item types are represented using
               the syntax of the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#prod-xpath40-ItemType">ItemType</a><sup><small>XP</small></sup>
               production in XPath, for example <code>comment()</code> or <code>xs:date</code>.</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>This means that the order of <code>t1, t2, t3, ...</code> has no significance:
                     <var>U{A, B}</var> is the same U-type as <var>U{B, A}</var>.</p>
               </div>
               <p>The smallest U-type is denoted <var>U{}</var>. This is not an empty type; like every
               other U-type, it has the empty sequence <code>()</code> as an instance. For
               convenience, the universal U-type is represented as <var>U{*}</var>; the U-type
               corresponding to the set of 7 node kinds is written <var>U{N}</var>, and the U-type
               corresponding to all atomic items (that is, the 19 primitive atomic types plus
                  <code>xs:untypedAtomic</code>) is written <var>U{A}</var>.</p>
               <p>Because a <a title="U-type" class="termref" href="#dt-utype">U-type</a> is a set, the operations of union, intersection,
               and difference are defined over U-types, and the result is always a U-type. If one
               U-type <var>U</var> is a subset of another U-type <var>V</var>, then <var>U</var> is
               said to be a subtype of <var>V</var>, and <var>V</var> is said to be a supertype of
                  <var>U</var>.</p>
               <p>In some cases the inference of a <a title="static type" class="termref" href="#dt-static-type">static type</a> depends on the
               declared types of variables or functions. Since declared types use the
               <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-type">SequenceType</a><sup><small>XT</small></sup> 
               syntax, there is therefore a mapping defined from
               SequenceTypes to U-types. The mapping is as follows:</p>
               <ul>
                  <li>
                     <p>The <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-type">SequenceType</a><sup><small>XT</small></sup> 
                     <code>empty-sequence()</code> maps to <var>U{}</var></p>
                  </li>
                  <li>
                     <p>For every other <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-type">SequenceType</a><sup><small>XT</small></sup>, 
                     the mapping depends only on the item type and
                     ignores the occurrence indicator. The mapping from item types is as
                     follows:</p>
                     <ul>
                        <li>
                           <p><code>item()</code> maps to <var>U{*}</var></p>
                        </li>
                        <li>
                           <p>A choice item type <code>(A | B | C)</code> maps
                        to the union of the U-types corresponding to <code>A</code>,
                        <code>B</code>, and <code>C</code>.</p>
                        </li>
                        <li>
                           <p><code>AnyKindTest</code> (<code>node()</code>) maps to
                           <var>U{N}</var></p>
                        </li>
                        <li>
                           <p><code>DocumentTest</code> maps to <var>U{document-node()}</var></p>
                        </li>
                        <li>
                           <p><code>ElementTest</code> and <code>SchemaElementTest</code> map to
                              <var>U{element()}</var></p>
                        </li>
                        <li>
                           <p><code>AttributeTest</code> and <code>SchemaAttributeTest</code> map to
                              <var>U{attribute()}</var></p>
                        </li>
                        <li>
                           <p><code>TextTest</code> maps to <var>U{text()}</var></p>
                        </li>
                        <li>
                           <p><code>CommentTest</code> maps to <var>U{comment()}</var></p>
                        </li>
                        <li>
                           <p><code>PITest</code> maps to <var>U{processing-instruction()}</var></p>
                        </li>
                        <li>
                           <p><code>NamespaceNodeTest</code> maps to <var>U{namespace-node()}</var></p>
                        </li>
                        <li>
                           <p><code>FunctionType</code>, <code>MapType</code>, 
                           and <code>ArrayType</code> and <code>RecordType</code> 
                           map to <var>U{fn(*)}</var></p>
                        </li>
                        <li>
                           <p>The QName <code>xs:error</code> maps to <var>U{}</var></p>
                        </li>
                        <li>
                           <p>A QName <var>Q</var> representing an atomic type that is a fundamental
                           item type maps to <var>U{Q}</var></p>
                        </li>
                        <li>
                           <p>A QName <var>Q</var> representing an atomic type derived from a
                           fundamental item type <var>F</var> maps to <var>U{F}</var></p>
                        </li>
                        <li>
                           <p>A QName <var>Q</var> representing a pure union type maps to a U-type
                           containing the fundamental item types present in the transitive
                           membership of the union, or from which the transitive members of the
                           union are derived.</p>
                        </li>
                     </ul>
                  </li>
               </ul>
               <div class="div3">
                  
                  <h4><a id="static-type-of-xpath-expressions"></a>3.5.1 <a href="#static-type-of-xpath-expressions" style="text-decoration: none">Static Type Inference for XPath Expressions</a></h4>
                  <p>Although all constructs have a <a title="static type" class="termref" href="#dt-static-type">static type</a>, the streamability
               analysis only needs to know the static type of XPath expressions, so the rules here
               are largely confined to that case. For <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">patterns</a><sup><small>XT</small></sup>, the <a title="static type" class="termref" href="#dt-static-type">static type</a> is
                  deemed to be <var>U{xs:boolean}</var>, reflecting the fact that a pattern is
                  essentially a function that can be applied to items to deliver a <code>true</code> or <code>false</code>
                  (matching or non-matching) result.
               For constructs other than <a href="https://qt4cg.org/specifications/xslt-40/#dt-expression">expressions</a><sup><small>XT</small></sup>
                  and <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">patterns</a><sup><small>XT</small></sup>, the <a title="static type" class="termref" href="#dt-static-type">static type</a> for the
                  purpose of streamability analysis is taken as <var>U{*}</var>.</p>
                  <p>The rules given here are deliberately simple. Implementations may well be able to
               compute a more precise <a title="static type" class="termref" href="#dt-static-type">static type</a>, but this will rarely be
               useful for streamability analysis. The item type for each kind of XPath expression is
               determined by the rules below. The columns are interpreted as follows:</p>
                  <ul>
                     <li>
                        <p>The name in the first column is the name of a production
               in the XPath grammar.</p>
                     </li>
                     <li>
                        <p>In the
                  second column, the <b>Proforma</b> uses an informal notation used both to
                  provide a reminder of the syntax of the construct in question, and to attach
                  labels to its operand roles so that they can be referred to in the text of the
                  third column.</p>
                     </li>
                     <li>
                        <p>The third column gives the static type of the expression, either as
               a <a title="U-type" class="termref" href="#dt-utype">U-type</a>, or as a formula for computing the U-type. In these
               formulae, <code>T(<var>E</var>)</code> means the U-type of expression <var>E</var>,
               <code><var>U<sub>1</sub></var>|<var>U<sub>2</sub></var></code> means the union of U-types <var>U<sub>1</sub></var>
               and <var>U<sub>2</sub></var>, and <code><var>U<sub>1</sub></var> intersect <var>U<sub>2</sub></var></code> means the intersection of U-types <var>U<sub>1</sub></var>
               and <var>U<sub>2</sub></var>.</p>
                     </li>
                     <li>
                        <p>The fourth column gives the cardinality of the result, either as an explicit range, or
                  as a formula. For example
               (0, 1) indicates a cardinality range from zero to one inclusive. <var>N</var> represents
               unbounded cardinality. The notation <code>C(<var>E</var>)</code> represents the cardinality
               of expression <var>E</var>.</p>
                        <p>The sum of two cardinalities <code><var>C</var> + <var>D</var></code> is the range
                  <code>(<var>C<sub>min</sub></var>+<var>D<sub>min</sub></var>, <var>C<sub>max</sub></var>+<var>D<sub>max</sub></var>)</code>.</p>
                        <p>The product of two cardinalities <code><var>C</var> * <var>D</var></code> is the range
                  <code>(<var>C<sub>min</sub></var>*<var>D<sub>min</sub></var>, <var>C<sub>max</sub></var>*<var>D<sub>max</sub></var>)</code>.</p>
                        <p>The maximum of two cardinalities <code>max(<var>C</var>, <var>D</var>)</code> is the range
                  <code>(<var>min(C<sub>min</sub></var>, <var>D<sub>min</sub></var>), max(<var>C<sub>max</sub></var>, <var>D<sub>max</sub></var>))</code>.</p>
                     </li>
                  </ul>
                  <table class="data">
                     <caption>Inferring a Static Type for XPath 3.0 Expressions</caption>
                     <thead>
                        <tr>
                           <th>Construct</th>
                           <th>Proforma</th>
                           <th>Static Item Type</th>
                           <th>Cardinality</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td>Expr</td>
                           <td><code>E,F</code></td>
                           <td><code>T(E) | T(F)</code></td>
                           <td><code>C(E) + C(F)</code></td>
                        </tr>
                        <tr>
                           <td>ForExpr</td>
                           <td><code>for $x in S return E</code></td>
                           <td><code>T(E)</code></td>
                           <td><code>C(S) * C(E)</code></td>
                        </tr>
                        <tr>
                           <td>LetExpr</td>
                           <td><code>let $x := S return E</code></td>
                           <td><code>T(E)</code></td>
                           <td><code>C(E)</code></td>
                        </tr>
                        <tr>
                           <td>QuantifiedExpr</td>
                           <td><code>some|every $x in S satisfies C</code></td>
                           <td><var>U{xs:boolean}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td rowspan="2">IfExpr</td>
                           <td><code>if (C) then A else B</code></td>
                           <td><code>T(A) | T(B)</code></td>
                           <td><code>max(C(A), C(B))</code></td>
                        </tr>
                        <tr>
                           <td><code>if (C) { A }</code></td>
                           <td><code>T(A)</code></td>
                           <td><code>max(C(A), (0,0))</code></td>
                        </tr>
                        <tr>
                           <td>OtherwiseExpr</td>
                           <td><code>A otherwise B</code></td>
                           <td><code>T(A) | T(B)</code></td>
                           <td><code>max(C(A), C(B))</code></td>
                        </tr>
                        <tr>
                           <td>OrExpr</td>
                           <td><code>E or F</code></td>
                           <td><var>U{xs:boolean}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>AndExpr</td>
                           <td><code>E and F</code></td>
                           <td><var>U{xs:boolean}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>ComparisonExpr</td>
                           <td><code>E = F</code>; <code>E eq F</code>; <code>E is F</code></td>
                           <td><var>U{xs:boolean}</var></td>
                           <td><code>(0,1)</code></td>
                        </tr>
                        <tr>
                           <td>StringConcatExpr</td>
                           <td><code>E || F</code></td>
                           <td><var>U{xs:string}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>RangeExpr</td>
                           <td><code>E to F</code></td>
                           <td><var>U{xs:decimal}</var></td>
                           <td><code>(0,N)</code></td>
                        </tr>
                        <tr>
                           <td>AdditiveExpr</td>
                           <td><code>E + F</code></td>
                           <td><var>U{A}</var>. But if the expression
                              is a predicate (that is, if it appears between square brackets in a
                              filter expression or axis step), then <var>U{xs:decimal, xs:double,
                                 xs:float}</var></td>
                           <td><code>(0,1)</code></td>
                        </tr>
                        <tr>
                           <td>MultiplicativeExpr</td>
                           <td><code>E * F</code></td>
                           <td><var>U{A}</var>. But if the expression
                              is a predicate (that is, if it appears between square brackets in a
                              filter expression or axis step), then <var>U{xs:decimal, xs:double,
                                 xs:float}</var></td>
                           <td><code>(0,1)</code></td>
                        </tr>
                        <tr>
                           <td>UnionExpr</td>
                           <td><code>A | B</code></td>
                           <td><code>T(A) | T(B)</code></td>
                           <td><code>C(A) + C(B)</code></td>
                        </tr>
                        <tr>
                           <td rowspan="2">IntersectExceptExpr</td>
                           <td><code>A intersect B</code></td>
                           <td><code>T(A) intersect T(B)</code></td>
                           <td><code>C(A) * (0,1)</code></td>
                        </tr>
                        <tr>
                           <td><code>E except F</code></td>
                           <td><code>T(A)</code></td>
                           <td><code>C(A) * (0,1)</code></td>
                        </tr>
                        <tr>
                           <td>InstanceOfExpr</td>
                           <td><code>E instance of T</code></td>
                           <td><var>U{xs:boolean}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>TreatExpr</td>
                           <td><code>E treat as T</code></td>
                           <td>The U-type corresponding to the SequenceType T</td>
                           <td>The cardinality of the SequenceType T</td>
                        </tr>
                        <tr>
                           <td>CastableExpr</td>
                           <td><code>E castable as T</code></td>
                           <td><var>U{xs:boolean}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>CastExpr</td>
                           <td><code>E cast as T</code></td>
                           <td>if T is an atomic or pure union type, the corresponding U-type. Otherwise,
                              for example if T is a list type, <var>U{A}</var>.</td>
                           <td>if T is an atomic or pure union type, (0,1). Otherwise,
                              for example if T is a list type, (0,N).</td>
                        </tr>
                        <tr>
                           <td>UnaryExpr</td>
                           <td><code>-N</code></td>
                           <td><var>U{xs:decimal, xs:double, xs:float}</var></td>
                           <td><code>C(N)</code></td>
                        </tr>
                        <tr>
                           <td>SimpleMapExpr</td>
                           <td><code>A ! B</code></td>
                           <td><code>T(B)</code></td>
                           <td><code>C(A) * C(B)</code></td>
                        </tr>
                        <tr>
                           <td rowspan="3">PathExpr</td>
                           <td><code>/</code></td>
                           <td><var>U{document-node()}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td><code>/P</code></td>
                           <td><code>T(P)</code></td>
                           <td><code>(0,N)</code></td>
                        </tr>
                        <tr>
                           <td><code>//P</code></td>
                           <td><code>T(P)</code></td>
                           <td><code>(0,N)</code></td>
                        </tr>
                        <tr>
                           <td>RelativePathExpr</td>
                           <td><code>P/Q</code>; <code>P//Q</code></td>
                           <td><code>T(Q)</code></td>
                           <td><code>(0,N)</code></td>
                        </tr>
                        <tr>
                           <td>AxisStep</td>
                           <td><code>E[P]</code></td>
                           <td><code>T(E)</code>: see <a href="#static-type-of-steps"><b>3.5.2 Static Type of an Axis Step</b></a></td>
                           <td><code>(0,N)</code></td>
                        </tr>
                        <tr>
                           <td>ForwardStep, ReverseStep</td>
                           <td><code>Axis::NodeTest</code></td>
                           <td>See <a href="#static-type-of-steps"><b>3.5.2 Static Type of an Axis Step</b></a></td>
                           <td><code>(0,N)</code></td>
                        </tr>
                        <tr>
                           <td rowspan="3">PostfixExpr</td>
                           <td>FilterExpr <code>E[P]</code></td>
                           <td>the static type of E</td>
                           <td>If <code>P</code> is numeric with max cardinality 1, 
                              then <code>(0,1)</code>. Otherwise <code>C(E) * (0,1)</code></td>
                        </tr>
                        <tr>
                           <td>FilterExprAM <code>E?[P]</code></td>
                           <td><code>T(E)</code></td>
                           <td><code>C(E) * (0,1)</code></td>
                        </tr>
                        <tr>
                           <td>Dynamic Function Call <code>F(X, Y)</code></td>
                           <td><var>U{*}</var>, unless ancillary information is available about the
                              function signature of F: see below.</td>
                           <td>The cardinality of the return type of <code>F</code>.</td>
                        </tr>
                        <tr>
                           <td>Literal</td>
                           <td><code>"pH"</code>, <code>93.7</code>, <code>#xml:space</code></td>
                           <td><var>U{xs:string}</var>, <var>U{xs:decimal}</var>, 
                              <var>U{xs:double}</var>, or <var>U{xs:QName}</var> depending on the form of the literal</td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>StringTemplate</td>
                           <td><code>`{$x}{$y}`</code></td>
                           <td><var>U{xs:string}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>VarRef</td>
                           <td><code>$V</code></td>
                           <td>The declared type of the variable if declared,
                              otherwise the item type of the expression to which the variable is bound.</td>
                           <td>The declared cardinality of the variable if declared,
                              otherwise the cardinality of the expression to which the variable is bound,
                              or <code>(1,1)</code> in the case of a variable declared in a <code>ForExpr</code>
                              or <code>QuantifiedExpr</code>.</td>
                        </tr>
                        <tr>
                           <td rowspan="2">ParenthesizedExpr</td>
                           <td><code>(E)</code></td>
                           <td><code>T(E)</code></td>
                           <td><code>C(E)</code></td>
                        </tr>
                        <tr>
                           <td><code>()</code></td>
                           <td><var>U{}</var> (a type whose only instance is the empty sequence)</td>
                           <td><code>(0,0)</code></td>
                        </tr>
                        <tr>
                           <td>ContextValueRef</td>
                           <td><code>.</code></td>
                           <td>the context item type: see below</td>
                           <td>the context cardinality: see below</td>
                        </tr>
                        <tr>
                           <td>FunctionCall</td>
                           <td><code>F(X, Y)</code></td>
                           <td>In general: the U-type corresponding to
                              the declared result type of function <var>F</var>. But:
                              
                              <ul>
                                 <li>
                                    <p>If one or more of
                              the arguments to the function have operand usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, then the intersection of the U-type
                              corresponding to the declared result type with the union of the static
                              types of the arguments having usage transmission. (For example, the
                              static type of the function call <code>head(//text())</code> is
                              <var>U{text()}</var>.)</p>
                                 </li>
                                 <li>
                                    <p>Special rules apply to the
                           <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current"><code>current</code></a> function: see <a href="#static-type-of-current-function"><b>3.5.3 Static Type of a Call to current</b></a>.</p>
                                 </li>
                              </ul>
                           </td>
                           <td><code>TODO</code></td>
                        </tr>
                        <tr>
                           <td>Partial Function Application</td>
                           <td><code>F(X, ?)</code>, $F(X, ?)</td>
                           <td><var>U{fn(*)}</var></td>
                           <td><code>TODO</code></td>
                        </tr>
                        <tr>
                           <td>NamedFunctionRef</td>
                           <td><code>F#n</code></td>
                           <td><var>U{fn(*)}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>InlineFunctionExpr</td>
                           <td><code>fn(P) {E}</code></td>
                           <td><var>U{fn(*)}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>MapConstructor</td>
                           <td><code>{ "A": E, "B": F }</code></td>
                           <td><var>U{fn(*)}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>Postfix Lookup (Shallow)</td>
                           <td><code>E ? K</code></td>
                           <td>If the type of <var>E</var> is a map type <code>map(K, V)</code> or an
                              array type <code>array(V)</code>, then the U-type corresponding to the item
                              type of <var>V</var>; otherwise <var>U{*}</var>. An implementation <span class="verb">may</span>
                              be able to determine a more precise type when the type of <var>E</var> is a record type.</td>
                           <td><code>(0,N)</code></td>
                        </tr>
                        <tr>
                           <td>Unary Lookup (Shallow)</td>
                           <td><code>? K</code></td>
                           <td>If the context item type is a map type <code>map(K, V)</code> or an array
                              type <code>array(V)</code>, then the U-type corresponding to the item type
                              of <var>V</var>; otherwise <var>U{*}</var>. An implementation <span class="verb">may</span>
                              be able to determine a more precise type when the context item type is a record type.</td>
                           <td><code>(0,N)</code></td>
                        </tr>
                        <tr>
                           <td>Deep Lookup</td>
                           <td><code>?? K</code>, <code>E ?? K</code></td>
                           <td><var>U{*}</var></td>
                           <td><code>(0,N)</code></td>
                        </tr>
                        <tr>
                           <td>PipelineExpr</td>
                           <td><code>A -&gt; B</code></td>
                           <td><code>T(B)</code></td>
                           <td><code>C(B)</code></td>
                        </tr>
                        <tr>
                           <td>ArrowExpr</td>
                           <td><code>X =&gt; F(Y, Z)</code>, <code>X =!&gt; F(Y, Z)</code></td>
                           <td>The static type of the equivalent static or dynamic function call 
                              <code>F(X, Y, Z)</code></td>
                           <td>The cardinality of the equivalent static or dynamic function call 
                              <code>F(X, Y, Z)</code></td>
                        </tr>
                        <tr>
                           <td>SquareArrayConstructor</td>
                           <td><code>[ X, Y, ... ]</code></td>
                           <td><var>U{fn(*)}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                        <tr>
                           <td>CurlyArrayConstructor</td>
                           <td><code>array {X, Y, ... }</code></td>
                           <td><var>U{fn(*)}</var></td>
                           <td><code>(1,1)</code></td>
                        </tr>
                     </tbody>
                  </table>
                  <p>Where the <a title="static type" class="termref" href="#dt-static-type">static type</a> of an expression is
                  <var>U{fn(*)}</var>, it is useful to retain additional information:
               specifically, the signature of the function. This may be regarded as information
               ancillary to the U-type of the expression; it does not play any role in operations
               such as testing whether one U-type is a subtype of another, or forming the union of
               two U-types. This ancillary information is available for a
                  <code>NamedFunctionRef</code>, for an <code>InlineFunctionExpr</code>, for a
                  <code>MapConstructor</code>, for a <code>FunctionCall</code> whose static type is
                  <var>U{fn(*)}</var>, and for a <code>VarRef</code> if the variable is bound
               to any of the forgoing, or if it has a declared type corresponding to
                  <var>U{fn(*)}</var>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The special case type inference used for an <code>AdditiveExpr</code> or
                     <code>MultiplicativeExpr</code> appearing as a predicate is possible because if
                  an arithmetic operation within a predicate produces any other result, for example
                  an <code>xs:duration</code> or <code>xs:dateTime</code>, this would cause a type
                  error (on the grounds that an <code>xs:duration</code> or <code>xs:dateTime</code>
                  has no effective boolean value), and static type inference only needs to consider
                  the type of non-error results. The benefit of this special rule is that filter
                  expressions such as <code>/descendant::section[$i + 1]</code> can be recognized as
                  returning a singleton, and therefore as being <a title="striding" class="termref" href="#dt-striding">striding</a>, even
                  if the type of <code>$i</code> is unknown.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="static-type-of-steps"></a>3.5.2 <a href="#static-type-of-steps" style="text-decoration: none">Static Type of an Axis Step</a></h4>
                  <p>An <code>AxisStep</code> consists of either a <code>ForwardStep</code> or <code>ReverseStep</code>
               followed by zero or more predicates. The predicates have no effect on the inferred type of the
               <code>AxisStep</code>.</p>
                  <p>The static type of an abbreviated step is the static type of its expansion, for example the
               static type of <code>@*</code> is the same as the static type of <code>attribute::*</code>.</p>
                  <p>Both the constructs <code>ForwardStep</code> or <code>ReverseStep</code>, in their
                  unabbreviated form, are written as <code>Axis::NodeTest</code>. The static type depends
               on both the <code>Axis</code> and the <code>NodeTest</code>, and also on the
                  <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a>, determined as described in 
                 <a href="#determining-context-item-type"><b>3.6 Determining the Context Item Type</b></a>.</p>
                  <p>If the <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> has an empty intersection with <code>U{N}</code>
                  (that is, if the context item type cannot be a node), then evaluation of the <code>AxisStep</code>
                  will always fail; it is permissible to raise a type error statically in this case, but for the
                  sake of the analysis, the static type of the <code>AxisStep</code> can be taken as <code>U{}</code>.
                  In other cases, let <var>CIT</var> be the intersection of the <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a>
                   with <code>U{N}</code>.</p>
                  <p>Let <var>K(A, CIT)</var> be the set of <b>reachable node kinds</b> given an axis <var>A</var> 
                  (a <a title="U-type" class="termref" href="#dt-utype">U-type</a>) as defined by the following table: </p>
                  <table>
                     <thead>
                        <tr>
                           <th>Axis</th>
                           <th>Reachable Node Kinds</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td>self</td>
                           <td><var>CIT</var></td>
                        </tr>
                        <tr>
                           <td>attribute</td>
                           <td>if <var>CIT</var> includes <code>U{element()}</code> then <code>U{attribute()}</code> else <code>U{}</code></td>
                        </tr>
                        <tr>
                           <td>namespace</td>
                           <td>if <var>CIT</var> includes <code>U{element()}</code> then <code>U{namespace-node()}</code> else <code>U{}</code></td>
                        </tr>
                        <tr>
                           <td>child, descendant</td>
                           <td>if <var>CIT</var> includes <code>U{element()}</code> or <code>U{document-node()}</code> then 
                              <code>U{element(), text(), comment(), processing-instruction()}</code> else <code>U{}</code></td>
                        </tr>
                        <tr>
                           <td>following-sibling, preceding-sibling, following, preceding</td>
                           <td>if <var>CIT</var> is <code>U{document-node()}</code> then <code>U{}</code> else
                              <code>U{element(), text(), comment(), processing-instruction()}</code></td>
                        </tr>
                        <tr>
                           <td>parent, ancestor</td>
                           <td>if <var>CIT</var> is <code>U{document-node()}</code> then <code>U{}</code> else
                              <code>U{element(), document-node()}</code> </td>
                        </tr>
                        <tr>
                           <td>ancestor-or-self</td>
                           <td>the union of <var>K(ancestor, CIT)</var> and <var>CIT</var></td>
                        </tr>
                        <tr>
                           <td>descendant-or-self</td>
                           <td>the union of <var>K(descendant, CIT)</var> and <var>CIT</var></td>
                        </tr>
                     </tbody>
                  </table>
                  <p>Let <code>T(NT)</code> be the set of node kinds that are capable of satisfying a <code>NodeTest</code> <var>NT</var>,
               defined by the following table:</p>
                  <table>
                     <thead>
                        <tr>
                           <th>NodeTest</th>
                           <th>Possible Node Kinds</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td><code>AnyKindTest</code> (that is, <code>node()</code>)</td>
                           <td><var>U{N}</var> (that is, any node)</td>
                        </tr>
                        <tr>
                           <td>Any other <code>KindTest</code></td>
                           <td>The corresponding <a title="U-type" class="termref" href="#dt-utype">U-type</a> (for example, <code>U{text()}</code> 
                              for the <code>KindTest</code> <code>text()</code>)</td>
                        </tr>
                        <tr>
                           <td>NameTest</td>
                           <td>The <a title="U-type" class="termref" href="#dt-utype">U-type</a> corresponding to the principal node kind of the
                              specified axis</td>
                        </tr>
                     </tbody>
                  </table>
                  <p>The static type of an <code>AxisStep</code> with axis <var>A</var> and node test <code>NT</code>,
                  given a context item type <var>CIT</var>, is then defined to be the 
               intersection of <code>K(A, CIT)</code> with <code>T(NT)</code>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="static-type-of-current-function"></a>3.5.3 <a href="#static-type-of-current-function" style="text-decoration: none">Static Type of a Call to <code>current</code></a></h4>
                  <p>The rules in this section define the static type of a call to the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current"><code>current</code></a>
               function.</p>
                  <ol class="enumar">
                     <li>
                        <p>If the call is within a <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup>, the static type of the function call is the <a title="match type" class="termref" href="#dt-match-type">match type</a> of the pattern.</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>There is no circularity in this definition: a call to <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current"><code>current</code></a> in a pattern can only appear within a predicate, and
                        the match type of a pattern never depends on anything appearing in a predicate.</p>
                        </div>
                     </li>
                     <li>
                        <p>Otherwise (the function call is within an XPath expression), the static type of the function call is the
                     <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> that applies to the outermost containing XPath expression, determined by the rules in 
                     <a href="#determining-context-item-type"><b>3.6 Determining the Context Item Type</b></a>.
                  </p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="notes-on-schema-aware-analysis"></a>3.5.4 <a href="#notes-on-schema-aware-analysis" style="text-decoration: none">Schema-Aware Streamability Analysis</a></h4>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The streamability analysis in this chapter is not schema-aware. There are cases
                  where use of schema type information might enable a processor to determine that a
                  construct is streamable when it would be unable to make this determination
                  otherwise. Two examples:</p>
                     <ul>
                        <li>
                           <p>A processor might decide that a construct such as <code>price +
                           salesTax</code> is streamable if both the child elements have a simple
                        type such as <code>xs:decimal</code>, or if the order in which they appear
                        in the input document is known.</p>
                        </li>
                        <li>
                           <p>A processor might decide that a step using the descendant axis, such as
                           <code>.//title</code>, has <a title="striding" class="termref" href="#dt-striding">striding</a> rather than
                           <a title="crawling" class="termref" href="#dt-crawling">crawling</a>
                        <a title="posture" class="termref" href="#dt-posture">posture</a> if it can establish that two <code>title</code>
                        elements will never be nested
                        (that is, a <code>title</code> cannot contain another <code>title</code>).
                        This would allow the instruction <code>&lt;xsl:apply-templates
                           select=".//title"/&gt;</code> to be used in a streaming template rule.</p>
                        </li>
                     </ul>
                     <p>Although such constructs are not guaranteed streamable according to this
                  specification, there is nothing to prevent a processor providing a streamed
                  implementation if it is able to do so.</p>
                  </div>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="determining-context-item-type"></a>3.6 <a href="#determining-context-item-type" style="text-decoration: none">Determining the Context Item Type</a></h3>
               <p><a id="dt-context-item-type" title="context item type"><span class="definition">[Definition:&nbsp;</span></a>For every expression, it
                  is possible to establish by static analysis, information about the item type of
                  the context item for evaluation of that expression. This is called the
                     <b>context item type</b> of the expression.<span class="definition">]</span></p>
               <p>The <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> of an expression
               is a <a title="U-type" class="termref" href="#dt-utype">U-type</a>.</p>
               <p>The semantics of every <a title="construct" class="termref" href="#dt-construct">construct</a>, defined in
               this specification or in the XPath specification, describe how the <a href="https://qt4cg.org/specifications/xslt-40/#dt-focus">focus</a><sup><small>XT</small></sup> for evaluating each <a title="operand" class="termref" href="#dt-operand">operand</a> of the construct
               is determined. In most cases the focus is the same as that of the parent construct.
               In some cases the focus is determined by evaluating some other expression, for
               example in the expressions <code>A/B</code>, <code>A!B</code>, <code>A[B]</code>, 
               <code>A?[B]</code>, or <code>A -&gt; B</code>
               the focus for evaluating <var>B</var> is <var>A</var>. More generally:</p>
               <ul>
                  <li>
                     <p><a id="dt-focus-changing-construct" title="focus-changing construct"><span class="definition">[Definition:&nbsp;</span></a>A
                           <b>focus-changing construct</b> is a <a title="construct" class="termref" href="#dt-construct">construct</a>
                        that has one or more <a title="operand" class="termref" href="#dt-operand">operands</a> that are
                        evaluated with a different <a href="https://qt4cg.org/specifications/xslt-40/#dt-focus">focus</a><sup><small>XT</small></sup> from the parent
                        construct.<span class="definition">]</span></p>
                     <div class="note">
                        <p class="prefix"><b>Note:</b></p>
                        <p>Examples of focus-changing constructs include the instructions
                           <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a>, <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a>, and
                           <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a>; path expressions, filter
                        expressions, and simple mapping expressions; and all patterns.</p>
                     </div>
                  </li>
                  <li>
                     <p><a id="dt-controlling-operand" title="controlling operand"><span class="definition">[Definition:&nbsp;</span></a>Within a
                           <a title="focus-changing construct" class="termref" href="#dt-focus-changing-construct">focus-changing construct</a> there is in many cases one
                           <a title="operand" class="termref" href="#dt-operand">operand</a> whose value determines the
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-focus">focus</a><sup><small>XT</small></sup> for evaluating other operands; this is referred
                        to as the <b>controlling operand</b>.<span class="definition">]</span></p>
                     <div class="note">
                        <p class="prefix"><b>Note:</b></p>
                        <p>For example, the controlling operand of an <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a>,
                           <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a>, or <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a>
                        instruction is the expression in its <code>select</code> attribute; the
                        controlling operand of a filter expression <code>E[P]</code> is
                           <code>E</code>, and the controlling operand of a simple mapping
                        expression <code>A!B</code> is <code>A</code>.</p>
                     </div>
                  </li>
                  <li>
                     <p><a id="dt-controlled-operand" title="controlled operand"><span class="definition">[Definition:&nbsp;</span></a>Within a <a title="focus-changing construct" class="termref" href="#dt-focus-changing-construct">focus-changing construct</a> there are one or more <a title="operand" class="termref" href="#dt-operand">operands</a> 
                    that are evaluated with a <a href="https://qt4cg.org/specifications/xslt-40/#dt-focus">focus</a><sup><small>XT</small></sup> determined by the <a title="controlling operand" class="termref" href="#dt-controlling-operand">controlling operand</a>
                        (or in some cases such as
                              <a href="../../xslt-40/Overview.html#xsl:on-completion">xsl:on-completion</a>, with an <a href="https://qt4cg.org/specifications/xslt-40/#dt-absent">absent</a><sup><small>XT</small></sup>
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-focus">focus</a><sup><small>XT</small></sup>); these are referred to as
                           <b>controlled operands</b>.<span class="definition">]</span></p>
                     <div class="note">
                        <p class="prefix"><b>Note:</b></p>
                        <p>For example, the main controlled operand of an
                        <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a>, <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a>, or
                           <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction is the contained sequence
                        constructor; the controlled operand of a filter expression <code>E[P]</code>
                        is <code>P</code>, and the controlled operand of a simple mapping expression
                           <code>A!B</code> is <code>B</code>.</p>
                     </div>
                  </li>
                  <li>
                     <p><a id="dt-focus-setting-container" title="focus-setting container"><span class="definition">[Definition:&nbsp;</span></a>The
                           <b>focus-setting container</b> of a construct <var>C</var> is the
                        innermost <a title="focus-changing construct" class="termref" href="#dt-focus-changing-construct">focus-changing construct</a>
                        <var>F</var> (if one exists) such that <var>C</var> is directly or
                        indirectly contained in a <a title="controlled operand" class="termref" href="#dt-controlled-operand">controlled operand</a> of
                           <var>F</var>. If there is no such construct
                              <var>F</var>, then the focus-setting container is the containing
                              <a href="https://qt4cg.org/specifications/xslt-40/#dt-declaration">declaration</a><sup><small>XT</small></sup>, for example an
                              <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a> or <a href="../../xslt-40/Overview.html#xsl:template">xsl:template</a>
                           element.<span class="definition">]</span></p>
                     <div class="note">
                        <p class="prefix"><b>Note:</b></p>
                        <p>For example, if an instruction appears as a child of
                           <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a>, then its focus-setting container is the
                           <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction; if an expression appears
                        within the predicate of a filter expression, its focus-setting container is
                        the filter expression.</p>
                     </div>
                  </li>
               </ul>
               <p>The <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> of a construct <var>C</var> is the first of
               the following that applies:</p>
               <ol class="enumar">
                  <li>
                     <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var> is an
                        <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a> element, an inline function declaration, or an
                        <a href="../../xslt-40/Overview.html#xsl:on-completion">xsl:on-completion</a> element, then the context item type is
                        <code>U{}</code>.</p>
                     <div class="note">
                        <p class="prefix"><b>Note:</b></p>
                        <p>This is essentially an error case; expressions that depend on the focus
                        should not normally appear within a construct that sets the focus to
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-absent">absent</a><sup><small>XT</small></sup>.</p>
                     </div>
                  </li>
                  <li>
                     <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var> is an
                        <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction, then the context item type is <code>U{document-node()}</code>.</p>
                  </li>
                  <li>
                     <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var> is a
                        <a href="https://qt4cg.org/specifications/xslt-40/#dt-template-rule">template rule</a><sup><small>XT</small></sup>, then the context item type is the
                        <a title="match type" class="termref" href="#dt-match-type">match type</a> of the match pattern of the template rule,
                     defined below.</p>
                  </li>
                  <li>
                     <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var> is a
                        <code>PredicatePattern</code>, then the context item type is <code>U{*}</code>.</p>
                  </li>
                  <li>
                     <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> is a <a href="https://qt4cg.org/specifications/xslt-40/#dt-global-variable">global variable</a><sup><small>XT</small></sup>
                     declaration, the context item type is determined by the <code>type</code> attribute
                     of the <a href="../../xslt-40/Overview.html#xsl:global-context-item">xsl:global-context-item</a> declaration, defaulting to <code>U{*}</code>,
                     or <code>U{}</code> if the <a href="../../xslt-40/Overview.html#xsl:global-context-item">xsl:global-context-item</a> declaration specifies
                     <code>use="absent"</code>.</p>
                  </li>
                  <li>
                     <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> is any other <a href="https://qt4cg.org/specifications/xslt-40/#dt-declaration">declaration</a><sup><small>XT</small></sup>, for example <a href="../../xslt-40/Overview.html#xsl:key">xsl:key</a> or 
                     <a href="../../xslt-40/Overview.html#xsl:accumulator">xsl:accumulator</a>, the
                     context item type is <code>U{*}</code>.</p>
                  </li>
                  <li>
                     <p>Otherwise, the context item type is the <a title="static type" class="termref" href="#dt-static-type">static type</a> (see
                        <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>) of the <a title="controlling operand" class="termref" href="#dt-controlling-operand">controlling operand</a> of the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var>.</p>
                  </li>
               </ol>
               <p><a id="dt-match-type" title="match type"><span class="definition">[Definition:&nbsp;</span></a>The
                     <b>match type</b> of a <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup> is the most specific
                     <a title="U-type" class="termref" href="#dt-utype">U-type</a> that is known to match all items that the pattern can
                  match.<span class="definition">]</span> The match type of a pattern is the inferred <a title="static type" class="termref" href="#dt-static-type">static type</a> of the pattern’s equivalent expression, determined
               according to the rules in <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>. For example, the
               match type of the pattern <code>para[1]</code> is <code>U{element()}</code>, while
               that of the pattern <code>@code[.='x']</code> is <code>U{attribute()}</code></p>
            </div>
            <div class="div2">
               
               <h3><a id="operand-roles-and-usage"></a>3.7 <a href="#operand-roles-and-usage" style="text-decoration: none">The Effect of Operand Usage</a></h3>
               <p>The effect of <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> on streamability analysis 
             is illustrated in the following examples:</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e3540"></a>Example: The Effect of Operand Usage on the Streamability of a Context Item
                     Expression</div>
                  <p>Consider the following construct:</p>
                  <div class="exampleInner">
                     <pre>
&lt;xsl:source-document streamable="yes" href="emps.xml"&gt;
  &lt;xsl:for-each select="*/emp"&gt;
    &lt;xsl:value-of select="."/&gt;
  &lt;/xsl:for-each&gt;
&lt;/xsl:source-document&gt;</pre>
                  </div>
                  <p>To assess the streamability, we follow the following logic:</p>
                  <ol class="enumar">
                     <li>
                        <p>The top-level construct is a <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>. It
                           is evaluated with a document node as the context item, and with a
                              <a title="striding" class="termref" href="#dt-striding">striding</a> posture.</p>
                     </li>
                     <li>
                        <p>The sequence constructor has one child <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instruction</a><sup><small>XT</small></sup>,
                           which has an <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of <a title="transmission" class="termref" href="#dt-transmission">transmission</a>.</p>
                     </li>
                     <li>
                        <p>The <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction evaluates its
                              <code>select</code> expression, with the context item and <a title="posture" class="termref" href="#dt-posture">posture</a> unchanged.</p>
                     </li>
                     <li>
                        <p>The step <code>child::*</code> is evaluated with this context item and
                           posture. The posture transition rules permit this; we now have a sequence
                           of child elements, and still a <a title="striding" class="termref" href="#dt-striding">striding</a> posture.</p>
                     </li>
                     <li>
                        <p>The same applies to the next step, <code>child::emp</code></p>
                     </li>
                     <li>
                        <p>The content of the <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction is a
                              <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> which itself has a single
                              <a title="operand" class="termref" href="#dt-operand">operand</a>, the <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a>
                           instruction.</p>
                     </li>
                     <li>
                        <p>The <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instruction is evaluated once for each
                              <code>emp</code> child, with that child as context item and in a
                              <a title="striding" class="termref" href="#dt-striding">striding</a> posture. This instruction uses the
                              <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of the <code>select</code> expression is
                              <a title="absorption" class="termref" href="#dt-absorption">absorption</a>. This means that the result of the
                              <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instruction is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                     </li>
                     <li>
                        <p>The result of the trivial sequence constructor contained in the
                              <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction is therefore <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a></p>
                     </li>
                     <li>
                        <p>The result of the <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction (see <a href="#streamability-xsl-for-each"><b>12.5.18 Streamability of xsl:for-each</b></a>) is therefore <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a></p>
                     </li>
                     <li>
                        <p>The result of the trivial sequence constructor contained in the
                              <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction is therefore <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a></p>
                     </li>
                     <li>
                        <p>The <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction is therefore <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                     </li>
                  </ol>
                  <p>Now consider a slightly different construct:</p>
                  <div class="exampleInner">
                     <pre>
&lt;xsl:source-document streamable="yes" href="emps.xml"&gt;
  &lt;xsl:for-each select="*/emp"&gt;
    &lt;xsl:sequence select="."/&gt;
  &lt;/xsl:for-each&gt;
&lt;/xsl:source-document&gt;</pre>
                  </div>
                  <p>To assess the streamability, we follow the following logic:</p>
                  <ol class="enumar">
                     <li>
                        <p>The top-level construct is a <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>. It
                           is evaluated with a document node as the context item, and with a
                              <a title="striding" class="termref" href="#dt-striding">striding</a> posture.</p>
                     </li>
                     <li>
                        <p>The sequence constructor has one child <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instruction</a><sup><small>XT</small></sup>,
                           which has an <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of <a title="transmission" class="termref" href="#dt-transmission">transmission</a>.</p>
                     </li>
                     <li>
                        <p>The <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction evaluates its
                              <code>select</code> expression, with the context item and <a title="posture" class="termref" href="#dt-posture">posture</a> unchanged.</p>
                     </li>
                     <li>
                        <p>The step <code>child::*</code> is evaluated with this context item and
                           posture. The posture transition rules permit this; we now have a sequence
                           of child elements, and still a <a title="striding" class="termref" href="#dt-striding">striding</a> posture.</p>
                     </li>
                     <li>
                        <p>The same applies to the next step, <code>child::emp</code></p>
                     </li>
                     <li>
                        <p>The content of the <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction is a
                              <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> which itself has a single
                           operand, the <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a> instruction.</p>
                     </li>
                     <li>
                        <p>The <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a> instruction is evaluated once for each
                              <code>emp</code> child, with that child as context item and in a
                              <a title="striding" class="termref" href="#dt-striding">striding</a> posture. This instruction uses the
                              <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of the <code>select</code> expression is
                              <a title="transmission" class="termref" href="#dt-transmission">transmission</a>. This means that the result of the
                              <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a> instruction is <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>The result of the trivial sequence constructor contained in the
                              <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction is therefore also <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>The result of the <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction (see <a href="#streamability-xsl-for-each"><b>12.5.18 Streamability of xsl:for-each</b></a>) is therefore <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a> (the wider of the sweeps of the
                                 <code>select</code> expression and the sequence
                              constructor).</p>
                     </li>
                     <li>
                        <p>The result of the trivial sequence constructor contained in the
                              <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction is therefore <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                     </li>
                     <li>
                        <p>Since the result is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,  the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a>
                           instruction is therefore not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                     </li>
                  </ol>
                  <p>Expressed informally, the result of a <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a> 
                     <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction
                     (or of a <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a> template rule) 
                     must not contain streamed nodes. The reason
                     for this is that once streamed nodes are returned to constructs that are not
                     declared streamable and therefore have no streamability constraints, there is
                     no way to analyze what happens to them, and thus to guarantee
                     streamability.</p>
               </div>
               <p>&nbsp;</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e3808"></a>Example: The Effect of Operand Roles on the Streamability of Path Expressions</div>
                  <p>Consider the expression <code>.//chapter</code>.</p>
                  <p>When this appears as an argument to the function <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-count"><code>count</code></a>
                     or <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-exists"><code>exists</code></a>, it can be streamed (it is a <a title="consuming" class="termref" href="#dt-consuming">consuming</a> expression, meaning that the subtree rooted at the
                     context item needs to be read in order to evaluate the expression). A possible
                     strategy for performing a streamed evaluation is to read all descendants of the
                     context item in document order, checking each one to see whether its name is
                        <code>chapter</code>. The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the expression will
                     be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, and its <a title="posture" class="termref" href="#dt-posture">posture</a> will be
                        <a title="crawling" class="termref" href="#dt-crawling">crawling</a>.</p>
                  <p>The <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> (the usage of the argument to
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-count"><code>count</code></a> or <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-exists"><code>exists</code></a>) is defined as
                        <a title="inspection" class="termref" href="#dt-inspection">inspection</a>. The <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> show that when the posture of an
                        <a title="operand" class="termref" href="#dt-operand">operand</a> is <a title="crawling" class="termref" href="#dt-crawling">crawling</a> and the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is <a title="inspection" class="termref" href="#dt-inspection">inspection</a>, the resulting
                     expression is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>
                        and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. This means that (in the absence of other
                        consuming expressions) the containing template or function will generally be
                        streamable.</p>
                  <p>In the expression <code>tail(.//chapter)</code>, the
                        <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is classified as <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, meaning that the nodes are simply passed up the
                     tree to the next containing expression. In general, when a <a title="crawling" class="termref" href="#dt-crawling">crawling</a> expression is passed as an argument and the operand role
                     is <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, the containing expression will also be
                        <a title="crawling" class="termref" href="#dt-crawling">crawling</a>. However, there is an exception where the
                     expression is known to deliver a singleton (for example,
                        <code>head(.//chapter)</code>). In this case the returned sequence cannot
                     contain any nested nodes, so it is <a title="crawling" class="termref" href="#dt-crawling">crawling</a>.</p>
                  <p>When the same expression appears as an argument to an atomizing function
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-string-join"><code>string-join</code></a>, the processor knows that it will need to
                     access the subtree of each selected <code>section</code> element in order to
                     compute the result of the function (the argument to
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-string-join"><code>string-join</code></a> is classified as having <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                     <a title="absorption" class="termref" href="#dt-absorption">absorption</a>). The processor does not know whether these
                     subtrees will be nested (one
                        <code>section</code> might contain another). In most cases they will not be nested, because atomizing a
                        sequence that contains nested nodes is not generally a useful thing to do.
                        The streamability analysis therefore makes an optimistic assumption, by
                        treating atomization of a <a title="crawling" class="termref" href="#dt-crawling">crawling</a> expression as a
                        streamable operation. In the worst case, where it turns out that the
                        selected nodes are indeed nested, the processor must handle this, typically
                        by buffering the content of inner nodes until the end tag of the outer nodes
                        is reached.</p>
                  <p>This treatment of nodes in a <a title="crawling" class="termref" href="#dt-crawling">crawling</a> expression applies to all cases in which the content of
                     the nodes is handled in a way defined entirely by the rules of this
                     specification: for example, operations such as atomization, obtaining the
                     string value of nodes, deep copy of nodes, and the
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-deep-equal"><code>deep-equal</code></a> function. It does not extend to cases
                     where the processing applied to the nodes is user-defined: for example,
                     operations such as <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a>,
                        <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a>, or <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a>. In
                     these cases, the nodes selected for processing must not be nested (a <a title="crawling" class="termref" href="#dt-crawling">crawling</a> <a title="posture" class="termref" href="#dt-posture">posture</a> is not permitted in these contexts).</p>
                  <p>When a <a title="crawling" class="termref" href="#dt-crawling">crawling</a> expression
                     appears as an argument to a call on a user-defined function, the effect depends on the <a title="streamability category" class="termref" href="#dt-streamability-category">streamability category</a> of the function, as described in
                           <a href="#streamable-stylesheet-functions"><b>8.1 Classifying Stylesheet Functions</b></a>.</p>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="posture"></a>3.8 <a href="#posture" style="text-decoration: none">Posture</a></h3>
               <p>The <b>posture</b> of a construct indicates the relationship of the nodes
               selected by the <a title="construct" class="termref" href="#dt-construct">construct</a> to a <a title="streamed document" class="termref" href="#dt-streamed-document">streamed input document</a>. The value is one of
               the following:</p>
               <ul>
                  <li>
                     <p><a id="dt-grounded" title="grounded"><span class="definition">[Definition:&nbsp;</span></a><b>Grounded</b>: indicates that
                        the value returned by the construct does not contain nodes from the streamed
                        input document<span class="definition">]</span>. Atomic items and function items are always
                     grounded; nodes are grounded if it is known that they are in a non-streamed
                     document. For example the expressions <code>doc('x')</code> and
                        <code>copy-of(.)</code> both return grounded nodes.</p>
                  </li>
                  <li>
                     <p><a id="dt-climbing" title="climbing"><span class="definition">[Definition:&nbsp;</span></a><b>Climbing</b>: indicates that
                        streamed nodes returned by the construct are reached by navigating the parent,
                        ancestor[-or-self], attribute, and/or namespace axes from the node at the
                        current streaming position.<span class="definition">]</span> When the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is climbing, use of certain
                     axes such as <code>parent</code> and <code>ancestor</code> is permitted, but
                     use of other axes such as <code>child</code> or <code>descendant</code>
                     violates the streamability rules.</p>
                  </li>
                  <li>
                     <p><a id="dt-crawling" title="crawling"><span class="definition">[Definition:&nbsp;</span></a><b>Crawling</b>: typically
                        indicates that streamed nodes returned by a construct are reached by navigating the
                        descendant[-or-self] axis.<span class="definition">]</span> Nodes reached in this way are potentially nested (one might be an ancestor
                        of another), so further downward navigation is not permitted.
                        Expressions that can be statically determined to
                        return a singleton node (for example <code>head(.//title)</code>) generate a
                        result with no such nesting, so
                        they are striding rather than crawling.</p>
                  </li>
                  <li>
                     <p><a id="dt-striding" title="striding"><span class="definition">[Definition:&nbsp;</span></a><b>Striding</b>: indicates that
                        the result of a construct contains a sequence of streamed nodes, in document order, that
                        are peers in the sense that none of them is an ancestor or descendant of any
                        other.<span class="definition">]</span> This is typically achieved by using one or more steps
                     involving the child or attribute
                     axes only. Use of the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-outermost"><code>outermost</code></a> function can also result
                     in a striding posture, as can functions such as
                           <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-head"><code>head</code></a> or <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-zero-or-one"><code>zero-or-one</code></a> that
                        ensure the result will be a singleton node.</p>
                  </li>
                  <li>
                     <p><a id="dt-roaming" title="roaming"><span class="definition">[Definition:&nbsp;</span></a><b>Roaming</b>: indicates that
                        the nodes returned by an expression could be anywhere in the tree, which
                        inevitably means that the construct cannot be evaluated using
                        streaming.<span class="definition">]</span> For example, the <a title="posture" class="termref" href="#dt-posture">posture</a> of an axis
                     step using the <code>following</code> or <code>preceding</code> axis will
                     typically be <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, which leads the analysis to conclude
                     that the construct is not streamable.</p>
                  </li>
               </ul>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>One way to think about the posture values is as labels for states in a finite
                  state automaton, where the alphabet of symbols accepted by the automaton is the
                  set of 13 XPath axes, and the sentence being parsed is a path expression
                  containing a sequence of axis steps. For example, use of the
                     <code>descendant</code> axis when the current state is <b>striding</b>
                  moves the new state to <b>crawling</b>, and use of the <code>parent</code>
                  axis then takes it to <b>climbing</b>. </p>
               </div>
               <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of a construct is determined in one of several
               ways:</p>
               <ul>
                  <li>
                     <p>For axis steps, the posture of the expression is determined by the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> and the
                     choice of axis. For example, an axis step using the ancestor axis always has a
                     posture of <a title="climbing" class="termref" href="#dt-climbing">climbing</a>, while an axis step using the child
                     axis, if the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a>, will itself have a posture of
                        <a title="striding" class="termref" href="#dt-striding">striding</a>. The rules for the posture transitions produced
                     by axis steps are given in <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a>.</p>
                  </li>
                  <li>
                     <p>For many other constructs, the posture is determined by the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. These determine the result posture
                     in terms of the <a title="operand" class="termref" href="#dt-operand">operands</a> of the construct
                     and the way in which each operand is used. For example, a construct that
                     accepts a streamed node as the value of an operand, and atomizes that node,
                     will generally have a posture of <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                  </li>
                  <li>
                     <p>Other constructs have their own special rules, which are listed in 
                     <a href="#streamability-of-constructs"><b>12 Streamability of Specific Constructs</b></a>. For example, a call 
                    on the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-root"><code>root</code></a> function
                     behaves analogously to an axis step, and is described in 
                    <a href="#streamability-fn-root"><b>12.8.21 Streamability of the root Function</b></a>. Special rules are needed for:</p>
                     <ul>
                        <li>
                           <p>Constructs that evaluate an <a title="operand" class="termref" href="#dt-operand">operand</a> more than once,
                           such as an XPath <code>for</code> expression;</p>
                        </li>
                        <li>
                           <p>Constructs that have alternatives among their operands, such as an XPath
                              <code>if</code> expression;</p>
                        </li>
                        <li>
                           <p>Constructs that navigate relative to the context item, such as axis
                           steps;</p>
                        </li>
                        <li>
                           <p>Constructs with implicit inputs, such as the context item expression
                              <code>.</code> (dot);</p>
                        </li>
                        <li>
                           <p>Constructs that change the focus, such as a filter expression;</p>
                        </li>
                        <li>
                           <p>Constructs that invoke functions or templates.</p>
                        </li>
                     </ul>
                  </li>
               </ul>
               <p>The characterization of an expression as striding, crawling, climbing, or
               roaming applies only to the streamed nodes in the result of the expression. The result of the expression
               may also contain non-streamed (grounded) nodes or atomic items. For example
               if <code>/x/y</code> is a striding expression, then <code>(/x/y | $doc//x)</code> is also striding, given
               that <code>$doc</code> contains non-streamed nodes. The assertion that the nodes in the result of a striding
               expression are in document order and are peers thus applies only to the subset of the nodes that are streamed.</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>A consequence of this is that when striding expressions are used in a context that requires sorting into
                  document order, for example <code>(/x/y | $doc//x) / @price</code>, the fact that the expression is striding
               does not eliminate the need for the sequence to be re-ordered. However, there will never be a need for the relative
               order of the streamed nodes in the value to change.</p>
                  <p>Since the data model leaves the relative order of nodes in different trees implementation-defined, and since streamed
                  and unstreamed nodes will necessarily be in different trees, a useful
               implementation strategy might be to arrange that streamed nodes always precede unstreamed nodes in document order (or vice
               versa). An operation that needs to process the result of a striding expression in document order can then first deliver
               all the streamed nodes (by consuming the input stream) in the order they arrive, and then deliver the unstreamed nodes, 
               suitably sorted.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="id-choice-operand-groups"></a>3.8.1 <a href="#id-choice-operand-groups" style="text-decoration: none">Choice Operand Groups</a></h4>
                  <p><a id="dt-choice-operand-group" title="choice operand group"><span class="definition">[Definition:&nbsp;</span></a>For some construct
               kinds, one or more operand roles may be defined to form a <b>choice operand
                  group</b>. This concept is used where it is known that <a title="operand" class="termref" href="#dt-operand">operands</a> are mutually exclusive (for example the
                  <code>then</code> and <code>else</code> clauses in a conditional
               expression).<span class="definition">]</span></p>
                  <p><a id="dt-combined-posture" title="combined posture"><span class="definition">[Definition:&nbsp;</span></a>The
                  <b>combined posture</b> of a <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a> is
               determined by the <a title="posture" class="termref" href="#dt-posture">postures</a> of the <a title="operand" class="termref" href="#dt-operand">operands</a> in the group (the <b>operand postures</b>), and is the first of
               the following that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If any of the operand postures is
                     <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, then the combined posture is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>.</p>
                     </li>
                     <li>
                        <p>If all of the operand postures are
                     <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the combined posture is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                     </li>
                     <li>
                        <p>If one or more of the operand postures
                  is <a title="climbing" class="termref" href="#dt-climbing">climbing</a> and the remainder (if any) are <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the combined posture is <a title="climbing" class="termref" href="#dt-climbing">climbing</a>.</p>
                     </li>
                     <li>
                        <p>If one or more of the operand postures
                  is <a title="striding" class="termref" href="#dt-striding">striding</a> and the remainder (if any) are <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the combined posture is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                     </li>
                     <li>
                        <p>If one or more of the operand postures
                  is <a title="crawling" class="termref" href="#dt-crawling">crawling</a> and each of the
                     remainder (if any) is either <a title="striding" class="termref" href="#dt-striding">striding</a> or <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the combined posture is <a title="crawling" class="termref" href="#dt-crawling">crawling</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise (for example, if the group includes both an operand with <a title="climbing" class="termref" href="#dt-climbing">climbing</a> posture and one with <a title="crawling" class="termref" href="#dt-crawling">crawling</a> posture),
                  the combined posture is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>. </p>
                     </li>
                  </ol>
                  <p>]</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="determining-context-posture"></a>3.8.2 <a href="#determining-context-posture" style="text-decoration: none">Determining the Context Posture</a></h4>
                  <p>In the same way as the type of the context item can be determined for any construct C
               by reference to the type of the construct that establishes the context for the
               evaluation of C, so the posture of the context item C can be determined by reference
               to the posture of the construct that establishes the context.</p>
                  <p>The <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of a construct <var>C</var> is the first of
               the following that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var> is an
                        <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a> declaration, an inline function declaration,
                     or an <a href="../../xslt-40/Overview.html#xsl:on-completion">xsl:on-completion</a> element, then the context posture is
                        <a title="roaming" class="termref" href="#dt-roaming">roaming</a>.</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>This is essentially an error case; expressions that depend on the context
                        item should not normally appear within these constructs.</p>
                        </div>
                     </li>
                     <li>
                        <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var> is an
                        <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction, then the context posture is
                     <a title="striding" class="termref" href="#dt-striding">striding</a> if the
                     instruction is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>, or <a title="grounded" class="termref" href="#dt-grounded">grounded</a> otherwise.</p>
                     </li>
                     <li>
                        <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var> is a
                        <a href="https://qt4cg.org/specifications/xslt-40/#dt-template-rule">template rule</a><sup><small>XT</small></sup> whose mode is declared with
                        <code>streamable="yes"</code>, then the context posture is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                     </li>
                     <li>
                        <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var> is a
                        <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup>, then the context posture is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                     </li>
                     <li>
                        <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var> is an
                        <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a> declaration with the attribute
                        <code>streamable="yes"</code>, then the context posture is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                     </li>
                     <li>
                        <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> is any other <a href="https://qt4cg.org/specifications/xslt-40/#dt-declaration">declaration</a><sup><small>XT</small></sup>, for example a global variable declaration, a
                        <a href="https://qt4cg.org/specifications/xslt-40/#dt-named-template">named template</a><sup><small>XT</small></sup>, or a template rule or attribute set that
                     does not specify <code>streamable="yes"</code>, then the context posture is
                        <a title="roaming" class="termref" href="#dt-roaming">roaming</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the context posture is the <a title="posture" class="termref" href="#dt-posture">posture</a> of the
                        <a title="controlling operand" class="termref" href="#dt-controlling-operand">controlling operand</a> of the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of <var>C</var>.</p>
                     </li>
                  </ol>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="sweep"></a>3.9 <a href="#sweep" style="text-decoration: none">Sweep</a></h3>
               <p><a id="dt-sweep" title="sweep"><span class="definition">[Definition:&nbsp;</span></a>Every construct has a <b>sweep</b>, which
                  is a measure of the extent to which the current position in the input stream moves
                  during the evaluation of the expression. The sweep is one of: <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, or <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>
                  .<span class="definition">]</span> This list of
               values is ordered: a <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> expression has <b>wider
                  sweep</b> than a <a title="consuming" class="termref" href="#dt-consuming">consuming</a> expression, which has
                  <b>wider sweep</b> than a <a title="motionless" class="termref" href="#dt-motionless">motionless</a> expression. </p>
               <p><a id="dt-motionless" title="motionless"><span class="definition">[Definition:&nbsp;</span></a>A <b>motionless</b> <a title="construct" class="termref" href="#dt-construct">construct</a> is
                  any construct deemed motionless by the rules for that construct
                     (typically given in <a href="#streamability-of-constructs"><b>12 Streamability of Specific Constructs</b></a>).<span class="definition">]</span> 
              Informally, a motionless construct
               is one that can be evaluated without changing the current position in the input
               stream.</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>The context item expression <code>.</code> is classified as motionless; however a
                  construct that uses <code>.</code> as an <a title="operand" class="termref" href="#dt-operand">operand</a> (for example,
                     <code>string(.)</code>) might be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. The
                  streamability rules effectively consider expressions such as <code>.</code> within
                  the context of the containing construct.</p>
               </div>
               <p><a id="dt-consuming" title="consuming"><span class="definition">[Definition:&nbsp;</span></a>A <b>consuming</b> construct is any
                     <a title="construct" class="termref" href="#dt-construct">construct</a> deemed consuming by the rules for that construct
                     (typically given in <a href="#streamability-of-constructs"><b>12 Streamability of Specific Constructs</b></a>).<span class="definition">]</span> 
              Informally, a consuming construct
               is one whose evaluation requires repositioning of the input stream from the start of
               the current node to the end of the current node.</p>
               <p><a id="dt-free-ranging" title="free-ranging"><span class="definition">[Definition:&nbsp;</span></a>A <b>free-ranging</b>
                  construct is any <a title="construct" class="termref" href="#dt-construct">construct</a> deemed free-ranging by the rules for
                  that construct (typically given in <a href="#streamability-of-constructs"><b>12 Streamability of Specific Constructs</b></a>).<span class="definition">]</span> 
               Informally, a
               free-ranging construct is one whose evaluation may require access to information that
               is not available from the subtree rooted at the current node, together with
               information about ancestors of the current node and their attributes.</p>
               <p>The table below shows some examples of expressions having
               different combinations of <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>.</p>
               <table class="data">
                  <caption>Combinations of Sweep and Posture</caption>
                  <thead>
                     <tr>
                        <th></th>
                        <th>Motionless</th>
                        <th>Consuming</th>
                        <th>Free-Ranging</th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr>
                        <th>Grounded</th>
                        <td><code>name()</code></td>
                        <td><code>string(title)</code></td>
                        <td>See Note</td>
                     </tr>
                     <tr>
                        <th>Climbing</th>
                        <td><code>parent::*</code></td>
                        <td><code>child::x/ancestor::y</code></td>
                        <td>See Note</td>
                     </tr>
                     <tr>
                        <th>Striding</th>
                        <td><code>@status</code></td>
                        <td><code>child::*</code></td>
                        <td>See Note</td>
                     </tr>
                     <tr>
                        <th>Crawling</th>
                        <td>The subexpression <code>.</code> in <code>//a/.</code></td>
                        <td><code>descendant::*</code></td>
                        <td><code>//x[child::y]</code></td>
                     </tr>
                     <tr>
                        <th>Roaming</th>
                        <td>See Note</td>
                        <td>See Note</td>
                        <td><code>preceding::*</code></td>
                     </tr>
                  </tbody>
               </table>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>In all cases where either the <a title="posture" class="termref" href="#dt-posture">posture</a> is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, or the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, or both, the effect is to make an expression
                  non-streamable. For convenience, therefore, evaluation of the streamability rules
                  in most cases returns the values <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> only in combination with each other. In cases where the
                  rules return a <a title="posture" class="termref" href="#dt-posture">posture</a> of <a title="roaming" class="termref" href="#dt-roaming">roaming</a> combined
                  with some other <a title="sweep" class="termref" href="#dt-sweep">sweep</a>, or a <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                     <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> with some other <a title="posture" class="termref" href="#dt-posture">posture</a>,
                  the final result of the analysis is always the same as if the expression were both
                     <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                  <p>For an example of a case where an expression is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> but
                  not <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, consider the right-hand operand of the
                  relative path expression <code>(preceding::x/.)</code>. The rules for the
                  streamability of a context item expression (see <a href="#streamability-of-context-item-expression"><b>12.7.13 Streamability of the Context Item Expression</b></a>) give <code>.</code> in this
                  context a <a title="roaming" class="termref" href="#dt-roaming">roaming</a> posture, combined with <a title="motionless" class="termref" href="#dt-motionless">motionless</a> sweep. But the relative path expression as a whole is
                     <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> (see <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a>), so the apparent inconsistency is
                  transient.</p>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="general-streamability-rules"></a>3.10 <a href="#general-streamability-rules" style="text-decoration: none">General Streamability Rules</a></h3>
               <p><a id="dt-general-streamability-rules" title="general streamability rules"><span class="definition">[Definition:&nbsp;</span></a>Many <a title="construct" class="termref" href="#dt-construct">constructs</a> share the same
                     streamability rules. These rules, referred to as the <b>general
                        streamability rules</b>, are defined here.<span class="definition">]</span></p>
               <p>Examples of constructs that use these rules are: an arithmetic expression, an
                     <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-value-template">attribute value template</a><sup><small>XT</small></sup>, 
                 a <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, 
                  the <a href="../../xslt-40/Overview.html#xsl:text">xsl:text</a> and <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instructions,
                  and a call to the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-doc"><code>doc</code></a> function.</p>
               <p>The rules determine both the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a construct. To determine the posture and
                  sweep of a construct <var>C</var>, assuming these general rules are applicable to
                  that kind of construct:</p>
               <ol class="enumar">
                  <li>
                     <p>For each <a title="operand" class="termref" href="#dt-operand">operand</a> of <var>C</var>:</p>
                     <ol class="enumla">
                        <li>
                           <p>Establish:</p>
                           <ol class="enumlr">
                              <li>
                                 <p>The <a title="static type" class="termref" href="#dt-static-type">static type</a>
                                    <var>T</var> of the operand (see <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>). </p>
                                 <div class="note">
                                    <p class="prefix"><b>Note:</b></p>
                                    <p>The static type is a <a title="U-type" class="termref" href="#dt-utype">U-type</a>. For example,
                                       the static type of the expression <code>(@*, *)</code> is
                                          <var>U{element(), attribute()}</var>.</p>
                                 </div>
                              </li>
                              <li>
                                 <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                                    <var>S</var> and <a title="posture" class="termref" href="#dt-posture">posture</a>
                                    <var>P</var> of the operand (by applying the rules appropriate to that operand).</p>
                              </li>
                              <li>
                                 <p>The <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                                    <var>U</var> corresponding to the <a title="operand role" class="termref" href="#dt-operand-role">role</a> 
                                   of the operand within <var>C</var>.</p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>Compute the adjusted sweep <var>S′</var> of the <a title="operand" class="termref" href="#dt-operand">operand</a> by taking the first of the following that
                              applies:</p>
                           <ol class="enumlr">
                              <li>
                                 <p>If <var>S</var> is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> or
                                       <var>P</var> is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, then
                                       <var>S′</var> is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>. (In this
                                    case the posture and sweep of <var>C</var> are <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>,
                                    regardless of any other operands.)</p>
                              </li>
                              <li>
                                 <p>If <var>P</var> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then
                                       <var>S′</var> is <var>S</var>.</p>
                              </li>
                              <li>
                                 <p>Otherwise (<var>P</var> is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                                    which implies that the <a title="operand" class="termref" href="#dt-operand">operand</a> is capable of returning streamed
                                    nodes), compute <var>S′</var> as follows:</p>
                                 <ol class="enumua">
                                    <li>
                                       <p>Compute the adjusted usage <var>U′</var> as follows:</p>
                                       <ol class="enumur">
                                          <li>
                                             <p>If <var>U</var> is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>
                                                  and the
                                                  intersection of <var>T</var> with
                                                  <var>U{element(), document-node()}</var> is
                                                  <var>U{}</var> (that is, if <var>T</var> is a type
                                                  that does not allow nodes with children),
                                                  then <var>U′</var> is <a title="inspection" class="termref" href="#dt-inspection">inspection</a>.</p>
                                             <div class="note">
                                                <p class="prefix"><b>Note:</b></p>
                                                <p>This is because the entire subtree of nodes
                                                  such as text nodes is available without reading
                                                  further data from the input stream.</p>
                                             </div>
                                          </li>
                                          <li>
                                             <p>Otherwise, <var>U′</var> is <var>U</var>.</p>
                                          </li>
                                       </ol>
                                    </li>
                                    <li>
                                       <p>Compute the adjusted <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                                          <var>S′</var> from the table below:</p>
                                       <table class="data">
                                          <caption>Computing the Adjusted Sweep of an Expression</caption>
                                          <thead>
                                             <tr>
                                                <th rowspan="2">Posture (P)</th>
                                                <th colspan="4">Adjusted Usage (U')</th>
                                             </tr>
                                             <tr>
                                                <th>Absorption</th>
                                                <th>Inspection</th>
                                                <th>Transmission</th>
                                                <th>Navigation</th>
                                             </tr>
                                          </thead>
                                          <tbody>
                                             <tr>
                                                <th>Climbing</th>
                                                <td>Free-ranging</td>
                                                <td><var>S</var></td>
                                                <td><var>S</var></td>
                                                <td>Free-ranging</td>
                                             </tr>
                                             <tr>
                                                <th>Striding</th>
                                                <td>Consuming</td>
                                                <td><var>S</var></td>
                                                <td><var>S</var></td>
                                                <td>Free-ranging</td>
                                             </tr>
                                             <tr>
                                                <th>Crawling</th>
                                                <td>Consuming</td>
                                                <td><var>S</var></td>
                                                <td><var>S</var></td>
                                                <td>Free-ranging</td>
                                             </tr>
                                          </tbody>
                                       </table>
                                    </li>
                                 </ol>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p><a id="dt-potentially-consuming" title="potentially consuming"><span class="definition">[Definition:&nbsp;</span></a>An
                                    <a title="operand" class="termref" href="#dt-operand">operand</a> is <b>potentially
                                    consuming</b> if at least one of the following conditions
                                 applies:</p>
                           <ol class="enumlr">
                              <li>
                                 <p>The operand’s adjusted <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                                    <var>S′</var> is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                              </li>
                              <li>
                                 <p>The <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is <a title="transmission" class="termref" href="#dt-transmission">transmission</a> and the operand is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                              </li>
                           </ol>
                           <p>]</p>
                        </li>
                     </ol>
                  </li>
                  <li>
                     <p>Having computed the adjusted sweep <var>S′(o)</var> of each <a title="operand" class="termref" href="#dt-operand">operand</a>
                        <var>o</var>, the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <var>C</var> are the first of the following that
                        applies:</p>
                     <ol class="enumla">
                        <li>
                           <p>If <var>C</var> has no operands, then <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and
                                 <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </li>
                        <li>
                           <p>If any operand <var>o</var> has an adjusted sweep <var>S′(o)</var> of
                                 <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a>
                              and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                        </li>
                        <li>
                           <p>If more than one operand is <a title="potentially consuming" class="termref" href="#dt-potentially-consuming">potentially consuming</a>, then:</p>
                           <ol class="enumlr">
                              <li>
                                 <p>If all these operands form part of a <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a>, then the <a title="posture" class="termref" href="#dt-posture">posture</a> of <var>C</var> is the <a title="combined posture" class="termref" href="#dt-combined-posture">combined posture</a> of the operands in this group,
                                    and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <var>C</var> is the widest
                                       <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the operands in this group</p>
                              </li>
                              <li>
                                 <p>If all these operands have <var>S′</var> = <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, (which necessarily means they have
                                       <var>U′</var> = <var>U</var> = <a title="transmission" class="termref" href="#dt-transmission">transmission</a>) and if they all have the same <a title="posture" class="termref" href="#dt-posture">posture</a>
                                    <var>P<sub>0</sub></var>, then <a title="motionless" class="termref" href="#dt-motionless">motionless</a> with <a title="posture" class="termref" href="#dt-posture">posture</a>
                                    <var>P<sub>0</sub></var>.</p>
                                 <div class="note">
                                    <p class="prefix"><b>Note:</b></p>
                                    <p>For example, the expression <code>(@a, @b)</code> is
                                       motionless and striding.</p>
                                 </div>
                              </li>
                              <li>
                                 <p>Otherwise, <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>If exactly one operand <var>o</var>
                              is <a title="potentially consuming" class="termref" href="#dt-potentially-consuming">potentially consuming</a>, then:</p>
                           <ol class="enumlr">
                              <li>
                                 <p>If <var>o</var> is a <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> of
                                       <var>C</var>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                              </li>
                              <li>
                                 <p>If the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of <var>o</var> is
                                       <a title="absorption" class="termref" href="#dt-absorption">absorption</a> or <a title="inspection" class="termref" href="#dt-inspection">inspection</a>, then <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and
                                       <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                              </li>
                              <li>
                                 <p>If the <a title="posture" class="termref" href="#dt-posture">posture</a> of <var>o</var> is <a title="crawling" class="termref" href="#dt-crawling">crawling</a> and <var>C</var> is a function call of a
                                       built-in function
                                    whose signature indicates a return type with a maximum
                                    cardinality of one then <a title="striding" class="termref" href="#dt-striding">striding</a> and the
                                    adjusted <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <var>o</var>.</p>
                                 <div class="note">
                                    <p class="prefix"><b>Note:</b></p>
                                    <p>Although this rule is written in
                                       general terms, the only functions that it applies to (at the
                                       time of publication) are <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-head"><code>head</code></a>,
                                          <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-exactly-one"><code>exactly-one</code></a>, and
                                          <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-zero-or-one"><code>zero-or-one</code></a>. This rule only
                                       applies if the argument usage is transmission (other cases
                                       having been handled by earlier rules); of the built-in
                                       functions, the three functions listed are the only ones
                                       having an argument with usage transmission and a return type
                                       with maximum cardinality one.</p>
                                 </div>
                              </li>
                              <li>
                                 <p>Otherwise (the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of <var>o</var>
                                    is <a title="transmission" class="termref" href="#dt-transmission">transmission</a>), the <a title="posture" class="termref" href="#dt-posture">posture</a> and adjusted <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                                       <var>o</var>.</p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>Otherwise (all operands are <a title="motionless" class="termref" href="#dt-motionless">motionless</a>) <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </li>
                     </ol>
                  </li>
               </ol>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>The rules ensure that if more than one <a title="operand" class="termref" href="#dt-operand">operand</a> is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, that is, if more than one operand reads the subtree of
                     the context node in a way that would cause the current position of the input
                     stream to change, then the construct is not streamable.</p>
                  <p>The rules also prevent multiple streamed nodes being returned in the result of
                     an expression if they are delivered by
                        different operands. For example, the expression <code>count((..,
                        *))</code> is not guaranteed streamable. This is to make static analysis
                     possible: the posture needs to be statically determined to ensure that
                     streaming does not fail at execution time. It is permitted, however, for
                     streamed nodes to be mixed in a sequence with non-streamed nodes or with atomic
                     items; in this case the posture of the result will be that of the streamed
                     nodes. It is also permitted to have multiple
                        operands delivering streamed nodes in different branches of a conditional,
                        provided the sweep and posture are compatible: for example <code>if (X) then
                           @name else name</code> is guaranteed streamable.</p>
                  <p>Expressions that have more than one operand
                  with usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, for example <code>(A, B)</code>,
                  or <code>(A | B)</code>, or <code>insert-before(A, n, B)</code>, generally allow only one of these operands to select
                  streamed nodes. The result of the expression will contain
                  a mixture of streamed and grounded nodes, but its posture and sweep will be
                  that of the streamed operand. The nodes in the result will not necessarily be in document order,
                  but the subset of the nodes that are streamed will always be in document order.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="general-streamability-examples"></a>3.10.1 <a href="#general-streamability-examples" style="text-decoration: none">Examples of the General Streamability Rules</a></h4>
                  <p>This section provides some examples of how the general streamability rules
                  operate. In each example, the emphasis is on the outermost construct shown;
                  explanations for how the sweep and posture of its operands are derived are not
                  given, though in many cases they are explained in earlier examples.</p>
                  <p>The examples assume that the context item type for evaluation of the expression
                  shown is an element node, and that its posture is striding.</p>
                  <ul>
                     <li>
                        <p><code>2 + 2</code> is grounded and motionless, because both the operands are
                        grounded and motionless.</p>
                     </li>
                     <li>
                        <p><code>price * 2</code> is grounded and consuming, because one of the
                        operands is consuming and the relevant operand usage is absorption.</p>
                     </li>
                     <li>
                        <p><code>price - discount</code> is roaming and free-ranging, because both the
                        operands are consuming (and they are not members of a parallel operand
                        group).</p>
                     </li>
                     <li>
                        <p><code>price * @discount</code> is grounded and consuming. The left-hand operand is consuming and
                        the corresponding operand usage is absorption, while the right-hand operand is motionless, again with an
                        operand usage of absorption, and its item type is <code>attribute()</code>
                        which changes the effective usage to inspection.</p>
                     </li>
                     <li>
                        <p><code>a/b/c</code> is striding and consuming. This is determined not by the
                        general streamability rules, but by the rules for path expressions in
                           <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a>.</p>
                     </li>
                     <li>
                        <p><code>a//c</code> is crawling and consuming. This is similarly determined by
                        the rules for path expressions in <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a>.</p>
                     </li>
                     <li>
                        <p><code>count(a/b/c)</code> is grounded and consuming, because the operand
                        (the argument to the count function) is striding and consuming (see earlier
                        example) and the operand usage is inspection.</p>
                     </li>
                     <li>
                        <p><code>sum(a/b/c)</code> is grounded and consuming, because the operand (the
                        argument to the <code>sum</code>
                        function) is striding and consuming (see earlier example) and the operand
                        usage is absorption.</p>
                     </li>
                     <li>
                        <p><code>count(descendant::c)</code> is grounded and
                        consuming, because the operand (the argument to the <code>count</code>
                        function) is crawling and consuming (see earlier example) and the operand
                        usage is inspection.</p>
                     </li>
                     <li>
                        <p><code>tail(descendant::c)</code> is crawling and
                        consuming. The operand is crawling, the operand usage is transmission, so
                        the posture and sweep of the result are the same as the posture and sweep of
                        the consuming operand.</p>
                     </li>
                     <li>
                        <p><code>unordered(a|b)</code> is crawling and
                        consuming. The operand (the argument to the <code>unordered</code> function)
                        is crawling (see <a href="#streamability-of-union-expressions"><b>12.7.4 Streamability of union, intersect, and
                        except Expressions</b></a>), and
                        the operand usage is transmission, so the posture and sweep of the result
                        are the same as the posture and sweep of the consuming operand.</p>
                     </li>
                     <li>
                        <p><code>zero-or-one(descendant::c)</code> is
                        striding and consuming. Although the operand is crawling, the operand usage
                        is transmission and the cardinality of the expression is zero or one, so the
                        posture of the result is striding. The same analysis applies to
                           <code>exactly-one(descendant::c)</code> and to
                           <code>head(descendant::c)</code>.</p>
                     </li>
                     <li>
                        <p><code>sum(descendant::c)</code> is grounded and
                        consuming, because the operand (the argument to the <code>sum</code>
                        function) is crawling and consuming (see earlier example) and the operand
                        usage is absorption. In theory (although it is unlikely in practice) the
                        selected <code>c</code> elements might be
                           nested one inside another. The processor is expected to handle
                        this situation, which may require some buffering. For example, given the
                        untyped source document
                           <code>&lt;a&gt;&lt;c&gt;&lt;c&gt;1&lt;/c&gt;&lt;c&gt;2&lt;/c&gt;&lt;c&gt;3&lt;/c&gt;&lt;/c&gt;&lt;/a&gt;</code>, the
                        result of the expression is <code>129</code> (123 + 1 + 2 + 3), and to
                        evaluate this, a streaming processor will typically maintain a stack of
                        buffers to accumulate the typed values of each of the four <code>c</code>
                        elements during a single pass of the source document. </p>
                     </li>
                     <li>
                        <p><code>"Q{" || namespace-uri(.) || "}" || local-name(.)</code> is grounded
                        and motionless. The two literal operands are grounded and motionless because
                        they have no operands; the two function calls are grounded and motionless
                        because they have a single operand that is striding and motionless, with an
                        operand usage of inspection.</p>
                     </li>
                     <li>
                        <p><code>copy-of(.)/head/following-sibling::*</code> is grounded and consuming.
                        The left-hand operand
                           <code>copy-of(.)/head</code> is grounded and consuming because, under the
                        rules in <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a>, its left-hand operand
                           <code>copy-of(.)</code> is grounded and consuming. This in turn is
                        because <code>.</code> is striding and motionless, and the operand usage is
                        absorption.</p>
                     </li>
                     <li>
                        <p><code>if ($discounted) then price else discounted-price</code> is striding
                        and consuming, because the two branches of the conditional are both striding
                        and consuming, and they form a <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a> with
                        usage transmission.</p>
                     </li>
                     <li>
                        <p><code>if ($gratis) then 0 else price</code> is striding and consuming
                        because there is only one consuming operand (the fact that it is part of a
                           <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a> does not affect the
                        reasoning).</p>
                     </li>
                     <li>
                        <p><code>count((author, editor))</code> is roaming and free-ranging. The first
                        argument to the <code>count</code> function is an expression with two
                        operands, both having usage=transmission, and neither being grounded.</p>
                     </li>
                     <li>
                        <p><code>count((author | editor))</code> is grounded and consuming. A union
                        expression is not subject to the general streamability rules; it has its own
                        rules, defined in <a href="#streamability-of-union-expressions"><b>12.7.4 Streamability of union, intersect, and
                        except Expressions</b></a>, which
                        establish in this case that the argument to the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-count"><code>count</code></a>
                        is <a title="crawling" class="termref" href="#dt-crawling">crawling</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. The
                           <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-count"><code>count</code></a> function does follow the general
                        streamability rules, with an operand usage of <a title="inspection" class="termref" href="#dt-inspection">inspection</a>: under rule 1(b)(iii)(B) the adjusted sweep is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, and rule 2(d)(iii) then applies.</p>
                     </li>
                     <li>
                        <p><code>('{', author, '}')</code> is striding and consuming. Exactly one
                        operand is consuming; it has usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, so the
                        result has the posture and sweep of that operand. (The formal analysis
                        treats comma as a binary operator, but the same result can be obtained by
                        treating the content of the parenthesized expression as an expression with
                        three operands.)</p>
                     </li>
                  </ul>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="streaming-source-documents"></a>4 <a href="#streaming-source-documents" style="text-decoration: none">Streaming Source Documents</a></h2>
            <p>The <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction reads a source document whose URI is
               supplied, and processes the content of the document  by evaluating the
               contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>. 
               The <code>streamable</code> attribute (default <code>"no"</code>)
            allows streamed processing to be requested.</p>
            <p>For example, if a document represents a book holding a sequence of chapters, then the
               following code can be used to split the book into multiple XML files, one per
               chapter, without allocating memory to hold the entire book in memory at one time:</p>
            <div class="exampleInner">
               <pre>&lt;xsl:source-document streamable="yes" href="book.xml"&gt;
  &lt;xsl:for-each select="book"&gt;             
    &lt;xsl:for-each select="chapter"&gt;
      &lt;xsl:result-document href="chapter{position()}.xml"&gt;
        &lt;xsl:copy-of select="."/&gt;
      &lt;/xsl:result-document&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:for-each&gt;  
&lt;/xsl:source-document&gt;</pre>
            </div>
            <p>The <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-stream-available"><code>stream-available</code></a> function can be used to determine whether a
    particular document is available for streamed processing: see <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#func-stream-available">18.2 fn:stream-available</a>.</p>
            <div class="div2">
               
               <h3><a id="source-document-streamability"></a>4.1 <a href="#source-document-streamability" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a></a></h3>
               <p>The <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction is 
                   <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> if both the following conditions are satisfied:</p>
               <ol class="enumar">
                  <li>
                     <p>The instruction is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>, by specifying
               <code>streamable="yes"</code>.</p>
                  </li>
                  <li>
                     <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> is 
                 <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, as assessed using
               the streamability analysis in <a href="#streamability"><b>3 Streamability Analysis Principles</b></a>. The consequences of
               being or not being guaranteed streamable depend on the processor conformance level,
               and are explained in <a href="#streamability-guarantees"><b>3.1 Streamability Guarantees</b></a>.</p>
                  </li>
               </ol>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>The rules for <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed streamability</a>
                  ensure that the sequence constructor (and therefore the
                     <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction) cannot return any nodes from a
                     <a title="streamed document" class="termref" href="#dt-streamed-document">streamed document</a>. For example,
                  it cannot contain the instruction <code>&lt;xsl:sequence
                     select="//chapter"/&gt;</code>. If nodes from this document are to be returned,
                  they must first be copied, for example by using the
                        <a href="../../xslt-40/Overview.html#xsl:copy-of">xsl:copy-of</a> instruction or by calling the
                     <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a> or <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-snapshot"><code>snapshot</code></a> functions.</p>
                  <p>Because the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction cannot (if it satisfies the rules for guaranteed
                     streamability) return nodes from the streamed document, any nodes it
                  does return will be conventional (unstreamed) nodes that can be processed without
                  restriction. For example, if <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> is invoked within a
                     <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet function</a><sup><small>XT</small></sup>
                  <code>f:firstChapter</code>, and the sequence constructor consists of the
                  instruction <code>&lt;xsl:copy-of select="//chapter"/&gt;</code>, then the calling
                  code can manipulate the resulting <code>chapter</code> elements as ordinary trees
                  rooted at parentless element nodes.</p>
                  <p>If the sequence constructor in an
                     <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction were to return nodes from the document
                  for which streaming has been requested, the instruction would not be guaranteed
                  streamable. Processors that support the streaming feature would then not be
                  required to process it in a streaming manner, and this specification imposes no
                  restrictions on the processing of the nodes returned. (The ability of a streaming
                  processor to handle such stylesheets in a streaming manner might, of course,
                  depend on how the nodes returned are processed, but those details are out of scope
                  for this specification.) </p>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="stream-examples"></a>4.2 <a href="#stream-examples" style="text-decoration: none">Examples of <code>xsl:source-document</code></a></h3>
               <p>The <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction can be used to initiate processing of
                  a document using streaming with a variety of coding styles, illustrated in the
                  examples below.</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e5411"></a>Example: Using <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> with Aggregate Functions</div>
                  <p>The following example computes the number of transactions in a transaction
                     file</p>
                  <p>Input:</p>
                  <div class="exampleInner">
                     <pre>
&lt;transactions&gt;
  &lt;transaction value="12.51"/&gt;
  &lt;transaction value="3.99"/&gt;
&lt;/transactions&gt;</pre>
                  </div>
                  <p>Stylesheet code:</p>
                  <div class="exampleInner">
                     <pre>&lt;xsl:source-document streamable="yes" href="transactions.xml"&gt;
  &lt;count&gt;
    &lt;xsl:value-of select="count(transactions/transaction)"/&gt;
  &lt;/count&gt;
&lt;/xsl:source-document&gt;</pre>
                  </div>
                  <p>Result:</p>
                  <div class="exampleInner">
                     <pre>&lt;count&gt;2&lt;/count&gt;</pre>
                  </div>
                  <p>Analysis:</p>
                  <ol class="enumar">
                     <li>
                        <p>The literal result element <code>count</code> has the same sweep as the
                              <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instruction.</p>
                     </li>
                     <li>
                        <p>The <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instruction has the same sweep as its
                              <code>select</code> expression.</p>
                     </li>
                     <li>
                        <p>The call to <code>count</code> has the same sweep as its argument.</p>
                     </li>
                     <li>
                        <p>The argument to <code>count</code> is a <code>RelativePathExpr</code>.
                           Under the rules in <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a>,
                           this expression is <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. The
                              call on <code>count</code> is therefore <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.
                        </p>
                     </li>
                     <li>
                        <p>The entire body of the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction is therefore
                        <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                     </li>
                  </ol>
                  <p>The following example computes the highest-value transaction in the same input
                     file:</p>
                  <div class="exampleInner">
                     <pre>&lt;xsl:source-document streamable="yes" href="transactions.xml"&gt;
  &lt;maxValue&gt;
    &lt;xsl:value-of select="max(transactions/transaction/@value)"/&gt;
  &lt;/maxValue&gt;
&lt;/xsl:source-document&gt;</pre>
                  </div>
                  <p>Result:</p>
                  <div class="exampleInner">
                     <pre>&lt;maxValue&gt;12.51&lt;/maxValue&gt;</pre>
                  </div>
                  <p>Analysis:</p>
                  <ol class="enumar">
                     <li>
                        <p>The literal result element <code>maxValue</code> has the same sweep as
                           the <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instruction.</p>
                     </li>
                     <li>
                        <p>The <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instruction has the same sweep as its
                              <code>select</code> expression.</p>
                     </li>
                     <li>
                        <p>The call to <code>max</code> has the same sweep as its argument.</p>
                     </li>
                     <li>
                        <p>The argument to <code>max</code> is a <code>RelativePathExpr</code> whose
                           two operands are the <code>RelativePathExpr</code>
                           <code>transactions/transaction</code> and the <code>AxisStep</code>
                           <code>@value</code>. The left-hand operand <code>transactions/transaction</code> has
                              <a title="striding" class="termref" href="#dt-striding">striding</a>
                              <a title="posture" class="termref" href="#dt-posture">posture</a>. The right-hand operand <code>@value</code>, given
                           that <span>the context posture is striding</span>, is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>. The <code>RelativePathExpr</code> argument to <code>max</code> is
                           therefore consuming. </p>
                     </li>
                     <li>
                        <p>The entire body of the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction is
                           therefore <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                     </li>
                  </ol>
                  <p>To compute both the count and the maximum value in a single pass over the
                     input, several approaches are possible. The simplest is to use maps (map constructors
                     are exempt from the usual rule that multiple downward selections are not allowed):</p>
                  <div class="exampleInner">
                     <pre>&lt;xsl:source-document streamable="yes" href="transactions.xml"&gt;
  &lt;xsl:variable name="tally" select="{ 'count': count(transactions/transaction), 
                                          'max': max(transactions/transaction/@value) }"/&gt;
  &lt;value count="{ $tally('count') }" max="{ $tally('max') }"/&gt;
&lt;/xsl:source-document&gt;</pre>
                  </div>
                  <p>Other options include the use of <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a>, or multiple <a href="../../xslt-40/Overview.html#xsl:accumulator">xsl:accumulator</a>
                  declarations, one for each value to be computed.</p>
               </div>
               <p>&nbsp;</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e5592"></a>Example: Using <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> with <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> to
                     Process a Collection of Input Documents </div>
                  <p>This example displays a list of the chapter titles extracted from each book in
                     a collection of books.</p>
                  <p>Each input document is assumed to have a structure such as:</p>
                  <div class="exampleInner">
                     <pre>&lt;book&gt;
  &lt;chapter number-of-pages="18"&gt;
    &lt;title&gt;The first chapter of book A&lt;/title&gt;
    ...
  &lt;/chapter&gt;
  &lt;chapter number-of-pages="15"&gt;
    &lt;title&gt;The second chapter of book A&lt;/title&gt;
    ...
  &lt;/chapter&gt;
  &lt;chapter number-of-pages="12"&gt;
    &lt;title&gt;The third chapter of book A&lt;/title&gt;
    ...
  &lt;/chapter&gt;
&lt;/book&gt;</pre>
                  </div>
                  <p>Stylesheet code:</p>
                  <div class="exampleInner">
                     <pre>&lt;chapter-titles&gt;
  &lt;xsl:for-each select="uri-collection('books')"&gt;
    &lt;xsl:source-document streamable="yes" href="{.}"&gt;
      &lt;xsl:for-each select="book"&gt;
        &lt;xsl:for-each select="chapter"&gt;
           &lt;title&gt;&lt;xsl:value-of select="title"/&gt;&lt;/title&gt;
        &lt;/xsl:for-each&gt;
      &lt;/xsl:for-each&gt;
    &lt;/xsl:source-document&gt;
  &lt;/xsl:for-each&gt;
&lt;/chapter-titles&gt;</pre>
                  </div>
                  <p>Output:</p>
                  <div class="exampleInner">
                     <pre>&lt;chapter-titles&gt;
  &lt;title&gt;The first chapter of book A&lt;/title&gt;
  &lt;title&gt;The second chapter of book A&lt;/title&gt;
  ...
  &lt;title&gt;The first chapter of book B&lt;/title&gt;
  ...
&lt;/chapter-titles&gt;</pre>
                  </div>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This example uses the function <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-uri-collection"><code>uri-collection</code></a> to
                        obtain the document URIs of all the documents in a collection, so that each
                        one can be processed in turn using <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a>.</p>
                  </div>
               </div>
               <p>&nbsp;</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e5624"></a>Example: Using <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> with <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a>
                     </div>
                  <p>This example assumes that the input is a book with multiple chapters, as shown
                     in the previous example, with the page count for each chapter given as an
                     attribute of the chapter. The transformation determines the starting page
                     number for each chapter by accumulating the page counts for previous chapters,
                     and rounding up to an odd number if necessary.</p>
                  <div class="exampleInner">
                     <pre>&lt;chapter-start-page&gt;
   &lt;xsl:source-document streamable="yes" href="book.xml"&gt;
      &lt;xsl:iterate select="book/chapter"&gt;
         &lt;xsl:param name="start-page" select="1"/&gt;
         &lt;chapter title="{title}" start-page="{ $start-page }"/&gt;
         &lt;xsl:next-iteration&gt;
            &lt;xsl:with-param name="start-page" 
                            select="$start-page + @number-of-pages + 
                                      (@number-of-pages mod 2)"/&gt;
         &lt;/xsl:next-iteration&gt;
      &lt;/xsl:iterate&gt;
   &lt;/xsl:source-document&gt;
&lt;/chapter-start-page&gt;</pre>
                  </div>
                  <p>Output:</p>
                  <div class="exampleInner">
                     <pre>&lt;chapter-start-page&gt;
  &lt;chapter title="The first chapter of book A" start-page="1"/&gt;
  &lt;chapter title="The second chapter of book A" start-page="19"/&gt;
  &lt;chapter title="The third chapter of book A" start-page="35"/&gt;
  ...
&lt;/chapter-start-page&gt;</pre>
                  </div>
               </div>
               <p>&nbsp;</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e5641"></a>Example: Using <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> with <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a>
                     </div>
                  <p>This example assumes that the input is a book with multiple chapters, and that
                     each chapter belongs to a part, which is present as an attribute of the chapter
                     (for example, chapters 1-4 might constitute Part 1, the next three chapters
                     forming Part 2, and so on):</p>
                  <div class="exampleInner">
                     <pre>&lt;book&gt;
  &lt;chapter part="1"&gt;
    &lt;title&gt;The first chapter of book A&lt;/title&gt;
    ...
  &lt;/chapter&gt;
  &lt;chapter part="1"&gt;
    &lt;title&gt;The second chapter of book A&lt;/title&gt;
    ...
  &lt;/chapter&gt;
  ...
  &lt;chapter part="2"&gt;
    &lt;title&gt;The fifth chapter of book A&lt;/title&gt;
    ...
  &lt;/chapter&gt;
&lt;/book&gt;</pre>
                  </div>
                  <p>The transformation copies the full text of the chapters, creating an extra
                     level of hierarchy for the parts.</p>
                  <div class="exampleInner">
                     <pre>&lt;book&gt;
   &lt;xsl:source-document streamable="yes" href="book.xml"&gt;
      &lt;xsl:for-each select="book"&gt;
         &lt;xsl:for-each-group select="chapter" group-adjacent="data(@part)"&gt;
            &lt;part number="{current-grouping-key()}"&gt;
               &lt;xsl:copy-of select="current-group()"/&gt;
            &lt;/part&gt;
         &lt;/xsl:for-each-group&gt;
      &lt;/xsl:for-each&gt;
   &lt;/xsl:source-document&gt;
&lt;/book&gt;</pre>
                  </div>
                  <p>Output:</p>
                  <div class="exampleInner">
                     <pre>&lt;book&gt;
  &lt;part number="1"&gt;
    &lt;chapter part="1"&gt;
      &lt;title&gt;The first chapter of book A&lt;/title&gt;
      ...
    &lt;/chapter&gt;
    &lt;chapter part="1"&gt;
      &lt;title&gt;The second chapter of book A&lt;/title&gt;
      ...
    &lt;/chapter&gt;
    ...
  &lt;/part&gt;
  &lt;part number="2"&gt;
    &lt;chapter part="2"&gt;
      &lt;title&gt;The fifth chapter of book A&lt;/title&gt;
    ...
    &lt;/chapter&gt;
    ...
  &lt;/part&gt;
&lt;/book&gt;</pre>
                  </div>
               </div>
               <p>&nbsp;</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e5662"></a>Example: Using <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> with <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a>
                     </div>
                  <p>This example copies an XML document while deleting all the <code>ednote</code>
                     elements at any level of the tree, together with their descendants. This
                     example is a complete stylesheet, which is intended to be evaluated by
                     nominating <code>main</code> as the <a href="https://qt4cg.org/specifications/xslt-40/#dt-initial-named-template">initial named template</a><sup><small>XT</small></sup>.
                     The use of <code>on-no-match="deep-copy"</code> in the
                        <a href="../../xslt-40/Overview.html#xsl:mode">xsl:mode</a> declaration means that the built-in template rule
                     copies nodes unchanged, except where overridden by a user-defined template
                     rule.</p>
                  <div class="exampleInner">
                     <pre>&lt;xsl:transform version="3.0" 
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

&lt;xsl:mode name="delete-ednotes" streamable="yes" 
                                on-no-match="shallow-copy"/&gt;

&lt;xsl:template name="main"&gt;
   &lt;xsl:source-document streamable="yes" href="book.xml"&gt;
      &lt;xsl:apply-templates mode="delete-ednotes"/&gt;
   &lt;/xsl:source-document&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="ednote" mode="delete-ednotes"/&gt;

&lt;/xsl:transform&gt;</pre>
                  </div>
                  <p>Additional template rules could be added to process other elements and
                     attributes in the same pass through the data: for example, to modify the value
                     of a <code>last-updated</code> attribute (wherever it appears) to the current
                     date and time, the following rule suffices:</p>
                  <div class="exampleInner">
                     <pre>
&lt;xsl:template match="@last-updated" mode="delete-ednotes"&gt;
  &lt;xsl:attribute name="last-updated" select="current-dateTime()"/&gt;
&lt;/xsl:template&gt;</pre>
                  </div>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="streamable-templates"></a>5 <a href="#streamable-templates" style="text-decoration: none">Streamable Templates</a></h2>
            <p>A template rule that is <a href="https://qt4cg.org/specifications/xslt-40/#dt-applicable">applicable</a><sup><small>XT</small></sup> 
                 to a mode <var>M</var> is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> if and only if all the following conditions
                  are satisfied:</p>
            <ol class="enumar">
               <li>
                  <p>Mode <var>M</var> is declared in an <a href="../../xslt-40/Overview.html#xsl:mode">xsl:mode</a> declaration
                        that specifies <code>streamable="yes"</code>.</p>
               </li>
               <li>
                  <p>The <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup> defined in the
                           <code>match</code> attribute of the <a href="../../xslt-40/Overview.html#xsl:template">xsl:template</a> element
                           is a <a title="motionless" class="termref" href="#dt-motionless">motionless</a>
                        pattern as defined in <a href="#classifying-patterns"><b>12.9 Classifying Patterns</b></a>.</p>
               </li>
               <li>
                  <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> 
                       forming the body of the <a href="../../xslt-40/Overview.html#xsl:template">xsl:template</a> element is either
                           <a title="motionless" class="termref" href="#dt-motionless">motionless</a> or <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
               </li>
               <li>
                  <p>The <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted
                           posture</a> of the <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> forming
                        the body of the <a href="../../xslt-40/Overview.html#xsl:template">xsl:template</a> element, with respect to the
                           <a title="U-type" class="termref" href="#dt-utype">U-type</a> that corresponds to the declared return type of
                        the template (defaulting to <code>item()*</code>), is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This means that either (a) the sequence constructor is grounded as
                           written (that is, it does not return streamed nodes), or (b) it
                           effectively becomes grounded because the declared result type of the
                           template is atomic, leading to implicit atomization of the result.</p>
                  </div>
               </li>
               <li>
                  <p>Every <a href="https://qt4cg.org/specifications/xslt-40/#dt-expression">expression</a><sup><small>XT</small></sup> and contained
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> in a contained
                           <a href="../../xslt-40/Overview.html#xsl:param">xsl:param</a> element (the construct that provides the
                        default value of the parameter) is
                        <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
               </li>
            </ol>
            <p>Specifying <code>streamable="yes"</code> on an
                     <a href="../../xslt-40/Overview.html#xsl:mode">xsl:mode</a> declaration declares an intent that every template
                  rule <span>to which that mode is <a href="https://qt4cg.org/specifications/xslt-40/#dt-applicable">applicable</a><sup><small>XT</small></sup></span> 
                  (explicitly or implicitly, including by specifying
                     <code>#all</code>), should be streamable,
                     either because it is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, or because it
                     takes advantage of streamability extensions offered by a particular
                     processor. The consequences of declaring the mode to be streamable
                  when there is such a template rule that is not guaranteed streamable depend on the
                  conformance level of the processor, and are explained in <a href="#streamability-guarantees"><b>3.1 Streamability Guarantees</b></a>.</p>
            <p>Processing of a document using streamable templates may be
                  initiated using code such as the following, where <code>S</code> is a mode
                  declared with <code>streamable="yes"</code>:</p>
            <div class="exampleInner">
               <pre>
&lt;xsl:source-document streamable="yes" href="bigdoc.xml"&gt;
  &lt;xsl:apply-templates mode="S"/&gt;
&lt;/xsl:source-document&gt;</pre>
            </div>
            <p>Alternatively, streamed processing may be initiated by invoking
                  the transformation with an <a href="https://qt4cg.org/specifications/xslt-40/#dt-initial-mode">initial mode</a><sup><small>XT</small></sup> declared as
                  streamable, while supplying the <a href="https://qt4cg.org/specifications/xslt-40/#dt-initial-match-selection">initial match selection</a><sup><small>XT</small></sup> 
                 (in an <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a> way) as a streamed document.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>Invoking a streamable template using the construct
                        <code>&lt;xsl:apply-templates select="doc('bigdoc.xml')"/&gt;</code> does
                     not ensure streamed processing. As always, processors may use streamed
                     processing if they are able to do so, but when the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-doc"><code>doc</code></a>
                     or <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-document"><code>document</code></a> functions are used, processors are obliged to
                     ensure that the results are deterministic, which may be difficult to reconcile
                     with streaming (if the same document is read twice, the results must be
                     identical). The use of <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> 
                     with <code>streamable="yes"</code>
                     does not offer the same guarantees of determinism.</p>
            </div>
            <p>For an example of processing a collection of documents by use of the function
                     <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-uri-collection"><code>uri-collection</code></a> in conjunction with
                     <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a>, see <a href="#stream-examples"><b>4.2 Examples of xsl:source-document</b></a>.</p>
         </div>
         <div class="div1">
            
            <h2><a id="streaming-with-xsl-iterate"></a>6 <a href="#streaming-with-xsl-iterate" style="text-decoration: none">Streaming with <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a></a></h2>
            <p>The <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> instruction plays an important role in streamed applications,
              because it allows an application (by means of the <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> parameters)
              to remember selected information as elements from a streamed source document are processed.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>An alternative way of achieving this is with streamed accumulators:
              see <a href="#streamability-of-accumulators"><b>11 Streamable Accumulators</b></a>.</p>
            </div>
            <p>The examples below use the <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> instruction in conjunction with the
                  <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction. This is not the only way of using
                  <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a>, but it illustrates the way in which the two features
               can be combined to achieve streaming of a large input document.</p>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e5890"></a>Example: Using <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> to Compute Cumulative Totals</div>
               <p>Suppose that the input XML document has this structure</p>
               <div class="exampleInner">
                  <pre>&lt;transactions&gt;
  &lt;transaction date="2008-09-01" value="12.00"/&gt;
  &lt;transaction date="2008-09-01" value="8.00"/&gt;
  &lt;transaction date="2008-09-02" value="-2.00"/&gt;
  &lt;transaction date="2008-09-02" value="5.00"/&gt;
&lt;/transactions&gt;</pre>
               </div>
               <p>and that the requirement is to transform this to:</p>
               <div class="exampleInner">
                  <pre>&lt;account&gt;
  &lt;balance date="2008-09-01" value="12.00"/&gt;
  &lt;balance date="2008-09-01" value="20.00"/&gt;
  &lt;balance date="2008-09-02" value="18.00"/&gt;
  &lt;balance date="2008-09-02" value="23.00"/&gt;
&lt;/account&gt;</pre>
               </div>
               <p>This can be achieved using the following code, which is designed to process the
                  transaction file using streaming:</p>
               <div class="exampleInner">
                  <pre>&lt;account&gt;
  &lt;xsl:source-document streamable="yes" href="transactions.xml"&gt;
    &lt;xsl:iterate select="transactions/transaction"&gt;
      &lt;xsl:param name="balance" select="0.00" as="xs:decimal"/&gt;
      &lt;xsl:variable name="newBalance" 
                    select="$balance + xs:decimal(@value)"/&gt;
      &lt;balance date="{@date}" value="{format-number($newBalance, '0.00')}"/&gt;
      &lt;xsl:next-iteration&gt;
        &lt;xsl:with-param name="balance" select="$newBalance"/&gt;
      &lt;/xsl:next-iteration&gt;
    &lt;/xsl:iterate&gt;
  &lt;/xsl:source-document&gt;
&lt;/account&gt;</pre>
               </div>
               <p>The following example modifies this by only outputting the information for the
                  first day’s transactions:</p>
               <div class="exampleInner">
                  <pre>&lt;account&gt;
  &lt;xsl:source-document streamable="yes" href="transactions.xml"&gt;
    &lt;xsl:iterate select="transactions/transaction"&gt;
      &lt;xsl:param name="balance" select="0.00" as="xs:decimal"/&gt;
      &lt;xsl:param name="prevDate" select="()" as="xs:date?"/&gt;
      &lt;xsl:variable name="newBalance" 
                    select="$balance + xs:decimal(@value)"/&gt;
      &lt;xsl:variable name="thisDate" 
                    select="xs:date(@date)"/&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="empty($prevDate) or $thisDate eq $prevDate"&gt;
          &lt;balance date="{ $thisDate }" 
                   value="{ format-number($newBalance, '0.00') }"/&gt;
          &lt;xsl:next-iteration&gt;
            &lt;xsl:with-param name="balance" select="$newBalance"/&gt;
            &lt;xsl:with-param name="prevDate" select="$thisDate"/&gt;
          &lt;/xsl:next-iteration&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;
          &lt;xsl:break/&gt;
        &lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:iterate&gt;
  &lt;/xsl:source-document&gt;
&lt;/account&gt;</pre>
               </div>
               <p>The following code outputs the balance only at the end of each day, together with
                  the final balance:</p>
               <div class="exampleInner">
                  <pre>&lt;account&gt;
  &lt;xsl:source-document streamable="yes" href="transactions.xml"&gt;
    &lt;xsl:iterate select="transactions/transaction"&gt;
      &lt;xsl:param name="balance" select="0.00" as="xs:decimal"/&gt;
      &lt;xsl:param name="prevDate" select="()" as="xs:date?"/&gt;
      &lt;xsl:on-completion&gt;
        &lt;balance date="{ $prevDate }" 
                 value="{ format-number($balance, '0.00') }"/&gt;
      &lt;/xsl:on-completion&gt;     
      &lt;xsl:variable name="newBalance" 
                    select="$balance + xs:decimal(@value)"/&gt;
      &lt;xsl:variable name="thisDate" select="xs:date(@date)"/&gt;
      &lt;xsl:if test="exists($prevDate) and $thisDate ne $prevDate"&gt;
        &lt;balance date="{ $prevDate }" 
                 value="{ format-number($balance, '0.00') }"/&gt;
      &lt;/xsl:if&gt;
      &lt;xsl:next-iteration&gt;
        &lt;xsl:with-param name="balance" select="$newBalance"/&gt;
        &lt;xsl:with-param name="prevDate" select="$thisDate"/&gt;
      &lt;/xsl:next-iteration&gt;     
    &lt;/xsl:iterate&gt;
  &lt;/xsl:source-document&gt;
&lt;/account&gt;</pre>
               </div>
               <p>If the sequence of transactions is empty, this code outputs a single element:
                     <code>&lt;balance date="" value="0.00"/&gt;</code>.</p>
            </div>
            <p>&nbsp;</p>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e5922"></a>Example: Collecting Multiple Values in a Single Pass</div>
               <p>Problem: Given a sequence of <code>employee</code> elements, find the employees
                  having the highest and lowest salary, while processing each employee only
                  once.</p>
               <p>Solution:</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:source-document streamable="yes" href="employees.xml"&gt;
    &lt;xsl:iterate select="employees/employee"&gt;
        &lt;xsl:param name="highest" as="element(employee)*"/&gt;
        &lt;xsl:param name="lowest" as="element(employee)*"/&gt;
        &lt;xsl:on-completion&gt;
            &lt;highest-paid-employees&gt;
                &lt;xsl:value-of select="$highest/name"/&gt;
            &lt;/highest-paid-employees&gt;
            &lt;lowest-paid-employees&gt;
                &lt;xsl:value-of select="$lowest/name"/&gt;
            &lt;/lowest-paid-employees&gt;  
        &lt;/xsl:on-completion&gt;
        &lt;xsl:variable name="this" select="copy-of()"/&gt;
        &lt;xsl:variable name="is-new-highest" as="xs:boolean"
            select="empty($highest[@salary ge current()/@salary])"/&gt;
        &lt;xsl:variable name="is-equal-highest" as="xs:boolean" 
            select="exists($highest[@salary eq current()/@salary])"/&gt; 
        &lt;xsl:variable name="is-new-lowest" as="xs:boolean" 
            select="empty($lowest[@salary le current()/@salary])"/&gt;
        &lt;xsl:variable name="is-equal-lowest" as="xs:boolean" 
            select="exists($lowest[@salary eq current()/@salary])"/&gt; 
        &lt;xsl:variable name="new-highest-set" as="element(employee)*"
            select="if ($is-new-highest) then $this
            else if ($is-equal-highest) then ($highest, $this)
            else $highest"/&gt;
        &lt;xsl:variable name="new-lowest-set" as="element(employee)*"
            select="if ($is-new-lowest) then $this
            else if ($is-equal-lowest) then ($lowest, $this)
            else $lowest"/&gt;
        &lt;xsl:next-iteration&gt;
            &lt;xsl:with-param name="highest" select="$new-highest-set"/&gt;
            &lt;xsl:with-param name="lowest" select="$new-lowest-set"/&gt;
        &lt;/xsl:next-iteration&gt;
    &lt;/xsl:iterate&gt;
&lt;/xsl:source-document&gt;</pre>
               </div>
               <p>If the input sequence is empty, this code outputs an empty
                     <code>highest-paid-employees</code> element and an empty
                     <code>lowest-paid-employees</code> element.</p>
            </div>
            <p>&nbsp;</p>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e5942"></a>Example: Processing the Last Item in a Sequence Specially</div>
               <p>When streaming, it is not possible to determine whether the item being processed
                  is the last in a sequence without reading ahead. The <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-last"><code>last</code></a>
                  function therefore cannot be used in <a href="https://qt4cg.org/specifications/xslt-streaming-40/#dt-guaranteed-streamable">guaranteed-streamable</a><sup><small>SG</small></sup>
                  code. The <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> instruction provides a solution to this
                  problem.</p>
               <p>Problem: render the last paragraph in a section in some special way, for example
                  by using bold face. (The actual rendition is achieved by processing the paragraph
                  with mode <code>last-para</code>.)</p>
               <p>The solution uses <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a>
                  together with the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a>
                     function to maintain a one-element look-ahead by explicit coding:</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:template match="section" mode="streaming"&gt;
   &lt;xsl:iterate select="para"&gt;
     &lt;xsl:param name="prev" select="()" as="element(para)?"/&gt;
     &lt;xsl:on-completion&gt;
       &lt;xsl:apply-templates select="$prev" mode="last-para"/&gt;      
     &lt;/xsl:on-completion&gt;
     &lt;xsl:if test="$prev"&gt;
       &lt;xsl:apply-templates select="$prev"/&gt;
     &lt;/xsl:if&gt;
     &lt;xsl:next-iteration&gt;
       &lt;xsl:with-param name="prev" select="copy-of(.)"/&gt;
     &lt;/xsl:next-iteration&gt;
   &lt;/xsl:iterate&gt;
 &lt;/xsl:template&gt;</pre>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="handling-empty-input"></a>7 <a href="#handling-empty-input" style="text-decoration: none">Handling Empty Input</a></h2>
            <p>The three instructions <a href="../../xslt-40/Overview.html#xsl:where-populated">xsl:where-populated</a>,
              <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a>, and <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a>
              were introduced to the language explicitly to make it easier to generate
               result trees conditionally depending on what is found in the input, without violating
               the rules for streamability. These facilities are available whether or not streaming
               is in use. This section provides examples of how they can be used 
               to process streamed input.</p>
            <p>The specific problem tackled by these instructions arises when empty input
            is to be processed differently from non-empty input: for example, outputting the
            message “There are no orders today” rather than an empty list of orders, or
            outputting a subtotal only when the list of items to be totaled is non-empty. The 
            conventional approach to this involves writing something like:</p>
            <div class="exampleInner">
               <pre>&lt;xsl:choose&gt;
   &lt;xsl:when test="empty(item)"&gt;There are no orders today!&lt;/xsl:when&gt;
   &lt;xsl:otherwise&gt;&lt;xsl:apply-templates select="item"/&gt;&lt;/xsl:otherwise&gt;
&lt;/xsl:choose&gt;</pre>
            </div>
            <p>but this is not streamable, because there are two instructions that process the
           child <code>item</code> elements.</p>
            <p>The alternative formulation using <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> is fully
           streamable:</p>
            <div class="exampleInner">
               <pre>&lt;xsl:sequence&gt;
   &lt;xsl:apply-templates select="item"/&gt;   
   &lt;xsl:on-empty&gt;There are no orders today!&lt;/xsl:on-empty&gt;
&lt;/xsl:sequence&gt;</pre>
            </div>
            <p>The examples that follow illustrate how to use these instructions when
              writing streamable stylesheet code.</p>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e6002"></a>Example: Generating a Wrapper Element for a non-Empty Sequence</div>
               <p>The following example generates an <code>events</code> element if and only if
                  there are one or more <code>event</code> elements. The code could be written like
                  this:</p>
               <div class="exampleInner">
                  <pre>
&lt;xsl:if test="exists(event)"&gt;
  &lt;events&gt;
    &lt;xsl:copy-of select="event"/&gt;
  &lt;/events&gt;
&lt;/xsl:if&gt;</pre>
               </div>
               <p>However, the above code would not be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>,
                  because it processes the child <code>event</code> elements more than once. To make
                  it streamable, it can be rewritten as:</p>
               <div class="exampleInner">
                  <pre>
&lt;xsl:where-populated&gt;
  &lt;events&gt;
    &lt;xsl:copy-of select="event"/&gt;
  &lt;/events&gt;
&lt;/xsl:where-populated&gt;</pre>
               </div>
               <p>The effect of the <a href="../../xslt-40/Overview.html#xsl:where-populated">xsl:where-populated</a> instruction
                  is to avoid outputting the <code>events</code> element if it would have no
                  children. A streaming implementation will typically hold the start tag of the
                     <code>events</code> element in a buffer, to be sent to the output destination
                  only if and when a child node is generated.</p>
            </div>
            <p>&nbsp;</p>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e6035"></a>Example: Generating a Header and Footer only if there is Content</div>
               <p>The following example generates an <code>h3</code> element and a summary paragraph
                  only if a list of items is non-empty. The code could be written like this:</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:if test="exists(item-for-sale)"&gt;
  &lt;h1&gt;Items for Sale&lt;/h1&gt;
&lt;/xsl:if&gt;  
&lt;xsl:apply-templates select="item-for-sale"/&gt;
&lt;xsl:if test="exists(item-for-sale)"&gt;
  &lt;p&gt;Total value: {accumulator-before('total-value')}&lt;/p&gt;
&lt;/xsl:if&gt;</pre>
               </div>
               <p>However, the above code would not be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>,
                  because it processes the child <code>item-for-sale</code> elements more than once.
                  To make it streamable, it can be rewritten as:</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:sequence&gt;
  &lt;xsl:on-non-empty&gt;
    &lt;h1&gt;Items for Sale&lt;/h1&gt;
  &lt;/xsl:on-non-empty&gt;  
  &lt;xsl:apply-templates select="item-for-sale"/&gt;
  &lt;xsl:on-non-empty&gt;
    &lt;p&gt;Total value: {accumulator-before('total-value')}&lt;/p&gt;
  &lt;/xsl:on-non-empty&gt;  
&lt;/xsl:sequence&gt;</pre>
               </div>
               <p>The effect of the <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> instruction
                  is to output the enclosed content only if the containing sequence
                  constructor also generates “ordinary” content, that is, if there is content
                  generated by instructions other than <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> and
                     <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> instructions.</p>
            </div>
            <p>&nbsp;</p>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e6065"></a>Example: Generating Substitute Text when there is no Content</div>
               <p>The following example generates a summary paragraph only if a list of items is
                  empty. The code could be written like this:</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:apply-templates select="item-for-sale"/&gt;
&lt;xsl:if test="empty(item-for-sale)"&gt;
  &lt;p&gt;There are no items for sale.&lt;/p&gt;
&lt;/xsl:if&gt;</pre>
               </div>
               <p>However, the above code would not be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>,
                  because it processes the child <code>item-for-sale</code> elements more than once
                  (the fact that the list is empty is irrelevant, because streamability is
                  determined statically). To make the code streamable, it can be rewritten as:</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:sequence&gt;
  &lt;xsl:apply-templates select="item-for-sale"/&gt;
  &lt;xsl:on-empty&gt;
    &lt;p&gt;There are no items for sale.&lt;/p&gt;
  &lt;/xsl:on-empty&gt;
&lt;/xsl:sequence&gt;</pre>
               </div>
               <p>The effect of the <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> instruction
                  is to output the enclosed content only if the containing sequence constructor
                  generates no “ordinary” content, that is, if there is no content generated by
                  instructions other than <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> and
                     <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> instructions.</p>
            </div>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>In some cases, similar effects can be achieved by using the
                     <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-has-children"><code>has-children</code></a> function, which tests whether an element
                  has child nodes without consuming the children. However, use of
                     <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-has-children"><code>has-children</code></a> has the drawback that the function is
                  unselective: it cannot be used to test whether there are any children of relevance
                  to the application. In particular, it returns <code>true</code> if an element contains comments
                  or whitespace text nodes that the application might consider to be
                  insignificant.</p>
            </div>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>There are no special streamability rules for the three instructions
                     <a href="../../xslt-40/Overview.html#xsl:where-populated">xsl:where-populated</a>, <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a>, or
                     <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a>. The <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply. 
                 In many cases the
                     <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> and <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a>
                  instructions will generate content that does not depend on the source document,
                  and they will therefore be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, but this is not
                  required.</p>
            </div>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e6128"></a>Example: Generating an HTML list</div>
               <p>The following example generates an HTML unnumbered list, if and only if the
                     list is non-empty. Note that the presence of the <code>class</code> attribute
                     does not make the list non-empty. The code is written to be streamable.</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:where-populated expand-text="yes"&gt;
  &lt;ul class="my-list"&gt;
    &lt;xsl:for-each select="source-item"&gt;
       &lt;li&gt;{.}&lt;/li&gt;
    &lt;/xsl:for-each&gt;
  &lt;/ul&gt;
&lt;/xsl:where-populated&gt;</pre>
               </div>
            </div>
            <p>&nbsp;</p>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e6138"></a>Example: A More Complex Example</div>
               <p>This example shows how the three instructions
                  <a href="../../xslt-40/Overview.html#xsl:where-populated">xsl:where-populated</a>, <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a>, and
                     <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> may be combined.</p>
               <p>The example generates a table containing the names and ages of a set
                     of students; if there are no students, it substitutes a paragraph explaining
                     this.</p>
               <div class="exampleInner">
                  <pre>&lt;div id="students" xsl:expand-text="yes"&gt;
&lt;xsl:where-populated&gt;
   &lt;table&gt;
      &lt;xsl:on-non-empty&gt;
         &lt;thead&gt;
            &lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Age&lt;/th&gt;&lt;/tr&gt;
         &lt;/thead&gt;
      &lt;/xsl:on-non-empty&gt;
      &lt;xsl:where-populated&gt;
         &lt;tbody&gt;
            &lt;xsl:for-each select="student/copy-of()"&gt;
               &lt;tr&gt;
                  &lt;td&gt;{name}&lt;/td&gt;
                  &lt;td&gt;{age}&lt;/td&gt;
               &lt;/tr&gt;
            &lt;/xsl:for-each&gt;
         &lt;/tbody&gt;
      &lt;/xsl:where-populated&gt;
   &lt;/table&gt;
&lt;/xsl:where-populated&gt;
&lt;xsl:on-empty&gt;
   &lt;p&gt;There are no students&lt;/p&gt;
&lt;/xsl:on-empty&gt;
&lt;/div&gt;</pre>
               </div>
               <p>Explanation:</p>
               <ul>
                  <li>
                     <p>The <a href="../../xslt-40/Overview.html#xsl:where-populated">xsl:where-populated</a> around the <code>table</code>
                           element ensures that if there is no <code>thead</code> and no
                              <code>tbody</code>, then there will be no <code>table</code>. </p>
                  </li>
                  <li>
                     <p>The <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> surrounding the <code>thead</code>
                           element ensures that the <code>thead</code> element is not output unless
                           the <code>tbody</code> element is output. </p>
                  </li>
                  <li>
                     <p>The <a href="../../xslt-40/Overview.html#xsl:where-populated">xsl:where-populated</a> around the <code>tbody</code>
                           element ensures that the <code>tbody</code> element is not output unless
                           there is at least one table row (<code>tr</code>). </p>
                  </li>
                  <li>
                     <p>The <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> around the <code>p</code> element
                           ensures that if no <code>table</code> is output, then the paragraph
                           <code>There are no students</code> is output instead. </p>
                  </li>
               </ul>
            </div>
            <div class="div2">
               
               <h3><a id="evaluating-on-empty"></a>7.1 <a href="#evaluating-on-empty" style="text-decoration: none">Streamed Evaluation of <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> and <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a></a></h3>
               <p>The following non-normative algorithm explains one possible strategy for streamed
                  evaluation of a <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> containing
                     <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> and/or <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a>
                  instructions.</p>
               <p>The algorithm makes use of the following mutable variables:</p>
               <ul>
                  <li>
                     <p><var>L</var> : a list of instructions awaiting evaluation. Initially
                        empty.</p>
                  </li>
                  <li>
                     <p><var>R</var> : a list of items to act as the result of the evaluation.
                        Initially empty.</p>
                  </li>
                  <li>
                     <p><var>F</var> : a boolean flag, initially <code>false</code>, to indicate whether any
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-vacuous">non-vacuous</a><sup><small>XT</small></sup> items have been written to <var>R</var> by
                           <b>ordinary instructions</b>. The term <b>ordinary instruction</b>
                        means any node in the sequence constructor other than an
                           <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> or <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a>
                        instruction.</p>
                  </li>
               </ul>
               <p>The algorithm is as follows:</p>
               <ol class="enumar">
                  <li>
                     <p>The nodes in the sequence constructor are evaluated in document order.</p>
                  </li>
                  <li>
                     <p>When an <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> instruction is encountered,
                        then:</p>
                     <ol class="enumla">
                        <li>
                           <p>If <var>F</var> is true, the instruction is evaluated and the result
                              is appended to <var>R</var>.</p>
                        </li>
                        <li>
                           <p>Otherwise, the instruction is appended to <var>L</var>.</p>
                        </li>
                     </ol>
                  </li>
                  <li>
                     <p>When an <b>ordinary instruction</b> is evaluated:</p>
                     <ol class="enumla">
                        <li>
                           <p>The results of the evaluation are appended to <var>R</var>, in
                              order.</p>
                        </li>
                        <li>
                           <p>When a <a href="https://qt4cg.org/specifications/xslt-40/#dt-vacuous">non-vacuous</a><sup><small>XT</small></sup> item is about to be appended to
                                 <var>R</var>, and <var>F</var> is false, then before appending the
                              item to <var>R</var>, the following actions are taken:</p>
                           <ol class="enumlr">
                              <li>
                                 <p>Any <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> instructions in
                                       <var>L</var> are evaluated, in order, and their results are
                                    appended to <var>R</var>.</p>
                              </li>
                              <li>
                                 <p><var>F</var> is set to <code>true</code>.</p>
                              </li>
                           </ol>
                        </li>
                     </ol>
                  </li>
                  <li>
                     <p>When an <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> instruction is encountered, then:</p>
                     <ol class="enumla">
                        <li>
                           <p>If <var>F</var> is true, the instruction is ignored.</p>
                        </li>
                        <li>
                           <p>Otherwise, the existing contents of <var>R</var> are discarded, 
                              the instruction is evaluated, and its results are appended to <var>R</var>.</p>
                           <div class="note">
                              <p class="prefix"><b>Note:</b></p>
                              <p>The need to discard items from <var>R</var> 
                              arises only when all the items in <var>R</var> are <a href="https://qt4cg.org/specifications/xslt-40/#dt-vacuous">vacuous</a><sup><small>XT</small></sup>. 
                              Streaming implementations may therefore need a limited amount of buffering to retain 
                              insignificant items until it is known whether they will be needed. 
                              However, in many common cases an optimized implementation will be able 
                              to discard <a href="https://qt4cg.org/specifications/xslt-40/#dt-vacuous">vacuous</a><sup><small>XT</small></sup> items such as empty text nodes immediately, 
                              because when a node is being constructed using the rules in 
                              <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#constructing-complex-content">5.7.1 Constructing Complex Content</a> 
                              or <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#constructing-simple-content">5.7.2 Constructing Simple Content</a>, 
                              such items have no effect on the final outcome.</p>
                           </div>
                           <p>Otherwise, the instruction is evaluated and its results are appended
                              to <var>R</var>.</p>
                        </li>
                     </ol>
                  </li>
                  <li>
                     <p>The result of the sequence constructor is the list of items in
                        <var>R</var>.</p>
                  </li>
               </ol>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="streamability-of-stylesheet-functions"></a>8 <a href="#streamability-of-stylesheet-functions" style="text-decoration: none">Streamable Stylesheet Functions</a></h2>
            <p>The <code>streamability</code> attribute of <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a> is used
                  to assign the function to one of a number of <a title="streamability category" class="termref" href="#dt-streamability-category">streamability categories</a>. The various
                  categories, and their effect on the streamability of function calls, are described
                  in <a href="#streamable-stylesheet-functions"><b>8.1 Classifying Stylesheet Functions</b></a>.</p>
            <p>The streamability category of a function characterizes the way in which the
                  function processes any streamed nodes supplied in the first argument to the
                  function. (In general, streamed nodes cannot be supplied in other arguments,
                  unless they are atomized by the <a href="https://qt4cg.org/specifications/xslt-40/#dt-coercion-rules">coercion rules</a><sup><small>XT</small></sup>.)
                  The <code>streamability</code> attribute is therefore not applicable unless the
                  function takes at least one argument.</p>
            <p><a id="err-XTSE3155"><span class="error">[ERR XTSE3155] </span></a>It is a static error if an <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a> element with no
                           <a href="../../xslt-40/Overview.html#xsl:param">xsl:param</a> children has a <code>streamability</code>
                        attribute with any value other than <code>unclassified</code>.</p>
            <div class="div2">
               
               <h3><a id="streamable-stylesheet-functions"></a>8.1 <a href="#streamable-stylesheet-functions" style="text-decoration: none">Classifying Stylesheet Functions</a></h3>
               <p>Under specific conditions, described in this section, a stylesheet function can be
                  used to process nodes from a <a title="streamed document" class="termref" href="#dt-streamed-document">streamed input
                     document</a>.</p>
               <p><a id="dt-streamability-category" title="streamability category"><span class="definition">[Definition:&nbsp;</span></a>Stylesheet
                     functions belong to one of a number of <b>streamability categories</b>:
                     the choice of category characterizes the way in which the function handles
                     streamed input.<span class="definition">]</span></p>
               <p>The <a title="streamability category" class="termref" href="#dt-streamability-category">category</a> to which a
                  function belongs is declared in the <code>streamability</code> attribute of the
                     <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a> declaration, and defaults to
                     <code>unclassified</code>.</p>
               <p>The streamability categories defined in this specification are:
                     <code>unclassified</code>, <code>absorbing</code>, <code>inspection</code>,
                     <code>filter</code>, <code>shallow-descent</code>, <code>deep-descent</code>,
                  and <code>ascent</code>. It is also possible to specify the streamability category
                  as a QName in an <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a> namespace, in which
                  case the streamability rules are <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a>; a
                  processor that does not recognize a category defined in this way
                     <span class="verb">must</span> analyze the function as if
                     <code>streamability="unclassified"</code> were specified. </p>
               <p>A stylesheet function is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a> if the
                     <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a> declaration has a <code>streamability</code>
                  attribute with a value other than <code>unclassified</code>.</p>
               <p>The only <a title="streamability category" class="termref" href="#dt-streamability-category">category</a> permitted for
                  a zero-arity function (one with no arguments) is <code>unclassified</code>. All
                  function calls to zero-arity stylesheet functions are <a title="grounded" class="termref" href="#dt-grounded">grounded</a>
                  and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
               <p>In general (subject to more detailed rules below), a node belonging to a <a title="streamed document" class="termref" href="#dt-streamed-document">streamed document</a> can be present within the value of an argument of
                  a call on a <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet function</a><sup><small>XT</small></sup> only if one of the following
                  conditions is true:</p>
               <ol class="enumar">
                  <li>
                     <p>The stylesheet function is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>, and the
                        argument in question is the first argument of the function call.</p>
                  </li>
                  <li>
                     <p>The corresponding <a href="https://qt4cg.org/specifications/xslt-40/#dt-function-parameter">function parameter</a><sup><small>XT</small></sup> is declared with a
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-required-type">required type</a><sup><small>XT</small></sup> that triggers 
                       <a href="https://qt4cg.org/specifications/xslt-40/#dt-atomization">atomization</a><sup><small>XT</small></sup> of any supplied node.</p>
                  </li>
               </ol>
               <p><a id="dt-streaming-parameter" title="streaming parameter"><span class="definition">[Definition:&nbsp;</span></a>The first 
                 <a href="https://qt4cg.org/specifications/xslt-40/#dt-function-parameter">parameter</a><sup><small>XT</small></sup> of a 
                 <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>
                     <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet function</a><sup><small>XT</small></sup> is referred to as a <b>streaming
                        parameter</b>.<span class="definition">]</span></p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>If a stylesheet function returns streamed nodes, then these nodes can only
                     derive from streamed nodes passed in an argument to the function. This is
                     because streamed nodes cannot be bound to global variables, and they cannot be
                     returned by an <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction within the function body
                     (the result of <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> is always grounded).</p>
               </div>
               <p>The choice of <a title="streamability category" class="termref" href="#dt-streamability-category">category</a> places
                  constraints on the function body, and also on calls to the function. These constraints
                  are defined below, separately for each category. A function is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> only if the constraints are satisfied,
                and a static function call is
               guaranteed-streamable only if the function is guaranteed-streamable and the
               function call itself satisfies the constraints for the chosen category.</p>
               <p>Dynamic function calls are <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> only
   in trivial cases, for example where the function signature indicates that an argument is required to
   be a text node or an attribute node. For details, see <a href="#streamability-of-dynamic-function-calls"><b>12.7.11 Streamability of Dynamic Function Calls</b></a>.</p>
               <p>The constraints on the function body are expressed in terms of the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the function result. The
                     <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the function
                  result are the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture and sweep</a> of the <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> contained within the
                     <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a> element, given the declared return type of the
                  function, which defaults to <code>item()*</code>.</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>Determining the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                     the function result requires first determining the <a title="posture" class="termref" href="#dt-posture">posture</a>
                     and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, which is done according to the rules in
                        <a href="#classifying-sequence-constructors"><b>12.4 Classifying Sequence Constructors</b></a>. This in turn will
                     usually involve examination of variable references that are bound to the
                     function’s parameters. The analysis of these variable references is described
                     in <a href="#streamability-of-variable-references"><b>12.7.12 Streamability of Variable References</b></a>.</p>
               </div>
               <p>If the function is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a> but does not satisfy
                  the constraints that make it <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, the
                  consequences are explained in <a href="#streamability-guarantees"><b>3.1 Streamability Guarantees</b></a>.</p>
               <p>If a stylesheet function is overridden in another package (using
                     <a href="../../xslt-40/Overview.html#xsl:override">xsl:override</a>), then the overriding stylesheet function must
                  belong to the same <a title="streamability category" class="termref" href="#dt-streamability-category">streamability category</a> as the function that
                  it overrides. This ensures that overriding a function cannot affect the
                  streamability of calls to that function.</p>
               <p>The rules for each <a title="streamability category" class="termref" href="#dt-streamability-category">streamability category</a> are given in the
                  following sections.</p>
               <div class="div3">
                  
                  <h4><a id="category-unclassified"></a>8.1.1 <a href="#category-unclassified" style="text-decoration: none">Streamability Category: unclassified</a></h4>
                  <p><b>Informal description:</b> Functions in this category cannot be called
                     with streamed nodes supplied in an argument, unless the function signature
                     causes such nodes to be atomized.</p>
                  <p><b>Rules for the function signature:</b> there are no constraints.</p>
                  <p><b>Rules for the function body:</b> there are no constraints.</p>
                  <p><b>Rules for references to the streaming
                        parameter:</b> not applicable, because there is no streaming
                     parameter.</p>
                  <p><b>Rules for function calls:</b> the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply. The operands are the
                     expressions appearing in the argument list of the function call, with the
                        <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of each operand being the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the declared type of the
                     corresponding parameter in the function signature. </p>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e6686"></a>Example: An unclassified stylesheet function that accepts nodes</div>
                     <p>The <a title="streamability category" class="termref" href="#dt-streamability-category">streamability category</a> is
                        <code>unclassified</code>.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:exclude-first" as="node()*"&gt;
  &lt;xsl:param name="nodes" as="node()*"/&gt;
  &lt;xsl:sequence select="$nodes[not(node-name() = preceding-sibling::*/node-name())]"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>The effect of the rules is that a call to this function is guaranteed
                        streamable if and only if the sequence supplied as the value of the
                           <code>$nodes</code> argument is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> (that is, it
                        contains no streamed nodes).</p>
                  </div>
                  <p>&nbsp;</p>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e6705"></a>Example: An unclassified stylesheet function that accepts atomic items</div>
                     <p>The <a title="streamability category" class="termref" href="#dt-streamability-category">streamability category</a> is
                        <code>unclassified</code>.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:min" as="xs:integer"&gt;
  &lt;xsl:param name="arg0" as="xs:integer"/&gt;
  &lt;xsl:param name="arg1" as="xs:integer"/&gt;
  &lt;xsl:sequence select="min(($arg0, $arg1))"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>The effect of the rules is that a call to this function is streamable under
                        similar circumstances to those that apply to a binary operator such as
                           <code>+</code>. For example, a call is streamable if two atomic items
                        are supplied, or if two attribute nodes are supplied, whether from streamed
                        or unstreamed documents. The main constraint is that it is not permitted for
                        both arguments to be consuming; for example, if the context node is a node
                        in a streamed document, then the function call <code>f:min((price,
                           discount))</code> would not be guaranteed streamable.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="category-absorbing"></a>8.1.2 <a href="#category-absorbing" style="text-decoration: none">Streamability Category: absorbing</a></h4>
                  <p><b>Informal description:</b> Functions in this category typically read
                     the subtrees rooted at the node or nodes supplied in the first argument. These
                     subtrees must not overlap each other. The function must not return any streamed
                     nodes.</p>
                  <p><b>Rules for the function signature:</b> there are no constraints.</p>
                  <p><b>Rules for the function body:</b> 
                     For the function to be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, the 
                     <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture</a> of
                     the function body with respect to the declared return type must be <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and the 
                     <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted sweep</a> of the function body 
                     with respect to the declared return type must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a> or <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  <p><b>Rules for references to the streaming
                        parameter:</b> If the declared type of the <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> permits more than one node, then a variable
                     reference referring to the streaming parameter is <a title="striding" class="termref" href="#dt-striding">striding</a>
                     and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. Otherwise such a variable reference is
                        <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p><b>Rules for function calls:</b> If the first argument is <a title="crawling" class="termref" href="#dt-crawling">crawling</a> then the function call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>
                     and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>; otherwise the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply. The operands are the
                     expressions appearing in the argument list of the function call. The <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of the first argument is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>; the operand usage of other arguments is the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the declared type of the
                     corresponding <a href="https://qt4cg.org/specifications/xslt-40/#dt-parameter">parameter</a><sup><small>XT</small></sup> in the function signature. </p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Absorbing functions perform an operation analogous to atomization on their
                        supplied arguments, in that they typically use information from the subtree
                        rooted at a node to compute atomic items. Atomization can be seen as a
                        special case of absorption. Calls on absorbing functions are therefore, from
                        a streamability point of view, equivalent to calls on functions that
                        implicitly atomize the supplied nodes.</p>
                     <p>An important difference, however, is that whereas atomization can be applied
                        to any argument of a function call, absorption applies only to the first
                        argument.</p>
                     <p>Another difference is that atomization is allowed on a sequence of nodes in
                           <a title="crawling" class="termref" href="#dt-crawling">crawling</a> posture, whereas generalized absorption is
                        not. Within a sequence, there may be nodes whose subtrees overlap, and the
                        code for atomization is expected to handle this, but more general absorption
                        operations are not. To write a function that accepts streamed nodes and
                        atomizes them, it is better to use the streamability category
                           <code>unclassified</code>, and to declare the first argument with an
                        atomic type, rather than using the category <code>absorbing</code> which
                        allows more general processing, but restricts what can be supplied in the
                        argument to the function call.</p>
                  </div>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e6805"></a>Example: An absorbing stylesheet function</div>
                     <p>The following function is declared as absorbing, and the function body meets
                        the rules for this category because it makes downward selections only, and
                        returns an atomic item.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:count-descendants" as="xs:integer" streamability="absorbing"&gt;
  &lt;xsl:param name="input" as="node()*"/&gt;
  &lt;xsl:sequence select="count($input//*)"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>The effect of the rules is that a call to this function is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> provided that the sequence supplied as
                        the value of the <code>$input</code> argument is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> or <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, and is either
                           <a title="grounded" class="termref" href="#dt-grounded">grounded</a> or <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                  </div>
                  <p>&nbsp;</p>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e6828"></a>Example: An absorbing stylesheet function with two arguments</div>
                     <p>The following function is declared as absorbing, and the function body meets
                        the rules for this category because it makes downward selections only from
                        the node supplied as the first argument, and returns an atomic item.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:compare-size" as="xs:integer" streamability="absorbing"&gt;
  &lt;xsl:param name="input0" as="node()"/&gt;
  &lt;xsl:param name="input1" as="node()"/&gt;
  &lt;xsl:sequence select="count($input0//*) - count($input1//*)"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>This function takes two nodes as its arguments. Some examples of function
                        calls include: </p>
                     <ul>
                        <li>
                           <p>Streamable: <code>f:compare-size(a, b)</code> where <code>a</code> is
                              an element in a streamed document and <code>b</code> is an element in
                              an unstreamed document</p>
                        </li>
                        <li>
                           <p>Streamable: <code>f:compare-size(a, b)</code> where <code>a</code> and
                                 <code>b</code> are both elements in unstreamed documents</p>
                        </li>
                        <li>
                           <p>Not streamable: <code>f:compare-size(a, b)</code> where <code>a</code>
                              is an element in an unstreamed document and <code>b</code> is an
                              element in a streamed document</p>
                        </li>
                     </ul>
                     <p>The reason for the asymmetry is that for the first
                     argument the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>,
                     while for the second argument it is <a title="navigation" class="termref" href="#dt-navigation">navigation</a>. It is a consequence
                     of the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> that when streamed nodes are
                     supplied to an operand with usage navigation, the resulting expression is
                     <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                  </div>
                  <p>&nbsp;</p>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e6889"></a>Example: A recursive absorbing stylesheet function</div>
                     <p>The following function is declared as absorbing, and the function body meets
                        the rules for this category. Analysis of the function body reveals that it
                        is grounded and consuming; to establish this, it is necessary to analyze the
                        recursive call <code>f:outline(*)</code>, and this is possible because it is
                        known to be a call on an absorbing stylesheet function.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:outline" as="xs:string" streamability="absorbing"&gt;
  &lt;xsl:param name="input" as="element()*"/&gt;
  &lt;xsl:value-of select="$input ! (name() || '(' || f:outline(*) || ')')" 
                separator=", "/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>The effect of the rules is that a call to this function is guaranteed
                        streamable in the typical case where the sequence supplied as the value of
                        the <code>$input</code> argument is <a title="striding" class="termref" href="#dt-striding">striding</a> and
                           <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="category-inspection"></a>8.1.3 <a href="#category-inspection" style="text-decoration: none">Streamability Category: inspection</a></h4>
                  <p><b>Informal description:</b> Functions in this category typically return
                     properties of the node supplied in the first argument, where these properties
                     can be determined without advancing the input stream. This allows access to
                     properties such as the name and type of each node, and also to its ancestors,
                     attributes, and namespaces. </p>
                  <p><b>Rules for the function signature:</b> If
                     the declared type of the streaming parameter permits more than one node,
                     the function is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                  <p><b>Rules for the function body:</b>
                     For the function to be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, 
                     the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture</a> of
                     the function body with respect to the declared return type must be <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and the 
                     <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted sweep</a> of the function body 
                     with respect to the declared return type must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p><b>Rules for references to the streaming
                        parameter:</b> Such a variable reference is
                        <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p><b>Rules for function calls:</b> the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply. The operands are the
                     expressions appearing in the argument list of the function call. The <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of the first argument is <a title="inspection" class="termref" href="#dt-inspection">inspection</a>; the operand usage of other arguments is the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the declared type of the
                     corresponding argument in the function signature. </p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> is restricted to be a single
                        node because if <code>$input</code> were a sequence of nodes, then an
                        expression such as <code>($input/name(), $input/@id)</code> would not be
                        streamable.</p>
                  </div>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e6968"></a>Example: Example of an inspection stylesheet function</div>
                     <p>The following function is declared with category <code>inspection</code>,
                        and the function body meets the rules for this category because all
                        references to the supplied node are motionless.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:depth" as="xs:integer" streamability="inspection"&gt;
  &lt;xsl:param name="input" as="node()"/&gt;
  &lt;xsl:sequence select="count($input/ancestor-or-self::*)"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>The effect of the rules is that a call to this function is guaranteed
                        streamable provided that the expression supplied as the value of the
                           <code>$input</code> argument is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> or
                           <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  </div>
                  <p>&nbsp;</p>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e6987"></a>Example: Example of an inspection stylesheet function with two arguments</div>
                     <p>The following function is declared with category <code>inspection</code>,
                        and the function body meets the rules for this category because the function
                        signature ensures that the second argument cannot be a node.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:get-attribute-value" as="xs:string"&gt;
  &lt;xsl:param name="element" as="node()"/&gt;
  &lt;xsl:param name="attribute-name" as="xs:string"/&gt;
  &lt;xsl:sequence select="string($element/@*[local-name() = $attribute-name])"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>Although the normal usage of this function might be to supply an element
                        from a streamed document as the first argument, and a literal string as the
                        second, it is also permissible (and guaranteed streamable) to supply an
                        unstreamed element as the first argument, and an element node from a
                        streamed document as the second. When applying the general streamability
                        rules in this case, the first operand is grounded and motionless, while the
                        second is grounded and consuming (by virtue of the rules for type-determined
                        usage), and this makes the function call grounded and consuming.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="category-filter"></a>8.1.4 <a href="#category-filter" style="text-decoration: none">Streamability Category: filter</a></h4>
                  <p><b>Informal description:</b> Functions in this category typically return
                     either the node supplied in the first argument or nothing, depending on the
                     values of properties that can be determined without advancing the input stream.
                     This allows access to properties such as the name and type of each node, and
                     also to its ancestors, attributes, and namespaces. </p>
                  <p><b>Rules for the function signature:</b> If
                     the declared type of the streaming parameter permits more than one node,
                     the function is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                  <p><b>Rules for the function body:</b> 
                     For the function to be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, 
                     the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture</a> of
                     the function body with respect to the declared return type must be <a title="striding" class="termref" href="#dt-striding">striding</a>, and the 
                     <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted sweep</a> of the function body 
                     with respect to the declared return type must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p><b>Rules for references to the streaming
                        parameter:</b> Such a variable reference is
                        <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p><b>Rules for function calls:</b> The <a title="posture" class="termref" href="#dt-posture">posture</a> and
                        <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a call to a function in this category are
                     determined by applying the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The
                     operands are the expressions supplied as arguments to the function call. The
                     first argument has <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                     <a title="transmission" class="termref" href="#dt-transmission">transmission</a>; any further arguments have <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the declared type of the
                     corresponding parameter in the function signature.</p>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e7054"></a>Example: Example of a filtering stylesheet function</div>
                     <p>The following function is declared as filtering, and the function body meets
                        the rules for this category because it selects nodes from the input based on
                        motionless properties (namely, the existence of attributes).</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:large-regions" as="element(region)" streamability="filter"&gt;
  &lt;xsl:param name="input" as="element(region)"/&gt;
  &lt;xsl:sequence select="$input[@size gt 1000]"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>The effect of the rules is that the posture and sweep of a function call 
                        <code>f:large-regions(EXPR)</code> are the same as the posture and sweep of <code>EXPR</code>.</p>
                     <p>Although the name <code>filter</code> suggests that the result must always
                        be a subset of the input, this is not strictly required by the rules. The
                        function can also return atomic items, as well as attribute and namespace
                        nodes.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="category-shallow-descent"></a>8.1.5 <a href="#category-shallow-descent" style="text-decoration: none">Streamability Category: shallow-descent</a></h4>
                  <p><b>Informal description:</b> Functions in this category typically return
                     children of the nodes supplied in the first argument. They may also select
                     deeper in the subtrees of these nodes, provided that no node in the result can
                     possibly be an ancestor of any other node in the result. </p>
                  <p><b>Rules for the function signature:</b> If
                     the declared type of the streaming parameter permits more than one node,
                     the function is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                  <p><b>Rules for the function body:</b> 
                     For the function to be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, 
                     the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture</a> of
                     the function body with respect to the declared return type must be <a title="striding" class="termref" href="#dt-striding">striding</a>, and the 
                     <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted sweep</a> of the function body 
                     with respect to the declared return type must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a> or <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  <p><b>Rules for references to the streaming
                        parameter:</b> Such a variable reference is
                        <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p><b>Rules for function calls:</b> The rules are as follows, in order:</p>
                  <ol class="enumar">
                     <li>
                        <p>Let <var>T<sub>0</sub></var> be the <a title="U-type" class="termref" href="#dt-utype">U-type</a> corresponding to the
                           declared type of the <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> in the
                           function signature (defaulting to <var>U{*}</var>).</p>
                     </li>
                     <li>
                        <p>Let <var>P<sub>0</sub></var> and <var>S<sub>0</sub></var> be the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture and sweep</a> of the first argument
                           expression, based on type <var>T<sub>0</sub></var>.</p>
                     </li>
                     <li>
                        <p>If <var>P<sub>0</sub></var> is not <a title="striding" class="termref" href="#dt-striding">striding</a> or <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, the function call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>
                           and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>Consider a construct <var>C</var> whose operands are the argument
                           expressions other than the first argument, with <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined operand usage</a>
                           based on the declared type of the corresponding parameter in the function
                           signature. Let <var>P<sub>1</sub></var> and <var>S<sub>1</sub></var> be the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <var>C</var>,
                           assessed using the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>.</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>If there is only one argument, then <var>P<sub>1</sub></var> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <var>S<sub>1</sub></var> is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </div>
                     </li>
                     <li>
                        <p>If <var>P<sub>1</sub></var> is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, the function call
                           is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If <var>S<sub>0</sub></var> and <var>S<sub>1</sub></var> are both <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, or if either is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, then the function
                           call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If <var>P<sub>0</sub></var> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the <a title="posture" class="termref" href="#dt-posture">posture</a> of the function call is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the function call is the wider
                           of <var>S<sub>0</sub></var> and <var>S<sub>1</sub></var>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="posture" class="termref" href="#dt-posture">posture</a> of the function call is
                              <var>P<sub>0</sub></var>, and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the function call
                           is as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>If the intersection of <var>T<sub>0</sub></var> with
                                       <var>U{document-node(), element()}</var> is empty (that is,
                                    the declared type of the first argument does not permit document
                                    or element nodes) then <var>S<sub>0</sub></var>.</p>
                           </li>
                           <li>
                              <p>Let <var>A</var> be the <a title="static type" class="termref" href="#dt-static-type">static type</a> of the
                                    expression supplied as the first argument. If the intersection
                                    of <var>A</var> with <var>U{document-node(), element()}</var> is
                                    empty (that is, the inferred type of the expression supplied as
                                    the first argument does not permit document or element nodes)
                                    then <var>S<sub>0</sub></var>.</p>
                           </li>
                           <li>
                              <p>Otherwise, <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                           </li>
                        </ol>
                     </li>
                  </ol>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e7294"></a>Example: A shallow-descent stylesheet function</div>
                     <p>The following function is declared as shallow-descent, and the function body
                        meets the rules for this category because it selects children of the
                        supplied input node.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:alternate-children" as="node()*" 
                                          streamability="shallow-descent"&gt;
  &lt;xsl:param name="input" as="element()"/&gt;
  &lt;xsl:sequence select="$input/node()[position() mod 2 = 1]"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>The effect of the rules is that a call to this function is guaranteed
                        streamable in the typical case where the node supplied as the value of
                        the <code>$input</code> argument is <a title="striding" class="termref" href="#dt-striding">striding</a> and
                           <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="category-deep-descent"></a>8.1.6 <a href="#category-deep-descent" style="text-decoration: none">Streamability Category: deep-descent</a></h4>
                  <p><b>Informal description:</b> Functions in this category typically return
                     descendants of the nodes supplied in the first argument. </p>
                  <p><b>Rules for the function signature:</b> If
                     the declared type of the streaming parameter permits more than one node,
                     the function is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                  <p><b>Rules for the function body:</b> 
                     For the function to be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, 
                     the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture</a> of
                     the function body with respect to the declared return type must be <a title="crawling" class="termref" href="#dt-crawling">crawling</a>, and the 
                     <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted sweep</a> of the function body 
                     with respect to the declared return type must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a> or <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  <p><b>Rules for references to the streaming
                        parameter:</b> Such a variable reference is
                        <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p><b>Rules for function calls:</b> The rules are as follows, in order:</p>
                  <ol class="enumar">
                     <li>
                        <p>Let <var>T<sub>0</sub></var> be the <a title="U-type" class="termref" href="#dt-utype">U-type</a> corresponding to the
                           declared type of the <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> in the
                           function signature (defaulting to <var>U{*}</var>).</p>
                     </li>
                     <li>
                        <p>Let <var>P<sub>0</sub></var> and <var>S<sub>0</sub></var> be the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture and sweep</a> of the first argument
                           expression, based on type <var>T<sub>0</sub></var>.</p>
                     </li>
                     <li>
                        <p>If <var>P<sub>0</sub></var> is not <a title="striding" class="termref" href="#dt-striding">striding</a> or <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, the function call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>
                           and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>Consider a construct <var>C</var> whose operands are the argument
                           expressions other than the first argument, with <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined operand usage</a>
                           based on the declared type of the corresponding parameter in the function
                           signature. Let <var>P<sub>1</sub></var> and <var>S<sub>1</sub></var> be the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <var>C</var>,
                           assessed using the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a></p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>If there is only one argument, then <var>P<sub>1</sub></var> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <var>S<sub>1</sub></var> is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </div>
                     </li>
                     <li>
                        <p>If <var>P<sub>1</sub></var> is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, the function call
                           is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If <var>S<sub>0</sub></var> and <var>S<sub>1</sub></var> are both <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, or if either is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, the function call
                           is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If <var>P<sub>0</sub></var> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the <a title="posture" class="termref" href="#dt-posture">posture</a> of the function call is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the function call is the wider
                           of <var>S<sub>0</sub></var> and <var>S<sub>1</sub></var>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="posture" class="termref" href="#dt-posture">posture</a> of the function call is
                              <a title="crawling" class="termref" href="#dt-crawling">crawling</a>, and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                           function call is as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>If the intersection of <var>T<sub>0</sub></var> with
                                       <var>U{document-node(), element()}</var> is empty (that is,
                                    the declared type of the first argument does not permit document
                                    or element nodes) then <var>S<sub>0</sub></var>.</p>
                           </li>
                           <li>
                              <p>Let <var>A</var> be the <a title="static type" class="termref" href="#dt-static-type">static type</a> of the
                                    expression supplied as the first argument. If the intersection
                                    of <var>A</var> with <var>U{document-node(), element()}</var> is
                                    empty (that is, the inferred type of the expression supplied as
                                    the first argument does not permit document or element nodes)
                                    then <var>S<sub>0</sub></var>.</p>
                           </li>
                           <li>
                              <p>Otherwise, <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                           </li>
                        </ol>
                     </li>
                  </ol>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e7528"></a>Example: A deep-descent stylesheet function</div>
                     <p>The following function is declared as deep-descent, and the function body
                        meets the rules for this category because it selects descendants of the
                        supplied input node.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:all-comments" as="comment()*" 
                                    streamability="deep-descent"&gt;
  &lt;xsl:param name="input" as="element()"/&gt;
  &lt;xsl:sequence select="$input//comment()"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>The effect of the rules is that a call to this function is guaranteed
                        streamable in the typical case where the node supplied as the value of
                        the <code>$input</code> argument is <a title="striding" class="termref" href="#dt-striding">striding</a> and
                           <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="category-ascent"></a>8.1.7 <a href="#category-ascent" style="text-decoration: none">Streamability Category: ascent</a></h4>
                  <p><b>Informal description:</b> Functions in this category typically return
                     ancestors of the nodes supplied in the first argument. </p>
                  <p><b>Rules for the function signature:</b> If
                     the declared type of the streaming parameter permits more than one node,
                     the function is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                  <p><b>Rules for the function body:</b> 
                     For the function to be <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, 
                     the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture</a> of
                     the function body with respect to the declared return type must be either 
                     <a title="climbing" class="termref" href="#dt-climbing">climbing</a> or <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and the 
                     <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted sweep</a> of the function body 
                     with respect to the declared return type must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p><b>Rules for references to the streaming
                        parameter:</b> Such a variable reference is
                        <a title="climbing" class="termref" href="#dt-climbing">climbing</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p><b>Rules for function calls:</b> The <a title="posture" class="termref" href="#dt-posture">posture</a> and
                        <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a call to a function in this category are
                     determined as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>Let <var>P<sub>0</sub></var> and <var>S<sub>0</sub></var> be the <a title="posture" class="termref" href="#dt-posture">posture</a>
                           and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> obtained by assessing the function call
                           using the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, where the
                           operands are the arguments to the function call, with an <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> 
                           for the first argument of <span><a title="transmission" class="termref" href="#dt-transmission">transmission</a></span>, 
                           and an <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> for
                           arguments after the first being the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the declared type of the
                           corresponding <a href="https://qt4cg.org/specifications/xslt-40/#dt-function-parameter">function parameter</a><sup><small>XT</small></sup>. 
                           </p>
                     </li>
                     <li>
                        <p>If <var>P<sub>0</sub></var> is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> or <var>S<sub>0</sub></var> is
                              <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, then the function call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If <var>S<sub>0</sub></var> is not <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, then the function
                           call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If <var>P<sub>0</sub></var> is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, then the function call
                           is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If <var>P<sub>0</sub></var> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the function call
                           is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>If the declared return type of the function does not permit nodes, then the function call
                           is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the function call is <a title="climbing" class="termref" href="#dt-climbing">climbing</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                  </ol>
                  <div class="example">
                     
                     <div class="exampleHeader"><a id="d4e7690"></a>Example: An ascending stylesheet function</div>
                     <p>The following function is declared with category <code>ascent</code>, and
                        the function body meets the rules for this category because it selects
                        ancestors of the supplied node.</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:function name="f:containing-section" as="element(section)" 
                                          streamability="ascent"&gt;
  &lt;xsl:param name="input" as="element(para)*"/&gt;
  &lt;xsl:sequence select="$input/ancestor::section[last()]"/&gt;
&lt;/xsl:function&gt;</pre>
                     </div>
                     <p>The effect of the rules is that a call to this function is guaranteed
                        streamable provided that the node supplied as the value of the
                           <code>input</code> argument is not <a title="roaming" class="termref" href="#dt-roaming">roaming</a> or
                           <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>. There are no other constraints on the
                        node supplied in the input sequence.</p>
                  </div>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="streamability-of-attribute-sets"></a>9 <a href="#streamability-of-attribute-sets" style="text-decoration: none">Streamable Attribute Sets</a></h2>
            <p>An <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">attribute set</a><sup><small>XT</small></sup> may be designated as
                  streamable by including the attribute <code>streamable="yes"</code> on each
                     <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a> declaration making up the attribute set. If
                  any <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a> declaration for an attribute set has the
                  attribute <code>streamable="yes"</code>, then every
                     <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a> declaration for that attribute set
                     <span class="verb">must</span> have the attribute <code>streamable="yes"</code>.</p>
            <p>An <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">attribute set</a><sup><small>XT</small></sup> is
                     <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> if all the following conditions are
                  satisfied:</p>
            <ol class="enumar">
               <li>
                  <p>Every <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a>
                        declaration for the attribute set has the attribute
                           <code>streamable="yes"</code>.</p>
               </li>
               <li>
                  <p>Every <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a> declaration for the attribute set
                        is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a> according to the analysis in <a href="#classifying-attribute-sets"><b>9.1 Classifying Attribute Sets</b></a>.</p>
               </li>
            </ol>
            <p>Specifying <code>streamable="yes"</code> on an
                     <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a> element declares an intent that the
                  attribute set should be streamable, either
                     because it is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, or because it takes
                     advantage of streamability extensions offered by a particular
                     processor. The consequences of declaring the attribute set to be
                  streamable when it is not in fact guaranteed streamable depend on the conformance
                  level of the processor, and are explained in <a href="#streamability-guarantees"><b>3.1 Streamability Guarantees</b></a>.</p>
            <p><a id="err-XTSE0730"><span class="error">[ERR XTSE0730] </span></a>If an <a href="../../xslt-40/Overview.html#xsl:attribute">xsl:attribute</a> set element specifies
                           <code>streamable="yes"</code> then every attribute set referenced in its
                           <code>use-attribute-sets</code> attribute (if present) must also specify
                           <code>streamable="yes"</code>.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>It is common for attribute sets to create attributes with constant values, and
                     such attribute sets will always be grounded and motionless and therefore streamable.
                     Although such cases are fairly simple for a processor to detect, references to
                     attribute sets are not guaranteed streamable unless the attribute set is
                     declared with the attribute <code>streamable="yes"</code>, which should
                     therefore be used if interoperable streaming is required.</p>
            </div>
            <div class="div2">
               
               <h3><a id="classifying-attribute-sets"></a>9.1 <a href="#classifying-attribute-sets" style="text-decoration: none">Classifying Attribute Sets</a></h3>
               <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of an <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">attribute set</a><sup><small>XT</small></sup>
               is always <a title="grounded" class="termref" href="#dt-grounded">grounded</a> (its result can never return streamed nodes).</p>
               <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of an <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">attribute set</a><sup><small>XT</small></sup>
                  is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> if all the following conditions hold:</p>
               <ol class="enumar">
                  <li>
                     <p>Every <a href="../../xslt-40/Overview.html#xsl:attribute">xsl:attribute</a> instruction within the declarations comprising the attribute set
                     is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> when assessed as described in <a href="#streamability-of-attribute-sets"><b>9 Streamable Attribute Sets</b></a>,
                  using a <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                  </li>
                  <li>
                     <p>Every attribute set referenced in the <code>use-attribute-sets</code> attribute of an <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a>
                  declaration of the attribute set has the attribute <code>streamable="yes"</code>.</p>
                  </li>
                  <li></li>
               </ol>
               <p>If the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of an <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">attribute set</a><sup><small>XT</small></sup>
                  is not <a title="motionless" class="termref" href="#dt-motionless">motionless</a> then it is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>Attribute sets will always be <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                     because they return newly constructed attribute nodes.</p>
                  <p>Attribute sets will very often be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, but if they
                     access the context item, they may be <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>. Although some attribute sets could theoretically be
                  classified as <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, this option has been excluded because
                  it is unlikely to be useful; given the requirement to create attributes whose values
                  are obtained by reading a streamed input document, use of a streamable <a href="https://qt4cg.org/specifications/xslt-40/#dt-template-rule">template rule</a><sup><small>XT</small></sup>
                  is a more versatile approach.</p>
                  <p>Because attribute sets can be overridden in another <a href="https://qt4cg.org/specifications/xslt-40/#dt-package">package</a><sup><small>XT</small></sup>, 
                    the streamability of a construct such as an
                        <a href="../../xslt-40/Overview.html#xsl:element">xsl:element</a> instruction containing a
                        <code>use-attribute-sets</code> attribute is based on the declared
                     streamability of the named attribute sets, as defined by the
                        <code>streamable</code> attribute of the <a href="../../xslt-40/Overview.html#xsl:attribute-set">xsl:attribute-set</a>
                     element. If <code>streamable="yes"</code> is specified, then there is a
                     requirement that any overriding attribute set should also specify
                        <code>streamable="yes"</code>, and a streaming processor is required to
                     check that an attribute set containing such a declaration does in fact satisfy
                     the streamability rules.</p>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="streamable-merging"></a>10 <a href="#streamable-merging" style="text-decoration: none">Streamable Merging</a></h2>
            <p>Any input to a merging operation, provided it is selected
               by means of the <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element with a
                  <code>for-each-source</code> attribute, may be designated as streamable by
               including the attribute <code>streamable="yes"</code> on the
                  <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element. </p>
            <p>When <code>streamable="yes"</code> is specified on an
                  <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element, then (whether or not streamed
               processing is actually used, and whether or not the processor supports streaming) the
               expression appearing in the <code>select</code> attribute is implicitly used as the
               argument of a call on the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-snapshot"><code>snapshot</code></a> function, which means that
               merge keys for each selected node are computed with reference to this snapshot, and
               the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-merge-group"><code>current-merge-group</code></a> function, when used within the
                  <a href="../../xslt-40/Overview.html#xsl:merge-action">xsl:merge-action</a> sequence constructor, delivers snapshots of the
               selected nodes.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>There are therefore no constraints on the navigation
                  that may be performed in computing the merge key, or in the course of evaluating
                  the <a href="../../xslt-40/Overview.html#xsl:merge-action">xsl:merge-action</a> body. An attempt to navigate outside the
                  portion of the source document delivered by the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-snapshot"><code>snapshot</code></a>
                  function will typically not cause an error, but will return empty results.</p>
               <p>There is no
                  rule to prevent the <code>select</code> expression returning atomic items, or grounded nodes from a
                  different source document, or newly constructed nodes, but they are still
                  processed using the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-snapshot"><code>snapshot</code></a> function.</p>
               <p>Because the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-snapshot"><code>snapshot</code></a> copies
                  accumulator values as described in <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#copying-accumulators">19.10 Copying Accumulator Values</a>, the
                  functions <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-before"><code>accumulator-before</code></a> and
                     <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> may be used to gain access to
                  information that is not directly available in the nodes that are present within
                  each snapshot (for example, information in a header section of the merge input
                  document).</p>
            </div>
            <p>An <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> if it satisfies all the following conditions:</p>
            <ol class="enumar">
               <li>
                  <p>The <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element has the 
                     attribute value <code>streamable="yes"</code>;</p>
               </li>
               <li>
                  <p>The <code>for-each-source</code> attribute is
                     present on that <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element;</p>
               </li>
               <li>
                  <p>The expression in the <code>select</code> attribute of that
                        <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element, assessed with a
                  <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of <a title="striding" class="termref" href="#dt-striding">striding</a>
                  and a <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> of <var>U{document-node()}</var>,
                  has <a title="striding" class="termref" href="#dt-striding">striding</a> or <a title="grounded" class="termref" href="#dt-grounded">grounded</a> <a title="posture" class="termref" href="#dt-posture">posture</a>
                     and <a title="motionless" class="termref" href="#dt-motionless">motionless</a> or <a title="consuming" class="termref" href="#dt-consuming">consuming</a> <a title="sweep" class="termref" href="#dt-sweep">sweep</a>;
                  </p>
               </li>
               <li>
                  <p>The <code>sort-before-merge</code> attribute of that
                        <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element is either absent or takes its
                     default value of <code>no</code>.</p>
               </li>
            </ol>
            <p>Specifying <code>streamable="yes"</code> on an
               <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> element declares an intent that the
                  <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> instruction should be streamable with respect to that particular source, either because it is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, or because it takes advantage of
                  streamability extensions offered by a particular processor. The
               consequences of declaring the instruction to be streamable when it is not in fact
               guaranteed streamable depend on the conformance level of the processor, and are
               explained in <a href="#streamability-guarantees"><b>3.1 Streamability Guarantees</b></a>.</p>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e8053"></a>Example: Streamed Merging</div>
               <p>The following example merges two log files, processing each of them using
                  streaming.</p>
               <div class="exampleInner">
                  <pre>
&lt;events&gt;
   &lt;xsl:merge&gt;
      &lt;xsl:merge-source for-each-source="'log-file-1.xml'" 
                        select="/events/event" 
                        streamable="yes"&gt;
         &lt;xsl:merge-key select="@timestamp"/&gt;
      &lt;/xsl:merge-source&gt;
      &lt;xsl:merge-source for-each-source="'log-files-2.xml'" 
                        select="/log/day/record" 
                        streamable="yes"&gt;
         &lt;xsl:merge-key select="dateTime(../@date, time)"/&gt;
      &lt;/xsl:merge-source&gt;
      &lt;xsl:merge-action&gt;
         &lt;events time="{current-merge-key()}"&gt;
            &lt;xsl:copy-of select="current-merge-group()"/&gt;
         &lt;/events&gt;   
      &lt;/xsl:merge-action&gt;
   &lt;/xsl:merge&gt;
&lt;/events&gt;</pre>
               </div>
            </div>
            <p>Note that the merge key for the second merge source includes data from a child
               element of the selected element and also from an attribute of the parent element.
               This works because the merge key is evaluated on the result of implicitly applying
               the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-snapshot"><code>snapshot</code></a> function.</p>
            <div class="example">
               
               <div class="exampleHeader"><a id="d4e8065"></a>Example: Merging XML and non-XML Data</div>
               <p>The following example merges two log files, one in text format and one in XML format.</p>
               <div class="exampleInner">
                  <pre>
&lt;events&gt;
   &lt;xsl:merge&gt;
      &lt;xsl:merge-source name="fax" 
                        select="unparsed-text-lines('fax-log.txt')"&gt;
         &lt;xsl:merge-key select="xs:dateTime(substring-before(., ' '))"/&gt;
      &lt;/xsl:merge-source&gt;
      &lt;xsl:merge-source name="mail"
                        for-each-source="'mail-log.xml'" 
                        select="/log/day/message" 
                        streamable="yes"&gt;
         &lt;xsl:merge-key select="dateTime(../@date, @time)"/&gt;
      &lt;/xsl:merge-source&gt;
      &lt;xsl:merge-action&gt;
         &lt;messages at="{current-merge-key()}"&gt;
            &lt;xsl:where-populated&gt;
               &lt;fax&gt;
                  &lt;xsl:for-each select="current-merge-group('fax')"&gt;
                     &lt;message xsl:expand-text="true"&gt;{
                        substring-after(., ' ')
                     }&lt;/message&gt;
                  &lt;/xsl:for-each&gt;   
               &lt;/fax&gt;
               &lt;mail&gt;
                  &lt;xsl:sequence select="current-merge-group('mail')/*"/&gt;
               &lt;/mail&gt;
            &lt;/xsl:where-populated&gt;   
         &lt;/messages&gt;   
      &lt;/xsl:merge-action&gt;
   &lt;/xsl:merge&gt;
&lt;/events&gt;</pre>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="streamability-of-accumulators"></a>11 <a href="#streamability-of-accumulators" style="text-decoration: none">Streamable Accumulators</a></h2>
            <p>Accumulators were introduced to the XSLT language specifically with the needs of
               streaming applications in mind. They allow information from a streamed source document
               (for example, the contents of a header element) to be retained for use when subsequent
               elements in the document are processed.</p>
            <p>The <code>capture</code> attribute introduced in XSLT 4.0 
                 (see <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#capturing-accumulators">19.9 Capturing Accumulators</a>)
               further increases the power of this approach.</p>
            <p>An accumulator is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> if
                  it satisfies all the following
                  conditions:</p>
            <ol class="enumar">
               <li>
                  <p>The <a href="../../xslt-40/Overview.html#xsl:accumulator">xsl:accumulator</a> declaration has the attribute
                           <code>streamable="yes"</code> (that is, it is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>).</p>
               </li>
               <li>
                  <p>In every contained <a href="../../xslt-40/Overview.html#xsl:accumulator-rule">xsl:accumulator-rule</a>, the 
                       <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup> in the <code>match</code> attribute is
                        a <a title="motionless" class="termref" href="#dt-motionless">motionless</a> pattern (see <a href="#classifying-patterns"><b>12.9 Classifying Patterns</b></a>).</p>
               </li>
               <li>
                  <p>The <a href="https://qt4cg.org/specifications/xslt-40/#dt-expression">expression</a><sup><small>XT</small></sup> in the
                           <code>initial-value</code> attribute is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and
                           <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
               </li>
               <li>
                  <p><span>In an <a href="../../xslt-40/Overview.html#xsl:accumulator-rule">xsl:accumulator-rule</a> with 
                        <code>phase="start"</code> (the default value),</span>
                        the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture and sweep</a> of
                        the <a href="https://qt4cg.org/specifications/xslt-40/#dt-expression">expression</a><sup><small>XT</small></sup> in the <code>select</code> attribute or the contained
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, with respect to the declared type of the accumulator,
                           is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
               </li>
               <li>
                  <p>In an <a href="../../xslt-40/Overview.html#xsl:accumulator-rule">xsl:accumulator-rule</a> with 
                        <code>phase="end"</code>, one of the
                        following conditions holds:</p>
                  <ol class="enumla">
                     <li>
                        <p>The rule has <code>capture="no"</code> (the default value),
                           and the <a title="type-adjusted posture and sweep" class="termref" href="#dt-type-adjusted-posture-and-sweep">type-adjusted posture and sweep</a> of
                           the <a href="https://qt4cg.org/specifications/xslt-40/#dt-expression">expression</a><sup><small>XT</small></sup> in the <code>select</code> attribute or the contained
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, with respect to the declared type of the accumulator,
                           is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>The rule has <code>capture="yes"</code>.</p>
                     </li>
                  </ol>
               </li>
            </ol>
            <p>Specifying <code>streamable="yes"</code> on an
                     <a href="../../xslt-40/Overview.html#xsl:accumulator">xsl:accumulator</a> element declares an intent that the
                  accumulator should be streamable, either
                     because it is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, or because it takes
                     advantage of streamability extensions offered by a particular
                     processor. The consequences of declaring the accumulator to be
                  streamable when it is not in fact guaranteed streamable depend on the conformance
                  level of the processor, and are explained in <a href="#streamability-guarantees"><b>3.1 Streamability Guarantees</b></a>.</p>
            <p>When an accumulator is declared to be streamable, the
                  stylesheet author must ensure that the accumulator function
                     <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> is only called at appropriate points in
                  the processing, as explained in <a href="#streamability-fn-accumulator-after"><b>12.8.1 Streamability of the accumulator-after Function</b></a>.</p>
            <p>For constructs that use accumulators to be
                        <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>:</p>
            <ul>
               <li>
                  <p>The <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-before"><code>accumulator-before</code></a> function for a streamed node can
                        be called at any time the node is available (it behaves like other
                        properties of the node such as <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-name"><code>name</code></a> or
                           <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-base-uri"><code>base-uri</code></a>).</p>
               </li>
               <li>
                  <p>The <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> function, however, is restricted
                            to appear after any instruction that reads the descendants
                        of the node in question. The constraints are expressed as static rules: see
                           <a href="#streamability-fn-accumulator-after"><b>12.8.1 Streamability of the accumulator-after Function</b></a> for more details.</p>
               </li>
            </ul>
         </div>
         <div class="div1">
            
            <h2><a id="streamability-of-constructs"></a>12 <a href="#streamability-of-constructs" style="text-decoration: none">Streamability of Specific Constructs</a></h2>
            <div class="div2">
               
               <h3><a id="maps-streaming"></a>12.1 <a href="#maps-streaming" style="text-decoration: none">Maps and Streaming</a></h3>
               <p>Maps have many uses, but their introduction to XSLT 3.0 was strongly motivated by
               streaming use cases. In essence, when a source document is processed in streaming
               mode, data that is encountered in the course of processing may need to be retained in
               variables for subsequent use, because the nodes cannot be revisited. This creates a
               need for a flexible data structure to accommodate such temporary data, and maps were
               designed to fulfil this need.</p>
               <p>The entries in a map are not allowed to contain references to 
               <a title="streamed node" class="termref" href="#dt-streamed-node">streamed nodes</a>. This is achieved by ensuring that for all constructs
            that supply content to be included in a map (for example the third argument of <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-map-put"><code>map:put</code></a>, and
               the <code>select</code> attribute of <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a>),
            the relevant operand is defined to have operand usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a>. Because maps cannot
               contain references to streamed nodes, they are effectively <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and can therefore
               be used freely in contexts (such as parameters to functions or templates) where only grounded operands
               are permitted.</p>
               <p>The <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> instruction, and the XPath <code>MapConstructor</code>
               construct, are exceptions to the general rule that during streaming, only one
               downward selection (one consuming subexpression) is permitted. They share this
               characteristic with <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a>. As with <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a>, a
               streaming processor is expected to be able to construct the map during a single pass
               of the streamed input document, which may require multiple expressions to be
               evaluated in parallel.</p>
               <p>In the case of the <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> instruction, this exemption applies only in the
               case where the instruction consists exclusively of <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a>
               (and <a href="../../xslt-40/Overview.html#xsl:fallback">xsl:fallback</a>) children, and not in more complex cases where the
               map entries are constructed dynamically (for example using a control flow implemented
               using <a href="../../xslt-40/Overview.html#xsl:choose">xsl:choose</a>, <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a>, or
                  <a href="../../xslt-40/Overview.html#xsl:call-template">xsl:call-template</a>). Such cases may, of course, be streamable
               if they only have a single consuming subexpression.</p>
               <p>For example, the following XPath expression is streamable, despite making two
               downward selections:</p>
               <div class="exampleInner">
                  <pre>
let $m := { 'price': xs:decimal(price), 'discount': xs:decimal(discount) } 
return ($m?price - $m?discount)</pre>
               </div>
               <p>Analysis:</p>
               <ol class="enumar">
                  <li>
                     <p>Because the <code>return</code> clause is motionless, the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the <code>let</code> expression is the sweep of the map
                     expression (the expression in curly brackets).</p>
                  </li>
                  <li>
                     <p>The sweep of a map expression is the maximum sweep of its key/value pairs.</p>
                  </li>
                  <li>
                     <p>For both key/value pairs, the key is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> and the
                     value is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  </li>
                  <li>
                     <p>The expression carefully atomizes both values, because
                     retaining references to streamed nodes in a map is not permitted.</p>
                  </li>
                  <li>
                     <p>Therefore the map expression, and hence the expression as a whole, is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  </li>
               </ol>
               <p>The streamability of the <a href="../../xslt-40/Overview.html#xsl:record">xsl:record</a> instruction is determined
                 by analysing the streamability of the equivalent <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> instruction 
                 as described in the definition of <a href="../../xslt-40/Overview.html#xsl:record">xsl:record</a> above.</p>
               <p>See also: <a href="#streamability-of-map-constructors"><b>12.7.17 Streamability of Map Constructors</b></a>, <a href="#streamability-xsl-map"><b>12.5.23 Streamability of xsl:map</b></a>,
                <a href="#streamability-xsl-map-entry"><b>12.5.24 Streamability of xsl:map-entry</b></a>, <a href="#streamability-xsl-record"><b>12.5.35 Streamability of xsl:record</b></a></p>
            </div>
            <div class="div2">
               
               <h3><a id="keys-and-streaming"></a>12.2 <a href="#keys-and-streaming" style="text-decoration: none">Keys and Streaming</a></h3>
               <p>Keys are not applicable to streamed documents.</p>
               <p>This is ensured by the rules for the streamability of the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-key"><code>key</code></a> function 
               (see <a href="#classifying-built-in-functions"><b>12.8 Classifying Calls to Built-In Functions</b></a>). These rules make the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of the
               third argument <a title="navigation" class="termref" href="#dt-navigation">navigation</a>, which has the consequence that when the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-key"><code>key</code></a> function
            is applied to a streamed input document, the call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, which effectively makes
            the containing construct non-streamable.</p>
            </div>
            <div class="div2">
               
               <h3><a id="grounded-consuming-constructs"></a>12.3 <a href="#grounded-consuming-constructs" style="text-decoration: none">Grounded Consuming Constructs</a></h3>
               <p>A construct is grounded if the items it delivers do not include nodes from a 
               streamed document; it is consuming if evaluation of the construct reads nodes 
               from a streamed input in a way that requires advancing the current position in the input.
            </p>
               <p>Grounded consuming constructs play an important role in streaming, and this 
               section discusses some of their characteristics.
            </p>
               <p>Examples of grounded consuming constructs (assuming the context item is a streamed node) include:
            </p>
               <ul>
                  <li>
                     <p><code>sum(.//transaction/@value)</code></p>
                  </li>
                  <li>
                     <p><code>copy-of(./account/history/event)</code></p>
                  </li>
                  <li>
                     <p><code>distinct-values(./account/@account-nr)</code></p>
                  </li>
                  <li>
                     <p><code>&lt;xsl:for-each select="transaction"&gt;&lt;t&gt;&lt;xsl:value-of select="@value"/&gt;&lt;/t&gt;&lt;/xsl:for-each&gt;</code></p>
                  </li>
               </ul>
               <p>XSLT 3.0 provides the two functions <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a> and <code>snapshot</code>
               with the explicit purpose of creating a sequence of grounded nodes, that can be processed
               one-by-one without the usual restrictions that apply to streamed processing, such as the
               rule permitting at most one downward selection. The processing style that exploits these
               functions is often called “windowed streaming”.</p>
               <p>In general the result of a grounded consuming construct is a sequence. Depending on how 
               this sequence is used, it may or may not be necessary for the processor to allocate sufficient 
               memory to hold the entire sequence. The streamability rules in this specification place few 
               constraints on how a grounded sequence is used. This is deliberate, because it gives users 
               control: by creating a grounded sequence (for example, by use of the copy-of function) 
               stylesheet authors create the possibility to process data in arbitrary ways (for example, 
               by sorting the sequence), and accept the possibility that this may consume memory.
            </p>
               <p>Pipelined evaluation of a sequence is analogous to streamed processing of a source document. 
               Pipelined evaluation occurs when the items in a sequence can be processed one-by-one, without 
               materializing the entire sequence in memory. Pipelining is a common optimization technique in 
               all functional programming languages. Operations for which pipelined evaluation is commonly 
               performed include filtering (<code>$transactions[@value gt 1000]</code>), mapping 
               (<code>$transactions!(@value - @processing-fee)</code>), and aggregation 
               (<code>sum($transactions)</code>). Operations that cannot be pipelined (because, 
               for example, the first item in the result sequence cannot be computed without knowing 
               the last item in the input sequence) include those that change the order of items 
               (<code>reverse()</code>, <code>sort()</code>). Other operations such as <code>distinct-values()</code> 
               allow the input to be processed one item at a time, but require memory that potentially 
               increases as the sequence length increases. Saving a grounded sequence in a variable is 
               also likely in many cases to require allocation of memory to hold the entire sequence.
            </p>
               <p>When the input to an operation is a grounded consuming sequence (more accurately, 
               a sequence resulting from the evaluation of a grounded consuming construct), this specification 
               does not attempt to dictate whether the operation is pipelined or not. The goal of interoperable 
               streaming in finite memory can therefore only be achieved if stylesheet authors take care to avoid 
               constructing grounded sequences that occupy large amounts of memory. In practice, however, users 
               can expect that many grounded consuming constructs will be pipelined where the semantics permit this.
            </p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>Some processors may recognize an opportunity for pipelining only if the expression
            is written in a particular way. For example the constructs <code>copy-of(/a/b/c)</code> and
            <code>/a/b/c/copy-of(.)</code> are to all intents and purposes equivalent, but some processors
            might recognize the second form more easily as suitable for pipelining.</p>
                  <p>(There is one minor difference between these expressions: the order of nodes in <code>copy-of(/a/b/c)</code>
            is required to reflect the document order of the nodes in <code>/a/b/c</code>, while the result
            of <code>/a/b/c/copy-of(.)</code> can be in any order, in consequence of the rule that document order
            for nodes in different trees is implementation-dependent.)</p>
               </div>
               <p>The use of the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-last"><code>last</code></a> function requires particular care because of
               its effect on pipelining.  The streamability rules prevent the use of <code>last()</code> in 
               conjunction with an expression that returns streamed nodes (because it would require look-ahead 
               in the stream), but there is no similar constraint for grounded sequences. So for example it 
               is not permitted (in a context that requires streaming) to write
            </p>
               <div class="exampleInner">
                  <pre>&lt;xsl:for-each select="transaction"&gt;
  &lt;xsl:value-of select="position(), ' of ', last()"/&gt;
&lt;/xsl:for-each&gt;</pre>
               </div>
               <p>but it is quite permissible to write</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:for-each select="transaction/copy-of()"&gt;
  &lt;xsl:value-of select="position(), ' of ', last()"/&gt;
&lt;/xsl:for-each&gt;</pre>
               </div>
               <p>because the call on <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a> makes the sequence grounded. This construct
               cannot be pipelined because computing the first item in the result sequence depends on knowing
               the length of the input sequence; in consequence, a processor might be obliged to buffer all
               the transactions (or their copies) in memory.
               In this simple example the impact of the call on <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-last"><code>last</code></a> is easily detected 
               both by the human reader and by the XSLT processor, but there are other cases where the effect 
               is less obvious. For example if the stylesheet executes the instruction
            </p>
               <div class="exampleInner">
                  <pre>&lt;xsl:apply-templates select="transaction/copy-of(.)"/&gt;</pre>
               </div>
               <p>then the presence of a call on <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-last"><code>last</code></a> in one of the template rules 
                  that gets invoked might not be easily spotted; yet the effect is exactly the same 
                  in preventing the result being computed by processing input items strictly one at 
                  a time. Avoiding such effects is entirely the responsibility of the stylesheet author.
               </p>
               <p>By contrast, there is no intrinsic reason why use of the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-position"><code>position</code></a> should
            prevent pipelined processing: all it requires is for the processor to count how many items have been
            processed so far. Processors may also be able to handle the construct <code>position() = last()</code>
            without storing the entire sequence in memory; rather than actually evaluating the numeric values of
            <code>position()</code> and <code>last()</code>, this can be done by testing whether the context item
            is the last item in the sequence, which only requires a one-item lookahead.</p>
            </div>
            <div class="div2">
               
               <h3><a id="classifying-sequence-constructors"></a>12.4 <a href="#classifying-sequence-constructors" style="text-decoration: none">Classifying Sequence Constructors</a></h3>
               <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a
                     <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> are determined by the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>.</p>
               <p>The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are:</p>
               <ol class="enumar">
                  <li>
                     <p>The immediately contained
                           <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instructions</a><sup><small>XT</small></sup>
                        and <a href="https://qt4cg.org/specifications/xslt-40/#dt-literal-result-element">literal result elements</a><sup><small>XT</small></sup>,
                           including any <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> or
                              <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> instructions. The <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> for these operands is <a title="transmission" class="termref" href="#dt-transmission">transmission</a>.</p>
                  </li>
                  <li>
                     <p>Any <a href="https://qt4cg.org/specifications/xslt-40/#dt-text-value-template">text value templates</a><sup><small>XT</small></sup>
                        appearing in text nodes within the sequence constructor, if text value
                        templates are enabled. The <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> for these
                        operands is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                  </li>
               </ol>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>Some consequences of these rules are:</p>
                  <ol class="enumar">
                     <li>
                        <p>An empty sequence constructor is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, and its
                              <a title="posture" class="termref" href="#dt-posture">posture</a> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                     </li>
                     <li>
                        <p>A sequence constructor containing a single instruction has the same
                              <a title="sweep" class="termref" href="#dt-sweep">sweep</a> and <a title="posture" class="termref" href="#dt-posture">posture</a> as that
                           instruction. (This means that sequence constructors containing a single instruction
                           can usefully be dropped from the construct tree.)</p>
                     </li>
                     <li>
                        <p>Informally, a sequence constructor is not streamable if it contains more
                           than one instruction that moves the position of the input stream.</p>
                     </li>
                     <li>
                        <p><a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> or <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a>
                           instructions are not treated specially. For example, there is no attempt
                           to take into account that they are mutually exclusive: if one is
                           evaluated, the other will not be evaluated. In most use cases for these
                           instructions, they will be motionless, so the additional complexity of
                           doing more advanced analysis would rarely be justified.</p>
                     </li>
                  </ol>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="classifying-instructions"></a>12.5 <a href="#classifying-instructions" style="text-decoration: none">Classifying Instructions</a></h3>
               <p>This section describes how <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instructions</a><sup><small>XT</small></sup>
                  are classified with respect to their streamability. The criteria are given first
                  for <a href="https://qt4cg.org/specifications/xslt-40/#dt-literal-result-element">literal result elements</a><sup><small>XT</small></sup> and
                     <a href="https://qt4cg.org/specifications/xslt-40/#dt-extension-instruction">extension instructions</a><sup><small>XT</small></sup>, then
                  for each XSLT instruction, listed alphabetically.</p>
               <div class="div3">
                  
                  <h4><a id="streamability-literal-result-elements"></a>12.5.1 <a href="#streamability-literal-result-elements" style="text-decoration: none">Streamability of Literal Result Elements</a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> 
                    of a <a href="https://qt4cg.org/specifications/xslt-40/#dt-literal-result-element">literal result element</a><sup><small>XT</small></sup> 
                    follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. 
                    The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> 
                    and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are:</p>
                  <ol class="enumar">
                     <li>
                        <p>The contained sequence constructor (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>Any expressions contained in 
                          <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-value-template">attribute value templates</a><sup><small>XT</small></sup> 
                          among the literal result
                           element’s attributes (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>Any <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">attribute sets</a><sup><small>XT</small></sup> named in the
                           <code>xsl:use-attribute-sets</code> attribute (usage irrelevant, but can be taken as <a title="inspection" class="termref" href="#dt-inspection">inspection</a>).</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>In practice, a reference to an attribute set that is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a> does not
                        affect the analysis, while a reference to any other attribute set makes the literal result element
                        <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                        </div>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-extension-instructions"></a>12.5.2 <a href="#streamability-extension-instructions" style="text-decoration: none">Streamability of extension instructions</a></h4>
                  <p>For a processor that recognizes an <a href="https://qt4cg.org/specifications/xslt-40/#dt-extension-instruction">extension instruction</a><sup><small>XT</small></sup>,
                     the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                     instruction are <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a>.</p>
                  <p>For a processor that does not recognize an <a href="https://qt4cg.org/specifications/xslt-40/#dt-extension-instruction">extension instruction</a><sup><small>XT</small></sup>, the <a title="posture" class="termref" href="#dt-posture">posture</a> and
                        <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the instruction are determined by applying the
                        <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. 
                    The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and 
                    their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence
                              constructors</a><sup><small>XT</small></sup> contained in any <a href="../../xslt-40/Overview.html#xsl:fallback">xsl:fallback</a>
                           children (usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>)</p>
                     </li>
                  </ol>
                  <p>Instructions in the XSLT namespace that are present under the provisions for
                        <a href="https://qt4cg.org/specifications/xslt-40/#dt-forwards-compatible-behavior">forwards compatible behavior</a><sup><small>XT</small></sup> are treated in the same way
                     as unrecognized extension instructions.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>These rules mean that if there is no <a href="../../xslt-40/Overview.html#xsl:fallback">xsl:fallback</a> child
                        instruction, the containing construct will be classified as streamable.
                        However, any attempt to execute the instruction will lead to a dynamic
                        error, so in fact, neither streamed nor unstreamed evaluation is
                        possible.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-analyze-string"></a>12.5.3 <a href="#streamability-xsl-analyze-string" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:analyze-string">xsl:analyze-string</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:analyze-string">xsl:analyze-string</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are:</p>
                  <ol class="enumar">
                     <li>
                        <p>the <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>);</p>
                     </li>
                     <li>
                        <p>the <code>regex</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>);</p>
                     </li>
                     <li>
                        <p>the sequence constructors contained in the
                              <a href="../../xslt-40/Overview.html#xsl:matching-substring">xsl:matching-substring</a> and
                              <a href="../../xslt-40/Overview.html#xsl:non-matching-substring">xsl:non-matching-substring</a> elements. These have usage
                              <a title="navigation" class="termref" href="#dt-navigation">navigation</a>, because they can be evaluated more
                           than once. The <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> for the two sequence
                           constructors is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, reflecting the fact that
                           their context item type is <code>xs:string</code>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>In practice, the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                        instruction will usually be the same as the sweep of the <code>select</code>
                        expression, and its <a title="posture" class="termref" href="#dt-posture">posture</a> will be <a title="grounded" class="termref" href="#dt-grounded">grounded</a>. Exceptions occur for example if the
                           <code>regex</code> attribute is not <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, or if
                        the contained sequence constructors refer to a grouping variable bound in a
                        contained <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-apply-imports"></a>12.5.4 <a href="#streamability-xsl-apply-imports" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:apply-imports">xsl:apply-imports</a></a></h4>
                  <p>The rules in this section apply also to <a href="../../xslt-40/Overview.html#xsl:next-match">xsl:next-match</a>.</p>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of these two
                     instructions follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The
                        <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are:</p>
                  <ol class="enumar">
                     <li>
                        <p>An implicit operand: a context item expression (<code>.</code>), with
                           usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>;</p>
                     </li>
                     <li>
                        <p>The <code>select</code> attribute or contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> of each
                              <a href="../../xslt-40/Overview.html#xsl:with-param">xsl:with-param</a> child element, with <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the type declared in the
                              <code>xsl:with-param/@as</code> attribute, or <code>item()*</code> if
                           absent.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The instruction will normally be <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, provided that nodes in a streamed document are not
                        passed as parameters to the called template rule.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-apply-templates"></a>12.5.5 <a href="#streamability-xsl-apply-templates" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a></a></h4>
                  <p>If there is no <code>select</code> attribute, the following
                     analysis assumes the presence of an implicit operand
                        <code>select="child::node()"</code>.</p>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                        <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a> instruction are the first of the
                     following that apply:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the <code>select</code> expression is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                           then the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                              <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a> instruction follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, with the <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <code>select</code> expression (the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is irrelevant, but can be taken as
                                    <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                           </li>
                           <li>
                              <p>The <code>select</code> expressions and contained sequence
                                 constructors of any child <a href="../../xslt-40/Overview.html#xsl:with-param">xsl:with-param</a> elements
                                 (usage <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined</a>, based on the type in the
                                    <code>xsl:with-param/@as</code> attribute, defaulting to
                                    <code>item()*</code>)</p>
                           </li>
                           <li>
                              <p>Any attribute value templates appearing in attributes of a child
                                    <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> instruction (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                           </li>
                           <li>
                              <p>The <code>select</code> expression or contained sequence
                                 constructor of any <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> children, assessed
                                 with a <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of <a title="grounded" class="termref" href="#dt-grounded">grounded</a> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                           </li>
                        </ol>
                        <p>For example, <code>&lt;xsl:apply-templates
                              select="copy-of(.)"/&gt;</code> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and
                              <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                     </li>
                     <li>
                        <p>If there is an <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> child element, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If the implicit or explicit <code>mode</code> attribute identifies a
                              <a href="https://qt4cg.org/specifications/xslt-40/#dt-mode">mode</a><sup><small>XT</small></sup> that is not declared with
                              <code>streamable="yes"</code>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>. </p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>When <code>mode="#current"</code> is specified, this is treated as
                              equivalent to specifying a streamable mode; although it is not known
                              statically what the mode will be, it is always the case that if the
                              template is invoked with a streamed node as the context item, then the
                              current mode must be a streamable mode.</p>
                        </div>
                     </li>
                     <li>
                        <p>If the <code>select</code> expression is <a title="climbing" class="termref" href="#dt-climbing">climbing</a> or
                              <a title="crawling" class="termref" href="#dt-crawling">crawling</a>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and
                              <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a></p>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                           of the <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a> instruction follow the
                              <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>The (explicit or implicit) <code>select</code> expression, with
                                 usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>; </p>
                           </li>
                           <li>
                              <p>The <code>select</code> attribute or contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> of each
                                    <a href="../../xslt-40/Overview.html#xsl:with-param">xsl:with-param</a> child element, with <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the type declared in
                                 the <code>xsl:with-param/@as</code> attribute, or
                                    <code>item()*</code> if absent.</p>
                           </li>
                        </ol>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-assert"></a>12.5.6 <a href="#streamability-xsl-assert" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:assert">xsl:assert</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:assert">xsl:assert</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>test</code> expression (usage <a title="inspection" class="termref" href="#dt-inspection">inspection</a>)</p>
                     </li>
                     <li>
                        <p>The <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>error-code</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-attribute"></a>12.5.7 <a href="#streamability-xsl-attribute" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:attribute">xsl:attribute</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:attribute">xsl:attribute</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>name</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>namespace</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>separator</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-break"></a>12.5.8 <a href="#streamability-xsl-break" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:break">xsl:break</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:break">xsl:break</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> expression (usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-call-template"></a>12.5.9 <a href="#streamability-xsl-call-template" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:call-template">xsl:call-template</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:call-template">xsl:call-template</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>Unless the referenced template has a child
                              <a href="../../xslt-40/Overview.html#xsl:context-item">xsl:context-item</a> element with the attribute
                              <code>use="prohibited"</code>, there is an implicit operand, a context
                           item expression (<code>.</code>): its <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                           is the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the type
                           declared in the <code>xsl:context-item/@as</code> attribute of the target
                           named template, defaulting to <code>item()*</code> if absent.</p>
                     </li>
                     <li>
                        <p>The <code>select</code> expression or sequence constructor content of any
                           contained <a href="../../xslt-40/Overview.html#xsl:with-param">xsl:with-param</a> child element: its <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the type declared in the
                              <code>xsl:with-param/@as</code> attribute, or the
                              <code>xsl:param/@as</code> attribute of the corresponding parameter on
                           the target named template, whichever is more restrictive, defaulting to
                              <code>item()*</code> if both are absent.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Calling <a href="../../xslt-40/Overview.html#xsl:call-template">xsl:call-template</a> will usually make stylesheet code
                        unstreamable if a streamed node is passed explicitly or implicitly to the
                        called template, unless it is atomized by declaring the expected type to be
                        atomic.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-choose"></a>12.5.10 <a href="#streamability-xsl-choose" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:choose">xsl:choose</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:choose">xsl:choose</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. 
                     The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their 
                     <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>test</code> attribute of contained <a href="../../xslt-40/Overview.html#xsl:when">xsl:when</a>
                           elements (usage <a title="inspection" class="termref" href="#dt-inspection">inspection</a>).</p>
                     </li>
                     <li>
                        <p>The sequence constructors <span>and <code>select</code> expressions</span>
                           contained within <a href="../../xslt-40/Overview.html#xsl:when">xsl:when</a> and
                              <a href="../../xslt-40/Overview.html#xsl:otherwise">xsl:otherwise</a> child elements (usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>). 
                           These  operands form a
                              <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The effect is to allow either of the following:</p>
                     <ol class="enumar">
                        <li>
                           <p>Any or all of the sequence constructors <span>and <code>select</code> expressions</span>
                              in <a href="../../xslt-40/Overview.html#xsl:when">xsl:when</a> and
                                 <a href="../../xslt-40/Overview.html#xsl:otherwise">xsl:otherwise</a> branches may be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>,  in
                              which case the <code>test</code> expressions must all be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </li>
                        <li>
                           <p>Any one of the <code>test</code> expressions may be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, 
                              in which case all the other <code>test</code> expressions, and all the 
                              sequence constructors <span>and <code>select</code> expressions</span>, 
                              must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-comment"></a>12.5.11 <a href="#streamability-xsl-comment" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:comment">xsl:comment</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:comment">xsl:comment</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-copy"></a>12.5.12 <a href="#streamability-xsl-copy" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:copy">xsl:copy</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:copy">xsl:copy</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The expression in the <code>select</code> attribute, defaulting to a
                           context item expression (<code>.</code>) (usage <a title="inspection" class="termref" href="#dt-inspection">inspection</a>)</p>
                     </li>
                     <li>
                        <p>The contained sequence constructor (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>), assessed with <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> and context item
                           type based on the <code>select</code> expression if present, or the outer
                           focus otherwise.</p>
                     </li>
                     <li>
                        <p>Any <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">attribute sets</a><sup><small>XT</small></sup> named in the
                           <code>use-attribute-sets</code> attribute (usage irrelevant, but can be taken as <a title="inspection" class="termref" href="#dt-inspection">inspection</a>).</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>In practice, a reference to an attribute set that is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a> does not
                           affect the analysis, while a reference to any other attribute set makes the <a href="../../xslt-40/Overview.html#xsl:copy">xsl:copy</a> instruction
                           <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                        </div>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The effect of these rules is that when a <code>select</code>
                     attribute is present, the sequence constructor contained by the <a href="../../xslt-40/Overview.html#xsl:copy">xsl:copy</a>
                     instruction is deemed to be a <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> of the instruction,
                     even though it can only be evaluated once.</p>
                     <p>This has the practical consequence that the following example is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>,
                  even though it is possible to imagine a strategy for streamed evaluation:</p>
                     <div class="exampleInner">
                        <pre>
 &lt;xsl:for-each-group select="product" group-adjacent="@category"&gt;
     &lt;xsl:copy select=".."&gt;
         &lt;xsl:copy-of select="current-group()"/&gt;
     &lt;/xsl:copy&gt;
 &lt;/xsl:for-each-group&gt;</pre>
                     </div>
                     <p>A workaround in this case might be to rewrite the code as follows:</p>
                     <div class="exampleInner">
                        <pre>
 &lt;xsl:for-each-group select="product" group-adjacent="@category"&gt;
     &lt;xsl:element name="{name(..)}" namespace="{namespace-uri(..)}"&gt;
         &lt;xsl:copy-of select="current-group()"/&gt;
     &lt;/xsl:element&gt;
 &lt;/xsl:for-each-group&gt;</pre>
                     </div>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-copy-of"></a>12.5.13 <a href="#streamability-xsl-copy-of" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:copy-of">xsl:copy-of</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:copy-of">xsl:copy-of</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-document"></a>12.5.14 <a href="#streamability-xsl-document" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:document">xsl:document</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:document">xsl:document</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-element"></a>12.5.15 <a href="#streamability-xsl-element" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:element">xsl:element</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:element">xsl:element</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>name</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>namespace</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>Any <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-set">attribute sets</a><sup><small>XT</small></sup> named in the
                           <code>use-attribute-sets</code> attribute (usage irrelevant, but can be taken as <a title="inspection" class="termref" href="#dt-inspection">inspection</a>).</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>In practice, a reference to an attribute set that is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a> does not
                           affect the analysis, while a reference to any other attribute set makes the <a href="../../xslt-40/Overview.html#xsl:element">xsl:element</a> instruction
                           <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                        </div>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-evaluate"></a>12.5.16 <a href="#streamability-xsl-evaluate" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:evaluate">xsl:evaluate</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:evaluate">xsl:evaluate</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>xpath</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>context-item</code> expression (usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a>)</p>
                     </li>
                     <li>
                        <p>The <code>with-params</code> expression (usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a>)</p>
                     </li>
                     <li>
                        <p>The <code>base-uri</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>namespace-context</code> expression (usage <a title="inspection" class="termref" href="#dt-inspection">inspection</a>)</p>
                     </li>
                     <li>
                        <p>The <code>schema-aware</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>select</code> attributes and contained 
                          <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructors</a><sup><small>XT</small></sup> of any
                              <a href="../../xslt-40/Overview.html#xsl:with-param">xsl:with-param</a> child elements (usage <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined</a>, based on the
                           type in the <code>xsl:with-param/@as</code> attribute, defaulting to
                              <code>item()*</code>)</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>In practice, code containing an <a href="../../xslt-40/Overview.html#xsl:evaluate">xsl:evaluate</a> instruction
                        will usually be streamable provided that streamed nodes are not passed to
                        the dynamic expression either as the context item or as the value of a
                        parameter.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-fallback"></a>12.5.17 <a href="#streamability-xsl-fallback" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:fallback">xsl:fallback</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                        <a href="../../xslt-40/Overview.html#xsl:fallback">xsl:fallback</a> instruction depend on whether the processor is
                     performing fallback (which is known statically).</p>
                  <p>If the processor is performing fallback, then the <a title="posture" class="termref" href="#dt-posture">posture</a>
                     and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the <a href="../../xslt-40/Overview.html#xsl:fallback">xsl:fallback</a> instruction
                     are the posture and sweep of the contained sequence constructor.</p>
                  <p>If the processor is not performing fallback, then the instruction is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-for-each"></a>12.5.18 <a href="#streamability-xsl-for-each" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                        <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction are the first of the following
                     that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the <code>select</code> expression is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                           then the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                              <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, with the <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <code>select</code> expression (the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is irrelevant, but can be taken as
                                    <a title="inspection" class="termref" href="#dt-inspection">inspection</a>)</p>
                           </li>
                           <li>
                              <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage
                                    <a title="transmission" class="termref" href="#dt-transmission">transmission</a>). This is a <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a>;
                                 its context posture is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                           </li>
                           <li>
                              <p>Any attribute value templates appearing in attributes of a child
                                    <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> instruction (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                           </li>
                           <li>
                              <p>The <code>select</code> expression or contained sequence
                                 constructor of any <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> children, assessed
                                 with a <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of <a title="grounded" class="termref" href="#dt-grounded">grounded</a> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).
                                 These are <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order
                                    operands</a>; their context posture is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>If there is an <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> child element, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If the <a title="posture" class="termref" href="#dt-posture">posture</a> of the
                              <code>select</code> expression is <a title="crawling" class="termref" href="#dt-crawling">crawling</a> and the
                              <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, then
                              <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>. </p>
                     </li>
                     <li>
                        <p>Otherwise:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the instruction is the <a title="posture" class="termref" href="#dt-posture">posture</a> of the contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, assessed with the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a>
                                 and context item type set to the <a title="posture" class="termref" href="#dt-posture">posture</a> and
                                 type of the <code>select</code> expression.</p>
                           </li>
                           <li>
                              <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the instruction is the wider of
                                 the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the <code>select</code> expression
                                 and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the contained 
                                <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>.</p>
                              <div class="note">
                                 <p class="prefix"><b>Note:</b></p>
                                 <p>The ordering of sweep values is in increasing order: <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, <a title="consuming" class="termref" href="#dt-consuming">consuming</a>,
                                       <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                              </div>
                           </li>
                        </ol>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>Because the body of the <a href="../../xslt-40/Overview.html#xsl:for-each">xsl:for-each</a> instruction is a
                                 <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> of the instruction, any
                              variable reference within the body that is bound to a 
                             <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> of a containing <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet function</a><sup><small>XT</small></sup> will not be singular, which in many
                              cases will make the entire function non-streamable.</p>
                        </div>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-for-each-group"></a>12.5.19 <a href="#streamability-xsl-for-each-group" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                        <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction are the first of the
                     following that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the <code>select</code> expression is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                           then the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                              <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, with the <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <code>select</code> expression (the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is irrelevant, but can be taken as
                                    <a title="inspection" class="termref" href="#dt-inspection">inspection</a>)</p>
                           </li>
                           <li>
                              <p>The <code>collation</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                           </li>
                           <li>
                              <p>Any attribute value templates appearing in attributes of a child
                                    <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> instruction (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                           </li>
                           <li>
                              <p>The <code>group-by</code> or <code>group-adjacent</code>
                                 expression, assessed with a <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of
                                    <a title="grounded" class="termref" href="#dt-grounded">grounded</a> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                           </li>
                           <li>
                              <p>The <code>select</code> expression or contained sequence
                                 constructor of any <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> children, assessed
                                 with a <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of <a title="grounded" class="termref" href="#dt-grounded">grounded</a> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                           </li>
                           <li>
                              <p>The <code>group-starting-with</code> or
                                    <code>group-ending-with</code> patterns if present; these are
                                    <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order
                                    operands</a> with usage <a title="inspection" class="termref" href="#dt-inspection">inspection</a>.</p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>If there is a <code>group-by</code> attribute and the instruction is not a child of
                                 <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If there is a <code>group-by</code>
                              or
                           <code>group-adjacent</code> attribute that is not <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If there is an <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> child element 
                           and the instruction is not a child of <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If the <a title="posture" class="termref" href="#dt-posture">posture</a> of the
                              <code>select</code> expression is <a title="crawling" class="termref" href="#dt-crawling">crawling</a> and the
                              <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the contained 
                          <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, then
                              <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the instruction is the <a title="posture" class="termref" href="#dt-posture">posture</a> of 
                                the contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, assessed with the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a>
                                 and context item type set to the <a title="posture" class="termref" href="#dt-posture">posture</a> and
                                 type of the <code>select</code> expression.</p>
                           </li>
                           <li>
                              <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the instruction is the wider of
                                 the <a title="sweep" class="termref" href="#dt-sweep">sweeps</a> of the
                                    <code>select</code> expression and the contained 
                                <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, where the ordering of
                                 increasing width is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                           </li>
                        </ol>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>Because the body of the <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a>
                              instruction is a <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> of the
                              instruction, any variable reference within the body that is bound to a
                                 <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> of a containing 
                             <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet function</a><sup><small>XT</small></sup> will not be singular, which in many
                              cases will make the entire function non-streamable.</p>
                        </div>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The above rules do not explicitly mention any
                        constraints on the presence or absence of a call on the
                           <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-group"><code>current-group</code></a> function. In practice, however, this
                        plays an important role. In the most common case, the <code>select</code>
                        expression of <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> is likely to be striding,
                        for example an expression such as <code>select="*"</code>. Any call on
                           <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-group"><code>current-group</code></a> associated with this
                           <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction will ordinarily be
                           <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, which is
                        consistent with streaming provided there is only one such call, and if it
                        appears in a suitable context (for example, not within a predicate). If
                        there is more than one call, or if it appears in an unsuitable context (for
                        example, within a predicate), then this will have the same effect as
                        multiple appearances of other consuming expressions: the construct as a
                        whole will be free-ranging. These rules are not spelled out explicitly, but
                        rather emerge as a consequence of the general streamability rules.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-fork"></a>12.5.20 <a href="#streamability-xsl-fork" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a> are the first of the following that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If there is a child <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction, then
                           the <a title="posture" class="termref" href="#dt-posture">posture</a> and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of that
                           instruction.</p>
                     </li>
                     <li>
                        <p>If there are no child <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a> instructions (other than
                              <a href="../../xslt-40/Overview.html#xsl:fallback">xsl:fallback</a>), then <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and
                              <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>If there is a child <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a> instruction whose
                              <a title="posture" class="termref" href="#dt-posture">posture</a> is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then
                              <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="posture" class="termref" href="#dt-posture">posture</a> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is the widest sweep of the
                              <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a> child instructions.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>None of the branches of <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a> can return streamed nodes.
                        The reason for this is that <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a> has to assemble its
                        results in the correct order, and streamed nodes cannot be re-ordered.</p>
                     <p>The effect of the rules is that each of the child
                           <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a> instructions can independently consume the
                        streamed input document, provided that the result of each child instruction
                        is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                     <p>Thus the following example is streamable:</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:fork&gt;
   &lt;xsl:sequence select="copy-of(author)"/&gt;
   &lt;xsl:sequence select="copy-of(editor)"/&gt;
&lt;/xsl:fork&gt;</pre>
                     </div>
                     <p>While the following is not streamable, because it returns streamed nodes in
                        an order that might not be document order:</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:fork&gt;
   &lt;xsl:sequence select="author"/&gt;
   &lt;xsl:sequence select="editor"/&gt;
&lt;/xsl:fork&gt;</pre>
                     </div>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-if"></a>12.5.21 <a href="#streamability-xsl-if" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:if">xsl:if</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:if">xsl:if</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>test</code> expression (usage <a title="inspection" class="termref" href="#dt-inspection">inspection</a>)</p>
                     </li>
                     <li>
                        <p>The <code>then</code> and <code>else</code> expressions and the 
                           contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>).
                        These operands form a <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a></p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The effect is to allow either of the following:</p>
                     <ol class="enumar">
                        <li>
                           <p>The <code>test</code> expression may be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, in which case any or all
                        of the <code>then</code> and <code>else</code> expressions, and the containing sequence constructor, may
                        be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                        </li>
                        <li>
                           <p>The <code>test</code> expression may be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, in which case
                           the <code>then</code> and <code>else</code> expressions, and the containing sequence constructor, must
                           all be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-iterate"></a>12.5.22 <a href="#streamability-xsl-iterate" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                        <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> instruction are the first of the following that
                     applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the <code>select</code> expression is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                           then the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                              <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> instruction follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, with the <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <code>select</code> expression (the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is irrelevant, but can be taken as
                                    <a title="inspection" class="termref" href="#dt-inspection">inspection</a>)</p>
                           </li>
                           <li>
                              <p>The <code>select</code> expression or contained sequence
                                 constructor of any <a href="../../xslt-40/Overview.html#xsl:param">xsl:param</a> children (usage
                                    <a title="navigation" class="termref" href="#dt-navigation">navigation</a>)</p>
                           </li>
                           <li>
                              <p>The sequence constructor contained within the
                                    <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> instruction itself, assessed with
                                 its context item type and <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> based
                                 on the <code>select</code> expression (usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>)</p>
                           </li>
                           <li>
                              <p>The <code>select</code> expression or contained sequence
                                 constructor of any child <a href="../../xslt-40/Overview.html#xsl:on-completion">xsl:on-completion</a>
                                 element, assessed with a context item type of <code>xs:error</code>
                                 and a <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of <a title="roaming" class="termref" href="#dt-roaming">roaming</a> to reflect the fact that any attempt to
                                 reference the context item within the
                                    <a href="../../xslt-40/Overview.html#xsl:on-completion">xsl:on-completion</a> element is an error (usage
                                    <a title="transmission" class="termref" href="#dt-transmission">transmission</a>)</p>
                              <div class="note">
                                 <p class="prefix"><b>Note:</b></p>
                                 <p>The <code>on-completion</code>
                                    element can cause the instruction to become non-streamable if,
                                    for example, it contains a call on
                                       <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-group"><code>current-group</code></a> or a variable reference
                                    bound to a <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a>.</p>
                              </div>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>If there is an <a href="../../xslt-40/Overview.html#xsl:param">xsl:param</a> child whose initializing
                              <code>select</code> expression or 
                          <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>
                           and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and
                              <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If there is an <a href="../../xslt-40/Overview.html#xsl:on-completion">xsl:on-completion</a> child whose
                              <code>select</code> expression or <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>
                           and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and
                              <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If the <a title="posture" class="termref" href="#dt-posture">posture</a> of the
                              <code>select</code> expression is <a title="crawling" class="termref" href="#dt-crawling">crawling</a> and the
                              <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, then
                              <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the instruction is the <a title="posture" class="termref" href="#dt-posture">posture</a> of the contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, assessed with the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a>
                                 and context item type set to the <a title="posture" class="termref" href="#dt-posture">posture</a> and
                                 type of the <code>select</code> expression.</p>
                           </li>
                           <li>
                              <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the instruction is the wider of
                                 the <a title="sweep" class="termref" href="#dt-sweep">sweeps</a> of the <code>select</code> expression and the
                                    contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>,
                                 where the ordering of increasing width is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                           </li>
                        </ol>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>If any <a href="../../xslt-40/Overview.html#xsl:break">xsl:break</a> or <a href="../../xslt-40/Overview.html#xsl:next-iteration">xsl:next-iteration</a>
                        instructions appear within the sequence constructor, their <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> will be assessed in the
                        course of evaluating the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the sequence constructor, by reference to the rules
                        in <a href="#streamability-xsl-break"><b>12.5.8 Streamability of xsl:break</b></a> and <a href="#streamability-xsl-next-iteration"><b>12.5.28 Streamability of xsl:next-iteration</b></a> respectively.</p>
                  </div>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Because the body of the <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> instruction is a
                           <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> of the instruction, any variable
                        reference within the body that is bound to a <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> 
                       of a containing <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet function</a><sup><small>XT</small></sup> will not be singular, which in many cases
                        will make the entire function non-streamable.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-map"></a>12.5.23 <a href="#streamability-xsl-map" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a></a></h4>
                  <div class="changes">
                     <p class="changesHeading">
        Changes in 4.0
        (<a href="#determining-static-type">previous</a>)</p>
                     <ol>
                        <li>
                           <p>The special rule allowing <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a>
                      to have multiple consumable operands does not apply if duplicate keys are
                     permitted.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2036">2036</a>&nbsp;]</i></p>
                        </li>
                     </ol>
                  </div>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> instruction are determined
                     by the first of the following that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the sequence constructor within the instruction consists exclusively
                           of <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a> instructions (and
                              <a href="../../xslt-40/Overview.html#xsl:fallback">xsl:fallback</a> instructions, which are ignored),
                           and the <code>duplicates</code> attribute is absent,
                           then:</p>
                        <ol class="enumla">
                           <li>
                              <p>If any of these <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a> children is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> or <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, then
                                    <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>;</p>
                           </li>
                           <li>
                              <p>Otherwise, <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and the widest sweep of the
                                    <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a> children.</p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                           of the <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> instruction are the posture and sweep of
                           the contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>See discussion in <a href="#maps-streaming"><b>12.1 Maps and Streaming</b></a>.</p>
                     <p>The effect of the rules is that it is possible to compute multiple map
                        entries in a single pass of the streamed input document. For example, the
                        following is streamable:</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:map&gt;
  &lt;xsl:map-entry key="'authors'" select="copy-of(author)"/&gt;
  &lt;xsl:map-entry key="'editors'" select="copy-of(editor)"/&gt;
&lt;/xsl:map&gt;</pre>
                     </div>
                     <p>The call on <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a> is necessary to ensure that the
                        content of the map entry is grounded; it is not possible to create a map
                        whose entries contain references to streamed nodes.</p>
                     <p>This rule does not apply when duplicate keys are permitted, because in that
                     situation the child <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a> instructions generally need
                     to be evaluated in the order they are written, rather than in the order their
                     operands are encountered.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-map-entry"></a>12.5.24 <a href="#streamability-xsl-map-entry" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>key</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>select</code> expression (usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a>)</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>This effectively means that the <code>select</code>
                              expression must not return nodes from a streamed input document.</p>
                        </div>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>
                           (usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-merge"></a>12.5.25 <a href="#streamability-xsl-merge" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a></a></h4>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This section is concerned with the (not very interesting) impact of the
                           <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> instruction on the streamability of its
                        containing template rule or <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction.</p>
                     <p>For the (more important) rules concerning the way in which
                           <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> performs streamed processing of its own
                        inputs, see <a href="#streamable-merging"><b>10 Streamable Merging</b></a>.</p>
                  </div>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>If every <a href="../../xslt-40/Overview.html#xsl:merge-source">xsl:merge-source</a> child element satisfies all
                           the following conditions:</p>
                        <ol class="enumla">
                           <li>
                              <p>The expression in the <code>for-each-item</code> attribute is
                                 either absent, or <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>;</p>
                           </li>
                           <li>
                              <p>The expression in the <code>for-each-source</code> attribute is
                                 either absent, or <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>;</p>
                           </li>
                           <li>
                              <p>Either at least one of the attributes <code>for-each-item</code>
                                 and <code>for-each-source</code> is present, or the expression in
                                 the <code>select</code> attribute is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>
                                 and <a title="motionless" class="termref" href="#dt-motionless">motionless</a></p>
                           </li>
                        </ol>
                        <p>then the <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> instruction is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> instruction is 
                           <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-message"></a>12.5.26 <a href="#streamability-xsl-message" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:message">xsl:message</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:message">xsl:message</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>terminate</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>error-code</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-namespace"></a>12.5.27 <a href="#streamability-xsl-namespace" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:namespace">xsl:namespace</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:namespace">xsl:namespace</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>name</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-next-iteration"></a>12.5.28 <a href="#streamability-xsl-next-iteration" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:next-iteration">xsl:next-iteration</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:next-iteration">xsl:next-iteration</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> expression or <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> content of any contained
                              <a href="../../xslt-40/Overview.html#xsl:with-param">xsl:with-param</a> child element: its <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the type declared in the
                              <code>xsl:with-param/@as</code> attribute, or the
                              <code>xsl:param/@as</code> attribute of the corresponding parameter on
                           the containing <a href="../../xslt-40/Overview.html#xsl:iterate">xsl:iterate</a> instruction, whichever is
                           more restrictive, defaulting to <code>item()*</code> if both are
                           absent.</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-next-match"></a>12.5.29 <a href="#streamability-xsl-next-match" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:next-match">xsl:next-match</a></a></h4>
                  <p>The rules are the same as for <a href="../../xslt-40/Overview.html#xsl:apply-imports">xsl:apply-imports</a>: see <a href="#streamability-xsl-apply-imports"><b>12.5.4 Streamability of xsl:apply-imports</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-number"></a>12.5.30 <a href="#streamability-xsl-number" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:number">xsl:number</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:number">xsl:number</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>value</code> attribute if present: usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a></p>
                     </li>
                     <li>
                        <p>The <code>select</code> attribute if there is
                           no <code>value</code> attribute, defaulting to the context item
                           expression (<code>.</code>) if the <code>select</code> attribute is also
                           absent: usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a></p>
                     </li>
                     <li>
                        <p>The attribute value templates in the <code>format</code>,
                              <code>lang</code>, <code>letter-value</code>, <code>ordinal</code>,
                              <code>start-at</code>, <code>grouping-separator</code>, and
                              <code>grouping-size</code> attributes (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>from</code> and <code>count</code> patterns if present. These can be treated as <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operands</a> with
                              usage <a title="inspection" class="termref" href="#dt-inspection">inspection</a>, though neither of these
                              properties affects the outcome.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The effect of these rules is that <a href="../../xslt-40/Overview.html#xsl:number">xsl:number</a> can be used
                        for formatting of numbers supplied directly using the <code>value</code>
                        attribute, and also for numbering of nodes in a non-streamed document, but
                        it cannot be used for numbering streamed nodes.</p>
                     <p>In practice the rules depend very little on the <code>from</code> and
                           <code>count</code> patterns. This is because when the instruction is
                        applied to a streamed node, the instruction will be <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> regardless of these patterns; while if it is
                        applied to a grounded node or atomic item, the instruction will normally be
                           <a title="motionless" class="termref" href="#dt-motionless">motionless</a> regardless of the values of these
                        patterns. The pattern does matter,
                           however, if it contains a variable reference bound to a <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a>;
                           because such a reference occurs within a <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> of the <a href="../../xslt-40/Overview.html#xsl:number">xsl:number</a>
                           instruction, its presence automatically makes the variable reference
                              <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, which in turn ensures that the
                           containing stylesheet function is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-on-empty"></a>12.5.31 <a href="#streamability-xsl-on-empty" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a></a></h4>
                  <p>The streamability rules for the <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> instruction are
                     the same as the rules for <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a>: see <a href="#streamability-xsl-sequence"><b>12.5.37 Streamability of xsl:sequence</b></a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The streamability rules for a sequence constructor containing an
                           <a href="../../xslt-40/Overview.html#xsl:on-empty">xsl:on-empty</a> instruction are given in <a href="#classifying-sequence-constructors"><b>12.4 Classifying Sequence Constructors</b></a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-on-non-empty"></a>12.5.32 <a href="#streamability-xsl-on-non-empty" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a></a></h4>
                  <p>The streamability rules for the <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> instruction
                     are the same as the rules for <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a>: see <a href="#streamability-xsl-sequence"><b>12.5.37 Streamability of xsl:sequence</b></a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The streamability rules for a sequence constructor containing an
                           <a href="../../xslt-40/Overview.html#xsl:on-non-empty">xsl:on-non-empty</a> instruction are given in <a href="#classifying-sequence-constructors"><b>12.4 Classifying Sequence Constructors</b></a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-perform-sort"></a>12.5.33 <a href="#streamability-xsl-perform-sort" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:perform-sort">xsl:perform-sort</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:perform-sort">xsl:perform-sort</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The expression in the <code>select</code> attribute: usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a> (because order is not preserved)</p>
                     </li>
                     <li>
                        <p>The expressions in the attribute value templates of
                              <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> child elements: usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a></p>
                     </li>
                     <li>
                        <p>The expression in the <code>select</code> attribute or contained sequence constructor in child
                              <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> child elements, with usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, assessed with <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> based on the
                           expression in the <code>xsl:perform-sort/@select</code> attribute.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>In practice, the <a href="../../xslt-40/Overview.html#xsl:perform-sort">xsl:perform-sort</a> instruction cannot be
                        used to sort nodes from the streamed input document, but it can be used to
                        sort atomic items or <a title="grounded" class="termref" href="#dt-grounded">grounded</a> nodes, for example a copy
                        of nodes from the streamed document made using the
                           <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a> function.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-processing-instruction"></a>12.5.34 <a href="#streamability-xsl-processing-instruction" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:processing-instruction">xsl:processing-instruction</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:processing-instruction">xsl:processing-instruction</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>name</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-record"></a>12.5.35 <a href="#streamability-xsl-record" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:record">xsl:record</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the <a href="../../xslt-40/Overview.html#xsl:record">xsl:record</a> instruction are determined
                        by the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the equivalent <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> instruction 
                        as described in the definition of <a href="../../xslt-40/Overview.html#xsl:record">xsl:record</a></p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-result-document"></a>12.5.36 <a href="#streamability-xsl-result-document" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:result-document">xsl:result-document</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:result-document">xsl:result-document</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>href</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The attribute value templates containing serialization properties (usage
                              <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-sequence"></a>12.5.37 <a href="#streamability-xsl-sequence" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:sequence">xsl:sequence</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> attribute value template (usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-stream"></a>12.5.38 <a href="#streamability-xsl-stream" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a></a></h4>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The concern here is with the impact of <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> on any
                        streaming template, or ancestor <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction, and
                        not with the streamed processing of the document accessed using the
                           <code>xsl:source-document/@href</code> attribute.</p>
                     <p>The streamability of the document opened by the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a>
                        instruction is not assessed using the rules in this section; it depends only
                        on the streamability properties of the contained sequence constructor, as
                        described in <a href="#source-document-streamability"><b>4.1 Streamability of xsl:source-document</b></a>.</p>
                  </div>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> are the first of the following that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the contained sequence constructor contains, at any depth, a call on the
                                 <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-group"><code>current-group</code></a> function whose nearest
                              containing <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction
                           exists and is an ancestor of the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction,
                           then <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If the contained sequence constructor contains, at any depth, a call on the
                                 <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-merge-group"><code>current-merge-group</code></a> function whose nearest
                              containing <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a> instruction exists and
                           is an ancestor of the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction, then
                              <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="posture" class="termref" href="#dt-posture">posture</a> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                           the <code>href</code> attribute value template.</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-switch"></a>12.5.39 <a href="#streamability-xsl-switch" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:switch">xsl:switch</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                     <a href="../../xslt-40/Overview.html#xsl:switch">xsl:switch</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. 
                     The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their 
                     <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> attribute of the <a href="../../xslt-40/Overview.html#xsl:switch">xsl:switch</a>
                           elements (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                     <li>
                        <p>The <code>test</code> attribute of contained <a href="../../xslt-40/Overview.html#xsl:when">xsl:when</a>
                           elements (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                     <li>
                        <p>The sequence constructors and <code>select</code> expressions
                           contained within <a href="../../xslt-40/Overview.html#xsl:when">xsl:when</a> and
                           <a href="../../xslt-40/Overview.html#xsl:otherwise">xsl:otherwise</a> child elements (usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>). 
                           These operands form a
                           <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The effect is to allow any of the following:</p>
                     <ol class="enumar">
                        <li>
                           <p>The <code>select</code> expression of the <a href="../../xslt-40/Overview.html#xsl:switch">xsl:switch</a> instruction may be
                              <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, in
                              which case all the other operands must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </li>
                        <li>
                           <p>Any one of the <code>test</code> expressions may be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, 
                              in which case all the other operands must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </li>
                        <li>
                           <p>Any or all of the sequence constructors and <code>select</code> expressions
                              in <a href="../../xslt-40/Overview.html#xsl:when">xsl:when</a> and
                              <a href="../../xslt-40/Overview.html#xsl:otherwise">xsl:otherwise</a> branches may be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>,  in
                              which case the <code>test</code> expressions and the <code>select</code> of
                              the <a href="../../xslt-40/Overview.html#xsl:switch">xsl:switch</a> instruction must all be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-text"></a>12.5.40 <a href="#streamability-xsl-text" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:text">xsl:text</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:text">xsl:text</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. 
                    The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their 
                    <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>separator</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> 
                          (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-try"></a>12.5.41 <a href="#streamability-xsl-try" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:try">xsl:try</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the <a href="../../xslt-40/Overview.html#xsl:try">xsl:try</a> instruction
                     follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> expression or contained 
                          <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> of the <a href="../../xslt-40/Overview.html#xsl:try">xsl:try</a>
                           element. This has <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                           <a title="transmission" class="termref" href="#dt-transmission">transmission</a>. (Note that the
                              <a href="../../xslt-40/Overview.html#xsl:catch">xsl:catch</a> children of <a href="../../xslt-40/Overview.html#xsl:try">xsl:try</a> are
                           not part of the sequence constructor and therefore not part of this
                           operand.)</p>
                     </li>
                     <li>
                        <p>The <code>select</code> expressions and/or contained 
                          <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> of the <a href="../../xslt-40/Overview.html#xsl:catch">xsl:catch</a>
                           child elements. These form a <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a>
                           with <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                           <a title="transmission" class="termref" href="#dt-transmission">transmission</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The overall effect of these rules is that either the
                           <a href="../../xslt-40/Overview.html#xsl:try">xsl:try</a> branch or the <a href="../../xslt-40/Overview.html#xsl:catch">xsl:catch</a> branch
                        may consume the streamed input, but not both. If there is more than one
                           <a href="../../xslt-40/Overview.html#xsl:catch">xsl:catch</a> branch then they may all consume the input,
                        since only one of these branches can be evaluated.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-value-of"></a>12.5.42 <a href="#streamability-xsl-value-of" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a> are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>select</code> expression (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The <code>separator</code> attribute value template (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>)</p>
                     </li>
                     <li>
                        <p>The contained 
                          <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-variable"></a>12.5.43 <a href="#streamability-xsl-variable" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:variable">xsl:variable</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                        <a href="../../xslt-40/Overview.html#xsl:variable">xsl:variable</a> follow the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> and their <a title="operand usage" class="termref" href="#dt-operand-usage">usages</a>
                     depend on the <code>as</code> attribute,
                      as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>If there is an <code>as</code> attribute, then:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <code>select</code> expression (with <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the <code>as</code>
                                 attribute).</p>
                           </li>
                           <li>
                              <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (with
                                    <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the
                                    <code>as</code> attribute).</p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>If there is no <code>as</code> attribute,
                           then:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <code>select</code> expression (usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a>).</p>
                           </li>
                           <li>
                              <p>The contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> (usage
                                    <a title="absorption" class="termref" href="#dt-absorption">absorption</a>).</p>
                           </li>
                        </ol>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The effect of the initialization expression having usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a> is that it is not possible in streamable constructs
                        to bind a variable to a node in a streamed document.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-xsl-where-populated"></a>12.5.44 <a href="#streamability-xsl-where-populated" style="text-decoration: none">Streamability of <a href="../../xslt-40/Overview.html#xsl:where-populated">xsl:where-populated</a></a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of an
                        <a href="../../xslt-40/Overview.html#xsl:where-populated">xsl:where-populated</a> instruction are the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> 
                    of the contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>.</p>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="classifying-vts"></a>12.6 <a href="#classifying-vts" style="text-decoration: none">Classifying Value Templates</a></h3>
               <p>A <a href="https://qt4cg.org/specifications/xslt-40/#dt-value-template">value template</a><sup><small>XT</small></sup> 
                 (that is, an <a href="https://qt4cg.org/specifications/xslt-40/#dt-attribute-value-template">attribute value template</a><sup><small>XT</small></sup> 
                 or <a href="https://qt4cg.org/specifications/xslt-40/#dt-text-value-template">text value template</a><sup><small>XT</small></sup>)
                  is a <a title="construct" class="termref" href="#dt-construct">construct</a> whose operands are the expressions contained
                  within curly brackets. The required type for this operand role is
                     <code>xs:string</code> and the <a title="operand usage" class="termref" href="#dt-operand-usage">usage</a>
                  is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
               <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> and <a title="posture" class="termref" href="#dt-posture">posture</a> of a value template
                  are determined using the general rules in <a href="#general-streamability-rules"><b>3.10 General Streamability Rules</b></a>.</p>
               <p>If there are no expressions contained within curly brackets, the value template is
                     <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
            </div>
            <div class="div2">
               
               <h3><a id="classifying-expressions"></a>12.7 <a href="#classifying-expressions" style="text-decoration: none">Classifying Expressions</a></h3>
               <p>XPath expressions are classified using the rules in this section.</p>
               <p>In the analysis that follows, <a href="https://qt4cg.org/specifications/xslt-40/#dt-expression">expressions</a><sup><small>XT</small></sup>
                  are classified according to the most specific production rule that they match for
                  which there is an entry in this section. A production <var>P</var> is considered
                  more specific than a production <var>Q</var> (<var>Q</var> ≠ <var>P</var>)
                  if every expression that matches <var>P</var> also matches <var>Q</var>. For
                  example:</p>
               <ul>
                  <li>
                     <p>The expression <code>3</code> satisfies the productions
                           <code>NumericLiteral</code>, <code>Literal</code>, and
                           <code>ArithmeticExpression</code>; the most specific of these for which
                        there is an entry in this section is <code>Literal</code>.</p>
                  </li>
                  <li>
                     <p>The expression <code>text()</code> (appearing as an expression) is a
                           <code>TextTest</code>, and therefore a <code>KindTest</code>, which is
                        itself a <code>NodeTest</code>, and therefore an <code>AxisStep</code> with
                        a defaulted <code>ForwardAxis</code>. The most specific of these for which
                        there is an entry in this section is <code>AxisStep</code>. Although the
                        expression is also a <code>RelativePathExpr</code>, that production is less
                        specific than <code>AxisStep</code> so its rules do not apply.</p>
                  </li>
                  <li>
                     <p>The expression <code>section/title</code> is a
                        <code>RelativePathExpr</code>, for which there is an entry in this section.
                        Although the expression is also a <code>PathExpr</code>, that production is
                        less specific than <code>RelativePathExpr</code> so its rules do not
                        apply.</p>
                  </li>
               </ul>
               <p>The production rules for different kinds of expression are listed (with their
                  names and numbers) in the order in which they appear in Appendix A.1 of the XPath
                  3.0 specification; rules are also given for
                  new constructs introduced by XPath 3.1. Where two
                  numbers are given, they are the production rule numbers in XPath 3.0 and XPath 3.1 respectively;
                  where there is a single number, it is the production rule number in XPath 3.1.</p>
               <p>Many expressions can be analyzed using the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. These are indicated in the table below
                  by means of a simple proforma in which the <a title="operand role" class="termref" href="#dt-operand-role">operand
                     roles</a> are represented by a short code (A = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, I = <a title="inspection" class="termref" href="#dt-inspection">inspection</a>, T = <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, N = <a title="navigation" class="termref" href="#dt-navigation">navigation</a>). For example the
                  proforma <code>A + A</code> indicates that for an arithmetic expression, both
                  operands have <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                  <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, while <code>I or I</code> indicates that for an
                     <code>or</code> expression, both operands have <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                  <a title="inspection" class="termref" href="#dt-inspection">inspection</a>. For expressions where further explanation is
                  needed, the table contains a link to the relevant section.</p>
               <table class="data">
                  <caption>Operand Roles for XPath Expressions</caption>
                  <thead>
                     <tr>
                        <th>Construct</th>
                        <th>Proforma or Reference to Detailed Rules</th>
                        <th>Further Information</th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr>
                        <td>Expr</td>
                        <td><code>T, T</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>ForExpr</td>
                        <td>See <a href="#streamability-of-for-expressions"><b>12.7.1 Streamability of for Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>LetExpr</td>
                        <td><code>let $var := N return T</code></td>
                        <td>Binding of variables to streamed nodes is not allowed.</td>
                     </tr>
                     <tr>
                        <td>QuantifiedExpr</td>
                        <td>See <a href="#streamability-of-quantified-expressions"><b>12.7.2 Streamability of Quantified Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>IfExpr</td>
                        <td><code>if (I) then T else
                              T</code></td>
                        <td>The then-clause and else-clause form a <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a> with usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a></td>
                     </tr>
                     <tr>
                        <td>OrExpr</td>
                        <td><code>I or I</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>AndExpr</td>
                        <td><code>I and I</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>StringConcatExpr</td>
                        <td><code>A || A</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>RangeExpr</td>
                        <td><code>A to A</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>AdditiveExpr</td>
                        <td><code>A + A</code>, <code>A - A</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>MultiplicativeExpr</td>
                        <td><code>A * A</code>, <code>A div A</code>, etc.</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>UnionExpr</td>
                        <td>See <a href="#streamability-of-union-expressions"><b>12.7.4 Streamability of union, intersect, and
                                 except Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>IntersectExceptExpr</td>
                        <td>See <a href="#streamability-of-union-expressions"><b>12.7.4 Streamability of union, intersect, and
                                 except Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>InstanceOfExpr</td>
                        <td>See <a href="#streamability-of-instance-of-expressions"><b>12.7.5 Streamability of instance of Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>TreatExpr</td>
                        <td>See <a href="#streamability-of-treat-as-expressions"><b>12.7.6 Streamability of treat as Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>CastableExpr</td>
                        <td><code>A castable as TYPE</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>CastExpr</td>
                        <td><code>A cast as TYPE</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>UnaryExpr</td>
                        <td><code>+A</code>, <code>-A</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>GeneralComp</td>
                        <td><code>A = A</code>, <code>A &lt; A</code>, <code>A != A</code>,
                           etc.</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>ValueComp</td>
                        <td><code>A eq A</code>, <code>A lt A</code>, <code>A ne A</code>, etc.</td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>NodeComp</td>
                        <td><code>I is I</code>, <code>I &lt;&lt;
                              I</code>, <code>I &gt;&gt; I</code></td>
                        <td>See Note 1 below</td>
                     </tr>
                     <tr>
                        <td>SimpleMapExpr</td>
                        <td>See <a href="#streamability-of-simple-mapping-expressions"><b>12.7.7 Streamability of Simple Mapping Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>PathExpr</td>
                        <td>See <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>RelativePathExpr</td>
                        <td>See <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>AxisStep</td>
                        <td>See <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>ForwardStep, ReverseStep</td>
                        <td>See <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>PostfixExpr: Filter Expression</td>
                        <td>See <a href="#streamability-of-filter-expressions"><b>12.7.10 Streamability of Filter Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>PostfixExpr: Dynamic Function Call</td>
                        <td>See <a href="#streamability-of-dynamic-function-calls"><b>12.7.11 Streamability of Dynamic Function Calls</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Literal</td>
                        <td></td>
                        <td>There are no operands, so the construct is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>
                           and <a title="motionless" class="termref" href="#dt-motionless">motionless</a></td>
                     </tr>
                     <tr>
                        <td>VarRef</td>
                        <td>See <a href="#streamability-of-variable-references"><b>12.7.12 Streamability of Variable References</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td rowspan="2">ParenthesizedExpr</td>
                        <td><code>(T)</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td><code>()</code></td>
                        <td>There are no operands, so the construct is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>
                           and <a title="motionless" class="termref" href="#dt-motionless">motionless</a></td>
                     </tr>
                     <tr>
                        <td>ContextItemExpr</td>
                        <td>See <a href="#streamability-of-context-item-expression"><b>12.7.13 Streamability of the Context Item Expression</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>FunctionCall</td>
                        <td>See <a href="#streamability-of-function-calls"><b>12.7.14 Streamability of Static Function Calls</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>NamedFunctionRef</td>
                        <td>See <a href="#streamability-of-named-function-ref"><b>12.7.15 Streamability of Named Function References</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>InlineFunctionExpr</td>
                        <td>See <a href="#streamability-of-inline-functions"><b>12.7.16 Streamability of Inline Function Declarations</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>MapConstructor</td>
                        <td>See <a href="#streamability-of-map-constructors"><b>12.7.17 Streamability of Map Constructors</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>Lookup (Postfix and Unary)</td>
                        <td>See <a href="#streamability-of-lookup-expressions"><b>12.7.18 Streamability of Lookup Expressions</b></a></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>ArrowExpr</td>
                        <td>See <a href="#streamability-of-function-calls"><b>12.7.14 Streamability of Static Function Calls</b></a>
                           and <a href="#streamability-of-dynamic-function-calls"><b>12.7.11 Streamability of Dynamic Function Calls</b></a>: 
                           the rules for <code>X =&gt; F(Y, Z)</code> are the same as the rules for <code>F(X, Y, Z)</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>SquareArrayConstructor</td>
                        <td><code>[ N, N, ... ]</code></td>
                        <td></td>
                     </tr>
                     <tr>
                        <td>CurlyArrayConstructor</td>
                        <td><code>array { N, N, ... }</code></td>
                        <td></td>
                     </tr>
                  </tbody>
               </table>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <ol class="enumar">
                     <li>
                        <p> The operators <code>is</code>, <code>&lt;&lt;</code>, and
                              <code>&gt;&gt;</code> apply to streamed nodes just as to any other
                           nodes, though there are few practical situations where they will be
                           useful. A streamed document conforms to the rules of the XDM data model,
                           and its nodes are therefore distinct and ordered. They follow the usual
                           rules, for example that a parent node precedes its children in document
                           order. Expressions such as <code>.. is parent::X</code> or
                              <code>ancestor::x[1] &lt;&lt; ancestor::y[1]</code> are therefore
                           perfectly meaningful. The usefulness of the operators is limited by the
                           fact that variables cannot be bound to nodes in a streamed document. It
                           is permitted, though perhaps not useful, for one of the operands to be
                              <a title="consuming" class="termref" href="#dt-consuming">consuming</a>: one can write <code>. &lt;&lt;
                              child::x</code>, and the resulting expression is (by applying the
                           general rules) <a title="consuming" class="termref" href="#dt-consuming">consuming</a> and grounded.</p>
                        <p>The restriction that variables cannot be bound to streamed nodes prevents
                           writing of expressions such as <code>let $x := . return
                              descendant::x[ancestor::y[1] is $x]</code>. As a workaround, the
                           intended effect can be achieved by comparing node identity using the
                              <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-generate-id"><code>generate-id</code></a> function: <code>let $x :=
                              generate-id(.) return descendant::x[generate-id(ancestor::y[1]) =
                              $x]</code></p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-for-expressions"></a>12.7.1 <a href="#streamability-of-for-expressions" style="text-decoration: none">Streamability of <code>for</code> Expressions</a></h4>
                  <p>Writing the expression as <code>for $v in S return R</code>, the two operand
                     roles are <var>S</var> and <var>R</var>.</p>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> are determined by
                     the first of the following that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If <var>S</var> is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then <a title="roaming" class="termref" href="#dt-roaming">roaming</a>
                           and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply. The
                           operand roles are:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <code>in</code> expression (<code>S</code>). This has <a title="operand usage" class="termref" href="#dt-operand-usage">usage</a>
                                 <a title="navigation" class="termref" href="#dt-navigation">navigation</a>.</p>
                           </li>
                           <li>
                              <p>The <code>return</code> expression (<code>R</code>). This is a
                                    <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> with <a title="operand usage" class="termref" href="#dt-operand-usage">usage</a>
                                 <a title="transmission" class="termref" href="#dt-transmission">transmission</a>.</p>
                           </li>
                        </ol>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Expressions of the form <code>for $i in 1 to 3 return $i*2</code>, where
                        there is no reference to a streamed node, are clearly streamable.</p>
                     <p>The <code>in</code> expression can also be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>,
                        for example <code>for $e in copy-of(emp) return $e/salary</code>.</p>
                     <p>The rule that <var>S</var> must be grounded
                        prevents the variable being bound to a node in a streamed document. This
                        disallows expressions of the form <code>for $x in child::section return
                           $x/para</code>, because this requires data flow analysis (tracing from
                        the binding of a variable to its usages), rather than purely syntactic
                        analysis. Some implementations may be able to stream such constructs.</p>
                     <p>The fact that the return clause is a higher-order operand prevents it from
                        being a <a title="consuming" class="termref" href="#dt-consuming">consuming</a> expression, for example <code>for $i
                           in 1 to 3 return salary</code>. Use of a motionless expression that
                        accesses streamed nodes is however allowed, for example <code>for $i in 1 to
                           3 return name(ancestor::x[$i])</code>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-quantified-expressions"></a>12.7.2 <a href="#streamability-of-quantified-expressions" style="text-decoration: none">Streamability of Quantified Expressions</a></h4>
                  <p>An expression with multiple in-clauses is first rewritten using nested
                     quantified expressions: for example <code>some $i in X, $j in Y satisfies $i eq
                        $j</code> can be rewritten as <code>some $i in X satisfies (some $j in Y
                        satisfies $i eq $j)</code>. The analysis therefore only needs to consider
                     expressions with a single in-clause.</p>
                  <p>Writing such an expression as <code>some|every $v in S satisfies C</code>, the
                     two operand roles are <var>S</var> and <var>C</var>.</p>
                  <p>The <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply. The <a title="operand role" class="termref" href="#dt-operand-role">operand roles</a> are:</p>
                  <ol class="enumar">
                     <li>
                        <p>The <code>in</code> expression (<var>S</var>). This has usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a>.</p>
                     </li>
                     <li>
                        <p>The <code>satisfies</code> expression (<var>C</var>). This is a <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> with usage <a title="inspection" class="termref" href="#dt-inspection">inspection</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Expressions of the form some <code>$i in 1 to 3 satisfies $i lt 2</code>,
                        where there is no reference to a streamed node, are clearly streamable. </p>
                     <p>The expression <var>S</var> can be <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, so long as
                        it is grounded: for example <code>some $e in emp/salary/number(.) satisfies
                           $e gt 10000</code>. </p>
                     <p>The rule that <var>S</var> has usage <a title="navigation" class="termref" href="#dt-navigation">navigation</a> prevents
                        the variable being bound to a node in a streamed document. This disallows
                        expressions of the form <code>some $x in child::section satisfies
                           has-children($x)</code>, because this requires data flow analysis
                        (tracing from the binding of a variable to its usages), rather than purely
                        syntactic analysis. Some implementations may be able to stream such
                        constructs. </p>
                     <p>The fact that <var>C</var> is a higher-order operand prevents it from being
                        a <a title="consuming" class="termref" href="#dt-consuming">consuming</a> expression: for example <code>some $i in 1
                           to 3 satisfies author[$i] eq "Kay"</code> is not streamable. Use of a
                        motionless expression that accesses streamed nodes is however allowed, for
                        example <code>some $i in 1 to 3 satisfies @grade = $i</code>. </p>
                     <p>Quantified expressions that fail the streamability rules can often be
                        rewritten as filter expressions. For example, the expression <code>some $x in
                           child::section satisfies has-children($x)</code> can be rewritten as
                           <code>exists(child::section[has-children(.)])</code>, which is grounded
                        and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. </p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-if-expressions"></a>12.7.3 <a href="#streamability-of-if-expressions" style="text-decoration: none">Streamability of <code>if</code> expressions</a></h4>
                  <p>Writing the expression as <code>if (C) then T else E</code>, there are three
                     operand roles: <var>C</var>, <var>T</var>, and <var>E</var>. The <a title="operand usage" class="termref" href="#dt-operand-usage">usage</a> of <var>C</var> is <a title="inspection" class="termref" href="#dt-inspection">inspection</a>, while the <a title="operand usage" class="termref" href="#dt-operand-usage">usage</a> of <var>T</var> and <var>E</var> is <a title="transmission" class="termref" href="#dt-transmission">transmission</a>. Operands <var>T</var> and <var>E</var> form a
                        <a title="choice operand group" class="termref" href="#dt-choice-operand-group">choice operand group</a>, meaning that they can both consume
                     the input stream, provided they have consistent <a title="posture" class="termref" href="#dt-posture">posture</a>.
                     The <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-union-expressions"></a>12.7.4 <a href="#streamability-of-union-expressions" style="text-decoration: none">Streamability of <code>union</code>, <code>intersect</code>, and
                        <code>except</code> Expressions</a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> are the first of
                     the following that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If either of the two operands is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, then
                              <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>
                           (Example: <code>. | following-sibling::*</code>).</p>
                     </li>
                     <li>
                        <p>If either of the two operands is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and
                              <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, then the <a title="posture" class="termref" href="#dt-posture">posture</a>
                           and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the other operand (Example: <code>. |
                              doc('abc.com')//x</code>)</p>
                     </li>
                     <li>
                        <p>If both operands are <a title="climbing" class="termref" href="#dt-climbing">climbing</a>, then <a title="climbing" class="termref" href="#dt-climbing">climbing</a> and the
                           wider of the sweeps of the two operands (Example: <code>parent::A | */ancestor::B</code>).</p>
                     </li>
                     <li>
                        <p>If the left-hand operand is <a title="striding" class="termref" href="#dt-striding">striding</a> or <a title="crawling" class="termref" href="#dt-crawling">crawling</a> and the right-hand operand is also
                                 <a title="striding" class="termref" href="#dt-striding">striding</a> or <a title="crawling" class="termref" href="#dt-crawling">crawling</a>, then <a title="crawling" class="termref" href="#dt-crawling">crawling</a> and the wider of the
                           sweeps of the two operands (Example: <code>* | */*</code>).</p>
                     </li>
                     <li>
                        <p>Otherwise, <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> (Example: <code>child::div |
                              parent::div</code>).</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Essentially the principle is that if both operands are streamable, then the
                        result is streamable (this assumes an evaluation strategy where both
                        operands are evaluated during the same pass of the streamed input document,
                        and the results merged). But there are caveats because of the need for
                        static streamability analysis of the result. This prevents constructs such
                        as <code>.. | *</code> that have heterogeneous <a title="posture" class="termref" href="#dt-posture">posture</a>.</p>
                     <p>Where the two operands are both <a title="striding" class="termref" href="#dt-striding">striding</a>, there are
                        cases where an implementation could determine that the result is also
                           <a title="striding" class="termref" href="#dt-striding">striding</a>: for example <code>(author | editor)</code>.
                        In general, however, the combination of two striding operands may produce a
                        sequence of nodes that have nested subtrees (consider <code>author | author/name</code>),
                        so the result is classified as <a title="crawling" class="termref" href="#dt-crawling">crawling</a>.</p>
                     <p>The expression <code>(author | editor)</code>, although it is not <a title="striding" class="termref" href="#dt-striding">striding</a>, can be rewritten in the form <code>*[self::author or
                           self::editor]</code>, which is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-instance-of-expressions"></a>12.7.5 <a href="#streamability-of-instance-of-expressions" style="text-decoration: none">Streamability of <code>instance of</code> Expressions</a></h4>
                  <p>For an expression of the form <var>X</var> instance of <var>ST</var> (where
                        <var>X</var> is an expression and <var>ST</var> is a
                     <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-type">SequenceType</a><sup><small>XT</small></sup>), 
                     the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> are determined by the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. There is a single operand
                        <var>X</var>, whose <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the <code>ItemType</code> of <var>ST</var> is a
                              <code>DocumentTest</code>, optionally parenthesized, that contains an
                              <code>ElementTest</code> or <code>SchemaElementTest</code> then
                           absorption</p>
                     </li>
                     <li>
                        <p>Otherwise, inspection.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>In general, it is possible to determine whether a node matches an
                           <code>ItemType</code> without consuming the node. For example it can be
                        established whether an element matches the test <code>element(para)</code>
                        when positioned at the start tag.</p>
                     <p>An <code>ItemType</code> of the form <code>document-node(element(X))</code>
                        is an exception to this rule because it matches a document node only if it
                        has exactly one element node child, and this cannot be determined without
                        consuming the document. </p>
                     <p>A processor may have knowledge that the document node cannot contain
                        multiple element nodes, for example because it knows that the source of the
                        streamed document is an XML parser that is not capable of generating such a
                        stream. In such cases the processor may make a different assessment of the
                        streamability of this construct. This comes under the general provision that
                        a processor is always at liberty to use streaming even when the stylesheet
                        is not guaranteed streamable. </p>
                  </div>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>As with other constructs that are evaluated with inspection usage, for
                        example the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-name"><code>name</code></a> function or access to an attribute
                        node, evaluation of a construct such as <code>$X instance of
                           schema-element(E)</code> as true or false may be invalidated if reading
                        of the input stream subsequently fails. Dynamic errors during streamed
                        processing of an input document invalidate all output generated prior to the
                        failure, and this case is no different. </p>
                  </div>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Given an expression such as <code>child::* instance of element(E)*</code>,
                        the expression as a whole is <a title="consuming" class="termref" href="#dt-consuming">consuming</a> and grounded. By
                        contrast, the expression <code>. instance of element(E)*</code> is
                        motionless and grounded. This can be verified by applying the general
                        streamability rules to these cases. </p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-treat-as-expressions"></a>12.7.6 <a href="#streamability-of-treat-as-expressions" style="text-decoration: none">Streamability of <code>treat as</code> Expressions</a></h4>
                  <p>For an expression of the form <var>X</var> treat as <var>ST</var> (where
                     <var>X</var> is an expression and <var>ST</var> is a
                     <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-type">SequenceType</a><sup><small>XT</small></sup>), 
                     the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> are determined as follows:  </p>
                  <ol class="enumar">
                     <li>
                        <p>If the <code>ItemType</code> of <var>ST</var> is a
                           <code>DocumentTest</code>, optionally parenthesized, that contains an
                           <code>ElementTest</code> or <code>SchemaElementTest</code> then
                           <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply. There is a single operand
                           <var>X</var>, whose <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is <a title="transmission" class="termref" href="#dt-transmission">transmission</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>See the notes in <a href="#streamability-of-instance-of-expressions"><b>12.7.5 Streamability of instance of Expressions</b></a> for
                  a discussion of the streamability difficulties associated with <code>document-node()</code> tests.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-simple-mapping-expressions"></a>12.7.7 <a href="#streamability-of-simple-mapping-expressions" style="text-decoration: none">Streamability of Simple Mapping Expressions</a></h4>
                  <p>The mapping operator <code>!</code> is treated as a left-associative binary
                     operator, so the expression <code>a!b!c</code> is processed as
                        <code>(a!b)!c</code>.</p>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the expression is
                     the <a title="posture" class="termref" href="#dt-posture">posture</a> of the right-hand operand, assessed with a
                        <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> and
                     type set to the <a title="posture" class="termref" href="#dt-posture">posture</a> and type of the left-hand operand.</p>
                  <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the expression is
                     the wider of the <a title="sweep" class="termref" href="#dt-sweep">sweeps</a> of the two
                     operands.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-path-expressions"></a>12.7.8 <a href="#streamability-of-path-expressions" style="text-decoration: none">Streamability of Path Expressions</a></h4>
                  <p>The streamability analysis applies after the expansion of the <code>//</code>
                     pseudo-operator to <code>/descendant-or-self::node()/</code>, and after
                     expanding <code>..</code> to <code>parent::node()</code>, <code>@X</code> to
                        <code>attribute::X</code>, and an omitted axis to the default axis for the node kind.</p>
                  <p>Following the rules in XPath, a leading <code>"/"</code> is converted to
                        <code>(root(self::node()) treat as document-node())/</code> (with the final
                        <code>"/"</code> omitted for the expression <code>"/"</code> on its own).
                     This is followed by a rewrite of the call on <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-root"><code>root</code></a>, as
                     described in <a href="#streamability-fn-root"><b>12.8.21 Streamability of the root Function</b></a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Taken together, these rewrites have the effect that a path expression such
                        as <code>//a</code> is streamable only if the statically determined context
                        item type is <code>document-node()</code>, which will be the case for
                        example immediately within <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a>, or in a template
                        rule with <code>match="/"</code>.</p>
                  </div>
                  <p>A <code>RelativePathExpr</code> with more than two operands (such as
                        <code>a/b/c</code>) is taken as a tree of binary expressions (that is,
                        <code>(a/b)/c</code>).</p>
                  <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a relative path expression is the wider
                        <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the two operands, where the ordering of
                     increasing width is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Examples:</p>
                     <ul>
                        <li>
                           <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <code>a/@code</code> is <a title="consuming" class="termref" href="#dt-consuming">consuming</a> (the wider of <a title="consuming" class="termref" href="#dt-consuming">consuming</a>
                              and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>).</p>
                        </li>
                        <li>
                           <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <code>a/descendant::b</code> is
                                 <a title="consuming" class="termref" href="#dt-consuming">consuming</a> (the wider of <a title="consuming" class="termref" href="#dt-consuming">consuming</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>).</p>
                        </li>
                        <li>
                           <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <code>./@code</code> is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> (the wider of <a title="motionless" class="termref" href="#dt-motionless">motionless</a>
                              and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>).</p>
                        </li>
                        <li>
                           <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <code>./a</code> is <a title="consuming" class="termref" href="#dt-consuming">consuming</a> (the wider of <a title="motionless" class="termref" href="#dt-motionless">motionless</a>
                              and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>).</p>
                        </li>
                        <li>
                           <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <code>a/following::b</code> is
                                 <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> (the wider of <a title="consuming" class="termref" href="#dt-consuming">consuming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>).</p>
                        </li>
                        <li>
                           <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <code>./.</code> is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> (the wider of <a title="motionless" class="termref" href="#dt-motionless">motionless</a>
                              and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>).</p>
                        </li>
                     </ul>
                  </div>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of a relative path
                     expression is assessed in two phases, as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>First, the provisional <a title="posture" class="termref" href="#dt-posture">posture</a> is determined as
                           follows: The provisional <a title="posture" class="termref" href="#dt-posture">posture</a> of the expression is
                           the <a title="posture" class="termref" href="#dt-posture">posture</a> of the right-hand operand, assessed with
                           a <a title="context posture" class="termref" href="#dt-context-posture">context posture</a>
                           and type set to the <a title="posture" class="termref" href="#dt-posture">posture</a> and type of the left-hand operand; and the
                           provisional sweep is the wider of the sweeps of the two operands.</p>
                     </li>
                     <li>
                        <p>If the provisional <a title="posture" class="termref" href="#dt-posture">posture</a> is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, then it is
                           reassessed as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p><a id="dt-scanning-expression" title="scanning expression"><span class="definition">[Definition:&nbsp;</span></a>A 
                                 <code>RelativePathExpr</code> is a <b>scanning expression</b>
                              if and only if it is syntactically equivalent to some <a title="motionless" class="termref" href="#dt-motionless">motionless</a>
                              <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup>.<span class="definition">]</span></p>
                              <div class="note">
                                 <p class="prefix"><b>Note:</b></p>
                                 <p>This means that a <code>RelativePathExpr</code>
                              is a <b>scanning expression</b> if it conforms to the grammar for a <code>RelativePathExprP</code>
                              in the grammar for patterns (see <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#pattern-syntax">6.3.2 Syntax of Patterns</a>),
                              and if, when considered as a pattern, the pattern is motionless according to the
                              rules in <a href="#classifying-patterns"><b>12.9 Classifying Patterns</b></a>.</p>
                                 <p>In practice, the test as to whether the construct is equivalent to a pattern is likely
                              to be made by examining the structure of the expression tree, rather than by re-parsing the
                              lexical form of the expression against the grammar for patterns; but the outcome is the same.</p>
                              </div>
                           </li>
                           <li>
                              <p>If the expression is a <b>scanning expression</b> then:</p>
                              <ol class="enumlr">
                                 <li>
                                    <p>If the static type of the expression contains
                                          <code>U{element}</code> then its <a title="posture" class="termref" href="#dt-posture">posture</a> is <a title="crawling" class="termref" href="#dt-crawling">crawling</a>.</p>
                                 </li>
                                 <li>
                                    <p>Otherwise, its <a title="posture" class="termref" href="#dt-posture">posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a></p>
                                 </li>
                              </ol>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>Otherwise (if the provisional <a title="posture" class="termref" href="#dt-posture">posture</a> is not <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, or
                           the expression is not a <b>scanning expression</b>), the <a title="posture" class="termref" href="#dt-posture">posture</a> of the expression is the provisional <a title="posture" class="termref" href="#dt-posture">posture</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The special rules for scanning expressions are designed to ensure
                     that expressions such as <code>//section/head</code> are streamable. The problem
                     with such an expression is that it is
                     possible to have two nested sections <var>A</var> and <var>B</var>, where <var>A</var>
                     is the parent of <var>B</var> and thus precedes <var>B</var> in document order,
                     but where there are children of <var>A</var> that come <em>after</em>
                     children of <var>B</var> in document order. This means that a nested-loop
                     strategy for the evaluation of <code>/descendant::section/child::head</code>
                     is not guaranteed to deliver nodes in document order without a sort, and is therefore not
                     a viable strategy for streaming.</p>
                     <p>However, there is a different strategy for evaluating such an expression,
                     which is in effect to rewrite the expression as <code>/descendant::head[parent::section]</code>;
                     specifically, it is possible to scan all descendants in document order, looking for a <code>head</code>
                     element that has a <code>section</code> parent. Hence the term <b>scanning expressions</b>.</p>
                     <p>The expressions that qualify as scanning expressions are paths that can be evaluated
                        by scanning all descendants and testing each one (independently) to see whether the elements
                        on its ancestor axis match the specified path. The subset of expressions that qualify 
                        as scanning expressions is therefore the same as the subset that qualify as motionless patterns.</p>
                     <p>Scanning expressions cannot use positional predicates: for example <code>//section/head[1]</code>
                        is not recognized as a scanning expression because this would require information
                        about a streamed node (specifically, about its preceding siblings) that is not retained during streaming.
                        </p>
                  </div>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Perhaps surprisingly, the expression <code>.//section/head</code> is not a scanning
                     expression and is therefore not guaranteed streamable. This is because it does not take
                     the syntactic form of a <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup>. To make it streamable, it can be rewritten as 
                     <code>descendant::section/head</code> or as <code>self::node()//section/head</code>.</p>
                     <p>Similarly, within a streamable stylesheet function whose <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> is
                     <code>$node</code>, the expression <code>$node//section/head</code> is not a scanning 
                     expression. In this case the expression does have the syntactic form of a pattern, but the
                     pattern is not classified as motionless. (See <a href="#classifying-patterns"><b>12.9 Classifying Patterns</b></a> — a
                     motionless pattern cannot contain a <code>RootedPath</code>.) A workaround in this case
                     is to rewrite the expression as <code>$node/(descendant::section/head)</code>. Assuming that the
                        function in question declares <code>streamability="absorbing"</code>, the analysis here is
                     that the left-hand operand (<code>$node</code>) is striding and consuming, while the right hand 
                     operand (<code>descendant::section/head</code>) is crawling and consuming (because it is a
                     scanning expression). The expression as a whole is therefore crawling and consuming.</p>
                     <p>These are cases where an implementation might reasonably choose to relax the rules,
                     insofar as this is permitted by <a href="#streamability-guarantees"><b>3.1 Streamability Guarantees</b></a>.</p>
                  </div>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Examples:</p>
                     <p>In each of the following cases, assume that the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is striding.</p>
                     <ul>
                        <li>
                           <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the expression <code>a/b/c</code>
                              is striding, because (under the rules for AxisStep [38]) a child axis
                              step evaluated with striding context <a title="posture" class="termref" href="#dt-posture">posture</a>
                              creates a new striding posture.</p>
                        </li>
                        <li>
                           <p>The posture of the expression <code>a/descendant::c</code> is
                              crawling, because a descendant axis step evaluated with striding
                              context posture creates a new crawling posture.</p>
                        </li>
                        <li>
                           <p>The posture of the expression
                                 <code>../@status</code> is striding, because a parent axis step
                              evaluated with striding context posture creates a new climbing
                              posture, and an attribute axis step evaluated with climbing context
                              posture creates a new striding posture.</p>
                        </li>
                        <li>
                           <p>The posture of the expression
                                 <code>copy-of(.)//a/following-sibling::*</code> is grounded,
                              because the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a> evaluated with striding
                              posture creates a grounded posture, and all subsequent axis steps
                              leave this posture unchanged.</p>
                        </li>
                        <li>
                           <p>The expression <code>section//head</code>
                              expands to
                                 <code>(section/descendant-or-self::node())/child::head</code>. The
                              posture of the left-hand operand
                                 <code>section/descendant-or-self::node()</code> is crawling,
                              because a descendant axis step evaluated with striding context posture
                              creates a new crawling posture. The provisional posture of the
                              expression as a whole is therefore <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, because a child axis step
                              evaluated with crawling context posture gives a resulting roaming posture. However, the expression
                              is a scanning expression (both <code>section//head</code> and its expansion are
                              motionless patterns), so the expression as a whole has
                              crawling posture. </p>
                        </li>
                        <li>
                           <p>The expression <code>section//head[1]</code> is
                              free-ranging: unlike the previous example, it contains a positional
                              predicate, which means that the operands do not satisfy the rules for
                              scanning expressions. </p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-axis-steps"></a>12.7.9 <a href="#streamability-of-axis-steps" style="text-decoration: none">Streamability of Axis Steps</a></h4>
                  <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> and <a title="posture" class="termref" href="#dt-posture">posture</a> of an AxisStep
                        <var>S</var> are determined by the first of the following rules that
                     applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the sweep is
                              <a title="motionless" class="termref" href="#dt-motionless">motionless</a> and the posture is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>;</p>
                     </li>
                     <li>
                        <p>If the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, then the sweep is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> and the posture is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>;</p>
                     </li>
                     <li>
                        <p>If the statically inferred <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> is such
                           that the axis will always be empty (for example, applying the child axis
                           to a text node or the parent axis to a document node), or if the <code>NodeTest</code> is one that can never
                              select nodes on the chosen axis (for example, selecting attribute
                              nodes on the child axis), then the sweep is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> and the posture is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>
                           (because the expression is statically known to return an empty
                           sequence);</p>
                     </li>
                     <li>
                        <p>If all the following conditions are satisfied:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a></p>
                           </li>
                           <li>
                              <p>The axis is <code>descendant</code> or
                                    <code>descendant-or-self</code></p>
                           </li>
                           <li>
                              <p>There is a predicate <var>P</var> in the list of predicates
                                 that satisfies all the following conditions:</p>
                              <ol class="enumlr">
                                 <li>
                                    <p>The static type of <var>P</var> is a subtype of
                                          <code>U{xs:decimal, xs:double, xs:float}</code></p>
                                 </li>
                                 <li>
                                    <p>The maximum cardinality of <var>P</var> is 1</p>
                                 </li>
                                 <li>
                                    <p>Neither <var>P</var>, nor any operand of <var>P</var>, at any
                                       depth provided it has the AxisStep <var>S</var> as its
                                          <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a>, is a context
                                       item expression, an axis expression, or a call on a
                                       focus-dependent function;</p>
                                 </li>
                              </ol>
                           </li>
                        </ol>
                        <p>then <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a></p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>Examples are <code>descendant::section[1]</code>,
                                 <code>descendant::section[$i+1]</code>,
                                 <code>descendant::section[count($x)]</code>. The significance of
                              this rule is that it detects cases where the descendant axis selects a
                              singleton, and where the posture of the result can therefore be
                                 <a title="striding" class="termref" href="#dt-striding">striding</a> rather than <a title="crawling" class="termref" href="#dt-crawling">crawling</a>.</p>
                        </div>
                     </li>
                     <li>
                        <p>If the list of predicates contains a <code>Predicate</code> that
                           is not <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, then the sweep is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a> and the posture is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>;</p>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> and <a title="posture" class="termref" href="#dt-posture">posture</a>
                           of the expression are as determined by the table below, based on the
                              <a title="context posture" class="termref" href="#dt-context-posture">context posture</a>, the choice of axis, and the node test. The condition
                           “Selects elements?” is true if the <a title="U-type" class="termref" href="#dt-utype">U-type</a> of
                              <var>S</var> has a non-empty intersection with
                           <var>U{element()}</var>.</p>
                        <table class="data">
                           <caption>Streamability of Axis Steps Based on Context Posture</caption>
                           <thead>
                              <tr>
                                 <th>Context posture</th>
                                 <th>Axis</th>
                                 <th>Selects elements?</th>
                                 <th>Result posture</th>
                                 <th>Sweep</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td>Grounded</td>
                                 <td>any</td>
                                 <td></td>
                                 <td>Grounded</td>
                                 <td>Motionless</td>
                              </tr>
                              <tr>
                                 <td>Climbing</td>
                                 <td>self, parent, ancestor-or-self, ancestor</td>
                                 <td></td>
                                 <td>Climbing</td>
                                 <td>Motionless</td>
                              </tr>
                              <tr>
                                 <td>Climbing</td>
                                 <td>attribute, namespace</td>
                                 <td></td>
                                 <td>Striding</td>
                                 <td>Motionless</td>
                              </tr>
                              <tr>
                                 <td>Striding</td>
                                 <td>parent, ancestor-or-self,
                                    ancestor</td>
                                 <td></td>
                                 <td>Climbing</td>
                                 <td>Motionless</td>
                              </tr>
                              <tr>
                                 <td>Striding</td>
                                 <td>self, attribute, namespace</td>
                                 <td></td>
                                 <td>Striding</td>
                                 <td>Motionless</td>
                              </tr>
                              <tr>
                                 <td>Striding</td>
                                 <td>child</td>
                                 <td></td>
                                 <td>Striding</td>
                                 <td>Consuming</td>
                              </tr>
                              <tr>
                                 <td>Striding</td>
                                 <td>descendant, descendant-or-self</td>
                                 <td>Yes</td>
                                 <td>Crawling</td>
                                 <td>Consuming</td>
                              </tr>
                              <tr>
                                 <td>Striding</td>
                                 <td>descendant, descendant-or-self</td>
                                 <td>No</td>
                                 <td>Striding</td>
                                 <td>Consuming</td>
                              </tr>
                              <tr>
                                 <td>Crawling</td>
                                 <td>parent, ancestor-or-self,
                                    ancestor</td>
                                 <td></td>
                                 <td>Climbing</td>
                                 <td>Motionless</td>
                              </tr>
                              <tr>
                                 <td>Crawling</td>
                                 <td>attribute, namespace</td>
                                 <td></td>
                                 <td>Striding</td>
                                 <td>Motionless</td>
                              </tr>
                              <tr>
                                 <td>Crawling</td>
                                 <td>self</td>
                                 <td>Yes</td>
                                 <td>Crawling</td>
                                 <td>Motionless</td>
                              </tr>
                              <tr>
                                 <td>Crawling</td>
                                 <td>self</td>
                                 <td>No</td>
                                 <td>Striding</td>
                                 <td>Motionless</td>
                              </tr>
                              <tr>
                                 <td colspan="2">Any other combination</td>
                                 <td></td>
                                 <td>Roaming</td>
                                 <td>Free-ranging</td>
                              </tr>
                           </tbody>
                        </table>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This analysis does not attempt to classify <code>para[title]</code> as a
                           <a title="consuming" class="termref" href="#dt-consuming">consuming</a> expression; an implementation might choose
                        to do so.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-filter-expressions"></a>12.7.10 <a href="#streamability-of-filter-expressions" style="text-decoration: none">Streamability of Filter Expressions</a></h4>
                  <p>For a filter expression <var>F</var> of the form <code>B[P]</code> (where
                        <var>B</var> might itself be a filter expression), the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> are the first of the
                     following that applies:</p>
                  <ol class="enumar">
                     <li>
                        <p>If all the following conditions are satisfied:</p>
                        <ol class="enumla">
                           <li>
                              <p><var>B</var> is crawling;</p>
                           </li>
                           <li>
                              <p>The static type of <var>P</var> is a subtype of <code>U{xs:decimal,
                                    xs:double, xs:float}</code>;</p>
                           </li>
                           <li>
                              <p>The maximum cardinality of <var>P</var> is 1;</p>
                           </li>
                           <li>
                              <p>Neither <var>P</var>, nor any operand of <var>P</var>, at any depth
                                 provided it has <var>F</var> as its focus-setting container, is a
                                 context item expression, an axis expression, or a call on a
                                 focus-dependent function</p>
                           </li>
                        </ol>
                        <p>then the <a title="posture" class="termref" href="#dt-posture">posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a> and
                           the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is the sweep of <var>B</var>. </p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>This rule captures cases where it can be statically determined that
                              the predicate is a single numeric item and is independent of the focus. In such
                              cases, the filter expression selects at most one node, and the posture
                              can therefore be changed from crawling to striding (if there is only
                              one node, there can be no overlapping trees). Examples of filter
                              expressions that satisfy this test are <code>(//x)[3]</code>,
                                 <code>(//x)[$i+1]</code>, <code>(//x)[index-of($a,
                                 $b)[last()]]</code>. The expression <code>(//x)[1 to 5]</code> does
                              not satisfy the test, because the value of the predicate is not a singleton.</p>
                        </div>
                     </li>
                     <li>
                        <p>If <var>P</var> is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, then the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <var>B</var>;</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>This includes the case where <var>B</var> is grounded. The predicate
                                 <var>P</var> is assessed with the posture of <var>B</var> as its
                              context posture, and if this is grounded, then <var>P</var> will
                              almost invariably be motionless, making the filter expression as a
                              whole grounded and motionless. For example if <code>$s</code> is
                              grounded, then <code>$s[child::*]</code> is also grounded. A
                              counter-example is the expression <code>$s[$n = 2]</code> where
                                 <code>$n</code> is a reference to the first argument of a stylesheet function
                              that is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>: here the predicate is
                              not motionless, so the filter expression is roaming and
                              free-ranging.</p>
                        </div>
                     </li>
                     <li>
                        <p>Otherwise, <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The first rule allows a construct such as <code>&lt;xsl:apply-templates
                           select="(//title)[1]"/&gt;</code>, where a <a title="crawling" class="termref" href="#dt-crawling">crawling</a>
                        operand would not be guaranteed streamable.</p>
                  </div>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This section is not applicable to predicates forming part of an axis step,
                        such as <code>//title[1]</code>, as these are not technically filter
                        expressions. See <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-dynamic-function-calls"></a>12.7.11 <a href="#streamability-of-dynamic-function-calls" style="text-decoration: none">Streamability of Dynamic Function Calls</a></h4>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This section applies to dynamic function calls written using the traditional
                        syntax <code>$F(X, Y, Z)</code> and equally to those using the syntax <code>X =&gt; $F(Y, Z)</code></p>
                  </div>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a dynamic
                     function call such as <code>$F(X, Y)</code> are determined by the <a href="#general-streamability-rules"><b>3.10 General Streamability Rules</b></a>. The operands and their usages are as
                     follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The base expression that computes the function value itself (here
                              <code>$F</code>). This has usage <a title="inspection" class="termref" href="#dt-inspection">inspection</a>.</p>
                     </li>
                     <li>
                        <p>The argument expressions excluding any
                                 <code>?</code> placeholders (here <code>X</code> and
                              <code>Y</code>). These have <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a>
                           dependent on ancillary information
                              associated with the <a title="static type" class="termref" href="#dt-static-type">static type</a> of the base
                              expression, where available (see <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>). If this information indicates
                              that the base expression is a function with signature
                           <code>fn(A, B, ...) as R</code>, then the first argument
                              <code>X</code> has <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on
                           the first argument type <code>A</code>, the second argument
                              <code>Y</code> has <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on
                           the second argument type <code>B</code>, and so on. If no function signature is available, then the
                           usage of each of the argument expressions is <a title="navigation" class="termref" href="#dt-navigation">navigation</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>As explained in <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#function-lookup">10.3.5 Dynamic Access to Functions</a>, use of a dynamic function
                        call where the function value is bound to a focus-dependent function such as
                           <code>name#0</code>, <code>lang#1</code>, or <code>last#0</code> is
                        likely to lead to a dynamic error if the context item is a node in a
                        streamed document, but this does not affect the static streamability
                        analysis.</p>
                  </div>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Maps and arrays are functions, and it is possible to look up a value in a map
                     or array using a dynamic function call of the form <code>$map($key)</code> or
                     <code>$array($index)</code>. If it is statically known that the function in question
                     is a map or array, then it is also known that the argument type is <code>xs:anyAtomicType</code>,
                     and that the operand usage is therefore <a title="absorption" class="termref" href="#dt-absorption">absorption</a>. A call that
                     passes a streamed node will therefore be <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.
                     However, if it is not known statically that the function is a map or array, then the expression
                     will generally be <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     <p>This means it is desirable to declare the type of any variable holding a map or array. 
                     If streamable nodes are used to lookup a value in a map or array, then it may be advisable to use
                     the <code>map:get</code> or <code>array:get</code> functions explicitly; or
                     the lookup operator (<code>?</code>).</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-variable-references"></a>12.7.12 <a href="#streamability-of-variable-references" style="text-decoration: none">Streamability of Variable References</a></h4>
                  <p>For variable references that are bound to the
                        <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> of a <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>
                     <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet function</a><sup><small>XT</small></sup>, see the rules for the <a title="streamability category" class="termref" href="#dt-streamability-category">streamability category</a> of the containing function, under <a href="#streamable-stylesheet-functions"><b>8.1 Classifying Stylesheet Functions</b></a>.</p>
                  <p>In all other cases, variable references are <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and
                        <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-context-item-expression"></a>12.7.13 <a href="#streamability-of-context-item-expression" style="text-decoration: none">Streamability of the Context Item Expression</a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the expression is the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a>, and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Although <code>.</code> is intrinsically motionless, when used in certain
                        contexts (such as <code>data(.)</code>) the containing expression will be
                           <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. This arises because of the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>: the argument to <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-data"><code>data</code></a> has
                        usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, and the combination of a <a title="motionless" class="termref" href="#dt-motionless">motionless</a> operand with usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>
                        leads to the containing expression being <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                     <p>Similarly, if <code>.</code> is used where the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is <a title="navigation" class="termref" href="#dt-navigation">navigation</a>, the
                        containing expression will be <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-function-calls"></a>12.7.14 <a href="#streamability-of-function-calls" style="text-decoration: none">Streamability of Static Function Calls</a></h4>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This section applies to static function calls written using the traditional
                     syntax <code>F(X, Y, Z)</code> and equally to those using the syntax <code>X =&gt; F(Y, Z)</code></p>
                  </div>
                  <p>For calls to built-in functions, see <a href="#classifying-built-in-functions"><b>12.8 Classifying Calls to Built-In Functions</b></a>.</p>
                  <p>For calls to <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet functions</a><sup><small>XT</small></sup>, see <a href="#streamable-stylesheet-functions"><b>8.1 Classifying Stylesheet Functions</b></a>.</p>
                  <p>For partial function applications (where one or more of the arguments is
                     supplied as a <code>?</code> placeholder), see the rules at the end of this
                     section.</p>
                  <p>For a call to a constructor function, the <a href="#general-streamability-rules"><b>3.10 General Streamability Rules</b></a> apply. There is a single operand role
                     (the argument to the function), with <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                     <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                  <p>For a call to an <a href="https://qt4cg.org/specifications/xslt-40/#dt-extension-function">extension function</a><sup><small>XT</small></sup>, the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> are <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a>.</p>
                  <p>If the function call is a partial function
                     application (that is, if one or more of the arguments is given as a
                        <code>?</code> placeholder), then:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the function is focus-dependent and
                              the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the function call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and
                           <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If the target of the function call is a
                              <a href="https://qt4cg.org/specifications/xslt-40/#dt-stylesheet-function">stylesheet function</a><sup><small>XT</small></sup>
                           that is <a title="declared-streamable" class="termref" href="#dt-declared-streamable">declared-streamable</a>, and if the first argument is actually
                           supplied (that is, this argument is not supplied as a <code>?</code>
                           placeholder), and if the expression
                              that is supplied as the first argument is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the function call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If the target is an <a href="https://qt4cg.org/specifications/xslt-40/#dt-extension-function">extension function</a><sup><small>XT</small></sup>, 
                          the <a title="posture" class="termref" href="#dt-posture">posture</a> and
                              <a title="sweep" class="termref" href="#dt-sweep">sweep</a> are <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply.
                              The operands of a partial function
                              application are the expressions actually supplied as arguments to the
                              function, ignoring <code>?</code> place-holders; the corresponding
                                 <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the declared type of that
                              argument.</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-named-function-ref"></a>12.7.15 <a href="#streamability-of-named-function-ref" style="text-decoration: none">Streamability of Named Function References</a></h4>
                  <p>Let <var>F</var> be the function to which the <code>NamedFunctionRef</code>
                     refers.</p>
                  <p>If <var>F</var> is focus-dependent and the
                           <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then the <code>NamedFunctionRef</code> is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                  <p>If <var>F</var> is an <a href="https://qt4cg.org/specifications/xslt-40/#dt-extension-function">extension function</a><sup><small>XT</small></sup>, the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> are <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a>.</p>
                  <p>Otherwise, the <code>NamedFunctionRef</code> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and
                     <a title="motionless" class="termref" href="#dt-motionless">motionless</a>. </p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The main intent behind these rules is to ensure that the function item
                        returned by a named function reference does not encapsulate a reference to a
                        streamed node.</p>
                     <p>In the case of an expression such as <code>local-name#0</code>,
                        implementations might be able to do better by pre-evaluating the function at
                        the point where the named function reference occurs.</p>
                     <p>In the case of extension functions, implementations may be able to
                        distinguish whether the function is focus-dependent, and decide the
                        streamability of the named function reference accordingly.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-inline-functions"></a>12.7.16 <a href="#streamability-of-inline-functions" style="text-decoration: none">Streamability of Inline Function Declarations</a></h4>
                  <p>An inline function declaration that textually
                     contains a variable reference bound to a <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a> (of some containing stylesheet function) is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and
                        <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                  <p>All other inline function declarations are <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>It is not possible to pass a streamed node as an argument to a call to an
                        inline function unless the declared type of the corresponding function
                        parameter causes the node to be atomized: see <a href="#streamability-of-dynamic-function-calls"><b>12.7.11 Streamability of Dynamic Function Calls</b></a>. The only other way an
                        inline function could access a streamed node is by having the streamed node
                        in its closure, and this is prevented by the rule above.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-map-constructors"></a>12.7.17 <a href="#streamability-of-map-constructors" style="text-decoration: none">Streamability of Map Constructors</a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a map
                     constructor (see  section <a href="../xquery-40/xpath-40.html#id-map-constructors">4.15.1.1 Map Constructors</a>) are the same as the
                        <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the equivalent
                        <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> instruction. The equivalent
                        <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> instruction is formed by creating a sequence of
                        <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a> instructions, one for each key/value pair in
                     the map expression, where the key expression becomes the value of
                        <code>xsl:map-entry/@key</code>, and the value expression becomes the value
                     of <code>xsl:map-entry/@select</code>; this sequence of
                        <a href="../../xslt-40/Overview.html#xsl:map-entry">xsl:map-entry</a> instructions is then wrapped in an
                        <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> parent instruction.</p>
                  <p>For example, the map constructor <code>{ 'red': false(),
                        'green': true() }</code> translates to the instruction:</p>
                  <div class="exampleInner">
                     <pre>
&lt;xsl:map&gt;
  &lt;xsl:map-entry key="'red'" select="false()"/&gt;
  &lt;xsl:map-entry key="'green'" select="true()"/&gt;
&lt;/xsl:map&gt;</pre>
                  </div>
                  <p>The rules for the streamability of <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a> appear in <a href="#streamability-xsl-map"><b>12.5.23 Streamability of xsl:map</b></a>.</p>
                  <p>See also <a href="#maps-streaming"><b>12.1 Maps and Streaming</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-of-lookup-expressions"></a>12.7.18 <a href="#streamability-of-lookup-expressions" style="text-decoration: none">Streamability of Lookup Expressions</a></h4>
                  <p>For the unary lookup operator, the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> 
                     of the expression <code>?X</code> are
                     defined to be the same as the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> 
                     of the postfix lookup expression <code>.?X</code>.</p>
                  <p>For the postfix lookup expression <code>E?K</code>, the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>In the wildcard form of the expression, <code>E?*</code>, there is only one operand, <code>E</code>.
                     This has <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> <a title="inspection" class="termref" href="#dt-inspection">inspection</a>.</p>
                     </li>
                     <li>
                        <p>Where the construct <code>K</code> is an NCName, the expression <code>E?NAME</code> is treated as
                        equivalent to <code>E?("NAME")</code>.</p>
                     </li>
                     <li>
                        <p>Where the construct <code>K</code> is an integer, the expression <code>E?N</code> is treated as
                        equivalent to <code>E?(N)</code>.</p>
                     </li>
                     <li>
                        <p>In the general case where <code>K</code> is a parenthesized expression, the lookup expression
                        <code>E?(K)</code> has two operands. The first operand <code>E</code> has <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> 
                        <a title="inspection" class="termref" href="#dt-inspection">inspection</a>, while the second operand <code>K</code> has <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                        <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                     </li>
                  </ol>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="classifying-built-in-functions"></a>12.8 <a href="#classifying-built-in-functions" style="text-decoration: none">Classifying Calls to Built-In Functions</a></h3>
               <p>This section describes the rules that determine the streamability of calls to
                  built-in functions. These differ from user-written functions because it is known
                  (defined in the specification) how nodes supplied as operands are used. Knowledge
                  of the usage of each operand, together with the <a title="posture" class="termref" href="#dt-posture">posture</a> of the
                  actual operands, is in most cases enough to determine the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the function result.</p>
               <p>All the built-in functions are listed below. For most functions, a simple proforma
                  is shown that indicates the operand usage of each argument, using the code (A =
                     <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, I = <a title="inspection" class="termref" href="#dt-inspection">inspection</a>, T =
                     <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, N = <a title="navigation" class="termref" href="#dt-navigation">navigation</a>). So, for
                  example, the entry <code>fn:remove(T, A)</code> means that for the function
                     <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-remove"><code>fn:remove#2</code></a>, the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of the first
                  argument is <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, and the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of the second argument is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>. By reference to the general rules in <a href="#general-streamability-rules"><b>3.10 General Streamability Rules</b></a>, this demonstrates that if the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a>, the posture and sweep of the expression
                     <code>sum(remove(*,1))</code> will be <code>grounded</code> and
                     <code>consuming</code> respectively. </p>
               <p>For functions that default one of their arguments (typically to the context item),
                  the relevant entry shows the equivalence, and the posture and sweep can in these
                  cases be computed by filling in the default value for the relevant argument.</p>
               <p>Some functions do not follow the general rules, and these are listed with a link
                  to the section where the particular rules for that function are described.</p>
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               <ul>
                  <li>
                     <p><code>array:append(I, N)</code></p>
                  </li>
                  <li>
                     <p><code>array:build(N, I)</code></p>
                  </li>
                  <li>
                     <p><code>array:empty(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:filter(I, I)</code></p>
                  </li>
                  <li>
                     <p><code>array:flatten(T)</code></p>
                  </li>
                  <li>
                     <p><code>array:fold-left(I, N, I)</code></p>
                  </li>
                  <li>
                     <p><code>array:fold-right(I, N, I)</code></p>
                  </li>
                  <li>
                     <p><code>array:foot</code> – See </p>
                  </li>
                  <li>
                     <p><code>array:for-each(I, I)</code></p>
                  </li>
                  <li>
                     <p><code>array:for-each-pair(I, I, I)</code></p>
                  </li>
                  <li>
                     <p><code>array:get(I, A)</code></p>
                  </li>
                  <li>
                     <p><code>array:get(I, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>array:head(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:index-of(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>array:index-where(I, I)</code></p>
                  </li>
                  <li>
                     <p><code>array:insert-before(I, A, N)</code></p>
                  </li>
                  <li>
                     <p><code>array:items(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:join(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:members(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:of-members(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:put(I, I, N)</code></p>
                  </li>
                  <li>
                     <p><code>array:remove(I, A)</code></p>
                  </li>
                  <li>
                     <p><code>array:reverse(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:size(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:slice(I, A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>array:sort(N, A, I)</code></p>
                  </li>
                  <li>
                     <p><code>array:sort-by(N, A)</code></p>
                  </li>
                  <li>
                     <p><code>array:sort-with(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>array:split(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:subarray(I, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>array:tail(I)</code></p>
                  </li>
                  <li>
                     <p><code>array:trunk</code> – See </p>
                  </li>
                  <li>
                     <p><code>fn:abs(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:accumulator-after</code> – See <a href="#streamability-fn-accumulator-after"><b>12.8.1 Streamability of the accumulator-after Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:accumulator-before</code> – See <a href="#streamability-fn-accumulator-before"><b>12.8.2 Streamability of the accumulator-before Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:adjust-date-to-timezone(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:adjust-dateTime-to-timezone(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:adjust-time-to-timezone(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:all-different(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:all-equal(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:analyze-string(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:apply(I, N)</code></p>
                  </li>
                  <li>
                     <p><code>fn:apply-templates(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:atomic-equal(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:atomic-type-annotation(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:available-environment-variables()</code></p>
                  </li>
                  <li>
                     <p><code>fn:available-system-properties()</code></p>
                  </li>
                  <li>
                     <p><code>fn:avg(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:base-uri(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:boolean(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:build-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:build-uri(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:ceiling(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:char(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:character-map(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:characters(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:civil-timezone(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:codepoint-equal(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:codepoints-to-string(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:collation(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:collation-available(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:collation-key(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:collection(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:compare(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:concat(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:contains(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:contains-subsequence(T, T, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:contains-token(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:copy-of(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:count(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:csv-doc(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:csv-to-arrays(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:csv-to-xml(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:current</code> – See <a href="#streamability-fn-current"><b>12.8.3 Streamability of the current Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:current-date()</code></p>
                  </li>
                  <li>
                     <p><code>fn:current-dateTime()</code></p>
                  </li>
                  <li>
                     <p><code>fn:current-group</code> – See <a href="#streamability-fn-current-group"><b>12.8.4 Streamability of the current-group Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:current-grouping-key</code> – See <a href="#streamability-fn-current-grouping-key"><b>12.8.5 Streamability of the current-grouping-key
                     Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:current-merge-group</code> – See <a href="#streamability-fn-current-merge-group"><b>12.8.6 Streamability of the current-merge-group
                     Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:current-merge-key</code> – See <a href="#streamability-fn-current-merge-key"><b>12.8.7 Streamability of the current-merge-key Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:current-merge-key-array</code> – See <a href="#streamability-fn-current-merge-key-array"><b>12.8.8 Streamability of the current-merge-key-array Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:current-output-uri()</code></p>
                  </li>
                  <li>
                     <p><code>fn:current-time()</code></p>
                  </li>
                  <li>
                     <p><code>fn:data(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:dateTime(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:day-from-date(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:day-from-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:days-from-duration(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:decode-from-uri(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:deep-equal(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:default-collation()</code></p>
                  </li>
                  <li>
                     <p><code>fn:default-language()</code></p>
                  </li>
                  <li>
                     <p><code>fn:distinct-ordered-nodes</code> – See <a href="#streamability-fn-distinct-ordered-nodes"><b>12.8.9 Streamability of the distinct-ordered-nodes Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:distinct-values(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:divide-decimals(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:do-until(N, I, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:doc(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:doc-available(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:document(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:document-uri(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:duplicate-values(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:element-available(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:element-to-map(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:element-to-map-plan(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:element-with-id(A, N)</code></p>
                  </li>
                  <li>
                     <p><code>fn:empty(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:encode-for-uri(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:ends-with(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:ends-with-subsequence(T, T, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:environment-variable(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:error(A, A, N)</code></p>
                  </li>
                  <li>
                     <p><code>fn:escape-html-uri(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:every(N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:exactly-one(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:exists(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:expanded-QName(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:false()</code></p>
                  </li>
                  <li>
                     <p><code>fn:filter(N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:floor(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:fold-left(N, A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:fold-right</code> – See <a href="#streamability-fn-fold-right"><b>12.8.11 Streamability of the fold-right Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:foot</code> – See <a href="#streamability-fn-foot"><b>12.8.12 Streamability of the foot Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:for-each(N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:for-each-pair(N, N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:format-date(A, A, A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:format-dateTime(A, A, A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:format-integer(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:format-number(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:format-time(A, A, A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:function-annotations(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:function-arity(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:function-available(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:function-identity(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:function-lookup</code> – See <a href="#streamability-fn-function-lookup"><b>12.8.15 Streamability of the function-lookup Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:function-name(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:generate-id(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:graphemes(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:has-children(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:hash(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:head(T)</code></p>
                  </li>
                  <li>
                     <p><code>fn:highest(N, A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:hours-from-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:hours-from-duration(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:hours-from-time(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:html-doc(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:id(A, N)</code></p>
                  </li>
                  <li>
                     <p><code>fn:identity(T)</code></p>
                  </li>
                  <li>
                     <p><code>fn:idref(A, N)</code></p>
                  </li>
                  <li>
                     <p><code>fn:implicit-timezone()</code></p>
                  </li>
                  <li>
                     <p><code>fn:in-scope-namespaces(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:in-scope-prefixes(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:index-of(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:index-where(N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:innermost</code> – See <a href="#streamability-fn-innermost"><b>12.8.16 Streamability of the innermost Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:insert-before(T, A, T)</code></p>
                  </li>
                  <li>
                     <p><code>fn:insert-separator(N, N)</code></p>
                  </li>
                  <li>
                     <p><code>fn:invisible-xml(N, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:iri-to-uri(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:is-NaN(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:items-at(T, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:jnode-content(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:jnode-position(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:jnode-selector(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:json-doc(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:json-to-xml(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:jtree(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:key(A, A, N)</code></p>
                  </li>
                  <li>
                     <p><code>fn:lang(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:last</code> – See <a href="#streamability-fn-last"><b>12.8.17 Streamability of the last Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:load-xquery-module(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:local-name(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:local-name-from-QName(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:lower-case(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:lowest(N, A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:map-for-key(A, N)</code></p>
                  </li>
                  <li>
                     <p><code>fn:matches(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:max(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:message(T, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:min(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:minutes-from-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:minutes-from-duration(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:minutes-from-time(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:month-from-date(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:month-from-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:months-from-duration(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:name(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:namespace-uri(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:namespace-uri-for-prefix(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:namespace-uri-from-QName(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:nilled(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:node-name(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:node-type-annotation(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:normalize-space(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:normalize-unicode(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:not(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:number(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:one-or-more(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:op(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:outermost</code> – See <a href="#streamability-fn-outermost"><b>12.8.18 Streamability of the outermost Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:parse-csv(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:parse-html(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:parse-ietf-date(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:parse-integer(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:parse-json(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:parse-QName(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:parse-uri(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:parse-xml(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:parse-xml-fragment(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:partial-apply(I, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:partition(N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:parts-of-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:path(N, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:position</code> – See <a href="#streamability-fn-position"><b>12.8.19 Streamability of the position Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:prefix-from-QName(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:QName(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:random-number-generator(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:regex-group(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:regex-groups()</code></p>
                  </li>
                  <li>
                     <p><code>fn:remove(T, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:replace(A, A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:replicate(N, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:resolve-QName(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:resolve-uri(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:reverse</code> – See <a href="#streamability-fn-reverse"><b>12.8.20 Streamability of the reverse Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:root</code> – See <a href="#streamability-fn-root"><b>12.8.21 Streamability of the root Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:round(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:round-half-to-even(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:scan-left(N, N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:scan-right(N, N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:schema-type(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:seconds(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:seconds-from-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:seconds-from-duration(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:seconds-from-time(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:serialize(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:siblings(N)</code></p>
                  </li>
                  <li>
                     <p><code>fn:slice(T, A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:snapshot(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:some(N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:sort(N, A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:sort-by(N, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:sort-with(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:starts-with(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:starts-with-subsequence(T, T, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:static-base-uri()</code></p>
                  </li>
                  <li>
                     <p><code>fn:stream-available(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:string(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:string-join(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:string-length(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:string-to-codepoints(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:subsequence(T, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:subsequence-where(T, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:substring(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:substring-after(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:substring-before(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:sum(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:system-property(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:tail(T)</code></p>
                  </li>
                  <li>
                     <p><code>fn:take-while(N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:timezone-from-date(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:timezone-from-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:timezone-from-time(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:tokenize(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:trace(T, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:transform(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:transitive-closure(N, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:translate(A, A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:true()</code></p>
                  </li>
                  <li>
                     <p><code>fn:trunk</code> – See <a href="#streamability-fn-trunk"><b>12.8.22 Streamability of the trunk Function</b></a></p>
                  </li>
                  <li>
                     <p><code>fn:type-available(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:type-of(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:unix-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:unordered(T)</code></p>
                  </li>
                  <li>
                     <p><code>fn:unparsed-binary(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:unparsed-entity-public-id(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:unparsed-entity-uri(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:unparsed-text(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:unparsed-text-available(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:unparsed-text-lines(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:upper-case(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:uri-collection(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:void(I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:while-do(N, I, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:xml-to-json(A, I)</code></p>
                  </li>
                  <li>
                     <p><code>fn:xsd-validator(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:year-from-date(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:year-from-dateTime(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:years-from-duration(A)</code></p>
                  </li>
                  <li>
                     <p><code>fn:zero-or-one(I)</code></p>
                  </li>
                  <li>
                     <p><code>map:build(N, I, I, A)</code></p>
                  </li>
                  <li>
                     <p><code>map:contains(I, A)</code></p>
                  </li>
                  <li>
                     <p><code>map:empty(I)</code></p>
                  </li>
                  <li>
                     <p><code>map:entries(I)</code></p>
                  </li>
                  <li>
                     <p><code>map:entry(A, N)</code></p>
                  </li>
                  <li>
                     <p><code>map:filter(I, I)</code></p>
                  </li>
                  <li>
                     <p><code>map:find(I, A)</code></p>
                  </li>
                  <li>
                     <p><code>map:for-each(I, I)</code></p>
                  </li>
                  <li>
                     <p><code>map:get(I, A, T)</code></p>
                  </li>
                  <li>
                     <p><code>map:items(I)</code></p>
                  </li>
                  <li>
                     <p><code>map:keys(I)</code></p>
                  </li>
                  <li>
                     <p><code>map:keys-where(I, I)</code></p>
                  </li>
                  <li>
                     <p><code>map:merge(I, I)</code></p>
                  </li>
                  <li>
                     <p><code>map:put(I, A, N)</code></p>
                  </li>
                  <li>
                     <p><code>map:remove(I, A)</code></p>
                  </li>
                  <li>
                     <p><code>map:size(I)</code></p>
                  </li>
                  <li>
                     <p><code>math:acos(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:asin(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:atan(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:atan2(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>math:cos(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:cosh(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:e()</code></p>
                  </li>
                  <li>
                     <p><code>math:exp(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:exp10(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:log(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:log10(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:pi()</code></p>
                  </li>
                  <li>
                     <p><code>math:pow(A, A)</code></p>
                  </li>
                  <li>
                     <p><code>math:sin(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:sinh(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:sqrt(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:tan(A)</code></p>
                  </li>
                  <li>
                     <p><code>math:tanh(A)</code></p>
                  </li>
               </ul>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-accumulator-after"></a>12.8.1 <a href="#streamability-fn-accumulator-after" style="text-decoration: none">Streamability of the <code>accumulator-after</code> Function</a></h4>
                  <p>See also <a href="#streamability-of-accumulators"><b>11 Streamable Accumulators</b></a>.</p>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the function call is in all cases <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                  <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is determined by applying the following rules, in
                     order:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the first argument (the accumulator name) is not <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, the function is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>. </p>
                     </li>
                     <li>
                        <p>If the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, the function is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>. </p>
                     </li>
                     <li>
                        <p>If the <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> has an empty intersection
                           with <var>U{document-node(), element()}</var> (that is, if the context
                           item cannot have children), the function is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>. </p>
                     </li>
                     <li>
                        <p>If the function call is contained in the <code>select</code> expression
                           or contained sequence constructor of an
                              <a href="../../xslt-40/Overview.html#xsl:accumulator-rule">xsl:accumulator-rule</a> specifying
                              <code>phase="start"</code>, then it is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                     <li>
                        <p>If the function call is contained in the <code>select</code> expression
                           or contained sequence constructor of an
                              <a href="../../xslt-40/Overview.html#xsl:accumulator-rule">xsl:accumulator-rule</a> specifying
                              <code>phase="end"</code>, then it is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>If no enclosing node of the function
                              call is part of a <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, then it is
                                 <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>. For this purpose, the
                                 <b>enclosing nodes</b> of a function call are the attribute
                              or text node that immediately contains the XPath expression in which
                              the function call appears, and its ancestors.
                        </p>
                     </li>
                     <li>
                        <p>If the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of the function call
                           is different from the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> of the
                           innermost containing <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instruction</a><sup><small>XT</small></sup>, then the function
                           is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>. </p>
                     </li>
                     <li>
                        <p>If no enclosing node <var>N</var> of
                              the function call has a preceding sibling node <var>P</var> such that
                              (a) <var>N</var> and <var>P</var> are part of the same <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>, and (b) the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <var>P</var> is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>,
                              then the function call is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. (The term
                                 <b>enclosing node</b> is defined above.)</p>
                     </li>
                     <li>
                        <p>Otherwise, the function call is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The following notes apply to the above rules with matching numbers:</p>
                     <ol class="enumar">
                        <li>
                           <p>This rule prevents the accumulator name being computed by reading the
                              streamed source document. This is disallowed primarily because there
                              is no conceivable use case for doing it.</p>
                        </li>
                        <li>
                           <p>If the context posture is grounded, then the target of the accumulator
                              is not a streamed node, so no streaming restrictions apply.</p>
                        </li>
                        <li>
                           <p>If the context item is a childless node (such as a text node), then
                              both the pre-descent and post-descent values of the accumulator can be
                              computed before evaluating any user-written constructs that access
                              this node; there are therefore no constraints on where a call to
                                 <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> can appear.</p>
                        </li>
                        <li>
                           <p>This rule ensures that when computing the pre-descent value of an
                              accumulator for a particular streamed node, the post-descent values of
                              accumulators for that node are not available.</p>
                        </li>
                        <li>
                           <p>This rule states that the post-descent value of an accumulator is
                              allowed to depend on the post-descent values of other accumulators for
                              the same node. There is a rule preventing cycles <a href="https://qt4cg.org/specifications/xslt-40/#ERRXTDE3400" title="XTDE3400"><span class="error">[ERR XTDE3400] </span></a><sup><small>XT40</small></sup>.</p>
                        </li>
                        <li>
                           <p>This rule prevents the use of the function (when applied to a streamed
                              node) in contexts like the <code>use</code> attribute of
                                 <a href="../../xslt-40/Overview.html#xsl:key">xsl:key</a>. It
                                 allows its use in the attributes of an <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instruction</a><sup><small>XT</small></sup> or <a href="https://qt4cg.org/specifications/xslt-40/#dt-literal-result-element">literal result element</a><sup><small>XT</small></sup>, 
                             or in a <a href="https://qt4cg.org/specifications/xslt-40/#dt-text-value-template">text value template</a><sup><small>XT</small></sup>. It does not allow use in an
                                    <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> or <a href="../../xslt-40/Overview.html#xsl:param">xsl:param</a> element,
                                 as these elements do not form part of a sequence constructor (see
                                    <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#sequence-constructors">5.7 Sequence Constructors</a>).</p>
                        </li>
                        <li>
                           <p>This rule prevents the use of the function (when applied to a streamed
                              node) in contexts such as predicates, or the right-hand side of the
                              <code>/</code> operator. The focus for evaluation of the function must be the
                              same as the focus for a containing sequence constructor. Sequence
                              constructors are treated differently from all other constructs for
                              this purpose in that their operands (the contained instructions) are
                              treated as ordered: in conjunction with the next rule, this rule is
                              assuming that instructions in a sequence constructor that follow a
                                 <a title="consuming" class="termref" href="#dt-consuming">consuming</a> instruction are evaluated after the
                                 <a title="consuming" class="termref" href="#dt-consuming">consuming</a> instruction and therefore have access
                              to the post-descent accumulator value.</p>
                        </li>
                        <li>
                           <p>This rule is subtle, and has a number of consequences. In these notes, the term
                                    <b>instruction</b> should be read as including all nodes
                                 making up a sequence constructor, including XSLT instructions,
                                 extension instructions, literal result elements, and text nodes
                                 containing text value templates.</p>
                           <ul>
                              <li>
                                 <p>In a sequence constructor that contains a <a title="consuming" class="termref" href="#dt-consuming">consuming</a> instruction such as
                                       <code>&lt;xsl:apply-templates/&gt;</code>, it allows any
                                    number of calls on <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> to
                                    appear in instructions that follow the call on
                                       <code>&lt;xsl:apply-templates/&gt;</code>.</p>
                              </li>
                              <li>
                                 <p>In such a sequence constructor it prevents a call on
                                       <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> from appearing in an
                                    instruction that precedes the
                                       <code>&lt;xsl:apply-templates/&gt;</code>, because there
                                    would then be two <a title="consuming" class="termref" href="#dt-consuming">consuming</a>
                                    instructions.</p>
                              </li>
                              <li>
                                 <p>In a sequence constructor that contains calls on
                                       <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a>, and contains no other
                                       <a title="consuming" class="termref" href="#dt-consuming">consuming</a> construct, the first
                                    instruction that contains a call on
                                       <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> is consuming (unless
                                    it contains more than one such call, in which case it is
                                    free-ranging), and subsequent instructions containing such a
                                    call are motionless. So it is possible to have two or more calls
                                    on <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> provided they appear
                                    in different instructions, which allows the analysis to assume
                                    an order of execution.</p>
                              </li>
                              <li>
                                 <p>It prevents a call on <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a>
                                    from appearing in the same instruction as another consuming
                                    construct: for example it disallows <code>concat(child::p,
                                       accumulator-after('a'))</code>. This rule preserves the
                                    ability to evaluate the arguments of the <code>concat</code>
                                    function in any order.</p>
                              </li>
                              <li>
                                 <p>It disallows a call on <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a>
                                    from appearing in a sequence constructor that is required to be
                                    motionless, for example within <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a>.</p>
                              </li>
                              <li>
                                 <p>The reference to a “preceding sibling node within the same
                                    sequence constructor” is carefully worded to ensure that
                                    preceding siblings among the children of
                                       <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a> are not taken into account; the
                                    children of <a href="../../xslt-40/Overview.html#xsl:fork">xsl:fork</a> are sibling instructions,
                                    but do not constitute a sequence constructor. The term also excludes elements such as
                                          <a href="../../xslt-40/Overview.html#xsl:param">xsl:param</a> and <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a>
                                       that may precede a sequence constructor but are not part of
                                       it.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The final rule states that if none of the previous rules apply, the
                              function is considered motionless. This applies when the
                                 <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> appears after a consuming
                              instruction within the same sequence constructor.</p>
                           <p>Note also that a call to <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> can
                              safely appear within a construct such as a named template or
                              (non-streamable) stylesheet function; this is safe because the rules
                              ensure that in such situations, the context item cannot be a streamed
                              node.</p>
                        </li>
                     </ol>
                  </div>
                  <p>Dynamic invocation of <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> is covered by the
                     rules in <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#function-lookup">10.3.5 Dynamic Access to Functions</a>. These rules ensure that a function
                     item cannot include a streamed node in its closure; circumventing the
                     streamability rules for <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-after"><code>accumulator-after</code></a> by making a
                     dynamic call is therefore not possible.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-accumulator-before"></a>12.8.2 <a href="#streamability-fn-accumulator-before" style="text-decoration: none">Streamability of the <code>accumulator-before</code> Function</a></h4>
                  <p>See also <a href="#streamability-of-accumulators"><b>11 Streamable Accumulators</b></a>.</p>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the function call are assessed as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the argument to <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-accumulator-before"><code>accumulator-before</code></a> is motionless,
                           the function call is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>Otherwise, the function call is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-current"></a>12.8.3 <a href="#streamability-fn-current" style="text-decoration: none">Streamability of the <code>current</code> Function</a></h4>
                  <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> and <a title="posture" class="termref" href="#dt-posture">posture</a> of a call to the
                        <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current"><code>current</code></a> function are determined as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>If the call appears within a pattern, then climbing and motionless.</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>The call to <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current"><code>current</code></a> will always be within a predicate of the pattern.
                        The use of climbing posture here allows predicates such as <code>[@class = current()/@class]</code>,
                        while disallowing downwards navigation from the node returned by the function.</p>
                        </div>
                     </li>
                     <li>
                        <p>Otherwise, let <var>E</var> be the outermost containing XPath expression of the call
                           to the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current"><code>current</code></a> function.</p>
                     </li>
                     <li>
                        <p>If the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of <var>E</var> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, then <a title="motionless" class="termref" href="#dt-motionless">motionless</a> and <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                     </li>
                     <li>
                        <p>If the path in the expression tree that connects the call on
                              <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current"><code>current</code></a> to <var>E</var> (excluding <var>E</var>
                           itself) contains an expression that is a <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> of its parent expression, then
                              <a title="motionless" class="termref" href="#dt-motionless">motionless</a> and <a title="climbing" class="termref" href="#dt-climbing">climbing</a>. </p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>Many common uses of the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current"><code>current</code></a>, such as
                                 <code>//p[@class=current()/@class]</code>, fall into this category:
                              a predicate is a higher-order operand of its containing filter
                              expression.</p>
                           <p>The use of <a title="climbing" class="termref" href="#dt-climbing">climbing</a> posture here might seem
                              unrelated to its usual connection with the ancestor axis. The
                              explanation (apart from the fact that it happens to produce the right
                              results) lies in the fact that at the point where the
                                 <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current"><code>current</code></a> call is evaluated, the node it returns
                              will always be an ancestor-or-self of the context node, as a
                              consequence of the fact that the containing XPath expression is
                              required to be either <a title="motionless" class="termref" href="#dt-motionless">motionless</a> or <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                           <p>The effect of the rule is to allow
                              expressions such as <code>//*[name() = name(current())]</code> or
                                 <code>//*[@ref = current()/@id]</code>.</p>
                        </div>
                     </li>
                     <li>
                        <p>Otherwise, the <a title="posture" class="termref" href="#dt-posture">posture</a> is the 
                        <a title="context posture" class="termref" href="#dt-context-posture">context posture</a>, and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is 
                        <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                  </ol>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-current-group"></a>12.8.4 <a href="#streamability-fn-current-group" style="text-decoration: none">Streamability of the <code>current-group</code> Function</a></h4>
                  <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> and <a title="posture" class="termref" href="#dt-posture">posture</a> of a call <var>C</var> to the
                        <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-group"><code>current-group</code></a> function are as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>If all the following conditions are true:</p>
                        <ol class="enumla">
                           <li>
                              <p><var>C</var> has a containing <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a>
                                 instruction (call it <var>F</var>)</p>
                           </li>
                           <li>
                              <p>The path in the construct tree that connects <var>C</var> to the
                                 sequence constructor forming the body of <var>F</var> is such that
                                 no child construct is a <a title="higher-order operand" class="termref" href="#dt-higher-order-operand">higher-order operand</a> of
                                 its parent</p>
                           </li>
                           <li>
                              <p>The <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a>
                                 of <var>C</var> is <var>F</var></p>
                           </li>
                        </ol>
                        <p>then the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> and <a title="posture" class="termref" href="#dt-posture">posture</a> of
                              <var>C</var> are the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> and <a title="posture" class="termref" href="#dt-posture">posture</a> of the <code>select</code> expression of
                              <var>F</var>.</p>
                     </li>
                     <li>
                        <p>Otherwise, <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Informally, for streamed evaluation to be possible, a call to
                           <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-group"><code>current-group</code></a> must not appear in a construct that is
                        evaluated repeatedly. For example, the expression <code>for $i in 1 to 10
                           return current-group()</code> would not be streamable.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-current-grouping-key"></a>12.8.5 <a href="#streamability-fn-current-grouping-key" style="text-decoration: none">Streamability of the <code>current-grouping-key</code>
                        Function</a></h4>
                  <p>A call to the
                        <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-grouping-key"><code>current-grouping-key</code></a> function is grounded and
                     motionless.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-current-merge-group"></a>12.8.6 <a href="#streamability-fn-current-merge-group" style="text-decoration: none">Streamability of the <code>current-merge-group</code>
                        Function</a></h4>
                  <p>A call to the
                        <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-merge-group"><code>current-merge-group</code></a> function is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This is because the nodes to be merged are always snapshots, and therefore
                           <a title="grounded" class="termref" href="#dt-grounded">grounded</a>: see <a href="#streamable-merging"><b>10 Streamable Merging</b></a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-current-merge-key"></a>12.8.7 <a href="#streamability-fn-current-merge-key" style="text-decoration: none">Streamability of the <code>current-merge-key</code> Function</a></h4>
                  <p>A call to the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-merge-key"><code>current-merge-key</code></a> function is 
                     <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-current-merge-key-array"></a>12.8.8 <a href="#streamability-fn-current-merge-key-array" style="text-decoration: none">Streamability of the <code>current-merge-key-array</code> Function</a></h4>
                  <p>A call to the <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-current-merge-key-array"><code>current-merge-key-array</code></a> 
                     function is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-distinct-ordered-nodes"></a>12.8.9 <a href="#streamability-fn-distinct-ordered-nodes" style="text-decoration: none">Streamability of the <code>distinct-ordered-nodes</code> Function</a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a call to the
                     <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-distinct-ordered-nodes"><code>distinct-ordered-nodes</code></a> function are the same as the
                     <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the first argument.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-fold-left"></a>12.8.10 <a href="#streamability-fn-fold-left" style="text-decoration: none">Streamability of the <code>fold-left</code> Function</a></h4>
                  <p>The function call <code>fold-left($seq, $zero, $f)</code>, follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, with the first argument
                        <code>$seq</code> having <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on
                     the type of the second argument of the function supplied as
                     <code>$f</code>.</p>
                  <p>For example, given the call <code>fold-left(/*/transaction, 0, fn($x as
                        xs:decimal, $y as xs:decimal) as xs:decimal { $x + $y })</code>, the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of the argument <code>/*/transaction</code> is
                     determined by the declared type of <code>$y</code>, namely
                        <code>xs:decimal</code>. Since this is an atomic type, the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>. Applying
                     this to the general streamability rules, the function call is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-fold-right"></a>12.8.11 <a href="#streamability-fn-fold-right" style="text-decoration: none">Streamability of the <code>fold-right</code> Function</a></h4>
                  <p>The function follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, with
                     the first argument having <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                     <a title="navigation" class="termref" href="#dt-navigation">navigation</a> to reflect the fact that the supplied sequence
                     is processed in reverse order.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The same considerations apply as for the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-reverse"><code>reverse</code></a>
                        function: see <a href="#streamability-fn-reverse"><b>12.8.20 Streamability of the reverse Function</b></a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-foot"></a>12.8.12 <a href="#streamability-fn-foot" style="text-decoration: none">Streamability of the <code>foot</code> Function</a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the expression
                     <code>foot($x)</code> are defined to be the same as the <a title="posture" class="termref" href="#dt-posture">posture</a> 
                     and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the equivalent expression <code>$x[position()=last()]</code>.
                     See <a href="#streamability-fn-last"><b>12.8.17 Streamability of the last Function</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-for-each"></a>12.8.13 <a href="#streamability-fn-for-each" style="text-decoration: none">Streamability of the <code>for-each</code> Function</a></h4>
                  <p>The function call <code>for-each($seq, $f)</code>, follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, with the first argument
                        <code>$seq</code> having <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on
                     the type of the (single) argument of the function supplied as
                     <code>$f</code>.</p>
                  <p>For example, given the call <code>for-each(/*/transaction, fn($x as
                        xs:decimal) as xs:decimal {abs($x)})</code>, the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> of the argument <code>/*/transaction</code> is
                     determined by the declared type of <code>$x</code>, namely
                        <code>xs:decimal</code>. Since this is an atomic type, the <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>. Applying
                     this to the general streamability rules, the function call is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>In practice, the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-filter"><code>filter</code></a> function is streamable if
                        either (a) the supplied sequence is grounded, or (b) the supplied function
                        is statically known to atomize its argument.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-for-each-pair"></a>12.8.14 <a href="#streamability-fn-for-each-pair" style="text-decoration: none">Streamability of the <code>for-each-pair</code> Function</a></h4>
                  <p>The function call <code>for-each($seq1, $seq2, $f)</code>, follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, where:</p>
                  <ol class="enumar">
                     <li>
                        <p>The first argument <code>$seq1</code> has <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the type of the first
                              argument of the function supplied as <code>$f</code>.</p>
                     </li>
                     <li>
                        <p>The second argument <code>$seq2</code> has <a title="type-determined usage" class="termref" href="#dt-type-determined-usage">type-determined usage</a> based on the type of the second
                              argument of the function supplied as <code>$f</code></p>
                     </li>
                  </ol>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>In practice, the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-for-each-pair"><code>for-each-pair</code></a> function is streamable
                        provided (a) at most one of the input sequences is consuming, and (b) either
                        (i) that input sequence is grounded, or (ii) the supplied function is
                        statically known to atomize the relevant argument.</p>
                     <p>If it is necessary to combine two sequences that are both streamed, consider
                        using <a href="../../xslt-40/Overview.html#xsl:merge">xsl:merge</a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-function-lookup"></a>12.8.15 <a href="#streamability-fn-function-lookup" style="text-decoration: none">Streamability of the <code>function-lookup</code> Function</a></h4>
                  <p>See <a href="#xslt-40">[XSLT 4.0]</a> section <a href="../xslt-40/#function-lookup">10.3.5 Dynamic Access to Functions</a> for special rules that relate to
                     streamability of calls to the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-function-lookup"><code>function-lookup</code></a>
                     function.</p>
                  <p>With the caveats given there, the function follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, for a function with two arguments
                     that both have <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                     <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-innermost"></a>12.8.16 <a href="#streamability-fn-innermost" style="text-decoration: none">Streamability of the <code>innermost</code> Function</a></h4>
                  <p>The function follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, with
                     the first argument having <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                     <a title="navigation" class="termref" href="#dt-navigation">navigation</a>. This is to reflect the fact that the processing
                     is not strictly sequential: it cannot be determined that a node is part of the
                     result sequence of <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-innermost"><code>innermost</code></a> until all its descendants
                     have been read.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-last"></a>12.8.17 <a href="#streamability-fn-last" style="text-decoration: none">Streamability of the <code>last</code> Function</a></h4>
                  <p>If the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> for a call on the
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-last"><code>last</code></a> function is <a title="striding" class="termref" href="#dt-striding">striding</a>,
                        <a title="crawling" class="termref" href="#dt-crawling">crawling</a>, or <a title="roaming" class="termref" href="#dt-roaming">roaming</a>, then the
                        <a title="posture" class="termref" href="#dt-posture">posture</a> of the function is <a title="roaming" class="termref" href="#dt-roaming">roaming</a>,
                     and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
                  <p>In all other cases the function is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The cases where <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-last"><code>last</code></a> can be used without affecting
                        streamability are where the context item is either <a title="grounded" class="termref" href="#dt-grounded">grounded</a> or <a title="climbing" class="termref" href="#dt-climbing">climbing</a>. The latter condition
                        makes expressions like <code>ancestor::*[@xml:space][last()]</code>
                        streamable.</p>
                     <p>There are special rules restricting the use of <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-last"><code>last</code></a>
                        in the predicate of a pattern: see <a href="#classifying-patterns"><b>12.9 Classifying Patterns</b></a>.</p>
                     <p>Note that there are no restrictions preventing the
                     use of <code>last()</code> when the context posture is grounded. The implications of
                     this are discussed in <a href="#grounded-consuming-constructs"><b>12.3 Grounded Consuming Constructs</b></a>. In the case where
                     the sequence being processed is delivered by a consuming expression, using <code>last()</code>
                     may result in this sequence being buffered in memory.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-outermost"></a>12.8.18 <a href="#streamability-fn-outermost" style="text-decoration: none">Streamability of the <code>outermost</code> Function</a></h4>
                  <p>The single argument to this function has <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                     <a title="transmission" class="termref" href="#dt-transmission">transmission</a>.</p>
                  <p>The streamability of the function call follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> with one exception: if the <a title="posture" class="termref" href="#dt-posture">posture</a> of the argument is <a title="crawling" class="termref" href="#dt-crawling">crawling</a>, then the
                     posture of the result is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>There are cases where the streaming rules allow the construct
                           <code>outermost(//para)</code> but do not allow <code>//para</code>; the
                        function can therefore be useful in cases where it is known that
                           <code>para</code> elements will not be nested, as well as cases where the
                        application actually wishes to process all <code>para</code> elements except
                        those that are nested within another.</p>
                     <p>By contrast, the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-innermost"><code>innermost</code></a> function offers no
                        streaming benefits. Although it delivers a subset of the input nodes as its
                        result, in the correct order, it is classed as navigational because it needs
                        to look ahead in the input stream before deciding whether a node can be
                        included in the result.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-position"></a>12.8.19 <a href="#streamability-fn-position" style="text-decoration: none">Streamability of the <code>position</code> Function</a></h4>
                  <p>The <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-position"><code>position</code></a> function follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. Since it has no operands, this means
                     it is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Within an expression, there are no special difficulties in evaluating the
                           <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-position"><code>position</code></a> function.</p>
                     <p>It does have special treatment within a predicate of a <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup>, however: a pattern is not motionless if it contains a
                        call to <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-position"><code>position</code></a>, as explained in <a href="#classifying-patterns"><b>12.9 Classifying Patterns</b></a>. </p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-reverse"></a>12.8.20 <a href="#streamability-fn-reverse" style="text-decoration: none">Streamability of the <code>reverse</code> Function</a></h4>
                  <p>The <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-reverse"><code>reverse</code></a> function follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, with its operand classified as
                     having <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                     <a title="navigation" class="termref" href="#dt-navigation">navigation</a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This means in effect that a call on <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-reverse"><code>reverse</code></a> is not
                        streamable unless the operand is grounded. This may cause few surprises:</p>
                     <ul>
                        <li>
                           <p>The expression <code>reverse(/*/emp/copy-of())</code> is considered
                              streamable, although all the <code>emp</code> elements will typically
                              need to be in memory at the same time. The explanation here is that
                              the streamability rules do not attempt to restrict the amount of
                              memory used for data that is explicitly copied by use of a function
                              such as <a href="https://qt4cg.org/specifications/xslt-40/Overview.html#func-copy-of"><code>copy-of</code></a>.</p>
                        </li>
                        <li>
                           <p>The expression <code>reverse(ancestor::*)/name()</code> is considered
                              non-streamable, because the operand is not grounded. This problem can
                              be circumvented by rewriting the expression as
                                 <code>reverse(ancestor::*/name())</code></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-root"></a>12.8.21 <a href="#streamability-fn-root" style="text-decoration: none">Streamability of the <code>root</code> Function</a></h4>
                  <p>The zero-argument function <code>root()</code> is equivalent to
                        <code>root(.)</code>.</p>
                  <p>Given the expression <code>root(X)</code>, if the <a title="static type" class="termref" href="#dt-static-type">static type</a> of <code>X</code> is <var>U{document-node()}</var>, and if its <a title="posture" class="termref" href="#dt-posture">posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a>, then
                        <code>root(X)</code> is rewritten as <code>X</code>. Otherwise, it is
                     rewritten as <code>head((X)/ancestor-or-self::node())</code>. Streamability
                     analysis is then applied to the rewritten expression.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Because path expressions starting with <code>/</code> are rewritten to use
                        the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-root"><code>root</code></a> function, this ensures that a leading slash
                        is ignored if the context item is a document node, for example within a
                        template rule with <code>match="/"</code>. This improves streamability,
                        because upwards navigation followed by downward navigation is
                        disallowed.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="streamability-fn-trunk"></a>12.8.22 <a href="#streamability-fn-trunk" style="text-decoration: none">Streamability of the <code>trunk</code> Function</a></h4>
                  <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the expression
                     <code>trunk($x)</code> are defined to be the same as the <a title="posture" class="termref" href="#dt-posture">posture</a> 
                     and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the equivalent expression <code>$x[position()!=last()]</code>.
                     See <a href="#streamability-fn-last"><b>12.8.17 Streamability of the last Function</b></a>.</p>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="classifying-patterns"></a>12.9 <a href="#classifying-patterns" style="text-decoration: none">Classifying Patterns</a></h3>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>Patterns differ from other kinds of construct in that they are not composable
                     in the same way. It is best to think of a pattern as specialized syntax for a
                     function that takes an item as its argument and returns a boolean: <code>true</code> if the
                     pattern matches the item, otherwise <code>false</code>. The <a title="static type" class="termref" href="#dt-static-type">static type</a> of a pattern is therefore taken as
                           <var>U{xs:boolean}</var> (this is not to be confused with the type of the
                        items that the pattern is capable of matching).</p>
               </div>
               <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of a <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup>
                  is either <a title="motionless" class="termref" href="#dt-motionless">motionless</a> or <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.
                  (Although there are patterns that could in principle be evaluated by consuming the
                  element node that they match, these are of no interest in the analysis, so they
                  are classified as free-ranging.)</p>
               <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of a <a href="https://qt4cg.org/specifications/xslt-40/#dt-pattern">pattern</a><sup><small>XT</small></sup>
                  is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> if the pattern is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>,
                  or <a title="roaming" class="termref" href="#dt-roaming">roaming</a> otherwise. (This reflects the fact that a pattern
                  always returns a boolean result; it never returns a node in a streamed
                  document.)</p>
               <p>Informally, a <a title="motionless" class="termref" href="#dt-motionless">motionless</a> pattern is one that
                  can be evaluated by a streaming processor when the input stream is positioned at
                  the start of the node being matched, without
                  advancing the input stream.</p>
               <p>A pattern is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> if and only if it satisfies all the following
                     conditions:</p>
               <ol class="enumar">
                  <li>
                     <p>The pattern does not contain a <a href="https://qt4cg.org/specifications/xslt-40/#RootedPath">RootedPath</a><sup><small>XT</small></sup>.</p>
                  </li>
                  <li>
                     <p>If the pattern contains predicates, then every top-level
                           <code>Predicate</code> in the pattern satisfies all the following
                        conditions:</p>
                     <ol class="enumla">
                        <li>
                           <p>The expression immediately contained in the predicate is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, when assessed with
                                 a <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of <a title="striding" class="termref" href="#dt-striding">striding</a>, and a context item type set to the <a title="static type" class="termref" href="#dt-static-type">static type</a> of the expression to which the predicate
                                 applies, determined using the rules in <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>.</p>
                        </li>
                        <li>
                           <p>The predicate is a <a title="non-positional predicate" class="termref" href="#dt-non-positional-predicate">non-positional predicate</a>.</p>
                        </li>
                     </ol>
                     <p>The use of the term <b>top-level</b> in this rule means that
                        predicates that are nested within other predicates do not themselves have to
                        be non-positional, though they may play a role in the analysis of top-level
                        predicates.</p>
                  </li>
                  <li>
                     <p>The pattern does not contain (at any depth) a variable reference that is
                        bound to a <a title="streaming parameter" class="termref" href="#dt-streaming-parameter">streaming parameter</a>. (See <a href="#streamability-of-function-calls"><b>12.7.14 Streamability of Static Function Calls</b></a>).</p>
                  </li>
               </ol>
               <p><a id="dt-non-positional-predicate" title="non-positional predicate"><span class="definition">[Definition:&nbsp;</span></a>A predicate is a <b>non-positional
                        predicate</b> if it satisfies both of the following
                  conditions:</p>
               <ol class="enumar">
                  <li>
                     <p>The predicate does not contain a function call or named function reference
                        to any of the following functions, unless that call or reference occurs
                        within a nested predicate:</p>
                     <ol class="enumla">
                        <li>
                           <p><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-position"><code>position</code></a></p>
                        </li>
                        <li>
                           <p><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-last"><code>last</code></a></p>
                        </li>
                        <li>
                           <p><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-function-lookup"><code>function-lookup</code></a>.</p>
                        </li>
                     </ol>
                     <div class="note">
                        <p class="prefix"><b>Note:</b></p>
                        <p>The exception for nested predicates is there to ensure that patterns
                           such as <code>match="p[@code = $status[last()]]</code> are not disqualified.</p>
                     </div>
                  </li>
                  <li>
                     <p>The expression immediately contained in the
                        predicate is a non-numeric expression. An expression is non-numeric if
                           the intersection of its <a title="static type" class="termref" href="#dt-static-type">static type</a> (see <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>)
                           with <var>U{xs:decimal, xs:double, xs:float}</var> is
                           <var>U{}</var>.</p>
                  </li>
               </ol>
               <p>]</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>A non-positional predicate can be evaluated by
                     considering each item in the filtered sequence independently; the result never
                     depends on the position of other items in the sequence or the length of the
                     sequence.</p>
               </div>
               <p>A pattern that is not <a title="motionless" class="termref" href="#dt-motionless">motionless</a> is classified as <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>.</p>
               <p>The following list shows examples of motionless
                  patterns:</p>
               <ul>
                  <li>
                     <p><code>/</code></p>
                  </li>
                  <li>
                     <p><code>*</code></p>
                  </li>
                  <li>
                     <p><code>/*</code></p>
                  </li>
                  <li>
                     <p><code>p</code></p>
                  </li>
                  <li>
                     <p><code>p|q</code></p>
                  </li>
                  <li>
                     <p><code>p/q</code></p>
                  </li>
                  <li>
                     <p><code>p[@status='red']</code></p>
                  </li>
                  <li>
                     <p><code>p[base-uri()]</code></p>
                  </li>
                  <li>
                     <p><code>p[@class or @style]</code></p>
                  </li>
                  <li>
                     <p><code>p[@status]</code></p>
                  </li>
                  <li>
                     <p><code>p[@status = $status-codes[1]]</code></p>
                  </li>
                  <li>
                     <p><code>p[@class | @style]</code></p>
                  </li>
                  <li>
                     <p><code>p[contains(@class, ':')]</code></p>
                  </li>
                  <li>
                     <p><code>p[substring-after(@class, ':')]</code></p>
                  </li>
                  <li>
                     <p><code>p[ancestor::*[@xml:lang]]</code></p>
                  </li>
                  <li>
                     <p><code>text()[starts-with(., '$')]</code></p>
                  </li>
                  <li>
                     <p><code>@price</code></p>
                  </li>
                  <li>
                     <p><code>@price[starts-with(., '$')]</code></p>
                  </li>
                  <li>
                     <p><code>//p/text()[. = 'Introduction']</code></p>
                  </li>
                  <li>
                     <p><code>document-node(element(html))</code> (Note:
                        this is classified as motionless even though testing a document node against
                        the pattern might require a small amount of look-ahead.)</p>
                  </li>
               </ul>
               <p>The following list shows examples of patterns that are
                  not motionless, explaining why not:</p>
               <ul>
                  <li>
                     <p><code>id('abc')</code> (contains a <code>RootedPath</code>)</p>
                  </li>
                  <li>
                     <p><code>$doc//p</code> (contains a <code>RootedPath</code>)</p>
                  </li>
                  <li>
                     <p><code>p[b]</code> (the predicate is not motionless)</p>
                  </li>
                  <li>
                     <p><code>p[. = 'Introduction']</code> (the predicate is not motionless)</p>
                  </li>
                  <li>
                     <p><code>p[starts-with(., '$')]</code> (the predicate is not motionless)</p>
                  </li>
                  <li>
                     <p><code>p[preceding-sibling::p[1] = '']</code> (the predicate is not
                        motionless)</p>
                  </li>
                  <li>
                     <p><code>p[1]</code> (contains a positional predicate: return type is
                        numeric)</p>
                  </li>
                  <li>
                     <p><code>p[$pnum + 1]</code> (contains a positional predicate: return type is
                        numeric)</p>
                  </li>
                  <li>
                     <p><code>p[data(@status)]</code> (contains a positional predicate: return type
                        is potentially numeric)</p>
                  </li>
                  <li>
                     <p><code>p[position() gt 2]</code> (contains a positional predicate: calls
                           <code>position()</code>)</p>
                  </li>
                  <li>
                     <p><code>p[last()]</code> (contains a positional predicate: calls
                           <code>last()</code>)</p>
                  </li>
               </ul>
            </div>
            <div class="div2">
               
               <h3><a id="streamability-analysis-examples"></a>12.10 <a href="#streamability-analysis-examples" style="text-decoration: none">Examples of Streamability Analysis</a></h3>
               <p>The examples in this section are intended to illustrate how the streamability rules
               are applied “top down” to establish whether template rules are guaranteed
               streamable.</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e16984"></a>Example: A recursive-descent template rule</div>
                  <p>Consider the following template rule, where mode <code>s</code> is defined with
                     <code>streamable="yes"</code>:</p>
                  <div class="exampleInner">
                     <pre>
&lt;xsl:template match="para" mode="s"&gt;
  &lt;div class="para"&gt;
    &lt;xsl:apply-templates mode="s"/&gt;
  &lt;/div&gt;
&lt;/xsl:template&gt;</pre>
                  </div>
                  <p>The processor is required to establish that this template meets the streamability
                  rules. Specifically, as stated in <a href="#streamable-templates"><b>5 Streamable Templates</b></a>, it must
                  satisfy three conditions:</p>
                  <ol class="enumar">
                     <li>
                        <p>The match pattern must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>The body of the template rule must be <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                     </li>
                     <li>
                        <p>The initializers of any template parameters must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                  </ol>
                  <p>The third condition is satisfied trivially because there are no parameters.</p>
                  <p>The first rule depends on the rules for assessing patterns, which are given in
                     <a href="#classifying-patterns"><b>12.9 Classifying Patterns</b></a>. This pattern is motionless because (a)
                  it does not contain a <code>RootedPath</code>, and (b) it contains no
                  predicates.</p>
                  <p>So it remains to determine that the body of the template is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>. The proof of this is as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The sequence constructor forming the body of the template is assessed
                        according to the rules in <a href="#classifying-sequence-constructors"><b>12.4 Classifying Sequence Constructors</b></a>, which tell us that there is a single operand (the
                           <code>&lt;div&gt;</code>
                        <a href="https://qt4cg.org/specifications/xslt-40/#dt-literal-result-element">literal result element</a><sup><small>XT</small></sup>) which has <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                        <var>U</var> = <a title="transmission" class="termref" href="#dt-transmission">transmission</a>. </p>
                     </li>
                     <li>
                        <p>The assessment of the sequence constructor uses the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>. These rules require us to
                        determine the type <var>T</var>, sweep <var>S</var>, posture <var>P</var>,
                        and usage <var>U</var> of each operand. We have already established that
                        there is a single operand, with <var>U</var> = <a title="transmission" class="termref" href="#dt-transmission">transmission</a>. Section <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>
                        tells us that for all instructions, we can take <var>T</var> =
                           <var>U{*}</var>. The <a title="posture" class="termref" href="#dt-posture">posture</a>
                        <var>P</var> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                        <var>S</var> of the literal result element are established as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>The rules for literal result elements (specifically the
                                 <code>&lt;div&gt;</code> element) are given in <a href="#streamability-literal-result-elements"><b>12.5.1 Streamability of Literal Result Elements</b></a>. This particular
                              literal result element has only one operand (its contained sequence
                              constructor), with <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                              <var>U</var> = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                           </li>
                           <li>
                              <p>The <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> again apply. Again
                              the <a title="static type" class="termref" href="#dt-static-type">static type</a>
                              <var>T</var> of the operand is <code>U{*}</code>, and we need to
                              determine the <a title="posture" class="termref" href="#dt-posture">posture</a>
                              <var>P</var> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                              <var>S</var>.</p>
                           </li>
                           <li>
                              <p>To determine the posture and sweep of this sequence constructor (the
                              one that contains the <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a>
                              instruction) we refer again to the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>.</p>
                              <ol class="enumlr">
                                 <li>
                                    <p>The sequence constructor has a single operand (the
                                       <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a> instruction); again
                                       <var>U</var> = <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, <var>T</var>
                                    = <var>U{*}</var>.</p>
                                 </li>
                                 <li>
                                    <p>The <a title="posture" class="termref" href="#dt-posture">posture</a>
                                    <var>P</var> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                                    <var>S</var> of the <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a>
                                    instruction are established as follows:</p>
                                    <ol class="enumua">
                                       <li>
                                          <p>The rules that apply are in <a href="#streamability-xsl-apply-templates"><b>12.5.5 Streamability of xsl:apply-templates</b></a>.</p>
                                       </li>
                                       <li>
                                          <p>Rule 1 does not apply because the <code>select</code>
                                          expression (which defaults to <code>child::node()</code>)
                                          is not <a title="grounded" class="termref" href="#dt-grounded">grounded</a>. This is a consequence
                                          of the rules in <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a>, specifically:</p>
                                          <ol class="enumur">
                                             <li>
                                                <p>The <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of the axis
                                                step is established by the template rule as a whole,
                                                as <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                                             </li>
                                             <li>
                                                <p>Therefore rules 1 and 2 do not apply.</p>
                                             </li>
                                             <li>
                                                <p>The statically inferred context item type is derived
                                                from the match pattern (<code>match="para"</code>).
                                                This gives a type of <var>U{element()}</var>. The
                                                child axis for element nodes is not necessarily
                                                empty, so rule 3 does not apply.</p>
                                             </li>
                                             <li>
                                                <p>Rule 4 does not apply because there are no
                                                predicates.</p>
                                             </li>
                                             <li>
                                                <p>So the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the axis step
                                                  <code>child::node()</code> are given by the table
                                                in rule 5. The entry for (context posture =
                                                striding, axis = child) gives a posture of <a title="striding" class="termref" href="#dt-striding">striding</a> and a <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                                             </li>
                                             <li>
                                                <p>So the <code>select</code> expression is not
                                                  <a title="grounded" class="termref" href="#dt-grounded">grounded</a>. (The same result can
                                                be reached intuitively: an expression that selects
                                                streamed nodes will never be <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.)</p>
                                             </li>
                                          </ol>
                                       </li>
                                       <li>
                                          <p>Rule 2 does not apply because there is no
                                             <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> element.</p>
                                       </li>
                                       <li>
                                          <p>Rule 3 does not apply because the mode is declared with
                                             <code>streamable="yes"</code>.</p>
                                       </li>
                                       <li>
                                          <p>So the <a title="posture" class="termref" href="#dt-posture">posture</a>
                                          <var>P</var> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                                          <var>S</var> of the <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a>
                                          instruction are established by the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, as follows:</p>
                                          <ol class="enumur">
                                             <li>
                                                <p>There is a single operand, the implicit
                                                  <code>select="child::node()"</code> expression,
                                                with usage <var>U</var> = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                                             </li>
                                             <li>
                                                <p>We have already established that for this operand,
                                                the posture <var>P</var> = <a title="striding" class="termref" href="#dt-striding">striding</a> and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                                                <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                                             </li>
                                             <li>
                                                <p>By the rules in <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>, the type
                                                  <var>T</var> of the <code>select</code> expression
                                                is <code>node()</code>.</p>
                                             </li>
                                             <li>
                                                <p>In the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, the adjusted sweep <var>S′</var> for an operand
                                                with (<var>P</var> = <a title="striding" class="termref" href="#dt-striding">striding</a>,
                                                  <var>U</var> = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>) is
                                                  <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, </p>
                                             </li>
                                             <li>
                                                <p>Rule 2(d) then applies, so the
                                                  <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a> instruction
                                                is <a title="consuming" class="termref" href="#dt-consuming">consuming</a> and <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                                             </li>
                                          </ol>
                                       </li>
                                    </ol>
                                 </li>
                                 <li>
                                    <p>So the sequence constructor that contains the
                                       <a href="../../xslt-40/Overview.html#xsl:apply-templates">xsl:apply-templates</a> instruction has one
                                    operand with <var>U</var> = <a title="transmission" class="termref" href="#dt-transmission">transmission</a>,
                                       <var>T</var> = <code>item()</code>, <var>P</var> = <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. Rule 2(d) of the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> applies, so the
                                    sequence constructor itself has <var>P</var> = <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>So the literal result element has one operand with <var>U</var> =
                                 <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, <var>T</var> = <code>item()</code>,
                                 <var>P</var> = <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, <var>S</var> =
                                 <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. Rule 2(d) of the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> applies, so the literal
                              result element has <var>P</var> = <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                                 <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>So the sequence constructor containing the literal result element has one
                        operand with <var>U</var> = <a title="transmission" class="termref" href="#dt-transmission">transmission</a>, <var>T</var> =
                           <code>item()</code>, <var>P</var> = <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                           <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. Rule 2(d) of the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> applies, so this sequence
                        constructor itself has <var>P</var> = <a title="grounded" class="termref" href="#dt-grounded">grounded</a>,
                           <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                     </li>
                     <li>
                        <p>So we have established that the sequence constructor forming the body of the
                        template rule is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                     </li>
                  </ol>
                  <p>Therefore, since the other conditions are also satisfied, the template is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                  <p>The analysis presented above could have been simplified by taking into account the
                  fact that the streamability properties of a sequence constructor containing a
                  single instruction are identical to the properties of that instruction. This
                  simplification will be exploited in the next example.</p>
               </div>
               <p>&nbsp;</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e17473"></a>Example: An aggregating template rule</div>
                  <p>Consider the following template rule, where mode <code>s</code> is defined with
                     <code>streamable="yes"</code>:</p>
                  <div class="exampleInner">
                     <pre>
&lt;xsl:template match="transactions[@currency='USD']" mode="s"&gt;
  &lt;total&gt;&lt;xsl:value-of select="sum(transaction/@value)"/&gt;&lt;/total&gt;
&lt;/xsl:template&gt;</pre>
                  </div>
                  <p>Again, as stated in <a href="#streamable-templates"><b>5 Streamable Templates</b></a>, it must satisfy three
                  conditions:</p>
                  <ol class="enumar">
                     <li>
                        <p>The match pattern must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                     <li>
                        <p>The body of the template rule must be <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                     </li>
                     <li>
                        <p>The initializers of any template parameters must be <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                     </li>
                  </ol>
                  <p>The third condition is satisfied trivially because there are no parameters.</p>
                  <p>The first rule depends on the rules for assessing patterns, which are given in
                     <a href="#classifying-patterns"><b>12.9 Classifying Patterns</b></a>. This pattern is motionless because (a)
                  it is not a <code>RootedPath</code>, and (b) every predicate is <a title="motionless" class="termref" href="#dt-motionless">motionless</a> and <a title="non-positional predicate" class="termref" href="#dt-non-positional-predicate">non-positional</a>. The analysis that proves the predicate is motionless
                  and non-positional proceeds as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>First establish that the expression <code>@currency='USD'</code> is
                           <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>The predicate is a general comparison (<code>GeneralComp</code>) which
                              follows the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>.</p>
                           </li>
                           <li>
                              <p>There are two operands: an <code>AxisStep</code> with a defaulted
                                 <code>ForwardAxis</code>, and a <code>Literal</code>. Both operand
                              roles are <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                           </li>
                           <li>
                              <p>The left-hand operand has
                              type <var>T</var> = <code>attribute()</code>. Its <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> are determined by
                              the rules in <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a>. The
                                 <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a>, so the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                              are determined by the entry in the table (rule 5) with context posture
                              = <a title="striding" class="termref" href="#dt-striding">striding</a>, axis = <code>attribute</code>: that
                              is, the result posture is <a title="striding" class="termref" href="#dt-striding">striding</a> and the <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                              is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                           </li>
                           <li>
                              <p>The right-hand operand,
                              being a literal, is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                           </li>
                           <li>
                              <p>In the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, rule 2(e)
                              applies, so the predicate is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a></p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>Now establish that the expression <code>@currency='USD'</code> is
                           <a title="non-positional predicate" class="termref" href="#dt-non-positional-predicate">non-positional</a>, as
                        follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>Rule 1 is satisfied: the predicate does not call
                                 <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-position"><code>position</code></a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-last"><code>last</code></a>, or
                                 <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-function-lookup"><code>function-lookup</code></a>.</p>
                           </li>
                           <li>
                              <p>Rule 2 is satisfied: the expression <code>@currency='USD'</code> is
                              non-numeric. The <a title="static type" class="termref" href="#dt-static-type">static type</a> of the expression is
                              determined using the rules in <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>
                              as <var>U{xs:boolean}</var>, and this has no intersection with
                                 <var>U{xs:decimal, xs:double, xs:float}</var>.</p>
                           </li>
                        </ol>
                     </li>
                  </ol>
                  <p>So both conditions in <a href="#classifying-patterns"><b>12.9 Classifying Patterns</b></a> are satisfied, and the
                  pattern is therefore <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                  <p>It remains to show that the body of the template rule is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>. The proof of this is as follows. Unlike the previous
                  example, the analysis is shown in simplified form; in particular the two sequence
                  constructors which each contain a single instruction are ignored, and replaced in
                  the construct tree by their contained instruction.</p>
                  <ol class="enumar">
                     <li>
                        <p>We need to show that the <code>&lt;total&gt;</code>
                        <a href="https://qt4cg.org/specifications/xslt-40/#dt-literal-result-element">literal result element</a><sup><small>XT</small></sup> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>.</p>
                     </li>
                     <li>
                        <p>The rules that apply are in <a href="#streamability-literal-result-elements"><b>12.5.1 Streamability of Literal Result Elements</b></a>.</p>
                     </li>
                     <li>
                        <p>These rules refer to the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>.
                        There is one operand, the <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> child element, which
                        has <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                        <var>U</var> = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, and type <var>T</var> =
                           <code>item()</code>.</p>
                     </li>
                     <li>
                        <p>So we need to determine the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instruction.</p>
                        <ol class="enumla">
                           <li>
                              <p>The rules are given in <a href="#streamability-xsl-value-of"><b>12.5.42 Streamability of xsl:value-of</b></a>.</p>
                           </li>
                           <li>
                              <p>The <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply. There is
                              one operand, the expression <code>sum(transaction/@value)</code>,
                              which has <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                              <var>U</var> = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                           </li>
                           <li>
                              <p>The type <var>T</var> of this operand is the return type defined in
                              the signature of the <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-sum"><code>sum</code></a> function, that is,
                                 <code>xs:anyAtomicType</code>.</p>
                           </li>
                           <li>
                              <p>The <a title="posture" class="termref" href="#dt-posture">posture</a>
                              <var>P</var> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                              <var>S</var> are established as follows:</p>
                              <ol class="enumlr">
                                 <li>
                                    <p>The rules that apply to the call on <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-sum"><code>sum</code></a>
                                    are given in <a href="#classifying-built-in-functions"><b>12.8 Classifying Calls to Built-In Functions</b></a>.</p>
                                 </li>
                                 <li>
                                    <p>The relevant proforma is <code>fn:sum(A)</code>, indicating that
                                    the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply, and
                                    that there is a single operand with usage <var>U</var> =
                                       <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                                 </li>
                                 <li>
                                    <p>The type <var>T</var> of the operand
                                       <code>transaction/@value</code> is determined (by the rules
                                    in <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a>) as
                                       <code>attribute()</code>.</p>
                                 </li>
                                 <li>
                                    <p>The <a title="posture" class="termref" href="#dt-posture">posture</a>
                                    <var>P</var> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a>
                                    <var>S</var> of the operand <code>transaction/@value</code> are
                                    determined by the rules in <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a>, as follows:</p>
                                    <ol class="enumua">
                                       <li>
                                          <p>The expression is expanded to
                                             <code>child::transaction/attribute::value</code>.</p>
                                       </li>
                                       <li>
                                          <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the left-hand operand
                                             <code>child::transaction</code> are determined by the
                                          rules in <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a>, as
                                          follows:</p>
                                          <ol class="enumur">
                                             <li>
                                                <p>The <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a>, because the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a> is the template
                                                rule itself.</p>
                                             </li>
                                             <li>
                                                <p>The <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> is
                                                  <code>element()</code>, based on the <a title="match type" class="termref" href="#dt-match-type">match type</a> of the pattern
                                                  <code>match="transactions[@currency='USD']"</code>.</p>
                                             </li>
                                             <li>
                                                <p>Rules 1 and 2 do not apply because the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                                             </li>
                                             <li>
                                                <p>Rule 3 does not apply because the <code>child</code>
                                                axis applied to an element node is not necessarily
                                                empty.</p>
                                             </li>
                                             <li>
                                                <p>Rule 4 does not apply because there are no
                                                predicates.</p>
                                             </li>
                                             <li>
                                                <p>Rule 5 applies, and the table entry with context
                                                posture = <a title="striding" class="termref" href="#dt-striding">striding</a>, axis =
                                                  <code>child</code> gives a result <a title="posture" class="termref" href="#dt-posture">posture</a> of <a title="striding" class="termref" href="#dt-striding">striding</a>
                                                and a <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                                             </li>
                                          </ol>
                                       </li>
                                       <li>
                                          <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the relative path
                                          expression
                                             <code>child::transaction/attribute::value</code> is
                                          therefore the <a title="posture" class="termref" href="#dt-posture">posture</a> of its right-hand operand
                                             <code>attribute::value</code>, assessed with a <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> of <a title="striding" class="termref" href="#dt-striding">striding</a>. This is determined by the rules in
                                             <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a>, as
                                          follows:</p>
                                          <ol class="enumur">
                                             <li>
                                                <p>The <a title="context posture" class="termref" href="#dt-context-posture">context posture</a>, as we have
                                                seen, is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                                             </li>
                                             <li>
                                                <p>The <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> is
                                                  <code>element()</code>, based on the type of the
                                                  left-hand operand
                                                  <code>child::transaction</code>.</p>
                                             </li>
                                             <li>
                                                <p>Rules 1 and 2 do not apply because the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                                             </li>
                                             <li>
                                                <p>Rule 3 does not apply because the
                                                  <code>attribute</code> axis applied to an element
                                                node is not necessarily empty.</p>
                                             </li>
                                             <li>
                                                <p>Rule 4 does not apply because there are no
                                                predicates.</p>
                                             </li>
                                             <li>
                                                <p>Rule 5 applies, and the table entry with context
                                                posture = <a title="striding" class="termref" href="#dt-striding">striding</a>, axis =
                                                  <code>attribute</code> gives a result <a title="posture" class="termref" href="#dt-posture">posture</a> of <a title="striding" class="termref" href="#dt-striding">striding</a> and a <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                                                  <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                                             </li>
                                          </ol>
                                       </li>
                                       <li>
                                          <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the relative path
                                          expression
                                             <code>child::transaction/attribute::value</code> is
                                          therefore <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                                       </li>
                                       <li>
                                          <p>The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the relative path
                                          expression
                                             <code>child::transaction/attribute::value</code> is the
                                          wider of the sweeps of its two operands, namely <a title="consuming" class="termref" href="#dt-consuming">consuming</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>. That is, it is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                                       </li>
                                    </ol>
                                 </li>
                                 <li>
                                    <p>So the first and only operand to the call on <code>sum()</code>
                                    has <var>U</var> = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, <var>T</var>
                                    = <code>attribute()</code>, <var>P</var> = <a title="climbing" class="termref" href="#dt-climbing">climbing</a>, and <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a></p>
                                 </li>
                                 <li>
                                    <p>Rule 1(b) of the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>
                                    computes the adjusted sweep <var>S′</var>. Rule 1(b)(iii)(A)
                                    applies, so the effective <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                                    <var>U′</var> is <a title="inspection" class="termref" href="#dt-inspection">inspection</a>. Rule
                                    1(b)(iii)(A) then computes the adjusted sweep from the table
                                    entry for <var>P</var> = <a title="climbing" class="termref" href="#dt-climbing">climbing</a>,
                                       <var>U′</var> = <a title="inspection" class="termref" href="#dt-inspection">inspection</a>; this shows
                                       <var>S′</var> = <var>S</var>, that is, <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                                 </li>
                                 <li>
                                    <p>Rule 2(d) now applies, so the call on <code>sum()</code> is
                                       <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Since the <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a> instruction has one operand
                              with <var>U</var> = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, <var>T</var> =
                                 <code>xs:anyAtomicType</code>, <var>P</var> = <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, rule 2(d) again applies, and the <a href="../../xslt-40/Overview.html#xsl:value-of">xsl:value-of</a>
                              instruction is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>Since the literal result element has one operand with <var>U</var> =
                           <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, <var>T</var> = <code>item()</code>,
                           <var>P</var> = <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>, rule 2(d) again applies, and the literal result
                        element is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                     </li>
                     <li>
                        <p>Therefore the body of the template rule is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and
                        since the other conditions are also satisfied, it is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                     </li>
                  </ol>
               </div>
               <p>&nbsp;</p>
               <div class="example">
                  
                  <div class="exampleHeader"><a id="d4e18115"></a>Example: Streamed Grouping</div>
                  <p>Consider the following code, which is designed to process a transaction file
                  containing transactions in chronological order, and output the total value of the
                  transactions for each day.</p>
                  <div class="exampleInner">
                     <pre>
&lt;xsl:template name="go"&gt;
  &lt;out&gt;
    &lt;xsl:source-document streamable="yes" href="transactions.xml"&gt;
      &lt;xsl:for-each-group select="/account/transaction" 
                          group-adjacent="xs:date(@timestamp)"&gt;
         &lt;total date="{current-grouping-key()}" value="{sum(current-group()/@value)}"/&gt;
      &lt;/xsl:for-each-group&gt;
    &lt;/xsl:source-document&gt;
  &lt;/out&gt;
&lt;/xsl:template&gt;</pre>
                  </div>
                  <p>The rules for <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> say that the instruction is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a> 
                 if the contained <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup> is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, and the task
                  of streamability analysis is to prove that this is the case. As in the previous
                  example, we will take a short-cut by making the assumption that a sequence
                  constructor containing a single instruction can be replaced by that instruction in
                  the construct tree.</p>
                  <p>So the task is to show that the <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction is
                     <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, which we can do as follows:</p>
                  <ol class="enumar">
                     <li>
                        <p>The relevant rules are to be found in <a href="#streamability-xsl-for-each-group"><b>12.5.19 Streamability of xsl:for-each-group</b></a>.</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>Rule numbers may be different in a version of the specification with
                           change markings.</p>
                        </div>
                     </li>
                     <li>
                        <p>Rule 1 applies only if the <code>select</code> expression is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>. It is easy to see informally that this is not the
                        case (an expression that returns streamed nodes is never grounded). More
                        formally:</p>
                        <ol class="enumla">
                           <li>
                              <p>The <code>select</code> expression is a path expression; the rules in
                                 <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a> apply.</p>
                           </li>
                           <li>
                              <p>The expression is rewritten as <code>((root(.) treat as
                                 document-node())/child::account)/child::transaction</code></p>
                           </li>
                           <li>
                              <p>The left-hand operand <code>(root(.) treat as
                                 document-node())/child::account</code> is also a path expression,
                              so the rules in <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a>
                              apply recursively:</p>
                              <ol class="enumlr">
                                 <li>
                                    <p>The left-hand operand <code>root(.) treat as
                                       document-node()</code> follows the rules for a
                                       <code>TreatExpr</code> in <a href="#classifying-expressions"><b>12.7 Classifying Expressions</b></a>; the proforma <code>T treat
                                       as TYPE</code> indicates that the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply with a single
                                    operand having usage <a title="transmission" class="termref" href="#dt-transmission">transmission</a>.</p>
                                 </li>
                                 <li>
                                    <p>This single operand <code>root(.)</code> follows the rules in
                                       <a href="#streamability-fn-root"><b>12.8.21 Streamability of the root Function</b></a>. The item type of the
                                    operand <code>.</code> is the <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a>, which is the type established
                                    by the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction, namely
                                       <code>document-node()</code>. Under these conditions
                                       <code>root(.)</code> is rewritten as <code>.</code>, so the
                                       <a title="posture" class="termref" href="#dt-posture">posture</a> is the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> established by the
                                       <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction, namely <a title="striding" class="termref" href="#dt-striding">striding</a>. The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is
                                       <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                                 </li>
                                 <li>
                                    <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                                    the expression <code>root(.) treat as document-node()</code> are
                                    the same as the <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of <code>root(.)</code>, namely <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a></p>
                                 </li>
                                 <li>
                                    <p>The right-hand operand <code>child::account</code> is governed
                                    by the rules in <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a>.
                                    The <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a>, and the axis is <code>child</code>, so
                                    the result posture is <a title="striding" class="termref" href="#dt-striding">striding</a> and the sweep
                                    is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                                 </li>
                                 <li>
                                    <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the path expression is the
                                       <a title="posture" class="termref" href="#dt-posture">posture</a> of the right-hand operand, that
                                    is <a title="striding" class="termref" href="#dt-striding">striding</a>, and its sweep is the wider
                                    sweep of the two operands, that is <a title="consuming" class="termref" href="#dt-consuming">consuming</a></p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Returning to the outer path expression, the <a title="posture" class="termref" href="#dt-posture">posture</a> of the right hand operand <code>child::transaction</code> is
                                 <a title="striding" class="termref" href="#dt-striding">striding</a>, and its sweep is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                           </li>
                           <li>
                              <p>So the <a title="posture" class="termref" href="#dt-posture">posture</a> of the <code>select</code>
                              expression as a whole is the posture of the right hand operand, that
                              is <a title="striding" class="termref" href="#dt-striding">striding</a>; and its sweep is the wider of the
                              sweeps of the operands, which is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>Rule 2 does not apply: there is no <code>group-by</code> attribute.</p>
                     </li>
                     <li>
                        <p>Rule 3 does not apply: there is a <code>group-adjacent</code> attribute, but
                        it is <a title="motionless" class="termref" href="#dt-motionless">motionless</a>. The reasoning is as follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>The value is a call to the constructor function <code>xs:date</code>.
                              The rules in <a href="#streamability-of-function-calls"><b>12.7.14 Streamability of Static Function Calls</b></a> apply.
                              There is a single operand, whose required type is atomic, so the
                                 <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a> is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                           </li>
                           <li>
                              <p>These rules refer to the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, so we need to determine the <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a>,
                                 <a title="posture" class="termref" href="#dt-posture">posture</a>, and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                              operand expression <code>@timestamp</code>. This is done as
                              follows:</p>
                              <ol class="enumlr">
                                 <li>
                                    <p>The expression is an <code>AxisStep</code>, so the relevant
                                    rules are in <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a>.</p>
                                 </li>
                                 <li>
                                    <p>The <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is the <a title="posture" class="termref" href="#dt-posture">posture</a> of the <a title="controlling operand" class="termref" href="#dt-controlling-operand">controlling operand</a> of the <a title="focus-setting container" class="termref" href="#dt-focus-setting-container">focus-setting container</a>, that is, is the
                                       <code>select</code> expression of the containing
                                       <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction, which as
                                    established above is <a title="striding" class="termref" href="#dt-striding">striding</a>. The <a title="context item type" class="termref" href="#dt-context-item-type">context item type</a> is similarly the inferred type
                                    of the <code>select</code> expression, and is
                                       <code>element()</code>.</p>
                                 </li>
                                 <li>
                                    <p>Rules 1 and 2 do not apply because the <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is <a title="striding" class="termref" href="#dt-striding">striding</a>.</p>
                                 </li>
                                 <li>
                                    <p>Rule 3 does not apply because the attribute axis for an element
                                    node is not necessarily empty.</p>
                                 </li>
                                 <li>
                                    <p>Rule 4 does not apply because there is no predicate.</p>
                                 </li>
                                 <li>
                                    <p>So the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> and <a title="posture" class="termref" href="#dt-posture">posture</a>
                                    of the expression <code>@timestamp</code> are given by the table
                                    in Rule 5 as <a title="striding" class="termref" href="#dt-striding">striding</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Returning to the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> for
                              the expression <code>xs:date(@timestamp)</code>, the operand <code>@timestamp</code>
                              has <var>U</var> = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, <var>T</var> =
                                 <code>attribute()</code>, <var>P</var> = <a title="striding" class="termref" href="#dt-striding">striding</a>, <var>S</var>
                              = <a title="motionless" class="termref" href="#dt-motionless">motionless</a>. </p>
                           </li>
                           <li>
                              <p>Under Rule 1(b)(iii)(A), because <var>T</var> =
                                 <code>attribute()</code>, the <a title="operand usage" class="termref" href="#dt-operand-usage">operand usage</a>
                              <var>U′</var> becomes <a title="inspection" class="termref" href="#dt-inspection">inspection</a>.</p>
                           </li>
                           <li>
                              <p>Under Rule 1(b)(iii)(A), <var>S′</var> = <var>S</var> = <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                           </li>
                           <li>
                              <p>Under Rule 2(e), the expression <code>xs:date(@timestamp)</code> is
                                 <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>Rule 4 (under <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a>) does not apply, because
                        there is no <a href="../../xslt-40/Overview.html#xsl:sort">xsl:sort</a> child.</p>
                     </li>
                     <li>
                        <p>So Rule 5 applies. This relies on knowing the <a title="posture" class="termref" href="#dt-posture">posture</a> of
                        the sequence constructor contained in the
                           <a href="../../xslt-40/Overview.html#xsl:for-each-group">xsl:for-each-group</a> instruction: that is, the <a title="posture" class="termref" href="#dt-posture">posture</a> of the <code>total</code>
                        <a href="https://qt4cg.org/specifications/xslt-40/#dt-literal-result-element">literal result element</a><sup><small>XT</small></sup>. This is calculated as
                        follows:</p>
                        <ol class="enumla">
                           <li>
                              <p>The rules that apply are in <a href="#streamability-literal-result-elements"><b>12.5.1 Streamability of Literal Result Elements</b></a>. The <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply; there are two
                              operands, the attribute value templates
                                 <code>{current-grouping-key()}</code> and
                                 <code>{sum(current-group()/@value)}</code>, and in each case the
                              usage is <a title="absorption" class="termref" href="#dt-absorption">absorption</a>. We can simplify the analysis
                              by observing that the empty <a href="https://qt4cg.org/specifications/xslt-40/#dt-sequence-constructor">sequence constructor</a><sup><small>XT</small></sup>
                              contained in the literal result element can be ignored, since it is
                                 <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.
                           </p>
                           </li>
                           <li>
                              <p>Consider first the operand <code>{current-grouping-key()}</code>.</p>
                              <ol class="enumlr">
                                 <li>
                                    <p>Section <a href="#classifying-vts"><b>12.6 Classifying Value Templates</b></a> applies. This refers to
                                    the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>; there is a
                                    single operand, the expression
                                       <code>current-grouping-key()</code>, with usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                                 </li>
                                 <li>
                                    <p>Section <a href="#streamability-fn-current-grouping-key"><b>12.8.5 Streamability of the current-grouping-key
                     Function</b></a>
                                    applies. This establishes that the expression is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                                 </li>
                                 <li>
                                    <p>It follows that the operand
                                       <code>{current-grouping-key()}</code> expression is also
                                       <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>.</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Now consider the operand
                              <code>{sum(current-group()/@value)}</code>.</p>
                           </li>
                           <li>
                              <p>Section <a href="#classifying-vts"><b>12.6 Classifying Value Templates</b></a> applies. This refers to the
                                 <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>; there is a single
                              operand, the expression <code>sum(current-group()/@value)</code>, with
                              usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>.</p>
                           </li>
                           <li>
                              <p>The rules for the <code>sum</code> function appear in <a href="#classifying-built-in-functions"><b>12.8 Classifying Calls to Built-In Functions</b></a>. The proforma is given there
                              as <code>fn:sum(A)</code>, which means that the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> apply, and that the single
                              operand <code>current-group()/@value</code> has usage <a title="absorption" class="termref" href="#dt-absorption">absorption</a>. So we need to establish the <a title="posture" class="termref" href="#dt-posture">posture</a>, <a title="sweep" class="termref" href="#dt-sweep">sweep</a>, and type of this
                              expression, which we can do as follows:</p>
                              <ol class="enumlr">
                                 <li>
                                    <p>The expression is a <code>RelativePathExpr</code>, so section
                                       <a href="#streamability-of-path-expressions"><b>12.7.8 Streamability of Path Expressions</b></a>
                                    applies.</p>
                                 </li>
                                 <li>
                                    <p>The expression is expanded to
                                       <code>current-group()/attribute::value</code>.</p>
                                 </li>
                                 <li>
                                    <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                                    the left-hand operand <code>current-group()</code> are defined
                                    in <a href="#streamability-fn-current-group"><b>12.8.4 Streamability of the current-group Function</b></a>. Since all
                                    the required conditions are satisfied, the <a title="posture" class="termref" href="#dt-posture">posture</a> of <code>current-group()</code> is the
                                       <a title="posture" class="termref" href="#dt-posture">posture</a> of the <code>select</code>
                                    expression, that is <a title="striding" class="termref" href="#dt-striding">striding</a>, and its
                                       <a title="sweep" class="termref" href="#dt-sweep">sweep</a> is the <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                                    the <code>select</code> expression, that is <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                                 </li>
                                 <li>
                                    <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> and <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of
                                    the right hand operand <code>@value</code> are defined in
                                       <a href="#streamability-of-axis-steps"><b>12.7.9 Streamability of Axis Steps</b></a>. The <a title="context posture" class="termref" href="#dt-context-posture">context posture</a> is the <a title="posture" class="termref" href="#dt-posture">posture</a>
                                    of the left-hand operand <code>current-group()</code>, namely
                                       <a title="striding" class="termref" href="#dt-striding">striding</a>; the table in Rule 5 applies,
                                    giving the result <a title="climbing" class="termref" href="#dt-climbing">climbing</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a></p>
                                 </li>
                                 <li>
                                    <p>The <a title="posture" class="termref" href="#dt-posture">posture</a> of the
                                       <code>RelativePathExpr</code> is the <a title="posture" class="termref" href="#dt-posture">posture</a> of the right hand operand, namely <a title="striding" class="termref" href="#dt-striding">striding</a>. The <a title="sweep" class="termref" href="#dt-sweep">sweep</a> of the
                                       <code>RelativePathExpr</code> is the wider of the <a title="sweep" class="termref" href="#dt-sweep">sweeps</a> of its operands, which is
                                       <a title="consuming" class="termref" href="#dt-consuming">consuming</a></p>
                                 </li>
                                 <li>
                                    <p>The type of the expression <code>current-group()/@value</code>
                                    is determined using the rules in <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a> as
                                    <code>attribute()</code>.</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>So the <code>sum</code> function has a single operand with
                                 <var>U</var> = <a title="absorption" class="termref" href="#dt-absorption">absorption</a>, <var>P</var> =
                                 <a title="striding" class="termref" href="#dt-striding">striding</a>, <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>,
                                 <var>T</var> = <code>attribute()</code>.</p>
                           </li>
                           <li>
                              <p>In the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a>, Rule
                              1(b)(iii)(A) gives the adjusted usage as <var>U′</var> = <a title="inspection" class="termref" href="#dt-inspection">inspection</a>, and Rule 1(b)(iii)(B) gives the adjusted
                              sweep as <var>S′</var> = <var>S</var> = <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.
                              Rule 2(d) gives the posture and sweep of the call to <code>sum</code>
                              as <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.
                           </p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>So the literal result element has two operands, one of which is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="motionless" class="termref" href="#dt-motionless">motionless</a>, the other
                           <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>. Rule 2(d)
                        of the <a title="general streamability rules" class="termref" href="#dt-general-streamability-rules">general streamability rules</a> determines that the
                        literal result element is <a title="grounded" class="termref" href="#dt-grounded">grounded</a> and <a title="consuming" class="termref" href="#dt-consuming">consuming</a>.</p>
                     </li>
                     <li>
                        <p>So the content of the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction is <a title="grounded" class="termref" href="#dt-grounded">grounded</a>, which means that the instruction is <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
                     </li>
                  </ol>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="streamability-with-1.0"></a>12.11 <a href="#streamability-with-1.0" style="text-decoration: none">Streamability and 1.0 Compatibility Mode</a></h3>
               <p>Processing an <a href="https://qt4cg.org/specifications/xslt-40/#dt-instruction">instruction</a><sup><small>XT</small></sup> with XSLT
                  1.0 behavior is not compatible with streaming. More specifically, and
                  notwithstanding anything stated in <a href="#streamability"><b>3 Streamability Analysis Principles</b></a>, an instruction
                  that is processed with XSLT 1.0 behavior is <a title="roaming" class="termref" href="#dt-roaming">roaming</a> and
                     <a title="free-ranging" class="termref" href="#dt-free-ranging">free-ranging</a>, which has the effect that any construct
                  containing such an instruction is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>.</p>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="conformance"></a>13 <a href="#conformance" style="text-decoration: none">Conformance</a></h2>
            <p>
               <a id="dt-streaming-feature" title="streaming feature"><span class="definition">[Definition:&nbsp;</span></a>A processor that claims
                  conformance with the <b>streaming feature</b>
                  <span class="verb">must</span> use streamed processing in cases where (a) streaming is
                  requested (for example by using the attribute <code>streamable="yes"</code> on
                  <a href="../../xslt-40/Overview.html#xsl:mode">xsl:mode</a>, or on
                  the <a href="../../xslt-40/Overview.html#xsl:source-document">xsl:source-document</a> instruction) and
                  (b) the constructs in question are <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>
                  according to this specification.<span class="definition">]</span>
            </p>
            <p>A processor that does not claim conformance with the streaming feature is not
               required to use streamed processing and is not required to determine whether any
               construct is guaranteed streamable. Such a processor must, however, implement the
               semantics of all constructs in the language provided that enough memory is available
               to perform the processing without streaming.</p>
            <p>A processor that conforms with the feature <span class="verb">must</span>
               return the value <code>"yes"</code> in response to the function call
                  <code>system-property('xsl:supports-streaming')</code>; a processor that does not
               conform with the feature <span class="verb">must</span> return the value
               <code>"no"</code>.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>The term <em>streamed processing</em> as used here means the ability to
                  process arbitrarily large input documents without ever-increasing memory
                  requirements.</p>
            </div>
         </div>
      </div>
      <div class="back">
         <div class="div1">
            
            <h2><a id="references"></a>A <a href="#references" style="text-decoration: none">References</a></h2>
            <div class="div2">
               
               <h3><a id="normative-references"></a>A.1 <a href="#normative-references" style="text-decoration: none">Normative References</a></h3>
               <dl>
                  <dt class="label"><span><a id="xpath-datamodel-40"></a>XDM 4.0</span></dt>
                  <dd>
                     <div>
                        <a href="../xpath-datamodel-40/Overview.html"><cite>XQuery and XPath Data Model (XDM) 4.0</cite></a>,
                        XSLT Extensions Community Group,
                        World Wide Web Consortium.</div>
                  </dd>
                  <dt class="label"><span><a id="xpath-functions-40"></a>Functions and Operators 4.0</span></dt>
                  <dd>
                     <div>
                        <em>CITATION: T.B.D.</em>
                        </div>
                  </dd>
                  <dt class="label"><span><a id="xml-infoset"></a>XML Information Set</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml-infoset/"><cite>XML Information Set (Second Edition)</cite></a>, John Cowan and Richard Tobin, Editors. World Wide Web Consortium, 04&nbsp;Feb&nbsp;2004. This
                        version is http://www.w3.org/TR/2004/REC-xml-infoset-20040204. The <a href="http://www.w3.org/TR/xml-infoset">latest version</a> is available at http://www.w3.org/TR/xml-infoset.</div>
                  </dd>
                  <dt class="label"><span><a id="ISO15924"></a>ISO 15924</span></dt>
                  <dd>
                     <div>ISO (International Organization for
                        Standardization) <em>Information and documentation — Codes for the
                           representation of names of scripts</em> ISO 15924:2004, January 2004. See <a href="https://www.iso.org/obp/ui/#!iso:std:iso:15924:ed-1:v1:en">https://www.iso.org/obp/ui/#!iso:std:iso:15924:ed-1:v1:en</a>.</div>
                  </dd>
                  <dt class="label"><span><a id="ISO15924_register"></a>ISO 15924 Register</span></dt>
                  <dd>
                     <div>Unicode Consortium. <em>Codes
                           for the representation of names of scripts — Alphabetical list of
                           four-letter script codes.</em> See <a href="http://www.unicode.org/iso15924/iso15924-codes.html">http://www.unicode.org/iso15924/iso15924-codes.html</a>. Retrieved
                        February 2013; continually updated.</div>
                  </dd>
                  <dt class="label"><span><a id="ISO21320"></a>ISO 21320</span></dt>
                  <dd>
                     <div>ISO (International Organization for
                        Standardization) <em>Information technology — Document Container File, Part 1: Core</em> 
                        ISO 21320-1:2015, October 2015. See <a href="https://www.iso.org/obp/ui/#iso:std:iso-iec:21320:-1:ed-1:v1:en">https://www.iso.org/obp/ui/#iso:std:iso-iec:21320:-1:ed-1:v1:en</a>.</div>
                  </dd>
                  <dt class="label"><span><a id="xslt-xquery-serialization-40"></a>Serialization 4.0</span></dt>
                  <dd>
                     <div>
                        <a href="../xslt-xquery-serialization-40/Overview.html"><cite>XSLT and XQuery Serialization 4.0</cite></a>,
                        XSLT Extensions Community Group,
                        World Wide Web Consortium.</div>
                  </dd>
                  <dt class="label"><span><a id="rfc7595"></a>RFC 7595</span></dt>
                  <dd>
                     <div>IETF. <em>Guidelines and Registration Procedures for URI Schemes.</em>
                        June 2015. See <a href="http://www.ietf.org/rfc/rfc7595.txt">http://www.ietf.org/rfc/rfc7595.txt</a>
                        </div>
                  </dd>
                  <dt class="label"><span><a id="rfc7159"></a>RFC 7159</span></dt>
                  <dd>
                     <div>IETF. <em>The JavaScript Object Notation (JSON)
                           Data Interchange Format.</em>
                        March 2014. See <a href="http://www.ietf.org/rfc/rfc7159.txt">http://www.ietf.org/rfc/rfc7159.txt</a>
                        </div>
                  </dd>
                  <dt class="label"><span><a id="UNICODE"></a>UNICODE</span></dt>
                  <dd>
                     <div>Unicode Consortium. <em>The Unicode
                           Standard</em> as updated from time to time by the publication of new
                        versions. See <a href="http://www.unicode.org/standard/versions/">http://www.unicode.org/standard/versions/</a> for the
                        latest version and additional information on versions of the standard and of the
                        Unicode Character Database. The version of Unicode to be used is <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a>, but
                        implementations are recommended to use the latest Unicode version.</div>
                  </dd>
                  <dt class="label"><span><a id="UNICODE-TR10"></a>UNICODE TR10</span></dt>
                  <dd>
                     <div>Unicode Consortium. <em>Unicode
                           Technical Standard #10. Unicode Collation Algorithm</em>. Unicode Technical
                        Report. See <a href="http://www.unicode.org/reports/tr10/">http://www.unicode.org/reports/tr10/</a>.</div>
                  </dd>
                  <dt class="label"><span><a id="UNICODE-TR35"></a>UNICODE TR35</span></dt>
                  <dd>
                     <div>Unicode Consortium. <em>Unicode
                           Technical Standard #35. Unicode Locale Data Markup Language</em>. Unicode
                        Technical Report. See <a href="http://www.unicode.org/reports/tr35/">http://www.unicode.org/reports/tr35/</a>.</div>
                  </dd>
                  <dt class="label"><span><a id="REC-xml"></a>XML 1.0</span></dt>
                  <dd>
                     <div> World Wide Web Consortium. <em>Extensible Markup
                           Language (XML) 1.0. W3C Recommendation.</em> See <a href="https://www.w3.org/TR/REC-xml">http://www.w3.org/TR/REC-xml/</a>. The
                        edition of XML 1.0 must be no earlier than the Third Edition; the edition used is
                        <a title="implementation-defined" class="termref" href="#dt-implementation-defined">implementation-defined</a>, but we recommend that
                        implementations use the latest version. </div>
                  </dd>
                  <dt class="label"><span><a id="xml11"></a>XML 1.1</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml11/"><cite>Extensible Markup Language (XML) 1.1 (Second Edition)</cite></a>, Tim Bray, Jean Paoli, Michael Sperberg-McQueen, <em>et. al.</em>, Editors. World Wide Web Consortium, 16&nbsp;Aug&nbsp;2006. This version is http://www.w3.org/TR/2006/REC-xml11-20060816.
                        The <a href="http://www.w3.org/TR/xml11/">latest version</a> is available at http://www.w3.org/TR/xml11/.</div>
                  </dd>
                  <dt class="label"><span><a id="xmlbase"></a>XML Base</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xmlbase/"><cite>XML Base (Second Edition)</cite></a>, Jonathan Marsh and Richard Tobin, Editors. World Wide Web Consortium, 28&nbsp;Jan&nbsp;2009.
                        This version is http://www.w3.org/TR/2009/REC-xmlbase-20090128/. The <a href="http://www.w3.org/TR/xmlbase/">latest version</a> is available at http://www.w3.org/TR/xmlbase/.</div>
                  </dd>
                  <dt class="label"><span><a id="xml-id"></a>xml:id</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml-id/"><cite>xml:id Version 1.0</cite></a>, Jonathan Marsh, Daniel Veillard, and Norman Walsh, Editors. World Wide Web Consortium,
                        09&nbsp;Sep&nbsp;2005. This version is http://www.w3.org/TR/2005/REC-xml-id-20050909/. The <a href="http://www.w3.org/TR/xml-id/">latest version</a> is available at http://www.w3.org/TR/xml-id/.</div>
                  </dd>
                  <dt class="label"><span><a id="xml-names"></a>Namespaces in XML</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml-names/"><cite>Namespaces in XML 1.0 (Third Edition)</cite></a>, Tim Bray, Dave Hollander, Andrew Layman, <em>et. al.</em>, Editors. World Wide Web Consortium, 08&nbsp;Dec&nbsp;2009. This version is http://www.w3.org/TR/2009/REC-xml-names-20091208/.
                        The <a href="http://www.w3.org/TR/xml-names/">latest version</a> is available at http://www.w3.org/TR/xml-names/.</div>
                  </dd>
                  <dt class="label"><span><a id="xml-names11"></a>Namespaces in XML 1.1</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml-names11/"><cite>Namespaces in XML 1.1 (Second Edition)</cite></a>, Tim Bray, Dave Hollander, Andrew Layman, and Richard Tobin, Editors. World Wide
                        Web Consortium, 16&nbsp;Aug&nbsp;2006. This version is http://www.w3.org/TR/2006/REC-xml-names11-20060816.
                        The <a href="http://www.w3.org/TR/xml-names11/">latest version</a> is available at http://www.w3.org/TR/xml-names11/.</div>
                  </dd>
                  <dt class="label"><span><a id="xmlschema-1"></a>XML Schema Part 1</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xmlschema-1/"><cite>XML Schema Part 1: Structures Second Edition</cite></a>, Henry Thompson, David Beech, Murray Maloney, and Noah Mendelsohn, Editors. World
                        Wide Web Consortium, 28&nbsp;Oct&nbsp;2004. This version is http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/.
                        The <a href="http://www.w3.org/TR/xmlschema-1/">latest version</a> is available at http://www.w3.org/TR/xmlschema-1/.</div>
                  </dd>
                  <dt class="label"><span><a id="xmlschema-2"></a>XML Schema Part 2</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xmlschema-2/"><cite>XML Schema Part 2: Datatypes Second Edition</cite></a>, Paul V. Biron and Ashok Malhotra, Editors. World Wide Web Consortium, 28&nbsp;Oct&nbsp;2004.
                        This version is http://www.w3.org/TR/2004/REC-xmlschema-2-20041028/. The <a href="http://www.w3.org/TR/xmlschema-2/">latest version</a> is available at http://www.w3.org/TR/xmlschema-2/.</div>
                  </dd>
                  <dt class="label"><span><a id="xmlschema11-1"></a>XML Schema 1.1 Part 1</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xmlschema11-1/"><cite>W3C XML Schema Definition Language (XSD) 1.1 Part 1: Structures</cite></a>, Sandy Gao, Michael Sperberg-McQueen, Henry Thompson, <em>et. al.</em>, Editors. World Wide Web Consortium, 05&nbsp;Apr&nbsp;2012. This version is http://www.w3.org/TR/2012/REC-xmlschema11-1-20120405/.
                        The <a href="http://www.w3.org/TR/xmlschema11-1/">latest version</a> is available at http://www.w3.org/TR/xmlschema11-1/.</div>
                  </dd>
                  <dt class="label"><span><a id="xmlschema11-2"></a>XML Schema 1.1 Part 2</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xmlschema11-2/"><cite>W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes</cite></a>, David Peterson, Sandy Gao, Ashok Malhotra, <em>et. al.</em>, Editors. World Wide Web Consortium, 05&nbsp;Apr&nbsp;2012. This version is http://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/.
                        The <a href="http://www.w3.org/TR/xmlschema11-2/">latest version</a> is available at http://www.w3.org/TR/xmlschema11-2/.</div>
                  </dd>
                  <dt class="label"><span><a id="xpath-40"></a>XPath 4.0</span></dt>
                  <dd>
                     <div>
                        <em>CITATION: T.B.D.</em>
                        </div>
                  </dd>
                  <dt class="label"><span><a id="XSLT-Mime-Type"></a>XSLT Media Type</span></dt>
                  <dd>
                     <div>World Wide Web Consortium.
                        <em>Registration of MIME Media Type application/xslt+xml</em>. In <a href="https://www.w3.org/TR/2007/REC-xslt20-20070123/#media-type-registration">Appendix B.1 of the XSLT 2.0 specification.</a></div>
                  </dd>
               </dl>
            </div>
            <div class="div2">
               
               <h3><a id="other-references"></a>A.2 <a href="#other-references" style="text-decoration: none">Other References</a></h3>
               <dl>
                  <dt class="label"><span><a id="CLDR"></a>Unicode CLDR</span></dt>
                  <dd>
                     <div>CLDR - Unicode Common Locale Data Repository.
                        Available at: <a href="http://cldr.unicode.org">http://cldr.unicode.org</a></div>
                  </dd>
                  <dt class="label"><span><a id="DOM-Level-2-Core"></a>DOM Level 2</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/DOM-Level-2-Core/"><cite>Document Object Model (DOM) Level 2 Core Specification</cite></a>, Arnaud Le Hors, Philippe Le Hégaret, Lauren Wood, <em>et. al.</em>, Editors. World Wide Web Consortium, 13&nbsp;Nov&nbsp;2000. This version is http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113.
                        The <a href="http://www.w3.org/TR/DOM-Level-2-Core/">latest version</a> is available at http://www.w3.org/TR/DOM-Level-2-Core/.</div>
                  </dd>
                  <dt class="label"><span><a id="ECMA-404"></a>ECMA-404</span></dt>
                  <dd>
                     <div> ECMA International. <em>The JSON Data
                           Interchange Format</em> October 2013. See <a href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf</a>. </div>
                  </dd>
                  <dt class="label"><span><a id="ICU"></a>ICU</span></dt>
                  <dd>
                     <div>ICU - International Components for Unicode. Available at
                        <a href="http://site.icu-project.org">http://site.icu-project.org</a>
                        </div>
                  </dd>
                  <dt class="label"><span><a id="rfc2119"></a>RFC2119</span></dt>
                  <dd>
                     <div>S. Bradner. <em>Key words for use in RFCs to
                           Indicate Requirement Levels</em>. IETF RFC 2119. See <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a>.</div>
                  </dd>
                  <dt class="label"><span><a id="RFC3986"></a>RFC3986</span></dt>
                  <dd>
                     <div> T. Berners-Lee, R. Fielding, and L. Masinter.
                        <em>Uniform Resource Identifiers (URI): Generic Syntax</em>. IETF RFC 3986.
                        See <a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</a>.</div>
                  </dd>
                  <dt class="label"><span><a id="RFC3987"></a>RFC3987</span></dt>
                  <dd>
                     <div>M. Duerst, M. Suignard. <em>Internationalized
                           Resource Identifiers (IRIs)</em>. IETF RFC 3987. See <a href="http://www.ietf.org/rfc/rfc3987.txt">http://www.ietf.org/rfc/rfc3987.txt</a>.</div>
                  </dd>
                  <dt class="label"><span><a id="RFC4647"></a>RFC4647</span></dt>
                  <dd>
                     <div>A. Phillips and M. Davis. <em>Matching of Language Tags</em>. IETF RFC 4647. See <a href="http://www.ietf.org/rfc/rfc4647.txt">http://www.ietf.org/rfc/rfc4647.txt</a>.</div>
                  </dd>
                  <dt class="label"><span><a id="rfc7303"></a>RFC7303</span></dt>
                  <dd>
                     <div>H. Thompson and C. Lilley. <em>XML Media
                           Types</em>. IETF RFC 7303. See <a href="http://www.ietf.org/rfc/rfc7303.txt">http://www.ietf.org/rfc/rfc7303.txt</a></div>
                  </dd>
                  <dt class="label"><span><a id="SemVer"></a>SemVer</span></dt>
                  <dd>
                     <div>Tom Preston-Werner, <em>Semantic Versioning
                           2.0.0</em>. See <a href="http://semver.org/">http://semver.org/</a>. Undated (retrieved 1 August
                        2014).</div>
                  </dd>
                  <dt class="label"><span><a id="STX"></a>STX</span></dt>
                  <dd>
                     <div>Petr Cimprich <em>et al</em>, <em>Streaming
                           Transformations for XML (STX) Version 1.0</em>. Working Draft 27 April 2007.
                        See <a href="http://stx.sourceforge.net/documents/spec-stx-20070427.html">http://stx.sourceforge.net/documents/spec-stx-20070427.html</a>
                        </div>
                  </dd>
                  <dt class="label"><span><a id="xlink"></a>XLink</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xlink/"><cite>XML Linking Language (XLink) Version 1.0</cite></a>, Steven DeRose, Eve Maler, and David Orchard, Editors. World Wide Web Consortium,
                        27&nbsp;Jun&nbsp;2001. This version is http://www.w3.org/TR/2001/REC-xlink-20010627/. The <a href="http://www.w3.org/TR/xlink/">latest version</a> is available at http://www.w3.org/TR/xlink/.</div>
                  </dd>
                  <dt class="label"><span><a id="SCHEMA-AND-XML-1.1"></a>XML Schema 1.0 and XML 1.1</span></dt>
                  <dd>
                     <div>World Wide Web
                        Consortium. <em>Processing XML 1.1 documents with XML Schema 1.0
                           processors</em>. W3C Working Group Note 11 May 2005. See <a href="https://www.w3.org/TR/2005/NOTE-xml11schema10-20050511/">https://www.w3.org/TR/2005/NOTE-xml11schema10-20050511/</a>
                        </div>
                  </dd>
                  <dt class="label"><span><a id="xml-stylesheet"></a>XML Stylesheet</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml-stylesheet"><cite>Associating Style Sheets with XML documents 1.0 (Second Edition)</cite></a>, James Clark, Simon Pieters, and Henry Thompson, Editors. World Wide Web Consortium,
                        28&nbsp;Oct&nbsp;2010. This version is http://www.w3.org/TR/2010/REC-xml-stylesheet-20101028.
                        The <a href="http://www.w3.org/TR/xml-stylesheet">latest version</a> is available at http://www.w3.org/TR/xml-stylesheet.</div>
                  </dd>
                  <dt class="label"><span><a id="xptr-framework"></a>XPointer Framework</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xptr-framework/"><cite>XPointer Framework</cite></a>, Paul Grosso, Eve Maler, Jonathan Marsh, and Norman Walsh, Editors. World Wide Web
                        Consortium, 25&nbsp;Mar&nbsp;2003. This version is http://www.w3.org/TR/2003/REC-xptr-framework-20030325/.
                        The <a href="http://www.w3.org/TR/xptr-framework/">latest version</a> is available at http://www.w3.org/TR/xptr-framework/.</div>
                  </dd>
                  <dt class="label"><span><a id="xsl11"></a>XSL-FO</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xsl11/"><cite>Extensible Stylesheet Language (XSL) Version 1.1</cite></a>, Anders Berglund, Editor. World Wide Web Consortium, 05&nbsp;Dec&nbsp;2006. This version is
                        http://www.w3.org/TR/2006/REC-xsl11-20061205/. The <a href="http://www.w3.org/TR/xsl11/">latest version</a> is available at http://www.w3.org/TR/xsl11/.</div>
                  </dd>
                  <dt class="label"><span><a id="xslt"></a>XSLT 1.0</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xslt"><cite>XSL Transformations (XSLT) Version 1.0</cite></a>, James Clark, Editor. World Wide Web Consortium, 16&nbsp;Nov&nbsp;1999. This version is http://www.w3.org/TR/1999/REC-xslt-19991116.
                        The <a href="http://www.w3.org/TR/xslt">latest version</a> is available at http://www.w3.org/TR/xslt.</div>
                  </dd>
                  <dt class="label"><span><a id="xslt20"></a>XSLT 2.0</span></dt>
                  <dd>
                     <div>
                        <a href="https://www.w3.org/TR/xslt20/"><cite>XSL Transformations (XSLT) Version 2.0 (Second Edition)</cite></a>,
                        Michael Kay, Editor.
                        World Wide Web Consortium,
                        23 January 2007.
                        This version is https://www.w3.org/TR/2007/REC-xslt20-20070123/.
                        The <a href="https://www.w3.org/TR/xslt20/">latest version</a>
                        is available at https://www.w3.org/TR/xslt20/.</div>
                  </dd>
                  <dt class="label"><span><a id="xslt-30"></a>XSLT 3.0</span></dt>
                  <dd>
                     <div>
                        <a href="https://www.w3.org/TR/xslt-30/"><cite>XSL Transformations (XSLT) Version 3.0</cite></a>,
                        Michael Kay, Editor.
                        World Wide Web Consortium,
                        7 February 2017. 
                        This version is https://www.w3.org/TR/2017/CR-xslt-30-20170207/.
                        The <a href="https://www.w3.org/TR/xslt-30/">latest version</a>
                        is available at https://www.w3.org/TR/xslt-30/.</div>
                  </dd>
                  <dt class="label"><span><a id="xslt-40"></a>XSLT 4.0</span></dt>
                  <dd>
                     <div>
                        <a href="../xslt-40/Overview.html"><cite>XSL Transformations (XSLT) Version 4.0</cite></a>,
                        XSLT Extensions Community Group,
                        World Wide Web Consortium.</div>
                  </dd>
               </dl>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="error-summary"></a>B <a href="#error-summary" style="text-decoration: none">Summary of Error Conditions</a> (Non-Normative)</h2>
            <p>This appendix provides a summary of error conditions that a processor
            may raise. This list includes all error codes defined in this specification, but this
            is not an exhaustive list of all errors that can occur. Implementations
               <span class="verb">must</span> raise errors using these error codes, and applications can
            test for these codes; however, when more than one rule in the specification is violated,
            different processors will not necessarily raise the same error code. Implementations
            are not <span class="verb">required</span> to raise errors using the descriptive text used
            here.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>The appendix is non-normative because the same information is given normatively
               elsewhere.</p>
            </div>
            <p><b>Static errors</b></p>
            <dl>
               <dt><a href="#err-XTSE0730"><span class="error">ERR XTSE0730</span></a></dt>
               <dd>
                  <p>If an <a href="../../xslt-40/Overview.html#xsl:attribute">xsl:attribute</a> set element specifies
                           <code>streamable="yes"</code> then every attribute set referenced in its
                           <code>use-attribute-sets</code> attribute (if present) must also specify
                           <code>streamable="yes"</code>.</p>
               </dd>
               <dt><a href="#err-XTSE3155"><span class="error">ERR XTSE3155</span></a></dt>
               <dd>
                  <p>It is a static error if an <a href="../../xslt-40/Overview.html#xsl:function">xsl:function</a> element with no
                           <a href="../../xslt-40/Overview.html#xsl:param">xsl:param</a> children has a <code>streamability</code>
                        attribute with any value other than <code>unclassified</code>.</p>
               </dd>
               <dt><a href="#err-XTSE3430"><span class="error">ERR XTSE3430</span></a></dt>
               <dd>
                  <p>It is a <a href="https://qt4cg.org/specifications/xslt-40/#dt-static-error">static error</a><sup><small>XT</small></sup> if a <a href="https://qt4cg.org/specifications/xslt-40/#dt-package">package</a><sup><small>XT</small></sup> contains a construct that is
                     declared to be streamable but which is not <a title="guaranteed-streamable" class="termref" href="#dt-guaranteed-streamable">guaranteed-streamable</a>, unless the user has indicated that the
                     processor is to handle this situation by processing the stylesheet without
                     streaming or by making use of processor extensions to the streamability rules
                     where available.</p>
               </dd>
            </dl>
         </div>
         <div class="div1">
            
            <h2><a id="revision-log"></a>C <a href="#revision-log" style="text-decoration: none">Change Log</a> (Non-Normative)</h2>
            <p>This appendix lists changes made in version 4.0 of this specification.</p>
            <ol>
               <li>
                  <p>Use the arrows to browse significant changes since the 3.1 version of this specification.</p>
                  <p>See <a href="#intro"><b>1 Introduction</b></a></p>
               </li>
               <li>
                  <p>Sections with significant changes are marked Δ in the table of contents.</p>
                  <p>See <a href="#intro"><b>1 Introduction</b></a></p>
               </li>
               <li>
                  <p>The special rule allowing <a href="../../xslt-40/Overview.html#xsl:map">xsl:map</a>
                      to have multiple consumable operands does not apply if duplicate keys are
                     permitted.</p>
                  <p>See <a href="#streamability-xsl-map"><b>12.5.23 Streamability of xsl:map</b></a></p>
               </li>
               <li>
                  <p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2011">2011&nbsp;</a></p>
                  <p>
                  The static typing rules have been updated to take account of new constructs in XPath 4.0.
               </p>
                  <p>See <a href="#determining-static-type"><b>3.5 Determining the Static Type of a Construct</b></a></p>
               </li>
            </ol>
         </div>
      </div><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script><script src="js/toc.js"></script></body>
</html>