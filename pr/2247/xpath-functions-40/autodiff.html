<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" lang="EN"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><!--Generated by the DeltaXML.com xhtml-outfilter.xsl--><!--Using XSL Processor: Saxonica--><title>XPath and XQuery Functions and Operators 4.0 </title><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="stylesheet" type="text/css" href="css/w3c-base.css"><link rel="stylesheet" href="css/qtspecs.css"><link rel="stylesheet" href="css/xpath-functions-40.css"><script src="js/fo-datalist.js"></script><style type="text/css">
          body { margin-top: 50px }
          a.button { background: #DDD; border: 2px outset black; padding: 2px; margin: 2px; font-family: sans-serif; font-size: small;}
          a.button:hover { cursor:pointer; }
          a.button:active { border-style: inset; }
        </style><link rel="stylesheet" href="/css/autodiff.css"></head><body><div style="position:fixed; clear:both; top:0px" id="_autodiff_buttons"><p><a class="button" onclick="view('old')">
              View Old
            </a><a class="button" onclick="view('new')">
              View New
            </a><a class="button" onclick="view('both')">
              View Both
            </a><a class="button" onclick="view('only')">
              View Only
            </a><a class="button" onclick="scroll_to('prev')">
              Previous
            </a><a class="button" onclick="scroll_to('next')">
              Next
            </a><span id="__autodiff__"></span></p></div><div class="head"><p><a href="https://www.w3.org/"><img src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" alt="W3C" height="48" width="72"></a></p><h1><a id="title"></a>XPath and XQuery Functions and Operators 4.0 </h1><h2><a id="w3c-doctype"></a>W3C Editor's Draft <span class="deltaxml-old" style="background:#FF5555">10</span><span class="deltaxml-new" style="background:#90EE90">11</span>&nbsp;February&nbsp;2026</h2><dl><dt>This version:</dt><dd><a href="https://qt4cg.org/pr/2247/xpath-functions-40//">https://qt4cg.org/<span class="deltaxml-old" style="background:#FF5555">specifications/</span><span class="deltaxml-new" style="background:#90EE90">pr/2247/</span>xpath-functions-40/</a></dd><dt>Latest version of XPath and XQuery Functions and Operators 4.0:</dt><dd><a href="https://qt4cg.org/specifications/xpath-functions-40/">https://qt4cg.org/specifications/xpath-functions-40/</a></dd><dt>Most recent Recommendation of XPath and XQuery Functions and Operators:</dt><dd><a href="https://www.w3.org/TR/2017/REC-xpath-functions-31-20170321/">https://www.w3.org/TR/2017/REC-xpath-functions-31-20170321/</a></dd><dt>Editor:</dt><dd>Michael Kay, Saxonica <a href="http://www.saxonica.com/">&lt;http://www.saxonica.com/&gt;</a></dd></dl><p>This document is also available in these non-normative formats: <a href="xpath-functions-40.xml">Specification in XML format</a> and&nbsp;<a href="function-catalog.xml">XML function catalog</a>.</p><p class="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>&nbsp;©&nbsp;2000&nbsp;<a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p><hr></div><div><h2><a id="abstract"></a>Abstract</h2><p>This document defines constructor functions, operators, and functions on the datatypes defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> and the datatypes defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. It also defines functions and operators on nodes and node sequences as defined in the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. These functions and operators are defined for use in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> and <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> and <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a> and other related XML standards. The signatures and summaries of functions defined in this document are available at: <a href="http://www.w3.org/2005/xpath-functions/">http://www.w3.org/2005/xpath-functions/</a>.</p><p>A summary of changes since version 3.1 is provided at <a href="#changelog"><b>H Changes since 3.1</b></a>.</p></div><div><h2><a id="status"></a>Status of this Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document.</em></p><p>This document is a working draft developed and maintained by a W3C Community Group, the <a href="https://www.w3.org/community/xslt-40/">XQuery and XSLT Extensions Community Group</a> unofficially known as QT4CG (where "QT" denotes Query and Transformation). This draft is work in progress and should not be considered either stable or complete. Standard W3C copyright and patent conditions apply.</p><p>The community group welcomes comments on the specification. Comments are best submitted as issues on the group's <a href="https://github.com/qt4cg/qtspecs/issues">GitHub repository</a>.</p><p id="at-risk">As the Community Group moves towards publishing dated, stable drafts, some features that the group thinks may likely be removed or substantially changed are marked “at risk” in their changes section. In this draft:</p><ul><li><a href="#func-array-members">array:members</a></li><li><a href="#func-array-of-members">array:of-members</a></li></ul><p>The community group maintains two extensive test suites, one oriented to XQuery and XPath, the other to XSLT. These can be found at <a href="https://github.com/qt4cg/qt4tests">qt4tests</a> and <a href="https://github.com/qt4cg/xslt40-test">xslt40-test</a> respectively. New tests, or suggestions for correcting existing tests, are welcome. The test suites include extensive metadata describing the conditions for applicability of each test case as well as the expected results. They do not include any test drivers for executing the tests: each implementation is expected to provide its own test driver.</p><div class="dedication" id="dedication"><h3>Dedication</h3><p>The publications of this community group <a href="../xquery-40/xpath-40.html#dedication">are dedicated</a> to our co-chair, Michael Sperberg-McQueen&nbsp;(1954–2024).</p></div></div><nav id="toc"><div id="function-finder"><div class="ffheader">FUNCTION FINDER</div><div><span style="display: none;" class="delete_version"><span>Function search: <input id="select-fn" list="fn-list" type="text"><button id="help-select-fn-button">?</button></span><p id="help-select-fn" style="display:none;">Type a function name, or press down arrow for a list.</p><datalist id="fn-list"><option value="fn:abs⁣"></option><option value="fn:adjust-date-to-timezone⁣"></option><option value="fn:adjust-dateTime-to-timezone⁣"></option><option value="fn:adjust-time-to-timezone⁣"></option><option value="fn:all-different⁣"></option><option value="fn:all-equal⁣"></option><option value="fn:analyze-string⁣"></option><option value="fn:apply⁣"></option><option value="fn:atomic-equal⁣"></option><option value="fn:atomic-type-annotation⁣"></option><option value="fn:available-environment-variables⁣"></option><option value="fn:avg⁣"></option><option value="fn:base-uri⁣"></option><option value="fn:boolean⁣"></option><option value="fn:build-dateTime⁣"></option><option value="fn:build-uri⁣"></option><option value="fn:ceiling⁣"></option><option value="fn:char⁣"></option><option value="fn:characters⁣"></option><option value="fn:civil-timezone⁣"></option><option value="fn:codepoint-equal⁣"></option><option value="fn:codepoints-to-string⁣"></option><option value="fn:collation⁣"></option><option value="fn:collation-available⁣"></option><option value="fn:collation-key⁣"></option><option value="fn:collection⁣"></option><option value="fn:compare⁣"></option><option value="fn:concat⁣"></option><option value="fn:contains⁣"></option><option value="fn:contains-subsequence⁣"></option><option value="fn:contains-token⁣"></option><option value="fn:count⁣"></option><option value="fn:csv-doc⁣"></option><option value="fn:csv-to-arrays⁣"></option><option value="fn:csv-to-xml⁣"></option><option value="fn:current-date⁣"></option><option value="fn:current-dateTime⁣"></option><option value="fn:current-time⁣"></option><option value="fn:data⁣"></option><option value="fn:dateTime⁣"></option><option value="fn:day-from-date⁣"></option><option value="fn:day-from-dateTime⁣"></option><option value="fn:days-from-duration⁣"></option><option value="fn:decode-from-uri⁣"></option><option value="fn:deep-equal⁣"></option><option value="fn:default-collation⁣"></option><option value="fn:default-language⁣"></option><option value="fn:distinct-ordered-nodes⁣"></option><option value="fn:distinct-values⁣"></option><option value="fn:divide-decimals⁣"></option><option value="fn:do-until⁣"></option><option value="fn:doc⁣"></option><option value="fn:doc-available⁣"></option><option value="fn:document-uri⁣"></option><option value="fn:duplicate-values⁣"></option><option value="fn:element-to-map⁣"></option><option value="fn:element-to-map-plan⁣"></option><option value="fn:element-with-id⁣"></option><option value="fn:empty⁣"></option><option value="fn:encode-for-uri⁣"></option><option value="fn:ends-with⁣"></option><option value="fn:ends-with-subsequence⁣"></option><option value="fn:environment-variable⁣"></option><option value="fn:error⁣"></option><option value="fn:escape-html-uri⁣"></option><option value="fn:every⁣"></option><option value="fn:exactly-one⁣"></option><option value="fn:exists⁣"></option><option value="fn:expanded-QName⁣"></option><option value="fn:false⁣"></option><option value="fn:filter⁣"></option><option value="fn:floor⁣"></option><option value="fn:fold-left⁣"></option><option value="fn:fold-right⁣"></option><option value="fn:foot⁣"></option><option value="fn:for-each⁣"></option><option value="fn:for-each-pair⁣"></option><option value="fn:format-date⁣"></option><option value="fn:format-dateTime⁣"></option><option value="fn:format-integer⁣"></option><option value="fn:format-number⁣"></option><option value="fn:format-time⁣"></option><option value="fn:function-annotations⁣"></option><option value="fn:function-arity⁣"></option><option value="fn:function-identity⁣"></option><option value="fn:function-lookup⁣"></option><option value="fn:function-name⁣"></option><option value="fn:generate-id⁣"></option><option value="fn:graphemes⁣"></option><option value="fn:has-children⁣"></option><option value="fn:hash⁣"></option><option value="fn:head⁣"></option><option value="fn:highest⁣"></option><option value="fn:hours-from-dateTime⁣"></option><option value="fn:hours-from-duration⁣"></option><option value="fn:hours-from-time⁣"></option><option value="fn:html-doc⁣"></option><option value="fn:id⁣"></option><option value="fn:identity⁣"></option><option value="fn:idref⁣"></option><option value="fn:implicit-timezone⁣"></option><option value="fn:in-scope-namespaces⁣"></option><option value="fn:in-scope-prefixes⁣"></option><option value="fn:index-of⁣"></option><option value="fn:index-where⁣"></option><option value="fn:innermost⁣"></option><option value="fn:insert-before⁣"></option><option value="fn:insert-separator⁣"></option><option value="fn:invisible-xml⁣"></option><option value="fn:iri-to-uri⁣"></option><option value="fn:is-NaN⁣"></option><option value="fn:items-at⁣"></option><option value="fn:jnode-content⁣"></option><option value="fn:jnode-position⁣"></option><option value="fn:jnode-selector⁣"></option><option value="fn:json-doc⁣"></option><option value="fn:json-to-xml⁣"></option><option value="fn:jtree⁣"></option><option value="fn:lang⁣"></option><option value="fn:last⁣"></option><option value="fn:load-xquery-module⁣"></option><option value="fn:local-name⁣"></option><option value="fn:local-name-from-QName⁣"></option><option value="fn:lower-case⁣"></option><option value="fn:lowest⁣"></option><option value="fn:matches⁣"></option><option value="fn:max⁣"></option><option value="fn:message⁣"></option><option value="fn:min⁣"></option><option value="fn:minutes-from-dateTime⁣"></option><option value="fn:minutes-from-duration⁣"></option><option value="fn:minutes-from-time⁣"></option><option value="fn:month-from-date⁣"></option><option value="fn:month-from-dateTime⁣"></option><option value="fn:months-from-duration⁣"></option><option value="fn:name⁣"></option><option value="fn:namespace-uri⁣"></option><option value="fn:namespace-uri-for-prefix⁣"></option><option value="fn:namespace-uri-from-QName⁣"></option><option value="fn:nilled⁣"></option><option value="fn:node-name⁣"></option><option value="fn:node-type-annotation⁣"></option><option value="fn:normalize-space⁣"></option><option value="fn:normalize-unicode⁣"></option><option value="fn:not⁣"></option><option value="fn:number⁣"></option><option value="fn:one-or-more⁣"></option><option value="fn:op⁣"></option><option value="fn:outermost⁣"></option><option value="fn:parse-csv⁣"></option><option value="fn:parse-html⁣"></option><option value="fn:parse-ietf-date⁣"></option><option value="fn:parse-integer⁣"></option><option value="fn:parse-json⁣"></option><option value="fn:parse-QName⁣"></option><option value="fn:parse-uri⁣"></option><option value="fn:parse-xml⁣"></option><option value="fn:parse-xml-fragment⁣"></option><option value="fn:partial-apply⁣"></option><option value="fn:partition⁣"></option><option value="fn:parts-of-dateTime⁣"></option><option value="fn:path⁣"></option><option value="fn:position⁣"></option><option value="fn:prefix-from-QName⁣"></option><option value="fn:QName⁣"></option><option value="fn:random-number-generator⁣"></option><option value="fn:remove⁣"></option><option value="fn:replace⁣"></option><option value="fn:replicate⁣"></option><option value="fn:resolve-QName⁣"></option><option value="fn:resolve-uri⁣"></option><option value="fn:reverse⁣"></option><option value="fn:root⁣"></option><option value="fn:round⁣"></option><option value="fn:round-half-to-even⁣"></option><option value="fn:scan-left⁣"></option><option value="fn:scan-right⁣"></option><option value="fn:schema-type⁣"></option><option value="fn:seconds⁣"></option><option value="fn:seconds-from-dateTime⁣"></option><option value="fn:seconds-from-duration⁣"></option><option value="fn:seconds-from-time⁣"></option><option value="fn:serialize⁣"></option><option value="fn:siblings⁣"></option><option value="fn:slice⁣"></option><option value="fn:some⁣"></option><option value="fn:sort⁣"></option><option value="fn:sort-by⁣"></option><option value="fn:sort-with⁣"></option><option value="fn:starts-with⁣"></option><option value="fn:starts-with-subsequence⁣"></option><option value="fn:static-base-uri⁣"></option><option value="fn:string⁣"></option><option value="fn:string-join⁣"></option><option value="fn:string-length⁣"></option><option value="fn:string-to-codepoints⁣"></option><option value="fn:subsequence⁣"></option><option value="fn:subsequence-where⁣"></option><option value="fn:substring⁣"></option><option value="fn:substring-after⁣"></option><option value="fn:substring-before⁣"></option><option value="fn:sum⁣"></option><option value="fn:tail⁣"></option><option value="fn:take-while⁣"></option><option value="fn:timezone-from-date⁣"></option><option value="fn:timezone-from-dateTime⁣"></option><option value="fn:timezone-from-time⁣"></option><option value="fn:tokenize⁣"></option><option value="fn:trace⁣"></option><option value="fn:transform⁣"></option><option value="fn:transitive-closure⁣"></option><option value="fn:translate⁣"></option><option value="fn:true⁣"></option><option value="fn:trunk⁣"></option><option value="fn:type-of⁣"></option><option value="fn:unix-dateTime⁣"></option><option value="fn:unordered⁣"></option><option value="fn:unparsed-binary⁣"></option><option value="fn:unparsed-text⁣"></option><option value="fn:unparsed-text-available⁣"></option><option value="fn:unparsed-text-lines⁣"></option><option value="fn:upper-case⁣"></option><option value="fn:uri-collection⁣"></option><option value="fn:void⁣"></option><option value="fn:while-do⁣"></option><option value="fn:xml-to-json⁣"></option><option value="fn:xsd-validator⁣"></option><option value="fn:year-from-date⁣"></option><option value="fn:year-from-dateTime⁣"></option><option value="fn:years-from-duration⁣"></option><option value="fn:zero-or-one⁣"></option><option value="array:append⁣"></option><option value="array:build⁣"></option><option value="array:empty⁣"></option><option value="array:filter⁣"></option><option value="array:flatten⁣"></option><option value="array:fold-left⁣"></option><option value="array:fold-right⁣"></option><option value="array:foot⁣"></option><option value="array:for-each⁣"></option><option value="array:for-each-pair⁣"></option><option value="array:get⁣"></option><option value="array:head⁣"></option><option value="array:index-of⁣"></option><option value="array:index-where⁣"></option><option value="array:insert-before⁣"></option><option value="array:items⁣"></option><option value="array:join⁣"></option><option value="array:members⁣"></option><option value="array:of-members⁣"></option><option value="array:put⁣"></option><option value="array:remove⁣"></option><option value="array:reverse⁣"></option><option value="array:size⁣"></option><option value="array:slice⁣"></option><option value="array:sort⁣"></option><option value="array:sort-by⁣"></option><option value="array:sort-with⁣"></option><option value="array:split⁣"></option><option value="array:subarray⁣"></option><option value="array:tail⁣"></option><option value="array:trunk⁣"></option><option value="map:build⁣"></option><option value="map:contains⁣"></option><option value="map:empty⁣"></option><option value="map:entries⁣"></option><option value="map:entry⁣"></option><option value="map:filter⁣"></option><option value="map:find⁣"></option><option value="map:for-each⁣"></option><option value="map:get⁣"></option><option value="map:items⁣"></option><option value="map:keys⁣"></option><option value="map:keys-where⁣"></option><option value="map:merge⁣"></option><option value="map:put⁣"></option><option value="map:remove⁣"></option><option value="map:size⁣"></option><option value="math:acos⁣"></option><option value="math:asin⁣"></option><option value="math:atan⁣"></option><option value="math:atan2⁣"></option><option value="math:cos⁣"></option><option value="math:cosh⁣"></option><option value="math:e⁣"></option><option value="math:exp⁣"></option><option value="math:exp10⁣"></option><option value="math:log⁣"></option><option value="math:log10⁣"></option><option value="math:pi⁣"></option><option value="math:pow⁣"></option><option value="math:sin⁣"></option><option value="math:sinh⁣"></option><option value="math:sqrt⁣"></option><option value="math:tan⁣"></option><option value="math:tanh⁣"></option><option value="op:add-dayTimeDuration-to-date⁣"></option><option value="op:add-dayTimeDuration-to-dateTime⁣"></option><option value="op:add-dayTimeDuration-to-time⁣"></option><option value="op:add-dayTimeDurations⁣"></option><option value="op:add-yearMonthDuration-to-date⁣"></option><option value="op:add-yearMonthDuration-to-dateTime⁣"></option><option value="op:add-yearMonthDurations⁣"></option><option value="op:divide-dayTimeDuration⁣"></option><option value="op:divide-dayTimeDuration-by-dayTimeDuration⁣"></option><option value="op:divide-yearMonthDuration⁣"></option><option value="op:divide-yearMonthDuration-by-yearMonthDuration⁣"></option><option value="op:multiply-dayTimeDuration⁣"></option><option value="op:multiply-yearMonthDuration⁣"></option><option value="op:numeric-add⁣"></option><option value="op:numeric-divide⁣"></option><option value="op:numeric-integer-divide⁣"></option><option value="op:numeric-mod⁣"></option><option value="op:numeric-multiply⁣"></option><option value="op:numeric-subtract⁣"></option><option value="op:numeric-unary-minus⁣"></option><option value="op:numeric-unary-plus⁣"></option><option value="op:subtract-dates⁣"></option><option value="op:subtract-dateTimes⁣"></option><option value="op:subtract-dayTimeDuration-from-date⁣"></option><option value="op:subtract-dayTimeDuration-from-dateTime⁣"></option><option value="op:subtract-dayTimeDuration-from-time⁣"></option><option value="op:subtract-dayTimeDurations⁣"></option><option value="op:subtract-times⁣"></option><option value="op:subtract-yearMonthDuration-from-date⁣"></option><option value="op:subtract-yearMonthDuration-from-dateTime⁣"></option><option value="op:subtract-yearMonthDurations⁣"></option></datalist></span><span style="display: none;" class="add_version"><span>Function search: <input id="select-fn" list="fn-list" type="text"><button id="help-select-fn-button">?</button></span><p id="help-select-fn" style="display:none;">Type a function name, or press down arrow for a list.</p><datalist id="fn-list"><option value="fn:abs⁣"></option><option value="fn:adjust-date-to-timezone⁣"></option><option value="fn:adjust-dateTime-to-timezone⁣"></option><option value="fn:adjust-time-to-timezone⁣"></option><option value="fn:all-different⁣"></option><option value="fn:all-equal⁣"></option><option value="fn:analyze-string⁣"></option><option value="fn:apply⁣"></option><option value="fn:atomic-equal⁣"></option><option value="fn:atomic-type-annotation⁣"></option><option value="fn:available-environment-variables⁣"></option><option value="fn:avg⁣"></option><option value="fn:base-uri⁣"></option><option value="fn:boolean⁣"></option><option value="fn:build-dateTime⁣"></option><option value="fn:build-uri⁣"></option><option value="fn:ceiling⁣"></option><option value="fn:char⁣"></option><option value="fn:characters⁣"></option><option value="fn:civil-timezone⁣"></option><option value="fn:codepoint-equal⁣"></option><option value="fn:codepoints-to-string⁣"></option><option value="fn:collation⁣"></option><option value="fn:collation-available⁣"></option><option value="fn:collation-key⁣"></option><option value="fn:collection⁣"></option><option value="fn:compare⁣"></option><option value="fn:concat⁣"></option><option value="fn:contains⁣"></option><option value="fn:contains-subsequence⁣"></option><option value="fn:contains-token⁣"></option><option value="fn:count⁣"></option><option value="fn:csv-doc⁣"></option><option value="fn:csv-to-arrays⁣"></option><option value="fn:csv-to-xml⁣"></option><option value="fn:current-date⁣"></option><option value="fn:current-dateTime⁣"></option><option value="fn:current-time⁣"></option><option value="fn:data⁣"></option><option value="fn:dateTime⁣"></option><option value="fn:day-from-date⁣"></option><option value="fn:day-from-dateTime⁣"></option><option value="fn:days-from-duration⁣"></option><option value="fn:decode-from-uri⁣"></option><option value="fn:deep-equal⁣"></option><option value="fn:default-collation⁣"></option><option value="fn:default-language⁣"></option><option value="fn:distinct-ordered-nodes⁣"></option><option value="fn:distinct-values⁣"></option><option value="fn:divide-decimals⁣"></option><option value="fn:do-until⁣"></option><option value="fn:doc⁣"></option><option value="fn:doc-available⁣"></option><option value="fn:document-uri⁣"></option><option value="fn:duplicate-values⁣"></option><option value="fn:element-to-map⁣"></option><option value="fn:element-to-map-plan⁣"></option><option value="fn:element-with-id⁣"></option><option value="fn:empty⁣"></option><option value="fn:encode-for-uri⁣"></option><option value="fn:ends-with⁣"></option><option value="fn:ends-with-subsequence⁣"></option><option value="fn:environment-variable⁣"></option><option value="fn:error⁣"></option><option value="fn:escape-html-uri⁣"></option><option value="fn:every⁣"></option><option value="fn:exactly-one⁣"></option><option value="fn:exists⁣"></option><option value="fn:expanded-QName⁣"></option><option value="fn:false⁣"></option><option value="fn:filter⁣"></option><option value="fn:floor⁣"></option><option value="fn:fold-left⁣"></option><option value="fn:fold-right⁣"></option><option value="fn:foot⁣"></option><option value="fn:for-each⁣"></option><option value="fn:for-each-pair⁣"></option><option value="fn:format-date⁣"></option><option value="fn:format-dateTime⁣"></option><option value="fn:format-integer⁣"></option><option value="fn:format-number⁣"></option><option value="fn:format-time⁣"></option><option value="fn:function-annotations⁣"></option><option value="fn:function-arity⁣"></option><option value="fn:function-identity⁣"></option><option value="fn:function-lookup⁣"></option><option value="fn:function-name⁣"></option><option value="fn:generate-id⁣"></option><option value="fn:graphemes⁣"></option><option value="fn:has-children⁣"></option><option value="fn:hash⁣"></option><option value="fn:head⁣"></option><option value="fn:highest⁣"></option><option value="fn:hours-from-dateTime⁣"></option><option value="fn:hours-from-duration⁣"></option><option value="fn:hours-from-time⁣"></option><option value="fn:html-doc⁣"></option><option value="fn:id⁣"></option><option value="fn:identity⁣"></option><option value="fn:idref⁣"></option><option value="fn:implicit-timezone⁣"></option><option value="fn:in-scope-namespaces⁣"></option><option value="fn:in-scope-prefixes⁣"></option><option value="fn:index-of⁣"></option><option value="fn:index-where⁣"></option><option value="fn:innermost⁣"></option><option value="fn:insert-before⁣"></option><option value="fn:insert-separator⁣"></option><option value="fn:invisible-xml⁣"></option><option value="fn:iri-to-uri⁣"></option><option value="fn:is-NaN⁣"></option><option value="fn:items-at⁣"></option><option value="fn:jnode-content⁣"></option><option value="fn:jnode-position⁣"></option><option value="fn:jnode-selector⁣"></option><option value="fn:json-doc⁣"></option><option value="fn:json-to-xml⁣"></option><option value="fn:jtree⁣"></option><option value="fn:lang⁣"></option><option value="fn:last⁣"></option><option value="fn:load-xquery-module⁣"></option><option value="fn:local-name⁣"></option><option value="fn:local-name-from-QName⁣"></option><option value="fn:lower-case⁣"></option><option value="fn:lowest⁣"></option><option value="fn:matches⁣"></option><option value="fn:max⁣"></option><option value="fn:message⁣"></option><option value="fn:min⁣"></option><option value="fn:minutes-from-dateTime⁣"></option><option value="fn:minutes-from-duration⁣"></option><option value="fn:minutes-from-time⁣"></option><option value="fn:month-from-date⁣"></option><option value="fn:month-from-dateTime⁣"></option><option value="fn:months-from-duration⁣"></option><option value="fn:name⁣"></option><option value="fn:namespace-uri⁣"></option><option value="fn:namespace-uri-for-prefix⁣"></option><option value="fn:namespace-uri-from-QName⁣"></option><option value="fn:nilled⁣"></option><option value="fn:node-name⁣"></option><option value="fn:node-type-annotation⁣"></option><option value="fn:normalize-space⁣"></option><option value="fn:normalize-unicode⁣"></option><option value="fn:not⁣"></option><option value="fn:number⁣"></option><option value="fn:one-or-more⁣"></option><option value="fn:op⁣"></option><option value="fn:outermost⁣"></option><option value="fn:parse-csv⁣"></option><option value="fn:parse-html⁣"></option><option value="fn:parse-ietf-date⁣"></option><option value="fn:parse-integer⁣"></option><option value="fn:parse-json⁣"></option><option value="fn:parse-QName⁣"></option><option value="fn:parse-uri⁣"></option><option value="fn:parse-xml⁣"></option><option value="fn:parse-xml-fragment⁣"></option><option value="fn:partial-apply⁣"></option><option value="fn:partition⁣"></option><option value="fn:parts-of-dateTime⁣"></option><option value="fn:path⁣"></option><option value="fn:position⁣"></option><option value="fn:prefix-from-QName⁣"></option><option value="fn:QName⁣"></option><option value="fn:random-number-generator⁣"></option><option value="fn:remove⁣"></option><option value="fn:replace⁣"></option><option value="fn:replicate⁣"></option><option value="fn:resolve-QName⁣"></option><option value="fn:resolve-uri⁣"></option><option value="fn:reverse⁣"></option><option value="fn:root⁣"></option><option value="fn:round⁣"></option><option value="fn:round-half-to-even⁣"></option><option value="fn:scan-left⁣"></option><option value="fn:scan-right⁣"></option><option value="fn:schema-type⁣"></option><option value="fn:seconds⁣"></option><option value="fn:seconds-from-dateTime⁣"></option><option value="fn:seconds-from-duration⁣"></option><option value="fn:seconds-from-time⁣"></option><option value="fn:serialize⁣"></option><option value="fn:siblings⁣"></option><option value="fn:slice⁣"></option><option value="fn:some⁣"></option><option value="fn:sort⁣"></option><option value="fn:sort-by⁣"></option><option value="fn:sort-with⁣"></option><option value="fn:starts-with⁣"></option><option value="fn:starts-with-subsequence⁣"></option><option value="fn:static-base-uri⁣"></option><option value="fn:string⁣"></option><option value="fn:string-join⁣"></option><option value="fn:string-length⁣"></option><option value="fn:string-to-codepoints⁣"></option><option value="fn:subsequence⁣"></option><option value="fn:subsequence-where⁣"></option><option value="fn:substring⁣"></option><option value="fn:substring-after⁣"></option><option value="fn:substring-before⁣"></option><option value="fn:sum⁣"></option><option value="fn:tail⁣"></option><option value="fn:take-while⁣"></option><option value="fn:timezone-from-date⁣"></option><option value="fn:timezone-from-dateTime⁣"></option><option value="fn:timezone-from-time⁣"></option><option value="fn:tokenize⁣"></option><option value="fn:trace⁣"></option><option value="fn:transform⁣"></option><option value="fn:transitive-closure⁣"></option><option value="fn:translate⁣"></option><option value="fn:true⁣"></option><option value="fn:trunk⁣"></option><option value="fn:type-of⁣"></option><option value="fn:unix-dateTime⁣"></option><option value="fn:unordered⁣"></option><option value="fn:unparsed-binary⁣"></option><option value="fn:unparsed-text⁣"></option><option value="fn:unparsed-text-available⁣"></option><option value="fn:unparsed-text-lines⁣"></option><option value="fn:upper-case⁣"></option><option value="fn:uri-collection⁣"></option><option value="fn:void⁣"></option><option value="fn:while-do⁣"></option><option value="fn:xml-to-json⁣"></option><option value="fn:xsd-validator⁣"></option><option value="fn:year-from-date⁣"></option><option value="fn:year-from-dateTime⁣"></option><option value="fn:years-from-duration⁣"></option><option value="fn:zero-or-one⁣"></option><option value="array:append⁣"></option><option value="array:build⁣"></option><option value="array:empty⁣"></option><option value="array:filter⁣"></option><option value="array:flatten⁣"></option><option value="array:fold-left⁣"></option><option value="array:fold-right⁣"></option><option value="array:foot⁣"></option><option value="array:for-each⁣"></option><option value="array:for-each-pair⁣"></option><option value="array:get⁣"></option><option value="array:head⁣"></option><option value="array:index-of⁣"></option><option value="array:index-where⁣"></option><option value="array:insert-before⁣"></option><option value="array:items⁣"></option><option value="array:join⁣"></option><option value="array:members⁣"></option><option value="array:of-members⁣"></option><option value="array:put⁣"></option><option value="array:remove⁣"></option><option value="array:reverse⁣"></option><option value="array:size⁣"></option><option value="array:slice⁣"></option><option value="array:sort⁣"></option><option value="array:sort-by⁣"></option><option value="array:sort-with⁣"></option><option value="array:split⁣"></option><option value="array:subarray⁣"></option><option value="array:tail⁣"></option><option value="array:trunk⁣"></option><option value="gn:append⁣"></option><option value="gn:at⁣"></option><option value="gn:chunk⁣"></option><option value="gn:concat⁣"></option><option value="gn:contains⁣"></option><option value="gn:distinct⁣"></option><option value="gn:empty-generator⁣"></option><option value="gn:filter⁣"></option><option value="gn:first-where⁣"></option><option value="gn:fold-lazy⁣"></option><option value="gn:fold-left⁣"></option><option value="gn:fold-right⁣"></option><option value="gn:for-each⁣"></option><option value="gn:for-each-pair⁣"></option><option value="gn:head⁣"></option><option value="gn:insert-at⁣"></option><option value="gn:make-generator⁣"></option><option value="gn:make-generator-from-array⁣"></option><option value="gn:make-generator-from-map⁣"></option><option value="gn:make-generator-from-sequence⁣"></option><option value="gn:next⁣"></option><option value="gn:prepend⁣"></option><option value="gn:remove-at⁣"></option><option value="gn:remove-where⁣"></option><option value="gn:replace⁣"></option><option value="gn:reverse⁣"></option><option value="gn:scan-left⁣"></option><option value="gn:scan-right⁣"></option><option value="gn:skip⁣"></option><option value="gn:skip-strict⁣"></option><option value="gn:skip-while⁣"></option><option value="gn:some⁣"></option><option value="gn:some-where⁣"></option><option value="gn:subrange⁣"></option><option value="gn:tail⁣"></option><option value="gn:take⁣"></option><option value="gn:take-while⁣"></option><option value="gn:to-array⁣"></option><option value="gn:to-map⁣"></option><option value="gn:to-sequence⁣"></option><option value="gn:value⁣"></option><option value="gn:zip⁣"></option><option value="map:build⁣"></option><option value="map:contains⁣"></option><option value="map:empty⁣"></option><option value="map:entries⁣"></option><option value="map:entry⁣"></option><option value="map:filter⁣"></option><option value="map:find⁣"></option><option value="map:for-each⁣"></option><option value="map:get⁣"></option><option value="map:items⁣"></option><option value="map:keys⁣"></option><option value="map:keys-where⁣"></option><option value="map:merge⁣"></option><option value="map:put⁣"></option><option value="map:remove⁣"></option><option value="map:size⁣"></option><option value="math:acos⁣"></option><option value="math:asin⁣"></option><option value="math:atan⁣"></option><option value="math:atan2⁣"></option><option value="math:cos⁣"></option><option value="math:cosh⁣"></option><option value="math:e⁣"></option><option value="math:exp⁣"></option><option value="math:exp10⁣"></option><option value="math:log⁣"></option><option value="math:log10⁣"></option><option value="math:pi⁣"></option><option value="math:pow⁣"></option><option value="math:sin⁣"></option><option value="math:sinh⁣"></option><option value="math:sqrt⁣"></option><option value="math:tan⁣"></option><option value="math:tanh⁣"></option><option value="op:add-dayTimeDuration-to-date⁣"></option><option value="op:add-dayTimeDuration-to-dateTime⁣"></option><option value="op:add-dayTimeDuration-to-time⁣"></option><option value="op:add-dayTimeDurations⁣"></option><option value="op:add-yearMonthDuration-to-date⁣"></option><option value="op:add-yearMonthDuration-to-dateTime⁣"></option><option value="op:add-yearMonthDurations⁣"></option><option value="op:divide-dayTimeDuration⁣"></option><option value="op:divide-dayTimeDuration-by-dayTimeDuration⁣"></option><option value="op:divide-yearMonthDuration⁣"></option><option value="op:divide-yearMonthDuration-by-yearMonthDuration⁣"></option><option value="op:multiply-dayTimeDuration⁣"></option><option value="op:multiply-yearMonthDuration⁣"></option><option value="op:numeric-add⁣"></option><option value="op:numeric-divide⁣"></option><option value="op:numeric-integer-divide⁣"></option><option value="op:numeric-mod⁣"></option><option value="op:numeric-multiply⁣"></option><option value="op:numeric-subtract⁣"></option><option value="op:numeric-unary-minus⁣"></option><option value="op:numeric-unary-plus⁣"></option><option value="op:subtract-dates⁣"></option><option value="op:subtract-dateTimes⁣"></option><option value="op:subtract-dayTimeDuration-from-date⁣"></option><option value="op:subtract-dayTimeDuration-from-dateTime⁣"></option><option value="op:subtract-dayTimeDuration-from-time⁣"></option><option value="op:subtract-dayTimeDurations⁣"></option><option value="op:subtract-times⁣"></option><option value="op:subtract-yearMonthDuration-from-date⁣"></option><option value="op:subtract-yearMonthDuration-from-dateTime⁣"></option><option value="op:subtract-yearMonthDurations⁣"></option></datalist></span><span class="modify_version"><span>Function search: <input id="select-fn" list="fn-list" type="text"><button id="help-select-fn-button">?</button></span><p id="help-select-fn" style="display:none;">Type a function name, or press down arrow for a list.</p><datalist id="fn-list"><option value="fn:abs⁣"></option><option value="fn:adjust-date-to-timezone⁣"></option><option value="fn:adjust-dateTime-to-timezone⁣"></option><option value="fn:adjust-time-to-timezone⁣"></option><option value="fn:all-different⁣"></option><option value="fn:all-equal⁣"></option><option value="fn:analyze-string⁣"></option><option value="fn:apply⁣"></option><option value="fn:atomic-equal⁣"></option><option value="fn:atomic-type-annotation⁣"></option><option value="fn:available-environment-variables⁣"></option><option value="fn:avg⁣"></option><option value="fn:base-uri⁣"></option><option value="fn:boolean⁣"></option><option value="fn:build-dateTime⁣"></option><option value="fn:build-uri⁣"></option><option value="fn:ceiling⁣"></option><option value="fn:char⁣"></option><option value="fn:characters⁣"></option><option value="fn:civil-timezone⁣"></option><option value="fn:codepoint-equal⁣"></option><option value="fn:codepoints-to-string⁣"></option><option value="fn:collation⁣"></option><option value="fn:collation-available⁣"></option><option value="fn:collation-key⁣"></option><option value="fn:collection⁣"></option><option value="fn:compare⁣"></option><option value="fn:concat⁣"></option><option value="fn:contains⁣"></option><option value="fn:contains-subsequence⁣"></option><option value="fn:contains-token⁣"></option><option value="fn:count⁣"></option><option value="fn:csv-doc⁣"></option><option value="fn:csv-to-arrays⁣"></option><option value="fn:csv-to-xml⁣"></option><option value="fn:current-date⁣"></option><option value="fn:current-dateTime⁣"></option><option value="fn:current-time⁣"></option><option value="fn:data⁣"></option><option value="fn:dateTime⁣"></option><option value="fn:day-from-date⁣"></option><option value="fn:day-from-dateTime⁣"></option><option value="fn:days-from-duration⁣"></option><option value="fn:decode-from-uri⁣"></option><option value="fn:deep-equal⁣"></option><option value="fn:default-collation⁣"></option><option value="fn:default-language⁣"></option><option value="fn:distinct-ordered-nodes⁣"></option><option value="fn:distinct-values⁣"></option><option value="fn:divide-decimals⁣"></option><option value="fn:do-until⁣"></option><option value="fn:doc⁣"></option><option value="fn:doc-available⁣"></option><option value="fn:document-uri⁣"></option><option value="fn:duplicate-values⁣"></option><option value="fn:element-to-map⁣"></option><option value="fn:element-to-map-plan⁣"></option><option value="fn:element-with-id⁣"></option><option value="fn:empty⁣"></option><option value="fn:encode-for-uri⁣"></option><option value="fn:ends-with⁣"></option><option value="fn:ends-with-subsequence⁣"></option><option value="fn:environment-variable⁣"></option><option value="fn:error⁣"></option><option value="fn:escape-html-uri⁣"></option><option value="fn:every⁣"></option><option value="fn:exactly-one⁣"></option><option value="fn:exists⁣"></option><option value="fn:expanded-QName⁣"></option><option value="fn:false⁣"></option><option value="fn:filter⁣"></option><option value="fn:floor⁣"></option><option value="fn:fold-left⁣"></option><option value="fn:fold-right⁣"></option><option value="fn:foot⁣"></option><option value="fn:for-each⁣"></option><option value="fn:for-each-pair⁣"></option><option value="fn:format-date⁣"></option><option value="fn:format-dateTime⁣"></option><option value="fn:format-integer⁣"></option><option value="fn:format-number⁣"></option><option value="fn:format-time⁣"></option><option value="fn:function-annotations⁣"></option><option value="fn:function-arity⁣"></option><option value="fn:function-identity⁣"></option><option value="fn:function-lookup⁣"></option><option value="fn:function-name⁣"></option><option value="fn:generate-id⁣"></option><option value="fn:graphemes⁣"></option><option value="fn:has-children⁣"></option><option value="fn:hash⁣"></option><option value="fn:head⁣"></option><option value="fn:highest⁣"></option><option value="fn:hours-from-dateTime⁣"></option><option value="fn:hours-from-duration⁣"></option><option value="fn:hours-from-time⁣"></option><option value="fn:html-doc⁣"></option><option value="fn:id⁣"></option><option value="fn:identity⁣"></option><option value="fn:idref⁣"></option><option value="fn:implicit-timezone⁣"></option><option value="fn:in-scope-namespaces⁣"></option><option value="fn:in-scope-prefixes⁣"></option><option value="fn:index-of⁣"></option><option value="fn:index-where⁣"></option><option value="fn:innermost⁣"></option><option value="fn:insert-before⁣"></option><option value="fn:insert-separator⁣"></option><option value="fn:invisible-xml⁣"></option><option value="fn:iri-to-uri⁣"></option><option value="fn:is-NaN⁣"></option><option value="fn:items-at⁣"></option><option value="fn:jnode-content⁣"></option><option value="fn:jnode-position⁣"></option><option value="fn:jnode-selector⁣"></option><option value="fn:json-doc⁣"></option><option value="fn:json-to-xml⁣"></option><option value="fn:jtree⁣"></option><option value="fn:lang⁣"></option><option value="fn:last⁣"></option><option value="fn:load-xquery-module⁣"></option><option value="fn:local-name⁣"></option><option value="fn:local-name-from-QName⁣"></option><option value="fn:lower-case⁣"></option><option value="fn:lowest⁣"></option><option value="fn:matches⁣"></option><option value="fn:max⁣"></option><option value="fn:message⁣"></option><option value="fn:min⁣"></option><option value="fn:minutes-from-dateTime⁣"></option><option value="fn:minutes-from-duration⁣"></option><option value="fn:minutes-from-time⁣"></option><option value="fn:month-from-date⁣"></option><option value="fn:month-from-dateTime⁣"></option><option value="fn:months-from-duration⁣"></option><option value="fn:name⁣"></option><option value="fn:namespace-uri⁣"></option><option value="fn:namespace-uri-for-prefix⁣"></option><option value="fn:namespace-uri-from-QName⁣"></option><option value="fn:nilled⁣"></option><option value="fn:node-name⁣"></option><option value="fn:node-type-annotation⁣"></option><option value="fn:normalize-space⁣"></option><option value="fn:normalize-unicode⁣"></option><option value="fn:not⁣"></option><option value="fn:number⁣"></option><option value="fn:one-or-more⁣"></option><option value="fn:op⁣"></option><option value="fn:outermost⁣"></option><option value="fn:parse-csv⁣"></option><option value="fn:parse-html⁣"></option><option value="fn:parse-ietf-date⁣"></option><option value="fn:parse-integer⁣"></option><option value="fn:parse-json⁣"></option><option value="fn:parse-QName⁣"></option><option value="fn:parse-uri⁣"></option><option value="fn:parse-xml⁣"></option><option value="fn:parse-xml-fragment⁣"></option><option value="fn:partial-apply⁣"></option><option value="fn:partition⁣"></option><option value="fn:parts-of-dateTime⁣"></option><option value="fn:path⁣"></option><option value="fn:position⁣"></option><option value="fn:prefix-from-QName⁣"></option><option value="fn:QName⁣"></option><option value="fn:random-number-generator⁣"></option><option value="fn:remove⁣"></option><option value="fn:replace⁣"></option><option value="fn:replicate⁣"></option><option value="fn:resolve-QName⁣"></option><option value="fn:resolve-uri⁣"></option><option value="fn:reverse⁣"></option><option value="fn:root⁣"></option><option value="fn:round⁣"></option><option value="fn:round-half-to-even⁣"></option><option value="fn:scan-left⁣"></option><option value="fn:scan-right⁣"></option><option value="fn:schema-type⁣"></option><option value="fn:seconds⁣"></option><option value="fn:seconds-from-dateTime⁣"></option><option value="fn:seconds-from-duration⁣"></option><option value="fn:seconds-from-time⁣"></option><option value="fn:serialize⁣"></option><option value="fn:siblings⁣"></option><option value="fn:slice⁣"></option><option value="fn:some⁣"></option><option value="fn:sort⁣"></option><option value="fn:sort-by⁣"></option><option value="fn:sort-with⁣"></option><option value="fn:starts-with⁣"></option><option value="fn:starts-with-subsequence⁣"></option><option value="fn:static-base-uri⁣"></option><option value="fn:string⁣"></option><option value="fn:string-join⁣"></option><option value="fn:string-length⁣"></option><option value="fn:string-to-codepoints⁣"></option><option value="fn:subsequence⁣"></option><option value="fn:subsequence-where⁣"></option><option value="fn:substring⁣"></option><option value="fn:substring-after⁣"></option><option value="fn:substring-before⁣"></option><option value="fn:sum⁣"></option><option value="fn:tail⁣"></option><option value="fn:take-while⁣"></option><option value="fn:timezone-from-date⁣"></option><option value="fn:timezone-from-dateTime⁣"></option><option value="fn:timezone-from-time⁣"></option><option value="fn:tokenize⁣"></option><option value="fn:trace⁣"></option><option value="fn:transform⁣"></option><option value="fn:transitive-closure⁣"></option><option value="fn:translate⁣"></option><option value="fn:true⁣"></option><option value="fn:trunk⁣"></option><option value="fn:type-of⁣"></option><option value="fn:unix-dateTime⁣"></option><option value="fn:unordered⁣"></option><option value="fn:unparsed-binary⁣"></option><option value="fn:unparsed-text⁣"></option><option value="fn:unparsed-text-available⁣"></option><option value="fn:unparsed-text-lines⁣"></option><option value="fn:upper-case⁣"></option><option value="fn:uri-collection⁣"></option><option value="fn:void⁣"></option><option value="fn:while-do⁣"></option><option value="fn:xml-to-json⁣"></option><option value="fn:xsd-validator⁣"></option><option value="fn:year-from-date⁣"></option><option value="fn:year-from-dateTime⁣"></option><option value="fn:years-from-duration⁣"></option><option value="fn:zero-or-one⁣"></option><option value="array:append⁣"></option><option value="array:build⁣"></option><option value="array:empty⁣"></option><option value="array:filter⁣"></option><option value="array:flatten⁣"></option><option value="array:fold-left⁣"></option><option value="array:fold-right⁣"></option><option value="array:foot⁣"></option><option value="array:for-each⁣"></option><option value="array:for-each-pair⁣"></option><option value="array:get⁣"></option><option value="array:head⁣"></option><option value="array:index-of⁣"></option><option value="array:index-where⁣"></option><option value="array:insert-before⁣"></option><option value="array:items⁣"></option><option value="array:join⁣"></option><option value="array:members⁣"></option><option value="array:of-members⁣"></option><option value="array:put⁣"></option><option value="array:remove⁣"></option><option value="array:reverse⁣"></option><option value="array:size⁣"></option><option value="array:slice⁣"></option><option value="array:sort⁣"></option><option value="array:sort-by⁣"></option><option value="array:sort-with⁣"></option><option value="array:split⁣"></option><option value="array:subarray⁣"></option><option value="array:tail⁣"></option><option value="array:trunk⁣"></option><option value="gn:append⁣">+[[]]+</option><option value="gn:at⁣">+[[]]+</option><option value="gn:chunk⁣">+[[]]+</option><option value="gn:concat⁣">+[[]]+</option><option value="gn:contains⁣">+[[]]+</option><option value="gn:distinct⁣">+[[]]+</option><option value="gn:empty-generator⁣">+[[]]+</option><option value="gn:filter⁣">+[[]]+</option><option value="gn:first-where⁣">+[[]]+</option><option value="gn:fold-lazy⁣">+[[]]+</option><option value="gn:fold-left⁣">+[[]]+</option><option value="gn:fold-right⁣">+[[]]+</option><option value="gn:for-each⁣">+[[]]+</option><option value="gn:for-each-pair⁣">+[[]]+</option><option value="gn:head⁣">+[[]]+</option><option value="gn:insert-at⁣">+[[]]+</option><option value="gn:make-generator⁣">+[[]]+</option><option value="gn:make-generator-from-array⁣">+[[]]+</option><option value="gn:make-generator-from-map⁣">+[[]]+</option><option value="gn:make-generator-from-sequence⁣">+[[]]+</option><option value="gn:next⁣">+[[]]+</option><option value="gn:prepend⁣">+[[]]+</option><option value="gn:remove-at⁣">+[[]]+</option><option value="gn:remove-where⁣">+[[]]+</option><option value="gn:replace⁣">+[[]]+</option><option value="gn:reverse⁣">+[[]]+</option><option value="gn:scan-left⁣">+[[]]+</option><option value="gn:scan-right⁣">+[[]]+</option><option value="gn:skip⁣">+[[]]+</option><option value="gn:skip-strict⁣">+[[]]+</option><option value="gn:skip-while⁣">+[[]]+</option><option value="gn:some⁣">+[[]]+</option><option value="gn:some-where⁣">+[[]]+</option><option value="gn:subrange⁣">+[[]]+</option><option value="gn:tail⁣">+[[]]+</option><option value="gn:take⁣">+[[]]+</option><option value="gn:take-while⁣">+[[]]+</option><option value="gn:to-array⁣">+[[]]+</option><option value="gn:to-map⁣">+[[]]+</option><option value="gn:to-sequence⁣">+[[]]+</option><option value="gn:value⁣">+[[]]+</option><option value="gn:zip⁣">+[[]]+</option><option value="map:build⁣"></option><option value="map:contains⁣"></option><option value="map:empty⁣"></option><option value="map:entries⁣"></option><option value="map:entry⁣"></option><option value="map:filter⁣"></option><option value="map:find⁣"></option><option value="map:for-each⁣"></option><option value="map:get⁣"></option><option value="map:items⁣"></option><option value="map:keys⁣"></option><option value="map:keys-where⁣"></option><option value="map:merge⁣"></option><option value="map:put⁣"></option><option value="map:remove⁣"></option><option value="map:size⁣"></option><option value="math:acos⁣"></option><option value="math:asin⁣"></option><option value="math:atan⁣"></option><option value="math:atan2⁣"></option><option value="math:cos⁣"></option><option value="math:cosh⁣"></option><option value="math:e⁣"></option><option value="math:exp⁣"></option><option value="math:exp10⁣"></option><option value="math:log⁣"></option><option value="math:log10⁣"></option><option value="math:pi⁣"></option><option value="math:pow⁣"></option><option value="math:sin⁣"></option><option value="math:sinh⁣"></option><option value="math:sqrt⁣"></option><option value="math:tan⁣"></option><option value="math:tanh⁣"></option><option value="op:add-dayTimeDuration-to-date⁣"></option><option value="op:add-dayTimeDuration-to-dateTime⁣"></option><option value="op:add-dayTimeDuration-to-time⁣"></option><option value="op:add-dayTimeDurations⁣"></option><option value="op:add-yearMonthDuration-to-date⁣"></option><option value="op:add-yearMonthDuration-to-dateTime⁣"></option><option value="op:add-yearMonthDurations⁣"></option><option value="op:divide-dayTimeDuration⁣"></option><option value="op:divide-dayTimeDuration-by-dayTimeDuration⁣"></option><option value="op:divide-yearMonthDuration⁣"></option><option value="op:divide-yearMonthDuration-by-yearMonthDuration⁣"></option><option value="op:multiply-dayTimeDuration⁣"></option><option value="op:multiply-yearMonthDuration⁣"></option><option value="op:numeric-add⁣"></option><option value="op:numeric-divide⁣"></option><option value="op:numeric-integer-divide⁣"></option><option value="op:numeric-mod⁣"></option><option value="op:numeric-multiply⁣"></option><option value="op:numeric-subtract⁣"></option><option value="op:numeric-unary-minus⁣"></option><option value="op:numeric-unary-plus⁣"></option><option value="op:subtract-dates⁣"></option><option value="op:subtract-dateTimes⁣"></option><option value="op:subtract-dayTimeDuration-from-date⁣"></option><option value="op:subtract-dayTimeDuration-from-dateTime⁣"></option><option value="op:subtract-dayTimeDuration-from-time⁣"></option><option value="op:subtract-dayTimeDurations⁣"></option><option value="op:subtract-times⁣"></option><option value="op:subtract-yearMonthDuration-from-date⁣"></option><option value="op:subtract-yearMonthDuration-from-dateTime⁣"></option><option value="op:subtract-yearMonthDurations⁣"></option></datalist></span></div></div><h2><a id="contents"></a>Table of Contents<span class="expalltoc collapsed"> ▶</span></h2><ol class="toc"><li><details><summary><a href="#intro"><span class="secno">1 </span><span class="content toc-chg">Introduction</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#operators"><span class="secno">1.1 </span><span class="content">Operators</span></a></summary></details></li><li><details><summary><a href="#conformance"><span class="secno">1.2 </span><span class="content toc-chg">Conformance</span></a></summary></details></li><li><details><summary><a href="#namespace-prefixes"><span class="secno">1.3 </span><span class="content">Namespaces and prefixes</span></a></summary></details></li><li><details><summary><a href="#func-overloading"><span class="secno">1.4 </span><span class="content">Function overloading</span></a></summary></details></li><li><details><summary><a href="#func-signatures"><span class="secno">1.5 </span><span class="content">Function signatures and descriptions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#id-function-signatures-name"><span class="secno">1.5.1 </span><span class="content">Function name</span></a></summary></details></li><li><details><summary><a href="#id-function-signatures-summary"><span class="secno">1.5.2 </span><span class="content">Function summary</span></a></summary></details></li><li><details><summary><a href="#id-function-signatures-signature"><span class="secno">1.5.3 </span><span class="content">Function signature</span></a></summary></details></li><li><details><summary><a href="#id-function-signatures-rules"><span class="secno">1.5.4 </span><span class="content">Function rules</span></a></summary></details></li><li><details><summary><a href="#id-function-signatures-formal-specification"><span class="secno">1.5.5 </span><span class="content">Formal Equivalents</span></a></summary></details></li><li><details><summary><a href="#id-function-signatures-notes"><span class="secno">1.5.6 </span><span class="content">Notes</span></a></summary></details></li><li><details><summary><a href="#id-function-signatures-examples"><span class="secno">1.5.7 </span><span class="content">Examples</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#id-function-calls"><span class="secno">1.6 </span><span class="content">Function calls</span></a></summary></details></li><li><details><summary><a href="#options"><span class="secno">1.7 </span><span class="content toc-chg">Options</span></a></summary></details></li><li><details><summary><a href="#datatypes"><span class="secno">1.8 </span><span class="content">Type System</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#item-type-hierarchy"><span class="secno">1.8.1 </span><span class="content">Item Types</span></a></summary></details></li><li><details><summary><a href="#schema-type-hierarchy"><span class="secno">1.8.2 </span><span class="content">Schema Type Hierarchy</span></a></summary></details></li><li><details><summary><a href="#atomic-type-hierarchy"><span class="secno">1.8.3 </span><span class="content">Atomic Type Hierarchy</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#terminology"><span class="secno">1.9 </span><span class="content toc-chg">Terminology</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#atomic-terminology"><span class="secno">1.9.1 </span><span class="content">Atomic items</span></a></summary></details></li><li><details><summary><a href="#character-terminology"><span class="secno">1.9.2 </span><span class="content">Strings, characters, and codepoints</span></a></summary></details></li><li><details><summary><a href="#namespace-terminology"><span class="secno">1.9.3 </span><span class="content">Namespaces and URIs</span></a></summary></details></li><li><details><summary><a href="#conformance-terminology"><span class="secno">1.9.4 </span><span class="content">Conformance terminology</span></a></summary></details></li><li><details><summary><a href="#properties-of-functions"><span class="secno">1.9.5 </span><span class="content">Properties of functions</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#sequence-functions"><span class="secno">2 </span><span class="content">Processing sequences</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#general-seq-funcs"><span class="secno">2.1 </span><span class="content">General functions on sequences</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-empty"><span class="secno">2.1.1 </span><span class="content">fn:empty</span></a></summary></details></li><li><details><summary><a href="#func-exists"><span class="secno">2.1.2 </span><span class="content">fn:exists</span></a></summary></details></li><li><details><summary><a href="#func-foot"><span class="secno">2.1.3 </span><span class="content toc-new">fn:foot</span></a></summary></details></li><li><details><summary><a href="#func-head"><span class="secno">2.1.4 </span><span class="content">fn:head</span></a></summary></details></li><li><details><summary><a href="#func-identity"><span class="secno">2.1.5 </span><span class="content toc-new">fn:identity</span></a></summary></details></li><li><details><summary><a href="#func-insert-before"><span class="secno">2.1.6 </span><span class="content">fn:insert-before</span></a></summary></details></li><li><details><summary><a href="#func-insert-separator"><span class="secno">2.1.7 </span><span class="content toc-new">fn:insert-separator</span></a></summary></details></li><li><details><summary><a href="#func-items-at"><span class="secno">2.1.8 </span><span class="content toc-new">fn:items-at</span></a></summary></details></li><li><details><summary><a href="#func-remove"><span class="secno">2.1.9 </span><span class="content toc-chg">fn:remove</span></a></summary></details></li><li><details><summary><a href="#func-replicate"><span class="secno">2.1.10 </span><span class="content toc-new">fn:replicate</span></a></summary></details></li><li><details><summary><a href="#func-reverse"><span class="secno">2.1.11 </span><span class="content">fn:reverse</span></a></summary></details></li><li><details><summary><a href="#func-slice"><span class="secno">2.1.12 </span><span class="content toc-new">fn:slice</span></a></summary></details></li><li><details><summary><a href="#func-subsequence"><span class="secno">2.1.13 </span><span class="content toc-chg">fn:subsequence</span></a></summary></details></li><li><details><summary><a href="#func-tail"><span class="secno">2.1.14 </span><span class="content">fn:tail</span></a></summary></details></li><li><details><summary><a href="#func-trunk"><span class="secno">2.1.15 </span><span class="content toc-new">fn:trunk</span></a></summary></details></li><li><details><summary><a href="#func-unordered"><span class="secno">2.1.16 </span><span class="content">fn:unordered</span></a></summary></details></li><li><details><summary><a href="#func-void"><span class="secno">2.1.17 </span><span class="content toc-new">fn:void</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#comparing-sequences"><span class="secno">2.2 </span><span class="content">Comparison functions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-atomic-equal"><span class="secno">2.2.1 </span><span class="content toc-new">fn:atomic-equal</span></a></summary></details></li><li><details><summary><a href="#func-compare"><span class="secno">2.2.2 </span><span class="content toc-chg">fn:compare</span></a></summary></details></li><li><details><summary><a href="#func-contains-subsequence"><span class="secno">2.2.3 </span><span class="content toc-new">fn:contains-subsequence</span></a></summary></details></li><li><details><summary><a href="#func-deep-equal"><span class="secno">2.2.4 </span><span class="content toc-chg">fn:deep-equal</span></a></summary></details></li><li><details><summary><a href="#func-distinct-values"><span class="secno">2.2.5 </span><span class="content toc-chg">fn:distinct-values</span></a></summary></details></li><li><details><summary><a href="#func-duplicate-values"><span class="secno">2.2.6 </span><span class="content toc-new">fn:duplicate-values</span></a></summary></details></li><li><details><summary><a href="#func-ends-with-subsequence"><span class="secno">2.2.7 </span><span class="content toc-new">fn:ends-with-subsequence</span></a></summary></details></li><li><details><summary><a href="#func-index-of"><span class="secno">2.2.8 </span><span class="content toc-chg">fn:index-of</span></a></summary></details></li><li><details><summary><a href="#func-starts-with-subsequence"><span class="secno">2.2.9 </span><span class="content toc-new">fn:starts-with-subsequence</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#cardinality-functions"><span class="secno">2.3 </span><span class="content">Asserting cardinality</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-exactly-one"><span class="secno">2.3.1 </span><span class="content">fn:exactly-one</span></a></summary></details></li><li><details><summary><a href="#func-one-or-more"><span class="secno">2.3.2 </span><span class="content">fn:one-or-more</span></a></summary></details></li><li><details><summary><a href="#func-zero-or-one"><span class="secno">2.3.3 </span><span class="content">fn:zero-or-one</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#aggregate-functions"><span class="secno">2.4 </span><span class="content">Aggregate functions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-count"><span class="secno">2.4.1 </span><span class="content">fn:count</span></a></summary></details></li><li><details><summary><a href="#func-all-equal"><span class="secno">2.4.2 </span><span class="content toc-new">fn:all-equal</span></a></summary></details></li><li><details><summary><a href="#func-all-different"><span class="secno">2.4.3 </span><span class="content toc-new">fn:all-different</span></a></summary></details></li><li><details><summary><a href="#func-avg"><span class="secno">2.4.4 </span><span class="content toc-chg">fn:avg</span></a></summary></details></li><li><details><summary><a href="#func-max"><span class="secno">2.4.5 </span><span class="content toc-chg">fn:max</span></a></summary></details></li><li><details><summary><a href="#func-min"><span class="secno">2.4.6 </span><span class="content toc-chg">fn:min</span></a></summary></details></li><li><details><summary><a href="#func-sum"><span class="secno">2.4.7 </span><span class="content toc-chg">fn:sum</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#basic-hofs"><span class="secno">2.5 </span><span class="content">Basic higher-order functions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-apply"><span class="secno">2.5.1 </span><span class="content toc-chg">fn:apply</span></a></summary></details></li><li><details><summary><a href="#func-do-until"><span class="secno">2.5.2 </span><span class="content toc-new">fn:do-until</span></a></summary></details></li><li><details><summary><a href="#func-every"><span class="secno">2.5.3 </span><span class="content toc-new">fn:every</span></a></summary></details></li><li><details><summary><a href="#func-filter"><span class="secno">2.5.4 </span><span class="content toc-chg">fn:filter</span></a></summary></details></li><li><details><summary><a href="#func-fold-left"><span class="secno">2.5.5 </span><span class="content">fn:fold-left</span></a></summary></details></li><li><details><summary><a href="#func-fold-right"><span class="secno">2.5.6 </span><span class="content">fn:fold-right</span></a></summary></details></li><li><details><summary><a href="#func-for-each"><span class="secno">2.5.7 </span><span class="content toc-chg">fn:for-each</span></a></summary></details></li><li><details><summary><a href="#func-for-each-pair"><span class="secno">2.5.8 </span><span class="content toc-chg">fn:for-each-pair</span></a></summary></details></li><li><details><summary><a href="#func-highest"><span class="secno">2.5.9 </span><span class="content toc-new">fn:highest</span></a></summary></details></li><li><details><summary><a href="#func-index-where"><span class="secno">2.5.10 </span><span class="content toc-new">fn:index-where</span></a></summary></details></li><li><details><summary><a href="#func-lowest"><span class="secno">2.5.11 </span><span class="content toc-new">fn:lowest</span></a></summary></details></li><li><details><summary><a href="#func-partial-apply"><span class="secno">2.5.12 </span><span class="content toc-new">fn:partial-apply</span></a></summary></details></li><li><details><summary><a href="#func-partition"><span class="secno">2.5.13 </span><span class="content toc-new">fn:partition</span></a></summary></details></li><li><details><summary><a href="#func-scan-left"><span class="secno">2.5.14 </span><span class="content toc-new">fn:scan-left</span></a></summary></details></li><li><details><summary><a href="#func-scan-right"><span class="secno">2.5.15 </span><span class="content toc-new">fn:scan-right</span></a></summary></details></li><li><details><summary><a href="#func-some"><span class="secno">2.5.16 </span><span class="content toc-new">fn:some</span></a></summary></details></li><li><details><summary><a href="#func-sort"><span class="secno">2.5.17 </span><span class="content">fn:sort</span></a></summary></details></li><li><details><summary><a href="#func-sort-by"><span class="secno">2.5.18 </span><span class="content toc-new">fn:sort-by</span></a></summary></details></li><li><details><summary><a href="#func-sort-with"><span class="secno">2.5.19 </span><span class="content toc-new">fn:sort-with</span></a></summary></details></li><li><details><summary><a href="#func-subsequence-where"><span class="secno">2.5.20 </span><span class="content toc-new">fn:subsequence-where</span></a></summary></details></li><li><details><summary><a href="#func-take-while"><span class="secno">2.5.21 </span><span class="content toc-new">fn:take-while</span></a></summary></details></li><li><details><summary><a href="#func-transitive-closure"><span class="secno">2.5.22 </span><span class="content toc-new">fn:transitive-closure</span></a></summary></details></li><li><details><summary><a href="#func-while-do"><span class="secno">2.5.23 </span><span class="content toc-new">fn:while-do</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#boolean-functions"><span class="secno">3 </span><span class="content">Processing booleans</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#boolean-constructors"><span class="secno">3.1 </span><span class="content">Boolean constant functions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-true"><span class="secno">3.1.1 </span><span class="content">fn:true</span></a></summary></details></li><li><details><summary><a href="#func-false"><span class="secno">3.1.2 </span><span class="content">fn:false</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#boolean-value-functions"><span class="secno">3.2 </span><span class="content">Functions on Boolean values</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-boolean"><span class="secno">3.2.1 </span><span class="content">fn:boolean</span></a></summary></details></li><li><details><summary><a href="#func-not"><span class="secno">3.2.2 </span><span class="content">fn:not</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#numeric-functions"><span class="secno">4 </span><span class="content">Processing numerics</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#numeric-types"><span class="secno">4.1 </span><span class="content">Numeric types</span></a></summary></details></li><li><details><summary><a href="#op.numeric"><span class="secno">4.2 </span><span class="content">Arithmetic operators on numeric values</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-numeric-add"><span class="secno">4.2.1 </span><span class="content">op:numeric-add</span></a></summary></details></li><li><details><summary><a href="#func-numeric-subtract"><span class="secno">4.2.2 </span><span class="content">op:numeric-subtract</span></a></summary></details></li><li><details><summary><a href="#func-numeric-multiply"><span class="secno">4.2.3 </span><span class="content">op:numeric-multiply</span></a></summary></details></li><li><details><summary><a href="#func-numeric-divide"><span class="secno">4.2.4 </span><span class="content">op:numeric-divide</span></a></summary></details></li><li><details><summary><a href="#func-numeric-integer-divide"><span class="secno">4.2.5 </span><span class="content">op:numeric-integer-divide</span></a></summary></details></li><li><details><summary><a href="#func-numeric-mod"><span class="secno">4.2.6 </span><span class="content">op:numeric-mod</span></a></summary></details></li><li><details><summary><a href="#func-numeric-unary-plus"><span class="secno">4.2.7 </span><span class="content">op:numeric-unary-plus</span></a></summary></details></li><li><details><summary><a href="#func-numeric-unary-minus"><span class="secno">4.2.8 </span><span class="content">op:numeric-unary-minus</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#comp.numeric"><span class="secno">4.3 </span><span class="content toc-chg">Comparing numeric values</span></a></summary></details></li><li><details><summary><a href="#numeric-value-functions"><span class="secno">4.4 </span><span class="content">Functions on numeric values</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-abs"><span class="secno">4.4.1 </span><span class="content">fn:abs</span></a></summary></details></li><li><details><summary><a href="#func-ceiling"><span class="secno">4.4.2 </span><span class="content">fn:ceiling</span></a></summary></details></li><li><details><summary><a href="#func-divide-decimals"><span class="secno">4.4.3 </span><span class="content toc-new">fn:divide-decimals</span></a></summary></details></li><li><details><summary><a href="#func-floor"><span class="secno">4.4.4 </span><span class="content">fn:floor</span></a></summary></details></li><li><details><summary><a href="#func-is-NaN"><span class="secno">4.4.5 </span><span class="content toc-new">fn:is-NaN</span></a></summary></details></li><li><details><summary><a href="#func-round"><span class="secno">4.4.6 </span><span class="content toc-chg">fn:round</span></a></summary></details></li><li><details><summary><a href="#func-round-half-to-even"><span class="secno">4.4.7 </span><span class="content toc-chg">fn:round-half-to-even</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#parsing-numbers"><span class="secno">4.5 </span><span class="content">Parsing numbers</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-number"><span class="secno">4.5.1 </span><span class="content">fn:number</span></a></summary></details></li><li><details><summary><a href="#func-parse-integer"><span class="secno">4.5.2 </span><span class="content toc-new">fn:parse-integer</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#formatting-integers"><span class="secno">4.6 </span><span class="content">Formatting integers</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-format-integer"><span class="secno">4.6.1 </span><span class="content toc-chg">fn:format-integer</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#formatting-numbers"><span class="secno">4.7 </span><span class="content">Formatting numbers</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#defining-decimal-format"><span class="secno">4.7.1 </span><span class="content">Defining a decimal format</span></a></summary></details></li><li><details><summary><a href="#func-format-number"><span class="secno">4.7.2 </span><span class="content toc-chg">fn:format-number</span></a></summary></details></li><li><details><summary><a href="#syntax-of-picture-string"><span class="secno">4.7.3 </span><span class="content">Syntax of the picture string</span></a></summary></details></li><li><details><summary><a href="#analyzing-picture-string"><span class="secno">4.7.4 </span><span class="content">Analyzing the picture string</span></a></summary></details></li><li><details><summary><a href="#formatting-the-number"><span class="secno">4.7.5 </span><span class="content">Formatting the number</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#trigonometry"><span class="secno">4.8 </span><span class="content">Trigonometric and exponential functions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-math-pi"><span class="secno">4.8.1 </span><span class="content">math:pi</span></a></summary></details></li><li><details><summary><a href="#func-math-e"><span class="secno">4.8.2 </span><span class="content toc-new">math:e</span></a></summary></details></li><li><details><summary><a href="#func-math-acos"><span class="secno">4.8.3 </span><span class="content">math:acos</span></a></summary></details></li><li><details><summary><a href="#func-math-asin"><span class="secno">4.8.4 </span><span class="content">math:asin</span></a></summary></details></li><li><details><summary><a href="#func-math-atan"><span class="secno">4.8.5 </span><span class="content">math:atan</span></a></summary></details></li><li><details><summary><a href="#func-math-atan2"><span class="secno">4.8.6 </span><span class="content">math:atan2</span></a></summary></details></li><li><details><summary><a href="#func-math-cos"><span class="secno">4.8.7 </span><span class="content">math:cos</span></a></summary></details></li><li><details><summary><a href="#func-math-cosh"><span class="secno">4.8.8 </span><span class="content toc-new">math:cosh</span></a></summary></details></li><li><details><summary><a href="#func-math-exp"><span class="secno">4.8.9 </span><span class="content">math:exp</span></a></summary></details></li><li><details><summary><a href="#func-math-exp10"><span class="secno">4.8.10 </span><span class="content">math:exp10</span></a></summary></details></li><li><details><summary><a href="#func-math-log"><span class="secno">4.8.11 </span><span class="content">math:log</span></a></summary></details></li><li><details><summary><a href="#func-math-log10"><span class="secno">4.8.12 </span><span class="content">math:log10</span></a></summary></details></li><li><details><summary><a href="#func-math-pow"><span class="secno">4.8.13 </span><span class="content">math:pow</span></a></summary></details></li><li><details><summary><a href="#func-math-sin"><span class="secno">4.8.14 </span><span class="content">math:sin</span></a></summary></details></li><li><details><summary><a href="#func-math-sinh"><span class="secno">4.8.15 </span><span class="content toc-new">math:sinh</span></a></summary></details></li><li><details><summary><a href="#func-math-sqrt"><span class="secno">4.8.16 </span><span class="content">math:sqrt</span></a></summary></details></li><li><details><summary><a href="#func-math-tan"><span class="secno">4.8.17 </span><span class="content">math:tan</span></a></summary></details></li><li><details><summary><a href="#func-math-tanh"><span class="secno">4.8.18 </span><span class="content toc-new">math:tanh</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#random-numbers"><span class="secno">4.9 </span><span class="content">Random Numbers</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#random-number-generator-record"><span class="secno">4.9.1 </span><span class="content">Record fn:random-number-generator-record</span></a></summary></details></li><li><details><summary><a href="#func-random-number-generator"><span class="secno">4.9.2 </span><span class="content toc-chg">fn:random-number-generator</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#string-functions"><span class="secno">5 </span><span class="content">Processing strings</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#string-types"><span class="secno">5.1 </span><span class="content">String types</span></a></summary></details></li><li><details><summary><a href="#func-assemble-disassemble-string"><span class="secno">5.2 </span><span class="content">Functions to assemble and disassemble strings</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-codepoints-to-string"><span class="secno">5.2.1 </span><span class="content toc-chg">fn:codepoints-to-string</span></a></summary></details></li><li><details><summary><a href="#func-string-to-codepoints"><span class="secno">5.2.2 </span><span class="content">fn:string-to-codepoints</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#string-compare"><span class="secno">5.3 </span><span class="content">Comparison of strings</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#collations"><span class="secno">5.3.1 </span><span class="content">Collations</span></a></summary></details></li><li><details><summary><a href="#collation-capabilities"><span class="secno">5.3.2 </span><span class="content">Collation Capabilities</span></a></summary></details></li><li><details><summary><a href="#codepoint-collation"><span class="secno">5.3.3 </span><span class="content">The Unicode Codepoint Collation</span></a></summary></details></li><li><details><summary><a href="#uca-collations"><span class="secno">5.3.4 </span><span class="content">The Unicode Collation Algorithm</span></a></summary></details></li><li><details><summary><a href="#unicode-case-insensitive-collation"><span class="secno">5.3.5 </span><span class="content toc-chg">The Unicode case-insensitive collation</span></a></summary></details></li><li><details><summary><a href="#html-ascii-case-insensitive-collation"><span class="secno">5.3.6 </span><span class="content toc-chg">The HTML ASCII Case-Insensitive Collation</span></a></summary></details></li><li><details><summary><a href="#choosing-a-collation"><span class="secno">5.3.7 </span><span class="content">Choosing a collation</span></a></summary></details></li><li><details><summary><a href="#func-codepoint-equal"><span class="secno">5.3.8 </span><span class="content">fn:codepoint-equal</span></a></summary></details></li><li><details><summary><a href="#func-collation"><span class="secno">5.3.9 </span><span class="content toc-new">fn:collation</span></a></summary></details></li><li><details><summary><a href="#func-collation-available"><span class="secno">5.3.10 </span><span class="content toc-new">fn:collation-available</span></a></summary></details></li><li><details><summary><a href="#func-collation-key"><span class="secno">5.3.11 </span><span class="content">fn:collation-key</span></a></summary></details></li><li><details><summary><a href="#func-contains-token"><span class="secno">5.3.12 </span><span class="content">fn:contains-token</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#string-value-functions"><span class="secno">5.4 </span><span class="content">Functions on string values</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-char"><span class="secno">5.4.1 </span><span class="content toc-new">fn:char</span></a></summary></details></li><li><details><summary><a href="#func-characters"><span class="secno">5.4.2 </span><span class="content toc-new">fn:characters</span></a></summary></details></li><li><details><summary><a href="#func-graphemes"><span class="secno">5.4.3 </span><span class="content toc-new">fn:graphemes</span></a></summary></details></li><li><details><summary><a href="#func-concat"><span class="secno">5.4.4 </span><span class="content toc-chg">fn:concat</span></a></summary></details></li><li><details><summary><a href="#func-string-join"><span class="secno">5.4.5 </span><span class="content">fn:string-join</span></a></summary></details></li><li><details><summary><a href="#func-substring"><span class="secno">5.4.6 </span><span class="content toc-chg">fn:substring</span></a></summary></details></li><li><details><summary><a href="#func-string-length"><span class="secno">5.4.7 </span><span class="content toc-chg">fn:string-length</span></a></summary></details></li><li><details><summary><a href="#func-normalize-space"><span class="secno">5.4.8 </span><span class="content toc-chg">fn:normalize-space</span></a></summary></details></li><li><details><summary><a href="#func-normalize-unicode"><span class="secno">5.4.9 </span><span class="content">fn:normalize-unicode</span></a></summary></details></li><li><details><summary><a href="#func-upper-case"><span class="secno">5.4.10 </span><span class="content">fn:upper-case</span></a></summary></details></li><li><details><summary><a href="#func-lower-case"><span class="secno">5.4.11 </span><span class="content">fn:lower-case</span></a></summary></details></li><li><details><summary><a href="#func-translate"><span class="secno">5.4.12 </span><span class="content">fn:translate</span></a></summary></details></li><li><details><summary><a href="#func-hash"><span class="secno">5.4.13 </span><span class="content toc-new">fn:hash</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#substring.functions"><span class="secno">5.5 </span><span class="content">Functions based on substring matching</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-contains"><span class="secno">5.5.1 </span><span class="content">fn:contains</span></a></summary></details></li><li><details><summary><a href="#func-starts-with"><span class="secno">5.5.2 </span><span class="content">fn:starts-with</span></a></summary></details></li><li><details><summary><a href="#func-ends-with"><span class="secno">5.5.3 </span><span class="content">fn:ends-with</span></a></summary></details></li><li><details><summary><a href="#func-substring-before"><span class="secno">5.5.4 </span><span class="content">fn:substring-before</span></a></summary></details></li><li><details><summary><a href="#func-substring-after"><span class="secno">5.5.5 </span><span class="content">fn:substring-after</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#string.match"><span class="secno">6 </span><span class="content">Regular expressions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#regex-syntax"><span class="secno">6.1 </span><span class="content toc-chg">Regular expression syntax</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#id-regex-processing-model"><span class="secno">6.1.1 </span><span class="content">Processing model for regular expressions</span></a></summary></details></li><li><details><summary><a href="#regex-comments"><span class="secno">6.1.2 </span><span class="content">Comments</span></a></summary></details></li><li><details><summary><a href="#id-regex-grammar"><span class="secno">6.1.3 </span><span class="content">Regular expression grammar</span></a></summary></details></li><li><details><summary><a href="#reluctant-quantifiers"><span class="secno">6.1.4 </span><span class="content">Reluctant quantifiers</span></a></summary></details></li><li><details><summary><a href="#captured-subexpressions"><span class="secno">6.1.5 </span><span class="content">Captured groups</span></a></summary></details></li><li><details><summary><a href="#back-references"><span class="secno">6.1.6 </span><span class="content">Back-references</span></a></summary></details></li><li><details><summary><a href="#unicode-block-names"><span class="secno">6.1.7 </span><span class="content">Unicode block names</span></a></summary></details></li><li><details><summary><a href="#id-assertions"><span class="secno">6.1.8 </span><span class="content">Assertions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#matching-start-and-end"><span class="secno">6.1.8.1 </span><span class="content">Matching the Start and End of the String</span></a></summary></details></li><li><details><summary><a href="#regex-boundary-assertions"><span class="secno">6.1.8.2 </span><span class="content">Boundary assertions</span></a></summary></details></li><li><details><summary><a href="#regex-positive-lookahead"><span class="secno">6.1.8.3 </span><span class="content">Positive Lookahead Assertions</span></a></summary></details></li><li><details><summary><a href="#regex-negative-lookahead-assertion"><span class="secno">6.1.8.4 </span><span class="content">Negative Lookahead Assertion</span></a></summary></details></li><li><details><summary><a href="#regex-positive-lookbehind"><span class="secno">6.1.8.5 </span><span class="content">Positive Lookbehind Assertions</span></a></summary></details></li><li><details><summary><a href="#regex-negative-lookbehind"><span class="secno">6.1.8.6 </span><span class="content">Negative Lookbehind Assertion</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#flags"><span class="secno">6.2 </span><span class="content toc-chg">Flags</span></a></summary></details></li><li><details><summary><a href="#regex-functions"><span class="secno">6.3 </span><span class="content">Functions using regular expressions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-matches"><span class="secno">6.3.1 </span><span class="content">fn:matches</span></a></summary></details></li><li><details><summary><a href="#func-replace"><span class="secno">6.3.2 </span><span class="content toc-chg">fn:replace</span></a></summary></details></li><li><details><summary><a href="#func-tokenize"><span class="secno">6.3.3 </span><span class="content toc-chg">fn:tokenize</span></a></summary></details></li><li><details><summary><a href="#func-analyze-string"><span class="secno">6.3.4 </span><span class="content toc-chg">fn:analyze-string</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#anyURI-functions"><span class="secno">7 </span><span class="content">Processing URIs</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-decode-from-uri"><span class="secno">7.1 </span><span class="content toc-new">fn:decode-from-uri</span></a></summary></details></li><li><details><summary><a href="#func-encode-for-uri"><span class="secno">7.2 </span><span class="content">fn:encode-for-uri</span></a></summary></details></li><li><details><summary><a href="#func-escape-html-uri"><span class="secno">7.3 </span><span class="content">fn:escape-html-uri</span></a></summary></details></li><li><details><summary><a href="#func-iri-to-uri"><span class="secno">7.4 </span><span class="content">fn:iri-to-uri</span></a></summary></details></li><li><details><summary><a href="#func-resolve-uri"><span class="secno">7.5 </span><span class="content toc-chg">fn:resolve-uri</span></a></summary></details></li><li><details><summary><a href="#parse-build"><span class="secno">7.6 </span><span class="content">Parsing and building URIs</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#uri-structure-record"><span class="secno">7.6.1 </span><span class="content">Record fn:uri-structure-record</span></a></summary></details></li><li><details><summary><a href="#func-parse-uri"><span class="secno">7.6.2 </span><span class="content toc-new">fn:parse-uri</span></a></summary></details></li><li><details><summary><a href="#func-build-uri"><span class="secno">7.6.3 </span><span class="content toc-new">fn:build-uri</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#durations"><span class="secno">8 </span><span class="content">Processing durations</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#duration-data-types"><span class="secno">8.1 </span><span class="content">Duration data types</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#duration-subtypes"><span class="secno">8.1.1 </span><span class="content">Subtypes of duration</span></a></summary></details></li><li><details><summary><a href="#duration-conformance"><span class="secno">8.1.2 </span><span class="content toc-chg">Limits and precision</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#comp.duration"><span class="secno">8.2 </span><span class="content">Comparing durations</span></a></summary></details></li><li><details><summary><a href="#component-extraction-durations"><span class="secno">8.3 </span><span class="content">Extracting components of durations</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-years-from-duration"><span class="secno">8.3.1 </span><span class="content">fn:years-from-duration</span></a></summary></details></li><li><details><summary><a href="#func-months-from-duration"><span class="secno">8.3.2 </span><span class="content">fn:months-from-duration</span></a></summary></details></li><li><details><summary><a href="#func-days-from-duration"><span class="secno">8.3.3 </span><span class="content">fn:days-from-duration</span></a></summary></details></li><li><details><summary><a href="#func-hours-from-duration"><span class="secno">8.3.4 </span><span class="content">fn:hours-from-duration</span></a></summary></details></li><li><details><summary><a href="#func-minutes-from-duration"><span class="secno">8.3.5 </span><span class="content">fn:minutes-from-duration</span></a></summary></details></li><li><details><summary><a href="#func-seconds-from-duration"><span class="secno">8.3.6 </span><span class="content">fn:seconds-from-duration</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#duration-construction"><span class="secno">8.4 </span><span class="content">Constructing durations</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-seconds"><span class="secno">8.4.1 </span><span class="content toc-new">fn:seconds</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#duration-arithmetic"><span class="secno">8.5 </span><span class="content">Arithmetic operators on durations</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-add-yearMonthDurations"><span class="secno">8.5.1 </span><span class="content">op:add-yearMonthDurations</span></a></summary></details></li><li><details><summary><a href="#func-subtract-yearMonthDurations"><span class="secno">8.5.2 </span><span class="content">op:subtract-yearMonthDurations</span></a></summary></details></li><li><details><summary><a href="#func-multiply-yearMonthDuration"><span class="secno">8.5.3 </span><span class="content">op:multiply-yearMonthDuration</span></a></summary></details></li><li><details><summary><a href="#func-divide-yearMonthDuration"><span class="secno">8.5.4 </span><span class="content">op:divide-yearMonthDuration</span></a></summary></details></li><li><details><summary><a href="#func-divide-yearMonthDuration-by-yearMonthDuration"><span class="secno">8.5.5 </span><span class="content">op:divide-yearMonthDuration-by-yearMonthDuration</span></a></summary></details></li><li><details><summary><a href="#func-add-dayTimeDurations"><span class="secno">8.5.6 </span><span class="content">op:add-dayTimeDurations</span></a></summary></details></li><li><details><summary><a href="#func-subtract-dayTimeDurations"><span class="secno">8.5.7 </span><span class="content">op:subtract-dayTimeDurations</span></a></summary></details></li><li><details><summary><a href="#func-multiply-dayTimeDuration"><span class="secno">8.5.8 </span><span class="content">op:multiply-dayTimeDuration</span></a></summary></details></li><li><details><summary><a href="#func-divide-dayTimeDuration"><span class="secno">8.5.9 </span><span class="content">op:divide-dayTimeDuration</span></a></summary></details></li><li><details><summary><a href="#func-divide-dayTimeDuration-by-dayTimeDuration"><span class="secno">8.5.10 </span><span class="content">op:divide-dayTimeDuration-by-dayTimeDuration</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#dates-times"><span class="secno">9 </span><span class="content">Processing dates and times</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#date-time-types"><span class="secno">9.1 </span><span class="content">Date and time types</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#date-time-duration-conformance"><span class="secno">9.1.1 </span><span class="content">Limits and precision</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#date-time-values"><span class="secno">9.2 </span><span class="content">Date/time datatype values</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#date-time-lexical-mapping"><span class="secno">9.2.1 </span><span class="content">Examples</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#dateTime-record"><span class="secno">9.3 </span><span class="content">Record fn:dateTime-record</span></a></summary></details></li><li><details><summary><a href="#constructing-dateTime"><span class="secno">9.4 </span><span class="content">Constructing a dateTime</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-dateTime"><span class="secno">9.4.1 </span><span class="content">fn:dateTime</span></a></summary></details></li><li><details><summary><a href="#func-build-dateTime"><span class="secno">9.4.2 </span><span class="content toc-new">fn:build-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-unix-dateTime"><span class="secno">9.4.3 </span><span class="content toc-new">fn:unix-dateTime</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#comp.datetime"><span class="secno">9.5 </span><span class="content">Comparing date and time values</span></a></summary></details></li><li><details><summary><a href="#component-extraction-dateTime"><span class="secno">9.6 </span><span class="content">Extracting components of dates and times</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-year-from-dateTime"><span class="secno">9.6.1 </span><span class="content toc-chg">fn:year-from-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-month-from-dateTime"><span class="secno">9.6.2 </span><span class="content toc-chg">fn:month-from-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-day-from-dateTime"><span class="secno">9.6.3 </span><span class="content toc-chg">fn:day-from-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-hours-from-dateTime"><span class="secno">9.6.4 </span><span class="content toc-chg">fn:hours-from-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-minutes-from-dateTime"><span class="secno">9.6.5 </span><span class="content toc-chg">fn:minutes-from-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-seconds-from-dateTime"><span class="secno">9.6.6 </span><span class="content">fn:seconds-from-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-timezone-from-dateTime"><span class="secno">9.6.7 </span><span class="content toc-chg">fn:timezone-from-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-year-from-date"><span class="secno">9.6.8 </span><span class="content">fn:year-from-date</span></a></summary></details></li><li><details><summary><a href="#func-month-from-date"><span class="secno">9.6.9 </span><span class="content">fn:month-from-date</span></a></summary></details></li><li><details><summary><a href="#func-day-from-date"><span class="secno">9.6.10 </span><span class="content">fn:day-from-date</span></a></summary></details></li><li><details><summary><a href="#func-timezone-from-date"><span class="secno">9.6.11 </span><span class="content">fn:timezone-from-date</span></a></summary></details></li><li><details><summary><a href="#func-hours-from-time"><span class="secno">9.6.12 </span><span class="content">fn:hours-from-time</span></a></summary></details></li><li><details><summary><a href="#func-minutes-from-time"><span class="secno">9.6.13 </span><span class="content">fn:minutes-from-time</span></a></summary></details></li><li><details><summary><a href="#func-seconds-from-time"><span class="secno">9.6.14 </span><span class="content">fn:seconds-from-time</span></a></summary></details></li><li><details><summary><a href="#func-timezone-from-time"><span class="secno">9.6.15 </span><span class="content">fn:timezone-from-time</span></a></summary></details></li><li><details><summary><a href="#func-parts-of-dateTime"><span class="secno">9.6.16 </span><span class="content toc-new">fn:parts-of-dateTime</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#timezone.functions"><span class="secno">9.7 </span><span class="content">Adjusting timezones on dates and times</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-adjust-dateTime-to-timezone"><span class="secno">9.7.1 </span><span class="content">fn:adjust-dateTime-to-timezone</span></a></summary></details></li><li><details><summary><a href="#func-adjust-date-to-timezone"><span class="secno">9.7.2 </span><span class="content">fn:adjust-date-to-timezone</span></a></summary></details></li><li><details><summary><a href="#func-adjust-time-to-timezone"><span class="secno">9.7.3 </span><span class="content">fn:adjust-time-to-timezone</span></a></summary></details></li><li><details><summary><a href="#func-civil-timezone"><span class="secno">9.7.4 </span><span class="content toc-new">fn:civil-timezone</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#dateTime-arithmetic"><span class="secno">9.8 </span><span class="content">Arithmetic operators on durations, dates, and times</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#duration-limits"><span class="secno">9.8.1 </span><span class="content">Limits and precision</span></a></summary></details></li><li><details><summary><a href="#func-subtract-dateTimes"><span class="secno">9.8.2 </span><span class="content">op:subtract-dateTimes</span></a></summary></details></li><li><details><summary><a href="#func-subtract-dates"><span class="secno">9.8.3 </span><span class="content">op:subtract-dates</span></a></summary></details></li><li><details><summary><a href="#func-subtract-times"><span class="secno">9.8.4 </span><span class="content">op:subtract-times</span></a></summary></details></li><li><details><summary><a href="#func-add-yearMonthDuration-to-dateTime"><span class="secno">9.8.5 </span><span class="content">op:add-yearMonthDuration-to-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-add-dayTimeDuration-to-dateTime"><span class="secno">9.8.6 </span><span class="content">op:add-dayTimeDuration-to-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-subtract-yearMonthDuration-from-dateTime"><span class="secno">9.8.7 </span><span class="content">op:subtract-yearMonthDuration-from-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-subtract-dayTimeDuration-from-dateTime"><span class="secno">9.8.8 </span><span class="content">op:subtract-dayTimeDuration-from-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-add-yearMonthDuration-to-date"><span class="secno">9.8.9 </span><span class="content">op:add-yearMonthDuration-to-date</span></a></summary></details></li><li><details><summary><a href="#func-add-dayTimeDuration-to-date"><span class="secno">9.8.10 </span><span class="content">op:add-dayTimeDuration-to-date</span></a></summary></details></li><li><details><summary><a href="#func-subtract-yearMonthDuration-from-date"><span class="secno">9.8.11 </span><span class="content">op:subtract-yearMonthDuration-from-date</span></a></summary></details></li><li><details><summary><a href="#func-subtract-dayTimeDuration-from-date"><span class="secno">9.8.12 </span><span class="content">op:subtract-dayTimeDuration-from-date</span></a></summary></details></li><li><details><summary><a href="#func-add-dayTimeDuration-to-time"><span class="secno">9.8.13 </span><span class="content">op:add-dayTimeDuration-to-time</span></a></summary></details></li><li><details><summary><a href="#func-subtract-dayTimeDuration-from-time"><span class="secno">9.8.14 </span><span class="content">op:subtract-dayTimeDuration-from-time</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#formatting-dates-and-times"><span class="secno">9.9 </span><span class="content">Formatting dates and times</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-format-dateTime"><span class="secno">9.9.1 </span><span class="content toc-chg">fn:format-dateTime</span></a></summary></details></li><li><details><summary><a href="#func-format-date"><span class="secno">9.9.2 </span><span class="content toc-chg">fn:format-date</span></a></summary></details></li><li><details><summary><a href="#func-format-time"><span class="secno">9.9.3 </span><span class="content toc-chg">fn:format-time</span></a></summary></details></li><li><details><summary><a href="#rules-for-datetime-formatting"><span class="secno">9.9.4 </span><span class="content">The date/time formatting functions</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#date-picture-string"><span class="secno">9.9.4.1 </span><span class="content">The picture string</span></a></summary></details></li><li><details><summary><a href="#width-modifier"><span class="secno">9.9.4.2 </span><span class="content">The Width Modifier</span></a></summary></details></li><li><details><summary><a href="#formatting-integer-valued-components"><span class="secno">9.9.4.3 </span><span class="content">Formatting Integer-Valued Date/Time Components</span></a></summary></details></li><li><details><summary><a href="#formatting-year-component"><span class="secno">9.9.4.4 </span><span class="content">Formatting the Year Component</span></a></summary></details></li><li><details><summary><a href="#formatting-fractional-seconds"><span class="secno">9.9.4.5 </span><span class="content">Formatting Fractional Seconds</span></a></summary></details></li><li><details><summary><a href="#formatting-timezones"><span class="secno">9.9.4.6 </span><span class="content">Formatting timezones</span></a></summary></details></li><li><details><summary><a href="#formatting-other-components"><span class="secno">9.9.4.7 </span><span class="content">Formatting Other Components</span></a></summary></details></li><li><details><summary><a href="#lang-cal-place"><span class="secno">9.9.4.8 </span><span class="content">The language, calendar, and place arguments</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#date-time-examples"><span class="secno">9.9.5 </span><span class="content">Examples of date and time formatting</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#parsing-dates-and-times"><span class="secno">9.10 </span><span class="content">Parsing dates and times</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-parse-ietf-date"><span class="secno">9.10.1 </span><span class="content">fn:parse-ietf-date</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#QName-funcs"><span class="secno">10 </span><span class="content">Processing QNames and NOTATIONS</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#QName-constructors"><span class="secno">10.1 </span><span class="content">Functions to create a QName</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-QName"><span class="secno">10.1.1 </span><span class="content">fn:QName</span></a></summary></details></li><li><details><summary><a href="#func-parse-QName"><span class="secno">10.1.2 </span><span class="content toc-new">fn:parse-QName</span></a></summary></details></li><li><details><summary><a href="#func-resolve-QName"><span class="secno">10.1.3 </span><span class="content">fn:resolve-QName</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#QName-functions"><span class="secno">10.2 </span><span class="content">Functions and operators on QNames</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-prefix-from-QName"><span class="secno">10.2.1 </span><span class="content">fn:prefix-from-QName</span></a></summary></details></li><li><details><summary><a href="#func-local-name-from-QName"><span class="secno">10.2.2 </span><span class="content">fn:local-name-from-QName</span></a></summary></details></li><li><details><summary><a href="#func-namespace-uri-from-QName"><span class="secno">10.2.3 </span><span class="content">fn:namespace-uri-from-QName</span></a></summary></details></li><li><details><summary><a href="#func-expanded-QName"><span class="secno">10.2.4 </span><span class="content toc-new">fn:expanded-QName</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#NOTATION-functions"><span class="secno">10.3 </span><span class="content">Processing NOTATIONs</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#binary-functions"><span class="secno">11 </span><span class="content">Processing binary values</span></a></summary></details></li><li><details><summary><a href="#node-functions"><span class="secno">12 </span><span class="content">Processing nodes</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#accessors"><span class="secno">12.1 </span><span class="content">Accessors</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-base-uri"><span class="secno">12.1.1 </span><span class="content toc-chg">fn:base-uri</span></a></summary></details></li><li><details><summary><a href="#func-document-uri"><span class="secno">12.1.2 </span><span class="content toc-chg">fn:document-uri</span></a></summary></details></li><li><details><summary><a href="#func-nilled"><span class="secno">12.1.3 </span><span class="content">fn:nilled</span></a></summary></details></li><li><details><summary><a href="#func-node-name"><span class="secno">12.1.4 </span><span class="content">fn:node-name</span></a></summary></details></li><li><details><summary><a href="#func-string"><span class="secno">12.1.5 </span><span class="content">fn:string</span></a></summary></details></li><li><details><summary><a href="#func-data"><span class="secno">12.1.6 </span><span class="content">fn:data</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#other-node-functions"><span class="secno">12.2 </span><span class="content">Other properties of nodes</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-has-children"><span class="secno">12.2.1 </span><span class="content toc-chg">fn:has-children</span></a></summary></details></li><li><details><summary><a href="#func-in-scope-namespaces"><span class="secno">12.2.2 </span><span class="content toc-new">fn:in-scope-namespaces</span></a></summary></details></li><li><details><summary><a href="#func-in-scope-prefixes"><span class="secno">12.2.3 </span><span class="content">fn:in-scope-prefixes</span></a></summary></details></li><li><details><summary><a href="#func-lang"><span class="secno">12.2.4 </span><span class="content">fn:lang</span></a></summary></details></li><li><details><summary><a href="#func-local-name"><span class="secno">12.2.5 </span><span class="content">fn:local-name</span></a></summary></details></li><li><details><summary><a href="#func-name"><span class="secno">12.2.6 </span><span class="content">fn:name</span></a></summary></details></li><li><details><summary><a href="#func-namespace-uri"><span class="secno">12.2.7 </span><span class="content">fn:namespace-uri</span></a></summary></details></li><li><details><summary><a href="#func-namespace-uri-for-prefix"><span class="secno">12.2.8 </span><span class="content">fn:namespace-uri-for-prefix</span></a></summary></details></li><li><details><summary><a href="#func-path"><span class="secno">12.2.9 </span><span class="content toc-chg">fn:path</span></a></summary></details></li><li><details><summary><a href="#func-root"><span class="secno">12.2.10 </span><span class="content">fn:root</span></a></summary></details></li><li><details><summary><a href="#func-siblings"><span class="secno">12.2.11 </span><span class="content toc-new">fn:siblings</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#functions-on-node-sequences"><span class="secno">12.3 </span><span class="content">Functions on sequences of nodes</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-distinct-ordered-nodes"><span class="secno">12.3.1 </span><span class="content toc-new">fn:distinct-ordered-nodes</span></a></summary></details></li><li><details><summary><a href="#func-innermost"><span class="secno">12.3.2 </span><span class="content toc-chg">fn:innermost</span></a></summary></details></li><li><details><summary><a href="#func-outermost"><span class="secno">12.3.3 </span><span class="content toc-chg">fn:outermost</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#fns-on-identifiers"><span class="secno">12.4 </span><span class="content">Identifying nodes</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-id"><span class="secno">12.4.1 </span><span class="content">fn:id</span></a></summary></details></li><li><details><summary><a href="#func-element-with-id"><span class="secno">12.4.2 </span><span class="content">fn:element-with-id</span></a></summary></details></li><li><details><summary><a href="#func-idref"><span class="secno">12.4.3 </span><span class="content">fn:idref</span></a></summary></details></li><li><details><summary><a href="#func-generate-id"><span class="secno">12.4.4 </span><span class="content">fn:generate-id</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#functions-on-functions"><span class="secno">13 </span><span class="content">Processing function items</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-function-lookup"><span class="secno">13.1 </span><span class="content">fn:function-lookup</span></a></summary></details></li><li><details><summary><a href="#func-function-name"><span class="secno">13.2 </span><span class="content">fn:function-name</span></a></summary></details></li><li><details><summary><a href="#func-function-arity"><span class="secno">13.3 </span><span class="content">fn:function-arity</span></a></summary></details></li><li><details><summary><a href="#func-function-identity"><span class="secno">13.4 </span><span class="content toc-new">fn:function-identity</span></a></summary></details></li><li><details><summary><a href="#func-function-annotations"><span class="secno">13.5 </span><span class="content toc-new">fn:function-annotations</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#maps"><span class="secno">14 </span><span class="content">Processing maps</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#map-ordering"><span class="secno">14.1 </span><span class="content toc-chg">Ordering of Maps</span></a></summary></details></li><li><details><summary><a href="#map-composition-decomposition"><span class="secno">14.2 </span><span class="content">Composing and Decomposing Maps</span></a></summary></details></li><li><details><summary><a href="#formal-specification-of-maps"><span class="secno">14.3 </span><span class="content">Formal specification of maps</span></a></summary></details></li><li><details><summary><a href="#map-functions"><span class="secno">14.4 </span><span class="content">Functions that operate on maps</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-map-build"><span class="secno">14.4.1 </span><span class="content toc-new">map:build</span></a></summary></details></li><li><details><summary><a href="#func-map-contains"><span class="secno">14.4.2 </span><span class="content">map:contains</span></a></summary></details></li><li><details><summary><a href="#func-map-empty"><span class="secno">14.4.3 </span><span class="content toc-new">map:empty</span></a></summary></details></li><li><details><summary><a href="#func-map-entries"><span class="secno">14.4.4 </span><span class="content toc-new">map:entries</span></a></summary></details></li><li><details><summary><a href="#func-map-entry"><span class="secno">14.4.5 </span><span class="content">map:entry</span></a></summary></details></li><li><details><summary><a href="#func-map-filter"><span class="secno">14.4.6 </span><span class="content toc-new">map:filter</span></a></summary></details></li><li><details><summary><a href="#func-map-find"><span class="secno">14.4.7 </span><span class="content toc-chg">map:find</span></a></summary></details></li><li><details><summary><a href="#func-map-for-each"><span class="secno">14.4.8 </span><span class="content toc-chg">map:for-each</span></a></summary></details></li><li><details><summary><a href="#func-map-get"><span class="secno">14.4.9 </span><span class="content toc-chg">map:get</span></a></summary></details></li><li><details><summary><a href="#func-map-items"><span class="secno">14.4.10 </span><span class="content toc-new">map:items</span></a></summary></details></li><li><details><summary><a href="#func-map-keys"><span class="secno">14.4.11 </span><span class="content">map:keys</span></a></summary></details></li><li><details><summary><a href="#func-map-keys-where"><span class="secno">14.4.12 </span><span class="content toc-new">map:keys-where</span></a></summary></details></li><li><details><summary><a href="#func-map-merge"><span class="secno">14.4.13 </span><span class="content toc-chg">map:merge</span></a></summary></details></li><li><details><summary><a href="#func-map-put"><span class="secno">14.4.14 </span><span class="content toc-chg">map:put</span></a></summary></details></li><li><details><summary><a href="#func-map-remove"><span class="secno">14.4.15 </span><span class="content toc-chg">map:remove</span></a></summary></details></li><li><details><summary><a href="#func-map-size"><span class="secno">14.4.16 </span><span class="content">map:size</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#xml-to-json-mappings"><span class="secno">14.5 </span><span class="content toc-chg">Converting elements to maps</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#id-element-layouts"><span class="secno">14.5.1 </span><span class="content">Element Layouts</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#id-empty-layout"><span class="secno">14.5.1.1 </span><span class="content">Layout: Empty Content</span></a></summary></details></li><li><details><summary><a href="#id-empty-plus-layout"><span class="secno">14.5.1.2 </span><span class="content">Layout: Empty Content with Attributes</span></a></summary></details></li><li><details><summary><a href="#id-simple-layout"><span class="secno">14.5.1.3 </span><span class="content">Layout: Simple Content</span></a></summary></details></li><li><details><summary><a href="#id-simple-plus-layout"><span class="secno">14.5.1.4 </span><span class="content">Layout: Simple Content with Attributes</span></a></summary></details></li><li><details><summary><a href="#id-list-layout"><span class="secno">14.5.1.5 </span><span class="content">Layout: Simple List</span></a></summary></details></li><li><details><summary><a href="#id-list-plus-layout"><span class="secno">14.5.1.6 </span><span class="content">Layout: List with Attributes</span></a></summary></details></li><li><details><summary><a href="#id-record-layout"><span class="secno">14.5.1.7 </span><span class="content">Layout: Record</span></a></summary></details></li><li><details><summary><a href="#id-sequence-layout"><span class="secno">14.5.1.8 </span><span class="content">Layout: Sequence</span></a></summary></details></li><li><details><summary><a href="#id-mixed-layout"><span class="secno">14.5.1.9 </span><span class="content">Layout: Mixed</span></a></summary></details></li><li><details><summary><a href="#id-xml-layout"><span class="secno">14.5.1.10 </span><span class="content">Layout: Serialized XML</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#id-creating-a-conversion-plan"><span class="secno">14.5.2 </span><span class="content">Creating a conversion plan</span></a></summary></details></li><li><details><summary><a href="#id-xsi-attributes"><span class="secno">14.5.3 </span><span class="content">Attributes in the xsi namespace</span></a></summary></details></li><li><details><summary><a href="#id-conversion-plan-structure"><span class="secno">14.5.4 </span><span class="content">Structure of the conversion plan</span></a></summary></details></li><li><details><summary><a href="#id-schema-based-conversion"><span class="secno">14.5.5 </span><span class="content">Schema-based conversion</span></a></summary></details></li><li><details><summary><a href="#id-selecting-element-layout"><span class="secno">14.5.6 </span><span class="content">Selecting an element layout</span></a></summary></details></li><li><details><summary><a href="#element-and-attribute-names"><span class="secno">14.5.7 </span><span class="content">Element and Attribute Names</span></a></summary></details></li><li><details><summary><a href="#element-and-attribute-content"><span class="secno">14.5.8 </span><span class="content">Element and Attribute Content</span></a></summary></details></li><li><details><summary><a href="#id-loss-of-xdm-information"><span class="secno">14.5.9 </span><span class="content">Lost XDM Information</span></a></summary></details></li><li><details><summary><a href="#id-element-to-map-examples"><span class="secno">14.5.10 </span><span class="content">Examples</span></a></summary></details></li><li><details><summary><a href="#func-element-to-map-plan"><span class="secno">14.5.11 </span><span class="content toc-new">fn:element-to-map-plan</span></a></summary></details></li><li><details><summary><a href="#func-element-to-map"><span class="secno">14.5.12 </span><span class="content toc-new">fn:element-to-map</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#map-operations"><span class="secno">14.6 </span><span class="content">Other operations on maps </span></a></summary></details></li></ol></details></li><li><details><summary><a href="#arrays"><span class="secno">15 </span><span class="content">Processing arrays</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#formal-specification-of-arrays"><span class="secno">15.1 </span><span class="content">Formal Specification of Arrays</span></a></summary></details></li><li><details><summary><a href="#array-functions"><span class="secno">15.2 </span><span class="content">Functions that operate on arrays</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-array-append"><span class="secno">15.2.1 </span><span class="content">array:append</span></a></summary></details></li><li><details><summary><a href="#func-array-build"><span class="secno">15.2.2 </span><span class="content toc-new">array:build</span></a></summary></details></li><li><details><summary><a href="#func-array-empty"><span class="secno">15.2.3 </span><span class="content toc-new">array:empty</span></a></summary></details></li><li><details><summary><a href="#func-array-filter"><span class="secno">15.2.4 </span><span class="content toc-chg">array:filter</span></a></summary></details></li><li><details><summary><a href="#func-array-flatten"><span class="secno">15.2.5 </span><span class="content">array:flatten</span></a></summary></details></li><li><details><summary><a href="#func-array-fold-left"><span class="secno">15.2.6 </span><span class="content">array:fold-left</span></a></summary></details></li><li><details><summary><a href="#func-array-fold-right"><span class="secno">15.2.7 </span><span class="content">array:fold-right</span></a></summary></details></li><li><details><summary><a href="#func-array-foot"><span class="secno">15.2.8 </span><span class="content toc-new">array:foot</span></a></summary></details></li><li><details><summary><a href="#func-array-for-each"><span class="secno">15.2.9 </span><span class="content toc-chg">array:for-each</span></a></summary></details></li><li><details><summary><a href="#func-array-for-each-pair"><span class="secno">15.2.10 </span><span class="content toc-chg">array:for-each-pair</span></a></summary></details></li><li><details><summary><a href="#func-array-get"><span class="secno">15.2.11 </span><span class="content toc-chg">array:get</span></a></summary></details></li><li><details><summary><a href="#func-array-head"><span class="secno">15.2.12 </span><span class="content">array:head</span></a></summary></details></li><li><details><summary><a href="#func-array-index-of"><span class="secno">15.2.13 </span><span class="content toc-new">array:index-of</span></a></summary></details></li><li><details><summary><a href="#func-array-index-where"><span class="secno">15.2.14 </span><span class="content toc-new">array:index-where</span></a></summary></details></li><li><details><summary><a href="#func-array-insert-before"><span class="secno">15.2.15 </span><span class="content">array:insert-before</span></a></summary></details></li><li><details><summary><a href="#func-array-items"><span class="secno">15.2.16 </span><span class="content toc-new">array:items</span></a></summary></details></li><li><details><summary><a href="#func-array-join"><span class="secno">15.2.17 </span><span class="content">array:join</span></a></summary></details></li><li><details><summary><a href="#func-array-members"><span class="secno">15.2.18 </span><span class="content toc-new">array:members</span></a></summary></details></li><li><details><summary><a href="#func-array-of-members"><span class="secno">15.2.19 </span><span class="content toc-new">array:of-members</span></a></summary></details></li><li><details><summary><a href="#func-array-put"><span class="secno">15.2.20 </span><span class="content">array:put</span></a></summary></details></li><li><details><summary><a href="#func-array-remove"><span class="secno">15.2.21 </span><span class="content">array:remove</span></a></summary></details></li><li><details><summary><a href="#func-array-reverse"><span class="secno">15.2.22 </span><span class="content">array:reverse</span></a></summary></details></li><li><details><summary><a href="#func-array-size"><span class="secno">15.2.23 </span><span class="content">array:size</span></a></summary></details></li><li><details><summary><a href="#func-array-slice"><span class="secno">15.2.24 </span><span class="content toc-new">array:slice</span></a></summary></details></li><li><details><summary><a href="#func-array-sort"><span class="secno">15.2.25 </span><span class="content">array:sort</span></a></summary></details></li><li><details><summary><a href="#func-array-sort-by"><span class="secno">15.2.26 </span><span class="content toc-new">array:sort-by</span></a></summary></details></li><li><details><summary><a href="#func-array-sort-with"><span class="secno">15.2.27 </span><span class="content toc-new">array:sort-with</span></a></summary></details></li><li><details><summary><a href="#func-array-split"><span class="secno">15.2.28 </span><span class="content toc-new">array:split</span></a></summary></details></li><li><details><summary><a href="#func-array-subarray"><span class="secno">15.2.29 </span><span class="content toc-chg">array:subarray</span></a></summary></details></li><li><details><summary><a href="#func-array-tail"><span class="secno">15.2.30 </span><span class="content">array:tail</span></a></summary></details></li><li><details><summary><a href="#func-array-trunk"><span class="secno">15.2.31 </span><span class="content toc-new">array:trunk</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#additional-array-operations"><span class="secno">15.3 </span><span class="content">Other Operations on Arrays</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#processing-jnodes"><span class="secno">16 </span><span class="content toc-chg">Processing JNodes</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#functions-on-jnodes"><span class="secno">16.1 </span><span class="content">Functions on JNodes</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-jtree"><span class="secno">16.1.1 </span><span class="content toc-new">fn:jtree</span></a></summary></details></li><li><details><summary><a href="#func-jnode-content"><span class="secno">16.1.2 </span><span class="content toc-new">fn:jnode-content</span></a></summary></details></li><li><details><summary><a href="#func-jnode-selector"><span class="secno">16.1.3 </span><span class="content toc-new">fn:jnode-selector</span></a></summary></details></li><li><details><summary><a href="#func-jnode-position"><span class="secno">16.1.4 </span><span class="content toc-new">fn:jnode-position</span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#parsing-and-serializing"><span class="secno">17 </span><span class="content">External resources and data formats</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#fns-on-docs"><span class="secno">17.1 </span><span class="content">Accessing external information</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-doc"><span class="secno">17.1.1 </span><span class="content toc-chg">fn:doc</span></a></summary></details></li><li><details><summary><a href="#func-doc-available"><span class="secno">17.1.2 </span><span class="content toc-chg">fn:doc-available</span></a></summary></details></li><li><details><summary><a href="#func-collection"><span class="secno">17.1.3 </span><span class="content">fn:collection</span></a></summary></details></li><li><details><summary><a href="#func-uri-collection"><span class="secno">17.1.4 </span><span class="content">fn:uri-collection</span></a></summary></details></li><li><details><summary><a href="#func-unparsed-text"><span class="secno">17.1.5 </span><span class="content toc-chg">fn:unparsed-text</span></a></summary></details></li><li><details><summary><a href="#func-unparsed-text-lines"><span class="secno">17.1.6 </span><span class="content toc-chg">fn:unparsed-text-lines</span></a></summary></details></li><li><details><summary><a href="#func-unparsed-text-available"><span class="secno">17.1.7 </span><span class="content toc-chg">fn:unparsed-text-available</span></a></summary></details></li><li><details><summary><a href="#func-unparsed-binary"><span class="secno">17.1.8 </span><span class="content toc-new">fn:unparsed-binary</span></a></summary></details></li><li><details><summary><a href="#func-environment-variable"><span class="secno">17.1.9 </span><span class="content">fn:environment-variable</span></a></summary></details></li><li><details><summary><a href="#func-available-environment-variables"><span class="secno">17.1.10 </span><span class="content">fn:available-environment-variables</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#xml-functions"><span class="secno">17.2 </span><span class="content">Functions on XML Data</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-parse-xml"><span class="secno">17.2.1 </span><span class="content toc-chg">fn:parse-xml</span></a></summary></details></li><li><details><summary><a href="#func-parse-xml-fragment"><span class="secno">17.2.2 </span><span class="content toc-chg">fn:parse-xml-fragment</span></a></summary></details></li><li><details><summary><a href="#func-serialize"><span class="secno">17.2.3 </span><span class="content toc-chg">fn:serialize</span></a></summary></details></li><li><details><summary><a href="#xsd-validation"><span class="secno">17.2.4 </span><span class="content toc-chg">XSD validation</span></a></summary></details></li><li><details><summary><a href="#func-xsd-validator"><span class="secno">17.2.5 </span><span class="content toc-new">fn:xsd-validator</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#html-functions"><span class="secno">17.3 </span><span class="content toc-chg">Functions on HTML Data</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#html-xdm-mapping"><span class="secno">17.3.1 </span><span class="content">XDM Mapping from HTML DOM Nodes</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#html-attributes-accessor"><span class="secno">17.3.1.1 </span><span class="content">attributes Accessor</span></a></summary></details></li><li><details><summary><a href="#html-base-uri-accessor"><span class="secno">17.3.1.2 </span><span class="content">base-uri Accessor</span></a></summary></details></li><li><details><summary><a href="#html-children-accessor"><span class="secno">17.3.1.3 </span><span class="content">children Accessor</span></a></summary></details></li><li><details><summary><a href="#html-document-uri-accessor"><span class="secno">17.3.1.4 </span><span class="content">document-uri Accessor</span></a></summary></details></li><li><details><summary><a href="#html-is-id-accessor"><span class="secno">17.3.1.5 </span><span class="content">is-id Accessor</span></a></summary></details></li><li><details><summary><a href="#html-is-idrefs-accessor"><span class="secno">17.3.1.6 </span><span class="content">is-idrefs Accessor</span></a></summary></details></li><li><details><summary><a href="#html-namespace-nodes-accessor"><span class="secno">17.3.1.7 </span><span class="content">namespace-nodes Accessor</span></a></summary></details></li><li><details><summary><a href="#html-nilled-accessor"><span class="secno">17.3.1.8 </span><span class="content">nilled Accessor</span></a></summary></details></li><li><details><summary><a href="#html-node-kind-accessor"><span class="secno">17.3.1.9 </span><span class="content">node-kind Accessor</span></a></summary></details></li><li><details><summary><a href="#html-node-name-accessor"><span class="secno">17.3.1.10 </span><span class="content">node-name Accessor</span></a></summary></details></li><li><details><summary><a href="#html-parent-accessor"><span class="secno">17.3.1.11 </span><span class="content">parent Accessor</span></a></summary></details></li><li><details><summary><a href="#html-string-value-accessor"><span class="secno">17.3.1.12 </span><span class="content">string-value Accessor</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#html-tree-string-construction"><span class="secno">17.3.1.12.1 </span><span class="content">Tree string construction</span></a></summary></details></li><li><details><summary><a href="#html-text-node-string-construction"><span class="secno">17.3.1.12.2 </span><span class="content">Text node string construction</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#html-type-name-accessor"><span class="secno">17.3.1.13 </span><span class="content">type-name Accessor</span></a></summary></details></li><li><details><summary><a href="#html-typed-value-accessor"><span class="secno">17.3.1.14 </span><span class="content">typed-value Accessor</span></a></summary></details></li><li><details><summary><a href="#html-unparsed-entity-public-id-accessor"><span class="secno">17.3.1.15 </span><span class="content">unparsed-entity-public-id Accessor</span></a></summary></details></li><li><details><summary><a href="#html-unparsed-entity-system-id-accessor"><span class="secno">17.3.1.16 </span><span class="content">unparsed-entity-system-id Accessor</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#func-parse-html"><span class="secno">17.3.2 </span><span class="content toc-new">fn:parse-html</span></a></summary></details></li><li><details><summary><a href="#func-html-doc"><span class="secno">17.3.3 </span><span class="content toc-new">fn:html-doc</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#json-functions"><span class="secno">17.4 </span><span class="content">Functions on JSON Data</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#json-to-maps-and-arrays"><span class="secno">17.4.1 </span><span class="content">Representing JSON using maps and arrays</span></a></summary></details></li><li><details><summary><a href="#json-to-xml-mapping"><span class="secno">17.4.2 </span><span class="content">XML Representation of JSON</span></a></summary></details></li><li><details><summary><a href="#json-character-repertoire"><span class="secno">17.4.3 </span><span class="content toc-chg">JSON character repertoire</span></a></summary></details></li><li><details><summary><a href="#func-parse-json"><span class="secno">17.4.4 </span><span class="content toc-chg">fn:parse-json</span></a></summary></details></li><li><details><summary><a href="#func-json-doc"><span class="secno">17.4.5 </span><span class="content toc-chg">fn:json-doc</span></a></summary></details></li><li><details><summary><a href="#func-json-to-xml"><span class="secno">17.4.6 </span><span class="content">fn:json-to-xml</span></a></summary></details></li><li><details><summary><a href="#func-xml-to-json"><span class="secno">17.4.7 </span><span class="content toc-chg">fn:xml-to-json</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#csv-functions"><span class="secno">17.5 </span><span class="content toc-chg">Functions on CSV Data</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#csv-delimiters"><span class="secno">17.5.1 </span><span class="content">CSV delimiters</span></a></summary></details></li><li><details><summary><a href="#csv-field-quoting"><span class="secno">17.5.2 </span><span class="content">Field quoting</span></a></summary></details></li><li><details><summary><a href="#basic-csv-to-xdm-mapping"><span class="secno">17.5.3 </span><span class="content">Basic parsing of CSV to arrays</span></a></summary></details></li><li><details><summary><a href="#func-csv-to-arrays"><span class="secno">17.5.4 </span><span class="content toc-new">fn:csv-to-arrays</span></a></summary></details></li><li><details><summary><a href="#csv-to-xdm-mapping"><span class="secno">17.5.5 </span><span class="content">Enhanced parsing of CSV data to maps and arrays</span></a></summary></details></li><li><details><summary><a href="#parsed-csv-structure-record"><span class="secno">17.5.6 </span><span class="content">Record fn:parsed-csv-structure-record</span></a></summary></details></li><li><details><summary><a href="#func-parse-csv"><span class="secno">17.5.7 </span><span class="content toc-new">fn:parse-csv</span></a></summary></details></li><li><details><summary><a href="#func-csv-doc"><span class="secno">17.5.8 </span><span class="content toc-new">fn:csv-doc</span></a></summary></details></li><li><details><summary><a href="#csv-represent-as-xml"><span class="secno">17.5.9 </span><span class="content">Representing CSV data as XML</span></a></summary></details></li><li><details><summary><a href="#func-csv-to-xml"><span class="secno">17.5.10 </span><span class="content toc-new">fn:csv-to-xml</span></a></summary></details></li><li><details><summary><a href="#illustrative-csv-examples"><span class="secno">17.5.11 </span><span class="content">Illustrative examples of processing CSV data</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#ixml-functions"><span class="secno">17.6 </span><span class="content">Functions on Invisible XML</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#func-invisible-xml"><span class="secno">17.6.1 </span><span class="content toc-new">fn:invisible-xml</span></a></summary></details></li></ol></details></li></ol></details></li><li class="add_version" style="display: none;"><details><summary><a href="#lazy-evaluation"><span class="secno">18 </span><span class="content">Deferred evaluation</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-use-cases"><span class="secno">18.1 </span><span class="content">Major use-cases</span></a></summary></details></li><li><details><summary><a href="#generator-definitions"><span class="secno">18.2 </span><span class="content">Definitions</span></a></summary></details></li><li><details><summary><a href="#generator"><span class="secno">18.3 </span><span class="content">Record fn:generator</span></a></summary></details></li><li><details><summary><a href="#generator-functions"><span class="secno">18.4 </span><span class="content">Functions on generators</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-functions-getting-value"><span class="secno">18.4.1 </span><span class="content">Functions returning a specific value</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-at"><span class="secno">18.4.1.1 </span><span class="content">gn:at</span></a></summary></details></li><li><details><summary><a href="#generator-contains"><span class="secno">18.4.1.2 </span><span class="content">gn:contains</span></a></summary></details></li><li><details><summary><a href="#generator-first-where"><span class="secno">18.4.1.3 </span><span class="content">gn:first-where</span></a></summary></details></li><li><details><summary><a href="#generator-fold-left"><span class="secno">18.4.1.4 </span><span class="content">gn:fold-left</span></a></summary></details></li><li><details><summary><a href="#generator-fold-right"><span class="secno">18.4.1.5 </span><span class="content">gn:fold-right</span></a></summary></details></li><li><details><summary><a href="#generator-fold-lazy"><span class="secno">18.4.1.6 </span><span class="content">gn:fold-lazy</span></a></summary></details></li><li><details><summary><a href="#generator-head"><span class="secno">18.4.1.7 </span><span class="content">gn:head</span></a></summary></details></li><li><details><summary><a href="#generator-some"><span class="secno">18.4.1.8 </span><span class="content">gn:some</span></a></summary></details></li><li><details><summary><a href="#generator-some-where"><span class="secno">18.4.1.9 </span><span class="content">gn:some-where</span></a></summary></details></li><li><details><summary><a href="#generator-value"><span class="secno">18.4.1.10 </span><span class="content">gn:value</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#generator-functions-producing-generators"><span class="secno">18.4.2 </span><span class="content">Functions that produce another generator from existing generators</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-append"><span class="secno">18.4.2.1 </span><span class="content">gn:append</span></a></summary></details></li><li><details><summary><a href="#generator-chunk"><span class="secno">18.4.2.2 </span><span class="content">gn:chunk</span></a></summary></details></li><li><details><summary><a href="#generator-concat"><span class="secno">18.4.2.3 </span><span class="content">gn:concat</span></a></summary></details></li><li><details><summary><a href="#generator-distinct"><span class="secno">18.4.2.4 </span><span class="content">gn:distinct</span></a></summary></details></li><li><details><summary><a href="#generator-filter"><span class="secno">18.4.2.5 </span><span class="content">gn:filter</span></a></summary></details></li><li><details><summary><a href="#generator-for-each"><span class="secno">18.4.2.6 </span><span class="content">gn:for-each</span></a></summary></details></li><li><details><summary><a href="#generator-for-each-pair"><span class="secno">18.4.2.7 </span><span class="content">gn:for-each-pair</span></a></summary></details></li><li><details><summary><a href="#generator-insert-at"><span class="secno">18.4.2.8 </span><span class="content">gn:insert-at</span></a></summary></details></li><li><details><summary><a href="#generator-next"><span class="secno">18.4.2.9 </span><span class="content">gn:next</span></a></summary></details></li><li><details><summary><a href="#generator-prepend"><span class="secno">18.4.2.10 </span><span class="content">gn:prepend</span></a></summary></details></li><li><details><summary><a href="#generator-remove-at"><span class="secno">18.4.2.11 </span><span class="content">gn:remove-at</span></a></summary></details></li><li><details><summary><a href="#generator-remove-where"><span class="secno">18.4.2.12 </span><span class="content">gn:remove-where</span></a></summary></details></li><li><details><summary><a href="#generator-replace"><span class="secno">18.4.2.13 </span><span class="content">gn:replace</span></a></summary></details></li><li><details><summary><a href="#generator-reverse"><span class="secno">18.4.2.14 </span><span class="content">gn:reverse</span></a></summary></details></li><li><details><summary><a href="#generator-scan-left"><span class="secno">18.4.2.15 </span><span class="content">gn:scan-left</span></a></summary></details></li><li><details><summary><a href="#generator-scan-right"><span class="secno">18.4.2.16 </span><span class="content">gn:scan-right</span></a></summary></details></li><li><details><summary><a href="#generator-skip"><span class="secno">18.4.2.17 </span><span class="content">gn:skip</span></a></summary></details></li><li><details><summary><a href="#generator-skip-strict"><span class="secno">18.4.2.18 </span><span class="content">gn:skip-strict</span></a></summary></details></li><li><details><summary><a href="#generator-skip-while"><span class="secno">18.4.2.19 </span><span class="content">gn:skip-while</span></a></summary></details></li><li><details><summary><a href="#generator-subrange"><span class="secno">18.4.2.20 </span><span class="content">gn:subrange</span></a></summary></details></li><li><details><summary><a href="#generator-tail"><span class="secno">18.4.2.21 </span><span class="content">gn:tail</span></a></summary></details></li><li><details><summary><a href="#generator-take"><span class="secno">18.4.2.22 </span><span class="content">gn:take</span></a></summary></details></li><li><details><summary><a href="#generator-take-while"><span class="secno">18.4.2.23 </span><span class="content">gn:take-while</span></a></summary></details></li><li><details><summary><a href="#generator-zip"><span class="secno">18.4.2.24 </span><span class="content">gn:zip</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#generator-functions-producing-generators-from-providers"><span class="secno">18.4.3 </span><span class="content">Functions that produce a generator from a data provider</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-empty-generator"><span class="secno">18.4.3.1 </span><span class="content">gn:empty-generator</span></a></summary></details></li><li><details><summary><a href="#generator-make-generator"><span class="secno">18.4.3.2 </span><span class="content">gn:make-generator</span></a></summary></details></li><li><details><summary><a href="#generator-make-generator-from-array"><span class="secno">18.4.3.3 </span><span class="content">gn:make-generator-from-array</span></a></summary></details></li><li><details><summary><a href="#generator-make-generator-from-sequence"><span class="secno">18.4.3.4 </span><span class="content">gn:make-generator-from-sequence</span></a></summary></details></li><li><details><summary><a href="#generator-make-generator-from-map"><span class="secno">18.4.3.5 </span><span class="content">gn:make-generator-from-map</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#generator-functions-producing-xpath-collections-from-generators"><span class="secno">18.4.4 </span><span class="content">Functions that produce an XPath collection from a generator</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-to-array"><span class="secno">18.4.4.1 </span><span class="content">gn:to-array</span></a></summary></details></li><li><details><summary><a href="#generator-to-map"><span class="secno">18.4.4.2 </span><span class="content">gn:to-map</span></a></summary></details></li><li><details><summary><a href="#generator-to-sequence"><span class="secno">18.4.4.3 </span><span class="content">gn:to-sequence</span></a></summary></details></li></ol></details></li></ol></details></li></ol></details></li><li class="modify_version"><details><summary><a href="#lazy-evaluation"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">Deferred evaluation</span></span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-use-cases"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.1 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">Major use-cases</span></span></a></summary></details></li><li><details><summary><a href="#generator-definitions"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.2 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">Definitions</span></span></a></summary></details></li><li><details><summary><a href="#generator"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.3 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">Record fn:generator</span></span></a></summary></details></li><li><details><summary><a href="#generator-functions"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">Functions on generators</span></span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-functions-getting-value"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">Functions returning a specific value</span></span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-at"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.1 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:at</span></span></a></summary></details></li><li><details><summary><a href="#generator-contains"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.2 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:contains</span></span></a></summary></details></li><li><details><summary><a href="#generator-first-where"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.3 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:first-where</span></span></a></summary></details></li><li><details><summary><a href="#generator-fold-left"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.4 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:fold-left</span></span></a></summary></details></li><li><details><summary><a href="#generator-fold-right"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.5 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:fold-right</span></span></a></summary></details></li><li><details><summary><a href="#generator-fold-lazy"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.6 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:fold-lazy</span></span></a></summary></details></li><li><details><summary><a href="#generator-head"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.7 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:head</span></span></a></summary></details></li><li><details><summary><a href="#generator-some"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.8 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:some</span></span></a></summary></details></li><li><details><summary><a href="#generator-some-where"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.9 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:some-where</span></span></a></summary></details></li><li><details><summary><a href="#generator-value"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.1.10 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:value</span></span></a></summary></details></li></ol></details></li><li><details><summary><a href="#generator-functions-producing-generators"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">Functions that produce another generator from existing generators</span></span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-append"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.1 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:append</span></span></a></summary></details></li><li><details><summary><a href="#generator-chunk"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.2 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:chunk</span></span></a></summary></details></li><li><details><summary><a href="#generator-concat"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.3 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:concat</span></span></a></summary></details></li><li><details><summary><a href="#generator-distinct"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.4 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:distinct</span></span></a></summary></details></li><li><details><summary><a href="#generator-filter"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.5 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:filter</span></span></a></summary></details></li><li><details><summary><a href="#generator-for-each"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.6 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:for-each</span></span></a></summary></details></li><li><details><summary><a href="#generator-for-each-pair"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.7 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:for-each-pair</span></span></a></summary></details></li><li><details><summary><a href="#generator-insert-at"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.8 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:insert-at</span></span></a></summary></details></li><li><details><summary><a href="#generator-next"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.9 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:next</span></span></a></summary></details></li><li><details><summary><a href="#generator-prepend"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.10 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:prepend</span></span></a></summary></details></li><li><details><summary><a href="#generator-remove-at"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.11 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:remove-at</span></span></a></summary></details></li><li><details><summary><a href="#generator-remove-where"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.12 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:remove-where</span></span></a></summary></details></li><li><details><summary><a href="#generator-replace"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.13 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:replace</span></span></a></summary></details></li><li><details><summary><a href="#generator-reverse"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.14 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:reverse</span></span></a></summary></details></li><li><details><summary><a href="#generator-scan-left"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.15 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:scan-left</span></span></a></summary></details></li><li><details><summary><a href="#generator-scan-right"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.16 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:scan-right</span></span></a></summary></details></li><li><details><summary><a href="#generator-skip"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.17 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:skip</span></span></a></summary></details></li><li><details><summary><a href="#generator-skip-strict"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.18 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:skip-strict</span></span></a></summary></details></li><li><details><summary><a href="#generator-skip-while"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.19 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:skip-while</span></span></a></summary></details></li><li><details><summary><a href="#generator-subrange"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.20 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:subrange</span></span></a></summary></details></li><li><details><summary><a href="#generator-tail"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.21 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:tail</span></span></a></summary></details></li><li><details><summary><a href="#generator-take"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.22 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:take</span></span></a></summary></details></li><li><details><summary><a href="#generator-take-while"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.23 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:take-while</span></span></a></summary></details></li><li><details><summary><a href="#generator-zip"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.2.24 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:zip</span></span></a></summary></details></li></ol></details></li><li><details><summary><a href="#generator-functions-producing-generators-from-providers"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.3 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">Functions that produce a generator from a data provider</span></span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-empty-generator"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.3.1 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator</span></span></a></summary></details></li><li><details><summary><a href="#generator-make-generator"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.3.2 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator</span></span></a></summary></details></li><li><details><summary><a href="#generator-make-generator-from-array"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.3.3 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-array</span></span></a></summary></details></li><li><details><summary><a href="#generator-make-generator-from-sequence"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.3.4 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-sequence</span></span></a></summary></details></li><li><details><summary><a href="#generator-make-generator-from-map"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.3.5 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-map</span></span></a></summary></details></li></ol></details></li><li><details><summary><a href="#generator-functions-producing-xpath-collections-from-generators"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.4 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">Functions that produce an XPath collection from a generator</span></span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#generator-to-array"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.4.1 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:to-array</span></span></a></summary></details></li><li><details><summary><a href="#generator-to-map"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.4.2 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:to-map</span></span></a></summary></details></li><li><details><summary><a href="#generator-to-sequence"><span class="secno"><span class="deltaxml-new" style="background:#90EE90">18.4.4.3 </span></span><span class="content"><span class="deltaxml-new" style="background:#90EE90">gn:to-sequence</span></span></a></summary></details></li></ol></details></li></ol></details></li></ol></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#dynamic-loading"><span class="delete_version"><span class="secno">18 </span><span class="content">Dynamic evaluation</span></span><span class="modify_version"><span class="secno">18 </span><span class="content">Dynamic evaluation</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#dynamic-loading"><span class="add_version"><span class="secno">19 </span><span class="content">Dynamic evaluation</span></span><span class="modify_version"><span class="secno">19 </span><span class="content">Dynamic evaluation</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#dynamic-loading"><span style="display: none;" class="delete_version"><span class="secno">18 </span><span class="content">Dynamic evaluation</span></span><span style="display: none;" class="add_version"><span class="secno">19 </span><span class="content">Dynamic evaluation</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">18</span><span class="deltaxml-new" style="background:#90EE90">19</span> </span><span class="content">Dynamic evaluation</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#load-xquery-module-record"><span style="display: none;" class="delete_version"><span class="secno">18.1 </span><span class="content">Record fn:load-xquery-module-record</span></span><span style="display: none;" class="add_version"><span class="secno">19.1 </span><span class="content">Record fn:load-xquery-module-record</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">18.1</span><span class="deltaxml-new" style="background:#90EE90">19.1</span> </span><span class="content">Record fn:load-xquery-module-record</span></span></a></summary></details></li><li><details><summary><a href="#func-load-xquery-module"><span style="display: none;" class="delete_version"><span class="secno">18.2 </span><span class="content toc-chg">fn:load-xquery-module</span></span><span style="display: none;" class="add_version"><span class="secno">19.2 </span><span class="content toc-chg">fn:load-xquery-module</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">18.2</span><span class="deltaxml-new" style="background:#90EE90">19.2</span> </span><span class="content toc-chg">fn:load-xquery-module</span></span></a></summary></details></li><li><details><summary><a href="#func-transform"><span style="display: none;" class="delete_version"><span class="secno">18.3 </span><span class="content">fn:transform</span></span><span style="display: none;" class="add_version"><span class="secno">19.3 </span><span class="content">fn:transform</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">18.3</span><span class="deltaxml-new" style="background:#90EE90">19.3</span> </span><span class="content">fn:transform</span></span></a></summary></details></li><li><details><summary><a href="#func-op"><span style="display: none;" class="delete_version"><span class="secno">18.4 </span><span class="content toc-new">fn:op</span></span><span style="display: none;" class="add_version"><span class="secno">19.4 </span><span class="content toc-new">fn:op</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">18.4</span><span class="deltaxml-new" style="background:#90EE90">19.4</span> </span><span class="content toc-new">fn:op</span></span></a></summary></details></li></ol></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#functions-on-types"><span class="delete_version"><span class="secno">19 </span><span class="content toc-chg">Processing types</span></span><span class="modify_version"><span class="secno">19 </span><span class="content toc-chg">Processing types</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#functions-on-types"><span class="add_version"><span class="secno">20 </span><span class="content toc-chg">Processing types</span></span><span class="modify_version"><span class="secno">20 </span><span class="content toc-chg">Processing types</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#functions-on-types"><span style="display: none;" class="delete_version"><span class="secno">19 </span><span class="content toc-chg">Processing types</span></span><span style="display: none;" class="add_version"><span class="secno">20 </span><span class="content toc-chg">Processing types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">19</span><span class="deltaxml-new" style="background:#90EE90">20</span> </span><span class="content toc-chg">Processing types</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><span style="display: none;" class="delete_version"><a href="#functions-returning-type-information"><span class="delete_version"><span class="secno">19.1 </span><span class="content">Functions returning type information</span></span><span class="modify_version"><span class="secno">19.1 </span><span class="content">Functions returning type information</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#functions-returning-type-information"><span class="add_version"><span class="secno">20.1 </span><span class="content">Functions returning type information</span></span><span class="modify_version"><span class="secno">20.1 </span><span class="content">Functions returning type information</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#functions-returning-type-information"><span style="display: none;" class="delete_version"><span class="secno">19.1 </span><span class="content">Functions returning type information</span></span><span style="display: none;" class="add_version"><span class="secno">20.1 </span><span class="content">Functions returning type information</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">19.1</span><span class="deltaxml-new" style="background:#90EE90">20.1</span> </span><span class="content">Functions returning type information</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#schema-type-record"><span style="display: none;" class="delete_version"><span class="secno">19.1.1 </span><span class="content">Record fn:schema-type-record</span></span><span style="display: none;" class="add_version"><span class="secno">20.1.1 </span><span class="content">Record fn:schema-type-record</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">19.1.1</span><span class="deltaxml-new" style="background:#90EE90">20.1.1</span> </span><span class="content">Record fn:schema-type-record</span></span></a></summary></details></li><li><details><summary><a href="#func-schema-type"><span style="display: none;" class="delete_version"><span class="secno">19.1.2 </span><span class="content toc-new">fn:schema-type</span></span><span style="display: none;" class="add_version"><span class="secno">20.1.2 </span><span class="content toc-new">fn:schema-type</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">19.1.2</span><span class="deltaxml-new" style="background:#90EE90">20.1.2</span> </span><span class="content toc-new">fn:schema-type</span></span></a></summary></details></li><li><details><summary><a href="#func-type-of"><span style="display: none;" class="delete_version"><span class="secno">19.1.3 </span><span class="content toc-new">fn:type-of</span></span><span style="display: none;" class="add_version"><span class="secno">20.1.3 </span><span class="content toc-new">fn:type-of</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">19.1.3</span><span class="deltaxml-new" style="background:#90EE90">20.1.3</span> </span><span class="content toc-new">fn:type-of</span></span></a></summary></details></li><li><details><summary><a href="#func-atomic-type-annotation"><span style="display: none;" class="delete_version"><span class="secno">19.1.4 </span><span class="content toc-new">fn:atomic-type-annotation</span></span><span style="display: none;" class="add_version"><span class="secno">20.1.4 </span><span class="content toc-new">fn:atomic-type-annotation</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">19.1.4</span><span class="deltaxml-new" style="background:#90EE90">20.1.4</span> </span><span class="content toc-new">fn:atomic-type-annotation</span></span></a></summary></details></li><li><details><summary><a href="#func-node-type-annotation"><span style="display: none;" class="delete_version"><span class="secno">19.1.5 </span><span class="content toc-new">fn:node-type-annotation</span></span><span style="display: none;" class="add_version"><span class="secno">20.1.5 </span><span class="content toc-new">fn:node-type-annotation</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">19.1.5</span><span class="deltaxml-new" style="background:#90EE90">20.1.5</span> </span><span class="content toc-new">fn:node-type-annotation</span></span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#context"><span class="delete_version"><span class="secno">20 </span><span class="content">Accessing the context</span></span><span class="modify_version"><span class="secno">20 </span><span class="content">Accessing the context</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#context"><span class="add_version"><span class="secno">21 </span><span class="content">Accessing the context</span></span><span class="modify_version"><span class="secno">21 </span><span class="content">Accessing the context</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#context"><span style="display: none;" class="delete_version"><span class="secno">20 </span><span class="content">Accessing the context</span></span><span style="display: none;" class="add_version"><span class="secno">21 </span><span class="content">Accessing the context</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20</span><span class="deltaxml-new" style="background:#90EE90">21</span> </span><span class="content">Accessing the context</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#func-current-date"><span style="display: none;" class="delete_version"><span class="secno">20.1 </span><span class="content">fn:current-date</span></span><span style="display: none;" class="add_version"><span class="secno">21.1 </span><span class="content">fn:current-date</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20.1</span><span class="deltaxml-new" style="background:#90EE90">21.1</span> </span><span class="content">fn:current-date</span></span></a></summary></details></li><li><details><summary><a href="#func-current-dateTime"><span style="display: none;" class="delete_version"><span class="secno">20.2 </span><span class="content">fn:current-dateTime</span></span><span style="display: none;" class="add_version"><span class="secno">21.2 </span><span class="content">fn:current-dateTime</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20.2</span><span class="deltaxml-new" style="background:#90EE90">21.2</span> </span><span class="content">fn:current-dateTime</span></span></a></summary></details></li><li><details><summary><a href="#func-current-time"><span style="display: none;" class="delete_version"><span class="secno">20.3 </span><span class="content">fn:current-time</span></span><span style="display: none;" class="add_version"><span class="secno">21.3 </span><span class="content">fn:current-time</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20.3</span><span class="deltaxml-new" style="background:#90EE90">21.3</span> </span><span class="content">fn:current-time</span></span></a></summary></details></li><li><details><summary><a href="#func-default-collation"><span style="display: none;" class="delete_version"><span class="secno">20.4 </span><span class="content">fn:default-collation</span></span><span style="display: none;" class="add_version"><span class="secno">21.4 </span><span class="content">fn:default-collation</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20.4</span><span class="deltaxml-new" style="background:#90EE90">21.4</span> </span><span class="content">fn:default-collation</span></span></a></summary></details></li><li><details><summary><a href="#func-default-language"><span style="display: none;" class="delete_version"><span class="secno">20.5 </span><span class="content">fn:default-language</span></span><span style="display: none;" class="add_version"><span class="secno">21.5 </span><span class="content">fn:default-language</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20.5</span><span class="deltaxml-new" style="background:#90EE90">21.5</span> </span><span class="content">fn:default-language</span></span></a></summary></details></li><li><details><summary><a href="#func-implicit-timezone"><span style="display: none;" class="delete_version"><span class="secno">20.6 </span><span class="content">fn:implicit-timezone</span></span><span style="display: none;" class="add_version"><span class="secno">21.6 </span><span class="content">fn:implicit-timezone</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20.6</span><span class="deltaxml-new" style="background:#90EE90">21.6</span> </span><span class="content">fn:implicit-timezone</span></span></a></summary></details></li><li><details><summary><a href="#func-last"><span style="display: none;" class="delete_version"><span class="secno">20.7 </span><span class="content">fn:last</span></span><span style="display: none;" class="add_version"><span class="secno">21.7 </span><span class="content">fn:last</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20.7</span><span class="deltaxml-new" style="background:#90EE90">21.7</span> </span><span class="content">fn:last</span></span></a></summary></details></li><li><details><summary><a href="#func-position"><span style="display: none;" class="delete_version"><span class="secno">20.8 </span><span class="content">fn:position</span></span><span style="display: none;" class="add_version"><span class="secno">21.8 </span><span class="content">fn:position</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20.8</span><span class="deltaxml-new" style="background:#90EE90">21.8</span> </span><span class="content">fn:position</span></span></a></summary></details></li><li><details><summary><a href="#func-static-base-uri"><span style="display: none;" class="delete_version"><span class="secno">20.9 </span><span class="content">fn:static-base-uri</span></span><span style="display: none;" class="add_version"><span class="secno">21.9 </span><span class="content">fn:static-base-uri</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">20.9</span><span class="deltaxml-new" style="background:#90EE90">21.9</span> </span><span class="content">fn:static-base-uri</span></span></a></summary></details></li></ol></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#errors-and-diagnostics"><span class="delete_version"><span class="secno">21 </span><span class="content">Errors and diagnostics</span></span><span class="modify_version"><span class="secno">21 </span><span class="content">Errors and diagnostics</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#errors-and-diagnostics"><span class="add_version"><span class="secno">22 </span><span class="content">Errors and diagnostics</span></span><span class="modify_version"><span class="secno">22 </span><span class="content">Errors and diagnostics</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#errors-and-diagnostics"><span style="display: none;" class="delete_version"><span class="secno">21 </span><span class="content">Errors and diagnostics</span></span><span style="display: none;" class="add_version"><span class="secno">22 </span><span class="content">Errors and diagnostics</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">21</span><span class="deltaxml-new" style="background:#90EE90">22</span> </span><span class="content">Errors and diagnostics</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><span style="display: none;" class="delete_version"><a href="#errors"><span class="delete_version"><span class="secno">21.1 </span><span class="content">Raising errors</span></span><span class="modify_version"><span class="secno">21.1 </span><span class="content">Raising errors</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#errors"><span class="add_version"><span class="secno">22.1 </span><span class="content">Raising errors</span></span><span class="modify_version"><span class="secno">22.1 </span><span class="content">Raising errors</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#errors"><span style="display: none;" class="delete_version"><span class="secno">21.1 </span><span class="content">Raising errors</span></span><span style="display: none;" class="add_version"><span class="secno">22.1 </span><span class="content">Raising errors</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">21.1</span><span class="deltaxml-new" style="background:#90EE90">22.1</span> </span><span class="content">Raising errors</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#func-error"><span style="display: none;" class="delete_version"><span class="secno">21.1.1 </span><span class="content toc-chg">fn:error</span></span><span style="display: none;" class="add_version"><span class="secno">22.1.1 </span><span class="content toc-chg">fn:error</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">21.1.1</span><span class="deltaxml-new" style="background:#90EE90">22.1.1</span> </span><span class="content toc-chg">fn:error</span></span></a></summary></details></li></ol></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#diagnostics"><span class="delete_version"><span class="secno">21.2 </span><span class="content">Diagnostic tracing</span></span><span class="modify_version"><span class="secno">21.2 </span><span class="content">Diagnostic tracing</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#diagnostics"><span class="add_version"><span class="secno">22.2 </span><span class="content">Diagnostic tracing</span></span><span class="modify_version"><span class="secno">22.2 </span><span class="content">Diagnostic tracing</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#diagnostics"><span style="display: none;" class="delete_version"><span class="secno">21.2 </span><span class="content">Diagnostic tracing</span></span><span style="display: none;" class="add_version"><span class="secno">22.2 </span><span class="content">Diagnostic tracing</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">21.2</span><span class="deltaxml-new" style="background:#90EE90">22.2</span> </span><span class="content">Diagnostic tracing</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#func-trace"><span style="display: none;" class="delete_version"><span class="secno">21.2.1 </span><span class="content toc-chg">fn:trace</span></span><span style="display: none;" class="add_version"><span class="secno">22.2.1 </span><span class="content toc-chg">fn:trace</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">21.2.1</span><span class="deltaxml-new" style="background:#90EE90">22.2.1</span> </span><span class="content toc-chg">fn:trace</span></span></a></summary></details></li><li><details><summary><a href="#func-message"><span style="display: none;" class="delete_version"><span class="secno">21.2.2 </span><span class="content toc-new">fn:message</span></span><span style="display: none;" class="add_version"><span class="secno">22.2.2 </span><span class="content toc-new">fn:message</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">21.2.2</span><span class="deltaxml-new" style="background:#90EE90">22.2.2</span> </span><span class="content toc-new">fn:message</span></span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#constructor-functions"><span class="delete_version"><span class="secno">22 </span><span class="content toc-chg">Constructor functions</span></span><span class="modify_version"><span class="secno">22 </span><span class="content toc-chg">Constructor functions</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#constructor-functions"><span class="add_version"><span class="secno">23 </span><span class="content toc-chg">Constructor functions</span></span><span class="modify_version"><span class="secno">23 </span><span class="content toc-chg">Constructor functions</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#constructor-functions"><span style="display: none;" class="delete_version"><span class="secno">22 </span><span class="content toc-chg">Constructor functions</span></span><span style="display: none;" class="add_version"><span class="secno">23 </span><span class="content toc-chg">Constructor functions</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">22</span><span class="deltaxml-new" style="background:#90EE90">23</span> </span><span class="content toc-chg">Constructor functions</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#constructor-functions-for-xsd-types"><span style="display: none;" class="delete_version"><span class="secno">22.1 </span><span class="content">Constructor functions for XML Schema built-in atomic types</span></span><span style="display: none;" class="add_version"><span class="secno">23.1 </span><span class="content">Constructor functions for XML Schema built-in atomic types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">22.1</span><span class="deltaxml-new" style="background:#90EE90">23.1</span> </span><span class="content">Constructor functions for XML Schema built-in atomic types</span></span></a></summary></details></li><li><details><summary><a href="#constructor-qname-notation"><span style="display: none;" class="delete_version"><span class="secno">22.2 </span><span class="content">Constructor functions for xs:QName and xs:NOTATION</span></span><span style="display: none;" class="add_version"><span class="secno">23.2 </span><span class="content">Constructor functions for xs:QName and xs:NOTATION</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">22.2</span><span class="deltaxml-new" style="background:#90EE90">23.2</span> </span><span class="content">Constructor functions for xs:QName and xs:NOTATION</span></span></a></summary></details></li><li><details><summary><a href="#constructor-functions-for-xsd-list-types"><span style="display: none;" class="delete_version"><span class="secno">22.3 </span><span class="content">Constructor functions for XML Schema built-in list types</span></span><span style="display: none;" class="add_version"><span class="secno">23.3 </span><span class="content">Constructor functions for XML Schema built-in list types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">22.3</span><span class="deltaxml-new" style="background:#90EE90">23.3</span> </span><span class="content">Constructor functions for XML Schema built-in list types</span></span></a></summary></details></li><li><details><summary><a href="#constructor-functions-for-xsd-union-types"><span style="display: none;" class="delete_version"><span class="secno">22.4 </span><span class="content">Constructor functions for XML Schema built-in union types</span></span><span style="display: none;" class="add_version"><span class="secno">23.4 </span><span class="content">Constructor functions for XML Schema built-in union types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">22.4</span><span class="deltaxml-new" style="background:#90EE90">23.4</span> </span><span class="content">Constructor functions for XML Schema built-in union types</span></span></a></summary></details></li><li><details><summary><a href="#constructor-functions-for-user-defined-types"><span style="display: none;" class="delete_version"><span class="secno">22.5 </span><span class="content">Constructor functions for user-defined atomic and union types</span></span><span style="display: none;" class="add_version"><span class="secno">23.5 </span><span class="content">Constructor functions for user-defined atomic and union types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">22.5</span><span class="deltaxml-new" style="background:#90EE90">23.5</span> </span><span class="content">Constructor functions for user-defined atomic and union types</span></span></a></summary></details></li><li><details><summary><a href="#id-constructors-for-record-tests"><span style="display: none;" class="delete_version"><span class="secno">22.6 </span><span class="content toc-chg">Constructor functions for named record types</span></span><span style="display: none;" class="add_version"><span class="secno">23.6 </span><span class="content toc-chg">Constructor functions for named record types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">22.6</span><span class="deltaxml-new" style="background:#90EE90">23.6</span> </span><span class="content toc-chg">Constructor functions for named record types</span></span></a></summary></details></li></ol></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#casting"><span class="delete_version"><span class="secno">23 </span><span class="content">Casting</span></span><span class="modify_version"><span class="secno">23 </span><span class="content">Casting</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#casting"><span class="add_version"><span class="secno">24 </span><span class="content">Casting</span></span><span class="modify_version"><span class="secno">24 </span><span class="content">Casting</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#casting"><span style="display: none;" class="delete_version"><span class="secno">23 </span><span class="content">Casting</span></span><span style="display: none;" class="add_version"><span class="secno">24 </span><span class="content">Casting</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23</span><span class="deltaxml-new" style="background:#90EE90">24</span> </span><span class="content">Casting</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><span style="display: none;" class="delete_version"><a href="#casting-from-primitive-to-primitive"><span class="delete_version"><span class="secno">23.1 </span><span class="content toc-chg">Casting from primitive types to primitive types</span></span><span class="modify_version"><span class="secno">23.1 </span><span class="content toc-chg">Casting from primitive types to primitive types</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#casting-from-primitive-to-primitive"><span class="add_version"><span class="secno">24.1 </span><span class="content toc-chg">Casting from primitive types to primitive types</span></span><span class="modify_version"><span class="secno">24.1 </span><span class="content toc-chg">Casting from primitive types to primitive types</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#casting-from-primitive-to-primitive"><span style="display: none;" class="delete_version"><span class="secno">23.1 </span><span class="content toc-chg">Casting from primitive types to primitive types</span></span><span style="display: none;" class="add_version"><span class="secno">24.1 </span><span class="content toc-chg">Casting from primitive types to primitive types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1</span><span class="deltaxml-new" style="background:#90EE90">24.1</span> </span><span class="content toc-chg">Casting from primitive types to primitive types</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#casting-to-untypedAtomic"><span style="display: none;" class="delete_version"><span class="secno">23.1.1 </span><span class="content">Casting to xs:untypedAtomic</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.1 </span><span class="content">Casting to xs:untypedAtomic</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.1</span><span class="deltaxml-new" style="background:#90EE90">24.1.1</span> </span><span class="content">Casting to xs:untypedAtomic</span></span></a></summary></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#casting-to-string"><span class="delete_version"><span class="secno">23.1.2 </span><span class="content">Casting to xs:string</span></span><span class="modify_version"><span class="secno">23.1.2 </span><span class="content">Casting to xs:string</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#casting-to-string"><span class="add_version"><span class="secno">24.1.2 </span><span class="content">Casting to xs:string</span></span><span class="modify_version"><span class="secno">24.1.2 </span><span class="content">Casting to xs:string</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#casting-to-string"><span style="display: none;" class="delete_version"><span class="secno">23.1.2 </span><span class="content">Casting to xs:string</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.2 </span><span class="content">Casting to xs:string</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.2</span> </span><span class="content">Casting to xs:string</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#casting-numeric-to-string"><span style="display: none;" class="delete_version"><span class="secno">23.1.2.1 </span><span class="content">Casting numeric values to xs:string</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.2.1 </span><span class="content">Casting numeric values to xs:string</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.2.1</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.1</span> </span><span class="content">Casting numeric values to xs:string</span></span></a></summary></details></li><li><details><summary><a href="#casting-date-time-to-string"><span style="display: none;" class="delete_version"><span class="secno">23.1.2.2 </span><span class="content toc-chg">Casting date/time values to xs:string</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.2.2 </span><span class="content toc-chg">Casting date/time values to xs:string</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.2.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.2</span> </span><span class="content toc-chg">Casting date/time values to xs:string</span></span></a></summary></details></li><li><details><summary><a href="#casting-duration-to-string"><span style="display: none;" class="delete_version"><span class="secno">23.1.2.3 </span><span class="content toc-chg">Casting xs:duration values to xs:string</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.2.3 </span><span class="content toc-chg">Casting xs:duration values to xs:string</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.2.3</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.3</span> </span><span class="content toc-chg">Casting xs:duration values to xs:string</span></span></a></summary></details></li></ol></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#casting-to-numerics"><span class="delete_version"><span class="secno">23.1.3 </span><span class="content">Casting to numeric types</span></span><span class="modify_version"><span class="secno">23.1.3 </span><span class="content">Casting to numeric types</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#casting-to-numerics"><span class="add_version"><span class="secno">24.1.3 </span><span class="content">Casting to numeric types</span></span><span class="modify_version"><span class="secno">24.1.3 </span><span class="content">Casting to numeric types</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#casting-to-numerics"><span style="display: none;" class="delete_version"><span class="secno">23.1.3 </span><span class="content">Casting to numeric types</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.3 </span><span class="content">Casting to numeric types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.3</span><span class="deltaxml-new" style="background:#90EE90">24.1.3</span> </span><span class="content">Casting to numeric types</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#casting-to-float"><span style="display: none;" class="delete_version"><span class="secno">23.1.3.1 </span><span class="content">Casting to xs:float</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.3.1 </span><span class="content">Casting to xs:float</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.1.3.1</span> </span><span class="content">Casting to xs:float</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-double"><span style="display: none;" class="delete_version"><span class="secno">23.1.3.2 </span><span class="content">Casting to xs:double</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.3.2 </span><span class="content">Casting to xs:double</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.3.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.3.2</span> </span><span class="content">Casting to xs:double</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-decimal"><span style="display: none;" class="delete_version"><span class="secno">23.1.3.3 </span><span class="content">Casting to xs:decimal</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.3.3 </span><span class="content">Casting to xs:decimal</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.3.3</span><span class="deltaxml-new" style="background:#90EE90">24.1.3.3</span> </span><span class="content">Casting to xs:decimal</span></span></a></summary></details></li></ol></details></li><li><details><summary><a href="#casting-to-durations"><span style="display: none;" class="delete_version"><span class="secno">23.1.4 </span><span class="content">Casting to duration types</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.4 </span><span class="content">Casting to duration types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.4</span><span class="deltaxml-new" style="background:#90EE90">24.1.4</span> </span><span class="content">Casting to duration types</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-datetimes"><span style="display: none;" class="delete_version"><span class="secno">23.1.5 </span><span class="content">Casting to date and time types</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.5 </span><span class="content">Casting to date and time types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.5</span><span class="deltaxml-new" style="background:#90EE90">24.1.5</span> </span><span class="content">Casting to date and time types</span></span></a></summary></details></li><li><details><summary><a href="#casting-boolean"><span style="display: none;" class="delete_version"><span class="secno">23.1.6 </span><span class="content">Casting to xs:boolean</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.6 </span><span class="content">Casting to xs:boolean</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.6</span><span class="deltaxml-new" style="background:#90EE90">24.1.6</span> </span><span class="content">Casting to xs:boolean</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-binary"><span style="display: none;" class="delete_version"><span class="secno">23.1.7 </span><span class="content">Casting to xs:base64Binary and xs:hexBinary</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.7 </span><span class="content">Casting to xs:base64Binary and xs:hexBinary</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.7</span><span class="deltaxml-new" style="background:#90EE90">24.1.7</span> </span><span class="content">Casting to xs:base64Binary and xs:hexBinary</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-anyuri"><span style="display: none;" class="delete_version"><span class="secno">23.1.8 </span><span class="content">Casting to xs:anyURI</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.8 </span><span class="content">Casting to xs:anyURI</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.8</span><span class="deltaxml-new" style="background:#90EE90">24.1.8</span> </span><span class="content">Casting to xs:anyURI</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-qname-and-notation"><span style="display: none;" class="delete_version"><span class="secno">23.1.9 </span><span class="content">Casting to xs:QName and xs:NOTATION</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.9 </span><span class="content">Casting to xs:QName and xs:NOTATION</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.9</span><span class="deltaxml-new" style="background:#90EE90">24.1.9</span> </span><span class="content">Casting to xs:QName and xs:NOTATION</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-ENTITY"><span style="display: none;" class="delete_version"><span class="secno">23.1.10 </span><span class="content">Casting to xs:ENTITY</span></span><span style="display: none;" class="add_version"><span class="secno">24.1.10 </span><span class="content">Casting to xs:ENTITY</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.1.10</span><span class="deltaxml-new" style="background:#90EE90">24.1.10</span> </span><span class="content">Casting to xs:ENTITY</span></span></a></summary></details></li></ol></details></li><li><details><summary><a href="#casting-from-strings"><span style="display: none;" class="delete_version"><span class="secno">23.2 </span><span class="content toc-chg">Casting from xs:string and xs:untypedAtomic</span></span><span style="display: none;" class="add_version"><span class="secno">24.2 </span><span class="content toc-chg">Casting from xs:string and xs:untypedAtomic</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> </span><span class="content toc-chg">Casting from xs:string and xs:untypedAtomic</span></span></a></summary></details></li><li><details><summary><span style="display: none;" class="delete_version"><a href="#casting-non-primitive-types"><span class="delete_version"><span class="secno">23.3 </span><span class="content">Casting involving non-primitive types</span></span><span class="modify_version"><span class="secno">23.3 </span><span class="content">Casting involving non-primitive types</span></span></a><span class="exptoc collapsed"></span></span><span style="display: none;" class="add_version"><a href="#casting-non-primitive-types"><span class="add_version"><span class="secno">24.3 </span><span class="content">Casting involving non-primitive types</span></span><span class="modify_version"><span class="secno">24.3 </span><span class="content">Casting involving non-primitive types</span></span></a><span class="exptoc collapsed"></span></span><span class="modify_version"><a href="#casting-non-primitive-types"><span style="display: none;" class="delete_version"><span class="secno">23.3 </span><span class="content">Casting involving non-primitive types</span></span><span style="display: none;" class="add_version"><span class="secno">24.3 </span><span class="content">Casting involving non-primitive types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.3</span><span class="deltaxml-new" style="background:#90EE90">24.3</span> </span><span class="content">Casting involving non-primitive types</span></span></a><span class="exptoc collapsed"></span></span></summary><ol class="toc"><li><details><summary><a href="#casting-to-derived-types"><span style="display: none;" class="delete_version"><span class="secno">23.3.1 </span><span class="content">Casting to derived types</span></span><span style="display: none;" class="add_version"><span class="secno">24.3.1 </span><span class="content">Casting to derived types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> </span><span class="content">Casting to derived types</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-integer"><span style="display: none;" class="delete_version"><span class="secno">23.3.2 </span><span class="content">Casting to xs:integer</span></span><span style="display: none;" class="add_version"><span class="secno">24.3.2 </span><span class="content">Casting to xs:integer</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.3.2</span><span class="deltaxml-new" style="background:#90EE90">24.3.2</span> </span><span class="content">Casting to xs:integer</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-duration-subtypes"><span style="display: none;" class="delete_version"><span class="secno">23.3.3 </span><span class="content">Casting to xs:yearMonthDuration and xs:dayTimeDuration</span></span><span style="display: none;" class="add_version"><span class="secno">24.3.3 </span><span class="content">Casting to xs:yearMonthDuration and xs:dayTimeDuration</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.3.3</span><span class="deltaxml-new" style="background:#90EE90">24.3.3</span> </span><span class="content">Casting to xs:yearMonthDuration and xs:dayTimeDuration</span></span></a></summary></details></li><li><details><summary><a href="#casting-from-derived-to-parent"><span style="display: none;" class="delete_version"><span class="secno">23.3.4 </span><span class="content">Casting from derived types to parent types</span></span><span style="display: none;" class="add_version"><span class="secno">24.3.4 </span><span class="content">Casting from derived types to parent types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.3.4</span><span class="deltaxml-new" style="background:#90EE90">24.3.4</span> </span><span class="content">Casting from derived types to parent types</span></span></a></summary></details></li><li><details><summary><a href="#casting-within-branch"><span style="display: none;" class="delete_version"><span class="secno">23.3.5 </span><span class="content">Casting within a branch of the type hierarchy</span></span><span style="display: none;" class="add_version"><span class="secno">24.3.5 </span><span class="content">Casting within a branch of the type hierarchy</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.3.5</span><span class="deltaxml-new" style="background:#90EE90">24.3.5</span> </span><span class="content">Casting within a branch of the type hierarchy</span></span></a></summary></details></li><li><details><summary><a href="#casting-across-hierarchy"><span style="display: none;" class="delete_version"><span class="secno">23.3.6 </span><span class="content">Casting across the type hierarchy</span></span><span style="display: none;" class="add_version"><span class="secno">24.3.6 </span><span class="content">Casting across the type hierarchy</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.3.6</span><span class="deltaxml-new" style="background:#90EE90">24.3.6</span> </span><span class="content">Casting across the type hierarchy</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-union"><span style="display: none;" class="delete_version"><span class="secno">23.3.7 </span><span class="content">Casting to union types</span></span><span style="display: none;" class="add_version"><span class="secno">24.3.7 </span><span class="content">Casting to union types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.3.7</span><span class="deltaxml-new" style="background:#90EE90">24.3.7</span> </span><span class="content">Casting to union types</span></span></a></summary></details></li><li><details><summary><a href="#casting-to-list"><span style="display: none;" class="delete_version"><span class="secno">23.3.8 </span><span class="content">Casting to list types</span></span><span style="display: none;" class="add_version"><span class="secno">24.3.8 </span><span class="content">Casting to list types</span></span><span class="modify_version"><span class="secno"><span class="deltaxml-old" style="background:#FF5555">23.3.8</span><span class="deltaxml-new" style="background:#90EE90">24.3.8</span> </span><span class="content">Casting to list types</span></span></a></summary></details></li></ol></details></li></ol></details></li><li><details><summary><a href="#biblio"><span class="secno">A </span><span class="content">References</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#normative-biblio"><span class="secno">A.1 </span><span class="content">Normative references</span></a></summary></details></li><li><details><summary><a href="#non-normative-biblio"><span class="secno">A.2 </span><span class="content">Non-normative references</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#error-summary"><span class="secno">B </span><span class="content">Error codes</span></a></summary></details></li><li><details><summary><a href="#id-built-in-named-record-types"><span class="secno">C </span><span class="content toc-chg">Built-in named record types</span></a></summary></details></li><li><details><summary><a href="#schemata"><span class="secno">D </span><span class="content toc-chg">Schemas</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#schema-for-analyze-string"><span class="secno">D.1 </span><span class="content">Schema for the result of fn:analyze-string</span></a></summary></details></li><li><details><summary><a href="#schema-for-json"><span class="secno">D.2 </span><span class="content">Schema for the result of fn:json-to-xml</span></a></summary></details></li><li><details><summary><a href="#schema-for-csv"><span class="secno">D.3 </span><span class="content">Schema for the result of fn:csv-to-xml</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#glossary"><span class="secno">E </span><span class="content">Glossary</span></a></summary></details></li><li><details><summary><a href="#other-functions"><span class="secno">F </span><span class="content">Functions defined elsewhere</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#functions-in-other-w3c-specs"><span class="secno">F.1 </span><span class="content">XPath Functions Defined in Other W3C Recommendations</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#functions-defined-in-XSLT"><span class="secno">F.1.1 </span><span class="content">Functions Defined in XSLT</span></a></summary></details></li><li><details><summary><a href="#functions-defined-in-XForms"><span class="secno">F.1.2 </span><span class="content">Functions Defined in XForms</span></a></summary></details></li><li><details><summary><a href="#xquery-update"><span class="secno">F.1.3 </span><span class="content">Function Defined in XQuery Update 1.0</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#functions-defined-by-community-groups"><span class="secno">F.2 </span><span class="content">Functions Defined by Community Groups</span></a></summary></details></li><li><details><summary><a href="#functx-library"><span class="secno">F.3 </span><span class="content">The FunctX Library</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#impl-def"><span class="secno">G </span><span class="content">Implementation-defined features</span></a></summary></details></li><li><details><summary><a href="#changelog"><span class="secno">H </span><span class="content">Changes since 3.1</span></a><span class="exptoc collapsed"></span></summary><ol class="toc"><li><details><summary><a href="#changes-summary"><span class="secno">H.1 </span><span class="content">Summary of Changes</span></a></summary></details></li><li><details><summary><a href="#changes-to-casts-and-constructors"><span class="secno">H.2 </span><span class="content">Changes to Casts and Constructor Functions</span></a></summary></details></li><li><details><summary><a href="#miscellaneous-changes"><span class="secno">H.3 </span><span class="content">Miscellaneous Changes</span></a></summary></details></li><li><details><summary><a href="#editorial-changes"><span class="secno">H.4 </span><span class="content">Editorial Changes</span></a></summary></details></li></ol></details></li><li><details><summary><a href="#back-compatibility"><span class="secno">I </span><span class="content">Backward compatibility</span></a></summary></details></li></ol></nav><hr><div class="body"><div class="div1"><h2><a id="intro"></a>1 <a href="#intro" style="text-decoration: none">Introduction</a></h2><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#conformance">next</a>)</p><ol><li><p>If a section of this specification has been updated since version 3.1, an overview of the changes is provided, along with links to navigate to the next or previous change.</p></li><li><p>Sections with significant changes are marked with a ✭ symbol in the table of contents. New functions are indicated by ✚.</p></li></ol></div><p>The purpose of this document is to define functions and operators for inclusion in XPath 4.0, XQuery 4.0, and XSLT 4.0. The exact syntax used to call these functions and operators is specified in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a>, <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> and <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a>. </p><p>This document defines three classes of functions:</p><ul><li><p>General purpose functions, available for direct use in user-written queries, stylesheets, and XPath expressions, whose arguments and results are values defined by the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p></li><li><p>Constructor functions, used for creating instances of a datatype from values of (in general) a different datatype. These functions are also available for general use; they are named after the datatype that they return, and they always take a single argument.</p></li><li><p>Functions that specify the semantics of operators defined in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> and <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a>. These exist for specification purposes only, and are not intended for direct calling from user-written code.</p></li></ul><p><a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> defines a number of primitive and derived datatypes, collectively known as built-in datatypes. This document defines functions and operations on these datatypes as well as the other types (for example, nodes and sequences of nodes) defined in <a href="https://www.w3.org/TR/xpath-datamodel-31/#types"> 2.7 Schema Information </a><sup><small>DM31</small></sup> of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. These functions and operations are available for use in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a>, <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> and any other host language that chooses to reference them. In particular, they may be referenced in future versions of XSLT and related XML standards. </p><p><a href="#xmlschema11-2">[XSD 1.1 Part 2]</a> adds to the datatypes defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>. It introduces a new derived type <code>xs:dateTimeStamp</code>, and it incorporates as built-in types the two types <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code> which were previously XDM additions to the type system. In addition, XSD 1.1 clarifies and updates many aspects of the definitions of the existing datatypes: for example, it extends the value space of <code>xs:double</code> to allow both positive and negative zero, and extends the lexical space to allow <code>+INF</code>; it modifies the value space of <code>xs:Name</code> to permit additional Unicode characters; it allows year zero and disallows leap seconds in <code>xs:dateTime</code> values; and it allows any character string to appear as the value of an <code>xs:anyURI</code> item. Implementations of this specification <span class="verb">may</span> support either XSD 1.0 or XSD 1.1 or both.</p><p>In some cases, this specification references XSD for the semantics of operations such as the effect of matching using regular expressions, or conversion of atomic items to strings. In most such cases there is no intended technical difference between the XSD 1.0 and XSD 1.1 specifications, but the 1.1 version often provides clearer explanations and sometimes also corrects technical errors. In such cases this specification often chooses to reference the XSD 1.1 specification. This should not be taken as implying that it is necessary to invoke an XSD 1.1 processor.</p><p>References to specific sections of some of the above documents are indicated by cross-document links in this document. Each such link consists of a pointer to a specific section followed a superscript specifying the linked document. The superscripts have the following meanings: XQ <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a>, XT <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a>, XP <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a>, and DM <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p><div class="div2"><h3><a id="operators"></a>1.1 <a href="#operators" style="text-decoration: none">Operators</a></h3><p>Despite its title, this document does not attempt to define the semantics of all the operators available in the <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> language; indeed, in the interests of avoiding duplication, the majority of operators are now defined entirely within <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> (for XQuery, the definitions are also found in <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a>, and are generally identical).</p><p>The remaining operators that are described in this publication are the arithmetic operators, where the semantics of the operator depend on the types of the arguments. For these operators, the language specification describes rules for selecting an internal function defined in this specification to underpin the operator. For example, when the operator <code>x+y</code> is applied to two operands of type <code>xs:double</code>, the function <a href="#func-numeric-add"><code>op:numeric-add</code></a> is selected.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Previous versions of this specification also defined the value comparison operators such as <code>eq</code>, <code>lt</code>, and <code>gt</code> in terms of functions such as <code>op:date-greater-than</code>. These have been dropped; for most data types the semantics of the value comparison operators are defined by reference to the <a href="#func-compare"><code>fn:compare</code></a> function.</p></div></div><div class="div2"><h3><a id="conformance"></a>1.2 <a href="#conformance" style="text-decoration: none">Conformance</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#options">next</a> | <a href="#intro">previous</a>)</p><ol><li><p>Higher-order functions are no longer an optional feature.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/205">205</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/326">326</a>&nbsp;1 February 2023]</i></p></li></ol></div><p> This recommendation contains a set of function specifications. It defines conformance at the level of individual functions. An implementation of a function conforms to a function specification in this recommendation if all the following conditions are satisfied:</p><ul><li><p>For all combinations of valid inputs to the function (both explicit arguments and implicit context dependencies), the result of the function meets the mandatory requirements of this specification. </p></li><li><p>For all invalid inputs to the function, the implementation raises (in some way appropriate to the calling environment) a dynamic error. </p></li><li><p>For a sequence of calls within the same <a title="execution scope" class="termref" href="#execution-scope">execution scope</a>, the requirements of this recommendation regarding the <a title="deterministic" class="termref" href="#dt-deterministic">determinism</a> of results are satisfied (see <a href="#properties-of-functions"><b>1.9.5 Properties of functions</b></a>). </p></li></ul><p>Other recommendations (“host languages”) that reference this document may dictate:</p><ul><li><p>Subsets or supersets of this set of functions to be available in particular environments;</p></li><li><p>Mechanisms for invoking functions, supplying arguments, initializing the static and dynamic context, receiving results, and handling errors; </p></li><li><p>A concrete realization of concepts such as <a title="execution scope" class="termref" href="#execution-scope">execution scope</a>;</p></li><li><p>Which versions of other specifications referenced herein (for example, XML, XSD, or Unicode) are to be used.</p></li></ul><p>Any behavior that is discretionary (implementation-defined or implementation-dependent) in this specification may be constrained by a host language.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Adding such constraints in a host language, however, is discouraged because it makes it difficult to reuse implementations of the function library across host languages.</p></div><p>This specification allows flexibility in the choice of versions of specifications on which it depends:</p><ul><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which version of Unicode is supported, but it is recommended that the most recent version of Unicode be used. </p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether the type system is based on XML Schema 1.0 or XML Schema 1.1. </p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether definitions that rely on XML (for example, the set of valid XML characters) should use the definitions in XML 1.0 or XML 1.1.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>The XML Schema 1.1 recommendation introduces one new concrete datatype: <code>xs:dateTimeStamp</code>; it also incorporates the types <code>xs:dayTimeDuration</code>, <code>xs:yearMonthDuration</code>, and <code>xs:anyAtomicType</code> which were previously defined in earlier versions of <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. Furthermore, XSD 1.1 includes the option of supporting revised definitions of types such as <code>xs:NCName</code> based on the rules in XML 1.1 rather than 1.0.</p></div><p>The <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> allows flexibility in the repertoire of characters permitted during processing that goes beyond even what version of XML is supported. A processor <span class="verb">may</span> allow the user to construct nodes and atomic items that contain characters not allowed by any version of XML. <span class="termdef"><a id="dt-permitted-character"></a>[Definition] A <b>permitted character</b> is one within the repertoire accepted by the implementation.</span></p><p>In this document, text labeled as an example or as a note is provided for explanatory purposes and is not normative.</p></div><div class="div2"><h3><a id="namespace-prefixes"></a>1.3 <a href="#namespace-prefixes" style="text-decoration: none">Namespaces and prefixes</a></h3><p>The functions and operators defined in this document are contained in one of several namespaces (see <a href="#xml-names">[Namespaces in XML]</a>) and referenced using an <code>xs:QName</code>.</p><p>This document uses conventional prefixes to refer to these namespaces. User-written applications can choose a different prefix to refer to the namespace, so long as it is bound to the correct URI. The host language may also define a default namespace for function calls, in which case function names in that namespace need not be prefixed at all. In many cases the default namespace will be <code>http://www.w3.org/2005/xpath-functions</code>, allowing a call on the <a href="#func-name"><code>fn:name</code></a> function (for example) to be written as <code>name()</code> rather than <code>fn:name()</code>; in this document, however, all example function calls are explicitly prefixed.</p><p>The URIs of the namespaces and the conventional prefixes associated with them are:</p><ul><li><p><code>http://www.w3.org/2001/XMLSchema</code> for constructors — associated with <code>xs</code>. </p><p><span style="display: none;" class="delete_version">The section <a href="#constructor-functions"><span class="delete_version"><b>22 Constructor functions</b></span><span class="modify_version"><b>22 Constructor functions</b></span></a> defines constructor functions for the built-in datatypes defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> and in <a href="https://www.w3.org/TR/xpath-datamodel-31/#types"> 2.7 Schema Information </a><sup><small>DM31</small></sup> of <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. These datatypes and the corresponding constructor functions are in the XML Schema namespace, <code>http://www.w3.org/2001/XMLSchema</code>, and are named in this document using the <code>xs</code> prefix. </span><span style="display: none;" class="add_version">The section <a href="#constructor-functions"><span class="add_version"><b>23 Constructor functions</b></span><span class="modify_version"><b>23 Constructor functions</b></span></a> defines constructor functions for the built-in datatypes defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> and in <a href="https://www.w3.org/TR/xpath-datamodel-31/#types"> 2.7 Schema Information </a><sup><small>DM31</small></sup> of <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. These datatypes and the corresponding constructor functions are in the XML Schema namespace, <code>http://www.w3.org/2001/XMLSchema</code>, and are named in this document using the <code>xs</code> prefix. </span><span class="modify_version">The section <a href="#constructor-functions"><span style="display: none;" class="delete_version"><b>22 Constructor functions</b></span><span style="display: none;" class="add_version"><b>23 Constructor functions</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22</span><span class="deltaxml-new" style="background:#90EE90">23</span> Constructor functions</b></span></a> defines constructor functions for the built-in datatypes defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> and in <a href="https://www.w3.org/TR/xpath-datamodel-31/#types"> 2.7 Schema Information </a><sup><small>DM31</small></sup> of <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. These datatypes and the corresponding constructor functions are in the XML Schema namespace, <code>http://www.w3.org/2001/XMLSchema</code>, and are named in this document using the <code>xs</code> prefix. </span></p></li><li><p><code>http://www.w3.org/2005/xpath-functions</code> for functions — associated with <code>fn</code>. </p><p>The namespace prefix used in this document for most functions that are available to users is <code>fn</code>.</p></li><li><p><code>http://www.w3.org/2005/xpath-functions/math</code> for functions — associated with <code>math</code>. </p><p>This namespace is used for some mathematical functions. The namespace prefix used in this document for these functions is <code>math</code>. These functions are available to users in exactly the same way as those in the <code>fn</code> namespace.</p></li><li><p><code>http://www.w3.org/2005/xpath-functions/map</code> for functions — associated with <code>map</code>. </p><p>This namespace is used for some functions that manipulate maps (see <a href="#map-functions"><b>14.4 Functions that operate on maps</b></a>). The namespace prefix used in this document for these functions is <code>map</code>. These functions are available to users in exactly the same way as those in the <code>fn</code> namespace.</p></li><li><p><code>http://www.w3.org/2005/xpath-functions/array</code> for functions — associated with <code>array</code>. </p><p>This namespace is used for some functions that manipulate maps (see <a href="#array-functions"><b>15.2 Functions that operate on arrays</b></a>). The namespace prefix used in this document for these functions is <code>array</code>. These functions are available to users in exactly the same way as those in the <code>fn</code> namespace.</p></li><li class="add_version" style="display: none;"><p><code>http://www.w3.org/2005/xpath-functions/generators</code> for functions — associated with <code>generators</code>. </p><p>This namespace is used for some functions that manipulate generators (see <a href="#generator-functions"><b>18.4 Functions on generators</b></a>). The namespace prefix used in this document for these functions is <code>gn</code>. These functions are available to users in exactly the same way as those in the <code>fn</code> namespace.</p></li><li class="modify_version"><p><code><span class="deltaxml-new" style="background:#90EE90">http://www.w3.org/2005/xpath-functions/generators</span></code><span class="deltaxml-new" style="background:#90EE90"> for functions — associated with </span><code><span class="deltaxml-new" style="background:#90EE90">generators</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p><p><span class="deltaxml-new" style="background:#90EE90">This namespace is used for some functions that manipulate generators (see </span><a href="#generator-functions"><b><span class="deltaxml-new" style="background:#90EE90">18.4 Functions on generators</span></b></a><span class="deltaxml-new" style="background:#90EE90">). The namespace prefix used in this document for these functions is </span><code><span class="deltaxml-new" style="background:#90EE90">gn</span></code><span class="deltaxml-new" style="background:#90EE90">. These functions are available to users in exactly the same way as those in the </span><code><span class="deltaxml-new" style="background:#90EE90">fn</span></code><span class="deltaxml-new" style="background:#90EE90"> namespace.</span></p></li><li><p><code>http://www.w3.org/2005/xqt-errors</code> — associated with <code>err</code>. </p><p>There are no functions in this namespace; it is used for error codes.</p><p>This document uses the prefix <code>err</code> to represent the namespace URI <code>http://www.w3.org/2005/xqt-errors</code>, which is the namespace for all XPath and XQuery error codes and messages. This namespace prefix is not predeclared and its use in this document is not normative.</p></li><li><p><code>http://www.w3.org/2010/xslt-xquery-serialization</code> — associated with <code>output</code>. </p><p>There are no functions in this namespace: it is used for serialization parameters, as described in <a href="#xslt-xquery-serialization-31">[XSLT and XQuery Serialization 3.1]</a></p></li><li><p> Functions defined with the <code>op</code> prefix are described here to underpin the definitions of the operators in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a>, <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> and <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a>. These functions are not available directly to users, and there is no requirement that implementations should actually provide these functions. For this reason, no namespace is associated with the <code>op</code> prefix. For example, multiplication is generally associated with the <code>*</code> operator, but it is described as a function in this document:</p><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:numeric-multiply</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric</code></code></td></tr></tbody></table></div><p>Sometimes there is a need to use an operator as a function. To meet this requirement, the function <a href="#func-op"><code>fn:op</code></a> takes any simple binary operator as its argument, and returns a corresponding function. So for example <code>fn:for-each-pair($seq1, $seq2, op("+"))</code> performs a pairwise addition of the values in two input sequences.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>The above namespace URIs are not expected to change from one version of this document to another. The contents of these namespaces may be extended to allow additional functions (and errors, and serialization parameters) to be defined.</p></div></div><div class="div2"><h3><a id="func-overloading"></a>1.4 <a href="#func-overloading" style="text-decoration: none">Function overloading</a></h3><p>A function is uniquely defined by its name and arity (number of arguments); it is therefore not possible to have two different functions that have the same name and arity, but different types in their signature. That is, function overloading in this sense of the term is not permitted. Consequently, functions such as <a href="#func-string"><code>fn:string</code></a> which accept arguments of many different types have a signature that defines a very general argument type, in this case <code>item()?</code> which accepts any single item; supplying an inappropriate item (such as a function item) causes a dynamic error.</p><p>Some functions on numeric types include the type <code>xs:numeric</code> in their signature as an argument or result type. In this version of the specification, <code>xs:numeric</code> has been redefined as a built-in union type representing the union of <code>xs:decimal</code>, <code>xs:float</code>, <code>xs:double</code> (and thus automatically accepting types derived from these, including <code>xs:integer</code>).</p><p>Operators such as <code>+</code> may be overloaded: they map to different underlying functions depending on the dynamic types of the supplied operands.</p><p>It is possible for two functions to have the same name provided they have different arity (number of arguments). For the functions defined in this specification, where two functions have the same name and different arity, they also have closely related behavior, so they are defined in the same section of this document.</p></div><div class="div2"><h3><a id="func-signatures"></a>1.5 <a href="#func-signatures" style="text-decoration: none">Function signatures and descriptions</a></h3><p>Each function (or group of functions having the same name) is defined in this specification using a standard proforma. This has the following sections:</p><div class="div3"><h4><a id="id-function-signatures-name"></a>1.5.1 <a href="#id-function-signatures-name" style="text-decoration: none">Function name</a></h4><p>The function name is a <code>QName</code> as defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> and must adhere to its syntactic conventions. Following the precedent set by <a href="#xpath">[XML Path Language (XPath) Version 1.0]</a>, function names are generally composed of English words separated by hyphens: specifically <span class="unicode-codepoint">U+002D</span> (<span class="unicode-name">HYPHEN-MINUS</span>, <code>-</code>) . Abbreviations are used only where there is a strong precedent in other programming languages (as with <a href="#func-math-sin"><code>math:sin</code></a> and <a href="#func-math-cos"><code>math:cos</code></a> for sine and cosine). If a function name contains a <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> datatype name, it may have intercapitalized spelling and is used in the function name as such. An example is <a href="#func-timezone-from-dateTime"><code>fn:timezone-from-dateTime</code></a>.</p></div><div class="div3"><h4><a id="id-function-signatures-summary"></a>1.5.2 <a href="#id-function-signatures-summary" style="text-decoration: none">Function summary</a></h4><p>The first section in the proforma is a short summary of what the function does. This is intended to be informative rather than normative.</p></div><div class="div3"><h4><a id="id-function-signatures-signature"></a>1.5.3 <a href="#id-function-signatures-signature" style="text-decoration: none">Function signature</a></h4><p>Each function is then defined by specifying its signature(s), which define the types of the parameters and of the result value.</p><p>Where functions take a variable number of arguments, two conventions are used:</p><ul><li><p>Wherever possible, a single function signature is used giving default values for those parameters that can be omitted.</p></li><li><p>If this is not possible, because the effect of omitting a parameter cannot be specified by giving a default value, multiple signatures are given for the function.</p></li></ul><p>Each function signature is presented in a form like this:</p><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:function-name</code>(</td></tr><tr class="arg"><td><code>$parameter-name</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>parameter-type</code></code>,</td><td></td></tr><tr class="arg"><td><code>$...</code></td><td><code class="as">as&nbsp;</code><code class="type"><code></code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>return-type</code></code></td></tr></tbody></table></div><p>In this notation, <b>function-name</b>, in bold-face, is the <span>local</span> name of the function whose signature is being specified. <span>The prefix <b>fn</b> indicates that the function is in the namespace <code>http://www.w3.org/2005/xpath-functions</code>: this is one of the conventional prefixes listed in <a href="#namespace-prefixes"><b>1.3 Namespaces and prefixes</b></a>.</span> If the function takes no parameters, then the name is followed by an empty parameter list: <code>()</code>; otherwise, the name is followed by a parenthesized list of parameter declarations. Each parameter declaration includes:</p><ul><li><p>The name of the parameter (which in 4.0 is significant because it can be used as a keyword in a function call)</p></li><li><p>The static type of the parameter (in italics)</p></li><li><p>If the parameter is optional, then an expression giving the default value (preceded by the symbol <code>:=</code>).</p><p>The default value expression is evaluated using the static and dynamic context of the function caller (or of a named function reference). For example, if the default value is given as <code>.</code>, then it evaluates to the context value from the dynamic context of the function caller; if it is given as <code>default-collation</code>, then its value is the default collation from the static context of the function caller; if it is given as <code>deep-equal#2</code>, then the third argument supplied to <code>deep-equal</code> is the default collation from the static context of the caller.</p></li></ul><p>If there are two or more parameter declarations, they are separated by a comma.</p><p>The <em><code>return-type</code></em>, also in italics, specifies the static type of the value returned by the function. The dynamic type of the value returned by the function is the same as its static type or derived from the static type. All parameter types and return types are specified using the SequenceType notation defined in <a href="https://www.w3.org/TR/xpath-31/#id-sequencetype-syntax"> 2.5.4 SequenceType Syntax </a><sup><small>XP31</small></sup>.</p></div><div class="div3"><h4><a id="id-function-signatures-rules"></a>1.5.4 <a href="#id-function-signatures-rules" style="text-decoration: none">Function rules</a></h4><p>The next section in the proforma defines the semantics of the function as a set of rules. The order in which the rules appear is significant; they are to be applied in the order in which they are written. Error conditions, however, are generally listed in a separate section that follows the main rules, and take precedence over non-error rules except where otherwise stated. The principles outlined in <a href="https://www.w3.org/TR/xpath-31/#id-errors-and-opt"> 2.3.4 Errors and Optimization </a><sup><small>XP31</small></sup> apply by default: to paraphrase, if the result of the function can be determined without evaluating all its arguments, then it is not necessary to evaluate the remaining arguments merely in order to determine whether any error conditions apply.</p></div><div class="div3"><h4><a id="id-function-signatures-formal-specification"></a>1.5.5 <a href="#id-function-signatures-formal-specification" style="text-decoration: none">Formal Equivalents</a></h4><p>Some functions supplement the prose rules with a more formal specification that describes the effect of the function in terms of an equivalent XPath or XQuery implementation. This is intended to take precedence over the prose rules in the event of any conflict; however, both sections are intended to be complete and not to rely on each other.</p><p>In writing the formal equivalents, a number of guidelines have been followed:</p><ol class="enumar"><li><p>Where the equivalent code calls other functions, these should either be primitives defined in the data model specification (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>), or functions that themselves have a formal equivalent; and the dependencies should not be circular.</p></li><li><p>There should be minimal reliance on XPath or XQuery language features. Although no attempt has been made to precisely define a core set of language constructs, the specifications try to avoid relying on features other than function calls and a few basic operators including the comma operator, equality testing, and simple integer arithmetic.</p></li><li><p>There is no suggestion that the formal equivalent is a practical implementation; in many cases it might have very poor performance.</p></li><li><p>In some cases the formal equivalent does not attempt to replicate correct behavior in error cases; if so, this is always clearly stated.</p></li><li><p>The formal equivalent will always produce a conformant result for the function, but in some cases this will not be the only possible conformant result.</p></li></ol><table class="ednote" caption="Editorial note"><tbody><tr><td style="text-align: left; vertical-align:top; width: 50%;"><b>Editorial note</b></td><td style="text-align: right; vertical-align:top; width: 50%;">&nbsp;</td></tr><tr style="text-align: left; vertical-align: top;"><td colspan="2">This worthy intent is not yet fully achieved; for example there are formal specifications that invoke fn:atomic-equal.</td></tr></tbody></table><p>There is no attempt to write formal equivalents for functions that have complex logic (such as <a href="#func-format-number"><code>fn:format-number</code></a>) or dependencies (such as <a href="#func-doc"><code>fn:doc</code></a>); the aim of the formal equivalents is to define as rigorously as possible a platform of basic functionality that can be used as a solid foundation for more complex features.</p></div><div class="div3"><h4><a id="id-function-signatures-notes"></a>1.5.6 <a href="#id-function-signatures-notes" style="text-decoration: none">Notes</a></h4><p>Where the proforma includes a section headed <em>Notes</em>, these are non-normative.</p></div><div class="div3"><h4><a id="id-function-signatures-examples"></a>1.5.7 <a href="#id-function-signatures-examples" style="text-decoration: none">Examples</a></h4><p>Where the proforma includes a section headed <em>Examples</em>, these are non-normative.</p><p>Many of the examples are given in structured form, showing example expressions and their expected results. These published examples are derived from executable test cases, so they follow a standard format. In general, the actual result of the expression is expected to be deep-equal to the presented result, under the rules of the <a href="#func-deep-equal"><code>fn:deep-equal</code></a> function with default options. In some cases the result is qualified to indicate that the order of items in the result is implementation-dependent, or that numeric results are approximate.</p><p>For more complex functions, examples may be given using informal narrative prose.</p></div></div><div class="div2"><h3><a id="id-function-calls"></a>1.6 <a href="#id-function-calls" style="text-decoration: none">Function calls</a></h3><p>Rules for evaluating the operands of operators are described in the relevant sections of <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> and <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a>. For example, the rules for evaluating the operands of arithmetic operators are described in <a href="https://www.w3.org/TR/xpath-31/#id-arithmetic"> 3.5 Arithmetic Expressions </a><sup><small>XP31</small></sup>. Specifically, rules for parameters of type <code>xs:untypedAtomic</code> and the empty sequence are specified in this section.</p><p>For function calls, the required type of an argument is defined in the function signature of each function, and the way in which a supplied value is converted to the required type (or rejected if it cannot be converted) is defined by the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-coercion-rules">coercion rules</a><sup><small>XP</small></sup>.</p><p>Some functions accept a single value or the empty sequence as an argument and some may return a single value or the empty sequence. This is indicated in the function signature by following the parameter or return type name with a question mark: <code>?</code>, indicating that either a single value or the empty sequence must appear. See below.</p><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:function-name</code>(</td></tr><tr class="arg"><td><code>$parameter-name</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>parameter-type</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>return-type</code>?</code></td></tr></tbody></table></div><p>Note that this function signature is different from a signature in which the parameter is omitted. See, for example, the two signatures for <a href="#func-string"><code>fn:string</code></a>. In the first signature, the parameter is omitted and the argument defaults to the context value, referred to as <code>.</code>. In the second signature, the argument must be present but may be the empty sequence, written as <code>()</code>. </p><p>Some functions accept a sequence of zero or more values as an argument. This is indicated by following the name of the type of the items in the sequence with <code>*</code>. The sequence may contain zero or more items of the named type. For example, the function below accepts a sequence of <code>xs:double</code> and returns a <code>xs:double</code> or the empty sequence.</p><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:median</code>(</td></tr><tr class="arg"><td><code>$arg</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double</code>?</code></td></tr></tbody></table></div><p>In XPath 4.0, the arguments in a function call can be supplied by keyword as an alternative to supplying them positionally. For example the call <code>resolve-uri(@href, static-base-uri())</code> can now be written <code>resolve-uri(base: static-base-uri(), relative: @href)</code>. The order in which arguments are supplied can therefore differ from the order in which they are declared. The specification, however, continues to use phrases such as “the second argument” as a convenient shorthand for "the value of the argument that is bound to the second parameter declaration".</p></div><div class="div2"><h3><a id="options"></a>1.7 <a href="#options" style="text-decoration: none">Options</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#terminology">next</a> | <a href="#conformance">previous</a>)</p><ol><li><p> Use of an option keyword that is not defined in the specification and is not known to the implementation now results in a dynamic error; previously it was ignored. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1019">1019</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1059">1059</a>&nbsp;26 March 2024]</i></p></li></ol></div><p>As a matter of convention, a number of functions defined in this document take a parameter whose value is a map, defining options controlling the detail of how the function is evaluated. Maps are a new datatype introduced in XPath 3.1.</p><p>For example, the function <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> has an options parameter allowing specification of whether the output is to be indented. A call might be written:</p><div class="exampleInner"><pre xml:space="preserve">xml-to-json($input, { 'indent': true() })</pre></div><p><span class="termdef"><a id="option-parameter-conventions"></a>[Definition] Functions that take an options parameter adopt common conventions on how the options are used. These are referred to as the <b>option parameter conventions</b>. These rules apply only to functions that explicitly refer to them.</span></p><p>Where a function adopts the <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a>, the following rules apply:</p><ol class="enumar"><li><p>The value of the relevant argument must be a map. The entries in the map are referred to as options: the key of the entry is called the option name, and the associated value is the option value. Option names defined in this specification are always strings (single <code>xs:string</code> values). Option values may be of any type.</p></li><li><p>The type of the options parameter in the function signature is always given as <code>map(*)</code>.</p></li><li><p>Although option names are described above as strings, the actual key may be any value that is the <a title="same key" class="termref" href="#dt-same-key">same key</a> as the required string. For example, instances of <code>xs:untypedAtomic</code> or <code>xs:anyURI</code> are equally acceptable.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>This means that the implementation of the function can check for the presence and value of particular options using the functions <a href="#func-map-contains"><code>map:contains</code></a> and/or <a href="#func-map-get"><code>map:get</code></a>.</p></div></li><li><p>Implementations <span class="verb">may</span> attach an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> meaning to options in the map that are not described in this specification. These options <span class="verb">should</span> use values of type <code>xs:QName</code> as the option names, using an appropriate namespace.</p></li><li><p>If an option is present whose key is not described in the specification, then a type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup><span class="verb">must</span> be raised unless either (a) the key is recognized by the implementation, or (b) the key is a value of type <code>xs:QName</code> with a non-absent namespace.</p></li><li><p>All entries in the options map are optional, and supplying the empty map has the same effect as omitting the relevant argument in the function call, assuming this is permitted.</p></li><li><p>The ordering of the options map is immaterial.</p></li><li><p>For each named option, the function specification defines a required type for the option value. The value that is actually supplied in the map is converted to this required type using the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-coercion-rules">coercion rules</a><sup><small>XP</small></sup>. This will result in an error (typically [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> or [<a href="https://www.w3.org/TR/xpath-functions/#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>]<sup><small>FO</small></sup>) if conversion of the supplied value to the required type is not possible. A type error also occurs if this conversion delivers a coerced function whose invocation fails with a type error. A dynamic error occurs if the supplied value after conversion is not one of the permitted values for the option in question: the error codes for this error are defined in the specification of each function.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>It is the responsibility of each function implementation to invoke this conversion; it does not happen automatically as a consequence of the function-calling rules.</p></div></li><li><p>In cases where the value of an option is itself a map, the specification of the particular function must indicate whether or not these rules apply recursively to the contents of that map.</p></li></ol></div><div class="div2"><h3><a id="datatypes"></a>1.8 <a href="#datatypes" style="text-decoration: none">Type System</a></h3><p>The diagrams in this section show how nodes, functions, primitive simple types, and user defined types fit together into a type system. This type system comprises two distinct subsystems that both include the primitive atomic types. In the diagrams, connecting lines represent relationships between derived types and the types from which they are derived; the former are always below and to the right of the latter. </p><p>The <code>xs:IDREFS</code>, <code>xs:NMTOKENS</code>, <code>xs:ENTITIES</code> types, and <code>xs:numeric</code> and both the <code>user-defined list types</code> and <code>user-defined union types</code> are special types in that these types are lists or unions rather than types derived by extension or restriction.</p><div class="div3"><h4><a id="item-type-hierarchy"></a>1.8.1 <a href="#item-type-hierarchy" style="text-decoration: none">Item Types</a></h4><p>The first diagram illustrates the relationship of various item types.</p><p>Item types are used to characterize the various types of item that can appear in a sequence (nodes, atomic items, and functions), and they are therefore used in declaring the types of variables or the argument types and result types of functions.</p><p>In XDM, item types include node types, function types, and built-in atomic types. Item types form a directed graph, rather than a hierarchy or lattice: in the relationship defined by the <code>derived-from(A, B)</code> function, some types are derived from more than one other type. Examples include functions (<code>function(xs:string) as xs:int</code> is substitutable for <code>function(xs:NCName) as xs:int</code> and also for <code>function(xs:string) as xs:decimal</code>), and choice types (<code>A</code> is substitutable for the choice type <code>(A | B)</code> and also for <code>(A | C)</code>. Record types provide an alternative way of categorizing maps: the instances of <code>record(longitude, latitude)</code> overlap with the instances of <code>map(xs:string, xs:double)</code>. The diagram, which shows only hierarchic relationships, is therefore a simplification of the full model.</p><div class="type-hierarchy-figure"><div class="hier"><ul class="type-hierarchy type-colors"><li class="abstract"><p class="root"><span>item</span><span class="kind"> (abstract)</span></p><ul><li class="built-in-atomic"><p><span><a href="#th_anyAtomicType">anyAtomicType</a></span><span class="kind"> (built-in atomic)</span></p></li><li class="abstract node"><p><span>GNode</span><span class="kind"> (node)</span></p><ul><li class="abstract node"><p><span>XNode</span><span class="kind"> (node)</span></p><ul><li class="node"><p><span>attribute</span><span class="kind"> (node)</span></p><ul><li class="node user-defined"><p><span>user-defined attribute types</span><span class="kind"> (user-defined)</span></p></li></ul></li><li class="node"><p><span>document</span><span class="kind"> (node)</span></p><ul><li class="node user-defined"><p><span>user-defined document types</span><span class="kind"> (user-defined)</span></p></li></ul></li><li class="node"><p><span>element</span><span class="kind"> (node)</span></p><ul><li class="node user-defined"><p><span>user-defined element types</span><span class="kind"> (user-defined)</span></p></li></ul></li><li class="node"><p><span>text</span><span class="kind"> (node)</span></p></li><li class="node"><p><span>comment</span><span class="kind"> (node)</span></p></li><li class="node"><p><span>processing-instruction</span><span class="kind"> (node)</span></p></li><li class="node"><p><span>namespace</span><span class="kind"> (node)</span></p></li></ul></li><li class="node"><p><span>JNode</span><span class="kind"> (node)</span></p></li></ul></li><li class="abstract function"><p><span>function</span><span class="kind"> (function item)</span></p><ul><li class="function user-defined"><p><span>user-defined function item types</span><span class="kind"> (user-defined)</span></p></li><li class="abstract function"><p><span>array</span><span class="kind"> (function item)</span></p><ul><li class="function user-defined"><p><span>user-defined array types</span><span class="kind"> (user-defined)</span></p></li></ul></li><li class="abstract function"><p><span>map</span><span class="kind"> (function item)</span></p><ul><li class="function user-defined"><p><span>user-defined map types</span><span class="kind"> (user-defined)</span></p></li><li class="function user-defined"><p><span>user-defined record types</span><span class="kind"> (user-defined)</span></p></li></ul></li></ul></li></ul></li></ul></div><div class="legend"><p>Legend:</p><ul class="type-hierarchy type-colors legend"><li><p class="root"><span>Supertype</span></p><ul><li><p><span>subtype</span></p></li></ul></li></ul><ul class="type-legend type-colors legend"><li class="abstract"><p><span>Abstract types</span><span class="kind"> (abstract)</span></p></li><li class="built-in-atomic"><p><span>Built-in atomic types</span><span class="kind"> (built-in atomic)</span></p></li><li class="node"><p><span>Node types</span><span class="kind"> (node)</span></p></li><li class="function"><p><span>Function item types</span><span class="kind"> (function item)</span></p></li><li class="user-defined"><p><span>User-defined types</span><span class="kind"> (user-defined)</span></p></li></ul></div></div></div><div class="div3"><h4><a id="schema-type-hierarchy"></a>1.8.2 <a href="#schema-type-hierarchy" style="text-decoration: none">Schema Type Hierarchy</a></h4><p>The next diagram illustrate the schema type subsystem, in which all types are derived from <code>xs:anyType</code>. </p><p>Schema types include built-in types defined in the XML Schema specification, and user-defined types defined using mechanisms described in the XML Schema specification. Schema types define the permitted contents of nodes. The main categories are complex types, which define the permitted content of elements, and simple types, which can be used to constrain the values of both elements and attributes.</p><div class="type-hierarchy-figure"><div class="hier"><ul class="type-hierarchy type-colors"><li class="abstract root"><p class="root"><span>XML Schema types</span><span class="kind"> (abstract)</span></p><ul><li class="built-in-complex"><p class="first"><span>anyType</span><span class="kind"> (built-in complex)</span></p><ul><li class="abstract"><p class="first"><span>Simple types</span><span class="kind"> (abstract)</span></p><ul><li class="built-in-list"><p class="first"><span>anySimpleType</span><span class="kind"> (built-inlist)</span></p><ul><li class="abstract"><p class="first"><span>Atomic types</span><span class="kind"> (abstract)</span></p><ul><li class="built-in-atomic"><p class="first"><span><a href="#th_anyAtomicType">anyAtomicType</a></span><span class="kind"> (built-in atomic)</span></p></li></ul></li><li class="abstract"><p class="item"><span>list types</span><span class="kind"> (abstract)</span></p><ul><li class="built-in-list"><p class="item"><span>ENTITIES</span><span class="kind"> (built-in list)</span></p></li><li class="built-in-list"><p class="first"><span>IDREFS</span><span class="kind"> (built-in list)</span></p></li><li class="built-in-list"><p class="item"><span>NMTOKENS</span><span class="kind"> (built-in list)</span></p></li><li class="user-defined"><p class="last"><span>user-defined list types</span><span class="kind"> (user-defined)</span></p></li></ul></li><li class="abstract"><p class="last"><span>union types</span><span class="kind"> (abstract)</span></p><ul><li class="built-in-complex"><p class="first"><span>numeric</span><span class="kind"> (built-in complex)</span></p></li><li class="user-defined"><p class="item"><span>user-defined union types</span><span class="kind"> (user-defined)</span></p></li><li class="user-defined"><p class="last"><span>user-defined enumeration types</span><span class="kind"> (user-defined)</span></p></li></ul></li></ul></li><li class="abstract"><p class="last"><span>complex types</span><span class="kind"> (complex)</span></p><ul><li class="built-in-complex"><p class="first"><span>untyped</span><span class="kind"> (built-in complex)</span></p></li><li class="user-defined"><p class="last"><span>user-defined complex types</span><span class="kind"> (user-defined)</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></div><div class="legend"><p>Legend:</p><ul class="type-hierarchy type-colors"><li><p class="root"><span>Supertype</span></p><ul><li><p><span>subtype</span></p></li></ul></li></ul><ul class="type-legend type-colors"><li class="abstract"><p><span>Abstract types</span><span class="kind"> (abstract)</span></p></li><li class="built-in-atomic"><p><span>Built-in atomic types</span><span class="kind"> (built-in atomic)</span></p></li><li class="built-in-complex"><p><span>Built-in complex types</span><span class="kind"> (built-in complex)</span></p></li><li class="built-in-list"><p><span>Built-in list types</span><span class="kind"> (built-in list)</span></p></li><li class="user-defined"><p><span>User-defined types</span><span class="kind"> (user-defined)</span></p></li></ul></div></div></div><div class="div3"><h4><a id="atomic-type-hierarchy"></a>1.8.3 <a href="#atomic-type-hierarchy" style="text-decoration: none">Atomic Type Hierarchy</a></h4><p id="hier_anyAtomicType">The final diagram shows all of the atomic types, including the primitive simple types and the built-in types derived from the primitive simple types. This includes all the built-in datatypes defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>.</p><p>Atomic types are both item types and schema types, so the root type <code>xs:anyAtomicType</code> may be found in both the previous diagrams.</p><div class="type-hierarchy-figure"><div class="hier"><ul class="type-hierarchy type-colors"><li class="primitive special root"><p id="th_anyAtomicType" class="root"><span>anyAtomicType</span></p><ul><li class="primitive"><p class="first"><span>anyURI</span></p></li><li class="primitive"><p class="item"><span>base64Binary</span></p></li><li class="primitive"><p class="item"><span>boolean</span></p></li><li class="primitive"><p class="item"><span>date</span></p></li><li class="primitive"><p class="item"><span>dateTime</span></p><ul><li class="atomic"><p class="first"><span>dateTimeStamp</span></p></li></ul></li><li class="primitive"><p class="item"><span>decimal</span></p><ul><li class="built-in-atomic"><p class="first"><span>integer</span></p><ul><li class="built-in-atomic"><p class="first"><span>long</span></p><ul><li class="built-in-atomic"><p class="first"><span>int</span></p><ul><li class="built-in-atomic"><p class="first"><span>short</span></p><ul><li class="built-in-atomic"><p class="first"><span>byte</span></p></li></ul></li></ul></li></ul></li><li class="built-in-atomic"><p class="item"><span>nonNegativeInteger</span></p><ul><li class="built-in-atomic"><p class="first"><span>positiveInteger</span></p></li><li class="built-in-atomic"><p class="last"><span>unsignedLong</span></p><ul><li class="built-in-atomic"><p class="first"><span>unsignedInt</span></p><ul><li class="built-in-atomic"><p class="first"><span>unsignedShort</span></p><ul><li class="built-in-atomic"><p class="first"><span>unsignedByte</span></p></li></ul></li></ul></li></ul></li></ul></li><li class="built-in-atomic"><p class="last"><span>nonPositiveInteger</span></p><ul><li class="built-in-atomic"><p class="first"><span>negativeInteger</span></p></li></ul></li></ul></li></ul></li><li class="primitive"><p class="item"><span>double</span></p></li><li class="primitive"><p class="item"><span>duration</span></p><ul><li class="built-in-atomic"><p class="first"><span>dayTimeDuration</span></p></li><li class="built-in-atomic"><p class="last"><span>yearMonthDuration</span></p></li></ul></li><li class="primitive"><p class="item"><span>float</span></p></li><li class="primitive"><p class="item"><span>gDay</span></p></li><li class="primitive"><p class="item"><span>gMonth</span></p></li><li class="primitive"><p class="item"><span>gMonthDay</span></p></li><li class="primitive"><p class="item"><span>gYear</span></p></li><li class="primitive"><p class="item"><span>gYearMonth</span></p></li><li class="primitive"><p class="item"><span>hexBinary</span></p></li><li class="primitive"><p class="item"><span>NOTATION</span></p></li><li class="primitive"><p class="item"><span>QName</span></p></li><li class="primitive"><p class="item"><span>string</span></p><ul><li class="built-in-atomic"><p class="first"><span>normalizedString</span></p><ul><li class="built-in-atomic"><p class="first"><span>token</span></p><ul><li class="built-in-atomic"><p class="last"><span>NMTOKEN</span></p></li><li class="built-in-atomic"><p class="item"><span>Name</span></p><ul><li class="built-in-atomic"><p class="first"><span>NCName</span></p><ul><li class="built-in-atomic"><p class="first"><span>ENTITY</span></p></li><li class="built-in-atomic"><p class="item"><span>ID</span></p></li><li class="built-in-atomic"><p class="last"><span>IDREF</span></p></li></ul></li></ul></li><li class="built-in-atomic"><p class="first"><span>language</span></p></li></ul></li></ul></li></ul></li><li class="primitive"><p class="item"><span>time</span></p></li><li class="primitive"><p class="last"><span>untypedAtomic</span></p></li></ul></li></ul></div><div class="legend"><p>Legend:</p><ul class="type-hierarchy type-colors"><li><p class="root"><span>Supertype</span></p><ul><li><p><span>subtype</span></p></li></ul></li></ul><ul class="type-legend type-colors"><li class="built-in-atomic"><p><span>Built-in atomic types</span></p></li></ul></div></div></div></div><div class="div2"><h3><a id="terminology"></a>1.9 <a href="#terminology" style="text-decoration: none">Terminology</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-foot">next</a> | <a href="#options">previous</a>)</p><ol><li><p> The term <b>atomic value</b> has been replaced by <b>atomic item</b>. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1337">1337</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1361">1361</a>&nbsp;2 August 2024]</i></p></li></ol></div><p>The terminology used to describe the functions and operators on types defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> is defined in the body of this specification. The terms defined in this section are used in building those definitions.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Following in the tradition of <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, the terms <b>type</b> and <b>datatype</b> are used interchangeably.</p></div><div class="div3"><h4><a id="atomic-terminology"></a>1.9.1 <a href="#atomic-terminology" style="text-decoration: none">Atomic items</a></h4><p>The following definitions are adopted from <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p><ul><li><p><span class="termdef"><a id="dt-atomic-item"></a>[Definition] An <b>atomic item</b> is a pair (<var>T</var>, <var>D</var>) where <var>T</var> (the <a title="type annotation" class="termref" href="#dt-type-annotation">type annotation</a>) is an atomic type, and <var>D</var> (the <a title="datum" class="termref" href="#dt-datum">datum</a>) is a point in the value space of <var>T</var>.</span></p></li><li><p><span class="termdef"><a id="dt-primitive-type"></a>[Definition] A <b>primitive type</b> is one of the 19 <b>primitive atomic</b> types defined in <a href="https://www.w3.org/TR/xmlschema-2/#built-in-primitive-datatypes"> 3.2 Primitive datatypes</a><sup><small>XS2</small></sup> of <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, or the type <code>xs:untypedAtomic</code> defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</span></p></li><li><p><span class="termdef"><a id="dt-datum"></a>[Definition] The <b>datum</b> of an <a title="atomic item" class="termref" href="#dt-atomic-item">atomic item</a> is a point in the value space of its type, which is also a point in the value space of the primitive type from which that type is derived.</span> There are 20 primitive atomic types (19 defined in XSD, plus <code>xs:untypedAtomic</code>), and these have non-overlapping value spaces, so each datum belongs to exactly one primitive atomic type.</p></li><li><p><span class="termdef"><a id="dt-type-annotation"></a>[Definition] The <b>type annotation</b> of an atomic item is the most specific atomic type that it is an instance of (it is also an instance of every type from which that type is derived).</span></p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>The term <b>value space</b> is defined in <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a> as a set of <em>values</em>. The term <b>datum</b> is used here in preference to <em>value</em>, because <b>value</b> has a different meaning in this data model.</p></div></div><div class="div3"><h4><a id="character-terminology"></a>1.9.2 <a href="#character-terminology" style="text-decoration: none">Strings, characters, and codepoints</a></h4><p>This document uses the terms <code>string</code>, <code>character</code>, and <code>codepoint</code> with meanings that are normatively defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>, and which are paraphrased here for ease of reference:</p><p><span class="termdef"><a id="character"></a>[Definition] A <b>character</b> is an instance of the <a href="https://www.w3.org/TR/REC-xml/#NT-Char">Char</a><sup><small>XML</small></sup> production of <a href="#xml">[Extensible Markup Language (XML) 1.0 (Fifth Edition)]</a>.</span></p><div class="note"><p class="prefix"><b>Note:</b></p><p>This definition excludes Unicode characters in the surrogate blocks as well as <span class="unicode-codepoint">U+FFFE</span> and <span class="unicode-codepoint">U+FFFF</span>, while including characters with codepoints greater than <span class="unicode-codepoint">U+FFFF</span> which some programming languages treat as two characters. The valid characters are defined by their codepoints, and include some whose codepoints have not been assigned by the Unicode consortium to any character.</p></div><p><span class="termdef"><a id="string"></a>[Definition] A <b>string</b> is a sequence of zero or more <a title="character" class="termref" href="#character">characters</a>, or equivalently, a value in the value space of the <code>xs:string</code> datatype.</span></p><p><span class="termdef"><a id="codepoint"></a>[Definition] A <b>codepoint</b> is an integer assigned to a <a title="character" class="termref" href="#character">character</a> by the Unicode consortium, or reserved for future assignment to a character.</span></p><div class="note"><p class="prefix"><b>Note:</b></p><p>The set of codepoints is thus wider than the set of characters.</p><p>This specification spells “codepoint” as one word; the Unicode specification spells it as “code point”. Equivalent terms found in other specifications are “character number” or “code position”. See <a href="#charmod">[Character Model for the World Wide Web 1.0: Fundamentals]</a></p></div><p>Because these terms appear so frequently, they are hyperlinked to the definition only when there is a particular desire to draw the reader’s attention to the definition; the absence of a hyperlink does not mean that the term is being used in some other sense.</p><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which version of <a href="#Unicode">[The Unicode Standard]</a> is supported, but it is recommended that the most recent version of Unicode be used.</p><p>This specification adopts the Unicode notation <code>U+xxxx</code> to refer to a codepoint by its hexadecimal value (always four to six hexadecimal digits). This is followed where appropriate by the official Unicode character name and its graphical representation: for example <span class="unicode-codepoint">U+20AC</span> (<span class="unicode-name">EURO SIGN</span>, <code>€</code>) .</p><p>Unless explicitly stated, the functions in this document do not ensure that any returned <code>xs:string</code> values are normalized in the sense of <a href="#charmod">[Character Model for the World Wide Web 1.0: Fundamentals]</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>In functions that involve character counting such as <a href="#func-substring"><code>fn:substring</code></a>, <a href="#func-string-length"><code>fn:string-length</code></a> and <a href="#func-translate"><code>fn:translate</code></a>, what is counted is the number of XML <a title="character" class="termref" href="#character">characters</a> in the string (or equivalently, the number of Unicode codepoints). Some implementations may represent a codepoint above <span class="unicode-codepoint">U+FFFF</span> using two 16-bit values known as a surrogate pair. A surrogate pair counts as one character, not two.</p></div><p>Wherever encoding names (such as <code>UTF-8</code> and <code>UTF-16</code>) are used in this specification, they are compared without regard to case: the strings <code>"UTF-8"</code> and <code>"utf-8"</code> both refer to the same encoding.</p></div><div class="div3"><h4><a id="namespace-terminology"></a>1.9.3 <a href="#namespace-terminology" style="text-decoration: none">Namespaces and URIs</a></h4><p>This document uses the phrase “namespace URI” to identify the concept identified in <a href="#xml-names">[Namespaces in XML]</a> as “namespace name”, and the phrase “local name” to identify the concept identified in <a href="#xml-names">[Namespaces in XML]</a> as “local part”.</p><p>It also uses the term “expanded-QName” defined below.</p><p><span class="termdef"><a id="expanded-name"></a>[Definition] An <b>expanded-QName</b> is a value in the value space of the <code>xs:QName</code> datatype as defined in the XDM data model (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>): that is, a triple containing namespace prefix (optional), namespace URI (optional), and local name. Two expanded QNames are equal if the namespace URIs are the same (or both absent) and the local names are the same. The prefix plays no part in the comparison, but is used only if the expanded QName needs to be converted back to a string.</span></p><p>The term URI is used as follows:</p><p><span class="termdef"><a id="dt-uri"></a>[Definition] Within this specification, the term <b>URI</b> refers to Universal Resource Identifiers as defined in <a href="#rfc3986">[RFC 3986]</a> and extended in <a href="#rfc3987">[RFC 3987]</a> with a new name <b>IRI</b>. The term <b>URI Reference</b>, unless otherwise stated, refers to a string in the lexical space of the <code>xs:anyURI</code> datatype as defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>.</span></p><div class="note"><p class="prefix"><b>Note:</b></p><p> This means, in practice, that where this specification requires a “URI Reference”, an IRI as defined in <a href="#rfc3987">[RFC 3987]</a> will be accepted, provided that other relevant specifications also permit an IRI. The term URI has been retained in preference to IRI to avoid introducing new names for concepts such as “Base URI” that are defined or referenced across the whole family of XML specifications. Note also that the definition of <code>xs:anyURI</code> is a wider definition than the definition in <a href="#rfc3987">[RFC 3987]</a>; for example it does not require non-ASCII characters to be escaped. </p></div></div><div class="div3"><h4><a id="conformance-terminology"></a>1.9.4 <a href="#conformance-terminology" style="text-decoration: none">Conformance terminology</a></h4><p>In this specification:</p><ul><li><p>The auxiliary verb <span class="verb">must</span>, when rendered in small capitals, indicates a precondition for conformance.</p><ul><li><p>When the sentence relates to an implementation of a function (for example "All implementations <span class="verb">must</span> recognize URIs of the form ...") then an implementation is not conformant unless it behaves as stated. </p></li><li><p>When the sentence relates to the result of a function (for example "The result <span class="verb">must</span> have the same type as <code>$arg</code>") then the implementation is not conformant unless it delivers a result as stated. </p></li><li><p>When the sentence relates to the arguments to a function (for example "The value of <code>$arg</code><span class="verb">must</span> be a valid regular expression") then the implementation is not conformant unless it enforces the condition by raising a dynamic error whenever the condition is not satisfied. </p></li></ul></li><li><p>The auxiliary verb <span class="verb">may</span>, when rendered in small capitals, indicates optional or discretionary behavior. The statement “An implementation <span class="verb">may</span> do X” implies that it is implementation-dependent whether or not it does X.</p></li><li><p>The auxiliary verb <span class="verb">should</span>, when rendered in small capitals, indicates desirable or recommended behavior. The statement “An implementation <span class="verb">should</span> do X” implies that it is desirable to do X, but implementations may choose to do otherwise if this is judged appropriate.</p></li></ul><p><span class="termdef"><a id="implementation-defined"></a>[Definition] Where behavior is described as <b>implementation-defined</b>, variations between processors are permitted, but a conformant implementation <span class="verb">must</span> document the choices it has made.</span></p><p><span class="termdef"><a id="implementation-dependent"></a>[Definition] Where behavior is described as <b>implementation-dependent</b>, variations between processors are permitted, and conformant implementations are not required to document the choices they have made.</span></p><div class="note"><p class="prefix"><b>Note:</b></p><p>Where this specification states that something is implementation-defined or implementation-dependent, it is open to host languages to place further constraints on the behavior.</p></div></div><div class="div3"><h4><a id="properties-of-functions"></a>1.9.5 <a href="#properties-of-functions" style="text-decoration: none">Properties of functions</a></h4><p>This section is concerned with the question of whether two calls on a function, with the same arguments, may produce different results.</p><p>In this section the term <b>function</b>, unless otherwise specified, applies equally to <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-function-definition">function definitions</a><sup><small>XP</small></sup> (which can be the target of a static function call) and <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-function-item">function items</a><sup><small>DM</small></sup> (which can be the target of a dynamic function call).</p><p><span class="termdef"><a id="execution-scope"></a>[Definition] An <b>execution scope</b> is a sequence of calls to the function library during which certain aspects of the state are required to remain invariant. For example, two calls to <a href="#func-current-dateTime"><code>fn:current-dateTime</code></a> within the same execution scope will return the same result. The execution scope is defined by the host language that invokes the function library.</span> In XSLT, for example, any two function calls executed during the same transformation are in the same execution scope (except that static expressions, such as those used in <code>use-when</code> attributes, are in a separate execution scope). </p><p>The following definition explains more precisely what it means for two function calls to return the same result:</p><p><span class="termdef"><a id="dt-identical"></a>[Definition] Two values <code>$V1</code> and <code>$V2</code> are defined to be <b>identical</b> if they contain the same number of items and the items are pairwise identical. Two items are identical if and only if one of the following conditions applies:</span></p><ol class="enumar"><li><p>Both items are atomic items, of precisely the same type, and the values are equal as defined using the <code>eq</code> operator, using the Unicode codepoint collation when comparing strings.</p></li><li><p>Both items are nodes, and represent the same node.</p></li><li><p>Both items are maps, both maps have the same number of entries, and for every entry <var>E<sub>1</sub></var> in the first map there is an entry <var>E<sub>2</sub></var> in the second map such that the keys of <var>E<sub>1</sub></var> and <var>E<sub>2</sub></var> are <a title="same key" class="termref" href="#dt-same-key">the same key</a>, and the corresponding values <var>V<sub>1</sub></var> and <var>V<sub>2</sub></var> are <a title="identical" class="termref" href="#dt-identical">identical</a>.</p></li><li><p>Both items are arrays, both arrays have the same number of members, and the members are pairwise <a title="identical" class="termref" href="#dt-identical">identical</a>.</p></li><li><p>Both items are function items, neither item is a map or array, and the two function items have the same function identity. The concept of function identity is explained in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#function-items">8.1 Function Items</a>.</p></li></ol><p>Some functions produce results that depend not only on their explicit arguments, but also on the static and dynamic context.</p><p><span class="termdef"><a id="dt-context-dependent"></a>[Definition] A <span><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-function-definition">function definition</a><sup><small>XP</small></sup></span> may have the property of being <b>context-dependent</b>: the result of such a function depends on the values of properties in the static and dynamic evaluation context <span>of the caller</span> as well as on the actual supplied arguments (if any). A function definition may be context-dependent for some arities in its arity range, and context-independent for others: for example <a href="#func-name"><code>fn:name#0</code></a> is context-dependent while <a href="#func-name"><code>fn:name#1</code></a> is context-independent.</span></p><p><span class="termdef"><a id="dt-context-independent"></a>[Definition] A <span><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-function-definition">function definition</a><sup><small>XP</small></sup></span> that is not <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a> is called <b>context-independent</b>.</span></p><p>The main categories of context-dependent functions are:</p><ul><li><p>Functions that explicitly deliver the value of a component of the static or dynamic context, for example <a href="#func-static-base-uri"><code>fn:static-base-uri</code></a>, <a href="#func-default-collation"><code>fn:default-collation</code></a>, <a href="#func-position"><code>fn:position</code></a>, or <a href="#func-last"><code>fn:last</code></a>.</p></li><li><p>Functions with an optional parameter whose default value is taken from the static or dynamic context of the caller, usually either the context value (for example, <a href="#func-node-name"><code>fn:node-name</code></a>) or the default collation (for example, <a href="#func-index-of"><code>fn:index-of</code></a>).</p></li><li><p>Functions that use the static context of the caller to expand or disambiguate the values of supplied arguments: for example <a href="#func-doc"><code>fn:doc</code></a> expands its first argument using the static base URI of the caller, and <code>xs:QName</code> expands its first argument using the in-scope namespaces of the caller.</p></li></ul><p><span class="termdef"><a id="dt-focus-dependent"></a>[Definition] A function is <b>focus-dependent</b> if its result depends on the <a href="https://www.w3.org/TR/xpath-31/#dt-focus">focus</a><sup><small>XP31</small></sup> (that is, the context item, position, or size) <span>of the caller</span>.</span></p><p><span class="termdef"><a id="dt-focus-independent"></a>[Definition] A function that is not <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a> is called <b>focus-independent</b>.</span></p><div class="note"><p class="prefix"><b>Note:</b></p><p>Some functions depend on aspects of the dynamic context that remain invariant within an <a title="execution scope" class="termref" href="#execution-scope">execution scope</a>, such as the implicit timezone. Formally this is treated in the same way as any other context dependency, but internally, the implementation may be able to take advantage of the fact that the value is invariant.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>User-defined functions in XQuery and XSLT may depend on the static context of the function definition (for example, the in-scope namespaces) and also in a limited way on the dynamic context (for example, the values of global variables). However, the only way they can depend on the static or dynamic context of the caller — which is what concerns us here — is by defining optional parameters whose default values are context-dependent.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>Because the focus is a specific part of the dynamic context, all <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a> functions are also <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>. A <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a> function, however, may be either <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a> or <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>.</p></div><p>A <span>function definition</span> that is context-dependent can be used as <span>the target of</span> a named function reference, can be partially applied, and can be found using <a href="#func-function-lookup"><code>fn:function-lookup</code></a>. The principle in such cases is that the static context used for the function evaluation is taken from the static context of the named function reference, partial function application, or the call on <a href="#func-function-lookup"><code>fn:function-lookup</code></a>; and the dynamic context for the function evaluation is taken from the dynamic context of the evaluation of the named function reference, partial function application, or the call of <a href="#func-function-lookup"><code>fn:function-lookup</code></a>. <span>These constructs all deliver a <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-function-item">function item</a><sup><small>DM</small></sup> having a <b>captured context</b> based on the static and dynamic context of the construct that created the function item. This captured context forms part of the closure of the function item.</span></p><p>The result of a dynamic call to a function item never depends on the static or dynamic context of the dynamic function call, only (where relevant) on the captured context held within the function item itself.</p><p>The <a href="#func-function-lookup"><code>fn:function-lookup</code></a> function is a special case because it is potentially dependent on everything in the static and dynamic context. This is because the static and dynamic context of the call to <a href="#func-function-lookup"><code>fn:function-lookup</code></a><span>form the captured context of the function item</span> that <a href="#func-function-lookup"><code>fn:function-lookup</code></a> returns.</p><p><span class="termdef"><a id="dt-deterministic"></a>[Definition] A function that is guaranteed to produce <a title="identical" class="termref" href="#dt-identical">identical</a> results from repeated calls within a single <a title="execution scope" class="termref" href="#execution-scope">execution scope</a> if the explicit and implicit arguments are identical is referred to as <b>deterministic</b>.</span></p><p><span class="termdef"><a id="dt-nondeterministic"></a>[Definition] A function that is not <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a> is referred to as <b>nondeterministic</b>.</span></p><p>All functions defined in this specification are <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a> unless otherwise stated. Exceptions include the following:</p><ul><li><p><span class="termdef"><a id="dt-nondeterministic-wrt-ordering"></a>[Definition] Some functions (such as <a href="#func-in-scope-prefixes"><code>fn:in-scope-prefixes</code></a>, <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a>, and <a href="#func-unordered"><code>fn:unordered</code></a>) produce result sequences or result maps in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> or <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> order. In such cases two calls with the same arguments are not guaranteed to produce the results in the same order. These functions are said to be <b>nondeterministic with respect to ordering</b>.</span></p></li><li><p>Some functions (such as <a href="#func-analyze-string"><code>fn:analyze-string</code></a>, <a href="#func-parse-xml"><code>fn:parse-xml</code></a>, <a href="#func-parse-xml-fragment"><code>fn:parse-xml-fragment</code></a>, <a href="#func-parse-html"><code>fn:parse-html</code></a>, and <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a>) construct a tree of nodes to represent their results. There is no guarantee that repeated calls with the same arguments will return the same identical node (in the sense of the <code>is</code> operator). However, if non-identical nodes are returned, their content will be the same in the sense of the <a href="#func-deep-equal"><code>fn:deep-equal</code></a> function. Such a function is said to be <b>nondeterministic with respect to node identity</b>.</p></li><li><p>Some functions (such as <a href="#func-doc"><code>fn:doc</code></a> and <a href="#func-collection"><code>fn:collection</code></a>) create new nodes by reading external documents. Such functions are guaranteed to be <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a> by default (some such functions have an option <code>"stable":false()</code> that makes them nondeterministic as a user option, and implementations <span class="verb">may</span> also provide configuration options to change the default).</p></li></ul><p>Where the results of a function are described as being (to a greater or lesser extent) <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> or <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>, this does not by itself remove the requirement that the results should be deterministic: that is, that repeated calls with the same explicit and implicit arguments <span class="verb">must</span> return identical results.</p><p><span class="termdef"><a id="dt-variadic"></a>[Definition] The function <a href="#func-concat"><code>fn:concat</code></a> is defined to be variadic: it accepts any number of arguments. No other function has this property.</span></p></div></div></div><div class="div1"><h2><a id="sequence-functions"></a>2 <a href="#sequence-functions" style="text-decoration: none">Processing sequences</a></h2><p>A <code>sequence</code> is an ordered collection of zero or more <code>items</code>. An <code>item</code> is a node, an atomic item, or a function, such as a map or an array. The terms <code>sequence</code> and <code>item</code> are defined formally in <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> and <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a>. </p><div class="div2"><h3><a id="general-seq-funcs"></a>2.1 <a href="#general-seq-funcs" style="text-decoration: none">General functions on sequences</a></h3><p>The following functions are defined on sequences. These functions work on any sequence, without performing any operations that are sensitive to the individual items in the sequence.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-empty"><code>fn:empty</code></a></td><td>Returns <code>true</code> if the argument is the empty sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-exists"><code>fn:exists</code></a></td><td>Returns <code>true</code> if the argument is a non-empty sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-foot"><code>fn:foot</code></a></td><td>Returns the last item in a sequence. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-head"><code>fn:head</code></a></td><td>Returns the first item in a sequence. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-identity"><code>fn:identity</code></a></td><td>Returns its argument value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-insert-before"><code>fn:insert-before</code></a></td><td>Returns a sequence constructed by inserting an item or a sequence of items at a given position within an existing sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-insert-separator"><code>fn:insert-separator</code></a></td><td>Inserts a separator between adjacent items in a sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-items-at"><code>fn:items-at</code></a></td><td>Returns a sequence containing the items from <code>$input</code> at positions defined by <code>$at</code>, in the order specified. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-remove"><code>fn:remove</code></a></td><td>Returns a new sequence containing all the items of <code>$input</code><span>except those at specified positions</span>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-replicate"><code>fn:replicate</code></a></td><td>Produces multiple copies of a sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-reverse"><code>fn:reverse</code></a></td><td>Reverses the order of items in a sequence. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-slice"><code>fn:slice</code></a></td><td>Returns a sequence containing selected items from a supplied input sequence based on their position.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subsequence"><code>fn:subsequence</code></a></td><td>Returns the contiguous sequence of items in <code>$input</code> beginning at the position indicated by <code>$start</code> and continuing for the number of items indicated by <code>$length</code>. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-tail"><code>fn:tail</code></a></td><td>Returns all but the first item in a sequence. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-trunk"><code>fn:trunk</code></a></td><td>Returns all but the last item in a sequence. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-unordered"><code>fn:unordered</code></a></td><td>Returns the items of <code>$input</code> in an <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> order.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-void"><code>fn:void</code></a></td><td>Absorbs the argument.</td></tr></tbody></table><p>As in the previous section, for the illustrative examples below, assume an XQuery or transformation operating on a non-empty Purchase Order document containing a number of line-item elements. The variable <code>$seq</code> is bound to the sequence of line-item nodes in document order. The variables <code>$item1</code>, <code>$item2</code>, etc. are bound to separate, individual line-item nodes in the sequence.</p><div class="div3"><h4><a id="func-empty"></a>2.1.1 <a href="#func-empty" style="text-decoration: none">fn:empty</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the argument is the empty sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:empty</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$input</code> is the empty sequence, the function returns <code>true</code>; otherwise, the function returns <code>false</code>. </p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">count($input) eq 0</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>empty((1, 2, 3)[10])</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>empty(remove(("hello", "world"), 1))</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>empty([])</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>empty({})</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>empty("")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td colspan="2"><p>Assuming <code>$break</code> is an element with no children:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $break := &lt;br/&gt;
return empty($break)</pre></div></td></tr><tr><td colspan="2"><p>The result is <code>false</code>.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-exists"></a>2.1.2 <a href="#func-exists" style="text-decoration: none">fn:exists</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the argument is a non-empty sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:exists</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$input</code> is a non-empty sequence, the function returns <code>true</code>; otherwise, the function returns <code>false</code>. </p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">count($input) gt 0</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>exists(remove(("hello"), 1))</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>exists(remove(("hello", "world"), 1))</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>exists([])</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>exists({})</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>exists("")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td colspan="2"><p>Assuming <code>$break</code> is an element with no children:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $break := &lt;br/&gt;
return exists($break)</pre></div></td></tr><tr><td colspan="2"><p>The result is <code>true</code>.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-foot"></a>2.1.3 <a href="#func-foot" style="text-decoration: none">fn:foot</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-identity">next</a> | <a href="#terminology">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/97">97</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/250">250</a>&nbsp;7 December 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the last item in a sequence. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:foot</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the value of the expression <code>$input[last()]</code></p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">filter($input, fn($item, $pos) { $pos eq count($input) })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$input</code> is the empty sequence the empty sequence is returned. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>foot(1 to 5)</code></pre></div></td><td style="vertical-align:top"><p><code>5</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>foot(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-head"></a>2.1.4 <a href="#func-head" style="text-decoration: none">fn:head</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the first item in a sequence. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:head</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the first item in <code>$input</code>; if <code>$input</code> is empty, it returns the empty sequence.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">filter($input, fn($item, $pos) { $pos eq 1 })</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>head(1 to 5)</code></pre></div></td><td style="vertical-align:top"><p><code>1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>head(("a", "b", "c"))</code></pre></div></td><td style="vertical-align:top"><p><code>"a"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>head(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>head([ 1, 2, 3 ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ 1, 2, 3 ]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-identity"></a>2.1.5 <a href="#func-identity" style="text-decoration: none">fn:identity</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-insert-separator">next</a> | <a href="#func-foot">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/858">858</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1473">1473</a>&nbsp;20 September 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns its argument value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:identity</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns <code>$input</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">$input</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function is useful in contexts where a function must be supplied, but no processing is required.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>identity(0)</code></pre></div></td><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>identity(1 to 10)</code></pre></div></td><td style="vertical-align:top"><p><code>1, 2, 3, 4, 5, 6, 7, 8, 9, 10</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>parse-xml('&lt;a/&gt;') ! (identity(/) is /)</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p><p><em>(If the argument is a node, the function returns the identical node, not a copy).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>identity(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-insert-before"></a>2.1.6 <a href="#func-insert-before" style="text-decoration: none">fn:insert-before</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns a sequence constructed by inserting an item or a sequence of items at a given position within an existing sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:insert-before</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$position</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer</code></code>,</td><td></td></tr><tr class="arg"><td><code>$insert</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The value returned by the function consists of all items of <code>$input</code> whose 1-based position is less than <code>$position</code>, followed by all items of <code>$insert</code>, followed by the remaining elements of <code>$input</code>, in that order. </p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">filter($input, fn($item, $pos) { $pos lt $position }),
$insert,
filter($input, fn($item, $pos) { $pos ge $position })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$input</code> is the empty sequence, <code>$insert</code> is returned. If <code>$insert</code> is the empty sequence, <code>$input</code> is returned.</p><p>If <code>$position</code> is less than one (1), the first position, the effective value of <code>$position</code> is one (1). If <code>$position</code> is greater than the number of items in <code>$input</code>, then the effective value of <code>$position</code> is equal to the number of items in <code>$input</code> plus 1. </p><p>The value of <code>$input</code> is not affected by the sequence construction.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $abc := ("a", "b", "c")</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>insert-before($abc, 0, "z")</code></pre></div></td><td style="vertical-align:top"><p><code>"z", "a", "b", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>insert-before($abc, 1, "z")</code></pre></div></td><td style="vertical-align:top"><p><code>"z", "a", "b", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>insert-before($abc, 2, "z")</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "z", "b", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>insert-before($abc, 3, "z")</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b", "z", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>insert-before($abc, 4, "z")</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b", "c", "z"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-insert-separator"></a>2.1.7 <a href="#func-insert-separator" style="text-decoration: none">fn:insert-separator</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-items-at">next</a> | <a href="#func-identity">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/2">2</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/868">868</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/2327">2327</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1504">1504</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/2329">2329</a>&nbsp;27 September 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Inserts a separator between adjacent items in a sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:insert-separator</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$separator</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function inserts a separator between adjacent items in a sequence. The input is returned unchanged if <code>$separator</code> is the empty sequence or if <code>$input</code> contains less than two items.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">for-each($input, fn($item, $pos) {
  if ($pos gt 1) { $separator },
  $item
})</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>insert-separator(1 to 5, "|")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, "|", 2, "|" , 3, "|", 4, "|", 5</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>insert-separator((), "|")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>insert-separator("A", "|")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"A"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>insert-separator(1 to 3, ("⅓", "⅔"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, "⅓", "⅔", 2, "⅓", "⅔", 3</code></p></td></tr><tr><td colspan="2"><p>Insert an empty <code>hr</code> element between adjacent paragraphs:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">insert-separator(./para, &lt;hr/&gt;)</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-items-at"></a>2.1.8 <a href="#func-items-at" style="text-decoration: none">fn:items-at</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-remove">next</a> | <a href="#func-insert-separator">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/213">213</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/419">419</a>&nbsp;22 November 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a sequence containing the items from <code>$input</code> at positions defined by <code>$at</code>, in the order specified. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:items-at</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$at</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Returns the items in <code>$input</code> at the positions listed in <code>$at</code>, in order of the integers in the <code>$at</code> argument.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">for-each($at, fn($index) { subsequence($input, $index, 1) })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>In the simplest case where <code>$at</code> is a single integer, <code>fn:items-at($input, 3)</code> returns the same result as <code>$input[3]</code>.</p><p>Compared with a simple positional filter expression, the function is useful because:</p><ol class="enumar"><li><p>It can select items at multiple positions, and unlike <a href="#func-subsequence"><code>fn:subsequence</code></a>, these do not need to be contiguous.</p></li><li><p>The <code>$at</code> expression can depend on the focus.</p></li><li><p>The order of the returned items can differ from their order in the <code>$input</code> sequence.</p></li></ol><p>If any integer in <code>$at</code> is outside the range <code>1 to count($input)</code>, that integer is effectively ignored: no error occurs.</p><p>If either of the arguments is the empty sequence, the result is the empty sequence.</p><p>If <code>$at</code> contains duplicate integers, the result also contains duplicates. No de-duplication occurs. If the input sequence contains nodes, these are not copied: instead, the result sequence contains multiple references to the same node.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>items-at(11 to 20, 4)</code></pre></div></td><td style="vertical-align:top"><p><code>14</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>items-at(11 to 20, 4 to 6)</code></pre></div></td><td style="vertical-align:top"><p><code>14, 15, 16</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>items-at(11 to 20, (7, 3))</code></pre></div></td><td style="vertical-align:top"><p><code>17, 13</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>items-at(11 to 20, index-of(("a", "b", "c"), "b"))</code></pre></div></td><td style="vertical-align:top"><p><code>12</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>items-at(characters("quintessential"), (4, 8, 3))</code></pre></div></td><td style="vertical-align:top"><p><code>"n", "s", "i"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>items-at(characters("quintessential"), (4, 8, 1, 1))</code></pre></div></td><td style="vertical-align:top"><p><code>"n", "s", "q", "q"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>items-at((), 832)</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>items-at((), ())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-remove"></a>2.1.9 <a href="#func-remove" style="text-decoration: none">fn:remove</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-replicate">next</a> | <a href="#func-items-at">previous</a>)</p><ol><li><p>The second argument can now be a sequence of integers.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/294">294</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/313">313</a>&nbsp;24 January 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a new sequence containing all the items of <code>$input</code><span>except those at specified positions</span>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:remove</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$positions</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence consisting of all items of <code>$input</code><span>whose 1-based position is not equal to any of the integers in <code>$positions</code>. </span></p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">filter($input, fn($item, $pos) { not($pos = $positions) })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>Any integer in <code>$positions</code> that is less than 1 or greater than the number of items in <code>$input</code> is effectively ignored.</p><p>If <code>$input</code> is the empty sequence, the empty sequence is returned.</p><p>If <code>$positions</code> is the empty sequence, the input sequence <code>$input</code> is returned unchanged.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $abc := ("a", "b", "c")</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>remove($abc, 0)</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>remove($abc, 1)</code></pre></div></td><td style="vertical-align:top"><p><code>"b", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>remove($abc, 6)</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>remove((), 3)</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>remove($abc, 2 to 3)</code></pre></div></td><td style="vertical-align:top"><p><code>"a"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>remove($abc, ())</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b", "c"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-replicate"></a>2.1.10 <a href="#func-replicate" style="text-decoration: none">fn:replicate</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-slice">next</a> | <a href="#func-remove">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[&nbsp;&nbsp;4 October 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Produces multiple copies of a sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:replicate</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$count</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:nonNegativeInteger</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the value of <code>(1 to $count) ! $input</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">for-each(1 to $count, fn($item, $pos) { $input })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$input</code> is the empty sequence, the empty sequence is returned.</p><p>The <code>$count</code> argument is declared as <code>xs:nonNegativeInteger</code>, which means that a type error occurs if it is called with a negative value.</p><p>If the input sequence contains nodes, these are not copied: instead, the result sequence contains multiple references to the same node. So, for example, <code>fn:count(fn:replicate(/, 6)|())</code> returns <code>1</code>, because the <a href="#func-replicate"><code>fn:replicate</code></a> call creates duplicates, and the union operation eliminates them.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>replicate(0, 6)</code></pre></div></td><td style="vertical-align:top"><p><code>0, 0, 0, 0, 0, 0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>replicate(("A", "B", "C"), 3)</code></pre></div></td><td style="vertical-align:top"><p><code>"A", "B", "C", "A", "B", "C", "A", "B", "C"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>replicate((), 5)</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>replicate(("A", "B", "C"), 1)</code></pre></div></td><td style="vertical-align:top"><p><code>"A", "B", "C"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>replicate(("A", "B", "C"), 0)</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-reverse"></a>2.1.11 <a href="#func-reverse" style="text-decoration: none">fn:reverse</a></h4><dl><dt class="label">Summary</dt><dd><p>Reverses the order of items in a sequence. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:reverse</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence containing the items in <code>$input</code> in reverse order.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">fold-left($input, (), fn($result, $item) { $item, $result })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$input</code> is the empty sequence, the empty sequence is returned. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $abc := ("a", "b", "c")</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>reverse($abc)</code></pre></div></td><td style="vertical-align:top"><p><code>"c", "b", "a"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>reverse(("hello"))</code></pre></div></td><td style="vertical-align:top"><p><code>"hello"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>reverse(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>reverse([ 1, 2, 3 ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ 1, 2, 3 ]</code></p><p><em>(The input is a sequence containing a single item (the array)).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>reverse(([ 1, 2, 3 ], [ 4, 5, 6 ]))</code></pre></div></td><td style="vertical-align:top"><p><code>[ 4, 5, 6 ], [ 1, 2, 3 ]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-slice"></a>2.1.12 <a href="#func-slice" style="text-decoration: none">fn:slice</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-subsequence">next</a> | <a href="#func-replicate">previous</a>)</p><ol><li><p>New in 4.0</p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a sequence containing selected items from a supplied input sequence based on their position.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:slice</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$start</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$end</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$step</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$input</code> is the empty sequence, the function returns the empty sequence.</p><p>Let <code>$S</code> be the first of the following that applies:</p><ul><li><p>If <code>$start</code> is absent, empty, or zero, then 1.</p></li><li><p>If <code>$start</code> is negative, then <code>fn:count($input) + $start + 1</code>.</p></li><li><p>Otherwise, <code>$start</code>.</p></li></ul><p>Let <code>$E</code> be the first of the following that applies:</p><ul><li><p>If <code>$end</code> is absent, empty, or zero, then <code>fn:count($input)</code>.</p></li><li><p>If <code>$end</code> is negative, then <code>fn:count($input) + $end + 1</code>.</p></li><li><p>Otherwise, <code>$end</code>.</p></li></ul><p>Let <code>$STEP</code> be the first of the following that applies:</p><ul><li><p>If <code>$step</code> is absent, empty, or zero, then:</p><ul><li><p>If <code>$E ge $S</code>, then +1</p></li><li><p>Otherwise -1</p></li></ul></li><li><p>Otherwise, <code>$step</code>.</p></li></ul><p>If <code>$STEP</code> is negative, the function returns <code>$input =&gt; fn:reverse() =&gt; fn:slice(-$S, -$E, -$STEP)</code>.</p><p>Otherwise the function returns the result of the expression:</p><div class="exampleInner"><pre xml:space="preserve">$input[position() ge $S and position() le $E and (position() - $S) mod $STEP eq 0]</pre></div><table class="ednote" caption="Editorial note"><tbody><tr><td style="text-align: left; vertical-align:top; width: 50%;"><b>Editorial note</b></td><td style="text-align: right; vertical-align:top; width: 50%;">&nbsp;</td></tr><tr style="text-align: left; vertical-align: top;"><td colspan="2">TBA: define formal equivalent.</td></tr></tbody></table></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function is inspired by the slice operators in Javascript and Python, but it differs in detail to accommodate the tradition of 1-based addressing in XPath. The end position is inclusive rather than exclusive, so that in the simple case where <code>$start</code> and <code>$end</code> are positive and <code>$end &gt; $start</code>, <code>fn:slice($in, $start, $end)</code> returns the same result as <code>$in[position() = $start to $end]</code>.</p><p>This function can be used to enhance the <code>RangeExpression</code>, defined in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-range-expressions">4.8.2 Range Expressions</a>, to construct a sequence of integers based on steps other than 1.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $in := ('a', 'b', 'c', 'd', 'e')</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := 2, end := 4)</code></pre></div></td><td style="vertical-align:top"><p><code>"b", "c", "d"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>"b", "c", "d", "e"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, end := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := 3, end := 3)</code></pre></div></td><td style="vertical-align:top"><p><code>"c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := 4, end := 3)</code></pre></div></td><td style="vertical-align:top"><p><code>"d", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := 2, end := 5, step := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>"b", "d"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := 5, end := 2, step := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>"e", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := 2, end := 5, step := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := 5, end := 2, step := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in)</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b", "c", "d", "e"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := -1)</code></pre></div></td><td style="vertical-align:top"><p><code>"e"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := -3)</code></pre></div></td><td style="vertical-align:top"><p><code>"c", "d", "e"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, end := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b", "c", "d"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := 2, end := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>"b", "c", "d"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := -2, end := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>"d", "c", "b"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := -4, end := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>"b", "c", "d"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := -2, end := -4)</code></pre></div></td><td style="vertical-align:top"><p><code>"d", "c", "b"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := -4, end := -2, step := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>"b", "d"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice($in, start := -2, end := -4, step := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>"d", "b"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice(("a", "b", "c", "d"), 0)</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b", "c", "d"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>slice((1 to 5), step := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>1, 3, 5</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subsequence"></a>2.1.13 <a href="#func-subsequence" style="text-decoration: none">fn:subsequence</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-trunk">next</a> | <a href="#func-slice">previous</a>)</p><ol><li><p>The optional third argument can now be supplied as the empty sequence.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/895">895</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901</a>&nbsp;16 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the contiguous sequence of items in <code>$input</code> beginning at the position indicated by <code>$start</code> and continuing for the number of items indicated by <code>$length</code>. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:subsequence</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$start</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double</code></code>,</td><td></td></tr><tr class="arg"><td><code>$length</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>In the two-argument case <span>(or where the third argument is the empty sequence),</span> the function returns:</p><div class="exampleInner"><pre xml:space="preserve">$input[round($start) le position()]</pre></div><p>In the three-argument case, the function returns:</p><div class="exampleInner"><pre xml:space="preserve">$input[round($start) le position() 
         and position() lt round($start) + round($length)]</pre></div></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">filter(
  $input,
  if (empty($length)) then (
    fn($item, $pos) { round($start) le $pos }
  ) else (
    fn($item, $pos) { round($start) le $pos and $pos lt round($start) + round($length) }
  )
)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The first item of a sequence is located at position 1, not position 0.</p><p>If <code>$input</code> is the empty sequence, the empty sequence is returned.</p><p>In the two-argument case, the function returns a sequence comprising those items of <code>$input</code> whose 1-based position is greater than or equal to <code>$start</code> (rounded to an integer). No error occurs if <code>$start</code> is zero or negative.</p><p>In the three-argument case, The function returns a sequence comprising those items of <code>$input</code> whose 1-based position is greater than or equal to <code>$start</code> (rounded to an integer), and less than the sum of <code>$start</code> and <code>$length</code> (both rounded to integers). No error occurs if <code>$start</code> is zero or negative, or if <code>$start</code> plus <code>$length</code> exceeds the number of items in the sequence, or if <code>$length</code> is negative.</p><p>As a consequence of the general rules, if <code>$start</code> is <code>-INF</code> and <code>$length</code> is <code>+INF</code>, then <code>fn:round($start) + fn:round($length)</code> is <code>NaN</code>; since <code>position() lt NaN</code> always returns <code>false</code>, the result is the empty sequence.</p><p>The reason the function accepts arguments of type <code>xs:double</code> is that many computations on untyped data return an <code>xs:double</code> result; and the reason for the rounding rules is to compensate for any imprecision in these floating-point computations.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $seq := ("item1", "item2", "item3", "item4", "item5")</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>subsequence($seq, 4)</code></pre></div></td><td style="vertical-align:top"><p><code>"item4", "item5"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>subsequence($seq, 3, 2)</code></pre></div></td><td style="vertical-align:top"><p><code>"item3", "item4"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-tail"></a>2.1.14 <a href="#func-tail" style="text-decoration: none">fn:tail</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns all but the first item in a sequence. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:tail</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function all items in <code>$input</code> except the first, retaining order.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">filter($input, fn($item, $pos) { $pos gt 1 })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$input</code> is the empty sequence, or a sequence containing a single item, then the empty sequence is returned. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>tail(1 to 5)</code></pre></div></td><td style="vertical-align:top"><p><code>2, 3, 4, 5</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>tail(("a", "b", "c"))</code></pre></div></td><td style="vertical-align:top"><p><code>"b", "c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>tail("a")</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>tail(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>tail([ 1, 2, 3 ])</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-trunk"></a>2.1.15 <a href="#func-trunk" style="text-decoration: none">fn:trunk</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-void">next</a> | <a href="#func-subsequence">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/97">97</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/250">250</a>&nbsp;7 December 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns all but the last item in a sequence. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:trunk</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns all items in <code>$input</code> except the last, retaining order.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">filter($input, fn($item, $pos) { $pos ne count($input) })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$input</code> is the empty sequence, or a sequence containing a single item, then the empty sequence is returned. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>trunk(1 to 5)</code></pre></div></td><td style="vertical-align:top"><p><code>1, 2, 3, 4</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>trunk(("a", "b", "c"))</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>trunk("a")</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>trunk(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>trunk([ 1, 2, 3 ])</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-unordered"></a>2.1.16 <a href="#func-unordered" style="text-decoration: none">fn:unordered</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the items of <code>$input</code> in an <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> order.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:unordered</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic with respect to ordering" class="termref" href="#dt-nondeterministic-wrt-ordering">nondeterministic-wrt-ordering</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the items of <code>$input</code> in an <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> order.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Query optimizers may be able to do a better job if the order of the output sequence is not specified. For example, when retrieving prices from a purchase order, if an index exists on prices, it may be more efficient to return the prices in index order rather than in document order.</p><p>This function does not guarantee that the resulting sequence will be in an order different from the input sequence. Many times the two sequences will be identical. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>unordered((1, 2, 3, 4, 5))</code></pre></div></td><td style="vertical-align:top"><p><code>(1, 2, 3, 4, 5)</code></p><p>(or some permutation thereof)</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-void"></a>2.1.17 <a href="#func-void" style="text-decoration: none">fn:void</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-atomic-equal">next</a> | <a href="#func-trunk">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1029">1029</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1032">1032</a>&nbsp;25 February 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Absorbs the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:void</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>empty-sequence()</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function absorbs the supplied <code>$input</code> argument and returns the empty sequence.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function can be used to discard unneeded output of expressions (functions, third-party libraries, etc.).</p><p>It can also be used to discard results during development.</p><p>It is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether the supplied argument is evaluated or ignored. An implementation may decide to evaluate <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a> expressions and ignore deterministic ones.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>void(1 to 1000000)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>for $f in (identity#1, void#1) return $f(123)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>123</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $mapping := () 
return for-each(1 to 10, $mapping otherwise void#0)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div><p><em>(Indicates that if no mapping is supplied, all items are dropped.)</em></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="comparing-sequences"></a>2.2 <a href="#comparing-sequences" style="text-decoration: none">Comparison functions</a></h3><p>The functions in this section perform comparisons between the items in one or more sequences.</p><p>Many of these functions require atomic items to be compared for equality.</p><p><span class="termdef"><a id="dt-contextually-equal"></a>[Definition] Two atomic items <var>A</var> and <var>B</var> are said to be <b>contextually equal</b> if the function call <code>fn:compare(<var>A</var>, <var>B</var>)</code> returns zero when evaluated with a specified or context-determined collation and implicit timezone.</span> If two values are not contextually equal, they are considered to be <b>contextually unequal</b>, even in the case when comparing them using <a href="#func-compare"><code>fn:compare</code></a> raises an error.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Except where explicitly stated otherwise, an appeal to <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextual equality</a> implies that <code>NaN</code> is treated as equal to <code>NaN</code>.</p></div><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-atomic-equal"><code>fn:atomic-equal</code></a></td><td>Determines whether two atomic items are equal, under the rules used for comparing keys in a map.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-compare"><code>fn:compare</code></a></td><td>Returns <code>-1</code>, <code>0</code>, or <code>1</code>, depending on whether the first value is less than, equal to, or greater than the second value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-contains-subsequence"><code>fn:contains-subsequence</code></a></td><td>Determines whether one sequence contains another as a contiguous subsequence, using a supplied callback function to compare items.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-deep-equal"><code>fn:deep-equal</code></a></td><td> This function assesses whether two sequences are deep-equal to each other. To be deep-equal, they must contain items that are pairwise deep-equal; and for two items to be deep-equal, they must either be atomic items that compare equal, or nodes of the same kind, with the same name, whose children are deep-equal<span>, or maps with matching entries, or arrays with matching members.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-distinct-values"><code>fn:distinct-values</code></a></td><td>Returns the values that appear in a sequence, with duplicates eliminated.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-duplicate-values"><code>fn:duplicate-values</code></a></td><td>Returns the values that appear in a sequence more than once.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-ends-with-subsequence"><code>fn:ends-with-subsequence</code></a></td><td>Determines whether one sequence ends with another, using a supplied callback function to compare items.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-index-of"><code>fn:index-of</code></a></td><td>Returns a sequence of positive integers giving the positions within the sequence <code>$input</code> of items that are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a> to <code>$target</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-starts-with-subsequence"><code>fn:starts-with-subsequence</code></a></td><td>Determines whether one sequence starts with another, using a supplied callback function to compare items.</td></tr></tbody></table><div class="div3"><h4><a id="func-atomic-equal"></a>2.2.1 <a href="#func-atomic-equal" style="text-decoration: none">fn:atomic-equal</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-compare">next</a> | <a href="#func-void">previous</a>)</p><ol><li><p>New in 4.0. The function replaces the internal <a href="#dt-same-key"><code>op:same-key</code></a> function in 3.1<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/221">221</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/319">319</a>&nbsp;1 February 2023]</i></p></li><li><p>Atomic items of types <code>xs:hexBinary</code> and <code>xs:base64Binary</code> are now mutually comparable. In rare cases, where an application uses both types and assumes they are distinct, this can represent a backwards incompatibility.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2139">2139</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2168">2168</a>&nbsp;19 August 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Determines whether two atomic items are equal, under the rules used for comparing keys in a map.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:atomic-equal</code>(</td></tr><tr class="arg"><td><code>$value1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code>,</td><td></td></tr><tr class="arg"><td><code>$value2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-atomic-equal"><code>fn:atomic-equal</code></a> is used to compare two atomic items for equality. This function has the following properties (which do not all apply to the <code>eq</code> operator):</p><ul><li><p>Any two atomic items can be compared, regardless of their type.</p></li><li><p>No dynamic error is ever raised (the result is either <code>true</code> or <code>false</code>).</p></li><li><p>The result of the comparison never depends on the static or dynamic context.</p></li><li><p>Every value (including <code>NaN</code>) is equal to itself.</p></li><li><p>The comparison is symmetric: if <var>A</var> equals <var>B</var>, then <var>B</var> equals <var>A</var>.</p></li><li><p>The comparison is transitive: if <var>A</var> equals <var>B</var> and <var>B</var> equals <var>C</var>, then <var>A</var> equals <var>C</var>.</p></li></ul><p>The function returns <code>true</code> if and only if one of the following conditions is true:</p><ol class="enumar"><li><p>All of the following conditions are true:</p><ol class="enumla"><li><p><code>$value1</code> is an instance of <code>xs:string</code>, <code>xs:anyURI</code>, or <code>xs:untypedAtomic</code></p></li><li><p><code>$value2</code> is an instance of <code>xs:string</code>, <code>xs:anyURI</code>, or <code>xs:untypedAtomic</code></p></li><li><p><code>fn:codepoint-equal($value1, $value2)</code></p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Strings are compared without any dependency on collations.</p></div></li><li><p>All of the following conditions are true:</p><ol class="enumla"><li><p><code>$value1</code> is an instance of <code>xs:decimal</code>, <code>xs:double</code>, or <code>xs:float</code></p></li><li><p><code>$value2</code> is an instance of <code>xs:decimal</code>, <code>xs:double</code>, or <code>xs:float</code></p></li><li><p><code>fn:compare($value1, $value2)</code> returns zero.</p><div class="note"><p class="prefix"><b>Note:</b></p><p><code>NaN</code> is equal to <code>NaN</code>, <code>INF</code> is equal to <code>INF</code>, <code>-INF</code> is equal to <code>-INF</code>, positive zero equals negative zero. This applies both to <code>xs:double</code> amd <code>xs:float</code> values, including comparisons across these two types.</p><p>Ordinary values (numeric values other than the special values mentioned above) are compared according to their mathematical magnitude. Every instance of <code>xs:double</code>, <code>xs:float</code>, and <code>xs:decimal</code> can be represented exactly as a decimal number provided enough digits are available both before and after the decimal point. This comparison is therefore transitive.</p></div></li><li><p>All of the following conditions are true:</p><ol class="enumlr"><li><p>One of the following conditions is true:</p><ol class="enumua"><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:date</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:time</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:dateTime</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:gYear</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:gYearMonth</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:gMonth</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:gMonthDay</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:gDay</code>.</p></li></ol></li><li><p>One of the following conditions is true:</p><ol class="enumua"><li><p>Both <code>$value1</code> and <code>$value2</code> have a timezone</p></li><li><p>Neither <code>$value1</code> nor <code>$value2</code> has a timezone</p></li></ol></li><li><p><code>fn:compare($value1, $value2)</code> returns zero. </p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Values having a timezone are never equal to values without one. The implicit timezone is not used.</p></div></li><li><p>All of the following conditions are true:</p><ol class="enumlr"><li><p><code>$value1</code> is an instance of <code>xs:hexBinary</code> or <code>xs:base64Binary</code></p></li><li><p><code>$value2</code> is an instance of <code>xs:hexBinary</code> or <code>xs:base64Binary</code></p></li><li><p><code>fn:compare($value1, $value2)</code> returns zero.</p></li></ol></li><li><p>All of the following conditions are true:</p><ol class="enumlr"><li><p>One of the following conditions is true:</p><ol class="enumua"><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:boolean</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:QName</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:NOTATION</code>.</p></li><li><p><code>$value1</code> and <code>$value2</code> are both instances of <code>xs:duration</code>.</p></li></ol></li><li><p><code>fn:compare($value1, $value2)</code> returns zero. </p></li></ol></li></ol></li></ol></dd><dt class="label">Notes</dt><dd><div class="note"><p>The internal function <code>op:same-key</code> was introduced in an earlier version of this specification for comparing keys within a map. In this version of the specification, the functionality is unchanged, but the function is exposed so that it is available directly to applications.</p><p>The function is used to assess whether two atomic items are considered to be duplicates when used as keys in a map. A map cannot contain two separate entries whose keys are <b>the same</b> as defined by this function. The function is also used when matching keys in functions such as <a href="#func-map-get"><code>map:get</code></a> and <a href="#func-map-remove"><code>map:remove</code></a>.</p><p>The rules for comparing keys in a map are chosen to ensure that the comparison is:</p><ul><li><p><b>Context-free</b>: there is no dependency on the static or dynamic context</p></li><li><p><b>Error-free</b>: any two atomic items can be compared, and the result is either <code>true</code> or <code>false</code>, never an error</p></li><li><p><b>Transitive</b>: if <var>A</var> is the same key as <var>B</var>, and <var>B</var> is the same key as <var>C</var>, then <var>A</var> is the same key as <var>C</var>.</p></li></ul><p>Two atomic items may be distinguishable even though they are equal under this comparison. For example: they may have different type annotations; dates and times may have different timezones; <code>xs:QName</code> values may have different prefixes.</p><p>Unlike previous versions of this specification, <code>xs:hexBinary</code> and <code>xs:base64Binary</code> values are mutually comparable. This decision affects backwards compatibility: it is no longer possible to construct certain maps that could be validly constructed using earlier versions of the specification. This may also cause problems passing data from a 3.1 processor to a 4.0 processor.</p><p>As always, any algorithm that delivers the right result is acceptable. For example, when testing whether an <code>xs:double</code> value <var>D</var> is the same key as an <code>xs:decimal</code> value that has <var>N</var> significant digits, it is not necessary to know all the digits in the decimal expansion of <var>D</var> to establish the result: computing the first <var>N+1</var> significant digits (or indeed, simply knowing that there are more than <var>N</var> significant digits) is sufficient.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal("a", "a")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal("a", "A")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal("a", xs:untypedAtomic("a"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">atomic-equal(
  "https://www.w3.org/",
  xs:anyURI("https://www.w3.org/")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(3, 3)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(3, 3e0)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(3.1, 3.1e0)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(xs:double('NaN'), xs:float('NaN'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(12, "12")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(xs:time('16:00:00Z'), xs:time('17:00:00+01:00'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(xs:time('16:00:00Z'), xs:time('16:00:00'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(xs:duration('PT1H'), xs:duration('PT60M'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(xs:duration('PT0S'), xs:duration('P0Y'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(xs:duration('P30D'), xs:duration('P1M'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(#Q{http://example.com}name, #Q{http://example.com}prefix:name)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>atomic-equal(xs:hexBinary(""), xs:base64Binary(""))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-compare"></a>2.2.2 <a href="#func-compare" style="text-decoration: none">fn:compare</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-contains-subsequence">next</a> | <a href="#func-atomic-equal">previous</a>)</p><ol><li><p>The function has been expanded in scope to handle comparison of values other than strings.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/893">893</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/909">909</a>&nbsp;10 January 2024]</i></p></li><li><p>The spec has been corrected to note that the function depends on the implicit timezone.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1608">1608</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1611">1611</a>&nbsp;26 November 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>-1</code>, <code>0</code>, or <code>1</code>, depending on whether the first value is less than, equal to, or greater than the second value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:compare</code>(</td></tr><tr class="arg"><td><code>$value1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$value2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone, and static base URI. </p></dd><dt class="label">Rules</dt><dd><p>The function compares two atomic items <code>$value1</code> and <code>$value2</code> for order, and returns the integer value <code>-1</code>, <code>0</code>, or <code>+1</code>, depending on whether <code>$value1</code> is less than, equal to, or greater than <code>$value2</code>, respectively.</p><p>This function is transitive and symmetric. For example:</p><ul><li><p>If <code>compare(A, B)</code> returns zero, then <code>compare(B, A)</code> returns zero.</p></li><li><p>If <code>compare(A, B)</code> returns -1, then <code>compare(B, A)</code> returns +1.</p></li><li><p>If <code>compare(A, B)</code> and <code>compare(B, C)</code> both return -1, then <code>compare(A, C)</code> also returns -1.</p></li></ul><p>If either <code>$value1</code> or <code>$value2</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the result is determined as follows:</p><ol class="enumar"><li><p>If <code>$value1</code> is an instance of <code>xs:string</code>, <code>xs:anyURI</code> or <code>xs:untypedAtomic</code>, and if <code>$value2</code> is an instance of <code>xs:string</code>, <code>xs:anyURI</code> or <code>xs:untypedAtomic</code>, the values are compared as strings, and the result reflects the order according to the rules of the collation that is used.</p><p>The collation is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Using the default collation may be inappropriate for some strings, for example URIs or manufacturing part numbers. In such cases it is safest to supply <code>"http://www.w3.org/2005/xpath-functions/collation/codepoint"</code> explicitly as the third argument.</p></div></li><li><p>If both <code>$value1</code> and <code>$value2</code> are instances of <code>xs:numeric</code>, the function relies on a total order, which is defined as follows:</p><ol class="enumla"><li><p>A value <code>$f</code> of type <code>xs:float</code> is in all cases equal to the value <code>xs:double($f)</code>. The remaining rules therefore only consider instances of <code>xs:double</code> and <code>xs:decimal</code>.</p></li><li><p><code>NaN</code> is equal to itself and less than any other value.</p></li><li><p>Negative infinity is equal to itself and less than any other value except <code>NaN</code>.</p></li><li><p>Positive infinity is equal to itself and greater than any other value.</p></li><li><p>Negative zero is equal to positive zero.</p></li><li><p>Other <code>xs:double</code> and <code>xs:decimal</code> values (that is, values other than the infinities, <code>NaN</code>, and negative zero) are ordered according to their mathematical magnitude, the comparison being done without any rounding or loss of precision. This effect can be achieved by converting <code>xs:double</code> values to <code>xs:decimal</code> using an implementation of <code>xs:decimal</code> that imposes no limits on precision or scale, or an implementation whose limits are such that all <code>xs:double</code> values can be represented precisely.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Every <code>xs:double</code> other than <code>NaN</code> and <code>±INF</code>, has a mathematical value of the form <code>m × 2^e</code>, where <var>m</var> is an integer whose absolute value is less than 2^53, and <var>e</var> is an integer between -1075 and 970, inclusive. This is the value that is used in comparisons.</p><p>Practical difficulties arise because the typical string representations of an <code>xs:double</code>, such as <code>3.1</code>, cannot be precisely represented by values of the form <code>m × 2^e</code>, but are instead converted to the best available approximation, which will often not be exactly equal to an <code>xs:decimal</code> expressed using the same lexical form.</p></div></li><li><p>If both <code>$value1</code> and <code>$value2</code> are instances of <code>xs:boolean</code>, the result is <code>fn:compare(xs:integer($value1), xs:integer($value2))</code></p><div class="note"><p class="prefix"><b>Note:</b></p><p>This means that <code>false</code> is treated as less than <code>true</code>.</p></div></li><li><p>If <code>$value1</code> is an instance of <code>xs:hexBinary</code> or <code>xs:base64Binary</code>, and if <code>$value2</code> is an instance of <code>xs:hexBinary</code> or <code>xs:base64Binary</code>, then:</p><ol class="enumla"><li><p>Let <code>$A</code> be the sequence of integers, in the range (0 to 255), representing the octets of <code>$value1</code>, in order; and let <code>$B</code> similarly be the sequence of integers representing the octets of <code>$value2</code>.</p></li><li><p>If <code>$A</code> is empty and <code>$B</code> is empty return zero.</p></li><li><p>If <code>$A</code> is empty and <code>$B</code> is not empty return -1.</p></li><li><p>Let <code>$C</code> be the value of <code>fn:compare(fn:head($A), fn:head($B))</code>.</p></li><li><p>If <code>$C</code> is non-zero, then return <code>$C</code>.</p></li><li><p>Otherwise, return the result of applying these rules recursively to <code>fn:tail($A)</code> and <code>fn:tail($B)</code></p></li></ol></li><li><p>If both <code>$value1</code> and <code>$value2</code> are instances of the same primitive type <var>T</var>, where <var>T</var> is one of the types <code>xs:dateTime</code>, <code>xs:date</code>, <code>xs:time</code>, <code>xs:gYear</code>, <code>xs:gYearMonth</code>, <code>xs:gMonth</code>, <code>gMonthDay</code>, or <code>gDay</code>, then:</p><ol class="enumla"><li><p>Each of the values is converted to an <code>xs:dateTime</code> value as follows:</p><ol class="enumlr"><li><p>The value is considered as a tuple with seven fields (year, month, day, hours, minutes, seconds, timezone) as defined by the functions <a href="#func-year-from-dateTime"><code>fn:year-from-dateTime</code></a>, <a href="#func-month-from-dateTime"><code>fn:month-from-dateTime</code></a>, and so on.</p></li><li><p>Any absent components, other than the timezone, are substituted with the corresponding components of the <code>xs:dateTime</code> value <code>1972-01-01T00:00:00</code> to produce an <code>xs:dateTime</code> value.</p></li><li><p>If the timezone component is absent, it is substituted with the implicit timezone from the dynamic context.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The <code>xs:dateTime</code><code>1972-01-01T00:00:00</code> is arbitrary. The only constraint is that the year must be a leap year (so that the <code>xs:gYearMonth</code> value <code>--02-29</code> expands to a valid date). XSD originally chose this as the being historically the first date on which there was a leap second, but this is irrelevant as leap seconds are not supported in XDM.</p></div></li></ol></li><li><p>The result of the function is then the result of comparing the <b>starting instants</b> of these two <code>xs:dateTime</code> values according to the algorithm defined in section 3.2.7.4 of <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> ( “Order relation on dateTime” for <code>xs:dateTime</code> values with timezones).</p></li></ol></li><li><p>If both <code>$value1</code> and <code>$value2</code> are instances of <code>xs:duration</code>, then:</p><ol class="enumla"><li><p>Let <code>$M1</code> and <code>$M2</code> be the months components of the two durations, and let <code>$S1</code> and <code>$S2</code> be the seconds components of the two durations.</p></li><li><p>Let <code>$C</code> be <code>fn:compare($M1, $M2)</code>.</p></li><li><p>If <code>$C</code> is non-zero, return <code>$C</code>.</p></li><li><p>Otherwise, return <code>fn:compare($S1, $S2)</code>.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>The result matches the real-world semantics of durations in many cases, for example:</p><ul><li><p>When both values are zero-length durations.</p></li><li><p>When both values are have an equal months component (in particular when both have a zero months component).</p></li><li><p>When both values are have an equal seconds component (in particular when both have a zero seconds component).</p></li><li><p>When both values have a seconds component that is less than the number of seconds in the shortest month.</p></li></ul><p>In other cases the result is well defined and well behaved (for example it is symmetric and transitive) but may be counter-intuitive. For example, one month (<code>PT1M</code>) is considered greater than one hundred days (<code>PT100D</code>).</p><p>Previous versions of this specification allowed durations to be compared only if both were instances of <code>xs:dateTimeDuration</code> or <code>xs:yearMonthDuration</code>. This requirement has been relaxed in the interests of allowing all atomic items to be sorted; in some applications the actual sort order matters little, so long as it is consistent.</p></div></li><li><p>If both <code>$value1</code> and <code>$value2</code> are instances of <code>xs:QName</code>, then:</p><ol class="enumla"><li><p>Let <code>$N1</code> and <code>$N2</code> be the result of applying the function <a href="#func-namespace-uri-from-QName"><code>fn:namespace-uri-from-QName</code></a> to the two values, and let <code>$L1</code> and <code>$L2</code> be the result of applying the function <a href="#func-local-name-from-QName"><code>local-name-from-QName</code></a> to the two values.</p></li><li><p>Let <code>$CPC</code> be <code>"http://www.w3.org/2005/xpath-functions/collation/codepoint"</code>.</p></li><li><p>Let <code>$C</code> be <code>fn:compare($N1, $N2, $CPC)</code>.</p></li><li><p>If <code>$C</code> is non-zero, return <code>$C</code>.</p></li><li><p>Otherwise, return <code>fn:compare($L1, $L2, $CPC)</code>.</p></li></ol></li><li><p>If both <code>$value1</code> and <code>$value2</code> are instances of <code>xs:NOTATION</code>, return <code>fn:compare(xs:QName($value1), xs:QName($value2))</code>.</p></li><li><p>For any other combination of types, a type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> is raised. In particular, this means that an error is raised when comparing two atomic items that belong to different <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dt-type-family"></a>.</p></li></ol></dd><dt class="label">Notes</dt><dd><div class="note"><p>For numeric values, consider the <code>xs:double</code> value written as <code>0.1e0</code> and the <code>xs:decimal</code> value written as <code>0.1</code>: The mathematical magnitude of this <code>xs:double</code> value is <code>0.1000000000000000055511151231257827021181583404541015625</code>. Therefore, <code>compare(0.1e0, 0.1)</code> returns <code>+1</code>. By contrast, <code>0.1e0 lt 0.1</code> is <code>false</code> and <code>0.1e0 eq 0.1</code> is <code>true</code>, because those expressions convert the <code>xs:decimal</code> value <code>0.1</code> to the <code>xs:double</code> value <code>0.1e0</code> before the comparison.</p><p>Although operations such as sorting and the <a href="#func-min"><code>fn:min</code></a> and <a href="#func-max"><code>fn:max</code></a> functions invoke <a href="#func-compare"><code>fn:compare</code></a> to perform numeric comparison, these functions in some cases treat <code>NaN</code> differently.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare('abc', 'abc')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare('Strasse', 'Straße')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare('Strasse', 'Straße')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p><p><em>(Assuming the default collation equates “ss” and the German letter “ß”.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">compare(
  'Strasse',
  'Straße',
  collation({ 'lang': 'de', 'strength': 'primary' })
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">0</pre></div><p><em>(The specified collation equates “ss” and the German letter “ß”.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare('text', parse-xml('&lt;xml&gt;text&lt;/xml&gt;'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(9, 10)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(123, 123.0)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:double('NaN'), xs:float('NaN'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:double('NaN'), xs:double('-INF'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:double('-INF'), -23)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(1, 1e0)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(1.1, 1.1e0)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(1.2, 1.2e0)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>+1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(9999, xs:double('INF'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(false(), true())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:hexBinary(''), xs:base64Binary(''))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:hexBinary('0001'), xs:hexBinary('0002'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:hexBinary('00FF'), xs:hexBinary('FF'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:time('23:59:59'), xs:time('00:00:00'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:time('12:00:00Z'), xs:time('13:00:00+01:00'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:date('2001-01-01+01:00'), xs:date('2001-01-01+00:00'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:duration('P1Y'), xs:duration('P13M'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:duration('P1Y'), xs:duration('P1Y3M4D'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(xs:duration('P1Y'), xs:duration('P1000D'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>+1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(#space, #xml:space)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>compare(#Q{http://example.com/ns}index, #Q{http://example.com/ns}xmp:index)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-contains-subsequence"></a>2.2.3 <a href="#func-contains-subsequence" style="text-decoration: none">fn:contains-subsequence</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-deep-equal">next</a> | <a href="#func-compare">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/92">92</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/222">222</a>&nbsp;1 November 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Determines whether one sequence contains another as a contiguous subsequence, using a supplied callback function to compare items.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:contains-subsequence</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$subsequence</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$compare</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item(), item()) as xs:boolean?)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:deep-equal#2</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function returns <code>true</code> if <code>$input</code> contains a consecutive subsequence matching <code>$subsequence</code>, when items are compared using the supplied (or default) <code>$compare</code> function.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">some $i in 0 to count($input) - count($subsequence)
satisfies (
  every $j in 1 to count($subsequence)
  satisfies $compare($input[$i + $j], $subsequence[$j])   
)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>There is no requirement that the <code>$compare</code> function should have the traditional qualities of equality comparison. The result is well-defined, for example, even if <code>$compare</code> is not transitive or not symmetric.</p><p>A return value of <code>()</code> from the function is treated as <code>false</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-subsequence((), ())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-subsequence(1 to 10, 3 to 6)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-subsequence(1 to 10, (2, 4, 6))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-subsequence(1 to 10, ())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-subsequence(1 to 10, 1 to 10)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-subsequence(1 to 10, 5)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">contains-subsequence(
  1 to 10,
  103 to 105,
  fn($x, $y) { $x mod 100 = $y mod 100 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">contains-subsequence(
  ("A", "B", "C", "D"),
  ("b", "c"),
  fn($x, $y) {
    compare(
      $x,
      $y,
      "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
    ) eq 0
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $chap := parse-xml("&lt;doc&gt;&lt;chap&gt;&lt;h1/&gt;&lt;p/&gt;&lt;p/&gt;&lt;footnote/&gt;&lt;/chap&gt;&lt;/doc&gt;")//chap
return contains-subsequence(
  $chap ! child::*,
  $chap ! child::p,
  op("is")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(True because the <code>p</code> children of the <code>chap</code> element form a contiguous subsequence.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-subsequence(10 to 20, (5, 3, 1), op("gt"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">contains-subsequence(
  ("Alpha", "Beta", "Gamma", "Delta"), ("B", "G"),
  starts-with#2
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">contains-subsequence(
  ("Zero", "Alpha", "Beta", "Gamma", "Delta", "Epsilon"),
  1 to 4,
  fn($x, $y) { ends-with($x, 'a') }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(True because there is a run of 4 consecutive items ending in <code>"a"</code>.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-deep-equal"></a>2.2.4 <a href="#func-deep-equal" style="text-decoration: none">fn:deep-equal</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-distinct-values">next</a> | <a href="#func-contains-subsequence">previous</a>)</p><ol><li><p>When comments and processing instructions are ignored, any text nodes either side of the comment or processing instruction are now merged prior to comparison.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/930">930</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/933">933</a>&nbsp;16 January 2024]</i></p></li><li><p>The <code>$options</code> parameter has been added, absorbing the <code>$collation</code> parameter.<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/934">934</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1167">1167</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1191">1191</a>&nbsp;21 May 2024]</i></p></li><li><p>A callback function can be supplied for comparing individual items.<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/99">99</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1142">1142</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1120">1120</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1150">1150</a>&nbsp;9 April 2024]</i></p></li><li><p>Atomic items of types <code>xs:hexBinary</code> and <code>xs:base64Binary</code> are now mutually comparable. In rare cases, where an application uses both types and assumes they are distinct, this can represent a backwards incompatibility.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2139">2139</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2168">2168</a>&nbsp;19 August 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p> This function assesses whether two sequences are deep-equal to each other. To be deep-equal, they must contain items that are pairwise deep-equal; and for two items to be deep-equal, they must either be atomic items that compare equal, or nodes of the same kind, with the same name, whose children are deep-equal<span>, or maps with matching entries, or arrays with matching members.</span></p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:deep-equal</code>(</td></tr><tr class="arg"><td><code>$input1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$input2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | map(*))?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>The <code>$options</code> argument, if present, defines additional parameters controlling how the comparison is done. If it is supplied as a map, then the <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>For backwards compatibility reasons, the <code>$options</code> argument can also be set to a string containing a collation name. Supplying a string <code>$S</code> for this argument is equivalent to supplying the map <code>{ 'collation': $S }</code>. Omitting the argument, or supplying the empty sequence, is equivalent to supplying the empty map.</p><p>If the two sequences (<code>$input1</code> and <code>$input2</code>) are both empty, the function returns <code>true</code>.</p><p>If the two sequences are of different lengths, the function returns <code>false</code>.</p><p>If the two sequences are of the same length, the comparison is controlled by the <code>ordered</code> option:</p><ul><li><p>By default, the option is <code>true</code>: The function returns <code>true</code> if and only if every item in the sequence <code>$input1</code> is deep-equal to the item at the same position in the sequence <code>$input2</code>. </p></li><li><p>If the option is set to <code>false</code>, the function returns <code>false</code> if and only if every item in the sequence <code>$input1</code> is deep-equal to an item at some position in the sequence <code>$input2</code>, and vice versa.</p></li></ul><p>The rules for deciding whether two items are deep-equal appear below.</p><p>The entries that may appear in the <code>$options</code> map are as follows. The detailed rules for the interpretation of each option appear later.</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">base-uri?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">collation?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">comments?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">debug?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">id-property?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">idrefs-property?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">in-scope-namespaces?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">items-equal?</code></td><td><code class="as">as&nbsp;</code><code>fn(item(), item()) as xs:boolean?</code>,</td></tr><tr class="arg"><td><code class="opt">map-order?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">namespace-prefixes?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">nilled-property?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">normalization-form?</code></td><td><code class="as">as&nbsp;</code><code>xs:string?</code>,</td></tr><tr class="arg"><td><code class="opt">ordered?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">processing-instructions?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">timezones?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">type-annotations?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">type-variety?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">typed-values?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">unordered-elements?</code></td><td><code class="as">as&nbsp;</code><code>xs:QName*</code>,</td></tr><tr class="arg"><td><code class="opt">whitespace?</code></td><td><code class="as">as&nbsp;</code><code>enum("preserve", "strip", "normalize")</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>base-uri?</code></p></td><td class="fos-thin">Determines whether the <code>base-uri</code> of a node is significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>collation?</code></p></td><td class="fos-thin">Identifies a collation which is used at all levels of recursion when strings are compared (but not when names are compared), according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>. If the argument is not supplied, or if it is empty, then the default collation from the dynamic context of the caller is used. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>fn:default-collation()</code></p></li></ul></td></tr><tr><td><p><code>comments?</code></p></td><td class="fos-thin">Determines whether comments are significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>debug?</code></p></td><td class="fos-thin">Requests diagnostics in the case where the function returns <code>false</code>. When this option is set and the two inputs are found to be not equal, the implementation <span class="verb">should</span> output messages (in an implementation-dependent format and to an implementation-dependent destination) indicating the nature of the differences that were found. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>id-property?</code></p></td><td class="fos-thin">Determines whether the <code>id</code> property of elements and attributes is significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>idrefs-property?</code></p></td><td class="fos-thin">Determines whether the <code>idrefs</code> property of elements and attributes is significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>in-scope-namespaces?</code></p></td><td class="fos-thin">Determines whether the in-scope namespaces of elements are significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>items-equal?</code></p></td><td class="fos-thin">A user-supplied function to test whether two items are considered equal. The function can return <code>true</code> or <code>false</code> to indicate that two items are or are not equal, overriding the normal rules that would apply to those items; or it can return the empty sequence, to indicate that the normal rules should be followed. Note that returning <code>()</code> is <em>not</em> equivalent to returning <code>false</code>. <ul><li><p><b>Type: </b><code>fn(item(), item()) as xs:boolean?</code></p></li><li><p><b>Default: </b><a href="#func-void"><code>fn:void#0</code></a></p></li></ul></td></tr><tr><td><p><code>map-order?</code></p></td><td class="fos-thin">Determines whether the order of entries in maps is significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>namespace-prefixes?</code></p></td><td class="fos-thin">Determines whether namespace prefixes in <code>xs:QName</code> values (particularly the names of elements and attributes) are significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>nilled-property?</code></p></td><td class="fos-thin">Determines whether the <code>nilled</code> property of elements and attributes is significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>normalization-form?</code></p></td><td class="fos-thin">If present, indicates that text and attributes are converted to the specified Unicode normalization form prior to comparison. The value is as for the corresponding argument of <a href="#func-normalize-unicode"><code>fn:normalize-unicode</code></a>. <ul><li><p><b>Type: </b><code>xs:string?</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>ordered?</code></p></td><td class="fos-thin">Controls whether the top-level order of the items of the input sequences is considered. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr><tr><td><p><code>processing-instructions?</code></p></td><td class="fos-thin">Determines whether processing instructions are significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>timezones?</code></p></td><td class="fos-thin">Determines whether timezones in date/time values are significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>type-annotations?</code></p></td><td class="fos-thin">Determines whether type annotations are significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>type-variety?</code></p></td><td class="fos-thin">Determines whether the variety of the type annotation of an element (whether it has complex content or simple content) is significant. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr><tr><td><p><code>typed-values?</code></p></td><td class="fos-thin">Determines whether nodes are compared using their typed values rather than their string values. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr><tr><td><p><code>unordered-elements?</code></p></td><td class="fos-thin">A list of QNames of elements considered to be unordered: that is, their child elements may appear in any order. <ul><li><p><b>Type: </b><code>xs:QName*</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>whitespace?</code></p></td><td class="fos-thin"><span>Determines the extent to which whitespace is treated as significant. The value <code>preserve</code> retains all whitespace. The value <code>strip</code> ignores text nodes consisting entirely of whitespace. The value <code>normalize</code> ignores whitespace text nodes in the same way as the <code>strip</code> option, and additionally compares text and attribute nodes after normalizing whitespace in accordance with the rules of the <a href="#func-normalize-space"><code>fn:normalize-space</code></a> function. The detailed rules, given below, also take into account type annotations and <code>xml:space</code> attributes. </span><ul><li><p><b>Type: </b><code>enum("preserve", "strip", "normalize")</code></p></li><li><p><b>Default: </b><code>preserve</code></p></li></ul></td></tr></tbody></table><div class="note"><p class="prefix"><b>Note:</b></p><p>As a general rule for boolean options (but not invariably), the value <code>true</code> indicates that the comparison is more strict. </p></div><p>In the following rules, where a recursive call on <a href="#func-deep-equal"><code>fn:deep-equal</code></a> is made, this is assumed to use the same values of <code>$options</code> as the original call.</p><p>The rules reference a function <code>equal-strings</code> which compares two <code>xs:string</code> or <code>xs:anyURI</code> values as follows:</p><ol class="enumar"><li><p>If the <code>whitespace</code> option is set to <code>normalize</code>, then each string is processed by calling the <a href="#func-normalize-space"><code>fn:normalize-space</code></a> function.</p></li><li><p>If the <code>normalization-form</code> option is present, each string is then normalized by calling the <a href="#func-normalize-unicode"><code>fn:normalize-unicode</code></a> function, supplying the specified normalization form.</p></li><li><p>The two strings are then compared for equality under the requested collation.</p></li></ol><p>More formally, the <code>equal-strings</code> function is equivalent to the following implementation in XQuery:</p><div class="exampleInner"><pre xml:space="preserve" class="small">declare function equal-strings(
  $string1  as xs:string,
  $string2  as xs:string, 
  $options  as map(*)
) as xs:boolean {
  let $n1 := if ($options?normalization-form)
             then normalize-unicode(?, $options?normalization-form) 
             else identity#1
  let $n2 := if ($options?whitespace = "normalize")
             then normalize-space#1 
             else identity#1               
  return compare($n1($n2($string1)), $n1($n2($string2)), $options?collation) eq 0    
}</pre></div><p>The rules for deciding whether two items <code>$i1</code> and <code>$i2</code> are deep-equal are as follows.</p><p>The two items are first compared using the function supplied in the <code>items-equal</code> option. If this returns <code>true</code> then the items are deep-equal. If it returns <code>false</code> then the items are not deep-equal. If it returns the empty sequence (which is always the case if the option is not explicitly specified) then the two items are deep-equal if one or more of the following conditions are true:</p><ol class="enumar"><li><p>All of the following conditions are true:</p><ol class="enumla"><li><p><code>$i1</code> is an atomic item.</p></li><li><p><code>$i2</code> is an atomic item.</p></li><li><p>Either the <code>type-annotations</code> option is <code>false</code>, or both atomic items have the same type annotation.</p></li><li><p>One of the following conditions is true:</p><ol class="enumlr"><li><p>If both <code>$i1</code> and <code>$i2</code> are instances of <code>xs:string</code>, <code>xs:untypedAtomic</code>, or <code>xs:anyURI</code>, <code>equal-strings($i1, $i2, $collation, $options)</code> returns <code>true</code>. </p></li><li><p>Otherwise, <code>fn:compare($i1, $i2)</code> returns zero. </p></li></ol><p>If <code>$i1</code> and <code>$i2</code> are not comparable, that is, if the expression <code>compare($i1, $i2)</code> raises an error, then the function returns <code>false</code>; it does not report an error.</p></li><li><p>One of the following conditions is true:</p><ol class="enumlr"><li><p>Option <code>namespace-prefixes</code> is <code>false</code>.</p></li><li><p>Neither <code>$i1</code> nor <code>$i2</code> is of type <code>xs:QName</code> or <code>xs:NOTATION</code>.</p></li><li><p><code>$i1</code> and <code>$i2</code> are qualified names with the same namespace prefix.</p></li></ol></li><li><p>One of the following conditions is true:</p><ol class="enumlr"><li><p>Option <code>timezones</code> is <code>false</code>.</p></li><li><p>Neither <code>$i1</code> nor <code>$i2</code> is of type <code>xs:date</code>, <code>xs:time</code>, <code>xs:dateTime</code>, <code>xs:gYear</code>, <code>xs:gYearMonth</code>, <code>xs:gMonth</code>, <code>xs:gMonthDay</code>, or <code>xs:gDay</code>.</p></li><li><p>Neither <code>$i1</code> nor <code>$i2</code> has a timezone component.</p></li><li><p>Both <code>$i1</code> and <code>$i2</code> have a timezone component and the timezone components are equal.</p></li></ol></li></ol></li><li><p>All of the following conditions are true:</p><ol class="enumla"><li><p><code>$i1</code> is a map.</p></li><li><p><code>$i2</code> is a map.</p></li><li><p>Both maps have the same number of entries.</p></li><li><p>For every entry in the first map, there is an entry in the second map that:</p><ol class="enumlr"><li><p>has the <a title="same key" class="termref" href="#dt-same-key">same key</a> (note that the collation is not used when comparing keys), and </p></li><li><p>has the same associated value (compared using the <a href="#func-deep-equal"><code>fn:deep-equal</code></a> function, recursively).</p></li></ol></li><li><p>Either <code>map-order</code> is false, or the entries in both maps appear in the same order, that is, the <var>Nth</var> key in the first map is the <a title="same key" class="termref" href="#dt-same-key">same key</a> as the <var>Nth</var> key in the second map, for all <var>N</var>.</p></li></ol></li><li><p>All the following conditions are true:</p><ol class="enumla"><li><p><code>$i1</code> is an array.</p></li><li><p><code>$i2</code> is an array.</p></li><li><p>Both arrays have the same number of members (<code>array:size($i1) eq array:size($i2)</code>).</p></li><li><p>Members in the same position of both arrays are deep-equal to each other: that is, <code>every $p in 1 to array:size($i1) satisfies deep-equal($i1($p), $i2($p), $collation, $options).</code></p></li></ol></li><li><p>All the following conditions are true:</p><ol class="enumla"><li><p><code>$i1</code> is a function item and is not a map or array.</p></li><li><p><code>$i2</code> is a function item and is not a map or array.</p></li><li><p><code>$i1</code> and <code>$i2</code> have the same function identity. The concept of function identity is explained in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#function-items">8.1 Function Items</a>.</p></li></ol></li><li><p>All the following conditions are true:</p><ol class="enumla"><li><p><code>$i1</code> is a node (specifically, an XNode).</p></li><li><p><code>$i2</code> is a node (specifically, an XNode).</p></li><li><p>Both nodes have the same node kind.</p></li><li><p>Either the <code>base-uri</code> option is <code>false</code>, or both nodes have the same value for their base URI property, or both nodes have an absent base URI.</p></li><li><p>Let <code>significant-children($parent)</code> be the sequence of nodes obtained by applying the following steps to the children of <code>$parent</code>, in turn:</p><ol class="enumlr"><li><p>Comment nodes are discarded if the option <code>comments</code> is <code>false</code>.</p></li><li><p>Processing instruction nodes are discarded if the option <code>processing-instructions</code> is <code>false</code>.</p></li><li><p>Adjacent text nodes are merged.</p></li><li><p>Whitespace-only text nodes are discarded if both the following conditions are true:</p><ol class="enumua"><li><p>The option <code>whitespace</code> is set to <code>strip</code> or <code>normalize</code>; and</p></li><li><p>The text node is not within the scope of an element that has the attribute <code>xml:space="preserve"</code>.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Whitespace text nodes will already have been discarded if <code>$parent</code> is a schema-validated element node whose type annotation is a complex type with an element-only or empty content model.</p></div></li></ol></li><li><p>One of the following conditions is true.</p><ol class="enumlr"><li><p>Both nodes are document nodes, and the sequence <code>significant-children($i1)</code> is deep-equal to the sequence <code>significant-children($i2)</code>.</p></li><li><p>Both nodes are element nodes, and all the following conditions are true:</p><ol class="enumua"><li><p>The two nodes have the same name, that is <code>(node-name($i1) eq node-name($i2))</code>.</p></li><li><p>Either the option <code>namespace-prefixes</code> is <code>false</code>, or both element names have the same prefix.</p></li><li><p>Either the option <code>in-scope-namespaces</code> is <code>false</code>, or both element nodes have the same in-scope namespace bindings.</p></li><li><p>Either the option <code>type-annotations</code> is <code>false</code>, or both element nodes have the same type annotation.</p></li><li><p>Either the option <code>id-property</code> is <code>false</code>, or both element nodes have the same value for their <code>is-id</code> property.</p></li><li><p>Either the option <code>idrefs-property</code> is <code>false</code>, or both element nodes have the same value for their <code>is-idrefs</code> property.</p></li><li><p>Either the option <code>nilled-property</code> is <code>false</code>, or both element nodes have the same value for their <code>nilled</code> property.</p></li><li><p>One of the following conditions is true:</p><ol class="enumur"><li><p>The option <code>type-variety</code> is <code>false</code>.</p></li><li><p>Both nodes are annotated as having simple content. For this purpose <b>simple content</b> means either a simple type or a complex type with simple content.</p></li><li><p>Both nodes are annotated as having complex content. For this purpose <b>complex content</b> means a complex type whose variety is mixed, element-only, or empty.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>It is a consequence of this rule that, by default, validating a document <var>D</var> against a schema will usually (but not necessarily) result in a document that is not deep-equal to <var>D</var>. The exception is when the schema allows all elements to have mixed content.</p></div></li><li><p>The two nodes have the same number of attributes, and for every attribute <code>$a1</code> in <code>$i1/@*</code> there exists an attribute <code>$a2</code> in <code>$i2/@*</code> such that <code>node-name($a1) eq node-name($a2)</code> and <code>$a1</code> and <code>$a2</code> are deep-equal.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Attributes, like other items, may be compared using the supplied <code>items-equal</code> function. However, this function will not be called to compare two attribute nodes unless they have the same name.</p></div></li><li><p> One of the following conditions holds:</p><ol class="enumur"><li><p>Both element nodes are annotated as having simple content (as defined above), the <code>typed-values</code> option is <code>true</code>, and the typed value of <code>$i1</code> is deep-equal to the typed value of <code>$i2</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The typed value of an element node is used only when the element has simple content, which means that no error can occur as a result of atomizing a node with no typed value.</p></div></li><li><p>Both element nodes are annotated as having simple content (as defined above), the <code>typed-values</code> option is <code>false</code>, and the <code>equal-strings</code> function returns <code>true</code> when applied to the string value of <code>$i1</code> and the string value of <code>$i2</code>.</p></li><li><p>Both element nodes have a type annotation that is a complex type with element-only, mixed, or empty content, the (common) element name is not present in the <code>unordered-elements</code> option, and the sequence <code>significant-children($i1)</code> is deep-equal to the sequence <code>significant-children($i2)</code>.</p></li><li><p>Both element nodes have a type annotation that is a complex type with element-only, mixed, or empty content, the (common) element name is present in the <code>unordered-elements</code> option, and the sequence <code>significant-children($i1)</code> is deep-equal to some permutation of the sequence <code>significant-children($i2)</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Elements annotated as <code>xs:untyped</code> fall into this category.</p><p>Including an element name in the <code>unordered-elements</code> list is unlikely to be useful except when the relevant elements have element-only content, but this is not a requirement: the rules apply equally to elements with mixed content, or even (trivially) to elements with empty content.</p></div></li></ol></li></ol></li><li><p>Both nodes are attribute nodes, and all the following conditions are true:</p><ol class="enumua"><li><p>The two attribute nodes have the same name, that is <code>(node-name($i1) eq node-name($i2))</code>.</p></li><li><p>Either the option <code>namespace-prefixes</code> is <code>false</code>, or both attribute names have the same prefix.</p></li><li><p>Either the option <code>type-annotations</code> is <code>false</code>, or both attribute nodes have the same type annotation.</p></li><li><p>Either the option <code>id-property</code> is <code>false</code>, or both attribute nodes have the same value for their <code>is-id</code> property.</p></li><li><p>Either the option <code>idrefs-property</code> is <code>false</code>, or both attribute nodes have the same value for their <code>is-idrefs</code> property.</p></li><li><p>Let <var>T</var> be true if the option <code>typed-value</code> is true and both attributes <code>$i1</code> and <code>$i2</code> have a type annotation other than <code>xs:untypedAtomic</code>.</p><p>Then either <var>T</var> is true and the typed value of <code>$i1</code> is deep-equal to the typed value of <code>$i2</code>, or <var>T</var> is false and the <code>equal-strings</code> function returns true when applied to the string value of <code>$i1</code> and the string value of <code>$i2</code>. </p></li></ol></li><li><p>Both nodes are processing instruction nodes, and all the following conditions are true:</p><ol class="enumua"><li><p>The two nodes have the same name, that is <code>(node-name($i1) eq node-name($i2))</code>.</p></li><li><p>The <code>equal-strings</code> function returns <code>true</code> when applied to the string value of <code>$i1</code> and the string value of <code>$i2</code>.</p></li></ol></li><li><p>Both nodes are namespace nodes, and all the following conditions are true:</p><ol class="enumua"><li><p>The two nodes either have the same name or are both nameless, that is <code>fn:deep-equal(node-name($i1), node-name($i2))</code>.</p></li><li><p>The string value of <code>$i1</code> is equal to the string value of <code>$i2</code> when compared using the Unicode codepoint collation.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Namespace nodes are not considered directly unless they appear in the top-level sequences passed explicitly to the <a href="#func-deep-equal"><code>fn:deep-equal</code></a> function.</p></div></li><li><p>Both nodes are comment nodes, and the <code>equal-strings</code> function returns <code>true</code> when applied to their string values.</p></li><li><p>Both nodes are text nodes, and the <code>equal-strings</code> function returns <code>true</code> when applied to their string values.</p></li></ol></li></ol></li><li><p>All the following conditions are true:</p><ol class="enumla"><li><p><code>$i1</code> is a JNode.</p></li><li><p><code>$i2</code> is a JNode.</p></li><li><p>The <b>·content·</b> property of <code>$i1</code> is deep-equal to the <b>·content·</b> property of <code>$i2</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The other properties of the two JNodes, such as <b>·parent·</b> and <b>·selector·</b>, are ignored. As with XNodes, deep equality considers only the subtree rooted at the node, and not its position within a containing tree.</p></div></li></ol></li></ol><p>In all other cases the result is <code>false</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> if the value of <code>$options</code> includes an entry whose key is defined in this specification, and whose value is not of the permitted type for that key.</p><p>A dynamic error is raised [<a href="#ERRFOJS0005" title="err:FOJS0005">err:FOJS0005</a>] if the value of <code>$options</code> includes an entry whose key is defined in this specification, and whose value is not a permitted value for that key.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>By default, whitespace in text nodes and attributes is considered significant. There are various ways whitespace differences can be ignored:</p><ul><li><p>If nodes have been schema-validated, setting the <code>typed-values</code> option to true causes the typed values rather than the string values to be compared. This will typically cause whitespace to be ignored except where the type of the value is <code>xs:string</code>.</p></li><li><p>Setting the <code>whitespace</code> option to <code>normalize</code> causes all text and attribute nodes to have leading and trailing whitespace removed, and intermediate whitespace reduced to a single character.</p></li></ul><p>By default, two nodes are not required to have the same type annotation, and they are not required to have the same in-scope namespaces. They may also differ in their parent, their base URI, and the values returned by the <code>is-id</code> and <code>is-idrefs</code> accessors (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-is-id">7.6.5 is-id Accessor</a> and <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-is-idrefs">7.6.6 is-idrefs Accessor</a>). The order of children is significant, but the order of attributes is insignificant. </p><p>By default, the contents of comments and processing instructions are significant only if these nodes appear directly as items in the two sequences being compared. The content of a comment or processing instruction that appears as a descendant of an item in one of the sequences being compared does not affect the result. <span>In previous versions of this specification, the presence of a comment or processing instruction, if it caused text to be split across two text nodes, might affect the result; this has been changed in 4.0 so that adjacent text nodes are merged after comments and processing instructions have been stripped.</span></p><p>Comparing items of different kind (for example, comparing an atomic item to a node, or a map to an array, or an integer to an <code>xs:date</code>) returns <code>false</code>, it does not return an error. So the result of <code>fn:deep-equal(1, current-dateTime())</code> is <code>false</code>.</p><p>The <code>items-equal</code> callback function may be used to override the default rules for comparing individual items. For example, it might return <code>true</code> unconditionally when comparing two <code>@timestamp</code> attributes, if there is no expectation that the two trees will have identical timestamps. Given two nodes <code>$n1</code> and <code>$n2</code>, it might compare them using the <code>is</code> operator, so that instead of comparing the descendants of the two nodes, the function simply checks whether they are the same node. Given two function items <code>$f1</code> and <code>$f2</code> it might return true unconditionally, knowing that there is no effective way to test if the functions are equivalent. Given two numeric values, it might return <code>true</code> if they are equal to six decimal places.</p><p>It is good practice for the <code>items-equal</code> callback function to be reflexive, symmetric, and transitive; if it is not, then the <a href="#func-deep-equal"><code>fn:deep-equal</code></a> function itself will lack these qualities. <em>Reflexive</em> means that every item (including <code>NaN</code>) should be equal to itself; <em>symmetric</em> means that <code>items-equal(A, B)</code> should return the same result as <code>items-equal(B, A)</code>, and <em>transitive</em> means that <code>items-equal(A, B)</code> and <code>items-equal(B, C)</code> should imply <code>items-equal(A, C)</code>.</p><p>Setting the <code>ordered</code> option to <code>false</code> or supplying the <code>unordered-elements</code> option may result in poor performance when comparing long sequences, especially if the <code>items-equal</code> callback function is supplied.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $at := &lt;attendees&gt;
  &lt;name last="Parker" first="Peter"/&gt;
  &lt;name last="Barker" first="Bob"/&gt;
  &lt;name last="Parker" first="Peter"/&gt;
&lt;/attendees&gt;</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>deep-equal($at, $at/*)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>deep-equal($at/name[1], $at/name[2])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>deep-equal($at/name[1], $at/name[3])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>deep-equal($at/name[1], 'Peter Parker')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">deep-equal(
  $at//name[@first="Bob"], 
  $at//name[@last="Barker"],
  options := { 'items-equal': op('is') } 
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(Tests whether the two input sequences contain exactly the same nodes.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>deep-equal([ 1, 2, 3], [ 1, 2, 3 ])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>deep-equal((1, 2, 3), [ 1, 2, 3 ])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">deep-equal(
  { 1: 'a', 2: 'b' },
  { 2: 'b', 1: 'a' }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">deep-equal(
  (1, 2, 3, 4),
  (1, 4, 3, 2),
  options := { 'ordered': false() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">deep-equal(
  (1, 1, 2, 3),
  (1, 2, 3, 3),
  options := { 'ordered': false() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">deep-equal(
  parse-xml("&lt;a xmlns='AA'/&gt;"),
  parse-xml("&lt;p:a xmlns:p='AA'/&gt;")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(By default, namespace prefixes are ignored).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">deep-equal(
  parse-xml("&lt;a xmlns='AA'/&gt;"),
  parse-xml("&lt;p:a xmlns:p='AA'/&gt;"),
  options := { 'namespace-prefixes': true() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div><p><em>(False because the namespace prefixes differ).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">deep-equal(
  parse-xml("&lt;a xmlns='AA'/&gt;"),
  parse-xml("&lt;p:a xmlns:p='AA'/&gt;"),
  options := { 'in-scope-namespaces': true() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div><p><em>(False because the in-scope namespace bindings differ).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">deep-equal(
  parse-xml("&lt;a&gt;&lt;b/&gt;&lt;c/&gt;&lt;/a&gt;"),
  parse-xml("&lt;a&gt;&lt;c/&gt;&lt;b/&gt;&lt;/a&gt;")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div><p><em>(By default, order of elements is significant).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">deep-equal(
  parse-xml("&lt;a&gt;&lt;b/&gt;&lt;c/&gt;&lt;/a&gt;"),
  parse-xml("&lt;a&gt;&lt;c/&gt;&lt;b/&gt;&lt;/a&gt;"),
  options := { 'unordered-elements': #a }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(The <code>unordered-elements</code> option means that the ordering of the children of <code>a</code> is ignored.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">deep-equal(
  parse-xml("&lt;para style='bold'&gt;&lt;span&gt;x&lt;/span&gt;&lt;/para&gt;"),
  parse-xml("&lt;para style=' bold'&gt; &lt;span&gt;x&lt;/span&gt;&lt;/para&gt;")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div><p><em>(By default, both the leading whitespace in the <code>style</code> attribute and the whitespace text node preceding the <code>span</code> element are significant.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">deep-equal(
  parse-xml("&lt;para style='bold'&gt;&lt;span&gt;x&lt;/span&gt;&lt;/para&gt;"),
  parse-xml("&lt;para style=' bold'&gt; &lt;span&gt;x&lt;/span&gt;&lt;/para&gt;"),
  options := { 'whitespace': 'normalize' }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(The <code>whitespace</code> option causes both the leading space in the attribute value and the whitespace preceding the <code>span</code> element to be ignored.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">deep-equal(
  (1, 2, 3), 
  (1.0007, 1.9998, 3.0005),
  options := { 'items-equal': fn($x, $y) {
    if (($x, $y) instance of xs:numeric+) {
      abs($x - $y) lt 0.001
    }
  } }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(For numeric values, the callback function tests whether they are approximately equal. For any other items, it returns the empty sequence, so the normal comparison rules apply.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">deep-equal(
  (1, 2, 3, 4, 5), 
  (1, 2, 3, 8, 5),
  options := { 'items-equal': fn($x, $y) {
    trace((), `comparing { $x } and { $y }`)
  } }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div><p><em>(The callback function traces which items are being compared, without changing the result of the comparison.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-distinct-values"></a>2.2.5 <a href="#func-distinct-values" style="text-decoration: none">fn:distinct-values</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-duplicate-values">next</a> | <a href="#func-deep-equal">previous</a>)</p><ol><li><p>Changed in 4.0 to use transitive equality comparisons for numeric values.</p></li><li><p>The order of results is now prescribed; it was previously implementation-dependent.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/628">628</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/987">987</a>&nbsp;6 February 2024]</i></p></li><li><p>Atomic items of types <code>xs:hexBinary</code> and <code>xs:base64Binary</code> are now mutually comparable. In rare cases, where an application uses both types and assumes they are distinct, this can represent a backwards incompatibility.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2139">2139</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2168">2168</a>&nbsp;14 August 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the values that appear in a sequence, with duplicates eliminated.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:distinct-values</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the sequence that results from removing from <code>$values</code> all but one of a set of values that are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a> to one another, when compared using the collation selected according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a> and the implicit timezone from the dynamic context. </p><p>The ordering of the result is as follows:</p><ul><li><p>For any set of values that compare equal, the one that is returned is the one that appears first in <code>$values</code>.</p></li><li><p>The items that are returned appear in the order of their first appearance within <code>$values</code>.</p></li></ul></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">filter($values, 
  fn($item, $pos) {
    empty(
      filter(
        subsequence($values, 1, $pos - 1),
        deep-equal(?, $item, $collation)
      )
    )
  }
)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$values</code> is the empty sequence, the function returns the empty sequence.</p><p>Values of type <code>xs:untypedAtomic</code> are compared as if they were of type <code>xs:string</code>.</p><p>Values that cannot be compared, because the <code>eq</code> operator is not defined for their types, are considered to be distinct.</p><p>For numeric values, the rules are the same as <a href="#func-atomic-equal"><code>fn:atomic-equal</code></a>: positive and negative zero are treated as equal, <code>NaN</code> is treated as equal to <code>NaN</code>, and values of different numeric types are converted to unlimited-precision decimals for comparison purposes.</p><p> If <code>xs:dateTime</code>, <code>xs:date</code> or <code>xs:time</code> values do not have a timezone, they are considered to have the implicit timezone provided by the dynamic context for the purpose of comparison. Note that <code>xs:dateTime</code>, <code>xs:date</code> or <code>xs:time</code> values can compare equal even if their timezones are different.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>distinct-values((1, 2.0, 3, 2))</code></pre></div></td><td style="vertical-align:top"><p><code>1, 2.0, 3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">distinct-values((
  xs:untypedAtomic("cherry"),
  xs:untypedAtomic("plum"),
  xs:untypedAtomic("plum")
))</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:untypedAtomic("cherry"), xs:untypedAtomic("plum")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-duplicate-values"></a>2.2.6 <a href="#func-duplicate-values" style="text-decoration: none">fn:duplicate-values</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-ends-with-subsequence">next</a> | <a href="#func-distinct-values">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/123">123</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/628">628</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1869">1869</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/614">614</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/987">987</a>&nbsp;18 July 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the values that appear in a sequence more than once.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:duplicate-values</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>The items of <code>$values</code> are compared against each other, according to the rules of <a href="#func-distinct-values"><code>fn:distinct-values</code></a> and with <code>$collation</code> as the collation selected according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>From each resulting set of values that are considered equal, one value will be returned if the set contains more than one value.</p><p>Specifically, the function returns those items in <code>$values</code> that are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a> to exactly one item appearing earlier in the sequence.</p><p>This means that the ordering of the result is as follows:</p><ul><li><p>For any set of values that compare equal, the one that is returned is the one that appears second in <code>$values</code>.</p></li><li><p>The items that are returned appear in the order of their second appearance within <code>$values</code>.</p></li></ul></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">filter(
  $values, 
  fn($item, $pos) {
    count(
      filter(
        subsequence($values, 1, $pos - 1),
        deep-equal(?, $item, $collation)
      )
    ) eq 1
  }
)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The comparison rules are exactly the same as the <a href="#func-distinct-values"><code>fn:distinct-values</code></a> function.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>duplicate-values((1, 2, 3, 1.0, 1e0))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1.0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>duplicate-values(1 to 100)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>duplicate-values(('1', &lt;x&gt;1&lt;/x&gt;, '2', 2))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>xs:untypedAtomic("1")</code></p><p><em>(The string <code>"1"</code> and the untyped value of the element node are considered equal, whereas the string <code>"2"</code> and the integer are considered unequal.)</em></p></td></tr><tr><td colspan="2"><p>Raise an error for duplicates in an ID sequence:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $ids := duplicate-values(//@id)
where exists($ids)
return error((), 'Duplicate IDs found: ' || string-join($ids, ', '))</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-ends-with-subsequence"></a>2.2.7 <a href="#func-ends-with-subsequence" style="text-decoration: none">fn:ends-with-subsequence</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-index-of">next</a> | <a href="#func-duplicate-values">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/92">92</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/222">222</a>&nbsp;1 November 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Determines whether one sequence ends with another, using a supplied callback function to compare items.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:ends-with-subsequence</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$subsequence</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$compare</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item(), item()) as xs:boolean?)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:deep-equal#2</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function returns <code>true</code> if <code>$input</code> ends with <code>$subsequence</code>, when items are compared using the supplied (or default) <code>$compare</code> function.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">starts-with-subsequence(reverse($input), reverse($subsequence), $compare)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>There is no requirement that the <code>$compare</code> function should have the traditional qualities of equality comparison. The result is well-defined, for example, even if <code>$compare</code> is not transitive or not symmetric.</p><p>A return value of <code>()</code> from the function is treated as <code>false</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>ends-with-subsequence((), ())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>ends-with-subsequence(1 to 10, 5 to 10)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>ends-with-subsequence(1 to 10, ())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>ends-with-subsequence(1 to 10, 1 to 10)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>ends-with-subsequence(1 to 10, 10)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">ends-with-subsequence(
  1 to 10,
  108 to 110,
  fn($x, $y) { $x mod 100 = $y mod 100 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">ends-with-subsequence(
  ("A", "B", "C"),
  ("b", "c"),
  fn($x, $y) {
    compare(
      $x,
      $y,
      "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
    ) eq 0
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $p := parse-xml("&lt;doc&gt;&lt;chap&gt;&lt;p/&gt;&lt;p/&gt;&lt;/chap&gt;&lt;/doc&gt;")//p[2]
return ends-with-subsequence(
  $p/ancestor::node()[last()],
  $p/root(),
  op("is")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>ends-with-subsequence(10 to 20, 1 to 5, op("gt"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">ends-with-subsequence(
  ("Alpha", "Beta", "Gamma"),
  ("B", "G"),
  starts-with#2
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">ends-with-subsequence(
  ("Alpha", "Beta", "Gamma", "Delta"),
  1 to 2,
  fn($x, $y) { string-length($x) eq 5 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(True because the last two items in the input sequence have a string length of 5.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-index-of"></a>2.2.8 <a href="#func-index-of" style="text-decoration: none">fn:index-of</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-starts-with-subsequence">next</a> | <a href="#func-ends-with-subsequence">previous</a>)</p><ol><li><p>In the interests of consistency, the <a href="#func-index-of"><code>index-of</code></a> function now defines equality to mean <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a>. This has the implication that <code>NaN</code> is now considered equal to <code>NaN</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2216">2216</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2256">2256</a>&nbsp;1 December 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a sequence of positive integers giving the positions within the sequence <code>$input</code> of items that are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a> to <code>$target</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:index-of</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$target</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence of positive integers giving the 1-based positions within the sequence <code>$input</code> of items that are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a> to <code>$target</code>.</p><p>The collation used by this function is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>. This collation is used when string comparison is required.</p><p>The result sequence is in ascending numeric order.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$input</code> is the empty sequence, or if no item in <code>$input</code> matches <code>$target</code>, then the function returns the empty sequence.</p><p>No error occurs if non-comparable values are encountered. So when comparing two atomic items, the effective boolean value of <code>fn:index-of($a, $b)</code> is <code>true</code> if <code>$a</code> and <code>$b</code> are equal, <code>false</code> if they are not equal or not comparable.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>index-of((10, 20, 30, 40), 35)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>index-of((10, 20, 30, 30, 20, 10), 20)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>2, 5</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">index-of(
  ("a", "sport", "and", "a", "pastime"),
  "a"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, 4</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">index-of(
  ("a", "b", "c"),
  "B",
  "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>index-of(current-date(), 23)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>index-of([ 1, [ 5, 6 ], [ 6, 7 ] ], 6)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>3, 4</code></p><p><em>(The array is atomized to a sequence of five integers).</em></p></td></tr><tr><td colspan="2"><p>If <code>@a</code> is an attribute of type <code>xs:NMTOKENS</code> whose string value is <code>"red green blue"</code>, and whose typed value is therefore <code>("red", "green", "blue")</code>, then <code>fn:index-of(@a, "blue")</code> returns <code>3</code>. This is because the function calling mechanism atomizes the attribute node to produce a sequence of three <code>xs:NMTOKEN</code> values.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-starts-with-subsequence"></a>2.2.9 <a href="#func-starts-with-subsequence" style="text-decoration: none">fn:starts-with-subsequence</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-all-equal">next</a> | <a href="#func-index-of">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/92">92</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/222">222</a>&nbsp;1 November 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Determines whether one sequence starts with another, using a supplied callback function to compare items.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:starts-with-subsequence</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$subsequence</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$compare</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item(), item()) as xs:boolean?)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:deep-equal#2</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function returns <code>true</code> if <code>$input</code> starts with <code>$subsequence</code>, when items are compared using the supplied (or default) <code>$compare</code> function.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">count($input) ge count($subsequence) and
every(for-each-pair($input, $subsequence, $compare))</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>There is no requirement that the <code>$compare</code> function should have the traditional qualities of equality comparison. The result is well-defined, for example, even if <code>$compare</code> is not transitive or not symmetric. A return value of <code>()</code> from the function is treated as <code>false</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>starts-with-subsequence((), ())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>starts-with-subsequence(1 to 10, 1 to 5)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>starts-with-subsequence(1 to 10, ())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>starts-with-subsequence(1 to 10, 1 to 10)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>starts-with-subsequence(1 to 10, 1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">starts-with-subsequence(
  1 to 10,
  101 to 105,
  fn($x, $y) { $x mod 100 = $y mod 100 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">starts-with-subsequence(
  ("A", "B", "C"),
  ("a", "b"),
  fn($x, $y) {
    compare(
      $x,
      $y,
      "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
    ) eq 0
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $p := parse-xml("&lt;doc&gt;&lt;chap&gt;&lt;p/&gt;&lt;p/&gt;&lt;/chap&gt;&lt;/doc&gt;")//p[2]
return starts-with-subsequence(
  $p/ancestor::*[1],
  $p/parent::*,
  op("is")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>starts-with-subsequence(10 to 20, 1 to 5, op("gt"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">starts-with-subsequence(
  ("Alpha", "Beta", "Gamma"),
  ("A", "B"),
  starts-with#2
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">starts-with-subsequence(
  ("Alpha", "Beta", "Gamma", "Delta"),
  1 to 3,
  fn($x, $y) { ends-with($x, 'a' ) }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(True because the first three items in the input sequence end with <code>"a"</code>.)</em></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="cardinality-functions"></a>2.3 <a href="#cardinality-functions" style="text-decoration: none">Asserting cardinality</a></h3><p>The following functions assert the cardinality of their sequence arguments.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-exactly-one"><code>fn:exactly-one</code></a></td><td>Returns <code>$input</code> if it contains exactly one item. Otherwise, raises an error. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-one-or-more"><code>fn:one-or-more</code></a></td><td>Returns <code>$input</code> if it contains one or more items. Otherwise, raises an error. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-zero-or-one"><code>fn:zero-or-one</code></a></td><td>Returns <code>input</code> if it contains zero or one items. Otherwise, raises an error.</td></tr></tbody></table><p>The functions <a href="#func-zero-or-one"><code>fn:zero-or-one</code></a>, <a href="#func-one-or-more"><code>fn:one-or-more</code></a>, and <a href="#func-exactly-one"><code>fn:exactly-one</code></a> defined in this section, check that the cardinality of a sequence is in the expected range. These functions were originally defined for use with processors that enforced strict static typing. For example, the function call <code>fn:remove($seq, fn:index-of($seq2, 'abc'))</code> requires the result of the call on <a href="#func-index-of"><code>fn:index-of</code></a> to be a singleton integer, but the static type system could not infer this; writing the expression as <code>fn:remove($seq, fn:exactly-one(fn:index-of($seq2, 'abc')))</code> would provide a suitable static type at query analysis time, and ensure that the length of the sequence is correct with a dynamic check at query execution time.</p><p>The 4.0 specifications no longer define strict static typing as an option, so the utility of these functions has declined. They may still serve a purpose, however, as assertions signaling expected preconditions both to the processor and to anyone reading the code.</p><p>The type signatures for these functions deliberately declare the argument type as <code>item()*</code>, permitting a sequence of any length. A more restrictive signature would defeat the purpose of the function, which is to defer cardinality checking until query execution time.</p><div class="div3"><h4><a id="func-exactly-one"></a>2.3.1 <a href="#func-exactly-one" style="text-decoration: none">fn:exactly-one</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>$input</code> if it contains exactly one item. Otherwise, raises an error. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:exactly-one</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Except in error cases, the function returns <code>$input</code> unchanged.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression, except in error cases.</p><div class="exampleInner"><pre xml:space="preserve" class="small">if (count($input) eq 1) 
then $input 
else error(parse-QName('Q{http://www.w3.org/2005/xqt-errors}FORG0005'))</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORG0005" title="err:FORG0005">err:FORG0005</a>] if <code>$input</code> is an empty sequence or a sequence containing more than one item.</p></dd></dl></div><div class="div3"><h4><a id="func-one-or-more"></a>2.3.2 <a href="#func-one-or-more" style="text-decoration: none">fn:one-or-more</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>$input</code> if it contains one or more items. Otherwise, raises an error. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:one-or-more</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()+</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Except in error cases, the function returns <code>$input</code> unchanged.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression, except in error cases.</p><div class="exampleInner"><pre xml:space="preserve" class="small">if (count($input) ge 1) 
then $input 
else error(parse-QName('Q{http://www.w3.org/2005/xqt-errors}FORG0004'))</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORG0004" title="err:FORG0004">err:FORG0004</a>] if <code>$input</code> is an empty sequence.</p></dd></dl></div><div class="div3"><h4><a id="func-zero-or-one"></a>2.3.3 <a href="#func-zero-or-one" style="text-decoration: none">fn:zero-or-one</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>input</code> if it contains zero or one items. Otherwise, raises an error.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:zero-or-one</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Except in error cases, the function returns <code>$input</code> unchanged.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression, except in error cases.</p><div class="exampleInner"><pre xml:space="preserve" class="small">if (count($input) le 1) 
then $input 
else error(parse-QName('Q{http://www.w3.org/2005/xqt-errors}FORG0003'))</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORG0003" title="err:FORG0003">err:FORG0003</a>] if <code>$input</code> contains more than one item.</p></dd></dl></div></div><div class="div2"><h3><a id="aggregate-functions"></a>2.4 <a href="#aggregate-functions" style="text-decoration: none">Aggregate functions</a></h3><p>Aggregate functions take a sequence as argument and return a single value computed from values in the sequence. Except for <a href="#func-count"><code>fn:count</code></a>, the sequence must consist of values of a single type or one if its subtypes, or they must be numeric. <code>xs:untypedAtomic</code> values are permitted in the input sequence and handled by special conversion rules. The type of the items in the sequence must also support certain operations.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-count"><code>fn:count</code></a></td><td>Returns the number of items in a sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-all-equal"><code>fn:all-equal</code></a></td><td>Returns <code>true</code> if all items in a supplied sequence (after atomization) are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-all-different"><code>fn:all-different</code></a></td><td>Returns <code>true</code> if no two items in a supplied sequence are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-avg"><code>fn:avg</code></a></td><td>Returns the average of the values in the input sequence <code>$values</code>, that is, the sum of the values divided by the number of values.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-max"><code>fn:max</code></a></td><td>Returns a value that is greater than or equal to every other value appearing in the input sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-min"><code>fn:min</code></a></td><td>Returns a value that is less than or equal to every other value appearing in the input sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-sum"><code>fn:sum</code></a></td><td>Returns a value obtained by adding together the values in <code>$values</code>.</td></tr></tbody></table><div class="div3"><h4><a id="func-count"></a>2.4.1 <a href="#func-count" style="text-decoration: none">fn:count</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the number of items in a sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:count</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the number of items in <code>$input</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function is defined as follows, making use of primitive constructors and accessors defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p><div class="exampleInner"><pre xml:space="preserve">dm:count($input)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function returns <code>0</code> if <code>$input</code> is the empty sequence.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $tree := &lt;doc&gt;&lt;chap&gt;&lt;p/&gt;&lt;p/&gt;&lt;p/&gt;&lt;/chap&gt;&lt;/doc&gt;</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $seq2 := (98.5, 98.3, 98.9)</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $seq3 := ()</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>count($tree//chap/p)</code></pre></div></td><td style="vertical-align:top"><p><code>3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>count($seq3)</code></pre></div></td><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>count($seq2)</code></pre></div></td><td style="vertical-align:top"><p><code>3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>count($seq2[. &gt; 100])</code></pre></div></td><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>count([])</code></pre></div></td><td style="vertical-align:top"><p><code>1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>count([ 1, 2, 3 ])</code></pre></div></td><td style="vertical-align:top"><p><code>1</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-all-equal"></a>2.4.2 <a href="#func-all-equal" style="text-decoration: none">fn:all-equal</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-all-different">next</a> | <a href="#func-starts-with-subsequence">previous</a>)</p><ol><li><p>New in 4.0. Originally proposed under the name <code>fn:uniform</code><i>&nbsp;&nbsp;[&nbsp;&nbsp;20 September 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if all items in a supplied sequence (after atomization) are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:all-equal</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>Omitting the second argument, <code>$collation</code>, is equivalent to supplying <code>fn:default-collation()</code>. For more information on collations see <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The result of the function <code>fn:all-equal($values, $collation)</code> is <code>true</code> if and only if the result of <code>fn:count(fn:distinct-values($values, $collation)) le 1</code> is <code>true</code> (that is, if the sequence is empty, or if all the items in the sequence are equal under the rules of the <a href="#func-distinct-values"><code>fn:distinct-values</code></a> function).</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>all-equal((1, 2, 3))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>all-equal((1, 1.0, 1.0e0))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>all-equal("one")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>all-equal(())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>all-equal((xs:float('NaN'), xs:double('NaN')))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">all-equal(
  ("ABC", "abc"),
  "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td colspan="2"><p>The expression <code>fn:all-equal(//p/@class)</code> returns <code>true</code> if all <code>p</code> elements have the same value for <code>@class</code>. </p></td></tr><tr><td colspan="2"><p>The expression <code>fn:all-equal(* ! fn:node-name())</code> returns <code>true</code> if all element children of the context node have the same name. </p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-all-different"></a>2.4.3 <a href="#func-all-different" style="text-decoration: none">fn:all-different</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-avg">next</a> | <a href="#func-all-equal">previous</a>)</p><ol><li><p>New in 4.0. Originally proposed under the name <code>fn:unique</code><i>&nbsp;&nbsp;[&nbsp;&nbsp;20 September 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if no two items in a supplied sequence are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:all-different</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>Omitting the second argument, <code>$collation</code>, is equivalent to supplying <code>fn:default-collation()</code>. For more information on collations see <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The result of the function <code>fn:all-different($values, $collation)</code> is <code>true</code> if and only if the result of <code>fn:count(fn:distinct-values($values, $collation)) eq fn:count($values)</code> is <code>true</code> (that is, if the sequence is empty, or if all the items in the sequence are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually unequal</a> under the rules used by the <a href="#func-distinct-values"><code>fn:distinct-values</code></a> function).</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>all-different((1, 2, 3))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>all-different((1, 1.0, 1.0e0))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>all-different("one")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>all-different(())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">all-different(
  ("ABC", "abc"),
  "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div></td></tr><tr><td colspan="2"><p>The expression <code>fn:all-different(//employee/@ssn)</code> is <code>true</code> if no two employees have the same value for their <code>@ssn</code> attribute.</p></td></tr><tr><td colspan="2"><p>The expression <code>fn:all-different(* ! fn:node-name())</code> returns <code>true</code> if all element children of the context node have distinct names. </p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-avg"></a>2.4.4 <a href="#func-avg" style="text-decoration: none">fn:avg</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-max">next</a> | <a href="#func-all-different">previous</a>)</p><ol><li><p>In 3.1, given a mixed input sequence such as (1, 3, 4.2e0), the specification was unclear whether it was permitted to add the first two integer items using integer arithmetic, rather than converting all items to doubles before performing any arithmetic. The 4.0 specification is clear that this is permitted; but since the items can be reordered before being added, this is not required.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1682">1682</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1734">1734</a>&nbsp;27 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the average of the values in the input sequence <code>$values</code>, that is, the sum of the values divided by the number of values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:avg</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$values</code> is the empty sequence, the empty sequence is returned.</p><p>Any item in <code>$values</code> that is an instance of <code>xs:untypedAtomic</code> is cast to <code>xs:double</code>. </p><p>After this conversion, one of the following conditions must be true:</p><ol class="enumar"><li><p>Every item in <code>$values</code> is an instance of <code>xs:yearMonthDuration</code>.</p></li><li><p>Every item in <code>$values</code> is an instance of <code>xs:dayTimeDuration</code>.</p></li><li><p>Every item in <code>$values</code> is an instance of <code>xs:numeric</code>.</p></li></ol><p>The function returns the average of the values as <code>sum($values) div count($values)</code>; but the implementation may use an otherwise equivalent algorithm that avoids arithmetic overflow. Note that the <a href="#func-sum"><code>fn:sum</code></a> function allows the input sequence to be reordered, which may affect the result in edge cases when the sequence contains a mixture of different numeric types.</p></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>] if the input sequence contains items of incompatible types, as described above.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $d1 := xs:yearMonthDuration("P20Y")</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $d2 := xs:yearMonthDuration("P10M")</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $seq3 := (3, 4, 5)</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>avg($seq3)</code></pre></div></td><td style="vertical-align:top"><p><code>4.0</code></p><p><em>(The result is of type <code>xs:decimal</code>.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>avg(($d1, $d2))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:yearMonthDuration("P10Y5M")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>avg(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>avg((xs:float('INF'), xs:float('-INF')))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:float('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>avg(($seq3, xs:float('NaN')))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:float('NaN')</code></p></td></tr><tr><td colspan="2"><p><code>fn:avg(($d1, $seq3))</code> raises a type error [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>]. </p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-max"></a>2.4.5 <a href="#func-max" style="text-decoration: none">fn:max</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-min">next</a> | <a href="#func-avg">previous</a>)</p><ol><li><p>The way that <a href="#func-min"><code>fn:min</code></a> and <a href="#func-max"><code>fn:max</code></a> compare numeric values of different types has changed. The most noticeable effect is that when these functions are applied to a sequence of <code>xs:integer</code> or <code>xs:decimal</code> values, the result is an <code>xs:integer</code> or <code>xs:decimal</code>, rather than the result of converting this to an <code>xs:float</code> or <code>xs:double</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/866">866</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/881">881</a>&nbsp;6 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a value that is greater than or equal to every other value appearing in the input sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:max</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>Any item in <code>$values</code> that is an instance of <code>xs:untypedAtomic</code> is first cast to <code>xs:double</code>. The resulting sequence is referred to as the converted sequence.</p><p>All pairs of values in the converted sequence must be mutually comparable. Two values <var>A</var> and <var>B</var> are mutually comparable if <code>fn:compare(<var>A</var>, <var>B</var>)</code> raises no error.</p><p>If the converted sequence is empty, the function returns the empty sequence.</p><p>If the converted sequence contains the value <code>NaN</code>, the value <code>NaN</code> is returned <span>(as an <code>xs:float</code> or <code>xs:double</code> as appropriate)</span>.</p><p>Two items <var>A</var> and <var>B</var> from the converted sequence are compared by calling <code>fn:compare(<var>A</var>, <var>B</var>, $collation)</code>, where <code>$collation</code> is determined by the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>:</p><p>The result of the function is a value from the converted sequence that is greater than or equal to every other value under the above rules. If there is more than one such value, then it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> which of them is returned.</p></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>] if the input sequence contains items of incompatible types, as described above.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If there are two or items that are “equal highest”, the specific item whose value is returned is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>. This can arise for example if two different strings compare equal under the selected collation, or if two different <code>xs:dateTime</code> values compare equal despite being in different timezones.</p><p>If the converted sequence contains exactly one value then that value is returned.</p><p>The default type when the <a href="#func-max"><code>fn:max</code></a> function is applied to <code>xs:untypedAtomic</code> values is <code>xs:double</code>. This differs from the default type for operators such as <code>lt</code>, and for sorting in XQuery and XSLT, which is <code>xs:string</code>.</p><p>In version 4.0, if <code>$values</code> is a sequence of <code>xs:decimal</code> values (including the case where it is a sequence of <code>xs:integer</code> values), then the result will be one of these <code>xs:decimal</code> or <code>xs:integer</code> values. In earlier versions it would be the result of converting this <code>xs:decimal</code> to <code>xs:float</code> or <code>xs:double</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>max((3, 2, 1))</code></pre></div></td><td style="vertical-align:top"><p><code>3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>max([ 3, 2, 1 ])</code></pre></div></td><td style="vertical-align:top"><p><code>3</code></p><p><em>(Arrays are atomized).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>max((
  xs:integer(5),
  xs:float(5),
  xs:double(0)
))</code></pre></div></td><td style="vertical-align:top"><p><code>5</code></p><p><em>(The result may be either the <code>xs:integer</code> or the <code>xs:float</code>, since they are equal.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>max((
  xs:float(0.0E0),
  xs:float(-0.0E0)
))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:float(0.0e0)</code></p><p><em>(The result may be either positive or negative zero, since they are equal.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>max((
  current-date(),
  xs:date("2100-01-01")
))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:date("2100-01-01")</code></p><p><em>(Assuming that the current date is during the 21st century.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>max(("a", "b", "c"))</code></pre></div></td><td style="vertical-align:top"><p><code>"c"</code></p><p><em>(Assuming a typical default collation.)</em></p></td></tr><tr><td colspan="2"><p><code>max((3, 4, "Zero"))</code> raises a type error [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>]. </p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-min"></a>2.4.6 <a href="#func-min" style="text-decoration: none">fn:min</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-sum">next</a> | <a href="#func-max">previous</a>)</p><ol><li><p>The way that <a href="#func-min"><code>fn:min</code></a> and <a href="#func-max"><code>fn:max</code></a> compare numeric values of different types has changed. The most noticeable effect is that when these functions are applied to a sequence of <code>xs:integer</code> or <code>xs:decimal</code> values, the result is an <code>xs:integer</code> or <code>xs:decimal</code>, rather than the result of converting this to an <code>xs:float</code> or <code>xs:double</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/866">866</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/881">881</a>&nbsp;6 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a value that is less than or equal to every other value appearing in the input sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:min</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>Any item in <code>$values</code> that is an instance of <code>xs:untypedAtomic</code> is first cast to <code>xs:double</code>. The resulting sequence is referred to as the converted sequence.</p><p>All pairs of values in the converted sequence must be mutually comparable. Two values <var>A</var> and <var>B</var> are mutually comparable if <code>fn:compare(<var>A</var>, <var>B</var>)</code> raises no error.</p><p>If the converted sequence is empty, the function returns the empty sequence.</p><p>If the converted sequence contains the value <code>NaN</code>, the value <code>NaN</code> is returned <span>(as an <code>xs:float</code> or <code>xs:double</code> as appropriate)</span>.</p><p>Two items <var>A</var> and <var>B</var> from the converted sequence are compared by calling <code>fn:compare(<var>A</var>, <var>B</var>, $collation)</code>, where <code>$collation</code> is determined by the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>:</p><p>The result of the function is a value from the converted sequence that is less than or equal to every other value under the above rules. If there is more than one such value, then it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> which of them is returned.</p></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>] if the input sequence contains items of incompatible types, as described above.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If there are two or items that are “equal lowest”, the specific item whose value is returned is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>. This can arise for example if two different strings compare equal under the selected collation, or if two different <code>xs:dateTime</code> values compare equal despite being in different timezones.</p><p>If the converted sequence contains exactly one value then that value is returned.</p><p>The default type when the <a href="#func-min"><code>fn:min</code></a> function is applied to <code>xs:untypedAtomic</code> values is <code>xs:double</code>. This differs from the default type for operators such as <code>lt</code>, and for sorting in XQuery and XSLT, which is <code>xs:string</code>.</p><p>In version 4.0, if <code>$values</code> is a sequence of <code>xs:decimal</code> values (including the case where it is a sequence of <code>xs:integer</code> values), then the result will be one of these <code>xs:decimal</code> or <code>xs:integer</code> values. In earlier versions it would be the result of converting this <code>xs:decimal</code> to <code>xs:float</code> or <code>xs:double</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>min((3, 4, 5))</code></pre></div></td><td style="vertical-align:top"><p><code>3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>min([ 3, 4, 5 ])</code></pre></div></td><td style="vertical-align:top"><p><code>3</code></p><p><em>(Arrays are atomized).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>min((
  xs:integer(5),
  xs:float(5),
  xs:double(10)
))</code></pre></div></td><td style="vertical-align:top"><p><code>5</code></p><p><em>(The result may be either the <code>xs:integer</code> or the <code>xs:float</code>, since they are equal.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>min((
  xs:float(0.0E0),
  xs:float(-0.0E0)
))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:float(0.0e0)</code></p><p><em>(The result may be either positive or negative zero, since they are equal.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>min((
  current-date(),
  xs:date("1900-01-01")
))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:date("1900-01-01")</code></p><p><em>(Assuming that the current date is set to a reasonable value.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>min(("a", "b", "c"))</code></pre></div></td><td style="vertical-align:top"><p><code>"a"</code></p><p><em>(Assuming a typical default collation.)</em></p></td></tr><tr><td colspan="2"><p><code>min((3, 4, "Zero"))</code> raises a type error [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>]. </p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-sum"></a>2.4.7 <a href="#func-sum" style="text-decoration: none">fn:sum</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-apply">next</a> | <a href="#func-min">previous</a>)</p><ol><li><p>In 3.1, given a mixed input sequence such as (1, 3, 4.2e0), the specification was unclear whether it was permitted to add the first two integer items using integer arithmetic, rather than converting all items to doubles before performing any arithmetic. The 4.0 specification is clear that this is permitted; but since the items can be reordered before being added, this is not required.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1682">1682</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1734">1734</a>&nbsp;27 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a value obtained by adding together the values in <code>$values</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:sum</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$zero</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>0</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Any value of type <code>xs:untypedAtomic</code> in <code>$values</code> is cast to <code>xs:double</code>. The items in the resulting sequence may be reordered in an arbitrary order. The resulting sequence is referred to below as the converted sequence.</p><p>If the converted sequence is empty, then the function returns the value of the argument <code>$zero</code>, which defaults to the <code>xs:integer</code> value <code>0</code>.</p><p>In other cases the items in the converted sequence are added pairwise according the rules of the <code>+</code> operator.</p><p>Specifically, the result of the function is the value of the expression:</p><div class="exampleInner"><pre xml:space="preserve">if (empty($c)) then $zero
else if (count($c) eq 1) then $c
else head($c) + sum(tail($c))</pre></div><p>where <code>$c</code> is the converted sequence.</p><p>This has the effect that a type error will occur unless one of the following conditions is satisfied:</p><ol class="enumar"><li><p>Every item in <code>$values</code> is an instance of <code>xs:yearMonthDuration</code>.</p></li><li><p>Every item in <code>$values</code> is an instance of <code>xs:dayTimeDuration</code>.</p></li><li><p>Every item in <code>$values</code> is an instance of <code>xs:numeric</code>.</p></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>] if the input sequence contains items of incompatible types, as described above.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The second argument allows an appropriate value to be defined to represent the sum of an empty sequence. For example, when summing a sequence of durations it would be appropriate to return a zero-length duration of the appropriate type. This argument is necessary because a system that does dynamic typing cannot distinguish “an empty sequence of integers", for example, from “an empty sequence of durations”.</p><p>The explicit or implicit value of the <code>$zero</code> argument is used only when the input sequence is empty, not when a non-empty sequence sums to zero. For example, <code>sum((-1, +1), xs:double('NaN'))</code> returns the <code>xs:integer</code> value <code>0</code>, not <code>NaN</code>.</p><p>The sum of a sequence of integers will be an integer, while the sum of a numeric sequence that includes at least one <code>xs:double</code> will be an <code>xs:double</code>.</p><p>If the converted sequence contains exactly one value then that value is returned.</p><p>If the converted sequence contains the value <code>NaN</code>, <code>NaN</code> is returned.</p><p>In edge cases the fact that the input sequence may be reordered makes the result slightly unpredictable. For example, if the input contains two <code>xs:decimal</code> values and an <code>xs:float</code>, then the decimal values might be added using decimal arithmetic, or they might both be converted to <code>xs:float</code> (potentially losing precision) before any arithmetic is performed. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $d1 := xs:yearMonthDuration("P20Y")</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $d2 := xs:yearMonthDuration("P10M")</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $seq1 := ($d1, $d2)</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $seq3 := (3, 4, 5)</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sum(($d1, $d2))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>xs:yearMonthDuration("P20Y10M")</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">sum(
  $seq1[. lt xs:yearMonthDuration('P3M')],
  xs:yearMonthDuration('P0M')
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:yearMonthDuration("P0M")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sum($seq3)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>12</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sum(())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sum((),())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sum((1 to 100)[. lt 0], 0) </code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sum(($d1, $d2), "ein Augenblick")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>xs:yearMonthDuration("P20Y10M")</code></p><p><em>(There is no requirement that the <code>$zero</code> value should be the same type as the items in <code>$value</code>, or even that it should belong to a type that supports addition.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sum([ 1, 2, 3 ])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>6</code></p><p><em>(Atomizing an array returns the sequence obtained by atomizing its members.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sum([ [ 1, 2 ], [ 3, 4 ] ])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>10</code></p><p><em>(Atomizing an array returns the sequence obtained by atomizing its members.)</em></p></td></tr><tr><td colspan="2"><p><code>fn:sum(($d1, 9E1))</code> raises a type error [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>]. </p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="basic-hofs"></a>2.5 <a href="#basic-hofs" style="text-decoration: none">Basic higher-order functions</a></h3><p>The following functions take function items as an argument.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-apply"><code>fn:apply</code></a></td><td>Makes a dynamic call on a function with an argument list supplied in the form of an array.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-do-until"><code>fn:do-until</code></a></td><td>Processes a supplied value repeatedly, continuing when some condition is false, and returning the value that satisfies the condition.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-every"><code>fn:every</code></a></td><td>Returns <code>true</code> if every item in the input sequence matches a supplied predicate.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-filter"><code>fn:filter</code></a></td><td>Returns those items from the sequence <code>$input</code> for which the supplied function <code>$predicate</code> returns <code>true</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-fold-left"><code>fn:fold-left</code></a></td><td>Processes the supplied sequence from left to right, applying the supplied function repeatedly to each item in turn, together with an accumulated result value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-fold-right"><code>fn:fold-right</code></a></td><td>Processes the supplied sequence from right to left, applying the supplied function repeatedly to each item in turn, together with an accumulated result value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-for-each"><code>fn:for-each</code></a></td><td>Applies the function item <code>$action</code> to every item from the sequence <var>$input</var> in turn, returning the concatenation of the resulting sequences in order.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-for-each-pair"><code>fn:for-each-pair</code></a></td><td>Applies the function item <code>$action</code> to successive pairs of items taken one from <code>$input1</code> and one from <code>$input2</code>, returning the concatenation of the resulting sequences in order.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-highest"><code>fn:highest</code></a></td><td>Returns a value that is greater than or equal to every other value appearing in the input sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-index-where"><code>fn:index-where</code></a></td><td>Returns the positions in an input sequence of items that match a supplied predicate.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-lowest"><code>fn:lowest</code></a></td><td>Returns those items from a supplied sequence that have the lowest value of a sort key, where the sort key can be computed using a caller-supplied function.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-partial-apply"><code>fn:partial-apply</code></a></td><td>Performs partial application of a function item by binding values to selected arguments.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-partition"><code>fn:partition</code></a></td><td>Partitions a sequence of items into a sequence of non-empty arrays containing the same items, starting a new partition when a supplied condition is true.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-scan-left"><code>fn:scan-left</code></a></td><td>Produces the sequence of successive partial results from the evaluation of <a href="#func-fold-left"><code>fn:fold-left</code></a> with the same arguments.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-scan-right"><code>fn:scan-right</code></a></td><td>Produces the sequence of successive partial results from the evaluation of <a href="#func-fold-right"><code>fn:fold-right</code></a> with the same arguments.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-some"><code>fn:some</code></a></td><td>Returns <code>true</code> if at least one item in the input sequence matches a supplied predicate.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-sort"><code>fn:sort</code></a></td><td>Sorts a supplied sequence, based on the value of a sort key supplied as a function.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-sort-by"><code>fn:sort-by</code></a></td><td>Sorts a supplied sequence, based on the value of a number of sort keys supplied as functions.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-sort-with"><code>fn:sort-with</code></a></td><td>Sorts a supplied sequence, according to the order induced by the supplied comparator functions.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subsequence-where"><code>fn:subsequence-where</code></a></td><td>Returns a contiguous sequence of items from <code>$input</code>, with the start and end points located by applying predicates.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-take-while"><code>fn:take-while</code></a></td><td>Returns items from the input sequence prior to the first one that fails to match a supplied predicate.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-transitive-closure"><code>fn:transitive-closure</code></a></td><td>Returns all the GNodes reachable from a given start GNode by applying a supplied function repeatedly.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-while-do"><code>fn:while-do</code></a></td><td>Processes a supplied value repeatedly, continuing while some condition remains true, and returning the first value that does not satisfy the condition.</td></tr></tbody></table><p>With all these functions, if the caller-supplied function fails with a dynamic error, this error is propagated as an error from the higher-order function itself.</p><div class="div3"><h4><a id="func-apply"></a>2.5.1 <a href="#func-apply" style="text-decoration: none">fn:apply</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-do-until">next</a> | <a href="#func-sum">previous</a>)</p><ol><li><p>As a result of changes to the coercion rules, the number of supplied arguments can be greater than the number required: extra arguments are ignored.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1267">1267</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1280">1280</a>&nbsp;18 June 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Makes a dynamic call on a function with an argument list supplied in the form of an array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:apply</code>(</td></tr><tr class="arg"><td><code>$function</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arguments</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The result of the function is obtained by invoking the supplied function <code>$function</code> with arguments taken from the members of the supplied array <code>$arguments</code>. The first argument of the function call is the first member of <code>$arguments</code>, the second argument is the second member of <code>$arguments</code>, and so on.</p><p>The arity of the supplied function <code>$function</code> must be less than or equal to the size of the array <code>$arguments</code>.</p><p>The effect of calling <code>fn:apply($f, [$a, $b, $c, ...])</code> is the same as the effect of the dynamic function call <code>$f($a, $b, $c, ....)</code>. For example, the coercion rules are applied to the supplied arguments in the usual way. Among other things this means that excess arguments are ignored.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised if the arity of the function <code>$function</code> is greater than the size of the array <code>$arguments</code> ([<a href="#ERRFOAP0001" title="err:FOAP0001">err:FOAP0001</a>]). </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function is useful where the arity of a function item is not known statically.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>apply(concat#3, [ "a", "b", "c" ])</code></pre></div></td><td style="vertical-align:top"><p><code>"abc"</code></p></td></tr><tr><td colspan="2"><p>The expression <code>apply($f, array:subarray([ "a", "b", "c", "d", "e", "f" ], 1, function-arity($f)))</code> calls the supplied function <code>$f</code> supplying the number of arguments required by its arity.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-do-until"></a>2.5.2 <a href="#func-do-until" style="text-decoration: none">fn:do-until</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-every">next</a> | <a href="#func-apply">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/946">946</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/962">962</a>&nbsp;23 January 2024]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Processes a supplied value repeatedly, continuing when some condition is false, and returning the value that satisfies the condition.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:do-until</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, xs:integer) as item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, xs:integer) as xs:boolean?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function behaves as follows:</p><ol class="enumar"><li><p><code>$pos</code> is initially set to <code>1</code>.</p></li><li><p><code>$action($input, $pos)</code> is evaluated, and the resulting value is used as a new <code>$input</code>.</p></li><li><p><code>$predicate($input, $pos)</code> is evaluated. If the result is <code>true</code>, the function returns the value of <code>$input</code>. Otherwise, the process repeats from step 2 with <code>$pos</code> incremented by <code>1</code>.</p><p>When the predicate returns the empty sequence, this is treated as <code>false</code>.</p></li></ol></dd><dt class="label">Formal Equivalent</dt><dd><p>The function delivers the same result as the following XQuery implementation.</p><div class="exampleInner"><pre xml:space="preserve" class="small">declare %private function do-until-helper(
  $input     as item()*,
  $action    as fn(item()*, xs:integer) as item()*,
  $predicate as fn(item()*, xs:integer) as xs:boolean?,
  $pos       as xs:integer
) as item()* {
  let $result := $action($input, $pos)
  return if ($predicate($result, $pos)) then (
    $result
  ) else (
    do-until-helper($result, $action, $predicate, $pos + 1)
  )
};

declare function do-until(
  $input     as item()*,
  $action    as fn(item()*, xs:integer) as item()*,
  $predicate as fn(item()*, xs:integer) as xs:boolean?
) as item()* {
  do-until-helper($input, $action, $predicate, 1)
};</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>Do-until loops are very common in procedural programming languages, and this function provides a way to write functionally clean and interruptible iterations without side-effects. A new value is computed and tested until a given condition fails. Depending on the use case, the value can be a simple atomic item or an arbitrarily complex data structure.</p><p>The function <a href="#func-while-do"><code>fn:while-do</code></a> can be used to perform the action after the first predicate test.</p><p>Note that, just as when writing recursive functions, it is easy to construct infinite loops.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">do-until(
  (),
  fn($value, $pos) { $value, $pos * $pos },
  fn($value) { foot($value) &gt; 50  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, 4, 9, 16, 25, 36, 49, 64</pre></div><p><em>(The loop is interrupted once the last value of the generated sequence is greater than 50.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">do-until(
  (1, 0),
  fn($value) { $value[1] + $value[2], $value },
  fn($value) { avg($value) &gt; 10 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">55, 34, 21, 13, 8, 5, 3, 2, 1, 1, 0</pre></div><p><em>(The computation is continued as long as the average of the first Fibonacci numbers is smaller than 10.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-every"></a>2.5.3 <a href="#func-every" style="text-decoration: none">fn:every</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-filter">next</a> | <a href="#func-do-until">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[&nbsp;&nbsp;13 September 2022]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if every item in the input sequence matches a supplied predicate.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:every</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item(), xs:integer) as xs:boolean?)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:boolean#1</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns true if <code>$input</code> is empty, or if <code>$predicate($item, $pos)</code> returns true for every item <code>$item</code> at position <code>$pos</code> (1-based) in <code>$input</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">count(filter($input, $predicate)) = count($input)</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>An error is raised if the <code>$predicate</code> function raises an error. In particular, when the default predicate <a href="#func-boolean"><code>fn:boolean#1</code></a> is used, an error is raised if an item has no effective boolean value.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the second argument is omitted or the empty sequence, the predicate defaults to <a href="#func-boolean"><code>fn:boolean#1</code></a>, which takes the effective boolean value of each item.</p><p>It is possible for the supplied <code>$predicate</code> to be a function whose arity is less than two. The coercion rules mean that the additional parameters are effectively ignored. Frequently a predicate function will only consider the item itself, and disregard its position in the sequence.</p><p>The predicate is required to return either <code>true</code>, <code>false</code>, or the empty sequence (which is treated as <code>false</code>). A predicate such as <code>fn { self::h1 }</code> results in a type error because it returns a node, not a boolean.</p><p>The implementation <span class="verb">may</span> deliver a result as soon as one item is found for which the predicate returns <code>false</code>; it is not required to evaluate the predicate for every item, nor is it required to examine items sequentially from left to right.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>every(())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>every((1 = 1, 2 = 2, 3 = 4))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>every((), boolean#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>every((1, 3, 7), fn { . mod 2 = 1 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>every(-5 to +5, fn { . ge 0 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">every(
  ("January", "February", "March", "April",
   "September", "October", "November", "December"),
  contains(?, "r")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">every(
  ("January", "February", "March", "April",
   "September", "October", "November", "December")
  =!&gt; contains("r")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>every((1, 2, number('NaN')))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p><p><em>(The effective boolean value of NaN is false.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>every(1 to 5, fn($num, $pos) { $num = $pos })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $dl := &lt;dl&gt;&lt;dt&gt;Morgawr&lt;/dt&gt;&lt;dd&gt;Sea giant&lt;/dd&gt;&lt;/dl&gt;
return every($dl/*, fn($elem, $pos) {
  name($elem) = (
    if (($pos mod 2)) then "dt" else "dd"
  )
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-filter"></a>2.5.4 <a href="#func-filter" style="text-decoration: none">fn:filter</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-for-each">next</a> | <a href="#func-every">previous</a>)</p><ol><li><p>The <code>$predicate</code> callback function accepts an optional position argument.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/516">516</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/828">828</a>&nbsp;14 November 2023]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns those items from the sequence <code>$input</code> for which the supplied function <code>$predicate</code> returns <code>true</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:filter</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item(), xs:integer) as xs:boolean?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence containing those items from <code>$input</code> for which <code>$predicate($item, $pos)</code> returns <code>true</code>, where <code>$item</code> is the item in question, and <code>$pos</code> is its 1-based ordinal position within <code>$input</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">for-each(
  $input,
  fn($item, $pos) { if ($predicate($item, $pos)) { $item } }
)</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>As a consequence of the function signature and the function calling rules, a type error occurs if the supplied <code>$predicate</code> function returns anything other than a single <code>xs:boolean</code> item or the empty sequence; there is no conversion to an effective boolean value, but the empty sequence is interpreted as false.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$predicate</code> is an arity-1 function, the function call <code>fn:filter($input, $predicate)</code> has a very similar effect to the expression <code>$input[$predicate(.)]</code>. There are some differences, however. In the case of <a href="#func-filter"><code>fn:filter</code></a>, the function <code>$F</code> is required to return an optional boolean; there is no special treatment for numeric predicate values, and no conversion to an effective boolean value. Also, with a filter expression <code>$input[$predicate(.)]</code>, the focus within the predicate is different from that outside; this means that the use of a context-sensitive function such as <a href="#func-lang"><code>fn:lang#1</code></a> will give different results in the two cases.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>filter(1 to 10, fn($a) { $a mod 2 = 0 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>2, 4, 6, 8, 10</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">filter(parse-xml('&lt;doc&gt;&lt;a id="2"/&gt;&lt;a/&gt;&lt;/doc&gt;')//a, fn { @id eq "2" })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">&lt;a id="2"/&gt;</pre></div><p><em>(The function returns <code>()</code> when there is no <code>@id</code> attribute; this is treated as false.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>filter((), lang("en", ?))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $sequence := (1, 1, 2, 3, 4, 4, 5)
return filter(
  $sequence,
  fn($item, $pos) { $item = $sequence[$pos - 1] }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, 4</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-fold-left"></a>2.5.5 <a href="#func-fold-left" style="text-decoration: none">fn:fold-left</a></h4><dl><dt class="label">Summary</dt><dd><p>Processes the supplied sequence from left to right, applying the supplied function repeatedly to each item in turn, together with an accumulated result value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:fold-left</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$init</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, item()) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$input</code> is empty, the function returns <code>$init</code>.</p><p>If <code>$input</code> contains at least one item, the function calls <code>$action($init, $input[1])</code>, returning a value <var>A<sub>1</sub></var>.</p><p>If <code>$input</code> contains a second item, the function then calls <code>$action(<var>A<sub>1</sub></var>, $input[2])</code>, returning <var>A<sub>2</sub></var>; to process the <var>n</var>th item it calls <code>$action(<var>A<sub>n-1</sub></var>, $input[<var>N</var>])</code>.</p><p>This continues in the same way until the end of the <code>$input</code> sequence; the final result is the result of the last call on <code>$action</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function delivers the same result as the following XQuery implementation.</p><div class="exampleInner"><pre xml:space="preserve" class="small">declare function fold-left(
  $input  as item()*,
  $init   as item()*,
  $action as function(item()*, item()) as item()*
) as item()* {
  if (empty($input)) 
  then $init
  else fold-left(tail($input), $action($init, head($input)), $action)
};</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>As a consequence of the function signature and the function calling rules, a type error occurs if the supplied function <code>$action</code> cannot be applied to two arguments, where the first argument is either the value of <code>$init</code> or the result of a previous application of <code>$action</code>, and the second is any single item from the sequence <code>$input</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>This operation is often referred to in the functional programming literature as “folding” or “reducing” a sequence. It typically takes a function that operates on a pair of values, and applies it repeatedly, with an accumulated result as the first argument, and the next item in the sequence as the second argument. The accumulated result is initially set to the value of the <code>$init</code> argument, which is conventionally a value (such as zero in the case of addition, one in the case of multiplication, or a zero-length string in the case of string concatenation) that causes the function to return the value of the other argument unchanged.</p><p>Unlike other functions that apply a user-supplied callback function to successive items in a sequence, this function does not supply the current position to the callback function as an optional argument. If positional information is required, this can be achieved by first forming the sequence <code>$input ! { 'position': position(), 'item': . }</code> and then applying the <a href="#func-fold-left"><code>fn:fold-left</code></a> function to this sequence.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-left(
  1 to 5,
  0,
  fn($a, $b) { $a + $b }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">15</pre></div><p><em>(This returns the sum of the items in the sequence).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-left(
  (2, 3, 5, 7),
  1,
  fn($a, $b) { $a * $b }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">210</pre></div><p><em>(This returns the product of the items in the sequence).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-left(
  (true(), false(), false()),
  false(),
  fn($a, $b) { $a or $b }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(This returns <code>true</code> if any item in the sequence has an effective boolean value of <code>true</code>).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-left(
  (true(), false(), false()),
  false(),
  fn($a, $b) { $a and $b }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div><p><em>(This returns <code>true</code> only if every item in the sequence has an effective boolean value of <code>true</code>).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-left(
  1 to 5,
  (),
  fn($a, $b) { $b, $a }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">5, 4, 3, 2, 1</pre></div><p><em>(This reverses the order of the items in a sequence).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-left(
  1 to 5,
  "",
  concat(?, ".", ?)
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">".1.2.3.4.5"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-left(
  1 to 5,
  "$z",
  concat("$f(", ?, ", ", ?, ")")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"$f($f($f($f($f($z, 1), 2), 3), 4), 5)"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-left(
  1 to 5,
  {},
  fn($map, $n) { map:put($map, $n, $n * 2) }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ 1: 2, 2: 4, 3: 6, 4: 8, 5: 10 }</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-fold-right"></a>2.5.6 <a href="#func-fold-right" style="text-decoration: none">fn:fold-right</a></h4><dl><dt class="label">Summary</dt><dd><p>Processes the supplied sequence from right to left, applying the supplied function repeatedly to each item in turn, together with an accumulated result value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:fold-right</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$init</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item(), item()*) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$input</code> is empty, the function returns <code>$init</code>.</p><p>Let <var>I<sub>n</sub></var> be the last item in <code>$input</code>, and let <var>A<sub>n</sub></var> be <code>$init</code>. The function starts by calling <code>$action(<var>I<sub>n</sub></var>, $init)</code>, producing a result <var>A<sub>n-1</sub></var>.</p><p>If there is a previous item, <var>I<sub>n-1</sub></var>, the function then calls <code>$action(<var>I<sub>n-1</sub></var>, <var>A<sub>n-1</sub></var>)</code>, producing the result <var>A<sub>n-2</sub></var>.</p><p>This continues in the same way until the start of the <code>$input</code> sequence is reached; the final result is the value <var>A<sub>0</sub></var>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function delivers the same result as the following XQuery implementation.</p><div class="exampleInner"><pre xml:space="preserve" class="small">declare function fold-right(
  $input  as item()*,
  $init   as item()*,
  $action as function(item(), item()*) as item()*
) as item()* {
  if (empty($input))
  then $init
  else $action(head($input), fold-right(tail($input), $init, $action))
};</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>As a consequence of the function signature and the function calling rules, a type error occurs if the supplied function <code>$action</code> cannot be applied to two arguments, where the first argument is any item in the sequence <code>$input</code>, and the second is either the value of <code>$init</code> or the result of a previous application of <code>$action</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>This operation is often referred to in the functional programming literature as “folding” or “reducing” a sequence. It takes a function that operates on a pair of values, and applies it repeatedly, with the next item in the sequence as the first argument, and the result of processing the remainder of the sequence as the second argument. The accumulated result is initially set to the value of the <code>$init</code> argument, which is conventionally a value (such as zero in the case of addition, one in the case of multiplication, or a zero-length string in the case of string concatenation) that causes the function to return the value of the other argument unchanged.</p><p>In cases where the function performs an associative operation on its two arguments (such as addition or multiplication), <a href="#func-fold-right"><code>fn:fold-right</code></a> produces the same result as <a href="#func-fold-left"><code>fn:fold-left</code></a>.</p><p>Unlike other functions that apply a user-supplied callback function to successive items in a sequence, this function does not supply the current position to the callback function as an optional argument. If positional information is required, this can be achieved by first forming the sequence <code>$input ! { 'position': position(), 'item': . }</code> and then applying the <a href="#func-fold-right"><code>fn:fold-right</code></a> function to this sequence.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-right(
  1 to 5,
  0,
  fn($a, $b) { $a + $b }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">15</pre></div><p><em>(This returns the sum of the items in the sequence).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-right(
  1 to 5,
  "",
  concat(?, ".", ?)
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"1.2.3.4.5."</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fold-right(
  1 to 5,
  "$z",
  concat("$f(", ?, ", ", ?, ")")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"$f(1, $f(2, $f(3, $f(4, $f(5, $z)))))"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-for-each"></a>2.5.7 <a href="#func-for-each" style="text-decoration: none">fn:for-each</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-for-each-pair">next</a> | <a href="#func-filter">previous</a>)</p><ol><li><p>The <code>$action</code> callback function accepts an optional position argument.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/516">516</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/828">828</a>&nbsp;14 November 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Applies the function item <code>$action</code> to every item from the sequence <var>$input</var> in turn, returning the concatenation of the resulting sequences in order.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:for-each</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item(), xs:integer) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function calls <code>$action($item, $pos)</code> for each item in <code>$input</code>, where <code>$item</code> is the item in question and <code>$pos</code> is its 1-based ordinal position in <code>$input</code>. The final result is the sequence concatenation of the result of these calls, preserving order. </p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function is defined as follows, making use of primitive constructors and accessors defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p><div class="exampleInner"><pre xml:space="preserve">dm:iterate-sequence($input, $action)</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>for-each(1 to 5, fn($a) { $a * $a })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, 4, 9, 16, 25</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">for-each(
  ("john", "jane"),
  string-to-codepoints#1
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">106, 111, 104, 110, 106, 97, 110, 101</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>for-each(("23", "29"), xs:int#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>23, 29</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">for-each(
  ('one', 'two', 'three'),
  fn($item, $pos) { $pos || '. ' || $item }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"1. one", "2. two", "3. three"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-for-each-pair"></a>2.5.8 <a href="#func-for-each-pair" style="text-decoration: none">fn:for-each-pair</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-highest">next</a> | <a href="#func-for-each">previous</a>)</p><ol><li><p>The <code>$action</code> callback function accepts an optional position argument.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/516">516</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/828">828</a>&nbsp;14 November 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Applies the function item <code>$action</code> to successive pairs of items taken one from <code>$input1</code> and one from <code>$input2</code>, returning the concatenation of the resulting sequences in order.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:for-each-pair</code>(</td></tr><tr class="arg"><td><code>$input1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$input2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item(), item(), xs:integer) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the value of the expression:</p><div class="exampleInner"><pre xml:space="preserve" class="small">for $pos in 1 to min((count($input1), count($input2)))
return $action($input1[$pos], $input2[$pos], $pos)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If one sequence is longer than the other, excess items in the longer sequence are ignored.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">for-each-pair(
  ("a", "b", "c"),
  ("x", "y", "z"),
  concat#2
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"ax", "by", "cz"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">for-each-pair(
  1 to 5,
  1 to 5,
  fn($a, $b) { 10 * $a + $b }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">11, 22, 33, 44, 55</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $s := 1 to 8
return for-each-pair($s, tail($s), fn($a, $b) { $a * $b })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2, 6, 12, 20, 30, 42, 56</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">for-each-pair(
  (1, 8, 2),
  (3, 4, 3),
  fn($item1, $item2, $pos) {
    $pos || ': ' || max(($item1, $item2))
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"1: 3", "2: 8", "3: 3"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-highest"></a>2.5.9 <a href="#func-highest" style="text-decoration: none">fn:highest</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-index-where">next</a> | <a href="#func-for-each-pair">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[&nbsp;&nbsp;20 September 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a value that is greater than or equal to every other value appearing in the input sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:highest</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code>,</td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item()) as xs:anyAtomicType*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:data#1</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>The second argument, <code>$collation</code>, defaults to <code>()</code>.</p><p>Supplying an empty sequence as <code>$collation</code> is equivalent to supplying <code>fn:default-collation()</code>. For more information on collations see <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The third argument, <code>$key</code>, defaults to the function <code>data#1</code>.</p><p>Let <code>$modified-key</code> be the function:</p><div class="exampleInner"><pre xml:space="preserve" class="small">fn($item) {
  $key($item) =&gt; data() ! (
    if (. instance of xs:untypedAtomic) then xs:double(.) else .
  )
}</pre></div><p>That is, the supplied function for computing key values is wrapped in a function that converts any <code>xs:untypedAtomic</code> values in its result to <code>xs:double</code>. This makes the function consistent with the behavior of <a href="#func-min"><code>fn:min</code></a> and <a href="#func-max"><code>fn:max</code></a>, but inconsistent with <a href="#func-sort"><code>fn:sort</code></a>, which treats untyped values as strings.</p><p>The result of the function is obtained as follows:</p><ul><li><p>If the input is an empty sequence, the result is an empty sequence.</p></li><li><p>The input sequence is sorted, by applying the function <code>fn:sort($input, $collation, $modified-key)</code>.</p></li><li><p>Let <var>$C</var> be the selected collation, or the default collation where applicable.</p></li><li><p>Let <var>$B</var> be the last item in the sorted sequence.</p></li><li><p>The function returns those items <var>$A</var> from the input sequence that are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a> to <code>$B</code>, retaining their order. </p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>If the set of computed keys contains <code>xs:untypedAtomic</code> values that are not castable to <code>xs:double</code> then the operation will fail with a dynamic error ([<a href="https://www.w3.org/TR/xpath-functions/#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>]<sup><small>FO</small></sup>). </p><p>If the set of computed keys contains values that are not comparable using the <code>lt</code> operator then the sort operation will fail with a type error ([<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>). </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $e := &lt;a x="10" y="5" z="2"/&gt;</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>highest($e/@*) ! name()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"x"</code></p><p><em>(By default, untyped values are compared as numbers.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>highest($e/@*, (), string#1) ! name()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"y"</code></p><p><em>(Here, the attribute values are compared as strings.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>highest(("red", "green", "blue"), (), string-length#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"green"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">highest(
  ("red", "green", "blue"),
  key := {
    "red"  : xs:hexBinary('FF0000'),
    "green": xs:hexBinary('008000'),
    "blue" : xs:hexBinary('0000FF')
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"red"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">highest(
  ("red", "orange", "yellow", "green", "blue", "indigo", "violet"),
  key := string-length#1
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"orange", "yellow", "indigo", "violet"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>highest(1 to 25, (), fn { . idiv 10 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>20, 21, 22, 23, 24, 25</code></p></td></tr><tr><td colspan="2"><p>To find employees having the highest salary: </p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">highest($employees, (), fn { xs:decimal(salary) })</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-index-where"></a>2.5.10 <a href="#func-index-where" style="text-decoration: none">fn:index-where</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-lowest">next</a> | <a href="#func-highest">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[&nbsp;&nbsp;20 September 2022]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the positions in an input sequence of items that match a supplied predicate.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:index-where</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item(), xs:integer) as xs:boolean?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The result of the function is a sequence of integers, in monotonic ascending order, representing the 1-based positions in the input sequence of those items for which the supplied predicate function returns <code>true</code>. A return value of <code>()</code> from the predicate function is treated as <code>false</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">for-each(
  $input,
  fn($item, $pos) { if ($predicate($item, $pos)) { $pos } }
)</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>index-where((), boolean#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>index-where((0, 4, 9), boolean#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>2, 3</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>index-where(1 to 10, fn { . mod 2 = 0 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>2, 4, 6, 8, 10</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">index-where(
  ("January", "February", "March", "April", "May", "June",
   "July", "August", "September", "October", "November", "December"),
  contains(?, "r")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, 2, 3, 4, 9, 10, 11, 12</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">index-where(
  ( 1, 8, 2, 7, 3 ),
  fn($item, $pos) { $item &lt; 5 and $pos &gt; 2 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">3, 5</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-lowest"></a>2.5.11 <a href="#func-lowest" style="text-decoration: none">fn:lowest</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-partial-apply">next</a> | <a href="#func-index-where">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[&nbsp;&nbsp;20 September 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns those items from a supplied sequence that have the lowest value of a sort key, where the sort key can be computed using a caller-supplied function.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:lowest</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code>,</td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item()) as xs:anyAtomicType*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:data#1</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>The second argument, <code>$collation</code>, defaults to <code>()</code>.</p><p>Supplying the empty sequence as <code>$collation</code> is equivalent to supplying <code>fn:default-collation()</code>. For more information on collations see <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The third argument defaults to the function <code>data#1</code>.</p><p>Let <code>$modified-key</code> be the function:</p><div class="exampleInner"><pre xml:space="preserve" class="small">fn($item) {
  $key($item) =&gt; data() ! (
    if (. instance of xs:untypedAtomic) then xs:double(.) else .
  )
}</pre></div><p>That is, the supplied function for computing key values is wrapped in a function that converts any <code>xs:untypedAtomic</code> values in its result to <code>xs:double</code>. This makes the function consistent with the behavior of <a href="#func-min"><code>fn:min</code></a> and <a href="#func-max"><code>fn:max</code></a>, but inconsistent with <a href="#func-sort"><code>fn:sort</code></a>, which treats untyped values as strings.</p><p>The result of the function is obtained as follows:</p><ul><li><p>If the input is the empty sequence, the result is the empty sequence.</p></li><li><p>The input sequence is sorted, by applying the function <code>fn:sort($input, $collation, $modified-key)</code>.</p></li><li><p>Let <var>$C</var> be the selected collation, or the default collation where applicable.</p></li><li><p>Let <var>$B</var> be the first item in the sorted sequence.</p></li><li><p>The function returns those items <var>$A</var> from the input sequence that are <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a> to <code>$B</code>, retaining their order. </p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>If the set of computed keys contains <code>xs:untypedAtomic</code> values that are not castable to <code>xs:double</code> then the operation will fail with a dynamic error ([<a href="https://www.w3.org/TR/xpath-functions/#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>]<sup><small>FO</small></sup>). </p><p>If the set of computed keys contains values that are not comparable using the <code>lt</code> operator then the sort operation will fail with a type error ([<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>). </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $e := &lt;a x="10" y="5" z="2"/&gt;</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>lowest($e/@*) ! name()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"z"</code></p><p><em>(By default, untyped values are compared as numbers.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>lowest($e/@*, (), string#1) ! name()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"x"</code></p><p><em>(Here, the attribute values are compared as strings.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>lowest(("red", "green", "blue"), (), string-length#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"red"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">lowest(
  ("red", "green", "blue"),
  key := {
    "red"  : xs:hexBinary('FF0000'),
    "green": xs:hexBinary('008000'),
    "blue" : xs:hexBinary('0000FF')
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"blue"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">lowest(
  ("April", "June", "July", "August"),
  key := string-length#1
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"June", "July"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>lowest(1 to 25, (), fn { . idiv 10 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, 2, 3, 4, 5, 6, 7, 8, 9</code></p></td></tr><tr><td colspan="2"><p>To find employees having the lowest salary: </p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">lowest($employees, (), fn { xs:decimal(salary) })</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-partial-apply"></a>2.5.12 <a href="#func-partial-apply" style="text-decoration: none">fn:partial-apply</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-partition">next</a> | <a href="#func-lowest">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1816">1816</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1825">1825</a>&nbsp;25 February 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Performs partial application of a function item by binding values to selected arguments.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:partial-apply</code>(</td></tr><tr class="arg"><td><code>$function</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arguments</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(xs:positiveInteger, item()*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>fn(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The result is a function obtained by binding values to selected arguments of the function item <code>$function</code>. The arguments to be bound are represented by entries in the <code>$arguments</code> map: an entry with key <code>$i</code> and value <code>$v</code> causes the argument at position <code>$i</code> (1-based) to be bound to <code>$v</code>. </p><p>Any entries in <code>$arguments</code> whose keys are greater than the arity of <code>$function</code> are ignored.</p><p>If <code>$arguments</code> is the empty map then the function returns <code>$function</code> unchanged.</p><p>For example, the effect of calling <code>fn:partial-apply($f, { 2: $x })</code> is the same as the effect of the partial appplication <code>$f(?, $x, ?, ?, ....)</code>. The coercion rules are applied to the supplied arguments in the usual way.</p><p>Unlike a partial application using place-holder arguments:</p><ul><li><p>The arity of <code>$function</code> need not be statically known.</p></li><li><p>It is possible to bind all the arguments of <code>$function</code>: the effect is to return a zero-arity function. </p></li></ul><p>The result is a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-partially-applied-function">partially applied function</a><sup><small>XP</small></sup> having the following properties (which are defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#function-items">8.1 Function Items</a>): </p><ul><li><p><b>name</b>: absent. </p></li><li><p><b>identity</b>: A new function identity distinct from the identity of any other function item.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>See also <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-function-identity">4.6.7 Function Identity</a>.</p></div></li><li><p><b>arity</b>: The arity of <code>$function</code> minus the number of parameters in <code>$function</code> that map to supplied arguments in <code>$arguments</code>.</p></li><li><p><b>parameter names</b>: The names of the parameters of <code>$function</code> that do not map to supplied arguments in <code>$arguments</code>. </p></li><li><p><b>signature</b>: The parameters in the returned function are the parameters of <code>$function</code> that do not map to supplied arguments in <code>$arguments</code>, retaining order. The result type of the returned function is the same as the result type of <code>$function</code>.</p><p>An implementation that can determine a more specific signature (for example, through use of type analysis) is permitted to do so. </p></li><li><p><b>body</b>: The body of <code>$function</code>.</p></li><li><p><b>captured context</b>: The static and dynamic context of <code>$function</code>, augmented, for each supplied argument, with a binding of the converted argument value to the corresponding parameter name. </p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised if any of the supplied arguments, after applying the coercion rules, does not match the required type of the corresponding function parameter.</p><p>In addition, a dynamic error may be raised if any of the supplied arguments does not match other constraints on the value of that argument (for example, if the value supplied for a parameter expecting a regular expression is not a valid regular expression); or if the processor is able to establish that evaluation of the resulting function will fail for any other reason (for example, if an error is raised while evaluating a subexpression in the function body that depends only on explicitly supplied and defaulted parameters).</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>See also <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-partial-function-application">4.6.4 Partial Function Application</a>.</p><p>The function is useful where the arity of a function item is not known statically, or where all arguments in a function are to be bound, returning a zero-arity function.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $f := partial-apply(dateTime#2,  {2: xs:time('00:00:00') })
return $f(xs:date('2025-03-01'))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2025-03-01T00:00:00')</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-partition"></a>2.5.13 <a href="#func-partition" style="text-decoration: none">fn:partition</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-scan-left">next</a> | <a href="#func-partial-apply">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/125">125</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/507">507</a>&nbsp;19 May 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Partitions a sequence of items into a sequence of non-empty arrays containing the same items, starting a new partition when a supplied condition is true.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:partition</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$split-when</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, item(), xs:integer) as xs:boolean?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(item()*)*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function starts by creating a partition containing the first item in the input sequence, if any. For each remaining item <var>J</var> in the input sequence, other than the first, it calls the supplied <code>$split-when</code> function with three arguments: the contents of the current partition, the item <var>J</var>, and the current position in the input sequence.</p><p>Each partition is a sequence of items; the function result wraps each partition as an array, and returns the sequence of arrays.</p><p>If the <code>$split-when</code> function returns <code>true</code>, the current partition is wrapped as an array and added to the result, and a new current partition is created, initially containing the item <var>J</var> only. If the <code>$split-when</code> function returns <code>false</code> or <code>()</code>, the item <var>J</var> is added to the current partition.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">for-each(
  $input,
  fn($item, $pos) { { 'item': $item, 'pos': $pos } }
)
=&gt; fold-left((), fn($partitions, $pair) {
  if (empty($partitions) or $split-when(foot($partitions)?*, $pair?item, $pair?pos))
  then ($partitions, [ $pair?item ])
  else (trunk($partitions), array { foot($partitions)?*, $pair?item })
})</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function enables a variety of positional grouping problems to be solved. For example:</p><ul><li><p><code>partition($input, fn($a, $b) { count($a) eq 3 }</code> partitions a sequence into fixed size groups of length 3.</p></li><li><p><code>partition($input, fn($a, $b) { boolean($b/self::h1) }</code> starts a new group whenever an <code>h1</code> element is encountered.</p></li><li><p><code>partition($input, fn($a, $b) { $b lt foot($a) }</code> starts a new group whenever an item is encountered whose value is less than the value of the previous item.</p></li></ul><p>The callback function is not called to process the first item in the input sequence, because this will always start a new partition. The first argument to the callback function (the current partition) is always a non-empty sequence.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">partition(
  ("Anita", "Anne", "Barbara", "Catherine", "Christine"), 
  fn($partition, $next) {
    substring(head($partition), 1, 1) ne substring($next, 1, 1)
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "Anita", "Anne" ], [ "Barbara" ], [ "Catherine", "Christine" ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">partition(
  (1, 2, 3, 4, 5, 6, 7),
  fn($partition, $next) { count($partition) eq 2 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1, 2 ], [ 3, 4 ], [ 5, 6 ], [ 7 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">partition(
  (1, 4, 6, 3, 1, 1),
  fn($partition, $next) { sum($partition) ge 5 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1, 4 ], [ 6 ], [ 3, 1, 1 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">partition(
  tokenize("In the beginning was the word"), 
  fn($partition, $next) {
    sum(($partition, $next) ! string-length()) gt 10
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "In", "the" ], [ "beginning" ], [ "was", "the", "word" ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">partition(
  (1, 2, 3, 6, 7, 9, 10),
  fn($partition, $next) { $next != foot($partition) + 1 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1, 2, 3 ], [ 6, 7 ], [ 9, 10 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">partition(
  ('a', 'b', 'c', 'd', 'e'),
  fn($all, $next, $p) { $p mod 2 = 1 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "a", "b" ], [ "c", "d" ], [ "e" ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-scan-left"></a>2.5.14 <a href="#func-scan-left" style="text-decoration: none">fn:scan-left</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-scan-right">next</a> | <a href="#func-partition">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/982">982</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1296">1296</a>&nbsp;23 June 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Produces the sequence of successive partial results from the evaluation of <a href="#func-fold-left"><code>fn:fold-left</code></a> with the same arguments.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:scan-left</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$init</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, item()) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence of <var>N</var>+1 <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-single-member-array">single-member arrays</a><sup><small>DM</small></sup>, where <var>N</var> is the number of items in <code>$input</code>. For values of <code>$n</code> in the range 0 to <var>N</var>, the value of the single member of array <code>$n+1</code> in the result sequence is the value of the expression <code>fold-left( subsequence($input, 1, $n), $init, $action )</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">(0 to count($input)) 
! [fold-left(subsequence($input, 1, .), $init, $action) ]</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>A practical implementation is likely to compute each array in the result sequence based on the value of the previous item, rather than computing each item independently as implied by the specification.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">scan-left(1 to 5, 0, op('+'))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 0 ], [ 1 ], [ 3 ], [ 6 ], [ 10 ], [ 15 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">scan-left(1 to 3, 0, op('-'))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 0 ], [ -1 ], [ -3 ], [ -6 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">scan-left(1 to 5, 1, op('*'))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1 ], [ 1 ], [ 2 ], [ 6 ], [ 24 ], [ 120 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">scan-left(1 to 3, (), fn($a, $b) { $b, $a })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ () ], [ 1 ], [ (2, 1) ], [ (3, 2, 1) ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-scan-right"></a>2.5.15 <a href="#func-scan-right" style="text-decoration: none">fn:scan-right</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-some">next</a> | <a href="#func-scan-left">previous</a>)</p><ol><li><p>New in 4.0</p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Produces the sequence of successive partial results from the evaluation of <a href="#func-fold-right"><code>fn:fold-right</code></a> with the same arguments.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:scan-right</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$init</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item(), item()*) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence of <var>N</var>+1 <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-single-member-array">single-member arrays</a><sup><small>DM</small></sup>, where <var>N</var> is the number of items in <code>$input</code>. For values of <code>$n</code> in the range 0 to <var>N</var>, the value of the single member of array <code>$n+1</code> in the result sequence is the value of the expression <code>fold-right( subsequence($input, count($input)-$n+1), $init, $action )</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">(0 to count($input)) 
! [ fold-right(subsequence($input, count($input)-.+1), $init, $action) ]</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>A practical implementation is likely to compute each array in the result sequence based on the value of the previous item, rather than computing each item independently as implied by the specification.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">scan-right(1 to 10, 0, op('+'))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 55 ], [ 54 ], [ 52 ], [ 49 ], [ 45 ], [ 40 ],
[ 34 ], [ 27 ], [ 19 ], [ 10 ], [ 0 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">scan-right(1 to 3, 0, op('-'))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 2 ], [ -1 ], [ 3 ], [ 0 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">scan-right(1 to 5, (), fn($a, $b) { $b, $a })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ (5, 4, 3, 2, 1) ], [ (5, 4, 3, 2) ], [ (5, 4, 3) ],
[ (5, 4) ], [ 5 ], [ () ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-some"></a>2.5.16 <a href="#func-some" style="text-decoration: none">fn:some</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-sort-by">next</a> | <a href="#func-scan-right">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[&nbsp;&nbsp;13 September 2022]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if at least one item in the input sequence matches a supplied predicate.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:some</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item(), xs:integer) as xs:boolean?)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:boolean#1</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns true if (and only if) there is an item <code>$item</code> at position <code>$pos</code> in the input sequence such that <code>$predicate($item, $pos)</code> returns true.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">exists(filter($input, $predicate))</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>An error is raised if the <code>$predicate</code> function raises an error. In particular, when the default predicate <a href="#func-boolean"><code>fn:boolean#1</code></a> is used, an error is raised if an item has no effective boolean value.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the second argument is omitted or the empty sequence, the predicate defaults to <a href="#func-boolean"><code>fn:boolean#1</code></a>, which takes the effective boolean value of each item.</p><p>It is possible for the supplied <code>$predicate</code> to be a function whose arity is less than two. The coercion rules mean that the additional parameters are effectively ignored. Frequently a predicate function will only consider the item itself, and disregard its position in the sequence.</p><p>The predicate is required to return either <code>true</code>, <code>false</code>, or the empty sequence (which is treated as <code>false</code>). A predicate such as <code>fn { self::h1 }</code> results in a type error because it returns a node, not a boolean.</p><p>The implementation <span class="verb">may</span> deliver a result as soon as one item is found for which the predicate returns <code>true</code>; it is not required to evaluate the predicate for every item, nor is it required to examine items sequentially from left to right.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>some(())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>some((1 = 1, 2 = 2, 3 = 4))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>some((), boolean#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>some((1, 3, 7), fn { . mod 2 = 1 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>some(-5 to +5, fn { . ge 0 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">some(
  ("January", "February", "March", "April",
   "September", "October", "November", "December"),
  contains(?, "z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">some(
  ("January", "February", "March", "April",
   "September", "October", "November", "December")
  =!&gt; contains("r")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>some(("", 0, number('NaN')))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p><p><em>(The effective boolean value in each case is false.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>some(reverse(1 to 5), fn($num, $pos) { $num = $pos })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-sort"></a>2.5.17 <a href="#func-sort" style="text-decoration: none">fn:sort</a></h4><dl><dt class="label">Summary</dt><dd><p>Sorts a supplied sequence, based on the value of a sort key supplied as a function.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:sort</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code>,</td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()) as xs:anyAtomicType*</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:data#1</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>This function is retained for compatibility from version 3.1 of this specification. Version 4.0 introduces two more powerful functions, <a href="#func-sort-by"><code>fn:sort-by</code></a> and <a href="#func-sort-with"><code>fn:sort-with</code></a>.</p><p>The function call <code>fn:sort($input, $collation, $key)</code> is defined to have the same effect as the call <code>fn:sort-by($input, { 'key': $key, 'collation': $collation, 'order': 'ascending'})</code>. See <a href="#func-sort-by"><code>fn:sort-by</code></a>.</p><p>The result of the function is a sequence that contains all the items from <code>$input</code>, typically in a different order, the order being defined by the supplied sort key definitions.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">fn:sort-by($input, { 'key':$key, 'collation':$collation, 'order':'ascending' })</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>If the set of computed sort keys contains values that are not comparable using the <code>lt</code> operator then the sort operation will fail with a type error ([<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>). </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sort((1, 4, 6, 5, 3))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, 3, 4, 5, 6</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sort((1, -2, 5, 10, -10, 10, 8), (), abs#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, -2, 5, 8, 10, -10, 10</code></p></td></tr><tr><td colspan="2"><p>To sort a set of strings <code>$in</code> using Swedish collation:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $SWEDISH := collation({ 'lang': 'se' })
return sort($in, $SWEDISH)</pre></div></td></tr><tr><td colspan="2"><p>To sort a sequence of employees by last name as the major sort key and first name as the minor sort key, using the default collation: </p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">sort($employees, (), fn { name ! (last, first) })</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-sort-by"></a>2.5.18 <a href="#func-sort-by" style="text-decoration: none">fn:sort-by</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-sort-with">next</a> | <a href="#func-some">previous</a>)</p><ol><li><p>New in 4.0.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1085">1085</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2001">2001</a>&nbsp;19 May 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Sorts a supplied sequence, based on the value of a number of sort keys supplied as functions.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:sort-by</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$keys</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>record(key? as (fn(item()) as xs:anyAtomicType*)?, collation? as xs:string?, order? as enum('ascending', 'descending')?)*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>The result of the function is a sequence that contains all the items from <code>$input</code>, typically in a different order, the order being defined by the supplied <b>sort key definitions</b>.</p><p>A <b>sort key definition</b> is a record with three parts:</p><ol class="enumar"><li><p><code>key:</code> A <b>sort key function</b>, which is applied to each item in the input sequence to determine a <b>sort key value</b>. If no function is supplied, the default is <a href="#func-data"><code>fn:data#1</code></a>, which atomizes the item.</p></li><li><p><code>collation:</code> A <b>collation</b>, which is used when comparing <b>sort key values</b> that are of type <code>xs:string</code> or <code>xs:untypedAtomic</code>. If no collation is supplied, the default collation from the static context is used.</p><p>When comparing values of types other than <code>xs:string</code> or <code>xs:untypedAtomic</code>, the collation is ignored (but an error <span class="verb">may</span> be reported if it is invalid). For more information see <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p></li><li><p><code>order:</code> An <b>order direction</b>, either <code>"ascending"</code> or <code>"descending"</code>. The default is <code>"ascending"</code>.</p></li></ol><p>The number of sort key definitions is determined by the number of records supplied in the <code>$keys</code> argument. If the argument is absent or empty, the default is a single sort key definition using the function <code>data#1</code>, using the default collation from the static context, and with order <code>ascending</code>.</p><p>The result of the <code>fn:sort-by</code> function is obtained as follows:</p><ol class="enumar"><li><p>The result sequence contains the same items as the input sequence <code>$input</code>, but generally in a different order.</p></li><li><p>The sort key definitions are established as described above. The sort key definitions are in major-to-minor order. That is, the position of two items <code>$A</code> and <code>$B</code> in the result sequence is determined first by the relative magnitude of their primary sort key values, which are computed by evaluating the <b>sort key function</b> in the first sort key definition. If those two sort key values are equal, then the position is determined by the relative magnitude of their secondary sort key values, computed by evaluating the sort key function in the second sort key definition, and so on.</p></li><li><p>When a pair of corresponding sort key values of <code>$A</code> and <code>$B</code> are found to be not equal, then <code>$A</code> precedes <code>$B</code> in the result sequence if both the following conditions are true, or if both conditions are false:</p><ol class="enumla"><li><p>The sort key value for <code>$A</code> is less than the sort key value for <code>$B</code>, as defined below.</p></li><li><p>The <b>order direction</b> in the corresponding sort key definition is <code>"ascending"</code>.</p></li></ol></li><li><p>If all the sort key values for <code>$A</code> and <code>$B</code> are pairwise equal, then <code>$A</code> precedes <code>$B</code> in the result sequence if and only if <code>$A</code> precedes <code>$B</code> in the input sequence.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>That is, the sort is <em>stable</em>.</p></div></li><li><p>Each sort key value for a given item is obtained by applying the sort key function of the corresponding sort key definition to that item. The result of this function is in the general case a sequence of atomic items. Two sort key values <code>$a</code> and <code>$b</code> are compared as follows:</p><ol class="enumla"><li><p>Let <var>$C</var> be the collation in the corresponding sort key definition.</p></li><li><p>Let <code>$REL</code> be the result of evaluating <code>op:lexicographic-compare($key($A), $key($B), $C)</code> where <code>op:lexicographic-compare($a, $b, $C)</code> is defined as follows:</p><div class="exampleInner"><pre xml:space="preserve" class="small">if (empty($a) and empty($b)) then 0 
else if (empty($a)) then -1
else if (empty($b)) then +1
else let $rel = op:simple-compare(head($a), head($b), $C)
     return if ($rel eq 0)
            then op:lexicographic-compare(tail($a), tail($b), $C)
            else $rel</pre></div></li><li><p>Here <code>op:simple-compare($k1, $k2)</code> is defined as follows:</p><div class="exampleInner"><pre xml:space="preserve" class="small">if ($k1 instance of (xs:string | xs:anyURI | xs:untypedAtomic)
    and $k2 instance of (xs:string | xs:anyURI | xs:untypedAtomic))
then compare($k1, $k2, $C)
else if ($k1 instance of xs:numeric and $k2 instance of xs:numeric)
then compare($k1, $k2)
else if ($k1 eq $k2) then 0
else if ($k2 lt $k2) then -1
else +1</pre></div><div class="note"><p class="prefix"><b>Note:</b></p><p>This raises an error if two keys are not comparable, for example if one is a string and the other is a number, or if both belong to a non-ordered type such as <code>xs:QName</code>.</p></div></li><li><p>If <code>$REL</code> is zero, then the two sort key values are deemed equal; if <code>$REL</code> is -1 then <code>$a</code> is deemed less than <code>$b</code>, and if <code>$REL</code> is +1 then <code>$a</code> is deemed greater than <code>$b</code></p></li></ol></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>If the set of computed sort keys contains values that are not comparable using the <code>lt</code> operator then the sort operation will fail with a type error ([<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>). </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function is a generalization of the <a href="#func-sort"><code>fn:sort</code></a> function available in 3.1, which is retained for compatibility. The enhancements allow multiple sort keys to be defined, each potentially with a different collation, and allow sorting in descending order.</p><p>If the sort key for an item evaluates to the empty sequence, the effect of the rules is that this item precedes any value for which the key is non-empty. This is equivalent to the effect of the XQuery option <code>empty least</code>. The effect of the option <code>empty greatest</code> can be achieved by adding an extra sort key definition with <code>{ 'key': fn { empty(K(.) } }</code>: when comparing boolean sort keys, <code>false</code> precedes <code>true</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sort-by((1, 4, 6, 5, 3), ())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, 3, 4, 5, 6</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sort-by((1, 4, 4e0, 6, 5, 3), { 'order': 'descending' })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>6, 5, 4, 4e0, 3, 1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sort-by((1, -2, 5, 10, -10, 10, 8), { 'key': abs#1 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, -2, 5, 8, 10, -10, 10</code></p></td></tr><tr><td colspan="2"><p>To sort a set of strings <code>$in</code> using Swedish collation:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $SWEDISH := collation({ 'lang': 'se' })
return sort-by($in, { 'collation': $SWEDISH })</pre></div></td></tr><tr><td colspan="2"><p>To sort a sequence of employees by last name as the major sort key and first name as the minor sort key, using the default collation: </p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">sort-by($employees, { 'key': fn { name ! (last, first) } })</pre></div></td></tr><tr><td colspan="2"><p>To sort a sequence of employees first by increasing last name (using Swedish collation order) and then by decreasing salary: </p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">sort-by(
  $employees, 
  ({ 'key': fn { name/last }, 'collation': collation({ 'lang': 'se' }) },
   { 'key': fn { xs:decimal(salary) }, 'order': 'descending' }))</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-sort-with"></a>2.5.19 <a href="#func-sort-with" style="text-decoration: none">fn:sort-with</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-subsequence-where">next</a> | <a href="#func-sort-by">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/655">655</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/2012">2012</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/795">795</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/2228">2228</a>&nbsp;20 February 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Sorts a supplied sequence, according to the order induced by the supplied comparator functions.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:sort-with</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$comparators</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item(), item()) as xs:integer)+</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the items of the supplied <code>$input</code> are sorted into an order based on the result of evaluating the supplied <code>$comparators</code>. The result is a sorted sequence.</p><p>Each comparator function takes two items and returns an <code>xs:integer</code> that defines the relationship between these items, following the conventions of the <a href="#func-compare"><code>fn:compare</code></a> function. Specifically, when a comparator <code>$c</code> is used to compare two items <code>$a</code> and <code>$b</code>, it must return a negative integer if <code>$a</code> is to be sorted before <code>$b</code>, zero if they are considered equal, and a positive integer if <code>$a</code> is to be sorted after <code>$b</code>.</p><p>There may be more than one comparator, representing sort keys in major to minor order. To determine the relative position of two items <code>$a</code> and <code>$b</code>:</p><ol class="enumar"><li><p>The first comparator is called: <code>$comparators[1]($a, $b)</code>. If the result is non-zero, this determines the relative position of <code>$a</code> and <code>$b</code> in the result sequence, and any further comparators can be ignored.</p></li><li><p>If the <var>N</var>th comparator returns zero, then:</p><ol class="enumla"><li><p>If this is the last comparator, then the two items are considered equal, and their relative position in the result sequence will be the same as their relative position in the input sequence (that is, the sort is <em>stable</em>).</p></li><li><p>Otherwise, the next comparator is evaluated, and so on, until the last comparator is reached or the result of a comparator is non-zero.</p></li></ol></li></ol><p>To ensure that the sorting algorithm produces predictable results (indeed, to ensure that it terminates), it is necessary for the comparators to have certain properties. Specifically, for every comparator <var>C</var>:</p><ol class="enumar"><li><p><var>C</var> must be deterministic (if called twice with the same arguments, it must deliver the same result).</p></li><li><p>Every item must be equal to itself: <code><var>C</var>($a, $a)</code> must be zero.</p></li><li><p>The ordering must be consistent: if <code><var>C</var>($a, $b) &lt; 0</code>, then <code><var>C</var>($b, $a) &gt; 0</code>, and vice versa, and similarly, if <code><var>C</var>($a, $b) = 0</code>, then <code><var>C</var>($b, $a) = 0</code>.</p></li><li><p>The ordering must be transitive: if <code><var>C</var>($a, $b) &lt; 0</code> and <code><var>C</var>($b, $c) &lt; 0</code>, then <code><var>C</var>($a, $c) &lt; 0</code>.</p></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>If a comparator function raises an error when processing any pair of items from the input sequence (for example, if the comparator function is <a href="#func-compare"><code>fn:compare#2</code></a> and the two items are of non-comparable types), then the evaluation of <a href="#func-sort-with"><code>fn:sort-with</code></a> fails with that error.</p><p>In general it is unpredictable which pairs of items from the input sequence will actually be compared using each comparator function. However, a comparator function <span class="verb">must</span> not be called to compare two items if they have been determined as unequal by an earlier comparator function.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sort-with((1, 4, 6, 5, 3), compare#2)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, 3, 4, 5, 6</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sort-with((1, 4, 6, 5, 3), op('-'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, 3, 4, 5, 6</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>sort-with((1, 4, 4e0, 6, 5, 3), fn($a, $b) { compare($b, $a) })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>6, 5, 4, 4e0, 3, 1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">sort-with(
  (1, -2, 5, 10, -12, 8),
  fn($a, $b) { abs($a) - abs($b) }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, -2, 5, 8, 10, -12</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $persons := &lt;persons&gt;
  &lt;person name='Josipa' age='8'/&gt;
  &lt;person name='Jade' age='6'/&gt;
  &lt;person name='Jie' age='8'/&gt;
&lt;/persons&gt;
return sort-with($persons/person, (
  fn($a, $b) { compare($a/@age, $b/@age) },
  fn($a, $b) { compare($a/@name, $b/@name) }
))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">&lt;person name="Jade" age="6"/&gt;
&lt;person name="Jie" age="8"/&gt;
&lt;person name="Josipa" age="8"/&gt;</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subsequence-where"></a>2.5.20 <a href="#func-subsequence-where" style="text-decoration: none">fn:subsequence-where</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-take-while">next</a> | <a href="#func-sort-with">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/878">878</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/940">940</a>&nbsp;5 February 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a contiguous sequence of items from <code>$input</code>, with the start and end points located by applying predicates.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:subsequence-where</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$from</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item(), xs:integer) as xs:boolean?)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>true#0</code>,</td></tr><tr class="arg"><td><code>$to</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item(), xs:integer) as xs:boolean?)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>false#0</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function returns the subsequence of <code>$input</code> starting with the first item that matches the <code>$from</code> predicate, and ending with the first subsequent item that matches the <code>$to</code> predicate. If <code>$from</code> is not supplied, it defaults to the start of <code>$input</code>; if <code>$to</code> is not supplied, it defaults to the end of <code>$input</code>. If <code>$from</code> does not match any items in <code>$input</code>, the result is the empty sequence; if <code>$to</code> does not match any items, all items up to the last are included in the result.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">let $start := index-where($input, $from)[1] otherwise count($input) + 1
let $end   := index-where($input, $to)[. ge $start][1] otherwise count($input) + 1
return slice($input, $start, $end)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The result includes both the item that matches the <code>$from</code> condition and the item that matches the <code>$to</code> condition. To select a subsequence that starts after the <code>$from</code> item, apply the <a href="#func-tail"><code>fn:tail</code></a> function to the result. To select a subsequence that ends before the <code>$to</code> item, apply the <a href="#func-trunk"><code>fn:trunk</code></a> function to the result.</p><p>The predicate functions supplied to the <code>$from</code> and <code>$to</code> parameters can include an integer position argument as well as the item itself. This position will always be 1-based, relative to the start of <code>$input</code>. This means it is possible to select items based on their absolute position in the <code>$input</code> sequence, but there is no mechanism to select an end position relative to the start position. If this is needed, the function can be combined with others: for example, to select a subsequence of four items starting with <code>"Barbara"</code>, use <code>$input =&gt; subsequence-where(fn { . eq "Barbara" }) =&gt; slice(end := 4)</code>.</p><p>If the requirement is to select all elements stopping before the first <code>h2</code> element if it exists, or up to the end of the sequence otherwise, the simplest solution is perhaps to write:</p><div class="exampleInner"><pre xml:space="preserve">slice($input, end:=index-where($input, fn { boolean(self::h2) })[1])</pre></div><p>A return value of <code>()</code> from the <code>$from</code> or <code>$to</code> predicate is treated as <code>false</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $names := ("Anna", "Barbara", "Catherine", "Delia",  "Eliza", "Freda",
  "Gertrude", "Hilda")</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>subsequence-where($names, starts-with(?, "E"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"Eliza", "Freda", "Gertrude", "Hilda"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>subsequence-where($names, to := starts-with(?, "D"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"Anna", "Barbara", "Catherine", "Delia"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>subsequence-where($names, to := starts-with(?, "D")) =&gt; trunk()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"Anna", "Barbara", "Catherine"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>subsequence-where($names, starts-with(?, "E"), starts-with(?, "G"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"Eliza", "Freda", "Gertrude"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">subsequence-where(
  $names,
  starts-with(?, "D"), fn { string-length(.) gt 5 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Delia", "Eliza", "Freda", "Gertrude"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>subsequence-where($names, starts-with(?, "M"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>subsequence-where($names, starts-with(?, "G"), starts-with(?, "Z"))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"Gertrude", "Hilda"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>subsequence-where($names)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Anna", "Barbara", "Catherine", "Delia", "Eliza", "Freda",
  "Gertrude", "Hilda"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">subsequence-where(
  $names,
  fn($it, $pos) { ends-with($it, "a") and $pos gt 5 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Freda", "Gertrude", "Hilda"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">subsequence-where(
  $names, 
  to := fn($it, $pos) { ends-with($it, "a") and $pos ge 5 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Anna", "Barbara", "Catherine", "Delia", "Eliza"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-take-while"></a>2.5.21 <a href="#func-take-while" style="text-decoration: none">fn:take-while</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-transitive-closure">next</a> | <a href="#func-subsequence-where">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/1002">1002</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1038">1038</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1046">1046</a>&nbsp;5 March 2004]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns items from the input sequence prior to the first one that fails to match a supplied predicate.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:take-while</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item(), xs:integer) as xs:boolean?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns all items in the sequence prior to the first one where the result of calling the supplied <code>$predicate</code> function, with the current item and its position as arguments, returns the value <code>false</code> or <code>()</code>.</p><p>If every item in the sequence satisfies the predicate, then <code>$input</code> is returned in its entirety.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XQuery expression.</p><div class="exampleInner"><pre xml:space="preserve">for $item at $pos in $input
while $predicate($item, $pos)
return $item</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>There is no analogous <code>drop-while</code> or <code>skip-while</code> function, as found in some functional programming languages. The effect of <code>drop-while($input, $predicate)</code> can be achieved by calling <code>fn:subsequence-where($input, fn { not($predicate(.)) })</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>take-while(10 to 20, fn { . le 12 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>10, 11, 12</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>take-while(10 to 20, fn { . lt 100 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>10 to 20</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>take-while((), boolean#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">take-while(
  ("A", "B", "C", " ", "E"), 
  fn { boolean(normalize-space()) }
 )</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"A", "B", "C"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">parse-xml("&lt;doc&gt;&lt;p/&gt;&lt;p/&gt;&lt;h2/&gt;&lt;img/&gt;&lt;p/&gt;&lt;/doc&gt;")/doc/*
=&gt; take-while(fn { boolean(self::p) })
=&gt; count()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">("Aardvark", "Antelope", "Bison", "Buffalo", "Camel", "Dingo")
=&gt; take-while(starts-with(?, "A"))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Aardvark", "Antelope"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">take-while(10 to 20, fn($num, $pos) { $num lt 18 and $pos lt 4 })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">10, 11, 12</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">take-while(
  characters("ABCD-123"), 
  fn($ch, $pos) { $pos lt 4 and $ch ne '-' }
) =&gt; string-join()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"ABC"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">take-while(
  ("A", "a", "B", "b", "C", "D", "d"),
   fn($ch, $pos) {
     matches($ch, if ($pos mod 2 eq 1) then "\p{Lu}" else "\p{Ll}")
   }
 )</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"A", "a", "B", "b", "C"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-transitive-closure"></a>2.5.22 <a href="#func-transitive-closure" style="text-decoration: none">fn:transitive-closure</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-while-do">next</a> | <a href="#func-take-while">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/518">518</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/554">554</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/754">754</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/521">521</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/761">761</a>&nbsp;18 October 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns all the GNodes reachable from a given start GNode by applying a supplied function repeatedly.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:transitive-closure</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>gnode()?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$step</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(gnode()) as gnode()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>gnode()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function works with both XNodes and JNodes.</p><p>The value of <code>$node</code> is a node from which navigation starts. If <code>$node</code> is an empty sequence, the function returns the empty sequence. </p><p>The value of <code>$step</code> is a function that takes a single GNode as input, and returns a set of GNodes as its result.</p><p>The result of the <a href="#func-transitive-closure"><code>fn:transitive-closure</code></a> function is the set of GNodes that are reachable from <code>$node</code> by applying the <code>$step</code> function one or more times.</p><p>Although <code>$step</code> may return any sequence of GNodes, the result is treated as a set: the order of GNodes in the sequence is ignored, and duplicates are ignored. The result of of the <code>transitive-closure</code> function will always be a sequence of GNodes in document order with no duplicates.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function delivers the same result as the following XQuery implementation.</p><div class="exampleInner"><pre xml:space="preserve" class="small">declare %private function tc-inclusive(
  $nodes as gnode()*,
  $step  as fn(gnode()) as gnode()*
) as gnode()* {
  let $nextStep := $nodes/$step(.)
  let $newNodes := $nextStep except $nodes
  return if (exists($newNodes))
         then $nodes union tc-inclusive($newNodes, $step)
         else $nodes
};

declare function transitive-closure (
  $node as gnode(),
  $step as fn(gnode()) as gnode()*
) as gnode()* {
  tc-inclusive($node/$step(.), $step)
};

(: Explanation:

   The private helper function tc-inclusive takes a set of GNodes as input,
   and calls the $step function on each one of those GNodes; if the result 
   includes GNodes that are not already present in the input, then it makes 
   a recursive call to find GNodes reachable from these new GNodes, and returns
   the union of the supplied GNodes and the GNodes returned from the recursive
   call (which will always include the new GNodes selected in the first step).
   
   If there are no new GNodes, the recursion ends, returning the GNodes that 
   have been found up to this point.
   
   The main function fn:transitive-closure finds the nodes that are reachable 
   from the start GNodes in a single step, and then invokes the helper function 
   tc-inclusive to add GNodes that are reachable in multiple steps.
:)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>Cycles in the data are not a problem; the function stops searching when it finds no new GNodes.</p><p>The function may fail to terminate if the supplied <code>$step</code> function constructs and returns new GNodes. A processor <span class="verb">may</span> detect this condition but is not required to do so.</p><p>The <code>$node</code> GNodes is not included in the result, unless it is reachable by applying the <code>$step</code> function one or more times. If a result is required that does include <code>$node</code>, it can be readily added to the result using the union operator: <code>$node | transitive-closure($node, $step)</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $data := document { &lt;doc&gt;
  &lt;person id="0"/&gt;
  &lt;person id="1" manager="0"/&gt;
  &lt;person id="2" manager="0"/&gt;
  &lt;person id="3" manager="2"/&gt;
  &lt;person id="4" manager="2"/&gt;
  &lt;person id="5" manager="1"/&gt;
  &lt;person id="6" manager="3"/&gt;
  &lt;person id="7" manager="6"/&gt;
  &lt;person id="8" manager="6"/&gt;
&lt;/doc&gt; }</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $direct-reports := fn($p as element(person)) as element(person)* {
  $p/../person[@manager = $p/@id]
}</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">transitive-closure(
  $data//person[@id = "2"],
  $direct-reports
)/string(@id)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"3", "4", "6", "7", "8"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">transitive-closure(
  $data, 
  function { child::* }
)/@id ! string()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"0", "1", "2", "3", "4", "5", "6", "7", "8"</pre></div></td></tr><tr><td colspan="2"><p>The following example, given <code>$root</code> as the root of an XSLT stylesheet module, returns the URIs of all stylesheet modules reachable using <code>xsl:import</code> and <code>xsl:include</code> declarations:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">transitive-closure($root, fn { document(//(xsl:import|xsl:include)/@href) }) 
=!&gt; document-uri()</pre></div></td></tr><tr><td colspan="2"><p>This example uses the XSLT-defined <code>document()</code> function.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-while-do"></a>2.5.23 <a href="#func-while-do" style="text-decoration: none">fn:while-do</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#comp.numeric">next</a> | <a href="#func-transitive-closure">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/946">946</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/962">962</a>&nbsp;23 January 2024]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Processes a supplied value repeatedly, continuing while some condition remains true, and returning the first value that does not satisfy the condition.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:while-do</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, xs:integer) as xs:boolean?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, xs:integer) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function behaves as follows:</p><ol class="enumar"><li><p><code>$pos</code> is initially set to <code>1</code>.</p></li><li><p><code>$predicate($input, $pos)</code> is evaluated. If the result is <code>false</code> or <code>()</code>, the function returns the value of <code>$input</code>.</p></li><li><p>Otherwise, <code>$action($input, $pos)</code> is evaluated, the resulting value is used as a new <code>$input</code>, and the process repeats from step 2 with <code>$pos</code> incremented by <code>1</code>.</p></li></ol></dd><dt class="label">Formal Equivalent</dt><dd><p>The function delivers the same result as the following XQuery implementation.</p><div class="exampleInner"><pre xml:space="preserve" class="small">declare %private function while-do-helper(
  $input     as item()*,
  $predicate as fn(item()*, xs:integer) as xs:boolean?,
  $action    as fn(item()*, xs:integer) as item()*,
  $pos       as xs:integer
) as item()* {
  if ($predicate($input, $pos))
  then while-do-helper($action($input, $pos), $predicate, $action, $pos + 1)
  else $input
};

declare function while-do(
  $input     as item()*,
  $predicate as fn(item()*, xs:integer) as xs:boolean?,
  $action    as fn(item()*, xs:integer) as item()*
) as item()* {
  while-do-helper($input, $predicate, $action, 1)
};</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>While-do loops are very common in procedural programming languages, and this function provides a way to write functionally clean and interruptible iterations without side-effects. As long as a given condition is met, an new value is computed and tested again. Depending on the use case, the value can be a simple atomic item or an arbitrarily complex data structure.</p><p>The function <a href="#func-do-until"><code>fn:do-until</code></a> can be used to perform the action before the first predicate test.</p><p>Note that, just as when writing recursive functions, it is easy to construct infinite loops.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">while-do(2, fn { . &lt;= 100 }, fn { . * . })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">256</pre></div><p><em>(The loop is interrupted as soon as the computed product is greater than 100.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">while-do(
  1,
  fn($num, $pos) { $pos &lt;= 10 },
  fn($num, $pos) { $num * $pos }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">3628800</pre></div><p><em>(This returns the factorial of 10, i.e., the product of all integers from 1 to 10.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := (0 to 4, 6 to 10)
return while-do(
  0,
  fn($n) { $n = $input },
  fn($n) { $n + 1 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">5</pre></div><p><em>(This returns the first positive number missing in a sequence.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">while-do(
  1 to 9,
  fn($value) { head($value) &lt; 5 },
  fn($value) { tail($value) }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">5, 6, 7, 8, 9</pre></div><p><em>(The first number of a sequence is removed as long as it is smaller than 5.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := 3936256
return while-do(
  $input,
  fn($result) { abs($result * $result - $input) &gt;= 0.0000000001 },
  fn($guess) { ($guess + $input div $guess) div 2 }
) =&gt; round(5)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1984</pre></div><p><em>(This computes the square root of a number.)</em></p></td></tr><tr><td colspan="2"><p>The following example generates random doubles. It is interrupted once a number exceeds a given limit:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $result := while-do(
  random-number-generator(),
  fn($random) {
    $random?number &lt; 0.8
  },
  fn($random) {
    map:put($random?next(), 'numbers', ($random?numbers, $random?number))
  }
)
return $result?numbers</pre></div></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="boolean-functions"></a>3 <a href="#boolean-functions" style="text-decoration: none">Processing booleans</a></h2><p>This section defines functions and operators on the <code>xs:boolean</code> datatype.</p><div class="div2"><h3><a id="boolean-constructors"></a>3.1 <a href="#boolean-constructors" style="text-decoration: none">Boolean constant functions</a></h3><p>Since no literals are defined in XPath to reference the constant boolean values <code>true</code> and <code>false</code>, two functions are provided for the purpose.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-true"><code>fn:true</code></a></td><td>Returns the <code>xs:boolean</code> value <code>true</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-false"><code>fn:false</code></a></td><td>Returns the <code>xs:boolean</code> value <code>false</code>.</td></tr></tbody></table><div class="div3"><h4><a id="func-true"></a>3.1.1 <a href="#func-true" style="text-decoration: none">fn:true</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:boolean</code> value <code>true</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:true</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:boolean</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The result is equivalent to <code>xs:boolean("1")</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>true()</code></pre></div></td><td style="vertical-align:top"><p><code>xs:boolean(1)</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-false"></a>3.1.2 <a href="#func-false" style="text-decoration: none">fn:false</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:boolean</code> value <code>false</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:false</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:boolean</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The result is equivalent to <code>xs:boolean("0")</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>false()</code></pre></div></td><td style="vertical-align:top"><p><code>xs:boolean(0)</code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="boolean-value-functions"></a>3.2 <a href="#boolean-value-functions" style="text-decoration: none">Functions on Boolean values</a></h3><p>The following functions are defined on boolean values:</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-boolean"><code>fn:boolean</code></a></td><td>Computes the effective boolean value of the sequence <code>$input</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-not"><code>fn:not</code></a></td><td>Returns <code>true</code> if the effective boolean value of <code>$input</code> is <code>false</code>, or <code>false</code> if it is <code>true</code>.</td></tr></tbody></table><div class="div3"><h4><a id="func-boolean"></a>3.2.1 <a href="#func-boolean" style="text-decoration: none">fn:boolean</a></h4><dl><dt class="label">Summary</dt><dd><p>Computes the effective boolean value of the sequence <code>$input</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:boolean</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function computes the effective boolean value of a sequence, defined according to the following rules. See also <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-ebv">2.6.4 Effective Boolean Value</a>.</p><ul><li><p>If <code>$input</code> is the empty sequence, <a href="#func-boolean"><code>fn:boolean</code></a> returns <code>false</code>.</p></li><li><p>If <code>$input</code> is a sequence whose first item is a <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-GNode">GNode</a><sup><small>DM</small></sup> (a generalized node), <a href="#func-boolean"><code>fn:boolean</code></a> returns <code>true</code>.</p></li><li><p>If <code>$input</code> is a singleton value of type <code>xs:boolean</code> or of a type derived from <code>xs:boolean</code>, <a href="#func-boolean"><code>fn:boolean</code></a> returns <code>$input</code>.</p></li><li><p>If <code>$input</code> is a singleton value of type <code>xs:untypedAtomic</code>, <code>xs:string</code>, <code>xs:anyURI</code>, or a type derived from <code>xs:string</code> or <code>xs:anyURI</code>, <a href="#func-boolean"><code>fn:boolean</code></a> returns <code>false</code> if the operand value has zero length; otherwise it returns <code>true</code>.</p></li><li><p>If <code>$input</code> is a singleton value of any numeric type or a type derived from a numeric type, <a href="#func-boolean"><code>fn:boolean</code></a> returns <code>false</code> if the operand value is <code>NaN</code> or is numerically equal to zero; otherwise it returns <code>true</code>.</p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>In all cases other than those listed above, <a href="#func-boolean"><code>fn:boolean</code></a> raises a type error [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>].</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The result of this function is not necessarily the same as <code>$input cast as xs:boolean</code>. For example, <code>fn:boolean("false")</code> returns the value <code>true</code> whereas <code>"false" cast as xs:boolean</code> (which can also be written <code>xs:boolean("false")</code>) returns <code>false</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $abc := ("a", "b", "")</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>boolean($abc[1])</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>boolean($abc[0])</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>boolean($abc[3])</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td colspan="2"><p><code>fn:boolean($abc)</code> raises a type error [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>].</p></td></tr><tr><td colspan="2"><p><code>fn:boolean([])</code> raises a type error [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>].</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-not"></a>3.2.2 <a href="#func-not" style="text-decoration: none">fn:not</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the effective boolean value of <code>$input</code> is <code>false</code>, or <code>false</code> if it is <code>true</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:not</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The value of <code>$input</code> is first reduced to an effective boolean value by applying the <code>fn:boolean()</code> function. The function returns <code>true</code> if the effective boolean value is <code>false</code>, or <code>false</code> if the effective boolean value is <code>true</code>. </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>not(true())</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>not(())</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>not("false")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td colspan="2"><p><code>fn:not(1 to 10)</code> raises a type error [<a href="#ERRFORG0006" title="err:FORG0006">err:FORG0006</a>].</p></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="numeric-functions"></a>4 <a href="#numeric-functions" style="text-decoration: none">Processing numerics</a></h2><p>This section specifies arithmetic operators on the numeric datatypes defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>.</p><div class="div2"><h3><a id="numeric-types"></a>4.1 <a href="#numeric-types" style="text-decoration: none">Numeric types</a></h3><p>The operators described in this section are defined on the following atomic types.</p><div class="type-hierarchy-figure"><div class="hier"><ul class="type-hierarchy type-colors"><li class="primitive special root"><ul><li class="primitive"><p class="item"><span>decimal</span></p><ul><li class="built-in-atomic"><p class="first"><span>integer</span></p></li></ul></li><li class="primitive"><p class="item"><span>double</span></p></li><li class="primitive"><p class="item"><span>float</span></p></li></ul></li></ul></div><div class="legend"><p>Legend:</p><ul class="type-hierarchy type-colors"><li><p class="root"><span>Supertype</span></p><ul><li><p><span>subtype</span></p></li></ul></li></ul><ul class="type-legend type-colors"><li class="built-in-atomic"><p><span>Built-in atomic types</span></p></li></ul></div></div><p>They also apply to types derived by restriction from the above types. </p><p>The type <code>xs:numeric</code> is defined as a union type whose member types are (in order) <code>xs:double</code>, <code>xs:float</code>, and <code>xs:decimal</code>. This type is implicitly imported into the static context, so it can also be used in defining the signature of user-written functions. Apart from the fact that it is implicitly imported, it behaves exactly like a user-defined type with the same definition. This means, for example:</p><ul><li><p>If the expected type of a function parameter is given as <code>xs:numeric</code>, the actual value supplied can be an instance of any of these three types, or any type derived from these three by restriction (this includes the built-in type <code>xs:integer</code>, which is derived from <code>xs:decimal</code>).</p></li><li><p><span style="display: none;" class="delete_version">If the expected type of a function parameter is given as <code>xs:numeric</code>, and the actual value supplied is <code>xs:untypedAtomic</code> (or a node whose atomized value is <code>xs:untypedAtomic</code>), then it will be cast to the union type <code>xs:numeric</code> using the rules in <a href="#casting-to-union"><span class="delete_version"><b>23.3.7 Casting to union types</b></span><span class="modify_version"><b>23.3.7 Casting to union types</b></span></a>. Because the lexical space of <code>xs:double</code> subsumes the lexical space of the other member types, and <code>xs:double</code> is listed first, the effect is that if the untyped atomic item is in the lexical space of <code>xs:double</code>, it will be converted to an <code>xs:double</code>, and if not, a dynamic error occurs.</span><span style="display: none;" class="add_version">If the expected type of a function parameter is given as <code>xs:numeric</code>, and the actual value supplied is <code>xs:untypedAtomic</code> (or a node whose atomized value is <code>xs:untypedAtomic</code>), then it will be cast to the union type <code>xs:numeric</code> using the rules in <a href="#casting-to-union"><span class="add_version"><b>24.3.7 Casting to union types</b></span><span class="modify_version"><b>24.3.7 Casting to union types</b></span></a>. Because the lexical space of <code>xs:double</code> subsumes the lexical space of the other member types, and <code>xs:double</code> is listed first, the effect is that if the untyped atomic item is in the lexical space of <code>xs:double</code>, it will be converted to an <code>xs:double</code>, and if not, a dynamic error occurs.</span><span class="modify_version">If the expected type of a function parameter is given as <code>xs:numeric</code>, and the actual value supplied is <code>xs:untypedAtomic</code> (or a node whose atomized value is <code>xs:untypedAtomic</code>), then it will be cast to the union type <code>xs:numeric</code> using the rules in <a href="#casting-to-union"><span style="display: none;" class="delete_version"><b>23.3.7 Casting to union types</b></span><span style="display: none;" class="add_version"><b>24.3.7 Casting to union types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.7</span><span class="deltaxml-new" style="background:#90EE90">24.3.7</span> Casting to union types</b></span></a>. Because the lexical space of <code>xs:double</code> subsumes the lexical space of the other member types, and <code>xs:double</code> is listed first, the effect is that if the untyped atomic item is in the lexical space of <code>xs:double</code>, it will be converted to an <code>xs:double</code>, and if not, a dynamic error occurs.</span></p></li><li><p>When the return type of a function is given as <code>xs:numeric</code>, the actual value returned will be an instance of one of the three member types (and perhaps also of types derived from these by restriction). The rules for the particular function will specify how the type of the result depends on the values supplied as arguments. In many cases, for the functions in this specification, the result is defined to be the same type as the first argument.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p> This specification uses <a href="#ieee754-2019">[IEEE 754-2019]</a> arithmetic for <code>xs:float</code> and <code>xs:double</code> values. One consequence of this is that some operations result in the value <code>NaN</code> (not a number), which has the unusual property that it is not equal to itself. Another consequence is that some operations return the value negative zero. This differs from <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, which defines <code>NaN</code> as being equal to itself and defines only a single zero in the value space. The text accompanying several functions defines behavior for both positive and negative zero inputs and outputs in the interest of alignment with <a href="#ieee754-2019">[IEEE 754-2019]</a>. A conformant implementation must respect these semantics. In consequence, the expression <code>-0.0e0</code> (which is actually a unary minus operator applied to an <code>xs:double</code> value) will always return negative zero: see <a href="#func-numeric-unary-minus"><b>4.2.8 op:numeric-unary-minus</b></a>. As a concession to implementations that rely on implementations of XSD 1.0, however, when casting from string to double the lexical form <code>-0</code><span class="verb">may</span> be converted to positive zero, though negative zero is <span class="verb">recommended</span>. </p><p>XML Schema 1.1 introduces support for positive and negative zero as distinct values, and also uses the <a href="#ieee754-2019">[IEEE 754-2019]</a> semantics for comparisons involving <code>NaN</code>.</p></div></div><div class="div2"><h3><a id="op.numeric"></a>4.2 <a href="#op.numeric" style="text-decoration: none">Arithmetic operators on numeric values</a></h3><p>The following functions define the semantics of arithmetic operators defined in <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> and <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> on these numeric types. </p><table class="no-code-break data"><thead><tr><th>Operator</th><th>Meaning</th></tr></thead><tbody><tr><td><a href="#func-numeric-add"><code>op:numeric-add</code></a></td><td>Addition</td></tr><tr><td><a href="#func-numeric-subtract"><code>op:numeric-subtract</code></a></td><td>Subtraction</td></tr><tr><td><a href="#func-numeric-multiply"><code>op:numeric-multiply</code></a></td><td>Multiplication</td></tr><tr><td><a href="#func-numeric-divide"><code>op:numeric-divide</code></a></td><td>Division</td></tr><tr><td><a href="#func-numeric-integer-divide"><code>op:numeric-integer-divide</code></a></td><td>Integer division</td></tr><tr><td><a href="#func-numeric-mod"><code>op:numeric-mod</code></a></td><td>Modulus</td></tr><tr><td><a href="#func-numeric-unary-plus"><code>op:numeric-unary-plus</code></a></td><td>Unary plus</td></tr><tr><td><a href="#func-numeric-unary-minus"><code>op:numeric-unary-minus</code></a></td><td>Unary minus (negation)</td></tr></tbody></table><p>The parameters and return types for the above operators are in most cases declared to be of type <code>xs:numeric</code>, which permits the basic numeric types: <code>xs:integer</code>, <code>xs:decimal</code>, <code>xs:float</code> and <code>xs:double</code>, and types derived from them. In general the two-argument functions require that both arguments are of the same primitive type, and they return a value of this same type. The exceptions are <a href="#func-numeric-divide"><code>op:numeric-divide</code></a>, which returns an <code>xs:decimal</code> if called with two <code>xs:integer</code> operands, and <a href="#func-numeric-integer-divide"><code>op:numeric-integer-divide</code></a> which always returns an <code>xs:integer</code>.</p><p>If the two operands of an arithmetic expression are not of the same type, they may be converted to a common type as described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-arithmetic">4.9 Arithmetic Expressions</a>. </p><p>The result type of operations depends on their argument datatypes and is defined in the following table:</p><table class="no-code-break data"><thead><tr><th>Operator</th><th>Returns</th></tr></thead><tbody><tr><td><code>op:operation(xs:integer, xs:integer)</code></td><td><code>xs:integer</code> (except for <code>op:numeric-divide(integer, integer)</code>, which returns <code>xs:decimal</code>)</td></tr><tr><td><code>op:operation(xs:decimal, xs:decimal)</code></td><td><code>xs:decimal</code></td></tr><tr><td><code>op:operation(xs:float, xs:float)</code></td><td><code>xs:float</code></td></tr><tr><td><code>op:operation(xs:double, xs:double)</code></td><td><code>xs:double</code></td></tr><tr><td><code>op:operation(xs:integer)</code></td><td><code>xs:integer</code></td></tr><tr><td><code>op:operation(xs:decimal)</code></td><td><code>xs:decimal</code></td></tr><tr><td><code>op:operation(xs:float)</code></td><td><code>xs:float</code></td></tr><tr><td><code>op:operation(xs:double)</code></td><td><code>xs:double</code></td></tr></tbody></table><p>The basic rules for addition, subtraction, and multiplication of ordinary numbers are not set out in this specification; they are taken as given. In the case of <code>xs:double</code> and <code>xs:float</code> the rules are as defined in <a href="#ieee754-2019">[IEEE 754-2019]</a>. The rules for handling division and modulus operations, as well as the rules for handling special values such as infinity and <code>NaN</code>, and exception conditions such as overflow and underflow, are described more explicitly since they are not necessarily obvious.</p><p>On overflow and underflow situations during arithmetic operations, conforming implementations <span class="verb">must</span> behave as follows:</p><ul><li><p>For <code>xs:float</code> and <code>xs:double</code> operations, overflow behavior <span class="verb">must</span> be conformant with <a href="#ieee754-2019">[IEEE 754-2019]</a>. This specification allows the following options:</p><ul><li><p>Raising a dynamic error [<a href="#ERRFOAR0002" title="err:FOAR0002">err:FOAR0002</a>] via an overflow trap.</p></li><li><p>Returning <code>INF</code> or <code>-INF</code>.</p></li><li><p>Returning the largest (positive or negative) non-infinite number.</p></li></ul></li><li><p>For <code>xs:float</code> and <code>xs:double</code> operations, underflow behavior <span class="verb">must</span> be conformant with <a href="#ieee754-2019">[IEEE 754-2019]</a>. This specification allows the following options:</p><ul><li><p>Raising a dynamic error [<a href="#ERRFOAR0002" title="err:FOAR0002">err:FOAR0002</a>] via an underflow trap.</p></li><li><p>Returning <code>0.0E0</code> or <code>+/- 2**Emin</code> or a denormalized value; where <code>Emin</code> is the smallest possible <code>xs:float</code> or <code>xs:double</code> exponent.</p></li></ul></li><li><p>For <code>xs:decimal</code> operations, overflow behavior <span class="verb">must</span> raise a dynamic error [<a href="#ERRFOAR0002" title="err:FOAR0002">err:FOAR0002</a>]. On underflow, <code>0.0</code> must be returned.</p></li><li><p>For <code>xs:integer</code> operations, implementations that support limited-precision integer operations <span class="verb">must</span> select from the following options:</p><ul><li><p> They <span class="verb">may</span> choose to always raise a dynamic error [<a href="#ERRFOAR0002" title="err:FOAR0002">err:FOAR0002</a>].</p></li><li><p> They <span class="verb">may</span> provide an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> mechanism that allows users to choose between raising an error and returning a result that is modulo the largest representable integer value. See <a href="#ISO10967">[ISO 10967]</a>.</p></li></ul></li></ul><p>The functions <a href="#func-numeric-add"><code>op:numeric-add</code></a>, <a href="#func-numeric-subtract"><code>op:numeric-subtract</code></a>, <a href="#func-numeric-multiply"><code>op:numeric-multiply</code></a>, <a href="#func-numeric-divide"><code>op:numeric-divide</code></a>, <a href="#func-numeric-integer-divide"><code>op:numeric-integer-divide</code></a> and <a href="#func-numeric-mod"><code>op:numeric-mod</code></a> are each defined for pairs of numeric operands, each of which has the same type:<code>xs:integer</code>, <code>xs:decimal</code>, <code>xs:float</code>, or <code>xs:double</code>. The functions <a href="#func-numeric-unary-plus"><code>op:numeric-unary-plus</code></a> and <a href="#func-numeric-unary-minus"><code>op:numeric-unary-minus</code></a> are defined for a single operand whose type is one of those same numeric types.</p><p> For <code>xs:float</code> and <code>xs:double</code> arguments, if either argument is <code>NaN</code>, the result is <code>NaN</code>.</p><p>For <code>xs:decimal</code> values, let <var>N</var> be the number of digits of precision supported by the implementation, and let <var>M</var> (<code>M &lt;= N</code>) be the minimum limit on the number of digits required for conformance (18 digits for XSD 1.0, 16 digits for XSD 1.1). Then for addition, subtraction, and multiplication operations, the returned result <span class="verb">should</span> be accurate to <var>N</var> digits of precision, and for division and modulus operations, the returned result <span class="verb">should</span> be accurate to at least <var>M</var> digits of precision. The actual precision is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the number of digits in the mathematical result exceeds the number of digits that the implementation retains for that operation, the result is truncated or rounded in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> manner.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>This specification does not determine whether <code>xs:decimal</code> operations are fixed point or floating point. In an implementation using floating point it is possible for very simple operations to require more digits of precision than are available; for example, adding <code>1e100</code> to <code>1e-100</code> requires 200 digits of precision for an accurate representation of the result.</p></div><p>The <a href="#ieee754-2019">[IEEE 754-2019]</a> specification also describes handling of two exception conditions called <code>divideByZero</code> and <code>invalidOperation</code>. The IEEE <code>divideByZero</code> exception is raised not only by a direct attempt to divide by zero, but also by operations such as <code>log(0)</code>. The IEEE <code>invalidOperation</code> exception is raised by attempts to call a function with an argument that is outside the function’s domain (for example, <code>sqrt(-1)</code> or <code>log(-1)</code>). Although IEEE defines these as exceptions, it also defines “default non-stop exception handling” in which the operation returns a defined result, typically positive or negative infinity, or <code>NaN</code>. With this function library, these IEEE exceptions do not cause a dynamic error at the application level; rather they result in the relevant function or operator returning the defined non-error result. The underlying IEEE exception <span class="verb">may</span> be notified to the application or to the user by some <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> warning condition, but the observable effect on an application using the functions and operators defined in this specification is simply to return the defined result (typically <code>-INF</code>, <code>+INF</code>, or <code>NaN</code>) with no error.</p><p>The <a href="#ieee754-2019">[IEEE 754-2019]</a> specification distinguishes two <code>NaN</code> values: a quiet <code>NaN</code> and a signaling <code>NaN</code>. These two values are not distinguishable in the XDM model: the value spaces of <code>xs:float</code> and <code>xs:double</code> each include only a single <code>NaN</code> value. This does not prevent the implementation distinguishing them internally, and triggering different <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> warning conditions, but such distinctions do not affect the observable behavior of an application using the functions and operators defined in this specification.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Although comparison of numeric values across heterogeneous types has changed to convert both values to <code>xs:decimal</code>, arithmetic operations continue to use <code>xs:double</code> as the common type.</p></div><div class="div3"><h4><a id="func-numeric-add"></a>4.2.1 <a href="#func-numeric-add" style="text-decoration: none">op:numeric-add</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the arithmetic sum of its operands: (<code>$arg1 + $arg2</code>).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>+</code> operator when applied to two numeric values</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:numeric-add</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p> For <code>xs:float</code> or <code>xs:double</code> values, if one of the operands is a zero or a finite number and the other is <code>INF</code> or <code>-INF</code>, <code>INF</code> or <code>-INF</code> is returned. If both operands are <code>INF</code>, <code>INF</code> is returned. If both operands are <code>-INF</code>, <code>-INF</code> is returned. If one of the operands is <code>INF</code> and the other is <code>-INF</code>, <code>NaN</code> is returned.</p></div></dd></dl></div><div class="div3"><h4><a id="func-numeric-subtract"></a>4.2.2 <a href="#func-numeric-subtract" style="text-decoration: none">op:numeric-subtract</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the arithmetic difference of its operands: (<code>$arg1 - $arg2</code>).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to two numeric values. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:numeric-subtract</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p> For <code>xs:float</code> or <code>xs:double</code> values, if one of the operands is a zero or a finite number and the other is <code>INF</code> or <code>-INF</code>, an infinity of the appropriate sign is returned. If both operands are <code>INF</code> or <code>-INF</code>, <code>NaN</code> is returned. If one of the operands is <code>INF</code> and the other is <code>-INF</code>, an infinity of the appropriate sign is returned.</p></div></dd></dl></div><div class="div3"><h4><a id="func-numeric-multiply"></a>4.2.3 <a href="#func-numeric-multiply" style="text-decoration: none">op:numeric-multiply</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the arithmetic product of its operands: (<code>$arg1 * $arg2</code>).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>*</code> operator when applied to two numeric values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:numeric-multiply</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p> For <code>xs:float</code> or <code>xs:double</code> values, if one of the operands is a zero and the other is an infinity, <code>NaN</code> is returned. If one of the operands is a non-zero number and the other is an infinity, an infinity with the appropriate sign is returned.</p></div></dd></dl></div><div class="div3"><h4><a id="func-numeric-divide"></a>4.2.4 <a href="#func-numeric-divide" style="text-decoration: none">op:numeric-divide</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the arithmetic quotient of its operands: (<code>$arg1 div $arg2</code>).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>div</code> operator when applied to two numeric values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:numeric-divide</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p><p>As a special case, if the types of both <code>$arg1</code> and <code>$arg2</code> are <code>xs:integer</code>, then the return type is <code>xs:decimal</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOAR0001" title="err:FOAR0001">err:FOAR0001</a>] for <code>xs:decimal</code> and <code>xs:integer</code> operands, if the divisor is (positive or negative) zero.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>For <code>xs:float</code> and <code>xs:double</code> operands, floating point division is performed as specified in <a href="#ieee754-2019">[IEEE 754-2019]</a>. A positive number divided by positive zero returns <code>INF</code>. A negative number divided by positive zero returns <code>-INF</code>. Division by negative zero returns <code>-INF</code> and <code>INF</code>, respectively. Positive or negative zero divided by positive or negative zero returns <code>NaN</code>. Also, <code>INF</code> or <code>-INF</code> divided by <code>INF</code> or <code>-INF</code> returns <code>NaN</code>.</p></div></dd></dl></div><div class="div3"><h4><a id="func-numeric-integer-divide"></a>4.2.5 <a href="#func-numeric-integer-divide" style="text-decoration: none">op:numeric-integer-divide</a></h4><dl><dt class="label">Summary</dt><dd><p>Performs an integer division.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>idiv</code> operator when applied to two numeric values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:numeric-integer-divide</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p><p>If <code>$arg2</code> is <code>INF</code> or <code>-INF</code>, and <code>$arg1</code> is not <code>INF</code> or <code>-INF</code>, then the result is zero.</p><p>Otherwise, subject to limits of precision and overflow/underflow conditions, the result is the largest (furthest from zero) <code>xs:integer</code> value <code>$N</code> such that the following expression is <code>true</code>:</p><div class="exampleInner"><pre xml:space="preserve">abs($N * $arg2) le abs($arg1) and
compare($N * $arg2, 0) eq compare($arg1, 0).</pre></div><div class="note"><p class="prefix"><b>Note:</b></p><p>The second term in this condition ensures that the result has the correct sign.</p></div><p>The implementation may adopt a different algorithm provided that it is equivalent to this formulation in all cases where <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> or <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> behavior does not affect the outcome, for example, the implementation-defined precision of the result of <code>xs:decimal</code> division.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOAR0001" title="err:FOAR0001">err:FOAR0001</a>] if the divisor is (positive or negative) zero.</p><p>A dynamic error is raised [<a href="#ERRFOAR0002" title="err:FOAR0002">err:FOAR0002</a>] if either operand is <code>NaN</code> or if <code>$arg1</code> is <code>INF</code> or <code>-INF</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Except in situations involving errors, loss of precision, or overflow/underflow, the result of <code>$a idiv $b</code> is the same as <code>($a div $b) cast as xs:integer</code>.</p><p>The semantics of this function are different from integer division as defined in programming languages such as Java and C++.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-integer-divide(10, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-integer-divide(3, -2)</code></pre></div></td><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-integer-divide(-3, 2)</code></pre></div></td><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-integer-divide(-3, -2)</code></pre></div></td><td style="vertical-align:top"><p><code>1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-integer-divide(9.0, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-integer-divide(-3.5, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-integer-divide(3.0, 4)</code></pre></div></td><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-integer-divide(3.1E1, 6)</code></pre></div></td><td style="vertical-align:top"><p><code>5</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-integer-divide(3.1E1, 7)</code></pre></div></td><td style="vertical-align:top"><p><code>4</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-numeric-mod"></a>4.2.6 <a href="#func-numeric-mod" style="text-decoration: none">op:numeric-mod</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the remainder resulting from dividing <code>$arg1</code>, the dividend, by <code>$arg2</code>, the divisor. </p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>mod</code> operator when applied to two numeric values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:numeric-mod</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p><p>The operation <code>a mod b</code> for operands that are <code>xs:integer</code> or <code>xs:decimal</code>, or types derived from them, produces a result such that <code>(a idiv b) * b + (a mod b)</code> is equal to <code>a</code> and the magnitude of the result is always less than the magnitude of <code>b</code>. This identity holds even in the special case that the dividend is the negative integer of largest possible magnitude for its type and the divisor is -1 (the remainder is 0). It follows from this rule that the sign of the result is the sign of the dividend.</p><p> For <code>xs:float</code> and <code>xs:double</code> operands the following rules apply:</p><ul><li><p>If either operand is <code>NaN</code>, the result is <code>NaN</code>.</p></li><li><p>If the dividend is positive or negative infinity, or the divisor is positive or negative zero (0), or both, the result is <code>NaN</code>.</p></li><li><p>If the dividend is finite and the divisor is an infinity, the result equals the dividend.</p></li><li><p>If the dividend is positive or negative zero and the divisor is finite, the result is the same as the dividend.</p></li><li><p>In the remaining cases, where neither positive or negative infinity, nor positive or negative zero, nor <code>NaN</code> is involved, the result obeys <code>(a idiv b)*b+(a mod b)</code> = <code>a</code>. Division is truncating division, analogous to integer division, not <a href="#ieee754-2019">[IEEE 754-2019]</a> rounding division i.e. additional digits are truncated, not rounded to the required precision.</p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOAR0001" title="err:FOAR0001">err:FOAR0001</a>] for <code>xs:integer</code> and <code>xs:decimal</code> operands, if <code>$arg2</code> is zero.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-mod(10, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-mod(6, -2)</code></pre></div></td><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-mod(4.5, 1.2)</code></pre></div></td><td style="vertical-align:top"><p><code>0.9</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>op:numeric-mod(1.23E2, 0.6E1)</code></pre></div></td><td style="vertical-align:top"><p><code>3.0E0</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-numeric-unary-plus"></a>4.2.7 <a href="#func-numeric-unary-plus" style="text-decoration: none">op:numeric-unary-plus</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns its operand with the sign unchanged: (<code>+ $arg</code>).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the unary <code>+</code> operator applied to a numeric value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:numeric-unary-plus</code>(</td></tr><tr class="arg"><td><code>$arg</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p><p>The returned value is equal to <code>$arg</code>, and is an instance of <code>xs:integer</code>, <code>xs:decimal</code>, <code>xs:double</code>, or <code>xs:float</code> depending on the type of <code>$arg</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Because coercion rules are applied in the normal way, the unary <code>+</code> operator can be used to force conversion of an untyped node to a number: the result of <code>+@price</code> is the same as <code>xs:double(@price)</code> if the type of <code>@price</code> is <code>xs:untypedAtomic</code>.</p></div></dd></dl></div><div class="div3"><h4><a id="func-numeric-unary-minus"></a>4.2.8 <a href="#func-numeric-unary-minus" style="text-decoration: none">op:numeric-unary-minus</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns its operand with the sign reversed: <code>-$arg</code>.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the unary <code>-</code> operator when applied to a numeric value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:numeric-unary-minus</code>(</td></tr><tr class="arg"><td><code>$arg</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p><p>The returned value is an instance of <code>xs:integer</code>, <code>xs:decimal</code>, <code>xs:double</code>, or <code>xs:float</code> depending on the type of <code>$arg</code>.</p><p>For <code>xs:integer</code> and <code>xs:decimal</code> arguments, <code>0</code> and <code>0.0</code> return <code>0</code> and <code>0.0</code>, respectively. For <code>xs:float</code> and <code>xs:double</code> arguments, <code>NaN</code> returns <code>NaN</code>, <code>0.0E0</code> returns <code>-0.0E0</code> and vice versa. <code>INF</code> returns <code>-INF</code>. <code>-INF</code> returns <code>INF</code>.</p></dd></dl></div></div><div class="div2"><h3><a id="comp.numeric"></a>4.3 <a href="#comp.numeric" style="text-decoration: none">Comparing numeric values</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-divide-decimals">next</a> | <a href="#func-while-do">previous</a>)</p><ol><li><p>Deleted an inaccurate statement concerning the behavior of NaN.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/473">473</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/482">482</a>]</i></p></li><li><p>Comparison of mixed numeric types (for example <code>xs:double</code> and <code>xs:decimal</code>) now generally converts both values to <code>xs:decimal</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/986">986</a>&nbsp;]</i></p></li></ol></div><p>Numeric values can be compared using the function <a href="#func-compare"><code>fn:compare</code></a>.</p><p>This function underpins the six value comparison operators <code>eq</code>, <code>ne</code>, <code>lt</code>, <code>le</code>, <code>gt</code>, and <code>ge</code> and the six general comparison operators <code>=</code>, <code>!=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, and <code>&gt;=</code>, which are all defined in terms of the <a href="#func-compare"><code>fn:compare</code></a> function.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>For a description of the different ways of comparing numeric values using the operators <code>=</code> and <code>eq</code> and functions such as <a href="#func-deep-equal"><code>fn:deep-equal</code></a>, <a href="#func-compare"><code>fn:compare</code></a>, and <a href="#func-atomic-equal"><code>fn:atomic-equal</code></a>, see <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-atomic-comparisons">G Atomic Comparisons: An Overview (Non-Normative)</a>.</p></div></div><div class="div2"><h3><a id="numeric-value-functions"></a>4.4 <a href="#numeric-value-functions" style="text-decoration: none">Functions on numeric values</a></h3><p>The following functions are defined on numeric types. Each function returns a value of the same type as the type of its argument.</p><ul><li><p>If the argument is the empty sequence, the empty sequence is returned.</p></li><li><p>For <code>xs:float</code> and <code>xs:double</code> arguments, if the argument is <code>NaN</code>, <code>NaN</code> is returned.</p></li><li><p>With the exception of <a href="#func-abs"><code>fn:abs</code></a>, functions with arguments of type <code>xs:float</code> and <code>xs:double</code> that are positive or negative infinity return positive or negative infinity.</p></li></ul><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-abs"><code>fn:abs</code></a></td><td>Returns the absolute value of <code>$value</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-ceiling"><code>fn:ceiling</code></a></td><td>Rounds <code>$value</code> upwards to a whole number.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-divide-decimals"><code>fn:divide-decimals</code></a></td><td>Divides one <code>xs:decimal</code> by another to a defined precision, returning both the quotient and the remainder.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-floor"><code>fn:floor</code></a></td><td>Rounds <code>$value</code> downwards to a whole number.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-is-NaN"><code>fn:is-NaN</code></a></td><td>Returns <code>true</code> if the argument is the <code>xs:float</code> or <code>xs:double</code> value <code>NaN</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-round"><code>fn:round</code></a></td><td>Rounds a value to a specified number of decimal places, with control over how the rounding takes place.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-round-half-to-even"><code>fn:round-half-to-even</code></a></td><td>Rounds a value to a specified number of decimal places, rounding to make the last digit even if two such values are equally near.</td></tr></tbody></table><div class="note"><p class="prefix"><b>Note:</b></p><p>The <a href="#func-round"><code>fn:round</code></a> function has been extended with a third argument in version 4.0 of this specification; this means that the <a href="#func-ceiling"><code>fn:ceiling</code></a>, <a href="#func-floor"><code>fn:floor</code></a>, and <a href="#func-round-half-to-even"><code>fn:round-half-to-even</code></a> functions are now technically redundant. They are retained, however, both for backwards compatibility and for convenience.</p></div><div class="div3"><h4><a id="func-abs"></a>4.4.1 <a href="#func-abs" style="text-decoration: none">fn:abs</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the absolute value of <code>$value</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:abs</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#numeric-value-functions"><b>4.4 Functions on numeric values</b></a>.</p><p>If <code>$value</code> is negative the function returns <code>-$value</code>, otherwise it returns <code>$value</code>.</p><p>For the four types <code>xs:float</code>, <code>xs:double</code>, <code>xs:decimal</code> and <code>xs:integer</code>, it is guaranteed that if the type of <code>$value</code> is an instance of type <var>T</var> then the result will also be an instance of <var>T</var>. The result <span class="verb">may</span> also be an instance of a type derived from one of these four by restriction. For example, if <code>$value</code> is an instance of <code>xs:positiveInteger</code> then the value of <code>$value</code><span class="verb">may</span> be returned unchanged.</p><p>For <code>xs:float</code> and <code>xs:double</code> arguments, if the argument is positive zero or negative zero, then positive zero is returned. If the argument is positive or negative infinity, positive infinity is returned.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>abs(10.5)</code></pre></div></td><td style="vertical-align:top"><p><code>10.5</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>abs(-10.5)</code></pre></div></td><td style="vertical-align:top"><p><code>10.5</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>abs(-math:log(0))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-ceiling"></a>4.4.2 <a href="#func-ceiling" style="text-decoration: none">fn:ceiling</a></h4><dl><dt class="label">Summary</dt><dd><p>Rounds <code>$value</code> upwards to a whole number.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:ceiling</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#numeric-value-functions"><b>4.4 Functions on numeric values</b></a>.</p><p>The function returns the smallest (closest to negative infinity) number with no fractional part that is not less than <code>$value</code>.</p><p>For the four types <code>xs:float</code>, <code>xs:double</code>, <code>xs:decimal</code> and <code>xs:integer</code>, it is guaranteed that if the type of <code>$value</code> is an instance of type <var>T</var> then the result will also be an instance of <var>T</var>. The result <span class="verb">may</span> also be an instance of a type derived from one of these four by restriction. For example, if <code>$value</code> is an instance of <code>xs:decimal</code> then the result <span class="verb">may</span> be an instance of <code>xs:integer</code>.</p><p>For <code>xs:float</code> and <code>xs:double</code> arguments, if the argument is positive zero, then positive zero is returned. If the argument is negative zero, then negative zero is returned. If the argument is less than zero and greater than -1, negative zero is returned. If the argument is positive or negative infinity, the value of the argument is returned.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>ceiling(10.5)</code></pre></div></td><td style="vertical-align:top"><p><code>11</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>ceiling(-10.5)</code></pre></div></td><td style="vertical-align:top"><p><code>-10</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>ceiling(math:log(0))</code></pre></div></td><td style="vertical-align:top"><p><code>-xs:double('INF')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-divide-decimals"></a>4.4.3 <a href="#func-divide-decimals" style="text-decoration: none">fn:divide-decimals</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-is-NaN">next</a> | <a href="#comp.numeric">previous</a>)</p><ol><li><p>New in 4.0.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1261">1261</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1671">1671</a>&nbsp;1 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Divides one <code>xs:decimal</code> by another to a defined precision, returning both the quotient and the remainder.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:divide-decimals</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:decimal</code></code>,</td><td></td></tr><tr class="arg"><td><code>$divisor</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:decimal</code></code>,</td><td></td></tr><tr class="arg"><td><code>$precision</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>0</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>record(quotient as xs:decimal, remainder as xs:decimal)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a record with two fields:</p><ol class="enumar"><li><p><code>quotient</code> is the <code>xs:decimal</code> value furthest from zero such that:</p><ol class="enumla"><li><p><code>quotient</code> is an exact multiple of ten to the power of minus <code>$precision</code>;</p></li><li><p>the absolute value of <code>quotient</code> multipled by <code>$divisor</code> is less than or equal to the absolute value of <code>$value</code>;</p></li><li><p>the sign of <code>quotient</code> is the same as the sign of <code>op:numeric-divide($value, $divisor)</code>.</p></li></ol></li><li><p><code>remainder</code> is the exact result of subtracting <code>quotient</code> multiplied by <code>$divisor</code> from <code>$value</code>.</p></li></ol><p>There may be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on the precision available. If the requested <code>$precision</code> is outside this range, it should be adjusted to the nearest value supported by the implementation.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOAR0001" title="err:FOAR0001">err:FOAR0001</a>] if <code>$divisor</code> is zero.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>divide-decimals(120.6, 60.3, 4)</code></pre></div></td><td style="vertical-align:top"><p><code>{ "quotient": 2, "remainder": 0 }</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>divide-decimals(10, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>{ "quotient": 3, "remainder": 1 }</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>divide-decimals(10, -3)</code></pre></div></td><td style="vertical-align:top"><p><code>{ "quotient": -3, "remainder": 1 }</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>divide-decimals(-10, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>{ "quotient": -3, "remainder": -1 }</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>divide-decimals(-10, -3)</code></pre></div></td><td style="vertical-align:top"><p><code>{ "quotient": 3, "remainder": -1 }</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>divide-decimals(10, 3, 6)</code></pre></div></td><td style="vertical-align:top"><p><code>{ "quotient": 3.333333, "remainder": 0.000001 }</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>divide-decimals(100, 30)</code></pre></div></td><td style="vertical-align:top"><p><code>{ "quotient": 3, "remainder": 10 }</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>divide-decimals(150_862, 7, -3)</code></pre></div></td><td style="vertical-align:top"><p><code>{ "quotient": 21_000, "remainder": 3_862 }</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-floor"></a>4.4.4 <a href="#func-floor" style="text-decoration: none">fn:floor</a></h4><dl><dt class="label">Summary</dt><dd><p>Rounds <code>$value</code> downwards to a whole number.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:floor</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#numeric-value-functions"><b>4.4 Functions on numeric values</b></a>.</p><p>The function returns the largest (closest to positive infinity) number with no fractional part that is not greater than <code>$value</code>.</p><p>For the four types <code>xs:float</code>, <code>xs:double</code>, <code>xs:decimal</code> and <code>xs:integer</code>, it is guaranteed that if the type of <code>$value</code> is an instance of type <var>T</var> then the result will also be an instance of <var>T</var>. The result <span class="verb">may</span> also be an instance of a type derived from one of these four by restriction. For example, if <code>$value</code> is an instance of <code>xs:decimal</code> then the result <span class="verb">may</span> be an instance of <code>xs:integer</code>.</p><p>For <code>xs:float</code> and <code>xs:double</code> arguments, if the argument is positive zero, then positive zero is returned. If the argument is negative zero, then negative zero is returned. If the argument is positive or negative infinity, the value of the argument is returned.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>floor(10.5)</code></pre></div></td><td style="vertical-align:top"><p><code>10</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>floor(-10.5)</code></pre></div></td><td style="vertical-align:top"><p><code>-11</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(0) =&gt; floor()</code></pre></div></td><td style="vertical-align:top"><p><code>-xs:double('INF')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-is-NaN"></a>4.4.5 <a href="#func-is-NaN" style="text-decoration: none">fn:is-NaN</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-round">next</a> | <a href="#func-divide-decimals">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[&nbsp;&nbsp;20 September 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the argument is the <code>xs:float</code> or <code>xs:double</code> value <code>NaN</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:is-NaN</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns <code>true</code> if the argument is the <code>xs:float</code> or <code>xs:double</code> value <code>NaN</code>; otherwise it returns <code>false</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>is-NaN(23)</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>is-NaN("NaN")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>is-NaN(number("twenty-three"))</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>is-NaN(math:sqrt(-1))</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-round"></a>4.4.6 <a href="#func-round" style="text-decoration: none">fn:round</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-round-half-to-even">next</a> | <a href="#func-is-NaN">previous</a>)</p><ol><li><p>A third argument has been added, providing control over the rounding mode.<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/1187">1187</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1274">1274</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1260">1260</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1275">1275</a>&nbsp;11 June 2024]</i></p></li><li><p>It is explicitly stated that the limits for <code>$precision</code> are implementation-defined.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1705">1705</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1711">1711</a>&nbsp;1 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Rounds a value to a specified number of decimal places, with control over how the rounding takes place.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:round</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$precision</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>0</code>,</td></tr><tr class="arg"><td><code>$mode</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>enum('floor', 'ceiling', 'toward-zero', 'away-from-zero', 'half-to-floor', 'half-to-ceiling', 'half-toward-zero', 'half-away-from-zero', 'half-to-even')?</code></code></td><td><code class="assign">:=&nbsp;</code><code>'half-to-ceiling'</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#numeric-value-functions"><b>4.4 Functions on numeric values</b></a>.</p><p>The function returns a value that is close to <code>$value</code> and that is a multiple of ten to the power of minus <code>$precision</code>. The default value of <code>$precision</code> is zero, in which case the function returns a whole number (but not necessarily an <code>xs:integer</code>).</p><p>The detailed way in which rounding is performed depends on the value of <code>$mode</code>, as follows. Here <var>L</var> means the highest multiple of ten to the power of minus <code>$precision</code> that is less than or equal to <code>$value</code>, <var>U</var> means the lowest multiple of ten to the power of minus <code>$precision</code> that is greater than or equal to <code>$value</code>, <var>N</var> means the multiple of ten to the power of minus <code>$precision</code> that is numerically closest to <code>$value</code>, and <b>midway</b> means that <code>$value</code> is equal to the arithmetic mean of <var>L</var> and <var>U</var>.</p><table class="no-code-break data"><caption>Rounding Modes</caption><thead><tr><th>Rounding Mode</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>'floor'</code></p></td><td><p>Returns <var>L</var>.</p></td></tr><tr><td><p><code>'ceiling'</code></p></td><td><p>Returns <var>U</var>.</p></td></tr><tr><td><p><code>'toward-zero'</code></p></td><td><p>Returns <var>L</var> if <code>$value</code> is positive, otherwise <var>U</var>.</p></td></tr><tr><td><p><code>'away-from-zero'</code></p></td><td><p>Returns <var>U</var> if <code>$value</code> is positive, otherwise <var>L</var></p></td></tr><tr><td><p><code>'half-to-floor'</code></p></td><td><p>Returns <var>N</var>, unless midway, in which case <var>L</var>.</p></td></tr><tr><td><p><code>'half-to-ceiling'</code></p></td><td><p>Returns <var>N</var>, unless midway, in which case <var>U</var>. This is the default.</p></td></tr><tr><td><p><code>'half-toward-zero'</code></p></td><td><p>Returns <var>N</var>, unless midway, in which case it returns <var>L</var> if <code>$value</code> is positive, otherwise <var>U</var>.</p></td></tr><tr><td><p><code>'half-away-from-zero'</code></p></td><td><p>Returns <var>N</var>, unless midway, in which case it returns <var>U</var> if <code>$value</code> is positive, otherwise <var>L</var>.</p></td></tr><tr><td><p><code>'half-to-even'</code></p></td><td><p>Returns <var>N</var>, unless midway, in which case it returns whichever of <var>L</var> and <var>U</var> has a last significant digit that is even.</p></td></tr></tbody></table><p>For the four types <code>xs:float</code>, <code>xs:double</code>, <code>xs:decimal</code> and <code>xs:integer</code>, it is guaranteed that if the type of <code>$value</code> is an instance of type <var>T</var> then the result will also be an instance of <var>T</var>. The result <span class="verb">may</span> also be an instance of a type derived from one of these four by restriction. For example, if <code>$value</code> is an instance of <code>xs:decimal</code> and <code>$precision</code> is less than one, then the result <span class="verb">may</span> be an instance of <code>xs:integer</code>.</p><p>If the second argument is omitted or is the empty sequence, the function produces the same result as when <code>$precision = 0</code> (that is, it rounds to a whole number).</p><p>When <code>$value</code> is of type <code>xs:float</code> and <code>xs:double</code>:</p><ol class="enumar"><li><p>If <code>$value</code> is <code>NaN</code>, positive or negative zero, or positive or negative infinity, then the result is the same as the argument.</p></li><li><p>For other values, the argument is cast to <code>xs:decimal</code> using an implementation of <code>xs:decimal</code> that imposes no limits on the number of digits that can be represented. The function is applied to this <code>xs:decimal</code> value, and the resulting <code>xs:decimal</code> is cast back to <code>xs:float</code> or <code>xs:double</code> as appropriate to form the function result. If the resulting <code>xs:decimal</code> value is zero, then positive or negative zero is returned according to the sign of <code>$value</code>.</p></li></ol><p>There may be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on the precision available. If the requested <code>$precision</code> is outside this range, it should be adjusted to the nearest value supported by the implementation.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function is typically used with a non-zero <code>$precision</code> in financial applications where the argument is of type <code>xs:decimal</code>. For arguments of type <code>xs:float</code> and <code>xs:double</code> the results may be counter-intuitive. For example, consider <code>round(35.425e0, 2)</code>. The result is not <code>35.43</code>, as might be expected, but <code>35.42</code>. This is because the <code>xs:double</code> written as <code>35.425e0</code> has an exact value equal to <code>35.42499999999...</code>, which is closer to <code>35.42</code> than to <code>35.43</code>.</p><p>The call <code>round($v, 0, "floor")</code> is equivalent to <code>floor($v)</code>.</p><p>The call <code>round($v, 0, "ceiling")</code> is equivalent to <code>ceiling($v)</code>.</p><p>The call <code>round($v, $p, "half-to-even")</code> is equivalent to <code>round-half-to-even($v, $p)</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(2.5)</code></pre></div></td><td style="vertical-align:top"><p><code>3.0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(2.4999)</code></pre></div></td><td style="vertical-align:top"><p><code>2.0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-2.5)</code></pre></div></td><td style="vertical-align:top"><p><code>-2.0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.125, 2)</code></pre></div></td><td style="vertical-align:top"><p><code>1.13</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(8452, -2)</code></pre></div></td><td style="vertical-align:top"><p><code>8500</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(3.1415e0, 2)</code></pre></div></td><td style="vertical-align:top"><p><code>3.14e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(0) =&gt; round()</code></pre></div></td><td style="vertical-align:top"><p><code>-xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.7, 0, "floor")</code></pre></div></td><td style="vertical-align:top"><p><code>1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-1.7, 0, "floor")</code></pre></div></td><td style="vertical-align:top"><p><code>-2</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.7, 0, "ceiling")</code></pre></div></td><td style="vertical-align:top"><p><code>2</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-1.7, 0, "ceiling")</code></pre></div></td><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.7, 0, "toward-zero")</code></pre></div></td><td style="vertical-align:top"><p><code>1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-1.7, 0, "toward-zero")</code></pre></div></td><td style="vertical-align:top"><p><code>-1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.7, 0, "away-from-zero")</code></pre></div></td><td style="vertical-align:top"><p><code>2</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-1.7, 0, "away-from-zero")</code></pre></div></td><td style="vertical-align:top"><p><code>-2</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.125, 2, "half-to-floor")</code></pre></div></td><td style="vertical-align:top"><p><code>1.12</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-1.125, 2, "half-to-floor")</code></pre></div></td><td style="vertical-align:top"><p><code>-1.13</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.125, 2, "half-to-ceiling")</code></pre></div></td><td style="vertical-align:top"><p><code>1.13</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-1.125, 2, "half-to-ceiling")</code></pre></div></td><td style="vertical-align:top"><p><code>-1.12</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.125, 2, "half-toward-zero")</code></pre></div></td><td style="vertical-align:top"><p><code>1.12</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-1.125, 2, "half-toward-zero")</code></pre></div></td><td style="vertical-align:top"><p><code>-1.12</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.125, 2, "half-away-from-zero")</code></pre></div></td><td style="vertical-align:top"><p><code>1.13</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-1.125, 2, "half-away-from-zero")</code></pre></div></td><td style="vertical-align:top"><p><code>-1.13</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(1.125, 2, "half-to-even")</code></pre></div></td><td style="vertical-align:top"><p><code>1.12</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round(-1.125, 2, "half-to-even")</code></pre></div></td><td style="vertical-align:top"><p><code>-1.12</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-round-half-to-even"></a>4.4.7 <a href="#func-round-half-to-even" style="text-decoration: none">fn:round-half-to-even</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-parse-integer">next</a> | <a href="#func-round">previous</a>)</p><ol><li><p>It is explicitly stated that the limits for <code>$precision</code> are implementation-defined.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1705">1705</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1711">1711</a>&nbsp;1 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Rounds a value to a specified number of decimal places, rounding to make the last digit even if two such values are equally near.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:round-half-to-even</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$precision</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>0</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>General rules: see <a href="#numeric-value-functions"><b>4.4 Functions on numeric values</b></a>.</p><p>The function returns the nearest (that is, numerically closest) value to <code>$value</code> that is a multiple of ten to the power of minus <code>$precision</code>. If two such values are equally near (e.g. if the fractional part in <code>$value</code> is exactly .500...), the function returns the one whose least significant digit is even.</p><p>For the four types <code>xs:float</code>, <code>xs:double</code>, <code>xs:decimal</code> and <code>xs:integer</code>, it is guaranteed that if the type of <code>$value</code> is an instance of type <var>T</var> then the result will also be an instance of <var>T</var>. The result <span class="verb">may</span> also be an instance of a type derived from one of these four by restriction. For example, if <code>$value</code> is an instance of <code>xs:decimal</code> and <code>$precision</code> is less than one, then the result <span class="verb">may</span> be an instance of <code>xs:integer</code>.</p><p> If the second argument is omitted or the empty sequence, the function produces the same result as the two-argument version with <code>$precision = 0</code>.</p><p>For arguments of type <code>xs:float</code> and <code>xs:double</code>:</p><ol class="enumar"><li><p>If the argument is <code>NaN</code>, positive or negative zero, or positive or negative infinity, then the result is the same as the argument.</p></li><li><p>In all other cases, the argument is cast to <code>xs:decimal</code> using an implementation of <code>xs:decimal</code> that imposes no limits on the number of digits that can be represented. The function is applied to this <code>xs:decimal</code> value, and the resulting <code>xs:decimal</code> is cast back to <code>xs:float</code> or <code>xs:double</code> as appropriate to form the function result. If the resulting <code>xs:decimal</code> value is zero, then positive or negative zero is returned according to the sign of the original argument.</p></li></ol><p>There may be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on the precision available. If the requested <code>$precision</code> is outside this range, it should be adjusted to the nearest value supported by the implementation.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function is typically used in financial applications where the argument is of type <code>xs:decimal</code>. For arguments of type <code>xs:float</code> and <code>xs:double</code> the results may be counter-intuitive. For example, consider <code>round-half-to-even(xs:float(150.015), 2)</code>. The result is not <code>150.02</code> as might be expected, but <code>150.01</code>. This is because the conversion of the <code>xs:float</code> value represented by the literal <code>150.015</code> to an <code>xs:decimal</code> produces the <code>xs:decimal</code> value <code>150.014999389...</code>, which is closer to <code>150.01</code> than to <code>150.02</code>.</p><p>From 4.0, the effect of this function can also be achieved by calling <a href="#func-round"><code>fn:round</code></a> with the third argument set to <code>"half-to-even"</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round-half-to-even(0.5)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round-half-to-even(1.5)</code></pre></div></td><td style="vertical-align:top"><p><code>2.0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round-half-to-even(2.5)</code></pre></div></td><td style="vertical-align:top"><p><code>2.0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round-half-to-even(3.567812e+3, 2)</code></pre></div></td><td style="vertical-align:top"><p><code>3567.81e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round-half-to-even(4.7564e-3, 2)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>round-half-to-even(35612.25, -2)</code></pre></div></td><td style="vertical-align:top"><p><code>35600</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(0) =&gt; round-half-to-even()</code></pre></div></td><td style="vertical-align:top"><p><code>-xs:double('INF')</code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="parsing-numbers"></a>4.5 <a href="#parsing-numbers" style="text-decoration: none">Parsing numbers</a></h3><p><span style="display: none;" class="delete_version">It is possible to convert strings to values of type <code>xs:integer</code>, <code>xs:float</code>, <code>xs:decimal</code>, or <code>xs:double</code> using the constructor functions described in <a href="#constructor-functions"><span class="delete_version"><b>22 Constructor functions</b></span><span class="modify_version"><b>22 Constructor functions</b></span></a> or using <code>cast</code> expressions as described in <a href="#casting"><span class="delete_version"><b>23 Casting</b></span><span class="modify_version"><b>23 Casting</b></span></a>.</span><span style="display: none;" class="add_version">It is possible to convert strings to values of type <code>xs:integer</code>, <code>xs:float</code>, <code>xs:decimal</code>, or <code>xs:double</code> using the constructor functions described in <a href="#constructor-functions"><span class="add_version"><b>23 Constructor functions</b></span><span class="modify_version"><b>23 Constructor functions</b></span></a> or using <code>cast</code> expressions as described in <a href="#casting"><span class="add_version"><b>24 Casting</b></span><span class="modify_version"><b>24 Casting</b></span></a>.</span><span class="modify_version">It is possible to convert strings to values of type <code>xs:integer</code>, <code>xs:float</code>, <code>xs:decimal</code>, or <code>xs:double</code> using the constructor functions described in <a href="#constructor-functions"><span style="display: none;" class="delete_version"><b>22 Constructor functions</b></span><span style="display: none;" class="add_version"><b>23 Constructor functions</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22</span><span class="deltaxml-new" style="background:#90EE90">23</span> Constructor functions</b></span></a> or using <code>cast</code> expressions as described in <a href="#casting"><span style="display: none;" class="delete_version"><b>23 Casting</b></span><span style="display: none;" class="add_version"><b>24 Casting</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23</span><span class="deltaxml-new" style="background:#90EE90">24</span> Casting</b></span></a>.</span></p><p>In addition the <a href="#func-number"><code>fn:number</code></a> function is available to convert strings to values of type <code>xs:double</code>. It differs from the <code>xs:double</code> constructor function in that any value outside the lexical space of the <code>xs:double</code> datatype is converted to the <code>xs:double</code> value <code>NaN</code>.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-number"><code>fn:number</code></a></td><td>Returns the value indicated by <code>$value</code> or, if <code>$value</code> is not specified, the context value after atomization, converted to an <code>xs:double</code>. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parse-integer"><code>fn:parse-integer</code></a></td><td>Converts a string to an integer, recognizing any radix in the range 2 to 36.</td></tr></tbody></table><div class="div3"><h4><a id="func-number"></a>4.5.1 <a href="#func-number" style="text-decoration: none">fn:number</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the value indicated by <code>$value</code> or, if <code>$value</code> is not specified, the context value after atomization, converted to an <code>xs:double</code>. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:number</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Calling the zero-argument version of the function is defined to give the same result as calling the single-argument version with the context value (<code>.</code>). That is, <code>fn:number()</code> is equivalent to <code>fn:number(.)</code>, as defined by the rules that follow.</p><p>If <code>$value</code> is the empty sequence or if <code>$value</code> cannot be converted to an <code>xs:double</code>, the <code>xs:double</code> value <code>NaN</code> is returned. </p><p><span style="display: none;" class="delete_version">Otherwise, <code>$value</code> is converted to an <code>xs:double</code> following the rules of <a href="#casting-to-double"><span class="delete_version"><b>23.1.3.2 Casting to xs:double</b></span><span class="modify_version"><b>23.1.3.2 Casting to xs:double</b></span></a>. If the conversion to <code>xs:double</code> fails, the <code>xs:double</code> value <code>NaN</code> is returned.</span><span style="display: none;" class="add_version">Otherwise, <code>$value</code> is converted to an <code>xs:double</code> following the rules of <a href="#casting-to-double"><span class="add_version"><b>24.1.3.2 Casting to xs:double</b></span><span class="modify_version"><b>24.1.3.2 Casting to xs:double</b></span></a>. If the conversion to <code>xs:double</code> fails, the <code>xs:double</code> value <code>NaN</code> is returned.</span><span class="modify_version">Otherwise, <code>$value</code> is converted to an <code>xs:double</code> following the rules of <a href="#casting-to-double"><span style="display: none;" class="delete_version"><b>23.1.3.2 Casting to xs:double</b></span><span style="display: none;" class="add_version"><b>24.1.3.2 Casting to xs:double</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.3.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.3.2</span> Casting to xs:double</b></span></a>. If the conversion to <code>xs:double</code> fails, the <code>xs:double</code> value <code>NaN</code> is returned.</span></p></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup> if <code>$value</code> is omitted and the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>.</p><p>As a consequence of the rules given above, a type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> if the context value cannot be atomized, or if the result of atomizing the context value is a sequence containing more than one atomic item.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>XSD 1.1 allows the string <code>+INF</code> as a representation of positive infinity; XSD 1.0 does not. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether XSD 1.1 is supported.</p><p>Generally <a href="#func-number"><code>fn:number</code></a> returns <code>NaN</code> rather than raising a dynamic error if the argument cannot be converted to <code>xs:double</code>. However, a type error is raised in the usual way if the supplied argument cannot be atomized or if the result of atomization does not match the required argument type.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $e := &lt;e price="12.1" discount="NONE"/&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>number(12)</code></pre></div></td><td style="vertical-align:top"><p><code>1.2e1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>number('12')</code></pre></div></td><td style="vertical-align:top"><p><code>1.2e1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>number('INF')</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>number('NaN')</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>number('non-numeric')</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>number($e/@price)</code></pre></div></td><td style="vertical-align:top"><p><code>1.21e1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>number($e/@discount)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>number($e/@misspelt)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>("10", "11", "12") ! number()</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e1, 1.1e1, 1.2e1</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-parse-integer"></a>4.5.2 <a href="#func-parse-integer" style="text-decoration: none">fn:parse-integer</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-format-integer">next</a> | <a href="#func-round-half-to-even">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/241">241</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/434">434</a>&nbsp;25 April 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Converts a string to an integer, recognizing any radix in the range 2 to 36.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parse-integer</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$radix</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>10</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the result is the empty sequence.</p><p>The supplied <code>$radix</code> must be in the range 2 to 36 inclusive.</p><p>The string <code>$value</code> is preprocessed by stripping all whitespace characters (including internal whitespace) and underscore characters.</p><p>After this process, the supplied value must consist of an optional sign (<code>+</code> or <code>-</code>) followed by a sequence of one or more generalized digits drawn from the first <code>$radix</code> characters in the alphabet <code>0123456789abcdefghijklmnopqrstuvwxyz</code>; upper-case alphabetics <code>A-Z</code> may be used in place of their lower-case equivalents.</p><p>The value of a generalized digit corresponds to its position in this alphabet.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression, except in error cases.</p><div class="exampleInner"><pre xml:space="preserve" class="small">let $alphabet := characters("0123456789abcdefghijklmnopqrstuvwxyz")
let $preprocessed := translate(
  $value, 
  codepoints-to-string((9, 10, 13, 32, 95)), 
  ""
)
let $digits := translate($preprocessed, "+-", "")
let $abs := sum(
  for $char at $p in reverse(characters(lower-case($digits)))
  return (index-of($alphabet, $char) - 1) * xs:integer(math:pow($radix, $p - 1))
)
return if (starts-with($preprocessed, "-")) then -$abs else +$abs</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORG0011" title="err:FORG0011">err:FORG0011</a>] if <code>$radix</code> is not in the range 2 to 36.</p><p>A dynamic error is raised [<a href="#ERRFORG0012" title="err:FORG0012">err:FORG0012</a>] if, after stripping whitespace and underscores and the optional leading sign, <code>$value</code> is a zero-length string, or if it contains a character that is not among the first <code>$radix</code> characters in the alphabet <code>0123456789abcdefghijklmnopqrstuvwxyz</code>, or the upper-case equivalent of such a character.</p><p>A dynamic error is raised [<a href="#ERRFOCA0003" title="err:FOCA0003">err:FOCA0003</a>] if the value of the resulting integer exceeds the implementation-dependent limit on the size of an <code>xs:integer</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>When <code>$radix</code> takes its default value of <code>10</code>, the function delivers the same result as casting <code>$value</code> (after removal of whitespace and underscores) to <code>xs:integer</code>.</p><p>If underscores or whitespace in the input need to be rejected, then the string should first be validated, perhaps using <a href="#func-matches"><code>fn:matches</code></a>.</p><p>If other characters may legitimately appear in the input, for example a leading <code>0x</code>, then this must first be removed by pre-processing the input.</p><p>If the input uses a different family of digits, then the value should first be converted to the required digits using <a href="#func-translate"><code>fn:translate</code></a>.</p><p>A string in the lexical space of <code>xs:hexBinary</code> will always be an acceptable input, provided it is not too long. So, for example, the expression <code>"1DE=" =&gt; xs:base64Binary() =&gt; xs:hexBinary() =&gt; xs:string() =&gt; parse-integer(16)</code> can be used to convert the Base 64 value <code>1DE=</code> to the integer 54321, via the hexadecimal string <code>D431</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-integer(" 200 ")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>200</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-integer("-20")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-20</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-integer(" +100")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>100</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-integer("ff", 16)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>255</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-integer("FFFF FFFF", 16)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>4294967295</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-integer("-FFFF_FFFF", 16)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>-4294967295</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-integer("377", 8)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>255</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-integer("101", 2)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>5</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-integer("vv", 32)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1023</code></p></td></tr><tr><td colspan="2"><p>Alphabetic base-26 numbering systems (hexavigesimal) can be parsed via translation. Note, enumerating systems that do not assign a symbol to zero (e.g., spreadsheet columns) must be preprocessed in a different fashion.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">lower-case("AAB")
=&gt; translate("abcdefghijklmnopqrstuvwxyz", "0123456789abcdefghijklmnop")
=&gt; parse-integer(26)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div></td></tr><tr><td colspan="2"><p>Digit-based numeration systems comparable to the Arabic numbers 0 through 9 can be parsed via translation.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">translate(value := '٢٠٢٣', replace := '٠١٢٣٤٥٦٧٨٩', with := '0123456789')
=&gt; parse-integer()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2023</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="formatting-integers"></a>4.6 <a href="#formatting-integers" style="text-decoration: none">Formatting integers</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-format-integer"><code>fn:format-integer</code></a></td><td>Formats an integer according to a given picture string, using the conventions of a given natural language if specified.</td></tr></tbody></table><div class="div3"><h4><a id="func-format-integer"></a>4.6.1 <a href="#func-format-integer" style="text-decoration: none">fn:format-integer</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-format-number">next</a> | <a href="#func-parse-integer">previous</a>)</p><ol><li><p>The function has been extended to allow output in a radix other than 10, for example in hexadecimal.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/241">241</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/434">434</a>&nbsp;7 April 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Formats an integer according to a given picture string, using the conventions of a given natural language if specified.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:format-integer</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$picture</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$language</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on default language. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns a zero-length string.</p><p>In all other cases, the <code>$picture</code> argument describes the format in which <code>$value</code> is output.</p><p>The rules that follow describe how non-negative numbers are output. If the value of <code>$value</code> is negative, the rules below are applied to the absolute value of <code>$value</code>, and a minus sign is prepended to the result.</p><p>The value of <code>$picture</code> consists of the following, in order:</p><ol class="enumar"><li><p>An optional radix, which is an integer in the range 2 to 36, written using ASCII digits (<code>0-9</code>) without any leading zero;</p></li><li><p>A circumflex (<code>^</code>), which is present if the radix is present, and absent otherwise.</p><p>A circumflex is recognized as marking the presence of a radix only if (a) it is immediately preceded by an integer in the range 2 to 36, and (b) it is followed (somewhere within the primary format token) by an <code>"X"</code> or <code>"x"</code>. In other cases, the circumflex is treated as a grouping separator. For example, the picture <code>9^000</code> outputs the number 2345 as <code>"2^345"</code>, whereas <code>9^XXX</code> outputs <code>"3185"</code>. This rule is to ensure backwards compatibility.</p></li><li><p>A primary format token. This is always present and <span class="verb">must not</span> be zero-length.</p></li><li><p>An optional format modifier.</p><p>If the string contains one or more semicolons then the last semicolon is taken as terminating the primary format token, and everything that follows is taken as the format modifier; if the string contains no semicolon then the format modifier is taken to be absent (which is equivalent to supplying a zero-length string).</p></li></ol><p>If a radix is present, then the primary format token must follow the rules for a <var>digit-pattern</var>.</p><p>The primary format token is classified as one of the following:</p><ol class="enumar"><li><p>A <var>digit-pattern</var> made up of <var>optional-digit-signs</var>, <var>mandatory-digit-signs</var>, and <var>grouping-separator-signs</var>.</p><ul><li><p>The <var>optional-digit-sign</var> is the character <code>#</code>.</p></li><li><p><span>If the radix is absent, then</span> a <var>mandatory-digit-sign</var> is a <a title="character" class="termref" href="#character">character</a> in Unicode category <var>Nd</var>. All <var>mandatory-digit-signs</var> within the format token <span class="verb">must</span> be from the same digit family, where a digit family is a sequence of ten consecutive characters in Unicode category <var>Nd</var>, having digit values <code>0</code> through <code>9</code>. Within the format token, these digits are interchangeable: a three-digit number may thus be indicated equivalently by <code>000</code>, <code>001</code>, or <code>999</code>.</p><p>If the primary format token contains at least one Unicode digit, then the primary format token is taken as a decimal digit pattern, and in this case it <span class="verb">must</span> match the regular expression <code>^((\p{Nd}|#|[^\p{N}\p{L}])+?)$</code>. If it contains a digit but does not match this pattern, a dynamic error is raised [<a href="#ERRFODF1310" title="err:FODF1310">err:FODF1310</a>].</p></li><li><p><span>If the radix (call it <var>R</var>) is present (including the case where an explicit radix of 10 is used), then</span> the character used as the <var>mandatory-digit-sign</var> is either <code>"x"</code> or <code>"X"</code>. If any <var>mandatory-digit-sign</var> is upper-case <code>"X"</code>, then all <var>mandatory-digit-signs</var> must be upper-case <code>"X"</code>. The digit family used in the output comprises the first <var>R</var> characters of the alphabet <code>0123456789abcdefghijklmnopqrstuvwxyz</code>, but using upper-case letters in place of lower-case if an upper-case <code>"X"</code> is used as the <var>mandatory-digit-sign</var>.</p><p>In this case the primary format token <span class="verb">must</span> match the regular expression <code>^(([Xx#]|[^\p{N}\p{L}])+?)$</code></p></li><li><p>a <var>grouping-separator-sign</var> is a non-alphanumeric character, that is a <a title="character" class="termref" href="#character">character</a> whose Unicode category is other than <var>Nd</var>, <var>Nl</var>, <var>No</var>, <var>Lu</var>, <var>Ll</var>, <var>Lt</var>, <var>Lm</var> or <var>Lo</var>.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>If a semicolon is to be used as a grouping separator, then the primary format token as a whole must be followed by another semicolon, to ensure that the grouping separator is not mistaken as a separator between the primary format token and the format modifier.</p></div><p>There <span class="verb">must</span> be at least one <var>mandatory-digit-sign</var>. There may be zero or more <var>optional-digit-signs</var>, and (if present) these <span class="verb">must</span> precede all <var>mandatory-digit-signs</var>. There may be zero or more <var>grouping-separator-signs</var>. A <var>grouping-separator-sign</var><span class="verb">must not</span> appear at the start or end of the <var>digit-pattern</var>, nor adjacent to another <var>grouping-separator-sign</var>.</p><p>The corresponding output is a number in the specified radix, using this digit family, with at least as many digits as there are <var>mandatory-digit-signs</var> in the format token. Thus:</p><ul><li><p>A format token <code>1</code> generates the sequence <code>0 1 2 ... 10 11 12 ...</code></p></li><li><p>A format token <code>01</code> (or equivalently, <code>00</code> or <code>99</code>) generates the sequence <code>00 01 02 ... 09 10 11 12 ... 99 100 101</code></p></li><li><p>A format token of <span class="unicode-codepoint">U+0661</span> (<span class="unicode-name">ARABIC-INDIC DIGIT ONE</span>, <code>١</code>) generates the sequence <code>١</code> then <code>٢</code> then <code>٣</code> ...</p></li><li><p>A format token of <code>16^xx</code> generates the sequence <code>00 01 02 03 ... 08 09 0a 0b 0c 0d 0e 0f 10 11 ...</code></p></li><li><p>A format token of <code>16^X</code> generates the sequence <code>0 1 2 3 ... 8 9 A B C D E F 10 11 ...</code></p></li></ul><p>The <var>grouping-separator-signs</var> are handled as follows:</p><ol class="enumla"><li><p>The position of grouping separators within the format token, counting backwards from the last digit, indicates the position of grouping separators to appear within the formatted number, and the character used as the <var>grouping-separator-sign</var> within the format token indicates the character to be used as the corresponding grouping separator in the formatted number. </p></li><li><p>More specifically, the <b>position</b> of a grouping separator is the number of <var>optional-digit-signs</var> and <var>mandatory-digit-signs</var> appearing between the grouping separator and the right-hand end of the primary format token.</p></li><li><p>Grouping separators are defined to be <b>regular</b> if the following conditions apply:</p><ol class="enumlr"><li><p>There is at least one grouping separator.</p></li><li><p>Every grouping separator is the same character (call it <var>C</var>).</p></li><li><p>There is a positive integer <var>G</var> (the grouping size) such that:</p><ol class="enumua"><li><p>The position of every grouping separator is an integer multiple of <var>G</var>, and</p></li><li><p>Every positive integer multiple of <var>G</var> that is less than the number of <var>optional-digit-signs</var> and <var>mandatory-digit-signs</var> in the primary format token is the position of a grouping separator.</p></li></ol></li></ol></li><li><p>The <b>grouping separator template</b> is a (possibly infinite) set of (position, character) pairs.</p></li><li><p>If grouping separators are regular, then the grouping separator template contains one pair of the form <code>(n×G, C)</code> for every positive integer <var>n</var> where <var>G</var> is the grouping size and <var>C</var> is the grouping character.</p></li><li><p>Otherwise (when grouping separators are not regular), the grouping separator template contains one pair of the form <code>(P, C)</code> for every grouping separator found in the primary formatting token, where <var>C</var> is the grouping separator character and <var>P</var> is its position.</p></li><li><div class="note"><p class="prefix"><b>Note:</b></p><p>If there are no grouping separators, then the grouping separator template is the empty set.</p></div></li></ol><p>The number is formatted as follows:</p><ol class="enumla"><li><p>Let <var>S<sub>1</sub></var> be the result of formatting the supplied number <span>in the appropriate radix: for radix 10 this will be the value obtained</span> by casting it to <code>xs:string</code>.</p></li><li><p>Let <var>S<sub>2</sub></var> be the result of padding <var>S<sub>1</sub></var> on the left with as many leading zeroes as are needed to ensure that it contains at least as many digits as the number of <var>mandatory-digit-signs</var> in the primary format token.</p></li><li><p>Let <var>S<sub>3</sub></var> be the result of replacing all decimal digits (0-9) in <var>S<sub>2</sub></var> with the corresponding digits from the selected digit family. <span>(This has no effect when the selected digit family uses ASCII digits (0-9), which will always be the case if a radix is specified.)</span></p></li><li><p>Let <var>S<sub>4</sub></var> be the result of inserting grouping separators into <var>S<sub>3</sub></var>: for every (position <var>P</var>, character <var>C</var>) pair in the grouping separator template where <var>P</var> is less than the number of digits in <var>S<sub>3</sub></var>, insert character <var>C</var> into <var>S<sub>3</sub></var> at position <var>P</var>, counting from the right-hand end.</p></li><li><p>Let <var>S<sub>5</sub></var> be the result of converting <var>S<sub>4</sub></var> into ordinal form, if an ordinal modifier is present, as described below.</p></li><li><p>The result of the function is then <var>S<sub>5</sub></var>.</p></li></ol></li><li><p>The format token <code>A</code>, which generates the sequence <code>A B C ... Z AA AB AC...</code>.</p></li><li><p>The format token <code>a</code>, which generates the sequence <code>a b c ... z aa ab ac...</code>.</p></li><li><p>The format token <code>i</code>, which generates the sequence <code>i ii iii iv v vi vii viii ix x ...</code>.</p></li><li><p>The format token <code>I</code>, which generates the sequence <code>I II III IV V VI VII VIII IX X ...</code>.</p></li><li><p>The format token <code>w</code>, which generates numbers written as lower-case words, for example in English, <code>one two three four ...</code></p></li><li><p>The format token <code>W</code>, which generates numbers written as upper-case words, for example in English, <code>ONE TWO THREE FOUR ...</code></p></li><li><p>The format token <code>Ww</code>, which generates numbers written as title-case words, for example in English, <code>One Two Three Four ...</code></p></li><li><p>Any other format token, which indicates a numbering sequence in which that token represents the number 1 (one) (but see the note below). It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which numbering sequences, additional to those listed above, are supported. If an implementation does not support a numbering sequence represented by the given token, it <span class="verb">must</span> use a format token of <code>1</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>In some traditional numbering sequences additional signs are added to denote that the letters should be interpreted as numbers, for example, in ancient Greek <span class="unicode-codepoint">U+0374</span> (<span class="unicode-name">DEXIA KERAIA</span>, <code>ʹ</code>) and sometimes <span class="unicode-codepoint">U+0375</span> (<span class="unicode-name">ARISTERI KERAIA</span>, <code>͵</code>) . These should not be included in the format token. </p></div></li></ol><p>For all format tokens other than a <var>digit-pattern</var>, there <span class="verb">may</span> be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> lower and upper bounds on the range of numbers that can be formatted using this format token; indeed, for some numbering sequences there may be intrinsic limits. For example, the format token <span class="unicode-codepoint">U+2460</span> (<span class="unicode-name">CIRCLED DIGIT ONE</span>, <code>①</code>) has a range imposed by the Unicode character repertoire — <span>zero to 20</span> in Unicode versions prior to <span>3.2</span>, or <span>zero to 50</span> in subsequent versions. For the numbering sequences described above any upper bound imposed by the implementation <span class="verb">must not</span> be less than 1000 (one thousand) and any lower bound must not be greater than 1. Numbers that fall outside this range <span class="verb">must</span> be formatted using the format token <code>1</code>.</p><p>The above expansions of numbering sequences for format tokens such as <code>a</code> and <code>i</code> are indicative but not prescriptive. There are various conventions in use for how alphabetic sequences continue when the alphabet is exhausted, and differing conventions for how roman numerals are written (for example, <code>IV</code> versus <code>IIII</code> as the representation of the number 4). Sometimes alphabetic sequences are used that omit letters such as <code>i</code> and <code>o</code>. This specification does not prescribe the detail of any sequence other than those sequences consisting entirely of decimal digits.</p><p>Many numbering sequences are language-sensitive. This applies especially to the sequence selected by the tokens <code>w</code>, <code>W</code>, and <code>Ww</code>. It also applies to other sequences, for example different languages using the Cyrillic alphabet use different sequences of characters, each starting with the letter <span class="unicode-codepoint">U+0410</span> (<span class="unicode-name">CYRILLIC CAPITAL LETTER A</span>, <code>А</code>) . In such cases, the <code>$language</code> argument specifies which language conventions are to be used. If the argument is specified, the value <span class="verb">should</span> be either the empty sequence or a value that would be valid for the <code>xml:lang</code> attribute (see <a href="#xml">[Extensible Markup Language (XML) 1.0 (Fifth Edition)]</a>). Note that this permits the identification of sublanguages based on country codes (from ISO 3166-1) as well as identification of dialects and regions within a country.</p><p>The set of languages for which numbering is supported is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the <code>$language</code> argument is absent, or is set to the empty sequence, or is invalid, or is not a language supported by the implementation, then the number is formatted using the default language from the dynamic context. </p><p>The format modifier <span class="verb">must</span> be a string that matches the regular expression <code>^([co](\(.+\))?)?[at]?$</code>. That is, if it is present it must consist of one or more of the following, in order:</p><ul><li><p>either <code>c</code> or <code>o</code>, optionally followed by a sequence of characters enclosed between parentheses, to indicate cardinal or ordinal numbering respectively, the default being cardinal numbering</p></li><li><p>either <code>a</code> or <code>t</code>, to indicate alphabetic or traditional numbering respectively, the default being <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p></li></ul><p>If the <code>o</code> modifier is present, this indicates a request to output ordinal numbers rather than cardinal numbers. For example, in English, when used with the format token <code>1</code>, this outputs the sequence <code>1st 2nd 3rd 4th ...</code>, and when used with the format token <code>w</code> outputs the sequence <code>first second third fourth ...</code>.</p><p>The string of characters between the parentheses, if present, is used to select between other possible variations of cardinal or ordinal numbering sequences. The interpretation of this string is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. No error occurs if the implementation does not define any interpretation for the defined string.</p><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> what combinations of values of the format token, the language, and the cardinal/ordinal modifier are supported. If ordinal numbering is not supported for the combination of the format token, the language, and the string appearing in parentheses, the request is ignored and cardinal numbers are generated instead.</p><p>The use of the <code>a</code> or <code>t</code> modifier disambiguates between numbering sequences that use letters. In many languages there are two commonly used numbering sequences that use letters. One numbering sequence assigns numeric values to letters in alphabetic sequence, and the other assigns numeric values to each letter in some other manner traditional in that language. In English, these would correspond to the numbering sequences specified by the format tokens <code>a</code> and <code>i</code>. In some languages, the first member of each sequence is the same, and so the format token alone would be ambiguous. In the absence of the <code>a</code> or <code>t</code> modifier, the default is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODF1310" title="err:FODF1310">err:FODF1310</a>] if the format token is invalid, that is, if it violates any mandatory rules (indicated by an emphasized <span class="verb">must</span> or <span class="verb">required</span> keyword in the above rules). For example, the error is raised if the primary format token contains a digit but does not match the required regular expression.</p></dd><dt class="label">Notes</dt><dd><div class="note"><ol class="enumar"><li><p>Note the careful distinction between conditions that are errors and conditions where fallback occurs. The principle is that an error in the syntax of the format picture will be reported by all processors, while a construct that is recognized by some implementations but not others will never result in an error, but will instead cause a fallback representation of the integer to be used.</p></li><li><p>The following notes apply when a <var>digit-pattern</var> is used:</p><ol class="enumla"><li><p>If <var>grouping-separator-signs</var> appear at regular intervals within the format token, then the sequence is extrapolated to the left, so grouping separators will be used in the formatted number at every multiple of <var>N</var>. For example, if the format token is <code>0'000</code> then the number one million will be formatted as <code>1'000'000</code>, while the number fifteen will be formatted as <code>0'015</code>.</p></li><li><p>The only purpose of <var>optional-digit-signs</var> is to mark the position of <var>grouping-separator-signs</var>. For example, if the format token is <code>#'##0</code> then the number one million will be formatted as <code>1'000'000</code>, while the number fifteen will be formatted as <code>15</code>. A grouping separator is included in the formatted number only if there is a digit to its left, which will only be the case if either (a) the number is large enough to require that digit, or (b) the number of <var>mandatory-digit-signs</var> in the format token requires insignificant leading zeros to be present.</p></li><li><p>Grouping separators are <em>not</em> designed for effects such as formatting a US telephone number as <code>(365)123-9876</code>. In general they are not suitable for such purposes because (a) only single characters are allowed, and (b) they cannot appear at the beginning or end of the number.</p></li><li><p>Numbers will never be truncated. Given the <var>digit-pattern</var><code>01</code>, the number three hundred will be output as <code>300</code>, despite the absence of any <var>optional-digit-sign</var>.</p></li></ol></li><li><p>The following notes apply when ordinal numbering is selected using the <code>o</code> modifier.</p><p>In some languages, the form of numbers (especially ordinal numbers) varies depending on the grammatical context: they may have different genders and may decline with the noun that they qualify. In such cases the string appearing in parentheses after the letter <code>c</code> or <code>o</code> may be used to indicate the variation of the cardinal or ordinal number required.</p><p>The way in which the variation is indicated will depend on the conventions of the language.</p><p>For inflected languages that vary the ending of the word, the approach recommended in the previous version of this specification was to indicate the required ending, preceded by a hyphen: for example in German, appropriate values might be <code>o(-e)</code>, <code>o(-er)</code>, <code>o(-es)</code>, <code>o(-en)</code>. </p><p>Another approach, which might usefully be adopted by an implementation based on the open-source ICU localization library <a href="#ICU">[ICU]</a>, or any other library making use of the Unicode Common Locale Data Repository <a href="#CLDR">[Unicode CLDR]</a>, is to allow the value in parentheses to be the name of a registered numbering rule set for the language in question, conventionally prefixed with a percent sign: for example, <code>o(%spellout-ordinal-masculine)</code>, or <code>c(%spellout-cardinal-year)</code>. </p></li><li><p>The following notes apply when the primary format token is neither a <var>digit-pattern</var> nor one of the seven other defined format tokens (A, a, i, I, w, W, Ww), but is an arbitrary token representing the number 1:</p><p>Unexpected results may occur for traditional numbering. For example, in an implementation that supports traditional numbering system in Greek, the example <code>format-integer(19, "α;t")</code> might return <code>δπιιιι</code> or <code>ιθ</code>, depending upon whether the ancient acrophonic or late antique alphabetic system is supported. </p><p>Unexpected results may also occur for alphabetic numbering. For example, in an implementation that supports alphabetic numbering system in Greek, someone writing <code>format-integer(19, "α;a")</code> might expect the nineteenth Greek letter, <span class="unicode-codepoint">U+03C4</span> (<span class="unicode-name">GREEK SMALL LETTER TAU</span>, <code>τ</code>) , but the implementation might return the eighteenth one, <span class="unicode-codepoint">U+03C3</span> (<span class="unicode-name">GREEK SMALL LETTER SIGMA</span>, <code>σ</code>) , because the latter is the nineteenth item in the sequence of lowercase Greek letters in Unicode (the sequence is interrupted because of the final form of the sigma, <span class="unicode-codepoint">U+03C2</span> (<span class="unicode-name">GREEK SMALL LETTER FINAL SIGMA</span>, <code>ς</code>) ). Because Greek never had a final capital sigma, Unicode has marked <span class="unicode-codepoint">U+03A2</span>, the eighteenth codepoint in the sequence of Greek capital letters, as reserved, to ensure that every Greek uppercase letter is always 32 codepoints less than its lowercase counterpart. Therefore, someone writing <code>format-integer(18, "Α;a")</code> might expect the eighteenth Greek capital letter, <span class="unicode-codepoint">U+03A3</span> (<span class="unicode-name">GREEK CAPITAL LETTER SIGMA</span>, <code>Σ</code>) , but an implementation might return <span class="unicode-codepoint">U+03A2</span>, the eighteenth position in the sequence of Greek capital letters, but unassigned to any character. </p></li></ol></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(123, '0000')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"0123"</code></p></td></tr><tr><td colspan="2"><p><code>format-integer(123, 'w')</code> might return <code>"one hundred and twenty-three"</code></p></td></tr><tr><td colspan="2"><p>Ordinal numbering in Italian: The specification <code>"1;o(-º)"</code> with <code>$language</code> equal to <code>it</code>, if supported, should produce the sequence:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">1º 2º 3º 4º ...</pre></div></td></tr><tr><td colspan="2"><p>The specification <code>"Ww;o"</code> with <code>$language</code> equal to <code>it</code>, if supported, should produce the sequence:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">Primo Secondo Terzo Quarto Quinto ...</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(21, '1;o', 'en')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"21st"</code></p></td></tr><tr><td colspan="2"><p><code>format-integer(14, 'Ww;o(-e)', 'de')</code> might return <code>"Vierzehnte"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(7, 'a')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"g"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(27, 'a')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"aa"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(57, 'I')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"LVII"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(1234, '#;##0;')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"1;234"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(1234, '16^xxxx')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"04d2"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(1234, '16^X')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"4D2"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(12345678, '16^xxxx_xxxx')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"00bc_614e"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(12345678, '16^#_xxxx')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"bc_614e"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(255, '2^xxxx xxxx')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"1111 1111"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(1023, '32^XXXX')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"00VV"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(1023, '10^XXXX')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"1023"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(1023, '10^00')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"10^23"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(-5, '001')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"-005"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(-5, 'a')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"-e"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-integer(-12, '16^XX')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"-0C"</code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="formatting-numbers"></a>4.7 <a href="#formatting-numbers" style="text-decoration: none">Formatting numbers</a></h3><p>This section defines a function for formatting decimal and floating point numbers.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-format-number"><code>fn:format-number</code></a></td><td>Returns a string containing a number formatted according to a given picture string and decimal format.</td></tr></tbody></table><div class="note"><p class="prefix"><b>Note:</b></p><p>This function can be used to format any numeric quantity, including an integer. For integers, however, the <a href="#func-format-integer"><code>fn:format-integer</code></a> function offers additional possibilities. Note also that the picture strings used by the two functions are not 100% compatible, though they share some options in common.</p></div><div class="div3"><h4><a id="defining-decimal-format"></a>4.7.1 <a href="#defining-decimal-format" style="text-decoration: none">Defining a decimal format</a></h4><p>Decimal formats are defined in the static context, and the way they are defined is therefore outside the scope of this specification. XSLT and XQuery both provide custom syntax for creating a decimal format.</p><p>The static context provides a set of decimal formats. One of the decimal formats is unnamed, the others (if any) are identified by a QName. There is always an unnamed decimal format available, but its contents are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p><p>Each decimal format provides a set of named properties.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>A phrase such as "The <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-minus-sign">minus-sign</a><sup><small>XP31</small></sup> character" is to be read as “the character assigned to the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-minus-sign">minus-sign</a><sup><small>XP31</small></sup> property in the relevant decimal format”.</p></div><p><span class="termdef"><a id="dt-decimal-digit-family"></a>[Definition] The <b>decimal digit family</b> of a decimal format is the sequence of ten digits with consecutive Unicode <a title="codepoint" class="termref" href="#codepoint">codepoints</a> starting with the character that is the value of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-zero-digit">zero-digit</a><sup><small>XP31</small></sup> property.</span></p><p><span class="termdef"><a id="dt-optional-digit-character"></a>[Definition] The <b>optional digit character</b> is the character that is the value of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-digit">digit</a><sup><small>XP31</small></sup> property.</span></p><p>For any decimal format, the properties representing characters used in a <a title="picture string" class="termref" href="#dt-picture-string">picture string</a> must have distinct values. These properties are <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> , <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup>, <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-exponent-separator">exponent-separator</a><sup><small>XP31</small></sup>, <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-percent">percent</a><sup><small>XP31</small></sup>, <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-per-mille">per-mille</a><sup><small>XP31</small></sup>, <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-digit">digit</a><sup><small>XP31</small></sup>, and <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-pattern-separator">pattern-separator</a><sup><small>XP31</small></sup>. Furthermore, none of these properties may be equal to any <a title="character" class="termref" href="#character">character</a> in the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a>. </p></div><div class="div3"><h4><a id="func-format-number"></a>4.7.2 <a href="#func-format-number" style="text-decoration: none">fn:format-number</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-math-e">next</a> | <a href="#func-format-integer">previous</a>)</p><ol><li><p>The decimal format name can now be supplied as a value of type <code>xs:QName</code>, as an alternative to supplying a lexical QName as an instance of <code>xs:string</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/780">780</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/925">925</a>&nbsp;9 January 2024]</i></p></li><li><p>Decimal format parameters can now be supplied directly as a map in the third argument, rather than referencing a format defined in the static context.<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/340">340</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1138">1138</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1049">1049</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1151">1151</a>&nbsp;5 March 2024]</i></p></li><li><p>For selected properties including <code>percent</code> and <code>exponent-separator</code>, it is now possible to specify a single-character marker to be used in the picture string, together with a multi-character rendition to be used in the formatted output.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1048">1048</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1250">1250</a>&nbsp;11 June 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a string containing a number formatted according to a given picture string and decimal format.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:format-number</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$picture</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | map(*))?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on decimal formats, and namespaces. </p></dd><dt class="label">Rules</dt><dd><p>The function formats <code>$value</code> as a string using the <a title="picture string" class="termref" href="#dt-picture-string">picture string</a> specified by the <code>$picture</code> argument and a decimal format.</p><p>The <code>$value</code> argument may be of any numeric data type (<code>xs:double</code>, <code>xs:float</code>, <code>xs:decimal</code>, or their subtypes including <code>xs:integer</code>). Note that if an <code>xs:decimal</code> is supplied, it is not automatically converted to an <code>xs:double</code>, as such conversion can involve a loss of precision.</p><p>If the supplied value of the <code>$value</code> argument is the empty sequence, the function behaves as if the supplied value were the <code>xs:double</code> value <code>NaN</code>.</p><p>If <code>$options</code> is absent, or if it is supplied as the empty sequence or the empty map, then the number is formatted using the properties of the unnamed decimal format in the static context.</p><p>For backwards compatibility reasons, the decimal format can be supplied as an instance of <code>xs:string</code>. If the value of the <code>$options</code> argument is an <code>xs:string</code>, then its value <span class="verb">must</span> be a string which after removal of leading and trailing whitespace is in the form of an <code>EQName</code> as defined in the XPath 4.0 grammar, that is one of the following:</p><ul><li><p>A lexical QName, which is expanded using the statically known namespaces. The default namespace is not used (no prefix means no namespace).</p></li><li><p>A <code>URIQualifiedName</code> using the syntax <code>Q{uri}local</code>, where the URI can be zero-length to indicate a name in no namespace.</p></li></ul><p>The effective value of the <code>$options</code> argument is then the map <code>{ 'format-name': $FN }</code> where <code>$FN</code> is the <code>xs:QName</code> result of expanding this <code>EQName</code>.</p><p>The entries that may appear in the <code>$options</code> map are as follows. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply. The detailed rules for the interpretation of each option appear later.</p><p>In the table, the type <code>xs:string (: matching '.' :)</code> represents a single-character string, that is, a restriction of <code>xs:string</code> with the facet <code>pattern="."</code>, while the type <code>xs:string (: matching '.|.:.*' :)</code> indicates a string that is either a single character, or a single character followed by <span class="unicode-codepoint">U+003A</span> (<span class="unicode-name">COLON</span>, <code>:</code>) followed by an arbitrary string. Such a property identifies two values: a single character called the <b>marker</b>, which is used to represent the property in the picture string; and an arbitrary string called the <b>rendition</b> which is used to represent in the property in the result string. In the absence of the colon the single character value is used both as the marker and the rendition.</p><p>The default value for absent options (other than <code>format-name</code>) is taken from a decimal format in the static context; the default values shown in the table are the values used if no specific value is assigned in the static context. </p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">format-name?</code></td><td><code class="as">as&nbsp;</code><code>(xs:NCName | xs:QName)?</code>,</td></tr><tr class="arg"><td><code class="opt">decimal-separator?</code></td><td><code class="as">as&nbsp;</code><code>xs:string (: matching '.|.:.*' :)</code>,</td></tr><tr class="arg"><td><code class="opt">grouping-separator?</code></td><td><code class="as">as&nbsp;</code><code>xs:string (: matching '.|.:.*' :)</code>,</td></tr><tr class="arg"><td><code class="opt">exponent-separator?</code></td><td><code class="as">as&nbsp;</code><code>xs:string (: matching '.|.:.*' :)</code>,</td></tr><tr class="arg"><td><code class="opt">infinity?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">minus-sign?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">NaN?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">percent?</code></td><td><code class="as">as&nbsp;</code><code>xs:string (: matching '.|.:.*' :)</code>,</td></tr><tr class="arg"><td><code class="opt">per-mille?</code></td><td><code class="as">as&nbsp;</code><code>xs:string (: matching '.|.:.*' :)</code>,</td></tr><tr class="arg"><td><code class="opt">zero-digit?</code></td><td><code class="as">as&nbsp;</code><code>xs:string (: matching '.' :)</code>,</td></tr><tr class="arg"><td><code class="opt">digit?</code></td><td><code class="as">as&nbsp;</code><code>xs:string (: matching '.' :)</code>,</td></tr><tr class="arg"><td><code class="opt">pattern-separator?</code></td><td><code class="as">as&nbsp;</code><code>xs:string (: matching '.' :)</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>format-name?</code></p></td><td class="fos-thin"> The name of a decimal format in the static context; if absent, the unnamed decimal format in the static context is used. An <code>xs:NCName</code> represents the local part of an <code>xs:QName</code> in no namespace. <ul><li><p><b>Type: </b><code>(xs:NCName | xs:QName)?</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>decimal-separator?</code></p></td><td class="fos-thin">The <b>marker</b> used to represent the decimal point in the picture string, and the <b>rendition</b> of the decimal point in the formatted number. <ul><li><p><b>Type: </b><code>xs:string (: matching '.|.:.*' :)</code></p></li><li><p><b>Default: </b><code>"."</code></p></li></ul></td></tr><tr><td><p><code>grouping-separator?</code></p></td><td class="fos-thin">The <b>marker</b> used to separate groups of digits in the picture string, and the <b>rendition</b> of the grouping separator in the formatted number. <ul><li><p><b>Type: </b><code>xs:string (: matching '.|.:.*' :)</code></p></li><li><p><b>Default: </b><code>","</code></p></li></ul></td></tr><tr><td><p><code>exponent-separator?</code></p></td><td class="fos-thin">The <b>marker</b> used to separate the mantissa from the exponent in scientific notation in the picture string, and the <b>rendition</b> of the exponent separator in the formatted number. <ul><li><p><b>Type: </b><code>xs:string (: matching '.|.:.*' :)</code></p></li><li><p><b>Default: </b><code>"e"</code></p></li></ul></td></tr><tr><td><p><code>infinity?</code></p></td><td class="fos-thin">The string used to represent the value positive or negative infinity in the formatted number. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>"Infinity"</code></p></li></ul></td></tr><tr><td><p><code>minus-sign?</code></p></td><td class="fos-thin">The string used as a minus sign in the formatted number if there is no subpicture for formatting negative numbers. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>"-"</code></p></li></ul></td></tr><tr><td><p><code>NaN?</code></p></td><td class="fos-thin">The string used to represent the value <code>NaN</code> in the formatted number. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>"NaN"</code></p></li></ul></td></tr><tr><td><p><code>percent?</code></p></td><td class="fos-thin">The <b>marker</b> used to indicate the presence of a percent sign in the picture string, and the <b>rendition</b> of the percent sign in the formatted number. <ul><li><p><b>Type: </b><code>xs:string (: matching '.|.:.*' :)</code></p></li><li><p><b>Default: </b><code>"%"</code></p></li></ul></td></tr><tr><td><p><code>per-mille?</code></p></td><td class="fos-thin"><b>marker</b> used to indicate the presence of a per-mille sign in the picture string, and the <b>rendition</b> of the per-mille sign in the formatted number. <ul><li><p><b>Type: </b><code>xs:string (: matching '.|.:.*' :)</code></p></li><li><p><b>Default: </b><code>"‰" (0x2030)</code></p></li></ul></td></tr><tr><td><p><code>zero-digit?</code></p></td><td class="fos-thin">Defines the characters used in the picture string to represent a mandatory digit: for example, if the zero-digit is <code>0</code> then any of the digits <code>0</code> to <code>9</code> may be used (interchangeably) in the picture string to represent a mandatory digit, and in the formatted number the characters <code>0</code> to <code>9</code> will be used to represent the digits zero to nine. The value must be a character in Unicode category Nd with decimal digit value 0 (zero). <ul><li><p><b>Type: </b><code>xs:string (: matching '.' :)</code></p></li><li><p><b>Default: </b><code>"0"</code></p></li></ul></td></tr><tr><td><p><code>digit?</code></p></td><td class="fos-thin">The character used in the picture string to represent an optional digit. <ul><li><p><b>Type: </b><code>xs:string (: matching '.' :)</code></p></li><li><p><b>Default: </b><code>"#"</code></p></li></ul></td></tr><tr><td><p><code>pattern-separator?</code></p></td><td class="fos-thin">The character used in the picture string to separate the positive and negative subpictures. <ul><li><p><b>Type: </b><code>xs:string (: matching '.' :)</code></p></li><li><p><b>Default: </b><code>";"</code></p></li></ul></td></tr></tbody></table><p>A base decimal format is established as follows:</p><ul><li><p>If the <code>format-name</code> option is present, then the decimal format in the static context identified by this name.</p></li><li><p>Otherwise, the unnamed decimal format in the static context.</p></li></ul><p>The base decimal format is then modified using the other entries in the supplied <code>$options</code> map. </p><p>The evaluation of the <a href="#func-format-number"><code>fn:format-number</code></a> function takes place in two phases, an analysis phase described in <a href="#analyzing-picture-string"><b>4.7.4 Analyzing the picture string</b></a> and a formatting phase described in <a href="#formatting-the-number"><b>4.7.5 Formatting the number</b></a>.</p><p>The analysis phase takes as its inputs the <a title="picture string" class="termref" href="#dt-picture-string">picture string</a> and the variables derived from the relevant decimal format in the static context, and produces as its output a number of variables with defined values. The formatting phase takes as its inputs the number to be formatted and the variables produced by the analysis phase, and produces as its output a string containing a formatted representation of the number.</p><p>The result of the function is the formatted string representation of the supplied number.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODF1280" title="err:FODF1280">err:FODF1280</a>] <span>if the <code>$options</code> argument is supplied as an <code>xs:string</code> that is</span> neither a valid lexical QName nor a valid <code>URIQualifiedName</code>, or if it uses a prefix that is not found in the statically known namespaces; or if the static context does not contain a declaration of a decimal format with a matching expanded QName; or if <code>$options?format-name</code> is present and the static context does not contain a declaration of a decimal format whose name matches <code>$options?format-name</code>. If the processor is able to detect the error statically (for example, when the argument is supplied as a string literal), then the processor <span class="verb">may</span> optionally signal this as a static error.</p><p>A dynamic error is raised [<a href="#ERRFODF1290" title="err:FODF1290">err:FODF1290</a>] if a value of <code>$format</code> is not valid for the associated property, or if the properties of the decimal format resulting from a supplied <code>$options</code> map do not have distinct values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>A string is an ordered sequence of characters, and this specification uses terms such as “left” and “right”, “preceding” and “following” in relation to this ordering, irrespective of the position of the characters when visually rendered on some output medium. Both in the picture string and in the result string, digits with higher significance (that is, representing higher powers of ten) always precede digits with lower significance, even when the rendered text flow is from right to left.</p><p>In previous versions of XSLT and XQuery, decimal formats were typically defined in the static context using custom declarations (<code>&lt;xsl:decimal-format&gt;</code> in XSLT, <code>declare decimal-format</code> in XQuery) and then selected by name in a call on <a href="#func-format-number"><code>fn:format-number</code></a>. This mechanism remains available, but in 4.0, it may be more convenient to dispense with these declarations, and instead to define a decimal format as a map bound to a global variable, which can be referenced in the <code>$options</code> argument of the <a href="#func-format-number"><code>fn:format-number</code></a> call.</p><p>Alternative ways to format an <code>xs:double</code> as a string include:</p><ul><li><p>Direct casting to string, for example using the constructor function <code>xs:string($number)</code></p></li><li><p>JSON serialization, for example <code>fn:serialize($number, {'method':'json', 'canonical':true()})</code></p></li></ul><p>In general these will produce different results, for example in the amount of precision that is retained, and in the use of exponential (scientific) notation.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The following examples assume a default decimal format in which the chosen digits are the ASCII digits 0-9, the decimal separator is <code>.</code>, the grouping separator is <code>,</code>, the minus-sign is <code>-</code>, and the percent-sign is <code>%</code>.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(12345.6, '#,###.00')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"12,345.60"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(12345678.9, '9,999.99')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"12,345,678.90"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(123.9, '9999')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"0124"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(0.14, '01%')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"14%"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(0.14, '01%', { 'percent': '%:pc' })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"14pc"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">format-number(12345, '0.0###^0', { 
   'exponent-separator': '^:×10^' 
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"1.2345×10^4"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(-6, '000')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"-006"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">format-number(1234567.8, '0.000,0', {
   'grouping-separator': '.',
   'decimal-separator': ','
 })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"1.234.567,8"</pre></div></td></tr><tr><td colspan="2"><p>The following examples assume the existence of a decimal format named <code>de</code> in which the grouping separator is <code>.</code> and the decimal separator is <code>,</code>:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(1234.5678, '#.##0,00', { 'format-name': 'de' })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"1.234,57"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">format-number(12345, '0,###^0', {
  'format-name': 'de',
  'exponent-separator': '^'
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"1,234^4"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">format-number(12345, '0,###^0', {
  'format-name': 'de',
  'exponent-separator': '^:×10^'
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"1,234×10^4"</pre></div></td></tr><tr><td colspan="2"><p>The following examples assume that the exponent separator in decimal format <code>fortran</code> is <code>E</code>:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(1234.5678, '00.000E0', 'fortran')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"12.346E2"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(0.234, '0.0E0', 'fortran')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"2.3E-1"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(0.234, '#.00E0', 'fortran')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"0.23E0"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>format-number(0.234, '.00E0', 'fortran')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>".23E0"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="syntax-of-picture-string"></a>4.7.3 <a href="#syntax-of-picture-string" style="text-decoration: none">Syntax of the picture string</a></h4><div class="note"><p class="prefix"><b>Note:</b></p><p>This differs from the <code>format-number</code> function previously defined in XSLT 2.0 in that any digit can be used in the picture string to represent a mandatory digit: for example the picture strings <code>"000"</code>, <code>"001"</code>, and <code>"999"</code> are equivalent. The digits will all be from the same decimal digit family, specifically, the sequence of ten consecutive digits starting with the digit assigned to the <var>zero-digit</var> property. This change is to align <code>format-number</code> (which previously used <code>"000"</code>) with <code>format-dateTime</code> (which used <code>001</code>).</p></div><p><span class="termdef"><a id="dt-picture-string"></a>[Definition] The formatting of a number is controlled by a <b>picture string</b>. The picture string is a sequence of <a title="character" class="termref" href="#character">characters</a>, in which the characters assigned to the properties <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> , <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-exponent-separator">exponent-separator</a><sup><small>XP31</small></sup>, <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup>, <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-digit">digit</a><sup><small>XP31</small></sup>, and <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-pattern-separator">pattern-separator</a><sup><small>XP31</small></sup> and the members of the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a>, are classified as active characters, and all other characters (including the values of the properties <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-percent">percent</a><sup><small>XP31</small></sup> and <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-per-mille">per-mille</a><sup><small>XP31</small></sup>) are classified as passive characters.</span></p><p>A dynamic error is raised [<a href="#ERRFODF1310" title="err:FODF1310">err:FODF1310</a>] if the <a title="picture string" class="termref" href="#dt-picture-string">picture string</a> does not conform to the following rules. Note that in these rules the words "preceded" and "followed" refer to characters anywhere in the string; they are not to be read as "immediately preceded" and "immediately followed".</p><ul><li><p>A picture-string consists either of a sub-picture, or of two sub-pictures separated by the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-pattern-separator">pattern-separator</a><sup><small>XP31</small></sup> character. A picture-string <span class="verb">must not</span> contain more than one instance of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-pattern-separator">pattern-separator</a><sup><small>XP31</small></sup> character. If the picture-string contains two sub-pictures, the first is used for positive and unsigned zero values and the second for negative values.</p></li><li><p>A sub-picture <span class="verb">must not</span> contain more than one instance of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character.</p></li><li><p>A sub-picture <span class="verb">must not</span> contain more than one instance of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-percent">percent</a><sup><small>XP31</small></sup> or <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-per-mille">per-mille</a><sup><small>XP31</small></sup> characters, and it <span class="verb">must not</span> contain one of each.</p></li><li><p>The <var>mantissa part</var> of a sub-picture (defined below) <span class="verb">must</span> contain at least one character that is either an <a title="optional digit character" class="termref" href="#dt-optional-digit-character">optional digit character</a> or a member of the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a>.</p></li><li><p>A sub-picture <span class="verb">must not</span> contain a passive character that is preceded by an active character and that is followed by another active character.</p></li><li><p>A sub-picture <span class="verb">must not</span> contain a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup> character that appears adjacent to a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character, or in the absence of a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character, at the end of the <var>integer part</var>.</p></li><li><p>A sub-picture <span class="verb">must not</span> contain two adjacent instances of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup> character.</p></li><li><p>The <var>integer part</var> of a sub-picture (defined below) <span class="verb">must not</span> contain a member of the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> that is followed by an instance of the <a title="optional digit character" class="termref" href="#dt-optional-digit-character">optional digit character</a>. The <var>fractional part</var> of a sub-picture (defined below) <span class="verb">must not</span> contain an instance of the <a title="optional digit character" class="termref" href="#dt-optional-digit-character">optional digit character</a> that is followed by a member of the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a>.</p></li><li><p>A character that matches the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-exponent-separator">exponent-separator</a><sup><small>XP31</small></sup> property is treated as an <var>exponent-separator-sign</var> if it is both preceded and followed within the sub-picture by an active character. Otherwise, it is treated as a passive character. A sub-picture <span class="verb">must not</span> contain more than one character that is treated as an <var>exponent-separator-sign</var>. </p></li><li><p>A sub-picture that contains a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-percent">percent</a><sup><small>XP31</small></sup> or <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-per-mille">per-mille</a><sup><small>XP31</small></sup> character <span class="verb">must not</span> contain a character treated as an <var>exponent-separator-sign</var>.</p></li><li><p>If a sub-picture contains a character treated as an <var>exponent-separator-sign</var> then this <span class="verb">must</span> be followed by one or more characters that are members of the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a>, and it <span class="verb">must not</span> be followed by any active character that is not a member of the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a>.</p></li></ul><p>The <var>mantissa part</var> of the sub-picture is defined as the part that appears to the left of the <var>exponent-separator-sign</var> if there is one, or the entire sub-picture otherwise. The <var>exponent part</var> of the subpicture is defined as the part that appears to the right of the <var>exponent-separator-sign</var>; if there is no <var>exponent-separator-sign</var> then the <var>exponent part</var> is absent.</p><p>The <var>integer part</var> of the sub-picture is defined as the part that appears to the left of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character if there is one, or the entire <var>mantissa part</var> otherwise.</p><p>The <var>fractional part</var> of the sub-picture is defined as that part of the <var>mantissa part</var> that appears to the right of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character if there is one, or the part that appears to the right of the rightmost active character otherwise. The fractional part may be zero-length.</p></div><div class="div3"><h4><a id="analyzing-picture-string"></a>4.7.4 <a href="#analyzing-picture-string" style="text-decoration: none">Analyzing the picture string</a></h4><p>This phase of the algorithm analyzes the <a title="picture string" class="termref" href="#dt-picture-string">picture string</a> and the properties from the selected decimal format in the static context, and it has the effect of setting the values of various variables, which are used in the subsequent formatting phase. These variables are listed below. Each is shown with its initial setting and its datatype. </p><p>Several variables are associated with each sub-picture. If there are two sub-pictures, then these rules are applied to one sub-picture to obtain the values that apply to positive and unsigned zero numbers, and to the other to obtain the values that apply to negative numbers. If there is only one sub-picture, then the values for both cases are derived from this sub-picture.</p><p>The variables are as follows:</p><ul><li><p>The <var>integer-part-grouping-positions</var> is a sequence of integers representing the positions of grouping separators within the integer part of the sub-picture. For each <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup> character that appears within the integer part of the sub-picture, this sequence contains an integer that is equal to the total number of <a title="optional digit character" class="termref" href="#dt-optional-digit-character">optional digit character</a> and <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> characters that appear within the integer part of the sub-picture and to the right of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup> character.</p><p>The grouping is defined to be <b>regular</b> if the following conditions apply:</p><ol class="enumar"><li><p>There is an least one grouping-separator in the integer part of the sub-picture.</p></li><li><p>There is a positive integer <var>G</var> (the grouping size) such that the position of every grouping-separator in the integer part of the sub-picture is a positive integer multiple of <var>G</var>.</p></li><li><p>Every position in the integer part of the sub-picture that is a positive integer multiple of <var>G</var> is occupied by a grouping-separator.</p></li></ol><p>If the grouping is regular, then the <var>integer-part-grouping-positions</var> sequence contains all integer multiples of <var>G</var> as far as necessary to accommodate the largest possible number.</p></li><li><p>The <var>minimum-integer-part-size</var> is an integer indicating the minimum number of digits that will appear to the left of the <var>decimal-separator</var> character. It is initially set to the number of <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> characters found in the integer part of the sub-picture, but may be adjusted as described below. </p><div class="note"><p class="prefix"><b>Note:</b></p><p>There is no maximum integer part size. All significant digits in the integer part of the number will be displayed, even if this exceeds the number of <a title="optional digit character" class="termref" href="#dt-optional-digit-character">optional digit character</a> and <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> characters in the subpicture.</p></div></li><li><p>The <var>scaling factor</var> is a non-negative integer used to determine the scaling of the mantissa in exponential notation. It is set to the number of <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> characters found in the integer part of the sub-picture.</p></li><li><p>The <var>prefix</var> is set to contain all passive characters in the sub-picture to the left of the leftmost active character. If the picture string contains only one sub-picture, the <var>prefix</var> for the negative sub-picture is set by concatenating the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-minus-sign">minus-sign</a><sup><small>XP31</small></sup> character and the <var>prefix</var> for the positive sub-picture (if any), in that order.</p></li><li><p>The <var>fractional-part-grouping-positions</var> is a sequence of integers representing the positions of grouping separators within the fractional part of the sub-picture. For each <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup> character that appears within the fractional part of the sub-picture, this sequence contains an integer that is equal to the total number of <a title="optional digit character" class="termref" href="#dt-optional-digit-character">optional digit character</a> and <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> characters that appear within the fractional part of the sub-picture and to the left of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup> character.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>There is no need to extrapolate grouping positions on the fractional side, because the number of digits in the output will never exceed the number of <a title="optional digit character" class="termref" href="#dt-optional-digit-character">optional digit character</a> and <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> characters in the fractional part of the sub-picture.</p></div></li><li><p>The <var>minimum-fractional-part-size</var> is set to the number of <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> characters found in the fractional part of the sub-picture.</p></li><li><p>The <var>maximum-fractional-part-size</var> is set to the total number of <a title="optional digit character" class="termref" href="#dt-optional-digit-character">optional digit character</a> and <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> characters found in the fractional part of the sub-picture.</p></li><li><p>If the effect of the above rules is that <var>minimum-integer-part-size</var> and <var>maximum-fractional-part-size</var> are both zero, then an adjustment is applied as follows:</p><ul><li><p>If an exponent separator is present then:</p><ul><li><p><var>minimum-fractional-part-size</var> is changed to 1 (one).</p></li><li><p><var>maximum-fractional-part-size</var> is changed to 1 (one).</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>This has the effect that with the picture <code>#.e9</code>, the value <code>0.123</code> is formatted as <code>0.1e0</code></p></div></li><li><p>Otherwise:</p><ul><li><p><var>minimum-integer-part-size</var> is changed to 1 (one).</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>This has the effect that with the picture <code>#</code>, the value <code>0.23</code> is formatted as <code>0</code></p></div></li></ul></li><li><p>If all the following conditions are true:</p><ul><li><p>An exponent separator is present</p></li><li><p>The <var>minimum-integer-part-size</var> is zero</p></li><li><p>There is at least one <a title="optional digit character" class="termref" href="#dt-optional-digit-character">optional digit character</a> in the integer part of the sub-picture</p></li></ul><p>then the <var>minimum-integer-part-size</var> is changed to 1 (one).</p><div class="note"><p class="prefix"><b>Note:</b></p><p>This has the effect that with the picture <code>.9e9</code>, the value <code>0.1</code> is formatted as <code>.1e0</code>, while with the picture <code>#.9e9</code>, it is formatted as <code>0.1e0</code></p></div></li><li><p>If (after making the above adjustments) the <var>minimum-integer-part-size</var> and the <var>minimum-fractional-part-size</var> are both zero, then the <var>minimum-fractional-part-size</var> is set to 1 (one).</p></li><li><p>The <var>minimum-exponent-size</var> is set to the number of <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> characters found in the exponent part of the sub-picture if present, or zero otherwise.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The rules for the syntax of the picture string ensure that if an exponent separator is present, then the <var>minimum-exponent-size</var> will always be greater than zero.</p></div></li><li><p>The <var>suffix</var> is set to contain all passive characters to the right of the rightmost active character in the sub-picture.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>If there is only one sub-picture, then all variables for positive numbers and negative numbers will be the same, except for <var>prefix</var>: the prefix for negative numbers will be preceded by the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-minus-sign">minus-sign</a><sup><small>XP31</small></sup> character.</p></div></div><div class="div3"><h4><a id="formatting-the-number"></a>4.7.5 <a href="#formatting-the-number" style="text-decoration: none">Formatting the number</a></h4><p>This section describes the second phase of processing of the <a href="#func-format-number"><code>fn:format-number</code></a> function. This phase takes as input a number to be formatted (referred to as the <em>input number</em>), and the variables set up by analyzing the decimal format in the static context and the <a title="picture string" class="termref" href="#dt-picture-string">picture string</a>, as described above. The result of this phase is a string, which forms the return value of the <a href="#func-format-number"><code>fn:format-number</code></a> function.</p><p>The algorithm for this second stage of processing is as follows:</p><ol class="enumar"><li><p>If the input number is <code>NaN</code> (not a number), the result is the value of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-NaN">pattern separator</a><sup><small>XP31</small></sup> property (with no <var>prefix</var> or <var>suffix</var>).</p></li><li><p>In the rules below, the positive sub-picture and its associated variables are used if the input number is positive, and the negative sub-picture and its associated variables are used if it is negative. For <code>xs:double</code> and <code>xs:float</code>, negative zero is taken as negative, positive zero as positive. For <code>xs:decimal</code> and <code>xs:integer</code>, the positive sub-picture is used for zero.</p></li><li><p>The <var>adjusted number</var> is determined as follows:</p><ul><li><p>If the sub-picture contains a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-percent">percent</a><sup><small>XP31</small></sup> character, the <var>adjusted number</var> is the input number multiplied by 100.</p></li><li><p>If the sub-picture contains a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-per-mille">per-mille</a><sup><small>XP31</small></sup> character, the <var>adjusted number</var> is the input number multiplied by 1000.</p></li><li><p>Otherwise, the <var>adjusted number</var> is the input number.</p></li></ul><p>If the multiplication causes numeric overflow, no error occurs, and the <var>adjusted number</var> is positive or negative infinity as appropriate.</p></li><li><p>If the <var>adjusted number</var> is positive or negative infinity, the result is the concatenation of the appropriate <var>prefix</var>, the value of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-infinity">infinity</a><sup><small>XP31</small></sup> property, and the appropriate <var>suffix</var>.</p></li><li><p>If the <var>minimum exponent size</var> is non-zero, <span>and the <var>adjusted number</var> is non-zero,</span> then the <var>adjusted number</var> is scaled to establish a <var>mantissa</var> and an integer <var>exponent</var>. The <var>mantissa</var> and <var>exponent</var> are chosen such that all the following conditions are true:</p><ul><li><p>The primitive type of the <var>mantissa</var> is the same as the primitive type of the <var>adjusted number</var> (integer, decimal, float, or double).</p></li><li><p>The <var>mantissa</var> multiplied by ten to the power of the exp<var></var>onent is equal to the <var>adjusted number</var>.</p></li><li><p>The <var>mantissa</var><span>(unless it is zero)</span> is less than 10<sup>N</sup>, and at least 10<sup>N-1</sup>, where <var>N</var> is the <var>scaling factor</var>.</p></li></ul><p>If the <var>minimum exponent size</var> is zero, then the <var>mantissa</var> is the <var>adjusted number</var> and there is no <var>exponent</var>.</p><p>If the <var>minimum exponent size</var> is non-zero and the <var>adjusted number</var> is zero, then the <var>mantissa</var> is the <var>adjusted number</var> and the <var>exponent</var> is zero.</p></li><li><p>The <var>mantissa</var> is converted (if necessary) to an <code>xs:decimal</code> value, using an implementation of <code>xs:decimal</code> that imposes no limits on the <code>totalDigits</code> or <code>fractionDigits</code> facets. If there are several such values that are numerically equal to the <var>mantissa</var> (bearing in mind that if the <var>mantissa</var> is an <code>xs:double</code> or <code>xs:float</code>, the comparison will be done by converting the decimal value back to an <code>xs:double</code> or <code>xs:float</code>), the one that is chosen <span class="verb">should</span> be one with the smallest possible number of digits not counting leading or trailing zeroes (whether significant or insignificant). For example, 1.0 is preferred to 0.9999999999, and 100000000 is preferred to 100000001. This value is then rounded so that it uses no more than <code>maximum-fractional-part-size</code> digits in its fractional part. The <var>rounded number</var> is defined to be the result of converting the <var>mantissa</var> to an <code>xs:decimal</code> value, as described above, and then calling the function <a href="#func-round-half-to-even"><code>fn:round-half-to-even</code></a> with this converted number as the first argument and the <code>maximum-fractional-part-size</code> as the second argument, again with no limits on the <code>totalDigits</code> or <code>fractionDigits</code> in the result.</p></li><li><p>The absolute value of the <var>rounded number</var> is converted to a string in decimal notation, using the digits in the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a> to represent the ten decimal digits, and the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character to separate the integer part and the fractional part. This string must always contain a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup>, and it must contain no leading zeroes and no trailing zeroes. The value zero will at this stage be represented by a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> on its own.</p></li><li><p>If the number of digits to the left of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character is less than <var>minimum-integer-part-size</var>, leading <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-zero-digit">zero digit</a><sup><small>XP31</small></sup> characters are added to pad out to that size.</p></li><li><p>If the number of digits to the right of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character is less than <var>minimum-fractional-part-size</var>, trailing <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-zero-digit">zero digit</a><sup><small>XP31</small></sup> characters are added to pad out to that size.</p></li><li><p>For each integer <var>N</var> in the <var>integer-part-grouping-positions</var> list, a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup> character is inserted into the string immediately after that digit that appears in the integer part of the number and has <var>N</var> digits between it and the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character, if there is such a digit.</p></li><li><p>For each integer <var>N</var> in the <var>fractional-part-grouping-positions</var> list, a <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup> character is inserted into the string immediately before that digit that appears in the fractional part of the number and has <var>N</var> digits between it and the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character, if there is such a digit.</p></li><li><p>If there is no <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> character in the sub-picture, or if there are no digits to the right of the <var>decimal-separator</var> character in the string, then the <var>decimal-separator</var> character is removed from the string (it will be the rightmost character in the string).</p></li><li><p>If an <var>exponent</var> exists, then the string produced from the <var>mantissa</var> as described above is extended with the following, in order: (a) the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-exponent-separator">exponent-separator</a><sup><small>XP31</small></sup> character; (b) if the <var>exponent</var> is negative, the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-minus-sign">minus-sign</a><sup><small>XP31</small></sup> character; (c) the value of the <var>exponent</var> represented as a decimal integer, extended if necessary with leading zeroes to make it up to the <var>minimum exponent size</var>, using digits taken from the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a>.</p></li><li><p>The result of the function is the concatenation of the appropriate <var>prefix</var>, the string conversion of the number as obtained above, and the appropriate <var>suffix</var>.</p></li></ol></div></div><div class="div2"><h3><a id="trigonometry"></a>4.8 <a href="#trigonometry" style="text-decoration: none">Trigonometric and exponential functions</a></h3><p>The functions in this section perform trigonometric and other mathematical calculations on <code>xs:double</code> values. They are provided primarily for use in applications performing geometrical computation, for example when generating SVG graphics.</p><p>Functions are provided to support the six most commonly used trigonometric calculations: sine, cosine, and tangent, and their inverses arc sine, arc cosine, and arc tangent. Other functions such as secant, cosecant, and cotangent are not provided because they are easily computed in terms of these six.</p><p>The functions in this section (with the exception of <a href="#func-math-pi"><code>math:pi</code></a>) are specified by reference to <a href="#ieee754-2019">[IEEE 754-2019]</a>, where they appear as <em>Recommended operations</em> in section 9. IEEE defines these functions for a variety of floating point formats; this specification defines them only for <code>xs:double</code> values. The IEEE specification applies with the following caveats:</p><ol class="enumar"><li><p>IEEE states that the preferred quantum is language-defined. In this specification, it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p></li><li><p>IEEE states that certain functions should raise the inexact exception if the result is inexact. In this specification, this exception if it occurs does not result in an error. Any diagnostic information is outside the scope of this specification.</p></li><li><p>IEEE defines various rounding algorithms for inexact results, and states that the choice of rounding direction, and the mechanisms for influencing this choice, are language-defined. In this specification, the rounding direction and any mechanisms for influencing it are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p></li><li><p>Certain operations (such as taking the square root of a negative number) are defined in IEEE to signal the invalid operation exception and return a quiet <code>NaN</code>. In this specification, such operations return <code>NaN</code> and do not raise an error. The same policy applies to operations (such as taking the logarithm of zero) that raise a divide-by-zero exception. Any diagnostic information is outside the scope of this specification. </p></li><li><p>Operations whose mathematical result is greater than the largest finite <code>xs:double</code> value are defined in IEEE to signal the overflow exception; operations whose mathematical result is closer to zero than the smallest non-zero <code>xs:double</code> value are similarly defined in IEEE to signal the underflow exception. The treatment of these exceptions in this specification is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p></li></ol><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-pi"><code>math:pi</code></a></td><td>Returns an approximation to the mathematical constant <span style="font-family:Times; font-style:italic">π</span>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-e"><code>math:e</code></a></td><td>Returns an approximation to the mathematical constant <var>e</var>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-acos"><code>math:acos</code></a></td><td>Returns the arc cosine of the argument.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-asin"><code>math:asin</code></a></td><td>Returns the arc sine of the argument.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-atan"><code>math:atan</code></a></td><td>Returns the arc tangent of the argument.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-atan2"><code>math:atan2</code></a></td><td>Returns the angle in radians subtended at the origin by the point on a plane with coordinates (x, y) and the positive x-axis.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-cos"><code>math:cos</code></a></td><td>Returns the cosine of the argument. The argument is an angle in radians.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-cosh"><code>math:cosh</code></a></td><td>Returns the hyperbolic cosine of the argument.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-exp"><code>math:exp</code></a></td><td>Returns the value of <var>e</var><sup><i>x</i></sup> where <var>x</var> is the argument value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-exp10"><code>math:exp10</code></a></td><td>Returns the value of <code>10</code><sup><i>x</i></sup>, where <var>x</var> is the supplied argument value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-log"><code>math:log</code></a></td><td>Returns the natural logarithm of the argument.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-log10"><code>math:log10</code></a></td><td>Returns the base-ten logarithm of the argument.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-pow"><code>math:pow</code></a></td><td>Returns the result of raising the first argument to the power of the second.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-sin"><code>math:sin</code></a></td><td>Returns the sine of the argument. The argument is an angle in radians.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-sinh"><code>math:sinh</code></a></td><td>Returns the hyperbolic sine of the argument.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-sqrt"><code>math:sqrt</code></a></td><td>Returns the non-negative square root of the argument.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-tan"><code>math:tan</code></a></td><td>Returns the tangent of the argument. The argument is an angle in radians.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-math-tanh"><code>math:tanh</code></a></td><td>Returns the hyperbolic tangent of the argument.</td></tr></tbody></table><div class="div3"><h4><a id="func-math-pi"></a>4.8.1 <a href="#func-math-pi" style="text-decoration: none">math:pi</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an approximation to the mathematical constant <span style="font-family:Times; font-style:italic">π</span>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">math:pi</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:double</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>This function returns the <code>xs:double</code> value whose lexical representation is 3.141592653589793e0</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>2 * math:pi()</code></pre></div></td><td style="vertical-align:top"><p><code>6.283185307179586e0</code></p></td></tr><tr><td colspan="2"><p>The expression <code>60 * (math:pi() div 180)</code> converts an angle of 60 degrees to radians. </p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-e"></a>4.8.2 <a href="#func-math-e" style="text-decoration: none">math:e</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-math-cosh">next</a> | <a href="#func-format-number">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/1196">1196</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1216">1216</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1205">1205</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1230">1230</a>&nbsp;14 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an approximation to the mathematical constant <var>e</var>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">math:e</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:double</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>This function returns the <code>xs:double</code> value whose lexical representation is 2.718281828459045e0</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(math:e(), 0.05 * 3)</code></pre></div></td><td style="vertical-align:top"><p><code>1.161834242728283e0</code></p><p>(approximately)</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-acos"></a>4.8.3 <a href="#func-math-acos" style="text-decoration: none">math:acos</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the arc cosine of the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:acos</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the arc cosine of <code>$value</code>, as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>acos</code> function applied to 64-bit binary floating point values. The result is in the range zero to +<span style="font-family:Times; font-style:italic">π</span> radians.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>invalidOperation</code> exception is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. </p><p>If <code>$value</code> is <code>NaN</code>, or if its absolute value is greater than one, then the result is <code>NaN</code>.</p><p>In other cases, the result is an <code>xs:double</code> value representing an angle <span style="font-family:Times; font-style:italic">θ</span> in radians in the range <code>0</code> &lt;= <span style="font-family:Times; font-style:italic">θ</span> &lt;= <code>math:pi()</code>. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:acos(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:acos(0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.5707963267948966e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:acos(-0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.5707963267948966e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:acos(1.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:acos(-1.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>3.141592653589793e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:acos(2.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:acos(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:acos(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:acos(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-asin"></a>4.8.4 <a href="#func-math-asin" style="text-decoration: none">math:asin</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the arc sine of the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:asin</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the arc sine of <code>$value</code> as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>asin</code> function applied to 64-bit binary floating point values. The result is in the range -<span style="font-family:Times; font-style:italic">π</span>/2 to +<span style="font-family:Times; font-style:italic">π</span>/2 radians. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>invalidOperation</code> and <code>underflow</code> exceptions is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. </p><p>If <code>$value</code> is positive or negative zero, the result is <code>$value</code>.</p><p>If <code>$value</code> is <code>NaN</code>, or if its absolute value is greater than one, then the result is <code>NaN</code>.</p><p>In other cases, the result is an <code>xs:double</code> value representing an angle <span style="font-family:Times; font-style:italic">θ</span> in radians in the range <code>-math:pi() div 2</code> &lt;= <span style="font-family:Times; font-style:italic">θ</span> &lt;= <code>math:pi() div 2</code>. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:asin(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:asin(0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:asin(-0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:asin(1.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.5707963267948966e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:asin(-1.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-1.5707963267948966e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:asin(2.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:asin(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:asin(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:asin(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-atan"></a>4.8.5 <a href="#func-math-atan" style="text-decoration: none">math:atan</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the arc tangent of the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:atan</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the arc tangent of <code>$value</code>, as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>atan</code> function applied to 64-bit binary floating point values. The result is in the range -<span style="font-family:Times; font-style:italic">π</span>/2 to +<span style="font-family:Times; font-style:italic">π</span>/2 radians.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>underflow</code> exception is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. </p><p>If <code>$value</code> is positive or negative zero, the result is <code>$value</code>.</p><p>If <code>$value</code> is <code>NaN</code> then the result is <code>NaN</code>.</p><p>In other cases, the result is an <code>xs:double</code> value representing an angle <span style="font-family:Times; font-style:italic">θ</span> in radians in the range <code>-math:pi() div 2</code> &lt;= <span style="font-family:Times; font-style:italic">θ</span> &lt;= <code>math:pi() div 2</code>. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan(0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan(-0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan(1.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.7853981633974483e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan(-1.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.7853981633974483e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>1.5707963267948966e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>-1.5707963267948966e0</code></p><p>(approximately)</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-atan2"></a>4.8.6 <a href="#func-math-atan2" style="text-decoration: none">math:atan2</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the angle in radians subtended at the origin by the point on a plane with coordinates (x, y) and the positive x-axis.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:atan2</code>(</td></tr><tr class="arg"><td><code>$y</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double</code></code>,</td><td></td></tr><tr class="arg"><td><code>$x</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The result is the value of <code>atan2(y, x)</code> as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>atan2</code> function applied to 64-bit binary floating point values. The result is in the range -<span style="font-family:Times; font-style:italic">π</span> to +<span style="font-family:Times; font-style:italic">π</span> radians.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>underflow</code> exception is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. The following rules apply when the values are finite and non-zero, (subject to rules for overflow, underflow, and approximation).</p><p>If either argument is <code>NaN</code> then the result is <code>NaN</code>.</p><p>If <code>$x</code> is positive, then the value of <code>atan2($y, $x)</code> is <code>atan($y div $x)</code>.</p><p>If <code>$x</code> is negative, then:</p><ul><li><p>If <code>$y</code> is positive, then the value of <code>atan2($y, $x)</code> is <code>atan($y div $x) + <span style="font-family:Times; font-style:italic">π</span></code>.</p></li><li><p>If <code>$y</code> is negative, then the value of <code>atan2($y, $x)</code> is <code>atan($y div $x) - <span style="font-family:Times; font-style:italic">π</span></code>.</p></li></ul><p>Some results for special values of the arguments are shown in the examples below.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(+0.0e0, 0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(-0.0e0, 0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(+0.0e0, -0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>3.141592653589793e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(-0.0e0, -0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-3.141592653589793e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(-1, 0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-1.5707963267948966e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(+1, 0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.5707963267948966e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(-0.0e0, -1)</code></pre></div></td><td style="vertical-align:top"><p><code>-3.141592653589793e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(+0.0e0, -1)</code></pre></div></td><td style="vertical-align:top"><p><code>3.141592653589793e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(-0.0e0, +1)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:atan2(+0.0e0, +1)</code></pre></div></td><td style="vertical-align:top"><p><code>+0.0e0</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-cos"></a>4.8.7 <a href="#func-math-cos" style="text-decoration: none">math:cos</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the cosine of the argument. The argument is an angle in radians.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:cos</code>(</td></tr><tr class="arg"><td><code>$radians</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$radians</code> is the empty sequence, the function returns the empty sequence.</p><p>If <code>$radians</code> is positive or negative infinity, or <code>NaN</code>, then the result is <code>NaN</code>.</p><p>Otherwise the result is the cosine of <code>$radians</code> (which is treated as an angle in radians) as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>cos</code> function applied to 64-bit binary floating point values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>invalidOperation</code> exception is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. </p><p>If <code>$radians</code> is positive or negative zero, the result is <code>$radians</code>.</p><p>If <code>$radians</code>is positive or negative infinity, or <code>NaN</code>, then the result is <code>NaN</code>.</p><p>Otherwise the result is always in the range -1.0e0 to +1.0e0</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cos(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cos(0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cos(-0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cos(math:pi() div 2)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cos(-math:pi() div 2)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cos(math:pi())</code></pre></div></td><td style="vertical-align:top"><p><code>-1.0e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cos(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cos(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cos(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-cosh"></a>4.8.8 <a href="#func-math-cosh" style="text-decoration: none">math:cosh</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-math-sinh">next</a> | <a href="#func-math-e">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/1196">1196</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1216">1216</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1205">1205</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1230">1230</a>&nbsp;14 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the hyperbolic cosine of the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:cosh</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the hyperbolic cosine of <code>$value</code> as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>cosh</code> function applied to 64-bit binary floating point values. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>overflow</code> exception is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. </p><p>If <code>$value</code> is positive or negative zero, the result is <code>1</code>.</p><p>If <code>$value</code> is positive or negative infinity, the result is <code>INF</code>.</p><p>If <code>$value</code> is <code>NaN</code>, the result is <code>NaN</code>.</p><p>In other cases, the result is an <code>xs:double</code> in the range <code>+1.0</code> to <code>INF</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cosh(0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:cosh(math:pi())</code></pre></div></td><td style="vertical-align:top"><p><code>11.591953275521519e0</code></p><p>(approximately)</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-exp"></a>4.8.9 <a href="#func-math-exp" style="text-decoration: none">math:exp</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the value of <var>e</var><sup><i>x</i></sup> where <var>x</var> is the argument value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:exp</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the mathematical constant <var>e</var> raised to the power of <code>$value</code>, as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>exp</code> function applied to 64-bit binary floating point values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of overflow and underflow is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp(0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp(1)</code></pre></div></td><td style="vertical-align:top"><p><code>2.7182818284590455e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp(2)</code></pre></div></td><td style="vertical-align:top"><p><code>7.38905609893065e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp(-1)</code></pre></div></td><td style="vertical-align:top"><p><code>0.36787944117144233e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp(math:pi())</code></pre></div></td><td style="vertical-align:top"><p><code>23.140692632779267e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-exp10"></a>4.8.10 <a href="#func-math-exp10" style="text-decoration: none">math:exp10</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the value of <code>10</code><sup><i>x</i></sup>, where <var>x</var> is the supplied argument value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:exp10</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is ten raised to the power of <code>$value</code>, as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>exp10</code> function applied to 64-bit binary floating point values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of overflow and underflow is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp10(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp10(0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp10(1)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp10(0.5)</code></pre></div></td><td style="vertical-align:top"><p><code>3.1622776601683795e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp10(-1)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e-1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp10(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp10(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:exp10(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-log"></a>4.8.11 <a href="#func-math-log" style="text-decoration: none">math:log</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the natural logarithm of the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:log</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the natural logarithm of <code>$value</code>, as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>log</code> function applied to 64-bit binary floating point values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of <code>divideByZero</code> and <code>invalidOperation</code> exceptions is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. <span>The effect is that if the argument is zero, the result is <code>-INF</code>, and if it is negative, the result is <code>NaN</code></span>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('-INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(math:exp(1))</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(1.0e-3)</code></pre></div></td><td style="vertical-align:top"><p><code>-6.907755278982137e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(2)</code></pre></div></td><td style="vertical-align:top"><p><code>0.6931471805599453e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(-1)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-log10"></a>4.8.12 <a href="#func-math-log10" style="text-decoration: none">math:log10</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the base-ten logarithm of the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:log10</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the base-10 logarithm of <code>$value</code>, as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>log10</code> function applied to 64-bit binary floating point values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of <code>divideByZero</code> and <code>invalidOperation</code> exceptions is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. <span>The effect is that if the argument is zero, the result is <code>-INF</code>, and if it is negative, the result is <code>NaN</code></span>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log10(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log10(0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('-INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log10(1.0e3)</code></pre></div></td><td style="vertical-align:top"><p><code>3.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log10(1.0e-3)</code></pre></div></td><td style="vertical-align:top"><p><code>-3.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log10(2)</code></pre></div></td><td style="vertical-align:top"><p><code>0.3010299956639812e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log10(-1)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log10(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log10(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:log10(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-pow"></a>4.8.13 <a href="#func-math-pow" style="text-decoration: none">math:pow</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the result of raising the first argument to the power of the second.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:pow</code>(</td></tr><tr class="arg"><td><code>$x</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$y</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:numeric</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$x</code> is the empty sequence, the function returns the empty sequence.</p><p>If <code>$y</code> is an instance of <code>xs:integer</code>, the result is <code>$x</code> raised to the power of <code>$y</code> as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>pown</code> function applied to a 64-bit binary floating point value and an integer.</p><p>Otherwise <code>$y</code> is cast to an <code>xs:double</code>, and the result is <code>$x</code> raised to the power of <code>$y</code> as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>pow</code> function applied to two 64-bit binary floating point values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>divideByZero</code> and <code>invalidOperation</code> exceptions is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. Some of the consequences are illustrated in the examples below.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow((), 93.7)</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(2, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>8.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-2, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>-8.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(2, -3)</code></pre></div></td><td style="vertical-align:top"><p><code>0.125e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-2, -3)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.125e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(2, 0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0, 0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(xs:double('INF'), 0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(xs:double('NaN'), 0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-math:pi(), 0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0e0, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0e0, 4)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-0e0, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0, 4)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0e0, -3)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0e0, -4)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-0e0, -3)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('-INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0, -4)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(16, 0.5e0)</code></pre></div></td><td style="vertical-align:top"><p><code>4.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(16, 0.25e0)</code></pre></div></td><td style="vertical-align:top"><p><code>2.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0e0, -3.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-0e0, -3.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('-INF')</code></p><p><em>(Odd-valued whole numbers are treated specially).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0e0, -3.1e0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-0e0, -3.1e0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0e0, 3.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-0e0, 3.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p><p><em>(Odd-valued whole numbers are treated specially).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(0e0, 3.1e0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-0e0, 3.1e0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-1, xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-1, xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(1, xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(1, xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(1, xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-2.5e0, 2.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>6.25e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:pow(-2.5e0, 2.00000001e0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-sin"></a>4.8.14 <a href="#func-math-sin" style="text-decoration: none">math:sin</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the sine of the argument. The argument is an angle in radians.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:sin</code>(</td></tr><tr class="arg"><td><code>$radians</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$radians</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the sine of <code>$radians</code> (which is treated as an angle in radians) as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>sin</code> function applied to 64-bit binary floating point values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>invalidOperation</code> and <code>underflow</code> exceptions is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. </p><p>If <code>$radians</code> is positive or negative zero, the result is <code>$radians</code>.</p><p>If <code>$radians</code> is positive or negative infinity, or <code>NaN</code>, then the result is <code>NaN</code>.</p><p>Otherwise the result is always in the range -1.0e0 to +1.0e0</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sin(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sin(0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sin(-0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sin(math:pi() div 2)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sin(-math:pi() div 2)</code></pre></div></td><td style="vertical-align:top"><p><code>-1.0e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sin(math:pi())</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sin(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sin(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sin(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-sinh"></a>4.8.15 <a href="#func-math-sinh" style="text-decoration: none">math:sinh</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-math-tanh">next</a> | <a href="#func-math-cosh">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/1196">1196</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1216">1216</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1205">1205</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1230">1230</a>&nbsp;14 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the hyperbolic sine of the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:sinh</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the hyperbolic sine of <code>$value</code> as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>sinh</code> function applied to 64-bit binary floating point values. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>overflow</code> and <code>underflow</code> exceptions is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. </p><p>If <code>$value</code> is positive or negative zero, the result is <code>$value</code>.</p><p>If <code>$value</code> is positive or negative infinity, or <code>NaN</code>, the result is <code>NaN</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sinh(1)</code></pre></div></td><td style="vertical-align:top"><p><code>1.1752011936438014e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sinh(math:pi())</code></pre></div></td><td style="vertical-align:top"><p><code>11.548739357257748e0</code></p><p>(approximately)</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-sqrt"></a>4.8.16 <a href="#func-math-sqrt" style="text-decoration: none">math:sqrt</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the non-negative square root of the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:sqrt</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the mathematical non-negative square root of <code>$value</code> as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>squareRoot</code> function applied to 64-bit binary floating point values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>invalidOperation</code> exception is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. The effect is that if the argument is less than zero, the result is <code>NaN</code>.</p><p>If <code>$value</code> is positive or negative zero, positive infinity, or <code>NaN</code>, then the result is <code>$value</code>. (Negative zero is the only case where the result can have negative sign)</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sqrt(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sqrt(0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sqrt(-0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sqrt(1.0e6)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sqrt(2.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>1.4142135623730951e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sqrt(-2.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sqrt(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sqrt(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('INF')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:sqrt(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-tan"></a>4.8.17 <a href="#func-math-tan" style="text-decoration: none">math:tan</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the tangent of the argument. The argument is an angle in radians.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:tan</code>(</td></tr><tr class="arg"><td><code>$radians</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$radians</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the tangent of <code>$radians</code> (which is treated as an angle in radians) as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>tan</code> function applied to 64-bit binary floating point values.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>invalidOperation</code> and <code>underflow</code> exceptions is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. </p><p>If <code>$radians</code> is positive or negative infinity, or <code>NaN</code>, then the result is <code>NaN</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tan(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tan(0)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tan(-0.0e0)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tan(math:pi() div 4)</code></pre></div></td><td style="vertical-align:top"><p><code>1.0e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tan(-math:pi() div 4)</code></pre></div></td><td style="vertical-align:top"><p><code>-1.0e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>1 div math:tan(math:pi() div 2)</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p><p>(approximately)</p><p><em>(Mathematically, <em>tan(π/2)</em> is positive infinity. But because <code>math:pi() div 2</code> returns an approximation, the result of <code>math:tan(math:pi() div 2)</code> will be a large but finite number.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>1 div math:tan(-math:pi() div 2)</code></pre></div></td><td style="vertical-align:top"><p><code>-0.0e0</code></p><p>(approximately)</p><p><em>(Mathematically, <em>tan(-π/2)</em> is negative infinity. But because <code>-math:pi() div 2</code> returns an approximation, the result of <code>math:tan(-math:pi() div 2)</code> will be a large but finite negative number.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tan(math:pi())</code></pre></div></td><td style="vertical-align:top"><p><code>0.0e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tan(xs:double('NaN'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tan(xs:double('INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tan(xs:double('-INF'))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:double('NaN')</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-math-tanh"></a>4.8.18 <a href="#func-math-tanh" style="text-decoration: none">math:tanh</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-random-number-generator">next</a> | <a href="#func-math-sinh">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/1196">1196</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1216">1216</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1205">1205</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1230">1230</a>&nbsp;14 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the hyperbolic tangent of the argument.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">math:tanh</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the result is the hyperbolic tangent of <code>$value</code> as defined in the <a href="#ieee754-2019">[IEEE 754-2019]</a> specification of the <code>tanh</code> function applied to 64-bit binary floating point values. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The treatment of the <code>underflow</code> exception is defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>. </p><p>If <code>$value</code> is positive or negative zero, the result is <code>$value</code>.</p><p>If <code>$value</code> is positive infinity, the result is <code>+1.0</code>.</p><p>If <code>$value</code> is negative infinity, the result is <code>-1.0</code>.</p><p>In other cases, the result is an <code>xs:double</code> in the range <code>-1.0</code> to <code>+1.0</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tanh(1)</code></pre></div></td><td style="vertical-align:top"><p><code>0.7615941559557649e0</code></p><p>(approximately)</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>math:tanh(math:pi())</code></pre></div></td><td style="vertical-align:top"><p><code>0.99627207622075e0</code></p><p>(approximately)</p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="random-numbers"></a>4.9 <a href="#random-numbers" style="text-decoration: none">Random Numbers</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-random-number-generator"><code>fn:random-number-generator</code></a></td><td>Returns a random number generator, which can be used to generate sequences of random numbers.</td></tr></tbody></table><p>The function makes use of the record structure defined in the next section.</p><div class="div3"><h4><a id="random-number-generator-record"></a>4.9.1 <a href="#random-number-generator-record" style="text-decoration: none">Record fn:random-number-generator-record</a></h4><p>This record type is used to represent the result of a call on the <a href="#func-random-number-generator"><code>fn:random-number-generator</code></a> function.</p><table class="fos-options"><thead><tr><th>Name</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>number</code></p></td><td class="fos-thin"><p>An <code>xs:double</code> greater than or equal to zero (0.0e0), and less than one (1.0e0).</p><ul><li><p><b>Type: </b><code>xs:double</code></p></li></ul></td></tr><tr><td><p><code>next</code></p></td><td class="fos-thin"><p>A zero-arity function that can be called to return another random number generator.</p><p>The properties of this function are as follows:</p><ul><li><p>name: absent</p></li><li><p>parameter names: ()</p></li><li><p>signature: <code>() =&gt; random-number-generator-record</code></p></li><li><p>non-local variable bindings: none</p></li><li><p>implementation: implementation-dependent</p></li></ul><ul><li><p><b>Type: </b><code>fn() as random-number-generator-record</code></p></li></ul></td></tr><tr><td><p><code>permute</code></p></td><td class="fos-thin"><p>A function with arity 1 (one), which takes an arbitrary sequence as its argument, and returns a random permutation of that sequence.</p><p>The properties of this function are as follows:</p><ul><li><p>name: absent</p></li><li><p>parameter names: <code>"arg"</code></p></li><li><p>signature: <code>(item()*) =&gt; item()*</code></p></li><li><p>non-local variable bindings: none</p></li><li><p>body: implementation-dependent</p></li></ul><ul><li><p><b>Type: </b><code>function(item()*) as item()*</code></p></li></ul></td></tr></tbody></table></div><div class="div3"><h4><a id="func-random-number-generator"></a>4.9.2 <a href="#func-random-number-generator" style="text-decoration: none">fn:random-number-generator</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-codepoints-to-string">next</a> | <a href="#func-math-tanh">previous</a>)</p><ol><li><p>The 3.1 specification suggested that every value in the result range should have the same chance of being chosen. This has been corrected to say that the distribution should be arithmetically uniform (because there are as many <code>xs:double</code> values between 0.01 and 0.1 as there are between 0.1 and 1.0).</p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a random number generator, which can be used to generate sequences of random numbers.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:random-number-generator</code>(</td></tr><tr class="arg"><td><code>$seed</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code class="return-type-ref"><a href="#random-number-generator-record">random-number-generator-record</a></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a random number generator. A random number generator is represented as a value of type <code>random-number-generator-record</code>, defined in <a href="#random-number-generator-record"><b>4.9.1 Record fn:random-number-generator-record</b></a>.</p><p>Calling the <a href="#func-random-number-generator"><code>fn:random-number-generator</code></a> function with no arguments is equivalent to calling the single-argument form of the function with an implementation-dependent seed.</p><p>Calling the <a href="#func-random-number-generator"><code>fn:random-number-generator</code></a> function with the empty sequence as <code>$seed</code> is equivalent to calling the single-argument form of the function with an implementation-dependent seed.</p><p>If a <code>$seed</code> is supplied, it may be an atomic item of any type.</p><p>Both forms of the function are <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>: calling the function twice with the same arguments, within a single <a title="execution scope" class="termref" href="#execution-scope">execution scope</a>, produces the same results.</p><p>The value of the <code>number</code> entry <span class="verb">should</span> be such that <span>the distribution of numbers is uniform: for example, the probability of the number being in the range 0.1e0 to 0.2e0 is the same as the probability of its being in the range 0.8e0 to 0.9e0</span>.</p><p>The function returned in the <code>permute</code> entry <span class="verb">should</span> be such that all permutations of the supplied sequence are equally likely to be chosen.</p><p>The map returned by the <a href="#func-random-number-generator"><code>fn:random-number-generator</code></a> function <span class="verb">may</span> contain additional entries beyond those specified here, but it <span class="verb">must</span> match the <span>record type defined above</span>. The meaning of any additional entries is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. To avoid conflict with any future version of this specification, the keys of any such entries <span class="verb">should</span> start with an underscore character.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>It is not meaningful to ask whether the functions returned in the <code>next</code> and <code>permute</code> functions resulting from two separate calls with the same seed are “the same function”, but the functions must be equivalent in the sense that calling them produces the same sequence of random numbers.</p><p>The repeatability of the results of function calls in different execution scopes is outside the scope of this specification. It is <span class="verb">recommended</span> that when the same seed is provided explicitly, the same random number sequence should be delivered even in different execution scopes; while if no seed is provided, the processor should choose a seed that is likely to be different from one execution scope to another. (The same effect can be achieved explicitly by using <code>fn:current-dateTime()</code> as a seed.)</p><p>The specification does not place strong conformance requirements on the actual randomness of the result; this is left to the implementation. It is desirable, for example, when generating a sequence of random numbers that the sequence should not get into a repeating loop; but the specification does not attempt to dictate this.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The following example returns a random permutation of the integers in the range <code>1</code> to <code>100</code>:</p></td></tr><tr><td colspan="2"><p><code>random-number-generator()?permute(1 to 100)</code></p></td></tr><tr><td colspan="2"><p>The following example returns a 10% sample of the items in an input sequence <code>$seq</code>, chosen at random:</p></td></tr><tr><td colspan="2"><p><code>random-number-generator()?permute($seq)[1 to (count($seq) idiv 10)]</code></p></td></tr><tr><td colspan="2"><p>The following XQuery code produces a random sequence of 200 <code>xs:double</code> values in the range zero to one:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">declare %public function local:random-sequence($length as xs:integer) as xs:double* {
  local:random-sequence($length, random-number-generator())
};
declare %private function local:random-sequence(
  $length as xs:integer, 
  $record as record(number as xs:double, next as fn(*))
) as xs:double* {
  if ($length != 0) {
    $record?number,
    local:random-sequence($length - 1, $record?next())
  }
};
local:random-sequence(200)</pre></div></td></tr><tr><td colspan="2"><p>An equivalent result can be achieved with <a href="#func-fold-left"><code>fn:fold-left</code></a>:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">tail(fold-left(
  (1 to 200),
  random-number-generator(),
  fn($result) { head($result) ! (?next(), ?number), tail($result) }
))</pre></div></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="string-functions"></a>5 <a href="#string-functions" style="text-decoration: none">Processing strings</a></h2><p>This section specifies functions and operators on the <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a><code>xs:string</code> datatype and the datatypes derived from it.</p><div class="div2"><h3><a id="string-types"></a>5.1 <a href="#string-types" style="text-decoration: none">String types</a></h3><p>The operators described in this section are defined on the following types.</p><div class="type-hierarchy-figure"><div class="hier"><ul class="type-hierarchy type-colors"><li class="primitive special root"><ul><li class="primitive"><p class="item"><span>string</span></p><ul><li class="built-in-atomic"><p class="first"><span>normalizedString</span></p><ul><li class="built-in-atomic"><p class="first"><span>token</span></p><ul><li class="built-in-atomic"><p class="first"><span>language</span></p></li><li class="built-in-atomic"><p class="last"><span>NMTOKEN</span></p></li><li class="built-in-atomic"><p class="item"><span>Name</span></p><ul><li class="built-in-atomic"><p class="first"><span>NCName</span></p><ul><li class="built-in-atomic"><p class="first"><span>ENTITY</span></p></li><li class="built-in-atomic"><p class="item"><span>ID</span></p></li><li class="built-in-atomic"><p class="last"><span>IDREF</span></p></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></div><div class="legend"><p>Legend:</p><ul class="type-hierarchy type-colors"><li><p class="root"><span>Supertype</span></p><ul><li><p><span>subtype</span></p></li></ul></li></ul><ul class="type-legend type-colors"><li class="built-in-atomic"><p><span>Built-in atomic types</span></p></li></ul></div></div><p>They also apply to user-defined types derived by restriction from the above types. </p></div><div class="div2"><h3><a id="func-assemble-disassemble-string"></a>5.2 <a href="#func-assemble-disassemble-string" style="text-decoration: none">Functions to assemble and disassemble strings</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-codepoints-to-string"><code>fn:codepoints-to-string</code></a></td><td>Returns an <code>xs:string</code> whose characters have supplied <a title="codepoint" class="termref" href="#codepoint">codepoints</a>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-string-to-codepoints"><code>fn:string-to-codepoints</code></a></td><td>Returns the sequence of <a title="codepoint" class="termref" href="#codepoint">codepoints</a> that constitute an <code>xs:string</code> value. </td></tr></tbody></table><div class="div3"><h4><a id="func-codepoints-to-string"></a>5.2.1 <a href="#func-codepoints-to-string" style="text-decoration: none">fn:codepoints-to-string</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#unicode-case-insensitive-collation">next</a> | <a href="#func-random-number-generator">previous</a>)</p><ol><li><p>It is no longer automatically an error if the input contains a codepoint that is not valid in XML. Instead, the codepoint must be a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. The set of permitted characters is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but it is <span class="verb">recommended</span> that all Unicode characters should be accepted.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/414">414</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/546">546</a>&nbsp;25 July 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an <code>xs:string</code> whose characters have supplied <a title="codepoint" class="termref" href="#codepoint">codepoints</a>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:codepoints-to-string</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the string made up from the <a title="character" class="termref" href="#character">characters</a> whose Unicode <a title="codepoint" class="termref" href="#codepoint">codepoints</a> are supplied in <code>$values</code>. This will be the zero-length string if <code>$values</code> is the empty sequence. </p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOCH0001" title="err:FOCH0001">err:FOCH0001</a>] if any of the codepoints in <code>$values</code> is not a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>codepoints-to-string((66, 65, 67, 72))</code></pre></div></td><td style="vertical-align:top"><p><code>"BACH"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>codepoints-to-string((2309, 2358, 2378, 2325))</code></pre></div></td><td style="vertical-align:top"><p><code>"अशॊक"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>codepoints-to-string(())</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>codepoints-to-string(0)</code></pre></div></td><td style="vertical-align:top"><p>Raises error FOCH0001.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-string-to-codepoints"></a>5.2.2 <a href="#func-string-to-codepoints" style="text-decoration: none">fn:string-to-codepoints</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the sequence of <a title="codepoint" class="termref" href="#codepoint">codepoints</a> that constitute an <code>xs:string</code> value. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:string-to-codepoints</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence of integers, each integer being the Unicode <a title="codepoint" class="termref" href="#codepoint">codepoint</a> of the corresponding <a title="character" class="termref" href="#character">character</a> in <code>$value</code>.</p><p>If <code>$value</code> is a zero-length string or the empty sequence, the function returns the empty sequence.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>string-to-codepoints("Thérèse")</code></pre></div></td><td style="vertical-align:top"><p><code>84, 104, 233, 114, 232, 115, 101</code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="string-compare"></a>5.3 <a href="#string-compare" style="text-decoration: none">Comparison of strings</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-codepoint-equal"><code>fn:codepoint-equal</code></a></td><td>Returns <code>true</code> if two strings are equal, considered codepoint-by-codepoint.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-collation"><code>fn:collation</code></a></td><td>Constructs a collation URI with requested properties.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-collation-available"><code>fn:collation-available</code></a></td><td>Asks whether a collation URI is recognized by the implementation, and whether it has required properties.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-collation-key"><code>fn:collation-key</code></a></td><td>Given a string value and a collation, generates an internal value called a collation key, with the property that the matching and ordering of collation keys reflects the matching and ordering of strings under the specified collation.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-contains-token"><code>fn:contains-token</code></a></td><td>Determines whether or not any of the supplied strings, when tokenized at whitespace boundaries, contains the supplied token, under the rules of the supplied collation.</td></tr></tbody></table><div class="div3"><h4><a id="collations"></a>5.3.1 <a href="#collations" style="text-decoration: none">Collations</a></h4><p><span class="termdef"><a id="dt-collation"></a>[Definition] A <b>collation</b> is an algorithm that determines, for any two given strings <var>S<sub>1</sub></var> and <var>S<sub>2</sub></var>, whether <var>S<sub>1</sub></var> is less than, equal to, or greater than <var>S<sub>2</sub></var>. In this specification, a collation is identified by an absolute URI.</span></p><p>The <a href="#charmod">[Character Model for the World Wide Web 1.0: Fundamentals]</a> observes that different applications may require different comparison and ordering behaviors. Similarly, different users with different linguistic expectations may require different behaviors. Consequently, the collation must be taken into account when comparing strings.</p><p>Collations can indicate that two different codepoints are to be considered equal for comparison purposes (for example, “v” and “w” are considered equivalent in some Swedish collations). Strings can be compared codepoint-by-codepoint or in a linguistically appropriate manner.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Some sources, for example <a href="#UNICODE-TR10">[UTS #10]</a> use the term <b>collation</b> to refer more generically to a set of sorting rules that can be further parameterized or “tailored”. In this specification the term is always used for a specific algorithm in which all such parameters have defined values.</p></div><p>This specification defines some collation URIs that provide interoperable sorting behavior across applications. Other collation URIs are defined only partially (leaving some aspects implementation-defined). Implementations may define further collation URIs, or may allow users or third parties to define them.</p><p>The <a title="Unicode codepoint collation" class="termref" href="#dt-codepoint-collation">Unicode codepoint collation</a> is available in every implementation. This collation sorts based on codepoint values. For further details see <a href="#codepoint-collation"><b>5.3.3 The Unicode Codepoint Collation</b></a>.</p><p>Collations may or may not perform Unicode normalization on strings before comparing them.</p><p>This specification allows a collation name to be provided as an argument to many string functions. Although collations are defined to be URIs, they are supplied as instances of <code>xs:string</code>.</p><p>The XQuery/XPath static context supplies a default collation for use when the collation argument is not specified. (see <a href="https://www.w3.org/TR/xpath-31/#static_context"> 2.1.1 Static Context </a><sup><small>XP31</small></sup>). If the default collation is not specified by the user or the system, the default collation is the <a title="Unicode codepoint collation" class="termref" href="#dt-codepoint-collation">Unicode codepoint collation</a>.</p><p>If the collation is specified using a relative URI reference, it is resolved relative to an <a title="" class="termref" href="#impl-def">implementation-defined</a> base URI.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Previous versions of this specification stated that it must be resolved against the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-static-base-uri">Static Base URI</a><sup><small>XP</small></sup>, but this is not always operationally convenient. It is <span class="verb">recommended</span> that processors should provide a means of setting the base URI for resolving collation URIs independently of the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-static-base-uri">Static Base URI</a><sup><small>XP</small></sup>, though for backwards compatibility, the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-static-base-uri">Static Base URI</a><sup><small>XP</small></sup> or <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">Executable Base URI</a><sup><small>XP</small></sup> should be used as a default.</p></div><p>This specification does not define whether or not the collation URI is dereferenced. The collation URI may be an abstract identifier, or it may refer to an actual resource describing the collation. If it refers to a resource, this specification does not define the nature of that resource. One possible candidate is that the resource is a locale description expressed using the Locale Data Markup Language: see <a href="#UNICODE-TR35">[UTS #35]</a>. </p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>XML allows elements to specify the <code>xml:lang</code> attribute to indicate the language associated with the content of such an element. This specification does not use <code>xml:lang</code> to identify the default collation because using <code>xml:lang</code> does not produce desired effects when the two strings to be compared have different <code>xml:lang</code> values or when a string is multilingual. </p></div></div><div class="div3"><h4><a id="collation-capabilities"></a>5.3.2 <a href="#collation-capabilities" style="text-decoration: none">Collation Capabilities</a></h4><p>All collations support the ability to compare two strings to decide whether they are equal, and if not, which one should sort first. This must always define a total ordering, which implies that the comparison is transitive.</p><p>A collation may (or may not) support the ability to derive a <b>collation key</b> for a given string. A collation key is a binary value obtained as a function of a string <var>S</var> and a collation <var>C</var>, such that the collation keys for two strings <var>S<sub>1</sub></var> and <var>S<sub>2</sub></var> have the same ordering relationship (less than, equal, or greater than) as the two strings themselves, when compared under the relevant collation. Collation keys are useful for operations such as indexing, because they can be used as keys in maps. They are available using the <a href="#func-collation-key"><code>fn:collation-key</code></a> function.</p><p>Furthermore, a collation may (or may not) support the ability to determine whether one string is a substring of another under that collation. The use of collations in substring matching is described in <a href="#substring.functions"><b>5.5 Functions based on substring matching</b></a>.</p><p>The capabilities of a collation may be determined using the <a href="#func-collation-available"><code>fn:collation-available</code></a> function.</p></div><div class="div3"><h4><a id="codepoint-collation"></a>5.3.3 <a href="#codepoint-collation" style="text-decoration: none">The Unicode Codepoint Collation</a></h4><p><span class="termdef"><a id="dt-codepoint-collation"></a>[Definition] The collation URI <code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code> identifies a collation which must be recognized by every implementation: it is referred to as the <b>Unicode codepoint collation</b> (not to be confused with the Unicode collation algorithm).</span></p><p>The Unicode codepoint collation does not perform any normalization on the supplied strings.</p><p>The collation is defined as follows. Each of the two strings is converted to a sequence of integers using the <a href="#func-string-to-codepoints"><code>fn:string-to-codepoints</code></a> function. These two sequences <code>$A</code> and <code>$B</code> are then compared as follows: </p><ol class="enumar"><li><p>If both sequences are empty, the strings are equal.</p></li><li><p>If one sequence is empty and the other is not, then the string corresponding to the empty sequence is less than the other string.</p></li><li><p>If the first integer in <code>$A</code> is less than the first integer in <code>$B</code>, then the string corresponding to <code>$A</code> is less than the string corresponding to <code>$B</code>. </p></li><li><p>If the first integer in <code>$A</code> is greater than the first integer in <code>$B</code>, then the string corresponding to <code>$A</code> is greater than the string corresponding to <code>$B</code>.</p></li><li><p>Otherwise (the first pair of integers are equal), the result is obtained by applying the same rules recursively to <code>fn:tail($A)</code> and <code>fn:tail($B)</code></p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>While the Unicode codepoint collation does not produce results suitable for quality publishing of printed indexes or directories, it is adequate for many purposes where a restricted alphabet is used, such as sorting of vehicle registrations.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>The Unicode codepoint collation differs from the default sort order used in programming languages that sort strings based on UTF-16 code units, which may include surrogate pairs.</p></div></div><div class="div3"><h4><a id="uca-collations"></a>5.3.4 <a href="#uca-collations" style="text-decoration: none">The Unicode Collation Algorithm</a></h4><p>This specification defines a family of collation URIs representing tailorings of the Unicode Collation Algorithm (UCA) as defined in <a href="#UNICODE-TR10">[UTS #10]</a>. The parameters used for tailoring the UCA are based on the parameters defined in the Locale Data Markup Language (LDML), defined in <a href="#UNICODE-TR35">[UTS #35]</a>.</p><p>This family of URIs use the scheme and path <code>http://www.w3.org/2013/collation/UCA</code> followed by an optional query part. The query part, if present, consists of a question mark followed by a sequence of zero or more semicolon-separated parameters. Each parameter is a keyword-value pair, the keyword and value being separated by an equals sign.</p><p>All implementations must recognize URIs in this family in the <code>collation</code> argument of functions that take a collation argument.</p><p>If the <code>fallback</code> parameter is present with the value <code>no</code>, then the implementation <span class="verb">must</span> either use a collation that conforms with the rules in the Unicode specifications for the requested tailoring, or fail with a static or dynamic error indicating that it does not provide the collation (the error code should be the same as if the collation URI were not recognized). If the <code>fallback</code> parameter is omitted or takes the value <code>yes</code>, and if the collation URI is well-formed according to the rules in this section, then the implementation <span class="verb">must</span> accept the collation URI, and <span class="verb">should</span> use the available collation that most closely reflects the user’s intentions. For example, if the collation URI requested is <code>http://www.w3.org/2013/collation/UCA?lang=se;fallback=yes</code> and the implementation does not include a fully conformant version of the UCA tailored for Swedish, then it <span class="verb">may</span> choose to use a Swedish collation that is known to differ from the UCA definition, or one whose conformance has not been established. It might even, as a last resort, fall back to using codepoint collation.</p><p>If two query parameters use the same keyword then the last one wins. If a query parameter uses a keyword or value which is not defined in this specification then the meaning is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the implementation recognizes the meaning of the keyword and value then it <span class="verb">should</span> interpret it accordingly; if it does not recognize the keyword or value then if the <code>fallback</code> parameter is present with the value <code>no</code> it should reject the collation as unsupported, otherwise it should ignore the unrecognized parameter.</p><p>The following query parameters are defined. If any parameter is absent, the default is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> except where otherwise stated. The meaning given for each parameter is non-normative; the normative specification is found in <a href="#UNICODE-TR35">[UTS #35]</a>.</p><table class="longlastcol data"><thead><tr><th>Keyword</th><th>Values</th><th>Meaning</th></tr></thead><tbody><tr><td>fallback</td><td>yes | no (default yes)</td><td>Determines whether the processor uses a fallback collation if a conformant collation is not available.</td></tr><tr><td>lang</td><td>language code: a string in the lexical space of <code>xs:language</code>.</td><td>The language whose collation conventions are to be used.</td></tr><tr><td>version</td><td>string</td><td>The version number of the UCA to be used.</td></tr><tr><td>strength</td><td>primary | secondary | tertiary | quaternary | identical, or 1|2|3|4|5 as synonyms (default tertiary / 3)</td><td>The collation strength as defined in UCA. Primary strength takes only the base form of the character into account (so A=a=Ä=ä); secondary strength ignores case but considers accents and diacritics as significant (so A=a and Ä=ä but ä≠a); tertiary considers case as significant (A≠a≠Ä≠ä); quaternary strength always considers as significant spaces and punctuation (data-base≠database; if <code>maxVariable</code> is <code>punct</code> or higher and <code>alternate</code> is not <code>non-ignorable</code>, lower strengths will treat data-base=database).</td></tr><tr><td>maxVariable</td><td>space | punct | symbol | currency (default punct)</td><td> Given the sequence <code>space</code>, <code>punct</code>, <code>symbol</code>, <code>currency</code>, all characters in the specified group and earlier groups are treated as “noise” characters to be handled as defined by the <code>alternate</code> parameter. For example, <code>maxVariable=punct</code> indicates that characters classified as whitespace or punctuation get this treatment.</td></tr><tr><td>alternate</td><td>non-ignorable | shifted | blanked (default non-ignorable)</td><td>Controls the handling of characters such as spaces and hyphens; specifically, the "noise" characters in the groups selected by the <code>maxVariable</code> parameter. The value <code>non-ignorable</code> indicates that such characters are treated as distinct at the primary level (so <code>data base</code> sorts before <code>database</code>); <code>shifted</code> indicates that they are used to differentiate two strings only at the <code>quaternary</code> level, and <code>blanked</code> indicates that they are taken into account only at the <code>identical</code> level.</td></tr><tr><td>backwards</td><td>yes | no (default no)</td><td>The value <code>backwards=yes</code> indicates that the last accent in the string is the most significant.</td></tr><tr><td>normalization</td><td>yes | no (default no)</td><td>Indicates whether strings are converted to normalization form D.</td></tr><tr><td>caseLevel</td><td>yes | no (default no)</td><td>When used with primary strength, setting <code>caseLevel=yes</code> has the effect of ignoring accents while taking account of case.</td></tr><tr><td>caseFirst</td><td>upper | lower (default lower)</td><td>Indicates whether upper-case precedes lower-case or vice versa.</td></tr><tr><td>numeric</td><td>yes | no (default no)</td><td>When <code>numeric=yes</code> is specified, a sequence of consecutive digits is interpreted as a number, for example <code>chap2</code> sorts before <code>chap12</code>.</td></tr><tr><td>reorder</td><td>a comma-separated sequence of reorder codes, where a reorder code is one of <code>space</code>, <code>punct</code>, <code>symbol</code>, <code>currency</code>, <code>digit</code>, or a four-letter script code defined in <a href="#ISO15924_register">[ISO 15924 Register]</a>, the register of scripts maintained by the Unicode Consortium in its capacity as registration authority for <a href="#ISO15924">[ISO 15924]</a>.</td><td>Determines the relative ordering of text in different scripts; for example the value <code>digit,Grek,Latn</code> indicates that digits precede Greek letters, which precede Latin letters.</td></tr></tbody></table><div class="note"><p class="prefix"><b>Note:</b></p><p>This list excludes parameters that are inconvenient to express in a URI, or that are applicable only to substring matching.</p></div><p>UCA collation URIs can be conveniently generated using the <a href="#func-collation"><code>fn:collation</code></a> function.</p></div><div class="div3"><h4><a id="unicode-case-insensitive-collation"></a>5.3.5 <a href="#unicode-case-insensitive-collation" style="text-decoration: none">The Unicode case-insensitive collation</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#html-ascii-case-insensitive-collation">next</a> | <a href="#func-codepoints-to-string">previous</a>)</p><ol><li><p> A new collation URI is defined for Unicode case-insensitive comparison and ordering. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1568">1568</a>&nbsp;]</i></p></li></ol></div><p>The collation URI <code>http://www.w3.org/2005/xpath-functions/collation/unicode-case-insensitive</code> must be recognized by every implementation.</p><p>The collation is defined as follows:</p><ul><li><p>Let <code>$UCI</code> be the collation URI <code>"http://www.w3.org/2005/xpath-functions/collation/unicode-case-insensitive"</code>.</p></li><li><p>Let <code>$UCC</code> be the Unicode Codepoint Collation URI <code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>.</p></li><li><p>For any two strings <code>$A</code> and <code>$B</code>, the result of the comparison <code>fn:compare($A, $B, $UCI)</code> is defined to be the same as the result of <code>fn:compare(lower-case($A), lower-case($B), $UCC)</code>.</p></li></ul><p>The collation supports collation units and can therefore be used with functions such as <a href="#func-contains"><code>fn:contains</code></a>; each Unicode codepoint is a single collation unit. The collation also supports the ability to obtain a collation key using <a href="#func-collation-key"><code>fn:collation-key</code></a>.</p></div><div class="div3"><h4><a id="html-ascii-case-insensitive-collation"></a>5.3.6 <a href="#html-ascii-case-insensitive-collation" style="text-decoration: none">The HTML ASCII Case-Insensitive Collation</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-collation">next</a> | <a href="#unicode-case-insensitive-collation">previous</a>)</p><ol><li><p> The case-insensitive collation is now defined normatively within this specification, rather than by reference to the HTML "living specification", which is subject to change. The collation can now be used for ordering comparisons as well as equality comparisons. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/668">668</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/680">680</a>&nbsp;5 September 2023]</i></p></li></ol></div><p>The collation URI <code>http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive</code> must be recognized by every implementation. It is <span>designed to be compatible with</span> the HTML ASCII case-insensitive collation as defined in <a href="#html5">[HTML: Living Standard]</a> (section 4.6, <em>Strings</em>), which is used, for example, when matching HTML <code>class</code> attribute values.</p><p>The collation is defined as follows:</p><ul><li><p>Let <code>$HACI</code> be the collation URI <code>"http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"</code>.</p></li><li><p>Let <code>$UCC</code> be the Unicode Codepoint Collation URI <code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>.</p></li><li><p>Let <code>$lc</code> be the function <code> fn:translate(?, "ABCDEFGHIJKLMNOPQRSTUVWXYZ", "abcdefghijklmnopqrstuvwxyz")</code>.</p></li><li><p>Then for any two strings <code>$A</code> and <code>$B</code>, the result of the comparison <code>fn:compare($A, $B, $HACI)</code> is defined to be the same as the result of <code>fn:compare($lc($A), $lc($B), $UCC)</code>.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>HTML5 defines the semantics of equality matching using this collation; <span>this specification additionally defines ordering rules. </span> The collation supports collation units and can therefore be used with functions such as <a href="#func-contains"><code>fn:contains</code></a>; each Unicode codepoint is a single collation unit.</p><p>The corresponding HTML5 definition is: A string <var>A</var> is an ASCII case-insensitive match for a string <var>B</var>, if the ASCII lowercase of <var>A</var> is the ASCII lowercase of <var>B</var>.</p></div></div><div class="div3"><h4><a id="choosing-a-collation"></a>5.3.7 <a href="#choosing-a-collation" style="text-decoration: none">Choosing a collation</a></h4><p>Many functions have a signature that includes a <code>$collation</code> argument, which is generally optional and takes <code>default-collation()</code> as its default value.</p><p>The collation to use for these functions is determined by the following rules:</p><ol class="enumar"><li><p>If the function specifies an explicit collation, CollationA (e.g., if the optional collation argument is specified in a call of the <a href="#func-compare"><code>fn:compare</code></a> function), then:</p><ul><li><p>If CollationA is supported by the implementation, then CollationA is used. </p></li><li><p>Otherwise, a dynamic error is raised [<a href="#ERRFOCH0002" title="err:FOCH0002">err:FOCH0002</a>]. </p></li></ul></li><li><p>If no collation is explicitly specified for the function <span>(that is, if the <code>$collation</code> argument is omitted or is set to an empty sequence)</span>, and the default collation in the XQuery/XPath static context is CollationB, then:</p><ul><li><p>If CollationB is supported by the implementation, then CollationB is used. </p></li><li><p>Otherwise, a dynamic error is raised [<a href="#ERRFOCH0002" title="err:FOCH0002">err:FOCH0002</a>]. </p></li></ul></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Because the set of collations that are supported is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, an implementation has the option to support all collation URIs, in which case it will never raise this error.</p></div><p>If the value of the collation argument is a relative URI reference, it is resolved against the base-URI from the static context. If it is a relative URI reference and cannot be resolved, perhaps because the base-URI property in the static context is absent, a dynamic error is raised [<a href="#ERRFOCH0002" title="err:FOCH0002">err:FOCH0002</a>].</p><div class="note"><p class="prefix"><b>Note:</b></p><p>There is no explicit requirement that the string used as a collation URI be a valid URI. Implementations will in many cases reject such strings on the grounds that do not identify a supported collation; they may also cause an error if they cannot be resolved against the <span>relevant</span> base URI.</p></div></div><div class="div3"><h4><a id="func-codepoint-equal"></a>5.3.8 <a href="#func-codepoint-equal" style="text-decoration: none">fn:codepoint-equal</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if two strings are equal, considered codepoint-by-codepoint.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:codepoint-equal</code>(</td></tr><tr class="arg"><td><code>$value1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$value2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If either argument is the empty sequence, the function returns the empty sequence. </p><p>Otherwise, the function returns <code>true</code> or <code>false</code> depending on whether <code>$value1</code> is equal to <code>$value2</code>, according to the Unicode codepoint collation (<code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>).</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function allows <code>xs:anyURI</code> values to be compared without having to specify the Unicode codepoint collation.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>codepoint-equal("abcd", "abcd")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>codepoint-equal("abcd", "abcd ")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>codepoint-equal("", "")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>codepoint-equal("", ())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>codepoint-equal((), ())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-collation"></a>5.3.9 <a href="#func-collation" style="text-decoration: none">fn:collation</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-collation-available">next</a> | <a href="#html-ascii-case-insensitive-collation">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1091">1091</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1093">1093</a>&nbsp;9 April 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Constructs a collation URI with requested properties.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:collation</code>(</td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>The function is supplied with a map defining the properties required of the collation, and returns a collation URI with these properties.</p><p>Specifically, it returns a string in the form of a URI with the scheme and path <code>http://www.w3.org/2013/collation/UCA</code> followed by an optional query part. The query part is absent if <code>options</code> is empty. Otherwise it consists of a question mark followed by a sequence of one or more semicolon-separated parameters. Each parameter is a keyword-value pair, the keyword and value being separated by an equals sign. There is one keyword-value pair for each entry in the <code>options</code> map: the keyword is the same as the string value of the key in the map, and the value is the string value of the corresponding value, except where the value is of type <code>xs:boolean</code>, in which case <code>true</code> and <code>false</code> are translated to <code>yes</code> and <code>no</code>. </p><p>The function does not check whether the implementation actually recognizes the resulting collation URI: that can be achieved using the <a href="#func-collation-available"><code>fn:collation-available</code></a> function.</p><p>The properties available are as defined for the Unicode Collation Algorithm (see <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>). Additional <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> properties <span class="verb">may</span> be specified as described in the rules for UCA collation URIs.</p><p>The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply, except as regards the handling of options not defined in this specification. Specifically:</p><ul><li><p>If the option key is of type <code>xs:string</code>, <code>xs:anyURI</code>, or <code>xs:untypedAtomic</code> then it is converted to a string, and produces a URI query parameter which is handled as described in <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. </p></li><li><p>If the option key is of any other type then the function fails with a type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul><p>The following options are defined:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">fallback?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">lang?</code></td><td><code class="as">as&nbsp;</code><code>xs:language</code>,</td></tr><tr class="arg"><td><code class="opt">version?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">strength?</code></td><td><code class="as">as&nbsp;</code><code>enum("primary", "secondary", "tertiary", "quaternary", "identical", "1", "2", "3", "4", "5")</code>,</td></tr><tr class="arg"><td><code class="opt">maxVariable?</code></td><td><code class="as">as&nbsp;</code><code>enum("space", "punct", "symbol", "currency")</code>,</td></tr><tr class="arg"><td><code class="opt">alternate?</code></td><td><code class="as">as&nbsp;</code><code>enum("non-ignorable", "shifted", "blanked", "currency")</code>,</td></tr><tr class="arg"><td><code class="opt">backwards?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">normalization?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">caseLevel?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">caseFirst?</code></td><td><code class="as">as&nbsp;</code><code>enum("upper","lower")</code>,</td></tr><tr class="arg"><td><code class="opt">numeric?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">reorder?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>fallback?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr><tr><td><p><code>lang?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>xs:language</code></p></li><li><p><b>Default: </b><code>default-language()</code></p></li></ul></td></tr><tr><td><p><code>version?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>strength?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>enum("primary", "secondary", "tertiary", "quaternary", "identical", "1", "2", "3", "4", "5")</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>maxVariable?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>enum("space", "punct", "symbol", "currency")</code></p></li><li><p><b>Default: </b><code>"punct"</code></p></li></ul></td></tr><tr><td><p><code>alternate?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>enum("non-ignorable", "shifted", "blanked", "currency")</code></p></li><li><p><b>Default: </b><code>"non-ignorable"</code></p></li></ul></td></tr><tr><td><p><code>backwards?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>normalization?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>caseLevel?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>caseFirst?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>enum("upper","lower")</code></p></li><li><p><b>Default: </b><code>"lower"</code></p></li></ul></td></tr><tr><td><p><code>numeric?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>reorder?</code></p></td><td class="fos-thin">See <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>""</code></p></li></ul></td></tr></tbody></table></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> if <code>options</code> includes an entry whose key is not of type <code>xs:string</code>, <code>xs:anyURI</code>, or <code>xs:untypedAtomic</code>, or whose corresponding value is not castable to <code>xs:string</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>collation({})</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"http://www.w3.org/2013/collation/UCA"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>collation({ 'lang': 'de' })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"http://www.w3.org/2013/collation/UCA?lang=de"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>collation({ 'lang': 'de', 'strength': 'primary' })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"http://www.w3.org/2013/collation/UCA?lang=de;strength=primary"</code></p><p><em>(The order of query parameters may vary.)</em></p></td></tr><tr><td colspan="2"><p>The expression <code>collation({ 'lang': default-language() })</code> returns a collation suitable for the default language in the dynamic context.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-collation-available"></a>5.3.10 <a href="#func-collation-available" style="text-decoration: none">fn:collation-available</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-char">next</a> | <a href="#func-collation">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1160">1160</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1262">1262</a>&nbsp;9 July 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Asks whether a collation URI is recognized by the implementation, and whether it has required properties.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:collation-available</code>(</td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$usage</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>enum('compare', 'key', 'substring')*</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>The first argument is a candidate collation URI.</p><p>The second argument establishes the intended usage of the collation URI. The value is a sequence containing zero or more of the following:</p><ul><li><p><code>compare</code> indicates that the intended purpose of the collation URI is to compare strings for equality or ordering, for example in functions such as <a href="#func-index-of"><code>fn:index-of</code></a>, <a href="#func-deep-equal"><code>fn:deep-equal</code></a>, <a href="#func-compare"><code>fn:compare</code></a>, and <a href="#func-sort"><code>fn:sort</code></a>.</p></li><li><p><code>key</code> indicates that the intended purpose of the collation URI is to obtain collation keys for strings using the <a href="#func-collation-key"><code>fn:collation-key</code></a> function.</p></li><li><p><code>substring</code> indicates that the intended purpose of the collation URI is to establish whether one string is a substring of another, for example in functions such as <a href="#func-contains"><code>fn:contains</code></a> or <a href="#func-starts-with"><code>fn:starts-with</code></a>.</p></li></ul><p>The function returns true if and only if the implementation recognizes the candidate collation URI as one that can be used for each of the purposes listed in the <code>$usage</code> argument. If the <code>$usage</code> argument is absent or set to the empty sequence, the function returns true only if the collation is available for all purposes. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the candidate collation is a UCA collation specifying <code>fallback=yes</code>, then this function will always return true: implementations are required to recognize such a collation and use fallback behavior if there is no direct equivalent available.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>collation-available("http://www.w3.org/2013/collation/UCA?lang=de")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>collation({ 'lang': 'de' }) =&gt; collation-available()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td colspan="2"><p>The expression <code>collation({ 'lang': default-language() })</code> returns a collation suitable for the default language in the dynamic context.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-collation-key"></a>5.3.11 <a href="#func-collation-key" style="text-decoration: none">fn:collation-key</a></h4><dl><dt class="label">Summary</dt><dd><p>Given a string value and a collation, generates an internal value called a collation key, with the property that the matching and ordering of collation keys reflects the matching and ordering of strings under the specified collation.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:collation-key</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:base64Binary</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>Calling the one-argument version of this function is equivalent to calling the two-argument version supplying the default collation as the second argument.</p><p>The function returns an <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> value with the property that, for any two strings <code>$K1</code> and <code>$K2</code>:</p><ul><li><p><code>collation-key($K1, $C) eq collation-key($K2, $C)</code> if and only if <code>compare($K1, $K2, $C) eq 0</code></p></li><li><p><code>collation-key($K1, $C) lt collation-key($K2, $C)</code> if and only if <code>compare($K1, $K2, $C) lt 0</code></p></li></ul><p>The collation used by this function is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>. Collation keys are defined as <code>xs:base64Binary</code> values to ensure unambiguous and context-free comparison semantics.</p><p>An implementation is free to generate a collation key in any convenient way provided that it always generates the same collation key for two strings that are equal under the collation, and different collation keys for strings that are not equal. This holds only within a single <a title="execution scope" class="termref" href="#execution-scope">execution scope</a>; an implementation is under no obligation to generate the same collation keys during a subsequent unrelated query or transformation.</p><p>It is possible to define collations that do not have the ability to generate collation keys. Supplying such a collation will cause the function to fail. The ability to generate collation keys is an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> property of the collation.</p></dd><dt class="label">Error Conditions</dt><dd><p>An error is raised [<a href="#ERRFOCH0004" title="err:FOCH0004">err:FOCH0004</a>] if the specified collation does not support the generation of collation keys. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function is provided primarily for use with maps. If a map is required where codepoint equality is inappropriate for comparing keys, then a common technique is to normalize the key so that equality matching becomes feasible. There are many ways keys can be normalized, for example by use of functions such as <a href="#func-upper-case"><code>fn:upper-case</code></a>, <a href="#func-lower-case"><code>fn:lower-case</code></a>, <a href="#func-normalize-space"><code>fn:normalize-space</code></a>, or <a href="#func-normalize-unicode"><code>fn:normalize-unicode</code></a>, but this function provides a way of normalizing them according to the rules of a specified collation. For example, if the collation ignores accents, then the function will generate the same collation key for two input strings that differ only in their use of accents.</p><p>The result of the function is defined to be an <code>xs:base64Binary</code> value. Binary values are chosen because they have unambiguous and context-free comparison semantics, because the value space is unbounded, and because the ordering rules are such that between any two values in the ordered value space, an arbitrary number of further values can be interpolated. The choice between <code>xs:base64Binary</code> and <code>xs:hexBinary</code> is arbitrary; the only operation that behaves differently between the two binary data types is conversion to/from a string, and this operation is not one that is normally required for effective use of collation keys. </p><p>For collations based on the Unicode Collation Algorithm, an algorithm for computing collation keys is provided in <a href="#UNICODE-TR10">[UTS #10]</a>. Implementations are <span class="verb">not required</span> to use this algorithm.</p><p>The fact that collation keys are ordered can be exploited in XQuery, whose <code>order by</code> clause does not allow the collation to be selected dynamically. This restriction can be circumvented by rewriting the clause <code>order by $e/@key collation "URI"</code> as <code>order by fn:collation-key($e/@key, $collation)</code>, where <code>$collation</code> allows the collation to be chosen dynamically.</p><p>Note that <code>xs:base64Binary</code> becomes an ordered type in XPath 3.1, making binary collation keys possible.</p><p>The <a href="#func-collation-available"><code>fn:collation-available</code></a> can be used to ask whether a particular collation is capable of delivering collation keys.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $C := collation({ 'strength': 'primary' })</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">map:merge(
  ({ collation-key("A", $C): 1 }, { collation-key("a", $C): 2 }),
  { "duplicates": "use-last" }
)(collation-key("A", $C))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2</pre></div><p><em>(Given that the keys of the two entries are equal under the rules of the chosen collation, only one of the entries can appear in the result; the one that is chosen is the one from the last map in the input sequence.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $M := {
  collation-key("A", $C): 1,
  collation-key("B", $C): 2
}
return $M(collation-key("a", $C))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div><p><em>(The strings <code>"A"</code> and <code>"a"</code> have the same collation key under this collation.)</em></p></td></tr><tr><td colspan="2"><p>As the above examples illustrate, it is important that when the <code>collation-key</code> function is used to add entries to a map, then it must also be used when retrieving entries from the map. This process can be made less error-prone by encapsulating the map within a function: <code>fn($k) { $M(collation-key($k, $collation) }</code>.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-contains-token"></a>5.3.12 <a href="#func-contains-token" style="text-decoration: none">fn:contains-token</a></h4><dl><dt class="label">Summary</dt><dd><p>Determines whether or not any of the supplied strings, when tokenized at whitespace boundaries, contains the supplied token, under the rules of the supplied collation.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:contains-token</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$token</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns <code>false</code>.</p><p>Leading and trailing whitespace is trimmed from <code>$token</code>. If the trimmed value of <code>$token</code> is a zero-length string, the function returns <code>false</code>.</p><p>The collation used by this function is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The function returns <code>true</code> if and only if there is string in <code>$value</code> which, after tokenizing at whitespace boundaries, contains a token that is equal to the trimmed value of <code>$token</code> under the rules of the selected collation.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">some $t in ($value ! tokenize(.))
satisfies compare($t, replace($token, '^\s*|\s*$', ''), $collation) eq 0</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>Interior whitespace within <code>$token</code> will cause the function to return <code>false</code>, unless such whitespace is ignored by the selected collation.</p><p>This function can be used for processing space-separated attribute values (for example, the XHTML and DITA class attribute), where one often needs to test for the presence of a single token in a space-separated list. The function is designed to work both when the attribute has been validated against an XSD list type, and when it appears as a single untyped string. It differs from the HTML 5 definition in that HTML 5 recognizes form feed (x0C) as a separator. To reproduce the HTML token matching behavior, the HTML ASCII case-insensitive collation should be used: see <a href="#html-ascii-case-insensitive-collation"><b>5.3.6 The HTML ASCII Case-Insensitive Collation</b></a>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-token("red green blue ", "red")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-token(("red", "green", "blue"), " red ")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>contains-token("red, green, blue", "red")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">contains-token(
  "red green blue",
  "RED",
  "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="string-value-functions"></a>5.4 <a href="#string-value-functions" style="text-decoration: none">Functions on string values</a></h3><p>The following functions are defined on values of type <code>xs:string</code> and types derived from it.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-char"><code>fn:char</code></a></td><td>Returns a string containing a particular character or glyph.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-characters"><code>fn:characters</code></a></td><td>Splits the supplied string into a sequence of single-character strings.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-graphemes"><code>fn:graphemes</code></a></td><td>Splits the supplied string into a sequence of single-grapheme strings.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-concat"><code>fn:concat</code></a></td><td>Returns the concatenation of the arguments, treated as sequences of strings.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-string-join"><code>fn:string-join</code></a></td><td>Returns a string created by concatenating the items in a sequence, with a defined separator between adjacent items.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-substring"><code>fn:substring</code></a></td><td>Returns the part of <code>$value</code> beginning at the position indicated by <code>$start</code> and continuing for the number of <a title="character" class="termref" href="#character">characters</a> indicated by <code>$length</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-string-length"><code>fn:string-length</code></a></td><td>Returns the number of <a title="character" class="termref" href="#character">characters</a> in a string.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-normalize-space"><code>fn:normalize-space</code></a></td><td>Returns <code>$value</code> with leading and trailing whitespace removed, and sequences of internal whitespace reduced to a single space character.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-normalize-unicode"><code>fn:normalize-unicode</code></a></td><td>Returns <code>$value</code> after applying Unicode normalization.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-upper-case"><code>fn:upper-case</code></a></td><td>Converts a string to upper case.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-lower-case"><code>fn:lower-case</code></a></td><td>Converts a string to lower case.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-translate"><code>fn:translate</code></a></td><td>Returns <code>$value</code> modified by replacing or removing individual characters. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-hash"><code>fn:hash</code></a></td><td>Returns the results of a specified hash, checksum, or cyclic redundancy check function applied to the input.</td></tr></tbody></table><div class="note"><p class="prefix"><b>Notes:</b></p><p>When the above operators and functions are applied to datatypes derived from <code>xs:string</code>, they are guaranteed to return values that are instances of <code>xs:string</code>, but the value might or might not be an instance of the particular subtype of <code>xs:string</code> to which they were applied. </p><p>The strings returned by <a href="#func-concat"><code>fn:concat</code></a> and <a href="#func-string-join"><code>fn:string-join</code></a> are not guaranteed to be normalized. But see note in <a href="#func-concat"><code>fn:concat</code></a>. </p></div><div class="div3"><h4><a id="func-char"></a>5.4.1 <a href="#func-char" style="text-decoration: none">fn:char</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-characters">next</a> | <a href="#func-collation-available">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/121">121</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/989">989</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/261">261</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/306">306</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/993">993</a>&nbsp;10 January 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a string containing a particular character or glyph.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:char</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | xs:positiveInteger)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a string, generally containing a single <a title="character" class="termref" href="#character">character</a> or glyph, identified by <code>$value</code>.</p><p>The supplied value of <code>$value</code> must be one of the following:</p><ol class="enumar"><li><p>A Unicode codepoint, supplied as an integer. For example <code>fn:char(9)</code> returns the tab character.</p></li><li><p>An HTML5 character reference name (often referred to as an entity name) as defined at <a href="https://html.spec.whatwg.org/multipage/named-characters.html">https://html.spec.whatwg.org/multipage/named-characters.html</a>. The name is written with no leading ampersand and no trailing semicolon. For example <code>fn:char("pi")</code> represents the character <span class="unicode-codepoint">U+03C0</span> (<span class="unicode-name">GREEK SMALL LETTER PI</span>, <code>π</code>) and <code>fn:char("nbsp")</code> returns <span class="unicode-codepoint">U+00A0</span> (<span class="unicode-name">NON-BREAKING SPACE, NBSP</span>) .</p><p>A processor <span class="verb">may</span> recognize additional character reference names defined in other versions of HTML. Character reference names are case-sensitive.</p><p>In the event that the HTML5 character reference name identifies a string comprising multiple codepoints, that string is returned.</p><p>[TODO: add a proper bibliographic reference.]</p></li><li><p>A backslash-escape sequence from the set <code>\n</code> (<span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ), <code>\r</code> (<span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) ), or <code>\t</code> (<span class="unicode-codepoint">U+0009</span> (<span class="unicode-name">TAB</span>) ).</p></li></ol><p>The result must consist of <a title="permitted character" class="termref" href="#dt-permitted-character">permitted characters</a>. For example <code>fn:char(0xDEAD)</code> is invalid because it is in the surrogate range.</p></dd><dt class="label">Error Conditions</dt><dd><p>The function fails with a dynamic error [<a href="#ERRFOCH0005" title="err:FOCH0005">err:FOCH0005</a>] if <code>$value</code> is not a valid representation of a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a> or sequence of permitted characters. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Although all Unicode characters can appear in string literals (the delimiting quotation marks can be escaped by doubling them), some characters are not visually distinctive, so representing them by name may make code more readable. In addition, there may be contexts where it is necessary or prudent to write XPath expressions using ASCII characters only, for example where an expression is used in the query part of a URI.</p><p>A few HTML5 character reference names identify glyphs whose Unicode representation uses multiple codepoints. For example, the name <code>NotEqualTilde</code> refers to the glyph <code>≂̸</code> which is expressed using the two codepoints <span class="unicode-codepoint">U+2242</span> (<span class="unicode-name">MINUS TILDE</span>, <code>≂</code>) , <span class="unicode-codepoint">U+0338</span> (<span class="unicode-name">COMBINING LONG SOLIDUS OVERLAY</span>) . In such cases the string length of the result of the function will exceed one.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>char("aacute")</code></pre></div></td><td style="vertical-align:top"><p><code>"á"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>char("eth")</code></pre></div></td><td style="vertical-align:top"><p><code>"ð"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>char(9)</code></pre></div></td><td style="vertical-align:top"><p><code>codepoints-to-string(9)</code></p><p><em>(The character <em>tab</em>).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>char("\t")</code></pre></div></td><td style="vertical-align:top"><p><code>codepoints-to-string(9)</code></p><p><em>(The character <em>tab</em>).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>char(0x20)</code></pre></div></td><td style="vertical-align:top"><p><code>" "</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>char(0x1D1CA)</code></pre></div></td><td style="vertical-align:top"><p><code>"𝇊"</code></p><p><em>(The character MUSICAL SYMBOL TEMPUS IMPERFECTUM CUM PROLATIONE PERFECTA).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>char("NotEqualTilde")</code></pre></div></td><td style="vertical-align:top"><p><code>codepoints-to-string((8770, 824))</code></p><p><em>(This HTML5 character reference name expands to multiple codepoints.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-characters"></a>5.4.2 <a href="#func-characters" style="text-decoration: none">fn:characters</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-graphemes">next</a> | <a href="#func-char">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[&nbsp;&nbsp;20 September 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Splits the supplied string into a sequence of single-character strings.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:characters</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence of strings, each string having length 1, containing the corresponding <a title="character" class="termref" href="#character">character</a> in <code>$value</code>.</p><p>If <code>$value</code> is a zero-length string or the empty sequence, the function returns the empty sequence.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">string-to-codepoints($value) ! codepoints-to-string(.)</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>characters("Thérèse")</code></pre></div></td><td style="vertical-align:top"><p><code>"T", "h", "é", "r", "è", "s", "e"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>characters("")</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>characters(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>characters("Banana") =&gt; index-of("a")</code></pre></div></td><td style="vertical-align:top"><p><code>2, 4, 6</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>characters("stretch") =&gt; string-join("-")</code></pre></div></td><td style="vertical-align:top"><p><code>"s-t-r-e-t-c-h"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Banana"
=&gt; characters()
=&gt; reverse()
=&gt; string-join()</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"ananaB"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-graphemes"></a>5.4.3 <a href="#func-graphemes" style="text-decoration: none">fn:graphemes</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-concat">next</a> | <a href="#func-characters">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/73">73</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1068">1068</a>&nbsp;15 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Splits the supplied string into a sequence of single-grapheme strings.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:graphemes</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence of strings. Each string in the sequence contains one or more <a title="character" class="termref" href="#character">character</a>s that collectively constitute a single extended grapheme cluster, as defined by <a href="#UNICODE-TR29">[UAX #29]</a>.</p><p>If <code>$value</code> is a zero-length string or the empty sequence, the function returns the empty sequence.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The resultant sequence of strings are extended graphemes, not legacy graphemes (see <a href="#UNICODE-TR29">[UAX #29]</a>).</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>graphemes("a" || char(0x308) || "b")</code></pre></div></td><td style="vertical-align:top"><p><code>"a" || char(0x308), "b"</code></p><p><em>(a + ◌̈ + b, three characters, two graphemes).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>graphemes("")</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>graphemes(())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>graphemes(char('\r') || char('\n'))</code></pre></div></td><td style="vertical-align:top"><p><code>char('\r') || char('\n')</code></p><p><em>(Carriage return + line feed, two characters, one grapheme).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>graphemes(char(0x1F476) || char(0x200D) || char(0x1F6D1))</code></pre></div></td><td style="vertical-align:top"><p><code>char(0x1F476) || char(0x200D) || char(0x1F6D1)</code></p><p><em>(👶 +ZWJ + 🛑, three characters, one grapheme).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>graphemes("कत")</code></pre></div></td><td style="vertical-align:top"><p><code>"क", "त"</code></p><p><em>(क + त, two characters, two graphemes).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>graphemes("क" || char(0x93C) || char(0x200D) || char(0x94D) || "त")</code></pre></div></td><td style="vertical-align:top"><p><code>"क" || char(0x93C) || char(0x200D) || char(0x94D) || "त"</code></p><p><em>(क + ◌़ + ZWJ + ◌् + त, five characters, one grapheme).</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-concat"></a>5.4.4 <a href="#func-concat" style="text-decoration: none">fn:concat</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-substring">next</a> | <a href="#func-graphemes">previous</a>)</p><ol><li><p>The function can now take any number of arguments (previously it had to be two or more), and the arguments can be sequences of strings rather than single strings.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/701">701</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/702">702</a>&nbsp;19 September 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the concatenation of the arguments, treated as sequences of strings.</p></dd><dt class="label">Operator Mapping</dt><dd><p> The two-argument form of this function defines the semantics of the <code>||</code> operator.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:concat</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType* ...</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>, and <a title="variadic" class="termref" href="#dt-variadic">variadic</a>. </p></dd><dt class="label">Rules</dt><dd><p>Unlike all other functions, this function is defined to be variadic, as indicated by the ellipsis in the function signature. Conceptually, there is an infinite set of functions with different numbers of arguments (minimum arity zero, maximum arity unbounded):</p><ul><li><p><code>concat()</code> returns a zero-length string, <code>""</code>.</p></li><li><p><code>concat("a")</code> returns <code>"a"</code>.</p></li><li><p><code>concat("a", "b")</code> returns <code>"ab"</code>.</p></li><li><p><code>concat("a", "b", "c")</code> returns <code>"abc"</code>.</p></li><li><p><code>concat("a", "b", "c", "d")</code> returns <code>"abcd"</code>.</p></li><li><p>and so on.</p></li></ul><p>It is equally possible to supply a single argument containing a sequence of strings:</p><ul><li><p><code>concat(())</code> returns a zero-length string, <code>""</code>.</p></li><li><p><code>concat(("a"))</code> returns <code>"a"</code>.</p></li><li><p><code>concat(("a", "b"))</code> returns <code>"ab"</code>.</p></li><li><p><code>concat(("a", "b", "c"))</code> returns <code>"abc"</code>.</p></li><li><p><code>concat(("a", "b", "c", "d"))</code> returns <code>"abcd"</code>.</p></li><li><p>and so on.</p></li></ul><p>More generally, any argument can be a sequence of strings:</p><ul><li><p><code>concat(("a", "b"), "c")</code> returns <code>"abc"</code>.</p></li><li><p><code>concat(("a", "b"), (), ("c", "d"))</code> returns <code>"abcd"</code>.</p></li></ul><p>A static call on the <a href="#func-concat"><code>fn:concat</code></a> function must use positional arguments, it cannot use keywords.</p><p>Each of the parameters has the required type <code>xs:anyAtomicType*</code>. The coercion rules ensure that each supplied argument is first converted to a sequence of atomic items by applying atomization. These sequences are then combined (by <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-concatenation">sequence concatenation</a><sup><small>XP</small></sup>) into a single sequence, and each item in the combined sequence is converted to a string using the <a href="#func-string"><code>fn:string</code></a> function. The strings are then concatenated with no separator.</p><p>If XPath 1.0 compatibility mode is set to true in the static context of a static function call to <a href="#func-concat"><code>fn:concat</code></a>, then each supplied argument <code>$v</code> is first reduced to a single string, the result of the expression <code>xs:string($v[1])</code>. This rule applies only to static function calls.</p><p>A named function reference can be used to create a function item with any arity: for example <code>concat#3</code> returns a function item that takes three arguments, which it concatenates. Similarly partial function application can be used to construct a function that concatenates fixed and variable values: for example <code>concat('[', ?, ']')</code> returns a function item that takes a single argument and wraps the string value of this argument in square brackets. Similarly, <code>concat(?, '-', ?)</code> returns a function item of arity two; it returns the string values of the two arguments separated by a hyphen.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>As mentioned in <a href="#string-types"><b>5.1 String types</b></a> Unicode normalization is not automatically applied to the result of <a href="#func-concat"><code>fn:concat</code></a>. If a normalized result is required, <a href="#func-normalize-unicode"><code>fn:normalize-unicode</code></a> can be applied to the <code>xs:string</code> returned by <a href="#func-concat"><code>fn:concat</code></a>. The following XQuery:</p><div class="exampleInner"><pre xml:space="preserve">let $v1 := "I plan to go to Mu"
let $v2 := "?nchen in September"
return concat($v1, $v2)</pre></div><p>where the <code>?</code> represents either the actual Unicode character <span class="unicode-codepoint">U+0308</span> (<span class="unicode-name">COMBINING DIAERESIS</span>) or the numeric character reference <code>&amp;#x0308;</code>, will return:</p><p>"I plan to go to Mu?nchen in September"</p><p>where the <code>?</code> again represents either the actual Unicode character <span class="unicode-codepoint">U+0308</span> (<span class="unicode-name">COMBINING DIAERESIS</span>) or the numeric character reference <code>&amp;#x0308;</code>. It is worth noting that the returned value is not normalized in NFC; however, it is normalized in NFD.</p><p> However, the following XQuery:</p><div class="exampleInner"><pre xml:space="preserve" class="small">let $v1 := "I plan to go to Mu"
let $v2 := "?nchen in September"
return normalize-unicode(concat($v1, $v2))</pre></div><p>where <code>?</code> represents either the actual Unicode character <span class="unicode-codepoint">U+0308</span> (<span class="unicode-name">COMBINING DIAERESIS</span>) or the numeric character reference <code>&amp;#x0308;</code>, will return:</p><p><code>"I plan to go to München in September"</code></p><p>This returned result is normalized in NFC.</p><p>Alternatives to the <a href="#func-concat"><code>fn:concat</code></a> function include the concatenation operator <code>||</code> (for example <code>$x || '-' || $y</code>), the use of string templates (for example <code>`{ $x }-{ $y }`)</code>, and the <a href="#func-string-join"><code>fn:string-join</code></a> function.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>concat('un', 'grateful')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"ungrateful"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>concat(('un', 'grateful'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"ungrateful"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">concat(
  'Thy ', (), 'old ', "groans", "", ' ring',
  ' yet', ' in', ' my', ' ancient',' ears.'
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Thy old groans ring yet in my ancient ears."</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>concat('Ciao!', ())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"Ciao!"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>concat('Ingratitude, ', 'thou ', ('marble-hearted', ' fiend!'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"Ingratitude, thou marble-hearted fiend!"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>concat(01, 02, 03, 04, true())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"1234true"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>concat()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>10 || '/' || 6</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"10/6"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-string-join"></a>5.4.5 <a href="#func-string-join" style="text-decoration: none">fn:string-join</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns a string created by concatenating the items in a sequence, with a defined separator between adjacent items.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:string-join</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$separator</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>""</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the second argument is omitted or the empty sequence, the effect is the same as calling the two-argument version with <code>$separator</code> set to a zero-length string.</p><p>The coercion rules ensure that the supplied <code>$values</code> argument is first converted to a sequence of atomic items by applying atomization.</p><p>The function then returns an <code>xs:string</code> created by casting each item in the atomized sequence to an <code>xs:string</code>, and then concatenating the result strings in order, using the value of <code>$separator</code> as a separator between adjacent strings. If <code>$separator</code> is the zero-length string, then the items in <code>$values</code> are concatenated without a separator.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$values</code> is the empty sequence, the function returns the zero-length string.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $doc := &lt;doc&gt;&lt;chap&gt;&lt;section xml:id="xyz"/&gt;&lt;/chap&gt;&lt;/doc&gt;</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>string-join(1 to 9)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"123456789"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>string-join(('Now', 'is', 'the', 'time', '...'), ' ')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"Now is the time ..."</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">string-join(
  ('Blow, ', 'blow, ', 'thou ', 'winter ', 'wind!'),
  ''
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Blow, blow, thou winter wind!"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>string-join((), 'separator')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>string-join(1 to 5, ', ')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"1, 2, 3, 4, 5"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">$doc//@xml:id
! string-join((node-name(), '="', ., '"'))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'xml:id="xyz"'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">$doc//section
! string-join(ancestor-or-self::*/name(), '/')</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"doc/chap/section"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-substring"></a>5.4.6 <a href="#func-substring" style="text-decoration: none">fn:substring</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-string-length">next</a> | <a href="#func-concat">previous</a>)</p><ol><li><p>The third argument can now be supplied as the empty sequence.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/895">895</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901</a>&nbsp;16 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the part of <code>$value</code> beginning at the position indicated by <code>$start</code> and continuing for the number of <a title="character" class="termref" href="#character">characters</a> indicated by <code>$length</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:substring</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$start</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double</code></code>,</td><td></td></tr><tr class="arg"><td><code>$length</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the zero-length string. </p><p>Otherwise, the function returns a string comprising those <a title="character" class="termref" href="#character">characters</a> of <code>$value</code> whose index position (counting from one) is greater than or equal to <code>$start</code> (rounded to an integer), and (if <code>$length</code> is specified <span>and non-empty</span>) less than the sum of <code>$start</code> and <code>$length</code> (both rounded to integers).</p><p>The characters returned do not extend beyond <code>$value</code>. If <code>$start</code> is zero or negative, only those characters in positions greater than zero are returned.</p><p>More specifically, the three argument version of the function returns the characters in <code>$value</code> whose position <code>$p</code> satisfies:</p><p><code>fn:round($start) &lt;= $p and $p &lt; fn:round($start) + fn:round($length)</code></p><p>The two argument version of the function assumes that <code>$length</code> is infinite and thus returns the <a title="character" class="termref" href="#character">characters</a> in <code>$value</code> whose position <code>$p</code> satisfies:</p><p><code>fn:round($start) &lt;= $p</code></p><p>In the above computations, the operators such as <code>&lt;=</code> and <code>+</code> are evaluated according to the rules of the XPath 4.0 specification.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The first character of a string is located at position 1, not position 0.</p><p>The second and third arguments allow <code>xs:double</code> values (rather than requiring <code>xs:integer</code>) in order to achieve compatibility with XPath 1.0.</p><p>A surrogate pair counts as one character, not two.</p><p>The consequences of supplying values such as <code>NaN</code> or positive or negative infinity for the <code>$start</code> or <code>$length</code> arguments follow from the above rules, and are not always intuitive.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("motor car", 6)</code></pre></div></td><td style="vertical-align:top"><p><code>" car"</code></p><p><em>(Characters starting at position 6 to the end of <code>$sourceString</code> are selected.)</em></p></td></tr><tr><td colspan="2"></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("metadata", 4, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>"ada"</code></p><p><em>(Characters at positions greater than or equal to 4 and less than 7 are selected.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("12345", 1.5, 2.6)</code></pre></div></td><td style="vertical-align:top"><p><code>"234"</code></p><p><em>(Characters at positions greater than or equal to 2 and less than 5 are selected.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("12345", 0, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>"12"</code></p><p><em>(Characters at positions greater than or equal to 0 and less than 3 are selected. Since the first position is 1, these are the characters at positions 1 and 2.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("12345", 5, -3)</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p><p><em>(Characters at positions greater than or equal to 5 and less than 2 are selected.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("12345", -3, 5)</code></pre></div></td><td style="vertical-align:top"><p><code>"1"</code></p><p><em>(Characters at positions greater than or equal to -3 and less than 2 are selected. Since the first position is 1, this is the character at position 1.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("12345", 0 div 0E0, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p><p><em>(Since <code>0 div 0E0</code> returns <code>NaN</code>, and <code>NaN</code> compared to any other number returns <code>false</code>, no characters are selected.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("12345", 1, 0 div 0E0)</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p><p><em>(As above.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring((), 1, 3)</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("12345", -42, 1 div 0E0)</code></pre></div></td><td style="vertical-align:top"><p><code>"12345"</code></p><p><em>(Characters at positions greater than or equal to -42 and less than <code>INF</code> are selected.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring("12345", -1 div 0E0, 1 div 0E0)</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p><p><em>(Since the value of <code>-INF + INF</code> is <code>NaN</code>, no characters are selected.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-string-length"></a>5.4.7 <a href="#func-string-length" style="text-decoration: none">fn:string-length</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-normalize-space">next</a> | <a href="#func-substring">previous</a>)</p><ol><li><p>The type of <code>$value</code> has been generalized to <code>xs:anyAtomicType?</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2279">2279</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2286">2286</a>&nbsp;17 November 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the number of <a title="character" class="termref" href="#character">characters</a> in a string.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:string-length</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:string(.)</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to <code>fn:string(.)</code>.</p><p>If the value is the empty sequence, the function returns the <code>xs:integer</code> value <code>0</code>. Otherwise, the value is cast to an <code>xs:string</code>, and an <code>xs:integer</code> is returned that reflects the number of <a title="character" class="termref" href="#character">characters</a> in the string.</p></dd><dt class="label">Error Conditions</dt><dd><p>If <code>$value</code> is not specified and the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, a type error is raised: [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup>.</p><p>As a consequence of the rules given above, a type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> if the context value cannot be atomized, or if the result of atomizing the context value is a sequence containing more than one atomic item.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Unlike some programming languages, a <a title="codepoint" class="termref" href="#codepoint">codepoint</a> greater than 65535 counts as one character, not two.</p><p>There are situations where <code>fn:string-length()</code> has a different effect from <code>fn:string-length(.)</code>. These situations all involve nodes with non-trivial type annotations. For example:</p><ul><li><p>If the context value is an attribute node typed as an <code>xs:integer</code> with the string value <code>000001</code>, then <code>fn:string-length()</code> returns <code>6</code> (the length of the string value of the node), while <code>fn:string-length(.)</code> returns 1 (the length of the string that results from converting the typed value (1) to a string). In earlier versions of this specification this call would have failed with a type error.</p></li><li><p>If the context value is the element node <code>&lt;e&gt; NN &lt;/e&gt;</code>, and has the type annotation <code>xs:NCName</code>, then <code>fn:string-length()</code> returns 4 (the length of the string value of the element node), while <code>fn:string-length(.)</code> returns 2 (the length of the typed value of the element node).</p></li><li><p>If the context value is the attribute node <code>ref="A B C"</code>, and has the type annotation <code>xs:IDREFS</code>, then <code>fn:string-length()</code> returns 5 (the length of the string value of the attribute node), while <code>fn:string-length(.)</code> raises an error, because the atomized value of the attribute is a sequence of strings, and calling the <a href="#func-string"><code>fn:string</code></a> function on a sequence of strings fails.</p></li></ul></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">string-length(
  "As long as a piece of string"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">28</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"ᾧ" =&gt; string-length()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"ᾧ" =&gt; normalize-unicode("NFD") =&gt; string-length()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">4</pre></div><p><em>(For strings that consist of a base character with combining characters, each combining character is length 1.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>string-length(())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>0</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-normalize-space"></a>5.4.8 <a href="#func-normalize-space" style="text-decoration: none">fn:normalize-space</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-hash">next</a> | <a href="#func-string-length">previous</a>)</p><ol><li><p>The type of <code>$value</code> has been generalized to <code>xs:anyAtomicType?</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2279">2279</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2286">2286</a>&nbsp;17 November 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>$value</code> with leading and trailing whitespace removed, and sequences of internal whitespace reduced to a single space character.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:normalize-space</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>string(.)</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to <code>fn:string(.)</code>.</p><p>If the value is the empty sequence, the function returns a zero-length string. Otherwise, the value is cast to an <code>xs:string</code>, and a new string is constructed by stripping leading and trailing whitespace from the string, and by replacing sequences of one or more adjacent whitespace characters with a single space, <span class="unicode-codepoint">U+0020</span> (<span class="unicode-name">SPACE</span>) .</p><p>The whitespace characters are defined in the metasymbol S (Production 3) of <a href="#xml">[Extensible Markup Language (XML) 1.0 (Fifth Edition)]</a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>If no argument is supplied and the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, a type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup>.</p><p>As a consequence of the rules given above, a type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> if the context value cannot be atomized, or if the result of atomizing the context value is a sequence containing more than one atomic item.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The definition of whitespace is unchanged in <a href="#xml11">[Extensible Markup Language (XML) 1.1 Recommendation]</a>. It is repeated here for convenience:</p><p><code>S ::= (#x20 | #x9 | #xD | #xA)+</code></p><p>There are situations where <code>fn:normalize-space()</code> has a different effect from <code>fn:normalize-space(.)</code>. These situations all involve nodes with non-trivial type annotations. For example:</p><ul><li><p>If the context value is an attribute node typed as an <code>xs:integer</code> with the string value <code>000001</code>, then <code>fn:normalize-space()</code> returns <code>"000001"</code> (the string value of the node, whitespace-normalized), while <code>fn:normalize-space(.)</code> returns <code>"1"</code> (the typed value of the node, converted to a string and then normalized).</p></li><li><p>If the context value is the attribute node <code>ref=" A B C "</code>, and has the type annotation <code>xs:IDREFS</code>, then <code>fn:normalize-space()</code> returns <code>"A B C"</code> (the string value of the attribute node, whitespace-normalized), while <code>fn:normalize-space(.)</code> raises an error, because the typed value of the attribute is a sequence of strings, and calling the <a href="#func-string"><code>fn:string</code></a> function on a sequence of strings fails.</p></li></ul><p>The effect of <code>fn:normalize-space</code> is exactly the same as the effect of the <code>whitespace=collapse</code> facet in XSD. Since this facet is implicit for most XSD data types (with the notable exception of <code>xs:string</code> itself), nodes that are validated against types other than <code>xs:string</code> will tend to be implicitly in the form that <code>normalize-string</code> generates. Confusingly, the XSD type <code>xs:normalizedString</code> uses the facet <code>whitespace=replace</code>, which does <em>not</em> have the same effect as the <a href="#func-normalize-space"><code>normalize-space</code></a> function: it replaces all whitespace characters by <span class="unicode-codepoint">U+0020</span> (<span class="unicode-name">SPACE</span>) , but does not remove leading or trailing spaces, nor does it merge adjacent spaces.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">normalize-space(" The    wealthy curled darlings
           of    our    nation. ")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"The wealthy curled darlings of our nation."</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>normalize-space(())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>""</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-normalize-unicode"></a>5.4.9 <a href="#func-normalize-unicode" style="text-decoration: none">fn:normalize-unicode</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>$value</code> after applying Unicode normalization.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:normalize-unicode</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$form</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>"NFC"</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the zero-length string.</p><p>If the second argument is omitted or the empty sequence, the result is the same as calling the two-argument version with <code>$form</code> set to the string <code>"NFC"</code>.</p><p>Otherwise, the function returns <code>$value</code> normalized according to the rules of the normalization form identified by the value of <code>$form</code>.</p><p>The effective value of <code>$form</code> is the value of the expression <code>fn:upper-case(fn:normalize-space($form))</code>.</p><ul><li><p>If the effective value of <code>$form</code> is “NFC”, then the function returns <code>$value</code> converted to Unicode Normalization Form C (NFC).</p></li><li><p>If the effective value of <code>$form</code> is “NFD”, then the function returns <code>$value</code> converted to Unicode Normalization Form D (NFD).</p></li><li><p>If the effective value of <code>$form</code> is “NFKC”, then the function returns <code>$value</code> in Unicode Normalization Form KC (NFKC).</p></li><li><p>If the effective value of <code>$form</code> is “NFKD”, then the function returns <code>$value</code> converted to Unicode Normalization Form KD (NFKD).</p></li><li><p>If the effective value of <code>$form</code> is “FULLY-NORMALIZED”, then the function returns <code>$value</code> converted to fully normalized form. </p></li><li><p>If the effective value of <code>$form</code> is the zero-length string, no normalization is performed and <code>$value</code> is returned.</p></li></ul><p>Normalization forms NFC, NFD, NFKC, and NFKD, and the algorithms to be used for converting a string to each of these forms, are defined in <a href="#UNICODE-TR15">[UAX #15]</a>.</p><p>The motivation for normalization form FULLY-NORMALIZED is explained in <a href="#charmod-normalization">[Character Model for the World Wide Web 1.0: Normalization]</a>. However, as that specification did not progress beyond working draft status, the normative specification is as follows:</p><ul><li><p>A string is <b>fully-normalized</b> if (a) it is in normalization form NFC as defined in <a href="#UNICODE-TR15">[UAX #15]</a>, and (b) it does not start with a composing character.</p></li><li><p>A composing character is a character that is one or both of the following:</p><ul><li><p>the second character in the canonical decomposition mapping of some character that is not listed in the Composition Exclusion Table defined in <a href="#UNICODE-TR15">[UAX #15]</a>;</p></li><li><p>of non-zero canonical combining class (as defined in <a href="#Unicode">[The Unicode Standard]</a>).</p></li></ul></li><li><p>A string is converted to FULLY-NORMALIZED form as follows:</p><ul><li><p>if the first character in the string is a composing character, prepend a single space (x20);</p></li><li><p>convert the resulting string to normalization form NFC.</p></li></ul></li></ul><p>Conforming implementations <span class="verb">must</span> support normalization form <code>NFC</code> and <span class="verb">may</span> support normalization forms <code>NFD</code>, <code>NFKC</code>, <code>NFKD</code>, and <code>FULLY-NORMALIZED</code>. They <span class="verb">may</span> also support other normalization forms with <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> semantics. </p><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which version of Unicode (and therefore, of the normalization algorithms and their underlying data) is supported by the implementation. See <a href="#UNICODE-TR15">[UAX #15]</a> for details of the stability policy regarding changes to the normalization rules in future versions of Unicode. If the input string contains codepoints that are unassigned in the relevant version of Unicode, or for which no normalization rules are defined, the <a href="#func-normalize-unicode"><code>fn:normalize-unicode</code></a> function leaves such codepoints unchanged. If the implementation supports the requested normalization form then it <span class="verb">must</span> be able to handle every input string without raising an error.</p></dd><dt class="label">Error Conditions</dt><dd><p>A <span>dynamic</span> error is raised [<a href="#ERRFOCH0003" title="err:FOCH0003">err:FOCH0003</a>] if the effective value of the <code>$form</code> argument is not one of the values supported by the implementation.</p></dd></dl></div><div class="div3"><h4><a id="func-upper-case"></a>5.4.10 <a href="#func-upper-case" style="text-decoration: none">fn:upper-case</a></h4><dl><dt class="label">Summary</dt><dd><p>Converts a string to upper case.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:upper-case</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the zero-length string is returned.</p><p>Otherwise, the function returns <code>$value</code> after translating every <a title="character" class="termref" href="#character">character</a> to its upper-case correspondent as defined in the appropriate case mappings section in the Unicode standard <a href="#Unicode">[The Unicode Standard]</a>. For versions of Unicode beginning with the 2.1.8 update, only locale-insensitive case mappings should be applied. Beginning with version 3.2.0 (and likely future versions) of Unicode, precise mappings are described in default case operations, which are full case mappings in the absence of tailoring for particular languages and environments. Every lower-case character that does not have an upper-case correspondent, as well as every upper-case character, is included in the returned value in its original form. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Case mappings may change the length of a string. In general, the <a href="#func-upper-case"><code>fn:upper-case</code></a> and <a href="#func-lower-case"><code>fn:lower-case</code></a> functions are not inverses of each other: <code>fn:lower-case(fn:upper-case($s))</code> is not guaranteed to return <code>$s</code>, nor is <code>fn:upper-case(fn:lower-case($s))</code>. The character <span class="unicode-codepoint">U+0131</span> (<span class="unicode-name">LATIN SMALL LETTER DOTLESS I</span>, <code>ı</code>) (used in Turkish) is perhaps the most prominent lower-case letter which will not round-trip. The character <span class="unicode-codepoint">U+0130</span> (<span class="unicode-name">LATIN CAPITAL LETTER I WITH DOT ABOVE</span>, <code>İ</code>) is the most prominent upper-case letter which will not round trip; there are others, such as <span class="unicode-codepoint">U+1E9E</span> (<span class="unicode-name">LATIN CAPITAL LETTER SHARP S</span>, <code>ẞ</code>) , which was introduced in Unicode 5.1.</p><p> These functions may not always be linguistically appropriate (e.g. Turkish i without dot) or appropriate for the application (e.g. titlecase). In cases such as Turkish, a simple translation should be used first.</p><p> Because the function is not sensitive to locale, results will not always match user expectations. In Quebec, for example, the standard uppercase equivalent of <code>è</code> is <code>È</code>, while in metropolitan France it is more commonly <code>E</code>; only one of these is supported by the functions as defined.</p><p> Many characters of class Ll lack uppercase equivalents in the Unicode case mapping tables; many characters of class Lu lack lowercase equivalents.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>upper-case("abCd0")</code></pre></div></td><td style="vertical-align:top"><p><code>"ABCD0"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-lower-case"></a>5.4.11 <a href="#func-lower-case" style="text-decoration: none">fn:lower-case</a></h4><dl><dt class="label">Summary</dt><dd><p>Converts a string to lower case.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:lower-case</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If t<code>$value</code> is the empty sequence, the zero-length string is returned.</p><p>Otherwise, the function returns <code>$value</code> after translating every <a title="character" class="termref" href="#character">character</a> to its lower-case correspondent as defined in the appropriate case mappings section in the Unicode standard <a href="#Unicode">[The Unicode Standard]</a>. For versions of Unicode beginning with the 2.1.8 update, only locale-insensitive case mappings should be applied. Beginning with version 3.2.0 (and likely future versions) of Unicode, precise mappings are described in default case operations, which are full case mappings in the absence of tailoring for particular languages and environments. Every upper-case character that does not have a lower-case correspondent, as well as every lower-case character, is included in the returned value in its original form. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Case mappings may change the length of a string. In general, the <a href="#func-upper-case"><code>fn:upper-case</code></a> and <a href="#func-lower-case"><code>fn:lower-case</code></a> functions are not inverses of each other: <code>fn:lower-case(fn:upper-case($s))</code> is not guaranteed to return <code>$s</code>, nor is <code>fn:upper-case(fn:lower-case($s))</code>. The character <span class="unicode-codepoint">U+0131</span> (<span class="unicode-name">LATIN SMALL LETTER DOTLESS I</span>, <code>ı</code>) (used in Turkish) is perhaps the most prominent lower-case letter which will not round-trip. The character <span class="unicode-codepoint">U+0130</span> (<span class="unicode-name">LATIN CAPITAL LETTER I WITH DOT ABOVE</span>, <code>İ</code>) is the most prominent upper-case letter which will not round trip; there are others, such as <span class="unicode-codepoint">U+1E9E</span> (<span class="unicode-name">LATIN CAPITAL LETTER SHARP S</span>, <code>ẞ</code>) , which was introduced in Unicode 5.1.</p><p> These functions may not always be linguistically appropriate (e.g. Turkish i without dot) or appropriate for the application (e.g. titlecase). In cases such as Turkish, a simple translation should be used first.</p><p> Because the function is not sensitive to locale, results will not always match user expectations. In Quebec, for example, the standard uppercase equivalent of <code>è</code> is <code>È</code>, while in metropolitan France it is more commonly <code>E</code>; only one of these is supported by the functions as defined.</p><p> Many characters of class Ll lack uppercase equivalents in the Unicode case mapping tables; many characters of class Lu lack lowercase equivalents.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>lower-case("ABc!D")</code></pre></div></td><td style="vertical-align:top"><p><code>"abc!d"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-translate"></a>5.4.12 <a href="#func-translate" style="text-decoration: none">fn:translate</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>$value</code> modified by replacing or removing individual characters. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:translate</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$replace</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$with</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the zero-length string.</p><p>Otherwise, the function returns a result string constructed by processing each <a title="character" class="termref" href="#character">character</a> in <code>$value</code>, in order, according to the following rules:</p><ol class="enumar"><li><p>If the character does not appear in <code>$replace</code> then it is added to the result string unchanged.</p></li><li><p>If the character first appears in <code>$replace</code> at some position <em>M</em>, where the value of <code>$with</code> is <em>M</em> or more characters in length, then the character at position <em>M</em> in <code>$with</code> is added to the result string.</p></li><li><p>If the character first appears in <code>$replace</code> at some position <em>M</em>, where <code>$with</code> is less than <em>M</em> characters in length, then the character is omitted from the result string.</p></li></ol></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$replace</code> is the zero-length string then the function returns <code>$value</code> unchanged.</p><p>If a character occurs more than once in <code>$replace</code>, then the first occurrence determines the action taken.</p><p>If <code>$with</code> is longer than <code>$replace</code>, the excess characters are ignored.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>translate("bar", "abc", "ABC")</code></pre></div></td><td style="vertical-align:top"><p><code>"BAr"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>translate("--aaa--", "abc-", "ABC")</code></pre></div></td><td style="vertical-align:top"><p><code>"AAA"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>translate("abcdabc", "abc", "AB")</code></pre></div></td><td style="vertical-align:top"><p><code>"ABdAB"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-hash"></a>5.4.13 <a href="#func-hash" style="text-decoration: none">fn:hash</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#regex-syntax">next</a> | <a href="#func-normalize-space">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/779">779</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1188">1188</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1422">1422</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1426">1426</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/937">937</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/995">995</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1190">1190</a>&nbsp;23 January 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the results of a specified hash, checksum, or cyclic redundancy check function applied to the input.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:hash</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | xs:hexBinary | xs:base64Binary)?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$algorithm</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>"MD5"</code>,</td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:hexBinary?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>If <code>$value</code> is an instance of <code>xs:string</code>, it is converted to a sequence of octets on the basis of UTF-8 encoding. If <code>$value</code> is an instance of <code>xs:base64Binary</code> or <code>xs:hexBinary</code>, it is converted to a sequence of octets. </p><p>The <code>$algorithm</code> argument, if present, determines the algorithm to be used to calculate a checksum, hash, or cyclic redundancy check. If empty or absent, <code>MD5</code> will be used. The effective value of the algorithm is determined by passing the value through <code>fn:upper-case(fn:normalize-space())</code>. </p><p>Conforming implementations <span class="verb">must</span> support the following options and the functions referred to by them:</p><ul><li><p><code>MD5</code>: the MD5 Message-Digest algorithm, defined by <a href="#rfc6151">[RFC 6151]</a> (update to <a href="#rfc1321">[RFC 1321]</a>).</p></li><li><p><code>SHA-1</code>: the SHA-1 algorithm, defined by <a href="#fips180-4">[FIPS 180-4]</a>. </p></li><li><p><code>SHA-256</code>: the SHA-256 algorithm, defined by <a href="#fips180-4">[FIPS 180-4]</a>. </p></li><li><p><code>BLAKE3</code>: the BLAKE3 algorithm defined by <a href="#BLAKE3">[BLAKE3 Hashing]</a>.</p></li><li><p><code>CRC-32</code>: the CRC-32 algorithm, defined by <a href="#ieee802-3">[IEEE 802-3]</a>. It delivers a 32 bit unsigned integer, which this function returns as a 4-octet <code>xs:hexBinary</code> value representing this integer in big-endian order (that is, most significant byte first).</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Some libraries, notably <code>System.IO.Hashing.Crc32</code> in .NET, return the result in little-endian order.</p></div></li></ul><p>Conforming implementations <span class="verb">may</span> support other checksum and hash functions with implementation-defined semantics. The <code>$options</code> argument, if present, defines additional parameters controlling how the process is conducted.</p><p>The function returns as <code>xs:hexBinary</code> the octets returned by passing <code>$value</code> as an octet sequence through the selected algorithm. The process is followed even if the input octet sequence is empty.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOHA0001" title="err:FOHA0001">err:FOHA0001</a>] if the effective value of the option <code>algorithm</code> is not one of the values supported by the implementation.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>It is common for secure algorithms to be cryptographically broken, as has happened to the algorithms <code>MD5</code>, <code>SHA-1</code>, and <code>SHA-256</code>. And the <code>CRC-32</code> algorithm is not intended for cryptographic purposes. Developers are responsible for ensuring that the algorithm chosen meets any expected security protocols, if relevant.</p><p>The <code>BLAKE3</code> algorithm is included in the list of hashing algorithms because at the time of writing it appears to be a promising candidate as a secure and fast algorithm that shows signs of gaining widespread support. However, this is a fast moving field and the community group recognizes that this decision might eventually not stand the test of time. As the technology evolves in the future, implementations are free to drop support for this algorithm and substitute another that appears to better meet requirements.</p><p>Additional security practices, such as salting, may be applied as a preprocessing step, or <code>fn:hash()</code> can be incorporated into more complex functions.</p><p>In most cases, the <code>xs:hexBinary</code> output of the function will be sought in string form. Because of serialization rules, casting to a string renders the hash in uppercase, and rendering in lowercase (as adopted by <a href="#rfc1321">[RFC 1321]</a> and <a href="#fips180-4">[FIPS 180-4]</a>) requires further adjustment.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $doc := &lt;doc&gt;abc&lt;/doc&gt;</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $salt := "D;%yL9TS:5PalS/d"</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("abc")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:hexBinary("900150983CD24FB0D6963F7D28E17F72")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("ABC")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:hexBinary("902FBDD2B1DF0C4F70B4A5D23525E932")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:hexBinary("D41D8CD98F00B204E9800998ECF8427E")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("ABC", "SHA-1")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:hexBinary("3C01BDBB26F358BAB27F267924AA2C9A03FCFDB8")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("ABC", "BLAKE3") 
=&gt; string()
=&gt; lower-case()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"d1717274597cf0289694f75d96d444b992a096f1afd8e7bbfa6ebb1d360fedfc"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("ABC", "BLAKE3") 
=&gt; xs:base64Binary()
=&gt; string()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"0XFydFl88CiWlPddltREuZKglvGv2Oe7+m67HTYP7fw="</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("ABC", "sha-256")
=&gt; string()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"B5D4045C3F466FA91FE2CC6ABE79232A1A57CDF104F7A26E716E0A1E2789DF78"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("ABC", "sha-256")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:hexBinary("B5D4045C3F466FA91FE2CC6ABE79232A1A57CDF104F7A26E716E0A1E2789DF78")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash($doc)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:hexBinary("900150983CD24FB0D6963F7D28E17F72")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash(serialize($doc), "sha-1") 
=&gt; xs:base64Binary()   
=&gt; string()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"8PzN28NtxQv5RlxQ5/w6DcnrpEU="</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("password123" || $salt, "SHA-256")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:hexBinary("9C9B913EB1B6254F4737CE947EFD16F16E916F9D6EE5C1102A2002E48D4C88BD")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("", "CRC-32")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:hexBinary("00000000")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hash("input", "CRC-32")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:hexBinary("D82832D7")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>hash("password123", "sha-unknown")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p>Raises error FOHA0001.</p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="substring.functions"></a>5.5 <a href="#substring.functions" style="text-decoration: none">Functions based on substring matching</a></h3><p>The functions described in this section examine a string <code>$arg1</code> to see whether it contains another string <code>$arg2</code> as a substring. The result depends on whether <code>$arg2</code> is a substring of <code>$arg1</code>, and if so, on the range of <a title="character" class="termref" href="#character">characters</a> in <code>$arg1</code> which <code>$arg2</code> matches.</p><p>When the <a title="Unicode codepoint collation" class="termref" href="#dt-codepoint-collation">Unicode codepoint collation</a> is used, this simply involves determining whether <code>$arg1</code> contains a contiguous sequence of characters whose <a title="codepoint" class="termref" href="#codepoint">codepoints</a> are the same, one for one, with the codepoints of the characters in <code>$arg2</code>.</p><p>When a collation is specified, the rules are more complex.</p><p>All collations support the capability of deciding whether two <a title="string" class="termref" href="#string">strings</a> are considered equal, and if not, which of the strings should be regarded as preceding the other. For functions such as <a href="#func-compare"><code>fn:compare</code></a>, this is all that is required. For other functions, such as <a href="#func-contains"><code>fn:contains</code></a>, the collation needs to support an additional property: it must be able to decompose the string into a sequence of collation units, each unit consisting of one or more characters, such that two strings can be compared by pairwise comparison of these units.</p><p><span class="termdef"><a id="dt-collation-unit"></a>[Definition] The term <b>collation unit</b> as used in this specification is equivalent to the term <b>collation element</b> used in <a href="#UNICODE-TR10">[UTS #10]</a>.</span></p><p>The string <var>Q</var> is then considered to contain <var>P</var> as a substring if the sequence of collation units corresponding to <var>P</var> is a subsequence of the sequence of collation units corresponding to <var>Q</var>. The characters in <code>P</code> that match are the characters corresponding to these collation units.</p><p>This rule may occasionally lead to surprises. For example, consider a collation that treats <code>"Jaeger"</code> and <code>"Jäger"</code> as equal. It might do this by treating <code>"ä"</code> as representing two collation units, in which case the expression <code>fn:contains("Jäger", "eg")</code> will return <code>true</code>. Alternatively, a collation might treat "ae" as a single collation unit, in which case the expression <code>fn:contains("Jaeger", "eg")</code> will return <code>false</code>. The results of these functions thus depend strongly on the properties of the collation that is used.</p><p>In addition, collations may specify that some collation units should be ignored during matching. If hyphen is an ignored collation unit, then <code>fn:contains("code-point", "codepoint")</code> will be <code>true</code>, and <code>fn:contains("codepoint", "-")</code> will also be <code>true</code>.</p><p> In the rules for the functions defined in this section, we use the following terms taken from <a href="#UNICODE-TR10">[UTS #10]</a>:</p><ul><li><p><span class="termdef"><a id="dt-match.collation"></a>[Definition] The term <b>match</b> is used in the sense of definition DS2 from <a href="#UNICODE-TR10">[UTS #10]</a>.</span></p></li><li><p><span class="termdef"><a id="dt-minimal-match.collation"></a>[Definition] The term <b>minimal match</b> is used in the sense of definition DS4 from <a href="#UNICODE-TR10">[UTS #10]</a>.</span></p></li></ul><p>In the definitions in <a href="#UNICODE-TR10">[UTS #10]</a>, these rules involve a number of parameters. In the context of the functions defined in this section, these parameters are interpreted as follows:</p><ul><li><p><var>C</var> is the collation; that is, the value of the <code>$collation</code> argument if specified, otherwise the default collation.</p></li><li><p><var>P</var> is the (candidate) substring, the value of the <code>$substring</code> argument to the function. </p></li><li><p><var>Q</var> is the (candidate) containing string, the value of the <code>$value</code> argument to the function. </p></li><li><p>The boundary condition <var>B</var> is satisfied at the start and end of a string, and between any two characters that belong to different collation units (“collation elements” in the language of <a href="#UNICODE-TR10">[UTS #10]</a>). It is not satisfied between two characters that belong to the same collation unit.</p></li></ul><p>It is possible to define collations that do not have the ability to decompose a string into units suitable for substring matching. An argument to a function defined in this section may be a URI that identifies a collation that is able to compare two strings, but that does not have the capability to split the string into collation units. Such a collation may cause the function to fail, or to give unexpected results, or it may be rejected as an unsuitable argument. The ability to decompose strings into collation units is an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> property of the collation. The <a href="#func-collation-available"><code>fn:collation-available</code></a> function can be used to ask whether a particular collation has this property.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-contains"><code>fn:contains</code></a></td><td>Returns <code>true</code> if the string <code>$value</code> contains <code>$substring</code> as a substring, taking collations into account.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-starts-with"><code>fn:starts-with</code></a></td><td>Returns <code>true</code> if the string <code>$value</code> contains <code>$substring</code> as a leading substring, taking collations into account.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-ends-with"><code>fn:ends-with</code></a></td><td>Returns <code>true</code> if the string <code>$value</code> contains <code>$substring</code> as a trailing substring, taking collations into account.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-substring-before"><code>fn:substring-before</code></a></td><td>Returns the part of <code>$value</code> that precedes the first occurrence of <code>$substring</code>, taking collations into account.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-substring-after"><code>fn:substring-after</code></a></td><td>Returns the part of <code>$value</code> that follows the first occurrence of <code>$substring</code>, taking collations into account.</td></tr></tbody></table><div class="div3"><h4><a id="func-contains"></a>5.5.1 <a href="#func-contains" style="text-decoration: none">fn:contains</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the string <code>$value</code> contains <code>$substring</code> as a substring, taking collations into account.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:contains</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$substring</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> or <code>$substring</code> is the empty sequence, or contains only ignorable collation units, it is interpreted as the zero-length string.</p><p>If <code>$substring</code> is the zero-length string, then the function returns <code>true</code>.</p><p>If <code>$value</code> is the zero-length string, the function returns <code>false</code>.</p><p>The collation used by this function is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The function returns an <code>xs:boolean</code> indicating whether or not <code>$value</code> contains (at the beginning, at the end, or anywhere within) at least one sequence of collation units that provides a <a title="minimal match" class="termref" href="#dt-minimal-match.collation">minimal match</a> to the collation units in <code>$substring</code>, according to the collation that is used.</p></dd><dt class="label">Error Conditions</dt><dd><p>A <span>dynamic</span> error <span class="verb">may</span> be raised [<a href="#ERRFOCH0004" title="err:FOCH0004">err:FOCH0004</a>] if the specified collation does not support collation units.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $coll := 
"http://www.w3.org/2013/collation/UCA?lang=en;alternate=blanked;strength=primary"</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>The collation used in some of these examples, <code>$coll</code>, is a collation in which both <code>-</code> and <code>*</code> are ignorable collation units.</p></td></tr><tr><td colspan="2"><p>“Ignorable collation unit” is equivalent to “ignorable collation element” in <a href="#UNICODE-TR10">[UTS #10]</a>.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>contains("tattoo", "t")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>contains("tattoo", "ttt")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>contains("", ())</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p><p><em>(The first rule is applied, followed by the second rule.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">contains(
  "abcdefghi",
  "-d-e-f-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">contains(
  "a*b*c*d*e*f*g*h*i*",
  "d-ef-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">contains(
  "abcd***e---f*--*ghi",
  "def",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">contains(
  (),
  "--***-*---",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(The second argument contains only ignorable collation units and is equivalent to the zero-length string.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-starts-with"></a>5.5.2 <a href="#func-starts-with" style="text-decoration: none">fn:starts-with</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the string <code>$value</code> contains <code>$substring</code> as a leading substring, taking collations into account.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:starts-with</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$substring</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> or <code>$substring</code> is the empty sequence, or contains only ignorable collation units, it is interpreted as the zero-length string.</p><p>If <code>$substring</code> is the zero-length string, then the function returns <code>true</code>. If <code>$value</code> is the zero-length string and <code>$substring</code> is not the zero-length string, then the function returns <code>false</code>.</p><p>The collation used by this function is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The function returns an <code>xs:boolean</code> indicating whether or not <code>$value</code> starts with a sequence of collation units that provides a <a title="match" class="termref" href="#dt-match.collation">match</a> to the collation units of <code>$substring</code> according to the collation that is used.</p></dd><dt class="label">Error Conditions</dt><dd><p>A <span>dynamic</span> error <span class="verb">may</span> be raised [<a href="#ERRFOCH0004" title="err:FOCH0004">err:FOCH0004</a>] if the specified collation does not support collation units.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $coll := 
"http://www.w3.org/2013/collation/UCA?lang=en;alternate=blanked;strength=primary"</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>The collation used in some of these examples, <code>$coll</code>, is a collation in which both <code>-</code> and <code>*</code> are ignorable collation units.</p></td></tr><tr><td colspan="2"><p>“Ignorable collation unit” is equivalent to “ignorable collation element” in <a href="#UNICODE-TR10">[UTS #10]</a>.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>starts-with("tattoo", "tat")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>starts-with("tattoo", "att")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>starts-with((), ())</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">starts-with(
  "abcdefghi",
  "-a-b-c-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">starts-with(
  "a*b*c*d*e*f*g*h*i*",
  "a-bc-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">starts-with(
  "abcd***e---f*--*ghi",
  "abcdef",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">starts-with(
  (),
  "--***-*---",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(The second argument contains only ignorable collation units and is equivalent to the zero-length string.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">starts-with(
  "-abcdefghi",
  "-abc",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-ends-with"></a>5.5.3 <a href="#func-ends-with" style="text-decoration: none">fn:ends-with</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the string <code>$value</code> contains <code>$substring</code> as a trailing substring, taking collations into account.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:ends-with</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$substring</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> or <code>$substring</code> is the empty sequence, or contains only ignorable collation units, it is interpreted as the zero-length string.</p><p>If <code>$substring</code> is the zero-length string, then the function returns <code>true</code>. If <code>$value</code> is the zero-length string and the value of <code>$substring</code> is not the zero-length string, then the function returns <code>false</code>.</p><p>The collation used by this function is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The function returns an <code>xs:boolean</code> indicating whether or not <code>$value</code> ends with a sequence of collation units that provides a <a title="match" class="termref" href="#dt-match.collation">match</a> to the collation units of <code>$substring</code> according to the collation that is used.</p></dd><dt class="label">Error Conditions</dt><dd><p>A <span>dynamic</span> error <span class="verb">may</span> be raised [<a href="#ERRFOCH0004" title="err:FOCH0004">err:FOCH0004</a>] if the specified collation does not support collation units.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $coll := 
"http://www.w3.org/2013/collation/UCA?lang=en;alternate=blanked;strength=primary"</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>The collation used in some of these examples, <code>$coll</code>, is a collation in which both <code>-</code> and <code>*</code> are ignorable collation units.</p></td></tr><tr><td colspan="2"><p>“Ignorable collation unit” is equivalent to “ignorable collation element” in <a href="#UNICODE-TR10">[UTS #10]</a>.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>ends-with("tattoo", "tattoo")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>ends-with("tattoo", "atto")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>ends-with((), ())</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">ends-with(
  "abcdefghi",
  "-g-h-i-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">ends-with(
  "abcd***e---f*--*ghi",
  "defghi",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">ends-with(
  "abcd***e---f*--*ghi",
  "defghi",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">ends-with(
  (),
  "--***-*---",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(The second argument contains only ignorable collation units and is equivalent to the zero-length string.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">ends-with(
  "abcdefghi",
  "ghi-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-substring-before"></a>5.5.4 <a href="#func-substring-before" style="text-decoration: none">fn:substring-before</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the part of <code>$value</code> that precedes the first occurrence of <code>$substring</code>, taking collations into account.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:substring-before</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$substring</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI. </p></dd><dt class="label">Rules</dt><dd><p> If <code>$value</code> or <code>$substring</code> is the empty sequence, or contains only ignorable collation units, it is interpreted as the zero-length string.</p><p>If <code>$substring</code> is the zero-length string, then the function returns the zero-length string. </p><p>If <code>$value</code> does not contain a string that is equal to <code>$substring</code>, then the function returns the zero-length string. </p><p>The collation used by this function is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The function returns the substring of <code>$value</code> that precedes in <code>$value</code> the first occurrence of a sequence of collation units that provides a <a title="minimal match" class="termref" href="#dt-minimal-match.collation">minimal match</a> to the collation units of <code>$substring</code> according to the collation that is used.</p></dd><dt class="label">Error Conditions</dt><dd><p>A <span>dynamic</span> error <span class="verb">may</span> be raised [<a href="#ERRFOCH0004" title="err:FOCH0004">err:FOCH0004</a>] if the specified collation does not support collation units.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $coll := 
"http://www.w3.org/2013/collation/UCA?lang=en;alternate=blanked;strength=primary"</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>The collation used in some of these examples, <code>$coll</code>, is a collation in which both <code>-</code> and <code>*</code> are ignorable collation units.</p></td></tr><tr><td colspan="2"><p>“Ignorable collation unit” is equivalent to “ignorable collation element” in <a href="#UNICODE-TR10">[UTS #10]</a>.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring-before("tattoo", "attoo")</code></pre></div></td><td style="vertical-align:top"><p><code>"t"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring-before("tattoo", "tatto")</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring-before((), ())</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">substring-before(
  "abcdefghi",
  "--d-e-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"abc"</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">substring-before(
  "abc--d-e-fghi",
  "--d-e-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"abc--"</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">substring-before(
  "a*b*c*d*e*f*g*h*i*",
  "***cde",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"a*b*"</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">substring-before(
  "Eureka!",
  "--***-*---",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">""</pre></div><p><em>(The second argument contains only ignorable collation units and is equivalent to the zero-length string.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-substring-after"></a>5.5.5 <a href="#func-substring-after" style="text-decoration: none">fn:substring-after</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the part of <code>$value</code> that follows the first occurrence of <code>$substring</code>, taking collations into account.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:substring-after</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$substring</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> or <code>$substring</code> is the empty sequence, or contains only ignorable collation units, it is interpreted as the zero-length string.</p><p>If <code>$substring</code> is the zero-length string, then the function returns the value of <code>$value</code>.</p><p>If <code>$value</code> does not contain a string that is equal to <code>$substring</code>, then the function returns the zero-length string. </p><p>The collation used by this function is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p><p>The function returns the substring of <code>$value</code> that follows in <code>$value</code> the first occurrence of a sequence of collation units that provides a <a title="minimal match" class="termref" href="#dt-minimal-match.collation">minimal match</a> to the collation units of <code>$substring</code> according to the collation that is used. </p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error <span class="verb">may</span> be raised [<a href="#ERRFOCH0004" title="err:FOCH0004">err:FOCH0004</a>] if the specified collation does not support collation units.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $coll := 
"http://www.w3.org/2013/collation/UCA?lang=en;alternate=blanked;strength=primary"</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>The collation used in some of these examples, <code>$coll</code>, is a collation in which both <code>-</code> and <code>*</code> are ignorable collation units.</p></td></tr><tr><td colspan="2"><p>“Ignorable collation unit” is equivalent to “ignorable collation element” in <a href="#UNICODE-TR10">[UTS #10]</a>.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring-after("tattoo", "tat")</code></pre></div></td><td style="vertical-align:top"><p><code>"too"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring-after("tattoo", "tattoo")</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>substring-after((), ())</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">substring-after(
  "abcdefghi",
  "--d-e-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"fghi"</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">substring-after(
  "abc--d-e-fghi",
  "--d-e-",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"-fghi"</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">substring-after(
  "a*b*c*d*e*f*g*h*i*",
  "***cde***",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"*f*g*h*i*"</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">substring-after(
  "Eureka!",
  "--***-*---",
  $coll
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Eureka!"</pre></div><p><em>(The second argument contains only ignorable collation units and is equivalent to the zero-length string.)</em></p></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="string.match"></a>6 <a href="#string.match" style="text-decoration: none">Regular expressions</a></h2><p>The functions described in this section make use of a regular expression syntax for pattern matching. The syntax and semantics of regular expressions are defined in this section.</p><div class="div2"><h3><a id="regex-syntax"></a>6.1 <a href="#regex-syntax" style="text-decoration: none">Regular expression syntax</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#flags">next</a> | <a href="#func-hash">previous</a>)</p><ol><li><p> Regular expressions can include comments (starting and ending with <code>#</code>) if the <code>c</code> flag is set. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/999">999</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1022">1022</a>&nbsp;20 February 2024]</i></p></li><li><p> Word boundaries can be matched. Lookahead and lookbehind assertions are supported. Assertions (including <code>^</code> and <code>$</code>) can no longer be followed by a quantifier. <i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/998">998</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1006">1006</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1856">1856</a>]</i></p></li></ol></div><p>The regular expression syntax used by these functions is defined in terms of the regular expression syntax specified in XSD 1.1 (see <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a>), which in turn is based on the established conventions of languages such as Perl. However, because XML Schema uses regular expressions only for validity checking, it omits some facilities that are widely used with other languages. XPath, therefore, extends the XML Schema regular expression syntax to reinstate some of these capabilities.</p><div class="note"><p class="prefix"><b>Note:</b></p><p> Implementers should consult <a href="#UNICODE-TR18">[UTS #18]</a> for information on using regular expression processing on Unicode characters.</p></div><p>The regular expression syntax and semantics are identical to those defined in <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a> with the additions described in the following subsections.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>In <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a> there are no substantive technical changes to the syntax or semantics of regular expressions relative to <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, but a number of errors and ambiguities have been resolved. For example, the rules for the interpretation of hyphens within square brackets in a regular expression have been clarified; and the semantics of regular expressions are no longer tied to a specific version of Unicode.</p><p>XSD 1.1 is therefore used as the specification baseline, even for processors that only support XSD 1.0.</p></div><div class="div3"><h4><a id="id-regex-processing-model"></a>6.1.1 <a href="#id-regex-processing-model" style="text-decoration: none">Processing model for regular expressions</a></h4><p>As well as extending the XSD 1.1 syntax for regular expressions, this specification also extends the processing model.</p><p>In XSD, a regular expression is defined to denote a set of strings, and the only functionality offered is to test whether a string matches a regular expression: that is, whether it is a member of the set of strings denoted by the regular expression.</p><p>In this specification, matching a string <var>S</var> against a regular expression delivers a more complex outcome.</p><p>First some terminology:</p><ul><li><p><span class="termdef"><a id="dt-character-position"></a>[Definition] A string of length <var>N</var> has <var>N+1</var><b>character positions</b>: one immediately before each character in the string, and one after the last character. In interfaces where character positions are exposed, they are numbered from 1 to <var>N+1</var>.</span></p></li><li><p><span class="termdef"><a id="dt-segment"></a>[Definition] A <b>segment</b> of a string <var>S</var> is a sequence of zero or more contiguous characters starting at a given <a title="character position" class="termref" href="#dt-character-position">character position</a> within <var>S</var>.</span> Segments of a string are uniquely identified by their start position and length. The sequence of characters making up a segment is referred to as the <b>string value</b> of the segment.</p></li><li><p><span class="termdef"><a id="dt-end-position"></a>[Definition] The <b>end position</b> of a segment is the start position of the segment plus its length.</span></p></li></ul><p>The operation of matching a string <var>S</var> against a regular expression delivers:</p><ul><li><p>A set of matching <a title="segment" class="termref" href="#dt-segment">segments</a>. The string <var>S</var> as a whole is said to match the regular expression if the set of matching segments is non-empty.</p></li><li><p>For each matching <a title="segment" class="termref" href="#dt-segment">segment</a><var>M</var>, a collection of <b>captured groups</b>. This is a mapping from positive integers to segments. The integer is called the group number, and corresponds to the ordinal sequence of opening parentheses of capturing subexpressions within the regular expression, as explained below. The corresponding segment is always a segment of <var>S</var>, but in the case of capturing expressions within lookahead assertions, it is not necessarily a segment of <var>M</var>.</p></li></ul><p>The semantics of particular constructs in a regular expression are affected by a set of flags. The available flags and their effect are defined in <a href="#flags"><b>6.2 Flags</b></a>.</p><p>The different functions available, such as <a href="#func-replace"><code>fn:replace</code></a> and <a href="#func-tokenize"><code>fn:tokenize</code></a>, are defined in terms of this outcome. For example:</p><ul><li><p>The function <a href="#func-matches"><code>fn:matches</code></a> returns true if the set of matching segments is non-empty.</p></li><li><p>The function <a href="#func-replace"><code>fn:replace</code></a> replaces matching segments of the input string with a replacement string.</p></li><li><p>The function <a href="#func-tokenize"><code>fn:tokenize</code></a> returns the segments of the input string that appear between the matching segments.</p></li></ul><p>In principle the set of segments that match a regular expression can be determined by enumerating all the segments of the input string and examining each one independently to establish whether it matches. In practice, however:</p><ul><li><p>If several matching segments have the same starting position, then only one of them is returned. This is chosen as follows:</p><ul><li><p>In the case of a choice (operator <code>"|"</code>) the first matching branch is chosen.</p></li><li><p>In the case of a repetition with a greedy quantifier (for example <code>"+"</code> or <code>"*"</code>) the longest matching segment is chosen.</p></li><li><p>In the case of a repetition with a reluctant quantifier (for example <code>"+?"</code> or <code>"*?"</code>) the shortest matching segment is chosen.</p></li></ul></li><li><p>A matching segment is not included in the result if it overlaps an earlier matching segment: specifically, a segment with start position <var>S<sub>1</sub></var> is excluded if there is a segment that has start position <var>S<sub>0</sub></var> and length <var>L<sub>0</sub></var>, where <code><var>S<sub>0</sub></var> &lt; <var>S<sub>1</sub></var> &lt; <var>S<sub>0</sub></var>+<var>L<sub>0</sub></var></code>.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>Two segments can be adjacent: that is, the start position of one <a title="segment" class="termref" href="#dt-segment">segment</a> can be equal to the <a title="end position" class="termref" href="#dt-end-position">end position</a> of the previous segment. This is true even when the second segment is zero-length (the two segments are not considered to be overlapping, even though they have the same <a title="end position" class="termref" href="#dt-end-position">end position</a>). This means, for example, that the regular expression <code>a*(?=x)</code> has two non-overlapping matches against the string <code>aaax</code>, one at position 1 and the other at position 4.</p></div><p><span class="termdef"><a id="dt-disjoint-matching-segments"></a>[Definition] The <b>disjoint matching segments</b> obtained by applying a regular expression <var>R</var> to a string <var>S</var> in the presence of a set of flags <var>F</var> are the <a title="segment" class="termref" href="#dt-segment">segments</a> of <var>S</var> that match <var>R</var> (using flags <var>F</var>), after elimination of overlapping segments.</span></p><p>The semantics of a regular expression are thus defined by stating which segments of an input string it matches, and what the captured groups corresponding to this match are. This is defined recursively for each construct that may appear within a regular expression, in terms of the outcome of applying its subexpressions.</p><p>For constructs defined in XSD 1.1 (<code>branch</code>, <code>piece</code>, <code>NormalChar</code>, <code>charClass</code>), XSD defines a set of strings denoted by the construct. The corresponding semantics for this specification are that the segments matched by such a construct are the segments whose string value is contained in this set.</p><p>For constructs added to the XSD 1.1 baseline by this specification, the semantics are defined in the sections that follow.</p></div><div class="div3"><h4><a id="regex-comments"></a>6.1.2 <a href="#regex-comments" style="text-decoration: none">Comments</a></h4><p>Comments are enabled in regular expressions if the <code>c</code> flag is present.</p><p>A comment starts with a <code>#</code> character that is not escaped with an immediately preceding backslash, and that is not contained in a <code>CharClassExpr</code> (that is, in square brackets). It ends with the following <code>#</code> character, or with the end of the string containing the regular expression.</p><p>Whether or not the <code>c</code> flag is present, the production for <code>SingleCharEsc</code> allows the <code>#</code> character to be escaped. </p></div><div class="div3"><h4><a id="id-regex-grammar"></a>6.1.3 <a href="#id-regex-grammar" style="text-decoration: none">Regular expression grammar</a></h4><p>The grammar for regular expressions is summarized here. Rules that differ from their definition in XSD 1.1 are marked with the character <code>§</code> against their names.</p><p>In these rules the notation<code>【abc】</code>matches any of the characters <code>'a'</code>, <code>'b'</code>, or <code>'c'</code>, while <code>【0➜9】</code> matches any character whose Unicode codepoint is within a given range, and <code>¬【abc】</code> matches any character other than <code>'a'</code>, <code>'b'</code>, or <code>'c'</code>. These symbols are used in place of the more conventional notation to allow special characters such as square brackets and hyphens to appear directly without escaping. Within the lenticular brackets, all characters other than <code>➜</code> (including hyphen and backslash) represent themselves.</p><div class="exampleInner"><pre xml:space="preserve" class="small">regExp              ::= branch ( '|' branch )*
branch              ::= piece*
piece               ::= (atom quantifier?) | assertion
§quantifier         ::= ( 【?*+】 | ( '{' quantity '}' ) ) '?'?
quantity            ::= quantRange | quantMin | QuantExact
quantRange          ::= QuantExact ',' QuantExact
quantMin            ::= QuantExact ','
QuantExact          ::= 【0➜9】+
§atom               ::= NormalChar | charClass | ( '(' '?:'? regExp ')' ) | backReference 
NormalChar          ::= ¬【.\?*+{}()|[]】	
charClass           ::= SingleCharEsc | charClassEsc | charClassExpr | WildcardEsc
charClassExpr       ::= '[' charGroup ']'
charGroup           ::= ( posCharGroup | negCharGroup ) ( '-' charClassExpr )?
posCharGroup        ::= ( charGroupPart )+
negCharGroup        ::= '^' posCharGroup  
charGroupPart       ::= singleChar | charRange | charClassEsc
singleChar          ::= SingleCharEsc | SingleCharNoEsc
charRange           ::= singleChar '-' singleChar
SingleCharNoEsc     ::= ¬【\[]】
charClassEsc        ::= ( MultiCharEsc | catEsc | complEsc )
§SingleCharEsc      ::= '\' 【nrt\|.?*+(){}$-[]^#】	
catEsc              ::= '\p{' charProp '}'
complEsc            ::= '\P{' charProp '}'
charProp            ::= IsCategory | IsBlock
IsCategory          ::= Letters | Marks | Numbers | Punctuation 
                        | Separators | Symbols | Others
Letters             ::= 'L' 【ultmo】?
Marks               ::= 'M' 【nce】?
Numbers             ::= 'N' 【dlo】?
Punctuation         ::= 'P' 【cdseifo】?
Separators          ::= 'Z' 【slp】?
Symbols             ::= 'S' 【mcko】?
Others              ::= 'C' 【cfon】?
IsBlock             ::= 'Is' 【a➜zA➜Z0➜9-】+
MultiCharEsc        ::= '\' 【sSiIcCdDwW】
WildcardEsc         ::= '.'
§assertion          ::= startOfString | endOfString | wordBoundary 
                        | positiveLookahead | negativeLookahead 
                        | positiveLookbehind | negativeLookbehind
§startOfString      ::= '^'
§endOfString        ::= '$'
§wordBoundary       ::= '\b' | '\B'
§backReference      ::= '\' 【1➜9】【0➜9】*
§positiveLookahead  ::= '(?=' regExp ')' 
                        | '(*positive_lookahead:' regExp ')'
§negativeLookahead  ::= '(?!' regExp ')' 
                        | '(*negative_lookahead:' regExp ')'
§positiveLookbehind ::= '(?&lt;=' simpleRegExp ')' 
                        | '(*positive_lookbehind:' simpleRegExp ')'
§negativeLookbehind ::= '(?&lt;!' simpleRegExp ')' 
                        | '(*negative_lookbehind:' simpleRegExp ')'
§simpleRegExp       ::= simplePiece ( '|' simplePiece )*
§simplePiece        ::= (NormalChar | charClass)*</pre></div><p>This grammar applies to the regular expression after removal of whitespace and comments if enabled by the <code>x</code> and <code>c</code> flags respectively: see <a href="#flags"><b>6.2 Flags</b></a>.</p><p>XSD 1.1 defines additional rules to disambiguate this grammar.</p></div><div class="div3"><h4><a id="reluctant-quantifiers"></a>6.1.4 <a href="#reluctant-quantifiers" style="text-decoration: none">Reluctant quantifiers</a></h4><p><em>Reluctant quantifiers</em> are supported. They are indicated by a <code>?</code> following a quantifier. Specifically:</p><ul><li><p><code>X??</code> matches X, once or not at all</p></li><li><p><code>X*?</code> matches X, zero or more times</p></li><li><p><code>X+?</code> matches X, one or more times</p></li><li><p><code>X{n}?</code> matches X, exactly n times</p></li><li><p><code>X{n,}?</code> matches X, at least n times</p></li><li><p><code>X{n,m}?</code> matches X, at least n times, but not more than m times</p></li></ul><p>Quantifiers that are not <b>reluctant</b> are referred to as <b>greedy</b>.</p><p>When a quantifier appears at the outermost level of a regular expression, the distinction between greedy and reluctant quantifiers affects the set of matching segments delivered by the matching operation. With a greedy quantifier, the longest matching segment at a given start position is returned; with a reluctant quantifier, the shortest matching segment at a given start position is returned.</p><p>When a quantifier appears within a subexpression, the quantified subexpression matches the <em>shortest</em> possible substring consistent with the match as a whole succeeding if the quantifier is reluctant, or the <em>longest</em> possible substring consistent with the match as a whole succeeding if the quantifier is greedy.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Reluctant quantifiers have no effect on the results of the boolean <a href="#func-matches"><code>fn:matches</code></a> function, since this function is only interested in discovering whether a matching segment exists, regardless of its start position and length.</p></div></div><div class="div3"><h4><a id="captured-subexpressions"></a>6.1.5 <a href="#captured-subexpressions" style="text-decoration: none">Captured groups</a></h4><p>The regular expression syntax defined by <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> allows a regular expression to contain parenthesized subexpressions, but attaches no special significance to them. Some operations associated with regular expressions (for example, back-references, and the <a href="#func-replace"><code>fn:replace</code></a> function) allow access to the parts of the input string that matched a parenthesized subexpression (called captured groups).</p><p><span class="termdef"><a id="dt-capturing-subexpression"></a>[Definition] A left parenthesis is recognized as a capturing left parenthesis provided it is not immediately followed by <code>?</code> or <code>*</code> (see below), is not within a character group (square brackets), and is not escaped with a backslash. The sub-expression enclosed by a capturing left parenthesis and its matching right parenthesis is referred to as a <b>capturing subexpression</b>.</span></p><p>More specifically, the <a title="capturing subexpression" class="termref" href="#dt-capturing-subexpression">capturing subexpression</a> enclosed by the <var>N</var>th capturing left parenthesis within the regular expression (determined by its character position in left-to-right order, and counting from one) is referred to as the <var>N</var>th capturing subexpression. </p><p>For example, in the regular expression <code>A(BC(?:D(EF(GH[()]))))</code>, the subexpression <code>BC(?:D(EF(GH[()])))</code> is capturing subexpression 1, the string subexpression <code>EF(GH[()])</code> is capturing subexpression 2, and the subexpression <code>GH[()]</code> is capturing subexpression 3. </p><p>When, in the course of evaluating a regular expression, a particular <a title="segment" class="termref" href="#dt-segment">segment</a> of the input matches a capturing subexpression, that segment becomes available as a <b>captured group</b>. The segment matched by the <var>N</var>th capturing subexpression is referred to as the <var>N</var>th captured group. By convention, the segment captured by the entire regular expression is treated as captured group 0 (zero).</p><p>When a <a title="capturing subexpression" class="termref" href="#dt-capturing-subexpression">capturing subexpression</a> is matched more than once (because it is within a construct that allows repetition), then only the last substring that it matched will be captured. Note that this rule is not sufficient in all cases to ensure an unambiguous result, especially in cases where (a) the regular expression contains nested repeating constructs, and/or (b) the repeating construct matches a zero-length string. In such cases it is implementation-dependent which substring is captured. For example given the regular expression <code>(a*)+</code> and the input string <code>"aaaa"</code>, an implementation might legitimately capture either <code>"aaaa"</code> or a zero length string as the content of the captured subgroup.</p><p>Parentheses that are required to group terms within the regular expression, but which are not required for capturing of substrings, can be represented using the syntax <code>(?:xxxx)</code>.</p><p>In the absence of back-references (see below), the presence of the optional <code>?:</code> has no effect on the set of strings that match the regular expression, but causes the left parenthesis not to be counted by operations (such as <a href="#func-replace"><code>fn:replace</code></a> and back-references) that number the capturing sub-expressions within a regular expression.</p></div><div class="div3"><h4><a id="back-references"></a>6.1.6 <a href="#back-references" style="text-decoration: none">Back-references</a></h4><p> Back-references are allowed outside a character class expression. A back-reference is an additional kind of atom. The construct <code>\N</code> where <code>N</code> is a single digit is always recognized as a back-reference; if this is followed by further digits, these digits are taken to be part of the back-reference if and only if the resulting number <var>NN</var> is such that the back-reference is preceded by the opening parenthesis of the <var>NN</var>th capturing left parenthesis. The regular expression is invalid if a back-reference refers to a capturing sub-expression that does not exist or whose closing right parenthesis occurs after the back-reference. </p><p>A back-reference with number <var>N</var> matches a string that is the same as the value of the <code>N</code>th captured substring.</p><p>For example, the regular expression <code>('|").*\1</code> matches a sequence of characters delimited either by an apostrophe at the start and end, or by a quotation mark at the start and end. </p><p>If no string has been matched by the <code>N</code>th capturing sub-expression, the back-reference is interpreted as matching a zero-length string.</p><div class="note"><p class="prefix"><b>Note:</b></p><p> Within a character class expression, <code>\</code> followed by a digit is invalid. Some other regular expression languages interpret this as an octal character reference. </p></div></div><div class="div3"><h4><a id="unicode-block-names"></a>6.1.7 <a href="#unicode-block-names" style="text-decoration: none">Unicode block names</a></h4><p>A regular expression that uses a Unicode block name that is not defined in the version(s) of Unicode supported by the processor (for example <code>\p{IsBadBlockName}</code>) is deemed to be invalid [<a href="#ERRFORX0002" title="err:FORX0002">err:FORX0002</a>].</p><div class="note"><p class="prefix"><b>Note:</b></p><p>XSD 1.0 does not say how this situation should be handled; XSD 1.1 says that it should be handled by treating all characters as matching.</p></div></div><div class="div3"><h4><a id="id-assertions"></a>6.1.8 <a href="#id-assertions" style="text-decoration: none">Assertions</a></h4><p>Assertions (sometimes called <em>zero-width assertions</em>) test whether a particular condition applies at the current position in the input string (resulting in either a match or a no-match), but they do not cause any change to the current position.</p><p>Assertions fall into the following categories:</p><ul><li><p>The <code>startOfString</code> assertion <code>^</code> tests whether the current position is at the start of the string.</p></li><li><p>The <code>endOfString</code> assertion <code>$</code> tests whether the current position is at the end of the string.</p></li><li><p>The <code>boundary</code> assertions <code>\b</code> and <code>\B</code> test whether the current position is at the start or end of a word.</p></li><li><p>The positive and negative lookahead assertions test whether there is (or is not) a substring starting at the current position that matches a given regular expression.</p></li><li><p>The positive and negative lookbehind assertions test whether there is (or is not) a substring ending at the current position that matches a given regular expression.</p></li></ul><p>An assertion <span class="verb">must not</span> be followed by a quantifier.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Previous versions of this specification allowed a quantifier to follow the <code>startOfString</code> and <code>endOfString</code> assertions, though this served no practical purpose. Processors <span class="verb">may</span> provide an option to allow quantifiers to be used in this situation in order to preserve backward compatibility.</p></div><div class="div4"><h5><a id="matching-start-and-end"></a>6.1.8.1 <a href="#matching-start-and-end" style="text-decoration: none">Matching the Start and End of the String</a></h5><p>Two meta-characters, <code>^</code> and <code>$</code> are added. By default, the meta-character <code>^</code> matches if the current position is the start of the entire string, while <code>$</code> matches if the current position is the end of the entire string. In multi-line mode, <code>^</code> matches the start of any line (that is, the start of the entire string, and the position immediately after a newline character), while <code>$</code> matches the end of any line (that is, the end of the entire string, and the position immediately before a newline character). Newline here means the character <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) only.</p><p>Single character escapes are extended to allow the <code>$</code> character to be escaped.</p></div><div class="div4"><h5><a id="regex-boundary-assertions"></a>6.1.8.2 <a href="#regex-boundary-assertions" style="text-decoration: none">Boundary assertions</a></h5><p>The assertion <code>\b</code> matches at any position where one of the following conditions is true:</p><ul><li><p>The current position is the start of the string, the string is not empty, and the first character in the string matches <code>\w</code>.</p></li><li><p>The current position is the end of the string, the string is not empty, and the last character in the string matches <code>\w</code>.</p></li><li><p>The character before the current position matches <code>\w</code> and the character after the current position matches <code>\W</code>.</p></li><li><p>The character before the current position matches <code>\W</code> and the character after the current position matches <code>\w</code>.</p></li></ul><p>Informally, <code>\b</code> matches if the current position is the start or end of a word, where a word is defined as a sequence of consecutive characters other than codepoints in Unicode groups <code>P</code> (punctuation), <code>Z</code> (separator), or <code>C</code> (other).</p><p>The assertion <code>\B</code> matches at any position where <code>\b</code> does not match.</p></div><div class="div4"><h5><a id="regex-positive-lookahead"></a>6.1.8.3 <a href="#regex-positive-lookahead" style="text-decoration: none">Positive Lookahead Assertions</a></h5><p>There are two equivalent ways of writing a positive lookahead assertion:</p><p><code>(?=<var>xyz</var>)</code></p><p><code>(*positive_lookahead:<var>xyz</var>)</code></p><p>In both cases, the assertion matches at a particular position in the input string only if there is a substring starting at that position that matches the regular expression <var>xyz</var>.</p><p>As with all assertions, evaluation of the assertion does not cause the current position to advance.</p><p>For example, <code>Chapter(?=\s+[1-9])</code> will match <code>"Chapter"</code> only if followed by a number, with intervening whitespace.</p><p>A parenthesized expression within a lookahead assertion can capture a substring in the normal way. There are some minor complications, however:</p><ul><li><p>Substrings captured while evaluating a lookahead assertion are represented differently in the result of the <a href="#func-analyze-string"><code>fn:analyze-string</code></a> function, because they can overlap other substrings in arbitrary ways.</p></li><li><p>If an assertion is satisfied, then any substrings that are captured are based on the first evaluation of the assertion that matches; alternative evaluations of the assertion that also match, but which capture different substrings, are not considered.</p></li></ul><p>A positive lookahead assertion that matches a zero-length string is permitted but pointless, since it will always match, and thus cause the assertion to succeed.</p></div><div class="div4"><h5><a id="regex-negative-lookahead-assertion"></a>6.1.8.4 <a href="#regex-negative-lookahead-assertion" style="text-decoration: none">Negative Lookahead Assertion</a></h5><p>There are two equivalent ways of writing a negative lookahead assertion:</p><p><code>(?!<var>xyz</var>)</code></p><p><code>(*negative_lookahead:<var>xyz</var>)</code></p><p>In both cases, the assertion matches at a particular position in the input string only if there is no substring starting at that position that matches the regular expression <var>xyz</var>.</p><p>As with all assertions, evaluation of the assertion does not cause the current position to advance.</p><p>For example, <code>Chapter(?!\s*[1-9])</code> will match <code>"Chapter"</code> only if it is not followed by a number, with optional intervening whitespace.</p><p>Any capturing parentheses within a negative lookahead assertion are counted for the purpose of numbering captured groups, but they cannot capture any result because the pattern in the assertion must fail to match.</p><p>A negative lookahead assertion that matches a zero-length string is permitted but pointless, since it will always match, and thus cause the assertion to fail.</p></div><div class="div4"><h5><a id="regex-positive-lookbehind"></a>6.1.8.5 <a href="#regex-positive-lookbehind" style="text-decoration: none">Positive Lookbehind Assertions</a></h5><p>There are two equivalent ways of writing a positive lookbehind assertion:</p><p><code>(?&lt;=<var>xyz</var>)</code></p><p><code>(*positive_lookbehind:<var>xyz</var>)</code></p><p>The second form may be more convenient when the expression appears within an XML-based host language such as XSLT, where the angle bracket would need to be escaped.</p><p>In both cases, the assertion matches at a particular position in the input string only if there is a substring ending at that position that matches the regular expression <var>xyz</var>.</p><p>For efficiency and ease of implementation, the regular expression contained within a lookbehind assertion is constrained. It must consist of one or more alternatives separated by <code>"|"</code>, and each alternative must be fixed-length, consisting only of the following constructs, each of which matches a single character:</p><ul><li><p><code>NormalChar</code> (for example <code>"A"</code>, <code>"3"</code>)</p></li><li><p><code>SingleCharEsc</code> (for example <code>"\("</code>, <code>"\["</code>)</p></li><li><p><code>charClassEsc</code> (for example <code>"\s"</code>, <code>"\p{Lu}"</code>)</p></li><li><p><code>charClassExpr</code> (for example <code>"[a-z]"</code>)</p></li><li><p><code>WildcardEsc</code> (<code>"."</code>)</p></li></ul><p>As with all assertions, evaluation of the assertion does not cause the current position to advance.</p><p>Parenthesized expressions cannot appear within lookbehind assertions.</p><p>For example, <code>(?&lt;=\[)[0-9+](?=\])</code> matches a sequence of digits immediately preceded by an opening square bracket and followed by a closing square bracket, without matching the brackets.</p></div><div class="div4"><h5><a id="regex-negative-lookbehind"></a>6.1.8.6 <a href="#regex-negative-lookbehind" style="text-decoration: none">Negative Lookbehind Assertion</a></h5><p>There are two equivalent ways of writing a negative lookbehind assertion:</p><p><code>(?&lt;!<var>xyz</var>)</code></p><p><code>(*negative_lookbehind:<var>xyz</var>)</code></p><p>The second form may be more convenient when the expression appears within an XML-based host language such as XSLT, where the angle bracket would need to be escaped.</p><p>In both cases, the assertion matches at a particular position in the input string only if there is no substring ending at that position that matches the regular expression <var>xyz</var>.</p><p>The regular expression within a negative lookbehind assertion is subject to the same restrictions as for a positive lookbehind assertion: see <a href="#regex-positive-lookbehind"><b>6.1.8.5 Positive Lookbehind Assertions</b></a>.</p><p>For example, <code>(?&lt;!\$)[0-9]+</code> matches any sequence of digits that is not immediately preceded by a dollar sign.</p></div></div></div><div class="div2"><h3><a id="flags"></a>6.2 <a href="#flags" style="text-decoration: none">Flags</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-replace">next</a> | <a href="#regex-syntax">previous</a>)</p><ol><li><p> Regular expressions can include comments (starting and ending with <code>#</code>) if the <code>c</code> flag is set. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/999">999</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1022">1022</a>&nbsp;20 February 2024]</i></p></li></ol></div><p>All these functions provide an optional parameter, <code>$flags</code>, to set options for the interpretation of the regular expression. The parameter accepts a <code>xs:string</code>, in which individual letters are used to set options. The presence of a letter within the string indicates that the option is on; its absence indicates that the option is off. Letters may appear in any order and may be repeated. They are case-sensitive. If there are characters present that are not defined here as flags, then a dynamic error is raised [<a href="#ERRFORX0001" title="err:FORX0001">err:FORX0001</a>].</p><p>The following options are defined:</p><ul><li><p><code>s</code>: If present, the match operates in “dot-all” mode. (Perl calls this the single-line mode.) If the <code>s</code> flag is not specified, the meta-character <code>.</code> matches any character except a newline (<code>#x0A</code>) or carriage return (<code>#x0D</code>) character. In dot-all mode, the meta-character <code>.</code> matches any character whatsoever. Suppose the input contains the strings <code>"hello"</code> and <code>"world"</code> on two lines. This will not be matched by the regular expression <code>"hello.*world"</code> unless dot-all mode is enabled.</p></li><li><p><code>m</code>: If present, the match operates in multi-line mode. By default, the meta-character <code>^</code> matches the start of the entire string, while $ matches the end of the entire string. In multi-line mode, <code>^</code> matches the start of any line (that is, the start of the entire string, and the position immediately after a newline character other than a newline that appears as the last character in the string), while <code>$</code> matches the end of any line (that is, the position immediately before a newline character, and the end of the entire string if there is no newline character at the end of the string). Newline here means the character <code>#x0A</code> only.</p></li><li><p><code>i</code>: If present, the match operates in case-insensitive mode. The detailed rules are as follows. In these rules, a character C2 is considered to be a <em>case-variant</em> of another character C1 if the following XPath expression returns <code>true</code> when the two characters are considered as strings of length one, and the <a title="Unicode codepoint collation" class="termref" href="#dt-codepoint-collation">Unicode codepoint collation</a> is used:</p><p><code>fn:lower-case(C1) eq fn:lower-case(C2) or fn:upper-case(C1) eq fn:upper-case(C2)</code></p><p> Note that the case-variants of a character under this definition are always single characters.</p><ol class="enumar"><li><p> When a normal character (<code>Char</code>) is used as an atom, it represents the set containing that character and all its case-variants. For example, the regular expression <code>"z"</code> will match both <code>"z"</code> and <code>"Z"</code>.</p></li><li><p> A character range (production <code>charRange</code> in the XSD 1.0 grammar, replaced by productions <code>charRange</code> and <code>singleChar</code> in XSD 1.1) represents the set containing all the characters that it would match in the absence of the <code>i</code> flag, together with their case-variants. For example, the regular expression <code>"[A-Z]"</code> will match all the letters <code>A</code> to <code>Z</code> and all the letters <code>a</code> to <code>z</code>. It will also match certain other characters such as <code>#x212A</code> (KELVIN SIGN), since <code>fn:lower-case("#x212A")</code> is <code>k</code>.</p><p> This rule applies also to a character range used in a character class subtraction (<code>charClassSub</code>): thus [A-Z-[IO]] will match characters such as <code>A</code>, <code>B</code>, <code>a</code>, and <code>b</code>, but will not match <code>I</code>, <code>O</code>, <code>i</code>, or <code>o</code>.</p><p> The rule also applies to a character range used as part of a negative character group: thus <code>"[^Q]"</code> will match every character except <code>Q</code> and <code>q</code> (these being the only case-variants of <code>Q</code> in Unicode).</p></li><li><p> A back-reference is compared using case-blind comparison: that is, each character must either be the same as the corresponding character of the previously matched string, or must be a case-variant of that character. For example, the strings <code>"Mum"</code>, <code>"mom"</code>, <code>"Dad"</code>, and <code>"DUD"</code> all match the regular expression <code>"([md])[aeiou]\1"</code> when the <code>i</code> flag is used.</p></li><li><p> All other constructs are unaffected by the <code>i</code> flag. For example, <code>"\p{Lu}"</code> continues to match upper-case letters only.</p></li></ol></li><li><p><code>x</code>: If present, whitespace characters (that is, <span class="unicode-codepoint">U+0009</span> (<span class="unicode-name">TAB</span>) , <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) , <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) and <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) ) in the regular expression are removed prior to matching with one exception: whitespace characters within character class expressions (<code>charClassExpr</code>) are not removed. This flag can be used, for example, to break up long regular expressions into readable lines.</p><p> Examples:</p><p><code>fn:matches("helloworld", "hello world", "x")</code> returns <code>true()</code></p><p><code>fn:matches("helloworld", "hello[ ]world", "x")</code> returns <code>false()</code></p><p><code>fn:matches("hello world", "hello\ sworld", "x")</code> returns <code>true()</code></p><p><code>fn:matches("hello world", "hello world", "x")</code> returns <code>false()</code></p><div class="note"><p class="prefix"><b>Note:</b></p><p>Whitespace is treated as a lexical construct to be removed before the regular expression is parsed; it is therefore not explicit in the regular expression grammar.</p></div></li><li><p><code>q</code>: if present, all characters in the regular expression are treated as representing themselves, not as metacharacters. In effect, every character that would normally have a special meaning in a regular expression is implicitly escaped by preceding it with a backslash.</p><p>Furthermore, when this flag is present, the characters <code>$</code> and <code>\</code> have no special significance when used in the replacement string supplied to the <a href="#func-replace"><code>fn:replace</code></a> function.</p><p>This flag can be used in conjunction with the <code>i</code> flag. If it is used together with the <code>m</code>, <code>s</code>, <code>x</code>, <span>or <code>c</code></span> flag, that flag has no effect.</p><p>Examples:</p><p><code>tokenize("12.3.5.6", ".", "q")</code> returns <code>("12", "3", "5", "6")</code></p><p><code>replace("a\b\c", "\", "\\", "q")</code> returns <code>"a\\b\\c"</code></p><p><code>replace("a/b/c", "/", "$", "q")</code> returns <code>"a$b$c"</code></p><p><code>matches("abcd", ".*", "q")</code> returns <code>false()</code></p><p><code>matches("Mr. B. Obama", "B. OBAMA", "iq")</code> returns <code>true()</code></p></li><li><p><code>c</code>: if present, comments are enabled in the regular expression. This flag has no effect if the <code>q</code> flag is present. A comment is recognized by the presence of a <code>#</code> character that is not escaped by a backslash or contained in a character class expression (<code>charClassExpr</code>), and it is terminated by the following <code>#</code> character or by the end of the regular expression string.</p><p>For example:</p><p><code>replace("03/24/2025", "(..#month#)/(..#day#)/(....#year#)", "$3-$1-$2", "c")</code></p><div class="note"><p class="prefix"><b>Note:</b></p><p>Comments are treated as a lexical construct to be removed before the regular expression is parsed; they are therefore not explicit in the regular expression grammar.</p></div></li></ul></div><div class="div2"><h3><a id="regex-functions"></a>6.3 <a href="#regex-functions" style="text-decoration: none">Functions using regular expressions</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-matches"><code>fn:matches</code></a></td><td>Returns <code>true</code> if the supplied string matches a given regular expression.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-replace"><code>fn:replace</code></a></td><td>Returns a string produced from the input string by replacing any segments that match a given regular expression with a supplied replacement string, provided either literally, or by invoking a supplied function.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-tokenize"><code>fn:tokenize</code></a></td><td>Returns a sequence of strings constructed by splitting the input wherever a separator is found; the separator is any substring that matches a given regular expression.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-analyze-string"><code>fn:analyze-string</code></a></td><td>Analyzes a string using a regular expression, returning an XML structure that identifies which parts of the input string matched or failed to match the regular expression, and in the case of matched substrings, which substrings matched each capturing group in the regular expression.</td></tr></tbody></table><div class="div3"><h4><a id="func-matches"></a>6.3.1 <a href="#func-matches" style="text-decoration: none">fn:matches</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the supplied string matches a given regular expression.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:matches</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$pattern</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$flags</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>""</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, it is interpreted as the zero-length string.</p><p>If the <code>$flags</code> argument is omitted or if it is the empty sequence, the effect is the same as setting <code>$flags</code> to a zero-length string. Flags are defined in <a href="#flags"><b>6.2 Flags</b></a>.</p><p>The function returns <code>true</code> if the set of <a title="disjoint matching segments" class="termref" href="#dt-disjoint-matching-segments">disjoint matching segments</a> obtained by matching <code>$value</code> against the regular expression <code>$pattern</code>, with the associated <code>$flags</code>, is non-empty. Otherwise, the function returns <code>false</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORX0002" title="err:FORX0002">err:FORX0002</a>] if <code>$pattern</code> is invalid according to the rules described in <a href="#regex-syntax"><b>6.1 Regular expression syntax</b></a>. </p><p>A dynamic error is raised [<a href="#ERRFORX0001" title="err:FORX0001">err:FORX0001</a>] if <code>$flags</code> is invalid according to the rules described in <a href="#flags"><b>6.2 Flags</b></a>. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Unless the metacharacters <code>^</code> and <code>$</code> are used as anchors, the string is considered to match the pattern if any substring matches the pattern. But if anchors are used, the anchors must match the start/end of the string (in string mode), or the start/end of a line (in multi-line mode). </p><p>This is different from the behavior of patterns in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, where regular expressions are <em>implicitly</em> anchored.</p><p>Regular expression matching is defined on the basis of Unicode codepoints; it takes no account of collations.</p><p>It is valid for the regular expression to match a zero-length segment of <code>$value</code>. For example, the result of the expression <code>matches($s, "")</code> is always true, regardless of the value of <code>$s</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $poem := &lt;poem author="Wilhelm Busch"&gt;
Kaum hat dies der Hahn gesehen,
Fängt er auch schon an zu krähen:
Kikeriki! Kikikerikih!!
Tak, tak, tak! - da kommen sie.
&lt;/poem&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>matches("abracadabra", "bra")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>matches("abracadabra", "^a.*a$")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>matches("abracadabra", "^bra")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>matches($poem, "Kaum.*krähen")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>matches($poem, "Kaum.*krähen", "s")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>matches($poem, "^Kaum.*gesehen,$", "m")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>matches($poem, "^Kaum.*gesehen,$")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>matches($poem, "kiki", "i")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-replace"></a>6.3.2 <a href="#func-replace" style="text-decoration: none">fn:replace</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-tokenize">next</a> | <a href="#flags">previous</a>)</p><ol><li><p>The <code>$replacement</code> argument can now be a function that computes the replacement strings.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1876">1876</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1897">1897</a>&nbsp;8 April 2025]</i></p></li><li><p>It is now permitted for the regular expression to match a zero-length string.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1911">1911</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1913">1913</a>&nbsp;8 April 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a string produced from the input string by replacing any segments that match a given regular expression with a supplied replacement string, provided either literally, or by invoking a supplied function.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:replace</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$pattern</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$replacement</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | fn(xs:untypedAtomic, xs:untypedAtomic*) as item()?)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$flags</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>''</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, it is interpreted as the zero-length string.</p><p>If the <code>$flags</code> argument is omitted or if it is the empty sequence, the effect is the same as setting <code>$flags</code> to a zero-length string. Flags are defined in <a href="#flags"><b>6.2 Flags</b></a>.</p><p>The string <code>$value</code> is matched against the regular expression <code>$pattern</code>, using the supplied <code>$flags</code>, to obtain a set of <a title="disjoint matching segments" class="termref" href="#dt-disjoint-matching-segments">disjoint matching segments</a>. A replacement string <var>R</var> for each of these segments (say <var>M</var>) is determined by the value of the <code>$replacement</code> argument, by applying the first of the following rules that applies:</p><ul><li><p>If <code>$replacement</code> is absent or empty, <var>R</var> is a zero-length string.</p></li><li><p>If <code>$replacement</code> is a function item <var>F</var>, then <var>R</var> is obtained by calling <var>F</var>, and then applying the function <a href="#func-string"><code>fn:string</code></a> to the result.</p><p>The first argument to <var>F</var> is the string to be replaced, provided as <code>xs:untypedAtomic</code>.</p><p>The second argument to <var>F</var> provides the captured groups as an <code>xs:untypedAtomic</code> sequence. The <code>Nth</code> item in this sequence is the string value of the segment captured by the <code>Nth</code> capturing subexpression. If the <code>Nth</code> capturing subexpression was not matched, the <code>Nth</code> item will be the zero-length string.</p><p>Note that the rules for function coercion mean that the function actually supplied for <var>F</var> may be an arity-1 function: the second argument does not need to be declared if it is not used.</p></li><li><p>If <code>$replacement</code> is a string and the <code>q</code> flag is present, <var>R</var> is the value of <code>$replacement</code>.</p></li><li><p>Otherwise, the value of <code>$replacement</code> is processed as follows.</p><p>Within the supplied <code>$replacement</code> string, a variable marker <code>$<var>N</var></code> (where <var>N</var> is an unsigned integer) may be used to refer to the <var>N</var>th captured group associated with <var>M</var>. The replacement string <var>R</var> is obtained by replacing each of these variable markers with the string value of the relevant captured group. The variable marker <code>$0</code> refers to the substring captured by the regular expression as a whole.</p><p>A literal <code>$</code> character within the replacement string must be written as <code>\$</code>, and a literal <code>\</code> character must be written as <code>\\</code>.</p><p>More specifically, the rules are as follows, where <var>S</var> is the number of capturing subexpressions in the regular expression, and <var>N</var> is the decimal number formed by taking all the digits that consecutively follow the <code>$</code> character in <code>$replacement</code>:</p><ol class="enumar"><li><p>If <var>N</var>=<code>0</code>, then the variable is replaced by the string value of <var>M</var>.</p></li><li><p>If <code>1</code>&lt;=<var>N</var>&lt;=<var>S</var>, then the variable marker is replaced by the string value of the <var>N</var>th captured group associated with <var>M</var>. If the <var>N</var>th parenthesized sub-expression was not matched, then the variable marker is replaced by the zero-length string.</p></li><li><p>If <var>S</var>&lt;<var>N</var>&lt;=<code>9</code>, then the variable marker is replaced by the zero-length string.</p></li><li><p>Otherwise (if <var>N</var>&gt;<var>S</var> and <var>N</var>&gt;<code>9</code>), the last digit of <var>N</var> is taken to be a literal character to be included “as is” in the replacement string, and the rules are reapplied using the number <var>N</var> formed by stripping off this last digit.</p><p>For example, if the replacement string is <code>"$23"</code> and there are 5 substrings, the result contains the value of the substring that matches the second capturing subexpression, followed by the digit <code>3</code>.</p></li></ol></li></ul><p>The function returns the <code>xs:string</code> that is obtained by replacing each of the <a title="disjoint matching segments" class="termref" href="#dt-disjoint-matching-segments">disjoint matching segments</a> of <code>$value</code> with the corresponding value of <var>R</var>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORX0002" title="err:FORX0002">err:FORX0002</a>] if the value of <code>$pattern</code> is invalid according to the rules described in section <a href="#regex-syntax"><b>6.1 Regular expression syntax</b></a>. </p><p>A dynamic error is raised [<a href="#ERRFORX0001" title="err:FORX0001">err:FORX0001</a>] if the value of <code>$flags</code> is invalid according to the rules described in section <a href="#flags"><b>6.2 Flags</b></a>. </p><p>In the absence of the <code>q</code> flag, a dynamic error is raised [<a href="#ERRFORX0004" title="err:FORX0004">err:FORX0004</a>] if the value of <code>$replacement</code> contains a dollar sign (<code>$</code>) character that is not immediately followed by a digit <code>0-9</code> and not immediately preceded by a backslash (<code>\</code>).</p><p>In the absence of the <code>q</code> flag, a dynamic error is raised [<a href="#ERRFORX0004" title="err:FORX0004">err:FORX0004</a>] if the value of <code>$replacement</code> contains a backslash (<code>\</code>) character that is not part of a <code>\\</code> pair, unless it is immediately followed by a dollar sign (<code>$</code>) character.</p><p>A dynamic error is raised [<a href="#ERRFORX0005" title="err:FORX0005">err:FORX0005</a>] if both the <code>$replacement</code> and <code>$action</code> arguments are supplied, and neither is the empty sequence.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the input string contains no substring that matches the regular expression, the result of the function is a single string identical to the input string.</p><p>If two overlapping substrings of <code>$value</code> both match the <code>$pattern</code>, then only the first one (that is, the one whose first <a title="character" class="termref" href="#character">character</a> comes first in the <code>$value</code> string) is replaced.</p><p> If two alternatives within the pattern both match at the same position in the <code>$input</code>, then the match that is chosen is the one matched by the first alternative. For example:</p><div class="exampleInner"><pre xml:space="preserve"> replace("abcd", "(ab)|(a)", "[1=$1][2=$2]") returns "[1=ab][2=]cd"</pre></div><p>The rules for <a title="disjoint matching segments" class="termref" href="#dt-disjoint-matching-segments">disjoint matching segments</a> allow a zero-length matching segment to immediately follow a non-zero-length matching segment (they are not considered to overlap). This means, for example, that the regular expression <code>.*</code> will typically produce two matches: one matching segment containing all the characters in the input string, and a second zero-length matching seqment at the end position of the string.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("abracadabra", "bra", "*")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"a*cada*"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("abracadabra", "a.*a", "*")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"*"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("abracadabra", "a.*?a", "*")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"*c*bra"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("abracadabra", "a", "")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"brcdbr"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("abracadabra", "a(.)", "a$1$1")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"abbraccaddabbra"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("AAAA", "A+", "b")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"b"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("AAAA", "A+?", "b")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"bbbb"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("In the beginning was the Word", "\b", "|")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"|In| |the| |beginning| |was| |the| |Word|"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("abcd!", "[a-z](?=.*(.)$)", "$0$1")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"a!b!c!d!!"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>replace("darted", "^(.*?)d(.*)$", "$1c$2")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"carted"</code></p><p><em>(Only the first <code>d</code> is replaced.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">replace("abracadabra", "bra", upper-case#1)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"aBRAcadaBRA"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">replace("Chapter 9", "[0-9]+", fn { . + 1 })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Chapter 10"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">replace(
  "LHR to LAX",
  "\b[A-Z]{3}\b",
  { 'LAX': 'Los Angeles', 'LHR': 'London' }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"London to Los Angeles"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">replace(
  "57°43′30″",
  "([0-9]+)°([0-9]+)′([0-9]+)″",
  fn($s, $groups) {
    string($groups[1] + $groups[2] ÷ 60 + $groups[3] ÷ 3600) || '°'
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"57.725°"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-tokenize"></a>6.3.3 <a href="#func-tokenize" style="text-decoration: none">fn:tokenize</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-analyze-string">next</a> | <a href="#func-replace">previous</a>)</p><ol><li><p>The second argument can now be the empty sequence.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/895">895</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901</a>&nbsp;16 December 2023]</i></p></li><li><p>It is now permitted for the regular expression to match a zero-length string.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1911">1911</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1913">1913</a>&nbsp;8 April 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a sequence of strings constructed by splitting the input wherever a separator is found; the separator is any substring that matches a given regular expression.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:tokenize</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$pattern</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$flags</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>""</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The following rules apply when the <code>$pattern</code> argument is omitted, or is set to the empty sequence:</p><ul><li><p>The function splits the supplied string at whitespace boundaries.</p></li><li><p>More specifically, calling <code>fn:tokenize($value)</code><span>or <code>fn:tokenize($value, ())</code></span> is equivalent to calling <code>fn:tokenize(fn:normalize-space($value), ' '))</code> where the second argument is a single space character (x20).</p></li><li><p>The <code>$flags</code> argument is ignored.</p></li></ul><p>The following rules apply when the <code>$pattern</code> argument is supplied as a single string:</p><ul><li><p>If the <code>$flags</code> argument is omitted or if it is the empty sequence, the effect is the same as setting <code>$flags</code> to a zero-length string. Flags are defined in <a href="#flags"><b>6.2 Flags</b></a>.</p></li><li><p>If <code>$value</code> is the empty sequence, or if <code>$value</code> is the zero-length string, the function returns the empty sequence.</p></li><li><p>The function returns a sequence of strings formed by breaking the <code>$value</code> string into a sequence of strings, treating any substring that matches <code>$pattern</code> as a separator. The separators themselves are not returned.</p></li><li><p>More specifically:</p><ul><li><p>Let <var>M<sub>0</sub></var> be the sequence of <a title="disjoint matching segments" class="termref" href="#dt-disjoint-matching-segments">disjoint matching segments</a> that results from matching <code>$value</code> against <code>$pattern</code> in the presence of <code>$flags</code>.</p></li><li><p>Unless the first segment in <var>M<sub>0</sub></var> is zero-length and starts at the first <a title="character position" class="termref" href="#dt-character-position">character position</a> of <code>$value</code>, prepend a zero-length segment that starts at the start of <code>$value</code>: call the result <var>M<sub>1</sub></var>.</p></li><li><p>Unless the last segment in <var>M<sub>1</sub></var> is zero-length and starts at the last <a title="character position" class="termref" href="#dt-character-position">character position</a> of <code>$value</code> (that is, the character position after the last character), append a zero-length segment that starts at the last character position of <code>$value</code>. Call the result <var>M<sub>2</sub></var>.</p></li><li><p>For each pair of adjacent segments in <var>M<sub>2</sub></var> (say, <var>S<sub>n</sub></var> and <var>S<sub>n+1</sub></var>), construct a string (possibly zero-length) that is the substring of <code>$value</code> containing all characters that follow <var>S<sub>n</sub></var> and that precede <var>S<sub>n+1</sub></var>. Return this sequence of strings, in order.</p></li></ul></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORX0002" title="err:FORX0002">err:FORX0002</a>] if the value of <code>$pattern</code> is invalid according to the rules described in section <a href="#regex-syntax"><b>6.1 Regular expression syntax</b></a>.</p><p>A dynamic error is raised [<a href="#ERRFORX0001" title="err:FORX0001">err:FORX0001</a>] if the value of <code>$flags</code> is invalid according to the rules described in section <a href="#flags"><b>6.2 Flags</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the input string is not zero length, and no separators are found in the input string, the result of the function is a single string identical to the input string.</p><p>For the one-argument form of the function:</p><ul><li><p>The function has a similar effect to the two-argument form with <code>\s+</code> as the separator pattern, except that the one-argument form strips leading and trailing whitespace, whereas the two-argument form delivers an extra zero-length token if leading or trailing whitespace is present.</p></li><li><p>The separator used is any sequence of tab (<span class="unicode-codepoint">U+0009</span> (<span class="unicode-name">TAB</span>) ), newline (<span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ), carriage return (<span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) ) or space (<span class="unicode-codepoint">U+0020</span> (<span class="unicode-name">SPACE</span>) ) characters. This is the same as the separator recognized by list-valued attributes as defined in XSD. It is not the same as the separator recognized by list-valued attributes in HTML5, which also treats form-feed (<span class="unicode-codepoint">U+000C</span> (<span class="unicode-name">FORM FEED</span>) ) as whitespace. If it is necessary to treat form-feed as a separator, an explicit separator pattern should be used.</p></li></ul><p>For the two-argument form of the function:</p><ul><li><p>The function returns no information about the separators that were found in the string. If this information is required, the <a href="#func-analyze-string"><code>fn:analyze-string</code></a> function can be used instead. Alternatively, zero-width assertions can be used to identify separators. For example, using the regular expression <code>(?&lt;=,)</code> will start a new token after every comma, including the comma as part of the previous token.</p></li><li><p>If a separator occurs at the start of <code>$value</code>, and is not zero-length, the result sequence will start with a zero-length string. Similarly, zero-length strings will also occur in the result sequence if a non-zero-length separator occurs at the end of <code>$value</code>, or if two adjacent substrings match the supplied <code>$pattern</code>.</p></li><li><p>If two alternatives within the supplied <code>$pattern</code> both match at the same position in the <code>$value</code> string, then the match that is chosen is the first. For example:</p><div class="exampleInner"><pre xml:space="preserve"> tokenize("abracadabra", "(ab)|(a)") returns ("", "r", "c", "d", "r", "")</pre></div></li><li><p>The pattern may match zero-length segments of the input string. For example, the expression <code>tokenize("Do not eat", "\b")</code> returns the sequence <code>"Do", " ", "not", " ", "eat"</code>.</p></li><li><p>A string may be split into individual characters (producing the same effect as the <a href="#func-characters"><code>fn:characters</code></a> function) by using the empty regular expression (for example, <code>tokenize("xyz", "")</code>, or any other regular expression such as <code>.??</code> that matches every zero-length string, regardless of position.</p><p>Unlike the <code>split</code> method in some other popular languages, however, not every regular expression that matches a zero-length string produces this behavior: for example the regular expression <code>\b</code> splits the string before and after every word.</p></li></ul></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>tokenize(" red green blue ")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"red", "green", "blue"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>tokenize("The cat sat on the mat", "\s+")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"The", "cat", "sat", "on", "the", "mat"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>tokenize(" red green blue ", "\s+")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"", "red", "green", "blue", ""</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>tokenize("1, 15, 24, 50", ",\s*")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"1", "15", "24", "50"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>tokenize("1,15,,24,50,", ",")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"1", "15", "", "24", "50", ""</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>fn:tokenize("the end", "\b")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"the", " ", "end"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>fn:tokenize("California", "")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"C", "a", "l", "i", "f", "o", "r", "n", "i", "a"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">tokenize(
  "Some unparsed &lt;br&gt; HTML &lt;BR&gt; text",
  "\s*&lt;br&gt;\s*", "i"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Some unparsed", "HTML", "text"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-analyze-string"></a>6.3.4 <a href="#func-analyze-string" style="text-decoration: none">fn:analyze-string</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-decode-from-uri">next</a> | <a href="#func-tokenize">previous</a>)</p><ol><li><p>The output of the function is extended to allow the represention of captured groups found within lookahead assertions.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/998">998</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1856">1856</a>&nbsp;18 March 2025]</i></p></li><li><p>It is now permitted for the regular expression to match a zero-length string.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1911">1911</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1913">1913</a>&nbsp;8 April 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Analyzes a string using a regular expression, returning an XML structure that identifies which parts of the input string matched or failed to match the regular expression, and in the case of matched substrings, which substrings matched each capturing group in the regular expression.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:analyze-string</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$pattern</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$flags</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>""</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>element(fn:analyze-string-result)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the <code>$flags</code> argument is omitted or if it is the empty sequence, the effect is the same as setting <code>$flags</code> to a zero-length string. Flags are defined in <a href="#flags"><b>6.2 Flags</b></a>.</p><p>If <code>$value</code> is the empty sequence the function behaves as if <code>$value</code> were the zero-length string.</p><p>The function returns an element node whose local name is <code>analyze-string-result</code>. This element and all its descendant elements have the namespace URI <code>http://www.w3.org/2005/xpath-functions</code>. The namespace prefix is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>. The children of this element are a sequence of <code>fn:match</code> and <code>fn:non-match</code> elements. This sequence is formed by breaking the <code>$value</code> string into a sequence of strings, returning any substring that matches <code>$pattern</code> as the content of an <code>fn:match</code> element, and any intervening substring as the content of an <code>fn:non-match</code> element.</p><p>More specifically, the function starts by matching the regular expression against the string, using the supplied <code>$flags</code>, to obtain the <a title="disjoint matching segments" class="termref" href="#dt-disjoint-matching-segments">disjoint matching segments</a>. For each such segment it constructs an <code>fn:match</code> child, whose string value is the string value of the segment. Before, between, or after these <code>fn:match</code> elements, as required to ensure that the string value of the <code>fn:analyze-string-result</code> element is the same as <code>$value</code>, it inserts <code>fn:non-match</code> elements. The content of an <code>fn:non-match</code> element is always a single (non-empty) text node, and two <code>fn:non-match</code> elements never appear as adjacent siblings.</p><p>The captured groups for each <a title="disjoint matching segments" class="termref" href="#dt-disjoint-matching-segments">disjoint matching segment</a> are represented using <code>fn:group</code> or <code>fn:lookahead-group</code> children of the corresponding <code>fn:match</code> element. Groups captured by a subexpression within a lookahead assertion are referred to as lookahead groups; those not within a lookahead assertion are called ordinary groups.</p><p>The content of an <code>fn:match</code> element is in general:</p><ul><li><p>A sequence of text nodes and <code>fn:group</code> element children, whose string-values when concatenated comprise the string value of the matching segment, followed by</p></li><li><p>A sequence of zero or more <code>fn:lookahead-group</code> elements, representing the lookahead groups</p></li></ul><p>The string value of an <code>fn:match</code> element may be empty.</p><p>An <code>fn:group</code> element with a <code>nr</code> attribute having the integer value <var>N</var> identifies the substring captured by an ordinary group, specifically the string value of the <var>Nth</var> captured group. For each ordinary capturing subexpression there will be at most one corresponding <code>fn:group</code> element in each <code>fn:match</code> element in the result.</p><p>By contrast, lookahead groups are represented by <code>fn:lookahead-group</code> elements, which (if they appear at all) must follow all text node and <code>fn:group</code> element children of the <code>fn:match</code> element. These groups may overlap the matching and non-matching substrings, and indeed may overlap each other. They must appear in ascending numerical order of group number. The attributes of the <code>fn:lookahead-group</code> element are as follows:</p><ul><li><p><code>nr</code>: the group number, based on the position of the capturing subexpression that captured the group;</p></li><li><p><code>value</code>: the string value of the segment that was captured;</p></li><li><p><code>position</code>: the one-based start position of the segment within the input string.</p></li></ul><p>If the function is called twice with the same arguments, it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether the two calls return the same element node or distinct (but deep equal) element nodes. In this respect it is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic with respect to node identity</a>.</p><p>The base URI of the element nodes in the result is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p>A schema is defined for the structure of the returned element: see <a href="#schema-for-analyze-string"><b>D.1 Schema for the result of fn:analyze-string</b></a>.</p><p>The result of the function will always be such that validation against this schema would succeed. However, it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether the result is typed or untyped, that is, whether the elements and attributes in the returned tree have type annotations that reflect the result of validating against this schema.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORX0002" title="err:FORX0002">err:FORX0002</a>] if the value of <code>$pattern</code> is invalid according to the rules described in section <a href="#regex-syntax"><b>6.1 Regular expression syntax</b></a>.</p><p>A dynamic error is raised [<a href="#ERRFORX0001" title="err:FORX0001">err:FORX0001</a>] if the value of <code>$flags</code> is invalid according to the rules described in section <a href="#flags"><b>6.2 Flags</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>It is <span class="verb">recommended</span> that a processor that implements schema awareness should return typed nodes. The concept of “schema awareness”, however, is a matter for host languages to define and is outside the scope of the function library specification.</p><p>The declarations and definitions in the schema are not automatically available in the static context of the <a href="#func-analyze-string"><code>fn:analyze-string</code></a> call (or of any other expression). The contents of the static context are host-language defined, and in some host languages are implementation-defined.</p><p>The schema defines the outermost element, <code>analyze-string-result</code>, in such a way that mixed content is permitted. In fact the element will only have element nodes (<code>match</code> and <code>non-match</code>) as its children, never text nodes. Although this might have originally been an oversight, defining the <code>analyze-string-result</code> element with <code>mixed="true"</code> allows it to be atomized, which is potentially useful (the atomized value will be the original input string), and the capability has therefore been retained for compatibility with the 3.0 version of this specification.</p><p>The rules for <a title="disjoint matching segments" class="termref" href="#dt-disjoint-matching-segments">disjoint matching segments</a> allow a zero-length matching segment to immediately follow a non-zero-length matching segment (they are not considered to overlap). This means, for example, that the regular expression <code>.*</code> will typically produce two matches: one matching segment containing all the characters in the input string, and a second zero-length matching seqment at the end position of the string.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>In the following examples, the result document is shown in serialized form, with whitespace between the element nodes. This whitespace is not actually present in the result.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>analyze-string("The cat sat on the mat.", "\w+")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;analyze-string-result xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;match&gt;The&lt;/match&gt;
  &lt;non-match&gt; &lt;/non-match&gt;
  &lt;match&gt;cat&lt;/match&gt;
  &lt;non-match&gt; &lt;/non-match&gt;
  &lt;match&gt;sat&lt;/match&gt;
  &lt;non-match&gt; &lt;/non-match&gt;
  &lt;match&gt;on&lt;/match&gt;
  &lt;non-match&gt; &lt;/non-match&gt;
  &lt;match&gt;the&lt;/match&gt;
  &lt;non-match&gt; &lt;/non-match&gt;
  &lt;match&gt;mat&lt;/match&gt;
  &lt;non-match&gt;.&lt;/non-match&gt;
&lt;/analyze-string-result&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">analyze-string("08-12-03", "^(\d+)\-(\d+)\-(\d+)$")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;analyze-string-result xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;match&gt;
    &lt;group nr="1"&gt;08&lt;/group&gt;-&lt;group nr="2"&gt;12&lt;/group&gt;-&lt;group nr="3"&gt;03&lt;/group&gt;
  &lt;/match&gt;
&lt;/analyze-string-result&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">analyze-string("A1,C15,,D24, X50,", "([A-Z])([0-9]+)")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;analyze-string-result xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;match&gt;
    &lt;group nr="1"&gt;A&lt;/group&gt;
    &lt;group nr="2"&gt;1&lt;/group&gt;
  &lt;/match&gt;
  &lt;non-match&gt;,&lt;/non-match&gt;
  &lt;match&gt;
    &lt;group nr="1"&gt;C&lt;/group&gt;
    &lt;group nr="2"&gt;15&lt;/group&gt;
  &lt;/match&gt;
  &lt;non-match&gt;,,&lt;/non-match&gt;
  &lt;match&gt;
    &lt;group nr="1"&gt;D&lt;/group&gt;
    &lt;group nr="2"&gt;24&lt;/group&gt;
  &lt;/match&gt;
  &lt;non-match&gt;, &lt;/non-match&gt;
  &lt;match&gt;
    &lt;group nr="1"&gt;X&lt;/group&gt;
    &lt;group nr="2"&gt;50&lt;/group&gt;
  &lt;/match&gt;
  &lt;non-match&gt;,&lt;/non-match&gt;
&lt;/analyze-string-result&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">analyze-string("Chapter 5", "(Chapter|Appendix)(?=\s+([0-9]+))")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;analyze-string-result xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;match&gt;
    &lt;group nr="1"&gt;Chapter&lt;/group&gt;
    &lt;lookahead-group nr="2" value="5" position="9"/&gt;
  &lt;/match&gt;
  &lt;non-match&gt; 5&lt;/non-match&gt;  
&lt;/analyze-string-result&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">analyze-string("There we go", "\b(?=(\w+))")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;analyze-string-result xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;match&gt;&lt;lookahead-group nr="1" value="There" position="1"/&gt;&lt;/match&gt;
  &lt;non-match&gt;There &lt;/non-match&gt;
  &lt;match&gt;&lt;lookahead-group nr="1" value="we" position="7"/&gt;&lt;/match&gt;
  &lt;non-match&gt;we &lt;/non-match&gt;
  &lt;match&gt;&lt;lookahead-group nr="1" value="go" position="10"/&gt;&lt;/match&gt;
  &lt;non-match&gt;go&lt;/non-match&gt;
&lt;/analyze-string-result&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="anyURI-functions"></a>7 <a href="#anyURI-functions" style="text-decoration: none">Processing URIs</a></h2><p>This section specifies functions that manipulate URI values, either as instances of <code>xs:anyURI</code> or as strings.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-decode-from-uri"><code>fn:decode-from-uri</code></a></td><td>Decodes URI-escaped characters in a string.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-encode-for-uri"><code>fn:encode-for-uri</code></a></td><td>Encodes reserved characters in a string that is intended to be used in the path segment of a URI.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-escape-html-uri"><code>fn:escape-html-uri</code></a></td><td>Escapes a URI in the same way that HTML user agents handle attribute values expected to contain URIs.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-iri-to-uri"><code>fn:iri-to-uri</code></a></td><td>Converts a string containing an IRI into a URI according to the rules of <a href="#rfc3987">[RFC 3987]</a>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-resolve-uri"><code>fn:resolve-uri</code></a></td><td>Resolves a relative IRI reference against an absolute IRI.</td></tr></tbody></table><div class="div2"><h3><a id="func-decode-from-uri"></a>7.1 <a href="#func-decode-from-uri" style="text-decoration: none">fn:decode-from-uri</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-resolve-uri">next</a> | <a href="#func-analyze-string">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/600">600</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/631">631</a>&nbsp;12 September 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Decodes URI-escaped characters in a string.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:decode-from-uri</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>This function returns the original representation of a URI-escaped string.</p><p>If <code>$value</code> is the empty sequence, the function returns the zero-length string.</p><p>Otherwise, the value is first converted to a sequence of octets. Each plus sign (<code>+</code>) is replaced with the octet representing a space character (<code>x20</code>), and any substring that matches the regular expression <code>%[a-fA-F0-9][a-fA-F0-9]</code> is replaced with an octet for the two-digit hexadecimal number that follows the percent sign. Characters that are not part of such a substring are replaced with the octets of their UTF-8 encoding. For example, <code>"A%42+C"</code> results in the octets <code>x41</code>, <code>x42</code>, <code>x20</code>, <code>x43</code>, and <code>"💡"</code> yields <code>xF0</code>, <code>x9F</code>, <code>x92</code>, and <code>xA1</code>.</p><p>If <code>%</code> is followed by up to two characters that are not hexadecimal digits, these characters are replaced by octets <code>xEF</code>, <code>xBF</code>, and <code>xBD</code>, that is, the UTF-8 encoding of the Unicode replacement character (<span class="unicode-codepoint">U+FFFD</span> (<span class="unicode-name">REPLACEMENT CHARACTER</span>, <code>�</code>) ). For example, the incomplete or invalid percent-encoded strings <code>"%"</code>, <code>"%X"</code>, <code>"%AX"</code>, and <code>"%XA"</code> are all replaced with these octets. For the string <code>"%1X!"</code>, the octets <code>xEF</code>, <code>xBF</code>, <code>xBD</code>, and <code>x21</code> are returned.</p><p>Next, the resulting octets are interpreted as UTF-8. For example, <code>x41</code>, <code>x42</code>, <code>x20</code>, and <code>x43</code> becomes <code>"AB C"</code>, and <code>xF0</code>, <code>x9F</code>, <code>x92</code>, and <code>xA1</code> becomes <code>"💡"</code>.</p><p>If an invalid UTF-8 octet sequence is encountered, the octets that have successfully been parsed are replaced with a Unicode replacement character. Examples:</p><ul><li><p>The single octet <code>xF0</code> is converted to <code>"�"</code>.</p></li><li><p>The octets <code>xF0</code>, <code>x9F</code>, <code>x92</code>, and <code>x41</code> are converted to <code>"�A"</code>: The bit pattern of the first octet indicates that the UTF-8 character comprises four octets. As the fourth octet is invalid, a Unicode replacement character is added for the first three octets, and the fourth (invalid) octet is parsed as a new character.</p></li><li><p>Similarly, the octets <code>xF0</code>, <code>xF0</code>, <code>x9F</code>, <code>x92</code>, and <code>xA1</code> are converted to <code>"�💡"</code>: The second octet is invalid, but it becomes valid when being parsed as the first octet of the remaining UTF-8 sequence.</p></li></ul><p>Similarly, a UTF-8 octet sequence that represents a codepoint that is not a valid XML character is replaced with a Unicode replacement character. For example, <code>x00</code> becomes <code>"�"</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>decode-from-uri("http://example.com/")</code></pre></div></td><td style="vertical-align:top"><p><code>"http://example.com/"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>decode-from-uri("~b%C3%A9b%C3%A9?a=b+c")</code></pre></div></td><td style="vertical-align:top"><p><code>"~bébé?a=b c"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>decode-from-uri("%00-%XX-%F0%9F%92%41-%F0%F0%9F%92%A1")</code></pre></div></td><td style="vertical-align:top"><p><code>"�-�-�A-�💡"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-encode-for-uri"></a>7.2 <a href="#func-encode-for-uri" style="text-decoration: none">fn:encode-for-uri</a></h3><dl><dt class="label">Summary</dt><dd><p>Encodes reserved characters in a string that is intended to be used in the path segment of a URI.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:encode-for-uri</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the zero-length string.</p><p>This function applies the URI escaping rules defined in section 2 of <a href="#rfc3986">[RFC 3986]</a> to the <code>xs:string</code> supplied as <code>$value</code>. The effect of the function is to escape reserved characters. Each such character in the string is replaced with its percent-encoded form as described in <a href="#rfc3986">[RFC 3986]</a>.</p><p>Since <a href="#rfc3986">[RFC 3986]</a> recommends that, for consistency, URI producers and normalizers should use uppercase hexadecimal digits for all percent-encodings, this function must always generate hexadecimal values using the upper-case letters A-F.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>All characters are escaped except those identified as “unreserved” by <a href="#rfc3986">[RFC 3986]</a>, that is the upper- and lower-case letters <code>A</code> to <code>Z</code>, the digits <code>0</code> to <code>9</code>, HYPHEN-MINUS (<code>-</code>), LOW LINE (<code>_</code>), FULL STOP (<code>.</code>), and TILDE (<code>~</code>).</p><p>This function escapes URI delimiters and therefore cannot be used indiscriminately to encode “invalid” characters in a path segment.</p><p>This function is invertible but not idempotent. This is because a string containing a percent character will be modified by applying the function: for example <code>100%</code> becomes <code>100%25</code>, while <code>100%25</code> becomes <code>100%2525</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">encode-for-uri(
  "http://example.com/00/Weather/CA/Los%20Angeles#ocean"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"http%3A%2F%2Fexample.com%2F00%2FWeather%2FCA%2FLos%2520Angeles%23ocean"</pre></div><p><em>(This is probably not what the user intended because all of the delimiters have been encoded.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">concat(
  "http://example.com/",
  encode-for-uri("~bébé")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"http://example.com/~b%C3%A9b%C3%A9"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">concat(
  "http://example.com/",
  encode-for-uri("100% organic")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"http://example.com/100%25%20organic"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-escape-html-uri"></a>7.3 <a href="#func-escape-html-uri" style="text-decoration: none">fn:escape-html-uri</a></h3><dl><dt class="label">Summary</dt><dd><p>Escapes a URI in the same way that HTML user agents handle attribute values expected to contain URIs.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:escape-html-uri</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the zero-length string.</p><p>Otherwise, the function escapes all <a title="character" class="termref" href="#character">characters</a> except printable characters of the US-ASCII coded character set, specifically the <a title="codepoint" class="termref" href="#codepoint">codepoints</a> between 32 and 126 (decimal) inclusive. Each character in <code>$value</code> to be escaped is replaced by an escape sequence, which is formed by encoding the character as a sequence of octets in UTF-8, and then representing each of these octets in the form %HH, where HH is the hexadecimal representation of the octet. This function must always generate hexadecimal values using the upper-case letters A-F.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The behavior of this function corresponds to the recommended handling of non-ASCII characters in URI attribute values as described in <a href="#HTML40">[HTML 4.0]</a> Appendix B.2.1.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">escape-html-uri(
  "http://www.example.com/00/Weather/CA/Los Angeles#ocean"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"http://www.example.com/00/Weather/CA/Los Angeles#ocean"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">escape-html-uri(
  "javascript:if (navigator.browserLanguage == 'fr') window.open('http://www.example.com/~bébé');"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">"javascript:if (navigator.browserLanguage == 'fr') window.open('http://www.example.com/~b%C3%A9b%C3%A9');"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-iri-to-uri"></a>7.4 <a href="#func-iri-to-uri" style="text-decoration: none">fn:iri-to-uri</a></h3><dl><dt class="label">Summary</dt><dd><p>Converts a string containing an IRI into a URI according to the rules of <a href="#rfc3987">[RFC 3987]</a>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:iri-to-uri</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the zero-length string.</p><p>Otherwise, the function converts <code>$value</code> into a URI according to the rules given in Section 3.1 of <a href="#rfc3987">[RFC 3987]</a> by percent-encoding characters that are allowed in an IRI but not in a URI. If <code>$value</code> contains a character that is invalid in an IRI, such as the space character (see note below), the invalid character is replaced by its percent-encoded form as described in <a href="#rfc3986">[RFC 3986]</a> before the conversion is performed.</p><p>Since <a href="#rfc3986">[RFC 3986]</a> recommends that, for consistency, URI producers and normalizers should use uppercase hexadecimal digits for all percent-encodings, this function must always generate hexadecimal values using the upper-case letters A-F.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function is idempotent but not invertible. Both the inputs <code>My Documents</code> and <code>My%20Documents</code> will be converted to the output <code>My%20Documents</code>.</p><p>This function does not check whether <code>$iri</code> is a valid IRI. It treats it as an <a title="string" class="termref" href="#string">string</a> and operates on the <a title="character" class="termref" href="#character">characters</a> in the string.</p><p> The following printable ASCII characters are invalid in an IRI: <code>&lt;</code>, <code>&gt;</code>, <code>"</code>, <code></code>, <code>{</code>, <code>}</code>, <code>|</code>, <code>\</code>, <code>^</code>, and <code>`</code>. Since these characters should not appear in an IRI, if they do appear in <code>$iri</code> they will be percent-encoded. In addition, characters outside the range <span class="unicode-codepoint">U+0020</span> (<span class="unicode-name">SPACE</span>) to <span class="unicode-codepoint">U+007E</span> (<span class="unicode-name">TILDE</span>, <code>~</code>) will be percent-encoded because they are invalid in a URI. </p><p> Since this function does not escape the character <span class="unicode-codepoint">U+0025</span> (<span class="unicode-name">PERCENT SIGN</span>, <code>%</code>) and this character is not allowed in data within a URI, users wishing to convert character strings (such as file names) that include <code>%</code> to a URI should manually escape <code>%</code> by replacing it with <code>%25</code>. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">iri-to-uri(
  "http://www.example.com/00/Weather/CA/Los%20Angeles#ocean"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"http://www.example.com/00/Weather/CA/Los%20Angeles#ocean"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>iri-to-uri("http://www.example.com/~bébé")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"http://www.example.com/~b%C3%A9b%C3%A9"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-resolve-uri"></a>7.5 <a href="#func-resolve-uri" style="text-decoration: none">fn:resolve-uri</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-parse-uri">next</a> | <a href="#func-decode-from-uri">previous</a>)</p><ol><li><p>The optional second argument can now be supplied as the empty sequence.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/895">895</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901</a>&nbsp;16 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Resolves a relative IRI reference against an absolute IRI.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:resolve-uri</code>(</td></tr><tr class="arg"><td><code>$href</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$base</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyURI?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>The function is defined to operate on IRI references as defined in <a href="#rfc3987">[RFC 3987]</a>, and the implementation <span class="verb">must</span> permit all arguments that are valid according to that specification. In addition, the implementation <span class="verb">may</span> accept some or all strings that conform to the rules for (absolute or relative) Legacy Extended IRI references as defined in <a href="#LEIRI">[Legacy extended IRIs for XML resource identification]</a>. For the purposes of this section, the terms IRI and IRI reference include these extensions, insofar as the implementation chooses to support them.</p><p>The following rules apply in order:</p><ol class="enumar"><li><p>If <code>$href</code> is the empty sequence, the function returns the empty sequence.</p></li><li><p>If <code>$href</code> is an absolute IRI (as defined above), then it is returned unchanged.</p></li><li><p>If the <code>$base</code> argument is not supplied, <span>or is supplied as the empty sequence</span> then:</p><ol class="enumla"><li><p>If the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> in the dynamic context is not absent, it is used as the effective value of <code>$base</code>.</p></li><li><p>Otherwise, a dynamic error is raised: <span>[<a href="#ERRFONS0005" title="err:FONS0005">err:FONS0005</a>]</span>.</p></li></ol></li><li><p>The function resolves the relative IRI reference <code>$href</code> against the base IRI <code>$base</code> using the algorithm defined in <a href="#rfc3986">[RFC 3986]</a>, adapted by treating any <a title="character" class="termref" href="#character">character</a> that would not be valid in an RFC3986 URI or relative reference in the same way that RFC3986 treats unreserved characters. No percent-encoding takes place.</p></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>The first form of this function resolves <code>$href</code> against the value of the base-uri property from the static context. A dynamic error is raised [<a href="#ERRFONS0005" title="err:FONS0005">err:FONS0005</a>] if the base-uri property is not initialized in the static context. </p><p>A dynamic error is raised [<a href="#ERRFORG0002" title="err:FORG0002">err:FORG0002</a>] if <code>$href</code> is not a valid IRI according to the rules of RFC3987, extended with an implementation-defined subset of the extensions permitted in LEIRI, or if it is not a suitable relative reference to use as input to the RFC3986 resolution algorithm extended to handle additional unreserved characters. </p><p>A dynamic error is raised [<a href="#ERRFORG0002" title="err:FORG0002">err:FORG0002</a>] if <code>$base</code> is not a valid IRI according to the rules of RFC3987, extended with an implementation-defined subset of the extensions permitted in LEIRI, or if it is not a suitable IRI to use as input to the chosen resolution algorithm (for example, if it is a relative IRI reference<span> or</span> if it is a non-hierarchic URI).<span> In XPath 4.0, attempting to resolve against an absolute URI that includes a fragment identifier is no longer an error, the fragment identifier is simply ignored. A narrow reading of RFC 3986 might seem to forbid this, but in practice the interpretation is non-controversial and the practice is widely supported.</span></p><p>A dynamic error is raised [<a href="#ERRFORG0009" title="err:FORG0009">err:FORG0009</a>] if the chosen resolution algorithm fails for any other reason. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Resolving a URI does not dereference it. This is merely a syntactic operation on two <a title="string" class="termref" href="#string">strings</a>.</p><p>The algorithms in the cited RFCs include some variations that are optional or recommended rather than mandatory; they also describe some common practices that are not recommended, but which are permitted for backwards compatibility. Where the cited RFCs permit variations in behavior, so does this specification. </p><p>Throughout this family of specifications, the phrase "resolving a relative URI (or IRI) reference" should be understood as using the rules of this function, unless otherwise stated.</p><p>RFC3986 defines an algorithm for resolving relative references in the context of the URI syntax defined in that RFC. RFC3987 describes a modification to that algorithm to make it applicable to IRIs (specifically: additional characters permitted in an IRI are handled the same way that RFC3986 handles unreserved characters). The LEIRI specification does not explicitly define a resolution algorithm, but suggests that it <em>should not</em> be done by converting the LEIRI to a URI, and <em>should not</em> involve percent-encoding. This specification fills this gap by defining resolution for LEIRIs in the same way that RFC3987 defines resolution for IRIs, that is by specifying that additional characters are handled as unreserved characters.</p></div></dd></dl></div><div class="div2"><h3><a id="parse-build"></a>7.6 <a href="#parse-build" style="text-decoration: none">Parsing and building URIs</a></h3><p>This section specifies functions that parse strings as URIs, to identify their structure, and construct URI strings from their structured representation.</p><p>Some URI schemes are hierarchical and some are non-hierarchical. Implementations must treat the following schemes as non-hierarchical: <code>jar</code>, <code>mailto</code>, <code>news</code>, <code>tag</code>, <code>tel</code>, and <code>urn</code>. Whether additional schemes are known to be non-hierarchical <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If a scheme is not known to be non-hierarchical, it must be treated as hierarchical.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parse-uri"><code>fn:parse-uri</code></a></td><td>Parses the URI provided and returns a map of its parts.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-build-uri"><code>fn:build-uri</code></a></td><td>Constructs a URI from the parts provided.</td></tr></tbody></table><p>Both functions use a structured representation of a URI as defined in the next section.</p><div class="div3"><h4><a id="uri-structure-record"></a>7.6.1 <a href="#uri-structure-record" style="text-decoration: none">Record fn:uri-structure-record</a></h4><p>This record type represents the components of a URI.</p><table class="fos-options"><thead><tr><th>Name</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>uri?</code></p></td><td class="fos-thin"><p>The original URI. This element is returned by <a href="#func-parse-uri"><code>fn:parse-uri</code></a>, but ignored by <a href="#func-build-uri"><code>fn:build-uri</code></a>.</p><ul><li><p><b>Type: </b><code>xs:string?</code></p></li></ul></td></tr><tr><td><p><code>scheme?</code></p></td><td class="fos-thin"><p>The URI scheme (e.g., “https” or “file”).</p><ul><li><p><b>Type: </b><code>xs:string?</code></p></li></ul></td></tr><tr><td><p><code>absolute?</code></p></td><td class="fos-thin"><p>The URI is an absolute URI.</p><ul><li><p><b>Type: </b><code>xs:boolean?</code></p></li></ul></td></tr><tr><td><p><code>hierarchical?</code></p></td><td class="fos-thin"><p>Whether the URI is hierarchical or not.</p><ul><li><p><b>Type: </b><code>xs:boolean?</code></p></li></ul></td></tr><tr><td><p><code>authority?</code></p></td><td class="fos-thin"><p>The authority portion of the URI (e.g., “example.com:8080”).</p><ul><li><p><b>Type: </b><code>xs:string?</code></p></li></ul></td></tr><tr><td><p><code>userinfo?</code></p></td><td class="fos-thin"><p>Any userinfo that was passed as part of the authority.</p><ul><li><p><b>Type: </b><code>xs:string?</code></p></li></ul></td></tr><tr><td><p><code>host?</code></p></td><td class="fos-thin"><p>The host passed as part of the authority (e.g., “example.com”). </p><ul><li><p><b>Type: </b><code>xs:string?</code></p></li></ul></td></tr><tr><td><p><code>port?</code></p></td><td class="fos-thin"><p>The port passed as part of the authority (e.g., “8080”).</p><ul><li><p><b>Type: </b><code>xs:integer?</code></p></li></ul></td></tr><tr><td><p><code>path?</code></p></td><td class="fos-thin"><p>The path portion of the URI.</p><ul><li><p><b>Type: </b><code>xs:string?</code></p></li></ul></td></tr><tr><td><p><code>query?</code></p></td><td class="fos-thin"><p>Any query string.</p><ul><li><p><b>Type: </b><code>xs:string?</code></p></li></ul></td></tr><tr><td><p><code>fragment?</code></p></td><td class="fos-thin"><p>Any fragment identifier.</p><ul><li><p><b>Type: </b><code>xs:string?</code></p></li></ul></td></tr><tr><td><p><code>path-segments?</code></p></td><td class="fos-thin"><p>Parsed and unescaped path segments.</p><ul><li><p><b>Type: </b><code>xs:string*</code></p></li></ul></td></tr><tr><td><p><code>query-parameters?</code></p></td><td class="fos-thin"><p>Parsed and unescaped query key-value pairs.</p><ul><li><p><b>Type: </b><code>map(xs:string, xs:string*)?</code></p></li></ul></td></tr><tr><td><p><code>filepath?</code></p></td><td class="fos-thin"><p>The path of the URI, treated as a filepath.</p><ul><li><p><b>Type: </b><code>xs:string?</code></p></li></ul></td></tr></tbody></table><p>The segmented forms of the path and query parameters provide convenient access to commonly used information.</p><p>The path, if there is one, is tokenized on “/” characters and each segment is unescaped (as per the <a href="#func-decode-from-uri"><code>fn:decode-from-uri</code></a> function). Consider the URI <code>http://example.com/path/to/a%2fb</code>. The path portion has to be returned as <code>/path/to/a%2fb</code> because decoding the <code>%2f</code> would change the nature of the path. The unescaped form is easily accessible from <code>path-segments</code>:</p><div class="exampleInner"><pre xml:space="preserve">("", "path", "to", "a/b")</pre></div><p>Note that the presence or absence of a leading slash on the path will affect whether or not the sequence begins with a zero-length string.</p><p>The query parameters are decoded into a map. Consider the URI: <code>http://example.com/path?a=1&amp;b=2%264&amp;a=3</code>. The decoded form in the query-parameters is the following map:</p><div class="exampleInner"><pre xml:space="preserve">{ "a": ("1", "3"), "b": "2&amp;4" }</pre></div><p>Note that both keys and values are unescaped. If a key is repeated in the query string, the map will contain a sequence of values for that key, as seen for <code>a</code> in this example.</p></div><div class="div3"><h4><a id="func-parse-uri"></a>7.6.2 <a href="#func-parse-uri" style="text-decoration: none">fn:parse-uri</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-build-uri">next</a> | <a href="#func-resolve-uri">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/72">72</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/389">389</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/390">390</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/215">215</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/415">415</a>&nbsp;17 October 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Parses the URI provided and returns a map of its parts.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parse-uri</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code class="return-type-ref"><a href="#uri-structure-record">uri-structure-record</a>?</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the result is the empty sequence.</p><p>The function parses the <code>$value</code> provided, returning a map containing its constituent parts: scheme, authority components, path, etc. In addition to parsing URIs as defined by <a href="#rfc3986">[RFC 3986]</a> (and <a href="#rfc3987">[RFC 3987]</a>), this function also attempts to account for strings that are not valid URIs but that often appear in URI-adjacent spaces, such as file names. Not all such strings can be successfully parsed as URIs.</p><p>The following options are available:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">allow-deprecated-features?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">omit-default-ports?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">unc-path?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>allow-deprecated-features?</code></p></td><td class="fos-thin">Indicates that deprecated URI features should be returned <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>omit-default-ports?</code></p></td><td class="fos-thin">Indicates that a port number that is the same as the default port for a given scheme should be omitted. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>unc-path?</code></p></td><td class="fos-thin">Indicates that an input URI that begins with two or more leading slashes should be interprted as a Windows Universal Naming Convention Path. (Specifically: that it has the <code>file:</code> scheme.) <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr></tbody></table><p>This function is described as a series of transformations over the input string to identify the parts of a URI that are present. Some portions of the URI are identified by matching with a regular expression. This approach is designed to make the description clear and unambiguous; it is not implementation advice. Comparison of <em>scheme</em> and <em>authority</em> components is case insensitive.</p><p>Processing begins with a <em>string</em> that is equal to the <code>$value</code>. If the <em>string</em> contains any backslashes (<code>\</code>), replace them with forward slashes (<code>/</code>).</p><p>Strip off the fragment identifier and any query:</p><ul><li><p>If the <em>string</em> matches <code>^(.*?)#(.*)$</code>, the <em>string</em> is the first match group and the <em>fragment</em> is the second match group. Otherwise, the string is unchanged and the <em>fragment</em> is the empty sequence. If a fragment is present, it is URI decoded. If the fragment is a zero-length string, it is discarded and the <em>fragment</em> is the empty sequence.</p></li><li><p>If the <em>string</em> matches <code>^(.*?)\?(.*)$</code>, the <em>string</em> is the first match group and the <em>query</em> is the second match group. Otherwise, the string is unchanged and the <em>query</em> is the empty sequence. If the query is a zero-length string, it is discarded and the <em>query</em> is the empty sequence.</p></li></ul><p>Attempt to identify the scheme:</p><ul><li><p>If the <em>string</em> matches <code>^([a-zA-Z][A-Za-z0-9\+\-\.]+):(.*)$</code>:</p><ul><li><p>the <em>scheme</em> is the first match group and</p></li><li><p>the <em>string</em> is the second match group.</p></li></ul></li><li><p>Otherwise, the <em>scheme</em> is the empty sequence and the <em>string</em> is unchanged.</p></li></ul><p>If the <em>scheme</em> is not empty and the <em>fragment</em> is empty, <em>absolute</em> is true. Otherwise, <em>absolute</em> is the empty sequence. (But see the discussion of hierarchical URIs, below.)</p><p>If <em>scheme</em> is the empty sequence or <code>file</code>:</p><ul><li><p>If the <em>string</em> matches <code>^/*([a-zA-Z][:|].*)$</code>:</p><ul><li><p>the <em>scheme</em> is <code>file</code> and</p></li><li><p>the <em>string</em> is a single slash <code>/</code> followed by the first match group with the second character changed to <code>:</code>, if necessary.</p></li></ul></li><li><p>Otherwise, if <em>unc-path</em> is <code>true</code>:</p><ul><li><p>the <em>scheme</em> is <code>file</code> and</p></li><li><p>the <em>string</em> is unchanged.</p></li></ul></li><li><p>Finally, if neither of the preceding cases apply:</p><ul><li><p>the <em>scheme</em> remains the empty sequence and</p></li><li><p>the <em>string</em> is unchanged.</p></li></ul></li></ul><p>Now that the scheme, if there is one, has been identified, determine if the URI is hierarchical:</p><ul><li><p>If the <em>scheme</em> is known to be hierarchical, or known not to be hierarchical, then <em>hierarchical</em> is set accordingly. If the implementation does not know if a <em>scheme</em> is or is not hierarchical, the <em>hierarchical</em> setting depends on the <em>string</em>: if the <em>string</em> is the zero-length string, <em>hierarchical</em> is the empty sequence (<em>i.e.</em> not known), otherwise <em>hierarchical</em> is <code>true</code> if <em>string</em> begins with <code>/</code> and <code>false</code> otherwise.</p></li></ul><p>If the URI is not <em>hierarchical</em>, <em>absolute</em> is the empty sequence.</p><p>Identify the remaining components according to the scheme and whether or not the URI is hierarchical.</p><ul><li><p>If the scheme is <code>file</code>:</p><ul><li><p>The <em>authority</em> is the empty sequence.</p></li><li><p>If <em>unc-path</em> is true and the string matches <code>^/*(//[^/].*)$</code>: then <em>filepath</em>, and <em>string</em> are both the first match group.</p></li><li><p>If the <em>string</em> begins <code>^//*[A-Za-z]:/</code> then all but one leading slash is removed from <em>string</em> and the <em>filepath</em> is the <em>string</em> with all leading slashes removed.</p></li><li><p>Otherwise, the <em>filepath</em> and <em>string</em> are the <em>string</em> with any sequence of leading slashes replaced by a single slash.</p></li></ul></li><li><p>If the scheme is <code>hierarchical</code>:</p><ul><li><p>If the <em>string</em> matches <code>^//([^/]+)$</code>, the <em>authority</em> is the first match group and the <em>string</em> is empty.</p></li><li><p>If the <em>string</em> matches <code>^//([^/]*)(/.*)$</code>, the <em>authority</em> is the first match group and the <em>string</em> is the second match group.</p></li><li><p>Otherwise, the <em>authority</em> is the empty sequence and the <em>string</em> is unchanged.</p></li></ul></li><li><p>If the scheme is not <code>hierarchical</code>:</p><ul><li><p>The <em>authority</em> is the empty sequence and the <em>string</em> is unchanged.</p></li></ul></li></ul><p>If the <em>authority</em> matches <code>^(([^@]*)@)(.*)(:([^:]*))?$</code>, then the <em>userinfo</em> is match group 2, otherwise <em>userinfo</em> is the empty sequence. If <em>userinfo</em> is present and contains a non-empty password, then <em>userinfo</em> is discarded and set to the empty sequence unless the <code>allow-deprecated-features</code> option is <code>true</code>.</p><p>When parsing the <em>authority</em> to find the <em>host</em>, there are four possibilities: the host can be a registered name (e.g., <code>example.com</code>), an IPv4 address (e.g., <code>127.0.0.1</code>), an IPv6 (or IPvFuture) address (e.g., <code>[::1]</code>), or an error if there is an open square bracket (<code>[</code>) not matched by a close square bracket (<code>]</code>). In a properly constructed RFC 3986 URI, the only place where square brackets may occur is around the IPv6/IPvFuture IP address.</p><ol class="enumar"><li><p>If the <em>authority</em> matches <code>^(([^@]*)@)?(\[[^\]]*\])(:([^:]*))?$</code>, then the <em>host</em> is match group 3, otherwise </p></li><li><p>If the <em>authority</em> matches <code>^(([^@]*)@)?\[.*$</code> then [<a href="#ERRFOUR0001" title="err:FOUR0001">err:FOUR0001</a>] is raised, otherwise </p></li><li><p>If the <em>authority</em> matches <code>^(([^@]*)@)?([^:]+)(:([^:]*))?$</code>, then the <em>host</em> is match group 3, otherwise </p></li><li><p>the <em>host</em> is the empty sequence.</p></li></ol><p>This function does not attempt to decode the components of the <em>host</em>.</p><p>Similar care must be taken to match the port because an IPv6/IPvFuture address may contain a colon.</p><ul><li><p>If the <em>authority</em> matches <code>^(([^@]*)@)?(\[[^\]]*\])(:([^:]*))?$</code>, then the <em>port</em> is match group 5. </p></li><li><p>Otherwise, if the <em>authority</em> matches <code>^(([^@]*)@)?([^:]+)(:([^:]*))?$</code>, then the <em>port</em> is match group 5. </p></li><li><p>Otherwise, the <em>port</em> is the empty sequence.</p></li></ul><p>If the <code>omit-default-ports</code> option is <code>true</code>, the port is discarded and set to the empty sequence if the port number is the same as the default port for the given scheme. Implementations <span class="verb">should</span> recognize the default ports for <code>http</code> (80), <code>https</code> (443), <code>ftp</code> (21), and <code>ssh</code> (22). Exactly which ports are recognized is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. </p><p>If the <em>string</em> is a zero-length string, then <em>path</em> is the empty sequence, otherwise <em>path</em> is the whole <em>string</em>. If the <em>scheme</em> is the empty sequence, <em>filepath</em> is also the whole <em>string</em>.</p><p>A <em>path-segments</em> sequence is constructed by tokenizing the <em>string</em> on <code>/</code>&nbsp;(solidus) and applying <em>uri decoding</em> on each token.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The <em>path</em> and <em>path-segments</em> properties both contain the path portion of the URI. The different formats only become important when the path contains encoded delimiters.</p><p>Consider <code>/path%2Fsegment</code>. An application may want to decode that, using <code>/path/segment</code> in a database query, for example. At the same time, an application may wish to modify the URI and then reconstruct it.</p><p>In the string form, decoding <code>%2F</code> to <code>/</code> is not reversible. In the <em>path-segments</em> form, the path is broken into discrete segments where the syntactic delimiters occur. This means the encoded delimiters can be decoded without introducing ambiguity: <code>("", "path/segment")</code>. In this format, the decoding is reversible: escape the non-syntactic delimiters before reconstructing the path with the syntactic ones.</p><p>A consequence of constructing the <em>path-segments</em> this way is that a zero-length string appears before the first <code>/</code>, if the path begins with a <code>/</code>, after the last <code>/</code>, if the path ends with a <code>/</code>, and between consecutive <code>/</code> characters. (If the path consists of a single <code>/</code>, that <code>/</code> counts as <em>both</em> the first and last <code>/</code>, producing a segment list containing two empty strings.)</p><p>The empty strings may seem unnecessary at first glance, but they assure that the path can be reconstructed by joining the segments together again without having to handle the presence or absence of a leading or trailing <code>/</code> as special cases.</p></div><p>Applying <em>uri decoding</em> is equivalent to calling <a href="#func-decode-from-uri"><code>fn:decode-from-uri</code></a> on the string.</p><p>The <em>query-parameters</em> value is constructed as follows. Start with the empty map. Tokenize the <em>query</em> on the <code>&amp;</code>&nbsp;(ampersand). For each token, identify the <em>key</em> and the <em>value</em>. If the token contains an equal sign (<code>=</code>), the <em>key</em> is the string that precedes the first equal sign, uri decoded, and the <em>value</em> is the remainder of the token, after the first equal sign, uri decoded. If the token does not contain an equal sign, <em>key</em> is the empty string and the <em>value</em> is equal to the token, uri decoded. Add the <em>key</em>/<em>value</em> pair to the map. If the <em>key</em> already exists in the map, add the <em>value</em> to a list of values associated with that key. The resulting map, when all tokens have been processed, is the <em>query-parameters</em> map.</p><p>If the <em>filepath</em> is not the empty sequence, it is uri decoded. On a Windows system, any forward slashes in the path <span class="verb">may</span> be replaced with backslashes.</p><p>A <a href="#uri-structure-record">uri-structure-record</a> is returned. The record should be populated with only those keys that have a non-empty value (keys whose value is the empty sequence <span class="verb">should</span> be omitted).</p><p>Implementations may implement additional or different rules for URIs that have a scheme or pattern that they recognize. An implementation might choose to parse <code>jar:</code> URIs with special rules, for example, since they extend the syntax in ways not defined by <a href="#rfc3986">[RFC 3986]</a>. Implementations may add additional keys to the map. The meaning of those keys is implementation-defined.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOUR0001" title="err:FOUR0001">err:FOUR0001</a>] if the URI contains an open square bracket in the authority component that is not followed by a close square bracket.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Like <a href="#func-resolve-uri"><code>fn:resolve-uri</code></a>, this function handles the additional characters allowed in <a href="#rfc3987">[RFC 3987]</a> IRIs in the same way that other unreserved characters are handled.</p><p>Unlike <a href="#func-resolve-uri"><code>fn:resolve-uri</code></a>, this function is not attempting to resolve one URI against another and consequently, the errors that can arise under those circumstances do not apply here. The <a href="#func-parse-uri"><code>fn:parse-uri</code></a> function will accept strings that would raise errors if resolution was attempted; see <a href="#func-build-uri"><code>fn:build-uri</code></a>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>In the examples that follow, keys with values that are null or the empty sequence are elided for editorial clarity. String literals that include an ampersand character are written as string templates (for example <code>`Barnes&amp;Noble`</code>) to ensure that the examples work in both XPath and XQuery.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("http://qt4cg.org/specifications/xpath-functions-40/Overview.html#parse-uri")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "authority": "qt4cg.org",
  "fragment": "parse-uri",
  "hierarchical": true(),
  "host": "qt4cg.org",
  "path": "/specifications/xpath-functions-40/Overview.html",
  "path-segments": ("", "specifications", "xpath-functions-40", "Overview.html"),
  "scheme": "http",
  "uri": "http://qt4cg.org/specifications/xpath-functions-40/Overview.html#parse-uri"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("http://www.ietf.org/rfc/rfc2396.txt")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "authority": "www.ietf.org",
  "hierarchical": true(),
  "absolute": true(),
  "host": "www.ietf.org",
  "path": "/rfc/rfc2396.txt",
  "path-segments": ("", "rfc", "rfc2396.txt"),
  "scheme": "http",
  "uri": "http://www.ietf.org/rfc/rfc2396.txt"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("https://example.com/path/to/file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "authority": "example.com",
  "path": "/path/to/file",
  "scheme": "https",
  "path-segments": ("", "path", "to", "file"),
  "host": "example.com",
  "hierarchical": true(),
  "absolute": true(),
  "uri": "https://example.com/path/to/file"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri(
  `https://example.com:8080/path?s=%22hello world%22&amp;sort=relevance`
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "authority": "example.com:8080",
  "hierarchical": true(),
  "absolute": true(),
  "host": "example.com",
  "path": "/path",
  "path-segments": ("", "path"),
  "port": 8080,
  "query": `s=%22hello world%22&amp;sort=relevance`,
  "query-parameters": {
    "s": """hello world""",
    "sort": "relevance"
  },
  "scheme": "https",
  "uri": `https://example.com:8080/path?s=%22hello world%22&amp;sort=relevance`
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("https://user@example.com/path/to/file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "authority": "user@example.com",
  "hierarchical": true(),
  "absolute": true(),
  "host": "example.com",
  "path": "/path/to/file",
  "path-segments": ("", "path", "to", "file"),
  "scheme": "https",
  "uri": "https://user@example.com/path/to/file",
  "userinfo": "user"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("ftp://ftp.is.co.za/rfc/rfc1808.txt")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "authority": "ftp.is.co.za",
  "hierarchical": true(),
  "absolute": true(),
  "host": "ftp.is.co.za",
  "path": "/rfc/rfc1808.txt",
  "path-segments": ("", "rfc", "rfc1808.txt"),
  "scheme": "ftp",
  "uri": "ftp://ftp.is.co.za/rfc/rfc1808.txt"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("file:////uncname/path/to/file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "filepath": "/uncname/path/to/file",
  "hierarchical": true(),
  "absolute": true(),
  "path": "/uncname/path/to/file",
  "path-segments": ("", "uncname", "path", "to", "file"),
  "scheme": "file",
  "uri": "file:////uncname/path/to/file"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("file:///c:/path/to/file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "filepath": "c:/path/to/file",
  "hierarchical": true(),
  "absolute": true(),
  "path": "/c:/path/to/file",
  "path-segments": ("", "c:", "path", "to", "file"),
  "scheme": "file",
  "uri": "file:///c:/path/to/file"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("file:/C:/Program%20Files/test.jar")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "filepath": "C:/Program Files/test.jar",
  "hierarchical": true(),
  "absolute": true(),
  "path": "/C:/Program%20Files/test.jar",
  "path-segments": ("", "C:", "Program Files", "test.jar"),
  "scheme": "file",
  "uri": "file:/C:/Program%20Files/test.jar"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("file:\\c:\path\to\file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "filepath": "c:/path/to/file",
  "hierarchical": true(),
  "absolute": true(),
  "path": "/c:/path/to/file",
  "path-segments": ("", "c:", "path", "to", "file"),
  "scheme": "file",
  "uri": "file:\\c:\path\to\file"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("file:\c:\path\to\file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "filepath": "c:/path/to/file",
  "hierarchical": true(),
  "absolute": true(),
  "path": "/c:/path/to/file",
  "path-segments": ("", "c:", "path", "to", "file"),
  "scheme": "file",
  "uri": "file:\c:\path\to\file"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("c:\path\to\file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "filepath": "c:/path/to/file",
  "hierarchical": true(),
  "path": "/c:/path/to/file",
  "path-segments": ("", "c:", "path", "to", "file"),
  "scheme": "file",
  "uri": "c:\path\to\file"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("/path/to/file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "filepath": "/path/to/file",
  "hierarchical": true(),
  "path": "/path/to/file",
  "path-segments": ("", "path", "to", "file"),
  "uri": "/path/to/file"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("#testing")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{
  "fragment": "testing",
  "uri": "#testing"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("?q=1")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{
  "query": "q=1",
  "query-parameters":{
    "q": "1"
  },
  "uri": "?q=1"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("ldap://[2001:db8::7]/c=GB?objectClass?one")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "authority": "[2001:db8::7]",
  "hierarchical": true(),
  "absolute": true(),
  "host": "[2001:db8::7]",
  "path": "/c=GB",
  "path-segments": ("", "c=GB"),
  "query": "objectClass?one",
  "query-parameters":{
    "": "objectClass?one"
  },
  "scheme": "ldap",
  "uri": "ldap://[2001:db8::7]/c=GB?objectClass?one"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("mailto:John.Doe@example.com")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "hierarchical": false(),
  "path": "John.Doe@example.com",
  "path-segments": "John.Doe@example.com",
  "scheme": "mailto",
  "uri": "mailto:John.Doe@example.com"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("news:comp.infosystems.www.servers.unix")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "hierarchical": false(),
  "path": "comp.infosystems.www.servers.unix",
  "path-segments": "comp.infosystems.www.servers.unix",
  "scheme": "news",
  "uri": "news:comp.infosystems.www.servers.unix"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("tel:+1-816-555-1212")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "hierarchical": false(),
  "path": "+1-816-555-1212",
  "path-segments": " 1-816-555-1212",
  "scheme": "tel",
  "uri": "tel:+1-816-555-1212"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("telnet://192.0.2.16:80/")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "authority": "192.0.2.16:80",
  "hierarchical": true(),
  "absolute": true(),
  "host": "192.0.2.16",
  "path": "/",
  "path-segments": ("", ""),
  "port": 80,
  "scheme": "telnet",
  "uri": "telnet://192.0.2.16:80/"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("urn:oasis:names:specification:docbook:dtd:xml:4.1.2")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "hierarchical": false(),
  "path": "oasis:names:specification:docbook:dtd:xml:4.1.2",
  "path-segments": "oasis:names:specification:docbook:dtd:xml:4.1.2",
  "scheme": "urn",
  "uri": "urn:oasis:names:specification:docbook:dtd:xml:4.1.2"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("tag:textalign.net,2015:ns")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "hierarchical": false(),
  "path": "textalign.net,2015:ns",
  "path-segments": "textalign.net,2015:ns",
  "scheme": "tag",
  "uri": "tag:textalign.net,2015:ns"
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("tag:jan@example.com,1999-01-31:my-uri")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "hierarchical": false(),
  "path": "jan@example.com,1999-01-31:my-uri",
  "path-segments": "jan@example.com,1999-01-31:my-uri",
  "scheme": "tag",
  "uri": "tag:jan@example.com,1999-01-31:my-uri"
}</pre></div></td></tr><tr><td colspan="2"><p>This example uses the algorithm described above, not an algorithm that is specifically aware of the <code>jar:</code> scheme.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("jar:file:/C:/Program%20Files/test.jar!/foo/bar")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "hierarchical": false(),
  "path": "file:/C:/Program%20Files/test.jar!/foo/bar",
  "path-segments": ("file:", "C:", "Program Files", "test.jar!", "foo", "bar"),
  "scheme": "jar",
  "uri": "jar:file:/C:/Program%20Files/test.jar!/foo/bar"
}</pre></div></td></tr><tr><td colspan="2"><p>This example demonstrates that parsing the URI treats non-URI characters in lexical IRIs as “unreserved characters”. The rationale for this is given in the description of <a href="#func-resolve-uri"><code>fn:resolve-uri</code></a>.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("http://www.example.org/Dürst")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "authority": "www.example.org",
  "hierarchical": true(),
  "absolute": true(),
  "host": "www.example.org",
  "path": "/Dürst",
  "path-segments": ("", "Dürst"),
  "scheme": "http",
  "uri": "http://www.example.org/Dürst"
}</pre></div></td></tr><tr><td colspan="2"><p>This example demonstrates the use of <code>|</code> instead of <code>:</code> in a Windows path.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("c|/path/to/file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "filepath": "c:/path/to/file",
  "hierarchical": true(),
  "path": "/c:/path/to/file",
  "path-segments": ("", "c:", "path", "to", "file"),
  "scheme": "file",
  "uri": "c|/path/to/file"
}</pre></div></td></tr><tr><td colspan="2"><p>This example demonstrates the use of <code>|</code> instead of <code>:</code> in a Windows path with an explicit <code>file:</code> scheme.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-uri("file://c|/path/to/file")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "filepath": "c:/path/to/file",
  "hierarchical": true(),
  "absolute": true(),
  "path": "/c:/path/to/file",
  "path-segments": ("", "c:", "path", "to", "file"),
  "scheme": "file",
  "uri": "file://c|/path/to/file"
}</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-build-uri"></a>7.6.3 <a href="#func-build-uri" style="text-decoration: none">fn:build-uri</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#duration-conformance">next</a> | <a href="#func-parse-uri">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/72">72</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/389">389</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/390">390</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1423">1423</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1413">1413</a>&nbsp;17 October 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Constructs a URI from the parts provided.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:build-uri</code>(</td></tr><tr class="arg"><td><code>$parts</code></td><td><code class="as">as&nbsp;</code><code><a href="#uri-structure-record">uri-structure-record</a></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>A URI is composed from a scheme, authority, path, query, and fragment.</p><p>The following options are available:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">allow-deprecated-features?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">omit-default-ports?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">unc-path?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>allow-deprecated-features?</code></p></td><td class="fos-thin">Indicates that deprecated URI features should be returned <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>omit-default-ports?</code></p></td><td class="fos-thin">Indicates that a port number that is the same as the default port for a given scheme should be omitted. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>unc-path?</code></p></td><td class="fos-thin">Indicates that the URI represents a Windows Universal Naming Convention Path. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr></tbody></table><p>The components are derived from the contents of the <code>$parts</code> map. To simplify the description below, a value is considered to be present in the map if the relevant field exists and is non-empty.</p><p>If the <code>scheme</code> key is present in the map, the URI begins with the value of that key. A URI is considered to be non-hierarchical if either the <code>hierarchical</code> key is present in the <code>$parts</code> map with the value <code>false</code> or if the scheme is known to be non-hierarchical. (In other words, schemes are hierarchical by default.)</p><ul><li><p>If the <code>scheme</code> is known to be non-hierarchical, it is delimited by a trailing <code>:</code>.</p></li><li><p>Otherwise, if the <code>scheme</code> is <code>file</code> and the <code>unc-path</code> option is <code>true</code>, the scheme is delimited by a trailing <code>:////</code>.</p></li><li><p>Otherwise, the scheme is delimited by a trailing <code>://</code>.</p></li></ul><p>For simplicity of exposition, we take the <code>userinfo</code>, <code>host</code>, and <code>port</code> values from the map and imagine they are stored in variables with the same name. If the key is not present in the map, the value of the variable is set to the empty sequence.</p><p>If <code>$userinfo</code> is non-empty and contains a non-empty password, then <code>$userinfo</code> is set to the empty sequence unless the <code>allow-deprecated-features</code> option is <code>true</code>.</p><p>If the <code>omit-default-ports</code> option is <code>true</code> then the <code>$port</code> is set to the empty sequence if the port number is the same as the default port for the given scheme. Implementations <span class="verb">should</span> recognize the default ports for <code>http</code> (80), <code>https</code> (443), <code>ftp</code> (21), and <code>ssh</code> (22). Exactly which ports are recognized is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. </p><p>If any of <code>$userinfo</code>, <code>$host</code>, or <code>$port</code> exist, the following authority is added to the URI under construction: </p><div class="exampleInner"><pre xml:space="preserve" class="small">concat(
  if (exists($userinfo)) { $userinfo || "@" },
  $host,
  if (exists($port)) { ":" || $port }
)</pre></div><p>If none of <code>userinfo</code>, <code>host</code>, or <code>port</code> is present, and <code>authority</code> is present, the value of the <code>authority</code> key is added to the URI. (In this case, no attempt is made to determine if a password or standard port are present, the <code>authority</code> value is simply added to the string.)</p><p>The <a href="#func-parse-uri"><code>fn:parse-uri</code></a> function removes percent-escaping when it constructs the <code>path-segments</code>, <code>query-parameters</code>, and <code>fragment</code> properties. That’s often the most convenient behavior but, in order to reconstruct a URI from them, special escaping rules apply. These rules protect delimiters without encoding additional characters unnecessarily. The rules for <code>path-segments</code>, <code>query-parameters</code>, and <code>fragment</code> are slightly different because the URI encoding conventions are slightly different in each case.</p><p>An application with more stringent requirements can construct a <code>path</code> or <code>query</code> that satisfies the requirements and leave the <code>path-segments</code> and/or <code>query-parameters</code> keys out of the map.</p><ul><li><p>If the <code>path-segments</code> key exists in the map, then the path is constructed from the segments. To construct the path, the possibly encoded segments are concatentated together, separated by <span class="unicode-codepoint">U+002F</span> (<span class="unicode-name">SOLIDUS, FORWARD SLASH</span>, <code>/</code>) characters.</p><p>The rules for encoding the path segments are different for hierarchical and non-hierarchical URIs. If the URI is non-hierarchical, no encoding is performed on the segments. Otherwise, each segment is encoded by replacing any control characters (codepoints less than 0x20) and exclusively the following characters with their percent-escaped forms: <span class="unicode-codepoint">U+0020</span> (<span class="unicode-name">SPACE</span>) , <span class="unicode-codepoint">U+0025</span> (<span class="unicode-name">PERCENT SIGN</span>, <code>%</code>) , <span class="unicode-codepoint">U+002F</span> (<span class="unicode-name">SOLIDUS, FORWARD SLASH</span>, <code>/</code>) , <span class="unicode-codepoint">U+003F</span> (<span class="unicode-name">QUESTION MARK</span>, <code>?</code>) , <span class="unicode-codepoint">U+0023</span> (<span class="unicode-name">NUMBER SIGN</span>, <code>#</code>) , <span class="unicode-codepoint">U+002B</span> (<span class="unicode-name">PLUS</span>, <code>+</code>) , <span class="unicode-codepoint">U+005B</span> (<span class="unicode-name">LEFT SQUARE BRACKET</span>, <code>[</code>) , and <span class="unicode-codepoint">U+005D</span> (<span class="unicode-name">RIGHT SQUARE BRACKET</span>, <code>]</code>) . That is “<code>[#0-#20%/\?\#\+\[\]]</code>”.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Encoding is performed unless the URI is known to be non-hierarchical; in other words, encoding is the default. This heuristic improves the reliability of using <code>fn:build-uri()</code> on the output of <code>fn:parse-uri()</code>. (For example, <code>fn:parse-uri('a+b/c') =&gt; fn:build-uri()</code> will return <code>a+b/c</code>.)</p><p>It is necessary to avoid encoding non-hierarchical schemes because there is more variation in them (for example, the <code>tel:</code> scheme uses a “<code>+</code>” that must not be encoded). Users working with non-hierarchical schemes may need to address the encoding issue directly bearing in mind the encoding requirements of the particular schemes in use.</p></div></li><li><p>Otherwise the value of the <code>path</code> key is used.</p></li><li><p>If neither are present, a zero-length string is used for the path.</p></li></ul><p>The path is added to the URI.</p><p>If the <code>query-parameters</code> key exists in the map, its value must be a map. A sequence of strings is constructed from the values in the map.</p><p>To construct the string, each <em>key</em> and <em>value</em> is encoded. The encoding performed replaces any control characters (codepoints less than 0x20) and exclusively the following characters with their percent-escaped forms: <span class="unicode-codepoint">U+0020</span> (<span class="unicode-name">SPACE</span>) , <span class="unicode-codepoint">U+0025</span> (<span class="unicode-name">PERCENT SIGN</span>, <code>%</code>) , <span class="unicode-codepoint">U+003D</span> (<span class="unicode-name">EQUALS SIGN</span>, <code>=</code>) , <span class="unicode-codepoint">U+0026</span> (<span class="unicode-name">AMPERSAND</span>, <code>&amp;</code>) , <span class="unicode-codepoint">U+0023</span> (<span class="unicode-name">NUMBER SIGN</span>, <code>#</code>) , <span class="unicode-codepoint">U+002B</span> (<span class="unicode-name">PLUS</span>, <code>+</code>) , <span class="unicode-codepoint">U+005B</span> (<span class="unicode-name">LEFT SQUARE BRACKET</span>, <code>[</code>) , and <span class="unicode-codepoint">U+005D</span> (<span class="unicode-name">RIGHT SQUARE BRACKET</span>, <code>]</code>) . That is “<code>[#0-#20%=&amp;\#\+\[\]]</code>”. (This differs from the path encoding in that it excludes <span class="unicode-codepoint">U+002F</span> (<span class="unicode-name">SOLIDUS, FORWARD SLASH</span>, <code>/</code>) and <span class="unicode-codepoint">U+003F</span> (<span class="unicode-name">QUESTION MARK</span>, <code>?</code>) but includes <span class="unicode-codepoint">U+003D</span> (<span class="unicode-name">EQUALS SIGN</span>, <code>=</code>) and <span class="unicode-codepoint">U+0026</span> (<span class="unicode-name">AMPERSAND</span>, <code>&amp;</code>) .) For each <em>key</em> and each <em>value</em> associated with that key in turn:</p><ul><li><p>If the <em>key</em> is a zero-length string, the string constructed is the encoded <em>value</em>.</p></li><li><p>Otherwise, the string constructed is the value of the <em>key</em>, encoded, followed by an equal sign (<span class="unicode-codepoint">U+003D</span> (<span class="unicode-name">EQUALS SIGN</span>, <code>=</code>) ), followed by the <em>value</em>, encoded.</p></li></ul><p>The query is constructed by joining the resulting strings into a single string, separated by <code>&amp;</code>&nbsp;(ampersand) characters. If the <code>query-parameters</code> key does not exist in the map, but the <code>query</code> key does, then the query is the value of the <code>query</code> key.</p><p>If there is a query, it is added to the URI with a preceding <span class="unicode-codepoint">U+003F</span> (<span class="unicode-name">QUESTION MARK</span>, <code>?</code>) .</p><p>If the <code>fragment</code> key exists in the map, then the value of that key is encoded and added to the URI with a preceding <span class="unicode-codepoint">U+0023</span> (<span class="unicode-name">NUMBER SIGN</span>, <code>#</code>) . The encoding performed replaces any control characters (codepoints less than 0x20) and exclusively the following characters with their percent-escaped forms: <span class="unicode-codepoint">U+0020</span> (<span class="unicode-name">SPACE</span>) , <span class="unicode-codepoint">U+0025</span> (<span class="unicode-name">PERCENT SIGN</span>, <code>%</code>) , <span class="unicode-codepoint">U+0023</span> (<span class="unicode-name">NUMBER SIGN</span>, <code>#</code>) , <span class="unicode-codepoint">U+002B</span> (<span class="unicode-name">PLUS</span>, <code>+</code>) , <span class="unicode-codepoint">U+005B</span> (<span class="unicode-name">LEFT SQUARE BRACKET</span>, <code>[</code>) , and <span class="unicode-codepoint">U+005D</span> (<span class="unicode-name">RIGHT SQUARE BRACKET</span>, <code>]</code>) . That is “<code>[#0-#20%\#\+\[\]]</code>”. (This differs from the path encoding in that it excludes <span class="unicode-codepoint">U+002F</span> (<span class="unicode-name">SOLIDUS, FORWARD SLASH</span>, <code>/</code>) and <span class="unicode-codepoint">U+003F</span> (<span class="unicode-name">QUESTION MARK</span>, <code>?</code>) .)</p><p>The resulting URI is returned.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">build-uri({
  "scheme": "https",
  "host": "qt4cg.org",
  "port": (),
  "path": "/specifications/index.html"
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"https://qt4cg.org/specifications/index.html"</pre></div></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="durations"></a>8 <a href="#durations" style="text-decoration: none">Processing durations</a></h2><p>Operators are defined on the following type:</p><ul><li><p><code>xs:duration</code></p></li></ul><p>and on the two defined subtypes (see <a href="#duration-subtypes"><b>8.1.1 Subtypes of duration</b></a>):</p><ul><li><p><code>xs:yearMonthDuration</code></p></li><li><p><code>xs:dayTimeDuration</code></p></li></ul><p>Arithmetic on durations is defined only on these subtypes: this is because the results of some operations (for example one month minus one day) have no representation in the value space.</p><p>Two <code>xs:duration</code> values may however be compared.</p><div class="div2"><h3><a id="duration-data-types"></a>8.1 <a href="#duration-data-types" style="text-decoration: none">Duration data types</a></h3><p>A value of type <code>xs:duration</code> is considered to comprise two parts:</p><ul><li><p>The total number of months, represented as a signed integer.</p></li><li><p>The total number of seconds, represented as a signed decimal number.</p></li></ul><p>If one of these values is negative (less than zero), the other must not be positive (greater than zero).</p><p>In effect this means that operations on durations (including equality comparison, casting to string, and extraction of components) all treat the duration as normalized. The duration <code>PT1M30S</code> (one minute and thirty seconds), for example, is precisely equivalent to the duration <code>PT90S</code> (ninety seconds); these are different representations of the same value, and the result of any operation will be the same regardless which representation is used. For example, the function <a href="#func-seconds-from-duration"><code>fn:seconds-from-duration</code></a> returns 30 in both cases.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The information content of an <code>xs:duration</code> value can be reduced to an <code>xs:integer</code> number of months, and an <code>xs:decimal</code> number of seconds. For the two defined subtypes this is further simplified so that one of these two components is fixed at zero. Operations such as comparison of durations and arithmetic on durations can be expressed in terms of numeric operations applied to these two components.</p></div><div class="div3"><h4><a id="duration-subtypes"></a>8.1.1 <a href="#duration-subtypes" style="text-decoration: none">Subtypes of duration</a></h4><p>Two subtypes of <code>xs:duration</code>, namely <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>, are defined in <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a>. These types <span class="verb">must</span> be available in the data model whether or not the implementation supports other aspects of XSD 1.1.</p><p>The significance of these subtypes is that arithmetic and ordering become well defined; this is not the case for <code>xs:duration</code> values in general, because of the variable number of days in a month. For this reason, many of the functions and operators on durations require the arguments/operands to belong to these two subtypes.</p><p>In an <code>xs:yearMonthDuration</code>, the seconds component is always zero. In an <code>xs:dayTimeDuration</code>, the months component is always zero.</p></div><div class="div3"><h4><a id="duration-conformance"></a>8.1.2 <a href="#duration-conformance" style="text-decoration: none">Limits and precision</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-seconds">next</a> | <a href="#func-build-uri">previous</a>)</p><ol><li><p> The specification now prescribes a minimum precision and range for durations. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/931">931</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/932">932</a>&nbsp;16 January 2024]</i></p></li></ol></div><p>All conforming processors <span class="verb">must</span> support duration values in which:</p><ul><li><p>The total number of months can be represented as a signed <code>xs:int</code> value;</p></li><li><p>The total number of seconds can be represented as a signed <code>xs:decimal</code> value with facets <code>totalDigits=18</code> and <code>fractionalDigits=3</code>. That is, durations must be supported to millisecond precision.</p></li></ul><p>Processors <span class="verb">may</span> support a greater range and/or precision. The limits are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p><p>A processor that limits the range or precision of duration values may encounter overflow and underflow conditions when it tries to evaluate operations on durations. In these situations, the processor <span class="verb">must</span> return a zero-length duration in case of duration underflow, and <span class="verb">must</span> raise a dynamic error [<a href="#ERRFODT0001" title="err:FODT0001">err:FODT0001</a>] in case of overflow.</p><p>Similarly, a processor may be unable accurately to represent the result of dividing a duration by 2, or multiplying a duration by 0.5. A processor that limits the precision of the seconds component of duration values <span class="verb">must</span> deliver a result that is as close as possible to the mathematically precise result, given these limits; if two values are equally close, the one that is chosen is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p></div></div><div class="div2"><h3><a id="comp.duration"></a>8.2 <a href="#comp.duration" style="text-decoration: none">Comparing durations</a></h3><p>Duration values may be compared using the <a href="#func-compare"><code>fn:compare</code></a> function.</p><p>In this version of the specification, all <code>xs:duration</code> values are mutually comparable: comparison operations are no longer restricted to the two subtypes <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>. However, although a total ordering is defined over all durations, the result is not always meaningful: while it makes sense that <code>P1Y1D</code> (one year and a day) is greater than <code>P1Y</code> (one year), it makes little sense that <code>P32D</code> (thirty-two days) is less than <code>P1M</code> (one month).</p><p>Durations are treated as tuples with two components, the months and seconds components, and they are compared by treating the months as the primary key and the seconds as the primary key.</p></div><div class="div2"><h3><a id="component-extraction-durations"></a>8.3 <a href="#component-extraction-durations" style="text-decoration: none">Extracting components of durations</a></h3><p>The duration datatype may be considered to be a composite datatype in that it contains distinct properties or components. The extraction functions specified below extract a single component from a duration value. For <code>xs:duration</code> and its subtypes, including the two subtypes <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>, the components are normalized: this means that the seconds and minutes components will always be less than 60, the hours component less than 24, and the months component less than 12. </p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-years-from-duration"><code>fn:years-from-duration</code></a></td><td>Returns the number of years in a duration.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-months-from-duration"><code>fn:months-from-duration</code></a></td><td>Returns the number of months in a duration.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-days-from-duration"><code>fn:days-from-duration</code></a></td><td>Returns the number of days in a duration.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-hours-from-duration"><code>fn:hours-from-duration</code></a></td><td>Returns the number of hours in a duration.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-minutes-from-duration"><code>fn:minutes-from-duration</code></a></td><td>Returns the number of minutes in a duration.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-seconds-from-duration"><code>fn:seconds-from-duration</code></a></td><td>Returns the number of seconds in a duration.</td></tr></tbody></table><div class="div3"><h4><a id="func-years-from-duration"></a>8.3.1 <a href="#func-years-from-duration" style="text-decoration: none">fn:years-from-duration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the number of years in a duration.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:years-from-duration</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:duration?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> representing the years component in <code>$value</code>. Given that a duration is a <code>($months, $seconds)</code> tuple, the result is the value of <code>($months idiv 12)</code>.</p><p>If <code>$value</code> is a negative duration then the result will be negative.</p><p>If <code>$value</code> is an <code>xs:dayTimeDuration</code> the function returns <code>0</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">years-from-duration(
  xs:yearMonthDuration("P20Y15M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">21</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">years-from-duration(
  xs:yearMonthDuration("-P15M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">-1</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">years-from-duration(
  xs:dayTimeDuration("-P2DT15H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">0</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">years-from-duration(
  xs:duration("P1Y1000D")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div><p><em>(To capture whole portions of years reflected in the <code>xs:dayTimeDuration</code> component, it must first be converted to an <code>xs:yearMonthDuration</code>.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-months-from-duration"></a>8.3.2 <a href="#func-months-from-duration" style="text-decoration: none">fn:months-from-duration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the number of months in a duration.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:months-from-duration</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:duration?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> representing the months component in <code>$value</code>. Given that a duration is a <code>($months, $seconds)</code> tuple, the result is the value of <code>($months mod 12)</code>.</p><p>If <code>$value</code> is a negative duration then the result will be negative.</p><p>If <code>$value</code> is an <code>xs:dayTimeDuration</code> the function returns <code>0</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">months-from-duration(
  xs:yearMonthDuration("P20Y15M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">3</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">months-from-duration(
  xs:yearMonthDuration("-P20Y18M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">-6</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">months-from-duration(
  xs:dayTimeDuration("-P2DT15H0M0S")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">0</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">months-from-duration(
   xs:duration("P1M100D")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div><p><em>(To capture whole portions of months reflected in the <code>xs:dayTimeDuration</code> component, it must first be converted to an <code>xs:yearMonthDuration</code>.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-days-from-duration"></a>8.3.3 <a href="#func-days-from-duration" style="text-decoration: none">fn:days-from-duration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the number of days in a duration.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:days-from-duration</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:duration?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> representing the days component in <code>$value</code>. Given that a duration is a <code>($months, $seconds)</code> tuple, the result is <code>($seconds idiv 86400)</code>.</p><p>If <code>$value</code> is a negative duration then the result will be negative.</p><p>If <code>$value</code> is an <code>xs:yearMonthDuration</code> the function returns <code>0</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">days-from-duration(
  xs:dayTimeDuration("P3DT10H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">3</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">days-from-duration(
  xs:dayTimeDuration("P3DT55H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">5</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">days-from-duration(
  xs:yearMonthDuration("P3Y5M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">0</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">days-from-duration(
   xs:duration("P1Y1D")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div><p><em>(To capture days reflected in the <code>xs:yearMonthDuration</code> component, it must first be converted to an <code>xs:dayTimeDuration</code>.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-hours-from-duration"></a>8.3.4 <a href="#func-hours-from-duration" style="text-decoration: none">fn:hours-from-duration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the number of hours in a duration.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:hours-from-duration</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:duration?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> representing the hours component in <code>$value</code>. <span>Given that a duration is a <code>($months, $seconds)</code> tuple, the result is the value of <code>($seconds mod 86400) idiv 3600</code></span>.</p><p>If <code>$value</code> is a negative duration then the result will be negative.</p><p>If <code>$value</code> is an <code>xs:yearMonthDuration</code> the function returns <code>0</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-duration(
  xs:dayTimeDuration("P3DT10H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">10</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-duration(
  xs:dayTimeDuration("P3DT12H32M12S")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">12</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-duration(
  xs:dayTimeDuration("PT123H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">3</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-duration(
  xs:dayTimeDuration("-P3DT10H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">-10</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-duration(
   xs:duration("P1YT1H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div><p><em>(To capture hours reflected in the <code>xs:yearMonthDuration</code> component, it must first be converted to an <code>xs:dayTimeDuration</code>.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-minutes-from-duration"></a>8.3.5 <a href="#func-minutes-from-duration" style="text-decoration: none">fn:minutes-from-duration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the number of minutes in a duration.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:minutes-from-duration</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:duration?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> representing the minutes component in <code>$value</code>. Given that a duration is a <code>($months, $seconds)</code> tuple, the result is the value of <code>($seconds mod 3600) idiv 60</code>.</p><p>If <code>$value</code> is a negative duration then the result will be negative.</p><p>If <code>$value</code> is an <code>xs:yearMonthDuration</code> the function returns <code>0</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">minutes-from-duration(
  xs:dayTimeDuration("P3DT10H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">0</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">minutes-from-duration(
  xs:dayTimeDuration("-P5DT12H30M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">-30</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">minutes-from-duration(
   xs:duration("P1YT1M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div><p><em>(To capture minutes reflected in the <code>xs:yearMonthDuration</code> component, it must first be converted to an <code>xs:dayTimeDuration</code>.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-seconds-from-duration"></a>8.3.6 <a href="#func-seconds-from-duration" style="text-decoration: none">fn:seconds-from-duration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the number of seconds in a duration.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:seconds-from-duration</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:duration?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:decimal?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:decimal</code> representing the seconds component in <code>$value</code>. Given that a duration is a <code>($months, $seconds)</code> tuple, the result is the value of <code>($seconds mod 60)</code> as an <code>xs:decimal</code>.</p><p>If <code>$value</code> is a negative duration then the result will be negative.</p><p>If <code>$value</code> is an <code>xs:yearMonthDuration</code> the function returns <code>0</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds-from-duration(
  xs:dayTimeDuration("P3DT10H12.5S")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">12.5</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds-from-duration(
  xs:dayTimeDuration("-PT256S")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">-16.0</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds-from-duration(
   xs:duration("P1YT1S")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div><p><em>(To capture seconds reflected in the <code>xs:yearMonthDuration</code> component of an <code>xs:duration</code>, it must first be converted to an <code>xs:dayTimeDuration</code>.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds-from-duration(
   xs:duration("P1YT1S")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div><p><em>(To capture seconds reflected in the <code>xs:yearMonthDuration</code> component, it must first be converted to an <code>xs:dayTimeDuration</code>.)</em></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="duration-construction"></a>8.4 <a href="#duration-construction" style="text-decoration: none">Constructing durations</a></h3><p>This section decribes the <a href="#func-seconds"><code>fn:seconds</code></a> function, which constructs an <code>xs:dayTimeDuration</code> value representing a decimal number of seconds.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-seconds"><code>fn:seconds</code></a></td><td>Returns an <code>xs:dayTimeDuration</code> whose length is a given number of seconds.</td></tr></tbody></table><div class="div3"><h4><a id="func-seconds"></a>8.4.1 <a href="#func-seconds" style="text-decoration: none">fn:seconds</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-build-dateTime">next</a> | <a href="#duration-conformance">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/959">959</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/984">984</a>&nbsp;6 February 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an <code>xs:dayTimeDuration</code> whose length is a given number of seconds.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:seconds</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:decimal?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:dayTimeDuration</code> value whose length in seconds is equal to <code>$value</code>. </p><p>If <code>$value</code> is negative then the result will be a negative duration.</p><p>For handling of overflow and underflow, see <a href="#duration-limits"><b>9.8.1 Limits and precision</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The result of <code>seconds($n)</code> is approximately equal to the result of the expression <code>xs:dayTimeDuration('PT1S') * $n</code>. The equivalence is only approximate, because <code>seconds($n)</code> uses the exact <code>xs:decimal</code> value supplied, whereas multiplying a duration by a number first converts the number to an <code>xs:double</code> value, which may lose precision.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds(1)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('PT1S')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds(0.001)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('PT0.001S')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds(60)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('PT1M')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds(86400)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('P1D')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds(-5400)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('-PT1H30M')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('1970-01-01T00:00:00Z') + 1706702400 * seconds(1)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2024-01-31T12:00:00Z')</pre></div><p><em>(The expression converts a Unix timestamp to an <code>xs:dateTime</code> value).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">(
  xs:dateTime('2024-01-31T12:00:00Z') -
  xs:dateTime('1970-01-01T00:00:00Z')
) div seconds(1)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1706702400</pre></div><p><em>(The expression converts an <code>xs:dateTime</code> value to a Unix timestamp).</em></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="duration-arithmetic"></a>8.5 <a href="#duration-arithmetic" style="text-decoration: none">Arithmetic operators on durations</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-add-yearMonthDurations"><code>op:add-yearMonthDurations</code></a></td><td>Returns the result of adding two <code>xs:yearMonthDuration</code> values. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-yearMonthDurations"><code>op:subtract-yearMonthDurations</code></a></td><td>Returns the result of subtracting one <code>xs:yearMonthDuration</code> value from another. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-multiply-yearMonthDuration"><code>op:multiply-yearMonthDuration</code></a></td><td>Returns the result of multiplying <code>$arg1</code> by <code>$arg2</code>. The result is rounded to the nearest month.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-divide-yearMonthDuration"><code>op:divide-yearMonthDuration</code></a></td><td>Returns the result of dividing <code>$arg1</code> by <code>$arg2</code>. The result is rounded to the nearest month.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-divide-yearMonthDuration-by-yearMonthDuration"><code>op:divide-yearMonthDuration-by-yearMonthDuration</code></a></td><td>Returns the ratio of two <code>xs:yearMonthDuration</code> values.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-add-dayTimeDurations"><code>op:add-dayTimeDurations</code></a></td><td>Returns the sum of two <code>xs:dayTimeDuration</code> values.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-dayTimeDurations"><code>op:subtract-dayTimeDurations</code></a></td><td>Returns the result of subtracting one <code>xs:dayTimeDuration</code> from another.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-multiply-dayTimeDuration"><code>op:multiply-dayTimeDuration</code></a></td><td>Returns the result of multiplying a <code>xs:dayTimeDuration</code> by a number.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-divide-dayTimeDuration"><code>op:divide-dayTimeDuration</code></a></td><td>Returns the result of multiplying a <code>xs:dayTimeDuration</code> by a number.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-divide-dayTimeDuration-by-dayTimeDuration"><code>op:divide-dayTimeDuration-by-dayTimeDuration</code></a></td><td>Returns the ratio of two <code>xs:dayTimeDuration</code> values, as a decimal number.</td></tr></tbody></table><p>For operators that combine a duration and a date/time value, see <a href="#dateTime-arithmetic"><b>9.8 Arithmetic operators on durations, dates, and times</b></a>.</p><div class="div3"><h4><a id="func-add-yearMonthDurations"></a>8.5.1 <a href="#func-add-yearMonthDurations" style="text-decoration: none">op:add-yearMonthDurations</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the result of adding two <code>xs:yearMonthDuration</code> values. </p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>+</code> operator when applied to two <code>xs:yearMonthDuration</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:add-yearMonthDurations</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:yearMonthDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function returns the result of adding <code>$arg1</code> to <code>$arg2</code>. The result will be an <code>xs:yearMonthDuration</code> whose length in months is equal to the length in months of <code>$arg1</code> plus the length in months of <code>$arg2</code>.</p><p>For handling of overflow, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either duration (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:add-yearMonthDurations(
  xs:yearMonthDuration("P2Y11M"),
  xs:yearMonthDuration("P3Y3M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:yearMonthDuration("P6Y2M")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subtract-yearMonthDurations"></a>8.5.2 <a href="#func-subtract-yearMonthDurations" style="text-decoration: none">op:subtract-yearMonthDurations</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the result of subtracting one <code>xs:yearMonthDuration</code> value from another. </p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to two <code>xs:yearMonthDuration</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-yearMonthDurations</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:yearMonthDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function returns the result of subtracting <code>$arg2</code> from <code>$arg1</code>. The result will be an <code>xs:yearMonthDuration</code> whose length in months is equal to the length in months of <code>$arg1</code> minus the length in months of <code>$arg2</code>.</p><p>For handling of overflow, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either duration (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-yearMonthDurations(
  xs:yearMonthDuration("P2Y11M"),
  xs:yearMonthDuration("P3Y3M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:yearMonthDuration("-P4M")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-multiply-yearMonthDuration"></a>8.5.3 <a href="#func-multiply-yearMonthDuration" style="text-decoration: none">op:multiply-yearMonthDuration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the result of multiplying <code>$arg1</code> by <code>$arg2</code>. The result is rounded to the nearest month.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>*</code> operator when applied to an <code>xs:yearMonthDuration</code> and a numeric value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:multiply-yearMonthDuration</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:yearMonthDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The result is the <code>xs:yearMonthDuration</code> whose length in months is equal to the result of applying the <a href="#func-round"><code>fn:round</code></a> function to the value obtained by multiplying the length in months of <code>$arg1</code> by the value of <code>$arg2</code>.</p><p>If <code>$arg2</code> is positive or negative zero, the result is a zero-length duration. If <code>$arg2</code> is positive or negative infinity, the result overflows and is handled as described in <a href="#duration-limits"><b>9.8.1 Limits and precision</b></a>. </p><p>For handling of overflow, underflow, and rounding, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOCA0005" title="err:FOCA0005">err:FOCA0005</a>] if <code>$arg2</code> is <code>NaN</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either duration (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:multiply-yearMonthDuration(
  xs:yearMonthDuration("P2Y11M"),
  2.3
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:yearMonthDuration("P6Y9M")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-divide-yearMonthDuration"></a>8.5.4 <a href="#func-divide-yearMonthDuration" style="text-decoration: none">op:divide-yearMonthDuration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the result of dividing <code>$arg1</code> by <code>$arg2</code>. The result is rounded to the nearest month.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>div</code> operator when applied to an <code>xs:yearMonthDuration</code> and a numeric value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:divide-yearMonthDuration</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:yearMonthDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The result is the <code>xs:yearMonthDuration</code> whose length in months is equal to the result of applying the <a href="#func-round"><code>fn:round</code></a> function to the value obtained by dividing the length in months of <code>$arg1</code> by the value of <code>$arg2</code>.</p><p>If <code>$arg2</code> is positive or negative infinity, the result is a zero-length duration. If <code>$arg2</code> is positive or negative zero, the result overflows and is handled as described in <a href="#duration-limits"><b>9.8.1 Limits and precision</b></a>. </p><p>For handling of overflow, underflow, and rounding, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOCA0005" title="err:FOCA0005">err:FOCA0005</a>] if <code>$arg2</code> is <code>NaN</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either operand (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:divide-yearMonthDuration(
  xs:yearMonthDuration("P2Y11M"),
  1.5
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:yearMonthDuration("P1Y11M")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-divide-yearMonthDuration-by-yearMonthDuration"></a>8.5.5 <a href="#func-divide-yearMonthDuration-by-yearMonthDuration" style="text-decoration: none">op:divide-yearMonthDuration-by-yearMonthDuration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the ratio of two <code>xs:yearMonthDuration</code> values.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>div</code> operator when applied to two <code>xs:yearMonthDuration</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:divide-yearMonthDuration-by-yearMonthDuration</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:decimal</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function returns the result of dividing the length in months of <code>$arg1</code> by the length in months of <code>$arg2</code>, according to the rules of the <a href="#func-numeric-divide"><code>op:numeric-divide</code></a> function for integer operands.</p><p>For handling of overflow, underflow, and rounding, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either duration (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">op:divide-yearMonthDuration-by-yearMonthDuration(
  xs:yearMonthDuration("P3Y4M"),
  xs:yearMonthDuration("-P1Y4M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">-2.5</pre></div></td></tr><tr><td colspan="2"><p>The following example demonstrates how to calculate the length of an <code>xs:yearMonthDuration</code> value in months:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">op:divide-yearMonthDuration-by-yearMonthDuration(
  xs:yearMonthDuration("P3Y4M"),
  xs:yearMonthDuration("P1M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">40</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-add-dayTimeDurations"></a>8.5.6 <a href="#func-add-dayTimeDurations" style="text-decoration: none">op:add-dayTimeDurations</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the sum of two <code>xs:dayTimeDuration</code> values.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>+</code> operator when applied to two <code>xs:dayTimeDuration</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:add-dayTimeDurations</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function returns the result of adding <code>$arg1</code> to <code>$arg2</code>. The result is the <code>xs:dayTimeDuration</code> whose length in seconds is equal to the sum of the length in seconds of the two input durations.</p><p>For handling of overflow, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either duration (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:add-dayTimeDurations(
  xs:dayTimeDuration("P2DT12H5M"),
  xs:dayTimeDuration("P5DT12H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('P8DT5M')</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subtract-dayTimeDurations"></a>8.5.7 <a href="#func-subtract-dayTimeDurations" style="text-decoration: none">op:subtract-dayTimeDurations</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the result of subtracting one <code>xs:dayTimeDuration</code> from another.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to two <code>xs:dayTimeDuration</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-dayTimeDurations</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function returns the result of subtracting <code>$arg2</code> from <code>$arg1</code>. The result is the <code>xs:dayTimeDuration</code> whose length in seconds is equal to the length in seconds of <code>$arg1</code> minus the length in seconds of <code>$arg2</code>.</p><p>For handling of overflow, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either duration (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-dayTimeDurations(
  xs:dayTimeDuration("P2DT12H"),
  xs:dayTimeDuration("P1DT10H30M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('P1DT1H30M')</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-multiply-dayTimeDuration"></a>8.5.8 <a href="#func-multiply-dayTimeDuration" style="text-decoration: none">op:multiply-dayTimeDuration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the result of multiplying a <code>xs:dayTimeDuration</code> by a number.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>*</code> operator when applied to an <code>xs:dayTimeDuration</code> and a numeric value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:multiply-dayTimeDuration</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function returns the result of multiplying <code>$arg1</code> by <code>$arg2</code>. The result is the <code>xs:dayTimeDuration</code> whose length in seconds is equal to the length in seconds of <code>$arg1</code> multiplied by the numeric value <code>$arg2</code>.</p><p>If <code>$arg2</code> is positive or negative zero, the result is a zero-length duration. If <code>$arg2</code> is positive or negative infinity, the result overflows and is handled as described in <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>. </p><p>For handling of overflow, underflow, and rounding, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOCA0005" title="err:FOCA0005">err:FOCA0005</a>] if <code>$arg2</code> is <code>NaN</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either operand (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:multiply-dayTimeDuration(
  xs:dayTimeDuration("PT2H10M"),
  2.1
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('PT4H33M')</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-divide-dayTimeDuration"></a>8.5.9 <a href="#func-divide-dayTimeDuration" style="text-decoration: none">op:divide-dayTimeDuration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the result of multiplying a <code>xs:dayTimeDuration</code> by a number.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>div</code> operator when applied to two <code>xs:dayTimeDuration</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:divide-dayTimeDuration</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:double</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function returns the result of dividing <code>$arg1</code> by <code>$arg2</code>. The result is the <code>xs:dayTimeDuration</code> whose length in seconds is equal to the length in seconds of <code>$arg1</code> divided by the numeric value <code>$arg2</code>.</p><p>If <code>$arg2</code> is positive or negative infinity, the result is a zero-length duration. If <code>$arg2</code> is positive or negative zero, the result overflows and is handled as described in <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>. </p><p>For handling of overflow, underflow, and rounding, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOCA0005" title="err:FOCA0005">err:FOCA0005</a>] if <code>$arg2</code> is <code>NaN</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either operand (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:divide-dayTimeDuration(
  xs:dayTimeDuration("P1DT2H30M10.5S"),
  1.5
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:duration("PT17H40M7S")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-divide-dayTimeDuration-by-dayTimeDuration"></a>8.5.10 <a href="#func-divide-dayTimeDuration-by-dayTimeDuration" style="text-decoration: none">op:divide-dayTimeDuration-by-dayTimeDuration</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the ratio of two <code>xs:dayTimeDuration</code> values, as a decimal number.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>div</code> operator when applied to two <code>xs:dayTimeDuration</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:divide-dayTimeDuration-by-dayTimeDuration</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:decimal</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function returns the result of dividing <code>$arg1</code> by <code>$arg2</code>. The result is the <code>xs:dayTimeDuration</code> whose length in seconds is equal to the length in seconds of <code>$arg1</code> divided by the length in seconds of <code>$arg2</code>. The calculation is performed by applying <a href="#func-numeric-divide"><code>op:numeric-divide</code></a> to the two <code>xs:decimal</code> operands.</p><p>For handling of overflow, underflow, and rounding, see <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Either operand (and therefore the result) may be negative.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">round-half-to-even(
  op:divide-dayTimeDuration-by-dayTimeDuration(
    xs:dayTimeDuration("P2DT53M11S"), xs:dayTimeDuration("P1DT10H")
  ),
  4
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1.4378</pre></div></td></tr><tr><td colspan="2"><p>This examples shows how to determine the number of seconds in a duration.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:divide-dayTimeDuration-by-dayTimeDuration(
  xs:dayTimeDuration("P2DT53M11S"),
  seconds(1)
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">175991.0</pre></div></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="dates-times"></a>9 <a href="#dates-times" style="text-decoration: none">Processing dates and times</a></h2><p>This section defines operations on the <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> date and time types.</p><p> See <a href="#Working-With-Timezones">[Working With Timezones]</a> for a disquisition on working with date and time values with and without timezones. </p><div class="div2"><h3><a id="date-time-types"></a>9.1 <a href="#date-time-types" style="text-decoration: none">Date and time types</a></h3><p><span class="termdef"><a id="dt-gregorian"></a>[Definition] The eight primitive types <code>xs:dateTime</code>, <code>xs:date</code>, <code>xs:time</code>, <code>xs:gYearMonth</code>, <code>xs:gYear</code>, <code>xs:gMonthDay</code>, <code>xs:gMonth</code>, <code>xs:gDay</code> are referred to collectively as the <b>Gregorian</b> types.</span></p><p>This section describes operations on atomic items of these types.</p><p>Values of these types are modeled as comprising one or more of the seven components year, month, day, hour, minute, second, and timezone.</p><p>The only operations defined on <code>xs:gYearMonth</code>, <code>xs:gYear</code>, <code>xs:gMonthDay</code>, <code>xs:gMonth</code>, and <code>xs:gDay</code> values are equality comparison and component extraction. For other types, further operations are provided, including order comparisons, arithmetic, formatted display, and timezone adjustment.</p><div class="div3"><h4><a id="date-time-duration-conformance"></a>9.1.1 <a href="#date-time-duration-conformance" style="text-decoration: none">Limits and precision</a></h4><p>All conforming processors <span class="verb">must</span> support year values in the range 1 to 9999, and a minimum fractional second precision of 1 millisecond or three digits (that is, <code>s.sss</code>). However, processors <span class="verb">may</span> set larger <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on the maximum number of digits they support in these two situations. Processors <span class="verb">may</span> also choose to support the year 0 and years with negative values. The results of operations on dates that cross the year 0 are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p><p>A processor that limits the number of digits in date and time datatype representations may encounter overflow and underflow conditions when it tries to execute the functions in <a href="#dateTime-arithmetic"><b>9.8 Arithmetic operators on durations, dates, and times</b></a>. In these situations, the processor <span class="verb">must</span> return 00:00:00 in case of time underflow. It <span class="verb">must</span> raise a dynamic error [<a href="#ERRFODT0001" title="err:FODT0001">err:FODT0001</a>] in case of overflow.</p><p>Similarly, a processor that limits the precision of the seconds component of date and time or duration values may need to deliver a rounded result for arithmetic operations. Such a processor <span class="verb">must</span> deliver a result that is as close as possible to the mathematically precise result, given these limits: if two values are equally close, the one that is chosen is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p></div></div><div class="div2"><h3><a id="date-time-values"></a>9.2 <a href="#date-time-values" style="text-decoration: none">Date/time datatype values</a></h3><p>As defined in <a href="https://www.w3.org/TR/xpath-datamodel-31/#dates-and-times"> 3.3.2 Dates and Times </a><sup><small>DM31</small></sup>, <code>xs:dateTime</code>, <code>xs:date</code>, <code>xs:time</code>, <code>xs:gYearMonth</code>, <code>xs:gYear</code>, <code>xs:gMonthDay</code>, <code>xs:gMonth</code>, <code>xs:gDay</code> values, referred to collectively as date/time values, are represented as seven components or properties: <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>minute</code>, <code>second</code> and <code>timezone</code>. The first five components are <code>xs:integer</code> values. The value of the <code>second</code> component is an <code>xs:decimal</code> and the value of the <code>timezone</code> component is an <code>xs:dayTimeDuration</code>. For all the primitive date/time datatypes, the <code>timezone</code> property is optional and may or may not be present. Depending on the datatype, some of the remaining six properties must be present and some must be <a href="https://www.w3.org/TR/xpath-datamodel-31/#dt-absent">absent</a><sup><small>DM31</small></sup>. Absent, or missing, properties are represented by the empty sequence. This value is referred to as the <em>local</em> value in that the value retains its original timezone. Before comparing or subtracting <code>xs:dateTime</code> values, this local value <span class="verb">must</span> be translated or <em>normalized</em> to UTC.</p><p>For <code>xs:time</code>, <code>00:00:00</code> and <code>24:00:00</code> are alternate lexical forms for the same value, whose canonical representation is <code>00:00:00</code>. For <code>xs:dateTime</code>, a time component <code>24:00:00</code> translates to <code>00:00:00</code> of the following day.</p><div class="div3"><h4><a id="date-time-lexical-mapping"></a>9.2.1 <a href="#date-time-lexical-mapping" style="text-decoration: none">Examples</a></h4><ul><li><p>An <code>xs:dateTime</code> with lexical representation <code>1999-05-31T05:00:00</code> is represented in the datamodel by <code>{ 1999, 5, 31, 5, 0, 0.0, () }</code>.</p></li><li><p>An <code>xs:dateTime</code> with lexical representation <code>1999-05-31T13:20:00-05:00</code> is represented by <code>{ 1999, 5, 31, 13, 20, 0.0, xs:dayTimeDuration("-PT5H") }</code>.</p></li><li><p>An <code>xs:dateTime</code> with lexical representation <code>1999-12-31T24:00:00</code> is represented by <code>{ 2000, 1, 1, 0, 0, 0.0, () }</code>.</p></li><li><p>An <code>xs:date</code> with lexical representation <code>2005-02-28+8:00</code> is represented by <code>{ 2005, 2, 28, (), (), (), xs:dayTimeDuration("PT8H") }</code>.</p></li><li><p>An <code>xs:time</code> with lexical representation <code>24:00:00</code> is represented by <code>{ (), (), (), 0, 0, 0, () }</code>.</p></li></ul></div></div><div class="div2"><h3><a id="dateTime-record"></a>9.3 <a href="#dateTime-record" style="text-decoration: none">Record fn:dateTime-record</a></h3><p>This record type is used to represent the components of a value of type <code>xs:dateTime</code>, <code>xs:date</code>, <code>xs:time</code>, <code>xs:gYear</code>, <code>xs:gYearMonth</code>, <code>xs:gMonth</code>, <code>xs:gMonthDay</code>, or <code>xs:gDay</code>.</p><table class="fos-options"><thead><tr><th>Name</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>year?</code></p></td><td class="fos-thin"><p>The value of the <code>year</code> component. Range is implementation-defined.</p><ul><li><p><b>Type: </b><code>xs:integer</code></p></li></ul></td></tr><tr><td><p><code>month?</code></p></td><td class="fos-thin"><p>The value of the <code>month</code> component. Range 1 to 12 inclusive.</p><ul><li><p><b>Type: </b><code>xs:integer</code></p></li></ul></td></tr><tr><td><p><code>day?</code></p></td><td class="fos-thin"><p>The value of the <code>day</code> component. Range 1 to 31 inclusive.</p><ul><li><p><b>Type: </b><code>xs:integer</code></p></li></ul></td></tr><tr><td><p><code>hours?</code></p></td><td class="fos-thin"><p>The value of the <code>hours</code> component. Range 0 to 23 inclusive.</p><ul><li><p><b>Type: </b><code>xs:integer</code></p></li></ul></td></tr><tr><td><p><code>minutes?</code></p></td><td class="fos-thin"><p>The value of the <code>minutes</code> component. Range 0 to 59 inclusive.</p><ul><li><p><b>Type: </b><code>xs:integer</code></p></li></ul></td></tr><tr><td><p><code>seconds?</code></p></td><td class="fos-thin"><p>The value of the <code>seconds</code> component. Range 0 (inclusive) to 60 (exclusive).</p><ul><li><p><b>Type: </b><code>xs:decimal</code></p></li></ul></td></tr><tr><td><p><code>timezone?</code></p></td><td class="fos-thin"><p>The timezone offset, if the value has a timezone.</p><ul><li><p><b>Type: </b><code>xs:dayTimeDuration</code></p></li></ul></td></tr></tbody></table></div><div class="div2"><h3><a id="constructing-dateTime"></a>9.4 <a href="#constructing-dateTime" style="text-decoration: none">Constructing a dateTime</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-dateTime"><code>fn:dateTime</code></a></td><td>Returns an <code>xs:dateTime</code> value created by combining an <code>xs:date</code> and an <code>xs:time</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-build-dateTime"><code>fn:build-dateTime</code></a></td><td>Constructs a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value from the values of its components.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-unix-dateTime"><code>fn:unix-dateTime</code></a></td><td>Returns a dateTime value for a Unix time.</td></tr></tbody></table><div class="div3"><h4><a id="func-dateTime"></a>9.4.1 <a href="#func-dateTime" style="text-decoration: none">fn:dateTime</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an <code>xs:dateTime</code> value created by combining an <code>xs:date</code> and an <code>xs:time</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:dateTime</code>(</td></tr><tr class="arg"><td><code>$date</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$time</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTime?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If either <code>$date</code> or <code>$time</code> is the empty sequence the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:dateTime</code> whose date component is equal to <code>$date</code> and whose time component is equal to <code>$time</code>.</p><p>The timezone of the result is computed as follows:</p><ul><li><p>If neither argument has a timezone, the result has no timezone.</p></li><li><p>If exactly one of the arguments has a timezone, or if both arguments have the same timezone, the result has this timezone.</p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORG0008" title="err:FORG0008">err:FORG0008</a>] if the two arguments both have timezones and the timezones are different. </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">dateTime(
  xs:date("1999-12-31"),
  xs:time("12:00:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime("1999-12-31T12:00:00")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">dateTime(
  xs:date("1999-12-31"),
  xs:time("24:00:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime("1999-12-31T00:00:00")</pre></div><p><em>(This is because <code>"24:00:00"</code> is an alternate lexical form for <code>"00:00:00"</code>).</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-build-dateTime"></a>9.4.2 <a href="#func-build-dateTime" style="text-decoration: none">fn:build-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-unix-dateTime">next</a> | <a href="#func-seconds">previous</a>)</p><ol><li><p>New in 4.0</p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Constructs a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value from the values of its components.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:build-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code><a href="#dateTime-record">dateTime-record</a>?</code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>(xs:dateTime | xs:date | xs:time | xs:gYear | xs:gYearMonth | xs:gMonth | xs:gMonthDay | xs:gDay)?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value based on the supplied component values. The result will be the <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value <code>$R</code> such that <code>deep-equal( $significant(parts-of-dateTime($R)), $significant($value) )</code>, where <code>$significant</code> is the function <code>map:filter(?, fn($K, $V){$K eq "timezone" or exists($V)})</code>, that is, a function that discards entries in a map whose value is the empty sequence, other than the entry with key <code>"timezone"</code>.</p><p>If all seven components are present (year, month, day, hours, minutes, seconds, and timezone) then the result will be of type <code>xs:dateTimeStamp</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODT0005" title="err:FODT0005">err:FODT0005</a>] if the set of fields that are present and non-empty in <code>$value</code> is not one of the sets:</p><ul><li><p>year, month, day, hours, minutes, seconds, and optional timezone (delivering an <code>xs:dateTime</code>)</p></li><li><p>year, month, day, and optional timezone (delivering an <code>xs:date</code>)</p></li><li><p>year, and optional timezone (delivering an <code>xs:gYear</code>)</p></li><li><p>year, month, and optional timezone (delivering an <code>xs:gYearMonth</code>)</p></li><li><p>month, and optional timezone (delivering an <code>xs:gMonth</code>)</p></li><li><p>month, day, and optional timezone (delivering an <code>xs:gMonthDay</code>)</p></li><li><p>day, and optional timezone (delivering an <code>xs:gDay</code>)</p></li><li><p>hours, minutes, seconds, and optional timezone (delivering an <code>xs:time</code>)</p></li></ul><p>A dynamic error is raised [<a href="#ERRFODT0006" title="err:FODT0006">err:FODT0006</a>] if any of the components in <code>$value</code> is outside the permitted range (for example if the value of the <code>minutes</code> component is less than zero or greater than 59), or if the combination of fields is not a valid date/time (for example, if <code>month</code> is 4 and <code>day</code> is 31).</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Components that are present in <code>$value</code> but with an empty value are treated as if they were absent.</p><p>Midnight must be expressed with the <code>hours</code> value set to zero, not 24.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">build-dateTime({ "year": 1999, "month": 5, "day": 31, 
  "hours": 13, "minutes": 20, "seconds": 0, 
  "timezone": xs:dayTimeDuration("-PT5H")})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime("1999-05-31T13:20:00-05:00")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">build-dateTime({"hours": 13, "minutes": 30, "seconds": 4.2678})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("13:30:04.2678")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">build-dateTime({ "year": 2007, "month": 5, 
                     "timezone": xs:dayTimeDuration("PT0S")})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:gYearMonth("2007-05Z")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-unix-dateTime"></a>9.4.3 <a href="#func-unix-dateTime" style="text-decoration: none">fn:unix-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-year-from-dateTime">next</a> | <a href="#func-build-dateTime">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/959">959</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1358">1358</a>&nbsp;1 August 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a dateTime value for a Unix time.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:unix-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:nonNegativeInteger?</code></code></td><td><code class="assign">:=&nbsp;</code><code>0</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTimeStamp</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a dateTime value in UTC timezone for the Unix time specified by <code>$value</code> in milliseconds. If the value is absent or the empty sequence, <code>0</code> is used. The Unix time is defined in <a href="#ieee1003.1-2024">[IEEE 1003.1-2024]</a>.</p><p>If the implementation supports data types from XSD 1.1 then the returned value will be an instance of <code>xs:dateTimeStamp</code>. Otherwise, the only guarantees are that it will be an instance of <code>xs:dateTime</code> and will have a timezone component.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('1970-01-01T00:00:00Z') + ($value otherwise 0) * seconds(0.001)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>By calling this convenience function, it can be ensured that the correct timezone is used for computing the Unix time.</p><p>Note that Unix time does not account for leap seconds. It assumes that every day has 86,400 seconds.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">unix-dateTime()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('1970-01-01T00:00:00Z')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">unix-dateTime(1)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('1970-01-01T00:00:00.001Z')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">unix-dateTime(86400000)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('1970-01-02T00:00:00Z')</pre></div></td></tr><tr><td colspan="2"><p>Calculate the Unix time associated with a <code>xs:dateTime</code> value:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $value := current-dateTime()
return ($value - unix-dateTime()) div seconds(0.001)</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="comp.datetime"></a>9.5 <a href="#comp.datetime" style="text-decoration: none">Comparing date and time values</a></h3><p>Date and time values can be compared using the function <a href="#func-compare"><code>fn:compare</code></a>.</p><p><a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> states that the order relation on date and time datatypes is not a total order but a partial order because these datatypes may or may not have a timezone. This is handled as follows. If either operand to a comparison function on date or time values does not have an (explicit) timezone then, for the purpose of the operation, an implicit timezone, provided by the dynamic context <a href="https://www.w3.org/TR/xpath-31/#id-xp-evaluation-context-components"> C.2 Dynamic Context Components </a><sup><small>XP31</small></sup>, is assumed to be present as part of the value. This creates a total order for all date and time values.</p><p>An <code>xs:dateTime</code> can be considered to consist of seven components: <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>minute</code>, <code>second</code> and <code>timezone</code>. For <code>xs:dateTime</code> six components (<code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>minute</code> and <code>second</code>) are required and <code>timezone</code> is optional. For other date/time values, of the first six components, some are required and others must be <a href="https://www.w3.org/TR/xpath-datamodel-31/#dt-absent">absent</a><sup><small>DM31</small></sup>. <code>Timezone</code> is always optional. For example, for <code>xs:date</code>, the <code>year</code>, <code>month</code> and <code>day</code> components are required and <code>hour</code>, <code>minute</code> and <code>second</code> components must be absent; for <code>xs:time</code> the <code>hour</code>, <code>minute</code> and <code>second</code> components are required and <code>year</code>, <code>month</code> and <code>day</code> are missing; for <code>xs:gDay</code>, <code>day</code> is required and <code>year</code>, <code>month</code>, <code>hour</code>, <code>minute</code> and <code>second</code> are missing.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>In <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a>, a new <code>explicitTimezone</code> facet is available with values <code>optional</code>, <code>required</code>, or <code>prohibited</code> to enable the timezone to be defined as mandatory or disallowed.</p></div><p>Values of the date/time datatypes <code>xs:time</code>, <code>xs:gMonthDay</code>, <code>xs:gMonth</code>, and <code>xs:gDay</code>, can be considered to represent a sequence of recurring time instants or time periods. An <code>xs:time</code> occurs every day. An <code>xs:gMonth</code> occurs every year. Comparison operators on these datatypes compare the starting instants of equivalent occurrences in the recurring series. These <code>xs:dateTime</code> values are calculated as described below.</p><p>Comparison operators on <code>xs:date</code>, <code>xs:gYearMonth</code> and <code>xs:gYear</code> compare their starting instants. These <code>xs:dateTime</code> values are calculated as described below.</p><p>The starting instant of an occurrence of a date/time value is an <code>xs:dateTime</code> calculated by filling in the missing components of the local value from a reference <code>xs:dateTime</code>. An example of a suitable reference <code>xs:dateTime</code> is <code>1972-01-01T00:00:00</code>. Then, for example, the starting instant corresponding to the <code>xs:date</code> value <code>2009-03-12</code> is <code>2009-03-12T00:00:00</code>; the starting instant corresponding to the <code>xs:time</code> value <code>13:30:02</code> is <code>1972-01-01T13:30:02</code>; and the starting instant corresponding to the <code>gMonthDay</code> value <code>--02-29</code> is <code>1972-02-29T00:00:00</code> (which explains why a leap year was chosen for the reference).</p><div class="note"><p class="prefix"><b>Note:</b></p><p>In the previous version of this specification, the reference date/time chosen was <code>1972-12-31T00:00:00</code>. While this gives the same results, it produces a "starting instant" for a <code>gMonth</code> or <code>gMonthDay</code> that bears no relation to the ordinary meaning of the term, and it also required special handling of short months. The original choice was made to allow for leap seconds; but since leap seconds are not recognized in date/time arithmetic, this is not actually necessary.</p></div><p>If the <code>xs:time</code> value written as <code>24:00:00</code> is to be compared, filling in the missing components gives <code>1972-01-01T00:00:00</code>, because <code>24:00:00</code> is an alternative representation of <code>00:00:00</code> (the lexical value <code>"24:00:00"</code> is converted to the time components { 0, 0, 0 } before the missing components are filled in). This has the consequence that when ordering <code>xs:time</code> values, <code>24:00:00</code> is considered to be earlier than <code>23:59:59</code>. However, when ordering <code>xs:dateTime</code> values, a time component of <code>24:00:00</code> is considered equivalent to <code>00:00:00</code> on the following day.</p><p>Note that the reference <code>xs:dateTime</code> does not have a timezone. The <code>timezone</code> component is never filled in from the reference <code>xs:dateTime</code>. In some cases, if the date/time value does not have a timezone, the implicit timezone from the dynamic context is used as the timezone.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>This specification uses the reference <code>xs:dateTime 1972-01-01T00:00:00</code> in the description of the comparison operators. Implementations may use other reference <code>xs:dateTime</code> values as long as they yield the same results. The reference <code>xs:dateTime</code> used must meet the following constraints: when it is used to supply components into <code>xs:gMonthDay</code> values, the year must allow for February 29 and so must be a leap year; when it is used to supply missing components into <code>xs:gDay</code> values, the month must allow for 31 days. Different reference <code>xs:dateTime</code> values may be used for different operators.</p></div></div><div class="div2"><h3><a id="component-extraction-dateTime"></a>9.6 <a href="#component-extraction-dateTime" style="text-decoration: none">Extracting components of dates and times</a></h3><p>The date and time datatypes may be considered to be composite datatypes in that they contain distinct properties or components. The extraction functions specified below extract a single component from a date or time value. In all cases the local value (that is, the original value as written, without any timezone adjustment) is used. </p><div class="note"><p class="prefix"><b>Note:</b></p><p>A time written as <code>24:00:00</code> is treated as <code>00:00:00</code> on the following day.</p></div><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-year-from-dateTime"><code>fn:year-from-dateTime</code></a></td><td>Returns the year component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-month-from-dateTime"><code>fn:month-from-dateTime</code></a></td><td>Returns the month component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-day-from-dateTime"><code>fn:day-from-dateTime</code></a></td><td>Returns the day component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-hours-from-dateTime"><code>fn:hours-from-dateTime</code></a></td><td>Returns the hours component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-minutes-from-dateTime"><code>fn:minutes-from-dateTime</code></a></td><td>Returns the minute component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-seconds-from-dateTime"><code>fn:seconds-from-dateTime</code></a></td><td>Returns the seconds component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-timezone-from-dateTime"><code>fn:timezone-from-dateTime</code></a></td><td>Returns the timezone component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-year-from-date"><code>fn:year-from-date</code></a></td><td>Returns the year component of an <code>xs:date</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-month-from-date"><code>fn:month-from-date</code></a></td><td>Returns the month component of an <code>xs:date</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-day-from-date"><code>fn:day-from-date</code></a></td><td>Returns the day component of an <code>xs:date</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-timezone-from-date"><code>fn:timezone-from-date</code></a></td><td>Returns the timezone component of an <code>xs:date</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-hours-from-time"><code>fn:hours-from-time</code></a></td><td>Returns the hours component of an <code>xs:time</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-minutes-from-time"><code>fn:minutes-from-time</code></a></td><td>Returns the minutes component of an <code>xs:time</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-seconds-from-time"><code>fn:seconds-from-time</code></a></td><td>Returns the seconds component of an <code>xs:time</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-timezone-from-time"><code>fn:timezone-from-time</code></a></td><td>Returns the timezone component of an <code>xs:time</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parts-of-dateTime"><code>fn:parts-of-dateTime</code></a></td><td>Returns all the components of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</td></tr></tbody></table><div class="div3"><h4><a id="func-year-from-dateTime"></a>9.6.1 <a href="#func-year-from-dateTime" style="text-decoration: none">fn:year-from-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-month-from-dateTime">next</a> | <a href="#func-unix-dateTime">previous</a>)</p><ol><li><p>The function has been extended to handle other Gregorian types such as <code>xs:gYearMonth</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1448">1448</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1481">1481</a>&nbsp;8 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the year component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:year-from-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:dateTime | xs:date | xs:time | xs:gYear | xs:gYearMonth | xs:gMonth | xs:gMonthDay | xs:gDay)?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, or if the <code>year</code> component is absent, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> representing the year component in <code>$value</code>. The result may be negative.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Ignoring complications that arise with midnight on the last day of the year, the year returned is the same numeric value that appears in the lexical representation, which for negative years means the meaning may vary depending on whether XSD 1.0 or XSD 1.1 conventions are in use.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-dateTime(
  xs:dateTime("1999-05-31T13:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1999</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-dateTime(
  xs:dateTime("1999-05-31T21:30:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1999</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-dateTime(
  xs:dateTime("1999-12-31T19:20:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1999</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-dateTime(
  xs:dateTime("1999-12-31T24:00:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2000</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-dateTime(
  xs:dateTime("-0002-06-06T00:00:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">-2</pre></div><p><em>(The result is the same whether XSD 1.0 or 1.1 is in use, despite the absence of a year 0 in the XSD 1.0 value space.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-dateTime(
  xs:gYearMonth("2007-05Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2007</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-dateTime(
  xs:time("12:30:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-month-from-dateTime"></a>9.6.2 <a href="#func-month-from-dateTime" style="text-decoration: none">fn:month-from-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-day-from-dateTime">next</a> | <a href="#func-year-from-dateTime">previous</a>)</p><ol><li><p>The function has been extended to handle other Gregorian types such as <code>xs:gYearMonth</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1448">1448</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1481">1481</a>&nbsp;8 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the month component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:month-from-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:dateTime | xs:date | xs:time | xs:gYear | xs:gYearMonth | xs:gMonth | xs:gMonthDay | xs:gDay)?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, or if it contains no <code>month</code> component, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> between <code>1</code> and <code>12</code>, both inclusive, representing the month component in <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">month-from-dateTime(
  xs:dateTime("1999-05-31T13:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">5</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">month-from-dateTime(
  xs:dateTime("1999-12-31T19:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">12</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">month-from-dateTime(
  adjust-dateTime-to-timezone(
    xs:dateTime("1999-12-31T19:20:00-05:00"),
    xs:dayTimeDuration("PT0S")
  )
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">month-from-dateTime(
  xs:gYearMonth("2007-05Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">5</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">month-from-dateTime(
  xs:time("12:30:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-day-from-dateTime"></a>9.6.3 <a href="#func-day-from-dateTime" style="text-decoration: none">fn:day-from-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-hours-from-dateTime">next</a> | <a href="#func-month-from-dateTime">previous</a>)</p><ol><li><p>The function has been extended to handle other Gregorian types such as <code>xs:gMonthDay</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1448">1448</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1481">1481</a>&nbsp;8 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the day component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:day-from-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:dateTime | xs:date | xs:time | xs:gYear | xs:gYearMonth | xs:gMonth | xs:gMonthDay | xs:gDay)?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, or if it contains no <code>day</code> component, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> between <code>1</code> and <code>31</code>, both inclusive, representing the day component in the local value of <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">day-from-dateTime(
  xs:dateTime("1999-05-31T13:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">31</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">day-from-dateTime(
  xs:dateTime("1999-12-31T20:00:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">31</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">day-from-dateTime(
  adjust-dateTime-to-timezone(
    xs:dateTime("1999-12-31T19:20:00-05:00"),
    xs:dayTimeDuration("PT0S")
  )
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">day-from-dateTime(
  xs:gMonthDay("--05-31Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">31</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">day-from-dateTime(
  xs:time("12:30:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-hours-from-dateTime"></a>9.6.4 <a href="#func-hours-from-dateTime" style="text-decoration: none">fn:hours-from-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-minutes-from-dateTime">next</a> | <a href="#func-day-from-dateTime">previous</a>)</p><ol><li><p>The function has been extended to handle other types including <code>xs:time</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1448">1448</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1481">1481</a>&nbsp;8 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the hours component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:hours-from-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:dateTime | xs:date | xs:time | xs:gYear | xs:gYearMonth | xs:gMonth | xs:gMonthDay | xs:gDay)?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, or if it contains no <code>hours</code> component, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> between <code>0</code> and <code>23</code>, both inclusive, representing the hours component in <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-dateTime(
  xs:dateTime("1999-05-31T08:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">8</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-dateTime(
  xs:dateTime("1999-12-31T21:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">21</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">hours-from-dateTime(
  adjust-dateTime-to-timezone(
    xs:dateTime("1999-12-31T21:20:00-05:00"),
    xs:dayTimeDuration("PT0S")
  )
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-dateTime(
  xs:dateTime("1999-12-31T12:00:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">12</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-dateTime(
  xs:dateTime("1999-12-31T24:00:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">0</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-dateTime(
  xs:gYearMonth("2007-05Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">hours-from-dateTime(
  xs:time("12:30:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">12</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-minutes-from-dateTime"></a>9.6.5 <a href="#func-minutes-from-dateTime" style="text-decoration: none">fn:minutes-from-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-timezone-from-dateTime">next</a> | <a href="#func-hours-from-dateTime">previous</a>)</p><ol><li><p>The function has been extended to handle other types including <code>xs:time</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1448">1448</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1481">1481</a>&nbsp;8 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the minute component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:minutes-from-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:dateTime | xs:date | xs:time | xs:gYear | xs:gYearMonth | xs:gMonth | xs:gMonthDay | xs:gDay)?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, or if it contains no <code>minutes</code> component, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> value between <code>0</code> and <code>59</code>, both inclusive, representing the minute component in the local value of <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">minutes-from-dateTime(
  xs:dateTime("1999-05-31T13:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">20</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">minutes-from-dateTime(
  xs:dateTime("1999-05-31T13:30:00+05:30")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">30</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">minutes-from-dateTime(
  xs:gYearMonth("2007-05Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">minutes-from-dateTime(
  xs:time("12:30:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">30</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-seconds-from-dateTime"></a>9.6.6 <a href="#func-seconds-from-dateTime" style="text-decoration: none">fn:seconds-from-dateTime</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the seconds component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:seconds-from-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:dateTime | xs:date | xs:time | xs:gYear | xs:gYearMonth | xs:gMonth | xs:gMonthDay | xs:gDay)?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:decimal?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, or if it contains no <code>seconds</code> component, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:decimal</code> value greater than or equal to zero and less than 60, representing the seconds and fractional seconds in <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds-from-dateTime(
  xs:dateTime("1999-05-31T13:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">0</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds-from-dateTime(
  xs:gYearMonth("2007-05Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">seconds-from-dateTime(
  xs:time("12:30:14.5")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">14.5</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-timezone-from-dateTime"></a>9.6.7 <a href="#func-timezone-from-dateTime" style="text-decoration: none">fn:timezone-from-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-parts-of-dateTime">next</a> | <a href="#func-minutes-from-dateTime">previous</a>)</p><ol><li><p>The function has been extended to handle other types such as <code>xs:gYearMonth</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1448">1448</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1481">1481</a>&nbsp;8 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the timezone component of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:timezone-from-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:dateTime | xs:date | xs:time | xs:gYear | xs:gYearMonth | xs:gMonth | xs:gMonthDay | xs:gDay)?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns the timezone component of <code>$value</code>, if any. If <code>$value</code> has a timezone component, then the result is an <code>xs:dayTimeDuration</code> that indicates deviation from UTC; its value may range from +14:00 to -14:00 hours, both inclusive. If <code>$value</code> has no timezone component, the result is the empty sequence.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">timezone-from-dateTime(
  xs:dateTime("1999-05-31T13:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("-PT5H")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">timezone-from-dateTime(
  xs:dateTime("2000-06-12T13:20:00Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("PT0S")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">timezone-from-dateTime(
  xs:dateTime("2004-08-27T00:00:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">timezone-from-dateTime(
  xs:gYearMonth("2007-05Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("PT0S")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">timezone-from-dateTime(
  xs:time("12:30:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-year-from-date"></a>9.6.8 <a href="#func-year-from-date" style="text-decoration: none">fn:year-from-date</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the year component of an <code>xs:date</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:year-from-date</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> representing the year in the local value of <code>$value</code>. The value may be negative. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The year returned is the same numeric value that appears in the lexical representation, which for negative years means the meaning may vary depending on whether XSD 1.0 or XSD 1.1 conventions are in use.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-date(
  xs:date("1999-05-31")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1999</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-date(
  xs:date("2000-01-01+05:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2000</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">year-from-date(
  xs:date("-0002-06-01")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">-2</pre></div><p><em>(The result is the same whether XSD 1.0 or 1.1 is in use, despite the absence of a year 0 in the XSD 1.0 value space.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-month-from-date"></a>9.6.9 <a href="#func-month-from-date" style="text-decoration: none">fn:month-from-date</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the month component of an <code>xs:date</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:month-from-date</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> between <code>1</code> and <code>12</code>, both inclusive, representing the month component in the local value of <code>$value</code>. </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">month-from-date(
  xs:date("1999-05-31-05:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">5</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">month-from-date(
  xs:date("2000-01-01+05:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-day-from-date"></a>9.6.10 <a href="#func-day-from-date" style="text-decoration: none">fn:day-from-date</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the day component of an <code>xs:date</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:day-from-date</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> between <code>1</code> and <code>31</code>, both inclusive, representing the day component in the localized value of <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">day-from-date(
  xs:date("1999-05-31-05:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">31</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">day-from-date(
  xs:date("2000-01-01+05:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-timezone-from-date"></a>9.6.11 <a href="#func-timezone-from-date" style="text-decoration: none">fn:timezone-from-date</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the timezone component of an <code>xs:date</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:timezone-from-date</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns the timezone component of <code>$value</code>, if any. If <code>$value</code> has a timezone component, then the result is an <code>xs:dayTimeDuration</code> that indicates deviation from UTC; its value may range from +14:00 to -14:00 hours, both inclusive. If <code>$value</code> has no timezone component, the result is the empty sequence.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">timezone-from-date(
  xs:date("1999-05-31-05:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("-PT5H")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">timezone-from-date(
  xs:date("2000-06-12Z")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("PT0S")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-hours-from-time"></a>9.6.12 <a href="#func-hours-from-time" style="text-decoration: none">fn:hours-from-time</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the hours component of an <code>xs:time</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:hours-from-time</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> between <code>0</code> and <code>23</code>, both inclusive, representing the value of the hours component in the local value of <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>Assume that the dynamic context provides an implicit timezone value of <code>-05:00</code>. </p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>hours-from-time(xs:time("11:23:00"))</code></pre></div></td><td style="vertical-align:top"><p><code>11</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>hours-from-time(xs:time("21:23:00"))</code></pre></div></td><td style="vertical-align:top"><p><code>21</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>hours-from-time(xs:time("01:23:00+05:00"))</code></pre></div></td><td style="vertical-align:top"><p><code>1</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">hours-from-time(
  adjust-time-to-timezone(
    xs:time("01:23:00+05:00"),
    xs:dayTimeDuration("PT0S")
  )
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">20</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>hours-from-time(xs:time("24:00:00"))</code></pre></div></td><td style="vertical-align:top"><p><code>0</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-minutes-from-time"></a>9.6.13 <a href="#func-minutes-from-time" style="text-decoration: none">fn:minutes-from-time</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the minutes component of an <code>xs:time</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:minutes-from-time</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:integer</code> value between <code>0</code> and <code>59</code>, both inclusive, representing the value of the minutes component in the local value of <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>minutes-from-time(xs:time("13:00:00Z"))</code></pre></div></td><td style="vertical-align:top"><p><code>0</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-seconds-from-time"></a>9.6.14 <a href="#func-seconds-from-time" style="text-decoration: none">fn:seconds-from-time</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the seconds component of an <code>xs:time</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:seconds-from-time</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:decimal?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:decimal</code> value greater than or equal to zero and less than 60, representing the seconds and fractional seconds in the local value of <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>seconds-from-time(xs:time("13:20:10.5"))</code></pre></div></td><td style="vertical-align:top"><p><code>10.5</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-timezone-from-time"></a>9.6.15 <a href="#func-timezone-from-time" style="text-decoration: none">fn:timezone-from-time</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the timezone component of an <code>xs:time</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:timezone-from-time</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns the timezone component of <code>$value</code>, if any. If <code>$value</code> has a timezone component, then the result is an <code>xs:dayTimeDuration</code> that indicates deviation from UTC; its value may range from +14:00 to -14:00 hours, both inclusive. If <code>$value</code> has no timezone component, the result is the empty sequence.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>timezone-from-time(xs:time("13:20:00-05:00"))</code></pre></div></td><td style="vertical-align:top"><p><code>xs:dayTimeDuration("-PT5H")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>timezone-from-time(xs:time("13:20:00"))</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-parts-of-dateTime"></a>9.6.16 <a href="#func-parts-of-dateTime" style="text-decoration: none">fn:parts-of-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-civil-timezone">next</a> | <a href="#func-timezone-from-dateTime">previous</a>)</p><ol><li><p>New in 4.0</p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns all the components of a <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parts-of-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:dateTime | xs:date | xs:time | xs:gYear | xs:gYearMonth | xs:gMonth | xs:gMonthDay | xs:gDay)?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code class="return-type-ref"><a href="#dateTime-record">dateTime-record</a>?</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns a record whose fields are as follows. All entries will be present, even when the value is an empty sequence.</p><table><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody><tr><td><code>year</code></td><td>The value of <code>fn:year-from-dateTime($value)</code></td></tr><tr><td><code>month</code></td><td>The value of <code>fn:month-from-dateTime($value)</code></td></tr><tr><td><code>day</code></td><td>The value of <code>fn:day-from-dateTime($value)</code></td></tr><tr><td><code>hours</code></td><td>The value of <code>fn:hours-from-dateTime($value)</code></td></tr><tr><td><code>minutes</code></td><td>The value of <code>fn:minutes-from-dateTime($value)</code></td></tr><tr><td><code>seconds</code></td><td>The value of <code>fn:seconds-from-dateTime($value)</code></td></tr><tr><td><code>timezone</code></td><td>The value of <code>fn:timezone-from-dateTime($value)</code></td></tr></tbody></table></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parts-of-dateTime(
  xs:dateTime("1999-05-31T13:20:00-05:00")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ "year": 1999, "month": 5, "day": 31, 
  "hours": 13, "minutes": 20, "seconds": 0, 
  "timezone": xs:dayTimeDuration("-PT5H") }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parts-of-dateTime(
  xs:time("13:30:04.2678")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ "year": (), "month": (), "day": (), 
  "hours": 13, "minutes": 30, "seconds": 4.2678, 
  "timezone": () }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parts-of-dateTime(
  xs:gYearMonth("2007-05Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ "year": 2007, "month": 5, "day": (), 
  "hours": (), "minutes": (), "seconds": (), 
  "timezone": xs:dayTimeDuration("-PT0S") }</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="timezone.functions"></a>9.7 <a href="#timezone.functions" style="text-decoration: none">Adjusting timezones on dates and times</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-adjust-dateTime-to-timezone"><code>fn:adjust-dateTime-to-timezone</code></a></td><td>Adjusts an <code>xs:dateTime</code> value to a specific timezone, or to no timezone at all.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-adjust-date-to-timezone"><code>fn:adjust-date-to-timezone</code></a></td><td>Adjusts an <code>xs:date</code> value to a specific timezone, or to no timezone at all; the result is the date in the target timezone that contains the starting instant of the supplied date.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-adjust-time-to-timezone"><code>fn:adjust-time-to-timezone</code></a></td><td>Adjusts an <code>xs:time</code> value to a specific timezone, or to no timezone at all.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-civil-timezone"><code>fn:civil-timezone</code></a></td><td>Returns the timezone offset from UTC that is in conventional use at a given place and time.</td></tr></tbody></table><p>These functions adjust the timezone component of an <code>xs:dateTime</code>, <code>xs:date</code> or <code>xs:time</code> value. The <code>$timezone</code> argument to these functions is defined as an <code>xs:dayTimeDuration</code> but must be a valid timezone value.</p><div class="div3"><h4><a id="func-adjust-dateTime-to-timezone"></a>9.7.1 <a href="#func-adjust-dateTime-to-timezone" style="text-decoration: none">fn:adjust-dateTime-to-timezone</a></h4><dl><dt class="label">Summary</dt><dd><p>Adjusts an <code>xs:dateTime</code> value to a specific timezone, or to no timezone at all.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:adjust-dateTime-to-timezone</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dateTime?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$timezone</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:implicit-timezone()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTime?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p> If <code>$timezone</code> is not specified, then the effective value of <code>$timezone</code> is the value of the implicit timezone in the dynamic context.</p><p> If <code>$value</code> is the empty sequence, then the function returns the empty sequence.</p><p> If <code>$value</code> does not have a timezone component and <code>$timezone</code> is the empty sequence, then the result is <code>$value</code>.</p><p> If <code>$value</code> does not have a timezone component and <code>$timezone</code> is not the empty sequence, then the result is <code>$value</code> with <code>$timezone</code> as the timezone component.</p><p> If <code>$value</code> has a timezone component and <code>$timezone</code> is the empty sequence, then the result is the local value of <code>$value</code> without its timezone component.</p><p> If <code>$value</code> has a timezone component and <code>$timezone</code> is not the empty sequence, then the result is the <code>xs:dateTime</code> value that is equal to <code>$value</code> and that has a timezone component equal to <code>$timezone</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p> A dynamic error is raised [<a href="#ERRFODT0003" title="err:FODT0003">err:FODT0003</a>] if <code>$timezone</code> is less than <code>-PT14H</code> or greater than <code>PT14H</code> or is not an integral number of minutes.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $tz-10 := xs:dayTimeDuration("-PT10H")</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr><td colspan="2"><p> Assume the dynamic context provides an implicit timezone of <code>-05:00 (-PT5H0M)</code>.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-dateTime-to-timezone(
  xs:dateTime('2002-03-07T10:00:00')
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2002-03-07T10:00:00-05:00')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-dateTime-to-timezone(
  xs:dateTime('2002-03-07T10:00:00-07:00')
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2002-03-07T12:00:00-05:00')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-dateTime-to-timezone(
  xs:dateTime('2002-03-07T10:00:00'),
  $tz-10
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2002-03-07T10:00:00-10:00')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-dateTime-to-timezone(
  xs:dateTime('2002-03-07T10:00:00-07:00'),
  $tz-10
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2002-03-07T07:00:00-10:00')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">adjust-dateTime-to-timezone(
  xs:dateTime('2002-03-07T10:00:00-07:00'),
  xs:dayTimeDuration("PT10H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2002-03-08T03:00:00+10:00')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">adjust-dateTime-to-timezone(
  xs:dateTime('2002-03-07T00:00:00+01:00'),
  xs:dayTimeDuration("-PT8H")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2002-03-06T15:00:00-08:00')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-dateTime-to-timezone(
  xs:dateTime('2002-03-07T10:00:00'),
  ()
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2002-03-07T10:00:00')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-dateTime-to-timezone(
  xs:dateTime('2002-03-07T10:00:00-07:00'),
  ()
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime('2002-03-07T10:00:00')</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-adjust-date-to-timezone"></a>9.7.2 <a href="#func-adjust-date-to-timezone" style="text-decoration: none">fn:adjust-date-to-timezone</a></h4><dl><dt class="label">Summary</dt><dd><p>Adjusts an <code>xs:date</code> value to a specific timezone, or to no timezone at all; the result is the date in the target timezone that contains the starting instant of the supplied date.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:adjust-date-to-timezone</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$timezone</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:implicit-timezone()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:date?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p> If <code>$timezone</code> is not specified, then the effective value of <code>$timezone</code> is the value of the implicit timezone in the dynamic context.</p><p> If <code>$value</code> is the empty sequence, then the function returns the empty sequence.</p><p> If <code>$value</code> does not have a timezone component and <code>$timezone</code> is the empty sequence, then the result is <code>$value</code>.</p><p> If <code>$value</code> does not have a timezone component and <code>$timezone</code> is not the empty sequence, then the result is <code>$value</code> with <code>$timezone</code> as the timezone component.</p><p> If <code>$value</code> has a timezone component and <code>$timezone</code> is the empty sequence, then the result is the local value of <code>$value</code> without its timezone component.</p><p> If <code>$value</code> has a timezone component and <code>$timezone</code> is not the empty sequence, then:</p><ul><li><p>Let <code>$dt</code> be the value of <code>fn:dateTime($arg, xs:time('00:00:00'))</code>.</p></li><li><p>Let <code>$adt</code> be the value of <code>fn:adjust-dateTime-to-timezone($dt, $timezone)</code></p></li><li><p>The function returns the value of <code>xs:date($adt)</code></p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODT0003" title="err:FODT0003">err:FODT0003</a>] if <code>$timezone</code> is less than <code>-PT14H</code> or greater than <code>PT14H</code> or is not an integral number of minutes.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $tz-10 := xs:dayTimeDuration("-PT10H")</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>Assume the dynamic context provides an implicit timezone of <code>-05:00 (-PT5H0M)</code>.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-date-to-timezone(
  xs:date("2002-03-07")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("2002-03-07-05:00")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-date-to-timezone(
  xs:date("2002-03-07-07:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("2002-03-07-05:00")</pre></div><p><em>(<code>$value</code> is converted to <code>xs:dateTime("2002-03-07T00:00:00-07:00")</code>. This is adjusted to the implicit timezone, giving <code>"2002-03-07T02:00:00-05:00"</code>. ).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-date-to-timezone(
  xs:date("2002-03-07"),
  $tz-10
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("2002-03-07-10:00")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-date-to-timezone(
  xs:date("2002-03-07-07:00"),
  $tz-10
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("2002-03-06-10:00")</pre></div><p><em>(<code>$value</code> is converted to <code>xs:dateTime("2002-03-07T00:00:00-07:00")</code>. This is adjusted to the given timezone, giving <code>"2002-03-06T21:00:00-10:00"</code>. ).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-date-to-timezone(
  xs:date("2002-03-07"),
  ()
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("2002-03-07")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-date-to-timezone(
  xs:date("2002-03-07-07:00"),
  ()
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("2002-03-07")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-adjust-time-to-timezone"></a>9.7.3 <a href="#func-adjust-time-to-timezone" style="text-decoration: none">fn:adjust-time-to-timezone</a></h4><dl><dt class="label">Summary</dt><dd><p>Adjusts an <code>xs:time</code> value to a specific timezone, or to no timezone at all.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:adjust-time-to-timezone</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$timezone</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:implicit-timezone()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:time?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p> If <code>$timezone</code> is not specified, then the effective value of <code>$timezone</code> is the value of the implicit timezone in the dynamic context.</p><p> If <code>$value</code> is the empty sequence, then the function returns the empty sequence.</p><p> If <code>$value</code> does not have a timezone component and <code>$timezone</code> is the empty sequence, then the result is <code>$value</code>.</p><p> If <code>$value</code> does not have a timezone component and <code>$timezone</code> is not the empty sequence, then the result is <code>$value</code> with <code>$timezone</code> as the timezone component.</p><p> If <code>$value</code> has a timezone component and <code>$timezone</code> is the empty sequence, then the result is the localized value of <code>$value</code> without its timezone component.</p><p> If <code>$value</code> has a timezone component and <code>$timezone</code> is not the empty sequence, then:</p><ul><li><p>Let <code>$dt</code> be the <code>xs:dateTime</code> value <code>fn:dateTime(xs:date('1972-12-31'), $value)</code>.</p></li><li><p>Let <code>$adt</code> be the value of <code>fn:adjust-dateTime-to-timezone($dt, $timezone)</code></p></li><li><p>The function returns the <code>xs:time</code> value <code>xs:time($adt)</code>.</p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODT0003" title="err:FODT0003">err:FODT0003</a>] if <code>$timezone</code> is less than <code>-PT14H</code> or greater than <code>PT14H</code> or if does not contain an integral number of minutes.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $tz-10 := xs:dayTimeDuration("-PT10H")</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>Assume the dynamic context provides an implicit timezone of <code>-05:00 (-PT5H0M)</code>.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-time-to-timezone(
  xs:time("10:00:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("10:00:00-05:00")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-time-to-timezone(
  xs:time("10:00:00-07:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("12:00:00-05:00")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-time-to-timezone(
  xs:time("10:00:00"),
  $tz-10
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("10:00:00-10:00")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-time-to-timezone(
  xs:time("10:00:00-07:00"),
  $tz-10
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("07:00:00-10:00")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-time-to-timezone(
  xs:time("10:00:00"),
  ()
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("10:00:00")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-time-to-timezone(
  xs:time("10:00:00-07:00"),
  ()
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("10:00:00")</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">adjust-time-to-timezone(
  xs:time("10:00:00-07:00"),
  xs:dayTimeDuration("PT10H")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("03:00:00+10:00")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-civil-timezone"></a>9.7.4 <a href="#func-civil-timezone" style="text-decoration: none">fn:civil-timezone</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-format-dateTime">next</a> | <a href="#func-parts-of-dateTime">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1539">1539</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1545">1545</a>&nbsp;5 November 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the timezone offset from UTC that is in conventional use at a given place and time.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:civil-timezone</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dateTime</code></code>,</td><td></td></tr><tr class="arg"><td><code>$place</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on default place. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>This function uses a database of civil timezones (including daylight savings time) to return the timezone offset for a given date/time and place. For example, the timezone offset for New York on 31 December 2024 would be <code>-PT5H</code>.</p><p>If the <code>$place</code> argument is omitted or empty then the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-default-place">default place</a><sup><small>XP</small></sup> from the dynamic context is used.</p><p>If the supplied <code>$value</code> has no timezone then the implicit timezone from the dynamic context is used. This is unrelated to the timezone applicable to the requested <code>$place</code>.</p><p>The intended use of the <code>$place</code> argument is to identify the place where an event represented by the <code>$value</code> argument took place or will take place. The value must be an IANA timezone name as defined in the IANA timezone database <a href="#olson">[IANA Timezone Database]</a>. Examples are <code>"America/New_York"</code> and <code>"Europe/Rome"</code>.</p><p>The result of the function is the civil timezone offset applicable to the given date/time and place, as determined by the IANA timezone database or an alternative authoritative source.</p></dd><dt class="label">Error Conditions</dt><dd><p> A dynamic error is raised [<a href="#ERRFODT0004" title="err:FODT0004">err:FODT0004</a>] if no timezone information is available for the given date/time and place. This includes the case where the given place is not present in the timezone database, and also the case where the information available for that place does not cover a sufficient range of dates.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">civil-timezone(
  xs:dateTime('2024-12-31T23:59:59'), 'America/New_York')</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('-PT5H')</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">civil-timezone(
  xs:dateTime('2024-06-30T23:59:59'), 'America/New_York')</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration('-PT4H')</pre></div></td></tr><tr><td colspan="2"><p>The expression:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">adjust-dateTime-to-timezone(
  current-dateTime(),
  civil-timezone(current-dateTime(), 'America/New_York')
)</pre></div></td></tr><tr><td colspan="2"><p>returns the current civil date and time in New York.</p></td></tr><tr><td colspan="2"><p>If the default place is a location in the same timezone as (say) Paris, then the expression</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">civil-timezone(xs:dateTime('2024-07-01T09:00:00'))</pre></div></td></tr><tr><td colspan="2"><p>returns PT2H.</p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="dateTime-arithmetic"></a>9.8 <a href="#dateTime-arithmetic" style="text-decoration: none">Arithmetic operators on durations, dates, and times</a></h3><p>These functions support adding or subtracting a duration value to or from an <code>xs:dateTime</code>, an <code>xs:date</code> or an <code>xs:time</code> value. Appendix E of <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> describes an algorithm for performing such operations.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-dateTimes"><code>op:subtract-dateTimes</code></a></td><td>Returns an <code>xs:dayTimeDuration</code> representing the amount of elapsed time between the instants <code>arg2</code> and <code>arg1</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-dates"><code>op:subtract-dates</code></a></td><td>Returns the <code>xs:dayTimeDuration</code> that corresponds to the elapsed time between the starting instant of <code>$arg2</code> and the starting instant of <code>$arg2</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-times"><code>op:subtract-times</code></a></td><td>Returns the <code>xs:dayTimeDuration</code> that corresponds to the elapsed time between the values of <code>$arg2</code> and <code>$arg1</code> treated as times on the same date.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-add-yearMonthDuration-to-dateTime"><code>op:add-yearMonthDuration-to-dateTime</code></a></td><td>Returns the <code>xs:dateTime</code> that is a given duration after a specified <code>xs:dateTime</code> (or before, if the duration is negative).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-add-dayTimeDuration-to-dateTime"><code>op:add-dayTimeDuration-to-dateTime</code></a></td><td>Returns the <code>xs:dateTime</code> that is a given duration after a specified <code>xs:dateTime</code> (or before, if the duration is negative).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-yearMonthDuration-from-dateTime"><code>op:subtract-yearMonthDuration-from-dateTime</code></a></td><td>Returns the <code>xs:dateTime</code> that is a given duration before a specified <code>xs:dateTime</code> (or after, if the duration is negative).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-dayTimeDuration-from-dateTime"><code>op:subtract-dayTimeDuration-from-dateTime</code></a></td><td>Returns the <code>xs:dateTime</code> that is a given duration before a specified <code>xs:dateTime</code> (or after, if the duration is negative).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-add-yearMonthDuration-to-date"><code>op:add-yearMonthDuration-to-date</code></a></td><td>Returns the <code>xs:date</code> that is a given duration after a specified <code>xs:date</code> (or before, if the duration is negative).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-add-dayTimeDuration-to-date"><code>op:add-dayTimeDuration-to-date</code></a></td><td>Returns the <code>xs:date</code> that is a given duration after a specified <code>xs:date</code> (or before, if the duration is negative).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-yearMonthDuration-from-date"><code>op:subtract-yearMonthDuration-from-date</code></a></td><td>Returns the <code>xs:date</code> that is a given duration before a specified <code>xs:date</code> (or after, if the duration is negative).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-dayTimeDuration-from-date"><code>op:subtract-dayTimeDuration-from-date</code></a></td><td>Returns the <code>xs:date</code> that is a given duration before a specified <code>xs:date</code> (or after, if the duration is negative).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-add-dayTimeDuration-to-time"><code>op:add-dayTimeDuration-to-time</code></a></td><td>Returns the <code>xs:time</code> value that is a given duration after a specified <code>xs:time</code> (or before, if the duration is negative or causes wrap-around past midnight)</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-subtract-dayTimeDuration-from-time"><code>op:subtract-dayTimeDuration-from-time</code></a></td><td>Returns the <code>xs:time</code> value that is a given duration before a specified <code>xs:time</code> (or after, if the duration is negative or causes wrap-around past midnight)</td></tr></tbody></table><div class="div3"><h4><a id="duration-limits"></a>9.8.1 <a href="#duration-limits" style="text-decoration: none">Limits and precision</a></h4><p>A processor that limits the number of digits in date and time datatype representations may encounter overflow and underflow conditions when it tries to execute the functions in this section. In these situations, the processor <span class="verb">must</span> return P0M or PT0S in case of duration underflow and 00:00:00 in case of time underflow. It <span class="verb">must</span> raise a dynamic error [<a href="#ERRFODT0001" title="err:FODT0001">err:FODT0001</a>] in case of overflow.</p><p>The value spaces of the two totally ordered subtypes of <code>xs:duration</code> described in <a href="#duration-subtypes"><b>8.1.1 Subtypes of duration</b></a> are <code>xs:integer</code> months for <code>xs:yearMonthDuration</code> and <code>xs:decimal</code> seconds for <code>xs:dayTimeDuration</code>. If a processor limits the number of digits allowed in the representation of <code>xs:integer</code> and <code>xs:decimal</code> then overflow and underflow situations can arise when it tries to execute the functions in <a href="#duration-arithmetic"><b>8.5 Arithmetic operators on durations</b></a>. In these situations the processor <span class="verb">must</span> return zero in case of numeric underflow and P0M or PT0S in case of duration underflow. It <span class="verb">must</span> raise a dynamic error [<a href="#ERRFODT0002" title="err:FODT0002">err:FODT0002</a>] in case of overflow.</p></div><div class="div3"><h4><a id="func-subtract-dateTimes"></a>9.8.2 <a href="#func-subtract-dateTimes" style="text-decoration: none">op:subtract-dateTimes</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an <code>xs:dayTimeDuration</code> representing the amount of elapsed time between the instants <code>arg2</code> and <code>arg1</code>.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to two <code>xs:dateTime</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-dateTimes</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dateTime</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dateTime</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>If either <code>$arg1</code> or <code>$arg2</code> do not contain an explicit timezone then, for the purpose of the operation, the implicit timezone provided by the dynamic context (See <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>.) is assumed to be present as part of the value.</p><p>The function returns the elapsed time between the date/time instant <code>arg2</code> and the date/time instant <code>arg1</code>, computed according to the algorithm given in Appendix E of <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, and expressed as a <code>xs:dayTimeDuration</code>.</p><p>If the normalized value of <code>$arg1</code> precedes in time the normalized value of <code>$arg2</code>, then the returned value is a negative duration.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>Assume that the dynamic context provides an implicit timezone value of <code>-05:00</code>.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-dateTimes(
  xs:dateTime("2000-10-30T06:12:00"),
  xs:dateTime("1999-11-28T09:00:00Z")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("P337DT2H12M")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subtract-dates"></a>9.8.3 <a href="#func-subtract-dates" style="text-decoration: none">op:subtract-dates</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:dayTimeDuration</code> that corresponds to the elapsed time between the starting instant of <code>$arg2</code> and the starting instant of <code>$arg2</code>.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to two <code>xs:date</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-dates</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>If either <code>$arg1</code> or <code>$arg2</code> do not contain an explicit timezone then, for the purpose of the operation, the implicit timezone provided by the dynamic context (See <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>.) is assumed to be present as part of the value.</p><p>The starting instant of an <code>xs:date</code> is the <code>xs:dateTime</code> at <code>00:00:00</code> on that date. </p><p>The function returns the result of subtracting the two starting instants using <a href="#func-subtract-dateTimes"><code>op:subtract-dateTimes</code></a>.</p><p>If the starting instant of <code>$arg1</code> precedes in time the starting instant of <code>$arg2</code>, then the returned value is a negative duration.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>Assume that the dynamic context provides an implicit timezone value of <code>Z</code>. </p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-dates(
  xs:date("2000-10-30"),
  xs:date("1999-11-28")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("P337D")</pre></div><p><em>(The normalized values of the two starting instants are <code>{ 2000, 10, 30, 0, 0, 0, xs:dayTimeDuration("PT0S") }</code> and <code>{ 1999, 11, 28, 0, 0, 0, xs:dayTimeDuration("PT0S") }</code>.)</em></p></td></tr><tr><td colspan="2"><p>Now assume that the dynamic context provides an implicit timezone value of <code>+05:00</code>.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-dates(
  xs:date("2000-10-30"),
  xs:date("1999-11-28Z")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("P336DT19H")</pre></div><p><em>( The normalized values of the two starting instants are <code>{ 2000, 10, 29, 19, 0, 0, xs:dayTimeDuration("PT0S") }</code> and <code>{ 1999, 11, 28, 0, 0, 0, xs:dayTimeDuration("PT0S") }</code>.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-dates(
  xs:date("2000-10-15-05:00"),
  xs:date("2000-10-10+02:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("P5DT7H")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subtract-times"></a>9.8.4 <a href="#func-subtract-times" style="text-decoration: none">op:subtract-times</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:dayTimeDuration</code> that corresponds to the elapsed time between the values of <code>$arg2</code> and <code>$arg1</code> treated as times on the same date.</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to two <code>xs:time</code> values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-times</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the result of the expression:</p><div class="exampleInner"><pre xml:space="preserve" class="small">op-subtract-dateTimes(
        dateTime(xs:date('1972-12-31'), $arg1),
        dateTime(xs:date('1972-12-31'), $arg2))</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>Any other reference date would work equally well.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td colspan="2"><p>Assume that the dynamic context provides an implicit timezone value of <code>-05:00</code>. Assume, also, that the date components of the reference <code>xs:dateTime</code> correspond to <code>"1972-12-31"</code>.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-times(
  xs:time("11:12:00Z"),
  xs:time("04:00:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("PT2H12M")</pre></div><p><em>(This is obtained by subtracting from the <code>xs:dateTime</code> value <code>{ 1972, 12, 31, 11, 12, 0, xs:dayTimeDuration("PT0S") }</code> the <code>xs:dateTime</code> value <code>{ 1972, 12, 31, 9, 0, 0, xs:dayTimeDuration("PT0S") }</code>.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-times(
  xs:time("11:00:00-05:00"),
  xs:time("21:30:00+05:30")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("PT0S")</pre></div><p><em>(The two <code>xs:dateTime</code> values are <code>{ 1972, 12, 31, 11, 0, 0, xs:dayTimeDuration("-PT5H") }</code> and <code>{ 1972, 12, 31, 21, 30, 0, xs:dayTimeDuration("PT5H30M") }</code>. These normalize to <code>{ 1972, 12, 31, 16, 0, 0, xs:dayTimeDuration("PT0S") }</code> and <code>{ 1972, 12, 31, 16, 0, 0, xs:dayTimeDuration("PT0S") }</code>. ).</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-times(
  xs:time("17:00:00-06:00"),
  xs:time("08:00:00+09:00")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("P1D")</pre></div><p><em>(The two normalized <code>xs:dateTime</code> values are <code>{ 1972, 12, 31, 23, 0, 0, xs:dayTimeDuration("PT0S") }</code> and <code>{ 1972, 12, 30, 23, 0, 0, xs:dayTimeDuration("PT0S") }</code>.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-times(
  xs:time("24:00:00"),
  xs:time("23:59:59")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dayTimeDuration("-PT23H59M59S")</pre></div><p><em>(The two normalized <code>xs:dateTime</code> values are <code>{ 1972, 12, 31, 0, 0, 0, () }</code> and <code>{ 1972, 12, 31, 23, 59, 59.0, () }</code>.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-add-yearMonthDuration-to-dateTime"></a>9.8.5 <a href="#func-add-yearMonthDuration-to-dateTime" style="text-decoration: none">op:add-yearMonthDuration-to-dateTime</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:dateTime</code> that is a given duration after a specified <code>xs:dateTime</code> (or before, if the duration is negative).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>+</code> operator when applied to an <code>xs:dateTime</code> and an <code>xs:yearMonthDuration</code> value. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:add-yearMonthDuration-to-dateTime</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dateTime</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTime</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the result of adding <code>$arg2</code> to the value of <code>$arg1</code> using the algorithm described in Appendix E of <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, disregarding the rule about leap seconds. If <code>$arg2</code> is negative, then the result <code>xs:dateTime</code> precedes <code>$arg1</code>.</p><p>The result has the same timezone as <code>$arg1</code>. If <code>$arg1</code> has no timezone, the result has no timezone. </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">op:add-yearMonthDuration-to-dateTime(
  xs:dateTime("2000-10-30T11:12:00"),
  xs:yearMonthDuration("P1Y2M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime("2001-12-30T11:12:00")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-add-dayTimeDuration-to-dateTime"></a>9.8.6 <a href="#func-add-dayTimeDuration-to-dateTime" style="text-decoration: none">op:add-dayTimeDuration-to-dateTime</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:dateTime</code> that is a given duration after a specified <code>xs:dateTime</code> (or before, if the duration is negative).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>+</code> operator when applied to an <code>xs:dateTime</code> and an <code>xs:dayTimeDuration</code> value. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:add-dayTimeDuration-to-dateTime</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dateTime</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTime</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the result of adding <code>$arg2</code> to the value of <code>$arg1</code> using the algorithm described in Appendix E of <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, disregarding the rule about leap seconds. If <code>$arg2</code> is negative, then the result <code>xs:dateTime</code> precedes <code>$arg1</code>.</p><p>The result has the same timezone as <code>$arg1</code>. If <code>$arg1</code> has no timezone, the result has no timezone. </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">op:add-dayTimeDuration-to-dateTime(
  xs:dateTime("2000-10-30T11:12:00"),
  xs:dayTimeDuration("P3DT1H15M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime("2000-11-02T12:27:00")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subtract-yearMonthDuration-from-dateTime"></a>9.8.7 <a href="#func-subtract-yearMonthDuration-from-dateTime" style="text-decoration: none">op:subtract-yearMonthDuration-from-dateTime</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:dateTime</code> that is a given duration before a specified <code>xs:dateTime</code> (or after, if the duration is negative).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to an <code>xs:dateTime</code> and an <code>xs:yearMonthDuration</code> value. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-yearMonthDuration-from-dateTime</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dateTime</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTime</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the <code>xs:dateTime</code> computed by negating <code>$arg2</code> and adding the result to <code>$arg1</code> using the function <a href="#func-add-yearMonthDuration-to-dateTime"><code>op:add-yearMonthDuration-to-dateTime</code></a>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">op:subtract-yearMonthDuration-from-dateTime(
  xs:dateTime("2000-10-30T11:12:00"),
  xs:yearMonthDuration("P1Y2M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime("1999-08-30T11:12:00")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subtract-dayTimeDuration-from-dateTime"></a>9.8.8 <a href="#func-subtract-dayTimeDuration-from-dateTime" style="text-decoration: none">op:subtract-dayTimeDuration-from-dateTime</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:dateTime</code> that is a given duration before a specified <code>xs:dateTime</code> (or after, if the duration is negative).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to an <code>xs:dateTime</code> an and <code>xs:dayTimeDuration</code> values</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-dayTimeDuration-from-dateTime</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dateTime</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTime</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>The function returns the <code>xs:dateTime</code> computed by negating <code>$arg2</code> and adding the result to <code>$arg1</code> using the function <a href="#func-add-dayTimeDuration-to-dateTime"><code>op:add-dayTimeDuration-to-dateTime</code></a>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">op:subtract-dayTimeDuration-from-dateTime(
  xs:dateTime("2000-10-30T11:12:00"),
  xs:dayTimeDuration("P3DT1H15M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:dateTime("2000-10-27T09:57:00")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-add-yearMonthDuration-to-date"></a>9.8.9 <a href="#func-add-yearMonthDuration-to-date" style="text-decoration: none">op:add-yearMonthDuration-to-date</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:date</code> that is a given duration after a specified <code>xs:date</code> (or before, if the duration is negative).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>+</code> operator when applied to an <code>xs:date</code> and an <code>xs:yearMonthDuration</code> value. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:add-yearMonthDuration-to-date</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:date</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the result of casting <code>$arg1</code> to an <code>xs:dateTime</code>, adding <code>$arg2</code> using the function <a href="#func-add-yearMonthDuration-to-dateTime"><code>op:add-yearMonthDuration-to-dateTime</code></a>, and casting the result back to an <code>xs:date</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:add-yearMonthDuration-to-date(
  xs:date("2000-10-30"),
  xs:yearMonthDuration("P1Y2M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("2001-12-30")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-add-dayTimeDuration-to-date"></a>9.8.10 <a href="#func-add-dayTimeDuration-to-date" style="text-decoration: none">op:add-dayTimeDuration-to-date</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:date</code> that is a given duration after a specified <code>xs:date</code> (or before, if the duration is negative).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>+</code> operator when applied to an <code>xs:date</code> and an <code>xs:dayTimeDuration</code> value. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:add-dayTimeDuration-to-date</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:date</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the result of casting <code>$arg1</code> to an <code>xs:dateTime</code>, adding <code>$arg2</code> using the function <a href="#func-add-dayTimeDuration-to-dateTime"><code>op:add-dayTimeDuration-to-dateTime</code></a>, and casting the result back to an <code>xs:date</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:add-dayTimeDuration-to-date(
  xs:date("2004-10-30Z"),
  xs:dayTimeDuration("P2DT2H30M0S")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("2004-11-01Z")</pre></div><p><em>( The starting instant of the first argument is the <code>xs:dateTime</code> value <code>{ 2004, 10, 30, 0, 0, 0, xs:dayTimeDuration("PT0S") }</code>. Adding the second argument to this gives the <code>xs:dateTime</code> value <code>{ 2004, 11, 1, 2, 30, 0, xs:dayTimeDuration("PT0S") }</code>. The time components are then discarded. ).</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subtract-yearMonthDuration-from-date"></a>9.8.11 <a href="#func-subtract-yearMonthDuration-from-date" style="text-decoration: none">op:subtract-yearMonthDuration-from-date</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:date</code> that is a given duration before a specified <code>xs:date</code> (or after, if the duration is negative).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to an <code>xs:date</code> and an <code>xs:yearMonthDuration</code> value. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-yearMonthDuration-from-date</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:yearMonthDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:date</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Returns the <code>xs:date</code> computed by negating <code>$arg2</code> and adding the result to <code>$arg1</code> using the function <a href="#func-add-yearMonthDuration-to-date"><code>op:add-yearMonthDuration-to-date</code></a>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-yearMonthDuration-from-date(
  xs:date("2000-10-30"),
  xs:yearMonthDuration("P1Y2M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("1999-08-30")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-yearMonthDuration-from-date(
  xs:date("2000-02-29Z"),
  xs:yearMonthDuration("P1Y")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("1999-02-28Z")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">op:subtract-yearMonthDuration-from-date(
  xs:date("2000-10-31-05:00"),
  xs:yearMonthDuration("P1Y1M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("1999-09-30-05:00")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subtract-dayTimeDuration-from-date"></a>9.8.12 <a href="#func-subtract-dayTimeDuration-from-date" style="text-decoration: none">op:subtract-dayTimeDuration-from-date</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:date</code> that is a given duration before a specified <code>xs:date</code> (or after, if the duration is negative).</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to an <code>xs:date</code> and an <code>xs:dayTimeDuration</code>. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-dayTimeDuration-from-date</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:date</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Returns the <code>xs:date</code> computed by negating <code>$arg2</code> and adding the result to <code>$arg1</code> using the function <a href="#func-add-dayTimeDuration-to-date"><code>op:add-dayTimeDuration-to-date</code></a>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-dayTimeDuration-from-date(
  xs:date("2000-10-30"),
  xs:dayTimeDuration("P3DT1H15M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:date("2000-10-26")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-add-dayTimeDuration-to-time"></a>9.8.13 <a href="#func-add-dayTimeDuration-to-time" style="text-decoration: none">op:add-dayTimeDuration-to-time</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:time</code> value that is a given duration after a specified <code>xs:time</code> (or before, if the duration is negative or causes wrap-around past midnight)</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>+</code> operator when applied to an <code>xs:time</code> and an <code>xs:dayTimeDuration</code> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:add-dayTimeDuration-to-time</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:time</code></code></td></tr></tbody></table></div></dd><dt class="label">Rules</dt><dd><p>First, the days component in the canonical lexical representation of <code>$arg2</code> is set to zero (0) and the value of the resulting <code>xs:dayTimeDuration</code> is calculated. Alternatively, the value of <code>$arg2</code> modulus 86,400 is used as the second argument. This value is added to the value of <code>$arg1</code> converted to an <code>xs:dateTime</code> using a reference date such as <code>1972-12-31</code>, and the time component of the result is returned. Note that the <code>xs:time</code> returned may occur in a following or preceding day and may be less than <code>$arg1</code>.</p><p>The result has the same timezone as <code>$arg1</code>. If <code>$arg1</code> has no timezone, the result has no timezone.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:add-dayTimeDuration-to-time(
  xs:time("11:12:00"),
  xs:dayTimeDuration("P3DT1H15M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("12:27:00")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:add-dayTimeDuration-to-time(
  xs:time("23:12:00+03:00"),
  xs:dayTimeDuration("P1DT3H15M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("02:27:00+03:00")</pre></div><p><em>(That is, <code>{ 0, 0, 0, 2, 27, 0, xs:dayTimeDuration("PT3H") }</code>).</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-subtract-dayTimeDuration-from-time"></a>9.8.14 <a href="#func-subtract-dayTimeDuration-from-time" style="text-decoration: none">op:subtract-dayTimeDuration-from-time</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the <code>xs:time</code> value that is a given duration before a specified <code>xs:time</code> (or after, if the duration is negative or causes wrap-around past midnight)</p></dd><dt class="label">Operator Mapping</dt><dd><p>Defines the semantics of the <code>-</code> operator when applied to an <code>xs:time</code> and an <code>xs:dayTimeDuration</code> value. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">op:subtract-dayTimeDuration-from-time</code>(</td></tr><tr class="arg"><td><code>$arg1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arg2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dayTimeDuration</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:time</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the result of negating <code>$arg2</code> and adding the result to <code>$arg1</code> using the function <a href="#func-add-dayTimeDuration-to-time"><code>op:add-dayTimeDuration-to-time</code></a>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">op:subtract-dayTimeDuration-from-time(
  xs:time("11:12:00"),
  xs:dayTimeDuration("P3DT1H15M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("09:57:00")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">op:subtract-dayTimeDuration-from-time(
  xs:time("08:20:00-05:00"),
  xs:dayTimeDuration("P23DT10H10M")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:time("22:10:00-05:00")</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="formatting-dates-and-times"></a>9.9 <a href="#formatting-dates-and-times" style="text-decoration: none">Formatting dates and times</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-format-dateTime"><code>fn:format-dateTime</code></a></td><td>Returns a string containing an <code>xs:dateTime</code> value formatted for display.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-format-date"><code>fn:format-date</code></a></td><td>Returns a string containing an <code>xs:date</code> value formatted for display.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-format-time"><code>fn:format-time</code></a></td><td>Returns a string containing an <code>xs:time</code> value formatted for display.</td></tr></tbody></table><p>Three functions are provided to represent dates and times as a string, using the conventions of a selected calendar, language, and country. The functions are presented in their customary fashion, except for the rules and examples, which are described en bloc at <a href="#rules-for-datetime-formatting"><b>9.9.4 The date/time formatting functions</b></a> and <a href="#date-time-examples"><b>9.9.5 Examples of date and time formatting</b></a>.</p><div class="div3"><h4><a id="func-format-dateTime"></a>9.9.1 <a href="#func-format-dateTime" style="text-decoration: none">fn:format-dateTime</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-format-date">next</a> | <a href="#func-civil-timezone">previous</a>)</p><ol><li><p>The 3rd, 4th, and 5th arguments are now optional; previously the function required either 2 or 5 arguments.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/895">895</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901</a>&nbsp;16 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a string containing an <code>xs:dateTime</code> value formatted for display.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:format-dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:dateTime?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$picture</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$language</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$calendar</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$place</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on default calendar, and default language, and default place, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>See <a href="#rules-for-datetime-formatting"><b>9.9.4 The date/time formatting functions</b></a>.</p></dd></dl></div><div class="div3"><h4><a id="func-format-date"></a>9.9.2 <a href="#func-format-date" style="text-decoration: none">fn:format-date</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-format-time">next</a> | <a href="#func-format-dateTime">previous</a>)</p><ol><li><p>The 3rd, 4th, and 5th arguments are now optional; previously the function required either 2 or 5 arguments.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/895">895</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901</a>&nbsp;16 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a string containing an <code>xs:date</code> value formatted for display.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:format-date</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:date?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$picture</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$language</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$calendar</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$place</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on default calendar, and default language, and default place, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>See <a href="#rules-for-datetime-formatting"><b>9.9.4 The date/time formatting functions</b></a>.</p></dd></dl></div><div class="div3"><h4><a id="func-format-time"></a>9.9.3 <a href="#func-format-time" style="text-decoration: none">fn:format-time</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-parse-QName">next</a> | <a href="#func-format-date">previous</a>)</p><ol><li><p>The 3rd, 4th, and 5th arguments are now optional; previously the function required either 2 or 5 arguments.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/895">895</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901</a>&nbsp;16 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a string containing an <code>xs:time</code> value formatted for display.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:format-time</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:time?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$picture</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$language</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$calendar</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$place</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on default calendar, and default language, and default place, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>See <a href="#rules-for-datetime-formatting"><b>9.9.4 The date/time formatting functions</b></a>.</p></dd></dl></div><div class="div3"><h4><a id="rules-for-datetime-formatting"></a>9.9.4 <a href="#rules-for-datetime-formatting" style="text-decoration: none">The date/time formatting functions</a></h4><p>The <a href="#func-format-dateTime"><code>fn:format-dateTime</code></a>, <a href="#func-format-date"><code>fn:format-date</code></a>, and <a href="#func-format-time"><code>fn:format-time</code></a> functions format <code>$value</code> as a string using the picture string specified by the <code>$picture</code> argument, the calendar specified by the <code>$calendar</code> argument, the language specified by the <code>$language</code> argument, and the country or other place name specified by the <code>$place</code> argument. The result of the function is the formatted string representation of the supplied <code>xs:dateTime</code>, <code>xs:date</code>, or <code>xs:time</code> value.</p><p><span class="termdef"><a id="dt-date-formatting-function"></a>[Definition] The three functions <a href="#func-format-dateTime"><code>fn:format-dateTime</code></a>, <a href="#func-format-date"><code>fn:format-date</code></a>, and <a href="#func-format-time"><code>fn:format-time</code></a> are referred to collectively as the <b>date formatting functions</b>.</span></p><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>Calling the two-argument form of each of the three functions is equivalent to calling the five-argument form with each of the last three arguments set to the empty sequence.</p><p>For details of the <code>$language</code>, <code>$calendar</code>, and <code>$place</code> arguments, see <a href="#lang-cal-place"><b>9.9.4.8 The language, calendar, and place arguments</b></a>.</p><p>In general, the use of an invalid <code>$picture</code>, <code>$language</code>, <code>$calendar</code>, or <code>$place</code> argument results in a dynamic error [<a href="#ERRFOFD1340" title="err:FOFD1340">err:FOFD1340</a>]. By contrast, use of an option in any of these arguments that is valid but not supported by the implementation is not an error, and in these cases the implementation is required to output the value in a fallback representation. More detailed rules are given below.</p><div class="div4"><h5><a id="date-picture-string"></a>9.9.4.1 <a href="#date-picture-string" style="text-decoration: none">The picture string</a></h5><p>The picture consists of a sequence of variable markers and literal substrings. A substring enclosed in square brackets is interpreted as a variable marker; substrings not enclosed in square brackets are taken as literal substrings. The literal substrings are optional and if present are rendered unchanged, including any whitespace. If an opening or closing square bracket is required within a literal substring, it <span class="verb">must</span> be doubled. The variable markers are replaced in the result by strings representing aspects of the date and/or time to be formatted. These are described in detail below.</p><p>A variable marker consists of a component specifier followed optionally by one or two presentation modifiers and/or optionally by a width modifier. Whitespace within a variable marker is ignored.</p><p>The variable marker may be separated into its components by applying the following rules:</p><ol class="enumar"><li><p>The component specifier is always present and is always a single letter.</p></li><li><p>The width modifier may be recognized by the presence of a comma.</p></li><li><p>The substring between the component specifier and the comma (if present) or the end of the string (if there is no comma) contains the first and second presentation modifiers, both of which are optional. If this substring contains a single character, this is interpreted as the first presentation modifier. If it contains more than one character, the last character is examined: if it is valid as a second presentation modifier then it is treated as such, and the preceding part of the substring constitutes the first presentation modifier. Otherwise, the second presentation modifier is presumed absent and the whole substring is interpreted as the first presentation modifier.</p></li></ol><p>The <em>component specifier</em> indicates the component of the date or time that is required, and takes the following values:</p><table class="data"><thead><tr><th style="text-align:left">Specifier</th><th style="text-align:left">Meaning</th><th style="text-align:left">Default Presentation Modifier</th></tr></thead><tbody><tr><td>Y</td><td>year (absolute value)</td><td>1</td></tr><tr><td>M</td><td>month in year</td><td>1</td></tr><tr><td>D</td><td>day in month</td><td>1</td></tr><tr><td>d</td><td>day in year</td><td>1</td></tr><tr><td>F</td><td>day of week</td><td>n</td></tr><tr><td>W</td><td>week in year</td><td>1</td></tr><tr><td>w</td><td>week in month</td><td>1</td></tr><tr><td>H</td><td>hour in day (24 hours)</td><td>1</td></tr><tr><td>h</td><td>hour in half-day (12 hours)</td><td>1</td></tr><tr><td>P</td><td>am/pm marker</td><td>n</td></tr><tr><td>m</td><td>minute in hour</td><td>01</td></tr><tr><td>s</td><td>second in minute</td><td>01</td></tr><tr><td>f</td><td>fractional seconds</td><td>1</td></tr><tr><td>Z</td><td>timezone</td><td>01:01</td></tr><tr><td>z</td><td>timezone (Same as Z, but modified where appropriate to include a prefix as a time offset using GMT, for example GMT+1 or GMT-05:00. For this component there is a fixed prefix of <code>GMT</code>, or a localized variation thereof for the chosen language, and the remainder of the value is formatted as for specifier <code>Z</code>.) </td><td>01:01</td></tr><tr><td>C</td><td>calendar: the name or abbreviation of a calendar name</td><td>n</td></tr><tr><td>E</td><td>era: the name of a baseline for the numbering of years, for example the reign of a monarch</td><td>n</td></tr></tbody></table><p>A dynamic error is reported [<a href="#ERRFOFD1340" title="err:FOFD1340">err:FOFD1340</a>] if the syntax of the picture is incorrect.</p><p>A dynamic error is reported [<a href="#ERRFOFD1350" title="err:FOFD1350">err:FOFD1350</a>] if a component specifier within the picture refers to components that are not available in the given type of <code>$value</code>, for example if the picture supplied to the <a href="#func-format-time"><code>fn:format-time</code></a> refers to the year, month, or day component.</p><p>It is not an error to include a timezone component when the supplied value has no timezone. In these circumstances the timezone component will be ignored.</p><p>The first <em>presentation modifier</em> indicates the style in which the value of a component is to be represented. Its value may be either:</p><ul><li><p>any format token permitted as a primary format token in the second argument of the <a href="#func-format-integer"><code>fn:format-integer</code></a> function, indicating that the value of the component is to be output numerically using the specified number format (for example, <code>1</code>, <code>01</code>, <code>i</code>, <code>I</code>, <code>w</code>, <code>W</code>, or <code>Ww</code>) or </p></li><li><p>the format token <code>n</code>, <code>N</code>, or <code>Nn</code>, indicating that the value of the component is to be output by name, in lower-case, upper-case, or title-case respectively. Components that can be output by name include (but are not limited to) months, days of the week, timezones, and eras. If the processor cannot output these components by name for the chosen calendar and language then it must use an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> fallback representation.</p></li></ul><p>If a comma is to be used as a grouping separator within the format token, then there must be a width specifier. More specifically: if a variable marker contains one or more commas, then the last comma is treated as introducing the width modifier, and all others are treated as grouping separators. So <code>[Y9,999,*]</code> will output the year as <code>2,008</code>.</p><p>It is not possible to use a closing square bracket as a grouping separator within the format token.</p><p>If the implementation does not support the use of the requested format token, it <span class="verb">must</span> use the default presentation modifier for that component.</p><p>If the first presentation modifier is present, then it may optionally be followed by a second presentation modifier as follows:</p><table class="longlastcol"><thead><tr><th style="text-align:left">Modifier</th><th style="text-align:left">Meaning</th></tr></thead><tbody><tr><td>either <code>a</code> or <code>t</code></td><td>indicates alphabetic or traditional numbering respectively, the default being <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. This has the same meaning as in the second argument of <a href="#func-format-integer"><code>fn:format-integer</code></a>.</td></tr><tr><td>either <code>c</code> or <code>o</code></td><td>indicates cardinal or ordinal numbering respectively, for example <code>7</code> or <code>seven</code> for a cardinal number, or <code>7th</code>, <code>seventh</code>, or <code>7º</code> for an ordinal number. This has the same meaning as in the second argument of <a href="#func-format-integer"><code>fn:format-integer</code></a>. The actual representation of the ordinal form of a number may depend not only on the language, but also on the grammatical context (for example, in some languages it must agree in gender).</td></tr></tbody></table><div class="note"><p class="prefix"><b>Note:</b></p><p>Although the formatting rules are expressed in terms of the rules for format tokens in <a href="#func-format-integer"><code>fn:format-integer</code></a>, the formats actually used may be specialized to the numbering of date components where appropriate. For example, in Italian, it is conventional to use an ordinal number (<code>primo</code>) for the first day of the month, and cardinal numbers (<code>due, tre, quattro ...</code>) for the remaining days. A processor may therefore use this convention to number days of the month, ignoring the presence or absence of the ordinal presentation modifier.</p></div></div><div class="div4"><h5><a id="width-modifier"></a>9.9.4.2 <a href="#width-modifier" style="text-decoration: none">The Width Modifier</a></h5><p>Whether or not a presentation modifier is included, a width modifier may be supplied. This indicates the number of characters to be included in the representation of the value.</p><p>The width modifier, if present, is introduced by a comma. It takes the form:</p><p><code>&nbsp;&nbsp;&nbsp;","&nbsp;&nbsp;min-width ("-" max-width)?</code></p><p>where <code>min-width</code> is either an unsigned integer indicating the minimum number of characters to be output, or <code>*</code> indicating that there is no explicit minimum, and <code>max-width</code> is either an unsigned integer indicating the maximum number of characters to be output, or <code>*</code> indicating that there is no explicit maximum; if <code>max-width</code> is omitted then <code>*</code> is assumed.</p><p>A dynamic error ([<a href="#ERRFOFD1340" title="err:FOFD1340">err:FOFD1340</a>]) is raised if <code>min-width</code> is present and less than one, or if <code>max-width</code> is present and less than one or less than <code>min-width</code>. </p><p>A format token containing more than one digit, such as <code>001</code> or <code>9999</code>, sets the minimum and maximum width to the number of digits appearing in the format token; if a width modifier is also present, then the width modifier takes precedence.</p></div><div class="div4"><h5><a id="formatting-integer-valued-components"></a>9.9.4.3 <a href="#formatting-integer-valued-components" style="text-decoration: none">Formatting Integer-Valued Date/Time Components</a></h5><p>The rules in this section apply to the majority of integer-valued components: specifically <code>M D d F W w H h m s</code>.</p><p>In the rules below, the term <b>decimal digit pattern</b> has the meaning given in <a href="#func-format-integer"><b>4.6.1 fn:format-integer</b></a>.</p><ol class="enumar"><li><p>If the first presentation modifier takes the form of a <b>decimal digit pattern</b>:</p><ol class="enumla"><li><p>If there is no width modifier, then the value is formatted according to the rules of the <code>format-integer</code> function.</p></li><li><p>If there is a width modifier, then the first presentation modifier is adjusted as follows:</p><ol class="enumlr"><li><p>If the decimal digit pattern includes a grouping separator, the output is implementation-defined (but this is not an error). </p><div class="note"><p class="prefix"><b>Note:</b></p><p>Use of a width modifier together with grouping separators is inadvisable for this reason. It is never necessary to use a width modifier with a decimal digit pattern, since the same effect can be achieved by use of optional digit signs.</p></div></li><li><p>Otherwise, the number of mandatory-digit-sign characters in the presentation modifier is increased if necessary. This is done first by replacing optional-digit-signs with mandatory-digit-signs, starting from the right, and then prepending mandatory-digit-signs to the presentation modifier, until the number of mandatory-digit-signs is equal to the minimum width. Any mandatory-digit-signs that are added by this process must use the same decimal digit family as existing mandatory-digit-signs in the presentation modifier if there are any, or ASCII digits otherwise. </p></li><li><p>The maximum width, if specified, is ignored. </p></li><li><p>The output is then as defined using the <code>format-integer</code> function with this adjusted decimal digit pattern. </p></li></ol></li></ol></li><li><p>If the first presentation modifiers is one of <code>N</code>, <code>n</code>, or <code>Nn</code>:</p><ol class="enumla"><li><p>Let <var>FN</var> be the full name of the component, that is, the form of the name that would be used in the absence of any width modifier.</p></li><li><p>If <var>FN</var> is shorter than the minimum width, then it is padded by appending spaces to the end of the name. </p></li><li><p>If <var>FN</var> is longer than the maximum width, then it is abbreviated, either by choosing a conventional abbreviation that fits within the maximum width (for example, “Wednesday” might be abbreviated to “Weds”), or by removing characters from the end of <var>FN</var> until it fits within the maximum width. </p></li></ol></li><li><p>For other presentation modifiers:</p><ol class="enumla"><li><p>Any adjustment of the value to fit within the requested width range is implementation-defined. </p></li><li><p>The value should not be truncated if this results in output that will not be meaningful to users (for example, there is no sensible way to truncate Roman numerals).</p></li><li><p>If shorter than the minimum width, the value should be padded to the minimum width, either by appending spaces, or in some other way appropriate to the numbering scheme.</p></li></ol></li></ol></div><div class="div4"><h5><a id="formatting-year-component"></a>9.9.4.4 <a href="#formatting-year-component" style="text-decoration: none">Formatting the Year Component</a></h5><p>The rules for the year component (Y) are the same as those in <a href="#formatting-integer-valued-components"><b>9.9.4.3 Formatting Integer-Valued Date/Time Components</b></a>, except that the value of the year as output is the value of the year component of the supplied value modulo ten to the power <var>N</var> where <var>N</var> is determined as follows: </p><ol class="enumar"><li><p>If the width modifier is present and defines a finite maximum width, then that maximum width. </p></li><li><p>Otherwise, if the first presentation modifier takes the form of a decimal-digit-pattern, then:</p><ol class="enumla"><li><p>Let <var>W</var> be the number of optional-digit-signs and mandatory-digit-signs in that decimal-digit-pattern.</p></li><li><p>If <var>W</var> is 2 or more, then <var>W</var>.</p></li></ol></li><li><p>Otherwise, <var>N</var> is infinity (that is, the year is output in full).</p></li></ol></div><div class="div4"><h5><a id="formatting-fractional-seconds"></a>9.9.4.5 <a href="#formatting-fractional-seconds" style="text-decoration: none">Formatting Fractional Seconds</a></h5><p>The output for the fractional seconds component (<code>f</code>) is equivalent to the result of the following algorithm: </p><ol class="enumar"><li><p>If the first presentation modifier contains no Unicode digit, then the output is implementation-defined. </p></li><li><p>Otherwise, the value of the fractional seconds is output as follows:</p><ol class="enumla"><li><p>If there is no width modifier and the first presentation modifier comprises in its entirety a single mandatory-digit-sign (for example the default <code>1</code>), then the presentation modifier is extended on the right with as many optional-digit-signs as are needed to accommodate the actual fractional seconds precision encountered in the value to be formatted. </p></li><li><p>If there is a width modifier, then the first presentation modifier is adjusted as follows:</p><ol class="enumlr"><li><p>If a minimum width is specified, and if this exceeds the number of mandatory-digit-sign characters in the first presentation modifier, then the first presentation modifier is adjusted. This is done first by replacing optional-digit-signs with mandatory-digit-signs, starting from the left, and then appending mandatory-digit-signs to the presentation modifier, until the number of mandatory-digit-signs is equal to the minimum width. Any mandatory-digit-signs that are added by this process must use the same decimal digit family as existing mandatory-digit-signs in the presentation modifier. </p></li><li><p>If a maximum width is specified, the first presentation modifier is extended on the right with as many optional-digit-signs as are needed to ensure that the number of mandatory-digit-signs and optional-digit-signs is at least equal to the maximum width. </p></li></ol></li><li><p>The sequence of characters in the (adjusted) first presentation modifier is reversed (for example, <code>999'###</code> becomes <code>###'999</code>). If the result is not a valid <b>decimal digit pattern</b>, then the output is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. </p></li><li><p>The sequence of digits in the conventional decimal representation of the fractional seconds component is reversed, with insignificant zeroes removed, and the result is treated as an integer. For example, if the seconds value is <code>25.8235</code>, the reversed fractional seconds value is <code>5328</code>. </p></li><li><p>The reversed fractional seconds value is formatted using the reversed decimal digit pattern according to the rules of the <a href="#func-format-integer"><code>fn:format-integer</code></a> function. Given the examples above, the result is <code>5'328</code></p></li><li><p>The resulting string is reversed. In our example, the result is <code>823'5</code>.</p></li><li><p>If the result contains more digits than the number of mandatory-digit-signs and optional-digit-signs in the decimal digit pattern, then excess digits are removed from the right hand end (that is, the value is truncated towards zero rather than being rounded). Any grouping separator that immediately precedes a removed digit is also removed.</p></li></ol></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>The reason for presenting the algorithm in this way is that it enables maximum reuse of the rules defined for <a href="#func-format-integer"><code>fn:format-integer</code></a>. Since the fractional seconds value is not properly an integer, the rules do not work if used directly: for example, the positions of grouping separators need to be counted from the left rather than from the right. Implementations, as always, are free to use a different algorithm that yields the same result.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>A format token consisting of a single digit, such as <code>1</code>, does not constrain the number of digits in the output. In the case of fractional seconds in particular, <code>[f001]</code> requests three decimal digits, <code>[f01]</code> requests two digits, but <code>[f1]</code> will retain all digits in the supplied date/time value (the maximum number of digits is implementation-defined). If exactly one digit is required, this can be achieved using the component specifier <code>[f1,1-1]</code>.</p></div></div><div class="div4"><h5><a id="formatting-timezones"></a>9.9.4.6 <a href="#formatting-timezones" style="text-decoration: none">Formatting timezones</a></h5><p>Special rules apply to the formatting of timezones. When the component specifiers <code>Z</code> or <code>z</code> are used, the rules in this section override any rules given elsewhere in the case of discrepancies.</p><p>If the date/time value to be formatted does not include a timezone offset, then the timezone component specifier is generally ignored (results in no output). The exception is where military timezones are used (format <code>ZZ</code>) in which case the string <code>"J"</code> is output, indicating local time.</p><ul><li><p>When the component specifier is <code>z</code>, the output is the same as for component specifier <code>Z</code>, except that it is prefixed by the characters <code>GMT</code> or some localized equivalent. The prefix is omitted, however, in cases where the timezone is identified by name rather than by a numeric offset from UTC.</p></li><li><p>If the first <var>presentation modifier</var> is numeric and comprises one or two digits with no <var>grouping-separator</var> (for example <code>1</code> or <code>01</code>), then the timezone is formatted as a displacement from UTC in hours, preceded by a plus or minus sign: for example <code>-5</code> or <code>+03</code>. If the actual timezone offset is not an integral number of hours, then the minutes part of the offset is appended, separated by a colon: for example <code>+10:30</code> or <code>-1:15</code>.</p></li><li><p>If the first <var>presentation modifier</var> is numeric with a <var>grouping-separator</var> (for example <code>1:01</code> or <code>01.01</code>), then the timezone offset is output in hours and minutes, separated by the grouping separator, even if the number of minutes is zero: for example <code>+5:00</code> or <code>+10.30</code>.</p></li><li><p>If the first <var>presentation modifier</var> is numeric and comprises three or four digits with no <var>grouping-separator</var>, for example <code>001</code> or <code>0001</code>, then the timezone offset is shown in hours and minutes with no separator, for example <code>-0500</code> or <code>+1030</code>. </p></li><li><p>If the first <var>presentation modifier</var> is numeric, in any of the above formats, and the second <var>presentation modifier</var> is <code>t</code>, then a zero timezone offset (that is, UTC) is output as <code>Z</code> instead of a signed numeric value. In this presentation modifier is absent or if the timezone offset is non-zero, then the displayed timezone offset is preceded by a <code>-</code> sign for negative offsets or a <code>+</code> sign for non-negative offsets.</p></li><li><p>If the first <var>presentation modifier</var> is <code>Z</code>, then the timezone is formatted as a military timezone letter, using the convention Z = +00:00, A = +01:00, B = +02:00, ..., M = +12:00, N = -01:00, O = -02:00, ... Y = -12:00. The letter J (meaning local time) is used in the case of a value that does not specify a timezone offset. Timezone offsets that have no representation in this system (for example Indian Standard Time, +05:30) are output as if the format <code>01:01</code> had been requested.</p></li><li><p>If the first <var>presentation modifier</var> is <code>N</code>, then the timezone is output (where possible) as a timezone name, for example <code>EST</code> or <code>CET</code>. The same timezone offset has different names in different places; it is therefore <span class="verb">recommended</span> that this option should be used only if a country code (see <a href="#ISO3166">[ISO 3166-1]</a>) or IANA timezone name (see <a href="#olson">[IANA Timezone Database]</a>) is supplied in the <code>$place</code> argument. In the absence of this information, the implementation may apply a default, for example by using the timezone names that are conventional in North America. If no timezone name can be identified, the timezone offset is output using the fallback format <span><code>01:01</code></span>.</p></li></ul><p>The following examples illustrate options for timezone formatting.</p><table class="small complex data"><thead><tr><th>Variable marker</th><th><code>$place</code></th><th colspan="5">Timezone offsets (with time = 12:00:00)</th></tr><tr><th>&nbsp;</th><th>&nbsp;</th><th>-10:00</th><th>-05:00</th><th>+00:00</th><th>+05:30</th><th>+13:00</th></tr></thead><tbody><tr><td>[Z]</td><td>()</td><td>-10:00</td><td>-05:00</td><td>+00:00</td><td>+05:30</td><td>+13:00</td></tr><tr><td>[Z0]</td><td>()</td><td>-10</td><td>-5</td><td>+0</td><td>+5:30</td><td>+13</td></tr><tr><td>[Z0:00]</td><td>()</td><td>-10:00</td><td>-5:00</td><td>+0:00</td><td>+5:30</td><td>+13:00</td></tr><tr><td>[Z00:00]</td><td>()</td><td>-10:00</td><td>-05:00</td><td>+00:00</td><td>+05:30</td><td>+13:00</td></tr><tr><td>[Z0000]</td><td>()</td><td>-1000</td><td>-0500</td><td>+0000</td><td>+0530</td><td>+1300</td></tr><tr><td>[Z00:00t]</td><td>()</td><td>-10:00</td><td>-05:00</td><td>Z</td><td>+05:30</td><td>+13:00</td></tr><tr><td>[z]</td><td>()</td><td>GMT‑10:00</td><td>GMT‑05:00</td><td>GMT+00:00</td><td>GMT+05:30</td><td>GMT+13:00</td></tr><tr><td>[ZZ]</td><td>()</td><td>W</td><td>R</td><td>Z</td><td>+05:30</td><td>+13:00</td></tr><tr><td>[ZN]</td><td>"us"</td><td>HST</td><td>EST</td><td>GMT</td><td>IST</td><td>+13:00</td></tr><tr><td>[H00]:[M00] [ZN]</td><td>"America/New_York"</td><td>06:00 EST</td><td>12:00 EST</td><td>07:00 EST</td><td>01:30 EST</td><td>18:00 EST</td></tr></tbody></table><p>If a width specifier is present when formatting a timezone, then the representation as defined in this section is padded to the minimum width as described in <a href="#width-modifier"><b>9.9.4.2 The Width Modifier</b></a>, but it is never shortened.</p></div><div class="div4"><h5><a id="formatting-other-components"></a>9.9.4.7 <a href="#formatting-other-components" style="text-decoration: none">Formatting Other Components</a></h5><p>This section applies to the remaining components: <code>P</code> (am/pm marker), <code>C</code> (calendar), and <code>E</code> (era).</p><p>The output for these components is entirely <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. The default presentation modifier for these components is <code>n</code>, indicating that they are output as names (or conventional abbreviations), and the chosen names will in many cases depend on the chosen language: see <a href="#lang-cal-place"><b>9.9.4.8 The language, calendar, and place arguments</b></a>.</p></div><div class="div4"><h5><a id="lang-cal-place"></a>9.9.4.8 <a href="#lang-cal-place" style="text-decoration: none">The language, calendar, and place arguments</a></h5><p>The set of languages, calendars, and places that are supported in the <a title="date formatting function" class="termref" href="#dt-date-formatting-function">date formatting functions</a> is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. When any of these arguments is omitted or is the empty sequence, an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> default value is used.</p><p>If the fallback representation uses a different calendar from that requested, the output string <span class="verb">must</span> identify the calendar actually used, for example by prefixing the string with <code>[Calendar: X]</code> (where X is the calendar actually used), localized as appropriate to the requested language. If the fallback representation uses a different language from that requested, the output string <span class="verb">must</span> identify the language actually used, for example by prefixing the string with <code>[Language: Y]</code> (where Y is the language actually used) localized in an implementation-dependent way. If a particular component of the value cannot be output in the requested format, it <span class="verb">should</span> be output in the default format for that component.</p><p>The <code>$language</code> argument specifies the language to be used for the result string of the function. The value of the argument <span class="verb">should</span> be either the empty sequence or a value that would be valid for the <code>xml:lang</code> attribute (see <a href="#xml">[Extensible Markup Language (XML) 1.0 (Fifth Edition)]</a>). Note that this permits the identification of sublanguages based on country codes (from <a href="#ISO3166">[ISO 3166-1]</a>) as well as identification of dialects and of regions within a country.</p><p>If the <code>$language</code> argument is omitted or is set to the empty sequence, or if it is set to an invalid value or a value that the implementation does not recognize, then the processor uses the default language defined in the dynamic context.</p><p>The language is used to select the appropriate language-dependent forms of:</p><ul><li><p>names (for example, of months)</p></li><li><p>numbers expressed as words or as ordinals (<code>twenty, 20th, twentieth</code>)</p></li><li><p>hour convention (0-23 vs 1-24, 0-11 vs 1-12)</p></li><li><p>first day of week, first week of year</p></li></ul><p>Where appropriate this choice may also take into account the value of the <code>$place</code> argument, though this <span class="verb">should</span> not be used to override the language or any sublanguage that is specified as part of the <code>language</code> argument.</p><p>The choice of the names and abbreviations used in any given language is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. For example, one implementation might abbreviate July as <code>Jul</code> while another uses <code>Jly</code>. In German, one implementation might represent Saturday as <code>Samstag</code> while another uses <code>Sonnabend</code>. Implementations <span class="verb">may</span> provide mechanisms allowing users to control such choices.</p><p>Where ordinal numbers are used, the selection of the correct representation of the ordinal (for example, the grammatical gender) <span class="verb">may</span> depend on the component being formatted and on its textual context in the picture string.</p><p>The <code>calendar</code> attribute specifies that the <code>dateTime</code>, <code>date</code>, or <code>time</code> supplied in the <code>$value</code> argument <span class="verb">must</span> be converted to a value in the specified calendar and then converted to a string using the conventions of that calendar.</p><p>The calendar value if present <span class="verb">must</span> be a valid <code>EQName</code> (dynamic error: [<a href="#ERRFOFD1340" title="err:FOFD1340">err:FOFD1340</a>]). If it is a lexical <code>QName</code> then it is expanded into an expanded QName using the statically known namespaces; if it has no prefix then it represents an expanded-QName in no namespace. If the expanded QName is in no namespace, then it <span class="verb">must</span> identify a calendar with a designator specified below (dynamic error: [<a href="#ERRFOFD1340" title="err:FOFD1340">err:FOFD1340</a>]). If the expanded QName is in a namespace then it identifies the calendar in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way.</p><p>If the <code>$calendar</code> argument is omitted or is set to the empty sequence then the default calendar defined in the dynamic context is used.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The calendars listed below were known to be in use during the last hundred years. Many other calendars have been used in the past.</p><p>This specification does not define any of these calendars, nor the way that they map to the value space of the <code>xs:date</code> datatype in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>. There may be ambiguities when dates are recorded using different calendars. For example, the start of a new day is not simultaneous in different calendars, and may also vary geographically (for example, based on the time of sunrise or sunset). Translation of dates is therefore more reliable when the time of day is also known, and when the geographic location is known. When translating dates between one calendar and another, the processor may take account of the values of the <code>$place</code> and/or <code>$language</code> arguments, with the <code>$place</code> argument taking precedence.</p><p>Information about some of these calendars, and algorithms for converting between them, may be found in <a href="#CALCALC">[Calendrical Calculations]</a>.</p></div><table class="data"><thead><tr><th>Designator</th><th>Calendar</th></tr></thead><tbody><tr><td>AD</td><td>Anno Domini (Christian Era)</td></tr><tr><td>AH</td><td>Anno Hegirae (Islamic Era)</td></tr><tr><td>AME</td><td>Mauludi Era (solar years since Muhammad’s birth)</td></tr><tr><td>AM</td><td>Anno Mundi (Jewish Calendar)</td></tr><tr><td>AP</td><td>Anno Persici</td></tr><tr><td>AS</td><td>Aji Saka Era (Java)</td></tr><tr><td>BE</td><td>Buddhist Era</td></tr><tr><td>CB</td><td>Cooch Behar Era</td></tr><tr><td>CE</td><td>Common Era</td></tr><tr><td>CL</td><td>Chinese Lunar Era</td></tr><tr><td>CS</td><td>Chula Sakarat Era</td></tr><tr><td>EE</td><td>Ethiopian Era</td></tr><tr><td>FE</td><td>Fasli Era</td></tr><tr><td>ISO</td><td>ISO 8601 calendar</td></tr><tr><td>JE</td><td>Japanese Calendar</td></tr><tr><td>KE</td><td>Khalsa Era (Sikh calendar)</td></tr><tr><td>KY</td><td>Kali Yuga</td></tr><tr><td>ME</td><td>Malabar Era</td></tr><tr><td>MS</td><td>Monarchic Solar Era</td></tr><tr><td>NS</td><td>Nepal Samwat Era</td></tr><tr><td>OS</td><td>Old Style (Julian Calendar)</td></tr><tr><td>RS</td><td>Rattanakosin (Bangkok) Era</td></tr><tr><td>SE</td><td>Saka Era</td></tr><tr><td>SH</td><td>Solar Hijri (Islamic Era, used in Iran and Afghanistan)</td></tr><tr><td>SS</td><td>Saka Samvat</td></tr><tr><td>TE</td><td>Tripurabda Era</td></tr><tr><td>VE</td><td>Vikrama Era</td></tr><tr><td>VS</td><td>Vikrama Samvat Era</td></tr></tbody></table><p>At least one of the above calendars <span class="verb">must</span> be supported. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which calendars are supported.</p><p>The ISO 8601 calendar (<a href="#ISO8601">[ISO 8601]</a>), which is included in the above list and designated <code>ISO</code>, is very similar to the Gregorian calendar designated <code>AD</code>, but it differs in several ways. The ISO calendar is intended to ensure that date and time formats can be read easily by other software, as well as being legible for human users. The ISO calendar prescribes the use of particular numbering conventions as defined in ISO 8601, rather than allowing these to be localized on a per-language basis. In particular it provides a numeric “week date” format which identifies dates by year, week of the year, and day in the week; in the ISO calendar the days of the week are numbered from 1 (Monday) to 7 (Sunday), and week 1 in any calendar year is the week (from Monday to Sunday) that includes the first Thursday of that year. The numeric values of the components year, month, day, hour, minute, and second are the same in the ISO calendar as the values used in the lexical representation of the date and time as defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>. The era (<code>E</code> component) with this calendar is either a minus sign (for negative years) or a zero-length string (for positive years). For dates before 1 January, AD 1, year numbers in the ISO and AD calendars are off by one from each other: ISO year 0000 is 1 BC, -0001 is 2 BC, etc.</p><p>ISO 8601 does not define a numbering for weeks within a month. When the <code>w</code> component is used, the convention to be adopted is that each Monday-to-Sunday week is considered to fall within a particular month if its Thursday occurs in that month; the weeks that fall in a particular month under this definition are numbered starting from 1. Thus, for example, 29 January 2013 falls in week 5 because the Thursday of the week (31 January 2013) is the fifth Thursday in January, and 1 February 2013 is also in week 5 for the same reason.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The value space of the date and time datatypes, as defined in XML Schema, is based on absolute points in time. The lexical space of these datatypes defines a representation of these absolute points in time using the proleptic Gregorian calendar, that is, the modern Western calendar extrapolated into the past and the future; but the value space is calendar-neutral. The <a title="date formatting function" class="termref" href="#dt-date-formatting-function">date formatting functions</a> produce a representation of this absolute point in time, but denoted in a possibly different calendar. So, for example, the date whose lexical representation in XML Schema is <code>1502-01-11</code> (the day on which Pope Gregory XIII was born) might be formatted using the Old Style (Julian) calendar as <code>1 January 1502</code>. This reflects the fact that there was at that time a ten-day difference between the two calendars. It would be incorrect, and would produce incorrect results, to represent this date in an element or attribute of type <code>xs:date</code> as <code>1502-01-01</code>, even though this might reflect the way the date was recorded in contemporary documents.</p><p>When referring to years occurring in antiquity, modern historians generally use a numbering system in which there is no year zero (the year before 1 CE is thus 1 BCE). This is the convention that <span class="verb">should</span> be used when the requested calendar is OS (Julian) or AD (Gregorian). When the requested calendar is ISO, however, the conventions of ISO 8601 <span class="verb">should</span> be followed: here the year before +0001 is numbered zero. In <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> (version 1.0), the value space for <code>xs:date</code> and <code>xs:dateTime</code> does not include a year zero: however, XSD 1.1 endorses the ISO 8601 convention. This means that the date on which Julius Caesar was assassinated has the ISO 8601 lexical representation -0043-03-13, but will be formatted as 15 March 44 BCE in the Julian calendar or 13 March 44 BCE in the Gregorian calendar (dependent on the chosen localization of the names of months and eras).</p></div><p>The intended use of the <code>$place</code> argument is to identify the place where an event represented by the <code>dateTime</code>, <code>date</code>, or <code>time</code> supplied in the <code>$value</code> argument took place or will take place. If the <code>$place</code> argument is omitted or is set to the empty sequence, then the default place defined in the dynamic context is used. If the value is supplied, and is not the empty sequence, then it <span class="verb">should</span> either be a country code or an IANA timezone name. If the value does not take this form, or if its value is not recognized by the implementation, then the default place defined in the dynamic context is used.</p><ul><li><p>Country codes are defined in <a href="#ISO3166">[ISO 3166-1]</a>. Examples are <code>"de"</code> for Germany and <code>"jp"</code> for Japan. Implementations <span class="verb">may</span> also allow the use of codes representing subdivisions of a country from ISO 3166-2, or codes representing formerly used names of countries from ISO 3166-3</p></li><li><p>IANA timezone names are defined in the IANA timezone database <a href="#olson">[IANA Timezone Database]</a>. Examples are <code>"America/New_York"</code> and <code>"Europe/Rome"</code>.</p></li></ul><p>This argument is not intended to identify the location of the user for whom the date or time is being formatted; that should be done by means of the <code>$language</code> attribute. This information <span class="verb">may</span> be used to provide additional information when converting dates between calendars or when deciding how individual components of the date and time are to be formatted. For example, different countries using the Old Style (Julian) calendar started the new year on different days, and some countries used variants of the calendar that were out of synchronization as a result of differences in calculating leap years.</p><p>The geographical area identified by a country code is defined by the boundaries as they existed at the time of the date to be formatted, or the present-day boundaries for dates in the future.</p><p>If the <code>$place</code> argument is supplied in the form of an IANA timezone name that is recognized by the implementation, then the date or time being formatted is adjusted to the timezone offset applicable in that timezone. For example, if the <code>xs:dateTime</code> value <code>2010-02-15T12:00:00Z</code> is formatted with the <code>$place</code> argument set to <code>America/New_York</code>, then the output will be as if the value <code>2010-02-15T07:00:00-05:00</code> had been supplied. This adjustment takes daylight savings time into account where possible; if the date in question falls during daylight savings time in New York, then it is adjusted to timezone offset <code>-PT4H</code> rather than <code>-PT5H</code>. Adjustment using daylight savings time is only possible where the value includes a date, and where the date is within the range covered by the timezone database.</p></div></div><div class="div3"><h4><a id="date-time-examples"></a>9.9.5 <a href="#date-time-examples" style="text-decoration: none">Examples of date and time formatting</a></h4><p>The following examples show a selection of dates and times and the way they might be formatted. These examples assume the use of the Gregorian calendar as the default calendar.</p><table class="data"><thead><tr><th>Required Output</th><th>Expression</th></tr></thead><tbody><tr><td><code>2002-12-31</code></td><td><code>format-date($d, "[Y0001]-[M01]-[D01]")</code></td></tr><tr><td><code>12-31-2002</code></td><td><code>format-date($d, "[M]-[D]-[Y]")</code></td></tr><tr><td><code>31-12-2002</code></td><td><code>format-date($d, "[D]-[M]-[Y]")</code></td></tr><tr><td><code>31 XII 2002</code></td><td><code>format-date($d, "[D1] [MI] [Y]")</code></td></tr><tr><td><code>31st December, 2002</code></td><td><code>format-date($d, "[D1o] [MNn], [Y]", "en", (), ())</code></td></tr><tr><td><code>31 DEC 2002</code></td><td><code>format-date($d, "[D01] [MN,*-3] [Y0001]", "en", (), ())</code></td></tr><tr><td><code>December 31, 2002</code></td><td><code>format-date($d, "[MNn] [D], [Y]", "en", (), ())</code></td></tr><tr><td><code>31 Dezember, 2002</code></td><td><code>format-date($d, "[D] [MNn], [Y]", "de", (), ())</code></td></tr><tr><td><code>Tisdag 31 December 2002</code></td><td><code>format-date($d, "[FNn] [D] [MNn] [Y]", "sv", (), ())</code></td></tr><tr><td><code>[2002-12-31]</code></td><td><code>format-date($d, "[[[Y0001]-[M01]-[D01]]]")</code></td></tr><tr><td><code>Two Thousand and Three</code></td><td><code>format-date($d, "[YWw]", "en", (), ())</code></td></tr><tr><td><code>einunddreißigste Dezember</code></td><td><code>format-date($d, "[Dwo] [MNn]", "de", (), ())</code></td></tr><tr><td><code>3:58 PM</code></td><td><code>format-time($t, "[h]:[m01] [PN]", "en", (), ())</code></td></tr><tr><td><code>3:58:45 pm</code></td><td><code>format-time($t, "[h]:[m01]:[s01] [Pn]", "en", (), ())</code></td></tr><tr><td><code>3:58:45 PM PDT</code></td><td><code>format-time($t, "[h]:[m01]:[s01] [PN] [ZN,*-3]", "en", (), ())</code></td></tr><tr><td><code>3:58:45 o'clock PM PDT</code></td><td><code>format-time($t, "[h]:[m01]:[s01] o'clock [PN] [ZN,*-3]", "en", (), ())</code></td></tr><tr><td><code>15:58</code></td><td><code>format-time($t, "[H01]:[m01]")</code></td></tr><tr><td><code>15:58:45.762</code></td><td><code>format-time($t, "[H01]:[m01]:[s01].[f001]")</code></td></tr><tr><td><code>15:58:45 GMT+02:00</code></td><td><code>format-time($t, "[H01]:[m01]:[s01] [z,6-6]", "en", (), ())</code></td></tr><tr><td><code>15.58 Uhr GMT+2</code></td><td><code>format-time($t, "[H01]:[m01] Uhr [z]", "de", (), ())</code></td></tr><tr><td><code>3.58pm on Tuesday, 31st December</code></td><td><code>format-dateTime($dt, "[h].[m01][Pn] on [FNn], [D1o] [MNn]")</code></td></tr><tr><td><code>12/31/2002 at 15:58:45</code></td><td><code>format-dateTime($dt, "[M01]/[D01]/[Y0001] at [H01]:[m01]:[s01]")</code></td></tr></tbody></table><p>The following examples use calendars other than the Gregorian calendar.</p><table class="data"><thead><tr><th>Description</th><th>Request</th><th>Result</th></tr></thead><tbody><tr><td>Islamic</td><td><code>format-date($d, "[D&amp;#x0661;] [Mn] [Y&amp;#x0661;]", "ar", "AH", ())</code></td><td>٢٦ ﺸﻭّﺍﻝ ١٤٢٣</td></tr><tr><td>Jewish (with Western numbering)</td><td><code>format-date($d, "[D] [Mn] [Y]", "he", "AM", ())</code></td><td>‏26 טבת 5763</td></tr><tr><td>Jewish (with traditional numbering)</td><td><code>format-date($d, "[D&amp;#x05D0;t] [Mn] [Y&amp;#x05D0;t]", "he", "AM", ())</code></td><td>כ״ו טבת תשס״ג</td></tr><tr><td>Julian (Old Style)</td><td><code>format-date($d, "[D] [MNn] [Y]", "en", "OS", ())</code></td><td>18 December 2002</td></tr><tr><td>Thai</td><td><code>format-date($d, "[D&amp;#x0E51;] [Mn] [Y&amp;#x0E51;]", "th", "BE", ())</code></td><td>๓๑ ธันวาคม ๒๕๔๕</td></tr></tbody></table></div></div><div class="div2"><h3><a id="parsing-dates-and-times"></a>9.10 <a href="#parsing-dates-and-times" style="text-decoration: none">Parsing dates and times</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parse-ietf-date"><code>fn:parse-ietf-date</code></a></td><td>Parses a string containing the date and time in IETF format, returning the corresponding <code>xs:dateTime</code> value.</td></tr></tbody></table><p>A function is provided to parse dates and times expressed using syntax that is commonly encountered in internet protocols.</p><div class="div3"><h4><a id="func-parse-ietf-date"></a>9.10.1 <a href="#func-parse-ietf-date" style="text-decoration: none">fn:parse-ietf-date</a></h4><dl><dt class="label">Summary</dt><dd><p>Parses a string containing the date and time in IETF format, returning the corresponding <code>xs:dateTime</code> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parse-ietf-date</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTime?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function accepts a string matching the production <code>input</code> in the following grammar:</p><table class="scrap"><tbody><tr><td><code>input</code></td><td><code>::=</code></td><td><code>S? (dayname ","? S)? ((datespec S time) | asctime) S?</code></td></tr><tr><td><code>dayname</code></td><td><code>::=</code></td><td><code>"Mon" | "Tue" | "Wed" | "Thu" | "Fri" | "Sat" | "Sun" | "Monday | "Tuesday" | "Wednesday" | "Thursday" | "Friday" | "Saturday" | "Sunday"</code></td></tr><tr><td><code>datespec</code></td><td><code>::=</code></td><td><code>daynum dsep monthname dsep year</code></td></tr><tr><td><code>asctime</code></td><td><code>::=</code></td><td><code>monthname dsep daynum S time S year</code></td></tr><tr><td><code>dsep</code></td><td><code>::=</code></td><td><code>S | (S? "-" S?)</code></td></tr><tr><td><code>daynum</code></td><td><code>::=</code></td><td><code>digit digit?</code></td></tr><tr><td><code>year</code></td><td><code>::=</code></td><td><code>digit digit (digit digit)?</code></td></tr><tr><td><code>digit</code></td><td><code>::=</code></td><td><code>[0-9]</code></td></tr><tr><td><code>monthname</code></td><td><code>::=</code></td><td><code>"Jan" | "Feb" | "Mar" | "Apr" | "May" | "Jun" | "Jul" | "Aug" | "Sep" | "Oct" | "Nov" | "Dec"</code></td></tr><tr><td><code>time</code></td><td><code>::=</code></td><td><code>hours ":" minutes (":" seconds)? (S? timezone)?</code></td></tr><tr><td><code>hours</code></td><td><code>::=</code></td><td><span><code>digit digit?</code></span></td></tr><tr><td><code>minutes</code></td><td><code>::=</code></td><td><code>digit digit</code></td></tr><tr><td><code>seconds</code></td><td><code>::=</code></td><td><code>digit digit ("." digit+)?</code></td></tr><tr><td><code>timezone</code></td><td><code>::=</code></td><td><code>tzname | tzoffset (S? "(" S? tzname S? ")")?</code></td></tr><tr><td><code>tzname</code></td><td><code>::=</code></td><td><code>"UT" | "UTC" | "GMT" | "EST" | "EDT" | "CST" | "CDT" | "MST" | "MDT" | "PST" | "PDT" </code></td></tr><tr><td><code>tzoffset</code></td><td><code>::=</code></td><td><span><code>("+"|"-") hours ":"? minutes?</code></span></td></tr><tr><td><code>S</code></td><td><code>::=</code></td><td><code>(x09 | x0A | x0D | x20)+</code></td></tr></tbody></table><p>The input is case-insensitive: upper-case and lower-case distinctions in the above grammar show the conventional usage, but otherwise have no significance.</p><p>If the input is the empty sequence, the result is the empty sequence.</p><p>The <code>dayname</code>, if present, is ignored.</p><p>The <code>daynum</code>, <code>monthname</code>, and <code>year</code> supply the day, month, and year of the resulting <code>xs:dateTime</code> value. A two-digit year <span class="verb">must</span> have 1900 added to it. A year such as 0070 is to be treated as given; negative years are not permitted.</p><p>The <code>hours</code>, <code>minutes</code>, and <code>seconds</code> (including fractional seconds) values supply the corresponding components of the resulting <code>xs:dateTime</code> value; if the <code>seconds</code> value <span>or the fractional seconds value</span> is absent then zero is assumed.</p><p>If both a <code>tzoffset</code> and a <code>tzname</code> are supplied then the <code>tzname</code> is ignored.</p><p>If a <code>tzoffset</code> is supplied then this defines the hours and minutes parts of the timezone offset:</p><ul><li><p>If it contains a colon, this separates the hours part from the minutes part.</p></li><li><p>Otherwise, the grammar allows a sequence of from one to four digits. These are interpreted as <code>H</code>, <code>HH</code>, <code>HMM</code>, or <code>HHMM</code> respectively, where <code>H</code> or <code>HH</code> is the hours part, and <code>MM</code> (if present) is the minutes part.</p></li><li><p>If the minutes part is absent it defaults to <code>00</code>.</p></li></ul><p>If a <code>tzname</code> is supplied with no <code>tzoffset</code> then it is translated to a timezone offset as follows:</p><table class="data"><thead><tr><th>tzname</th><th>Offset</th></tr></thead><tbody><tr><td>UT, UTC, GMT</td><td>00:00</td></tr><tr><td>EST</td><td>-05:00</td></tr><tr><td>EDT</td><td>-04:00</td></tr><tr><td>CST</td><td>-06:00</td></tr><tr><td>CDT</td><td>-05:00</td></tr><tr><td>MST</td><td>-07:00</td></tr><tr><td>MDT</td><td>-06:00</td></tr><tr><td>PST</td><td>-08:00</td></tr><tr><td>PDT</td><td>-07:00</td></tr></tbody></table><p>If neither a <code>tzoffset</code> nor <code>tzname</code> is supplied, a timezone offset of <code>00:00</code> is assumed.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFORG0010" title="err:FORG0010">err:FORG0010</a>] if the input does not match the grammar, or if the resulting date/time value is invalid (for example, <code>"31 February"</code>).</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The <code>parse-ietf-date</code> function attempts to interpret its input as a date in any of the three formats specified by HTTP <a href="#rfc2616">[RFC 2616]</a>.</p><p>These formats are used widely on the Internet to represent timestamps, and were specified in:</p><ul><li><p><a href="#rfc822">[RFC 822]</a> (electronic mail), extended in <a href="#rfc1123">[RFC 1123]</a> to allow four-digit years;</p></li><li><p><a href="#rfc850">[RFC 850]</a> (Usenet Messages), obsoleted by <a href="#rfc1036">[RFC 1036]</a>;</p></li><li><p>POSIX <code>asctime()</code> format</p></li></ul><p><a href="#rfc2616">[RFC 2616]</a> (HTTP) officially uses a subset of those three formats restricted to GMT.</p><p>The grammar for this function is slightly more liberal than the RFCs (reflecting the internet tradition of being liberal in what is accepted). For example the function:</p><ol class="enumar"><li><p>Accepts a single-digit value where appropriate in place of a two-digit value with a leading zero (so <code>"Wed 1 Jun"</code> is acceptable in place of <code>"Wed 01 Jun"</code>, <span>and the timezone offset <code>"-5:00"</code> is equivalent to <code>"-05:00"</code>)</span></p></li><li><p>Accepts one or more whitespace characters (x20, x09, x0A, x0D) wherever a single space is required, and allows whitespace to be omitted where it is not required for parsing</p></li><li><p>Accepts and ignores whitespace characters (x20, x09, x0A, x0D) at the start or end of the string.</p></li></ol><p>In new protocols IETF recommends the format of <a href="#rfc3339">[RFC 3339]</a>, which is based on a profile of ISO 8601 similar to that already used in XPath and XSD, but the “approximate” <a href="#rfc822">[RFC 822]</a> format described here is very widely used.</p><p>An <a href="#rfc1123">[RFC 1123]</a> date can be generated approximately using <a href="#func-format-dateTime"><code>fn:format-dateTime</code></a> with a picture string of <code>"[FNn3], [D01] [MNn3] [Y04] [H01]:[m01]:[s01] [Z0000]"</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>parse-ietf-date("Wed, 06 Jun 1994 07:29:35 GMT")</code></pre></div></td><td style="vertical-align:top"><p><code>xs:dateTime("1994-06-06T07:29:35Z")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>parse-ietf-date("Wed, 6 Jun 94 07:29:35 GMT")</code></pre></div></td><td style="vertical-align:top"><p><code>xs:dateTime("1994-06-06T07:29:35Z")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>parse-ietf-date("Wed Jun 06 11:54:45 EST 2013")</code></pre></div></td><td style="vertical-align:top"><p><code>xs:dateTime("2013-06-06T11:54:45-05:00")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>parse-ietf-date("Sunday, 06-Nov-94 08:49:37 GMT")</code></pre></div></td><td style="vertical-align:top"><p><code>xs:dateTime("1994-11-06T08:49:37Z")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>parse-ietf-date("Wed, 6 Jun 94 07:29:35 +0500")</code></pre></div></td><td style="vertical-align:top"><p><code>xs:dateTime("1994-06-06T07:29:35+05:00")</code></p></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="QName-funcs"></a>10 <a href="#QName-funcs" style="text-decoration: none">Processing QNames and NOTATIONS</a></h2><div class="div2"><h3><a id="QName-constructors"></a>10.1 <a href="#QName-constructors" style="text-decoration: none">Functions to create a QName</a></h3><p>In XPath 4.0, statically-known QNames can be expressed using a QName literal such as <code>#xml:space</code>. Where the QName is not known statically, the <code>xs:QName</code> constructor function can be used.</p><p>In addition to the <code>xs:QName</code> constructor function, QName values can be constructed by combining a namespace URI, prefix, and local name, or by resolving a lexical QName against the in-scope namespaces of an element node. This section defines functions that perform these operations. Leading and trailing whitespace, if present, is stripped from string arguments before the result is constructed.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-QName"><code>fn:QName</code></a></td><td>Returns an <code>xs:QName</code> value formed using a supplied namespace URI and lexical QName.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parse-QName"><code>fn:parse-QName</code></a></td><td>Returns an <code>xs:QName</code> value formed by parsing an EQName.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-resolve-QName"><code>fn:resolve-QName</code></a></td><td>Returns an <code>xs:QName</code> value (that is, an expanded-QName) by taking an <code>xs:string</code> that has the lexical form of an <code>xs:QName</code> (a string in the form <code>"prefix:local-name"</code> or <code>"local-name"</code>) and resolving it using the in-scope namespaces for a given element.</td></tr></tbody></table><div class="div3"><h4><a id="func-QName"></a>10.1.1 <a href="#func-QName" style="text-decoration: none">fn:QName</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an <code>xs:QName</code> value formed using a supplied namespace URI and lexical QName.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:QName</code>(</td></tr><tr class="arg"><td><code>$uri</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$qname</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:QName</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The namespace URI in the returned QName is taken from <code>$uri</code>. If <code>$uri</code> is the zero-length string or the empty sequence, it represents “no namespace”.</p><p>The prefix (or absence of a prefix) in <code>$qname</code> is retained in the returned <code>xs:QName</code> value.</p><p>The local name in the result is taken from the local part of <code>$qname</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOCA0002" title="err:FOCA0002">err:FOCA0002</a>] if <code>$qname</code> does not have the correct lexical form for an instance of <code>xs:QName</code>.</p><p>A dynamic error is raised [<a href="#ERRFOCA0002" title="err:FOCA0002">err:FOCA0002</a>] if <code>$uri</code> is the zero-length string or the empty sequence, and the value of <code>$qname</code> contains a colon (<code>:</code>).</p><p>A dynamic error <span class="verb">may</span> be raised [<a href="#ERRFOCA0002" title="err:FOCA0002">err:FOCA0002</a>] if <code>$uri</code> is not a valid URI (XML Namespaces 1.0) or IRI (XML Namespaces 1.1). </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p><code>fn:QName("http://www.example.com/example", "person")</code> returns an <code>xs:QName</code> with namespace URI <code>"http://www.example.com/example"</code>, local name <code>"person"</code> and prefix <code>""</code>.</p></td></tr><tr><td colspan="2"><p><code>fn:QName("http://www.example.com/example", "ht:person")</code> returns an <code>xs:QName</code> with namespace URI <code>"http://www.example.com/example"</code>, local name <code>"person"</code> and prefix <code>"ht"</code>.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-parse-QName"></a>10.1.2 <a href="#func-parse-QName" style="text-decoration: none">fn:parse-QName</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-expanded-QName">next</a> | <a href="#func-format-time">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1">1</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/207">207</a>&nbsp;15 November 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an <code>xs:QName</code> value formed by parsing an EQName.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parse-QName</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:QName?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on namespaces. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the result is the empty sequence.</p><p>Otherwise, leading and trailing whitespace in <code>$value</code> is stripped: call the result <var>V</var></p><p>If <var>V</var> is castable to <code>xs:NCName</code>, the result is <code>fn:QName("", $value)</code>: that is, a QName in no namespace.</p><p>If <var>V</var> is in the lexical space of <code>xs:QName</code> (that is, if it is in the form <code>prefix:local</code>), the result is <code>xs:QName($value)</code>. Note that this result depends on the in-scope prefixes in the static context, and may result in various error conditions.</p><p>If <var>V</var> takes the form of a XPath <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#URIQualifiedName">URIQualifiedName</a><sup><small>XP</small></sup> (that is, <code>Q{uri}local</code>, where the <code>uri</code> part may be zero-length, or <code>Q{uri}prefix:local</code>), then the result is <code>fn:QName(uri, local)</code> or <code>fn:QName(uri, prefix:local)</code> respectively.</p><p>The rules used for parsing a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#BracedURILiteral">BracedURILiteral</a><sup><small>XP</small></sup> within a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#URIQualifiedName">URIQualifiedName</a><sup><small>XP</small></sup> are the XPath rules, not the XQuery rules (the XQuery rules require special characters such as <code>&lt;</code> and <code>&amp;</code> to be escaped).</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOCA0002" title="err:FOCA0002">err:FOCA0002</a>] if the supplied value of <code>$value</code>, after whitespace normalization, does not match the XPath production <a href="../xquery-40/xpath-40.html#EQName">EQName</a><sup><small>XP</small></sup>, or if the input is a <code>URIQualifiedName</code> in which the namespace prefix is present but the namespace URI is absent.</p><p>A dynamic error is raised [<a href="#ERRFONS0004" title="err:FONS0004">err:FONS0004</a>] if the supplied value of <code>$value</code>, after whitespace normalization, is in the form <code>prefix:local</code> (with a non-absent prefix), and the prefix cannot be resolved to a namespace URI using the in-scope namespace bindings from the static context.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>fn:parse-QName("Q{http://www.example.com/ns}person")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>fn:QName("http://www.example.com/ns", "person")</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>fn:parse-QName("person")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>fn:QName("", "person")</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>fn:parse-QName("Q{}person")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>fn:QName("", "person")</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>fn:parse-QName("Q{http://www.example.com/ns}xmp:person")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>fn:QName("http://www.example.com/ns", "xmp:person")</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">declare namespace xmp = "http://www.example.com/ns";
fn:parse-QName("xmp:person")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">fn:QName("http://www.example.com/ns", "xmp:person")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-resolve-QName"></a>10.1.3 <a href="#func-resolve-QName" style="text-decoration: none">fn:resolve-QName</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an <code>xs:QName</code> value (that is, an expanded-QName) by taking an <code>xs:string</code> that has the lexical form of an <code>xs:QName</code> (a string in the form <code>"prefix:local-name"</code> or <code>"local-name"</code>) and resolving it using the in-scope namespaces for a given element.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:resolve-QName</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$element</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>element()</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:QName?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, returns the empty sequence.</p><p>More specifically, the function searches the namespace bindings of <code>$element</code> for a binding whose name matches the prefix of <code>$value</code>, or the zero-length string if it has no prefix, and returns an expanded-QName whose local name is taken from the supplied <code>$value</code>, and whose namespace URI is taken from the string value of the namespace binding.</p><p>If the <code>$value</code> has no prefix, and there is no namespace binding for <code>$element</code> corresponding to the default (unnamed) namespace, then the resulting expanded-QName has no namespace part.</p><p>The prefix (or absence of a prefix) in the supplied <code>$value</code> argument is retained in the returned expanded-QName, as described in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#terminology">2.1 Terminology</a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOCA0002" title="err:FOCA0002">err:FOCA0002</a>] if <code>$value</code> does not have the correct lexical form for an instance of <code>xs:QName</code>.</p><p>A dynamic error is raised [<a href="#ERRFONS0004" title="err:FONS0004">err:FONS0004</a>] if <code>$value</code> has a prefix and there is no namespace binding for <code>$element</code> that matches this prefix.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Sometimes the requirement is to construct an <code>xs:QName</code> without using the default namespace. This can be achieved by writing:</p><div class="exampleInner"><pre xml:space="preserve">if (contains($value, ":"))
then resolve-QName($value, $element)
else QName("", $value)</pre></div><p>If the requirement is to construct an <code>xs:QName</code> using the namespaces in the static context, then the <code>xs:QName</code> constructor should be used.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>Assume that the element bound to <code>$element</code> has a single namespace binding bound to the prefix <code>eg</code>.</p></td></tr><tr><td colspan="2"><p><code>fn:resolve-QName("hello", $element)</code> returns a QName with local name <code>"hello"</code> that is in no namespace.</p></td></tr><tr><td colspan="2"><p><code>fn:resolve-QName("eg:myFunc", $element)</code> returns an <code>xs:QName</code> whose namespace URI is specified by the namespace binding corresponding to the prefix <code>"eg"</code> and whose local name is <code>"myFunc"</code>.</p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="QName-functions"></a>10.2 <a href="#QName-functions" style="text-decoration: none">Functions and operators on QNames</a></h3><p>This section specifies functions on QNames as defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-prefix-from-QName"><code>fn:prefix-from-QName</code></a></td><td>Returns the prefix component of the supplied QName.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-local-name-from-QName"><code>fn:local-name-from-QName</code></a></td><td>Returns the local part of the supplied QName.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-namespace-uri-from-QName"><code>fn:namespace-uri-from-QName</code></a></td><td>Returns the namespace URI part of the supplied QName.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-expanded-QName"><code>fn:expanded-QName</code></a></td><td>Returns a string representation of an <code>xs:QName</code> in the format <code>Q{uri}local</code>.</td></tr></tbody></table><div class="div3"><h4><a id="func-prefix-from-QName"></a>10.2.1 <a href="#func-prefix-from-QName" style="text-decoration: none">fn:prefix-from-QName</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the prefix component of the supplied QName.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:prefix-from-QName</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:QName?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:NCName?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence the function returns the empty sequence.</p><p>If <code>$value</code> has no prefix component the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:NCName</code> representing the prefix component of <code>$value</code>.</p></dd></dl></div><div class="div3"><h4><a id="func-local-name-from-QName"></a>10.2.2 <a href="#func-local-name-from-QName" style="text-decoration: none">fn:local-name-from-QName</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the local part of the supplied QName.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:local-name-from-QName</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:QName?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:NCName?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:NCName</code> representing the local part of <code>$value</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">local-name-from-QName(
  QName("http://www.example.com/example", "person")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"person"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-namespace-uri-from-QName"></a>10.2.3 <a href="#func-namespace-uri-from-QName" style="text-decoration: none">fn:namespace-uri-from-QName</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the namespace URI part of the supplied QName.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:namespace-uri-from-QName</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:QName?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyURI?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence the function returns the empty sequence.</p><p>Otherwise, the function returns an <code>xs:anyURI</code> representing the namespace URI part of <code>$value</code>.</p><p>If <code>$value</code> is in no namespace, the function returns the zero-length <code>xs:anyURI</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">namespace-uri-from-QName(
  QName("http://www.example.com/example", "person")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">xs:anyURI("http://www.example.com/example")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-expanded-QName"></a>10.2.4 <a href="#func-expanded-QName" style="text-decoration: none">fn:expanded-QName</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-base-uri">next</a> | <a href="#func-parse-QName">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1">1</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/207">207</a>&nbsp;15 November 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a string representation of an <code>xs:QName</code> in the format <code>Q{uri}local</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:expanded-QName</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:QName?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, returns the empty sequence.</p><p>The result is a string in the format <code>Q{uri}local</code>, where:</p><ul><li><p><code>uri</code> is the result of <code>fn:string(fn:namespace-uri-from-QName($value))</code> (which will be a zero-length string if the QName is in no namespace), and </p></li><li><p><code>local</code> is the result of <code>fn:local-name-from-QName($value)</code>.</p></li></ul><p>There is no escaping of special characters in the namespace URI. If the namespace URI contains curly braces, the resulting string will not be a valid <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#BracedURILiteral">BracedURILiteral</a><sup><small>XP</small></sup>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">QName("http://example.com/", "person")
=&gt; expanded-QName()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Q{http://example.com/}person"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">QName("", "person")
=&gt; expanded-QName()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Q{}person"</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="NOTATION-functions"></a>10.3 <a href="#NOTATION-functions" style="text-decoration: none">Processing NOTATIONs</a></h3><p>There are no functions designed explicitly to process <code>xs:NOTATION</code> items.</p><p>However, some generic functions such as <a href="#func-atomic-equal"><code>fn:atomic-equal</code></a> and <a href="#func-compare"><code>fn:compare</code></a> can be used on <code>xs:NOTATION</code> items.</p></div></div><div class="div1"><h2><a id="binary-functions"></a>11 <a href="#binary-functions" style="text-decoration: none">Processing binary values</a></h2><p>Binary data is represented using the data types <code>xs:hexBinary</code> and <code>xs:base64Binary</code>. Both types have the same value space: a sequence of octets, which can be considered as integers in the range 0 to 255.</p><p>The coercion rules of XPath 4.0 ensure that the two types are interoperable; a function that declares an argument of type <code>xs:hexBinary</code> will always accept a value of type <code>xs:base64Binary</code>, and vice versa.</p><p>There are no functions defined in this document provided exclusively for processing binary data. A number of generic functions are available:</p><ul><li><p>Functions such as <a href="#func-atomic-equal"><code>fn:atomic-equal</code></a>, <a href="#func-deep-equal"><code>fn:deep-equal</code></a>, and <a href="#func-index-of"><code>fn:index-of</code></a> compare binary values for equality.</p></li><li><p>Functions such as <a href="#func-compare"><code>fn:compare</code></a>, <a href="#func-sort-by"><code>fn:sort-by</code></a>, and <a href="#func-max"><code>fn:max</code></a> compare binary values for ordering.</p></li><li><p>The function <a href="#func-string"><code>fn:string</code></a> creates a string representation of a binary value.</p></li><li><p>The constructor functions <code>xs:string</code>, <code>xs:hexBinary</code>, and <code>xs:base64Binary</code> can be used to convert binary values to and from their string representation.</p></li></ul><p>The function <a href="#func-unparsed-binary"><code>fn:unparsed-binary</code></a> reads an external resource and returns is content as an <code>xs:base64Binary</code> value.</p><p>A library of functions specific to processing of binary data can be found in <a href="#binary-40">[EXPath Binary Module 4.0]</a>.</p></div><div class="div1"><h2><a id="node-functions"></a>12 <a href="#node-functions" style="text-decoration: none">Processing nodes</a></h2><div class="div2"><h3><a id="accessors"></a>12.1 <a href="#accessors" style="text-decoration: none">Accessors</a></h3><p>Accessors and their semantics are described in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. Some of these accessors are exposed to the user through the functions described below.</p><p>Each of these functions has an arity-zero signature which is equivalent to the arity-one form, with the context value supplied as the implicit first argument. In addition, each of the arity-one functions accepts the empty sequence as the argument, in which case it generally delivers the empty sequence as the result: the exception is <a href="#func-string"><code>fn:string</code></a>, which delivers a zero-length string.</p><table class="data"><thead><tr><th>Function</th><th>Accessor</th><th>Accepts</th><th>Returns</th></tr></thead><tbody><tr><td><a href="#func-node-name"><code>fn:node-name</code></a></td><td><code>node-name</code></td><td>node (optional)</td><td><code>xs:QName</code> (optional) </td></tr><tr><td><a href="#func-nilled"><code>fn:nilled</code></a></td><td><code>nilled</code></td><td>node (optional)</td><td><code>xs:boolean</code> (optional) </td></tr><tr><td><a href="#func-string"><code>fn:string</code></a></td><td><code>string-value</code></td><td>item (optional)</td><td><code>xs:string</code></td></tr><tr><td><a href="#func-data"><code>fn:data</code></a></td><td><code>typed-value</code></td><td>zero or more items</td><td>a sequence of atomic items</td></tr><tr><td><a href="#func-base-uri"><code>fn:base-uri</code></a></td><td><code>base-uri</code></td><td>node (optional)</td><td><code>xs:anyURI</code> (optional) </td></tr><tr><td><a href="#func-document-uri"><code>fn:document-uri</code></a></td><td><code>document-uri</code></td><td>node (optional)</td><td><code>xs:anyURI</code> (optional) </td></tr></tbody></table><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-base-uri"><code>fn:base-uri</code></a></td><td>Returns the base URI of a node.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-document-uri"><code>fn:document-uri</code></a></td><td>Returns the URI of a resource where a document can be found, if available.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-nilled"><code>fn:nilled</code></a></td><td>Returns <code>true</code> for an element that is <b>nilled</b>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-node-name"><code>fn:node-name</code></a></td><td>Returns the name of a node, as an <code>xs:QName</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-string"><code>fn:string</code></a></td><td>Returns the value of <code>$value</code> represented as an <code>xs:string</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-data"><code>fn:data</code></a></td><td>Returns the result of atomizing a sequence. This process flattens arrays, and replaces nodes by their typed values.</td></tr></tbody></table><div class="div3"><h4><a id="func-base-uri"></a>12.1.1 <a href="#func-base-uri" style="text-decoration: none">fn:base-uri</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-document-uri">next</a> | <a href="#func-expanded-QName">previous</a>)</p><ol><li><p>An error may now be raised if the base URI is not a valid LEIRI reference.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2148">2148</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2223">2223</a>&nbsp;2 October 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the base URI of a node.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:base-uri</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyURI?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The zero-argument version of the function returns the base URI of the context node: it is equivalent to calling <code>fn:base-uri(.)</code>.</p><p>The single-argument version of the function behaves as follows:</p><ol class="enumar"><li><p>If <code>$node</code> is the empty sequence, the function returns the empty sequence.</p></li><li><p>Otherwise, the function returns the value of the <code>dm:base-uri</code> accessor applied to the node <code>$node</code>. This accessor is defined, for each kind of node, in the XDM specification (See <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-base-uri">7.6.2 base-uri Accessor</a>).</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>As explained in XDM, document, element and processing-instruction nodes have a base-uri property which may be empty. The base-uri property for all other node kinds is the empty sequence. The dm:base-uri accessor returns the base-uri property of a node if it exists and is non-empty; otherwise it returns the result of applying the dm:base-uri accessor to its parent, recursively. If the node does not have a parent, or if the recursive ascent up the ancestor chain encounters a parentless node whose base-uri property is empty, the empty sequence is returned. In the case of namespace nodes, however, the result is always the empty sequence — it does not depend on the base URI of the parent element.</p></div><p>See also <a href="#func-static-base-uri"><code>fn:static-base-uri</code></a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>node()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul><p>A dynamic error <span class="verb">may</span> be raised [<a href="#ERRFORG0002" title="err:FORG0002">err:FORG0002</a>] if the base URI is not a valid Legacy Extended IRI reference (see <a href="#LEIRI">[Legacy extended IRIs for XML resource identification]</a>). </p></dd></dl></div><div class="div3"><h4><a id="func-document-uri"></a>12.1.2 <a href="#func-document-uri" style="text-decoration: none">fn:document-uri</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-has-children">next</a> | <a href="#func-base-uri">previous</a>)</p><ol><li><p>The constraints on the result of the function have been relaxed.<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/898">898</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1161">1161</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1265">1265</a>&nbsp;2 July 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the URI of a resource where a document can be found, if available.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:document-uri</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyURI?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>). </p><p>If <code>$node</code> is the empty sequence, the function returns the empty sequence.</p><p>If <code>$node</code> is not a document node, the function returns the empty sequence.</p><p>Otherwise, the function returns the value of the <code>document-uri</code> accessor applied to <code>$node</code>, as defined in <a href="#xpath-datamodel-31">[XQuery and XPath Data Model (XDM) 3.1]</a> (See <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#DocumentNodeAccessors">7.5.1.2 Accessors</a>).</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>node()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>In the 3.1 version of this specification, it was mandated that two distinct documents could not have the same document-uri property: more specifically, it was guaranteed that for any document node <code>$D</code>, either <code>document-uri($D)</code> would be absent, or <code>doc(document-uri($D))</code> would return <code>$D</code>.</p><p>For various reasons, this constraint has proved impractical. Different parts of an application may read the same external resource in different ways, for example with or without validation or whitespace stripping, leading to different document nodes derived from the same external resource having the same <code>document-uri</code> property. In addition, the specification explicitly allows implementations, at user request, to relax the requirements for determinism of resource access functions, which makes it possible for multiple calls of functions such as <a href="#func-doc"><code>fn:doc</code></a>, <a href="#func-json-doc"><code>fn:json-doc</code></a>, or <a href="#func-collection"><code>fn:collection</code></a> to return different results for the same supplied URI.</p><p>Although the uniqueness of the <code>document-uri</code> property is no longer an absolute constraint, it is still desirable that implementations should where possible respect the principle that URIs are usable as identifiers for resources.</p><p>In the case of a document node <code>$D</code> returned by the <a href="#func-doc"><code>fn:doc</code></a> function, it will generally be the case that <code>fn:document-uri($D)</code> returns a URI <code>$U</code> such that a call on <code>fn:doc($U)</code> in the same dynamic context will return the same document node <code>$D</code>. The URI <code>$U</code> will not necessarily be the same URI that was originally passed to the <a href="#func-doc"><code>fn:doc</code></a> function, since several URIs may identify the same resource.</p><p>It is <span class="verb">recommended</span> that implementations of <a href="#func-collection"><code>fn:collection</code></a> should ensure that any documents included in the returned collection, if they have a non-empty <a href="#func-document-uri"><code>fn:document-uri</code></a> property, should be such that a call on <a href="#func-doc"><code>fn:doc</code></a> supplying this URI returns the same document node.</p></div></dd></dl></div><div class="div3"><h4><a id="func-nilled"></a>12.1.3 <a href="#func-nilled" style="text-decoration: none">fn:nilled</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> for an element that is <b>nilled</b>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:nilled</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>). </p><p>If <code>$node</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise the function returns the result of the <code>dm:nilled</code> accessor as defined in <a href="#xpath-datamodel-31">[XQuery and XPath Data Model (XDM) 3.1]</a> (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-nilled">7.6.8 nilled Accessor</a>).</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>node()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$node</code> is not an element node, the function returns the empty sequence.</p><p>If <code>$node</code> is an untyped element node, the function returns <code>false</code>.</p><p>In practice, the function returns <code>true</code> only for an element node that has the attribute <code>xsi:nil="true"</code> and that is successfully validated against a schema that defines the element to be nillable; the detailed rules, however, are defined in <a href="#xpath-datamodel-31">[XQuery and XPath Data Model (XDM) 3.1]</a>.</p></div></dd></dl></div><div class="div3"><h4><a id="func-node-name"></a>12.1.4 <a href="#func-node-name" style="text-decoration: none">fn:node-name</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the name of a node, as an <code>xs:QName</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:node-name</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:QName?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>).</p><p>If <code>$node</code> is the empty sequence, the empty sequence is returned.</p><p>Otherwise, the function returns the result of the <code>dm:node-name</code> accessor as defined in <a href="#xpath-datamodel-31">[XQuery and XPath Data Model (XDM) 3.1]</a> (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-node-name">7.6.10 node-name Accessor</a>).</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup>.</p></li><li><p>If the context value is not an instance of the sequence type <code>node()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>For element and attribute nodes, the name of the node is returned as an <code>xs:QName</code>, retaining the prefix, namespace URI, and local part.</p><p>For processing instructions, the name of the node is returned as an <code>xs:QName</code> in which the prefix and namespace URI are <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>.</p><p>For a namespace node, the function returns the empty sequence if the node represents the default namespace; otherwise it returns an <code>xs:QName</code> in which prefix and namespace URI are <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup> and the local part is the namespace prefix being bound.</p><p>For all other kinds of node, the function returns the empty sequence.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $e := &lt;doc&gt;
  &lt;p id="alpha" xml:id="beta"&gt;One&lt;/p&gt;
  &lt;p id="gamma" xmlns="http://example.com/ns"&gt;Two&lt;/p&gt;
  &lt;ex:p id="delta" xmlns:ex="http://example.com/ns"&gt;Three&lt;/ex:p&gt;
  &lt;?pi 3.14159?&gt;
&lt;/doc&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>node-name($e//*[@id = 'alpha'])</code></pre></div></td><td style="vertical-align:top"><p><code>QName("", "p")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>node-name($e//*[@id = 'gamma'])</code></pre></div></td><td style="vertical-align:top"><p><code>QName("http://example.com/ns", "p")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>node-name($e//*[@id = 'delta'])</code></pre></div></td><td style="vertical-align:top"><p><code>QName("http://example.com/ns", "ex:p")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>node-name($e//processing-instruction())</code></pre></div></td><td style="vertical-align:top"><p><code>QName("", "pi")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>node-name($e//*[@id = 'alpha']/text())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>node-name($e//*[@id = 'alpha']/@id)</code></pre></div></td><td style="vertical-align:top"><p><code>QName("", "id")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>node-name($e//*[@id = 'alpha']/@xml:id)</code></pre></div></td><td style="vertical-align:top"><p><code>#xml:id</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-string"></a>12.1.5 <a href="#func-string" style="text-decoration: none">fn:string</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the value of <code>$value</code> represented as an <code>xs:string</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:string</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>In the zero-argument version of the function, <code>$value</code> defaults to the context value. That is, calling <code>fn:string()</code> is equivalent to calling <code>fn:string(.)</code>.</p><p>If <code>$value</code> is the empty sequence, the function returns the zero-length string.</p><p>If <code>$value</code> is an <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-XNode">XNode</a><sup><small>DM</small></sup>, the function returns the string value of the node, as obtained using the <code>dm:string-value</code> accessor defined in <a href="#xpath-datamodel-31">[XQuery and XPath Data Model (XDM) 3.1]</a> (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-string-value">7.6.12 string-value Accessor</a>).</p><p>If <code>$value</code> is a <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JNode">JNode</a><sup><small>DM</small></sup>, the function returns the result of <code>string(jnode-content($value))</code>. This will fail in the case where <code>jnode-content($value)</code> is a map or an array.</p><p><span style="display: none;" class="delete_version">If <code>$value</code> is an atomic item, the function returns the result of the expression <code>$value cast as xs:string</code> (see <a href="#casting"><span class="delete_version"><b>23 Casting</b></span><span class="modify_version"><b>23 Casting</b></span></a>).</span><span style="display: none;" class="add_version">If <code>$value</code> is an atomic item, the function returns the result of the expression <code>$value cast as xs:string</code> (see <a href="#casting"><span class="add_version"><b>24 Casting</b></span><span class="modify_version"><b>24 Casting</b></span></a>).</span><span class="modify_version">If <code>$value</code> is an atomic item, the function returns the result of the expression <code>$value cast as xs:string</code> (see <a href="#casting"><span style="display: none;" class="delete_version"><b>23 Casting</b></span><span style="display: none;" class="add_version"><b>24 Casting</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23</span><span class="deltaxml-new" style="background:#90EE90">24</span> Casting</b></span></a>).</span></p><p>In all other cases, a dynamic error occurs (see below).</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$value</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup>.</p></li><li><p>If the context value is not an instance of the sequence type <code>item()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul><p>A type error is raised [<a href="#ERRFOTY0014" title="err:FOTY0014">err:FOTY0014</a>] if <code>$value</code> is a function item (this includes maps and arrays).</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Every node has a string value, even an element with element-only content (which has no typed value). Moreover, casting an atomic item to a string always succeeds. Functions, maps, and arrays have no string value, so these satisfy the type signature but cause failure. Applying the <a href="#func-string"><code>string</code></a> function to a JNode succeeds if the JNode wraps a simple value such as a string, number, or boolean, or if it wraps an XNode, but it fails in the case where the JNode wraps a map or an array.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $para := &lt;para&gt;There lived a &lt;term author="Tolkien"&gt;hobbit&lt;/term&gt;.&lt;/para&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>string(23)</code></pre></div></td><td style="vertical-align:top"><p><code>"23"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>string(false())</code></pre></div></td><td style="vertical-align:top"><p><code>"false"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>string("Paris")</code></pre></div></td><td style="vertical-align:top"><p><code>"Paris"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>string((1, 2, 3))</code></pre></div></td><td style="vertical-align:top"><p>Raises error XPTY0004.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>string([ [ 1, 2 ], [ 3, 4 ] ])</code></pre></div></td><td style="vertical-align:top"><p>Raises error FOTY0014.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>string(abs#1)</code></pre></div></td><td style="vertical-align:top"><p>Raises error FOTY0014.</p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>string({"x": [10, 20, 30]} / x / *[3])</code></pre></div></td><td style="vertical-align:top"><p><code>"30"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>string($para)</code></pre></div></td><td style="vertical-align:top"><p><code>"There lived a hobbit."</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-data"></a>12.1.6 <a href="#func-data" style="text-decoration: none">fn:data</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the result of atomizing a sequence. This process flattens arrays, and replaces nodes by their typed values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:data</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>).</p><p> The result of <a href="#func-data"><code>fn:data</code></a> is the sequence of atomic items produced by applying the following rules to each item in <code>$input</code>:</p><ul><li><p>If the item is an atomic item, it is appended to the result sequence.</p></li><li><p>If the item is an <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-XNode">XNode</a><sup><small>DM</small></sup>, the typed value of the node is appended to the result sequence. The typed value is a sequence of zero or more atomic items: specifically, the result of the <code>dm:typed-value</code> accessor as defined in <a href="#xpath-datamodel-31">[XQuery and XPath Data Model (XDM) 3.1]</a> (See <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-typed-value">7.6.14 typed-value Accessor</a>).</p></li><li><p>If the item is a <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JNode">JNode</a><sup><small>DM</small></sup>, the atomized value of its <b>·content·</b> property is appended to the result sequence.</p></li><li><p>If the item is an array, the result of applying <a href="#func-data"><code>fn:data</code></a> to each member of the array, in order, is appended to the result sequence.</p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="#ERRFOTY0012" title="err:FOTY0012">err:FOTY0012</a>] if an item in the sequence <code>$input</code> is a node that does not have a typed value. </p><p>A type error is raised [<a href="#ERRFOTY0013" title="err:FOTY0013">err:FOTY0013</a>] if an item in the sequence <code>$input</code> is a function item other than an array. </p><p>A type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup> if <code>$input</code> is omitted and the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The process of applying the <a href="#func-data"><code>fn:data</code></a> function to a sequence is referred to as <b>atomization</b>. In many cases an explicit call on <a href="#func-data"><code>fn:data</code></a> is not required, because atomization is invoked implicitly when a node or sequence of nodes is supplied in a context where an atomic item or sequence of atomic items is required.</p><p>The result of atomizing the empty sequence is the empty sequence.</p><p>The result of atomizing the empty array is the empty sequence.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $para := &lt;para&gt;There lived a &lt;term author="Tolkien"&gt;hobbit&lt;/term&gt;.&lt;/para&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>data(123)</code></pre></div></td><td style="vertical-align:top"><p><code>123</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>data((123, 456))</code></pre></div></td><td style="vertical-align:top"><p><code>123, 456</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>data([ [ 1, 2 ], [ 3, 4 ] ])</code></pre></div></td><td style="vertical-align:top"><p><code>1, 2, 3, 4</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>data($para)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:untypedAtomic("There lived a hobbit.")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>data($para/term/@author)</code></pre></div></td><td style="vertical-align:top"><p><code>xs:untypedAtomic("Tolkien")</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>data(abs#1)</code></pre></div></td><td style="vertical-align:top"><p>Raises error FOTY0013.</p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="other-node-functions"></a>12.2 <a href="#other-node-functions" style="text-decoration: none">Other properties of nodes</a></h3><p>This section specifies further functions that return properties of nodes. Nodes are formally defined in <a href="https://www.w3.org/TR/xpath-datamodel-31/#Node"> 6 Nodes </a><sup><small>DM31</small></sup>.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-has-children"><code>fn:has-children</code></a></td><td>Returns <code>true</code> if the supplied GNode has one or more child nodes (of any kind).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-in-scope-namespaces"><code>fn:in-scope-namespaces</code></a></td><td>Returns the in-scope namespaces of an element node, as a map.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-in-scope-prefixes"><code>fn:in-scope-prefixes</code></a></td><td>Returns the prefixes of the in-scope namespaces for an element node.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-lang"><code>fn:lang</code></a></td><td>This function tests whether the language of <code>$node</code>, or the context value if the second argument is omitted, as specified by <code>xml:lang</code> attributes is the same as, or is a sublanguage of, the language specified by <code>$language</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-local-name"><code>fn:local-name</code></a></td><td>Returns the local part of the name of <code>$node</code> as an <code>xs:string</code> that is either the zero-length string, or has the lexical form of an <code>xs:NCName</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-name"><code>fn:name</code></a></td><td>Returns the name of a node, as an <code>xs:string</code> that is either the zero-length string, or has the lexical form of an <code>xs:QName</code>. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-namespace-uri"><code>fn:namespace-uri</code></a></td><td>Returns the namespace URI part of the name of <code>$node</code>, as an <code>xs:anyURI</code> value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-namespace-uri-for-prefix"><code>fn:namespace-uri-for-prefix</code></a></td><td>Returns the namespace URI of one of the in-scope namespaces for <code>$element</code>, identified by its namespace prefix.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-path"><code>fn:path</code></a></td><td>Returns a path expression that can be used to select the supplied node relative to the root of its containing document.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-root"><code>fn:root</code></a></td><td>Returns the root of the tree to which <code>$node</code> belongs. The function can be applied both to <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-XNode">XNodes</a><sup><small>DM</small></sup> and to <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JNode">JNodes</a><sup><small>DM</small></sup>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-siblings"><code>fn:siblings</code></a></td><td>Returns the supplied GNode together with its siblings, in document order.</td></tr></tbody></table><div class="div3"><h4><a id="func-has-children"></a>12.2.1 <a href="#func-has-children" style="text-decoration: none">fn:has-children</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-in-scope-namespaces">next</a> | <a href="#func-document-uri">previous</a>)</p><ol><li><p>Generalized to work with JNodes as well as XNodes.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2100">2100</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2149">2149</a>&nbsp;12 August 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the supplied GNode has one or more child nodes (of any kind).</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:has-children</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>gnode()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>).</p><p>Provided that the supplied argument <code>$node</code> matches the expected type <code>gnode()?</code>, the result of the function call <code>fn:has-children($node)</code> is defined to be the same as the result of the expression <code>fn:exists($node/child::gnode())</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>gnode()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$node</code> is the empty sequence the result is <code>false</code>.</p><p>The motivation for this function is to support streamed evaluation. According to the streaming rules in <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a>, the following construct is not streamable:</p><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;xsl:if test="exists(row)"&gt;
  &lt;ulist&gt;
    &lt;xsl:for-each select="row"&gt;
      &lt;item&gt;&lt;xsl:value-of select="."/&gt;&lt;/item&gt;
    &lt;/xsl:for-each&gt;
  &lt;/ulist&gt;
&lt;/xsl:if&gt;</pre></div><p>This is because it makes two downward selections to read the child <code>row</code> elements. The use of <a href="#func-has-children"><code>fn:has-children</code></a> in the <code>xsl:if</code> conditional is intended to circumvent this restriction.</p><p>Although the function was introduced to support streaming use cases, it has general utility as a convenience function.</p><p>If the supplied argument is a map or an array, it will automatically be coerced to a JNode.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $e := &lt;doc&gt;
  &lt;p id="alpha"&gt;One&lt;/p&gt;
  &lt;p/&gt;
  &lt;p&gt;Three&lt;/p&gt;
  &lt;?pi 3.14159?&gt;
&lt;/doc&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>has-children($e)</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>has-children($e//p[1])</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>has-children($e//p[2])</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>has-children($e//p[3])</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>has-children($e//processing-instruction())</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>has-children($e//p[1]/text())</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>has-children($e//p[1]/@id)</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>jtree([1,2,3]) =&gt; has-children()</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>jtree([]) =&gt; has-children()</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-in-scope-namespaces"></a>12.2.2 <a href="#func-in-scope-namespaces" style="text-decoration: none">fn:in-scope-namespaces</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-path">next</a> | <a href="#func-has-children">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[&nbsp;&nbsp;20 September 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the in-scope namespaces of an element node, as a map.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:in-scope-namespaces</code>(</td></tr><tr class="arg"><td><code>$element</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>element()</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map((xs:NCName | enum('')), xs:anyURI)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a map representing the prefixes of the in-scope namespaces for <code>$element</code>. The map contains one entry for each in-scope namespace: the key of the entry is the namespace prefix or a zero-length string, and the corresponding value is the namespace URI.</p><p>For namespace bindings that have a prefix, the key represents the prefix as an instance of <code>xs:NCName</code>. For the default namespace, which has no prefix, the key is the zero-length string as an instance of <code>xs:string</code>.</p><p>The order of entries in the returned map is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The XML namespace is in scope for every element, so the result will always include an entry with key <code>"xml"</code> and corresponding value <code>http://www.w3.org/XML/1998/namespace</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $e := 
&lt;z:a xmlns="http://example.org/one" xmlns:z="http://example.org/two"&gt;
  &lt;b xmlns=""/&gt;
&lt;/z:a&gt;</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>in-scope-namespaces($e)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "": "http://example.org/one",
  "z": "http://example.org/two",
  "xml": "http://www.w3.org/XML/1998/namespace"
}</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-in-scope-prefixes"></a>12.2.3 <a href="#func-in-scope-prefixes" style="text-decoration: none">fn:in-scope-prefixes</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the prefixes of the in-scope namespaces for an element node.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:in-scope-prefixes</code>(</td></tr><tr class="arg"><td><code>$element</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>element()</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic with respect to ordering" class="termref" href="#dt-nondeterministic-wrt-ordering">nondeterministic-wrt-ordering</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the result of the expression <code>map:keys(fn:in-scope-namespaces($element))</code> (but in no defined order).</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The XML namespace is in scope for every element, so the result will always include the string <code>"xml"</code>.</p></div></dd></dl></div><div class="div3"><h4><a id="func-lang"></a>12.2.4 <a href="#func-lang" style="text-decoration: none">fn:lang</a></h4><dl><dt class="label">Summary</dt><dd><p>This function tests whether the language of <code>$node</code>, or the context value if the second argument is omitted, as specified by <code>xml:lang</code> attributes is the same as, or is a sublanguage of, the language specified by <code>$language</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:lang</code>(</td></tr><tr class="arg"><td><code>$language</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The behavior of the function if the second argument is omitted is exactly the same as if the context value (<code>.</code>) had been passed as the second argument.</p><p>The language of the argument <code>$node</code>, or the context value if the second argument is omitted, is determined by the value of the <code>xml:lang</code> attribute on the node, or, if the node has no such attribute, by the value of the <code>xml:lang</code> attribute on the nearest ancestor of the node that has an <code>xml:lang</code> attribute. If there is no such ancestor, then the function returns <code>false</code>. </p><p>If <code>$language</code> is the empty sequence it is interpreted as the zero-length string.</p><p>The relevant <code>xml:lang</code> attribute is determined by the value of the XPath expression:</p><div class="exampleInner"><pre xml:space="preserve">(ancestor-or-self::*/@xml:lang)[last()]</pre></div><p>If this expression returns the empty sequence, the function returns <code>false</code>. </p><p>Otherwise, the function returns <code>true</code> if and only if, based on a caseless default match as specified in section 3.13 of <a href="#Unicode">[The Unicode Standard]</a>, either:</p><ol class="enumar"><li><p><code>$language</code> is equal to the string-value of the relevant <code>xml:lang</code> attribute, or</p></li><li><p><code>$language</code> is equal to some substring of the string-value of the relevant <code>xml:lang</code> attribute that starts at the start of the string-value and ends immediately before a hyphen, <code>-</code> (HYPHEN-MINUS, <code>#x002D</code>).</p></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not a single node, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The expression <code>fn:lang("en")</code> would return <code>true</code> if the context node were any of the following four elements:</p></td></tr><tr><td colspan="2"><ul><li><p><code>&lt;para xml:lang="en"/&gt;</code></p></li><li><p><code>&lt;div xml:lang="en"&gt;&lt;para&gt;And now, and forever!&lt;/para&gt;&lt;/div&gt;</code></p></li><li><p><code>&lt;para xml:lang="EN"/&gt;</code></p></li><li><p><code>&lt;para xml:lang="en-us"/&gt;</code></p></li></ul></td></tr><tr><td colspan="2"><p>The expression <code>fn:lang("fr")</code> would return <code>false</code> if the context node were <code>&lt;para xml:lang="EN"/&gt;</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-local-name"></a>12.2.5 <a href="#func-local-name" style="text-decoration: none">fn:local-name</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the local part of the name of <code>$node</code> as an <code>xs:string</code> that is either the zero-length string, or has the lexical form of an <code>xs:NCName</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:local-name</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>).</p><p>If the argument is supplied and is the empty sequence, the function returns the zero-length string.</p><p>If the node identified by <code>$node</code> has no name (that is, if it is a document node, a comment, a text node, or a namespace node having no name), the function returns the zero-length string.</p><p>Otherwise, the function returns the local part of the expanded-QName of the node identified by <code>$node</code>, as determined by the <code>dm:node-name</code> accessor defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-node-name">7.6.10 node-name Accessor</a>. This will be an <code>xs:string</code> whose lexical form is an <code>xs:NCName</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not a single node, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $e := &lt;doc&gt;
  &lt;p id="alpha" xml:id="beta"&gt;One&lt;/p&gt;
  &lt;p id="gamma" xmlns="http://example.com/ns"&gt;Two&lt;/p&gt;
  &lt;ex:p id="delta" xmlns:ex="http://example.com/ns"&gt;Three&lt;/ex:p&gt;
  &lt;?pi 3.14159?&gt;
&lt;/doc&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>local-name($e//*[@id = 'alpha'])</code></pre></div></td><td style="vertical-align:top"><p><code>"p"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>local-name($e//*[@id = 'gamma'])</code></pre></div></td><td style="vertical-align:top"><p><code>"p"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>local-name($e//*[@id = 'delta'])</code></pre></div></td><td style="vertical-align:top"><p><code>"p"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>local-name($e//processing-instruction())</code></pre></div></td><td style="vertical-align:top"><p><code>"pi"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>local-name($e//*[@id = 'alpha']/text())</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>local-name($e//*[@id = 'alpha']/@id)</code></pre></div></td><td style="vertical-align:top"><p><code>"id"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>local-name($e//*[@id = 'alpha']/@xml:id)</code></pre></div></td><td style="vertical-align:top"><p><code>"id"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-name"></a>12.2.6 <a href="#func-name" style="text-decoration: none">fn:name</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the name of a node, as an <code>xs:string</code> that is either the zero-length string, or has the lexical form of an <code>xs:QName</code>. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:name</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>).</p><p>If the argument is supplied and is the empty sequence, the function returns the zero-length string.</p><p>If the node identified by <code>$node</code> has no name (that is, if it is a document node, a comment, a text node, or a namespace node having no name), the function returns the zero-length string.</p><p>Otherwise, the function returns the value of the expression <code>fn:string(fn:node-name($node))</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>node()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>Because the result depends on the choice of namespace prefixes in the source document, it is not good practice to use the result of this function for anything other than display purposes. For example, the test <code>name(.) = 'my:profile'</code> will fail if the source document uses an unexpected namespace prefix. Such a test (assuming it relates to an element node) is better written as <code>boolean(self::my:profile)</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $e := &lt;doc&gt;
  &lt;p id="alpha" xml:id="beta"&gt;One&lt;/p&gt;
  &lt;p id="gamma" xmlns="http://example.com/ns"&gt;Two&lt;/p&gt;
  &lt;ex:p id="delta" xmlns:ex="http://example.com/ns"&gt;Three&lt;/ex:p&gt;
  &lt;?pi 3.14159?&gt;
&lt;/doc&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>name($e//*[@id = 'alpha'])</code></pre></div></td><td style="vertical-align:top"><p><code>"p"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>name($e//*[@id = 'gamma'])</code></pre></div></td><td style="vertical-align:top"><p><code>"p"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>name($e//*[@id = 'delta'])</code></pre></div></td><td style="vertical-align:top"><p><code>"ex:p"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>name($e//processing-instruction())</code></pre></div></td><td style="vertical-align:top"><p><code>"pi"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>name($e//*[@id = 'alpha']/text())</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>name($e//*[@id = 'alpha']/@id)</code></pre></div></td><td style="vertical-align:top"><p><code>"id"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>name($e//*[@id = 'alpha']/@xml:id)</code></pre></div></td><td style="vertical-align:top"><p><code>"xml:id"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-namespace-uri"></a>12.2.7 <a href="#func-namespace-uri" style="text-decoration: none">fn:namespace-uri</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the namespace URI part of the name of <code>$node</code>, as an <code>xs:anyURI</code> value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:namespace-uri</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyURI</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context node (<code>.</code>). </p><p>If the node identified by <code>$node</code> is neither an element nor an attribute node, or if it is an element or attribute node whose expanded-QName (as determined by the <code>dm:node-name</code> accessor in the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-node-name">7.6.10 node-name Accessor</a>) is in no namespace, then the function returns the zero-length <code>xs:anyURI</code> value.</p><p>Otherwise, the result will be the namespace URI part of the expanded-QName of the node identified by <code>$node</code>, as determined by the <code>dm:node-name</code> accessor defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-node-name">7.6.10 node-name Accessor</a>), returned as an <code>xs:anyURI</code> value.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>node()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $e := &lt;doc&gt;
  &lt;p id="alpha" xml:id="beta"&gt;One&lt;/p&gt;
  &lt;p id="gamma" xmlns="http://example.com/ns"&gt;Two&lt;/p&gt;
  &lt;ex:p id="delta" xmlns:ex="http://example.com/ns"&gt;Three&lt;/ex:p&gt;
  &lt;?pi 3.14159?&gt;
&lt;/doc&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri($e//*[@id = 'alpha'])</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri($e//*[@id = 'gamma'])</code></pre></div></td><td style="vertical-align:top"><p><code>"http://example.com/ns"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri($e//*[@id = 'delta'])</code></pre></div></td><td style="vertical-align:top"><p><code>"http://example.com/ns"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri($e//processing-instruction())</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri($e//*[@id = 'alpha']/text())</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri($e//*[@id = 'alpha']/@id)</code></pre></div></td><td style="vertical-align:top"><p><code>""</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri($e//*[@id = 'alpha']/@xml:id)</code></pre></div></td><td style="vertical-align:top"><p><code>"http://www.w3.org/XML/1998/namespace"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-namespace-uri-for-prefix"></a>12.2.8 <a href="#func-namespace-uri-for-prefix" style="text-decoration: none">fn:namespace-uri-for-prefix</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the namespace URI of one of the in-scope namespaces for <code>$element</code>, identified by its namespace prefix.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:namespace-uri-for-prefix</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:NCName | enum(''))?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$element</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>element()</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyURI?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the result of the expression <code>map:get(fn:in-scope-namespaces($element), string($value))</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $e := 
&lt;z:a xmlns="http://example.org/one" xmlns:z="http://example.org/two"&gt;
  &lt;b xmlns=""/&gt;
&lt;/z:a&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri-for-prefix("z", $e)</code></pre></div></td><td style="vertical-align:top"><p><code>"http://example.org/two"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri-for-prefix("", $e)</code></pre></div></td><td style="vertical-align:top"><p><code>"http://example.org/one"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri-for-prefix((), $e)</code></pre></div></td><td style="vertical-align:top"><p><code>"http://example.org/one"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>namespace-uri-for-prefix("xml", $e)</code></pre></div></td><td style="vertical-align:top"><p><code>"http://www.w3.org/XML/1998/namespace"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-path"></a>12.2.9 <a href="#func-path" style="text-decoration: none">fn:path</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-siblings">next</a> | <a href="#func-in-scope-namespaces">previous</a>)</p><ol><li><p>Options are added to customize the form of the output.<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/332">332</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1660">1660</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1620">1620</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1886">1886</a>&nbsp;29 November 2024]</i></p></li><li><p>The function is extended to handle JNodes.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2100">2100</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2149">2149</a>&nbsp;5 August 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a path expression that can be used to select the supplied node relative to the root of its containing document.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:path</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>gnode()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code>,</td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The behavior of the function if the <code>$node</code>argument is omitted is exactly the same as if the context value (<code>.</code>) had been passed as the argument.</p><p>If <code>$node</code> is the empty sequence, the function returns the empty sequence.</p><p>The <code>$options</code> argument, if present, defines additional parameters controlling how the output is formatted. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply. The options available are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">origin?</code></td><td><code class="as">as&nbsp;</code><code>gnode()?</code>,</td></tr><tr class="arg"><td><code class="opt">lexical?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">namespaces?</code></td><td><code class="as">as&nbsp;</code><code>map((xs:NCName | enum('')), xs:anyURI)?</code>,</td></tr><tr class="arg"><td><code class="opt">indexes?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>origin?</code></p></td><td class="fos-thin">A GNode, which must be an ancestor of <code>$node</code>. If present, the returned path will be a relative path that selects <code>$node</code> starting from the supplied origin node, rather than from the root of the containing tree. <ul><li><p><b>Type: </b><code>gnode()?</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>lexical?</code></p></td><td class="fos-thin">If true, the names of element nodes in the path are represented by the result of a call on the <a href="#func-name"><code>name</code></a> function applied to each element. The result in this case does not contain sufficient information to identify the namespace URI of the element. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>namespaces?</code></p></td><td class="fos-thin">A map from namespace prefixes to namespace URIs, such as might be returned by the function <a href="#func-in-scope-namespaces"><code>fn:in-scope-namespaces</code></a>. If a prefix is available for a given URI, it is used in preference to using <code>Q{uri}local</code> notation. <ul><li><p><b>Type: </b><code>map((xs:NCName | enum('')), xs:anyURI)?</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>indexes?</code></p></td><td class="fos-thin">If true, the returned path includes the index positions of nodes. If false, only the node names are included. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr></tbody></table><p>Let <var>R</var> be the GNode supplied in the <code>origin</code> option, or the root GNode of the tree containing <code>$node</code> otherwise.</p><p>If <code>$node</code> is a document node, or a JNode with no parent, the function returns the string <code>"/"</code>.</p><p>Otherwise, the function returns a string that consists of a sequence of steps, one for each ancestor-or-self of <code>$node</code> that is not an ancestor-or-self of <var>R</var>.</p><p>If <var>R</var> is an XNode other than a document node and the <code>origin</code> option is absent or empty, then this string is preceded by a string notionally representing a call to the <a href="#func-root"><code>fn:root</code></a> function, expressed as follows:</p><ul><li><p>If the <code>lexical</code> option is present with the value <code>true</code>, then the string <code>"fn:root()"</code>.</p></li><li><p>If the <code>namespaces</code> option is present and defines a mapping from a non empty prefix <var>P</var> to the namespace URI <code>http://www.w3.org/2005/xpath-functions</code>, then <code>"<var>P</var>:root()"</code></p></li><li><p>If the <code>namespaces</code> option is present and defines a mapping from the empty string to the namespace URI <code>http://www.w3.org/2005/xpath-functions</code>, then <code>"root()"</code></p></li><li><p>Otherwise, <code>"Q{http://www.w3.org/2005/xpath-functions}root()"</code>.</p></li></ul><p>Each step is the concatenation of:</p><ol class="enumar"><li><p>The character <code>"/"</code>, which is omitted for the first step if the <code>origin</code> option is present;</p></li><li><p>A string whose form depends on the kind of node selected by that step, as follows:</p><ol class="enumla"><li><p>For an element node, the concatenation of:</p><ol class="enumlr"><li><p>A representation of the element name, chosen as follows:</p><ol class="enumua"><li><p>If the <code>lexical</code> option is present with the value <code>true</code>, then the result of applying the <a href="#func-name"><code>name</code></a> function to the element node.</p></li><li><p>Otherwise, if the <code>namespaces</code> option is present and the element is in a namespace <var>U</var> and the <code>namespaces</code> option includes a mapping from a prefix <var>P</var> to the namespace <var>U</var>, then the string <code><var>P</var>:<var>L</var></code>, where <var>L</var> is the local part of the element name. If there is more than one such prefix, then one of them is chosen arbitrarily.</p></li><li><p>Otherwise, if the <code>namespaces</code> option is present and the element is in a namespace <var>U</var> and the <code>namespaces</code> option includes a mapping from the zero-length string to the namespace <var>U</var>, then the local part of the element name.</p></li><li><p>Otherwise, if the <code>namespaces</code> option is present and the element is in no namespace and the <code>namespaces</code> option includes no mapping from the zero-length string to any namespace, then the local part of the element name.</p></li><li><p>Otherwise, the string <code>Q{<var>U</var>}<var>L</var></code>, where <var>U</var> is the namespace URI of the element name or the empty string if the element is in no namespace, and <var>L</var> is the local part of the element name.</p></li></ol></li><li><p>Unless the <code>indexes</code> option is present with the value <code>false</code>, a string in the form <code>[<var>position</var>]</code> where <var>position</var> is an integer representing the one-based position of the selected node among its like-named siblings.</p></li></ol></li><li><p>For an attribute node, the concatenation of:</p><ol class="enumlr"><li><p>The character <code>"@"</code></p></li><li><p>If the <code>lexical</code> option is present with the value <code>true</code>, then the result of applying the <a href="#func-name"><code>name</code></a> function to the attribute node.</p></li><li><p>Otherwise, if the attribute node is in no namespace, the local part of the attribute name.</p></li><li><p>Otherwise, if the <code>namespaces</code> option is present, and if it includes a mapping from a non-empty namespace prefix <var>P</var> to the namespace URI of the attribute, then a string in the form <code><var>P</var>:<var>L</var></code>, where <var>L</var> is the local part of the attribute name. If there is more than one such prefix, then one of them is chosen arbitrarily.</p></li><li><p>Otherwise, the string <code>Q{<var>U</var>}<var>L</var></code>, where <var>U</var> is the namespace URI of the attribute name, and <var>L</var> is the local part of the attribute name.</p></li></ol></li><li><p>For a text node: <code>text()[<var>position</var>]</code> where <code><var>position</var></code> is an integer representing the position of the selected node among its text node siblings.</p><p>The suffix <code>[<var>position</var>]</code> is omitted if the <code>indexes</code> option is present with the value <code>false</code>.</p></li><li><p>For a comment node: <code>comment()[<var>position</var>]</code> where <code><em>position</em></code> is an integer representing the position of the selected node among its comment node siblings.</p><p>The suffix <code>[<var>position</var>]</code> is omitted if the <code>indexes</code> option is present with the value <code>false</code>.</p></li><li><p>For a processing-instruction node: <code>processing-instruction(<var>local</var>)[<var>position</var>]</code> where <code><em>local</em></code> is the name of the processing instruction node and <code><em>position</em></code> is an integer representing the position of the selected node among its like-named processing-instruction node siblings.</p><p>The suffix <code>[<var>position</var>]</code> is omitted if the <code>indexes</code> option is present with the value <code>false</code>.</p></li><li><p>For a namespace node:</p><ol class="enumlr"><li><p>If the namespace node has a name: <code>namespace::<em>prefix</em></code>, where <code><em>prefix</em></code> is the local part of the name of the namespace node (which represents the namespace prefix).</p></li><li><p>If the namespace node has no name (that is, if it represents the default namespace): <code>namespace::*[<var>U</var>local-name() = ""]</code></p><p>Here <code><var>U</var>local-name()</code> represents a call on the function <a href="#func-local-name"><code>fn:local-name</code></a> and is formatted using the same conventions as the call on <a href="#func-root"><code>fn:root</code></a> described earlier.</p></li></ol></li><li><p>For a JNode where the ·content· property of the parent is an array, then as the string <code>*[<var>N</var>]</code> where <var>N</var> is the value of the ·selector· property.</p></li><li><p>For any other JNode (including the case where the ·content· property of the parent is a map):</p><ol class="enumlr"><li><p>If the value is an <code>xs:string</code>, <code>xs:untypedAtomic</code>, or <code>xs:anyURI</code> that is castable to <code>xs:NCName</code>, then the result of casting the value to <code>xs:NCName</code>.</p></li><li><p>If the value is an <code>xs:string</code>, <code>xs:untypedAtomic</code>, or <code>xs:anyURI</code> that is not castable to <code>xs:NCName</code>, then then as the string <code>get("<var>S</var>")</code> where <var>S</var> is the string value.</p></li><li><p>If the value is numeric, then as the string <code>get(<var>N</var>)</code> where <var>N</var> is the result of casting the numeric value to <code>xs:string</code>.</p></li><li><p>If the value is an <code>xs:QName</code>, then as the string <code>get(#Q{<var>uri</var>}<var>local</var>)</code> where <var>uri</var> and <var>local</var> are the namespace URI and local name parts of the QName.</p></li><li><p>If the value is an <code>xs:boolean</code>, then as the string <code>get(true())</code> or <code>get(false())</code>.</p></li><li><p>If the value is of any other type, then as the string <code>get(xs:<var>T</var>("<var>S</var>"))</code> where <var>T</var> is the local part of the most specific built-in atomic type of which the value is an instance, and <var>S</var> is the result of casting the value to <code>xs:string</code>.</p></li></ol><p>TODO: Better handling of the case where the parent is neither a map nor an array, for example where it is a sequence of several maps or several arrays. It's hard to provide a better path for these when there is no <code>AxisStep</code> for selecting within such values.</p></li></ol></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>gnode()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul><p>If the value of the <code>origin</code> option is a node that is not an ancestor of <code>$node</code> (or in the absence of <code>$node</code>, the context value), dynamic error [<a href="#ERRFOPA0001" title="err:FOPA0001">err:FOPA0001</a>].</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Using the <code>namespaces</code> option to shorten the generated path is often convenient, but the resulting path may be unusable if the input tree contains multiple bindings for the same prefix.</p><p>Similarly, using the <code>lexical</code> option is convenient if there is no need for precise namespace information: it is especially suitable when the containing node tree declares no namespaces.</p><p>If the supplied argument is a map or an array, it will automatically be coerced to a JNode. This however is not useful, because this will be a root JNode, yielding the path <code>/</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $e := document {            
  &lt;p xmlns="http://example.com/one" xml:lang="de" author="Friedrich von Schiller"&gt;
Freude, schöner Götterfunken,&lt;br/&gt;
Tochter aus Elysium,&lt;br/&gt;
Wir betreten feuertrunken,&lt;br/&gt;
Himmlische, dein Heiligtum.
&lt;/p&gt;}</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $emp := 
  &lt;employee xml:id="ID21256"&gt;
     &lt;empnr&gt;E21256&lt;/empnr&gt;
     &lt;first&gt;John&lt;/first&gt;
     &lt;last&gt;Brown&lt;/last&gt;
  &lt;/employee&gt;</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e/*:p)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/Q{http://example.com/one}p[1]'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e/*:p, { 'namespaces': in-scope-namespaces($e/*) })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/p[1]'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e/*:p, { 'indexes': false() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/Q{http://example.com/one}p'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e/*:p/@xml:lang)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/Q{http://example.com/one}p[1]/@Q{http://www.w3.org/XML/1998/namespace}lang'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e//@xml:lang, { 'namespaces': in-scope-namespaces($e/*) })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/p[1]/@xml:lang'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e/*:p/@author)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/Q{http://example.com/one}p[1]/@author'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e/*:p/*:br[2])</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/Q{http://example.com/one}p[1]/Q{http://example.com/one}br[2]'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e/*:p/*:br[2], {
  'namespaces': { 'N': 'http://example.com/one' },
  'indexes': false() 
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/N:p/N:br'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e//text()[starts-with(normalize-space(), 'Tochter')])</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/Q{http://example.com/one}p[1]/text()[2]'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e/*:p/*:br[2], { 'lexical': true() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'/p[1]/br[2]'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($e/*:p/*:br[2], { 'lexical': true(), 'origin': $e/*:p })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'br[2]'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($emp)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'Q{http://www.w3.org/2005/xpath-functions}root()'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($emp/@xml:id)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'Q{http://www.w3.org/2005/xpath-functions}root()/@Q{http://www.w3.org/XML/1998/namespace}id'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($emp/empnr)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'Q{http://www.w3.org/2005/xpath-functions}root()/Q{}empnr[1]'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">path($emp/empnr, { 'lexical': true() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'fn:root()/empnr[1]'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">path($emp/empnr, {
  'namespaces': {
    'fn': 'http://www.w3.org/2005/xpath-functions',
    '': ''
  }
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'fn:root()/empnr[1]'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $in := [{"b":[3,4]}]
return path($in/*[1]/b/*[2])</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"/*[1]/b/*[2]"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $in := [[{'a':1}], [{'a':2}]]
return path($in//a[. = 2])</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"/*[2]/*[1]/a"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-root"></a>12.2.10 <a href="#func-root" style="text-decoration: none">fn:root</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the root of the tree to which <code>$node</code> belongs. The function can be applied both to <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-XNode">XNodes</a><sup><small>DM</small></sup> and to <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JNode">JNodes</a><sup><small>DM</small></sup>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:root</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>gnode()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>gnode()?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the function is called without an argument, the context value (<code>.</code>) is used as the default argument.</p><p>The function returns the value of the expression <code>$node/ancestor-or-self::gnode()[last()]</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>gnode()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>These examples use some variables which could be defined in <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> as:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $i := &lt;tool&gt;wrench&lt;/tool&gt;
let $o := &lt;order&gt;{ $i }&lt;quantity&gt;5&lt;/quantity&gt;&lt;/order&gt;
let $odoc := document { $o }
let $newi := $o/tool</pre></div></td></tr><tr><td colspan="2"><p>Or they could be defined in <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a> as:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;xsl:variable name="i" as="element()"&gt;
  &lt;tool&gt;wrench&lt;/tool&gt;
&lt;/xsl:variable&gt;

&lt;xsl:variable name="o" as="element()"&gt;
  &lt;order&gt;
    &lt;xsl:copy-of select="$i"/&gt;
    &lt;quantity&gt;5&lt;/quantity&gt;
  &lt;/order&gt;
&lt;/xsl:variable&gt;

&lt;xsl:variable name="odoc"&gt;
  &lt;xsl:copy-of select="$o"/&gt;
&lt;/xsl:variable&gt;

&lt;xsl:variable name="newi" select="$o/tool"/&gt;</pre></div></td></tr><tr><td colspan="2"><p><code>root($i)</code> returns the element node <code>$i</code></p></td></tr><tr><td colspan="2"><p><code>root($o/quantity)</code> returns the element node <code>$o</code></p></td></tr><tr><td colspan="2"><p><code>root($odoc//quantity)</code> returns the document node <code>$odoc</code></p></td></tr><tr><td colspan="2"><p><code>root($newi)</code> returns the element node <code>$o</code></p></td></tr><tr><td colspan="2"><p>The final three examples could be made type-safe by wrapping their operands with <code>exactly-one()</code>.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-siblings"></a>12.2.11 <a href="#func-siblings" style="text-decoration: none">fn:siblings</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-distinct-ordered-nodes">next</a> | <a href="#func-path">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/1542">1542</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1552">1552</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1547">1547</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1551">1551</a>&nbsp;5 November 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the supplied GNode together with its siblings, in document order.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:siblings</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>gnode()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>gnode()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the <code>$node</code> argument is omitted, it defaults to the context value (<code>.</code>).</p><p>If the value of <code>$node</code> is the empty sequence, the function returns the empty sequence.</p><p>If <code>$node</code> is a child of some parent GNode <var>P</var>, the function returns all the children of <var>P</var> (including <code>$node</code>), in document order, as determined by the value of <code>$node/child::gnode()</code>.</p><p>Otherwise (specifically, if <code>$node</code> is parentless, or if it is an attribute or namespace node), the function returns <code>$node</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">if ($node intersect $node/parent::gnode()/child::gnode())
then $node/parent::gnode()/child::gnode()
else $node</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>gnode()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>The result of <code>siblings($n)</code> (except in error cases) is the same as the result of <code>$n/(preceding-sibling::node() | following-sibling-or-self::node())</code>. It is also the same as <code>$n/(preceding-sibling-or-self::node() | following-sibling::node())</code></p><p>As with names such as <code>parent</code> and <code>child</code>, the word <b>sibling</b> used here as a technical term is not a precise match to its use in describing human family relationships, but is chosen for convenience.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $e := &lt;doc x="X"&gt;&lt;a&gt;A&lt;/a&gt;text&lt;?pi 3.14159?&gt;&lt;/doc&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>siblings($e//a) ! string()</code></pre></div></td><td style="vertical-align:top"><p><code>"A", "text", "3.14159"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>siblings($e//processing-instruction('pi')) ! string()</code></pre></div></td><td style="vertical-align:top"><p><code>"A", "text", "3.14159"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>siblings($e//@x) ! string()</code></pre></div></td><td style="vertical-align:top"><p><code>"X"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>[[1,2], [11,12], [13,14]]//jnode()[.='12'] =&gt; siblings() =&gt; sum()</code></pre></div></td><td style="vertical-align:top"><p><code>23</code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="functions-on-node-sequences"></a>12.3 <a href="#functions-on-node-sequences" style="text-decoration: none">Functions on sequences of nodes</a></h3><p>This section specifies functions on sequences of nodes.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-distinct-ordered-nodes"><code>fn:distinct-ordered-nodes</code></a></td><td>Removes duplicate GNodes and sorts the input into document order.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-innermost"><code>fn:innermost</code></a></td><td>Returns every GNode within the input sequence that is not an ancestor of another member of the input sequence; the GNodes are returned in document order with duplicates eliminated.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-outermost"><code>fn:outermost</code></a></td><td>Returns every GNode within the input sequence that has no ancestor that is itself a member of the input sequence; the nodes are returned in document order with duplicates eliminated.</td></tr></tbody></table><div class="div3"><h4><a id="func-distinct-ordered-nodes"></a>12.3.1 <a href="#func-distinct-ordered-nodes" style="text-decoration: none">fn:distinct-ordered-nodes</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-innermost">next</a> | <a href="#func-siblings">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1189">1189</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1191">1191</a>&nbsp;14 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Removes duplicate GNodes and sorts the input into document order.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:distinct-ordered-nodes</code>(</td></tr><tr class="arg"><td><code>$nodes</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>gnode()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>gnode()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Any duplicate GNodes (that is, XNodes or JNodes) in the input (based on node identity) are discarded. The remaining GNodes are returned in <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-document-order">document order</a><sup><small>XP</small></sup>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Document order is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> (but stable) for GNodes in different trees. If some GNode in tree <var>A</var> precedes some GNode in tree <var>B</var>, then every GNode in <var>A</var> precedes every GNode in <var>B</var>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $x := parse-xml('&lt;doc&gt;&lt;a/&gt;&lt;b/&gt;&lt;c/&gt;&lt;d/&gt;&lt;c/&gt;&lt;e/&gt;&lt;/doc&gt;')
return distinct-ordered-nodes(($x//c, $x//b, $x//a, $x//b)) ! name()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"a", "b", "c", "c"</pre></div><p><em>(The two <code>$x//b</code> expressions select the same node; one of these is eliminated as a duplicate. The <code>$x//c</code> expression selects two nodes that have distinct identity, so both are retained.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $x := [1, "a", true()]
return count(distinct-ordered-nodes(
                ($x/*[1], $x/type(xs:integer)) 
            ))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div><p><em>(The first array member is selected by two different routes; duplicate JNodes are eliminated.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-innermost"></a>12.3.2 <a href="#func-innermost" style="text-decoration: none">fn:innermost</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-outermost">next</a> | <a href="#func-distinct-ordered-nodes">previous</a>)</p><ol><li><p>Generalized to work with JNodes as well as XNodes.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2100">2100</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2149">2149</a>&nbsp;12 August 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns every GNode within the input sequence that is not an ancestor of another member of the input sequence; the GNodes are returned in document order with duplicates eliminated.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:innermost</code>(</td></tr><tr class="arg"><td><code>$nodes</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>gnode()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>gnode()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The effect of the function call <code>fn:innermost($nodes)</code> is defined to be equivalent to the result of the expression:</p><div class="exampleInner"><pre xml:space="preserve">$nodes except $nodes/ancestor::gnode()</pre></div><p>That is, the function takes as input a sequence of GNodes, and returns every GNode within the sequence that is not an ancestor of another GNode within the sequence; the GNodes are returned in document order with duplicates eliminated.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the supplied argument includes a map or an array, it will automatically be coerced to a JNode.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">parse-xml("&lt;doc&gt;
    &lt;div id='a'&gt;&lt;div id='b'&gt;&lt;div id='c'/&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;/doc&gt;")//div
   =&gt; innermost() =&gt; for-each(fn{string(@id)})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"c"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[[[1,2], [3,4]], [[5,6], [7,8]]]//array(*)
   =&gt; innermost() =!&gt; jnode-content()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[1,2], [3,4], [5,6], [7,8]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-outermost"></a>12.3.3 <a href="#func-outermost" style="text-decoration: none">fn:outermost</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-function-identity">next</a> | <a href="#func-innermost">previous</a>)</p><ol><li><p>Generalized to work with JNodes as well as XNodes.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2100">2100</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2149">2149</a>&nbsp;12 August 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns every GNode within the input sequence that has no ancestor that is itself a member of the input sequence; the nodes are returned in document order with duplicates eliminated.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:outermost</code>(</td></tr><tr class="arg"><td><code>$nodes</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>gnode()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>gnode()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The effect of the function call <code>fn:outermost($nodes)</code> is defined to be equivalent to the result of the expression:</p><div class="exampleInner"><pre xml:space="preserve">$nodes[not(ancestor::gnode() intersect $nodes)]/.</pre></div><p>That is, the function takes as input a sequence of GNodes, and returns every GNode within the sequence that does not have another GNode within the sequence as an ancestor; the GNodes are returned in document order with duplicates eliminated.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The formulation <code>$nodes except $nodes/descendant::node()</code> might appear to be simpler, but does not correctly account for attribute nodes, as these are not descendants of their parent element.</p><p>The motivation for the function was based on XSLT streaming use cases. There are cases where the <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a> streaming rules allow the construct <code>outermost(//section)</code> but do not allow <code>//section</code>; the function can therefore be useful in cases where it is known that sections will not be nested, as well as cases where the application actually wishes to process all sections except those that are nested within another.</p><p>If the supplied argument includes a map or an array, it will automatically be coerced to a JNode.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">parse-xml("&lt;doc&gt;
     &lt;div id='a'&gt;&lt;div id='b'&gt;&lt;div id='c'/&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;/doc&gt;")//div
   =&gt; outermost() =&gt; for-each(fn{string(@id)})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"a"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[[[1], [2]], [[3], [4]], [[5], [6]]]//jnode(*, array(*))
   =&gt; outermost() =!&gt; array:size()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">3</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="fns-on-identifiers"></a>12.4 <a href="#fns-on-identifiers" style="text-decoration: none">Identifying nodes</a></h3><p>This section defines a number of functions used to find elements by <code>ID</code> or <code>IDREF</code> value, or to generate identifiers.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-id"><code>fn:id</code></a></td><td>Returns the sequence of element nodes that have an <code>ID</code> value matching the value of one or more of the <code>IDREF</code> values supplied in <code>$values</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-element-with-id"><code>fn:element-with-id</code></a></td><td> Returns the sequence of element nodes that have an <code>ID</code> value matching the value of one or more of the <code>IDREF</code> values supplied in <code>$values</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-idref"><code>fn:idref</code></a></td><td>Returns the sequence of element or attribute nodes with an <code>IDREF</code> value matching the value of one or more of the <code>ID</code> values supplied in <code>$values</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-generate-id"><code>fn:generate-id</code></a></td><td>This function returns a string that uniquely identifies a given GNode. </td></tr></tbody></table><div class="div3"><h4><a id="func-id"></a>12.4.1 <a href="#func-id" style="text-decoration: none">fn:id</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the sequence of element nodes that have an <code>ID</code> value matching the value of one or more of the <code>IDREF</code> values supplied in <code>$values</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:id</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>element()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence, in document order with duplicates eliminated, containing every element node <code>E</code> that satisfies all the following conditions:</p><ol class="enumar"><li><p><code>E</code> is in the target document. The target document is the document containing <code>$node</code>, or the document containing the context value (<code>.</code>) if the second argument is omitted. The behavior of the function if <code>$node</code> is omitted is exactly the same as if the context value had been passed as <code>$node</code>.</p></li><li><p><code>E</code> has an <code>ID</code> value equal to one of the candidate <code>IDREF</code> values, where:</p><ul><li><p> An element has an <code>ID</code> value equal to <code>V</code> if either or both of the following conditions are true:</p><ul><li><p>The <code>is-id</code> property (See <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-is-id">7.6.5 is-id Accessor</a>.) of the element node is <code>true</code>, and the typed value of the element node is equal to <code>V</code> under the rules of the <code>eq</code> operator using the Unicode codepoint collation (<code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>).</p></li><li><p>The element has an attribute node whose <code>is-id</code> property (See <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-is-id">7.6.5 is-id Accessor</a>.) is <code>true</code> and whose typed value is equal to <code>V</code> under the rules of the <code>eq</code> operator using the Unicode code point collation (<code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>).</p></li></ul></li><li><p> Each <code>xs:string</code> in <code>$values</code> is parsed as if it were of type <code>IDREFS</code>, that is, each <code>xs:string</code> in <code>$values</code> is treated as a whitespace-separated sequence of tokens, each acting as an <code>IDREF</code>. These tokens are then included in the list of candidate <code>IDREF</code>s. If any of the tokens is not a lexically valid <code>IDREF</code> (that is, if it is not lexically an <code>xs:NCName</code>), it is ignored. Formally, the candidate <code>IDREF</code> values are the strings in the sequence given by the expression:</p><div class="exampleInner"><pre xml:space="preserve">for $s in $values
return tokenize(normalize-space($s), ' ')[. castable as xs:IDREF]</pre></div></li></ul></li><li><p>If several elements have the same <code>ID</code> value, then <code>E</code> is the one that is first in document order.</p></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODC0001" title="err:FODC0001">err:FODC0001</a>] if <code>$node</code>, or the context value if the second argument is absent, is a node in a tree whose root is not a document node.</p><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not a single node, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>The effect of this function is anomalous in respect of element nodes with the <code>is-id</code> property. For legacy reasons, this function returns the element that has the <code>is-id</code> property, whereas it would be more appropriate to return its parent, that being the element that is uniquely identified by the ID. A new function <a href="#func-element-with-id"><code>fn:element-with-id</code></a> has been introduced with the desired behavior.</p><p> If the data model is constructed from an Infoset, an attribute will have the <code>is-id</code> property if the corresponding attribute in the Infoset had an attribute type of <code>ID</code>: typically this means the attribute was declared as an <code>ID</code> in a DTD.</p><p> If the data model is constructed from a PSVI, an element or attribute will have the <code>is-id</code> property if its typed value is a single atomic item of type <code>xs:ID</code> or a type derived by restriction from <code>xs:ID</code>.</p><p> No error is raised in respect of a candidate <code>IDREF</code> value that does not match the <code>ID</code> of any element in the document. If no candidate <code>IDREF</code> value matches the <code>ID</code> value of any element, the function returns the empty sequence.</p><p> It is not necessary that the supplied argument should have type <code>xs:IDREF</code> or <code>xs:IDREFS</code>, or that it should be derived from a node with the <code>is-idrefs</code> property.</p><p> An element may have more than one <code>ID</code> value. This can occur with synthetic data models or with data models constructed from a PSVI where the element and one of its attributes are both typed as <code>xs:ID</code>.</p><p> If the source document is well-formed but not valid, it is possible for two or more elements to have the same <code>ID</code> value. In this situation, the function will select the first such element.</p><p> It is also possible in a well-formed but invalid document to have an element or attribute that has the <code>is-id</code> property but whose value does not conform to the lexical rules for the <code>xs:ID</code> type. Such a node will never be selected by this function.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $emp := validate lax {
  document {
    &lt;employee xml:id="ID21256"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
              xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;
      &lt;empnr xsi:type="xs:ID"&gt;E21256&lt;/empnr&gt;
      &lt;first&gt;John&lt;/first&gt;
      &lt;last&gt;Brown&lt;/last&gt;
    &lt;/employee&gt;
  }
}</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">$emp/id('ID21256')/name()</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"employee"</pre></div><p><em>(The <code>xml:id</code> attribute has the <code>is-id</code> property, so the employee element is selected.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">$emp/id('E21256')/name()</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"empnr"</pre></div><p><em>(Assuming the <code>empnr</code> element is given the type <code>xs:ID</code> as a result of schema validation, the element will have the <code>is-id</code> property and is therefore selected. Note the difference from the behavior of <a href="#func-element-with-id"><code>fn:element-with-id</code></a>.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-element-with-id"></a>12.4.2 <a href="#func-element-with-id" style="text-decoration: none">fn:element-with-id</a></h4><dl><dt class="label">Summary</dt><dd><p> Returns the sequence of element nodes that have an <code>ID</code> value matching the value of one or more of the <code>IDREF</code> values supplied in <code>$values</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:element-with-id</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>element()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><div class="note"><p class="prefix"><b>Note:</b></p><p>The effect of this function is identical to <a href="#func-id"><code>fn:id</code></a> in respect of elements that have an attribute with the <code>is-id</code> property. However, it behaves differently in respect of element nodes with the <code>is-id</code> property. Whereas the <a href="#func-id"><code>fn:id</code></a> function, for legacy reasons, returns the element that has the <code>is-id</code> property, this function returns the element identified by the ID, which is the parent of the element having the <code>is-id</code> property.</p></div><p>The function returns a sequence, in document order with duplicates eliminated, containing every element node <code>E</code> that satisfies all the following conditions:</p><ol class="enumar"><li><p><code>E</code> is in the target document. The target document is the document containing <code>$node</code>, or the document containing the context value (<code>.</code>) if the second argument is omitted. The behavior of the function if <code>$node</code> is omitted is exactly the same as if the context value had been passed as <code>$node</code>.</p></li><li><p><code>E</code> has an <code>ID</code> value equal to one of the candidate <code>IDREF</code> values, where:</p><ul><li><p> An element has an <code>ID</code> value equal to <code>V</code> if either or both of the following conditions are true:</p><ul><li><p>The element has an child element node whose <code>is-id</code> property (See <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-is-id">7.6.5 is-id Accessor</a>.) is <code>true</code> and whose typed value is equal to <code>V</code> under the rules of the <code>eq</code> operator using the Unicode code point collation (<code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>).</p></li><li><p>The element has an attribute node whose <code>is-id</code> property (See <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-is-id">7.6.5 is-id Accessor</a>.) is <code>true</code> and whose typed value is equal to <code>V</code> under the rules of the <code>eq</code> operator using the Unicode code point collation (<code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>).</p></li></ul></li><li><p>Each <code>xs:string</code> in <code>$values</code> is parsed as if it were of type <code>IDREFS</code>, that is, each <code>xs:string</code> in <code>$values</code> is treated as a whitespace-separated sequence of tokens, each acting as an <code>IDREF</code>. These tokens are then included in the list of candidate <code>IDREF</code>s. If any of the tokens is not a lexically valid <code>IDREF</code> (that is, if it is not lexically an <code>xs:NCName</code>), it is ignored. Formally, the candidate <code>IDREF</code> values are the strings in the sequence given by the expression:</p><div class="exampleInner"><pre xml:space="preserve">for $s in $values
return tokenize(normalize-space($s), ' ')[. castable as xs:IDREF]</pre></div></li></ul></li><li><p> If several elements have the same <code>ID</code> value, then <code>E</code> is the one that is first in document order.</p></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODC0001" title="err:FODC0001">err:FODC0001</a>] if <code>$node</code>, or the context value if the second argument is omitted, is a node in a tree whose root is not a document node.</p><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not a single node, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function is equivalent to the <a href="#func-id"><code>fn:id</code></a> function except when dealing with ID-valued element nodes. Whereas the <a href="#func-id"><code>fn:id</code></a> function selects the element containing the identifier, this function selects its parent.</p><p>If the data model is constructed from an Infoset, an attribute will have the <code>is-id</code> property if the corresponding attribute in the Infoset had an attribute type of <code>ID</code>: typically this means the attribute was declared as an <code>ID</code> in a DTD.</p><p> If the data model is constructed from a PSVI, an element or attribute will have the <code>is-id</code> property if its typed value is a single atomic item of type <code>xs:ID</code> or a type derived by restriction from <code>xs:ID</code>.</p><p> No error is raised in respect of a candidate <code>IDREF</code> value that does not match the <code>ID</code> of any element in the document. If no candidate <code>IDREF</code> value matches the <code>ID</code> value of any element, the function returns the empty sequence.</p><p> It is not necessary that the supplied argument should have type <code>xs:IDREF</code> or <code>xs:IDREFS</code>, or that it should be derived from a node with the <code>is-idrefs</code> property.</p><p> An element may have more than one <code>ID</code> value. This can occur with synthetic data models or with data models constructed from a PSVI where the element and one of its attributes are both typed as <code>xs:ID</code>.</p><p> If the source document is well-formed but not valid, it is possible for two or more elements to have the same <code>ID</code> value. In this situation, the function will select the first such element.</p><p> It is also possible in a well-formed but invalid document to have an element or attribute that has the <code>is-id</code> property but whose value does not conform to the lexical rules for the <code>xs:ID</code> type. Such a node will never be selected by this function.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $emp := validate lax {    
  document {
    &lt;employee xml:id="ID21256"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
              xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;
      &lt;empnr xsi:type="xs:ID"&gt;E21256&lt;/empnr&gt;
      &lt;first&gt;John&lt;/first&gt;
      &lt;last&gt;Brown&lt;/last&gt;
    &lt;/employee&gt;
  }
}</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">$emp/element-with-id('ID21256')/name()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"employee"</pre></div><p><em>(The <code>xml:id</code> attribute has the <code>is-id</code> property, so the employee element is selected.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>$emp/element-with-id('E21256')/name()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"employee"</code></p><p><em>(Assuming the <code>empnr</code> element is given the type <code>xs:ID</code> as a result of schema validation, the element will have the <code>is-id</code> property and is therefore its parent is selected. Note the difference from the behavior of <a href="#func-id"><code>fn:id</code></a>.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-idref"></a>12.4.3 <a href="#func-idref" style="text-decoration: none">fn:idref</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the sequence of element or attribute nodes with an <code>IDREF</code> value matching the value of one or more of the <code>ID</code> values supplied in <code>$values</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:idref</code>(</td></tr><tr class="arg"><td><code>$values</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>node()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p> The function returns a sequence, in document order with duplicates eliminated, containing every element or attribute node <code>$N</code> that satisfies all the following conditions:</p><ol class="enumar"><li><p><code>$N</code> is in the target document. The target document is the document containing <code>$node</code>, or the document containing the context value (<code>.</code>) if the second argument is omitted. The behavior of the function if <code>$node</code> is omitted is exactly the same as if the context value had been passed as <code>$node</code>.</p></li><li><p><code>$N</code> has an <code>IDREF</code> value equal to one of the candidate <code>ID</code> values, where:</p><ul><li><p>A node <code>$N</code> has an <code>IDREF</code> value equal to <code>V</code> if both of the following conditions are true:</p><ul><li><p>The <code>is-idrefs</code> property (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-is-idrefs">7.6.6 is-idrefs Accessor</a>) of <code>$N</code> is <code>true</code>.</p></li><li><p>The sequence </p><div class="exampleInner"><pre xml:space="preserve">tokenize(normalize-space(string($N)), ' ')</pre></div><p>contains a string that is equal to <code>V</code> under the rules of the <code>eq</code> operator using the Unicode code point collation (<code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>).</p></li></ul></li><li><p>Each <code>xs:string</code> in <code>$values</code> is parsed as if it were of lexically of type <code>xs:ID</code>. These <code>xs:string</code>s are then included in the list of candidate <code>xs:ID</code>s. If any of the strings in <code>$values</code> is not a lexically valid <code>xs:ID</code> (that is, if it is not lexically an <code>xs:NCName</code>), it is ignored. More formally, the candidate <code>ID</code> values are the strings in the sequence:</p><div class="exampleInner"><pre xml:space="preserve">$values[. castable as xs:NCName]</pre></div></li></ul></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODC0001" title="err:FODC0001">err:FODC0001</a>] if <code>$node</code>, or the context value if the second argument is omitted, is a node in a tree whose root is not a document node. </p><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not a single node, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p> An element or attribute typically acquires the <code>is-idrefs</code> property by being validated against the schema type <code>xs:IDREF</code> or <code>xs:IDREFS</code>, or (for attributes only) by being described as of type <code>IDREF</code> or <code>IDREFS</code> in a DTD.</p><p>Because the function is sensitive to the way in which the data model is constructed, calls on this function are not always interoperable.</p><p> No error is raised in respect of a candidate <code>ID</code> value that does not match the <code>IDREF</code> value of any element or attribute in the document. If no candidate <code>ID</code> value matches the <code>IDREF</code> value of any element or attribute, the function returns the empty sequence.</p><p> It is possible for two or more nodes to have an <code>IDREF</code> value that matches a given candidate <code>ID</code> value. In this situation, the function will return all such nodes. However, each matching node will be returned at most once, regardless how many candidate <code>ID</code> values it matches.</p><p> It is possible in a well-formed but invalid document to have a node whose <code>is-idrefs</code> property is <code>true</code> but that does not conform to the lexical rules for the <code>xs:IDREF</code> type. The effect of the above rules is that ill-formed candidate <code>ID</code> values and ill-formed <code>IDREF</code> values are ignored.</p><p>If the data model is constructed from a PSVI, the typed value of a node that has the <code>is-idrefs</code> property will contain at least one atomic item of type <code>xs:IDREF</code> (or a type derived by restriction from <code>xs:IDREF</code>). It may also contain atomic items of other types. These atomic items are treated as candidate <code>ID</code> values <span>if two conditions are met: their lexical form must be valid as an <code>xs:NCName</code>, and there must be at least one instance of <code>xs:IDREF</code> in the typed value of the node. If these conditions are not satisfied, such values are ignored.</span></p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $emp := validate lax {  
  document {    
    &lt;employees xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
               xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;  
      &lt;employee xml:id="ID21256"&gt;
        &lt;empnr xsi:type="xs:ID"&gt;E21256&lt;/empnr&gt;
        &lt;first&gt;Anil&lt;/first&gt;
        &lt;last&gt;Singh&lt;/last&gt;
        &lt;deputy xsi:type="xs:IDREF"&gt;E30561&lt;/deputy&gt;
      &lt;/employee&gt;
      &lt;employee xml:id="ID30561"&gt;
        &lt;empnr xsi:type="xs:ID"&gt;E30561&lt;/empnr&gt;
        &lt;first&gt;John&lt;/first&gt;
        &lt;last&gt;Brown&lt;/last&gt;
        &lt;manager xsi:type="xs:IDREF"&gt;ID21256&lt;/manager&gt;
      &lt;/employee&gt;
    &lt;/employees&gt;
  }
}</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">$emp/(
  element-with-id('ID21256')/@xml:id =&gt; idref()
)/ancestor::employee/last
=&gt; string()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Brown"</pre></div><p><em>(Assuming that <code>manager</code> has the is-idref property, the call on <a href="#func-idref"><code>fn:idref</code></a> selects the <code>manager</code> element. If, instead, the <code>manager</code> had a <code>ref</code> attribute with the is-idref property, the call on <a href="#func-idref"><code>fn:idref</code></a> would select the attribute node.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">$emp/(
  element-with-id('E30561')/empnr =&gt; idref()
)/ancestor::employee/last
=&gt; string()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Singh"</pre></div><p><em>(Assuming that <code>employee/deputy</code> has the is-idref property, the call on <a href="#func-idref"><code>fn:idref</code></a> selects the <code>deputy</code> element.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-generate-id"></a>12.4.4 <a href="#func-generate-id" style="text-decoration: none">fn:generate-id</a></h4><dl><dt class="label">Summary</dt><dd><p>This function returns a string that uniquely identifies a given GNode. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:generate-id</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>gnode()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The zero-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p><p>The one-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>).</p><p>If the argument is the empty sequence, the result is the zero-length string.</p><p>In other cases, the function returns a string that uniquely identifies a given node. <span>More formally, it is guaranteed that within a single <a title="execution scope" class="termref" href="#execution-scope">execution scope</a>, <code>fn:codepoint-equal(fn:generate-id($N), fn:generate-id($M))</code> returns <code>true</code> if and only if <code>($M is $N)</code> returns <code>true</code>.</span></p><p>The returned identifier <span class="verb">must</span> consist of ASCII alphanumeric characters and <span class="verb">must</span> start with an alphabetic character. Thus, the string is syntactically an XML name.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup></p></li><li><p>If the context value is not an instance of the sequence type <code>gnode()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>An implementation is free to generate an identifier in any convenient way provided that it always generates the same identifier for the same GNode and that different identifiers are always generated from different GNodes. An implementation is under no obligation to generate the same identifiers each time a document is transformed or queried.</p><p>There is no guarantee that a generated unique identifier will be distinct from any unique IDs specified in the source document.</p><p>There is no inverse to this function; it is not directly possible to find the GNode with a given generated ID. Of course, it is possible to search a given sequence of GNodes using an expression such as <code>$nodes[generate-id()=$id]</code>.</p><p>It is advisable, but not required, for implementations to generate IDs that are distinct even when compared using a case-blind collation.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The primary use case for this function is to generate hyperlinks. For example, when generating HTML, an anchor for a given section <code>$sect</code> can be generated by writing (in either XSLT or XQuery):</p></td></tr><tr><td colspan="2"><p><code>&lt;a name="{ generate-id($sect) }"/&gt;</code></p></td></tr><tr><td colspan="2"><p>and a link to that section can then be produced with code such as:</p></td></tr><tr><td colspan="2"><p><code>see &lt;a href="#{ generate-id($sect) }"&gt;here&lt;/a&gt;</code></p></td></tr><tr><td colspan="2"><p>Note that anchors generated in this way will not necessarily be the same each time a document is republished.</p></td></tr><tr><td colspan="2"><p>Since the keys in a map must be atomic items, it is possible to use generated IDs as surrogates for nodes when constructing a map. For example, in some implementations, testing whether a node <code>$N</code> is a member of a large node-set <code>$S</code> using the expression <code>exists($N intersect $S)</code> may be expensive; there may then be performance benefits in creating a map:</p></td></tr><tr><td colspan="2"><p><code>let $SMap := map:merge($S ! { generate-id(.) : . })</code></p></td></tr><tr><td colspan="2"><p>and then testing for membership of the node-set using:</p></td></tr><tr><td colspan="2"><p><code>map:contains($SMap, generate-id($N))</code></p></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="functions-on-functions"></a>13 <a href="#functions-on-functions" style="text-decoration: none">Processing function items</a></h2><p>The functions included in this section operate on function items, that is, values referring to a function.</p><p><span class="termdef"><a id="dt-higher-order"></a>[Definition] Functions that accept functions among their arguments, or that return functions in their result, are described in this specification as <b>higher-order</b> functions.</span></p><div class="note"><p class="prefix"><b>Note:</b></p><p>Some functions such as <a href="#func-parse-json"><code>fn:parse-json</code></a> allow the option of supplying a callback function for example to define exception behavior. Where this is not essential to the use of the function, the function has not been classified as higher-order for this purpose; in applications where function items cannot be created, these particular options will not be available.</p></div><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-function-lookup"><code>fn:function-lookup</code></a></td><td>Returns <span>a function item</span> having a given name and arity, if there is one.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-function-name"><code>fn:function-name</code></a></td><td>Returns the name of the function identified by a function item.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-function-arity"><code>fn:function-arity</code></a></td><td>Returns the arity of the function identified by a function item.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-function-identity"><code>fn:function-identity</code></a></td><td>Returns a string representing the identity of a function item.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-function-annotations"><code>fn:function-annotations</code></a></td><td>Returns the annotations of the function item.</td></tr></tbody></table><div class="div2"><h3><a id="func-function-lookup"></a>13.1 <a href="#func-function-lookup" style="text-decoration: none">fn:function-lookup</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns <span>a function item</span> having a given name and arity, if there is one.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:function-lookup</code>(</td></tr><tr class="arg"><td><code>$name</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:QName</code></code>,</td><td></td></tr><tr class="arg"><td><code>$arity</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>fn(*)?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p></dd><dt class="label">Rules</dt><dd><p>A call to <a href="#func-function-lookup"><code>fn:function-lookup</code></a> starts by looking for a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-function-definition">function definition</a><sup><small>XP</small></sup> in the named functions component of the dynamic context (specifically, the dynamic context of the call to <a href="#func-function-lookup"><code>fn:function-lookup</code></a>), using the expanded QName supplied as <code>$name</code> and the arity supplied as <code>$arity</code>. There can be at most one such function definition.</p><p>If no function definition can be identified (by name and arity), then the empty sequence is returned.</p><p>If a function definition is identified, then a function item is obtained from the function definition using the same rules as for evaluation of a named function reference (see <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-named-function-ref">4.6.5 Named Function References</a>). The captured context of the returned function item (if it is context dependent) is the static and dynamic context of the call on <a href="#func-function-lookup"><code>fn:function-lookup</code></a>.</p><p>If the arguments to <a href="#func-function-lookup"><code>fn:function-lookup</code></a> identify a function that is present in the static context of the function call, the function will always return the same function that a static reference to this function would bind to. If there is no such function in the static context, then the results depend on what is present in the dynamic context, which is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>An error is raised if the identified function depends on components of the static or dynamic context that are not present, or that have unsuitable values. For example [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup> is raised for the call <code>function-lookup( #fn:name, 0 )</code> if the context value is absent, and [<a href="#ERRFODC0001" title="err:FODC0001">err:FODC0001</a>] is raised for the call <code>function-lookup( #fn:id, 1 )</code> if the context value is not a single node in a tree that is rooted at a document node. The error that is raised is the same as the error that would be raised by the corresponding function if called with the same static and dynamic context.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function can be useful where there is a need to make a dynamic decision on which of several statically known functions to call. It can thus be used as a substitute for polymorphism, in the case where the application has been designed so several functions implement the same interface.</p><p>The function can also be useful in cases where a query or stylesheet module is written to work with alternative versions of a library module. In such cases the author of the main module might wish to test whether an imported library module contains or does not contain a particular function, and to call a function in that module only if it is available in the version that was imported. A static call would cause a static error if the function is not available, whereas getting the function using <a href="#func-function-lookup"><code>fn:function-lookup</code></a> allows the caller to take fallback action in this situation. </p><p>If the function that is retrieved by <a href="#func-function-lookup"><code>fn:function-lookup</code></a> is <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, that is, if it has dependencies on the static or dynamic context of its caller, the context that applies is the static and/or dynamic context of the call to the <a href="#func-function-lookup"><code>fn:function-lookup</code></a> function itself. The context thus effectively forms part of the closure of the returned function. This mainly applies when the target of <a href="#func-function-lookup"><code>fn:function-lookup</code></a> is a built-in function, because user-defined functions typically have no dependency on the static or dynamic context of the function call (an exception arises when the expressions used to define default values for parameters are context-dependent). The rule applies recursively, since <a href="#func-function-lookup"><code>fn:function-lookup</code></a> is itself a context-dependent built-in function. </p><p>However, the static and dynamic context of the call to <a href="#func-function-lookup"><code>fn:function-lookup</code></a> may play a role even when the selected function definition is not itself context dependent, if the expressions used to establish default parameter values are context dependent.</p><p>User-defined XSLT or XQuery functions should be accessible to <a href="#func-function-lookup"><code>fn:function-lookup</code></a> only if they are statically visible at the location where the call to <a href="#func-function-lookup"><code>fn:function-lookup</code></a> appears. This means that private functions, if they are not statically visible in the containing module, should not be accessible using <a href="#func-function-lookup"><code>fn:function-lookup</code></a>.</p><p>The function identity is determined in the same way as for a named function reference. Specifically, if there is no context dependency, two calls on <a href="#func-function-lookup"><code>fn:function-lookup</code></a> with the same name and arity must return the same function.</p><p>These specifications do not define any circumstances in which the dynamic context will contain functions that are not present in the static context, but neither do they rule this out. For example an API <span class="verb">may</span> provide the ability to add functions to the dynamic context, and such functions may potentially be context-dependent. </p><p>The mere fact that a function exists and has a name does not of itself mean that the function is present in the dynamic context. For example, functions obtained through use of the <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a> function are not added to the dynamic context.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>function-lookup( #fn:substring, 2 )( 'abcd', 2 )</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>'bcd'</code></p></td></tr><tr><td colspan="2"><p>The expression <code>(fn:function-lookup( #xs:dateTimeStamp, 1 ), xs:dateTime#1)[1] ('2011-11-11T11:11:11Z')</code> returns an <code>xs:dateTime</code> value set to the specified date, time, and timezone; if the implementation supports XSD 1.1 then the result will be an instance of the derived type <code>xs:dateTimeStamp</code>. The query is written to ensure that no failure occurs when the implementation does not recognize the type <code>xs:dateTimeStamp</code>.</p></td></tr><tr><td colspan="2"><p>The expression </p><div class="exampleInner"><pre xml:space="preserve" class="small">let $f := function-lookup( #zip:binary-entry, 2 )
return if (exists($f)) then $f($source, $entry) else ()</pre></div><p> returns the result of calling <code>zip:binary-entry($source, $entry)</code> if the function is available, or the empty sequence otherwise.</p></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-function-name"></a>13.2 <a href="#func-function-name" style="text-decoration: none">fn:function-name</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the name of the function identified by a function item.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:function-name</code>(</td></tr><tr class="arg"><td><code>$function</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:QName?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$function</code> refers to a named function, <code>fn:function-name($func)</code> returns the name of that function.</p><p>Otherwise (<code>$function</code> refers to an anonymous function), <code>fn:function-name($function)</code> returns the empty sequence.</p><p>The prefix part of the returned QName is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>function-name(substring#2)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">QName("http://www.w3.org/2005/xpath-functions", "fn:substring")</pre></div><p><em>(The namespace prefix of the returned QName is not predictable.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>function-name(fn($node) { count($node/*) })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-function-arity"></a>13.3 <a href="#func-function-arity" style="text-decoration: none">fn:function-arity</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the arity of the function identified by a function item.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:function-arity</code>(</td></tr><tr class="arg"><td><code>$function</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The <a href="#func-function-arity"><code>fn:function-arity</code></a> function returns the arity (number of arguments) of the function identified by <code>$function</code>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>function-arity(substring#2)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>2</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>function-arity(fn($node) { name($node) })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $initial := substring(?, 1, 1)
return function-arity($initial)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-function-identity"></a>13.4 <a href="#func-function-identity" style="text-decoration: none">fn:function-identity</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-function-annotations">next</a> | <a href="#func-outermost">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1798">1798</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1801">1801</a>&nbsp;5 March 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a string representing the identity of a function item.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:function-identity</code>(</td></tr><tr class="arg"><td><code>$function</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The <a href="#func-function-identity"><code>fn:function-identity</code></a> function returns a string that represents the identity of <code>$function</code>.</p><p>The returned string has the property that <code>fn:function-identity($f1)</code> and <code>fn:function-identity($f2)</code> are codepoint-equal if and only if <code>$f1</code> and <code>$f2</code> have the same function identity. Apart from this property, the result is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p>In the case of maps and arrays, the result follows the following rule: If <code>$X</code> and <code>$Y</code> are both maps or arrays then <code>fn:function-identity($X)</code><span class="verb">must not</span> be codepoint-equal to <code>fn:function-identity($Y)</code> unless <code>$X</code> and <code>$Y</code> are indistinguishable, that is unless every operator or function applied to <code>$X</code> returns the same result as for <code>$Y</code>. Even in this case, however, the result of the comparison <code>fn:function-identity($X) eq fn:function-identity($Y)</code> is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function enables applications to test whether two expressions or variables reference the same function item. This may be useful, for example, to allow caching of function results to avoid repeated evaluation. The results of previous function invocations might be held in a map whose key is the function identity.</p><p>The function identity, by definition, is generated upon the creation of a function item. Specific expressions that create function items have their own rules for the identity of the returned functions: for example, it is guaranteed that evaluation of a function reference to a system function with no captured context (such as <a href="#func-abs"><code>fn:abs#1</code></a>) will always return the same function item.</p><p>It is not meaningful to store or compare the result of calling <a href="#func-function-identity"><code>fn:function-identity</code></a> across different <a title="execution scope" class="termref" href="#execution-scope">execution scopes</a>, because the string used to represent the function identity will generally vary from one execution scope to another.</p><p>The result of an expression such as <code>function-identity(abs#1) eq function-identity(abs(?))</code> may be either <code>true</code> or <code>false</code>, because it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether <code>abs#1</code> and <code>abs(?)</code> return the same function item.</p><p>Similarly, <code>function-identity({ 1:() }) eq function-identity(map:entry(1, ()))</code> may be either <code>true</code> or <code>false</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>function-identity(abs#1) eq function-identity(abs#1)</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>function-identity(abs#1) eq function-identity(round#1)</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>function-identity({ 1: 0 }) eq function-identity({ 1: 1 })</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>function-identity([ 0 ]) eq function-identity([ 1 ])</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-function-annotations"></a>13.5 <a href="#func-function-annotations" style="text-decoration: none">fn:function-annotations</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#map-ordering">next</a> | <a href="#func-function-identity">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/36">36</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/710">710</a>&nbsp;17 September 2023]</i></p></li><li><p>Changes the function to return a sequence of key-value pairs rather than a map.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1391">1391</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1393">1393</a>&nbsp;19 August 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the annotations of the function item.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:function-annotations</code>(</td></tr><tr class="arg"><td><code>$function</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(xs:QName, xs:anyAtomicType*)*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The <code>fn:function-annotations</code> function returns the annotations of <code>$function</code> as a sequence of <a title="single-entry map" class="termref" href="#dt-single-entry-map">single-entry maps</a>, each associating the name of a function annotation with the value of the annotation. Note that several annotations on a function can share the same name. The order of the annotations is retained.</p><p>The result is a sequence of <a title="single-entry map" class="termref" href="#dt-single-entry-map">single-entry maps</a>, each being an instance of <code>map(xs:QName, xs:anyAtomicType*)</code>. If a function (for example, a built-in function) has no annotations, the result of the function is the empty sequence.</p><p>For each annotation, a map is returned, with a single entry. The key of the map entry is the name of the annotation as an <code>xs:QName</code>. The value of the entry is the value of the annotation as a sequence of atomic items. If the annotation has no values, the associated value is the empty sequence.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>In the common case where the annotation names are all unique, the result of the function can readily be converted into single map by applying the function <a href="#func-map-merge"><code>map:merge</code></a>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">function-annotations(true#0)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">declare %private function local:inc($c) { $c + 1 };
function-annotations(local:inc#1)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ #Q{http://www.w3.org/2012/xquery}private : () }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $old := %local:deprecated('0.1', '0.2') fn() {}
let $ann := function-annotations($old)
return map:merge($ann)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{
  #Q{http://www.w3.org/2005/xquery-local-functions}deprecated :
  ("0.1", "0.2") 
}</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div1"><h2><a id="maps"></a>14 <a href="#maps" style="text-decoration: none">Processing maps</a></h2><p>Maps were introduced as a new datatype in XDM 3.1. This section describes functions that operate on maps.</p><p>A map is a kind of item.</p><p><span class="termdef"><a id="dt-map"></a>[Definition] A <b>map</b> consists of a sequence of entries, also known as key-value pairs. Each entry comprises a key which is an arbitrary atomic item, and an arbitrary sequence called the associated value.</span></p><p><span class="termdef"><a id="dt-same-key"></a>[Definition] Within a map, no two entries have the <b>same key</b>. Two atomic items <code>K1</code> and <code>K2</code> are the <b>same key</b> for this purpose if the <span>function call <code>fn:atomic-equal($K1, $K2)</code></span> returns <code>true</code>.</span></p><p>It is not necessary that all the keys in a map should be of the same type (for example, they can include a mixture of integers and strings).</p><p>Maps are immutable, and have no identity separate from their content. For example, the <a href="#func-map-remove"><code>map:remove</code></a> function returns a map that differs from the supplied map by the omission (typically) of one entry, but the supplied map is not changed by the operation. Two calls on <a href="#func-map-remove"><code>map:remove</code></a> with the same arguments return maps that are indistinguishable from each other; there is no way of asking whether these are “the same map”.</p><p>A map can also be viewed as a function from keys to associated values. To achieve this, a map is also a function item. The function corresponding to the map has the signature <code>function($key as xs:anyAtomicValue) as item()*</code>. Calling the function has the same effect as calling the <a href="#func-map-get"><code>map:get</code></a> function: the expression <code>$map($key)</code> returns the same result as <code>get($map, $key)</code>. For example, if <code>$books-by-isbn</code> is a map whose keys are ISBNs and whose assocated values are <code>book</code> elements, then the expression <code>$books-by-isbn("0470192747")</code> returns the <code>book</code> element with the given ISBN. The fact that a map is a function item allows it to be passed as an argument to higher-order functions that expect a function item as one of their arguments.</p><div class="div2"><h3><a id="map-ordering"></a>14.1 <a href="#map-ordering" style="text-decoration: none">Ordering of Maps</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-build">next</a> | <a href="#func-function-annotations">previous</a>)</p><ol><li><p>Ordered maps are introduced.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1651">1651</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703</a>&nbsp;14 January 2025]</i></p></li></ol></div><p>In 4.0, the entries in a map are ordered. The <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup> of a map is referred to as <b>entry order</b>.</p><p>The entry order of the entries in a map is defined by the function or expression that creates the map, and affects the result of functions and expressions that process multiple entries in a map, for example the function <a href="#func-map-keys"><code>map:keys</code></a> and the expression <code>for key $k value $v return <var>EXPR</var></code>. The ordering is also reflected in the output of the <code>json</code> and <code>adaptive</code> serialization methods.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Order is maintained in maps for two main reasons:</p><ul><li><p>To make the representation of a map (such as its JSON serialization) easier for human readers to process: for example when visually inspecting the result of a JSON transformation;</p></li><li><p>To make the result of different implementations interoperable.</p></li></ul><p>Although it is possible to use the ordering of a map to capture semantic information, the design of functions such as <a href="#func-deep-equal"><code>fn:deep-equal</code></a> discourages this: maps are compared with each other, and matched against map types, without regard to the order of entries.</p></div></div><div class="div2"><h3><a id="map-composition-decomposition"></a>14.2 <a href="#map-composition-decomposition" style="text-decoration: none">Composing and Decomposing Maps</a></h3><p>It is often useful to decompose a map into a sequence of entries, or key-value pairs (in which the key is an atomic item and the value is an arbitrary sequence). Subsequently it may be necessary to reconstruct a map from these components, typically after modification.</p><p>There are two conventional ways of representing a map as a sequence of key-value pairs, each with its own advantages and disadvantages. These are described below:</p><ol class="enumar"><li><p>A map can be represented as a sequence of single-entry maps.</p><p><span class="termdef"><a id="dt-single-entry-map"></a>[Definition] A <b>single-entry map</b> is a map containing a single entry.</span></p><p>It is possible to decompose any map into a sequence of <a title="single-entry map" class="termref" href="#dt-single-entry-map">single-entry maps</a>, and to construct a map from a sequence of single-entry maps.</p><p>For example the map <code>{ "x": 1, "y": 2 }</code> can be decomposed to the sequence <code>({ "x": 1 }, { "y": 2 })</code>.</p></li><li><p>A map can be represented as a sequence of JNodes.</p><p>A JNode holds the map key in its <b>·selector·</b> property and the corresponding value in its <b>·content·</b> property.</p></li></ol><p>The following table summarizes the way in which these two representations can be used to compose and decompose maps:</p><table class="data"><thead><tr><th>Operation</th><th>Single-Entry Maps</th><th>JNodes</th></tr></thead><tbody><tr><td><p>Decompose a map</p></td><td><p><code>map:entries($map)</code></p></td><td><p><code>$map/child::*</code></p></td></tr><tr><td><p>Compose a map</p></td><td><p><code>map:merge($entries)</code></p></td><td><p><code>map:build($jnodes, jnode-selector#1, jnode-content#1)</code></p></td></tr><tr><td><p>Create a single entry</p></td><td><p><code>map:entry($key, $value)</code></p></td><td><p><code>{$key : $value}/child::*</code></p></td></tr><tr><td><p>Extract the key part of a single entry</p></td><td><p><code>map:keys($entry)</code></p></td><td><p><code>jnode-selector($jnode)</code></p></td></tr><tr><td><p>Extract the value part of a single entry</p></td><td><p><code>map:items($entry)</code></p></td><td><p><code>jnode-content($jnode)</code></p></td></tr></tbody></table><p>It is also possible to decompose a map using:</p><ul><li><p>The function <a href="#func-map-for-each"><code>map:for-each</code></a></p></li><li><p>The expression <code>for key $k value $v in $map return ....</code></p></li></ul><div class="example"><div class="exampleHeader"><a id="d5e56436"></a><a id="d5e56454"></a>Example: Reordering the entries in a map</div><p>The examples below show several ways of constructing a map with the same entries as an input map, but with the entries sorted by key.</p><ol class="enumar"><li><p>Using <a href="#func-map-entries"><code>map:entries</code></a> and <a href="#func-map-merge"><code>map:merge</code></a>:</p><div class="exampleInner"><pre xml:space="preserve">map:entries($map) =&gt; sort-by({'key': map:keys#1}) =&gt; map:merge()</pre></div></li><li><p>Using JNodes:</p><div class="exampleInner"><pre xml:space="preserve">$map/* =&gt; sort-by({'key': jnode-selector#1}) =&gt; map:build(jnode-selector#1, jnode-content#1)</pre></div></li><li><p>Using <a href="#func-map-for-each"><code>map:for-each</code></a>:</p><div class="exampleInner"><pre xml:space="preserve">map:merge( map:for-each($map, map:entry#2) =&gt; sort-by({'key': map:keys#1}) )</pre></div></li><li><p>Using an XQuery FLWOR expression:</p><div class="exampleInner"><pre xml:space="preserve">map:merge( for key $k value $v order by $k return {$k : $v} )</pre></div></li></ol></div></div><div class="div2"><h3><a id="formal-specification-of-maps"></a>14.3 <a href="#formal-specification-of-maps" style="text-decoration: none">Formal specification of maps</a></h3><p>The XDM data model (<a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>) defines three primitive operations on maps:</p><ul><li><p><code>dm:empty-map</code> constructs the empty map.</p></li><li><p><code>dm:map-put</code> adds or replaces an entry in a map.</p></li><li><p><code>dm:iterate-map</code> applies a supplied function to every entry in a map.</p></li></ul><p>The functions in this section are all specified by means of equivalent expressions that either call these primitives directly, or invoke other functions that rely on these primitives. The specifications avoid relying on XPath language constructs that manipulate maps, such as map constructor syntax, lookup expressions, or FLWOR expressions. This is done to allow these language constructs to be specified by reference to this function library, without risk of circularity.</p><p>There is one exception to this rule: for convenience, the notation <code>{}</code> is used to represent the empty map, in preference to a call on <code>dm:empty-map()</code>.</p><p>The formal equivalents are not intended to provide a realistic way of implementating the functions (in particular, any real implementation might be expected to implement <a href="#func-map-get"><code>map:get</code></a> and <a href="#func-map-put"><code>map:put</code></a> much more efficiently). They do, however, provide a framework that allows the correctness of a practical implementation to be verified.</p><table class="ednote" caption="Editorial note"><tbody><tr><td style="text-align: left; vertical-align:top; width: 50%;"><b>Editorial note</b></td><td style="text-align: right; vertical-align:top; width: 50%;">&nbsp;</td></tr><tr style="text-align: left; vertical-align: top;"><td colspan="2">TODO: as yet there is no formal equivalent for <code>map:find()</code>.</td></tr></tbody></table></div><div class="div2"><h3><a id="map-functions"></a>14.4 <a href="#map-functions" style="text-decoration: none">Functions that operate on maps</a></h3><p>The functions defined in this section use a conventional namespace prefix <code>map</code>, which is assumed to be bound to the namespace URI <code>http://www.w3.org/2005/xpath-functions/map</code>.</p><p>The function call <code>map:get($map, $key)</code> can be used to retrieve the value associated with a given key.</p><p>There is no operation to atomize a map or convert it to a string. The function <a href="#func-serialize"><code>fn:serialize</code></a> can in some cases be used to produce a JSON representation of a map.</p><p>Note that when the required type of an argument to a function such as <a href="#func-map-build"><code>map:build</code></a> is a map type, then the coercion rules ensure that a JNode can be supplied in the function call: if the <b>·content·</b> property of the JNode is a map, then the map is automatically extracted as if by the <a href="#func-jnode-content"><code>jnode-content</code></a> function.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-build"><code>map:build</code></a></td><td>Returns a map that typically contains one entry for each item in a supplied input sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-contains"><code>map:contains</code></a></td><td>Tests whether a supplied map contains an entry for a given key.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-empty"><code>map:empty</code></a></td><td>Returns <code>true</code> if the supplied map contains no entries.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-entries"><code>map:entries</code></a></td><td>Returns a sequence containing all the key-value pairs present in a map, each represented as a <a title="single-entry map" class="termref" href="#dt-single-entry-map">single-entry map</a>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-entry"><code>map:entry</code></a></td><td><span>Returns</span> a <a title="single-entry map" class="termref" href="#dt-single-entry-map">single-entry map</a> that represents a single key-value pair.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-filter"><code>map:filter</code></a></td><td>Selects entries from a map, returning a new map.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-find"><code>map:find</code></a></td><td>Searches the supplied input sequence and any contained maps and arrays for a map entry with the supplied key, and returns the corresponding values.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-for-each"><code>map:for-each</code></a></td><td>Applies a supplied function to every entry in a map, returning the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-concatenation">sequence concatenation</a><sup><small>XP</small></sup> of the results.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-get"><code>map:get</code></a></td><td>Returns the value associated with a supplied key in a given map.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-items"><code>map:items</code></a></td><td>Returns a sequence containing all the values present in a map, in order.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-keys"><code>map:keys</code></a></td><td>Returns a sequence containing all the keys present in a map.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-keys-where"><code>map:keys-where</code></a></td><td>Returns a sequence containing selected keys present in a map.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-merge"><code>map:merge</code></a></td><td>Returns a map that combines the entries from a number of existing maps.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-put"><code>map:put</code></a></td><td>Returns a map containing all the contents of the supplied map, but with an additional entry, which replaces any existing entry for the same key.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-remove"><code>map:remove</code></a></td><td>Returns a map containing all the entries from a supplied map, except <span>those having a specified key</span>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-map-size"><code>map:size</code></a></td><td>Returns the number of entries in the supplied map.</td></tr></tbody></table><div class="div3"><h4><a id="func-map-build"></a>14.4.1 <a href="#func-map-build" style="text-decoration: none">map:build</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-empty">next</a> | <a href="#map-ordering">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/151">151</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/203">203</a>&nbsp;18 October 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a map that typically contains one entry for each item in a supplied input sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:build</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn($item as item(), $position as xs:integer) as xs:anyAtomicType*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:identity#1</code>,</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn($item as item(), $position as xs:integer) as item()*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:identity#1</code>,</td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function processes each item in <code>$input</code> in order. It calls the <code>$key</code> function on that item to obtain a sequence of key values, and the <code>$value</code> function to obtain an associated value. Then, for each key value:</p><ul><li><p>If the key is not already present in the target map, the processor adds a new key-value pair to the map, with that key and that value. </p></li><li><p>If the key is already present, the processor combines the new value for the key with the existing value; the way they are combined is determined by the <code>duplicates</code> option.</p><p>By default, when two duplicate entries occur:</p><ul><li><p>A single combined entry will be present in the result.</p></li><li><p>This entry will contain the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-concatenation">sequence concatenation</a><sup><small>XP</small></sup> of the supplied values.</p></li><li><p>The position of the combined entry in the <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup> of the result map will correspond to the position of the first of the duplicates.</p></li><li><p>The key of the combined entry will correspond to the key of one of the duplicates: it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> which one is chosen. (It is possible for two keys to be considered duplicates even if they differ: for example, they may have different type annotations, or they may be <code>xs:dateTime</code> values in different timezones.) </p></li></ul><p>The <code>$options</code> argument can be used to control the way in which duplicate keys are handled. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply. The entries that may appear in the <code>$options</code> map are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">duplicates?</code></td><td><code class="as">as&nbsp;</code><code>(enum( "reject", "use-first", "use-last", "use-any", "combine") | fn(item()*, item()*) as item()*)?</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td rowspan="7"><p><code>duplicates?</code></p></td><td class="fos-thick" colspan="2">Determines the policy for handling duplicate keys: specifically, the action to be taken if two entries in the input sequence have key values <var>K<sub>1</sub></var> and <var>K<sub>2</sub></var> where <var>K<sub>1</sub></var> and <var>K<sub>2</sub></var> are the <a title="same key" class="termref" href="#dt-same-key">same key</a>. <ul><li><p><b>Type: </b><code>(enum( "reject", "use-first", "use-last", "use-any", "combine") | fn(item()*, item()*) as item()*)?</code></p></li><li><p><b>Default: </b><code>"combine"</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>"reject"</code></td><td> Equivalent to supplying a function that raises a dynamic error with error code "FOJS0003". The effect is that duplicate keys result in an error. </td></tr><tr><td class="fos-thin"><code>"use-first"</code></td><td>Equivalent to supplying the function <code>fn($a, $b){ $a }</code>. The effect is that the first of the duplicates is chosen. </td></tr><tr><td class="fos-thin"><code>"use-last"</code></td><td>Equivalent to supplying the function <code>fn($a, $b){ $b }</code>. The effect is that the last of the duplicates is chosen. </td></tr><tr><td class="fos-thin"><code>"use-any"</code></td><td>Equivalent to supplying the function <code>fn($a, $b){ one-of($a, $b) }</code> where <code>one-of</code> chooses either <code>$a</code> or <code>$b</code> in an <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> way. The effect is that it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> which of the duplicates is chosen. </td></tr><tr><td class="fos-thin"><code>"combine"</code></td><td>Equivalent to supplying the function <code>fn($a, $b){ $a, $b }</code> (or equivalently, the function <code>op(",")</code>). The effect is that the result contains the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-concatenation">sequence concatenation</a><sup><small>XP</small></sup> of the values having the same key, retaining order. </td></tr><tr><td class="fos-thick"><code>function(*)</code></td><td> A function with signature <code>fn(item()*, item()*) as item()*</code>. The function is called for any entry in the input sequence that has the <a title="same key" class="termref" href="#dt-same-key">same key</a> as a previous entry. The first argument is the existing value associated with the key; the second argument is the value associated with the key in the duplicate input entry, and the result is the new value to be associated with the key. The effect is cumulative: for example if there are three values <var>X</var>, <var>Y</var>, and <var>Z</var> associated with the same key, and the supplied function is <var>F</var>, then the result is an entry whose value is <code><var>X</var> =&gt; <var>F</var>(<var>Y</var>) =&gt; <var>F</var>(<var>Z</var>)</code>. </td></tr></tbody></table></li></ul></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">for-each(
  $input, 
  fn($item, $pos) {
    for-each($key($item, $pos), fn($k) {
      map:entry($k, $value($item, $pos))
    }
  )}
)
=&gt; map:merge($options)</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>An error is raised [<a href="#ERRFOJS0003" title="err:FOJS0003">err:FOJS0003</a>] if the value of <code>$options</code> indicates that duplicates are to be rejected, and a duplicate key is encountered.</p><p>An error is raised [<a href="#ERRFOJS0005" title="err:FOJS0005">err:FOJS0005</a>] if the value of <code>$options</code> includes an entry whose key is defined in this specification, and whose value is not a permitted value for that key.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The default function for both <code>$key</code> and <code>$value</code> is the identity function. Although it is permitted to default both, this serves little purpose: usually at least one of these arguments will be supplied.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:build((), string#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>{}</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:build(1 to 10, fn { . mod 3 })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>{ 0: (3, 6, 9), 1: (1, 4, 7, 10), 2: (2, 5, 8) }</code></p><p><em>(Returns a map with one entry for each distinct value of <code>. mod 3</code>. The function to compute the value is the identity function, and duplicates are combined by sequence concatenation.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:build(
  1 to 5,
  value := format-integer(?, "w")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ 1: "one", 2: "two", 3: "three", 4: "four", 5: "five" }</pre></div><p><em>(Returns a map with five entries. The function to compute the key is an identity function, the function to compute the value invokes <a href="#func-format-integer"><code>fn:format-integer</code></a>.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">map:build(
  ("January", "February", "March", "April", "May", "June",
   "July", "August", "September", "October", "November", "December"),
  substring(?, 1, 1)
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "A": ("April", "August"),
  "D": ("December"),
  "F": ("February"),
  "J": ("January", "June", "July"),
  "M": ("March", "May"),
  "N": ("November"),
  "O": ("October"),
  "S": ("September")
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:build(1 to 5, {
  1: ("eins", "one"),
  4: ("vier", "four")
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{
  "eins": 1,
  "one": 1,
  "vier": 4,
  "four": 4
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">map:build(
  ("apple", "apricot", "banana", "blueberry", "cherry"), 
  substring(?, 1, 1),
  string-length#1,
  { "duplicates": op("+") }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "a": 12, "b": 15, "c": 6 }</pre></div><p><em>(Constructs a map where the key is the first character of an input item, and where the corresponding value is the total string-length of the items starting with that character.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">map:build(
  ('Wang', 'Liu', 'Zhao'),
  key := fn($name, $pos) { $name },
  value := fn($name, $pos) { $pos }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "Wang": 1, "Liu": 2, "Zhao": 3 }</pre></div><p><em>(Returns an inverted index for the input sequence with the string stored as key and the position stored as value.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $titles := &lt;titles&gt;
  &lt;title&gt;A Beginner’s Guide to &lt;ix&gt;Java&lt;/ix&gt;&lt;/title&gt;
  &lt;title&gt;Learning &lt;ix&gt;XML&lt;/ix&gt;&lt;/title&gt;
  &lt;title&gt;Using &lt;ix&gt;XML&lt;/ix&gt; with &lt;ix&gt;Java&lt;/ix&gt;&lt;/title&gt;
&lt;/titles&gt;
return map:build($titles/title, fn($title) { $title/ix })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "Java": (
    &lt;title&gt;A Beginner’s Guide to &lt;ix&gt;Java&lt;/ix&gt;&lt;/title&gt;,
    &lt;title&gt;Using &lt;ix&gt;XML&lt;/ix&gt; with &lt;ix&gt;Java&lt;/ix&gt;&lt;/title&gt;
  ),
  "XML": (
    &lt;title&gt;Learning &lt;ix&gt;XML&lt;/ix&gt;&lt;/title&gt;,
    &lt;title&gt;Using &lt;ix&gt;XML&lt;/ix&gt; with &lt;ix&gt;Java&lt;/ix&gt;&lt;/title&gt;
  )
}</pre></div></td></tr><tr><td colspan="2"><p>The following expression creates a map whose keys are employee <code>@ssn</code> values, and whose corresponding values are the employee nodes:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">map:build(//employee, fn { @ssn })</pre></div></td></tr><tr><td colspan="2"><p>The following expression creates a map whose keys are employee <code>@location</code> values, and whose corresponding values represent the number of employees at each distinct location. Any employees that lack an <code>@location</code> attribute will be excluded from the result.</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">map:build(//employee, fn { @location }, fn { 1 }, { "duplicates": op("+") })</pre></div></td></tr><tr><td colspan="2"><p>The following expression creates a map whose keys are employee <code>@location</code> values, and whose corresponding values contain the employee node for the highest-paid employee at each distinct location:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">map:build(
  //employee,
  key := fn { @location }, 
  combine := fn($a, $b) { highest(($a, $b), fn { xs:decimal(@salary) }) }
)</pre></div></td></tr><tr><td colspan="2"><p>The following expression creates a map allowing efficient access to every element in a document by means of its <a href="#func-generate-id"><code>fn:generate-id</code></a> value:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">map:build(//*, generate-id#1)</pre></div></td></tr><tr><td colspan="2"><p>The following expression creates a map allowing efficient access to values in a recursive JSON structure using hierarchic paths:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $tree := parse-json('{
  "type": "package",
  "name": "org",
  "content": [
      { "type": "package",
        "name": "xml,
        "content: [
            { "type": "package",
              "name": "sax",
              "content": [
                  { "type": "class",
                    "name": "Attributes"},
                  { "type": "class",
                    "name": "ContentHandler"},
                  { "type": "class",
                    "name": "XMLReader"}
               ]
            }]
       }]
   }')
   return map:build($tree ? descendant::~[record(type, name, content?)],
                    fn{?ancestor-or-self::name =&gt; reverse() =&gt; string-join(,)},
                    fn{`{?type} {?name}`})</pre></div></td></tr><tr><td colspan="2"><p>The result is the map:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">{ "org.xml.sax.Attributes": "class Attributes",
  "org.xml.sax.ContentHandler": "class ContentHandler",
  "org.xml.sax.XMLReader": "class XMLReader" }</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-contains"></a>14.4.2 <a href="#func-map-contains" style="text-decoration: none">map:contains</a></h4><dl><dt class="label">Summary</dt><dd><p>Tests whether a supplied map contains an entry for a given key.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:contains</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-contains"><code>map:contains</code></a> returns <code>true</code> if the <a title="map" class="termref" href="#dt-map">map</a> supplied as <code>$map</code> contains an entry with the <a title="same key" class="termref" href="#dt-same-key">same key</a> as <code>$key</code>; otherwise it returns <code>false</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">some(map:keys($map), atomic-equal(?, $key))</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $week := {
  0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag"
}</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:contains($week, 2)</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:contains($week, 9)</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:contains({}, "xyz")</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:contains({ "xyz": 23 }, "xyz")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:contains({ "abc": 23, "xyz": () }, "xyz")</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-empty"></a>14.4.3 <a href="#func-map-empty" style="text-decoration: none">map:empty</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-entries">next</a> | <a href="#func-map-build">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/827">827</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/843">843</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/969">969</a>&nbsp;18 November 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the supplied map contains no entries.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:empty</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns <code>true</code> if and only if <code>$map</code> contains no entries, that is, if <code>map:size($map) eq 0</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">map:size($map) eq 0</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:empty({})</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:empty({ 1: () })</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-entries"></a>14.4.4 <a href="#func-map-entries" style="text-decoration: none">map:entries</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-filter">next</a> | <a href="#func-map-empty">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/29">29</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/314">314</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/360">360</a>&nbsp;21 March 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a sequence containing all the key-value pairs present in a map, each represented as a <a title="single-entry map" class="termref" href="#dt-single-entry-map">single-entry map</a>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:entries</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(*)*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-entries"><code>map:entries</code></a> takes any <a title="map" class="termref" href="#dt-map">map</a> as its <code>$map</code> argument and returns the key-value pairs that are present in the map as a sequence of <a title="single-entry map" class="termref" href="#dt-single-entry-map">single-entry maps</a>, in <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">map:for-each($map, map:entry#2)</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:entries(
  { 1: "yes", 0: "no" }
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">({ 1: "yes" }, { 0: "no" })</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-entry"></a>14.4.5 <a href="#func-map-entry" style="text-decoration: none">map:entry</a></h4><dl><dt class="label">Summary</dt><dd><p><span>Returns</span> a <a title="single-entry map" class="termref" href="#dt-single-entry-map">single-entry map</a> that represents a single key-value pair.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:entry</code>(</td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code>,</td><td></td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-entry"><code>map:entry</code></a> returns a <a title="map" class="termref" href="#dt-map">map</a> which contains a single entry. The key of the entry in the new map is <code>$key</code>, and its associated value is <code>$value</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">map:put({}, $key, $value)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function <a href="#func-map-entry"><code>map:entry</code></a> is intended primarily for use in conjunction with the function <a href="#func-map-merge"><code>map:merge</code></a>. For example, a map containing seven entries may be constructed like this:</p><div class="exampleInner"><pre xml:space="preserve" class="small">map:merge((
  map:entry("Su", "Sunday"),
  map:entry("Mo", "Monday"),
  map:entry("Tu", "Tuesday"),
  map:entry("We", "Wednesday"),
  map:entry("Th", "Thursday"),
  map:entry("Fr", "Friday"),
  map:entry("Sa", "Saturday")
))</pre></div><p>The <a href="#func-map-merge"><code>map:merge</code></a> function can be used to construct a map with a variable number of entries, for example:</p><div class="exampleInner"><pre xml:space="preserve">map:merge(//book ! map:entry(isbn, .))</pre></div></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:entry("M", "Monday")</code></pre></div></td><td style="vertical-align:top"><p><code>{ "M": "Monday" }</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-filter"></a>14.4.6 <a href="#func-map-filter" style="text-decoration: none">map:filter</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-find">next</a> | <a href="#func-map-entries">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/584">584</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/843">843</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1074">1074</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1133">1133</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/969">969</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1134">1134</a>&nbsp;11 July 2023]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li><li><p>Enhanced to allow for ordered maps.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1651">1651</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703</a>&nbsp;14 January 2025]</i></p></li><li><p>The <code>$action</code> callback function now accepts an optional position argument.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1718">1718</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2224">2224</a>&nbsp;2 October 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Selects entries from a map, returning a new map.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:filter</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn($key as xs:anyAtomicType, $value as item()*, $position as xs:integer) as xs:boolean?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-filter"><code>map:filter</code></a> takes any <a title="map" class="termref" href="#dt-map">map</a> as its <code>$map</code> argument and applies the supplied function to each entry in the map; the result is a new map containing those entries for which the function returns <code>true</code>. A return value of <code>()</code> from the predicate is treated as <code>false</code>.</p><p>The function supplied as <code>$predicate</code> takes three arguments. It is called supplying the key of the map entry as the first argument, the associated value as the second argument, and the 1-based integer position as the third argument.</p><p>The relative <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">order of entries</a><sup><small>DM</small></sup> in the returned map is the same as their relative order in <code>$map</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">map:for-each($map, fn($key, $value, $position) {
  if ($predicate($key, $value, $position)) {
    map:entry($key, $value)
  }
})
=&gt; map:merge()</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">map:filter(
  { 1: "Sunday", 2: "Monday", 3: "Tuesday", 4: "Wednesday",
    5: "Thursday", 6: "Friday", 7: "Saturday" },
  fn($k, $v) { $k = (1, 7) }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ 1: "Sunday", 7: "Saturday" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">map:filter(
  { 1: "Sunday", 2: "Monday", 3: "Tuesday", 4: "Wednesday",
    5: "Thursday", 6: "Friday", 7: "Saturday" },
  fn($k, $v) { $v = ("Saturday", "Sunday") }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ 1: "Sunday", 7: "Saturday" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $en-ja := { 'one': '一', 'two': '二', 'three': '三' }
return map:filter($en-ja, fn($en, $ja, $pos) {
  $pos mod 2 = 1
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ 'one': '一', 'three': '三' }</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-find"></a>14.4.7 <a href="#func-map-find" style="text-decoration: none">map:find</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-for-each">next</a> | <a href="#func-map-filter">previous</a>)</p><ol><li><p>Enhanced to allow for ordered maps.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1651">1651</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703</a>&nbsp;14 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Searches the supplied input sequence and any contained maps and arrays for a map entry with the supplied key, and returns the corresponding values.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:find</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-find"><code>map:find</code></a> searches the sequence supplied as <code>$input</code> looking for map entries whose key is the <a title="same key" class="termref" href="#dt-same-key">same key</a> as <code>$key</code>. The associated value in any such map entry (each being in general a sequence) is returned as a member of the result array.</p><p>The search processes the <code>$input</code> sequence using the following recursively defined rules (any equivalent algorithm may be used provided it delivers the same result, respecting those rules that constrain the order of the result):</p><ol class="enumar"><li><p>To process a sequence, process each of its items in order.</p></li><li><p>To process an item that is an array, process each of its members in order (each member is, in general, a sequence).</p></li><li><p>To process an item that is a map, then for each key-value entry (<var>K</var>, <var>V</var>) in the map (in <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup>) perform both of the following steps, in order:</p><ol class="enumla"><li><p>If <var>K</var> is the <a title="same key" class="termref" href="#dt-same-key">same key</a> as <code>$key</code>, then add <var>V</var> as a new member to the end of the result array.</p></li><li><p>Process <var>V</var> (which is, in general, a sequence).</p></li></ol></li><li><p>To process an item that is neither a map nor an array, do nothing. (Such items are ignored).</p></li></ol></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$input</code> is the empty sequence, map, or array, or if the requested <code>$key</code> is not found, the result will be a zero-length array.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $responses := [
  { 0: 'no', 1: 'yes' },
  { 0: 'non', 1: 'oui' },
  { 0: 'nein', 1: ('ja', 'doch') }
]</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $inventory := {
  "name": "car",
  "id": "QZ123", 
  "parts": [ { "name": "engine", "id": "YW678", "parts": [] } ]
}</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:find($responses, 0)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[ 'no', 'non', 'nein' ]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:find($responses, 1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[ 'yes', 'oui', ('ja', 'doch') ]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:find($responses, 2)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:find($inventory, "parts")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[
  [ { "name": "engine", "id": "YW678", "parts": [] } ],
  []
]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-for-each"></a>14.4.8 <a href="#func-map-for-each" style="text-decoration: none">map:for-each</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-get">next</a> | <a href="#func-map-find">previous</a>)</p><ol><li><p>Enhanced to allow for ordered maps.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1651">1651</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703</a>&nbsp;14 January 2025]</i></p></li><li><p>The <code>$action</code> callback function now accepts an optional position argument.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1718">1718</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2224">2224</a>&nbsp;2 October 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Applies a supplied function to every entry in a map, returning the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-concatenation">sequence concatenation</a><sup><small>XP</small></sup> of the results.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:for-each</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn($key as xs:anyAtomicType, $value as item()*, $position as xs:integer) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-for-each"><code>map:for-each</code></a> takes any <a title="map" class="termref" href="#dt-map">map</a> as its <code>$map</code> argument and applies the supplied function to each entry in the map, in <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup>; the result is the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-concatenation">sequence concatenation</a><sup><small>XP</small></sup> of the results of these function calls.</p><p>The function supplied as <code>$action</code> takes three arguments. It is called supplying the key of the map entry as the first argument, the associated value as the second argument, and the 1-based integer position as the third argument.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function is defined as follows, making use of primitive constructors and accessors defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p><div class="exampleInner"><pre xml:space="preserve">dm:iterate-map($map, $action, $position)</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:for-each(
  { 1: "yes", 2: "no" },
  fn($k, $v) { $k }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">(1, 2)</pre></div><p><em>(This function call is equivalent to calling <a href="#func-map-keys"><code>map:keys</code></a>.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">distinct-values(
  map:for-each(
    { 1: "yes", 2: "no" },
    fn($k, $v) { $v }
  )
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">("yes", "no")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:merge(
  map:for-each(
    { "a": 1, "b": 2 },
    fn($k, $v) { map:entry($k, $v + 1) }
  )
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "a": 2, "b": 3 }</pre></div><p><em>(This function call returns a map with the same keys as the input map, with the value of each entry increased by one.)</em></p></td></tr><tr><td colspan="2"><p>This XQuery example converts the entries in a map to attributes on a newly constructed element node:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $dimensions := { 'height': 3, 'width': 4, 'depth': 5 }
return &lt;box&gt;{
  map:for-each($dimensions, fn($k, $v) { attribute { $k } { $v } })
}&lt;/box&gt;</pre></div></td></tr><tr><td colspan="2"><p>The result is the element <code>&lt;box height="3" width="4" depth="5"/&gt;</code>.</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $en-ja := { 'one': '一', 'two': '二', 'three': '三' }
return map:for-each($en-ja, fn($en, $ja, $pos) {
  $pos || '. ' || $en || ': ' || $ja
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"1. one: 一", "2. two: 二", "3. three: 三"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-get"></a>14.4.9 <a href="#func-map-get" style="text-decoration: none">map:get</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-items">next</a> | <a href="#func-map-for-each">previous</a>)</p><ol><li><p>A third argument is added, allowing user control of how absent keys should be handled.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1363">1363</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/289">289</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1901">1901</a>&nbsp;15 April 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the value associated with a supplied key in a given map.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:get</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code>,</td><td></td></tr><tr class="arg"><td><code>$default</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-get"><code>map:get</code></a> attempts to find an entry within the <a title="map" class="termref" href="#dt-map">map</a> supplied as <code>$map</code> that has the <a title="same key" class="termref" href="#dt-same-key">same key</a> as <code>$key</code>. If there is such an entry, it returns the associated value; if not, it returns the supplied <code>$default</code> value, which defaults to the empty sequence.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function is defined as follows, making use of primitive constructors and accessors defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p><div class="exampleInner"><pre xml:space="preserve" class="small">let $entry := dm:iterate-map($map, fn($k, $v) {
  if (atomic-equal($k, $key)) {
    map:entry($k, $v)
  }
})
return (
  if (exists($entry))
  then map:items($entry)
  else $default
)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>A return value of <code>()</code> from <a href="#func-map-get"><code>map:get#2</code></a> could indicate that the key is present in the map with an associated value of <code>()</code>, or it could indicate that the key is not present in the map. The two cases can be distinguished by either by calling <a href="#func-map-contains"><code>map:contains</code></a> to test whether an entry is present, or by using a <code>$default</code> value to return a value known never to appear in the map.</p><p>Invoking the <a title="map" class="termref" href="#dt-map">map</a> as a function item has the same effect as calling <code>get</code> with no <code>$default</code> argument: that is, when <code>$map</code> is a map, the expression <code>$map($K)</code> is equivalent to <code>map:get($map, $K)</code>. Similarly, the expression <code>map:get(map:get(map:get($map, 'employee'), 'name'), 'first')</code> can be written as <code>$map('employee')('name')('first')</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $week := {
  0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag"
}</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:get($week, 4)</code></pre></div></td><td style="vertical-align:top"><p><code>"Donnerstag"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:get($week, 9)</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p><p><em>(When the key is not present, the function returns the empty sequence.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:get(map:entry(7,()), 7)</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p><p><em>(An empty sequence as the result can also signify that the key is present and the associated value is the empty sequence.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:get($week, 7, "n/a")</code></pre></div></td><td style="vertical-align:top"><p><code>"n/a"</code></p><p><em>(The third argument supplies a default value.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-items"></a>14.4.10 <a href="#func-map-items" style="text-decoration: none">map:items</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-keys-where">next</a> | <a href="#func-map-get">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1672">1672</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1687">1687</a>&nbsp;14 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a sequence containing all the values present in a map, in order.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:items</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-items"><code>map:items</code></a> takes any <a title="map" class="termref" href="#dt-map">map</a> as its <code>$map</code> argument and returns the values that are present in the map as a sequence, in <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup>.</p><p>The effect of the function is equivalent to <code>$map?*</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">map:for-each($map, fn($key, $value) { $value })</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:items({ 1: "yes", 2: "no" })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">("yes", "no")</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:items({
  1: ("red", "green"),
  2: ("blue", "yellow"),
  3: ()
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">("red", "green", "blue", "yellow")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-keys"></a>14.4.11 <a href="#func-map-keys" style="text-decoration: none">map:keys</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns a sequence containing all the keys present in a map.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:keys</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function <a href="#func-map-keys"><code>map:keys</code></a> takes any <a title="map" class="termref" href="#dt-map">map</a> as its <code>$map</code> argument and returns the keys that are present in the map as a sequence of atomic items, in <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">map:for-each($map, fn($key, $value) { $key })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The number of items in the result will be the same as the number of entries in the map, and the result sequence will contain no duplicate values.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:keys({ 1: "yes", 0: "no" })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>(1, 0)</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">({ "red": 0}, { "blue": 1}, { "green": 2 })
=&gt; map:merge()
=&gt; map:keys()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">("red", "blue", "green")</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-keys-where"></a>14.4.12 <a href="#func-map-keys-where" style="text-decoration: none">map:keys-where</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-merge">next</a> | <a href="#func-map-items">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/467">467</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/504">504</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/478">478</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/515">515</a>&nbsp;16 May 2023]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a sequence containing selected keys present in a map.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:keys-where</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn($key as xs:anyAtomicType, $value as item()*) as xs:boolean?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function <a href="#func-map-keys"><code>map:keys</code></a> takes any <a title="map" class="termref" href="#dt-map">map</a> as its <code>$map</code> argument. The <code>$predicate</code> function takes the key and the value of the corresponding map entry as an argument, and the result is a sequence containing the keys of those entries for which the predicate function returns <code>true</code>, in <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup>.</p><p>A return value of <code>()</code> from the predicate function is treated as <code>false</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">map:for-each($map, fn($key, $value) {
  if ($predicate($key, $value)) { $key }
})</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $numbers := {
  0: "zero",
  1: "one",
  2: "two",
  3: "three"
}
return map:keys-where(
  $numbers,
  fn($key, $value) { $value = ("two", "three") }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">(2, 3)</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $square := map:merge(
  (1 to 5) ! map:entry(., . * .)
)
return map:keys-where(
  $square,
  fn($key, $value) { $value &gt; 5 and $value &lt; 20 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">(3, 4)</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $birthdays := {
  "Agnieszka": xs:date("1980-12-31"),
  "Jabulile": xs:date("2001-05-05"),
  "Joel": xs:date("1969-11-10"),
  "Midori": xs:date("2012-01-08")
}
return map:keys-where($birthdays, fn($name, $date) {
  starts-with($name, "J") and year-from-date($date) = 1969
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Joel"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-merge"></a>14.4.13 <a href="#func-map-merge" style="text-decoration: none">map:merge</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-put">next</a> | <a href="#func-map-keys-where">previous</a>)</p><ol><li><p>For consistency with the new function <a href="#func-map-build"><code>map:build</code></a>, the handling of duplicates may now be controlled by supplying a user-defined callback function as an alternative to the fixed values for the earlier <code>duplicates</code> option.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1725">1725</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1727">1727</a>&nbsp;31 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a map that combines the entries from a number of existing maps.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:merge</code>(</td></tr><tr class="arg"><td><code>$maps</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-merge"><code>map:merge</code></a> returns a map that is formed by combining the contents of the maps supplied in the <code>$maps</code> argument.</p><p>Informally, the supplied maps are combined as follows:</p><ol class="enumar"><li><p>There is one entry in the returned map for each distinct key present in the union of the input maps, where two keys are distinct if they are not the <a title="same key" class="termref" href="#dt-same-key">same key</a>. The order of the input maps, and of the entries within these input maps, is retained in the <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup> of the result map.</p></li><li><p>If there are duplicate keys, that is, if two or more maps contain entries having the <a title="same key" class="termref" href="#dt-same-key">same key</a>, then the relevant entries are combined in a way that is controlled by the supplied <code>$options</code>.</p><p>The <code>$options</code> argument takes the same values (with the same meanings) as the <a href="#func-map-build"><code>map:build</code></a> function, except that the default is different: for <code>map:merge</code>, the default for duplicate keys is <code>use-first</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The difference is for backwards compatibility reasons.</p></div><p>With the default options, when duplicate entries occur:</p><ol class="enumla"><li><p>There will be a single entry in the result corresponding to a set of duplicate entries in the input. </p></li><li><p>The value of that entry will be taken from the first of the duplicates.</p></li><li><p>The position of that entry in the <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup> of the result map will correspond to the position of the first of the duplicates.</p></li><li><p>The key of the combined entry will correspond to the key of one of the duplicates: it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> which one is chosen. (Keys may be duplicates even though they differ: for example, they may have different type annotations, or they may be <code>xs:dateTime</code> values in different timezones.)</p></li></ol></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>An error is raised [<a href="#ERRFOJS0003" title="err:FOJS0003">err:FOJS0003</a>] if the value of <code>$options</code> indicates that duplicates are to be rejected, and a duplicate key is encountered.</p><p>An error is raised [<a href="#ERRFOJS0005" title="err:FOJS0005">err:FOJS0005</a>] if the value of <code>$options</code> includes an entry whose key is defined in this specification, and whose value is not a permitted value for that key.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the input is the empty sequence, the result is the empty map.</p><p>If the input is a sequence of length one, the result map is indistinguishable from the input map.</p><p>There is no requirement that the supplied input maps should have the same or compatible types. The type of a map (for example <code>map(xs:integer, xs:string)</code>) is descriptive of the entries it currently contains, but is not a constraint on how the map may be combined with other maps.</p><p>The XSLT 3.0 recommendation included a specification of this function that incorrectly used the option value <code>{ 'duplicates': 'unspecified' }</code> in place of <code>{ 'duplicates': 'use-any' }</code>. XSLT implementations wishing to preserve backwards compatibility <span class="verb">may</span> choose to retain support for this setting.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $week := {
  0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag"
}</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:merge(())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>{}</code></p><p><em>(Returns the empty map).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:merge((
  map:entry(0, "no"),
  map:entry(1, "yes")
))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ 0: "no", 1: "yes" }</pre></div><p><em>(Returns a map with two entries).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:merge(({ "red": 0 }, { "green": 1}, { "blue": 2 })) 
=&gt; map:keys()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"red", "green", "blue"</pre></div><p><em>(Note the order of the result.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:merge(
  ($week, { 7: "Unbekannt" })
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag", 7: "Unbekannt" }</pre></div><p><em>(The value of the existing map is unchanged; the <span>returned map contains</span> all the entries from <code>$week</code>, supplemented with an additional entry.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:merge(
  ($week, { 6: "Sonnabend" }),
  { "duplicates": "use-last" }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Sonnabend" }</pre></div><p><em>(The value of the existing map is unchanged; the returned map contains all the entries from <code>$week</code>, with one entry replaced by a new entry. Both input maps contain an entry with the key <code>6</code>; the one used in the result is the one that comes last in the input sequence.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:merge(
  ($week, { 6: "Sonnabend" }),
  { "duplicates": "use-first" }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag" }</pre></div><p><em>(The value of the existing map is unchanged; the returned map contains all the entries from <code>$week</code>, with one entry replaced by a new entry. Both input maps contain an entry with the key <code>6</code>; the one used in the result is the one that comes first in the input sequence.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">map:merge(
  ($week, { 6: "Sonnabend" }),
  { "duplicates": "combine" }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: ("Samstag", "Sonnabend") }</pre></div><p><em>(The value of the existing map is unchanged; the returned map contains all the entries from <code>$week</code>, with one entry replaced by a new entry. Both input maps contain an entry with the key <code>6</code>; the entry that appears in the result is the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-concatenation">sequence concatenation</a><sup><small>XP</small></sup> of the entries in the input maps, retaining order.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">map:merge(
  ({ "oxygen": 0.22, "hydrogen": 0.68, "nitrogen": 0.1 },
   { "oxygen": 0.24, "hydrogen": 0.70, "nitrogen": 0.06 }), 
  { "duplicates": fn($a, $b) { max(($a, $b)) } })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "oxygen": 0.24, "hydrogen": 0.70, "nitrogen": 0.1 }</pre></div><p><em>(The result map holds, for each distinct key, the maximum of the values for that key in the input.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-put"></a>14.4.14 <a href="#func-map-put" style="text-decoration: none">map:put</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-map-remove">next</a> | <a href="#func-map-merge">previous</a>)</p><ol><li><p>Enhanced to allow for ordered maps.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1651">1651</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703</a>&nbsp;14 January 2025]</i></p></li><li><p>It is no longer guaranteed that the new key replaces the existing key.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1725">1725</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1727">1727</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1740">1740</a>&nbsp;28 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a map containing all the contents of the supplied map, but with an additional entry, which replaces any existing entry for the same key.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:put</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code>,</td><td></td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$map</code> contains an entry whose key is the <a title="same key" class="termref" href="#dt-same-key">same key</a> as <code>$key</code>, the function returns a map in which that entry is replaced (at the same relative position) with a new entry whose value is <code>$value</code>. It is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether the key in the new entry takes its original value or is replaced by the supplied <code>$key</code>. All other entries in the map are unchanged, and retain their relative order.</p><p>Otherwise, when <code>$map</code> contains no such entry, the function returns a map containing all entries from the supplied <code>$map</code> (retaining their relative position) followed by a new entry whose key is <code>$key</code> and whose associated value is <code>$value</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function is defined as follows, making use of primitive constructors and accessors defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p><div class="exampleInner"><pre xml:space="preserve">dm:map-put($map, $key, $value)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>There is no requirement that the type of <code>$key</code> and <code>$value</code> be consistent with the types of any existing keys and values in the supplied map.</p><p>It is possible to force the new entry to go at the end of the sequence by calling <a href="#func-map-remove"><code>map:remove</code></a> before calling <code>map:put</code>.</p><p>It can happen that the supplied <code>$key</code> is the <a title="same key" class="termref" href="#dt-same-key">same key</a> as some existing key present in <code>$map</code>, but nevertheless differs from the existing key in some way: for example, it might have a different type annotation, or it might be an <code>xs:dateTime</code> value in a different timezone. In this situation it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether the key that appears in the result map is the supplied <code>$key</code> or the existing key.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $week := {
  0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag"
}</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:put($week, 6, "Sonnabend")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Sonnabend" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:put($week, -1, "Unbekannt")</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag", -1: "Unbekannt" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-json('{ "red": 0, "green": 1, "blue": 2 }')
=&gt; map:put("yellow", -1) 
=&gt; map:keys()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"red", "green", "blue", "yellow"</pre></div><p><em>(The new entry is added at the end of the list.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-json('{ "red": 0, "green": 1, "blue": 2 }')
=&gt; map:put("red", -1) 
=&gt; map:keys()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"red", "green", "blue"</pre></div><p><em>(Changing the value for an existing key does not change the order of the keys.)</em></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-remove"></a>14.4.15 <a href="#func-map-remove" style="text-decoration: none">map:remove</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#xml-to-json-mappings">next</a> | <a href="#func-map-put">previous</a>)</p><ol><li><p>Enhanced to allow for ordered maps.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1651">1651</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703</a>&nbsp;14 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a map containing all the entries from a supplied map, except <span>those having a specified key</span>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:remove</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$keys</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-remove"><code>map:remove</code></a> returns a <a title="map" class="termref" href="#dt-map">map</a> containing all the entries in <code>$map</code> except for any entry whose key is the <a title="same key" class="termref" href="#dt-same-key">same key</a> as <span>an item in</span><code>$keys</code>.</p><p>No failure occurs <span>if an item in <code>$keys</code> does not correspond to any entry in <code>$map</code>; that key value is simply ignored</span>.</p><p>The relative position of retained entries in the result map is the same as their relative position in <code>$map</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">map:filter(
  $map,
  fn($k, $v) { not(some($keys, atomic-equal($k, ?))) }
)</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $week := {
  0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag"
}</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:remove($week, 4)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ 0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  5: "Freitag", 6: "Samstag" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:remove($week, 23)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:remove($week, (0, 6 to 7))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ 1: "Montag", 2: "Dienstag", 3: "Mittwoch", 4: "Donnerstag",
  5: "Freitag" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>map:remove($week, ())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 0: "Sonntag", 1: "Montag", 2: "Dienstag", 3: "Mittwoch",
  4: "Donnerstag", 5: "Freitag", 6: "Samstag" }</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-map-size"></a>14.4.16 <a href="#func-map-size" style="text-decoration: none">map:size</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the number of entries in the supplied map.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">map:size</code>(</td></tr><tr class="arg"><td><code>$map</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function <a href="#func-map-size"><code>map:size</code></a> takes any <a title="map" class="termref" href="#dt-map">map</a> as its <code>$map</code> argument and returns the number of entries that are present in the map.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">count(map:entries($map))</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:size({})</code></pre></div></td><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>map:size({ "true": 1, "false": 0 })</code></pre></div></td><td style="vertical-align:top"><p><code>2</code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="xml-to-json-mappings"></a>14.5 <a href="#xml-to-json-mappings" style="text-decoration: none">Converting elements to maps</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-element-to-map-plan">next</a> | <a href="#func-map-remove">previous</a>)</p><ol><li><p> A new function <a href="#func-element-to-map"><code>fn:element-to-map</code></a> is provided for converting XDM trees to maps suitable for serialization as JSON. Unlike the <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> function retained from 3.1, this can handle arbitrary XML as input. <i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/528">528</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1645">1645</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1646">1646</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1647">1647</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1648">1648</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1658">1658</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1658">1658</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1797">1797</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1575">1575</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1906">1906</a>&nbsp;19 November 2024]</i></p></li></ol></div><p>The <a href="#func-element-to-map"><code>fn:element-to-map</code></a> function converts a tree rooted at an XML element node to a corresponding tree of maps, in a form suitable for serialization as JSON. In effect it provides a mechanism for converting XML to JSON.</p><p>This section describes the mappings used by this function.</p><p>This mapping is designed with three objectives:</p><ul><li><p>It should be possible to represent any XML element as a map suitable for JSON serialization.</p></li><li><p>The resulting JSON should be intuitive and easy to use.</p></li><li><p>The JSON should be consistent and stable: small variations in the input should not result in large variations in the output.</p></li></ul><p>Achieving all three objectives requires design compromises. It also requires sacrificing some other desiderata. In consequence:</p><ul><li><p>The conversion is not lossless (see <a href="#id-loss-of-xdm-information"><b>14.5.9 Lost XDM Information</b></a> for details).</p></li><li><p>The conversion is not streamable.</p></li><li><p>The results are not necessarily compatible with those produced by other popular libraries.</p></li></ul><p>The requirement for consistency and stability is particularly challenging. An element such as <code>&lt;name&gt;John&lt;/name&gt;</code> maps naturally to the map <code>{ "name": "John" }</code>; but adding an attribute (so it becomes <code>&lt;name role="first"&gt;John&lt;/name&gt;</code>) then requires an incompatible change in the JSON representation. The format could be made extensible by converting <code>&lt;name&gt;John&lt;/name&gt;</code> to <code>{ "name": {"#content":"John"} }</code> and <code>&lt;name role="first"&gt;John&lt;/name&gt;</code> to <code>{ "name": { "@role":"first", "#content":"John" } }</code>, but this imposes unwanted complexity on the simplest cases. The solution adopted is threefold:</p><ul><li><p>It is possible to analyze a corpus of XML documents to develop a conversion plan, which can then be applied consistently to individual input documents, whether or not these documents were present in the corpus. The conversion plan can be serialized and subsequently reused, so that it can be applied to input documents that might not have existed at the time the conversion plan was formulated.</p></li><li><p>Alternatively, the function can make use of schema information where available, so it considers not just the structure of an individual element instance, but the rules governing the element type.</p></li><li><p>It is possible to override the choices made by the system, and explicitly specify the format to be used for elements or attributes having a given name.</p></li></ul><div class="div3"><h4><a id="id-element-layouts"></a>14.5.1 <a href="#id-element-layouts" style="text-decoration: none">Element Layouts</a></h4><p>The key challenge in mapping XML to JSON is in deciding how element content is to be represented. To illustrate the variety of mappings that are possible, the following table lists some examples of typical XML elements and their JSON equivalents:</p><table class="data"><thead><tr><th>XML element</th><th>JSON equivalent</th></tr></thead><tbody><tr><td><div class="exampleInner"><pre xml:space="preserve">&lt;hr/&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve">"hr": ""</pre></div></td></tr><tr><td><div class="exampleInner"><pre xml:space="preserve">&lt;date-of-birth&gt;2023-05-18&lt;/date-of-birth&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve">"date-of-birth": "2023-05-18"</pre></div></td></tr><tr><td><div class="exampleInner"><pre xml:space="preserve">&lt;box width="5" height="10"/&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve">"box": { "@width": "5", "@height": "10" }</pre></div></td></tr><tr><td><div class="exampleInner"><pre xml:space="preserve">&lt;label id="t41"&gt;Warning!&lt;/label&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve">"label": { "@id": "t41", "#content": "Warning!" }</pre></div></td></tr><tr><td><div class="exampleInner"><pre xml:space="preserve">&lt;box&gt;
    &lt;width&gt;5&lt;/width&gt;
    &lt;height&gt;10&lt;/height&gt;
&lt;/box&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve">"box": {
    "width": 5, 
    "height": 10
}</pre></div></td></tr><tr><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;polygon&gt;
    &lt;point x="0" y="0"/&gt;
    &lt;point x="1" y="0"/&gt;
    &lt;point x="1" y="1"/&gt;
    &lt;point x="0" y="1"/&gt;
&lt;/polygon&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve" class="small">"polygon": [
    { "x": 0, "y": 0 }, 
    { "x": 1, "y": 0 }, 
    { "x": 1, "y": 1 }, 
    { "x": 0, "y": 1 }
]</pre></div></td></tr></tbody></table><p>This specification defines a number of named mappings, called <b>layouts</b>, and allows the layout for a particular element to be selected in a number of different ways:</p><ul><li><p>The layout to be used for a specific elements can be explicitly selected by supplying a conversion plan as input to the <a href="#func-element-to-map"><code>fn:element-to-map</code></a> function.</p></li><li><p>It is possible to construct a conversion plan by analyzing a corpus of documents using the <a href="#func-element-to-map-plan"><code>fn:element-to-map-plan</code></a> function.</p></li><li><p>It is also possible to construct a conversion plan manually, or to modify the conversion plan produced by the <a href="#func-element-to-map-plan"><code>fn:element-to-map-plan</code></a> function before use.</p></li><li><p>In the absence of an explicit conversion plan, if the data has been schema-validated, the layout is inferred from the content model for the element type as defined in the schema.</p></li><li><p>When the data is untyped and no specific layout has been selected, a default layout is chosen based on the properties of the individual element instance.</p></li></ul><p>The advantage of using schema information is that it gives a consistent representation for all elements of a particular type, even if they vary in content: for example if an element type allows optional attributes, the JSON representation will be consistent between those elements that have attributes and those without. In the absence of a schema, consistency can be achieved by supplying a conversion plan that applies uniformly to multiple documents.</p><p>The different layouts available are defined in the following sections. For each layout there is a table showing:</p><ul><li><p><b>Layout name</b>: the name to be used to select this layout in a conversion plan supplied to the <a href="#func-element-to-map"><code>fn:element-to-map</code></a> function.</p></li><li><p><b>Usage</b>: the situations for which this layout is designed.</p></li><li><p><b>Example input</b>: an example of a typical element for which this layout is appropriate, shown as serialized XML.</p></li><li><p><b>Example output</b>: the result of converting this example, shown as serialized JSON. The result is always shown as a singleton map, which is how it will appear when the layout is used for the top-level elements supplied in the <code>$elements</code> argument; when used to convert a descendant element, the corresponding key-value pair may appear as part of a larger map, depending on the layout chosen for its parent element..</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The <a href="#func-element-to-map"><code>fn:element-to-map</code></a> function produces a map as its result, but it is convenient to illustrate the form of the map by showing the effect of serializing the map as JSON.</p></div></li><li><p><b>Mapping rules</b>: The rules for mapping the XML element to an XDM map representation.</p></li><li><p><b>Mapping for nilled elements</b>: special rules that apply to an element having the attribute <code>xsi:nil="true"</code>. These rules only apply if the element has been schema-validated.</p></li><li><p><b>Errors</b>: situations where the layout cannot be used, and where attempting to use it will fail. For example, the <code>empty</code> layout cannot be used for an element that is not empty. In such a situation the recovery action is as follows, in order:</p><ol class="enumar"><li><p>Attributes are dropped, and if this is sufficient to enable the layout to be used, then the element is converted without its attributes.</p></li><li><p>If the <code>type</code> of an element or attribute in the conversion plan is given as <code>boolean</code> or <code>numeric</code>, but the actual value of the element or attribute is not castable to <code>xs:boolean</code> or <code>xs:numeric</code> respectively, then the node is output ignoring the <code>type</code> property, that is, as an instance of <code>xs:untypedAtomic</code>.</p></li><li><p>If the conversion plan supplies a fallback layout (an entry with key <code>"*"</code>), then the fallback layout is used.</p></li><li><p>The <a href="#func-element-to-map"><code>element-to-map</code></a> function fails with a dynamic error.</p></li></ol></li></ul><p>The rules for selecting the layout for a particular element are given later, in <a href="#id-selecting-element-layout"><b>14.5.6 Selecting an element layout</b></a>.</p><p>Note that it is possible to request any layout for any element. If an inappropriate layout is chosen for a particular element (for example, <code>empty</code> layout for an element that is not empty), then the rules for that layout specify what happens. It is possible to specify a fallback layout for use when the selected layout fails: this will typically be a layout such as <code>xml</code> or <code>mixed</code> that can handle any element.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Acknowledgements for this categorization: see <a href="#Goessner">[Goessner]</a>. Although Goessner's categories have been used, the detailed mappings vary from his proposal.</p></div><div class="div4"><h5><a id="id-empty-layout"></a>14.5.1.1 <a href="#id-empty-layout" style="text-decoration: none">Layout: Empty Content</a></h5><table class="data"><tbody><tr><th>Layout name</th><td><p><code>empty</code></p></td></tr><tr><th>Usage</th><td><p>Intended for XML elements that have no content and no attributes.</p></td></tr><tr><th>Example input</th><td><div class="exampleInner"><pre xml:space="preserve">&lt;hr/&gt;</pre></div></td></tr><tr><th>Example output</th><td><div class="exampleInner"><pre xml:space="preserve">{ "hr": "" }</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The content is represented by the zero-length <code>xs:string</code> value <code>""</code>.</p></td></tr><tr><th>Mapping for nilled elements</th><td><p>The content is represented by the QName <code>fn:QName("http://www.w3.org/2005/xpath-functions", "null")</code>, which the JSON serialization method serializes as <code>null</code>. For example the result of converting the element <code>&lt;hr xsi:nil="true"/&gt;</code> becomes <code>{ "hr": #fn:null }</code>, which is serialized in JSON as <code>{ "hr": null }</code>.</p></td></tr><tr><th>Errors</th><td><p>Attributes are discarded, along with child comment nodes, processing instructions, and whitespace-only text nodes.</p><p>If any other child nodes are present, this layout fails.</p></td></tr></tbody></table></div><div class="div4"><h5><a id="id-empty-plus-layout"></a>14.5.1.2 <a href="#id-empty-plus-layout" style="text-decoration: none">Layout: Empty Content with Attributes</a></h5><table class="data"><tbody><tr><th>Layout name</th><td><p><code>empty-plus</code></p></td></tr><tr><th>Usage</th><td><p>Intended for XML elements that have no content but may have attributes.</p></td></tr><tr><th>Example input</th><td><div class="exampleInner"><pre xml:space="preserve">&lt;hr class="ccc" id="zzz"/&gt;</pre></div></td></tr><tr><th>Example output</th><td><div class="exampleInner"><pre xml:space="preserve">{ "hr": { "@class": "ccc", "@id": "zzz" } }</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The content is represented by a map containing one entry for each attribute in the XML element; if there are no attributes, the content is represented as the empty map. The rules for attribute names are defined in <a href="#element-and-attribute-names"><b>14.5.7 Element and Attribute Names</b></a>, and the rules for attribute content in <a href="#element-and-attribute-content"><b>14.5.8 Element and Attribute Content</b></a>.</p></td></tr><tr><th>Mapping for nilled elements</th><td><p>An additional key-value pair <code>"#content": #fn:null</code> is added, which serializes in JSON as <code>"#content": null</code>. For example <code>&lt;hr id="x" xsi:nil="true"/&gt;</code> becomes <code>{ "hr": { "@id": "x", "#content": #fn:null } }</code>.</p></td></tr><tr><th>Errors</th><td><p>Child comment nodes, processing instructions, and whitespace-only text nodes are discarded.</p><p>If any other child nodes are present, this layout fails.</p></td></tr></tbody></table></div><div class="div4"><h5><a id="id-simple-layout"></a>14.5.1.3 <a href="#id-simple-layout" style="text-decoration: none">Layout: Simple Content</a></h5><table class="data"><tbody><tr><th>Layout name</th><td><p><code>simple</code></p></td></tr><tr><th>Usage</th><td><p>Intended for XML elements that have simple content and no attributes.</p></td></tr><tr><th>Example input</th><td><div class="exampleInner"><pre xml:space="preserve">&lt;date&gt;2023-05-30&lt;/date&gt;</pre></div></td></tr><tr><th>Example output</th><td><div class="exampleInner"><pre xml:space="preserve">{ "date": "2023-05-30" }</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The element is atomized and the resulting atomized value is handled as described in <a href="#element-and-attribute-content"><b>14.5.8 Element and Attribute Content</b></a>. If atomization fails, the element is treated as if it were untyped.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>If the element is untyped, the atomized value will always appear in the result as an instance of <code>xs:untypedAtomic</code>.</p></div></td></tr><tr><th>Mapping for nilled elements</th><td><p>The content is represented by the value <code>#fn:null</code>, which is serialized as the JSON value <code>null</code>. For example. <code>&lt;name xsi:nil="true"/&gt;</code> becomes <code>{ "name": #fn:null }</code>.</p></td></tr><tr><th>Errors</th><td><p>Attributes are discarded, along with child comment nodes and processing instructions; whitespace is retained.</p><p>If any child elements are present, this layout fails.</p></td></tr></tbody></table></div><div class="div4"><h5><a id="id-simple-plus-layout"></a>14.5.1.4 <a href="#id-simple-plus-layout" style="text-decoration: none">Layout: Simple Content with Attributes</a></h5><table class="data"><tbody><tr><th>Layout name</th><td><p><code>simple-plus</code></p></td></tr><tr><th>Usage</th><td><p>Intended for XML elements that have simple content and (optionally) attributes.</p></td></tr><tr><th>Example input</th><td><div class="exampleInner"><pre xml:space="preserve">&lt;price currency="USD"&gt;23.50&lt;/date&gt;</pre></div></td></tr><tr><th>Example output</th><td><div class="exampleInner"><pre xml:space="preserve">{ "price": { "@currency": "USD", "#content": 23.50 } }</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The element is represented by a map containing one entry for each of its attributes, plus an entry with key <code>"#content"</code> representing the result of atomizing the element. The atomized value is handled as described in <a href="#element-and-attribute-content"><b>14.5.8 Element and Attribute Content</b></a>.</p><p>The rules for attribute names are defined in <a href="#element-and-attribute-names"><b>14.5.7 Element and Attribute Names</b></a>, and the rules for attribute content in <a href="#element-and-attribute-content"><b>14.5.8 Element and Attribute Content</b></a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>If the element is untyped, the value of each attribute, and of <code>"#content"</code>, will always be an instance of <code>xs:untypedAtomic</code>.</p><p>If the element has been schema-validated, the types of the items in the atomized value are retained.</p></div></td></tr><tr><th>Mapping for nilled elements</th><td><p>The <code>"#content"</code> property is represented by the value <code>#fn:null</code>, which is serialized in JSON as <code>null</code>.</p></td></tr><tr><th>Errors</th><td><p>Child comment nodes and processing instructions are discarded; whitespace is retained.</p><p>If any child elements are present, this layout fails.</p></td></tr></tbody></table></div><div class="div4"><h5><a id="id-list-layout"></a>14.5.1.5 <a href="#id-list-layout" style="text-decoration: none">Layout: Simple List</a></h5><table class="data"><tbody><tr><th>Layout name</th><td><p><code>list</code></p></td></tr><tr><th>Usage</th><td><p>Intended for XML elements that act as wrappers for a list of child elements, all having the same element name; neither the element itself nor any of its children should have any attributes. The expected child element name may be present in the conversion plan. The names of the child elements are not retained in the output.</p></td></tr><tr><th>Example input (1)</th><td><div class="exampleInner"><pre xml:space="preserve">&lt;dates&gt;
  &lt;date&gt;2023-03-20&lt;/date&gt;
  &lt;date&gt;2023-04-12&lt;/date&gt;
  &lt;date&gt;2023-05-30&lt;/date&gt;
&lt;/dates&gt;</pre></div></td></tr><tr><th>Example output (1)</th><td><div class="exampleInner"><pre xml:space="preserve">{ "dates": [ "2023-03-20", "2023-04-12", "2023-05-30" ] }</pre></div></td></tr><tr><th>Example input (2)</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;dates&gt;
  &lt;date&gt;&lt;year&gt;2023&lt;/year&gt;&lt;month&gt;03&lt;/month&gt;&lt;day&gt;20&lt;/day&gt;&lt;/date&gt;
  &lt;date&gt;&lt;year&gt;2023&lt;/year&gt;&lt;month&gt;04&lt;/month&gt;&lt;day&gt;12&lt;/day&gt;&lt;/date&gt;
  &lt;date&gt;&lt;year&gt;2023&lt;/year&gt;&lt;month&gt;05&lt;/month&gt;&lt;day&gt;30&lt;/day&gt;&lt;/date&gt;
&lt;/dates&gt;</pre></div></td></tr><tr><th>Example output (2)</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">{ "dates": [ 
    { "year": "2023", "month": "03", "day": "20" },
    { "year": "2023", "month": "04", "day": "12" },
    { "year": "2023", "month": "05", "day": "30" }
  ] }</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The content is represented by an array, whose members correspond one-to-one with the children of the element. Each child element is converted to a map as if it were a top-level element: the resulting map contains a single key-value pair. The key part is discarded, and the value part is used as a member in the resulting array.</p><p>If there are no children then the content is represented by the empty array.</p></td></tr><tr><th>Mapping for nilled elements</th><td><p>The array is replaced by the value <code>#fn:null</code>, which serializes to the JSON value <code>null</code> (for example <code>{ "dates": #fn:null }</code>).</p></td></tr><tr><th>Errors</th><td><p>Attributes are discarded for both the element itself, and its children. Comments, processing instructions, and whitespace text nodes in the content are discarded.</p><p>This layout fails if any child element is present with a name that differs from the expected child element name, or if there are non-whitespace text node children.</p></td></tr></tbody></table></div><div class="div4"><h5><a id="id-list-plus-layout"></a>14.5.1.6 <a href="#id-list-plus-layout" style="text-decoration: none">Layout: List with Attributes</a></h5><table class="data"><tbody><tr><th>Layout name</th><td><p><code>list-plus</code></p></td></tr><tr><th>Usage</th><td><p>Intended for XML elements that act as wrappers for a list of child elements, all having the same element name. The wrapper element may have attributes, but the children should not. and the name of the child elements is retained in the output.</p></td></tr><tr><th>Example input (1)</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;dates id="x"&gt;
  &lt;date&gt;2023-03-20&lt;/date&gt;
  &lt;date&gt;2023-04-12&lt;/date&gt;
  &lt;date&gt;2023-05-30&lt;/date&gt;
&lt;/dates&gt;</pre></div></td></tr><tr><th>Example output (1)</th><td><div class="exampleInner"><pre xml:space="preserve">"dates": { "@id": "x", "date": ["2023-03-20", "2023-04-12", "2023-05-30"]}</pre></div></td></tr><tr><th>Example input (2)</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;dates id="x"&gt;
  &lt;date&gt;&lt;year&gt;2023&lt;/year&gt;&lt;month&gt;03&lt;/month&gt;&lt;day&gt;20&lt;/day&gt;&lt;/date&gt;
  &lt;date&gt;&lt;year&gt;2023&lt;/year&gt;&lt;month&gt;04&lt;/month&gt;&lt;day&gt;12&lt;/day&gt;&lt;/date&gt;
  &lt;date&gt;&lt;year&gt;2023&lt;/year&gt;&lt;month&gt;05&lt;/month&gt;&lt;day&gt;30&lt;/day&gt;&lt;/date&gt;
&lt;/dates&gt;</pre></div></td></tr><tr><th>Example output (2)</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">{ "dates": {
   "@id": "x", 
   "date": [ 
    { "year": "2023", "month": "03", "day": "20" },
    { "year": "2023", "month": "04", "day": "12" },
    { "year": "2023", "month": "05", "day": "30" }
  ] } }</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The content is represented by a map containing one entry for each attribute in the XML element, plus a property named after the child elements (the <b>content property</b>), whose value is an array containing the results of formatting the content in the same way as the <code>list</code> layout.</p><p>If there are no children and the element is untyped (which can occur when this layout is chosen explicitly via the options to <a href="#func-element-to-map"><code>fn:element-to-map</code></a>) then the content property is omitted (since the child element name is unknown). But if the element is typed, then the content property is included and set to the empty array.</p></td></tr><tr><th>Mapping for nilled elements</th><td><p>The array-valued entry in the result is replaced by the entry <code>"#content": #fn:null</code>, which serializes to the JSON value <code>null</code>. For example the element <code>&lt;dates id="x" xsi:nil="true"/&gt;</code> becomes <code>{"dates": { "@id": "x", "#content": #fn:null } }</code>.</p></td></tr><tr><th>Errors</th><td><p>Any attributes on the element's children are discarded. Comments, processing instructions, and whitespace text nodes in the content are discarded.</p><p>This layout fails if any child element is present with a name that differs from the expected child element name, or if there are non-whitespace text node children.</p></td></tr></tbody></table></div><div class="div4"><h5><a id="id-record-layout"></a>14.5.1.7 <a href="#id-record-layout" style="text-decoration: none">Layout: Record</a></h5><table class="data"><tbody><tr><th>Layout name</th><td><p><code>record</code></p></td></tr><tr><th>Usage</th><td><p>Intended primarily for XML elements that contain multiple child elements, with different names, where the order of the child elements is not significant. Also used for elements whose content is a single element node child. The element may or may not have attributes.</p></td></tr><tr><th>Example input (1)</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;employee id="x"&gt;
  &lt;date-of-birth&gt;1984-03-20&lt;/date&gt;
  &lt;location&gt;Germany&lt;/location&gt;
  &lt;position&gt;Janitor&lt;/position&gt;
&lt;/employee&gt;</pre></div></td></tr><tr><th>Example output (1)</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">{ "employee": { "@id": "x", 
                "date-of-birth": "1984-03-20", 
                "location": "Germany", 
                "position": "Janitor"
              }
}</pre></div></td></tr><tr><th>Example input (2)</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;employee id="x"&gt;
  &lt;date-of-birth&gt;1984-03-20&lt;/date&gt;
  &lt;location&gt;Germany&lt;/location&gt;
  &lt;position&gt;Janitor&lt;/position&gt;
  &lt;position&gt;Gardener&lt;/position&gt;
&lt;/employee&gt;</pre></div></td></tr><tr><th>Example output (2)</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">{ "employee": { "@id": "x", 
                "date-of-birth": "1984-03-20", 
                "location": "Germany", 
                "position": [ "Janitor", "Gardener" ]
              }
}</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The content is represented by a map containing one entry for each attribute in the XML element, plus one entry for each child element, whose value is formatted according to the rules for that element.</p><p>If two or more child elements have the same name, or names that are represented by the same string (taking into account the chosen <code>name-format</code> option), then they are combined into a single entry containing all the corresponding values as members of an array. For example, if there are two children <code>&lt;author&gt;Mills&lt;/author&gt;</code> and <code>&lt;author&gt;Boon&lt;/author&gt;</code>, they are combined into a single entry <code>"author": ["Mills", "Boon"]</code>.</p><p>The <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup> of the resulting map first contains entries derived from attributes (in unpredictable order), then entries derived from child elements, in order of first appearance.</p></td></tr><tr><th>Mapping for nilled elements</th><td><p>Alongside any attributes, the value includes the additional entry <code>"#content": #fn:null</code>, which will be serialized in JSON as <code>"#content": null</code>.</p></td></tr><tr><th>Errors</th><td><p>Although this layout is intended primarily for elements whose children are unordered and uniquely named, it is also viable to use it in cases where elements can repeat, so long as order relative to other elements is not significant.</p><p>Comments, processing instructions, and whitespace text nodes in the content are discarded.</p><p>This layout fails if there are non-whitespace text node children.</p></td></tr></tbody></table></div><div class="div4"><h5><a id="id-sequence-layout"></a>14.5.1.8 <a href="#id-sequence-layout" style="text-decoration: none">Layout: Sequence</a></h5><table class="data"><tbody><tr><th>layout name</th><td><p><code>sequence</code></p></td></tr><tr><th>Usage</th><td><p>Intended for XML elements that contain a sequence of element node children, whose order is significant. The element may or may not have attributes.</p></td></tr><tr><th>Example input</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;section id="x"&gt;
   &lt;head&gt;Introduction&lt;/head&gt;
   &lt;p&gt;Lorem ipsum.&lt;/p&gt;
   &lt;p&gt;Dolor sit amet.&lt;/p&gt;
&lt;/section&gt;</pre></div></td></tr><tr><th>Example output</th><td><div class="exampleInner"><pre xml:space="preserve" class="small">{ "section": [
      { "@id": "x" },                        
      { "head": "Introduction" },
      { "p": "Lorem ipsum." },
      { "p": "Dolor sit amet." }
   ] }</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The mapping rules are identical to the rules for the <code>mixed</code> layout (see <a href="#id-mixed-layout"><b>14.5.1.9 Layout: Mixed</b></a>) except that whitespace-only text nodes are discarded.</p></td></tr><tr><th>Mapping for nilled elements</th><td><p>A nilled element is indicated by including an additional map <code>{ "#content" : #fn:null}</code> in the array, after any attributes.</p></td></tr><tr><th>Errors</th><td><p>This layout fails if there are non-whitespace text node children.</p></td></tr></tbody></table></div><div class="div4"><h5><a id="id-mixed-layout"></a>14.5.1.9 <a href="#id-mixed-layout" style="text-decoration: none">Layout: Mixed</a></h5><table class="data"><tbody><tr><th>Layout name</th><td><p><code>mixed</code></p></td></tr><tr><th>Usage</th><td><p>Intended for XML elements that contain mixed content (that is, elements that contain both child elements and child text nodes, intermingled). The element may or may not have attributes.</p></td></tr><tr><th>Example input</th><td><div class="exampleInner"><pre xml:space="preserve">&lt;para id="x"&gt;This is a &lt;i&gt;fine&lt;/i&gt; mess!&lt;/para&gt;</pre></div></td></tr><tr><th>Example output</th><td><div class="exampleInner"><pre xml:space="preserve">{ "para": [
     { "@id": "x" },
     "This is a ",
     { "i": "fine" },
     "mess!"
   ] }</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The content is represented by an XDM array containing one entry for each attribute in the XML element, and one entry for each child node, in order. </p><p>Each attribute node is represented within this array by a single-entry map: the rules for attribute names are defined in <a href="#element-and-attribute-names"><b>14.5.7 Element and Attribute Names</b></a>, and the rules for attribute content in <a href="#element-and-attribute-content"><b>14.5.8 Element and Attribute Content</b></a>.</p><p>Child nodes are represented within the array as follows:</p><ul><li><p>A text node child is represented as an atomic item of type <code>xs:untypedAtomic</code>.</p></li><li><p>An element node child is represented as a map containing a single entry, with the key representing the element name and the value representing the element's content, formatted according to the chosen layout for that element.</p></li><li><p>A comment node is represented as a map containing a single entry whose key is the string <code>"#comment"</code>, and whose corresponding value is an atomic item of type <code>xs:string</code> containing the text of the comment.</p></li><li><p>A processing instruction node is represented as a map containing a single entry whose key is the string <code>"#processing-instruction"</code> and whose value is a map with two entries: the first has the key <code>"#target"</code> with the value being the name of the processing instruction as an atomic item of type <code>xs:NCName</code>; the second has the key <code>"#data"</code> with the value being an atomic item of type <code>xs:string</code> containing the string value of the processing instruction node.</p></li></ul><p>Whitespace text nodes are retained.</p></td></tr><tr><th>Mapping for nilled elements</th><td><p>A nilled element is indicated by including an additional map <code>{ "#content" : #fn:null}</code> in the array, after any attributes. For example, <code>&lt;para id="p2" xsi:nil="true"/&gt;</code> becomes <code>{"para": [ { "id": "p2" }, { "#content": #fn:null } ] }</code>. In JSON the value <code>#fn:null</code> is serialized as <code>null</code>.</p></td></tr><tr><th>Errors</th><td><p>All children are retained, including comments, processing instructions, and text nodes, whether or not they are whitespace-only.</p><p>This layout never fails.</p></td></tr></tbody></table></div><div class="div4"><h5><a id="id-xml-layout"></a>14.5.1.10 <a href="#id-xml-layout" style="text-decoration: none">Layout: Serialized XML</a></h5><p>Serialized layout allows an element node to be represented as lexical XML, contained within a map.</p><table class="data"><tbody><tr><th>Layout name</th><td><p><code>xml</code></p></td></tr><tr><th>Usage</th><td><p>This layout is useful when the input contains a mix of structured data and marked-up textual content. It allows the textual content to be output as serialized XML. It is also used as a fallback representation when the selected element layout is inappropriate for a particular element.</p></td></tr><tr><th>Example input</th><td><div class="exampleInner"><pre xml:space="preserve">&lt;p&gt;That was &lt;i&gt;awesome&lt;/i&gt;&lt;/p&gt;</pre></div></td></tr><tr><th>Example output</th><td><div class="exampleInner"><pre xml:space="preserve">{ "p": "&lt;p&gt;That was &lt;i&gt;awesome&lt;/i&gt;&lt;/p&gt;" }</pre></div></td></tr><tr><th>Mapping rules</th><td><p>The element node is serialized as if by the <a href="#func-serialize"><code>fn:serialize</code></a> function, and the resulting content is output as an atomic item of type <code>xs:string</code>.</p><p>The serialization parameter <code>method</code> is set to <code>"xml"</code>.</p><p>The serialization parameter <code>indent</code> is set to <code>false</code>.</p><p>The serialization parameter <code>omit-xml-declaration</code> is set to true.</p><p>Other serialization parameters take their default values.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The outermost element name will typically be repeated, for example <code>"p": "&lt;p&gt;Lorem ipsum&lt;/p&gt;"</code>.</p></div></td></tr><tr><th>Mapping for nilled elements</th><td><p>A nilled element is represented using its normal XML serialization, that is, the output serialization includes the attribute <code>xsi:nil="true"</code>, together with a declaration of the <code>xsi</code> namespace prefix.</p></td></tr><tr><th>Errors</th><td><p>This layout never fails.</p></td></tr></tbody></table></div></div><div class="div3"><h4><a id="id-creating-a-conversion-plan"></a>14.5.2 <a href="#id-creating-a-conversion-plan" style="text-decoration: none">Creating a conversion plan</a></h4><p>It is possible to create a conversion plan by analyzing a collection of sample input documents. The function <a href="#func-element-to-map-plan"><code>fn:element-to-map-plan</code></a> is supplied with a collection of nodes (which will normally be element or document nodes), and it examines all the elements within the trees rooted at these nodes, looking for commonalities among like-named elements.</p><p>The output of this function (the conversion plan) holds information about how elements and attributes (identified by name) should be converted.</p><p>For elements, the information is primarily a mapping from element names (<code>xs:QName</code> instances) to layout names. In some cases additional information beyond the layout name is also included. The conversion plan is represented as an XDM map, whose structure is defined in this specification. A conversion plan can be constructed directly, or the plan produced by calling <a href="#func-element-to-map-plan"><code>fn:element-to-map-plan</code></a> can be modified before use. The plan can be serialized using the JSON output method and reloaded so that the same plan is used whenever a query or stylesheet is executed.</p><p>The <a href="#func-element-to-map-plan"><code>fn:element-to-map-plan</code></a> function selects a layout for a given element name <var>N</var> by applying the following rules:</p><ol class="enumar"><li><p>Let <code>$EE</code> be the set of all elements named <var>N</var>, specifically <code>$input/descendant-or-self::*[node-name(.) eq <var>N</var>]</code>. </p></li><li><p>If <code>empty($EE/(* | text())</code> (that is, if there are no child elements or text nodes) then:</p><ol class="enumla"><li><p>If <code>empty($EE/@*)</code> (that is, if there are no attributes), then the layout is <code>empty</code>: see <a href="#id-empty-layout"><b>14.5.1.1 Layout: Empty Content</b></a>.</p></li><li><p>Otherwise, the layout is <code>empty-plus</code>: see <a href="#id-empty-plus-layout"><b>14.5.1.2 Layout: Empty Content with Attributes</b></a>.</p></li></ol></li><li><p>If <code>empty($EE/*)</code> (that is, if there are no child elements) then:</p><ol class="enumla"><li><p>If <code>empty($EE/@*)</code> (that is, if there are no attributes) then the layout is <code>simple</code>: see <a href="#id-simple-layout"><b>14.5.1.3 Layout: Simple Content</b></a>.</p></li><li><p>Otherwise, <code>simple-plus</code>: see <a href="#id-simple-plus-layout"><b>14.5.1.4 Layout: Simple Content with Attributes</b></a>.</p></li><li><p>The plan also includes the property <code>type</code>. If all the elements in <code>$EE</code> are castable as <code>xs:boolean</code>, then the type is <code>boolean</code>; otherwise, if all the elements in <code>$EE</code> as castable as <code>xs:numeric</code>, then the type is <code>numeric</code>; otherwise, the type is <code>string</code>.</p></li></ol></li><li><p>If <code>empty($EE/text()[normalize-space()])</code> (that is, there are no text node children other than whitespace), then:</p><ol class="enumla"><li><p>If <code>all-equal($EE/*/node-name()) and exists($EE/*[2])</code> (that is, if all child elements have the same name, and at least one element has multiple child elements), then:</p><ol class="enumlr"><li><p>If <code>empty($EE/@*)</code> (that is, if there are no attributes) then <code>list</code>: see <a href="#id-list-layout"><b>14.5.1.5 Layout: Simple List</b></a>.</p></li><li><p>Otherwise, <code>list-plus</code>: see <a href="#id-list-plus-layout"><b>14.5.1.6 Layout: List with Attributes</b></a>.</p></li></ol></li><li><p>If <code>every $e in $EE satisfies all-different($e/*/node-name())</code> (that is, the child elements are uniquely named among their siblings), then <code>record</code>: see <a href="#id-record-layout"><b>14.5.1.7 Layout: Record</b></a>.</p></li><li><p>Otherwise, <code>sequence</code>: see <a href="#id-sequence-layout"><b>14.5.1.8 Layout: Sequence</b></a>.</p></li></ol></li><li><p>Otherwise, <code>mixed</code>: see <a href="#id-mixed-layout"><b>14.5.1.9 Layout: Mixed</b></a>.</p></li></ol><p>For elements with simple content (more specifically, elements where the chosen layout is <code>simple</code> or <code>simple-plus</code>) the conversion plan also includes an entry indicating whether the content should be represented as a boolean, a number, or a string. If every instance of the element name has content that is castable to <code>xs:boolean</code>, the plan indicates <code>"type": "boolean"</code>. If every instance of the element name has content that is castable to <code>xs:numeric</code>, the plan indicates <code>"type": "numeric"</code>. In other cases, the plan indicates <code>"type": "string"</code>; however, this may be omitted because it is the default.</p><p>For attributes, the conversion plan identifies whether attributes (with a given name) should be represented as booleans, numbers, or strings; alternatively, it may indicate that attributes with a given name should be discarded. For every distinct attribute name present in the input, an entry is output associating the attribute name with one of the types <code>boolean</code> or <code>numeric</code>; the entry is generally omitted when the values are to be represented as strings, though the type can also be given explicitly as <code>string</code>. An entry with type <code>boolean</code> is generated for an attribute name if all the attributes with that name are castable as <code>xs:boolean</code>. Similarly, an entry with type <code>numeric</code> is generated for an attribute name if all the attributes with that name are castable as <code>xs:numeric</code>. In other case, the attributes are treated as being of type <code>string</code>. Entries with type <code>string</code> may be omitted, since that is the default. The entry for an attribute may also specify <code>"type": "skip"</code> to indicate that the attribute should be discarded.</p><p>A plan that is produced by analyzing a corpus of input documents can then be customized by the user if required. For example:</p><ul><li><p>If <code>simple</code> layout is chosen for a particular element name, but it is known that some documents might be encountered in which that element has attributes, then <code>simple</code> might be changed to <code>simple-plus</code>.</p></li><li><p>If <code>record</code> layout is chosen for a particular element name, but it is known that some documents might be encountered in which child elements can be repeated, then <code>record</code> might be changed to <code>sequence</code>.</p></li><li><p>If a generated plan determines that phone numbers should be represented as numbers, it might be modified to treat them as strings.</p></li></ul><p>The conversion plan is a map of type <code>map(xs:string, record(*))</code>. The key is an element or attribute name, representing element names in the form <code>Q{uri}local</code>, and attributes in the form <code>@Q{uri}local</code>notation: in both cases the <code>Q{uri}</code> part <span class="verb">must</span> be omitted for a name in no namespace. Strings are used as keys in preference to <code>xs:QName</code> instances to allow the plan to be serialized in JSON format.</p><p>A more detailed definition of the structure is given in <a href="#id-conversion-plan-structure"><b>14.5.4 Structure of the conversion plan</b></a>.</p><p>A small example might be (in its JSON serialization):</p><div class="exampleInner"><pre xml:space="preserve" class="small">{ "bookList": { "layout": "list", "child": "book" },
  "book": { "layout": "record" },
  "author": { "layout": "simple" },
  "title": { "layout": "simple" },
  "price": { "layout": "simple", "type": "numeric" },
  "hardback": { "layout": "simple", "type": "boolean" },
  "@out-of-print": { "type": "boolean" },
  "@Q{http://www.w3.org/2001/XMLSchema-instance}nil": { "type": "skip" }
}</pre></div></div><div class="div3"><h4><a id="id-xsi-attributes"></a>14.5.3 <a href="#id-xsi-attributes" style="text-decoration: none">Attributes in the <code>xsi</code> namespace</a></h4><p>This section defines modifications to the above rules that apply to elements having attributes in the <code>xsi</code> namespace (that is, <code>http://www.w3.org/2001/XMLSchema-instance</code>).</p><ul><li><p>When analyzing a corpus using <a href="#func-element-to-map-plan"><code>fn:element-to-map-plan</code></a>, elements having the attribute <code>xsi:nil="true"</code> are ignored. If all elements with a given name have this attribute, allocate the layout <code>mixed</code>.</p></li><li><p>When deciding whether an element has any attributes (for example to decide between the layouts <code>empty</code> and <code>empty-plus</code>), all attributes in the <code>xsi</code> namespace are ignored.</p></li><li><p>When converting an individual element to a map, all attributes in the <code>xsi</code> namespace are ignored.</p></li><li><p>Notwithstanding the above, elements having the <code>nilled</code> property (which essentially means they are schema-validated and have the attribute <code>xsi:nil="true"</code>), are treated specially by each of the possible element layouts.</p></li></ul></div><div class="div3"><h4><a id="id-conversion-plan-structure"></a>14.5.4 <a href="#id-conversion-plan-structure" style="text-decoration: none">Structure of the conversion plan</a></h4><p>This section provides a definition of the structure of the conversion plan that is output by the <a href="#func-element-to-map-plan"><code>fn:element-to-map-plan</code></a> function, and used as input to the <a href="#func-element-to-map"><code>fn:element-to-map</code></a> function.</p><p>The structure is defined by the following item type:</p><div class="exampleInner"><pre xml:space="preserve" class="small">map( xs:string,
     record ( layout? as enum("empty", "empty-plus", "simple", "simple-plus",
                              "list", list-plus",
                              "record", "sequence", "mixed",
                              "xml", "error", "deep-skip"),
              child? as xs:string,
              type? as enum("boolean", "numeric", "string", "skip")
              * )
)</pre></div><p>The rules relating to this structure are as follows:</p><ol class="enumar"><li><p>The keys of the map entries are strings of the form:</p><ol class="enumla"><li><p><code>local-name</code> representing the name of an element in no namespace.</p></li><li><p><code>Q{uri}local-name</code> representing the name of an element in a namespace.</p></li><li><p><code>*</code> representing a fallback rule for use with elements where either (a) there is no more specific rule, or (b) processing using the selected layout fails.</p></li><li><p><code>@local-name</code> representing the name of an attribute in no namespace.</p></li><li><p><code>@Q{uri}local-name</code> representing the name of an attribute in a namespace.</p></li></ol><p>Any entries whose keys are not in this format will be ignored.</p></li><li><p>The <code>layout</code> entry is present if and only if the key represents the name of an element.</p></li><li><p>The <code>child</code> entry is present if and only if the value of <code>layout</code> is <code>list</code> or <code>list-plus</code>. It represents an element name in the format <code>local-name</code> for a name in no namespace, or <code>Q{uri}local-name</code> for a name in a namespace.</p></li><li><p>The <code>type</code> entry is present if, and only if, one of the following conditions applies:</p><ol class="enumla"><li><p>The key represents the name of an attribute.</p></li><li><p>The <code>layout</code> is <code>simple</code> or <code>simple-plus</code>. In this case the value must not be <code>"skip"</code>.</p></li></ol></li></ol><p>If additional entries (beyond those described above) are present in any of the maps, they are ignored, provided that the map is coercible to the given type definition.</p><p>The fallback rule (with key <code>"*"</code>) is used to process elements whose name has no specific entry, and also for elements where normal processing fails (for example when the selected layout is <code>"empty"</code>, but the element has children). If no fallback rule is present then <code>"error"</code> is assumed: this causes processing to fail with a dynamic error. The fallback rule will typically set the <code>layout</code> property to one of the following:</p><ul><li><p><code>error</code>: this causes the function to fail with a dynamic error.</p></li><li><p><code>deep-skip</code>: this causes the element and its content (recursively) to be omitted from the output.</p></li><li><p><code>mixed</code>: this causes the element to be output using layout <code>mixed</code></p></li><li><p><code>xml</code>: this outputs the element to be output using layout <code>xml</code>, which represents the content as a string containing serialized XML.</p></li></ul><p>However, any layout may be used as the fallback; if it fails, the error is unrecoverable.</p></div><div class="div3"><h4><a id="id-schema-based-conversion"></a>14.5.5 <a href="#id-schema-based-conversion" style="text-decoration: none">Schema-based conversion</a></h4><p>As an alternative to constructing a conversion plan by analyzing a corpus of specimen documents, conversion may be controlled using type annotations derived from schema validation.</p><p>If the function <a href="#func-element-to-map"><code>element-to-map</code></a> encounters an element whose name is not present in the conversion plan (including the case where no plan is supplied), and if the element has a type annotation <var>T</var> other than <code>xs:anyType</code> or <code>xs:untyped</code>, then the following rules apply:</p><div class="note"><p class="prefix"><b>Note:</b></p><p>This section uses the notation <code>{prop}</code> to refer to properties of schema components, as defined in <a href="#xmlschema11-1">[XSD 1.1 Part 1]</a>. The schema component model from XSD 1.1 is used; when XSD 1.0 is used for validation, some properties such as <code>{open content}</code> will inevitably be absent.</p></div><ol class="enumar"><li><p>Let <code>zeroLength(ST)</code> be true for a simple type <code>ST</code> if any of the following conditions is true:</p><ol class="enumla"><li><p><code>ST.{variety} = list</code>, and <code>ST.{facets}</code> includes a <code>length</code> or <code>maxLength</code> facet whose value is 0 (zero).</p></li><li><p><code>ST.{variety} = atomic</code>, and <code>ST.{facets}</code> includes a <code>length</code> or <code>maxLength</code> facet whose value is 0 (zero).</p></li><li><p><code>ST.{variety} = atomic</code>, and <code>ST.{facets}</code> includes an <code>enumeration</code> facet constraining the value to be zero-length.</p></li><li><p><code>ST.{variety} = atomic</code>, and <code>ST.{facets}</code> includes a <code>pattern</code> facet with the value <code>""</code> (a zero-length string).</p></li></ol></li><li><p>If <var>T</var> is a simple type:</p><ol class="enumla"><li><p>If <code>zeroLength(T)</code>, then the selected layout is <code>empty</code> (see <a href="#id-empty-layout"><b>14.5.1.1 Layout: Empty Content</b></a>).</p></li><li><p>Otherwise, the selected layout is <code>simple</code> (see <a href="#id-simple-layout"><b>14.5.1.3 Layout: Simple Content</b></a>), and the selected type is <code>boolean</code> if <var>T</var> is derived from <code>xs:boolean</code>; <code>numeric</code> if <var>T</var> is derived from <code>xs:decimal</code>, <code>xs:double</code>, or <code>xs:float</code>; or <code>string</code> otherwise.</p></li></ol></li><li><p>Otherwise (if <var>T</var> is a complex type):</p><ol class="enumla"><li><p>Let <code>$noAttributes</code> be true if <code>T.{attribute uses}</code> is empty and <code>T.{attribute wildcard}</code> is absent.</p></li><li><p>If <code>T.{content type}.{variety} = empty</code>, then:</p><ol class="enumlr"><li><p>If <code>$noAttributes</code> and if <code>empty</code> layout is not disabled, then the selected layout is <code>empty</code> (see <a href="#id-empty-layout"><b>14.5.1.1 Layout: Empty Content</b></a>).</p></li><li><p>Otherwise, the selected layout is <code>empty-plus</code> (see <a href="#id-empty-plus-layout"><b>14.5.1.2 Layout: Empty Content with Attributes</b></a>).</p></li></ol></li><li><p>If <code>T.{content type}.{variety} = simple</code> (a complex type with simple content), then:</p><ol class="enumlr"><li><p>Let <code>ST</code> be <code>T.{content type}.{simple type definition}</code> (the corresponding simple type).</p></li><li><p>If <code>zeroLength(ST)</code>, then:</p><ol class="enumua"><li><p>If <code>$noAttributes</code>, the selected layout is <code>empty</code> (see <a href="#id-empty-layout"><b>14.5.1.1 Layout: Empty Content</b></a>).</p></li><li><p>Otherwise, the selected layout is <code>empty-plus</code> (see <a href="#id-empty-plus-layout"><b>14.5.1.2 Layout: Empty Content with Attributes</b></a>).</p></li></ol></li><li><p>Otherwise:</p><ol class="enumua"><li><p>If <code>$noAttributes</code>, the selected layout is <code>simple</code> (see <a href="#id-simple-layout"><b>14.5.1.3 Layout: Simple Content</b></a>).</p></li><li><p>Otherwise the selected layout is <code>simple-plus</code> (see <a href="#id-simple-plus-layout"><b>14.5.1.4 Layout: Simple Content with Attributes</b></a>).</p></li><li><p>In both cases the selected type is one of <code>boolean</code><code>numeric</code>, or <code>string</code>, chosen in the same way as for elements having a simple type.</p></li></ol></li></ol></li><li><p>If <code>T.{content type}.{variety} = element-only</code> (a complex type with an element-only content model):</p><ol class="enumlr"><li><p>Let <code>$noWildcards</code> be true if <code>T.{content type}.{open content}</code> is absent, and <code>T.{content type}.{particle}</code>, expanded recursively, contains no wildcard term.</p></li><li><p>Let <code>$childCardinalities</code> be a set of (<code>xs:QName</code>, <code>xs:double</code>) pairs representing the expanded names of the element declaration terms within <code>T.{content type}.{particle}</code>, expanded recursively, and for each one, the maximum number of occurrences of elements with that name, computed using the value of the <code>{maxOccurs}</code> property of the particles at each level, taking the value <code>unbounded</code> as positive infinity.</p></li><li><p>If <code>$noWildcards</code> is true, and if <code>$childCardinalities</code> contains a single entry, and that entry has a cardinality greater than one, then:</p><ol class="enumua"><li><p>If <code>$noAttributes</code> then the selected layout is <code>list</code> (see <a href="#id-list-layout"><b>14.5.1.5 Layout: Simple List</b></a>).</p></li><li><p>Otherwise, the selected layout is <code>list-plus</code> (see <a href="#id-list-plus-layout"><b>14.5.1.6 Layout: List with Attributes</b></a>).</p></li></ol></li><li><p>If <code>$noWildcards</code> is true, and if every entry in <code>$childCardinalities</code> has a cardinality of one, then the selected layout is <code>record</code> (see <a href="#id-record-layout"><b>14.5.1.7 Layout: Record</b></a>).</p></li><li><p>Otherwise, the selected layout is <code>sequence</code> (see <a href="#id-sequence-layout"><b>14.5.1.8 Layout: Sequence</b></a>).</p></li></ol></li><li><p>Otherwise (that is, when <code>T.{content type}.{variety} = mixed</code>, the selected layout is <code>mixed</code> (see <a href="#id-mixed-layout"><b>14.5.1.9 Layout: Mixed</b></a>).</p></li></ol></li></ol><p>For attribute nodes, the selected type is <code>boolean</code> if the type annotation is derived from <code>xs:boolean</code>; <code>numeric</code> if the type annotation is derived from <code>xs:decimal</code>, <code>xs:double</code>, or <code>xs:float</code>; and <code>string</code> otherwise.</p></div><div class="div3"><h4><a id="id-selecting-element-layout"></a>14.5.6 <a href="#id-selecting-element-layout" style="text-decoration: none">Selecting an element layout</a></h4><p>The various layouts available for elements are described in <a href="#id-element-layouts"><b>14.5.1 Element Layouts</b></a>. This section defines the rules for selecting an element layout for a given element <var>E</var>. The rules are applied in order.</p><ol class="enumar"><li><p>If an explicit layout is given for the element name of <var>E</var> in the conversion plan supplied to the <a href="#func-element-to-map"><code>fn:element-to-map</code></a> function call, then that layout is used. If the selected layout is <code>deep-skip</code>, then no output is produced for that element. If the selected layout is <code>error</code>, then the function fails with a dynamic error. If the selected layout fails for the element instance, then the fallback layout (identified with the key <code>"*"</code> in the conversion plan) is used; in the absence of a fallback layout, the function fails with a dynamic error.</p></li><li><p>Otherwise (when no explicit layout is given for <var>E</var>), if the type annotation of the element is something other than <code>xs:untyped</code> or <code>xs:anyType</code>, then a schema-determined layout is used as defined in <a href="#id-schema-based-conversion"><b>14.5.5 Schema-based conversion</b></a>.</p></li><li><p>Otherwise, if the conversion plan supplies a fallback layout (identified with the key <code>"*"</code>), then the fallback layout is used.</p></li><li><p>If the above rules do not provide a layout for <var>E</var>, then a conversion plan for <var>E</var> is determined by applying the rules in <a href="#id-creating-a-conversion-plan"><b>14.5.2 Creating a conversion plan</b></a>, with an input that contains the single element <var>E</var> and no others. (Only the element <var>E</var> itself is considered, not its descendants.)</p></li></ol></div><div class="div3"><h4><a id="element-and-attribute-names"></a>14.5.7 <a href="#element-and-attribute-names" style="text-decoration: none">Element and Attribute Names</a></h4><p>The <code>name-format</code> option gives control over how element and attribute names are formatted. There are four options:</p><ul><li><p>The default option (which may be explicitly requested by specifying <code>"name-format": "default"</code>) retains the namespace URI for any element that is either (a) the top-level element of a tree being converted, or (b) has a name that is in a different namespace from its parent element. In such cases the format <code>"Q{uri}local"</code> is used. For other elements, the name is output using the local part of the element name alone. For attributes, the form <code>"Q{uri}local"</code> is used for an attribute in a namespace, and the local name alone is used for a no-namespace name. Namespace prefixes are not retained.</p></li><li><p>The option <code>eqname</code> uses the format <code>"Q{uri}local"</code> for all element and attribute names that are in a namespace, or the local name alone for all names that are not in a namespace.</p></li><li><p>The option <code>local</code> discards all namespace information: all elements and attributes are output using the local name alone.</p></li><li><p>The option <code>lexical</code> outputs element and attribute names in the form obtained by calling the function <a href="#func-name"><code>fn:name</code></a>. If the name has a prefix, the prefix is retained in the output. However, the output contains no information that enables the prefix to be associated with a namespace URI, so this format is suitable only when prefixes in the input documents are used predictably.</p></li></ul><p>Regardless of the chosen <code>name-format</code>, and regardless of the above rules, attributes in the <code>xml</code> namespace (<code>http://www.w3.org/XML/1998/namespace</code>) are output using a lexical QName, with the prefix <code>xml</code>.</p><p>Attribute names in the output are typically prefixed with the character <code>"@"</code>. The option <code>attribute-marker</code> allows this to be changed to a different prefix or none.</p><p>Whichever format of names is chosen, if the rules for the selected layout would result in an output map having two entries with the same key, the conflict is resolved by combining these entries into an array. For example if <code>name-format</code> is set to <code>local</code> then the element <code>&lt;data x:val="3" y:val="4"/&gt;</code> becomes either <code>{ "data": { "@val": ["3", "4"] } }</code> or (because attribute order is unpredictable) <code>{ "data": { "@val": ["4", "3"] } }</code>.</p></div><div class="div3"><h4><a id="element-and-attribute-content"></a>14.5.8 <a href="#element-and-attribute-content" style="text-decoration: none">Element and Attribute Content</a></h4><p>The conversion plan may indicate that element content is to be output as type <code>string</code>, <code>numeric</code>, or <code>boolean</code>: the default is <code>string</code>. In the case of untyped elements and attributes, the value is output as an instance of a string, numeric, or boolean type, according to this prescription. Specifically:</p><ul><li><p>If the prescribed type is <code>boolean</code> and the value is castable as <code>xs:boolean</code>, then it is output as an instance of <code>xs:boolean</code>.</p></li><li><p>If the prescribed type is <code>numeric</code> and the value is castable as <code>xs:numeric</code>, then it is output as an instance of <code>xs:integer</code>, <code>xs:decimal</code>, or <code>xs:double</code> depending on the lexical form of the value, following the same rules as for XPath numeric literals. For example, <code>"-1"</code> becomes an <code>xs:integer</code>, <code>12.00</code> becomes an <code>xs:decimal</code>, and <code>1e-3</code> becomes an <code>xs:double</code>. The special <code>xs:double</code> values <code>NaN</code> and <code>INF</code> (which cannot be used as numeric literals) are also recognized.</p></li><li><p>In all other cases the value is output as an instance of <code>xs:untypedAtomic</code>, retaining its original lexical form.</p></li></ul><p>Where the element or attribute is schema-validated, however:</p><ol class="enumar"><li><p>If an element has the <code>nilled</code> property (that is, <code>xsi:nil="true"</code>), then the mapping for nilled elements with the chosen layout is used.</p></li><li><p>Let <var>AV</var> be the typed value of the node (that is, the result of atomization).</p></li><li><p>If, however, an element is annotated with a type that does not allow atomization (specifically, a complex type with element-only content) then let <var>AV</var> be the string value of the element, as an atomic item of type <code>xs:untypedAtomic</code>.</p></li><li><p>If an attribute is annotated as having a simple type of {variety} <code>list</code>, or if an element using layout <code>simple</code> or <code>simple-plus</code> is annotated as having either a simple type of {variety} <code>list</code> or a complex type with simple content of {variety} <code>list</code> then the atomized value <var>AV</var> is represented in the result as the array represented by the XPath expression <code>array{<var>AV</var>}</code>. This applies whether or not the atomized value actually contains multiple atomic items. The individual atomic items in the array retain their type, for example items of type <code>xs:date</code> remain items of type <code>xs:date</code> in the result.</p></li><li><p>In all other cases <var>AV</var> will be a single atomic item, and this value is used <em>as is</em>, retaining its type.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Atomic items in the result of the <a href="#func-element-to-map"><code>fn:element-to-map</code></a> function may thus be of any atomic type. The type information is lost if the result is subsequently serialized as JSON.</p></div></div><div class="div3"><h4><a id="id-loss-of-xdm-information"></a>14.5.9 <a href="#id-loss-of-xdm-information" style="text-decoration: none">Lost XDM Information</a></h4><p>This section is non-normative. Its purpose is to explain what information available in the XDM nodes supplied as input to the <a href="#func-element-to-map"><code>fn:element-to-map</code></a> function is missing from the output.</p><ul><li><p><em>Element and attribute names: </em> If the chosen <code>name-format</code> is <code>default</code> or <code>eqname</code>, then local names and namespace URIs of elements and attributes are retained, but namespace prefixes are lost. If the chosen <code>name-format</code> is <code>lexical</code>, then prefixes are retained but namespace URIs are lost. If the chosen <code>name-format</code> is <code>local</code> then only local names are retained; namespace URIs and prefixes are lost.</p><p>In addition, element names are lost when the parent element is mapped using <code>list</code> layout: see <a href="#id-list-layout"><b>14.5.1.5 Layout: Simple List</b></a>.</p></li><li><p><em>In-scope namespaces: </em> All information about in-scope namespaces (and in particular, bindings for namespaces that are declared but not used in element and attribute names) is lost.</p></li><li><p><em>Comments and processing instructions: </em> Comments and processing instructions are lost except when they appear as children of elements that are mapped using the <code>sequence</code>, <code>mixed</code> or <code>xml</code> layouts.</p></li><li><p><em>Text nodes: </em>Whitespace text nodes are discarded when they appear as children of elements that are mapped using the <code>empty</code>, <code>empty-plus</code>, <code>list</code>, <code>list-plus</code>, <code>record</code>, or <code>sequence</code> layouts. Non-whitespace text nodes are never discarded. </p></li><li><p><em>Additional node properties: </em> The values of the <code>is-id</code>, <code>is-idref</code>, and <code>is-nilled</code> properties of a node are lost.</p></li><li><p><em>Type annotations: </em> The values of type annotations on elements are lost. Type annotations on atomized values of schema-validated nodes, however, are retained.</p></li><li><p><em>Element order: </em> The order of child elements is lost when <code>record</code> layout is used and the element has multiple children with the same name.</p></li><li><p><em>XSI attributes: </em> Attributes in the <code>xsi</code> namespace (for example, <code>xsi:type</code> and <code>xsi:nil</code>) are not represented in the result. .</p></li></ul></div><div class="div3"><h4><a id="id-element-to-map-examples"></a>14.5.10 <a href="#id-element-to-map-examples" style="text-decoration: none">Examples</a></h4><p>The following examples show the effect of transforming some simple XML documents with default options, and then serializing the result as JSON with <code>indent</code> is set to <code>true</code>. The actual indentation is implementation dependent.</p><table class="data"><thead><tr><th>XDM element</th><th>JSON serialization of result</th></tr></thead><tbody><tr><td><div class="exampleInner"><pre xml:space="preserve">&lt;a x='1' b='2'/&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve">{ "a":{
    "@x": "1",
    "@b": "2"
  } }</pre></div></td></tr><tr><td><div class="exampleInner"><pre xml:space="preserve">&lt;a&gt;&lt;x&gt;1&lt;/x&gt;&lt;y&gt;2&lt;/y&gt;&lt;/a&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve">{ "a":{
    "x": "1",
    "y": "2"
  } }</pre></div></td></tr><tr><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;polygon&gt; 
   &lt;point x='0' y='0'/&gt; 
   &lt;point x='0' y='1'/&gt; 
   &lt;point x='1' y='1'/&gt; 
   &lt;point x='1' y='0'/&gt;
&lt;/polygon&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve" class="small">{ "polygon":[
       {"@x": "0", "@y": "0"},
       {"@x": "0", "@y": "1"},
       {"@x": "1", "@y": "1"},
       {"@x": "1", "@y": "0"}
  ] ] }</pre></div></td></tr><tr><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;cities&gt;
   &lt;city id="LDN"&gt;
      &lt;name&gt;London&lt;/name&gt;
      &lt;size&gt;18.2&lt;/size&gt;
   &lt;/city&gt;
   &lt;city id="PRS"&gt;
      &lt;name&gt;Paris&lt;/name&gt;
      &lt;size&gt;19.1&lt;/size&gt;
   &lt;/city&gt;
   &lt;city id="BLN"&gt;
      &lt;name&gt;Berlin&lt;/name&gt;
      &lt;size&gt;14.6&lt;/size&gt;
   &lt;/city&gt;
&lt;/cities&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve" class="small">{ "cities":[
    {
      "@id": "LDN",
      "name": "London",
      "size": "18.2"
    },
    {
      "@id": "PRS",
      "name": "Paris",
      "size": "19.1"
    },
    {
      "@id": "BLN",
      "name": "Berlin",
      "size": "14.6"
    }
  ] }</pre></div></td></tr></tbody></table><p>The following more complex example demonstrates a case where the default conversion is inadequate (for example, it wrongly assumes that for the third production, the order of child elements is immaterial). A better result, shown below, can be achieved by using a schema-aware conversion.</p><table class="data"><thead><tr><th>XDM element</th><th>JSON serialization of result</th></tr></thead><tbody><tr><td><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;g:grammar language="xquery"
    xmlns:g="http://www.w3.org/XPath/grammar"&gt;
  &lt;g:production
    name="FunctionBody"&gt;
    &lt;g:ref name="EnclosedExpr"/&gt;
    &lt;g:ref name="Block"/&gt;
  &lt;/g:production&gt;
  &lt;g:production
    name="EnclosedExpr"&gt;
    &lt;g:ref name="Lbrace"/&gt;
    &lt;g:ref name="Expr"/&gt;
    &lt;g:optional&gt;
      &lt;g:ref name="Expr"/&gt;
    &lt;/g:optional&gt;
    &lt;g:ref name="Rbrace"/&gt;
  &lt;/g:production&gt;
  &lt;g:production
    name="SimpleReturnClause"&gt;
    &lt;g:string&gt;return&lt;/g:string&gt;
    &lt;g:ref name="ExprSingle"/&gt;
  &lt;/g:production&gt;
&lt;/g:grammar&gt;</pre></div></td><td><div class="exampleInner"><pre xml:space="preserve" class="small">[{ "Q{http://www.w3.org/XPath/grammar}grammar": [
  { "@language": "xquery" },
  { "production": [
    { "@name": "FunctionBody" },
    { "ref": { "@name": "EnclosedExpr" } },
    { "ref": { "@name": "Block" } }
  ] },
  { "production": [
    { "@name": "EnclosedExpr" },
    { "ref": { "@name": "Lbrace" } },
    { "ref": { "@name": "Expr" } },
    { "optional":[
      { "ref": { "@name": "Expr" } }
    ] },
    { "ref": { "@name": "Rbrace" } }
  ] },
  { "production": [
    { "@name": "SimpleReturnClause" },
    { "string": "return" },
    { "ref": { "@name": "ExprSingle" } }
  ] }
] }]</pre></div></td></tr></tbody></table><div class="note"><p class="prefix"><b>Note:</b></p><p>In the above example, the schema used to validate the source document was simplified to eliminate options that do not actually arise in this input instance (such as the <code>g:string</code> element having attributes). This is a legitimate technique that may be useful when trying to obtain the simplest possible JSON representation.</p><p>Further improvements to the usability of the JSON output could be achieved by doing some simple transformation of the XML prior to conversion. For example, the <code>name</code> attribute of various productions could be converted to a child element, and <code>&lt;ref name="x"/&gt;</code> could be transformed to <code>&lt;ref&gt;x&lt;/ref&gt;</code>.</p></div></div><div class="div3"><h4><a id="func-element-to-map-plan"></a>14.5.11 <a href="#func-element-to-map-plan" style="text-decoration: none">fn:element-to-map-plan</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-element-to-map">next</a> | <a href="#xml-to-json-mappings">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1797">1797</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1906">1906</a>&nbsp;29 April 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Analyzes sample data to generate a conversion plan suitable for use by the <a href="#func-element-to-map"><code>element-to-map</code></a> function.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:element-to-map-plan</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(document-node() | element())*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(xs:string, record(*))</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function takes as input a collection of document and element nodes and analyzes the trees rooted at these nodes to determine a conversion plan for converting elements in these trees to maps, suitable for serialization in JSON format. The conversion plan can be used <em>as-is</em> by supplying it directly to the <a href="#func-element-to-map"><code>element-to-map</code></a> function; alternatively it can be amended before use. The plan can also be serialized to a file (in JSON format) allowing the same plan to be used repeatedly for transforming documents with a similar structure to those in the sample provided.</p><p>The rules followed by the function, and the detailed format of the conversion plan, are described in <a href="#id-creating-a-conversion-plan"><b>14.5.2 Creating a conversion plan</b></a>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XQuery expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">let $data-type := fn($nodes as node()*) {
  if (every($nodes ! (. castable as xs:boolean))) then "boolean"
  else if (every($nodes ! (. castable as xs:numeric))) then "numeric"
  else ()
}
let $name := fn($node as node()) {
  if (namespace-uri($node)) 
  then expanded-QName(node-name($node))
  else local-name($node)
}  
return (
  for $ee in $input/descendant-or-self::*
  group by $n := $name($ee)
  return { $n :
           if (empty($ee/(*|text())))
             then { 'layout' : if (empty($ee/@*)) 
                               then 'empty' 
                               else 'empty-plus' } 
           else if (empty($ee/*)) 
             then map:merge((
                    if (empty($ee/@*)) 
                      then {'layout': 'simple'}
                      else {'layout': 'simple-plus'},
                    $data-type($ee) ! { 'type': . }
                 ))
           else if (empty($ee/text()[normalize-space()])) 
             then if (all-equal($ee/*/node-name()) and exists($ee/*[2]))
                    then { 'layout': if (empty($ee/@*)) 
                                     then 'list' 
                                     else 'list-plus',
                           'child': $name(head($ee/*))
                         }
                    else { 'layout' : if (every($ee ! all-different(*/node-name())))
                                      then 'record'
                                      else 'sequence'
                         }             
           else {'layout': 'mixed'}
        },
  for $a in $input//@*
  group by $n := $name($a)
  let $t := $data-type($a)
  return $t ! { `@{$n}`: { 'type': $t } }
) =&gt; map:merge()</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The conversion plan is organized by element and attribute name, so its effectiveness depends on the <code>$input</code> collection being homogenous in its structure, and representative of the documents that will subsequently be converted using the <a href="#func-element-to-map"><code>element-to-map</code></a> function.</p><p>This function is separate from the <a href="#func-element-to-map"><code>element-to-map</code></a> function for a number of reasons:</p><ul><li><p>The collection of documents that need to be analyzed to establish an effective conversion plan might be much smaller than the set of documents actually being converted.</p></li><li><p>Conversely, it might be that only a small number of documents need to be converted at a particular time, but the conversion plan used needs to take into account variations that might exist within a larger corpus.</p></li><li><p>If JSON output is required in a particular format, it might be necessary to fine-tune the automatically generated conversion plan to take account of these requirements.</p></li><li><p>It might be necessary to devise a conversion plan that can be used to convert individual documents as they arrive over a period of time, and to ensure that the same conversion rules are applied to each document even though documents might exhibit variations in structure.</p></li><li><p>The conversion plan is human-readable, which can help in understanding why the output of <a href="#func-element-to-map"><code>element-to-map</code></a> is in a particular form.</p></li></ul></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">element-to-map-plan(&lt;a&gt;&lt;b&gt;3&lt;/b&gt;&lt;b&gt;4&lt;/b&gt;&lt;/a&gt;)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 'a': { 'layout': 'list', 'child': 'b' },
  'b': { 'layout': 'simple', 'type': 'numeric' }
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">element-to-map-plan((&lt;a x="2"&gt;red&lt;/a&gt;, &lt;a x="3"&gt;blue&lt;/a&gt;))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ 'a': { 'layout': 'simple-plus' },
  '@x': { 'type': 'numeric' }
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">element-to-map-plan(
   &lt;a xmlns="http://example.ns"&gt;H&lt;sub&gt;2&lt;/sub&gt;SO&lt;sub&gt;4&lt;/sub&gt;&lt;/a&gt;
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 'Q{http://example.ns}a': { 'layout': 'mixed' },
  'Q{http://example.ns}sub': { 'layout': 'simple', 'type': 'numeric' }
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">element-to-map-plan((&lt;a&gt;&lt;b/&gt;&lt;b/&gt;&lt;/a&gt;, &lt;a&gt;&lt;b/&gt;&lt;c/&gt;&lt;/a&gt;))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ 'a': { 'layout': 'sequence' },
  'b': { 'layout': 'empty' },
  'c': { 'layout': 'empty' }
}</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-element-to-map"></a>14.5.12 <a href="#func-element-to-map" style="text-decoration: none">fn:element-to-map</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-build">next</a> | <a href="#func-element-to-map-plan">previous</a>)</p><ol><li><p>New in 4.0.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1797">1797</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1906">1906</a>&nbsp;29 April 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Converts an element node into a map that is suitable for JSON serialization.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:element-to-map</code>(</td></tr><tr class="arg"><td><code>$element</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>element()?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(xs:string, item()?)?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>This function returns a map derived from the element node supplied in <code>$element</code>. The map is in a form that is suitable for JSON serialization, thus providing a mechanism for conversion of arbitrary XML to JSON.</p><p>The map that is returned will always be a <a title="single-entry map" class="termref" href="#dt-single-entry-map">single-entry map</a>; the key of this entry will be a string representing the element name, and the value of the entry will be a representation of the element's attributes and children.</p><p>The entries that may appear in the <code>$options</code> map are as follows. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">plan?</code></td><td><code class="as">as&nbsp;</code><code>map(xs:string, record(layout?, child?, type?))</code>,</td></tr><tr class="arg"><td><code class="opt">attribute-marker?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">name-format?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>plan?</code></p></td><td class="fos-thin" colspan="2">A conversion plan, supplied as a map whose keys represent element and attribute names. The plan might be generated using the function <a href="#func-element-to-map-plan"><code>element-to-map-plan</code></a>, or it might be constructed in some other way. The format of the plan is described in <a href="#id-creating-a-conversion-plan"><b>14.5.2 Creating a conversion plan</b></a>. <ul><li><p><b>Type: </b><code>map(xs:string, record(layout?, child?, type?))</code></p></li><li><p><b>Default: </b><code>{}</code></p></li></ul></td></tr><tr><td><p><code>attribute-marker?</code></p></td><td class="fos-thin" colspan="2">A string that is prepended to any key value in the output that represents an XDM attribute node in the input. The string may be empty. If, after applying the requested prefix (or no prefix) there is a conflict between the names of attributes and child elements, then the requested prefix (or lack thereof) is ignored and the default prefix <code>"@"</code> is used. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>"@"</code></p></li></ul></td></tr><tr><td rowspan="5"><p><code>name-format?</code></p></td><td class="fos-thick" colspan="2">Indicates how the names of element and attribute nodes are handled. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>"default"</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>lexical</code></td><td>Names are output in the form produced by the <a href="#func-name"><code>fn:name</code></a> function.</td></tr><tr><td class="fos-thin"><code>local</code></td><td>Names are output in the form produced by the <a href="#func-local-name"><code>fn:local-name</code></a> function.</td></tr><tr><td class="fos-thin"><code>eqname</code></td><td>Names in a namespace are output in the form <code>"Q{uri}local"</code>. Names in no namespace are output using the local name alone.</td></tr><tr><td class="fos-thick"><code>default</code></td><td>An element name is output as a local name alone if either (a) it is a top-level element and is in no namespace, or (b) it is in the same namespace as its parent element. An attribute name is output as a local name alone if it is in no namespace. All other names are output in the format <code>"Q{uri}local"</code> if in a namespace, or <code>"Q{}local"</code> if in no namespace. "Top-level" here means that the element is one that appears explicitly in the sequence of elements passed in the <code>$elements</code> argument, as distinct from a descendant of such an element.</td></tr></tbody></table><p>If <code>$element</code> is the empty sequence, the result is the empty sequence.</p><p>The principles for conversion from elements to maps are described in <a href="#id-element-layouts"><b>14.5.1 Element Layouts</b></a>, and the rules for selecting an element layout for each element are given in <a href="#id-selecting-element-layout"><b>14.5.6 Selecting an element layout</b></a>.</p><p>In general, every descendant element within the tree rooted at the supplied <code>$element</code> maps to a key-value pair in which the key represents the element name, and the corresponding value represents the attributes and children of the element. This key-value pair will be added to the content representing its parent element, in a way that depends on the parent element's layout.</p><p>The representation of a node of any other kind depends on the layout chosen for its parent element.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error [<a href="#ERRFOJS0008" title="err:FOJS0008">err:FOJS0008</a>] occurs if any element cannot be processed using the selected layout for that element, unless fallback processing is defined; or if error action is explicitly requested for an element.</p><p>Any error in the conversion plan is treated as a type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> whether or not it is technically a contravention of the defined type for the value. This relieves users and implementers of the burden of distinguishing different kinds of error in the plan.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>element-to-map(())</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>element-to-map(&lt;foo&gt;bar&lt;/foo&gt;)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>{ "foo": "bar" }</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">element-to-map(
    &lt;list&gt;
      &lt;item value='1'/&gt;
      &lt;item value='2'/&gt;
    &lt;/list&gt;, { 'attribute-marker': '' }
  )</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "list": [ 
    { "value": "1" },
    { "value": "2" }
  ] }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">element-to-map(
    &lt;name&gt;
      &lt;first&gt;Jane&lt;/first&gt;
      &lt;last&gt;Smith&lt;/last&gt;
    &lt;/name&gt;
  )</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "name": { 
  "first": "Jane",
  "last": "Smith" 
} }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">element-to-map(
    &lt;name xmlns="http://example.ns/"&gt;
      &lt;first&gt;Jane&lt;/first&gt;
      &lt;middle&gt;Elizabeth&lt;/middle&gt;
      &lt;middle&gt;Mary&lt;/middle&gt;
      &lt;last&gt;Smith&lt;/last&gt;
    &lt;/name&gt;, 
    { 'plan': {'Q{http://example.ns/}name': { 'layout': 'record' }},
      'name-format' : 'local'
    }
  )</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "name": { 
    "first": "Jane",
    "middle": ["Elizabeth", "Mary"],
    "last": "Smith" 
  } 
}</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">element-to-map(
    &lt;name xmlns="http://example.ns/"&gt;
      &lt;first&gt;Jane&lt;/first&gt;
      &lt;middle&gt;Elizabeth&lt;/middle&gt;
      &lt;middle&gt;Mary&lt;/middle&gt;
      &lt;last&gt;Smith&lt;/last&gt;
    &lt;/name&gt;, 
    { 'plan': {'Q{http://example.ns/}name': { 'layout': 'record' },
               'Q{http://example.ns/}middle': { 'layout': 'deep-skip' }
              },
      'name-format' : 'local'
    }
  )</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "name": { 
    "first": "Jane",
    "last": "Smith" 
  } 
}</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="map-operations"></a>14.6 <a href="#map-operations" style="text-decoration: none">Other operations on maps </a></h3><p><em>This section is non-normative.</em></p><p>Because a map is a function item, functions that apply to functions also apply to maps. A map is an anonymous function, so <a href="#func-function-name"><code>fn:function-name</code></a> returns the empty sequence; <a href="#func-function-arity"><code>fn:function-arity</code></a> always returns <code>1</code>.</p><p>Maps may be compared using the <a href="#func-deep-equal"><code>fn:deep-equal</code></a> function.</p><p>There is no function or operator to atomize a map or convert it to a string (other than <a href="#func-serialize"><code>fn:serialize</code></a>, which can be used to serialize some maps as JSON texts).</p><p>XPath 4.0 defines a number of syntactic constructs that operate on maps. These all have equivalents in the function library:</p><ul><li><p>The expression <code>{}</code> creates the empty map (see <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-map-constructors">4.14.1.1 Map Constructors</a>). This is equivalent to the effect of the data model primitive <code>dm:empty-map()</code>. Using user-visible functions the same can be achieved by calling <a href="#func-map-build"><code>map:build</code></a> or <a href="#func-map-merge"><code>map:merge</code></a>, supplying the empty sequence as the argument.</p></li><li><p>The map constructor <code>{ <var>K<sub>1</sub></var> : <var>V<sub>1</sub></var>, <var>K<sub>2</sub></var> : <var>V<sub>2</sub></var>, ... , <var>K<sub>n</sub></var> : <var>V<sub>n</sub></var> }</code> is equivalent to <code>map:merge((map:entry(<var>K<sub>1</sub></var>, <var>V<sub>1</sub></var>), map:entry(<var>K<sub>1</sub></var>, <var>V<sub>1</sub></var>), ..., map:entry(<var>K<sub>n</sub></var>, <var>V<sub>n</sub></var>)), { "duplicates": "reject" })</code></p></li><li><p>The lookup expression <code>$map?*</code> (see <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-lookup">4.14.3 Lookup Expressions</a>) is equivalent to <code>map:items($map)</code>.</p></li><li><p>The lookup expression <code>$map?K</code>, where <var>K</var> is a key value, is equivalent to <code>map:get($map, <var>K</var>)</code></p></li><li><p>The expression <code>for key $k value $v in $map return <var>EXPR</var></code> (see <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> section <a href="../xquery-40/xquery-40.html#id-xquery-for-clause">4.13.2 For Clause</a> and <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-for-expressions">4.13.1 For Expressions</a>) is equivalent to the function call <code>map:for-each($map, fn($k, $v) { <var>EXPR</var> })</code>.</p></li><li><p>Maps can be filtered using the construct <code>$map?[<var>predicate</var>]</code> (see <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-filter-maps-and-arrays">4.14.5 Filter Expressions for Maps and Arrays</a>).</p></li></ul></div></div><div class="div1"><h2><a id="arrays"></a>15 <a href="#arrays" style="text-decoration: none">Processing arrays</a></h2><p>Arrays were introduced as a new datatype in XDM 3.1. This section describes functions that operate on arrays.</p><p>An array is an additional kind of item. An array of size <var>N</var> is a mapping from the integers (1 to <var>N</var>) to a set of values, called the members of the array, each of which is an arbitrary sequence. Because an array is an item, and therefore a sequence, arrays can be nested.</p><p>An array acts as a function from integer positions to associated values, so the function call <code>$array($index)</code> can be used to retrieve the array member at a given position. The function corresponding to the array has the signature <code>function($index as xs:integer) as item()*</code>. The fact that an array is a function item allows it to be passed as an argument to higher-order functions that expect a function item as one of their arguments.</p><div class="div2"><h3><a id="formal-specification-of-arrays"></a>15.1 <a href="#formal-specification-of-arrays" style="text-decoration: none">Formal Specification of Arrays</a></h3><p>The XDM data model (<a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>) defines three primitive operations on arrays:</p><ul><li><p><code>dm:empty-array</code> constructs the empty array.</p></li><li><p><code>dm:array-append</code> adds a member to an array.</p></li><li><p><code>dm:iterate-array</code> applies a supplied function to every member of an array, in order.</p></li></ul><p>The functions in this section are all specified by means of equivalent expressions that either call these primitives directly, or invoke other functions that rely on these primitives. The specifications avoid relying on XPath language constructs that manipulate arrays, such as array constructor syntax, lookup expressions, or FLWOR expressions. This is done to allow these language constructs to be specified by reference to this function library, without risk of circularity.</p><p>There is one exception to this rule: for convenience, the notation <code>[]</code> is used to represent the empty array, in preference to a call on <code>dm:empty-array()</code>.</p><p>The formal equivalents are not intended to provide a realistic way of implementating the functions. They do, however, provide a framework that allows the correctness of a practical implementation to be verified.</p></div><div class="div2"><h3><a id="array-functions"></a>15.2 <a href="#array-functions" style="text-decoration: none">Functions that operate on arrays</a></h3><p>The functions defined in this section use a conventional namespace prefix <code>array</code>, which is assumed to be bound to the namespace URI <code>http://www.w3.org/2005/xpath-functions/array</code>.</p><p>As with all other values, arrays are treated as immutable. For example, the <a href="#func-array-reverse"><code>array:reverse</code></a> function returns an array that differs from the supplied array in the order of its members, but the supplied array is not changed by the operation. Two calls on <a href="#func-array-reverse"><code>array:reverse</code></a> with the same argument will return arrays that are indistinguishable from each other; there is no way of asking whether these are “the same array”. Like sequences, arrays have no identity. </p><p>All functionality on arrays is defined in terms of two primitives:</p><ul><li><p>The function <a href="#func-array-members"><code>array:members</code></a> decomposes an array to a sequence of <b>value records</b>.</p></li><li><p>The function <a href="#func-array-of-members"><code>array:of-members</code></a> composes an array from a sequence of <b>value records</b>.</p></li></ul><p>A <b>value record</b> here is an item that encapsulates an arbitrary value; the representation chosen for a value record is <code>record(value as item()*)</code>, that is, a map containing a single entry whose key is the string <code>"value"</code> and whose value is the encapsulated sequence.</p><p>Note that when the required type of an argument to a function such as <a href="#func-array-build"><code>array:build</code></a> is an array type, then the coercion rules ensure that a JNode can be supplied in the function call: if the <b>·content·</b> property of the JNode is an array, then the array is automatically extracted as if by the <a href="#func-jnode-content"><code>jnode-content</code></a> function.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-append"><code>array:append</code></a></td><td>Returns an array containing all the members of a supplied array, plus one additional member at the end.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-build"><code>array:build</code></a></td><td>Returns an array obtained by evaluating the supplied function once for each item in the input sequence.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-empty"><code>array:empty</code></a></td><td>Returns <code>true</code> if the supplied array contains no members.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-filter"><code>array:filter</code></a></td><td>Returns an array containing those members of the <code>$array</code> for which <code>$predicate</code> returns <code>true</code>. A return value of <code>()</code> is treated as <code>false</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-flatten"><code>array:flatten</code></a></td><td>Replaces any array appearing in a supplied sequence with the members of the array, recursively.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-fold-left"><code>array:fold-left</code></a></td><td>Evaluates the supplied function cumulatively on successive members of the supplied array.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-fold-right"><code>array:fold-right</code></a></td><td>Evaluates the supplied function cumulatively on successive values of the supplied array.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-foot"><code>array:foot</code></a></td><td>Returns the last member of an array.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-for-each"><code>array:for-each</code></a></td><td>Returns an array whose size is the same as <code>array:size($array)</code>, in which each member is computed by applying <code>$action</code> to the corresponding member of <code>$array</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-for-each-pair"><code>array:for-each-pair</code></a></td><td>Returns an array obtained by evaluating the supplied function once for each pair of members at the same position in the two supplied arrays.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-get"><code>array:get</code></a></td><td>Returns the value at the specified position in the supplied array (counting from 1).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-head"><code>array:head</code></a></td><td>Returns the first member of an array, that is <code>$array(1)</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-index-of"><code>array:index-of</code></a></td><td>Returns a sequence of positive integers giving the positions within the array <code>$array</code> of members that are equal to <code>$target</code>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-index-where"><code>array:index-where</code></a></td><td>Returns the positions in an input array of members that match a supplied predicate.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-insert-before"><code>array:insert-before</code></a></td><td>Returns an array containing all the members of the supplied array, with one additional member at a specified position.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-items"><code>array:items</code></a></td><td>Returns the sequence concatenation of the members of an array.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-join"><code>array:join</code></a></td><td>Concatenates the contents of several arrays into a single array.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-members"><code>array:members</code></a></td><td>Delivers the contents of an array as a sequence of <b>value records</b>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-of-members"><code>array:of-members</code></a></td><td>Constructs an array from the contents of a sequence of <b>value records</b>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-put"><code>array:put</code></a></td><td>Returns an array containing all the members of a supplied array, except for one member which is replaced with a new value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-remove"><code>array:remove</code></a></td><td>Returns an array containing all the members of the supplied array, except for the members at specified positions.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-reverse"><code>array:reverse</code></a></td><td>Returns an array containing all the members of a supplied array, but in reverse order.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-size"><code>array:size</code></a></td><td>Returns the number of members in the supplied array.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-slice"><code>array:slice</code></a></td><td>Returns an array containing selected members of a supplied input array based on their position.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-sort"><code>array:sort</code></a></td><td>Sorts a supplied array, based on the value of a sort key supplied as a function.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-sort-by"><code>array:sort-by</code></a></td><td>Sorts a supplied array, based on the value of a number of sort keys supplied as functions.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-sort-with"><code>array:sort-with</code></a></td><td>Sorts a supplied array, according to the order induced by the supplied comparator functions.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-split"><code>array:split</code></a></td><td>Delivers the contents of an array as a sequence of single-member arrays.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-subarray"><code>array:subarray</code></a></td><td>Returns an array containing all members from a supplied array starting at a supplied position, up to a specified length.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-tail"><code>array:tail</code></a></td><td>Returns an array containing all members except the first from a supplied array.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-array-trunk"><code>array:trunk</code></a></td><td>Returns an array containing all members except the last from a supplied array.</td></tr></tbody></table><div class="div3"><h4><a id="func-array-append"></a>15.2.1 <a href="#func-array-append" style="text-decoration: none">array:append</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an array containing all the members of a supplied array, plus one additional member at the end.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:append</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$member</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the result is an array whose size is <code>array:size($array) + 1</code>, in which all members in positions 1 to <code>array:size($array)</code> are the same as the members in the corresponding position of <code>$array</code>, and the member in position <code>array:size($array) + 1</code> is <code>$member</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function is defined as follows, making use of primitive constructors and accessors defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p><div class="exampleInner"><pre xml:space="preserve">dm:array-append($array, $member)</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:append([ "a", "b", "c" ], "d")</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", "c", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:append([ "a", "b", "c" ], ("d", "e"))</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", "c", ("d", "e") ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:append([ "a", "b", "c" ], [ "d", "e" ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", "c", [ "d", "e" ] ]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-build"></a>15.2.2 <a href="#func-array-build" style="text-decoration: none">array:build</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-empty">next</a> | <a href="#func-element-to-map">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/97">97</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/250">250</a>&nbsp;7 December 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an array obtained by evaluating the supplied function once for each item in the input sequence.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:build</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item(), xs:integer) as item()*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:identity#1</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the function is called with one argument, the effect is the same as calling the two-argument function with <a href="#func-identity"><code>fn:identity#1</code></a> as the second argument.</p><p>Informally, <code>array:build#2</code> applies the supplied function to each item in the input sequence, and the resulting sequence becomes one member of the returned array.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">array:of-members(
  for-each($input, 
    fn($item, $pos) { { 'value': $action($item, $pos) } }
  )
)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The single-argument function <code>array:build($input)</code> is equivalent to the XPath expression <code>array { $input }</code>, but it is useful to have this available as a function.</p><p>The two-argument form facilitates the construction of arrays whose members are arbitrary sequences.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:build(1 to 5)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[ 1, 2, 3, 4, 5 ]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:build(1 to 5, fn { 2 * . })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 2, 4, 6, 8, 10 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:build(1 to 5, fn { 1 to . })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1, (1, 2), (1, 2, 3), (1, 2, 3, 4), (1, 2, 3, 4, 5) ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:build(("red", "green", "blue"), characters#1)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ ("r", "e", "d"), ("g", "r", "e", "e", "n"), ("b", "l", "u", "e") ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:build(1 to 5, fn { array { 1 to . } })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ [ 1 ], [ 1, 2 ], [ 1, 2, 3 ], [ 1, 2, 3, 4 ], [ 1, 2, 3, 4, 5 ] ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">array:build(
  (0x41 to 0x48) ! char(.),
  fn($char, $pos) {
    if ($pos mod 2 = 0) then lower-case($char) else $char
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "A", "b", "C", "d", "E", "f", "G", "h" ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-empty"></a>15.2.3 <a href="#func-array-empty" style="text-decoration: none">array:empty</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-filter">next</a> | <a href="#func-array-build">previous</a>)</p><ol><li><p>New in 4.0</p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns <code>true</code> if the supplied array contains no members.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:empty</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns <code>true</code> if and only if <code>$array</code> contains no members.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">array:size($array) eq 0</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The test for emptiness is not the same as the test used by the <code>xsl:on-empty</code> instruction in XSLT. For example, an array is not considered empty by this function if it contains a single member that is itself the empty array.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:empty([ "a", "b", "c" ])</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:empty([])</code></pre></div></td><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:empty([ [] ])</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:empty([ () ])</code></pre></div></td><td style="vertical-align:top"><p><code>false()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-filter"></a>15.2.4 <a href="#func-array-filter" style="text-decoration: none">array:filter</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-foot">next</a> | <a href="#func-array-empty">previous</a>)</p><ol><li><p>The <code>$predicate</code> callback function now accepts an optional position argument.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/516">516</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/828">828</a>&nbsp;14 November 2023]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an array containing those members of the <code>$array</code> for which <code>$predicate</code> returns <code>true</code>. A return value of <code>()</code> is treated as <code>false</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:filter</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, xs:integer) as xs:boolean?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function returns an array containing those members of the input array that satisfy the supplied predicate.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XQuery expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">array:of-members(
  filter(
    array:members($array),
    fn($item, $pos) { $predicate(map:get($item, 'value'), $pos) }
  )
)</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>As a consequence of the function signature and the function calling rules, a type error occurs if the supplied function <code>$function</code> returns anything other than a single <code>xs:boolean</code> item or the empty sequence; there is no conversion to an effective boolean value.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:filter(
  [ "A", "B", 1, 2 ],
  fn($x) { $x instance of xs:integer }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1, 2 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:filter(
  [ "the cat", "sat", "on the mat" ],
  function { count(tokenize(.)) &gt; 1 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "the cat", "on the mat" ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:filter([ "A", "B", "", 0, 1 ], boolean#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[ "A", "B", 1] </code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $array := [ 1, 1, 2, 3, 4, 4, 5 ]
return array:filter(
  $array,
  fn($item, $pos) { $pos &gt; 1 and $item = $array($pos - 1) }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1, 4 ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-flatten"></a>15.2.5 <a href="#func-array-flatten" style="text-decoration: none">array:flatten</a></h4><dl><dt class="label">Summary</dt><dd><p>Replaces any array appearing in a supplied sequence with the members of the array, recursively.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:flatten</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function processes the items in the supplied sequence <code>$input</code> as follows:</p><ul><li><p>An item that is an array is replaced by its members, retaining order.</p></li><li><p>Any other item is retained unchanged.</p></li></ul><p>The process is then repeated so long as the sequence contains an array among its items.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function delivers the same result as the following XQuery implementation.</p><div class="exampleInner"><pre xml:space="preserve" class="small">declare function array:flatten(
  $input as item()*
) as item()* {
  for $item in $input
  return (
    if ($item instance of array(*)) 
    then array:flatten(array:items($item)) 
    else $item
  )
};</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The argument to the function will often be a single array item, but this is not essential.</p><p>Unlike atomization, this function retains any nodes contained in the array.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:flatten([ 1, 4, 6, 5, 3 ])</code></pre></div></td><td style="vertical-align:top"><p><code>1, 4, 6, 5, 3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:flatten(([ 1, 2 ], [ [ 10, 11 ], 12 ], [], 13))</code></pre></div></td><td style="vertical-align:top"><p><code>1, 2, 10, 11, 12, 13</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:flatten([ (1, 0), (1, 1), (0, 1), (0, 0) ])</code></pre></div></td><td style="vertical-align:top"><p><code>1, 0, 1, 1, 0, 1, 0, 0</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-fold-left"></a>15.2.6 <a href="#func-array-fold-left" style="text-decoration: none">array:fold-left</a></h4><dl><dt class="label">Summary</dt><dd><p>Evaluates the supplied function cumulatively on successive members of the supplied array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:fold-left</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$init</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, item()*) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function is defined formally below, in terms of the equivalent <a href="#func-fold-left"><code>fn:fold-left</code></a> function for sequences.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">fold-left(
  array:members($array),
  $init,
  fn($result, $member) { $action($result, map:get($member, 'value')) }
)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the supplied array is empty, the function returns <code>$init</code>.</p><p>If the supplied array contains a single member <code>$m</code>, the function returns <code>$init =&gt; $action($m)</code>.</p><p>If the supplied array contains two members <code>$m</code> and <code>$n</code>, the function returns <code>$init =&gt; $action($m) =&gt; $action($n)</code>; and similarly for an input array with more than two members.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:fold-left(
  [ true(), true(), false() ],
  true(),
  fn($x, $y) { $x and $y }
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div><p><em>(Returns <code>true</code> if every member of the input array has an effective boolean value of <code>true</code>.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:fold-left(
  [ true(), true(), false() ],
  false(), 
  fn($x, $y) { $x or $y }
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(Returns <code>true</code> if at least one member of the input array has an effective boolean value of <code>true</code>.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:fold-left(
  [ 1, 2, 3 ],
  [],
  fn($x, $y) { [ $x, $y ] }
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ [ [ [], 1 ], 2 ], 3 ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-fold-right"></a>15.2.7 <a href="#func-array-fold-right" style="text-decoration: none">array:fold-right</a></h4><dl><dt class="label">Summary</dt><dd><p>Evaluates the supplied function cumulatively on successive values of the supplied array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:fold-right</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$init</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, item()*) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function is defined formally below, in terms of the equivalent <a href="#func-fold-right"><code>fn:fold-right</code></a> function for sequences.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">fold-right(
  array:members($array),
  $init,
  fn($member, $result) { $action(map:get($member, 'value'), $result) }
)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the supplied array is empty, the function returns <code>$init</code>.</p><p>If the supplied array contains a single member <code>$m</code>, the function returns <code>$action($m, $init)</code>.</p><p>If the supplied array contains two members <code>$m</code> and <code>$n</code>, the function returns <code>$action($m, $action($n, $init))</code>; and similarly for an input array with more than two members.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:fold-right(
  [ true(), true(), false() ],
  true(),
  fn($x, $y) { $x and $y }
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div><p><em>(Returns <code>true</code> if every member of the input array has an effective boolean value of <code>true</code>.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:fold-right(
  [ true(), true(), false() ],
  false(),
  fn($x, $y) { $x or $y }
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(Returns <code>true</code> if at least one member of the input array has an effective boolean value of <code>true</code>.)</em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:fold-right(
  [ 1, 2, 3 ],
  [],
  fn($x, $y) { [ $x, $y ] }
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1, [ 2, [ 3, [] ] ] ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-foot"></a>15.2.8 <a href="#func-array-foot" style="text-decoration: none">array:foot</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-for-each">next</a> | <a href="#func-array-filter">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/97">97</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/250">250</a>&nbsp;7 December 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the last member of an array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:foot</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the last member of <code>$array</code>. </p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">array:get($array, array:size($array))</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error occurs [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if <code>$array</code> is empty.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:foot([ 5, 6, 7, 8 ])</code></pre></div></td><td style="vertical-align:top"><p><code>8</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:foot([ [ "a", "b" ], [ "c", "d" ] ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ "c", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:foot([ ("a", "b"), ("c", "d") ])</code></pre></div></td><td style="vertical-align:top"><p><code>"c", "d"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-for-each"></a>15.2.9 <a href="#func-array-for-each" style="text-decoration: none">array:for-each</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-for-each-pair">next</a> | <a href="#func-array-foot">previous</a>)</p><ol><li><p>The <code>$action</code> callback function now accepts an optional position argument.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/516">516</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/828">828</a>&nbsp;14 November 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an array whose size is the same as <code>array:size($array)</code>, in which each member is computed by applying <code>$action</code> to the corresponding member of <code>$array</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:for-each</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, xs:integer) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function returns an array whose members are obtained by applying the supplied <code>$action</code> function to each member of the input array in turn.</p><p>The <code>$action</code> function is called with two arguments: the first is the array member (which in general is an arbitrary sequence), and the second is the 1-based integer position.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">array:of-members(
  for-each(array:members($array), 
           fn($member, $pos) {
              { 'value': $action(map:get($member, 'value'), $pos) }
           })
)</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:for-each(
  [ "A", "B", 1, 2 ],
  fn($z) { $z instance of xs:integer }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[false(), false(), true(), true()]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:for-each(
  [ "the cat", "sat", "on the mat" ],
  tokenize#1
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ ("the", "cat"), "sat", ("on", "the", "mat") ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:for-each(
  [ [ "the", "cat" ], [ "sat" ], [ "on", "the", "mat" ] ],
  array:flatten#1
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ ("the", "cat"), "sat", ("on", "the", "mat") ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:for-each(
  [ 'one', 'two', 'three' ],
  fn($member, $pos) { $pos || '. ' || $member }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "1. one", "2. two", "3. three" ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-for-each-pair"></a>15.2.10 <a href="#func-array-for-each-pair" style="text-decoration: none">array:for-each-pair</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-get">next</a> | <a href="#func-array-for-each">previous</a>)</p><ol><li><p>The <code>$action</code> callback function now accepts an optional position argument.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/516">516</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/828">828</a>&nbsp;14 November 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an array obtained by evaluating the supplied function once for each pair of members at the same position in the two supplied arrays.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:for-each-pair</code>(</td></tr><tr class="arg"><td><code>$array1</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$array2</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$action</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, item()*, xs:integer) as item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function applies <code>$action</code> to each pair of values in corresponding positions within <code>$array1</code> and <code>$array2</code>, ignoring any excess values if one array is longer than the other. The results are then assembed into a new array whose size is equal to the shorter of the two input arrays.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">array:of-members(
  for-each-pair(
    array:members($array1),
    array:members($array2),
    fn($v1, $v2, $pos) {
      { 'value': $action(map:get($v1, 'value'), map:get($v2, 'value'), $pos) }
    }
  )
)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the arrays have different size, excess members in the longer array are ignored.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:for-each-pair(
  [ "A", "B", "C" ],
  [ 1, 2, 3 ],
  fn($x, $y) { array { $x, $y }}
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ [ "A", 1 ], [ "B", 2 ], [ "C", 3 ] ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $array := [ "A", "B", "C", "D" ]
return array:for-each-pair(
  $array,
  array:tail($array),
  concat#2
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "AB", "BC", "CD" ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">array:for-each-pair(
  [ 1, 8, 2 ],
  [ 3, 4, 3 ],
  fn($member1, $member2, $pos) {
    $pos || ': ' || max(($member1, $member2))
  }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "1: 3", "2: 8", "3: 3" ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-get"></a>15.2.11 <a href="#func-array-get" style="text-decoration: none">array:get</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-index-of">next</a> | <a href="#func-array-for-each-pair">previous</a>)</p><ol><li><p>A third argument is added, allowing user control of how index-out-of-bounds conditions should be handled.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1363">1363</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/289">289</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1901">1901</a>]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the value at the specified position in the supplied array (counting from 1).</p></dd><dt class="label">Signatures</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:get</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$position</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:get</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$position</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer</code></code>,</td><td></td></tr><tr class="arg"><td><code>$default</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function returns the member at a specified position in the array.</p><p>If <code>$position</code> is out of bounds (that is, if it is less than one or greater than <code>array:size($array)</code>), then the effect depends on the number of arguments:</p><ul><li><p>When there are two arguments, an error is raised ([<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>]).</p></li><li><p>When there are three arguments, the value of <code>$default</code> is returned.</p></li></ul><table class="ednote" caption="Editorial note"><tbody><tr><td style="text-align: left; vertical-align:top; width: 50%;"><b>Editorial note</b></td><td style="text-align: right; vertical-align:top; width: 50%;">&nbsp;</td></tr><tr style="text-align: left; vertical-align: top;"><td colspan="2">Provide separate "formal equivalents" for the two variants.</td></tr></tbody></table></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression, except in error cases.</p><div class="exampleInner"><pre xml:space="preserve" class="small">(: For the two-argument form: :)           
    if ($position = (1 to array:size($array)))
    then items-at(array:members($array), $position) =&gt; map:get('value'))
    else error(),
(: For the three-argument form: :)           
    if ($position = (1 to array:size($array)))
    then items-at(array:members($array), $position) =&gt; map:get('value'))
    else $default</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>In the absence of a <code>$default</code> argument, a dynamic error occurs [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if <code>$position</code> is not in the range <code>1 to array:size($array)</code> inclusive.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>[ "a", "b", "c" ] =&gt; array:get(2)</code></pre></div></td><td style="vertical-align:top"><p><code>"b"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>[ "a", [ "b", "c" ] ] =&gt; array:get(2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "c" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>[ "a" ] =&gt; array:get(1, ())</code></pre></div></td><td style="vertical-align:top"><p><code>"a"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>[ "a" ] =&gt; array:get(2, ())</code></pre></div></td><td style="vertical-align:top"><p><code>()</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-head"></a>15.2.12 <a href="#func-array-head" style="text-decoration: none">array:head</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the first member of an array, that is <code>$array(1)</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:head</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns first member of <code>$array</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">array:get($array, 1)</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error occurs [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if <code>$array</code> is empty.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:head([ 5, 6, 7, 8 ])</code></pre></div></td><td style="vertical-align:top"><p><code>5</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:head([ [ "a", "b" ], [ "c", "d" ] ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:head([ ("a", "b"), ("c", "d") ])</code></pre></div></td><td style="vertical-align:top"><p><code>"a", "b"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-index-of"></a>15.2.13 <a href="#func-array-index-of" style="text-decoration: none">array:index-of</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-index-where">next</a> | <a href="#func-array-get">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/260">260</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1096">1096</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/968">968</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1295">1295</a>&nbsp;6 February 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a sequence of positive integers giving the positions within the array <code>$array</code> of members that are equal to <code>$target</code>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:index-of</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$target</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>The two-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and implicit timezone. </p><p>The three-argument form of this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations, and static base URI, and implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>Informally, all members of <code>$array</code> are compared with <code>$target</code>. An array member is compared to the target value using the rules of the <a href="#func-deep-equal"><code>fn:deep-equal</code></a> function, with the specified (or defaulted) collation. The index position of the member is included in the result sequence if the comparison returns true. </p><p>The collation used by this function is determined according to the rules in <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>. This collation is used when string comparison is required.</p><p>The first member in an array is at position 1, not position 0.</p><p>The result sequence is in ascending numeric order.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">array:index-where($array, deep-equal(?, $target, $collation))</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>If <code>$array</code> is the empty array, or if no member in <code>$array</code> matches <code>$target</code>, then the function returns the empty sequence.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:index-of([ 10, 20, 30, 30, 20, 10 ], 20)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>2, 5</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:index-of([ (), 1, (5, 6), (6, 7) ], (6, 7))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>4</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">array:index-of(
  [ "a", ("b", "C"), "d" ],
  ("B", "c"),
  "http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:index-of(
  [ '1', xs:untypedAtomic('1'), 1, current-date() ],
  '1'
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, 2</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-index-where"></a>15.2.14 <a href="#func-array-index-where" style="text-decoration: none">array:index-where</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-items">next</a> | <a href="#func-array-index-of">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/114">114</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/258">258</a>&nbsp;13 December 2022]</i></p></li><li><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1171">1171</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182</a>&nbsp;7 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the positions in an input array of members that match a supplied predicate.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:index-where</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$predicate</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*, xs:integer) as xs:boolean?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The result of the function is a sequence of integers, in monotonic ascending order, representing the 1-based positions in the input array of those members for which the supplied predicate function returns <code>true</code>. A return value of <code>()</code> is treated as <code>false</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">dm:iterate-array($array, fn($member, $pos) {
  if ($predicate($member, $pos)) { $pos }
})</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:index-where([], boolean#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:index-where([ 0, (), 4, 9 ], boolean#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>3, 4</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:index-where(
  array { 1 to 10 },
  function { . mod 2 = 0 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2, 4, 6, 8, 10</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">array:index-where(
  [ "January", "February", "March", "April",
    "May", "June", "July", "August", "September",
    "October", "November", "December" ],
  contains(?, "r")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, 2, 3, 4, 9, 10, 11, 12</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:index-where(
  [ (1, 2, 3), (4, 5, 6), (7, 8) ],
  fn($m) { count($m) = 3 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, 2</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:index-where(
  [ 1, 8, 2, 7, 3 ],
  fn($member, $pos) { $member &lt; 5 and $pos &gt; 2 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">3, 5</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-insert-before"></a>15.2.15 <a href="#func-array-insert-before" style="text-decoration: none">array:insert-before</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an array containing all the members of the supplied array, with one additional member at a specified position.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:insert-before</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$position</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer</code></code>,</td><td></td></tr><tr class="arg"><td><code>$member</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function returns an array of size <code>array:size($array) + 1</code> containing all members from <code>$array</code> whose position is less than <code>$position</code>, then a new member given by <code>$member</code>, and then all members from <code>$array</code> whose position is greater than or equal to <code>$position</code>. Positions are counted from 1.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression, except in error cases.</p><div class="exampleInner"><pre xml:space="preserve">$array 
=&gt; array:members() 
=&gt; insert-before($position, { 'value': $member })
=&gt; array:of-members()</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error occurs [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if <code>$position</code> is not in the range <code>1 to array:size($array) + 1</code> inclusive.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Setting <code>$position</code> to 1 has the effect of prepending the new member at the start of the array. Setting <code>$position</code> to the value <code>array:size($array) + 1</code> delivers the same result as <code>array:append($array, $member)</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:insert-before(
  [ "a", "b", "c", "d" ],
  3,
  ("x", "y")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "a", "b", ("x", "y"), "c", "d" ]</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:insert-before(
  [ "a", "b", "c", "d" ],
  5,
  ("x", "y")
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "a", "b", "c", "d", ("x", "y") ]</pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:insert-before(
  [ "a", "b", "c", "d" ],
  3,
  [ "x", "y" ]
)</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "a", "b", [ "x", "y" ], "c", "d" ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-items"></a>15.2.16 <a href="#func-array-items" style="text-decoration: none">array:items</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-members">next</a> | <a href="#func-array-index-where">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/29">29</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1086">1086</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/476">476</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1087">1087</a>&nbsp;5 September 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the sequence concatenation of the members of an array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:items</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-concatenation">sequence concatenation</a><sup><small>XP</small></sup> of the members of <code>$array</code>, retaining order.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">dm:iterate-array($array, fn($member, $pos) { $member })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>Unlike <a href="#func-array-flatten"><code>array:flatten</code></a>, the function does not apply recursively to nested arrays.</p><p>If <code>$A</code> is a single array item, then <code>array:items($A)</code> returns the same result as <code>$A?*</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:items(["one", "two", "three"])</code></pre></div></td><td style="vertical-align:top"><p><code>"one", "two", "three"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:items(["one", ("two", "three")])</code></pre></div></td><td style="vertical-align:top"><p><code>"one", "two", "three"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:items(["one", ("two", "three"), ()])</code></pre></div></td><td style="vertical-align:top"><p><code>"one", "two", "three"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:items(["one", ["two", "three"]])</code></pre></div></td><td style="vertical-align:top"><p><code>"one", ["two", "three"]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:items([ (), 1, (2 to 4), [ 5 ] ])</code></pre></div></td><td style="vertical-align:top"><p><code>1, 2, 3, 4, [ 5 ]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-join"></a>15.2.17 <a href="#func-array-join" style="text-decoration: none">array:join</a></h4><dl><dt class="label">Summary</dt><dd><p>Concatenates the contents of several arrays into a single array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:join</code>(</td></tr><tr class="arg"><td><code>$arrays</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function concatenates the members of several arrays into a single array.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">$arrays
=&gt; for-each(fn($array) { array:members($array) })
=&gt; array:of-members()</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:join(())</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:join([ 1, 2, 3 ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ 1, 2, 3 ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:join(([ "a", "b" ], [ "c" ]))</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", "c" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:join(([ "a", "b" ], [ "c" ], []))</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", "c" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:join(([ "a", "b" ], [ [ "c" ] ]))</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", [ "c" ] ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array { 1 to 3 }
=&gt; array:split()
=&gt; array:join()</pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1, 2, 3 ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-members"></a>15.2.18 <a href="#func-array-members" style="text-decoration: none">array:members</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-of-members">next</a> | <a href="#func-array-items">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/29">29</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/113">113</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/314">314</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/360">360</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/476">476</a>]</i></p></li><li><p>The group may remove this function, it is considered <a href="#at-risk">at risk</a>. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2351">2351</a>&nbsp;]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Delivers the contents of an array as a sequence of <b>value records</b>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:members</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>record(value as item()*)*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The members of the array are delivered as a sequence of <b>value records</b>. A value record is an item that encapsulates an arbitrary sequence <code>$S</code>: specifically it is a map comprising a single entry whose key is the <code>xs:string</code> value <code>"value"</code> and whose corresponding value is <code>$S</code>. The content encapsulated by a value record <code>$V</code> can be obtained using the expression <code>$V?value</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The function is defined as follows, making use of primitive constructors and accessors defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p><div class="exampleInner"><pre xml:space="preserve">dm:iterate-array($array, array:member#1)</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function is the inverse of <a href="#func-array-of-members"><code>array:of-members</code></a>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:members([])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:members([ 1 to 5 ])?value</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, 2, 3, 4, 5</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:members([ (1, 1), (2, 4), (3, 9), (4, 16), (5, 25) ])
! sum(?value)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2, 6, 12, 20, 30</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $array := [ "any array" ]
return deep-equal(
  $array,
  array:of-members(array:members($array))
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-of-members"></a>15.2.19 <a href="#func-array-of-members" style="text-decoration: none">array:of-members</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-slice">next</a> | <a href="#func-array-members">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/29">29</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/113">113</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/314">314</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/360">360</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/476">476</a>&nbsp;21 March 2023]</i></p></li><li><p>The group may remove this function, it is considered <a href="#at-risk">at risk</a>. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2351">2351</a>&nbsp;]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Constructs an array from the contents of a sequence of <b>value records</b>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:of-members</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>record(value as item()*)*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The input items must be <b>value records</b>, as defined in the type signature. A value record is an item that encapsulates an arbitrary sequence <code>$S</code>: specifically it is a map comprising a single entry whose key is the <code>xs:string</code> value <code>"value"</code> and whose corresponding value is <code>$S</code>. The content encapsulated by a value record <code>$V</code> can be obtained using the expression <code>$V?value</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XQuery expression.</p><div class="exampleInner"><pre xml:space="preserve">fold-left($input, [], fn($array, $record) { 
  array:append($array, map:get($record, 'value'))
})</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function is the inverse of <a href="#func-array-members"><code>array:members</code></a>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:of-members(())</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:of-members({ 'value': (1 to 5) })</code></pre></div></td><td style="vertical-align:top"><p><code>[ (1, 2, 3, 4, 5) ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:of-members((1 to 5) ! { 'value': . })</code></pre></div></td><td style="vertical-align:top"><p><code>[ 1, 2, 3, 4, 5 ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:of-members((1 to 3) ! { 'value': (., . * .) })</code></pre></div></td><td style="vertical-align:top"><p><code>[ (1, 1), (2, 4), (3, 9) ]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-put"></a>15.2.20 <a href="#func-array-put" style="text-decoration: none">array:put</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an array containing all the members of a supplied array, except for one member which is replaced with a new value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:put</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$position</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer</code></code>,</td><td></td></tr><tr class="arg"><td><code>$member</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the result is an array whose size is <code>array:size($array)</code>, in which all members in positions other than <code>$position</code> are the same as the members in the corresponding position of <code>$array</code>, and the member in position <code>$position</code> is <code>$member</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">$array 
=&gt; array:remove($position) 
=&gt; array:insert-before($position, $member)</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error occurs [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if <code>$position</code> is not in the range <code>1 to array:size($array)</code> inclusive.</p><p>This error will always occur if <code>$array</code> is empty.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:put([ "a", "b", "c" ], 2, "d")</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "d", "c" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:put([ "a", "b", "c" ], 2, ("d", "e"))</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", ("d", "e"), "c" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:put([ "a" ], 1, [ "d", "e" ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ [ "d", "e" ] ]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-remove"></a>15.2.21 <a href="#func-array-remove" style="text-decoration: none">array:remove</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an array containing all the members of the supplied array, except for the members at specified positions.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:remove</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$positions</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the function returns an array of size <span><code>array:size($array) - fn:count(fn:distinct-values($positions))</code></span> containing all members from <code>$array</code> except the members whose position (counting from 1) is present in the sequence <code>$positions</code>. The order of the remaining members is preserved.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression, except in error cases.</p><div class="exampleInner"><pre xml:space="preserve">$array 
=&gt; array:members() 
=&gt; remove($positions) 
=&gt; array:of-members()</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if any integer in <code>$positions</code> is not in the range <code>1 to array:size($array)</code> inclusive. By implication, an error occurs if <code>$array</code> is empty, unless <code>$positions</code> is also empty.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:remove([ "a", "b", "c", "d" ], 1)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "c", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:remove([ "a", "b", "c", "d" ], 2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "c", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:remove([ "a" ], 1)</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:remove([ "a", "b", "c", "d" ], 1 to 3)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:remove([ "a", "b", "c", "d" ], ())</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", "c", "d" ]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-reverse"></a>15.2.22 <a href="#func-array-reverse" style="text-decoration: none">array:reverse</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an array containing all the members of a supplied array, but in reverse order.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:reverse</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns an array with the same number of members as <code>$array</code>, but in reverse order.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">$array 
=&gt; array:members() 
=&gt; reverse() 
=&gt; array:of-members()</pre></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:reverse([ "a", "b", "c", "d" ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ "d", "c", "b", "a" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:reverse([ ("a", "b"), ("c", "d") ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ ("c", "d"), ("a", "b") ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:reverse([ 1 to 5 ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ (1, 2, 3, 4, 5) ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:reverse([])</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-size"></a>15.2.23 <a href="#func-array-size" style="text-decoration: none">array:size</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the number of members in the supplied array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:size</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns the number of members in the array.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">count(array:members($array))</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>Note that because an array is an item, the <a href="#func-count"><code>fn:count</code></a> function when applied to an array always returns <code>1</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:size([ "a", "b", "c" ])</code></pre></div></td><td style="vertical-align:top"><p><code>3</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:size([ "a", [ "b", "c" ] ])</code></pre></div></td><td style="vertical-align:top"><p><code>2</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:size([])</code></pre></div></td><td style="vertical-align:top"><p><code>0</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:size([ [] ])</code></pre></div></td><td style="vertical-align:top"><p><code>1</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-slice"></a>15.2.24 <a href="#func-array-slice" style="text-decoration: none">array:slice</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-sort-by">next</a> | <a href="#func-array-of-members">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/63">63</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/477">477</a>&nbsp;9 May 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an array containing selected members of a supplied input array based on their position.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:slice</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$start</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$end</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$step</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the array is converted to a sequence, the function <a href="#func-slice"><code>fn:slice</code></a> is applied to this sequence, and the resulting sequence is converted back to an array.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">$array 
=&gt; array:members() 
=&gt; slice($start, $end, $step) 
=&gt; array:of-members()</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>Note that unlike other operations on arrays, there are no out-of-bounds errors for inappropriate values of <code>$start</code>, <code>$end</code>, or <code>$step</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $in := [ 'a', 'b', 'c', 'd', 'e' ]</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := 2, end := 4)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "c", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "c", "d", "e" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, end := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := 3, end := 3)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "c" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := 4, end := 3)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "d", "c" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := 2, end := 5, step := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := 5, end := 2, step := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "e", "c" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := 2, end := 5, step := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := 5, end := 2, step := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", "c", "d", "e" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := -1)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "e" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := -3)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "c", "d", "e" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, end := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", "c", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := 2, end := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "c", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := -2, end := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "d", "c", "b" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := -4, end := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "c", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := -2, end := -4)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "d", "c", "b" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := -4, end := -2, step := 2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice($in, start := -2, end := -4, step := -2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "d", "b" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:slice([ "a", "b", "c", "d" ], 0)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "a", "b", "c", "d" ]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-sort"></a>15.2.25 <a href="#func-array-sort" style="text-decoration: none">array:sort</a></h4><dl><dt class="label">Summary</dt><dd><p>Sorts a supplied array, based on the value of a sort key supplied as a function.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:sort</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$collation</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:default-collation()</code>,</td></tr><tr class="arg"><td><code>$key</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>fn(item()*) as xs:anyAtomicType*</code></code></td><td><code class="assign">:=&nbsp;</code><code>fn:data#1</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>This function is retained for compatibility from version 3.1 of this specification. Version 4.0 introduces a more powerful functions, <a href="#func-array-sort-by"><code>array:sort-by</code></a>.</p><p>The function call <code>array:sort($array, $collation, $key)</code> is defined to have the same effect as the call <code>array:sort-by($array, { 'key': $key, 'collation': $collation, 'order': 'ascending'})</code>. See <a href="#func-array-sort-by"><code>array:sort-by</code></a>.</p><p>The result of the function is a sequence that contains all the items from <code>$input</code>, typically in a different order, the order being defined by the supplied sort key definitions.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">array:sort-by($array, { 'key':$key, 'collation':$collation, 'order':'ascending' })</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>If the set of computed sort keys contains values that are not comparable using the <code>lt</code> operator then the sort operation will fail with a type error ([<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>). </p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:sort([ 1, 4, 6, 5, 3 ])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[ 1, 3, 4, 5, 6 ]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:sort([ 1, -2, 5, 10, -10, 10, 8 ], (), abs#1)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[ 1, -2, 5, 8, 10, -10, 10 ]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:sort([ [ 2, "i" ], [ 1, "e" ], [ 2, "g" ], [ 1, "f" ] ])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[ [ 1, "e" ], [ 1, "f" ], [ 2, "g" ], [ 2, "i" ] ]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-sort-by"></a>15.2.26 <a href="#func-array-sort-by" style="text-decoration: none">array:sort-by</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-sort-with">next</a> | <a href="#func-array-slice">previous</a>)</p><ol><li><p>New in 4.0.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1085">1085</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2001">2001</a>&nbsp;19 May 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Sorts a supplied array, based on the value of a number of sort keys supplied as functions.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:sort-by</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$keys</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>record(key? as (fn(item()*) as xs:anyAtomicType*)?, collation? as xs:string?, order? as enum('ascending', 'descending')?)*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>The result of the function is an array that contains the same members as <code>$array</code>, typically in a different order, the order being defined by the supplied <b>sort key definitions</b>.</p><p>A <b>sort key definition</b> is a record with three parts:</p><ol class="enumar"><li><p><code>key:</code> A <b>sort key function</b>, which is applied to each member of the input sequence to determine a <b>sort key value</b>. If no function is supplied, the default is <a href="#func-data"><code>fn:data#1</code></a>, which atomizes the value of the array member.</p></li><li><p><code>collation:</code> A <b>collation</b>, which is used when comparing <b>sort key values</b> that are of type <code>xs:string</code> or <code>xs:untypedAtomic</code>. If no collation is supplied, the default collation from the static context is used.</p><p>When comparing values of types other than <code>xs:string</code> or <code>xs:untypedAtomic</code>, the collation is ignored (but an error <span class="verb">may</span> be reported if it is invalid). For more information see <a href="#choosing-a-collation"><b>5.3.7 Choosing a collation</b></a>.</p></li><li><p><code>order:</code> An <b>order direction</b>, either <code>"ascending"</code> or <code>"descending"</code>. The default is <code>"ascending"</code>.</p></li></ol><p>The number of sort key definitions is determined by the number of records supplied in the <code>$keys</code> argument. If the argument is absent or empty, the default is a single sort key definition using the function <code>data#1</code>, using the default collation from the static context, and with order <code>ascending</code>.</p><p>The result of the <code>array:sort-by</code> function is obtained as follows:</p><ol class="enumar"><li><p>The result array contains the same members as <code>$array</code>, but generally in a different order.</p></li><li><p>The sort key definitions are established as described above. The sort key definitions are in major-to-minor order. That is, the position of two values <code>$A</code> and <code>$B</code> in the result sequence is determined first by the relative magnitude of their primary sort key values, which are computed by evaluating the <b>sort key function</b> in the first sort key definition. If those two sort key values are equal, then the position is determined by the relative magnitude of their secondary sort key values, computed by evaluating the sort key function in the second sort key definition, and so on.</p></li><li><p>When a pair of corresponding sort key values of <code>$A</code> and <code>$B</code> are found to be not equal, then <code>$A</code> precedes <code>$B</code> in the result sequence if both the following conditions are true, or if both conditions are false:</p><ol class="enumla"><li><p>The sort key value for <code>$A</code> is less than the sort key value for <code>$B</code>, as defined below.</p></li><li><p>The <b>order direction</b> in the corresponding sort key definition is <code>"ascending"</code>.</p></li></ol></li><li><p>If all the sort key values for <code>$A</code> and <code>$B</code> are pairwise equal, then <code>$A</code> precedes <code>$B</code> in the result sequence if and only if <code>$A</code> precedes <code>$B</code> in the input sequence.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>That is, the sort is <em>stable</em>.</p></div></li><li><p>Each sort key value for a given array member is obtained by applying the sort key function of the corresponding sort key definition to that member. The result of this function is in the general case a sequence of atomic items. Two sort key values <code>$a</code> and <code>$b</code> are compared as follows:</p><ol class="enumla"><li><p>Let <var>$C</var> be the collation in the corresponding sort key definition.</p></li><li><p>Let <code>$REL</code> be the result of evaluating <code>op:lexicographic-compare($key($A), $key($B), $C)</code> where <code>op:lexicographic-compare($a, $b, $C)</code> is defined as follows:</p><div class="exampleInner"><pre xml:space="preserve" class="small">if (empty($a) and empty($b)) then 0 
else if (empty($a)) then -1
else if (empty($b)) then +1
else let $rel = op:simple-compare(head($a), head($b), $C)
     return if ($rel eq 0)
            then op:lexicographic-compare(tail($a), tail($b), $C)
            else $rel</pre></div></li><li><p>Here <code>op:simple-compare($k1, $k2)</code> is defined as follows:</p><div class="exampleInner"><pre xml:space="preserve" class="small">if ($k1 instance of (xs:string | xs:anyURI | xs:untypedAtomic)
    and $k2 instance of (xs:string | xs:anyURI | xs:untypedAtomic))
then compare($k1, $k2, $C)
else if ($k1 instance of xs:numeric and $k2 instance of xs:numeric)
then compare($k1, $k2)
else if ($k1 eq $k2) then 0
else if ($k2 lt $k2) then -1
else +1</pre></div><div class="note"><p class="prefix"><b>Note:</b></p><p>This raises an error if two keys are not comparable, for example if one is a string and the other is a number, or if both belong to a non-ordered type such as <code>xs:QName</code>.</p></div></li><li><p>If <code>$REL</code> is zero, then the two sort key values are deemed equal; if <code>$REL</code> is -1 then <code>$a</code> is deemed less than <code>$b</code>, and if <code>$REL</code> is +1 then <code>$a</code> is deemed greater than <code>$b</code></p></li></ol></li></ol></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve" class="small">$array
=&gt; array:members()
=&gt; fn:sort-by(
  for $key-spec in ($keys otherwise {})
  return map:put{$key-spec, 'key', fn($member as record(value)) as xs:anyAtomicType* {
    map:get($key-spec, 'key', fn:data#1)(map:get($member, 'value'))
  }
)
=&gt; array:of-members()</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>If the set of computed sort keys contains values that are not comparable using the <code>lt</code> operator then the sort operation will fail with a type error ([<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>). </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function is a generalization of the <a href="#func-array-sort"><code>array:sort</code></a> function available in 3.1, which is retained for compatibility. The enhancements allow multiple sort keys to be defined, each potentially with a different collation, and allow sorting in descending order.</p><p>If the sort key for an item evaluates to the empty sequence, the effect of the rules is that this item precedes any value for which the key is non-empty. This is equivalent to the effect of the XQuery option <code>empty least</code>. The effect of the option <code>empty greatest</code> can be achieved by adding an extra sort key definition with <code>{'key': fn{empty(K(.)}}</code>: when comparing boolean sort keys, <code>false</code> precedes <code>true</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:sort-by([1, 4, 6, 5, 3], {})</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[1, 3, 4, 5, 6]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:sort-by([1, 4, 4e0, 6, 5, 3], {'order': 'descending'})</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[6, 5, 4, 4e0, 3, 1]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:sort-by([(1,4,3), 4, (5,6), 2], ({'key': count#1}, {}))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[2, 4, (5,6), (1,4,3)]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-sort-with"></a>15.2.27 <a href="#func-array-sort-with" style="text-decoration: none">array:sort-with</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-split">next</a> | <a href="#func-array-sort-by">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2012">2012</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2228">2228</a>&nbsp;3 October 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Sorts a supplied array, according to the order induced by the supplied comparator functions.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:sort-with</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$comparators</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(fn(item()*, item()*) as xs:integer)+</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Informally, the members of the supplied <code>$array</code> are sorted into an order based on the result of evaluating the supplied <code>$comparators</code>. The result is a sorted array.</p><p>Each comparator function takes two values and returns an <code>xs:integer</code> that defines the relationship between these values, following the conventions of the <a href="#func-compare"><code>fn:compare</code></a> function. Specifically, when a comparator <code>$c</code> is used to compare two values <code>$a</code> and <code>$b</code>, it must return a negative integer if <code>$a</code> is to be sorted before <code>$b</code>, zero if they are considered equal, and a positive integer if <code>$a</code> is to be sorted after <code>$b</code>.</p><p>There may be more than one comparator, representing sort keys in major to minor order. To determine the relative position of two members <code>$a</code> and <code>$b</code>:</p><ol class="enumar"><li><p>The first comparator is called: <code>$comparators[1]($a, $b)</code>. If the result is non-zero, this determines the relative position of <code>$a</code> and <code>$b</code> in the result array, and any further comparators can be ignored.</p></li><li><p>If the <var>N</var>th comparator returns zero, then:</p><ol class="enumla"><li><p>If this is the last comparator, then the two members are considered equal, and their relative position in the result sequence will be the same as their relative position in the input sequence (that is, the sort is <em>stable</em>).</p></li><li><p>Otherwise, the next comparator is evaluated, and so on, until the last comparator is reached or the result of a comparator is non-zero.</p></li></ol></li></ol><p>To ensure that the sorting algorithm produces predictable results (indeed, to ensure that it terminates), it is necessary for the comparators to have certain properties. Specifically, for every comparator <var>C</var>:</p><ol class="enumar"><li><p><var>C</var> must be deterministic (if called twice with the same arguments, it must deliver the same result).</p></li><li><p>Every value must be equal to itself: <code><var>C</var>($a, $a)</code> must be zero.</p></li><li><p>The ordering must be consistent: if <code><var>C</var>($a, $b) &lt; 0</code>, then <code><var>C</var>($b, $a) &gt; 0</code>, and vice versa, and similarly, if <code><var>C</var>($a, $b) = 0</code>, then <code><var>C</var>($b, $a) = 0</code>.</p></li><li><p>The ordering must be transitive: if <code><var>C</var>($a, $b) &lt; 0</code> and <code><var>C</var>($b, $c) &lt; 0</code>, then <code><var>C</var>($a, $c) &lt; 0</code>.</p></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>If a comparator function raises an error when processing any pair of members from the input array (for example, if the comparator function is <a href="#func-compare"><code>fn:compare#2</code></a> and one of the members is not coercible to <code>xs:anyAtomicType</code>), then the evaluation of <a href="#func-sort-with"><code>fn:sort-with</code></a> fails with that error.</p><p>In general it is unpredictable which pairs of members from the input array will actually be compared using each comparator function. However, a comparator function <span class="verb">must</span> not be called to compare two members if they have been determined as unequal by an earlier comparator function.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:sort-with([1, 4, 6, 5, 3], compare#2)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[1, 3, 4, 5, 6]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:sort-with([1, 4, 6, 5, 3], op('-'))</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[1, 3, 4, 5, 6]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:sort-with([1, 4, 4e0, 6, 5, 3], fn($a, $b) { compare($b, $a) })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[6, 5, 4, 4e0, 3, 1]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">array:sort-with(
  [{"a":1, "b":20}, {"a":5, "b":12}, {"a":1, "b":3}],
   ( fn($x, $y){ compare($x?a, $y?a) },
     fn($x, $y){ compare($x?b, $y?b) })  
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[{"a":1, "b":3}, {"a":1, "b":20}, {"a":5, "b":12}]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-split"></a>15.2.28 <a href="#func-array-split" style="text-decoration: none">array:split</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-subarray">next</a> | <a href="#func-array-sort-with">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/508">508</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/609">609</a>&nbsp;25 July 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Delivers the contents of an array as a sequence of single-member arrays.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:split</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The members of the array are delivered as a sequence of <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-single-member-array">single-member arrays</a><sup><small>DM</small></sup>. Each returned array encapsulates the value of one member of <code>$array</code>.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">dm:iterate-array($array, fn($member) { array:append([], $member) })</pre></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function call <code>array:split($array)</code> produces the same result as the expression <code>for member $m in $array return [ $m ]</code>.</p><p>The expression <code>$A =&gt; array:split() =&gt; array:join()</code>, applied to any array <code>$A</code>, returns the original array <code>$A</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:split([])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:split([ () ])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[ () ]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>array:split([ 1 to 5 ])</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>[ (1, 2, 3, 4, 5) ]</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:split(
  array { 1 to 5 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ 1 ], [ 2 ], [ 3 ], [ 4 ], [ 5 ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">array:split(
  [ (1, 1), (2, 4), (3, 9), (4, 16), (5, 25) ]
) ! sum(.)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2, 6, 12, 20, 30</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $array := [ "any array" ]
return deep-equal(
  $array,
  array:join(array:split($array))
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-subarray"></a>15.2.29 <a href="#func-array-subarray" style="text-decoration: none">array:subarray</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-array-trunk">next</a> | <a href="#func-array-split">previous</a>)</p><ol><li><p>Supplying the empty sequence as the value of an optional argument is equivalent to omitting the argument.</p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an array containing all members from a supplied array starting at a supplied position, up to a specified length.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:subarray</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code>,</td><td></td></tr><tr class="arg"><td><code>$start</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer</code></code>,</td><td></td></tr><tr class="arg"><td><code>$length</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:integer?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Except in error cases, the two-argument version of the function returns the same result as the three-argument version when called with <code>$length</code> equal to the value of <code>array:size($array) - $start + 1</code>.</p><p>Setting the third argument to the empty sequence has the same effect as omitting the argument.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression, except in error cases.</p><div class="exampleInner"><pre xml:space="preserve">$array
=&gt; array:members()
=&gt; subsequence($start, $length)
=&gt; array:of-members()</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if <code>$start</code> is less than one <span>or greater than <code>array:size($array) + 1</code></span>.</p><p>For the three-argument version of the function:</p><ul><li><p>A dynamic error is raised [<a href="#ERRFOAY0002" title="err:FOAY0002">err:FOAY0002</a>] if <code>$length</code> is less than zero.</p></li><li><p>A dynamic error is raised [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if <code>$start + $length</code> is greater than <code>array:size($array) + 1</code>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>The value of <code>$start</code> can be equal to <code>array:size($array) + 1</code> provided that <code>$length</code> is either equal to zero or omitted. In this case the result will be the empty array.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:subarray([ "a", "b", "c", "d" ], 2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "c", "d" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:subarray([ "a", "b", "c", "d" ], 5)</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:subarray([ "a", "b", "c", "d" ], 2, 0)</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:subarray([ "a", "b", "c", "d" ], 2, 1)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:subarray([ "a", "b", "c", "d" ], 2, 2)</code></pre></div></td><td style="vertical-align:top"><p><code>[ "b", "c" ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:subarray([ "a", "b", "c", "d" ], 5, 0)</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:subarray([], 1, 0)</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-tail"></a>15.2.30 <a href="#func-array-tail" style="text-decoration: none">array:tail</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns an array containing all members except the first from a supplied array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:tail</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns an array containing all members of the supplied array except the first.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">array:remove($array, 1)</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error occurs [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if <code>$array</code> is empty.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the supplied array contains exactly one member, the result will be the empty array.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:tail([ 5, 6, 7, 8 ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ 6, 7, 8 ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:tail([ 5 ])</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-array-trunk"></a>15.2.31 <a href="#func-array-trunk" style="text-decoration: none">array:trunk</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#processing-jnodes">next</a> | <a href="#func-array-subarray">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/97">97</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/250">250</a>&nbsp;7 December 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns an array containing all members except the last from a supplied array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">array:trunk</code>(</td></tr><tr class="arg"><td><code>$array</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>array(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns an array containing all members of the supplied array except the last.</p></dd><dt class="label">Formal Equivalent</dt><dd><p>The effect of the function is equivalent to the result of the following XPath expression.</p><div class="exampleInner"><pre xml:space="preserve">array:remove($array, array:size($array))</pre></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error occurs [<a href="#ERRFOAY0001" title="err:FOAY0001">err:FOAY0001</a>] if <code>$array</code> is empty.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the supplied array contains exactly one member, the result will be the empty array.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:trunk([ 5, 6, 7, 8 ])</code></pre></div></td><td style="vertical-align:top"><p><code>[ 5, 6, 7 ]</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>array:trunk([ 5 ])</code></pre></div></td><td style="vertical-align:top"><p><code>[]</code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="additional-array-operations"></a>15.3 <a href="#additional-array-operations" style="text-decoration: none">Other Operations on Arrays</a></h3><p><em>This section is non-normative.</em></p><p>Arrays may be compared using the <a href="#func-deep-equal"><code>fn:deep-equal</code></a> function.</p><p>The XPath language provides explicit syntax for certain operations on arrays. These constructs can all be specified in terms of function primitives:</p><ul><li><p>The empty array can be constructed using either of the expressions <code>[]</code> or <code>array{}</code>. The effect is the same as the data model primitive <code>dm:empty-array(())</code> (see <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-array-constructors">4.14.2.1 Array Constructors</a>). Using user-visible functions it can be achieved by calling <code>array:build(())</code> or <code>array:of-members(())</code>.</p></li><li><p>The expression <code>array { $sequence }</code> constructs an array whose members are the items in <code>$sequence</code>. Every member of this array will be a singleton item. The effect is the same as <code>array:build($sequence)</code>.</p></li><li><p>The expression <code>[<var>E<sub>1</sub></var>, <var>E<sub>2</sub></var>, <var>E<sub>3</sub></var>, ..., <var>E<sub>n</sub></var>]</code> constructs an array in which <code>E1</code> is the first member, <code>E2</code> is the second member, and so on. The result is equivalent to the expression <code>[] =&gt; array:append(<var>E<sub>1</sub></var>) =&gt; array:append(<var>E<sub>2</sub></var>) =&gt; ... =&gt; array:append(<var>E<sub>n</sub></var>))). </code></p></li><li><p>The lookup expression <code>$array?*</code> returns the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-sequence-concatenation">sequence concatenation</a><sup><small>XP</small></sup> of the members of the array. It is equivalent to calling <code>array:fold-left($array, (), fn($result, $next){ $result, $next })</code>.</p></li><li><p>The lookup expression <code>$array?$N</code>, where <code>$N</code> is an integer within the bounds of the array, is equivalent to <code>array:get($array, $N)</code>.</p></li><li><p>Similarly, applying the array as a function, <code>$array($N)</code>, is also equivalent to <code>array:get($array, [$N])</code></p></li><li><p>The expression <code>for member $m in $array return <var>EXPR</var></code> is equivalent to <code>array:for-each($array, fn($m){ <var>EXPR</var> })</code> (see <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> section <a href="../xquery-40/xquery-40.html#id-xquery-for-clause">4.13.2 For Clause</a> and <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-for-expressions">4.13.1 For Expressions</a>).</p></li><li><p>Arrays can be filtered using the construct <code>$array?[<var>predicate</var>]</code> (see <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-filter-maps-and-arrays">4.14.5 Filter Expressions for Maps and Arrays</a>).</p></li></ul></div></div><div class="div1"><h2><a id="processing-jnodes"></a>16 <a href="#processing-jnodes" style="text-decoration: none">Processing JNodes</a></h2><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-jtree">next</a> | <a href="#func-array-trunk">previous</a>)</p><ol><li><p> Introduced the concept of JNodes. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2025">2025</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2031">2031</a>&nbsp;11 June 2025]</i></p></li></ol></div><p>A <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JNode">JNode</a><sup><small>DM</small></sup> is a wrapper around a map or array, or around a value that appears within the content of a map or array. JNodes are described at <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#id-JNodes">8.4 JNodes</a>. Wrapping a map or array in a JNode enables the use of path expressions such as <code>$jnode/descendant::title</code>, as described at <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-path-expressions">4.7 Path Expressions</a>.</p><p>In addition to the functions defined in this section, functions that operate on JNodes include:</p><blockquote><p><a href="#func-distinct-ordered-nodes"><code>fn:distinct-ordered-nodes</code></a><br><a href="#func-generate-id"><code>fn:generate-id</code></a><br><a href="#func-has-children"><code>fn:has-children</code></a><br><a href="#func-innermost"><code>fn:innermost</code></a><br><a href="#func-outermost"><code>fn:outermost</code></a><br><a href="#func-path"><code>fn:path</code></a><br><a href="#func-root"><code>fn:root</code></a><br><a href="#func-siblings"><code>fn:siblings</code></a><br><a href="#func-transitive-closure"><code>fn:transitive-closure</code></a></p></blockquote><div class="div2"><h3><a id="functions-on-jnodes"></a>16.1 <a href="#functions-on-jnodes" style="text-decoration: none">Functions on JNodes</a></h3><div class="div3"><h4><a id="func-jtree"></a>16.1.1 <a href="#func-jtree" style="text-decoration: none">fn:jtree</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-jnode-content">next</a> | <a href="#processing-jnodes">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2025">2025</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2031">2031</a>&nbsp;12 June 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Delivers a root <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JNode">JNode</a><sup><small>DM</small></sup> wrapping a map or array, enabling the use of lookup expression to navigate a <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JTree">JTree</a><sup><small>DM</small></sup> rooted at that map or array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:jtree</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(map(*)|array(*))</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>jnode((map(*)|array(*)))</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function creates a <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JNode">JNode</a><sup><small>DM</small></sup> that wraps the supplied map or array. Specifically, it creates a root JNode whose <b>·content·</b> property is <code>$input</code>, and whose <b>·parent·</b>, <b>·position·</b>, and <b>·selector·</b> properties are absent.</p><p>This has the effect that lookup expressions starting from this JNode retain information for subsequent navigation.</p><p>A JNode has unique identity. If two maps or arrays <var>M<sub>1</sub></var> and <var>M<sub>2</sub></var> have the same function identity, as determined by the <a href="#func-function-identity"><code>function-identity</code></a> function, then <code>jtree(<var>M<sub>1</sub></var>) is jtree(<var>M<sub>2</sub></var>)</code><span class="verb">must</span> return true: that is, the same JNode must be delivered for both.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>It is to some extent <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether two maps or arrays have the same function identity. Processors <span class="verb">should</span> ensure as a minimum that when a variable <code>$m</code> is bound to a map or array, calling <code>jtree($m)</code> more than once (with the same variable reference) will deliver the same JNode each time.</p><p>The effect of the coercion rules is technically that if an existing JNode is supplied as <code>$input</code>, the wrapped value will be extracted, and then rewrapped as a JNode: in practice, this can be short-circuited by returning the supplied JNode unchanged.</p><p>Although <code>fn:jnode</code> is available as a function for user applications to call explicitly, it is also invoked implicitly by some expressions, notably when a path expression is written in a form such as <code>$map/child::*</code>. Specifically, if the left-hand operand of the <code>/</code> operator is a map or array, then the supplied map or array is implicitly wrapped in a JNode. </p><p>The effect of applying <code>fn:jnode</code> to a map or array is that subsequent retrieval operations within the wrapped map or array return results that retain useful information about where the results were found. For example, consider an expression such as <code>json-doc($source)//name</code>. This expression returns a set of JNodes representing all entries in the JTree having the key <code>"name"</code>; each of these JNodes contains not only the value of the relevant <code>"name"</code> entry, but also the key (which in this simple example is always <code>"name"</code> and the containing map. This means, for example, if <code>$result</code> is the result of the expression <code>json-doc($source) // name</code>, then:</p><ul><li><p><code>$result / .. / ssn</code> locates the map that contained each <code>name</code>, and returns the value of the <code>ssn</code> entry in that map.</p></li><li><p><code>$result / ancestor::course</code> returns any <code>course</code> entries in containing maps.</p></li><li><p><code>$result / ancestor::* =&gt; jnode-selector() </code> returns a sequence of map keys and array index values representing the location of the found entries within the JSON structure.</p></li></ul><p>An alternative way of wrapping a map or array, rather than calling <code>jtree($X)</code>, is to use the path expression <code>$X/.</code>.</p><p>There are two situations where a map or array is implicitly wrapped in a JNode:</p><ul><li><p>When the value of the left-hand operand of the <code>/</code> operator includes a map or array;</p></li><li><p>When the context value for evaluation of an <code>AxisStep</code> includes a map or array.</p></li></ul></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>jtree([ "a", "b", "c" ])/*[1]/../*[last()] =&gt; string()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"c"</code></p><p><em>(The call on <code>fn:jnode</code> would happen automatically).</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>jtree([ "a", "b", "c", "d" ])/* =!&gt; jnode-selector()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>1, 2, 3, 4</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $data := {
  "fr": { "capital": "Paris", "languages": [ "French" ] }, 
  "de": { "capital": "Berlin", "languages": [ "German" ] }
}
return jtree($data)//languages[. = 'German']/../capital =!&gt; string()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Berlin"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-jnode-content"></a>16.1.2 <a href="#func-jnode-content" style="text-decoration: none">fn:jnode-content</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-jnode-selector">next</a> | <a href="#func-jtree">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2025">2025</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2031">2031</a>&nbsp;12 June 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the <b>·content·</b> property of a JNode.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:jnode-content</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>jnode()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>).</p><p>If <code>$input</code> is the empty sequence, the function returns the empty sequence.</p><p>Otherwise, the function returns the <b>·content·</b> property of <code>$input</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup>.</p></li><li><p>If the context value is not an instance of the sequence type <code>jnode()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>In many cases it is unnecessary to make an explicit call on <code>jnode-content</code>, because the coercion rules will take care of this automatically. For example, in an expression such as <code>$X / descendant::name [matches(., '^J')]</code>, the call on <a href="#func-matches"><code>matches</code></a> is supplied with a JNode as its first argument; atomization ensures that the actual value being passed to the first argument of <a href="#func-matches"><code>matches</code></a> is the atomized value of the <b>·content·</b> property.</p><p>Other examples where the <b>·content·</b> of a JNode is extracted automatically include:</p><ul><li><p>Any context where the required type is an atomic value, for example arithmetic operations, value comparisons and general comparisons, and calls on functions that expect an atomic value.</p></li><li><p>Any context where the required type is a map or array, for example the first argument of functions such as <a href="#func-map-size"><code>map:size</code></a> or <a href="#func-array-size"><code>array:size</code></a>, a free-standing expression within a map constructor such as <code>map{ $jnode }</code>, the constructs <code>for member</code> and <code>for key/value</code>, the left-hand operand of the lookup operator <code>?</code> (or the context value in the case of a unary lookup operator), and the operand of a map/array filter expression <code>$jnode?[predicate]</code>.</p></li></ul><p>Notable places where the <b>·content·</b> is <em>not</em> automatically extracted include:</p><ul><li><p>When computing the effective boolean value. As with XNodes, writing <code>if ($array/child::*[1]) ...</code> tests for the existence of a child, it does not test its value. To test its value, write <code>if (jnode-content($array/child::*[1])) ...</code>, or equivalently <code>if (xs:boolean($array/child::*[1])) ...</code>.</p></li><li><p>When calling functions that accept arbitrary sequences, such as <a href="#func-count"><code>count</code></a> or <a href="#func-deep-equal"><code>deep-equal</code></a>.</p></li></ul><p>It is possible (though probably unwise) to construct a JNode whose <b>·content·</b> property itself contains another JNode. For example, the expression <code>jtree([jtree([]), jtree([])])</code> creates a JNode whose <b>·content·</b> is an array of JNodes, and applying the <code>child</code> axis to this JNode will return a sequence of two JNodes that themselves have further JNodes as their content. The <a href="#func-jnode-content"><code>jnode-content</code></a> returns these contained JNodes, it does not recursively extract their content.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $array := [1, 3, 4.5, 7, "eight", 10]
return $array / child::type(xs:integer) =!&gt; jnode-content()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, 3, 7, 10</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $map := {'Mo': 'Monday', 'Tu': 'Tuesday', 'We': 'Wednesday'}
return $map / child::get(("Mo", "We", "Fr", "Su")) =!&gt; jnode-content()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Monday", "Wednesday"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $array := [[4, 18], [30, 4, 22]]
return $array / descendant::*[. &gt; 25][1] / ancestor-or-self::* =!&gt; jnode-content()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[[4, 18], [30, 4, 22]], [30, 4, 22]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-jnode-selector"></a>16.1.3 <a href="#func-jnode-selector" style="text-decoration: none">fn:jnode-selector</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-jnode-position">next</a> | <a href="#func-jnode-content">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2025">2025</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2031">2031</a>&nbsp;12 June 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the <b>·selector·</b> property of a JNode.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:jnode-selector</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>jnode()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>).</p><p>If <code>$input</code> is the empty sequence, the function returns the empty sequence.</p><p>If <code>$input</code> is a root JNode (one in which the <b>·selector·</b> property is absent), the function returns the empty sequence.</p><p>Otherwise, the function returns the <b>·selector·</b> property of <code>$input</code>. In the case where the parent JNode wraps a map, this will be the key of the relevant entry within that map; in the case where the parent JNode wraps an array, it will be the 1-based index of the relevant member of the array.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup>.</p></li><li><p>If the context value is not an instance of the sequence type <code>jnode()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $array := [1, 3, 4.5, 7, "eight", 10]
return $array / child::type(xs:integer) =!&gt; jnode-selector()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1, 2, 4, 6</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $map := {'Mo': 'Monday', 'Tu': 'Tuesday', 'We': 'Wednesday'}
return $map / child::get(("Mo", "We", "Fr", "Su")) =!&gt; jnode-selector()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">"Mo", "We"</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $array := [[4, 18], [30, 4, 22]]
return $array / descendant::*[. &gt; 25] / ancestor-or-self::* =!&gt; jnode-selector()</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">2, 1</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-jnode-position"></a>16.1.4 <a href="#func-jnode-position" style="text-decoration: none">fn:jnode-position</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-doc">next</a> | <a href="#func-jnode-selector">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2025">2025</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2031">2031</a>&nbsp;12 June 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns the <b>·position·</b> property of a JNode.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:jnode-position</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>jnode()?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyAtomicType?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the argument is omitted, it defaults to the context value (<code>.</code>).</p><p>If <code>$input</code> is the empty sequence, the function returns the empty sequence.</p><p>If <code>$input</code> is a root JNode (one in which the <b>·position·</b> property is absent), the function returns the empty sequence.</p><p>Otherwise, the function returns the <b>·position·</b> property of <code>$input</code>. The value of this property will be 1 (one) except in cases where the value of an entry in a map, or a member in an array, is a sequence that contains multiple items including maps and/or arrays; in such cases the position will be the 1-based position of the relevant map or array.</p></dd><dt class="label">Error Conditions</dt><dd><p>The following errors may be raised when <code>$node</code> is omitted:</p><ul><li><p>If the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup>.</p></li><li><p>If the context value is not an instance of the sequence type <code>jnode()?</code>, type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p></li></ul></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function is relevant only when there are maps whose entries are multi-item sequences that include maps and arrays, or arrays whose members include such multi-item sequences. Such structures are uncommon, and never arise from parsing of JSON source text. It is generally best to avoid such structures by using arrays rather than sequences within array and map content; apart from other considerations, this allows the data to be serialized in JSON format.</p><p>If an entry within a map, or a member of an array, contains a sequence of items that mixes arrays and maps with other content (for example the array <code>[1, 2, ([1,2], [3,4], 5))</code>, then a lookup using the child axis will only construct JNodes in respect of those items that are non-empty maps or arrays. This may leave gaps in the position numbering sequence, as illustrated in the examples below.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := {
   "a": [10, 20, 30], 
   "b": ([40, 50, 60], [], 0, [70, 80, (90, 100)])
}
return $input / child::b / * 
       ! { "position": jnode-position(),
           "index": jnode-selector(),
           "value": jnode-content()
         }</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ "position": 1, "index": 1, "value": 40 },
{ "position": 1, "index": 2, "value": 50 },
{ "position": 1, "index": 3, "value": 60 },
{ "position": 4, "index": 1, "value": 70 },
{ "position": 4, "index": 2, "value": 80 },
{ "position": 4, "index": 3, "value": (90, 100) }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := {
   "a": {"x": 10, "y": 20, "z": 30}, 
   "b": ( {"x": 40, "y": 50, "z": 60},
          {},
          {"x": 70, "y": 80, "z": (90, 100)})
}
return $input / child::b / * 
       ! { "position": jnode-position(),
           "key": jnode-selector(),
           "value": jnode-content()
         }</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{ "position": 1, "key": "x", "value": 40 },
{ "position": 1, "key": "y", "value": 50 },
{ "position": 1, "key": "z", "value": 60 },
{ "position": 3, "key": "x", "value": 70 },
{ "position": 3, "key": "y", "value": 80 },
{ "position": 3, "key": "z", "value": (90, 100) }</pre></div></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="parsing-and-serializing"></a>17 <a href="#parsing-and-serializing" style="text-decoration: none">External resources and data formats</a></h2><p>These functions in this section access resources external to a query or stylesheet, and convert between external file formats and their XPath and XQuery data model representation.</p><div class="div2"><h3><a id="fns-on-docs"></a>17.1 <a href="#fns-on-docs" style="text-decoration: none">Accessing external information</a></h3><p>The functions in this section provide access to resources (such as files) in the external environment.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-doc"><code>fn:doc</code></a></td><td>Retrieves a document using a URI supplied as an <code>xs:string</code>, and returns the corresponding document node.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-doc-available"><code>fn:doc-available</code></a></td><td>The function returns <code>true</code> if and only if the function call <code>fn:doc($source, $options)</code> would return a document node.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-collection"><code>fn:collection</code></a></td><td>Returns a sequence of items identified by a collection URI; or a default collection if no URI is supplied.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-uri-collection"><code>fn:uri-collection</code></a></td><td>Returns a sequence of <code>xs:anyURI</code> values representing the URIs in a URI collection.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-unparsed-text"><code>fn:unparsed-text</code></a></td><td>The <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function reads an external resource (for example, a file) and returns a string representation of the resource.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a></td><td>The <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> function reads an external resource (for example, a file) and returns its contents as a sequence of strings, one for each line of text in the string representation of the resource.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-unparsed-text-available"><code>fn:unparsed-text-available</code></a></td><td>Allows an application to determine whether a call on <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> with particular arguments would succeed.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-unparsed-binary"><code>fn:unparsed-binary</code></a></td><td>The <a href="#func-unparsed-binary"><code>fn:unparsed-binary</code></a> function reads an external resource (for example, a file) and returns its contents in binary.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-environment-variable"><code>fn:environment-variable</code></a></td><td>Returns the value of a system environment variable, if it exists.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-available-environment-variables"><code>fn:available-environment-variables</code></a></td><td>Returns a list of environment variable names that are suitable for passing to <a href="#func-environment-variable"><code>fn:environment-variable</code></a>, as a (possibly empty) sequence of strings.</td></tr></tbody></table><div class="div3"><h4><a id="func-doc"></a>17.1.1 <a href="#func-doc" style="text-decoration: none">fn:doc</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-doc-available">next</a> | <a href="#func-jnode-position">previous</a>)</p><ol><li><p>The rule that multiple calls on <a href="#func-doc"><code>fn:doc</code></a> supplying the same absolute URI must return the same document node has been clarified; in particular the rule does not apply if the dynamic context for the two calls requires different processing of the documents (such as schema validation or whitespace stripping).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/898">898</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/905">905</a>&nbsp;9 January 2024]</i></p></li><li><p>An <code>$options</code> parameter is added. Note that the rules for the <code>$options</code> parameter control aspects of processing that were implementation-defined in earlier versions of this specification. An implementation may provide configuration options designed to retain backwards-compatible behavior when no explicit options are supplied.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1021">1021</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1910">1910</a>&nbsp;6 April 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Retrieves a document using a URI supplied as an <code>xs:string</code>, and returns the corresponding document node.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:doc</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>document-node()?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on available documents, and executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$source</code> is the empty sequence, the result is the empty sequence.</p><p>If <code>$source</code> is a relative URI reference, it is resolved relative to the value of the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> property from the dynamic context of the caller. The resulting absolute URI is promoted to an <code>xs:string</code>.</p><p>The way in which an absolute URI is dereferenced to obtain an external resource is described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-security-resources">2.3 External Resources and Security</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div><p>The URI may include a fragment identifier.</p><p>The <code>$options</code> argument, if present and non-empty, defines the detailed behavior of the function. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply. The options available are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">trusted?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">dtd-validation?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">stable?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">strip-space?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean?</code>,</td></tr><tr class="arg"><td><code class="opt">xinclude?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">xsd-validation?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">use-xsi-schema-location?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td rowspan="3"><p><code>trusted?</code></p></td><td class="fos-thick" colspan="2">Indicates whether processing the document may cause other external resources to be fetched (including, for example, external entities, an external DTD, or documents referenced using <code>xsi:schemaLocation</code> or XInclude elements). <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false()</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>The document may include references to other external resources. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>The document must not include references to other external resources unless access to these resources has been explicitly enabled. </td></tr><tr><td rowspan="3"><p><code>dtd-validation?</code></p></td><td class="fos-thick" colspan="2">Determines whether DTD validation takes place. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>The input is parsed using a validating XML parser. The input must contain a <code>DOCTYPE</code> declaration to identify the DTD to be used for validation. The DTD may be internal or external. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>DTD validation does not take place. However, if a <code>DOCTYPE</code> declaration is present, then it is read, for example to perform entity expansion. </td></tr><tr><td rowspan="3"><p><code>stable?</code></p></td><td class="fos-thick" colspan="2">Determines whether two calls on the <a href="#func-doc"><code>doc</code></a> function, with the same URI, the same options, and the same context, are guaranteed to return the same document node. The default value is <code>true</code>, but this may be overridden by implementation-defined configuration options. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>Given the same explicit and implicit arguments, multiple calls return the same document node: that is, the function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>Multiple calls with the same explicit and implicit arguments may return the same document node or different document nodes at the discretion of the implementation. </td></tr><tr><td rowspan="3"><p><code>strip-space?</code></p></td><td class="fos-thick" colspan="2">Determines whether whitespace-only text nodes are removed from the resulting document. The default is defined by the host language or by the implementation. (Note: in XSLT, the <code>xsl:strip-space</code> and <code>xsl:preserve-space</code> declarations provide detailed control based on the parent element name.) <ul><li><p><b>Type: </b><code>xs:boolean?</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>All whitespace-only text nodes are stripped, unless either (a) they are within the scope of the attribute <code>xml:space="preserve"</code>, or (b) XSD validation identifies that the parent element has a simple type or a complex type with simple content. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>All whitespace-only text nodes are preserved, unless either (a) DTD validation marks them as ignorable, or (b) XSD validation recognizes the containing element as having element-only or empty content. </td></tr><tr><td rowspan="3"><p><code>xinclude?</code></p></td><td class="fos-thick" colspan="2">Determines whether any <code>xi:include</code> elements in the input are to be processed using an XInclude processor. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>Any <code>xi:include</code> elements are expanded. If there are <code>xi:include</code> elements and no XInclude processor is available then a dynamic error is raised. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>Any <code>xi:include</code> elements are handled as ordinary elements without expansion. </td></tr><tr><td rowspan="5"><p><code>xsd-validation?</code></p></td><td class="fos-thick" colspan="2">Determines whether XSD validation takes place, using the schema definitions present in the static context. The effect of requesting validation is the same as invoking the <a href="#func-doc"><code>doc</code></a> function without validation, and then applying an XQuery <code>validate</code> expression to the result, with corresponding options. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>"skip"</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>strict</code></td><td>Strict XSD validation takes place</td></tr><tr><td class="fos-thin"><code>lax</code></td><td>Lax XSD validation takes place</td></tr><tr><td class="fos-thin"><code>skip</code></td><td>No XSD validation takes place</td></tr><tr><td class="fos-thick"><code>type Q{uri}local</code></td><td>XSD validation takes place against the schema-defined type, present in the static context, that has the given URI and local name.</td></tr><tr><td rowspan="3"><p><code>use-xsi-schema-location?</code></p></td><td class="fos-thick" colspan="2">When XSD validation takes place, determines whether schema components referenced using <code>xsi:schemaLocation</code> or <code>xsi:noNamespaceSchemaLocation</code> attributes within the source document are to be used. The option is ignored if XSD validation does not take place. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>XSD validation uses the schema components referenced using <code>xsi:schemaLocation</code> or <code>xsi:noNamespaceSchemaLocation</code> attributes in addition to the schema components present in the static context; these components must be compatible as described in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#schema-consistency">4.1.2 Schema Consistency</a>.</td></tr><tr><td class="fos-thick"><code>false</code></td><td>Any <code>xsi:schemaLocation</code> and <code>xsi:noNamespaceSchemaLocation</code> attributes in the document are ignored.</td></tr></tbody></table><p>By default, this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>. Two calls on this function return the same document node if the same URI Reference (after resolution to an absolute URI Reference) is supplied to both calls. Thus, the following expression (if it does not raise an error) will always return <code>true</code>:</p><div class="exampleInner"><pre xml:space="preserve">doc("foo.xml") is doc("foo.xml")</pre></div><div class="note"><p class="prefix"><b>Note:</b></p><p>This equivalence applies only because the two calls on the <a href="#func-doc"><code>fn:doc</code></a> function have the same options and the same static and dynamic context, to the extent this is relevant. If two calls on <a href="#func-doc"><code>fn:doc</code></a> have different dynamic contexts, then the mapping from URIs to document nodes in the two contexts may differ, which means that different document nodes may be returned for the same URI. This can happen, for example, if the two calls appear in different XSLT packages with different validation options or whitespace-stripping options; one call might produce a schema-validated document, the other an untyped document.</p></div><p>The requirement to deliver a deterministic result has performance implications, and for this reason implementations may provide a user option to evaluate the function without a guarantee of determinism. The manner in which any such option is provided is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the user has not selected such an option, a call of the function must either return a deterministic result or must raise a dynamic error [<a href="#ERRFODC0003" title="err:FODC0003">err:FODC0003</a>].</p><div class="note"><p class="prefix"><b>Note:</b></p><p>If the <code>$source</code> URI is obtained from a source document, it is generally appropriate to resolve it relative to the base URI property of the relevant node in the source document. This can be achieved by calling the <a href="#func-resolve-uri"><code>fn:resolve-uri</code></a> function, and passing the resulting absolute URI as an argument to the <a href="#func-doc"><code>fn:doc</code></a> function.</p></div><p>If two calls to this function supply different absolute URI References as arguments, the same document node may be returned if the implementation can determine that the two arguments refer to the same resource.</p><p> By defining the semantics of this function in terms of a string-to-document-node mapping in the dynamic context, the specification is acknowledging that the results of this function are outside the purview of the language specification itself, and depend entirely on the run-time environment in which the expression is evaluated. This run-time environment includes not only an unpredictable collection of resources (“the web”), but configurable machinery for locating resources and turning their contents into document nodes within the XPath data model. Both the set of resources that are reachable, and the mechanisms by which those resources are parsed and validated, are <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p> One possible processing model for this function is as follows. The resource identified by the URI Reference is retrieved. If the resource cannot be retrieved, a dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>]. The data resulting from the retrieval action is then parsed as an XML document and a tree is constructed in accordance with the <a href="#xpath-datamodel-30">[XQuery and XPath Data Model (XDM) 3.0]</a>. If the top-level media type is known and is <code>"text"</code>, the content is parsed in the same way as if the media type were text/xml; otherwise, it is parsed in the same way as if the media type were application/xml. If the contents cannot be parsed successfully, a dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>]. Otherwise, the result of the function is the document node at the root of the resulting tree. This tree is then optionally validated against a schema.</p><p>Various aspects of this processing are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations may provide external configuration options that allow any aspect of the processing to be controlled by the user. In particular:</p><ul><li><p>The set of URI schemes that the implementation recognizes is implementation-defined. Implementations may allow the mapping of URIs to resources to be configured by the user, using mechanisms such as catalogs or user-written URI handlers.</p></li><li><p>The handling of non-XML media types is implementation-defined. Implementations may allow instances of the data model to be constructed from non-XML resources, under user control.</p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether DTD validation and/or schema validation is applied to the source document.</p></li><li><p>Implementations may provide user-defined error handling options that allow processing to continue following an error in retrieving a resource, or in parsing and validating its content. When errors have been handled in this way, the function may return either the empty sequence, or a fallback document provided by the error handler.</p></li><li><p>Implementations may provide user options that relax the requirement for the function to return deterministic results.</p></li><li><p>The effect of a fragment identifier in the supplied URI is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. One possible interpretation is to treat the fragment identifier as an ID attribute value, and to return a document node having the element with the selected ID value as its only child.</p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error <span class="verb">may</span> be raised [<a href="#ERRFODC0005" title="err:FODC0005">err:FODC0005</a>] if <code>$source</code> is not a valid URI <span>reference</span>.</p><p>A dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>] if a relative URI reference is supplied, and the base-URI property in the static context is absent.</p><p>A dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>] if the <b>available documents</b> provides no mapping for the absolutized URI.</p><p>A dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>] if the resource cannot be retrieved or cannot be parsed successfully as XML using the selected options.</p><p>A dynamic error is raised [<a href="#ERRFODC0003" title="err:FODC0003">err:FODC0003</a>] if the implementation is not able to guarantee that the result of the function will be deterministic, and the user has not indicated that an unstable result is acceptable.</p></dd></dl></div><div class="div3"><h4><a id="func-doc-available"></a>17.1.2 <a href="#func-doc-available" style="text-decoration: none">fn:doc-available</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-unparsed-text">next</a> | <a href="#func-doc">previous</a>)</p><ol><li><p>An <code>$options</code> parameter is added. Note that the rules for the <code>$options</code> parameter control aspects of processing that were implementation-defined in earlier versions of this specification. An implementation may provide configuration options designed to retain backwards-compatible behavior when no explicit options are supplied.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1021">1021</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1910">1910</a>&nbsp;6 April 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>The function returns <code>true</code> if and only if the function call <code>fn:doc($source, $options)</code> would return a document node.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:doc-available</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on available documents, and executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$source</code> is the empty sequence, this function returns <code>false</code>.</p><p>If a call on <code>fn:doc($source, $options)</code> would return a document node, this function returns <code>true</code>.</p><p>In all other cases this function returns <code>false</code>. <span>This includes the case where <span>an invalid URI is supplied, and also the case where </span> a valid relative URI reference is supplied, and cannot be resolved, for example because the static base URI is absent.</span></p><p>The recognized values for <code>$options</code> are the same as for the <a href="#func-doc"><code>fn:doc</code></a> function. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply. Note that if the <code>stable</code> option is set to <code>true</code>, then a result of <code>true</code> from this function guarantees that a call on <a href="#func-doc"><code>fn:doc</code></a> with the same explicit and implicit arguments will succeed, whereas a result of <code>false</code> from this function guarantees that the corresponding call on <a href="#func-doc"><code>fn:doc</code></a> will fail. Conversely, if the <code>stable</code> option is set to <code>false</code>, then the result of this function provides no guarantees regarding the outcome of a call on <a href="#func-doc"><code>fn:doc</code></a> with the same explicit and implicit arguments.</p></dd><dt class="label">Error Conditions</dt><dd><p>Like any other function, <a href="#func-doc-available"><code>doc-available</code></a> fails with an error if invalid arguments are supplied: for example if the first argument is not a string, or if unrecognized options are included in <code>$options</code>. However, it returns false rather than raising an error if the first argument is invalid as a URI.</p><p>The function also returns false (rather than raising an error) if the document is unavailable because of processor limitations, for example if schema validation is requested and the processor is not schema-aware.</p></dd></dl></div><div class="div3"><h4><a id="func-collection"></a>17.1.3 <a href="#func-collection" style="text-decoration: none">fn:collection</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns a sequence of items identified by a collection URI; or a default collection if no URI is supplied.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:collection</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on available collections, and executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>This function takes an <code>xs:string</code> as argument and returns a sequence of <span>items</span> obtained by interpreting <code>$source</code> as an <code>xs:anyURI</code> and resolving it according to the mapping specified in <b>available collections</b> described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>.</p><p>If <span><b>available collections</b></span> provides a mapping from this string to a sequence of items, the function returns that sequence. If <b>available collections</b> maps the string to the empty sequence, then the function returns an empty sequence.</p><p>If <code>$source</code> is not specified, the function returns the sequence of <span>items</span> in the default collection in the dynamic context. See <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>. </p><p>If <code>$source</code> is a relative URI reference, it is resolved relative to the value of the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> property from the dynamic context of the caller. The resulting absolute URI is promoted to an <code>xs:string</code>.</p><p>If <code>$source</code> is the empty sequence, the function behaves as if it had been called without an argument. See above.</p><p>By default, this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>. This means that repeated calls on the function with the same argument will return the same result. However, for performance reasons, implementations may provide a user option to evaluate the function without a guarantee of determinism. The manner in which any such option is provided is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the user has not selected such an option, a call to this function must either return a deterministic result or must raise a dynamic error [<a href="#ERRFODC0003" title="err:FODC0003">err:FODC0003</a>].</p><p>There is no requirement that <span>any nodes in the result</span> should be in document order, nor is there a requirement that the result should contain no duplicates.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>] if no URI is supplied and the value of the default collection is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>.</p><p>A dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>] if a relative URI reference is supplied, and the base-URI property in the static context is absent.</p><p>A dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>] if <b>available node collections</b> provides no mapping for the absolutized URI.</p><p>A dynamic error <span><span class="verb">may</span> be</span> raised [<a href="#ERRFODC0004" title="err:FODC0004">err:FODC0004</a>] if <code>$source</code> is not a valid <code>xs:anyURI</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>In earlier versions of this specification, the primary use for the <a href="#func-collection"><code>fn:collection</code></a> function was to retrieve a collection of XML documents, perhaps held as lexical XML in operating system filestore, or perhaps held in an XML database. In this release the concept has been generalised to allow other resources to be retrieved: for example JSON documents might be returned as arrays or maps, non-XML text files might be returned as strings, and binary files might be returned as instances of <code>xs:base64Binary</code>.</p><p>The abstract concept of a collection might be realized in different ways by different implementations, and the ways in which URIs map to collections can be equally variable. Specifying resources using URIs is useful because URIs are dynamic, can be parameterized, and do not rely on an external environment.</p></div></dd></dl></div><div class="div3"><h4><a id="func-uri-collection"></a>17.1.4 <a href="#func-uri-collection" style="text-decoration: none">fn:uri-collection</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns a sequence of <code>xs:anyURI</code> values representing the URIs in a URI collection.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:uri-collection</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyURI*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on available URI collections, and executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>The zero-argument form of the function returns the URIs in the <b>default URI collection</b> described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>.</p><p>If <code>$source</code> is a relative URI reference, it is resolved relative to the value of the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> property from the dynamic context of the caller. The resulting absolute URI is promoted to an <code>xs:string</code>.</p><p>If <code>$source</code> is the empty sequence, the function behaves as if it had been called without an argument. See above.</p><p>The single-argument form of the function returns the sequence of URIs corresponding to the supplied URI in the <b>available URI collections</b> described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>.</p><p>By default, this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>. This means that repeated calls on the function with the same argument will return the same result. However, for performance reasons, implementations may provide a user option to evaluate the function without a guarantee of determinism. The manner in which any such option is provided is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the user has not selected such an option, a call to this function must either return a deterministic result or must raise a dynamic error [<a href="#ERRFODC0003" title="err:FODC0003">err:FODC0003</a>].</p><p>There is no requirement that the URIs returned by this function should all be distinct, and no assumptions can be made about the order of URIs in the sequence, unless the implementation defines otherwise.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>] if no URI is supplied (that is, if the function is called with no arguments, or with a single argument that evaluates to the empty sequence), and the value of the default resource collection is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>.</p><p>A dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>] if a relative URI reference is supplied, and the base-URI property in the static context is absent.</p><p>A dynamic error is raised [<a href="#ERRFODC0002" title="err:FODC0002">err:FODC0002</a>] if <b>available resource collections</b> provides no mapping for the absolutized URI.</p><p>A dynamic error <span><span class="verb">may</span> be</span> raised [<a href="#ERRFODC0004" title="err:FODC0004">err:FODC0004</a>] if <code>$source</code> is not a valid <code>xs:anyURI</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>In some implementations, there might be a close relationship between <b>collections</b> (as retrieved by the <a href="#func-collection"><code>fn:collection</code></a> function), and <b>URI collections</b> (as retrieved by this function). For example, a collection might return XML documents, and the corresponding URI collection might return the URIs of those documents. However, this specification does not impose such a close relationship. For example, there may be collection URIs accepted by one of the two functions and not by the other; a collection might contain items that do not have any URI; or a URI collection might contain URIs that cannot be dereferenced to return any resource.</p><p>In the case where <a href="#func-uri-collection"><code>fn:uri-collection</code></a> returns the URIs of resources that could also be retrieved directly using <a href="#func-collection"><code>fn:collection</code></a>, there are several reasons why it might be appropriate to use this function in preference to the <a href="#func-collection"><code>fn:collection</code></a> function. For example:</p><ul><li><p>It allows different URIs for different kinds of resource to be dereferenced in different ways: for example, the returned URIs might be referenced using the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function rather than the <a href="#func-doc"><code>fn:doc</code></a> function.</p></li><li><p>In XSLT 3.0 it allows the documents in a collection to be processed in streaming mode using the <code>xsl:stream</code> instruction.</p></li><li><p>It allows recovery from failures to read, parse, or validate individual documents, by calling the <a href="#func-doc"><code>fn:doc</code></a> (or other dereferencing) function within the scope of try/catch.</p></li><li><p>It allows selection of which documents to read based on their URI, for example they can be filtered to select those whose URIs end in <code>.xml</code>, or those that use the <code>https</code> scheme.</p></li><li><p>An application might choose to limit the number of URIs processed in a single run, for example it might process only the first 50 URIs in the collection; or it might present the URIs to the user and allow the user to select which of them need to be further processed.</p></li><li><p>It allows the URIs to be modified before they are dereferenced, for example by adding or removing query parameters, or by redirecting the request to a local cache or to a mirror site.</p></li></ul><p>For some of these use cases, this assumes that the cost of calling <a href="#func-collection"><code>fn:collection</code></a> might be significant (for example, it might involving retrieving all the documents in the collection over the network and parsing them). This will not necessarily be true of all implementations.</p></div></dd></dl></div><div class="div3"><h4><a id="func-unparsed-text"></a>17.1.5 <a href="#func-unparsed-text" style="text-decoration: none">fn:unparsed-text</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-unparsed-text-lines">next</a> | <a href="#func-doc-available">previous</a>)</p><ol><li><p>The <code>$options</code> parameter has been added.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1116">1116</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1117">1117</a>&nbsp;21 May 2024]</i></p></li><li><p>It is no longer automatically an error if the resource (after decoding) contains a codepoint that is not valid in XML. Instead, the codepoint must be a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. The set of permitted characters is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but it is <span class="verb">recommended</span> that all Unicode characters should be accepted.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/414">414</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/546">546</a>&nbsp;25 July 2023]</i></p></li><li><p>The specification now describes in more detail how to determine the effective encoding value.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2221">2221</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2249">2249</a>&nbsp;21 October 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>The <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function reads an external resource (for example, a file) and returns a string representation of the resource.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:unparsed-text</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | map(*))?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>The <code>$source</code> argument <span class="verb">must</span> be a string in the form of a URI reference, which <span class="verb">must</span> contain no fragment identifier, and <span class="verb">must</span> identify a resource for which a string representation is available.</p><p>If <code>$source</code> is a relative URI reference, it is resolved relative to the value of the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> property from the dynamic context of the caller. The resulting absolute URI is promoted to an <code>xs:string</code>.</p><p>The <code>$options</code> argument, for backwards compatibility reasons, may be supplied either as a map, or as a string. Supplying a value <code>$S</code> that is not a map is equivalent to supplying the map <code>{ "encoding": $S }</code>. After that substitution, the <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>The entries that may appear in the <code>$options</code> map are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">encoding?</code></td><td><code class="as">as&nbsp;</code><code>xs:string?</code>,</td></tr><tr class="arg"><td><code class="opt">normalize-newlines?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>encoding?</code></p></td><td class="fos-thin" colspan="2">Defines the encoding of the resource, as described below. <ul><li><p><b>Type: </b><code>xs:string?</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td rowspan="3"><p><code>normalize-newlines?</code></p></td><td class="fos-thick" colspan="2">Determines whether CR and CRLF character sequences are treated as equivalent to NL characters. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td>No normalization of line endings takes place. </td></tr><tr><td class="fos-thick"><code>true</code></td><td>The character <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) and the character pair (<span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ) are converted to the single character <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) . </td></tr></tbody></table><p>The way in which an absolute URI is dereferenced to obtain an external resource is described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-security-resources">2.3 External Resources and Security</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div><p>If the <code>$source</code> argument is the empty sequence, the function returns the empty sequence.</p><p>The <code>encoding</code> option, if present <span> and non-empty</span>, is the name of an encoding. The values for this option follow the same rules as for the <code>encoding</code> attribute in an XML declaration. The values which an implementation is <span class="verb">required</span> to recognize are <code>UTF-8</code>, <code>UTF-16</code>, <code>UTF-16LE</code>, and <code>UTF-16BE</code> (in any upper/lower case combination).</p><p>The effective encoding is chosen as follows:</p><ol class="enumar"><li><p>external encoding information if available; otherwise</p></li><li><p>the encoding recognized as specified in <a href="#xml">[Extensible Markup Language (XML) 1.0 (Fifth Edition)]</a> if the media type of the resource is <code>text/xml</code> or <code>application/xml</code> (see <a href="#rfc2376">[RFC 2376]</a>), or if it matches the conventions <code>text/*+xml</code> or <code>application/*+xml</code> (see <a href="#rfc7303">[RFC 7303]</a> and/or its successors); otherwise</p></li><li><p>the value of the <code>encoding</code> option if present; otherwise</p></li><li><p>the encoding inferred from the initial octets of the resource, or from <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> heuristics as defined by the rules of the <a href="https://qt4cg.org/specifications/EXPath/binary-40/Overview.html#func-bin-infer-encoding"><code>bin:infer-encoding</code></a> function.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Encoding names are compared without regard to case.</p></div><p>If the input (as decoded using the effective encoding) starts with a byte order mark, then the byte order mark is not included in the result.</p><p>The result of the function is a string containing the string representation of the resource retrieved using the URI, decoded according to the effective encoding.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOUT1170" title="err:FOUT1170">err:FOUT1170</a>] if the <code>$source</code> argument contains a fragment identifier, <span>or if it cannot be resolved to an absolute URI (for example, because the base-URI property in the static context is absent), </span>or if it cannot be used to retrieve the string representation of a resource. </p><p>A dynamic error is raised [<a href="#ERRFOUT1190" title="err:FOUT1190">err:FOUT1190</a>] if the value of the <code>encoding</code> option is not a valid encoding name, if the processor does not support the specified encoding, if the string representation of the retrieved resource contains octets that cannot be decoded into Unicode <a title="character" class="termref" href="#character">characters</a> using the specified encoding, or if any resulting character is not a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>.</p><p>A dynamic error is raised [<a href="#ERRFOUT1200" title="err:FOUT1200">err:FOUT1200</a>] if the <code>encoding</code> option is absent and the processor cannot infer the encoding using external information and the actual encoding is not UTF-8.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If it is appropriate to use a base URI other than the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> (for example, when resolving a relative URI reference read from a source document) then it is advisable to resolve the relative URI reference using the <a href="#func-resolve-uri"><code>fn:resolve-uri</code></a> function before passing it to the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function.</p><p>There is no essential relationship between the sets of URIs accepted by the two functions <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> and <a href="#func-doc"><code>fn:doc</code></a> (a URI accepted by one may or may not be accepted by the other), and if a URI is accepted by both there is no essential relationship between the results (different resource representations are permitted by the architecture of the web).</p><p>There are no constraints on the MIME type of the resource.</p><p>The fact that the resolution of URIs is defined by a mapping in the dynamic context means that in effect, various aspects of the behavior of this function are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations may provide external configuration options that allow any aspect of the processing to be controlled by the user. In particular:</p><ul><li><p>The set of URI schemes that the implementation recognizes is implementation-defined. Implementations may allow the mapping of URIs to resources to be configured by the user, using mechanisms such as catalogs or user-written URI handlers.</p></li><li><p>The handling of media types is implementation-defined.</p></li><li><p>Implementations may provide user options that relax the requirement for the function to return deterministic results.</p></li><li><p>Implementations may provide user-defined error handling options that allow processing to continue following an error in retrieving a resource, or in reading its content. When errors have been handled in this way, the function may return a fallback document provided by the error handler.</p></li></ul><p>The rules for determining the encoding are chosen for consistency with <a href="#xinclude">[XML Inclusions (XInclude) Version 1.0 (Second Edition)]</a>. Files with an XML media type are treated specially because there are use cases for this function where the retrieved text is to be included as unparsed XML within a CDATA section of a containing document, and because processors are likely to be able to reuse the code that performs encoding detection for XML external entities.</p><p>If the text file contains characters such as <code>&lt;</code> and <code>&amp;</code>, these will typically be output as <code>&amp;lt;</code> and <code>&amp;amp;</code> if the string is serialized as XML or HTML. If these characters actually represent markup (for example, if the text file contains HTML), then an XSLT stylesheet can attempt to write them as markup to the output file using the <code>disable-output-escaping</code> attribute of the <code>xsl:value-of</code> instruction. Note, however, that XSLT implementations are not required to support this feature.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>This XSLT example attempts to read a file containing “boilerplate” HTML and copy it directly to the serialized output file:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;xsl:output method="html"/&gt;

&lt;xsl:template match="/"&gt;
  &lt;xsl:value-of select="unparsed-text('header.html', 'iso-8859-1')"
                disable-output-escaping="yes"/&gt;
  &lt;xsl:apply-templates/&gt;
  &lt;xsl:value-of select="unparsed-text('footer.html', 'iso-8859-1')"
                disable-output-escaping="yes"/&gt;
&lt;/xsl:template&gt;</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-unparsed-text-lines"></a>17.1.6 <a href="#func-unparsed-text-lines" style="text-decoration: none">fn:unparsed-text-lines</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-unparsed-text-available">next</a> | <a href="#func-unparsed-text">previous</a>)</p><ol><li><p>The <code>$options</code> parameter has been added.<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/1116">1116</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1278">1278</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/1117">1117</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1279">1279</a>&nbsp;21 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>The <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> function reads an external resource (for example, a file) and returns its contents as a sequence of strings, one for each line of text in the string representation of the resource.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:unparsed-text-lines</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | map(*))?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>The <code>unparsed-text-lines</code> function reads an external resource (for example, a file) and returns its string representation as a sequence of strings, separated at newline boundaries.</p><p>The <code>$options</code> argument, for backwards compatibility reasons, may be supplied either as a map, or as a string. Supplying a value <code>$S</code> that is not a map is equivalent to supplying the map <code>{ "encoding": $S }</code>. After that substitution, the <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>The entries that may appear in the <code>$options</code> map are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">encoding?</code></td><td><code class="as">as&nbsp;</code><code>xs:string?</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>encoding?</code></p></td><td class="fos-thin">Defines the encoding of the resource, following the rules of <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a>. <ul><li><p><b>Type: </b><code>xs:string?</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr></tbody></table><p>The result of the function is the same as the result of the expression:</p><div class="exampleInner"><pre xml:space="preserve" class="small">let $text := unparsed-text($source, map:put($options, 'normalize-newlines', true()))
let $lines := tokenize($text, '\n')
return $lines[not(position() = last() and . = '')]</pre></div><p>The result is thus a sequence of strings containing the text of the resource retrieved using the URI, each string representing one line of text. Lines may be delimited by any of the character sequences <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) , <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , or <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) followed by <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) . Line ending characters are not included in the returned strings. If there are two adjacent newline sequences, a zero-length string will be returned to represent the empty line; but if the external resource ends with a newline sequence, the result will be as if this final line ending were not present.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div></dd><dt class="label">Error Conditions</dt><dd><p>Error conditions are the same as for the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>See the notes for <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a>.</p></div></dd></dl></div><div class="div3"><h4><a id="func-unparsed-text-available"></a>17.1.7 <a href="#func-unparsed-text-available" style="text-decoration: none">fn:unparsed-text-available</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-unparsed-binary">next</a> | <a href="#func-unparsed-text-lines">previous</a>)</p><ol><li><p>The <code>$options</code> parameter has been added.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1116">1116</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1117">1117</a>&nbsp;21 May 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Allows an application to determine whether a call on <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> with particular arguments would succeed.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:unparsed-text-available</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | map(*))?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>The <a href="#func-unparsed-text-available"><code>fn:unparsed-text-available</code></a> function determines whether a call on the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function with identical arguments would return a string.</p><p>If the first argument is the empty sequence, the function returns <code>false</code>. </p><p>In other cases, the function returns <code>true</code> if a call on <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> or <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> with the same arguments would succeed, and <code>false</code> if a call on <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> or <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> with the same arguments would fail with a non-recoverable dynamic error.</p><p>The functions <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> and <a href="#func-unparsed-text-available"><code>fn:unparsed-text-available</code></a> have the same requirement for <a title="deterministic" class="termref" href="#dt-deterministic">determinism</a> as the functions <a href="#func-doc"><code>fn:doc</code></a> and <a href="#func-doc-available"><code>fn:doc-available</code></a>. This means that unless the user has explicitly stated a requirement for a reduced level of determinism, either of these functions if called twice with the same arguments during the course of a transformation <span class="verb">must</span> return the same results each time; moreover, the results of a call on <a href="#func-unparsed-text-available"><code>fn:unparsed-text-available</code></a><span class="verb">must</span> be consistent with the results of a subsequent call on <code>unparsed-text</code> with the same arguments.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div></dd><dt class="label">Notes</dt><dd><div class="note"><p>This function was introduced before XQuery and XSLT allowed errors to be caught; with current versions of these host languages, catching an error from <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> may provide a better alternative.</p><p>The specification requires that the <a href="#func-unparsed-text-available"><code>fn:unparsed-text-available</code></a> function should actually attempt to read the resource identified by the URI, and check that it is correctly encoded and contains no characters that are invalid in XML. Implementations may avoid the cost of repeating these checks for example by caching the validated contents of the resource, to anticipate a subsequent call on the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> or <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> function. Alternatively, implementations may be able to rewrite an expression such as <code>if (unparsed-text-available(A)) then unparsed-text(A) else ...</code> to generate a single call internally.</p><p>Since the function <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> succeeds or fails under exactly the same circumstances as <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a>, the <a href="#func-unparsed-text-available"><code>fn:unparsed-text-available</code></a> function may equally be used to test whether a call on <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> would succeed.</p></div></dd></dl></div><div class="div3"><h4><a id="func-unparsed-binary"></a>17.1.8 <a href="#func-unparsed-binary" style="text-decoration: none">fn:unparsed-binary</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-parse-xml">next</a> | <a href="#func-unparsed-text-available">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/557">557</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1587">1587</a>&nbsp;18 November 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>The <code>fn:unparsed-binary</code> function reads an external resource (for example, a file) and returns its contents in binary.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:unparsed-binary</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:base64Binary?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>The <code>$source</code> argument <span class="verb">must</span> be a string in the form of a URI reference, which <span class="verb">must</span> contain no fragment identifier, and <span class="verb">must</span> identify a resource for which a binary representation is available.</p><p>If <code>$source</code> is a relative URI reference, it is resolved relative to the value of the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> property from the dynamic context of the caller. The resulting absolute URI is promoted to an <code>xs:string</code>.</p><p>The mapping of URIs to the binary representation of a resource is the mapping defined in the <span class="markup-error">[TERMDEF dt-available-binary-resources IN XP40]</span> component of the dynamic context.</p><p>If the <code>$source</code> argument is the empty sequence, the function returns the empty sequence.</p><p>The result of the function is an atomic item of type <code>xs:base64Binary</code> containing the binary representation of the resource retrieved using the URI.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOUT1170" title="err:FOUT1170">err:FOUT1170</a>] if the <code>$source</code> argument contains a fragment identifier, <span>or if it cannot be resolved to an absolute URI (for example, because the base-URI property in the static context is absent), </span>or if it cannot be used to retrieve the binary representation of a resource. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If it is appropriate to use a base URI other than the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> (for example, when resolving a relative URI reference read from a source document) then it is advisable to resolve the relative URI reference using the <a href="#func-resolve-uri"><code>fn:resolve-uri</code></a> function before passing it to the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function.</p><p>There is no essential relationship between the sets of URIs accepted by the function <code>fn:unparsed-binary</code> and other functions such as <a href="#func-doc"><code>fn:doc</code></a> and <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> (a URI accepted by one may or may not be accepted by the others), and if a URI is accepted by more than one of these functions then there is no essential relationship between the results (different resource representations are permitted by the architecture of the web).</p><p>There are no constraints on the MIME type of the resource.</p><p>The fact that the resolution of URIs is defined by a mapping in the dynamic context means that in effect, various aspects of the behavior of this function are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations may provide external configuration options that allow any aspect of the processing to be controlled by the user. In particular:</p><ul><li><p>The set of URI schemes that the implementation recognizes is implementation-defined. Implementations may allow the mapping of URIs to resources to be configured by the user, using mechanisms such as catalogs or user-written URI handlers.</p></li><li><p>The handling of media types is implementation-defined.</p></li><li><p>Implementations may provide user options that relax the requirement for the function to return deterministic results.</p></li><li><p>Implementations may provide user-defined error handling options that allow processing to continue following an error in retrieving a resource, or in reading its content. When errors have been handled in this way, the function may return a fallback document provided by the error handler.</p></li></ul><p>There is no function (analogous to <a href="#func-doc-available"><code>fn:doc-available</code></a> or <a href="#func-unparsed-text-available"><code>fn:unparsed-text-available</code></a>) to determine whether a suitable resource is available. In XQuery and XSLT, try/catch constructs are available to catch the error.</p><p>The choice of <code>xs:base64Binary</code> rather than <code>xs:hexBinary</code> for the result is arbitrary. The two types have the same value space and are interchangeable for nearly all purposes, the notable exception being conversion to <code>xs:string</code>.</p><p>A comprehensive set of functions for manipulating binary data is available in the EXPath binary module: see <a href="#expath">[EXPath]</a>. In addition, the EXPath file module provides a function <code>file:read-binary</code> with similar functionality to <code>fn:unparsed-binary</code>, the notable differences being (a) that it takes a file name rather than a URI, and (b) that it is defined to be nondeterministic. </p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The following XQuery, adapted from an example in the EXPath binary module <a href="#expath">[EXPath]</a>, reads a JPEG image and determines its size in pixels:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">declare namespace bin = "http://expath.org/ns/binary";
let $content := fn:unparsed-binary("image.jpeg")
let $int16-at := bin:unpack-unsigned-integer(
                    $content, ?, 2, 'most-significant-first')
let $loc := bin:find($content, 0, bin:hex('FFC0'))
return { "width": $int16-at($loc + 5),
         "height": $int16-at($loc + 7) }</pre></div></td></tr><tr><td colspan="2"><p>The example assumes that the functions in the EXPath binary module are available.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-environment-variable"></a>17.1.9 <a href="#func-environment-variable" style="text-decoration: none">fn:environment-variable</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns the value of a system environment variable, if it exists.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:environment-variable</code>(</td></tr><tr class="arg"><td><code>$name</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on environment variables. </p></dd><dt class="label">Rules</dt><dd><p>The set of available <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-environment-variables">environment variables</a><sup><small>XP</small></sup> is a set of (name, value) pairs forming part of the dynamic context, in which the name is unique within the set of pairs. The name and value are arbitrary strings.</p><p>If the <code>$name</code> argument matches the name of one of these pairs, the function returns the corresponding value.</p><p>If there is no environment variable with a matching name, the function returns the empty sequence.</p><p>The collation used for matching names is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but must be the same as the collation used to ensure that the names of all environment variables are unique.</p><p>The function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, which means that if it is called several times within the same <a title="execution scope" class="termref" href="#execution-scope">execution scope</a>, with the same arguments, it must return the same result.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>On many platforms, the term “environment variable” has a natural meaning in terms of facilities provided by the operating system. This interpretation of the concept does not exclude other interpretations, such as a mapping to a set of configuration parameters in a database system.</p><p>Environment variable names are usually case sensitive. Names are usually of the form <code>(letter|_) (letter|_|digit)*</code>, but this varies by platform.</p><p>On some platforms, there may sometimes be multiple environment variables with the same name; in this case, it is implementation-dependent as to which is returned; see for example <a href="#POSIX.1-2008">[POSIX.1-2008]</a> (Chapter 8, Environment Variables). Implementations <span class="verb">may</span> use prefixes or other naming conventions to disambiguate the names.</p><p>The requirement to ensure that the function is deterministic means in practice that the implementation must make a snapshot of the environment variables at some time during execution, and return values obtained from this snapshot, rather than using live values that are subject to change at any time.</p><p>Operating system environment variables may be associated with a particular process, while queries and stylesheets may execute across multiple processes (or multiple machines). In such circumstances implementations <span class="verb">may</span> choose to provide access to the environment variables associated with the process in which the query or stylesheet processing was initiated.</p><p>Security advice: <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-untrusted">Untrusted</a><sup><small>XP</small></sup> applications should not be permitted unrestricted access to environment variables. For example, the name of the account under which a query is running may be useful information to a would-be intruder. An implementation may therefore choose to restrict access to the environment, or may provide a facility to make <a href="#func-environment-variable"><code>fn:environment-variable</code></a> always return the empty sequence.</p></div></dd></dl></div><div class="div3"><h4><a id="func-available-environment-variables"></a>17.1.10 <a href="#func-available-environment-variables" style="text-decoration: none">fn:available-environment-variables</a></h4><dl><dt class="label">Summary</dt><dd><p>Returns a list of environment variable names that are suitable for passing to <a href="#func-environment-variable"><code>fn:environment-variable</code></a>, as a (possibly empty) sequence of strings.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:available-environment-variables</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:string*</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on environment variables. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a sequence of strings, being the names of the environment variables in the dynamic context in some <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> order.</p><p>The function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>: that is, the set of available environment variables does not vary during evaluation.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function returns a list of strings, containing no duplicates.</p><p>It is intended that the strings in this list should be suitable for passing to <a href="#func-environment-variable"><code>fn:environment-variable</code></a>.</p><p>See also the note on security under the definition of the <a href="#func-environment-variable"><code>fn:environment-variable</code></a> function. If access to environment variables has been disabled, <a href="#func-available-environment-variables"><code>fn:available-environment-variables</code></a> always returns the empty sequence.</p></div></dd></dl></div></div><div class="div2"><h3><a id="xml-functions"></a>17.2 <a href="#xml-functions" style="text-decoration: none">Functions on XML Data</a></h3><p>These functions convert between the lexical representation of XML and the tree representation.</p><p>(The <a href="#func-serialize"><code>fn:serialize</code></a> function also handles HTML and JSON output, but is included in this section for editorial convenience.)</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parse-xml"><code>fn:parse-xml</code></a></td><td>This function takes as input an XML document, and returns the document node at the root of an XDM tree representing the parsed document.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parse-xml-fragment"><code>fn:parse-xml-fragment</code></a></td><td>This function takes as input an XML external entity represented as a string, and returns the document node at the root of an XDM tree representing the parsed document fragment.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-serialize"><code>fn:serialize</code></a></td><td>This function serializes the supplied input sequence <code>$input</code> as described in <a href="#xslt-xquery-serialization-31">[XSLT and XQuery Serialization 3.1]</a>, returning the serialized representation of the sequence as a string.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-xsd-validator"><code>fn:xsd-validator</code></a></td><td>Given an XSD schema, delivers a function item that can be invoked to validate a document, element, or attribute node against this schema.</td></tr></tbody></table><div class="div3"><h4><a id="func-parse-xml"></a>17.2.1 <a href="#func-parse-xml" style="text-decoration: none">fn:parse-xml</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-parse-xml-fragment">next</a> | <a href="#func-unparsed-binary">previous</a>)</p><ol><li><p>The <code>$options</code> parameter has been added.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/305">305</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1257">1257</a>&nbsp;11 June 2024]</i></p></li><li><p>Additional error conditions have been defined.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1287">1287</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1288">1288</a>&nbsp;25 June 2024]</i></p></li><li><p>Additional options to control DTD and XInclude processing have been added.<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/1857">1857</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1860">1860</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1879">1879</a>&nbsp;18 March 2025]</i></p></li><li><p>Support for binary input has been added.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/748">748</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2013">2013</a>&nbsp;20 May 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>This function takes as input an XML document, and returns the document node at the root of an XDM tree representing the parsed document.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parse-xml</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | xs:hexBinary | xs:base64Binary)?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>document-node(*)?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>In other cases, <code>$value</code> is expected to contain an XML document supplied either as a string or a binary value. If it is supplied as a binary value, an optional byte order mark or XML declaration may contain the input encoding, and the input will be processed like a resource retrieved by the <a href="#func-doc"><code>fn:doc</code></a> function. Otherwise, if the input is a string, any byte order mark as well as the encoding specified in an optional XML declaration <span class="verb">should</span> be ignored.</p><p>The <code>$options</code> argument, if present and non-empty, defines the detailed behavior of the function. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply. The options available are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">base-uri?</code></td><td><code class="as">as&nbsp;</code><code>xs:anyURI</code>,</td></tr><tr class="arg"><td><code class="opt">dtd-validation?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">strip-space?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">trusted?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">xinclude?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">xsd-validation?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">use-xsi-schema-location?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>base-uri?</code></p></td><td class="fos-thin" colspan="2">Determines the base URI. This is used both as the base URI used by the XML parser to resolve relative entity references within the document, and as the base URI of the document node that is returned. It defaults to the static base URI of the function call. <ul><li><p><b>Type: </b><code>xs:anyURI</code></p></li><li><p><b>Default: </b><code>static-base-uri()</code></p></li></ul></td></tr><tr><td rowspan="3"><p><code>dtd-validation?</code></p></td><td class="fos-thick" colspan="2">Determines whether DTD validation takes place. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>The input is parsed using a validating XML parser. The input must contain a <code>DOCTYPE</code> declaration to identify the DTD to be used for validation. The DTD may be internal or external. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>DTD validation does not take place. However, if a <code>DOCTYPE</code> declaration is present, then it is read, for example to perform entity expansion. </td></tr><tr><td rowspan="3"><p><code>strip-space?</code></p></td><td class="fos-thick" colspan="2">Determines whether whitespace-only text nodes are removed from the resulting document. (Note: in XSLT, the <code>xsl:strip-space</code> and <code>xsl:preserve-space</code> declarations are ignored.) <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>All whitespace-only text nodes are stripped, unless either (a) they are within the scope of the attribute <code>xml:space="preserve"</code>, or (b) XSD validation identifies that the parent element has a simple type or a complex type with simple content. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>All whitespace-only text nodes are preserved, unless either (a) DTD validation marks them as ignorable, or (b) XSD validation recognizes the containing element as having element-only or empty content. </td></tr><tr><td rowspan="3"><p><code>trusted?</code></p></td><td class="fos-thick" colspan="2">Indicates whether processing the supplied document may cause external resources to be fetched (including, for example, external entities, an external DTD, or documents referenced using <code>xsi:schemaLocation</code> or XInclude elements). <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false()</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>The document may include references to external resources. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>The document must not include references to external resources unless access to these resources has been explicitly enabled. </td></tr><tr><td rowspan="3"><p><code>xinclude?</code></p></td><td class="fos-thick" colspan="2">Determines whether any <code>xi:include</code> elements in the input are to be processed using an XInclude processor. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>Any <code>xi:include</code> elements are expanded. If there are <code>xi:include</code> elements and no XInclude processor is available then a dynamic error is raised. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>Any <code>xi:include</code> elements are handled as ordinary elements without expansion. </td></tr><tr><td rowspan="5"><p><code>xsd-validation?</code></p></td><td class="fos-thick" colspan="2">Determines whether XSD validation takes place, using the schema definitions present in the static context. The effect of requesting validation is the same as invoking the <a href="#func-parse-xml"><code>parse-xml</code></a> function without validation, and then applying an XQuery <code>validate</code> expression to the result, with corresponding options. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>"skip"</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>strict</code></td><td>Strict XSD validation takes place</td></tr><tr><td class="fos-thin"><code>lax</code></td><td>Lax XSD validation takes place</td></tr><tr><td class="fos-thin"><code>skip</code></td><td>No XSD validation takes place</td></tr><tr><td class="fos-thick"><code>type Q{uri}local</code></td><td>XSD validation takes place against the schema-defined type, present in the static context, that has the given URI and local name.</td></tr><tr><td rowspan="3"><p><code>use-xsi-schema-location?</code></p></td><td class="fos-thick" colspan="2">When XSD validation takes place, determines whether schema components referenced using <code>xsi:schemaLocation</code> or <code>xsi:noNamespaceSchemaLocation</code> attributes within the source document are to be used. The option is ignored if XSD validation does not take place. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>XSD validation uses the schema components referenced using <code>xsi:schemaLocation</code> or <code>xsi:noNamespaceSchemaLocation</code> attributes in addition to the schema components present in the static context; these components must be compatible as described in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#schema-consistency">4.1.2 Schema Consistency</a>.</td></tr><tr><td class="fos-thick"><code>false</code></td><td>Any <code>xsi:schemaLocation</code> and <code>xsi:noNamespaceSchemaLocation</code> attributes in the document are ignored.</td></tr></tbody></table><p>Except to the extent defined by these options, the precise process used to construct the XDM instance is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. In particular, it is implementation-defined whether an XML 1.0 or XML 1.1 parser is used.</p><p>The document URI of the returned node is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>.</p><p>The function is <em>not</em><a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>: that is, if the function is called twice with the same arguments, it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether the same node is returned on both occasions.</p><p>Options set in <code>$options</code> may be supplemented or modified based on configuration options defined externally using <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> mechanisms.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODC0006" title="err:FODC0006">err:FODC0006</a>] if the content of <code>$value</code> is not a well-formed and namespace-well-formed XML document.</p><p>A dynamic error is raised [<a href="#ERRFODC0007" title="err:FODC0007">err:FODC0007</a>] if DTD validation is carried out and the content of <code>$value</code> is not valid against the relevant DTD.</p><p>A dynamic error is raised [<a href="#ERRFODC0008" title="err:FODC0008">err:FODC0008</a>] if the value of the <code>xsd-validation</code> option is not one of the permitted values (for example, if the string that follows <code>"type"</code> is not a valid <code>EQName</code>, or if it does not identify a type that is present in the static context).</p><p>A dynamic error is raised [<a href="#ERRFODC0009" title="err:FODC0009">err:FODC0009</a>] if the value of the <code>xsd-validation</code> option is set to anything other than <code>skip</code> when the processor is not schema-aware. (XSLT 4.0 and XQuery 4.0 define schema-awareness as an optional feature; other host languages may set their own rules.)</p><p>A dynamic error is raised [<a href="#ERRFODC0013" title="err:FODC0013">err:FODC0013</a>] if processor does not have access to an XML parser supporting the requested options, for example the ability to perform DTD validation or XInclude processing or to prevent access to external entities.</p><p>A dynamic error is raised [<a href="#ERRFODC0014" title="err:FODC0014">err:FODC0014</a>] if XSD validation is carried out and the content of <code>$value</code> is not valid against the relevant XSD schema.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Since the XML document is presented to the parser as a string, rather than as a sequence of octets, the encoding specified within the XML declaration has no meaning. If the XML parser accepts input only in the form of a sequence of octets, then the processor must ensure that the string is encoded as octets in a way that is consistent with rules used by the XML parser to detect the encoding.</p><p>A common use case for this function is to handle input documents that contain nested XML documents embedded within CDATA sections. Since the content of the CDATA section is exposed as text, the receiving query or stylesheet may pass this text to the <a href="#func-parse-xml"><code>fn:parse-xml</code></a> function to create a tree representation of the nested document.</p><p>Similarly, nested XML within comments is sometimes encountered, and lexical XML is sometimes returned by extension functions, for example, functions that access web services or read from databases.</p><p>A use case arises in XSLT where there is a need to preprocess an input document before parsing. For example, an application might wish to edit the document to remove its DOCTYPE declaration. This can be done by reading the raw text using the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function, editing the resulting string, and then passing it to the <a href="#func-parse-xml"><code>fn:parse-xml</code></a> function.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The expression <code>fn:parse-xml("&lt;alpha&gt;abcd&lt;/alpha&gt;")</code> returns a newly created document node, having an <code>alpha</code> element as its only child; the <code>alpha</code> element in turn is the parent of a text node whose string value is <code>"abcd"</code>.</p></td></tr><tr><td colspan="2"><p>The expression <code>fn:parse-xml("&lt;alpha&gt;&lt;beta&gt; &lt;/beta&gt;&lt;/alpha&gt;", { "strip-space": true() })</code> returns a newly created document node, having an <code>alpha</code> element as its only child; the <code>alpha</code> element in turn is the parent of a <code>beta</code> element whose content is empty, as a result of whitespace stripping.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-parse-xml-fragment"></a>17.2.2 <a href="#func-parse-xml-fragment" style="text-decoration: none">fn:parse-xml-fragment</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-serialize">next</a> | <a href="#func-parse-xml">previous</a>)</p><ol><li><p>The <code>$options</code> parameter has been added.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/305">305</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1257">1257</a>&nbsp;11 June 2024]</i></p></li><li><p>Support for binary input has been added.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/748">748</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2013">2013</a>&nbsp;20 May 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>This function takes as input an XML external entity represented as a string, and returns the document node at the root of an XDM tree representing the parsed document fragment.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parse-xml-fragment</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | xs:hexBinary | xs:base64Binary)?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>document-node()?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>If the input is supplied as a binary value, the function detects the encoding using the same rules as the <a href="#func-unparsed-text"><code>unparsed-text</code></a> function, except that the special handling of media types such as <code>text/xml</code> and <code>application/xml</code> may be skipped. Otherwise, if the input is a string, any byte order mark as well as the encoding specified in an optional XML declaration <span class="verb">should</span> be ignored.</p><p>The input must be a namespace-well-formed external general parsed entity. More specifically, it must conform to the production rule <a href="https://www.w3.org/TR/REC-xml/#NT-extParsedEnt">extParsedEnt</a><sup><small>XML</small></sup> in <a href="#xml">[Extensible Markup Language (XML) 1.0 (Fifth Edition)]</a>, it must contain no entity references other than references to predefined entities, and it must satisfy all the rules of <a href="#xml-names">[Namespaces in XML]</a> for namespace-well-formed documents with the exception that the rule requiring it to be a well-formed document is replaced by the rule requiring it to be a well-formed external general parsed entity.</p><p>The input is parsed to form a sequence of nodes which become children of the new document node, in the same way as the content of any element is converted into a sequence of children for the resulting element node.</p><p>The <code>$options</code> argument, if present and non-empty, defines the detailed behavior of the function. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply. The options available are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">base-uri?</code></td><td><code class="as">as&nbsp;</code><code>xs:anyURI</code>,</td></tr><tr class="arg"><td><code class="opt">strip-space?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>base-uri?</code></p></td><td class="fos-thin" colspan="2">Determines the base URI. This is used as the base URI of the document node that is returned. It defaults to the static base URI of the function call. <ul><li><p><b>Type: </b><code>xs:anyURI</code></p></li><li><p><b>Default: </b><code>static-base-uri()</code></p></li></ul></td></tr><tr><td rowspan="3"><p><code>strip-space?</code></p></td><td class="fos-thick" colspan="2">Determines whether whitespace-only text nodes are removed from the resulting document. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>All whitespace-only text nodes are stripped, unless they are within the scope of the attribute <code>xml:space="preserve"</code>. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>All whitespace-only text nodes are preserved. </td></tr></tbody></table><p>DTD validation is <em>not</em> invoked (an external general parsed entity cannot contain a <code>DOCTYPE</code> declaration.</p><p>Schema validation is <em>not</em> invoked, which means that the nodes in the returned document will all be untyped.</p><p>XInclude processing is <em>not</em> invoked.</p><p>Except as explicitly defined, the precise process used to construct the XDM instance is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. In particular, it is implementation-defined whether an XML 1.0 or XML 1.1 parser is used.</p><p>The document URI of the returned node is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>.</p><p>The function is <em>not</em><a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>: that is, if the function is called twice with the same arguments, it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether the same node is returned on both occasions.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODC0006" title="err:FODC0006">err:FODC0006</a>] if the content of <code>$value</code> is not a well-formed external general parsed entity, if it contains entity references other than references to predefined entities, or if a document that incorporates this well-formed parsed entity would not be namespace-well-formed.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>See also the notes for the <a href="#func-parse-xml"><code>fn:parse-xml</code></a> function.</p><p>The main differences between <a href="#func-parse-xml"><code>fn:parse-xml</code></a> and <a href="#func-parse-xml-fragment"><code>fn:parse-xml-fragment</code></a> are that for <a href="#func-parse-xml"><code>fn:parse-xml</code></a>, the children of the resulting document node must contain exactly one element node and no text nodes, wheras for <a href="#func-parse-xml-fragment"><code>fn:parse-xml-fragment</code></a>, the resulting document node can have any number (including zero) of element and text nodes among its children. An additional difference is that the <em>text declaration</em> at the start of an external entity has slightly different syntax from the <em>XML declaration</em> at the start of a well-formed document.</p><p>Note that all whitespace outside the <em>text declaration</em> is significant, including whitespace that precedes the first element node, unless the <code>strip-space</code> option is set.</p><p>One use case for this function is to handle XML fragments stored in databases, which frequently allow zero-or-more top level element nodes. Another use case is to parse the contents of a <code>CDATA</code> section embedded within another XML document.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The expression <code>parse-xml-fragment("&lt;alpha&gt;abcd&lt;/alpha&gt;&lt;beta&gt;abcd&lt;/beta&gt;")</code> returns a newly created document node, having two elements named <code>alpha</code> and <code>beta</code> as its children; each of these elements in turn is the parent of a text node.</p></td></tr><tr><td colspan="2"><p>The expression <code>parse-xml-fragment("He was &lt;i&gt;so&lt;/i&gt; kind")</code> returns a newly created document node having three children: a text node whose string value is <code>"He was "</code>, an element node named <code>i</code> having a child text node with string value <code>"so"</code>, and a text node whose string value is <code>" kind"</code>.</p></td></tr><tr><td colspan="2"><p>The expression <code>parse-xml-fragment("")</code> returns a document node having no children.</p></td></tr><tr><td colspan="2"><p>The expression <code>parse-xml-fragment(" ")</code> returns a document node whose children comprise a single text node whose string value is a single space.</p></td></tr><tr><td colspan="2"><p>The expression <code>parse-xml-fragment(" ", { "strip-space": true() })</code> returns a document node having no children.</p></td></tr><tr><td colspan="2"><p>The expression <code>parse-xml-fragment('&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;&lt;a/&gt;')</code> results in a dynamic error [<a href="#ERRFODC0006" title="err:FODC0006">err:FODC0006</a>] because the <code>standalone</code> keyword is not permitted in the text declaration that appears at the start of an external general parsed entity. (Thus, it is not the case that any input accepted by the <a href="#func-parse-xml"><code>fn:parse-xml</code></a> function will also be accepted by <a href="#func-parse-xml-fragment"><code>fn:parse-xml-fragment</code></a>.)</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-serialize"></a>17.2.3 <a href="#func-serialize" style="text-decoration: none">fn:serialize</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#xsd-validation">next</a> | <a href="#func-parse-xml-fragment">previous</a>)</p><ol><li><p>A new parameter <code>canonical</code> is available to give control over serialization of XML, XHTML, and JSON.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/938">938</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2259">2259</a>&nbsp;3 November 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>This function serializes the supplied input sequence <code>$input</code> as described in <a href="#xslt-xquery-serialization-31">[XSLT and XQuery Serialization 3.1]</a>, returning the serialized representation of the sequence as a string.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:serialize</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(element(output:serialization-parameters) | map(*))?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The value of the first argument <code>$input</code> acts as the input sequence to the serialization process, which starts with sequence normalization.</p><p>The second argument <code>$options</code>, if present, provides serialization parameters. These may be supplied in either of two forms:</p><ol class="enumar"><li><p>As an <code>output:serialization-parameters</code> element, having the format described in <a href="https://www.w3.org/TR/xslt-xquery-serialization-31/#serparams-in-xdm-instance"> 3.1 Setting Serialization Parameters by Means of a Data Model Instance </a><sup><small>SER31</small></sup>. In this case the type of the supplied argument must match the required type <code>element(output:serialization-parameters)</code>.</p></li><li><p>As a map. In this case the type of the supplied argument must match the required type <code>map(*)</code></p></li></ol><p>The single-argument version of this function has the same effect as the two-argument version called with <code>$options</code> set to the empty sequence. This in turn is the same as the effect of passing an <code>output:serialization-parameters</code> element with no child elements.</p><p>The final stage of serialization, that is, encoding, is skipped. If the serializer does not allow this phase to be skipped, then the sequence of octets returned by the serializer is decoded into a string by reversing the character encoding performed in the final stage.</p><p>If the second argument is omitted, or is supplied in the form of an <code>output:serialization-parameters</code> element, then the values of any serialization parameters that are not explicitly specified is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, and may depend on the context.</p><p>If the second argument is supplied as a map, then the <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply. In this case:</p><ol class="enumar"><li><p>Each entry in the map defines one serialization parameter.</p></li><li><p>The key of the entry is an <code>xs:string</code> value in the cases of parameter names defined in these specifications, or an <code>xs:QName</code> (with non-absent namespace) in the case of implementation-defined serialization parameters.</p></li><li><p>The required type of each parameter, and its default value, are defined by the following table. The default value is used when the map contains no entry for the parameter in question, and also when an entry is present, with the empty sequence as its value. The table also indicates how the value of the map entry is to be interpreted in cases where further explanation is needed.</p></li></ol><table class="no-code-break data"><thead><tr><th>Parameter</th><th>Required type</th><th>Interpretation</th><th>Default Value</th></tr></thead><tbody><tr><td><code>allow-duplicate-names</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code></td><td><code>no</code></td></tr><tr><td><code>byte-order-mark</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code></td><td><code>no</code></td></tr><tr><td><code>canonical</code></td><td><code>xs:boolean?</code></td><td><code>true()</code> means <code>"yes"</code>, <code>false()</code> means <code>"no"</code></td><td><code>no</code></td></tr><tr><td><code>cdata-section-elements</code></td><td><code>xs:QName*</code></td><td></td><td><code>()</code></td></tr><tr><td><code>doctype-public</code></td><td><code>xs:string?</code></td><td>Zero-length string and <code>()</code> both represent <code>"absent"</code></td><td>absent</td></tr><tr><td><code>doctype-system</code></td><td><code>xs:string?</code></td><td>Zero-length string and <code>()</code> both represent <code>"absent"</code></td><td>absent</td></tr><tr><td><code>encoding</code></td><td><code>xs:string?</code></td><td></td><td><code>UTF-8</code></td></tr><tr><td><code>escape-solidus</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code></td><td><code>yes</code></td></tr><tr><td><code>escape-uri-attributes</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code></td><td><code>yes</code></td></tr><tr><td><code>html-version</code></td><td><code>xs:decimal?</code></td><td></td><td><code>5</code></td></tr><tr><td><code>include-content-type</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code></td><td><code>yes</code></td></tr><tr><td><code>indent</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code></td><td><code>no</code></td></tr><tr><td><code>item-delimiter</code></td><td><code>xs:string?</code></td><td></td><td>absent</td></tr><tr><td><code>json-lines</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code></td><td><code>no</code></td></tr><tr><td><code>json-node-output-method</code></td><td><code>(xs:string | xs:QName)?</code></td><td>See Notes 1, 2</td><td><code>xml</code></td></tr><tr><td><code>media-type</code></td><td><code>xs:string?</code></td><td></td><td>(a media type suitable for the chosen <code>method</code>)</td></tr><tr><td><code>method</code></td><td><code>(xs:string | xs:QName)?</code></td><td>See Notes 1, 2</td><td><code>xml</code></td></tr><tr><td><code>normalization-form</code></td><td><code>xs:string?</code></td><td></td><td><code>none</code></td></tr><tr><td><code>omit-xml-declaration</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code></td><td><code>yes</code></td></tr><tr><td><code>standalone</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code>, <code>()</code> means <code>"omit"</code></td><td><code>omit</code></td></tr><tr><td><code>suppress-indentation</code></td><td><code>xs:QName*</code></td><td></td><td><code>()</code></td></tr><tr><td><code>undeclare-prefixes</code></td><td><code>xs:boolean?</code></td><td><code>true</code> means <code>"yes"</code>, <code>false</code> means <code>"no"</code></td><td><code>no</code></td></tr><tr><td><code>use-character-maps</code></td><td><code>map(xs:string, xs:string)?</code></td><td>See Note 3</td><td><code>{}</code></td></tr><tr><td><code>version</code></td><td><code>xs:string?</code></td><td></td><td><code>1.0</code></td></tr></tbody></table><p>Notes to the table:</p><ol class="enumar"><li><p>The notation <code>(A | B)</code> represents a union type whose member types are <code>A</code> and <code>B</code>.</p></li><li><p>If an <code>xs:QName</code> is supplied <span>for the <code>method</code> or <code>json-node-output-method</code> options,</span> then it must have a non-absent namespace URI. This means that system-defined serialization methods such as <code>xml</code> and <code>json</code> are defined as strings, not as <code>xs:QName</code> values.</p></li><li><p><span>For the <code>use-character-maps</code> option</span>, the value is a map, whose keys are the characters to be mapped (as <code>xs:string</code> instances), and whose corresponding values are the strings to be substituted for these characters. </p></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>A type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> occurs if the <code>$options</code> argument is present and does not match either of the types <code>element(output:serialization-parameters)?</code> or <code>map(*)</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>This is defined as a type error so that it can be enforced via the function signature by implementations that generalize the type system in a suitable way.</p></div><p>If the host language makes serialization an optional feature and the implementation does not support serialization, then a dynamic error [<a href="#ERRFODC0010" title="err:FODC0010">err:FODC0010</a>] is raised.</p><p>When the second argument is supplied as a map, and the supplied value is of the wrong type for the particular parameter, for example if the value of <code>indent</code> is a string rather than a boolean, then as defined by the <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a>, a type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> is raised. If the value is of the correct type, but does not satisfy the rules for that parameter defined in <a href="#xslt-xquery-serialization-31">[XSLT and XQuery Serialization 3.1]</a>, then a dynamic error [<a href="https://www.w3.org/TR/xslt-xquery-serialization-31/#ERRSEPM0016" title="err:SEPM0016">err:SEPM0016</a>]<sup><small>SER31</small></sup> is raised. (For example, this occurs if the map supplied to <code>use-character-maps</code> includes a key that is a string whose length is not one (1)).</p><p>If any serialization error occurs, including the detection of an invalid value for a serialization parameter as described above, this results in the <a href="#func-serialize"><code>fn:serialize</code></a> call failing with a dynamic error.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>One use case for this function arises when there is a need to construct an XML document containing nested XML documents within a CDATA section (or on occasions within a comment). See <a href="#func-parse-xml"><code>fn:parse-xml</code></a> for further details.</p><p>Another use case arises when there is a need to call an extension function that expects a lexical XML document as input.</p><p>Another use case for this function is serializing instances of the data model into a human readable format for the purposes of debugging. Using the <a href="https://www.w3.org/TR/xslt-xquery-serialization-31/#adaptive-output"> 10 Adaptive Output Method </a><sup><small>SER31</small></sup> by specifying it as the output method defined in the second argument via <code>output:serialization-parameters</code>, allows for serializing any valid XDM instance without raising a serialization error.</p><p>There are also use cases where the application wants to post-process the output of a query or transformation, for example by adding an internal DTD subset, or by inserting proprietary markup delimiters such as the <code>&lt;% ... %&gt;</code> used by some templating languages.</p><p>The ability to specify the serialization parameters in an <code>output:serialization-parameters</code> element provides backwards compatibility with the 3.0 version of this specification; the ability to use a map takes advantage of new features in the 3.1 version. The default parameter values are implementation-defined when an <code>output:serialization-parameters</code> element is used (or when the argument is omitted), but are fixed by this specification in the case where a map (including the empty map) is supplied for the argument.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $params := &lt;output:serialization-parameters 
    xmlns:output="http://www.w3.org/2010/xslt-xquery-serialization"&gt;
  &lt;output:omit-xml-declaration value="yes"/&gt;
&lt;/output:serialization-parameters&gt;</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $data := &lt;a b="3"/&gt;</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr><td colspan="2"><p>Given the variables:</p></td></tr><tr><td colspan="2"><p>The following call might produce the output shown:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>serialize($data, $params)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>'&lt;a b="3"/&gt;'</code></p></td></tr><tr><td colspan="2"><p>The following call would also produce the output shown (though the second argument could equally well be supplied as the empty map (<code>{}</code>), since both parameters are given their default values):</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">serialize(
  $data,
  { "method": "xml", "omit-xml-declaration": true() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'&lt;a b="3"/&gt;'</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>serialize({ "a": "AB", "b": "BC" }, { "method": "adaptive" })</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>'{"a":"AB","b":"BC"}'</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">serialize(
  array { "a", 3, attribute test { "true" } },
  { "method": "adaptive" 
})</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">'["a",3,test="true"]'</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="xsd-validation"></a>17.2.4 <a href="#xsd-validation" style="text-decoration: none">XSD validation</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-xsd-validator">next</a> | <a href="#func-serialize">previous</a>)</p><ol><li><p> This description of the XSD validation process was previously found (with some duplication) in the XQuery and XSLT specifications; those specifications now reference this description. As a side-effects, the descriptions of the process in XQuery and XSLT are better aligned. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/2029">2029</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2030">2030</a>&nbsp;28 May 2025]</i></p></li></ol></div><p>This section describes a process called <b>XSD validation</b>, which validates a supplied node against a supplied XSD schema. The validation process refers to the process defined in <a href="#xmlschema-1">[XML Schema Part 1: Structures Second Edition]</a> or <a href="#xmlschema11-1">[XSD 1.1 Part 1]</a>.</p><p>The validation process takes the following inputs:</p><ul><li><p>A schema to be used for validation, called the <b>effective schema</b>.</p></li><li><p>A boolean indicating whether any <code>xsi:schemaLocation</code> or <code>xsi:noNamespaceSchemaLocation</code> attributes are to be taken into consideration.</p></li><li><p>A document, element, or attribute node to be validated; this is called the <b>operand node</b>.</p></li><li><p>A validation mode, which is one of <code>strict</code><code>lax</code>, or <code>by-type</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>XSLT also allows the value <code>strip</code>, but this does not invoke validation (instead, it invokes stripping of existing type annotations, and re-annotation of nodes as <code>xs:untyped</code>.)</p></div></li><li><p>If the validation mode is <code>by-type</code>, then a schema type to be used for validating the operand node. This may be any simple or complex type present in the effective schema: it must not be <code>xs:untyped</code> or <code>xs:untypedAtomic</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>An XQuery <code>ValidateExpr</code> allows the type to be specified as <code>xs:untyped</code> or <code>xs:untypedAtomic</code>, but this does not invoke validation (instead, it invokes stripping of existing type annotations and re-annotation of nodes as untyped.)</p></div></li></ul><p>The output of the validation process comprises one or more of the following:</p><ul><li><p>A boolean indicating whether the operand node was found to be valid.</p></li><li><p>If the operand node was found to be valid, a deep copy of the operand node augmented with <a title="type annotation" class="termref" href="#dt-type-annotation">type annotations</a> corresponding to the types against which they were validated, the copies may also include expanded values for element and attribute defaults defined in the schema.</p><p>This creates a new node with its own identity and with no parent.</p><p>The base URI property of every node in the resulting XDM tree is the same as the base URI property of the corresponding node in the input tree. </p></li><li><p>If the operand node was not found to be valid, then optionally, a set of error diagnostics in implementation-defined format.</p></li></ul><p>The operand node must be one of:</p><ul><li><p>An element node</p></li><li><p>An attribute node</p></li><li><p>A well-formed document node, that is, a document node having among its children exactly one element node and zero or more comment and processing instruction nodes.</p></li></ul><p>The term <b>validation root</b> is used to refer to the operand node if it is an element or attribute node, or to the single element child of the operand node when the operand node is a document node.</p><p>Note that a <b>schema</b> is defined as a collection of schema components (for example, element and attribute declarations, complex and simple type definitions). In some cases the schema that is used is the set of schema components found in the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-issd">in-scope schema definitions</a><sup><small>XP</small></sup>, but this is not the only possibility.</p><p>The result of the validation process is defined by the following rules.</p><ol class="enumar"><li><p>The invoking application determines whether the validity assessment process takes account of any <code>xsi:schemaLocation</code> or <code>xsi:noNamespaceSchemaLocation</code> attributes in the tree being validated. If it does so, then it <span class="verb">should</span> adhere to the following rules:</p><ol class="enumla"><li><p>Any schema loaded using these attributes must be <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-schema-compatible">compatible</a><sup><small>DM</small></sup> with the existing <b>effective schema</b>.</p></li><li><p>Any schema loaded using these attributes must not override or redefine any schema components in the effective schema.</p></li><li><p>Any schema components loaded using this mechanism must be used for this validity assessment only, and must not affect the outcome of any subsequent validity assessments of other documents.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>A processor may choose to cache such schema components but the existence of such a cache should only affect performance, not the validation outcome.</p></div></li></ol><p>A consequence of validating a document using schema components that are not in the static context is that nodes may be annotated with types that are not in the static context. But the rules for <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-schema-compatible">schema compatibility</a><sup><small>DM</small></sup> mean that this is not a problem.</p></li><li><p>If the instance being validated contains any <code>xml:id</code> attributes, such attributes are validated against the type <code>xs:ID</code>, making the containing element eligible as a target for the <a href="#func-id"><code>id</code></a> function. Uniqueness checking of elements and attributes typed as <code>xs:ID</code>, however, is carried out only if the operand node is a document node. </p></li><li><p> If the operand node is a document node:</p><ol class="enumla"><li><p>The children of the document node <span class="verb">must</span> consist of exactly one element node and zero or more comment and processing instruction nodes, in any order.</p></li><li><p>The element node child is validated, as described below.</p></li><li><p>The validation rule “Validation Root Valid (ID/IDREF)” is applied to the single element node child of the document node. This means that validation will fail if there are non-unique ID values or dangling IDREF values in the document tree.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>This rule is <em>not</em> applied when the operand node is an element or attribute node.</p></div></li><li><p>There is no check that the tree contains unparsed entities whose names match the values of nodes of type <code>xs:ENTITY</code> or <code>xs:ENTITIES</code>. This is because it is not possible (either in XSLT or XQuery) to construct a tree containing unparsed entities. It is possible to add unparsed entity declarations to the result document by referencing a suitable DOCTYPE during serialization.</p></li><li><p>All other children of the document node (comments and processing instructions) are copied unchanged, and the results become the children of a new document node, which is returned as the validation result.</p></li></ol></li><li><p>If the operand node is an element node, then:</p><ol class="enumla"><li><p>For specification purposes, because the XSD specifications require the input document to be expressed as an XML Information Set (<a href="#XINFO">[XML Infoset]</a>), the operand node is first converted to an Infoset according to the “Infoset Mapping” rules defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. Note that this process discards any existing <a title="type annotation" class="termref" href="#dt-type-annotation">type annotations</a>.</p><p>Validity assessment is carried out on the root element information item of the resulting Infoset, using the supplied schema. The process of validation applies recursively to contained elements and attributes to the extent required by the supplied schema. </p><div class="note"><p class="prefix"><b>Note:</b></p><p>A practical implementation is unlikely to perform any physical conversion, but the process is defined this way in order to align with the XSD specification.</p></div></li><li><p>If the validation mode is <code>by-type</code>, then Schema-validity assessment is carried out according to the rules defined in <a href="#xmlschema-1">[XML Schema Part 1: Structures Second Edition]</a> or <a href="#xmlschema11-1">[XSD 1.1 Part 1]</a> Part 1, section 3.3.4 "Element Declaration Validation Rules", “Validation Rule: Schema-Validity Assessment (Element)”, clauses 1.2 and 2, using this type definition as the “processor-stipulated type definition” for validation.</p></li><li><p>If validation mode is <code>strict</code>, then strict validation is carried out as described in <a href="#xmlschema-1">[XML Schema Part 1: Structures Second Edition]</a> Part 1, section 5.2, “Assessing Schema-Validity”, item 2, or its counterpart in XSD 1.1. This means that the root element information item in the Infoset must either:</p><ol class="enumlr"><li><p>have a name that matches a top-level element declaration in the effective schema, or</p></li><li><p>have an <code>xsi:type</code> attribute whose value matches the name of a top-level type definition in the effective schema</p></li></ol><p>If there is no such element declaration or type definition, the element is assessed as invalid.</p></li><li><p>If validation mode is <code>lax</code>, then schema-validity assessment is carried out in accordance with <a href="#xmlschema-1">[XML Schema Part 1: Structures Second Edition]</a> Part 1, section 5.2, “Assessing Schema-Validity”, item 3, or its counterpart in XSD 1.1.</p><p>If validation mode is <code>lax</code> and the root element information item has neither a top-level element declaration nor an <code>xsi:type</code> attribute, XSD 1.0 and XSD 1.1 define the recursive checking of children and attributes as optional. This specification prescribes that this recursive checking is required.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>This means, for example, that when an instance document is structured as having an envelope in one namespace wrapping a payload in a different namespaces, and when schema definitions are available for the payload but not for the envelope, lax validation of the envelope may trigger validation of the payload.</p></div></li><li><p>If the operand node is an element node, the validation rules named “Validation Root Valid (ID/IDREF)” are not applied. This means that document-level constraints relating to uniqueness and referential integrity are not enforced.</p></li><li><p>There is no check that the document contains unparsed entities whose names match the values of nodes of type <code>xs:ENTITY</code> or <code>xs:ENTITIES</code>.</p></li></ol></li><li><p>If the operand node is an attribute node, in particular when it is a parentless attribute node, then validation cannot be defined directly in terms of the XSD-defined validation process. Instead, conceptually, a copy of the attribute is first added to an element node that is created for the purpose, and namespace fixup is performed on this element node to ensure that it has an in-scope namespace binding for the prefix and namespace of the attribute name. The name of this element is of no consequence, but it must be the same as the name of a synthesized element declaration of the form:</p><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;xs:element name="E"&gt;
  &lt;xs:complexType&gt;
    &lt;xs:sequence/&gt;
    &lt;xs:attribute ref="A"/&gt;
  &lt;/xs:complexType&gt;
&lt;/xs:element&gt;</pre></div><p>where A is the name of the attribute being validated.</p><p>This synthetic element is then validated using the procedure given above for validating elements, and if it is found to be valid, a copy of the validated attribute is made, retaining its <a title="type annotation" class="termref" href="#dt-type-annotation">type annotation</a>, but detaching it from the containing element (and thus, from any in-scope namespace bindings).</p><p>The XDM data model does not permit an attribute node with no parent to have a typed value that includes a namespace-qualified name, that is, a value whose type is derived from <code>xs:QName</code> or <code>xs:NOTATION</code>. This restriction is imposed because these types rely on the in-scope namespaces of a containing element to resolve namespace prefixes. Therefore, a parentless attribute is considered to be invalid against such a type.</p></li><li><p>The outcome of the validation expression depends on the <code>validity</code> property of the root element information item in the PSVI that results from the XSD validation process.</p><ol class="enumla"><li><p>If the <code>validity</code> property of the root element information item is <code>valid</code>, or if validation mode is <code>lax</code> and the <code>validity</code> property of the root element information item is <code>notKnown</code>, the PSVI is converted back into a data model instance as described in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> Section 3.3, “Construction from a PSVI”. The resulting node (a new node of the same kind as the operand node) is returned as the result of the <code>validate</code> expression.</p><p>Otherwise, the operand node is deemed invalid.</p></li></ol></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>During conversion of the PSVI into an XDM instance after validation, any element information items whose validity property is <code>notKnown</code> are converted into element nodes with <a title="type annotation" class="termref" href="#dt-type-annotation">type annotation</a><code>xs:anyType</code>, and any attribute information items whose validity property is <code>notKnown</code> are converted into attribute nodes with <a title="type annotation" class="termref" href="#dt-type-annotation">type annotation</a><code>xs:untypedAtomic</code>, as described in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#PSVI2NodeTypes">7.4.3.1.1 Element and Attribute Node Types</a>. </p></div></div><div class="div3"><h4><a id="func-xsd-validator"></a>17.2.5 <a href="#func-xsd-validator" style="text-decoration: none">fn:xsd-validator</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#html-functions">next</a> | <a href="#xsd-validation">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1271">1271</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1933">1933</a>&nbsp;29 April 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Given an XSD schema, delivers a function item that can be invoked to validate a document, element, or attribute node against this schema.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:xsd-validator</code>(</td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>function((document-node(*) | element() | attribute())?) as record(is-valid as xs:boolean, typed-node? as node(), error-details? as record(*)*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The <a href="#func-xsd-validator"><code>fn:xsd-validator</code></a> function returns a function item that can be used to validate a document node, element node, or attribute node with respect to a supplied schema.</p><p>The details of how the schema is assembled, and the way it is used, are defined by the supplied <code>$options</code>. If the <code>$options</code> argument is absent or empty the effect is to use the schema components from the static context of the call on <a href="#func-xsd-validator"><code>fn:xsd-validator</code></a>. In the general case, however, the schema used for validation may include components from any or all of the following:</p><ul><li><p>The static context of the function call</p></li><li><p>Explicitly supplied schema documents</p></li><li><p>Schema components referenced in <code>xsi:schemaLocation</code> and <code>xsi:noNamespaceSchemaLocation</code> attributes within the instance document being validated.</p></li></ul><p>More details of schema assembly appear below. Taken together, the assembled components must constitute a valid schema.</p><p>The function is designed to separate the process of assembling a schema from the process of performing instance validation. However, if the schema is to include components identified in <code>xsi:schemaLocation</code> and <code>xsi:noNamespaceSchemaLocation</code> attributes, then the process of assembling the schema cannot be completed until the instance document is available.</p><p>The options recognized are as follows. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">trusted?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">use-imported-schema?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">schema?</code></td><td><code class="as">as&nbsp;</code><code>element(xs:schema)*</code>,</td></tr><tr class="arg"><td><code class="opt">target-namespace?</code></td><td><code class="as">as&nbsp;</code><code>xs:anyURI*</code>,</td></tr><tr class="arg"><td><code class="opt">schema-location?</code></td><td><code class="as">as&nbsp;</code><code>xs:anyURI*</code>,</td></tr><tr class="arg"><td><code class="opt">use-xsi-schema-location?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">xsd-version?</code></td><td><code class="as">as&nbsp;</code><code>xs:decimal</code>,</td></tr><tr class="arg"><td><code class="opt">validation-mode?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">type?</code></td><td><code class="as">as&nbsp;</code><code>xs:QName?</code>,</td></tr><tr class="arg"><td><code class="opt">return-typed-node?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">return-error-details?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td rowspan="3"><p><code>trusted?</code></p></td><td class="fos-thick" colspan="2">Indicates whether the validation process may cause external resources to be fetched (including, for example, documents referenced using the <code>schema-location</code> property, or <code>xsi:schemaLocation</code> attributes within the document being validated). <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false()</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>The validation process may retrieve external resources. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>The validation process must not retrieve any external resources unless access to these resources has been explicitly enabled. </td></tr><tr><td><p><code>use-imported-schema?</code></p></td><td class="fos-thin" colspan="2">If true, the schema to be used for validation includes the schema components available in the static context of the function call. If false, these components are not used. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr><tr><td><p><code>schema?</code></p></td><td class="fos-thin" colspan="2">A list of XDM nodes containing XSD schema documents to be used for validation. <ul><li><p><b>Type: </b><code>element(xs:schema)*</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>target-namespace?</code></p></td><td class="fos-thin" colspan="2">A list of target namespaces identifying schema components to be used for validation. The way in which the processor locates schema components for the specified target namespaces is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. A zero-length string denotes a no-namespace schema. <ul><li><p><b>Type: </b><code>xs:anyURI*</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>schema-location?</code></p></td><td class="fos-thin" colspan="2">A list of locations of XSD schema documents to be used to assemble a schema. Any relative URIs are resolved relative to the base URI of the function call. Access to the schema documents at these locations is allowed regardless of the value of the <code>trusted</code> option; access to indirectly referenced schema documents (for example, using <code>xs:include</code> is allowed only if the <code>trusted</code> option is set to <code>true</code>. <ul><li><p><b>Type: </b><code>xs:anyURI*</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td><p><code>use-xsi-schema-location?</code></p></td><td class="fos-thin" colspan="2">If true, the schema to be used for validation includes any schema documents referenced by <code>xsi:schemaLocation</code> or <code>xsi:noNamespaceSchemaLocation</code> attributes in the instance document being validated. If false, these attributes are ignored. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>xsd-version?</code></p></td><td class="fos-thin" colspan="2">Set to the decimal value 1.0 or 1.1 to indicate which version of XSD is to be used. The default is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. A processor may use a later version of XSD than the version requested, but must not use an earlier version. <ul><li><p><b>Type: </b><code>xs:decimal</code></p></li></ul></td></tr><tr><td rowspan="4"><p><code>validation-mode?</code></p></td><td class="fos-thick" colspan="2">The validation mode. <ul><li><p><b>Type: </b><code>xs:string</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>strict</code></td><td>Validates the input using the element or attribute declaration for the operand node. This element or attribute declaration must exist. This is the default when the <code>type</code> option is absent.</td></tr><tr><td class="fos-thin"><code>lax</code></td><td>Validates the input using the element or attribute declaration for the operand node, if it exists.</td></tr><tr><td class="fos-thick"><code>by-type</code></td><td>Validates the input using the supplied governing type. This is the default when the <code>type</code> option is present.</td></tr><tr><td><p><code>type?</code></p></td><td class="fos-thin" colspan="2">Establishes the governing type for validation. The type must be present in the assembled schema. <ul><li><p><b>Type: </b><code>xs:QName?</code></p></li></ul></td></tr><tr><td><p><code>return-typed-node?</code></p></td><td class="fos-thin" colspan="2">If true, the result of the generated validation function, when validation is successful, includes the property <code>typed-node</code> which contains a copy of the target node augmented with type annotations and expanded default values. If false, the typed node is not included in the result. If a node containing type annotations is to be returned, then the schema used for validation must be compatible with all other schemas used within the same query or stylesheet, as described in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#schema-consistency">4.1.2 Schema Consistency</a>; this is to ensure that the type annotations in the validated document have a consistent interpretation. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr><tr><td><p><code>return-error-details?</code></p></td><td class="fos-thin" colspan="2">If true, the result of the generated validation function, when validation is unsuccessful, includes detailed information about the nature of the validity errors that were found. If false, the result only includes an indication that the document was invalid. Note that setting the value to false means that validation can complete as soon as the first error is found. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr></tbody></table><p>The first task of the function is to assemble a schema (that is, a collection of schema components). Schema components can come from a number of sources, and a schema can be assembled from more than one source, provided that the total collection of components comprises a valid schema: the main thing that will prevent this is if two sources contain conflicting definitions of the same named component.</p><ul><li><p>The default is to use the in-scope schema components from the static context of the function call.</p></li><li><p>Instead, or in addition, schema components may be loaded explictly for this validator. Supplementary schema components may be requested in a number of ways:</p><ul><li><p>The <code>schema-location</code> option can specify one or more URIs that are interpreted as locations for source XSD schema documents, which are then assembled into a schema as described in the XSD specifications.</p></li><li><p>The <code>schema</code> option can be used to identify one or more <code>xs:schema</code> element nodes holding source schema documents. This allows a schema to be constructed dynamically by the application, or to be held as a global variable in the source code of a query or stylesheet module.</p></li><li><p>The <code>target-namespace</code> option can be used to supply the target namespaces of additional schema components that are known to the system or that are made available using some external mechanism. For example, the system might have built-in schemas for common namespaces such as the <code>xml</code>, <code>fn</code>, or <code>xlink</code> namespaces, or it might have a mechanism allowing schemas for a particular namespace to be registered using an external API or configuration mechanism.</p></li></ul></li><li><p>The <code>use-xsi-schema-location</code> also allows the application to request that schema documents referenced from <code>xsi:schemaLocation</code> or <code>xsi:noNamespaceSchemaLocation</code> attributes should be included in the schema. By default these attributes are ignored.</p></li><li><p>It is acceptable to assemble a schema from more than one of these sources. In addition, any of these sources can bring in additional components by the use of the XSD directives <code>xsl:include</code> and <code>xsl:import</code>. The important constraint is that the result should be a valid schema. This will only be the case if the sources used to assemble the schema are <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-schema-compatible">compatible</a><sup><small>DM</small></sup> with each other: see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#schema-consistency">4.1.2 Schema Consistency</a>.</p></li><li><p>The XSD specification allows a schema to be used for validation even when it contains unresolved references to absent schema components. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether this function allows the schema to be incomplete in this way. For example, some processors might allow validation using a schema in which an element declaration contains a reference to a type declaration that is not present in the schema, provided that the element declaration is never needed in the course of a particular validation episode.</p></li></ul><p>Having assembled a schema, the next task is to validate a supplied node (and the subtree rooted at that node).</p><div class="note"><p class="prefix"><b>Note:</b></p><p>This description is a deliberate simplification. If the <code>use-xsi-schema-location</code> option is <code>true</code>, then assembly of the schema is not completed until the instance document is available, and in practice overlaps with the validation process.</p></div><p>The <a href="#func-xsd-validator"><code>xsd-validator</code></a> function returns a function item (call it <var>V</var>) with the following characteristics:</p><ul><li><p><var>V</var> has an arity of one. Call the value of the supplied argument <code>$target</code>. The required type of <code>$target</code> is <code>(document-node(*) | element() | attribute())?</code>: that is, it accepts either a well-formed document node, or an element node, or an attribute node, or the empty sequence.</p></li><li><p>If the argument is the empty sequence then the result of <var>V</var> is also the empty sequence.</p></li><li><p>In other cases, the result of a call on <var>V</var> is a record containing the following fields:</p><ul><li><p><code>is-valid as xs:boolean</code>. This field is always present, and indicates whether the supplied <code>$target</code> node was found to be valid against the schema. The value is <code>true</code> if either (a) the validation outcome was <code>valid</code>, or (b) lax validation was requested and the validation outcome was <code>notKnown</code>. In other cases it is <code>false</code>.</p></li><li><p><code>typed-node as (document-node(*) | element() | attribute())</code>. This field is present only when (a) the option <code>return-typed-node</code> was set (explicitly or implicitly) to <code>true</code>, and (b) the value of the <code>is-valid</code> field is <code>true</code>. It represents the root of a tree that is a deep copy of the input tree, augmented with type annotations and default values.</p></li><li><p><code>error-details as map(*)*</code>. This field is present only when (a) the option <code>return-error-details</code> was set to <code>true</code>, and (b) the supplied document was found to be invalid. The value is a sequence of maps, each containing details of one invalidity that was found. The precise details of the invalidities are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but they <span class="verb">may</span> include the following fields, if the information is available:</p><ul><li><p><code>message</code>. A string containing the text of an error message, intended for a human reader.</p></li><li><p><code>rule</code>. A reference to the rule in the XSD specification that was violated. This is a string comprising four parts separated by the character <span class="unicode-codepoint">U+007C</span> (<span class="unicode-name">VERTICAL BAR</span>, <code>|</code>) :</p><ul><li><p>"1.0" or "1.1" indicating whether the reference is to the XSD 1.0 or 1.1 specification.</p></li><li><p>"1" or "2" indicating whether the reference is to part 1 or part 2 of the specification.</p></li><li><p>The name of the validation rule (for example "Datatype Valid").</p></li><li><p>The clause number within that validation rule (for example "2.3").</p></li></ul><p>For example, if an attribute is declared to be of type <code>xs:integer</code>, but the actual value is not in the lexical space of <code>xs:integer</code>, the value of <code>rule</code> might be <code>"1.1|2|Datatype Valid|2.1"</code>.</p></li><li><p><code>node</code>. The node that was found to be invalid. Note that when a containing element <var>C</var> is invalid because a child element <var>D</var> is not allowed by its content model, the invalid node is <var>C</var>, not <var>D</var>.</p></li><li><p><code>error-node</code>. The node whose presence led to detection of the invalidity. In the above example, this would be <var>D</var>.</p></li><li><p><code>error-uri</code>. The URI of the XML entity in which the error was detected.</p></li><li><p><code>line-number</code>. The line number where the error was detected, within its external entity.</p></li><li><p><code>column-number</code>. The column number where the error was detected, within the error line number.</p></li></ul></li></ul></li><li><p>The validation is performed as described in <a href="#xsd-validation"><b>17.2.4 XSD validation</b></a>, with the assembled schema as the effective schema and <code>$target</code> as the operand node.</p></li><li><p>If the <code>use-xsi-schema-location</code> option is <code>true</code> and a failure occurs processing an <code>xsi:schemaLocation</code> or <code>xsi:noNamespaceSchemaLocation</code> attribute (for example, because a schema document cannot be retrieved, or because the referenced schema document is invalid, or because it is incompatible with other schema components) this is treated as an invalidity, not as a dynamic error: <var>V</var> returns successfully with <code>is-valid</code> set to <code>false</code>.</p></li><li><p>The function <var>V</var> may fail with a dynamic error if it is not possible to determine whether or not the instance document is valid. This may happen, for example, if processor-defined limits are exceeded.</p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODC0009" title="err:FODC0009">err:FODC0009</a>] if the processor is not schema-aware, or if no schema processor with the required capabilities (such as XSD 1.1 support) is available.</p><p>A dynamic error is raised [<a href="#ERRFODC0015" title="err:FODC0015">err:FODC0015</a>] if it is not possible to assemble a valid and consistent schema.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Both XQuery and XSLT provide capabilities for XSD-based schema validation in earlier versions of the specifications, and those are retained in 4.0. This function provides additional capability:</p><ul><li><p>It is possible to control validation more precisely, through a wider range of options;</p></li><li><p>It is possible to validate different instance documents against different schemas;</p></li><li><p>Information about any invalidities is made available to the application, rather than simply causing a dynamic error;</p></li><li><p>The capability is provided by means of a function rather than custom syntax, making it easier to integrate into an application.</p></li><li><p>The capability is available through XPath alone, and therefore with host languages other than XQuery and XSLT.</p></li></ul><p>Three possible ways of using the function include:</p><ul><li><p>To simply test whether or not a document is valid against a schema, set the options <code>return-typed-node</code> and <code>return-error-details</code> to <code>false</code>, and simply test the value of the <code>is-valid</code> field returned when the validation function is called.</p></li><li><p>To obtain a typed XDM tree from an input document that is expected to be valid, set the option <code>return-typed-node</code> to true. On return from the validation function, test the value of the <code>is-valid</code> field; call <a href="#func-error"><code>fn:error</code></a> if the value is false; otherwise use the <code>typed-node</code> property of the result. The main benefit of using a typed XDM tree is that it allows static type checking of path expressions: this benefit only applies when the schema used for validation is the imported schema used in the static context. However, there are cases where validation against a different schema is appropriate, for example when validating the result of one query or transformation that is to be used as input to another.</p></li><li><p>To validate an input document and provide feedback to the document author about any validity problems that were found, set <code>return-error-details</code> to <code>true</code>. If the result of the validation function has <code>is-valid = false()</code>, process the returned <code>error-details</code>. The information available for this part of the processing may not be 100% interoperable, though with care it should be possible to write the query in such a way that it works with different processors.</p></li></ul><p>The function has no effect on the static context. Schemas loaded using this function, either directly or via the effect of <code>xsi:schemaLocation</code> and <code>xsi:noNamespaceSchemaLocation</code> attributes, are not added to the static context and have no effect on any other validation episodes. A processor may cache schema components to reduce the cost of processing the same schema repeatedly, but this has no observable effect other than on performance.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $schema := 
  &lt;xs:schema&gt;
    &lt;xs:element name="distance" type="xs:decimal"/&gt;
  &lt;/xs:schema&gt;
let $validator := xsd-validator({'schema': $schema})
return ($validator(&lt;distance&gt;8.5&lt;/distance&gt;)?is-valid,
        $validator(&lt;distance&gt;8.5km&lt;/distance&gt;)?is-valid)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true(), false()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $schema := 
  &lt;xs:schema&gt;
    &lt;xs:element name="distance" type="xs:decimal"/&gt;
  &lt;/xs:schema&gt;
let $validator := xsd-validator({'schema': $schema})
let $typed-result := $validator(&lt;distance&gt;8.5&lt;/distance&gt;)?typed-node
return $typed-result instance of element(distance, xs:decimal)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="html-functions"></a>17.3 <a href="#html-functions" style="text-decoration: none">Functions on HTML Data</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-parse-html">next</a> | <a href="#func-xsd-validator">previous</a>)</p><ol><li><p> A new function is available for processing input data in HTML format. <i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/74">74</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/850">850</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1799">1799</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1889">1889</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1891">1891</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/259">259</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/956">956</a>&nbsp;10 January 2023]</i></p></li></ol></div><p>This function converts between the lexical representation of HTML and the XDM tree representation.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parse-html"><code>fn:parse-html</code></a></td><td>This function takes as input an HTML document, and returns the document node at the root of an XDM tree representing the parsed document.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-html-doc"><code>fn:html-doc</code></a></td><td>Reads an external resource containing HTML, and returns the result of parsing the resource as HTML.</td></tr></tbody></table><div class="div3"><h4><a id="html-xdm-mapping"></a>17.3.1 <a href="#html-xdm-mapping" style="text-decoration: none">XDM Mapping from HTML DOM Nodes</a></h4><p>The <a href="#func-parse-html"><code>fn:parse-html</code></a> function conceptually works in two phases:</p><ol class="enumar"><li><p>The lexical HTML (supplied as a string) is parsed into an HTML DOM as defined by the HTML5 specification: see <a href="#html5">[HTML: Living Standard]</a> and <a href="#dom-ls">[DOM: Living Standard]</a>. </p></li><li><p>The resulting DOM is converted to an XDM tree as described in this section. This is described by defining the actions of the accessor functions defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#accessors">7.6 Accessors</a>.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Because the <a href="#dom-ls">[DOM: Living Standard]</a> and <a href="#html5">[HTML: Living Standard]</a> are not fixed, it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which versions are used.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>An implementation must match the semantics of the mapping described in this section, but the specific way it achieves that is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p>Some possible implementation strategies are:</p><ol class="enumar"><li><p>Parse the HTML to an HTML DOM and then convert the HTML DOM to an XDM node tree.</p></li><li><p>Parse the HTML to an HTML DOM and then implement a wrapper or facade that presents an XDM interface to the HTML DOM.</p></li><li><p>Parse the lexical HTML directly to an XDM node tree, bypassing the HTML DOM.</p></li></ol></div><p>The <a href="#dom-ls">[DOM: Living Standard]</a> defines parsing algorithms for two different formats, which it refers to as the HTML and XML serializations (or concrete syntaxes). The XML serialization is an XML document which typically uses the namespace <code>http://www.w3.org/1999/xhtml</code> and the content type <code>application/xhtml+xml</code>, and is popularly referred to as <code>XHTML</code>. The HTML parsing algorithm constructs an HTML DOM <code>HTMLDocument</code> document object for the HTML document. The XHTML parsing algorithm constructs an HTML DOM <code>XMLDocument</code> object for the HTML document, following XML parsing rules. This mapping supports both of these document types.</p><p>The <a href="#dom-ls">[DOM: Living Standard]</a> specification defines HTML DOM nodes that are mapped to XDM nodes as follows:</p><ol class="enumar"><li><p>The HTML DOM <code>Document</code> interface maps to <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#DocumentNode">7.5.1 Document nodes</a>.</p></li><li><p>The HTML DOM <code>Element</code> interface maps to <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#ElementNode">7.5.2 Element nodes</a>. But see below for the mapping of an HTML <code>template</code> element.</p></li><li><p>The HTML DOM <code>Attr</code> interface maps to <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#AttributeNode">7.5.3 Attribute nodes</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Any HTML DOM <code>Attr</code> instances in an HTML DOM <code>HTMLDocument</code> that represent namespace declarations will have been filtered out: see <a href="#html-attributes-accessor"><b>17.3.1.1 attributes Accessor</b></a>.</p></div></li><li><p>The HTML DOM <code>ProcessingInstruction</code> interface maps to <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#ProcessingInstructionNode">7.5.5 Processing instruction nodes</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The HTML parsing algorithm does not generate processing instruction nodes. If encountered they are parsed as comment nodes. The HTML DOM <code>ProcessingInstruction</code> interface is relevant only when the XHTML parsing algorithm is used.</p></div></li><li><p>The HTML DOM <code>Comment</code> interface maps to <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#CommentNode">7.5.6 Comment nodes</a>.</p></li><li><p>The HTML DOM <code>Text</code> interface maps to <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#TextNode">7.5.7 Text nodes</a>. Adjacent HTML DOM <code>Text</code> nodes are combined into a single <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#TextNode">7.5.7 Text nodes</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The HTML DOM <code>CDATASection</code> interface is an instance of HTML DOM <code>Text</code>, so CDATA sections also map to <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#TextNode">7.5.7 Text nodes</a>.</p><p>The use of CDATA sections can result in the HTML DOM containing adjacent text nodes, which the mapping to XDM will merge into a single node.</p></div></li><li><p>An HTML <code>template</code> element is mapped to an XDM <code>template</code> element with children corresponding to the children of the HTML DOM <code>DocumentFragment</code> that is the value of the <b>template contents</b> property of the HTML DOM <code>template</code> element.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Given source HTML such as <code>&lt;template&gt;&lt;p&gt;Lorem ipsum&lt;/p&gt;&lt;/template&gt;</code>, the HTML DOM represents the element <code>&lt;p&gt;Lorem ipsum&lt;/p&gt;</code> not as a child of the <code>template</code> element, but as the child of a free-standing document fragment which is accessible (in the DOM API) as the value of the <code>template.content</code> property of the element node. The XDM representation produced by the <a href="#func-parse-html"><code>parse-html</code></a> does not follow this convention: instead, the element <code>&lt;p&gt;Lorem ipsum&lt;/p&gt;</code> appears as an ordinary child node of the <code>template</code> element.</p></div></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>The HTML DOM <code>DocumentFragment</code> interface is not supported as an XML node. There are two places in the HTML DOM where this is used:</p><ol class="enumar"><li><p>The HTML DOM <code>ShadowRoot</code> interface is not present in the main HTML DOM tree. It is only accessible via JavaScript.</p></li><li><p>The <code>template</code> element’s <code>content</code> property contains the child nodes of the <code>template</code> element. The behaviour of this is described above.</p></li></ol><p>If an implementation allows these nodes to be passed in via an API or similar mechanism, their behaviour is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p></div><div class="div4"><h5><a id="html-attributes-accessor"></a>17.3.1.1 <a href="#html-attributes-accessor" style="text-decoration: none">attributes Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-attributes">7.6.1 attributes Accessor</a><code>dm:attributes($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>If the node is an instance of HTML DOM <code>Element</code> then the result is the value of the <code>Element.attributes</code> property mapped to a sequence as described below;</p></li><li><p>Otherwise, the result is the empty sequence.</p></li></ol><p>An HTML DOM <code>NamedNodeMap</code> is mapped to a sequence as follows:</p><ol class="enumar"><li><p><code>NamedNodeMap.length</code> is the length of the sequence, where a length of <code>0</code> results in the empty sequence;</p></li><li><p><code>NamedNodeMap.item(n)</code> is the n<sup>th</sup> element of the sequence.</p></li></ol><p>That sequence is then filtered as follows:</p><ol class="enumar"><li><p>If the <code>Attr.namespaceURI</code> property is <code>"http://www.w3.org/2000/xmlns/"</code>, the attribute is not included in this sequence;</p></li><li><p>If the <code>Attr.localName</code> property is <code>"xmlns"</code>, the attribute is not included in this sequence;</p></li><li><p>If the <code>Attr.localName</code> property starts with <code>"xmlns:"</code>, the attribute is not included in this sequence;</p></li><li><p>Otherwise, the attribute is included in this sequence using the XDM mapping rules described in this section.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>The HTML DOM <code>Element.attributes</code> property includes namespace and non-namespace attributes in the list when the HTML or XML parser is used. As such, the namespace attributes have to be filtered from the resulting XDM attribute sequence.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>When the resulting document is an HTML DOM <code>HTMLDocument</code>, the <code>Attr.localName</code> and <code>Attr.name</code> properties of HTML DOM <code>Attr</code> nodes are both set to the qualified name. This includes namespace declarations which are filtered out by the logic in this section.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>The <code>Attr.localName</code> property will be ASCII lowercase. The <a href="#html5">[HTML: Living Standard]</a> section 13.2.5.33, <em>Attribute name state</em> specifies that ASCII upper alpha characters are appended to the attribute’s name in lowercase.</p></div></div><div class="div4"><h5><a id="html-base-uri-accessor"></a>17.3.1.2 <a href="#html-base-uri-accessor" style="text-decoration: none">base-uri Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-base-uri">7.6.2 base-uri Accessor</a><code>dm:base-uri($node)</code> for an HTML DOM <code>Node</code> is the value of the <code>Node.baseURI</code> property mapped as follows:</p><ol class="enumar"><li><p>If the value is null or the zero-length string, then the result is the empty sequence;</p></li><li><p>Otherwise, the string value is cast to an <code>xs:anyURI</code>.</p></li></ol></div><div class="div4"><h5><a id="html-children-accessor"></a>17.3.1.3 <a href="#html-children-accessor" style="text-decoration: none">children Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-children">7.6.3 children Accessor</a><code>dm:children($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>If the node is an instance of HTML DOM <code>Document</code> then the result is the value of the <code>Node.childNodes</code> property mapped to a sequence;</p></li><li><p>If the node is an instance of HTML DOM <code>HTMLTemplateElement</code> then the result is the HTML DOM <code>DocumentFragment</code>’s <code>Node.childNodes</code> property, mapped to a sequence;</p></li><li><p>If the node is an instance of HTML DOM <code>Element</code> then the result the value of the <code>Node.childNodes</code> property mapped to a sequence;</p></li><li><p>Otherwise, the result is the empty sequence.</p></li></ol><p>An HTML DOM <code>NodeList</code> is mapped to a sequence as follows:</p><ol class="enumar"><li><p><code>NodeList.length</code> is the length of the sequence, where a length of <code>0</code> results in the empty sequence;</p></li><li><p><code>NodeList.item(n)</code> is the n<sup>th</sup> element of the sequence.</p></li></ol><p>That sequence is then filtered as follows:</p><ol class="enumar"><li><p>If the child is an instance of HTML DOM <code>DocumentType</code>, that child is not included in this sequence;</p></li><li><p>A sequence of consecutive HTML DOM <code>Text</code> nodes is combined into a single XDM <code>text</code> node;</p></li><li><p>Otherwise, the HTML DOM <code>Node</code> nodes are mapped to XDM according to the rules in this section.</p></li></ol></div><div class="div4"><h5><a id="html-document-uri-accessor"></a>17.3.1.4 <a href="#html-document-uri-accessor" style="text-decoration: none">document-uri Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-document-uri">7.6.4 document-uri Accessor</a><code>dm:document-uri($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>If the node is an instance of HTML DOM <code>Document</code> then the value of the <code>Document.documentURI</code> property mapped as follows:</p><ol class="enumla"><li><p>If the value is null or the zero-length string, then the result is the empty sequence;</p></li><li><p>Otherwise, the string value is cast to an <code>xs:anyURI</code>.</p></li></ol></li><li><p>Otherwise, the result is the empty sequence.</p></li></ol></div><div class="div4"><h5><a id="html-is-id-accessor"></a>17.3.1.5 <a href="#html-is-id-accessor" style="text-decoration: none">is-id Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-is-id">7.6.5 is-id Accessor</a><code>dm:is-id($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>If the node is an instance of HTML DOM <code>Attr</code> then:</p><ol class="enumla"><li><p>If the <code>Attr.name</code> property (its qualified name) is <code>"id"</code>, then:</p><ol class="enumlr"><li><p>If the <code>Attr.value</code> is castable to an <code>xs:NCName</code>, the result is <code>true</code>;</p></li><li><p>Otherwise, the result is <code>false</code>;</p></li></ol></li><li><p>Otherwise, the result is <code>false</code>;</p></li></ol></li><li><p>Otherwise, the result is <code>false</code>.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>In <a href="#html5">[HTML: Living Standard]</a> section 3.2.5, <em>Global attributes</em>, the <code>id</code> attribute is defined as being unique in the element’s tree, containing at least one character, and not having any ASCII whitespace characters. This means that an HTML <code>id</code> attribute may not conform to an <code>xs:NCName</code>.</p><p>If an HTML <code>id</code> is not a valid <code>xs:NCName</code> then that attribute is not an XML ID.</p></div></div><div class="div4"><h5><a id="html-is-idrefs-accessor"></a>17.3.1.6 <a href="#html-is-idrefs-accessor" style="text-decoration: none">is-idrefs Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-is-idrefs">7.6.6 is-idrefs Accessor</a><code>dm:is-idrefs($node)</code> for an HTML DOM <code>Node</code> is the empty sequence.</p></div><div class="div4"><h5><a id="html-namespace-nodes-accessor"></a>17.3.1.7 <a href="#html-namespace-nodes-accessor" style="text-decoration: none">namespace-nodes Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-namespace-nodes">7.6.7 namespace-nodes Accessor</a><code>dm:namespace-nodes($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>If the node is an instance of HTML DOM <code>Element</code> then an <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> sequence of namespace nodes that is sufficient to define the namespace context of the node.</p></li><li><p>Otherwise, the result is the empty sequence.</p></li></ol><p>For the XHTML parsing algorithm, this will be equivalent to constructing the namespace nodes from an XML infoset, PSVI, or similar mapping.</p><p>For the HTML parsing algorithm, the <a href="#html5">[HTML: Living Standard]</a> specification defines the namespace context in various places:</p><ol class="enumar"><li><p>Section 2.1.3 <em>XML compatibility</em> defines the default element namespace to be <code>http://www.w3.org/1999/xhtml</code>.</p></li><li><p>Section 4.8.15 <em>MathML</em> defines rules for embedded MathML content in HTML documents. Section 13.1.2 <em>Elements</em> defines these elements as foreign elements, placing them in the MathML namespace (<code>http://www.w3.org/1998/Math/MathML</code>). The default element namespace for these elements is the MathML namespace.</p></li><li><p>Section 4.8.16 <em>SVG</em> defines rules for embedded SVG content in HTML documents. Section 13.1.2 <em>Elements</em> defines these elements as foreign elements, placing them in the SVG namespace (<code>http://www.w3.org/2000/svg</code>). The default element namespace for these elements is the SVG namespace.</p></li><li><p>Section 13.1.2.3 <em>Attributes</em> defines several namespaced attributes available on foreign elements. If any of these namespaced attributes are present, a namespace node for that namespace must be present on the element.</p><p>The supported namespace prefixes are:</p><ol class="enumla"><li><p><code>xlink</code> in the <code>http://www.w3.org/1999/xlink</code> namespace;</p></li><li><p><code>xml</code> in the <code>http://www.w3.org/XML/1998/namespace</code> namespace; and</p></li><li><p><code>xmlns</code> in the <code>http://www.w3.org/2000/xmlns/</code> namespace.</p></li></ol></li></ol><p>No other namespaces are supported by the HTML parser.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Section number references to <a href="#html5">[HTML: Living Standard]</a> may change over time.</p></div></div><div class="div4"><h5><a id="html-nilled-accessor"></a>17.3.1.8 <a href="#html-nilled-accessor" style="text-decoration: none">nilled Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-nilled">7.6.8 nilled Accessor</a><code>dm:nilled($node)</code> for an HTML DOM <code>Node</code> is <code>false()</code>.</p></div><div class="div4"><h5><a id="html-node-kind-accessor"></a>17.3.1.9 <a href="#html-node-kind-accessor" style="text-decoration: none">node-kind Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-node-kind">7.6.9 node-kind Accessor</a><code>dm:node-kind($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>If the node is an instance of HTML DOM <code>Document</code> then the result is <code>"document"</code>.</p></li><li><p>If the node is an instance of HTML DOM <code>Element</code> then the result is <code>"element"</code>.</p></li><li><p>If the node is an instance of HTML DOM <code>Attr</code> then the result is <code>"attribute"</code>.</p></li><li><p>If the node is an instance of HTML DOM <code>ProcessingInstruction</code> then the result is <code>"processing-instruction"</code>.</p></li><li><p>If the node is an instance of HTML DOM <code>Comment</code> then the result is <code>"comment"</code>.</p></li><li><p>If the node is an instance of HTML DOM <code>Text</code> then the result is <code>"text"</code>.</p></li></ol></div><div class="div4"><h5><a id="html-node-name-accessor"></a>17.3.1.10 <a href="#html-node-name-accessor" style="text-decoration: none">node-name Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-node-name">7.6.10 node-name Accessor</a><code>dm:node-name($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>If the node is an instance of HTML DOM <code>Element</code> then the result is determined as follows:</p><ol class="enumla"><li><p>The <em>local name</em> is the value of the <code>Element.localName</code> property. This is derived as follows:</p><ol class="enumlr"><li><p>The local name is initially set to the ASCII lowercase tag name. The <a href="#html5">[HTML: Living Standard]</a> section 13.2.5.8, <em>Tag name state</em> specifies that ASCII upper alpha characters are appended to the element’s name in lowercase.</p></li><li><p>If the local name is an SVG element name, the case-sensitive name is used. <a href="#html5">[HTML: Living Standard]</a> section 13.2.6.5, <em>The rules for parsing tokens in foreign content</em> has a table mapping the lowercase element names to their SVG names.</p></li><li><p>If the local name contains a character that is not a valid XML <code>NameStartChar</code> or <code>NameChar</code>, then an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> replacement string is used. The result must be a valid <code>NCName</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p><a href="#html5">[HTML: Living Standard]</a> section 13.2.9 <em>Coercing an HTML DOM into an infoset</em> uses a <code>Unnnnnn</code> escape sequence. That would map <code>:</code> to <code>U00003A</code>.</p><p>This local name escaping applies only to the HTML parsing algorithm. If the XHTML parsing algorithm is used, the <code>localName</code> and <code>prefix</code> will be correctly set for QName-based node names.</p></div></li></ol></li><li><p>The <em>namespace prefix</em> is the value of the <code>Element.prefix</code> property, or empty if the value is null;</p></li><li><p>The <em>namespace URI</em> is the value of the <code>Element.namespaceURI</code> property, or empty if the value is null.</p><ol class="enumlr"><li><p>If the element is an HTML element, the namespace URI is <code>"http://www.w3.org/1999/xhtml"</code>.</p></li><li><p>If the element is an SVG element, the namespace URI is <code>"http://www.w3.org/2000/svg"</code>.</p></li><li><p>If the element is a MathML element, the namespace URI is <code>"http://www.w3.org/1998/Math/MathML"</code>.</p></li></ol></li></ol></li><li><p>If the node is an instance of HTML DOM <code>Attr</code> then the result is determined as follows:</p><ol class="enumla"><li><p>The <em>attribute name</em> is the tokenized attribute name. The <a href="#html5">[HTML: Living Standard]</a> section 13.2.5.33, <em>Attribute name state</em> specifies that ASCII upper alpha characters are appended to the attribute’s name in lowercase.</p></li><li><p>The <em>local name</em> is the value of the <code>Attr.localName</code> property. This is derived as follows:</p><ol class="enumlr"><li><p>The local name is initially set to the <em>attribute name</em>.</p></li><li><p>If the local name is an SVG or MathML attribute name, the case-sensitive name is used. <a href="#html5">[HTML: Living Standard]</a> section 13.2.6.1, <em>Creating and inserting nodes</em> has a table mapping the lowercase attribute names to their SVG/MathML names.</p></li><li><p>If the local name is an allowed <code>xlink</code>, <code>xml</code>, or <code>xmlns</code> attribute name the local name is the value of the local name column of the attribute name mapping table in <a href="#html5">[HTML: Living Standard]</a> section 13.2.6.1, <em>Creating and inserting nodes</em>.</p></li><li><p>If the local name contains a character that is not a valid XML <code>NameStartChar</code> or <code>NameChar</code>, then an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> replacement string is used. The result must be a valid <code>NCName</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p><a href="#dom-ls">[DOM: Living Standard]</a> section 13.2.9 <em>Coercing an HTML DOM into an infoset</em> uses a <code>Unnnnnn</code> escape sequence. That would map <code>:</code> to <code>U00003A</code>.</p><p>This local name escaping applies only to the HTML parsing algorithm. If the XHTML parsing algorithm is used, the <code>localName</code> and <code>prefix</code> will be correctly set for QName-based node names.</p></div></li></ol></li><li><p>The <em>namespace prefix</em> is the value of the <code>Attr.prefix</code> property, or empty if the value is null.</p><ol class="enumlr"><li><p>If the attribute name is an allowed <code>xlink</code>, <code>xml</code>, or <code>xmlns</code> attribute name the namespace prefix is the value of the prefix column of the attribute name mapping table in <a href="#html5">[HTML: Living Standard]</a> section 13.2.6.1, <em>Creating and inserting nodes</em>.</p></li></ol></li><li><p>The <em>namespace URI</em> is the value of the <code>Attr.namespaceURI</code> property, or empty if the value is null;</p><ol class="enumlr"><li><p>If the attribute name is an allowed <code>xlink</code>, <code>xml</code>, or <code>xmlns</code> attribute name the namespace URI is the value of the namespace column of the attribute name mapping table in <a href="#html5">[HTML: Living Standard]</a> section 13.2.6.1, <em>Creating and inserting nodes</em>.</p></li></ol></li></ol></li><li><p>If the node is an instance of HTML DOM <code>ProcessingInstruction</code> then the result is an <code>xs:QName</code> constructed as follows:</p><ol class="enumla"><li><p>The <em>local name</em> is the value of the <code>ProcessingInstruction.target</code> property;</p></li><li><p>The <em>namespace prefix</em> is empty;</p></li><li><p>The <em>namespace URI</em> is empty;</p></li></ol></li><li><p>Otherwise, the result is the empty sequence.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>When the resulting document is an HTML DOM <code>HTMLDocument</code>, the <code>Element.localName</code> and <code>Element.name</code> properties of HTML DOM <code>Element</code> nodes are both set to the qualified name.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>When the resulting document is an HTML DOM <code>HTMLDocument</code>, the <code>Attr.localName</code> and <code>Attr.name</code> properties of HTML DOM <code>Attr</code> nodes are both set to the qualified name.</p></div></div><div class="div4"><h5><a id="html-parent-accessor"></a>17.3.1.11 <a href="#html-parent-accessor" style="text-decoration: none">parent Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-parent">7.6.11 parent Accessor</a><code>dm:parent($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>Let <code>$parent</code> be the <code>Node.parentNode</code> property of the node;</p></li><li><p>If <code>$parent</code> is an instance of HTML DOM <code>DocumentFragment</code>, then for each HTML DOM <code>HTMLTemplateElement</code><code>$template</code> in the parsed DOM tree:</p><ol class="enumla"><li><p>Let <code>$content</code> be the value of the <code>HTMLTemplateElement.content</code> property of <code>$template</code>;</p></li><li><p>If <code>$content</code> is the same node as <code>$parent</code>, then the result is <code>$template</code> using the XDM mapping rules described in this section;</p></li><li><p>If there are no more <code>$template</code> nodes, then the result is an empty sequence;</p></li></ol></li><li><p>If <code>$parent</code> is null, then the result is the empty sequence;</p></li><li><p>Otherwise, the result is <code>$parent</code> using the XDM mapping rules described in this section.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>The current node can have a HTML DOM <code>DocumentFragment</code> parent node only if the <code>include-template-content</code> key of the <code>html-parser-options</code> is <code>true()</code>.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>The HTML DOM <code>DocumentFragment</code>’s <code>Node.parentNode</code> property is null, and a <code>DocumentFragment</code> attached to <code>HTMLTemplateElement.content</code> property does not have a <code>host</code> property connecting the fragment back to the template element.</p><p>If a future version of <a href="#dom-ls">[DOM: Living Standard]</a> adds a <code>DocumentFragment.host</code> property that references the node’s <code>template</code> element, or the implementation has access to that internal property, the implementation may choose to use that instead of traversing the parsed HTML tree.</p></div></div><div class="div4"><h5><a id="html-string-value-accessor"></a>17.3.1.12 <a href="#html-string-value-accessor" style="text-decoration: none">string-value Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-string-value">7.6.12 string-value Accessor</a><code>dm:string-value($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>If the node is an instance of HTML DOM <code>Document</code>, then use the algorithm described in <a href="#html-tree-string-construction"><b>17.3.1.12.1 Tree string construction</b></a>;</p></li><li><p>If the node is an instance of HTML DOM <code>Element</code>, then use the algorithm described in <a href="#html-tree-string-construction"><b>17.3.1.12.1 Tree string construction</b></a>;</p></li><li><p>If the node is an instance of HTML DOM <code>Text</code>, then use the algorithm described in <a href="#html-text-node-string-construction"><b>17.3.1.12.2 Text node string construction</b></a>;</p></li><li><p>Otherwise, the result is the value of the <code>Node.nodeValue</code> property.</p></li></ol><div class="div5"><h6><a id="html-tree-string-construction"></a>17.3.1.12.1 <a href="#html-tree-string-construction" style="text-decoration: none">Tree string construction</a></h6><p>The following algorithm is used to construct the concatenated string value of a node in the HTML DOM tree:</p><ol class="enumar"><li><p>Let <code>$text</code> be the string value <code>""</code>;</p></li><li><p>For each descendant node <code>$node</code> in document order:</p><ol class="enumla"><li><p>If <code>$node</code> is not an instance of HTML DOM <code>Text</code>, process the next node in document order;</p></li><li><p>Append the value of the <code>Node.nodeValue</code> property for <code>$node</code> to <code>$text</code>;</p></li></ol></li><li><p>The result is <code>$text</code>.</p></li></ol></div><div class="div5"><h6><a id="html-text-node-string-construction"></a>17.3.1.12.2 <a href="#html-text-node-string-construction" style="text-decoration: none">Text node string construction</a></h6><p>The following algorithm is used to construct the maximal sequence of adjacent <em>character information items</em> for text node children of an element:</p><ol class="enumar"><li><p>Let <code>$text</code> be the string value <code>""</code>;</p></li><li><p>Append the value of the <code>Node.nodeValue</code> property for <code>$node</code> to <code>$text</code>;</p></li><li><p>Let <code>$next</code> be the value of <code>Node.nextSibling</code>;</p></li><li><p>Let <code>$next</code> is null, or not an instance of HTML DOM <code>Text</code>, the result is <code>$text</code>;</p></li><li><p>Otherwise, repeat from step 2 using <code>$next</code> as <code>$node</code>.</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>Adjacent text nodes in the HTML DOM are treated as a single XDM text node by only including the first text node and providing logic to ensure that the text content is merged into a single text block.</p></div></div></div><div class="div4"><h5><a id="html-type-name-accessor"></a>17.3.1.13 <a href="#html-type-name-accessor" style="text-decoration: none">type-name Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-type-name">7.6.13 type-name Accessor</a><code>dm:type-name($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>If the node is an instance of HTML DOM <code>Element</code> then the result is <code>xs:untyped</code>.</p></li><li><p>If the node is an instance of HTML DOM <code>Attr</code> then the result is <code>xs:untypedAtomic</code>.</p></li><li><p>If the node is an instance of HTML DOM <code>Text</code> then the result is <code>xs:untypedAtomic</code>.</p></li><li><p>Otherwise, the result is the empty sequence.</p></li></ol></div><div class="div4"><h5><a id="html-typed-value-accessor"></a>17.3.1.14 <a href="#html-typed-value-accessor" style="text-decoration: none">typed-value Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-typed-value">7.6.14 typed-value Accessor</a><code>dm:typed-value($node)</code> for an HTML DOM <code>Node</code> is as follows:</p><ol class="enumar"><li><p>Let <code>$string-value</code> be the <a href="#html-string-value-accessor"><b>17.3.1.12 string-value Accessor</b></a> for the node;</p></li><li><p>If the node is an instance of HTML DOM <code>Document</code> then the result is <code>$string-value</code> as an <code>xs:untypedAtomic</code>;</p></li><li><p>If the node is an instance of HTML DOM <code>Element</code> then the result is <code>$string-value</code> as an <code>xs:untypedAtomic</code>;</p></li><li><p>If the node is an instance of HTML DOM <code>Attr</code> then the result is <code>$string-value</code> as an <code>xs:untypedAtomic</code>;</p></li><li><p>If the node is an instance of HTML DOM <code>Text</code> then the result is <code>$string-value</code> as an <code>xs:untypedAtomic</code>;</p></li><li><p>Otherwise, the result is <code>$string-value</code>.</p></li></ol></div><div class="div4"><h5><a id="html-unparsed-entity-public-id-accessor"></a>17.3.1.15 <a href="#html-unparsed-entity-public-id-accessor" style="text-decoration: none">unparsed-entity-public-id Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-unparsed-entity-public-id">7.6.15 unparsed-entity-public-id Accessor</a><code>dm:unparsed-entity-public-id($node)</code> for an HTML DOM <code>Node</code> is the empty sequence.</p></div><div class="div4"><h5><a id="html-unparsed-entity-system-id-accessor"></a>17.3.1.16 <a href="#html-unparsed-entity-system-id-accessor" style="text-decoration: none">unparsed-entity-system-id Accessor</a></h5><p>The result of the <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-unparsed-entity-system-id">7.6.16 unparsed-entity-system-id Accessor</a><code>dm:unparsed-entity-system-id($node)</code> for an HTML DOM <code>Node</code> is the empty sequence.</p></div></div><div class="div3"><h4><a id="func-parse-html"></a>17.3.2 <a href="#func-parse-html" style="text-decoration: none">fn:parse-html</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-html-doc">next</a> | <a href="#html-functions">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/74">74</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/850">850</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1799">1799</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1889">1889</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1891">1891</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/2210">2210</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/259">259</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/956">956</a>&nbsp;10 January 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>This function takes as input an HTML document, and returns the document node at the root of an XDM tree representing the parsed document.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parse-html</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | xs:hexBinary | xs:base64Binary)?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>document-node(*:html)?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence the function returns the empty sequence.</p><p>In other cases, <code>$value</code> is expected to contain an HTML document supplied either as a string or a binary value.</p><p>The entries that may appear in the <code>$options</code> map are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">encoding?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">fail-on-error?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>encoding?</code></p></td><td class="fos-thin" colspan="2"><p>The character encoding to use to decode a sequence of octets that represents an HTML document. Note that encoding names are case-insensitive.</p><ul><li><p><b>Type: </b><code>xs:string</code></p></li></ul></td></tr><tr><td rowspan="3"><p><code>fail-on-error?</code></p></td><td class="fos-thick" colspan="2"><p>Indicates whether the function should fail with a dynamic error if the input is not syntactically valid.</p><ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td> Parsing errors should be handled as described in <a href="#html5">[HTML: Living Standard]</a> section 13.2.2, <em>Parse Errors</em>. </td></tr><tr><td class="fos-thick"><code>true</code></td><td> A parsing error should result in the function failing with a dynamic error. </td></tr></tbody></table><p>The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>If <code>$value</code> is not the empty sequence, an input byte stream is constructed as follows:</p><ol class="enumar"><li><p>If <code>$value</code> is an <code>xs:string</code>, then in principle no decoding is needed. Conceptually, however, the HTML parsing algorithm always starts by decoding an octet stream. The string is therefore first encoded using UTF-8, and the resulting octet stream is then passed to the HTML parser with a <b>known definite encoding</b> of UTF-8, as described in <a href="#html5">[HTML: Living Standard]</a> section 13.2.3.1, <em>Parsing with a known character encoding</em>.</p><p>If the first codepoint of the string is <span class="unicode-codepoint">U+FEFF</span>, this should be stripped, since it might otherwise lead to an incorrect encoding inference.</p></li><li><p>If the type of <code>$value</code> is a sequence of octets (<code>xs:hexBinary</code> or <code>xs:base64Binary</code>) the encoding of the input byte stream is determined in a way consistent with <a href="#html5">[HTML: Living Standard]</a> section 13.2.3.2, <em>Determining the character encoding</em>:</p><ol class="enumla"><li><p>The <code>encoding</code> key of <code>$options</code> is interpreted in step 2 of <em>Determining the character encoding</em> as the user instructing the user agent to override the document’s character encoding with the specified encoding.</p></li><li><p>If the <code>encoding</code> key of <code>$options</code> is not specified, step 2 of <em>Determining the character encoding</em> is skipped.</p></li></ol></li></ol><ol class="enumar"><li><p>Tokenizing the byte stream according to the HTML parsing algorithm as described in <a href="#html5">[HTML: Living Standard]</a> section 13.2.5, <em>Tokenization</em>.</p></li><li><p>Constructing a <code>HTMLDocument</code> object for HTML documents, or an <code>XMLDocument</code> for XML/XHTML documents as described in <a href="#html5">[HTML: Living Standard]</a> section 13.2.6, <em>Tree construction</em>.</p></li><li><p>Building an XDM representation of the <code>HTMLDocument</code> or <code>XMLDocument</code> according to the rules in <a href="#html-xdm-mapping"><b>17.3.1 XDM Mapping from HTML DOM Nodes</b></a>.</p></li></ol><p>The implementation <span class="verb">should</span> process any input HTML that adheres to the current practice of mainstream web browsers, as this evolves over time. Since this is defined by a “living standard” (see <a href="#html5">[HTML: Living Standard]</a>), no specific version is prescribed. An implementation <span class="verb">may</span> define additional options to control aspects of the HTML parsing algorithm, including the selection of a specific HTML parsing library; it may also provide options to process alternative HTML versions or dialects.</p><p>The implementation <span class="verb">should</span> recognize and process XHTML (referred to in <a href="#html5">[HTML: Living Standard]</a> as the XML concrete syntax of HTML).</p><p>The function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic with respect to node identity</a>: that is, if the function is called twice with the same arguments, it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether the same node is returned on both occasions.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFODC0011" title="err:FODC0011">err:FODC0011</a>] if the content of <code>$value</code> is not a well-formed HTML document. This includes the case where <code>$value</code> cannot be decoded using the specified encoding.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the HTML parser accepts a string as the input then that may be used directly when <code>$value</code> is an <code>xs:string</code> instead of converting the string to a sequence of octets in an <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> encoding. The HTML parser must not perform character encoding processing on that input, treating the HTML string as being in a known character encoding that matches the encoding of the string.</p><p>The WHATWG Encoding specification defines the ISO 8859-1 (latin1) and ASCII encodings as aliases of the windows-1252 encoding.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The expression <code>parse-html(())</code> returns <code>()</code>.</p></td></tr><tr><td colspan="2"><p>The expression <code>parse-html("&lt;p&gt;Hello&lt;/p&gt;")</code> returns an XDM document node equivalent to the result of parsing the XML <code>&lt;html xmlns='http://www.w3.org/1999/xhtml'&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</code></p></td></tr><tr><td colspan="2"><p>The expression <code>parse-html("&lt;p&gt;Hi&lt;/p&gt;", method:="html")</code> is equivalent to <code>parse-html("&lt;p&gt;Hi&lt;/p&gt;")</code>.</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-html-doc"></a>17.3.3 <a href="#func-html-doc" style="text-decoration: none">fn:html-doc</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#json-character-repertoire">next</a> | <a href="#func-parse-html">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/748">748</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2013">2013</a>&nbsp;20 May 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Reads an external resource containing HTML, and returns the result of parsing the resource as HTML.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:html-doc</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>document-node(*:html)?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>If the second argument is omitted or the empty sequence, the result is the same as calling the two-argument form with the empty map as the value of the <code>$options</code> argument.</p><p>The effect of the two-argument function call <code>fn:html-doc($H, $M)</code>is equivalent to the function composition <code>fn:unparsed-binary($H) =&gt; fn:parse-html($M)</code>.</p><p>If <code>$source</code> is the empty sequence, the function returns the empty sequence.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div></dd><dt class="label">Error Conditions</dt><dd><p>The function may raise any error defined for the <a href="#func-unparsed-binary"><code>fn:unparsed-binary</code></a> or <a href="#func-parse-html"><code>fn:parse-html</code></a> functions.</p></dd></dl></div></div><div class="div2"><h3><a id="json-functions"></a>17.4 <a href="#json-functions" style="text-decoration: none">Functions on JSON Data</a></h3><p>The functions listed in this section parse or serialize JSON data.</p><p>JSON is a popular format for exchange of structured data on the web: it is specified in <a href="#rfc7159">[RFC 7159]</a>. This section describes facilities allowing JSON data to be converted to and from XDM values.</p><p>This specification describes two ways of representing JSON data losslessly using XDM constructs. The first method uses XDM maps to represent JSON objects, and XDM arrays to represent JSON arrays. The second method represents all JSON constructs using XDM element and attribute nodes.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parse-json"><code>fn:parse-json</code></a></td><td>Parses input supplied in the form of a JSON text, returning the results typically in the form of a map or array.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-json-doc"><code>fn:json-doc</code></a></td><td>Reads an external resource containing JSON, and returns the result of parsing the resource as JSON.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-json-to-xml"><code>fn:json-to-xml</code></a></td><td>Parses a string supplied in the form of a JSON text, returning the results in the form of an XML <span>document node</span>.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-xml-to-json"><code>fn:xml-to-json</code></a></td><td>Converts an XML tree, whose format corresponds to the XML representation of JSON defined in this specification, into a string conforming to the JSON grammar.</td></tr></tbody></table><p>Note also:</p><ul><li><p>The function <a href="#func-serialize"><code>fn:serialize</code></a> has an option to generate JSON output from a structure of maps and arrays.</p></li><li><p>The function <a href="#func-element-to-map"><code>fn:element-to-map</code></a> enables arbitrary XML node trees to be converted to trees of maps and arrays suitable for serializing as JSON.</p></li></ul><div class="div3"><h4><a id="json-to-maps-and-arrays"></a>17.4.1 <a href="#json-to-maps-and-arrays" style="text-decoration: none">Representing JSON using maps and arrays</a></h4><p>This section defines a mapping from JSON data to XDM maps and arrays. Two functions are available to support this mapping: <a href="#func-parse-json"><code>fn:parse-json</code></a> and <a href="#func-serialize"><code>fn:serialize</code></a> (with options selecting JSON as the output method). The <a href="#func-parse-json"><code>fn:parse-json</code></a> function will accept any JSON text as input, and converts it to XDM data values. The <a href="#func-serialize"><code>fn:serialize</code></a> function (with JSON as the output method) will accept any XDM value produced using <a href="#func-parse-json"><code>fn:parse-json</code></a> and convert it back to the original JSON text (subject to insignificant variations such as reordering the properties in a JSON object). </p><div class="note"><p class="prefix"><b>Note:</b></p><p>The conversion is lossless if recommended JSON good practice is followed. Information may however be lost if (a) JSON numbers are not exactly representable as double-precision floating point, or (b) duplicate key values appear within a JSON object.</p></div><p>The representation of JSON data produced by the <a href="#func-parse-json"><code>fn:parse-json</code></a> function has been chosen with ease of manipulation as a design aim. For example, a simple JSON object such as <code>{ "Sun": 1, "Mon": 2, "Tue": 3, ... }</code> produces a simple map, so if the result of parsing is held in <code>$weekdays</code>, the number for a given weekday can be extracted using an expression such as <code>$weekdays?Tue</code>. Similarly, a simple array such as <code>[ "Sun", "Mon", "Tue", ... ]</code> produces an array that can be addressed as, for example, <code>$weekdays(3)</code>. A more deeply nested structure can be addressed in a similar way: for example if the JSON text is an array of person objects, each of which has a property named <code>phones</code> which is an array of strings containing phone numbers, then the first phone number of each person in the data can be addressed as <code>$data?phones(1)</code>.</p></div><div class="div3"><h4><a id="json-to-xml-mapping"></a>17.4.2 <a href="#json-to-xml-mapping" style="text-decoration: none">XML Representation of JSON</a></h4><p>This section defines a mapping from JSON data to XML (specifically, to XDM element and attribute nodes). A function <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a> is provided to take a JSON string as input and convert it to the XML representation, and a second function <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> performs the reverse operation.</p><p>The XML representation is designed to be capable of representing any valid JSON text including one that uses characters which are not valid in XML. The transformation is normally lossless: that is, distinct JSON texts convert to distinct XML representations. When converting JSON to XML, options are provided to reject unsupported characters, to replace them with a substitute character, or to leave them in backslash-escaped form.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The conversion is lossless if recommended JSON good practice is followed. Information may however be lost if (a) JSON numbers are not exactly representable as double-precision floating point, or (b) duplicate key values appear within a JSON object.</p></div><p>The following example demonstrates the correspondence of a JSON text and the corresponding XML representation. </p><div class="example"><div class="exampleHeader"><a id="d5e73975"></a><a id="d5e73993"></a>Example: A JSON Text and its XML Representation</div><p>Consider the following JSON text:</p><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "desc"    : "Distances between several cities, in kilometers.",
  "updated" : "2014-02-04T18:50:45",
  "uptodate": true,
  "author"  : null,
  "cities"  : {
    "Brussels": [
      { "to": "London",    "distance": 322 },
      { "to": "Paris",     "distance": 265 },
      { "to": "Amsterdam", "distance": 173 }
    ],
    "London": [
      { "to": "Brussels",  "distance": 322 },
      { "to": "Paris",     "distance": 344 },
      { "to": "Amsterdam", "distance": 358 }
    ],
    "Paris": [
      { "to": "Brussels",  "distance": 265 },
      { "to": "London",    "distance": 344 },
      { "to": "Amsterdam", "distance": 431 }
    ],
    "Amsterdam": [
      { "to": "Brussels",  "distance": 173 },
      { "to": "London",    "distance": 358 },
      { "to": "Paris",     "distance": 431 }
    ]
  }
}</pre></div><p>The XML representation of this text is as follows. Whitespace is included in the XML representation for purposes of illustration, but it will not necessarily be present in the output of the <a href="#func-json-to-xml"><code>json-to-xml</code></a> function.</p><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;string key="desc"&gt;Distances between several cities, in kilometers.&lt;/string&gt;
  &lt;string key="updated"&gt;2014-02-04T18:50:45&lt;/string&gt;
  &lt;boolean key="uptodate"&gt;true&lt;/boolean&gt;
  &lt;null key="author"/&gt;
  &lt;map key="cities"&gt;
    &lt;array key="Brussels"&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;London&lt;/string&gt;
        &lt;number key="distance"&gt;322&lt;/number&gt;
      &lt;/map&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;Paris&lt;/string&gt;
        &lt;number key="distance"&gt;265&lt;/number&gt;
      &lt;/map&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;Amsterdam&lt;/string&gt;
        &lt;number key="distance"&gt;173&lt;/number&gt;
      &lt;/map&gt;
    &lt;/array&gt;
    &lt;array key="London"&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;Brussels&lt;/string&gt;
        &lt;number key="distance"&gt;322&lt;/number&gt;
      &lt;/map&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;Paris&lt;/string&gt;
        &lt;number key="distance"&gt;344&lt;/number&gt;
      &lt;/map&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;Amsterdam&lt;/string&gt;
        &lt;number key="distance"&gt;358&lt;/number&gt;
      &lt;/map&gt;
    &lt;/array&gt;
    &lt;array key="Paris"&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;Brussels&lt;/string&gt;
        &lt;number key="distance"&gt;265&lt;/number&gt;
      &lt;/map&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;London&lt;/string&gt;
        &lt;number key="distance"&gt;344&lt;/number&gt;
      &lt;/map&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;Amsterdam&lt;/string&gt;
        &lt;number key="distance"&gt;431&lt;/number&gt;
      &lt;/map&gt;
    &lt;/array&gt;
    &lt;array key="Amsterdam"&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;Brussels&lt;/string&gt;
        &lt;number key="distance"&gt;173&lt;/number&gt;
      &lt;/map&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;London&lt;/string&gt;
        &lt;number key="distance"&gt;358&lt;/number&gt;
      &lt;/map&gt;
      &lt;map&gt;
        &lt;string key="to"&gt;Paris&lt;/string&gt;
        &lt;number key="distance"&gt;431&lt;/number&gt;
      &lt;/map&gt;
    &lt;/array&gt;
  &lt;/map&gt;
&lt;/map&gt;</pre></div></div><p>An XSD 1.0 schema for the XML representation is provided in <a href="#schema-for-json"><b>D.2 Schema for the result of fn:json-to-xml</b></a>. It is not necessary to import this schema into the static context unless the stylesheet or query makes explicit reference to the components defined in the schema. If the stylesheet or query does import a schema for the namespace <code>http://www.w3.org/2005/xpath-functions</code>, then:</p><ol class="enumar"><li><p>Unless the host language specifies otherwise, the processor (if it is schema-aware) <span class="verb">must</span> recognize an import declaration for this namespace, whether or not a schema location is supplied.</p></li><li><p>If a schema location is provided, then the schema document at that location <span class="verb">must</span> be equivalent to the schema document at <a href="#schema-for-json"><b>D.2 Schema for the result of fn:json-to-xml</b></a>; the effect if it is not equivalent is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a></p></li></ol><p>The rules governing the mapping from JSON to XML are as follows. In these rules, the phrase “an element named N” is to be interpreted as meaning “an element node whose local name is N and whose namespace URI is <code>http://www.w3.org/2005/xpath-functions</code>”.</p><ol class="enumar"><li><p>The JSON value <code>null</code> is represented by an element named <code>null</code>, with empty content.</p></li><li><p>The JSON values <code>true</code> and <code>false</code> are represented by an element named <code>boolean</code>, with content conforming to the type <code>xs:boolean</code>. When the element is created by the <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a> function, the string value of the element will be <code>true</code> or <code>false</code>. The <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> function also recognizes other strings that validate as <code>xs:boolean</code>, for example <code>1</code> and <code>0</code>. Leading and trailing whitespace is accepted. </p></li><li><p>A JSON number is represented by an element named <code>number</code>, with content conforming to the type <code>xs:double</code>, with the additional restriction that the value must not be positive or negative infinity, nor <code>NaN</code>. The <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a> function creates an element whose string value is lexically the same as the JSON representation of the number. The <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> function generates a JSON representation that is the result of casting the (typed or untyped) value of the node to <code>xs:double</code> and then casting the result to <code>xs:string</code>. Leading and trailing whitespace is accepted. Since JSON does not impose limits on the range or precision of numbers, these rules mean that conversion from JSON to XML will always succeed, and will retain full precision in the lexical representation unless the data model implementation is one that reconstructs the string value from the typed value. In the reverse direction, conversion from XML to JSON may fail if the value is infinity or <code>NaN</code>, or if the string value is such that casting to <code>xs:double</code> produces positive or negative infinity. </p></li><li><p>A JSON string is represented by an element named <code>string</code>, with content conforming to the type <code>xs:string</code>. The <code>string</code> element has two alternative representations: escaped form, and unescaped form.</p></li><li><p>A JSON array is represented by an element named <code>array</code>. The content is a sequence of child elements representing the members of the array in order, each such element being the representation of the array member obtained by applying these rules recursively.</p></li><li><p>A JSON object is represented by an element named <code>map</code>. The content is a sequence of child elements each of which represents one of the name/value pairs in the object. The representation of the name/value pair <var>N:V</var> is obtained by taking the element that represents the value <var>V</var> (by applying these rules recursively) and adding an attribute with name <code>key</code> (in no namespace), whose value is <var>N</var> as an instance of <code>xs:string</code>. The functions <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a> and <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> both retain the order of entries, subject to rules about how duplicate keys are handled. The key may be represented in escaped or unescaped form.</p></li></ol><p>The attribute <code>escaped="true"</code> may be specified on a <code>string</code> element to indicate that the string value contains backslash-escaped characters that are to be interpreted according to the JSON rules. The attribute <code>escaped-key="true"</code> may be specified on any element with a <code>key</code> attribute to indicate that the key contains backslash-escaped characters that are to be interpreted according to the JSON rules. Both attributes have the default value <code>false</code>, signifying that the relevant value is in unescaped form. In unescaped form, the backslash character has no special significance (it represents itself).</p><p>The JSON grammar for <code>number</code> is a subset of the lexical space of the XSD type <code>xs:double</code>. The mapping from JSON <code>number</code> values to <code>xs:double</code> values is defined by the XPath rules for casting from <code>xs:string</code> to <code>xs:double</code>. Note that these rules will never generate an error for out-of-range values; instead very large or very small values will be converted to <code>+INF</code> or <code>-INF</code>. Since JSON does not impose limits on the range or precision of numbers, the conversion is not guaranteed to retain full precision.</p><p>Although the order of entries in a JSON object is generally considered to have no significance, the functions <code>json-to-xml</code> and <code>xml-to-json</code> both retain order.</p><p>The XDM representation of a JSON value may either be untyped (all elements annotated as <code>xs:untyped</code>, attributes as <code>xs:untypedAtomic</code>), or it may be typed. If it is typed, then it <span class="verb">must</span> have the type annotations obtained by validating the untyped representation against the schema given in <a href="#schema-for-json"><b>D.2 Schema for the result of fn:json-to-xml</b></a>. If it is untyped, then it <span class="verb">must</span> be an XDM instance such that validation against this schema would succeed; with the proviso that all attributes other than those in no namespace or in namespace <code>http://www.w3.org/2005/xpath-functions</code> are ignored, including attributes such as <code>xsi:type</code> and <code>xsi:nil</code> that would normally influence the process of schema validation.</p><p>The namespace prefix associated with the namespace <code>http://www.w3.org/2005/xpath-functions</code> (if any) is immaterial. The effect of the <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> function does not depend on the choice of prefix, and the prefix (if any) generated by the <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a> function is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p></div><div class="div3"><h4><a id="json-character-repertoire"></a>17.4.3 <a href="#json-character-repertoire" style="text-decoration: none">JSON character repertoire</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-parse-json">next</a> | <a href="#func-html-doc">previous</a>)</p><ol><li><p> The rules regarding use of non-XML characters in JSON texts have been relaxed. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/414">414</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/546">546</a>&nbsp;25 July 2023]</i></p></li></ol></div><p>The set of characters that may appear in JSON texts is not the same as the set of characters allowed in XML. Specifically:</p><ul><li><p>As plain unescaped characters, JSON allows any codepoint in the numeric range 0x20 to 0x10FFFF, with the exception of <span class="unicode-codepoint">U+0022</span> (<span class="unicode-name">QUOTATION MARK</span>, <code>"</code>) and <span class="unicode-codepoint">U+005C</span> (<span class="unicode-name">REVERSE SOLIDUS, BACKSLASH</span>, <code>\</code>) .</p></li><li><p>As a backslash-escaped character, JSON allows any codepoint in the numeric range 0x00 to 0xFFFF.</p></li><li><p>Whether escaped or not, the JSON grammar allows codepoints in the surrogate range to appear, and does not explicitly require that they be properly paired. However, the JSON specifications recognize that unpaired surrogates are likely to lead to interoperability problems.</p></li></ul><p>Ignoring unpaired surrogates, this means that JSON allows codepoints that are not allowed by XML:</p><ul><li><p>Not allowed by XML 1.0: 0x00 to 0x1F (other than 0x09, 0x0A, and 0x0D); 0xFFFE; 0xFFFF.</p></li><li><p>Not allowed by XML 1.1: 0x00; 0xFFFE; 0xFFFF.</p></li></ul><p>The XDM data model (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#xml-and-xsd-versions">4.1.5 XML and XSD Versions</a>) allows an implementation to define the set of <a title="permitted character" class="termref" href="#dt-permitted-character">permitted characters</a> in the <code>xs:string</code> data type in such a way that any Unicode codepoint assigned to a character (which excludes surrogates) is allowed. However, this is not required: a conformant implementation <span class="verb">may</span> restrict the set of codepoints to those permitted by XML 1.0 or XML 1.1.</p><p>In consequence, parsing of conformant JSON texts may fail if they contain codepoints that the implementation does not support. However, if such codepoints are represented in the input using JSON escape sequences, these specifications define mechanisms for dealing with them, for example by substituting a replacement character.</p></div><div class="div3"><h4><a id="func-parse-json"></a>17.4.4 <a href="#func-parse-json" style="text-decoration: none">fn:parse-json</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-json-doc">next</a> | <a href="#json-character-repertoire">previous</a>)</p><ol><li><p>The rules regarding use of non-XML characters in JSON texts have been relaxed.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/414">414</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/546">546</a>&nbsp;25 July 2023]</i></p></li><li><p>An option is provided to control how the JSON <code>null</code> value should be handled.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/960">960</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1028">1028</a>&nbsp;20 February 2024]</i></p></li><li><p>An option is provided to control how JSON numbers should be formatted.<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/973">973</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1037">1037</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/975">975</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1058">1058</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1246">1246</a>&nbsp;12 March 2024]</i></p></li><li><p>It is now recommended that out-of-range <code>xs:double</code> values should translate to positive or negative infinity.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/641">641</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2387">2387</a>&nbsp;16 January 2026]</i></p></li><li><p>The default for the <code>escape</code> option has been changed to <code>false</code>. The 3.1 specification gave the default value as <code>true</code>, but this appears to have been an error, since it was inconsistent with examples given in the specification and with tests in the test suite.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1555">1555</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1565">1565</a>&nbsp;11 November 2024]</i></p></li><li><p>The order of entries in maps is retained.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1651">1651</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703</a>&nbsp;14 January 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Parses input supplied in the form of a JSON text, returning the results typically in the form of a map or array.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parse-json</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the second argument is omitted or the empty sequence, the result is the same as calling the two-argument form with the empty map as the value of the <code>$options</code> argument.</p><p>The first argument is a JSON text as defined in <a href="#rfc7159">[RFC 7159]</a>, in the form of a string or binary value. The function parses this input to return an XDM value.</p><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>If the input is <code>"null"</code>, the result will also be an empty sequence.</p></div><p>The <code>$options</code> argument can be used to control the way in which the parsing takes place. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>The entries that may appear in the <code>$options</code> map are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">liberal?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">duplicates?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">escape?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">fallback?</code></td><td><code class="as">as&nbsp;</code><code>(fn(xs:string) as xs:anyAtomicType)?</code>,</td></tr><tr class="arg"><td><code class="opt">null?</code></td><td><code class="as">as&nbsp;</code><code>item()*</code>,</td></tr><tr class="arg"><td><code class="opt">number-parser?</code></td><td><code class="as">as&nbsp;</code><code>(fn(xs:untypedAtomic) as item()?)?</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td rowspan="3"><p><code>liberal?</code></p></td><td class="fos-thick" colspan="2">Determines whether deviations from the syntax of RFC7159 are permitted. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td> The input <span class="verb">must</span> consist of <span>an optional byte order mark (which is ignored) followed by</span> a string that conforms to the grammar of <code>JSON-text</code> in <a href="#rfc7159">[RFC 7159]</a>. An error <span class="verb">must</span> be raised [<a href="#ERRFOJS0001" title="err:FOJS0001">err:FOJS0001</a>] if the input does not conform to the grammar. </td></tr><tr><td class="fos-thick"><code>true</code></td><td> The input <span class="verb">may</span> contain deviations from the grammar of <a href="#rfc7159">[RFC 7159]</a>, which are handled in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way. (Note: some popular extensions include allowing quotes on keys to be omitted, allowing a comma to appear after the last item in an array, allowing leading zeroes in numbers, and allowing control characters such as tab and newline to be present in unescaped form.) Since the extensions accepted are implementation-defined, an error <span class="verb">may</span> be raised [<a href="#ERRFOJS0001" title="err:FOJS0001">err:FOJS0001</a>] if the input does not conform to the grammar. </td></tr><tr><td rowspan="4"><p><code>duplicates?</code></p></td><td class="fos-thick" colspan="2">Determines the policy for handling duplicate keys in a JSON object. To determine whether keys are duplicates, they are compared using the Unicode codepoint collation, after expanding escape sequences, unless the <span><code>escape</code> option is set to <code>true</code></span>, in which case keys are compared in escaped form. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>use-first</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>reject</code></td><td> An error is raised [<a href="#ERRFOJS0003" title="err:FOJS0003">err:FOJS0003</a>] if duplicate keys are encountered. </td></tr><tr><td class="fos-thin"><code>use-first</code></td><td> If duplicate keys are present in a JSON object, all but the first of a set of duplicates are ignored. </td></tr><tr><td class="fos-thick"><code>use-last</code></td><td> If duplicate keys are present in a JSON object, all but the last of a set of duplicates are ignored. </td></tr><tr><td rowspan="3"><p><code>escape?</code></p></td><td class="fos-thick" colspan="2">Determines whether special characters are represented in the XDM output in backslash-escaped form. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td> Any <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a> in the input, whether or not it is represented in the input by means of an escape sequence, is represented as an unescaped character in the result. Any other character or codepoint (for example, an unpaired surrogate) is passed to the <code>fallback</code> function as described below; in the absence of a fallback function, it is replaced by <span class="unicode-codepoint">U+FFFD</span> (<span class="unicode-name">REPLACEMENT CHARACTER</span>, <code>�</code>) . </td></tr><tr><td class="fos-thick"><code>true</code></td><td> JSON escape sequences are used in the result to represent special characters in the JSON input, as defined below, whether or not they were represented using JSON escape sequences in the input. The characters that are considered “special” for this purpose are: <ul><li><p>all codepoints in the range <span class="unicode-codepoint">U+0000</span> (<span class="unicode-name">NULL</span>) to <span class="unicode-codepoint">U+001F</span> (<span class="unicode-name">IS1</span>) or <span class="unicode-codepoint">U+007F</span> (<span class="unicode-name">DELETE</span>) to <span class="unicode-codepoint">U+009F</span> (<span class="unicode-name">APC</span>) ;</p></li><li><p>all codepoints that do not represent <a title="permitted character" class="termref" href="#dt-permitted-character">permitted characters</a>, including codepoints representing unpaired surrogates;</p></li><li><p>the character <span class="unicode-codepoint">U+005C</span> (<span class="unicode-name">REVERSE SOLIDUS, BACKSLASH</span>, <code>\</code>) itself.</p></li></ul> Such characters are represented using a two-character escape sequence where available (for example, <code>\t</code>), or a six-character escape sequence otherwise (for example <code>\uDEAD</code>). Characters other than these are not escaped in the result, even if they were escaped in the input. </td></tr><tr><td rowspan="2"><p><code>fallback?</code></p></td><td class="fos-thick" colspan="2"> Provides a function which is called when the input contains an escape sequence that represents a character that is not a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. It is an error to supply the <code>fallback</code> option if the <code>escape</code> option is present with the value <code>true</code>. <ul><li><p><b>Type: </b><code>(fn(xs:string) as xs:anyAtomicType)?</code></p></li><li><p><b>Default: </b><code>fn { char(0xFFFD) }</code></p></li></ul></td></tr><tr><td class="fos-thick"><code>User-supplied function</code></td><td> The function is called when the JSON input contains character that is not a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a> It is called once for any surrogate that is not properly paired with another surrogate. The untyped atomic item supplied as the argument will always be a two- or six-character escape sequence, starting with a backslash, that conforms to the rules in the JSON grammar (as extended by the implementation if <code>liberal:true()</code> is specified): for example <code>\b</code> or <code>\uFFFF</code> or <code>\uDEAD</code>. <p>By default, the escape sequence is replaced with the Unicode <code>REPLACEMENT CHARACTER</code>. The function is <em>not</em> called for an escape sequence that is invalid against the grammar (for example <code>\x0A</code>). The string, which results from invoking <a href="#func-string"><code>fn:string</code></a> on the result of the function, is inserted into the result in place of the invalid character. The function also has the option of raising a dynamic error by calling <a href="#func-error"><code>fn:error</code></a>.</p></td></tr><tr><td rowspan="2"><p><code>null?</code></p></td><td class="fos-thick" colspan="2">Determines how the JSON <code>null</code> value should be represented. <ul><li><p><b>Type: </b><code>item()*</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td class="fos-thick"><code>Value</code></td><td> The supplied XDM value is used to represent the JSON <code>null</code> value. The default representation of <code>null</code> is the empty sequence, which works well in cases where setting a property of an object to <code>null</code> has the same meaning as omitting the property. It works less well in cases where <code>null</code> is used with some other meaning, because expressions such as the lookup operator <code>?</code> flatten the result to a single sequence of items, which means that any entries whose value is the empty sequence effectively disappear. The property can be set to any XDM value; a suggested value is the <code>xs:QName</code> value <code>fn:QName("http://www.w3.org/2005/xpath-functions", "null")</code>, which is recognized by the JSON serialization method as representing the JSON value <code>null</code>. </td></tr><tr><td rowspan="2"><p><code>number-parser?</code></p></td><td class="fos-thick" colspan="2">Determines how numeric values should be processed. <ul><li><p><b>Type: </b><code>(fn(xs:untypedAtomic) as item()?)?</code></p></li><li><p><b>Default: </b><code>xs:double#1</code></p></li></ul></td></tr><tr><td class="fos-thick"><code>User-supplied function</code></td><td> The supplied function is called to process the string value of any JSON number in the input. By default, numbers are processed by converting to <code>xs:double</code> using the XPath casting rules. Supplying the value <code>xs:decimal#1</code> will instead convert to <code>xs:decimal</code> (which potentially retains more precision, but disallows exponential notation), while supplying a function that casts to <code>(xs:decimal | xs:double)</code> will treat the value as <code>xs:decimal</code> if there is no exponent, or as <code>xs:double</code> otherwise. Supplying the value <a href="#func-identity"><code>fn:identity#1</code></a> causes the value to be retained unchanged as an <code>xs:untypedAtomic</code>. If the <code>liberal</code> option is <code>false</code> (the default), then the supplied <code>number-parser</code> is called if and only if the value conforms to the JSON grammar for numbers (for example, a leading plus sign and redundant leading zeroes are not allowed). If the <code>liberal</code> option is <code>true</code> then it is also called if the value conforms to an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> extension of this grammar. </td></tr></tbody></table><p>The various structures that can occur in JSON are transformed recursively to XDM values as follows:</p><ol class="enumar"><li><p>A JSON <em>object</em> is converted to a map. The entries in the map correspond to the key/value pairs in the JSON object. The key is always of type <code>xs:string</code>; the associated value may be of any type, and is the result of converting the JSON value by recursive application of these rules. For example, the JSON text <code>{ "x": 2, "y": 5 }</code> is transformed to the value <code>{ "x": 2, "y": 5 }</code>.</p><p>If duplicate keys are encountered in a JSON <em>object</em>, they are handled as determined by the <code>duplicates</code> option defined above.</p><p>The order of entries is retained.</p></li><li><p>A JSON <em>array</em> is transformed to an array whose members are the result of converting the corresponding member of the array by recursive application of these rules. For example, the JSON text <code>[ "a", "b", null ]</code> is transformed (by default) to the value <code>[ "a", "b", () ]</code>.</p></li><li><p>A JSON <em>string</em> is converted to an <code>xs:string</code> value. <span>The handling of special characters depends on the <code>escape</code> and <code>fallback</code> options, as described in the table above.</span></p></li><li><p>A JSON <em>number</em> is <span>processed using the function supplied in the <code>number-parser</code> option; by default it is</span> converted to an <code>xs:double</code> value using the rules for casting from <code>xs:string</code> to <code>xs:double</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The casting rules leave implementations some flexibility as to how values should be handled when they are too large to represent as an <code>xs:double</code>. It is <span class="verb">recommended</span> that when parsing JSON, out-of-range values should be converted to positive or negative infinity. This option enables round-tripping behavior, since the JSON serialization method represents positive and negative infinity as <code>1e9999</code> or <code>-1e9999</code> respectively.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>Round-tripping of NaN can be achieved by setting the option <code>"null": number("NaN")</code></p></div></li><li><p>The JSON <em>boolean</em> values <code>true</code> and <code>false</code> are converted to the corresponding <code>xs:boolean</code> values.</p></li><li><p>The JSON value <em>null</em> is converted to the value given by the <code>null</code> option, which defaults to an empty sequence.</p></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error [<a href="#ERRFOJS0001" title="err:FOJS0001">err:FOJS0001</a>] occurs if the value of <code>$value</code> does not conform to the JSON grammar, unless the option <code>"liberal":true()</code> is present and the processor chooses to accept the deviation.</p><p>A dynamic error [<a href="#ERRFOJS0003" title="err:FOJS0003">err:FOJS0003</a>] occurs if the option <code>"duplicates": "reject"</code> is present and the value of <code>$value</code> contains a JSON object with duplicate keys.</p><p>A dynamic error [<a href="#ERRFOJS0005" title="err:FOJS0005">err:FOJS0005</a>] occurs if the <code>$options</code> map contains an entry whose key is defined in this specification and whose value is not valid for that key, or if it contains an entry with the key <code>fallback</code> when the option <code>"escape":true()</code> is also present.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The result of the function will be an instance of one of the following types. An <code>instance of</code> test (or in XQuery, <code>typeswitch</code>) can be used to distinguish them:</p><ul><li><p><code>map(xs:string, item()?)</code> for a JSON object</p></li><li><p><code>array(item()?)</code> for a JSON array</p></li><li><p><code>xs:string</code> for a JSON string</p></li><li><p><code>xs:double</code> for a JSON number</p></li><li><p><code>xs:boolean</code> for a JSON boolean</p></li><li><p><code>empty-sequence()</code> for a JSON null (or for empty input)</p></li></ul><p>If the source of the JSON input is a resource accessible by URI, then it may be preferable to use the <a href="#func-json-doc"><code>fn:json-doc</code></a> function. If the source is a binary value (<code>xs:hexBinary</code> or <code>xs:base64Binary</code>) then this can first be decoded as a string using the functions <a href="https://qt4cg.org/specifications/EXPath/binary-40/Overview.html#func-bin-infer-encoding"><code>bin:infer-encoding</code></a> and <a href="https://qt4cg.org/specifications/EXPath/binary-40/Overview.html#func-bin-decode-string"><code>bin:decode-string</code></a>.</p><p>If the input starts with a byte order mark, this function ignores it. The byte order mark may have been added to the data stream in order to facilitate decoding of an octet stream to a character string, but since this function takes a character string as input, the byte order mark serves no useful purpose.</p><p>The possibility of the input containing characters that are not valid in XML (for example, unpaired surrogates) arises only when such characters are expressed using JSON escape sequences. This is because the input to the function is an instance of <code>xs:string</code>, which by definition (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#xml-and-xsd-versions">4.1.5 XML and XSD Versions</a>) cannot contain unpaired surrogates.</p><p>The serializer provides an option to output data in <b>json-lines</b> format. This is a format for structured data containing one JSON value (usually but not necessarily a JSON object) on each line. There is no corresponding option to parse <b>json-lines</b> input, but this can be achieved using the expression <code>unparsed-text-lines($uri) =!&gt; parse-json()</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-json('{ "x": 1, "y": [ 3, 4, 5 ] }')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>{ "x": 1e0, "y": [ 3e0, 4e0, 5e0 ] }</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-json('"abcd"')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"abcd"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>parse-json('{ "x": "\\", "y": "\u0025" }')</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>{ "x": "\", "y": "%" }</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-json(
  '{ "x": "\\", "y": "\u0025" }',
  { 'escape': true() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "x": "\\", "y": "%" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-json(
  '{ "x": "\\", "y": "\u0000" }'
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "x": "\", "y": char(0xFFFD) }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-json(
  '{ "x": "\\", "y": "\u0000" }',
  { 'escape': true() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "x": "\\", "y": "\u0000" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-json(
  '{ "x": "\\", "y": "\u0000" }',
  { 'fallback': fn($s) { '[' || $s || ']' } }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">{ "x": "\", "y": "[\u0000]" }</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-json(
  "1984.2",
  { 'number-parser': fn { xs:integer(round(.)) } }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">1984</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-json(
  '[ 1, -1, 2 ]',
  { 'number-parser': fn  { boolean(. &gt;= 0) } }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ true(), false(), true() ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">parse-json('[ "a", null, "b" ]',
  { 'null': #fn:null }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "a", #fn:null, "b" ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-json-doc"></a>17.4.5 <a href="#func-json-doc" style="text-decoration: none">fn:json-doc</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-xml-to-json">next</a> | <a href="#func-parse-json">previous</a>)</p><ol><li><p>Additional options are available, as defined by <a href="#func-parse-json"><code>fn:parse-json</code></a>.</p></li><li><p>It is no longer automatically an error if the input contains a codepoint that is not valid in XML. Instead, the codepoint must be a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. The set of permitted characters is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but it is <span class="verb">recommended</span> that all Unicode characters should be accepted.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/414">414</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/546">546</a>&nbsp;25 July 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Reads an external resource containing JSON, and returns the result of parsing the resource as JSON.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:json-doc</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>If the second argument is omitted or the empty sequence, the result is the same as calling the two-argument form with the empty map as the value of the <code>$options</code> argument.</p><p>The effect of the two-argument function call <code>fn:json-doc($H, $M)</code>is equivalent to the function composition <code>fn:unparsed-text($H) =&gt; fn:parse-json($M)</code>, except that:</p><ul><li><p>The function may accept a resource in any encoding. [RFC 7159] requires UTF-8, UTF-16, or UTF-32 to be accepted, but it is not an error if a different encoding is used. Unless external encoding information is available, the function must assume that the encoding is one of UTF-8, UTF-16, or UTF-32, and must distinguish these cases by examination of the initial octets of the resource.</p></li><li><p>Having established the encoding, the function must accept any codepoint that can validly occur in a JSON text, with the exception of unpaired surrogates.</p></li></ul><p>If <code>$source</code> is the empty sequence, the function returns the empty sequence.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div></dd><dt class="label">Error Conditions</dt><dd><p>The function may raise any error defined for the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> or <a href="#func-parse-json"><code>fn:parse-json</code></a> functions.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>An initial byte order mark is dropped, as with the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function.</p><p>If the input cannot be decoded (that is, converted into a sequence of Unicode codepoints, which may or may not represent characters), then a dynamic error occurs as with the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function.</p><p>If the input can be decoded, then the possibility still arises that the resulting sequence of codepoints includes codepoints that are not <a title="permitted character" class="termref" href="#dt-permitted-character">permitted characters</a>. Such codepoints are translated into JSON escape sequences (for example, <code>\uFFFF</code>), and the JSON escape sequence is then passed to the fallback function specified in the <code>$options</code> argument, which in turn defaults to a function that returns <span class="unicode-codepoint">xFFFD</span>.</p><p>The function <span class="verb">may</span> accept a resource in any encoding. <a href="#rfc7159">[RFC 7159]</a> requires UTF-8, UTF-16, or UTF-32 to be accepted, but it is not an error if a different encoding is used. The function detects the encoding using the same rules as the <a href="#func-unparsed-text"><code>unparsed-text</code></a> function, except that the special handling of media types such as <code>text/xml</code> and <code>application/xml</code> may be skipped.</p></div></dd></dl></div><div class="div3"><h4><a id="func-json-to-xml"></a>17.4.6 <a href="#func-json-to-xml" style="text-decoration: none">fn:json-to-xml</a></h4><dl><dt class="label">Summary</dt><dd><p>Parses a string supplied in the form of a JSON text, returning the results in the form of an XML <span>document node</span>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:json-to-xml</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>document-node(fn:*)?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>If the second argument is omitted or the empty sequence, the result is the same as calling the two-argument form with the empty map as the value of the <code>$options</code> argument.</p><p>The first argument is a JSON text as defined in <a href="#rfc7159">[RFC 7159]</a>, in the form of a string. The function parses this string to return an XDM node.</p><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>The <code>$options</code> argument can be used to control the way in which the parsing takes place. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>The entries that may appear in the <code>$options</code> map are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">liberal?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">duplicates?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">validate?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">escape?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">fallback?</code></td><td><code class="as">as&nbsp;</code><code>(fn(xs:string) as xs:anyAtomicType)?</code>,</td></tr><tr class="arg"><td><code class="opt">number-parser?</code></td><td><code class="as">as&nbsp;</code><code>(fn(xs:untypedAtomic) as item()?)?</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td rowspan="3"><p><code>liberal?</code></p></td><td class="fos-thick" colspan="2">Determines whether deviations from the syntax of RFC7159 are permitted. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td> The input <span class="verb">must</span> consist of <span>an optional byte order mark (which is ignored) followed by</span> a string that conforms to the grammar of <code>JSON-text</code> in <a href="#rfc7159">[RFC 7159]</a>. An error <span class="verb">must</span> be raised (see below) if the input does not conform to the grammar. </td></tr><tr><td class="fos-thick"><code>true</code></td><td> The input <span class="verb">may</span> contain deviations from the grammar of <a href="#rfc7159">[RFC 7159]</a>, which are handled in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way. (Note: some popular extensions include allowing quotes on keys to be omitted, allowing a comma to appear after the last item in an array, allowing leading zeroes in numbers, and allowing control characters such as tab and newline to be present in unescaped form.) Since the extensions accepted are implementation-defined, an error <span class="verb">may</span> be raised (see below) if the input does not conform to the grammar. </td></tr><tr><td rowspan="4"><p><code>duplicates?</code></p></td><td class="fos-thick" colspan="2">Determines the policy for handling duplicate keys in a JSON object. To determine whether keys are duplicates, they are compared using the Unicode codepoint collation, after expanding escape sequences, unless the <span><code>escape</code> option is set to <code>true</code></span>, in which case keys are compared in escaped form. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b>If <code>validate</code> is <code>true</code> then <code>reject</code>, otherwise <code>retain</code>.</p></li></ul></td></tr><tr><td class="fos-thin"><code>reject</code></td><td> An error is raised [<a href="#ERRFOJS0003" title="err:FOJS0003">err:FOJS0003</a>] if duplicate keys are encountered. </td></tr><tr><td class="fos-thin"><code>use-first</code></td><td> If duplicate keys are present in a JSON object, all but the first of a set of duplicates are ignored. </td></tr><tr><td class="fos-thick"><code>retain</code></td><td> If duplicate keys are present in a JSON object, the XML result of the function will also contain duplicates (making it invalid against the schema). This value is therefore incompatible with the option <code>validate=true</code> [<a href="#ERRFOJS0005" title="err:FOJS0005">err:FOJS0005</a>] </td></tr><tr><td rowspan="3"><p><code>validate?</code></p></td><td class="fos-thick" colspan="2">Determines whether the generated XML tree is schema-validated. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><a title="implementation-defined" class="termref" href="#implementation-defined">Implementation-defined</a>.</p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td> Indicates that the resulting XDM instance must be typed; that is, the element and attribute nodes must carry the type annotations that result from validation against the schema given at <a href="#schema-for-json"><b>D.2 Schema for the result of fn:json-to-xml</b></a>, or against an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> schema if the <code>liberal</code> option has the value <code>true</code>. </td></tr><tr><td class="fos-thick"><code>false</code></td><td> Indicates that the resulting XDM instance must be untyped. </td></tr><tr><td rowspan="3"><p><code>escape?</code></p></td><td class="fos-thick" colspan="2">Determines whether special characters are represented in the XDM output in backslash-escaped form. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td> All characters in the input that are valid in the version of XML supported by the implementation, whether or not they are represented in the input by means of an escape sequence, are represented as unescaped characters in the result. Any characters or codepoints that are not valid XML characters (for example, unpaired surrogates) <span>are passed to the <code>fallback</code> function as described below; in the absence of a fallback function, they are replaced by the character <span class="unicode-codepoint">U+FFFD</span> (<span class="unicode-name">REPLACEMENT CHARACTER</span>, <code>�</code>) </span>. The attributes <code>escaped</code> and <code>escaped-key</code> will not be present in the XDM output. </td></tr><tr><td class="fos-thick"><code>true</code></td><td> JSON escape sequences are used in the result to represent special characters in the JSON input, as defined below, whether or not they were represented using JSON escape sequences in the input. The characters that are considered “special” for this purpose are: <ul><li><p>all codepoints in the range <span class="unicode-codepoint">U+0000</span> (<span class="unicode-name">NULL</span>) to <span class="unicode-codepoint">U+001F</span> (<span class="unicode-name">IS1</span>) or <span class="unicode-codepoint">U+007F</span> (<span class="unicode-name">DELETE</span>) to <span class="unicode-codepoint">U+009F</span> (<span class="unicode-name">APC</span>) ;</p></li><li><p>all codepoints that do not represent characters that are valid in the version of XML supported by the processor, including codepoints representing unpaired surrogates;</p></li><li><p>the backslash character itself (<span class="unicode-codepoint">U+005C</span> (<span class="unicode-name">REVERSE SOLIDUS, BACKSLASH</span>, <code>\</code>) ).</p></li></ul> Such characters are represented using a two-character escape sequence where available (for example, <code>\t</code>), or a six-character escape sequence otherwise (for example <code>\uDEAD</code>). Characters other than these will not be escaped in the result, even if they were escaped in the input. In the result: <ul><li><p>Any <code>string</code> element whose string value contains a backslash character must have the attribute value <code>escaped="true"</code>.</p></li><li><p>Any element that contains a <code>key</code> attribute whose string value contains a backslash character must have the attribute <code>escaped-key="true"</code>.</p></li><li><p>The values of the <code>escaped</code> and <code>escaped-key</code> attributes are immaterial when there is no backslash present, and it is never necessary to include either attribute when its value is <code>false</code>.</p></li></ul></td></tr><tr><td rowspan="2"><p><code>fallback?</code></p></td><td class="fos-thick" colspan="2"> Provides a function which is called when the input contains an escape sequence that represents a character that is not valid in the version of XML supported by the implementation. It is an error to supply the <code>fallback</code> option if the <code>escape</code> option is present with the value <code>true</code>. <ul><li><p><b>Type: </b><code>(fn(xs:string) as xs:anyAtomicType)?</code></p></li><li><p><b>Default: </b><code>fn { char(0xFFFD) }</code></p></li></ul></td></tr><tr><td class="fos-thick"><code>User-supplied function</code></td><td> The function is called when the JSON input contains an escape sequence that is valid according to the JSON grammar, but which does not represent a character that is valid in the version of XML supported by the processor. In the case of surrogates, it is called once for any six-character escape sequence that is not properly paired with another surrogate. The untyped atomic item supplied as the argument will always be a two- or six-character escape sequence, starting with a backslash, that conforms to the rules in the JSON grammar (as extended by the implementation if <code>liberal:true()</code> is specified): for example <code>\b</code> or <code>\uFFFF</code> or <code>\uDEAD</code>. <p>By default, the escape sequence is replaced with the Unicode <code>REPLACEMENT CHARACTER</code>. The function is <em>not</em> called for an escape sequence that is invalid against the grammar (for example <code>\x0A</code>). The string, which results from invoking <a href="#func-string"><code>fn:string</code></a> on the result of the function, is inserted into the result in place of the invalid character. The function also has the option of raising a dynamic error by calling <a href="#func-error"><code>fn:error</code></a>.</p></td></tr><tr><td rowspan="2"><p><code>number-parser?</code></p></td><td class="fos-thick" colspan="2">Determines how numeric values should be processed. <ul><li><p><b>Type: </b><code>(fn(xs:untypedAtomic) as item()?)?</code></p></li><li><p><b>Default: </b><code>xs:identity#1</code></p></li></ul></td></tr><tr><td class="fos-thick"><code>User-supplied function</code></td><td> The supplied function is called to process the string value of any JSON number in the input. The string value of the <code>number</code> element generated in the result will be the value obtained by calling the supplied function, and then converting its result to a string by calling <a href="#func-string"><code>fn:string#1</code></a>. <p>By default, numbers are represented in the XML output exactly as they were written in the input. Supplying the value <code>xs:double#1</code> will cause the value to be convered to type <code>xs:double</code> (which will then be represented in the XML by converting the <code>xs:double</code> to a string). Similarly <code>xs:decimal#1</code> will convert to <code>xs:decimal</code> (which potentially retains more precision, but disallows exponential notation), while supplying a function that casts to <code>(xs:decimal | xs:double)</code> will treat the value as <code>xs:decimal</code> if there is no exponent, or as <code>xs:double</code> otherwise. The default value <a href="#func-identity"><code>fn:identity#1</code></a> causes the value to be retained unchanged as an <code>xs:untypedAtomic</code>. Before calling the supplied <code>number-parser</code>, the value is first checked to ensure that it conforms to the JSON grammar (for example, a leading plus sign and redundant leading zeroes are not allowed); these checks are disabled if the <code>liberal</code> option is set to <code>true</code>. Note that the option <code>validate=true</code> will cause the result to be validated as type <code>xs:double</code> (disallowing NaN and infinity).</p></td></tr></tbody></table><p>The various structures that can occur in JSON are transformed recursively to XDM values according to the rules given in <a href="#json-to-xml-mapping"><b>17.4.2 XML Representation of JSON</b></a>.</p><p>The function returns a document node, whose only child is the element node representing the outermost construct in the JSON text.</p><p>The function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic with respect to node identity</a>: that is, if the function is called twice with the same arguments, it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether the same node is returned on both occasions.</p><p>The base URI of the returned document node is taken from the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> of the function call.</p><p>The choice of namespace prefix (or absence of a prefix) in the names of constructed nodes is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p>The XDM tree returned by the function does not contain any unnecessary (albeit valid) nodes such as whitespace text nodes, comments, or processing instructions. It does not include any whitespace in the value of <code>number</code> or <code>boolean</code> element nodes, nor in the value of <code>escaped</code> or <code>escaped-key</code> attribute nodes.</p><p>If the result is typed, every element named <code>string</code> will have an attribute named <code>escaped</code> whose value is either <code>true</code> or <code>false</code>, and every element having an attribute named <code>key</code> will also have an attribute named <code>escaped-key</code> whose value is either <code>true</code> or <code>false</code>. </p><p>If the result is untyped, the attributes <code>escaped</code> and <code>escaped-key</code> will either be present with the value <code>true</code>, or will be absent. They will never be present with the value <code>false</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>An error is raised [<a href="#ERRFOJS0001" title="err:FOJS0001">err:FOJS0001</a>] if the value of <code>$value</code> does not conform to the JSON grammar as defined by <a href="#rfc7159">[RFC 7159]</a>, unless the option <code>"liberal":true()</code> is present and the processor chooses to accept the deviation. </p><p>An error is raised [<a href="#ERRFOJS0004" title="err:FOJS0004">err:FOJS0004</a>] if the value of the <code>validate</code> option is <code>true</code> and the processor does not support schema validation or typed data.</p><p>An error is raised [<a href="#ERRFOJS0005" title="err:FOJS0005">err:FOJS0005</a>] if the value of <code>$options</code> includes an entry whose key is defined in this specification, and whose value is not a permitted value for that key.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>To read a JSON file, this function can be used in conjunction with the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> function.</p><p>Many JSON implementations allow commas to be used after the last item in an object or array, although the specification does not permit it. The option <code>spec="liberal"</code> is provided to allow such deviations from the specification to be accepted. Some JSON implementations also allow constructors such as <code>new Date("2000-12-13")</code> to appear as values: specifying <code>spec="liberal"</code> allows such extensions to be accepted, but does not guarantee it. If such extensions are accepted, the resulting value is implementation-defined, and will not necessarily conform to the schema at <a href="#schema-for-json"><b>D.2 Schema for the result of fn:json-to-xml</b></a>.</p><p>If the input starts with a byte order mark, this function ignores it. The byte order mark may have been added to the data stream in order to facilitate decoding of an octet stream to a character string, but since this function takes a character string as input, the byte order mark serves no useful purpose.</p><p>The possibility of the input containing characters that are not valid in XML (for example, unpaired surrogates) arises only when such characters are expressed using JSON escape sequences. This is the only possibility because the input to the function is an instance of <code>xs:string</code>, which by definition can contain only those characters that are valid in XML.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">json-to-xml(
  '{ "x": 1, "y": [ 3, 4, 5 ] }',
  { "validate": false() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;number key="x"&gt;1&lt;/number&gt;
  &lt;array key="y"&gt;
   &lt;number&gt;3&lt;/number&gt;
   &lt;number&gt;4&lt;/number&gt;
   &lt;number&gt;5&lt;/number&gt;
  &lt;/array&gt;
&lt;/map&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">json-to-xml(
  '"abcd"',
  { 'liberal': false() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">&lt;string xmlns="http://www.w3.org/2005/xpath-functions"&gt;abcd&lt;/string&gt;</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">json-to-xml(
  '{ "x": "\\", "y": "\u0025" }',
  { "validate": false() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;string key="x"&gt;\&lt;/string&gt;
  &lt;string key="y"&gt;%&lt;/string&gt;
&lt;/map&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">json-to-xml(
  '{ "x": "\\", "y": "\u0025" }',
  { 'escape': true(), "validate": false() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;string escaped="true" key="x"&gt;\\&lt;/string&gt;
  &lt;string key="y"&gt;%&lt;/string&gt;
&lt;/map&gt;</pre></div><p>(with whitespace added for legibility)</p><p><em>(But see the detailed rules for alternative values of the <code>escaped</code> attribute on the second <code>string</code> element.)</em></p></td></tr><tr><td colspan="2"><p>The following example illustrates use of the <code>fallback</code> function to handle characters that are invalid in XML.</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $json := unparsed-text('http://example.com/endpoint')
let $options := {
  'liberal': true(),
  'fallback': fn($char as xs:string) as xs:string {
    let $c0chars := {
      '\u0000': '[NUL]',
      '\u0001': '[SOH]',
      '\u0002': '[STX]',
      ...
      '\u001E': '[RS]',
      '\u001F': '[US]'
    }
    let $replacement := $c0chars($char)
    return if (exists($replacement)) then (
      $replacement
    ) else (
      error( #err:invalid-char,
        'Error: ' || $char || ' is not a C0 control character.'
      )
    )
  }
}
return json-to-xml($json, $options)</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-xml-to-json"></a>17.4.7 <a href="#func-xml-to-json" style="text-decoration: none">fn:xml-to-json</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#csv-functions">next</a> | <a href="#func-json-doc">previous</a>)</p><ol><li><p>An option has been added to suppress the escaping of the solidus (forwards slash) character.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1347">1347</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1353">1353</a>&nbsp;3 September 2024]</i></p></li><li><p>Numbers now retain their original lexical form, except for any changes needed to satisfy JSON syntax rules (for example, stripping leading zero digits).<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1445">1445</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1455">1455</a>&nbsp;1 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Converts an XML tree, whose format corresponds to the XML representation of JSON defined in this specification, into a string conforming to the JSON grammar.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:xml-to-json</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>node()?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the second argument is omitted or the empty sequence, the result is the same as calling the two-argument form with the empty map as the value of the <code>$options</code> argument.</p><p>The first argument <code>$node</code> is a node; the subtree rooted at this node will typically be the XML representation of a JSON document as defined in <a href="#json-to-xml-mapping"><b>17.4.2 XML Representation of JSON</b></a>.</p><p>If <code>$node</code> is the empty sequence, the function returns the empty sequence.</p><p>The <code>$options</code> argument can be used to control the way in which the conversion takes place. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>The entries that may appear in the <code>$options</code> map are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">escape-solidus?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">indent?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td rowspan="3"><p><code>escape-solidus?</code></p></td><td class="fos-thick" colspan="2">Determines whether the character <span class="unicode-codepoint">U+002F</span> (<span class="unicode-name">SOLIDUS, FORWARD SLASH</span>, <code>/</code>) should be escaped as <code>\/</code>. By default the character is escaped, but this is only necessary when the resulting JSON is embedded in HTML. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td> The character <span class="unicode-codepoint">U+002F</span> (<span class="unicode-name">SOLIDUS, FORWARD SLASH</span>, <code>/</code>) is output as is, without escaping. </td></tr><tr><td class="fos-thick"><code>true</code></td><td> The character <span class="unicode-codepoint">U+002F</span> (<span class="unicode-name">SOLIDUS, FORWARD SLASH</span>, <code>/</code>) is escaped by preceding it with <span class="unicode-codepoint">U+005C</span> (<span class="unicode-name">REVERSE SOLIDUS, BACKSLASH</span>, <code>\</code>) . </td></tr><tr><td rowspan="3"><p><code>indent?</code></p></td><td class="fos-thick" colspan="2">Determines whether additional whitespace should be added to the output to improve readability. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td> The processor must not insert any insignificant whitespace between JSON tokens. </td></tr><tr><td class="fos-thick"><code>true</code></td><td> The processor <span class="verb">may</span> insert whitespace between JSON tokens in order to improve readability. The specification imposes no constraints on how this is done. </td></tr></tbody></table><p>The node supplied as <code>$node</code> must be one of the following: [<a href="#ERRFOJS0006" title="err:FOJS0006">err:FOJS0006</a>]</p><ol class="enumar"><li><p>An element node whose name matches the name of a global element declaration in the schema given in <a href="#schema-for-json"><b>D.2 Schema for the result of fn:json-to-xml</b></a> (“the schema”) and that is valid as defined below:</p><ol class="enumla"><li><p>If the type annotation of the element matches the type of the relevant element declaration in the schema (indicating that the element has been validated against the schema), then the element is considered valid. </p></li><li><p>Otherwise, the processor <span class="verb">may</span> attempt to validate the element against the schema, in which case it is treated as valid if and only if the outcome of validation is <b>valid</b>. </p></li><li><p>Otherwise (if the processor does not attempt validation using the schema), the processor <span class="verb">must</span> ensure that the content of the element, after stripping all attributes (at any depth) in namespaces other than <code>http://www.w3.org/2005/xpath-functions</code>, is such that validation against the schema would have an outcome of <b>valid</b>. </p><div class="note"><p class="prefix"><b>Note:</b></p><p>The process described here is not precisely equivalent to schema validation. For example, schema validation will fail if there is an invalid <code>xsi:type</code> or <code>xsi:nil</code> attribute, whereas this process will ignore such attributes. </p></div></li></ol></li><li><p>An element node <var>E</var> having a <code>key</code> attribute and/or an <code>escaped-key</code> attribute provided that <var>E</var> would satisfy one of the above conditions if the <code>key</code> and/or <code>escaped-key</code> attributes were removed.</p></li><li><p>A document node having exactly one element child and no text node children, where the element child satisfies one of the conditions above.</p></li></ol><p>Furthermore, <code>$node</code> must satisfy the following constraint (which cannot be conveniently expressed in the schema). Every element <var>M</var> that is a descendant-or-self of <code>$node</code> and has local name <code>map</code> and namespace URI <code>http://www.w3.org/2005/xpath-functions</code> must satisfy the following rule: there must not be two distinct children of <var>M</var> (say <var>C<sub>1</sub></var> and <var>C<sub>2</sub></var>) such that the normalized key of <var>C<sub>1</sub></var> is equal to the normalized key of <var>C<sub>2</sub></var>. The normalized key of an element <var>C</var> is as follows:</p><ul><li><p>If <var>C</var> has the attribute value <code>escaped-key="true"</code>, then the value of the <code>key</code> attribute of <var>C</var>, with all JSON escape sequences replaced by the corresponding Unicode characters according to the JSON escaping rules. </p></li><li><p>Otherwise (the <code>escaped-key</code> attribute of <var>C</var> is absent or set to <code>false</code>), the value of the <code>key</code> attribute of <var>C</var>.</p></li></ul><p>Nodes in the input tree are handled by applying the following rules, recursively. In these rules the phrase “an element named <var>N</var>” means “an element node whose local name is <var>N</var> and whose namespace URI is <code>http://www.w3.org/2005/xpath-functions</code>”.</p><ol class="enumar"><li><p>A document node having a single element node child is processed by processing that child.</p></li><li><p>An element named <code>null</code> results in the output <code>null</code>.</p></li><li><p>An element <code>$E</code> named <code>boolean</code> results in the output <code>true</code> or <code>false</code> depending on the result of <span><code>xs:boolean(fn:string($E))</code></span>.</p></li><li><p>An element <code>$E</code> named <code>number</code> is processed as follows.</p><p>The input is required to conform to the XSD rules defining a valid instance of <code>xs:double</code> (excluding infinity and <code>NaN</code>), while the output is required to conform to the JSON rules defining a valid JSON number. These rules are slightly different.</p><p>Specifically, the XSD rules require the value (after removing leading and trailing whitespace) to match the regular expression:</p><div class="exampleInner"><pre xml:space="preserve">(\+|-)?([0-9]+(\.[0-9]*)?|\.[0-9]+)([Ee](\+|-)?[0-9]+)?</pre></div><p>while the JSON rules require:</p><div class="exampleInner"><pre xml:space="preserve">-?(0|[1-9][0-9]*)(\.[0-9]+)?([Ee](\+|-)?[0-9]+)?</pre></div><p>If the input value does not match the required JSON format, it must therefore be adjusted by applying the following steps:</p><ul><li><p>Remove leading and trailing whitespace.</p></li><li><p>Remove any leading plus sign.</p></li><li><p>Remove any leading zero digits in the integer part, while ensuring that at least one digit remains.</p></li><li><p>If there is a decimal point that is not preceded by a digit, add a zero digit before the decimal point.</p></li><li><p>If there is a decimal point that is not followed by a digit, add a zero digit after the decimal point.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>The output uses exponential notation if and only if the input uses exponential notation.</p><p>The rules have changed since version 3.1 of this specification. In previous versions, the supplied number was cast to an <code>xs:double</code>, and then serialized using the rules of the <a href="#func-string"><code>fn:string</code></a> function. This resulted in JSON numbers using exponential notation for values outside the range 1e-6 to 1e6, and led to a loss of precision for 64-bit integer values. </p></div></li><li><p>An element named <code>string</code> results in the output of the string value of the element, enclosed in quotation marks, with any special characters in the string escaped as described below.</p></li><li><p>An element named <code>array</code> results in the output of the children of the <code>array</code> element, each processed by applying these rules recursively: the items in the resulting list are enclosed between square brackets, and separated by commas.</p></li><li><p>An element named <code>map</code> results in the output of a sequence of map entries corresponding to the children of the <code>map</code> element, enclosed between curly braces and separated by commas. Each entry comprises the value of the <code>key</code> attribute of the child element, enclosed in quotation marks and escaped as described below, followed by a colon, followed by the result of processing the child element by applying these rules recursively. The order of properties in the output JSON representation retains the order of the children of the <code>map</code> element.</p></li><li><p>Comments, processing instructions, and whitespace text node children of <code>map</code> and <code>array</code> are ignored.</p></li></ol><p>Strings are escaped as follows:</p><ol class="enumar"><li><p>If the attribute <code>escaped="true"</code> is present for a string value, or <code>escaped-key="true"</code> for a key value, then:</p><ol class="enumla"><li><p>any valid JSON escape sequence present in the string is copied unchanged to the output;</p></li><li><p>any invalid JSON escape sequence results in a dynamic error [<a href="#ERRFOJS0007" title="err:FOJS0007">err:FOJS0007</a>];</p></li><li><p>any unescaped occurrence of <span class="unicode-codepoint">U+0022</span> (<span class="unicode-name">QUOTATION MARK</span>, <code>"</code>) , <span class="unicode-codepoint">U+0008</span> (<span class="unicode-name">BACKSPACE</span>) , <span class="unicode-codepoint">U+000C</span> (<span class="unicode-name">FORM FEED</span>) , <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) , <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , <span class="unicode-codepoint">U+0009</span> (<span class="unicode-name">TAB</span>) , or (subject to the <code>escape-solidus</code> option) <span class="unicode-codepoint">U+002F</span> (<span class="unicode-name">SOLIDUS, FORWARD SLASH</span>, <code>/</code>) is replaced by <code>\"</code>, <code>\b</code>, <code>\f</code>, <code>\n</code>, <code>\r</code>, <code>\t</code>, <span>or <code>\/</code></span> respectively; </p></li><li><p>any other codepoint in the range 1-31 or 127-159 is replaced by an escape in the form \uHHHH where HHHH is the upper-case hexadecimal representation of the codepoint value.</p></li></ol></li><li><p>Otherwise (that is, in the absence of the attribute <code>escaped="true"</code> for a string value, or <code>escaped-key="true"</code> for a key value):</p><ol class="enumla"><li><p>any occurrence of backslash is replaced by <code>\\</code></p></li><li><p>any occurrence of <span class="unicode-codepoint">U+0022</span> (<span class="unicode-name">QUOTATION MARK</span>, <code>"</code>) , <span class="unicode-codepoint">U+0008</span> (<span class="unicode-name">BACKSPACE</span>) , <span class="unicode-codepoint">U+000C</span> (<span class="unicode-name">FORM FEED</span>) , <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) , <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , or <span class="unicode-codepoint">U+0009</span> (<span class="unicode-name">TAB</span>) is replaced by <code>\"</code>, <code>\b</code>, <code>\f</code>, <code>\n</code>, <code>\r</code>, or <code>\t</code> respectively; </p></li><li><p>any other codepoint in the range 1-31 or 127-159 is replaced by an escape in the form <code>\uHHHH</code> where <code>HHHH</code> is the upper-case hexadecimal representation of the codepoint value.</p></li></ol></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOJS0005" title="err:FOJS0005">err:FOJS0005</a>] if the value of <code>$options</code> includes an entry whose key is defined in this specification, and whose value is not a permitted value for that key.</p><p>A dynamic error is raised [<a href="#ERRFOJS0006" title="err:FOJS0006">err:FOJS0006</a>] if the value of <code>$node</code> is not a document or element node or is not valid according to the schema for the XML representation of JSON<span>, or if a <code>map</code> element has two children whose normalized key values are the same.</span></p><p>A dynamic error is raised [<a href="#ERRFOJS0007" title="err:FOJS0007">err:FOJS0007</a>] if the value of <code>$node</code> includes a string labeled with <code>escaped="true"</code>, or a key labeled with <code>escaped-key="true"</code>, where the content of the string or key contains an invalid JSON escape sequence: specifically, where it contains a backslash (<code>\</code>) that is not followed by one of the characters <code>"</code>, <code>\</code>, <code>/</code>, <code>b</code>, <code>f</code>, <code>n</code>, <code>r</code>, <code>t</code>, or <code>u</code>, or where it contains the characters <code>\u</code> not followed by four hexadecimal digits (that is <code>[0-9A-Fa-f]{4}</code>). </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The rule requiring schema validity has a number of consequences, including the following:</p><ol class="enumar"><li><p>The input cannot contain no-namespace attributes, or attributes in the namespace <code>http://www.w3.org/2005/xpath-functions</code>, except where explicitly allowed by the schema. Attributes in other namespaces, however, are ignored.</p></li><li><p>Nodes that do not affect schema validity, such as comments, processing instructions, namespace nodes, and whitespace text node children of <code>map</code> and <code>array</code>, are ignored.</p></li><li><p>Numeric values are restricted to those that are valid in JSON: the schema disallows positive and negative infinity and <code>NaN</code>.</p></li><li><p>Duplicate key values are not permitted. <span>Most cases of duplicate keys are prevented by the rules in the schema; additional cases (where the keys are equal only after expanding JSON escape sequences) are prevented by the prose rules of this function. For example, the key values <code>\n</code> and <code>\u000A</code> are treated as duplicates even though the rules in the schema do not treat them as such.</span></p></li></ol><p>The rule allowing the top-level element to have a <code>key</code> attribute (which is ignored) allows any element in the output of the <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a> function to be processed: for example, it is possible to take a JSON document, convert it to XML, select a subtree based on the value of a <code>key</code> attribute, and then convert this subtree back to JSON, perhaps after a transformation. The rule means that an element with the appropriate name will be accepted if it has been validated against one of the types <code>mapWithinMapType</code>, <code>arrayWithinMapType</code>, <code>stringWithinMapType</code>, <code>numberWithinMapType</code>, <code>booleanWithinMapType</code>, or <code>nullWithinMapType</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The input <code>&lt;array xmlns="http://www.w3.org/2005/xpath-functions"&gt;&lt;number&gt;1&lt;/number&gt;&lt;string&gt;is&lt;/string&gt;&lt;boolean&gt;1&lt;/boolean&gt;&lt;/array&gt;</code> produces the result <code>[ 1, "is", true ]</code>.</p></td></tr><tr><td colspan="2"><p>The input <code>&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;&lt;number key="Sunday"&gt;1&lt;/number&gt;&lt;number key="Monday"&gt;2&lt;/number&gt;&lt;/map&gt;</code> produces the result <code>{ "Sunday": 1, "Monday": 2 }</code>.</p></td></tr><tr><td colspan="2"><p>The input <code>&lt;array xmlns="http://www.w3.org/2005/xpath-functions"&gt;&lt;number&gt;10&lt;/number&gt;&lt;number&gt;17e2&lt;/number&gt;&lt;number&gt;0005&lt;/number&gt;&lt;/array&gt;</code> produces the result <code>[ 10, 17e2, 5 ]</code>.</p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="csv-functions"></a>17.5 <a href="#csv-functions" style="text-decoration: none">Functions on CSV Data</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-csv-to-arrays">next</a> | <a href="#func-xml-to-json">previous</a>)</p><ol><li><p> New functions are available for processing input data in CSV (comma separated values) format. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/413">413</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/533">533</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/719">719</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/834">834</a>]</i></p></li></ol></div><p>This section describes functions that parse CSV data.</p><p><span class="termdef"><a id="dt-csv"></a>[Definition] The term <b>comma separated values</b> or <b>CSV</b> refers to a wide variety of plain-text tabular data formats with fields and records separated by standard character delimiters (often, but not invariably, commas).</span></p><p>A CSV is a 2-dimensional tabular data structure consisting of multiple <b>rows</b> (also known as <b>records</b>). Each row contains multiple <b>fields</b>. Fields occupying the same position in successive rows constitute a <b>column</b>. Columns are identified by position and optionally by name. Column names can be assigned within a CSV using an optional <b>header row</b>.</p><p>CSV has developed informally for decades, and many variations are found. This specification refers to <a href="#rfc4180">[RFC 4180]</a>, which provides a standardized grammar. This specification extends the grammar defined in <a href="#rfc4180">[RFC 4180]</a> as follows:</p><ul><li><p>This specification uses the term <b>row</b> where RFC 4180 uses <b>record</b>.</p></li><li><p>Line endings are normalized: specifically, the character sequences <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , or <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) followed by <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) , are converted to a single <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) character. This applies whether or not the line ending appears within a quoted string, and whether or not <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) is the chosen row delimiter.</p></li><li><p>Row delimiters other than newline are recognized.</p></li><li><p>Field delimiters other than <span class="unicode-codepoint">U+002C</span> (<span class="unicode-name">COMMA</span>, <code>,</code>) are recognized.</p></li><li><p>Quote characters other than <span class="unicode-codepoint">U+0022</span> (<span class="unicode-name">QUOTATION MARK</span>, <code>"</code>) are recognized.</p></li><li><p>Non-ASCII characters are recognized.</p></li></ul><p>This specification defines a mapping from this extended grammar to constructs in the XDM model, and provides illustrative examples of how these constructs can be combined with other language features to process CSV data.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-csv-to-arrays"><code>fn:csv-to-arrays</code></a></td><td>Parses CSV data supplied as a string, returning the results in the form of a sequence of arrays of strings.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-parse-csv"><code>fn:parse-csv</code></a></td><td>Parses CSV data, returning the results in the form of a record containing information about the names in the header, as well as the data itself.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-csv-doc"><code>fn:csv-doc</code></a></td><td>Reads an external resource containing CSV, and returns the results as a record containing information about the names in the header, as well as the data itself.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-csv-to-xml"><code>fn:csv-to-xml</code></a></td><td>Parses CSV data supplied as a string, returning the results as an XML document, as described by <a href="#csv-represent-as-xml"><b>17.5.9 Representing CSV data as XML</b></a>.</td></tr></tbody></table><p>The most basic function for parsing CSV is <a href="#func-csv-to-arrays"><code>fn:csv-to-arrays</code></a> which recognizes the delimiters for rows and fields and returns a sequence of arrays each corresponding to one row. The fields within each array are represented as instances of <code>xs:string</code>.</p><p>The other two functions recognize column names, and make it easier to address individual fields using these names. The <code>parse-csv</code> function delivers this capability using XDM maps and functions, while <code>csv-to-xml</code> function represents the information using XDM element nodes.</p><div class="div3"><h4><a id="csv-delimiters"></a>17.5.1 <a href="#csv-delimiters" style="text-decoration: none">CSV delimiters</a></h4><p>The delimiters used for rows, columns, and quoting are configurable. An error is raised if the same delimiter string is used in multiple roles [<a href="#ERRFOCV0003" title="err:FOCV0003">err:FOCV0003</a>].</p><p>Rows in CSV files are typically delimited with CRLF (<span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ), LF (<span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ), or CR (<span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) ) line endings, although RFC 4180 specifies CRLF. The CSV parsing functions normalize these line endings to LF (<span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ). They therefore use LF as the default row delimiter. </p><p>The last row in the file may or may not be followed by a row delimiter. the empty file is treated as containing zero rows, while a file consisting solely of a row delimiter is treated as containing one empty row. In all other cases, a file that does not end with a row delimiter is treated as if a row delimiter were added at the end.</p><p>Fields in CSV are frequently delimited with a comma. Other field delimiters are useful, for example when numeric data uses comma as a decimal separator. The chosen field delimiter is then often <span class="unicode-codepoint">U+003B</span> (<span class="unicode-name">SEMICOLON</span>, <code>;</code>) or <span class="unicode-codepoint">U+0009</span> (<span class="unicode-name">TAB</span>) .</p><p>The column delimiter thus defaults to <span class="unicode-codepoint">U+002C</span> (<span class="unicode-name">COMMA</span>, <code>,</code>) . The value may be any single Unicode character. An error is raised if the <code>column-delimiter</code> option is set to a multi-character string.</p></div><div class="div3"><h4><a id="csv-field-quoting"></a>17.5.2 <a href="#csv-field-quoting" style="text-decoration: none">Field quoting</a></h4><p>CSVs, as specified in <a href="#rfc4180">[RFC 4180]</a>, require that fields be wrapped with a quote character if they contain either the row or column delimiter. For example:</p><div class="exampleInner"><pre xml:space="preserve">"A single field, containing a comma","another field containing CRLF
                  within it"</pre></div><p>If a field is to contain the quote character, the character must be escaped by doubling it, as with escaping of quotes in XPath string literals (see <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-literals">4.3.1 Literals</a>). An error is raised [<a href="#ERRFOCV0001" title="err:FOCV0001">err:FOCV0001</a>] if a quote character appears within a field incorrectly escaped, for example:</p><div class="exampleInner"><pre xml:space="preserve">incorrectly escaped " quote character</pre></div><p>The quotes surrounding quoted fields are not included in the result. The following input string, when parsed, produces a sequence of strings, as shown below:</p><div class="exampleInner"><pre xml:space="preserve">'"Field 1","Field 2","Field ""with quotes"" 3"'</pre></div><div class="exampleInner"><pre xml:space="preserve">('Field 1', 'Field 2', 'Field "with quotes" 3')</pre></div><p>The quote character defaults to <span class="unicode-codepoint">U+0022</span> (<span class="unicode-name">QUOTATION MARK</span>, <code>"</code>) .</p><p>No space is allowed between the column delimiter and a quote. An error is raised [<a href="#ERRFOCV0001" title="err:FOCV0001">err:FOCV0001</a>] if whitespace or other characters occur between a quote character and the nearest column delimiter.</p><p>The following example is therefore invalid and parsing it will raise an error.</p><div class="exampleInner"><pre xml:space="preserve">'"Field 1", "Field 2", "Field 3"'</pre></div></div><div class="div3"><h4><a id="basic-csv-to-xdm-mapping"></a>17.5.3 <a href="#basic-csv-to-xdm-mapping" style="text-decoration: none">Basic parsing of CSV to arrays</a></h4><p>The result of <a href="#func-csv-to-arrays"><code>fn:csv-to-arrays</code></a> is a sequence of rows, where each row is represented as an array of <code>xs:string</code> values.</p><p>The first row of the CSV is returned in the same way as all the other rows. <a href="#func-csv-to-arrays"><code>fn:csv-to-arrays</code></a> does not distinguish between a header row and data rows, and returns all of them.</p><div class="example"><div class="exampleHeader"><a id="d5e76772"></a><a id="d5e76790"></a>Example: A CSV with fixed-width rows</div><p>For example, given the input:</p><div class="exampleInner"><pre xml:space="preserve">'Column 1,Column 2,Column 3
Field 1A,Field 1B,Field 1C
Field 2A,Field 2B,Field 2C'</pre></div><p>the <a href="#func-csv-to-arrays"><code>fn:csv-to-arrays</code></a> function produces</p><div class="exampleInner"><pre xml:space="preserve" class="small">(
  [ "Column 1", "Column 2", "Column 3" ],
  [ "Field 1A", "Field 1B", "Field 1C" ],
  [ "Field 2A", "Field 2B", "Field 2C" ]
)</pre></div></div><div class="example"><div class="exampleHeader"><a id="d5e76783"></a><a id="d5e76801"></a>Example: A CSV with variable-width rows</div><p>It is common practice for all rows in a CSV to have the same number of columns, but this is not required.</p><div class="exampleInner"><pre xml:space="preserve" class="small">'Column 1,Column 2,Column 3
Field 1A,Field 1B,Field 1C
Field 2A,Field 2B,Field 2C,Field 2D'</pre></div><p>produces</p><div class="exampleInner"><pre xml:space="preserve" class="small">(
  [ "Column 1", "Column 2", "Column 3" ],
  [ "Field 1A", "Field 1B", "Field 1C" ],
  [ "Field 2A", "Field 2B", "Field 2C", "Field 2D" ]
)</pre></div><p><a href="#rfc4180">[RFC 4180]</a> states that CSVs <span class="verb">should</span> contain the same number of fields in each row, so that there are a uniform number of columns. However, the reality is that CSVs can, and sometimes do, contain a variable number of fields in a row. As a result, this function does not truncate or pad the number of fields in each row for any reason. The <a href="#func-csv-to-xml"><code>fn:csv-to-xml</code></a> and <a href="#func-parse-csv"><code>fn:parse-csv</code></a> functions provide facilities to enforce uniformity and an expected number of columns.</p></div></div><div class="div3"><h4><a id="func-csv-to-arrays"></a>17.5.4 <a href="#func-csv-to-arrays" style="text-decoration: none">fn:csv-to-arrays</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-parse-csv">next</a> | <a href="#csv-functions">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/413">413</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1052">1052</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/533">533</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/719">719</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/834">834</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1066">1066</a>&nbsp;25 July 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Parses CSV data supplied as a string, returning the results in the form of a sequence of arrays of strings.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:csv-to-arrays</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>array(xs:string)*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The <code>$value</code> argument is CSV data, as defined in <a href="#rfc4180">[RFC 4180]</a>, in the form of an <code>xs:string</code> value. The function parses this string, after normalizing newlines so that <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) and (<span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ) sequences are converted to <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) . The result of the function is a sequence of arrays of strings, that is <code>array(xs:string)*</code>; each array represents one row of the CSV input.</p><p>If <code>$value</code> is the empty sequence or a zero-length string, the function returns the empty sequence.</p><p>The <code>$options</code> argument can be used to control the way in which the parsing takes place. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>If the <code>$options</code> argument is omitted or the empty sequence, the result is the same as calling the two-argument form with the empty map as the value of the <code>$options</code> argument.</p><p>The entries that may appear in the <code>$options</code> map are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">field-delimiter?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">row-delimiter?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">quote-character?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">trim-whitespace?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>field-delimiter?</code></p></td><td class="fos-thin" colspan="2">The character used to delimit fields within a record. An instance of <code>xs:string</code> whose length is exactly one. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>","</code></p></li></ul></td></tr><tr><td><p><code>row-delimiter?</code></p></td><td class="fos-thin" colspan="2">The character used to delimit rows within the CSV string. An instance of <code>xs:string</code> whose length is exactly one. Defaults to a single newline character (<span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ). <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>char('\n')</code></p></li></ul></td></tr><tr><td><p><code>quote-character?</code></p></td><td class="fos-thin" colspan="2">The character used to quote fields within the CSV string. An instance of <code>xs:string</code> whose length is exactly one. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>'"'</code></p></li></ul></td></tr><tr><td rowspan="3"><p><code>trim-whitespace?</code></p></td><td class="fos-thick" colspan="2">Determines whether leading and trailing whitespace is removed from the content of unquoted fields. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td>Unquoted fields will be returned with any leading or trailing whitespace intact. </td></tr><tr><td class="fos-thick"><code>true</code></td><td>Unquoted fields will be returned with leading or trailing whitespace removed, and all other whitespace preserved. </td></tr></tbody></table><p>An empty field is represented by a zero-length string. An empty field is deemed to exist when a field delimiter immediately follows either another field delimiter, or a row delimiter, or the start of <code>$value</code>; or when a row delimiter or the end of <code>$value</code> immediately follows a field delimiter.</p><p>A blank row is represented as the empty array (not as an array containing a single empty field). A blank row is deemed to exist when a row delimiter immediately follows either another row delimiter or the start of <code>$value</code>, after trimming of whitespace if the <code>trim-whitespace</code> option is <code>true</code>. No blank row occurs after the final row delimiter.</p><p>If <code>$value</code> is a zero-length string, the CSV is considered to contain no rows; while if <code>$value</code> consists of a single row delimiter, it is considered to contain a single blank row. The presence or absence of a final row delimiter generally has no effect on the result, except when it appears at the start of the input, in which case it causes a single blank row to exist.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error [<a href="#ERRFOCV0001" title="err:FOCV0001">err:FOCV0001</a>] occurs if the value of <code>$csv</code> does not conform to the required grammar.</p><p>A dynamic error [<a href="#ERRFOCV0002" title="err:FOCV0002">err:FOCV0002</a>] occurs if the value of the <code>field-delimiter</code>, <code>row-delimiter</code>, or <code>quote-character</code> option is not a single character.</p><p>A dynamic error [<a href="#ERRFOCV0003" title="err:FOCV0003">err:FOCV0003</a>] occurs if the same character is used for more than one of the <code>field-delimiter</code>, <code>row-delimiter</code>, and <code>quote-character</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The default row delimiter is a single newline character <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) . Alternative line endings such as <code>CR</code> and <code>CRLF</code> will already have been normalized to a single newline. </p><p>All fields are returned as <code>xs:string</code> values.</p><p>Quoted fields in the input are returned without the quotes.</p><p>The first row is not treated specially.</p><p>For more discussion of the returned data, see <a href="#basic-csv-to-xdm-mapping"><b>17.5.3 Basic parsing of CSV to arrays</b></a>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>Handling trivial input:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-arrays(())</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-arrays("")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-arrays(char('\n'))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-arrays(" ", { 'trim-whitespace': true() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-arrays(" ", { 'trim-whitespace': false() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ " " ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-arrays(` { char('\n') }`, { 'trim-whitespace': true() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-arrays(` { char('\n') }`, { 'trim-whitespace': false() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ " " ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-arrays(`{ char('\n') } `, { 'trim-whitespace': true() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-arrays(`{ char('\n') } `, { 'trim-whitespace': false() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[], [ " " ]</pre></div></td></tr><tr><td colspan="2"><p>Using newline separators:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">csv-to-arrays(
  `name,city{ char('\n') }` ||
  `Bob,Berlin{ char('\n') }` ||
  `Alice,Aachen{ char('\n') }`
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "name", "city" ],
[ "Bob", "Berlin" ],
[ "Alice", "Aachen" ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $CRLF := `{ char('\r') }{ char('\n') }`
return csv-to-arrays(
  `name,city{ $CRLF }` ||
  `Bob,Berlin{ $CRLF }` ||
  `Alice,Aachen{ $CRLF }`
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "name", "city" ],
[ "Bob", "Berlin" ],
[ "Alice", "Aachen" ]</pre></div></td></tr><tr><td colspan="2"><p>Quote handling:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">csv-to-arrays(
  string-join(
    (`"name","city"`, `"Bob","Berlin"`, `"Alice","Aachen"`),
    char('\n')
  )
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "name", "city" ],
[ "Bob", "Berlin" ],
[ "Alice", "Aachen" ]</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">csv-to-arrays(
  `"name","city"{ char('\n') }` ||
  `"Bob ""The Exemplar"" Mustermann","Berlin"{ char('\n') }`
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">(
  [ "name", "city" ],
  [ 'Bob "The Exemplar" Mustermann', "Berlin" ]
)</pre></div></td></tr><tr><td colspan="2"><p>Non-default record- and field-delimiters:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">csv-to-arrays(
  "name;city§Bob;Berlin§Alice;Aachen", 
  { "row-delimiter": "§", "field-delimiter": ";" }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "name", "city" ],
[ "Bob", "Berlin" ],
[ "Alice", "Aachen" ]</pre></div></td></tr><tr><td colspan="2"><p>Non-default quote character:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">csv-to-arrays(
  string-join(
    ("|name|,|city|", "|Bob|,|Berlin|"),
    char('\n')
  ), 
  { "quote-character": "|" }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "name", "city" ],
[ "Bob", "Berlin" ]</pre></div></td></tr><tr><td colspan="2"><p>Trimming whitespace in fields:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">csv-to-arrays(
  string-join(
    ("name  ,city    ", "Bob   ,Berlin  ", "Alice ,Aachen  "),
    char('\n')
  ),
  { "trim-whitespace": true() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">[ "name", "city" ],
[ "Bob", "Berlin" ],
[ "Alice", "Aachen" ]</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="csv-to-xdm-mapping"></a>17.5.5 <a href="#csv-to-xdm-mapping" style="text-decoration: none">Enhanced parsing of CSV data to maps and arrays</a></h4><p>While <a href="#func-csv-to-arrays"><code>fn:csv-to-arrays</code></a> simply delivers the CSV content as a sequence of arrays, the <a href="#func-parse-csv"><code>fn:parse-csv</code></a> function goes a step further and enables access to the data using column names. The column names may be taken either from the first row of the CSV data, or from data supplied by the caller in the <code>options</code> parameter.</p></div><div class="div3"><h4><a id="parsed-csv-structure-record"></a>17.5.6 <a href="#parsed-csv-structure-record" style="text-decoration: none">Record fn:parsed-csv-structure-record</a></h4><p>This record type is used to hold the result of the <a href="#func-parse-csv"><code>fn:parse-csv</code></a> function.</p><table class="fos-options"><thead><tr><th>Name</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>columns</code></p></td><td class="fos-thin"><p>This entry holds a sequence of strings containing column names. The content depends on the setting of the <code>header</code> entry in <code>$options</code>:</p><ul><li><p>With <code>"header":false()</code> (which is the default), the value of this entry is the empty sequence.</p></li><li><p>With <code>"header":true()</code>, the value is a sequence of strings taken from the first row of the data. The strings have leading and trailing whitespace trimmed, regardless of the value of the <code>trim-whitespace</code> option. The sequence of strings will potentially be truncated if the <code>number-of-columns</code> option is specified, and it will potentially be reordered if the <code>filter-columns</code> option is specified. Any strings that are zero-length or duplicated are retained <em>as-is</em>.</p></li><li><p>If the value of the <code>header</code> option is a sequence of strings, then the value is taken from the supplied sequence.</p><p>The order of names is <em>not</em> adjusted based on the <code>select-columns</code> option; the supplied list of names is expected to refer to columns in the result, not to columns in the input.</p></li></ul><ul><li><p><b>Type: </b><code>xs:string*</code></p></li></ul></td></tr><tr><td><p><code>column-index</code></p></td><td class="fos-thin"><p>This entry holds a map from column names (as strings) to column positions (as 1-based positive integers). The content depends on the setting of the <code>header</code> entry in <code>$options</code>:</p><ul><li><p>With <code>"header":false()</code> (which is the default), the value of this entry is the empty map.</p></li><li><p>With <code>"header":true()</code>, the map contains entries based on the contents of the first row of the data. The strings have leading and trailing whitespace trimmed, regardless of the value of the <code>trim-whitespace</code> option. Any string appearing in the header row that is non-zero-length and is not equal (using codepoint collation) to any previous string appearing in the header results in an entry pairing that string to its 1-based position in the header row.</p><p>If the <code>select-columns</code> option is present then the entries are adjusted (or removed) to reflect their position in the adjusted data rows.</p></li><li><p>If the value of the <code>header</code> option is a sequence of strings, then the map contains entries based on the supplied value. Any string appearing in the option value that is non-zero-length and is not equal (using codepoint collation) to any previous string results in an entry pairing that string to its 1-based position in the sequence. </p><p>The allocation of column numbers is <em>not</em> adjusted based on the <code>select-columns</code> option; the supplied list of names is expected to refer to columns in the result, not to columns in the input.</p></li></ul><ul><li><p><b>Type: </b><code>map(xs:string,xs:integer)?</code></p></li></ul></td></tr><tr><td><p><code>rows</code></p></td><td class="fos-thin"><p>This entry is a sequence of arrays of strings, holding the parsed rows of the CSV data. The format is the same as the result of the <a href="#func-csv-to-arrays"><code>fn:csv-to-arrays</code></a> function, except that the first row is omitted in the case where the <code>header</code> option is <code>true</code>. If there are no data rows in the CSV, the value will be the empty sequence.</p><ul><li><p><b>Type: </b><code>array(xs:string)*</code></p></li></ul></td></tr><tr><td><p><code>get</code></p></td><td class="fos-thin"><p>A function providing ready access to a given field in a given row. The <code>get</code> function has signature:</p><div class="exampleInner"><pre xml:space="preserve">function($row as xs:positiveInteger, $column as (xs:positiveInteger | xs:string)) as xs:string</pre></div><p>The function takes two arguments: the first is an integer giving the row number (1-based), the second identifies a column either by its name or by its 1-based position.</p><p>Except in error cases (described below), the function call <code>$csv?get($R, $C)</code>, where <code>$C</code> is an integer, returns the value of <code>$csv?rows[$R] =&gt; array:get($C, "")</code>, and the function call <code>$csv?get($R, $K)</code>, where <code>$K</code> is a string, returns the value of <code>$csv?get($R, $csv?column-index($K))</code>.</p><p>The properties of the function are as follows:</p><dl><dt class="label">Name</dt><dd><p>Absent</p></dd><dt class="label">Signature</dt><dd><p><code>(xs:positiveInteger, (xs:positiveInteger | xs:string)) =&gt; xs:string</code></p></dd><dt class="label">Non-local variable bindings</dt><dd><p>None</p></dd><dt class="label">Body</dt><dd><p>As described in the specification above</p></dd><dt class="label">Errors</dt><dd><p>A dynamic error [<a href="#ERRFOCV0004" title="err:FOCV0004">err:FOCV0004</a>] occurs if the supplied <var>$key</var> is a string and does not occur in the map of column names.</p></dd><dt class="label">Rules</dt><dd><p>The function returns a field in the result.</p><p>The first argument <code>$row</code> selects a row within the sequence of rows returned as <var>rows</var> by position (one-based). If the value is out of range for the number of rows returned, the <code>get</code> function returns a zero-length string.</p><p>The second argument <code>$col</code> may be either an integer or a string.</p><p>If <code>$col</code> is an integer then it selects a field within the selected row by position (one-based). If the value is out of range for the number of fields in the selected row, the <code>get</code> function returns a zero-length string.</p><p>If <code>$col</code> is a string, the string is mapped to an integer using the map in the returned <var>column-index</var>. If the string is not present in this map, then an error is raised [<a href="#ERRFOCV0004" title="err:FOCV0004">err:FOCV0004</a>]. The resulting integer is then used as if it were supplied as <code>$col</code> directly.</p></dd></dl><ul><li><p><b>Type: </b><code>function(xs:positiveInteger, (xs:positiveInteger | xs:string)) as xs:string</code></p></li></ul></td></tr></tbody></table></div><div class="div3"><h4><a id="func-parse-csv"></a>17.5.7 <a href="#func-parse-csv" style="text-decoration: none">fn:parse-csv</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-csv-doc">next</a> | <a href="#func-csv-to-arrays">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/413">413</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1052">1052</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/533">533</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/719">719</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/834">834</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1066">1066</a>&nbsp;19 March 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Parses CSV data, returning the results in the form of a record containing information about the names in the header, as well as the data itself.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:parse-csv</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code class="return-type-ref"><a href="#parsed-csv-structure-record">parsed-csv-structure-record</a>?</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>The input supplied in <code>$value</code> is CSV data, as defined in <a href="#rfc4180">[RFC 4180]</a>. The function first parses the input using <a href="#func-csv-to-arrays"><code>fn:csv-to-arrays</code></a>, and then further processes the result. The initial parsing is exactly as defined for <a href="#func-csv-to-arrays"><code>fn:csv-to-arrays</code></a>, and can be controlled using the same options. Additional options are available to control the way in which header information and column names are handled.</p><p>If the input is the a zero-length string, the function returns a <code>parsed-csv-structure-record</code> whose <code>rows</code> entry is the empty sequence.</p><p>The <code>$options</code> argument can be used to control the way in which the parsing takes place. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>If the <code>$options</code> argument is omitted or is the empty sequence, the result is the same as calling the two-argument form with the empty map as the value of the <code>$options</code> argument.</p><p>The entries that may appear in the <code>$options</code> map are as follows:</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">field-delimiter?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">row-delimiter?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">quote-character?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">trim-whitespace?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">header?</code></td><td><code class="as">as&nbsp;</code><code>item()*</code>,</td></tr><tr class="arg"><td><code class="opt">select-columns?</code></td><td><code class="as">as&nbsp;</code><code>xs:positiveInteger*</code>,</td></tr><tr class="arg"><td><code class="opt">trim-rows?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>field-delimiter?</code></p></td><td class="fos-thin" colspan="2">The character used to delimit fields within a record. An instance of <code>xs:string</code> whose length is exactly one. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>","</code></p></li></ul></td></tr><tr><td><p><code>row-delimiter?</code></p></td><td class="fos-thin" colspan="2">The character used to delimit rows within the CSV string. An instance of <code>xs:string</code> whose length is exactly one. Defaults to a single newline character (<span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ). Note that this is tested after line endings are normalized. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>char('\n')</code></p></li></ul></td></tr><tr><td><p><code>quote-character?</code></p></td><td class="fos-thin" colspan="2">The character used to quote fields within the CSV string. An instance of <code>xs:string</code> whose length is exactly one. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>'"'</code></p></li></ul></td></tr><tr><td rowspan="3"><p><code>trim-whitespace?</code></p></td><td class="fos-thick" colspan="2">Determines whether leading and trailing whitespace is removed from the content of unquoted fields. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td>Unquoted fields will be returned with any leading or trailing whitespace intact. </td></tr><tr><td class="fos-thick"><code>true</code></td><td>Unquoted fields will be returned with leading or trailing whitespace removed, and all other whitespace preserved. </td></tr><tr><td rowspan="4"><p><code>header?</code></p></td><td class="fos-thick" colspan="2">Determines whether the first row of the CSV should be treated as a list of column names, or whether column names are being supplied by the caller. The value must either be a single boolean, or a sequence of zero or more strings. <ul><li><p><b>Type: </b><code>item()*</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>Column names are taken from the first row of the CSV data.</td></tr><tr><td class="fos-thin"><code>false</code></td><td>Column names are not available; all references to columns are by ordinal position.</td></tr><tr><td class="fos-thick"><code>xs:string*</code></td><td>Supplies explicit names for the columns. The <var>N</var>th name in the list applies to the <var>N</var>th column after any filtering or rearrangement. A zero-length string can be used when there is a column that requires no name. </td></tr><tr><td><p><code>select-columns?</code></p></td><td class="fos-thin" colspan="2">A sequence of integers indicating which columns to include and in which order. If this option is absent or empty, all columns are returned in their original order. For example, the value <code>1 to 4</code> indicates that the output contains the first, second, third, and fourth columns from the input, in order, while <code>(1, 5, 4)</code> indicates that the output contains three columns, taken from the first, fifth, and fourth columns of the input, in that order. An integer in the sequence is treated as the 1-based index of the column to include. Any other columns are dropped. If a particular row includes no field at the specified index, the empty field is included at the relevant position in the result. If an integer appears more than once then the result will include duplicated columns. <ul><li><p><b>Type: </b><code>xs:positiveInteger*</code></p></li><li><p><b>Default: </b><code>()</code></p></li></ul></td></tr><tr><td rowspan="3"><p><code>trim-rows?</code></p></td><td class="fos-thick" colspan="2">Determines whether all rows should be adjusted to contain the same number of fields. This option is ignored if <code>select-columns</code> is specified. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>false</code></td><td>No padding or trimming of rows takes place, unless requested using the <code>select-columns</code> option.</td></tr><tr><td class="fos-thick"><code>true</code></td><td>The number of fields in the first row (whether this be a header or a data row) determines the number of fields in every subsequent row; to achieve this, excess fields are removed, or additional zero-length fields are added. </td></tr></tbody></table><p>The result of the function is a <code>parsed-csv-structure-record</code>, as defined in <a href="#parsed-csv-structure-record"><b>17.5.6 Record fn:parsed-csv-structure-record</b></a>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error [<a href="#ERRFOCV0001" title="err:FOCV0001">err:FOCV0001</a>] occurs if the value of <code>$csv</code> does not conform to the required grammar.</p><p>A dynamic error [<a href="#ERRFOCV0002" title="err:FOCV0002">err:FOCV0002</a>] occurs if any of the options <code>field-delimiter</code>, <code>row-delimiter</code>, or <code>quote-character</code> is not a single character.</p><p>A dynamic error [<a href="#ERRFOCV0003" title="err:FOCV0003">err:FOCV0003</a>] occurs if the same character is used for more than one of the options <code>field-delimiter</code>, <code>row-delimiter</code>, and <code>quote-character</code>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The default row delimiter is a single newline character <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) . Alternative line endings such as <code>CR</code> and <code>CRLF</code> will already have been normalized to a single newline.</p><p>All fields are returned as <code>xs:string</code> values.</p><p>Quoted fields in the input are returned without the quotes.</p><p>For more discussion of the returned data, see <a href="#csv-to-xdm-mapping"><b>17.5.5 Enhanced parsing of CSV data to maps and arrays</b></a>.</p><p>If the source of the CSV input is a resource accessible by URI, then it may be preferable to use the <a href="#func-csv-doc"><code>fn:csv-doc</code></a> function. If the source is a binary value (<code>xs:hexBinary</code> or <code>xs:base64Binary</code>) then this can first be decoded as a string using the functions <a href="https://qt4cg.org/specifications/EXPath/binary-40/Overview.html#func-bin-infer-encoding"><code>bin:infer-encoding</code></a> and <a href="https://qt4cg.org/specifications/EXPath/binary-40/Overview.html#func-bin-decode-string"><code>bin:decode-string</code></a>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $display := fn($result) {
  (: tidy up the result for display (function items cannot be properly displayed) :)         
  map:put($result, "get", "(: function :)")
}</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr><td colspan="2"><p>Default delimiters, no column headers:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := string-join(
  ("name,city", "Bob,Berlin", "Alice,Aachen"),
  char('\n')
)
let $result := parse-csv($input)
return (
  $result =&gt; $display(),
  $result?get(1, 2),
  $result?get(2, 2)
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "columns": (),
  "column-index": {},
  "rows": ([ "name", "city" ], [ "Bob", "Berlin" ], [ "Alice", "Aachen" ]),
  "get": "(: function :)"
},
"city",
"Berlin"</pre></div></td></tr><tr><td colspan="2"><p>Default delimiters, column headers:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := string-join(
  ("name,city", "Bob,Berlin", "Alice,Aachen"),
  char('\n')
)
let $result := parse-csv($input, { "header": true() })
return (
  $result =&gt; $display(),
  $result?get(1, "name"),
  $result?get(2, "city")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "columns": ("name", "city"),
  "column-index": { "name": 1, "city": 2 },
  "rows": ([ "Bob", "Berlin" ], [ "Alice", "Aachen" ]),
  "get": "(: function :)"
},
"Bob",
"Aachen"</pre></div></td></tr><tr><td colspan="2"><p>Custom delimiters, no column headers:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $options := {
  "row-delimiter": "§", 
  "field-delimiter": ";", 
  "quote-character": "|"
}
let $input := "|name|;|city|§|Bob|;|Berlin|§|Alice|;|Aachen|"
let $result := parse-csv($input, $options)
return (
  $result =&gt; $display(),
  $result?get(3, 1)
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "columns": (),
  "column-index": {},
  "rows": ([ "name", "city" ], [ "Bob", "Berlin" ], [ "Alice", "Aachen" ]),
  "get": "(: function :)"
},
"Alice"</pre></div></td></tr><tr><td colspan="2"><p>Supplied column names:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $headers := ("Person", "Location")
let $options := { "header": $headers, "row-delimiter": ";" }
let $input := "Alice,Aachen;Bob,Berlin;"
let $parsed-csv := parse-csv($input, $options)
return (
  $parsed-csv =&gt; $display(), 
  $parsed-csv?get(2, "Location")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "columns": ("Person", "Location"),
  "column-index": { "Person": 1, "Location": 2 },
  "rows": ([ "Alice", "Aachen" ], [ "Bob", "Berlin" ]),
  "get": "(: function :)"                  
},
"Berlin"</pre></div></td></tr><tr><td colspan="2"><p>Filtering columns, with ragged input and <code>header: true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := string-join((
   "date,name,city,amount,currency,original amount,note",
   "2023-07-19,Bob,Berlin,10.00,USD,13.99",
   "2023-07-20,Alice,Aachen,15.00",
   "2023-07-20,Charlie,Celle,15.00,GBP,11.99,cake,not a lie"
), char('\n'))
let $options := { 
  "header": true(), 
  "select-columns": (2, 1, 4)
}
let $result := parse-csv($input, $options)
return (
  $result =&gt; $display(),
  $result?get(2, "amount")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "columns": ("name", "date", "amount"),
  "column-index": { "name": 1, "date": 2, "amount": 3 },
  "rows": (
    [ "Bob", "2023-07-19", "10.00" ],
    [ "Alice", "2023-07-20", "15.00" ],
    [ "Charlie", "2023-07-20", "15.00" ]
  ),
  "get": "(: function :)"                  
},
"15.00"</pre></div></td></tr><tr><td colspan="2"><p>Filtering columns, with supplied column map</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := string-join((
  "2023-07-20,Alice,Aachen,15.00",                  
  "2023-07-19,Bob,Berlin,10.00,USD,13.99",
  "2023-07-20,Charlie,Celle,15.00,GBP,11.99,cake,not a lie"
), char('\n'))
let $options := { 
  "header": ( "Person", "", "Amount" ),
  "select-columns": (2, 1, 4)
}
let $result := parse-csv($input, $options)
return (
  $result =&gt; $display(),
  $result?get(2, "Person"),
  $result?get(2, "Amount")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "columns": ("Person", "", "Amount"),
  "column-index": { "Person": 1, "Amount": 3 },
  "rows": ([ "Alice", "2023-07-20", "15.00" ], 
           [ "Bob", "2023-07-19", "10.00" ], 
           [ "Charlie", "2023-07-20", "15.00" ]),
  "get": "(: function :)"                  
},
"Bob",
"10.00"</pre></div></td></tr><tr><td colspan="2"><p>Specifying the number of columns explicitly, with <code>header: false()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := string-join((
  "date,      name,     amount,    currency,   original amount",               
  "2023-07-19,Bob,      10.00,     USD,        13.99",
  "2023-07-20,Alice,    15.00",
  "2023-07-20,Charlie,  15.00,     GBP,        11.99,             extra data"
), char('\n'))
let $options := {
  "header": false(), 
  "select-columns": 1 to 5, 
  "trim-whitespace" :true()
}
let $result := parse-csv($input, $options)
return (
  $result =&gt; $display(),
  $result?get(4, 3)
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "columns": (),
  "column-index": {},
  "rows": (
    [ "date", "name", "amount", "currency", "original amount" ],
    [ "2023-07-19", "Bob", "10.00", "USD", "13.99" ],
    [ "2023-07-20", "Alice", "15.00", "", "" ],
    [ "2023-07-20", "Charlie", "15.00", "GBP", "11.99" ]
  ),
  "get": "(: function :)"                  
},
"15.00"</pre></div></td></tr><tr><td colspan="2"><p>Specifying the number of columns with a number and <code>header: true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $input := string-join((
  "date,name,city,amount,currency,original amount,note",               
  "2023-07-19,Bob,Berlin,10.00,USD,13.99",
  "2023-07-20,Alice,Aachen,15.00",
  "2023-07-20,Charlie,Celle,15.00,GBP,11.99,cake,not a lie"
), char('\n'))
let $options := { "header": true(), "select-columns": 1 to 6 }
let $result := parse-csv($input, $options)
return (
  $result =&gt; $display(),
  $result?get(3, "original amount")
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">{
  "columns": ("date", "name", "city", 
              "amount", "currency", "original amount"),
  "column-index": {
    "date": 1, "name": 2, "city": 3, "amount": 4,
    "currency": 5, "original amount": 6
  },
  "rows": (
    [ "2023-07-19", "Bob", "Berlin", "10.00", "USD", "13.99"],
    [ "2023-07-20", "Alice", "Aachen", "15.00", "", ""],
    [ "2023-07-20", "Charlie", "Celle", "15.00", "GBP", "11.99"]
  ),
  "get": "(: function :)"                  
},
"11.99"</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-csv-doc"></a>17.5.8 <a href="#func-csv-doc" style="text-decoration: none">fn:csv-doc</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-csv-to-xml">next</a> | <a href="#func-parse-csv">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/748">748</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/2013">2013</a>&nbsp;20 May 2025]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Reads an external resource containing CSV, and returns the results as a record containing information about the names in the header, as well as the data itself.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:csv-doc</code>(</td></tr><tr class="arg"><td><code>$source</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>fn:parsed-csv-structure-record?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>If the second argument is omitted or the empty sequence, the result is the same as calling the two-argument form with the empty map as the value of the <code>$options</code> argument.</p><p>The effect of the two-argument function call <code>fn:csv-doc($H, $M)</code>is equivalent to the function composition <code>fn:unparsed-binary($H) =&gt; fn:parse-csv($M)</code>.</p><p>If <code>$source</code> is the empty sequence, the function returns the empty sequence.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The ability to access external resources depends on whether the calling code is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trusted</a><sup><small>XP</small></sup>.</p></div></dd><dt class="label">Error Conditions</dt><dd><p>The function may raise any error defined for the <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> or <a href="#func-parse-csv"><code>fn:parse-csv</code></a> functions.</p></dd></dl></div><div class="div3"><h4><a id="csv-represent-as-xml"></a>17.5.9 <a href="#csv-represent-as-xml" style="text-decoration: none">Representing CSV data as XML</a></h4><p>The <a href="#func-csv-to-xml"><code>fn:csv-to-xml</code></a> function returns an XDM node tree representing the CSV data. Following is a CSV text and the XML serialization of the corresponding node tree.</p><div class="exampleInner"><pre xml:space="preserve">Name,Date,Amount
Alice,2023-07-14,1.23
Bob,2023-07-14,2.34</pre></div><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;columns&gt;
    &lt;column&gt;Name&lt;/column&gt;
    &lt;column&gt;Date&lt;/column&gt;
    &lt;column&gt;Amount&lt;/column&gt;
  &lt;/columns&gt;
  &lt;rows&gt;
    &lt;row&gt;
      &lt;field column="Name"&gt;Alice&lt;/field&gt;
      &lt;field column="Date"&gt;2023-07-14&lt;/field&gt;
      &lt;field column="Amount"&gt;1.23&lt;/field&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="Name"&gt;Bob&lt;/field&gt;
      &lt;field column="Date"&gt;2023-07-14&lt;/field&gt;
      &lt;field column="Amount"&gt;2.34&lt;/field&gt;
    &lt;/row&gt;
  &lt;/rows&gt;
&lt;/csv&gt;</pre></div><p>If no non-empty column names are available, then the <code>columns</code> element and all <code>column</code> attributes are absent. If non-empty column names are available for some columns but not for others, then (a) the empty <code>column</code> element is included within the <code>columns</code> element if and only if there is a subsequent column with a non-empty name, and (b) the <code>column</code> attribute for the corresponding <code>field</code> elements is absent.</p><p>For example (when no column names are available):</p><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;rows&gt;
    &lt;row&gt;
      &lt;field&gt;Name&lt;/field&gt;
      &lt;field&gt;Date&lt;/field&gt;
      &lt;field&gt;Amount&lt;/field&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field&gt;Alice&lt;/field&gt;
      &lt;field&gt;2023-07-14&lt;/field&gt;
      &lt;field&gt;1.23&lt;/field&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field&gt;Bob&lt;/field&gt;
      &lt;field&gt;2023-07-14&lt;/field&gt;
      &lt;field&gt;2.34&lt;/field&gt;
    &lt;/row&gt;
  &lt;/rows&gt;
&lt;/csv&gt;</pre></div><p>An XSD 1.0 schema for the XML representation is provided in <a href="#schema-for-csv"><b>D.3 Schema for the result of fn:csv-to-xml</b></a>.</p></div><div class="div3"><h4><a id="func-csv-to-xml"></a>17.5.10 <a href="#func-csv-to-xml" style="text-decoration: none">fn:csv-to-xml</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-invisible-xml">next</a> | <a href="#func-csv-doc">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/413">413</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1052">1052</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/533">533</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/719">719</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/834">834</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1066">1066</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1605">1605</a>&nbsp;25 July 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Parses CSV data supplied as a string, returning the results as an XML document, as described by <a href="#csv-represent-as-xml"><b>17.5.9 Representing CSV data as XML</b></a>.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:csv-to-xml</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>document-node(fn:csv)?</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>The arguments have the same meaning, and are subject to the same constraints, as the arguments of <a href="#func-parse-csv"><code>fn:parse-csv</code></a>.</p><p>If <code>$value</code> is the empty sequence, the function returns the empty sequence.</p><p>In other cases, the effect of the function is equivalent to the result of the following XQuery expression (where <code>$options</code> is the empty map if the argument is not supplied):</p><div class="exampleInner"><pre xml:space="preserve" class="small">let $parsedCSV := parse-csv($value, $options)
let $colNames := $parsedCSV?columns
return document {
   &lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt; {
     if (exists($colNames)) {
       &lt;columns&gt;{ $colNames ! &lt;column&gt;{ . }&lt;/column&gt; }&lt;/columns&gt;
     },
     &lt;rows&gt;{
       for $row in $parsedCSV?rows
       return &lt;row&gt;{
         for member $field at $col in $row
         return &lt;field&gt;{
           if ($colnames[$col]) {
             attribute column { $colnames[$col] }
           },
           $field
         }&lt;/field&gt;
       }&lt;/row&gt;
     }&lt;/rows&gt; 
   }&lt;/csv&gt; 
}</pre></div><p>The elements in the returned XML are in the namespace <code>http://www.w3.org/2005/xpath-functions</code>; the namespace prefix that is used (or its absence) is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p>If the function is called twice with the same arguments, it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether the two calls return the same element node or distinct (but deep equal) element nodes. In this respect it is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic with respect to node identity</a>.</p><p>The base URI of the element nodes in the result is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p>A schema is defined for the structure of the returned document: see <a href="#schema-for-csv"><b>D.3 Schema for the result of fn:csv-to-xml</b></a>.</p><p>The result of the function will always be such that validation against this schema would succeed. However, it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether the result is typed or untyped, that is, whether the elements and attributes in the returned tree have type annotations that reflect the result of validating against this schema.</p></dd><dt class="label">Error Conditions</dt><dd><p>See <a href="#func-parse-csv"><code>fn:parse-csv</code></a>.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $crlf := char('\r') || char('\n')</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve">let $csv-string := `name,city{ $crlf }Bob,Berlin{ $crlf }Alice,Aachen{ $crlf }`</pre></div></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $csv-uneven-cols := concat(
  `date,name,city,amount,currency,original amount,note{ $crlf }`,
  `2023-07-19,Bob,Berlin,10.00,USD,13.99{ $crlf }`,
  `2023-07-20,Alice,Aachen,15.00{ $crlf }`,
  `2023-07-20,Charlie,Celle,15.00,GBP,11.99,cake,not a lie{ $crlf }`
)</pre></div></td></tr></tbody></table><table class="medium"><tbody><tr><td colspan="2"><p>An empty CSV with default column extraction (false):</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml(())</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml("")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;rows/&gt;
&lt;/csv&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml(char('\n'))</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;rows&gt;
    &lt;row/&gt;
  &lt;/rows&gt;
&lt;/csv&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr><td colspan="2"><p>An empty CSV with header extraction:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml("", { "header": true() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;rows/&gt;
&lt;/csv&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr><td colspan="2"><p>An empty CSV with explicit column names:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml("", { "header": ("name", "", "city") })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;columns&gt;
    &lt;column&gt;name&lt;/column&gt;
    &lt;column/&gt;
    &lt;column&gt;city&lt;/column&gt;
  &lt;/columns&gt;
  &lt;rows/&gt;
&lt;/csv&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr><td colspan="2"><p>With defaults for delimiters and quotes, recognizing headers:</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml($csv-string, { "header": true() })</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;columns&gt;
    &lt;column&gt;name&lt;/column&gt;
    &lt;column&gt;city&lt;/column&gt;
  &lt;/columns&gt;
  &lt;rows&gt;
    &lt;row&gt;
      &lt;field column="name"&gt;Bob&lt;/field&gt;
      &lt;field column="city"&gt;Berlin&lt;/field&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="name"&gt;Alice&lt;/field&gt;
      &lt;field column="city"&gt;Aachen&lt;/field&gt;
    &lt;/row&gt;
  &lt;/rows&gt;
&lt;/csv&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr><td colspan="2"><p>Filtering columns</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml(
  $csv-uneven-cols, 
  { "header": true(), "select-columns": (2, 1, 4) }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;columns&gt;
    &lt;column&gt;name&lt;/column&gt;
    &lt;column&gt;date&lt;/column&gt;
    &lt;column&gt;amount&lt;/column&gt;
  &lt;/columns&gt;
  &lt;rows&gt;
    &lt;row&gt;
      &lt;field column="name"&gt;Bob&lt;/field&gt;
      &lt;field column="date"&gt;2023-07-19&lt;/field&gt;
      &lt;field column="amount"&gt;10.00&lt;/field&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="name"&gt;Alice&lt;/field&gt;
      &lt;field column="date"&gt;2023-07-20&lt;/field&gt;
      &lt;field column="amount"&gt;15.00&lt;/field&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="name"&gt;Charlie&lt;/field&gt;
      &lt;field column="date"&gt;2023-07-20&lt;/field&gt;
      &lt;field column="amount"&gt;15.00&lt;/field&gt;
    &lt;/row&gt;
  &lt;/rows&gt;
&lt;/csv&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr><td colspan="2"><p>Ragged rows</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml(
  $csv-uneven-cols, 
  { "header": true() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;columns&gt;
    &lt;column&gt;date&lt;/column&gt;
    &lt;column&gt;name&lt;/column&gt;
    &lt;column&gt;city&lt;/column&gt;
    &lt;column&gt;amount&lt;/column&gt;
    &lt;column&gt;currency&lt;/column&gt;
    &lt;column&gt;original amount&lt;/column&gt;
    &lt;column&gt;note&lt;/column&gt;
  &lt;/columns&gt;
  &lt;rows&gt;
    &lt;row&gt;
      &lt;field column="date"&gt;2023-07-19&lt;/field&gt;
      &lt;field column="name"&gt;Bob&lt;/field&gt;
      &lt;field column="city"&gt;Berlin&lt;/field&gt;
      &lt;field column="amount"&gt;10.00&lt;/field&gt;
      &lt;field column="currency"&gt;USD&lt;/field&gt;
      &lt;field column="original amount"&gt;13.99&lt;/field&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="date"&gt;2023-07-20&lt;/field&gt;
      &lt;field column="name"&gt;Alice&lt;/field&gt;
      &lt;field column="city"&gt;Aachen&lt;/field&gt;
      &lt;field column="amount"&gt;15.00&lt;/field&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="date"&gt;2023-07-20&lt;/field&gt;
      &lt;field column="name"&gt;Charlie&lt;/field&gt;
      &lt;field column="city"&gt;Celle&lt;/field&gt;
      &lt;field column="amount"&gt;15.00&lt;/field&gt;
      &lt;field column="currency"&gt;GBP&lt;/field&gt;
      &lt;field column="original amount"&gt;11.99&lt;/field&gt;
      &lt;field column="note"&gt;cake&lt;/field&gt;
      &lt;field&gt;not a lie&lt;/field&gt;
    &lt;/row&gt;
  &lt;/rows&gt;
&lt;/csv&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr><td colspan="2"><p>Trimming rows to constant width</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml(
  $csv-uneven-cols, 
  { "header": true(), "trim-rows": true() }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;columns&gt;
    &lt;column&gt;date&lt;/column&gt;
    &lt;column&gt;name&lt;/column&gt;
    &lt;column&gt;city&lt;/column&gt;
    &lt;column&gt;amount&lt;/column&gt;
    &lt;column&gt;currency&lt;/column&gt;
    &lt;column&gt;original amount&lt;/column&gt;
    &lt;column&gt;note&lt;/column&gt;
  &lt;/columns&gt;
  &lt;rows&gt;
    &lt;row&gt;
      &lt;field column="date"&gt;2023-07-19&lt;/field&gt;
      &lt;field column="name"&gt;Bob&lt;/field&gt;
      &lt;field column="city"&gt;Berlin&lt;/field&gt;
      &lt;field column="amount"&gt;10.00&lt;/field&gt;
      &lt;field column="currency"&gt;USD&lt;/field&gt;
      &lt;field column="original amount"&gt;13.99&lt;/field&gt;
      &lt;field column="note"/&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="date"&gt;2023-07-20&lt;/field&gt;
      &lt;field column="name"&gt;Alice&lt;/field&gt;
      &lt;field column="city"&gt;Aachen&lt;/field&gt;
      &lt;field column="amount"&gt;15.00&lt;/field&gt;
      &lt;field column="currency"/&gt;
      &lt;field column="original amount"/&gt;
      &lt;field column="note"/&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="date"&gt;2023-07-20&lt;/field&gt;
      &lt;field column="name"&gt;Charlie&lt;/field&gt;
      &lt;field column="city"&gt;Celle&lt;/field&gt;
      &lt;field column="amount"&gt;15.00&lt;/field&gt;
      &lt;field column="currency"&gt;GBP&lt;/field&gt;
      &lt;field column="original amount"&gt;11.99&lt;/field&gt;
      &lt;field column="note"&gt;cake&lt;/field&gt;
    &lt;/row&gt;
  &lt;/rows&gt;
&lt;/csv&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr><tr><td colspan="2"><p>Specifying a fixed number of columns</p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">csv-to-xml(
  $csv-uneven-cols, 
  { "header": true(), "select-columns": 1 to 6 }
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;csv xmlns="http://www.w3.org/2005/xpath-functions"&gt;
  &lt;columns&gt;
    &lt;column&gt;date&lt;/column&gt;
    &lt;column&gt;name&lt;/column&gt;
    &lt;column&gt;city&lt;/column&gt;
    &lt;column&gt;amount&lt;/column&gt;
    &lt;column&gt;currency&lt;/column&gt;
    &lt;column&gt;original amount&lt;/column&gt;
  &lt;/columns&gt;
  &lt;rows&gt;
    &lt;row&gt;
      &lt;field column="date"&gt;2023-07-19&lt;/field&gt;
      &lt;field column="name"&gt;Bob&lt;/field&gt;
      &lt;field column="city"&gt;Berlin&lt;/field&gt;
      &lt;field column="amount"&gt;10.00&lt;/field&gt;
      &lt;field column="currency"&gt;USD&lt;/field&gt;
      &lt;field column="original amount"&gt;13.99&lt;/field&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="date"&gt;2023-07-20&lt;/field&gt;
      &lt;field column="name"&gt;Alice&lt;/field&gt;
      &lt;field column="city"&gt;Aachen&lt;/field&gt;
      &lt;field column="amount"&gt;15.00&lt;/field&gt;
      &lt;field column="currency"/&gt;
      &lt;field column="original amount"/&gt;
    &lt;/row&gt;
    &lt;row&gt;
      &lt;field column="date"&gt;2023-07-20&lt;/field&gt;
      &lt;field column="name"&gt;Charlie&lt;/field&gt;
      &lt;field column="city"&gt;Celle&lt;/field&gt;
      &lt;field column="amount"&gt;15.00&lt;/field&gt;
      &lt;field column="currency"&gt;GBP&lt;/field&gt;
      &lt;field column="original amount"&gt;11.99&lt;/field&gt;
    &lt;/row&gt;
  &lt;/rows&gt;
&lt;/csv&gt;</pre></div><p>(with whitespace added for legibility)</p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="illustrative-csv-examples"></a>17.5.11 <a href="#illustrative-csv-examples" style="text-decoration: none">Illustrative examples of processing CSV data</a></h4><p>The following examples illustrate more complex applications making use of CSV parsing functions.</p><p>A variable <code>$crlf</code> is assumed to be in scope representing the CRLF string:</p><div class="exampleInner"><pre xml:space="preserve">let $crlf := fn:char(0x0D)||fn:char(0x0A)</pre></div><div class="example"><div class="exampleHeader"><a id="csv-to-html-table"></a>Example: Converting a CSV into an HTML-style table using <code>fn:parse-csv</code></div><p>Direct conversion is a matter of iterating across the records and fields to generate <code>&lt;tr&gt;</code> and <code>&lt;td&gt;</code> elements.</p><p>Using XQuery:</p><div class="exampleInner"><pre xml:space="preserve" class="small">let $csv := fn:parse-csv(`name,city{ $crlf }Bob,Berlin`)
return &lt;table&gt;
  &lt;thead&gt;{
    for $column in $csv?columns?fields
    return &lt;th&gt;{ $column }&lt;/th&gt;
  }&lt;/thead&gt;
  &lt;tbody&gt;{
    for $row in $csv?rows
    return &lt;tr&gt;{ for $field in $row?fields return &lt;td&gt;{ $field }&lt;/td&gt; }&lt;/tr&gt;
  }&lt;/tbody&gt;
&lt;/table&gt;</pre></div><p>Using XSLT:</p><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:eg="http://example.org/eg"
  xmlns:array="http://www.w3.org/2005/xpath-functions/array"
  exclude-result-prefixes="eg array"
  version="4.0"&gt;
  &lt;xsl:output method="xml" indent="true"/&gt;

  &lt;xsl:template match="." mode="csv-th" expand-text="true"&gt;
    &lt;th&gt;{ . }&lt;/th&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="." mode="csv-td" expand-text="true"&gt;
    &lt;td&gt;{ . }&lt;/td&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="." mode="csv-tr"&gt;
    &lt;tr&gt;
      &lt;xsl:apply-templates select=".?fields" mode="csv-td"/&gt;
    &lt;/tr&gt;
  &lt;/xsl:function&gt;

  &lt;xsl:template name="xsl:initial-template"&gt;
    &lt;xsl:variable name="csv" select="parse-csv(`name,city{ $crlf }Bob,Berlin`)"/&gt;
    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;xsl:apply-templates select="$csv?columns?fields" mode="csv-th"/&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;xsl:apply-templates select="$csv?rows" mode="csv-tr"/&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre></div></div><div class="example"><div class="exampleHeader"><a id="csv-to-html-table-csv-to-xml"></a>Example: Converting a CSV into an HTML-style table using <code>fn:csv-to-xml</code></div><p>The <a href="#func-csv-to-xml"><code>fn:csv-to-xml</code></a> function makes these kinds of conversion-to-XML-table tasks simpler by providing a simple XML represenation of the data. Here, in XQuery:</p><div class="exampleInner"><pre xml:space="preserve" class="small">let $csv := csv-to-xml(`name,city{ $crlf }Bob,Berlin`)
return &lt;table&gt;
  &lt;thead&gt;{
    for $column in $csv/csv/columns/column
    return &lt;th&gt;{ $column }&lt;/th&gt;
  }&lt;/thead&gt;
  &lt;tbody&gt;{
    for $row in $csv/csv/rows/row
    return &lt;tr&gt;{ for $field in $row/field return &lt;td&gt;{ $field }&lt;/td&gt; }&lt;/tr&gt;
  }&lt;/tbody&gt;
&lt;/table&gt;</pre></div><p>And in XSLT:</p><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:fn="http://www.w3.org/2005/xpath-functions"
  exclude-result-prefixes="fn"
  version="4.0"&gt;
  &lt;xsl:output method="xml" indent="true"/&gt;

  &lt;xsl:template match="fn:column" expand-text="true"&gt;
    &lt;th&gt;{ . }&lt;/th&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="fn:field" expand-text="true"&gt;
    &lt;td&gt;{ . }&lt;/td&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="fn:row"&gt;
    &lt;tr&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/tr&gt;
  &lt;/xsl:function&gt;

  &lt;xsl:template match="fn:columns"&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;xsl:apply-templates/&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
  &lt;/xsl:function&gt;

  &lt;xsl:template match="fn:rows"&gt;
    &lt;tbody&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/tbody&gt;
  &lt;/xsl:function&gt;

  &lt;xsl:template match="fn:csv"&gt;
    &lt;table&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/table&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template name="xsl:initial-template"&gt;
    &lt;xsl:apply-templates select="fn:csv-to-xml(`name,city{ $crlf }Bob,Berlin`)"/&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre></div></div></div></div><div class="div2"><h3><a id="ixml-functions"></a>17.6 <a href="#ixml-functions" style="text-decoration: none">Functions on Invisible XML</a></h3><p>This section describes functions that support <a href="#invisible-xml">[Invisible XML]</a> parsing.</p><p>Invisible XML defines a BNF-like language for specifying grammars, together with a mapping from sentences in that grammar to an XML representation. By defining an Invisible XML grammar, a great variety of non-XML data formats can be manipulated as if they were XML. The function <a href="#func-invisible-xml"><code>fn:invisible-xml</code></a> takes a grammar as input, and returns a function which can be used for parsing data instances and converting them to XML node trees.</p><div class="div3"><h4><a id="func-invisible-xml"></a>17.6.1 <a href="#func-invisible-xml" style="text-decoration: none">fn:invisible-xml</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-load-xquery-module">next</a> | <a href="#func-csv-to-xml">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/238">238</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/991">991</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1281">1281</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/1404">1404</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/791">791</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1256">1256</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1282">1282</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/1405">1405</a>]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Creates an Invisible XML parser for a grammar.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:invisible-xml</code>(</td></tr><tr class="arg"><td><code>$grammar</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(xs:string | element(Q{}ixml))?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>fn(xs:string) as item()</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Conceptually, an <a href="#invisible-xml">[Invisible XML]</a> processor takes two arguments: a grammar and an input string. The grammar is a description of some format and the parser will attempt to interpret the input string according to that description. The parser returns an XML representation of the input string as parsed by the provided grammar. If parsing fails, it returns an XML representation that indicates an error occurred and may provide additional error information.</p><p>If the function is called twice with the same arguments, it is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic with respect to node identity</a>. </p><p>For example, the following grammar describes a date as consisting of a year, a month, and a day. Each are a sequence of digits and they are separated by hyphens:</p><div class="exampleInner"><pre xml:space="preserve" class="small"> date = year, -'-', month, -'-', day .
 year = d, d, d, d .
month = '0', d | '1', ['0'|'1'|'2'] .
  day = ['0'|'1'|'2'], d | '3', ['0'|'1'] .
   -d = ['0'-'9'] .</pre></div><p>Using this grammar to parse “2023-10-31” will produce:</p><div class="exampleInner"><pre xml:space="preserve">&lt;date&gt;&lt;year&gt;2023&lt;/year&gt;&lt;month&gt;10&lt;/month&gt;&lt;day&gt;31&lt;/day&gt;&lt;/date&gt;</pre></div><p>Using this grammar to parse “2023-10-32” will produce something like this:</p><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;fail xmlns:ixml='http://invisiblexml.org/NS' ixml:state='failed'&gt;
  &lt;line&gt;1&lt;/line&gt;
  &lt;column&gt;10&lt;/column&gt;
  &lt;pos&gt;9&lt;/pos&gt;
  &lt;unexpected&gt;3&lt;/unexpected&gt;
  &lt;permitted&gt;'3', ['0'; '1'; '2']&lt;/permitted&gt;
&lt;/fail&gt;</pre></div><p>The exact format of the error output will vary between implementations. The only required part of the output is the <code>ixml:state</code> attribute that contains the value <code>failed</code>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Careful readers will observe that the example grammar will parse “2023-00-00” as a date. The grammar could easily be extended to exclude the “00” forms for month and day, but this is only intended to be an illustrative example.</p></div><p>The <a href="#func-invisible-xml"><code>fn:invisible-xml</code></a> function takes a grammar and returns a function that can be used to parse input strings. In practice, constructing a parser from a grammar may be an expensive operation. Returning a parsing function makes it easy to efficiently reuse a parser.</p><p>The provided grammar must be a string conforming to the Invisible XML specification grammar or an XML representation of such a grammar.</p><p>The following options are available. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">fail-on-error?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>fail-on-error?</code></p></td><td class="fos-thin">Raise an error if the parse function fails <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr></tbody></table><p>Additional, <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> options may be available, for example, to control aspects of the XML serialization, to specify the grammar start symbol, or to produce output formats other than XML.</p><p>If <code>$grammar</code> is the empty sequence, a parser is returned for the Invisible XML specification grammar. This <span class="verb">should</span> be the same grammar that the implementation uses to parse iXML grammars. If <code>$grammar</code> is not empty, it <span class="verb">must</span> be a valid Invisible XML grammar. If it is not, <a href="#func-invisible-xml"><code>fn:invisible-xml</code></a> raises <code>err:FOIX0001</code>.</p><p>The parsing function that is returned behaves as follows:</p><ol class="enumar"><li><p>It takes a string as input and returns an item as its result, usually an XML document containing the result of the parse. (The return type is <code>item()</code> to allow implementations to provide other sorts of results.)</p></li><li><p>It is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic with respect to node identity</a> (that is, if it is called twice with the same input string, it may or may not return the same document node each time).</p></li></ol><p>If the <code>fail-on-error</code> option is <code>true</code>, the parsing function will raise <code>err:FOIX0002</code> if the input provided cannot be parsed successfully. Otherwise, it returns an XML representation of the error (rooted at a document node) as described by the <a href="#invisible-xml">[Invisible XML]</a> specification.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">invisible-xml("S=A. A='a'.")("a")</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">&lt;S&gt;&lt;A&gt;a&lt;/A&gt;&lt;/S&gt;</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $parser := invisible-xml("S=A. A='a'.")
let $result := $parser("b")
return $result/*/@*:state = 'failed'</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">true()</pre></div><p><em>(The returned document contains information about the error in the parsed string.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $parser := invisible-xml("S=A. A='a'.", { "fail-on-error": true() })
let $result := $parser("b")
return $result</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p>Raises error FOIX0002.</p></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="lazy-evaluation"></a><span class="deltaxml-new" style="background:#90EE90">18 </span><a href="#lazy-evaluation" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">Deferred evaluation</span></a></h2><p><span class="deltaxml-new" style="background:#90EE90">Deferred-evaluation is achieved in a user-controlled way, using the system-defined </span><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code><span class="deltaxml-new" style="background:#90EE90"> record.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Deferred-evaluation is particularly useful when solving any problem, where data sources of unknown or unpredictable size must be handled, and only one or a few values from these are needed at any time during the processing. </span></p><div class="div2"><h3><a id="generator-use-cases"></a><span class="deltaxml-new" style="background:#90EE90">18.1 </span><a href="#generator-use-cases" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">Major use-cases</span></a></h3><p><span class="deltaxml-new" style="background:#90EE90">The </span><code><span class="deltaxml-new" style="background:#90EE90">f:generator</span></code><span class="deltaxml-new" style="background:#90EE90"> record is a tool for solutions needed for the following use-cases: </span></p><ol class="enumar"><li><p><span class="deltaxml-new" style="background:#90EE90">Processing a huge data-source whose values may not all be needed. A generator produces only the next value from the data-source and only on demand basis.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">Handling a data-source providing unknown or infinite number of values. When requested for the next value of the data-source the generator always produces it, if the data-source still contains any values. It is the responsibility of the caller to issue only the necessary number of requests for the really needed next values.</span></p></li></ol><p><span class="deltaxml-new" style="background:#90EE90">What is achieved in these two cases: </span></p><ul><li><p><span class="deltaxml-new" style="background:#90EE90">A (next) value is produced only on request. No time is spent on producing all values of the collection.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">A (next) value is produced only on request. No memory is consumed to store all values of the collection.</span></p></li></ul><p></p></div><div class="div2"><h3><a id="generator-definitions"></a><span class="deltaxml-new" style="background:#90EE90">18.2 </span><a href="#generator-definitions" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">Definitions</span></a></h3><p><span class="deltaxml-new" style="background:#90EE90">The following terms are defined:</span></p><div class="example"><ul><li><p><span class="termdef"><a id="gr-collection-data-source"></a><span class="deltaxml-new" style="background:#90EE90">[Definition] An </span><span><b><span class="deltaxml-new" style="background:#90EE90">XPath collection</span></b></span><span class="deltaxml-new" style="background:#90EE90"> or just </span><span><b><span class="deltaxml-new" style="background:#90EE90">collection</span></b></span><span class="deltaxml-new" style="background:#90EE90"> has nothing to do with the </span><code><span class="deltaxml-new" style="background:#90EE90">f:collection</span></code><span class="deltaxml-new" style="background:#90EE90"> function. An </span><span><b><span class="deltaxml-new" style="background:#90EE90">XPath collection</span></b></span><span class="deltaxml-new" style="background:#90EE90"> can be a sequence, an array or a map. </span></span></p></li><li><p><span class="termdef"><a id="gr-value"></a><span class="deltaxml-new" style="background:#90EE90">[Definition] Generator </span><span><b><span class="deltaxml-new" style="background:#90EE90">value</span></b></span><span class="deltaxml-new" style="background:#90EE90"> - a "value" produced by a call to the generator method </span><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90"> can be either an individual XPath </span><code><span class="deltaxml-new" style="background:#90EE90">item()</span></code><span class="deltaxml-new" style="background:#90EE90"> or an XPath sequence. </span></span></p></li><li><p><span class="termdef"><a id="gr-instance"></a><span class="deltaxml-new" style="background:#90EE90">[Definition] Generator </span><span><b><span class="deltaxml-new" style="background:#90EE90">instance</span></b></span><span class="deltaxml-new" style="background:#90EE90"> - a given instance of the </span><code><span class="deltaxml-new" style="background:#90EE90">f:generator</span></code><span class="deltaxml-new" style="background:#90EE90"> record or the result produced by a chain of one or more applications of the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method starting from a given </span><code><span class="deltaxml-new" style="background:#90EE90">f:generator</span></code><span class="deltaxml-new" style="background:#90EE90"> instance. </span></span></p></li><li><p><span class="termdef"><a id="gr-next-value"></a><span class="deltaxml-new" style="background:#90EE90">[Definition] The term </span><span><b><span class="deltaxml-new" style="background:#90EE90">the next value of a generator</span></b></span><span class="deltaxml-new" style="background:#90EE90"> denotes the value returned from the </span><code><span class="deltaxml-new" style="background:#90EE90">get-current()</span></code><span class="deltaxml-new" style="background:#90EE90"> method applied on the generator-instance produced by the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> method, if the </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> field of this next generator-instance is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">. This is also the next value in the generator's </span><span><b><span class="deltaxml-new" style="background:#90EE90">yield</span></b></span><span class="deltaxml-new" style="background:#90EE90"> - see below. </span></span></p></li><li><p></p><span class="termdef"><a id="gr-contents"></a><span class="deltaxml-new" style="background:#90EE90">[Definition] The term </span><span><b><span class="deltaxml-new" style="background:#90EE90">yield</span></b><span class="deltaxml-new" style="background:#90EE90"> (of a generator)</span></span><span class="deltaxml-new" style="background:#90EE90"> denotes the consecutive values returned from calling the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> and then the </span><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90"> method starting from the current generator instance, and on each generator instance thus produced, by applying the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> method and then the </span><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90"> method until </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> produces a generator instance whose </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> field is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. </span><div class="note"><p class="prefix"><b><span class="deltaxml-new" style="background:#90EE90">Note:</span></b></p><ol class="enumar"><li><p><span class="deltaxml-new" style="background:#90EE90">Thus, if the consecutive generator instances produced by continuously applying the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> method on each of them, starting from the initialized </span><code><span class="deltaxml-new" style="background:#90EE90">$G1</span></code><span class="deltaxml-new" style="background:#90EE90"> generator is:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$G2, $G3, ... , $Gn, ...</span></code><span class="deltaxml-new" style="background:#90EE90">, then the yield of the generator $G1 is exactly these consecutive generator values:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$G1 =?&gt; get-current(), $G2 =?&gt; get-current(), ..., $Gn =?&gt; get-current(), ... </span></code></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">If the sequence of the generator instances thus produced is finite (for the final produced generator </span><code><span class="deltaxml-new" style="background:#90EE90">$Gm</span></code><span class="deltaxml-new" style="background:#90EE90">, </span><code><span class="deltaxml-new" style="background:#90EE90">$Gm?end-reached eq true()</span></code><span class="deltaxml-new" style="background:#90EE90">, then the yield is:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$G1 =?&gt; get-current(), $G2 =?&gt; get-current(), ..., $Gm-1 =?&gt; get-current()</span></code></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">If the </span><code><span class="deltaxml-new" style="background:#90EE90">$G1</span></code><span class="deltaxml-new" style="background:#90EE90"> generator is not initialized (</span><code><span class="deltaxml-new" style="background:#90EE90">$G1?initialized eq false())</span></code><span class="deltaxml-new" style="background:#90EE90">, then the yield of this generator is the same as the yield of the (first initialized in the chain) </span><code><span class="deltaxml-new" style="background:#90EE90">$G2</span></code><span class="deltaxml-new" style="background:#90EE90"> generator:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$G2 =?&gt; get-current(), $G3 =?&gt; get-current(), ..., $Gn =?&gt; get-current(), ... </span></code></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">The yield is empty, if </span><code><span class="deltaxml-new" style="background:#90EE90">$G1?end-reached eq true</span></code><span class="deltaxml-new" style="background:#90EE90"> and the yield is infinite if neither </span><code><span class="deltaxml-new" style="background:#90EE90">$G1?end-reached eq true()</span></code><span class="deltaxml-new" style="background:#90EE90"> nor any of the consecutive applications of </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> produces a generator </span><code><span class="deltaxml-new" style="background:#90EE90">$Gx</span></code><span class="deltaxml-new" style="background:#90EE90">, such that </span><code><span class="deltaxml-new" style="background:#90EE90">$Gx?end-reached eq true()</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></li></ol></div></span><p></p></li><li><p></p><span class="termdef"><a id="gr-empty-generator"></a><span class="deltaxml-new" style="background:#90EE90">[Definition] A generator is </span><span><b><span class="deltaxml-new" style="background:#90EE90">empty</span></b></span><span class="deltaxml-new" style="background:#90EE90"> if and only if its field </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> has the effective boolean value </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. An </span><span><b><span class="deltaxml-new" style="background:#90EE90">empty generator-instance</span></b></span><span class="deltaxml-new" style="background:#90EE90"> reached in the chain produced by successive evaluations of the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method signifies that the yield of a starting generator-instance has been fully traversed. It has the following properties: </span><ol class="enumar"><li><p><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90">'s evaluation raises an error.</span></p></li><li><p><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90">'s evaluation raises an error.</span></p></li></ol><div class="note"><p class="prefix"><b><span class="deltaxml-new" style="background:#90EE90">Note:</span></b></p><p><span class="deltaxml-new" style="background:#90EE90">Empty generators may arise in two ways:</span></p><ol class="enumar"><li><p><span class="deltaxml-new" style="background:#90EE90">Produced by the function </span><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">Termination of a chain of generator instances - the final value of repeated application of the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method is an empty generator instance.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Generators with infinite yield never reach an empty-generator instance in this process.</span></p></li></ol></div></span><p></p></li></ul></div><p><span class="deltaxml-new" style="background:#90EE90">The fields of the </span><code><span class="deltaxml-new" style="background:#90EE90">f:generator</span></code><span class="deltaxml-new" style="background:#90EE90"> record, including its methods are defined in the next sections.</span></p></div><div class="div2"><h3><a id="generator"></a><span class="deltaxml-new" style="background:#90EE90">18.3 </span><a href="#generator" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">Record fn:generator</span></a></h3><p><span class="deltaxml-new" style="background:#90EE90">This record type is used as a tool for implementing deferred evaluation upon collections of values. The user has to maintain the five record fields, provided below. The user can add any needed map-entries as the value (map) of the last record field: `state` - as appropriate. Fields of </span><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code><span class="deltaxml-new" style="background:#90EE90"> :</span></p><table class="fos-options"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Name</span></th><th><span class="deltaxml-new" style="background:#90EE90">Meaning</span></th></tr></thead><tbody><tr><td><p><code><span class="deltaxml-new" style="background:#90EE90">initialized</span></code></p></td><td class="fos-thin"><p><span class="deltaxml-new" style="background:#90EE90">If the value of </span><code><span class="deltaxml-new" style="background:#90EE90">initialized</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90"> calling </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =?&gt; get-current()</span></code><span class="deltaxml-new" style="background:#90EE90"> raises error [</span><a href="#ERRFOGR0001" title="err:FOGR0001"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0001</span></a><span class="deltaxml-new" style="background:#90EE90">]. When a </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is initially created, sometimes it makes sense to perform additional, initializing actions on it, before it becomes possible to extract its current value. In such case, in order to get the first value of the yield, the caller must call </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =?&gt; move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> and the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method should produce a new generator, whose </span><code><span class="deltaxml-new" style="background:#90EE90">initialized</span></code><span class="deltaxml-new" style="background:#90EE90"> field is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p><ul><li><p><b><span class="deltaxml-new" style="background:#90EE90">Type: </span></b><code><span class="deltaxml-new" style="background:#90EE90">xs:boolean</span></code></p></li></ul></td></tr><tr><td><p><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code></p></td><td class="fos-thin"><p><span class="deltaxml-new" style="background:#90EE90">Indicates whether or not the yield of the generator is empty. If after a call to </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> the value of the returned generator's </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> field is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> then further calling </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> or </span><code><span class="deltaxml-new" style="background:#90EE90">get-current()</span></code><span class="deltaxml-new" style="background:#90EE90"> on this generator raises error [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">]. </span></p><ul><li><p><b><span class="deltaxml-new" style="background:#90EE90">Type: </span></b><code><span class="deltaxml-new" style="background:#90EE90">xs:boolean</span></code></p></li></ul></td></tr><tr><td><p><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code></p></td><td class="fos-thin"><p><span class="deltaxml-new" style="background:#90EE90">This function produces the current value of the generator after the last call to </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90">, if this last call didn't return a generator whose </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> value was </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. </span><code><span class="deltaxml-new" style="background:#90EE90">get-current()</span></code><span class="deltaxml-new" style="background:#90EE90"> must only be called if the value of </span><code><span class="deltaxml-new" style="background:#90EE90">initialized</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> and the value of </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">, otherwise an error, respectively [</span><a href="#ERRFOGR0001" title="err:FOGR0001"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0001</span></a><span class="deltaxml-new" style="background:#90EE90">] or [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">], is raised. </span></p><ul><li><p><b><span class="deltaxml-new" style="background:#90EE90">Type: </span></b><code><span class="deltaxml-new" style="background:#90EE90">fn($this as f:generator) as item()*</span></code></p></li></ul></td></tr><tr><td><p><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code></p></td><td class="fos-thin"><p><span class="deltaxml-new" style="background:#90EE90">This function, when called on a generator-instance whose </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> value is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">, produces the next generator-instance, whose </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> field could be </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">, however if after the call this field of the produced generator-instance is still </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">, then calling </span><code><span class="deltaxml-new" style="background:#90EE90">get-current()</span></code><span class="deltaxml-new" style="background:#90EE90">) on this resulting generator-instance produces the "next value" of the generator. </span></p><ul><li><p><b><span class="deltaxml-new" style="background:#90EE90">Type: </span></b><code><span class="deltaxml-new" style="background:#90EE90">fn($this as f:generator) as f:generator</span></code></p></li></ul></td></tr><tr><td><p><code><span class="deltaxml-new" style="background:#90EE90">state</span></code></p></td><td class="fos-thin"><p><span class="deltaxml-new" style="background:#90EE90">This map can be used, if necessary, to access data by both </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> and </span><code><span class="deltaxml-new" style="background:#90EE90">get-current()</span></code><span class="deltaxml-new" style="background:#90EE90">. The function </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> can set the entries of this map in the result of this function (the next generator-instance) so that they are accesible from it. </span></p><ul><li><p><b><span class="deltaxml-new" style="background:#90EE90">Type: </span></b><code><span class="deltaxml-new" style="background:#90EE90">map(*)</span></code></p></li></ul></td></tr></tbody></table></div><div class="div2"><h3><a id="generator-functions"></a><span class="deltaxml-new" style="background:#90EE90">18.4 </span><a href="#generator-functions" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">Functions on generators</span></a></h3><p><span class="deltaxml-new" style="background:#90EE90">The functions defined in this section use a conventional namespace prefix "gn", which is assumed to be bound to the namespace URI http://www.w3.org/2005/xpath-functions/generator. They are listed under the following categories, based on the type of the function result:</span></p><ul><li><p><span class="deltaxml-new" style="background:#90EE90">Functions returning a specific value: an </span><code><span class="deltaxml-new" style="background:#90EE90">item()</span></code><span class="deltaxml-new" style="background:#90EE90"> or a sequence.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">Functions that produce another generator from existing generators.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">Functions that produce a generator from data by a data-provider.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">Functions that produce an XPath collection from the yield of a generator.</span></p></li></ul><p><span class="deltaxml-new" style="background:#90EE90">These functions do not evaluate eagerly the yield of any of their generator-operands. A value from a yield is produced only if explicitly requested by evaluating the methods </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> and </span><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90">. At no point in the computation it is necessary to have all values of a yield available. In most cases a function would only need one or a few values from a yield. No unnecessary computation of a value from a yield is done and no memory is used to hold such unnecessary value at any point in the computation. This is why the evaluation of the functions defined here is referred to as "Deferred Evaluation". </span></p><div class="note"><p class="prefix"><b><span class="deltaxml-new" style="background:#90EE90">Note:</span></b></p><p><span class="deltaxml-new" style="background:#90EE90">Most of the examples in this section depend on the definition of the following variables:</span></p><div class="example"><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf := f:generator(initialized := true(), 
                      end-reached := false(), 
                      get-current := fn($this as f:generator){$this?state?last +1},
                      move-next := fn($this as f:generator)
                      {
                       if(not($this?initialized))
                         then map:put($this, "initialized", true())
                         else map:put($this, "state", map{"last": $this?state?last + 1})
                      },
                      state := map{"last" : 1}
                          ),
    $genN := $gen2ToInf =&gt; map:put("state", map{"last": 0}),
    $gen0toInf := $gen2ToInf =&gt; map:put("state", map{"last": -1}),
    $double := fn($n) {2*$n},
    $sum2 := fn($m, $n) {$m + $n},
    $product := fn($m, $n) {$m * $n},
    $factorial := fn($n) {fold-left(1 to $n, 1, $product)}</span></pre></div></div><p><span class="deltaxml-new" style="background:#90EE90"> The examples use three generators with infinite yields: </span></p><ul><li><p><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf</span></code><span class="deltaxml-new" style="background:#90EE90"> with yield - all integers in the interval from 2 to Infinity ([2, ∞])</span></p></li><li><p><code><span class="deltaxml-new" style="background:#90EE90">$genN</span></code><span class="deltaxml-new" style="background:#90EE90"> with yield - the sequence of all natural numbers: all integers in [1, ∞]</span></p></li><li><p><code><span class="deltaxml-new" style="background:#90EE90">$gen0toInf </span></code><span class="deltaxml-new" style="background:#90EE90"> with yield - the sequence of all non-negative numbers: all integers in [0, ∞]</span></p></li></ul><p></p><p><span class="deltaxml-new" style="background:#90EE90">And four functions: </span></p><ul><li><p><code><span class="deltaxml-new" style="background:#90EE90">$double</span></code><span class="deltaxml-new" style="background:#90EE90"> returns its argument, multiplied by </span><code><span class="deltaxml-new" style="background:#90EE90">2</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></li><li><p><code><span class="deltaxml-new" style="background:#90EE90">$sum2</span></code><span class="deltaxml-new" style="background:#90EE90"> returns the sum of its two arguments.</span></p></li><li><p><code><span class="deltaxml-new" style="background:#90EE90">$product</span></code><span class="deltaxml-new" style="background:#90EE90"> returns the product of its two arguments.</span></p></li><li><p><code><span class="deltaxml-new" style="background:#90EE90">$factorial</span></code><span class="deltaxml-new" style="background:#90EE90"> given a non-negative argument </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> returns its factorial </span><code><span class="deltaxml-new" style="background:#90EE90">($n)!</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></li></ul><p></p></div><div class="div3"><h4><a id="generator-functions-getting-value"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1 </span><a href="#generator-functions-getting-value" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">Functions returning a specific value</span></a></h4><p><span class="deltaxml-new" style="background:#90EE90">This group of functions returns a single value computed from the yield of a supplied generator. Each function inspects the yield only as far as necessary to obtain that value.</span></p><table class="index"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Function</span></th><th><span class="deltaxml-new" style="background:#90EE90">Meaning</span></th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:at</span></code></td><td><span class="deltaxml-new" style="background:#90EE90"> Returns the </span><code><span class="deltaxml-new" style="background:#90EE90">$k</span></code><span class="deltaxml-new" style="background:#90EE90">-th value from the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:contains</span></code></td><td><span class="deltaxml-new" style="background:#90EE90"> Returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> if the </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90"> is contained in the yield of the generator, and </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90"> otherwise. The comparisons are done using </span><a href="#func-deep-equal"><code><span class="deltaxml-new" style="background:#90EE90">fn:deep-equal</span></code></a><span class="deltaxml-new" style="background:#90EE90">. </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:first-where</span></code></td><td><span class="deltaxml-new" style="background:#90EE90"> Returns the first </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90"> in the yield of the generator for which </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate($value)</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. If the generator's yield doesn't contain any such item, error [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised. </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:fold-left</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Processes consecutively the values of the yield of the supplied generator, applying the supplied function repeatedly to each value in turn, together with an accumulated result value.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:fold-right</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Processes consecutively from right to left the values of the yield of the supplied generator, applying the supplied function repeatedly to each value in turn, together with an accumulated result value.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:fold-lazy</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Produces the same result as gn:fold-right on the entire yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> with the operation specified by </span><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code><span class="deltaxml-new" style="background:#90EE90"> but also performs short-circuiting if detected by the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$short-circuit-detector</span></code><span class="deltaxml-new" style="background:#90EE90"> function.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:head</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Produces the first value contained in the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:some</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> if and only if the generator is initialized and its yield contains at least one value.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:some-where</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> if the generator is initialized and its yield contains any value upon which evaluating the supplied predicate returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. Otherwise, </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90"> is returned.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:value</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Produces the value contained in this generator-instance.</span></td></tr></tbody></table><div class="div4"><h5><a id="generator-at"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.1 </span><a href="#generator-at" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:at</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> Returns the </span><code><span class="deltaxml-new" style="background:#90EE90">$k</span></code><span class="deltaxml-new" style="background:#90EE90">-th value from the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:at</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$k</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:positiveInteger</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> If </span><code><span class="deltaxml-new" style="background:#90EE90">$k</span></code><span class="deltaxml-new" style="background:#90EE90"> is greater than the number of items contained in the generator's yield, error [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">gn:subrange($generator, $k, $k) =?&gt; get-current()</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:at(1)</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">2</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:at(5)</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">6</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(5) =&gt; gn:at(6)</span></code></pre></div></td><td style="vertical-align:top"><p><span class="deltaxml-new" style="background:#90EE90">Raises error FOGR0002.</span></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-contains"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.2 </span><a href="#generator-contains" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:contains</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> Returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> if the </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90"> is contained in the yield of the generator, and </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90"> otherwise. The comparisons are done using </span><a href="#func-deep-equal"><code><span class="deltaxml-new" style="background:#90EE90">fn:deep-equal</span></code></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:contains</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">xs:boolean</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> The comparisons are done using </span><a href="#func-deep-equal"><code><span class="deltaxml-new" style="background:#90EE90">fn:deep-equal</span></code></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($gen?initialized)) then  $gen =?&gt; move-next()
              else $gen
 return
  if($gen?end-reached) then false()
   else
     let $current := $gen =?&gt; get-current()
       return
          if(deep-equal($current, $value)) then true()
            else gn:contains($gen =?&gt; move-next(), $value)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$genN =&gt; gn:take(10) =&gt; gn:contains(3)</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$genN =&gt; gn:take(10) =&gt; gn:contains(20)</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$genN =&gt; gn:take(10) =&gt; gn:contains(0)</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$genN =&gt; gn:take(10) =&gt; gn:contains(11)</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$genN =&gt; gn:contains(15)</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-first-where"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.3 </span><a href="#generator-first-where" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:first-where</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> Returns the first </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90"> in the yield of the generator for which </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate($value)</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. If the generator's yield doesn't contain any such item, error [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:first-where</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*) as xs:boolean</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> The </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> function is applied consecutively on every value in the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> until it returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. This value is then returned as the result. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">$gen =&gt; gn:skip-while(fn($x as item()*){not($pred($x))}) =&gt; gn:head()</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:first-where(fn($n){$n gt 10})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">11</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:chunk(10)  
           =&gt;  gn:first-where(
                    fn($arr as array(*))
                    {$arr(1) le 33 and $arr(10) ge 33})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[32,33,34,35,36,37,38,39,40,41]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-fold-left"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.4 </span><a href="#generator-fold-left" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:fold-left</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Processes consecutively the values of the yield of the supplied generator, applying the supplied function repeatedly to each value in turn, together with an accumulated result value.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:fold-left</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*, item()*) as item()*) as item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Let the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains </span><code><span class="deltaxml-new" style="background:#90EE90">N</span></code><span class="deltaxml-new" style="background:#90EE90"> values. Let us denote these </span><code><span class="deltaxml-new" style="background:#90EE90">N</span></code><span class="deltaxml-new" style="background:#90EE90"> values as </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">2</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, ..., </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">N</span></sub></var><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90"> If </span><code><span class="deltaxml-new" style="background:#90EE90">N eq 0</span></code><span class="deltaxml-new" style="background:#90EE90"> the function returns </span><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p><p><span class="deltaxml-new" style="background:#90EE90"> If </span><code><span class="deltaxml-new" style="background:#90EE90">N gt 0</span></code><span class="deltaxml-new" style="background:#90EE90"> the function calls </span><code><span class="deltaxml-new" style="background:#90EE90">$action($init, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">)</span></code><span class="deltaxml-new" style="background:#90EE90"> returning a value </span><var><span class="deltaxml-new" style="background:#90EE90">A</span><sub><span class="deltaxml-new" style="background:#90EE90">1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">. </span></p><p><span class="deltaxml-new" style="background:#90EE90"> If the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains a second value, the function then calls </span><code><span class="deltaxml-new" style="background:#90EE90">$action(</span><var><span class="deltaxml-new" style="background:#90EE90">A</span><sub><span class="deltaxml-new" style="background:#90EE90">1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">2</span></sub></var><span class="deltaxml-new" style="background:#90EE90">)</span></code><span class="deltaxml-new" style="background:#90EE90"> returning a value </span><var><span class="deltaxml-new" style="background:#90EE90">A</span><sub><span class="deltaxml-new" style="background:#90EE90">2</span></sub></var><span class="deltaxml-new" style="background:#90EE90">. To process the </span><var><span class="deltaxml-new" style="background:#90EE90">k</span><sub><span class="deltaxml-new" style="background:#90EE90">th</span></sub></var><span class="deltaxml-new" style="background:#90EE90"> value it calls </span><code><span class="deltaxml-new" style="background:#90EE90">$action(</span><var><span class="deltaxml-new" style="background:#90EE90">A</span><sub><span class="deltaxml-new" style="background:#90EE90">k-1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">k</span></sub></var><span class="deltaxml-new" style="background:#90EE90">)</span></code></p><p><span class="deltaxml-new" style="background:#90EE90">This continues in the same way until the end of the yield of the</span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">; the final result is the result of the last call on </span><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function delivers the same result as the following XQuery implementation.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">declare function gn:fold-left($generator, 
                              $init as item()*,  
                              $action as fn(item()*, item()*) as item()*) as item()*
{
  if($generator?end-reached) then $init
    else gn:fold-left(gn:tail($generator), 
                      $action($init, $gen =?&gt; get-current()), 
                      $action)		
}</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(5) =&gt; gn:fold-left(0, fn($x, $y){$x + $y})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">20</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() 
    =&gt; gn:fold-left(54321, fn($x, $y){$x + $y})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">54321</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen0toInf 
    =&gt; gn:for-each(fn($n){(2 * $n + 1) 
                          div $factorial(2*xs:decimal($n)})
    =&gt; gn:take(8) 
    =&gt; gn:fold-left(0, fn($x, $y){$x + $y})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">2.718281828458229747</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-fold-right"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.5 </span><a href="#generator-fold-right" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:fold-right</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Processes consecutively from right to left the values of the yield of the supplied generator, applying the supplied function repeatedly to each value in turn, together with an accumulated result value.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:fold-right</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*, item()*) as item()*) as item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Let the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains </span><code><span class="deltaxml-new" style="background:#90EE90">n</span></code><span class="deltaxml-new" style="background:#90EE90"> values. Let us denote these </span><code><span class="deltaxml-new" style="background:#90EE90">n</span></code><span class="deltaxml-new" style="background:#90EE90"> values as </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">2</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, ..., </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">n</span></sub></var><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90"> If </span><code><span class="deltaxml-new" style="background:#90EE90">n eq 0</span></code><span class="deltaxml-new" style="background:#90EE90"> the function returns </span><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p><p><span class="deltaxml-new" style="background:#90EE90"> If </span><code><span class="deltaxml-new" style="background:#90EE90">n gt 0</span></code><span class="deltaxml-new" style="background:#90EE90"> the function calls </span><code><span class="deltaxml-new" style="background:#90EE90">$action(</span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">n</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, $init)</span></code><span class="deltaxml-new" style="background:#90EE90"> returning a value </span><var><span class="deltaxml-new" style="background:#90EE90">A</span><sub><span class="deltaxml-new" style="background:#90EE90">n-1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">. </span></p><p><span class="deltaxml-new" style="background:#90EE90"> If the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains a previous value, the function then calls </span><code><span class="deltaxml-new" style="background:#90EE90">$action(</span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">n-1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">A</span><sub><span class="deltaxml-new" style="background:#90EE90">n-1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">)</span></code><span class="deltaxml-new" style="background:#90EE90"> returning a value </span><var><span class="deltaxml-new" style="background:#90EE90">A</span><sub><span class="deltaxml-new" style="background:#90EE90">n-2</span></sub></var><span class="deltaxml-new" style="background:#90EE90">. To process the </span><var><span class="deltaxml-new" style="background:#90EE90">k</span><sub><span class="deltaxml-new" style="background:#90EE90">th</span></sub></var><span class="deltaxml-new" style="background:#90EE90"> value it calls </span><code><span class="deltaxml-new" style="background:#90EE90">$action(</span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">k</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">A</span><sub><span class="deltaxml-new" style="background:#90EE90">k-1</span></sub></var><span class="deltaxml-new" style="background:#90EE90">)</span></code></p><p><span class="deltaxml-new" style="background:#90EE90">This continues in the same way until the starting value of the yield of the</span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is reached; the final result is the result of the last call on </span><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code><span class="deltaxml-new" style="background:#90EE90">, that is </span><var><span class="deltaxml-new" style="background:#90EE90">A</span><sub><span class="deltaxml-new" style="background:#90EE90">0</span></sub></var><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function delivers the same result as the following XQuery implementation.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">declare function gn:fold-right($generator, 
                              $init as item()*,  
                              $action as fn(item()*, item()*) as item()*) as item()*
{
  if($generator?end-reached) then $init
    else $action(gn:head($generator), 
	             gn:fold-right(gn:tail($generator), $init, $action))		
}</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(5) =&gt; gn:fold-right(0, fn($x, $y){$x + $y})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">20</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator()
    =&gt; gn:fold-right(12345, fn($x, $y){$x + $y})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">12345</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-fold-lazy"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.6 </span><a href="#generator-fold-lazy" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:fold-lazy</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Produces the same result as gn:fold-right on the entire yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> with the operation specified by </span><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code><span class="deltaxml-new" style="background:#90EE90"> but also performs short-circuiting if detected by the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$short-circuit-detector</span></code><span class="deltaxml-new" style="background:#90EE90"> function.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:fold-lazy</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*, item()*) as item()*) as item()*</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$short-circuit-detector</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(*) as item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> doesn't contain any value, </span><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code><span class="deltaxml-new" style="background:#90EE90"> is returned.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, the same processing as done with gn:fold-right is performed, but on each step of the traversal of the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> the function </span><code><span class="deltaxml-new" style="background:#90EE90">$short-circuit-detector</span></code><span class="deltaxml-new" style="background:#90EE90"> is called, passing to it two arguments: the current value of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">'s yield and the value of </span><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p><p><span class="deltaxml-new" style="background:#90EE90">The result of applying </span><code><span class="deltaxml-new" style="background:#90EE90">$short-circuit-detector</span></code><span class="deltaxml-new" style="background:#90EE90"> on these two arguments is a function. If the arity of the returned function is </span><code><span class="deltaxml-new" style="background:#90EE90">0</span></code><span class="deltaxml-new" style="background:#90EE90">, this means that short-circuiting has been detected. In this case the folding process ends and the result of applying this 0-arity function is returned. For example, if </span><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code><span class="deltaxml-new" style="background:#90EE90"> is multiplication, a suitable </span><code><span class="deltaxml-new" style="background:#90EE90">$short-circuit-detector</span></code><span class="deltaxml-new" style="background:#90EE90"> function returns </span><code><span class="deltaxml-new" style="background:#90EE90">fn() {0}</span></code><span class="deltaxml-new" style="background:#90EE90"> if one of the two arguments passed to it is </span><code><span class="deltaxml-new" style="background:#90EE90">0</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p><div class="note"><p class="prefix"><b><span class="deltaxml-new" style="background:#90EE90">Note:</span></b></p><p><span class="deltaxml-new" style="background:#90EE90">Detecting the possibility of a short-circuiting makes it possible to fold the contents of an infinite-yield generator - for example computing the product of the infinite sequence of integers in [-3, ∞].</span></p></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function delivers the same result as the following XQuery implementation.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">declare function gn:fold-lazy($generator as f:generator, 
                              $init as item()*, 
                              $action as fn(*), 
                              $short-circuit-detector as function(*)) as item()*
{
  if($generator?end-reached) then $init
  else
   let $current := $generator =?&gt; get-current()
     return
       if(function-arity($short-circuit-detector($current, $init)) eq 0)
         then $short-circuit-detector($current, $init)()
         else $action($current, gn:fold-lazy($generator =?&gt; move-next(), 
					     $init, 
					     $action, 
					     $short-circuit-detector))
}</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">let $multShortCircuitProvider := fn($x, $y)
        {
          if($x eq 0) then fn(){0}
            else fn($z) {$x * $z}
        },
        $gen-5ToInf := $gen2ToInf =&gt; gn:for-each(fn($n){$n -7})
     return
     (
       $gen2ToInf =&gt; gn:take(5) 
                  =&gt; gn:fold-lazy(1, $product, $multShortCircuitProvider),
				  
       $gen-5ToInf =&gt; gn:fold-lazy(1, $product, $multShortCircuitProvider)</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">(720, 0)</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(An infinite product in the 2nd expression is successfully evaluated.)</span></em></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-head"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.7 </span><a href="#generator-head" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:head</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Produces the first value contained in the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:head</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the generator's yield doesn't contain any value, error [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">gn:take($generator, 1) =?&gt; get-current()</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:head()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">2</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:tail() =&gt; gn:head()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">3</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:head()</span></code></pre></div></td><td style="vertical-align:top"><p><span class="deltaxml-new" style="background:#90EE90">Raises error FOGR0002.</span></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-some"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.8 </span><a href="#generator-some" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:some</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> if and only if the generator is initialized and its yield contains at least one value.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:some</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">xs:boolean</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function produces </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> if the generator is initialized (</span><code><span class="deltaxml-new" style="background:#90EE90">$generator?initialized eq true()</span></code><span class="deltaxml-new" style="background:#90EE90">) and its yield contains values (</span><code><span class="deltaxml-new" style="background:#90EE90">$generator?end-reached eq false()</span></code><span class="deltaxml-new" style="background:#90EE90">).</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, the function returns </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">$generator?initialized and not($generator?end-reached)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:some()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:some()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-some-where"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.9 </span><a href="#generator-some-where" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:some-where</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> if the generator is initialized and its yield contains any value upon which evaluating the supplied predicate returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. Otherwise, </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90"> is returned.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:some-where</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">function(item()*) as xs:boolean</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">xs:boolean</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function produces </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> if the generator is initialized (</span><code><span class="deltaxml-new" style="background:#90EE90">$generator?initialized eq true()</span></code><span class="deltaxml-new" style="background:#90EE90">) and when filtered with the given predicate, the yield of the produced generator contains values:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:filter($predicate) =&gt; gn:some()</span></code><span class="deltaxml-new" style="background:#90EE90"> .</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, the function returns </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">gn:some(gn:filter($generator, $predicate))</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(5) =&gt; gn:some-where(fn($n){$n ge 7})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(5) =&gt; gn:some-where(fn($n){$n ge 6})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:some-where(fn($n){$n ge 100})</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-value"></a><span class="deltaxml-new" style="background:#90EE90">18.4.1.10 </span><a href="#generator-value" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:value</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Produces the value contained in this generator-instance.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:value</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the generator's yield doesn't contain any value, error [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise returns the value obtained from the current generator-instance (</span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">)</span></p><div class="note"><p class="prefix"><b><span class="deltaxml-new" style="background:#90EE90">Note:</span></b></p><p><span class="deltaxml-new" style="background:#90EE90">This function is a synonym for the generator method </span><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90">. The goal is to free the end user from the nuisance of having to enter additional parentheses within an expression due to the different precedence of the </span><code><span class="deltaxml-new" style="background:#90EE90">=?&gt;</span></code><span class="deltaxml-new" style="background:#90EE90"> and </span><code><span class="deltaxml-new" style="background:#90EE90">=&gt;</span></code><span class="deltaxml-new" style="background:#90EE90"> operators. Thus, instead of having to write: </span></p><p><code><span class="deltaxml-new" style="background:#90EE90">($myGenerator =&gt; gn:take(5)) =?&gt; get-current()</span></code><span class="deltaxml-new" style="background:#90EE90">, one simply writes: </span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$myGenerator =&gt; gn:take(5) =&gt; gn:value()</span></code></p></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">$generator =?&gt; get-current()</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">2</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(3) =&gt; gn:skip(2) =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">4</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><span class="deltaxml-new" style="background:#90EE90">Raises error FOGR0002.</span></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div3"><h4><a id="generator-functions-producing-generators"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2 </span><a href="#generator-functions-producing-generators" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">Functions that produce another generator from existing generators</span></a></h4><p><span class="deltaxml-new" style="background:#90EE90">Each of the functions in this section takes a generator as its first argument, and returns a generator. This allows chaining of function calls to produce complex transformations of the yields of the generators that are supplied as arguments. Only the starting instance of the result-generator is produced, and only the instances of the intermediate-result-generators that are required to compute this starting instance are produced. </span></p><table class="index"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Function</span></th><th><span class="deltaxml-new" style="background:#90EE90">Meaning</span></th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:append</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Creates from a given </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> a new one whose yield is the yield of the original generator with the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90"> appended to it.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:chunk</span></code></td><td><span class="deltaxml-new" style="background:#90EE90"> Returns a new generator each of whose yield values is a "chunk" of consecutive values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> held in an array of size </span><code><span class="deltaxml-new" style="background:#90EE90">$size</span></code><span class="deltaxml-new" style="background:#90EE90">, with the possible exception that the size of the array containing the last "chunk" could be smaller. </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:concat</span></code></td><td><span class="deltaxml-new" style="background:#90EE90"> Returns a new generator whose yield consists of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> followed by the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:distinct</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains only the distinct values from the original generator, in their original order.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:filter</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains exactly those values from the yield of the original generator, upon which the supplied predicate returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">, in their original order.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:for-each</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Produces a new generator, in the yield of which each value is the result of applying the function item </span><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code><span class="deltaxml-new" style="background:#90EE90"> on the corresponding value of the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, in their original order.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:for-each-pair</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Produces a new generator, in the yield of which each value is the result of applying the function item </span><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code><span class="deltaxml-new" style="background:#90EE90"> on the corresponding values of the yields of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator1</span></code><span class="deltaxml-new" style="background:#90EE90"> and </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90">, in their original order.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:insert-at</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains the first </span><code><span class="deltaxml-new" style="background:#90EE90">$position - 1</span></code><span class="deltaxml-new" style="background:#90EE90"> values of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, followed by the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90">, followed by all the values of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> starting from position </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:next</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Produces the next state/generator-instance obtained from the current generator-instance </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:prepend</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator, whose yield is the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90"> followed by the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:remove-at</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator, whose yield is the result of removing the </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90">th value from the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> . </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:remove-where</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield is the result of removing from the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> all values upon which the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:replace</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator, whose yield is the result of replacing in the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> the first value upon which the application of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> with the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$replacement</span></code><span class="deltaxml-new" style="background:#90EE90"> . </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:reverse</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator, the values of whose yield are the ones in the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> but in reverse order. </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:scan-left</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains the partial results of the evaluation of the </span><code><span class="deltaxml-new" style="background:#90EE90">gn:fold-left</span></code><span class="deltaxml-new" style="background:#90EE90"> function with the same arguments.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:scan-right</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains the partial results of the evaluation of the </span><code><span class="deltaxml-new" style="background:#90EE90">gn:fold-right</span></code><span class="deltaxml-new" style="background:#90EE90"> function with the same arguments.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:skip</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains only the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> after the </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90">th one and in their original order.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:skip-strict</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> after the </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90">th one. If the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains less than </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> values, and the supplied argument </span><code><span class="deltaxml-new" style="background:#90EE90">$raise-error-on-empty</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> then [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised. </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:skip-while</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains all the values from the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, having removed the longest leading segment of values on which the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:subrange</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains the values from the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, from position </span><code><span class="deltaxml-new" style="background:#90EE90">$start</span></code><span class="deltaxml-new" style="background:#90EE90"> to position </span><code><span class="deltaxml-new" style="background:#90EE90">$end</span></code><span class="deltaxml-new" style="background:#90EE90">in their original order.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:tail</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains all the values but the first from the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> or raises [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] if the supplied generator's yield is empty.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:take</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield is the leading segment with length </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> from the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> or raises [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] if the supplied generator's yield is empty and </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> is greater than </span><code><span class="deltaxml-new" style="background:#90EE90">0</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:take-while</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains the longest leading segment from the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> on all values of which the provided function </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:zip</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a new generator the </span><code><span class="deltaxml-new" style="background:#90EE90">k</span></code><span class="deltaxml-new" style="background:#90EE90">th value of whose yield is an array having two members: the </span><code><span class="deltaxml-new" style="background:#90EE90">k</span></code><span class="deltaxml-new" style="background:#90EE90">th value of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator1</span></code><span class="deltaxml-new" style="background:#90EE90"> and the </span><code><span class="deltaxml-new" style="background:#90EE90">k</span></code><span class="deltaxml-new" style="background:#90EE90">th value of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90">, where </span><code><span class="deltaxml-new" style="background:#90EE90">k</span></code><span class="deltaxml-new" style="background:#90EE90">does not exceed the smaller of the lengths of the yields of the two generators. </span></td></tr></tbody></table><div class="div4"><h5><a id="generator-append"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.1 </span><a href="#generator-append" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:append</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Creates from a given </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> a new one whose yield is the yield of the original generator with the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90"> appended to it.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:append</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">A new generator </span><var><span class="deltaxml-new" style="background:#90EE90">Gen</span><sub><span class="deltaxml-new" style="background:#90EE90">2</span></sub></var><span class="deltaxml-new" style="background:#90EE90"> is created, whose yield has a single value: </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">The function returns the result of applying </span><code><span class="deltaxml-new" style="background:#90EE90">gn:concat</span></code><span class="deltaxml-new" style="background:#90EE90"> on the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> and the generator </span><var><span class="deltaxml-new" style="background:#90EE90">Gen</span><sub><span class="deltaxml-new" style="background:#90EE90">2</span></sub></var><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
              else $generator,
    $genSingle := $gen =&gt; map:put("get-current", fn($this as f:generator){$value})
                       =&gt; map:put("move-next", fn($this as f:generator)
                                                 {gn:empty-generator()})
                       =&gt; map:put("end-reached", false())
 return
   gn:concat($gen, $genSingle)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:append(101) instance of f:generator</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:append(101) =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">2</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(5) =&gt; gn:append(101) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,5,6,101]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:append(101) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[101]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-chunk"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.2 </span><a href="#generator-chunk" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:chunk</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> Returns a new generator each of whose yield values is a "chunk" of consecutive values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> held in an array of size </span><code><span class="deltaxml-new" style="background:#90EE90">$size</span></code><span class="deltaxml-new" style="background:#90EE90">, with the possible exception that the size of the array containing the last "chunk" could be smaller. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:chunk</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$size</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:positiveInteger</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the generator's yield doesn't contain any value, an empty generator (with empty yield) is returned.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise returns a new generator: </span><var><span class="deltaxml-new" style="background:#90EE90">G</span><sub><span class="deltaxml-new" style="background:#90EE90">next</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, whose current-value is:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:take($size) =&gt; gn:to-array()</span></code><span class="deltaxml-new" style="background:#90EE90">, and upon which the function </span><code><span class="deltaxml-new" style="background:#90EE90">gn:next(</span><var><span class="deltaxml-new" style="background:#90EE90">G</span><sub><span class="deltaxml-new" style="background:#90EE90">next</span></sub></var><span class="deltaxml-new" style="background:#90EE90">)</span></code><span class="deltaxml-new" style="background:#90EE90"> produces the same generator as:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:skip($size) =&gt; gn:chunk($size)</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
                else $generator
   return
     if($gen?end-reached) then gn:empty-generator()
     else
       let $thisChunk := gn:to-array(gn:take($gen, $size)),
           $cutGen := gn:skip($gen, $size),
           $resultGen := $gen =&gt; map:put("get-current", fn($this as f:generator){$thisChunk})
                              =&gt; map:put("move-next",   
                                         fn($this as f:generator){gn:chunk($cutGen, $size)})
        return $resultGen</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:chunk(20) =&gt; gn:some()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:chunk(10) =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,5,6,7,8,9,10,11]</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(The first from an infinite number of chunks).</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:chunk(10) =&gt; gn:next() =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[12,13,14,15,16,17,18,19,20,21]</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(The second from an infinite number of chunks).</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:chunk(4) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[[2,3,4,5],[6,7,8,9],[10,11]]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:chunk(4) 
            =&gt; gn:for-each(fn($arr)
                      {array:size($arr)}) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[4,4,2]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-concat"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.3 </span><a href="#generator-concat" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:concat</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> Returns a new generator whose yield consists of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> followed by the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:concat</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function produces a new generator whose yield consists of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> followed by the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Thus, if the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains </span><code><span class="deltaxml-new" style="background:#90EE90">$M</span></code><span class="deltaxml-new" style="background:#90EE90"> values, and the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90"> contains </span><code><span class="deltaxml-new" style="background:#90EE90">$N</span></code><span class="deltaxml-new" style="background:#90EE90"> values.</span></p><p><span class="deltaxml-new" style="background:#90EE90">The yield of the generator returned by the function: </span><code><span class="deltaxml-new" style="background:#90EE90">$result-generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains </span><code><span class="deltaxml-new" style="background:#90EE90">$M + $N</span></code><span class="deltaxml-new" style="background:#90EE90"> values, and:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$result-generator =&gt; gn:take($M)</span></code><span class="deltaxml-new" style="background:#90EE90"> is a generator that has the same yield as </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, and:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$result-generator =&gt; gn:skip($M)</span></code><span class="deltaxml-new" style="background:#90EE90"> is a generator that has the same yield as </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
			else $generator,
    $gen2 := if(not($generator2?initialized)) then $gen2 =?&gt; move-next()
             else $generator2,
    $resultGen := if($gen?end-reached) then $gen2
                    else if($gen2?end-reached) then $gen
                         else
                           $gen  =&gt; map:put("move-next", 
                                            fn($this as f:generator)
                                              {
                                               let $nextGen := $gen =?&gt; move-next()
                                                return 
                                                  gn:concat($nextGen, $gen2)
                                              }
                                           )                                   
 return 
   $resultGen</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:subrange(10, 15) 
            =&gt; gn:concat($gen2ToInf =&gt; gn:subrange(1, 9)) 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">[11,12,13,14,15,16,
 2,3,4,5,6,7,8,9,10]</span></pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() 
            =&gt; gn:concat(gn:empty-generator()) 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() 
            =&gt; gn:concat($gen2ToInf =&gt; gn:take(1)) 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(1) 
            =&gt; gn:concat(gn:empty-generator()) 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:concat($gen2ToInf) =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-distinct"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.4 </span><a href="#generator-distinct" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:distinct</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains only the distinct values from the original generator, in their original order.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:distinct</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains no values, that is: </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:some()</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">, then </span><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator()</span></code><span class="deltaxml-new" style="background:#90EE90"> is returned. </span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, a generator is returned, the first value (</span><code><span class="deltaxml-new" style="background:#90EE90">$v1</span></code><span class="deltaxml-new" style="background:#90EE90">) of whose yield is the same as the first value of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, and the remaining values are the distinct values of the yield of the generator </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:filter(fn($x){not(deep-equal($v1, $x))})</span></code></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
              else $generator
 return
   if($gen?end-reached) then $gen
   else
     let $priorValue := $gen =?&gt; get-current()
       return
         $gen =&gt; map:put("move-next", 
                         fn($this as f:generator)
                         {gn:distinct(gn:remove-where(gn:tail($gen), 
                                      fn($x){deep-equal($priorValue, $x)}
                                      ))})</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-sequence((1, 3, 1, 2, 1, 5, 3, 2))  
            =&gt; gn:distinct() =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[1,3,2,5]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf  
            =&gt; gn:for-each(fn($n){$n idiv 10}) 
            =&gt; gn:take(50) =&gt; gn:distinct() =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[0,1,2,3,4,5]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf  
            =&gt; gn:for-each(fn($n){$n idiv 10}) 
            =&gt; gn:take(100) =&gt; gn:distinct() =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">[0,1,2,3,4,5,
6,7,8,9,10]</span></pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf  
            =&gt; gn:for-each(fn($n){$n idiv 10}) 
            =&gt; gn:distinct() =&gt; gn:take(12) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">[0,1,2,3,4,5,
6,7,8,9,10,11]</span></pre></div><p><em><span class="deltaxml-new" style="background:#90EE90">(The first 12 distinct numbers from an infinite sequence.)</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:distinct() =&gt; gn:to-array() </span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-filter"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.5 </span><a href="#generator-filter" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:filter</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains exactly those values from the yield of the original generator, upon which the supplied predicate returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">, in their original order.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:filter</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*) as xs:boolean</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the supplied generator's yield is empty, this same generator is returned.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If none of the values of the supplied generator's yield satisfies the </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90">, a generator with empty yield is returned.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise returns the concatenation of: a generator whose yield contains exactly one value - the first satisfying the predicate value (</span><code><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">1</span></sub></var></code><span class="deltaxml-new" style="background:#90EE90">), and the second generator to be concatenated: the result of filtering with the same </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> the generator whose yield has the same values as the original generator, but with all values preceding and including </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">1</span></sub></var><span class="deltaxml-new" style="background:#90EE90"> - removed.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function delivers the same result as the following XQuery implementation.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">declare function gn:filter($generator as f:generator, 
                           $predicate as function(item()*) as xs:boolean) 
                    as f:generator
{
 if($generator?initialized and $generator?end-reached) then gn:empty-generator()
  else
    let $getNextGoodGen := function($gen as map(*), 
                                    $pred as function(item()*) as xs:boolean)
                           {gn:skip-while($gen, fn($x){not($pred($x))})},
        $gen := if($generator?initialized) then $generator 
                  else $generator =?&gt; move-next(),
        $nextGoodGen := $getNextGoodGen($gen, $predicate)                           
    return
      if($nextGoodGen?end-reached) then gn:empty-generator()
        else
          $nextGoodGen =&gt; map:put("move-next", 
                                  fn($this as f:generator) 
                                  {gn:filter($nextGoodGen =&gt; gn:skip(1), $predicate)})
}</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:filter(fn($n){$n mod 2 eq 1}) =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">3</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:filter(fn($n){$n mod 2 eq 1}) 
          =&gt; gn:next() =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">5</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
$gen2ToInf =&gt; gn:filter(fn($n){$n mod 2 eq 1}) 
               =&gt; gn:take(7) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">[3,5,7,9,
11, 13,15]</span></pre></div><p><em><span class="deltaxml-new" style="background:#90EE90">(The first 7 values of a filtered infinite generator.)</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
$gen2ToInf =&gt; gn:take(10) =&gt; gn:filter(fn($n){$n gt 12}) 
                 =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
gn:empty-generator() =&gt; gn:filter(fn($n){$n eq $n}) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-for-each"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.6 </span><a href="#generator-for-each" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:for-each</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Produces a new generator, in the yield of which each value is the result of applying the function item </span><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code><span class="deltaxml-new" style="background:#90EE90"> on the corresponding value of the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, in their original order.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:for-each</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*) as item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> has no values, then a generator, whose yield has no values, is returned.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise a generator is returned, whose current value is </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:value() =&gt; $action()</span></code><span class="deltaxml-new" style="background:#90EE90">, and whose </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method produces </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:skip(1) =&gt; gn:for-each($action)</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
			else $generator        
return
 if($gen?end-reached) then gn:empty-generator()
  else
   let $current := $fun($gen =?&gt; get-current()),
       $newResultGen := map:put($gen, 
                                "get-current",
                                fn($this as f:generator){$current}),
       $nextGen := $gen =?&gt; move-next()
    return
	  if($nextGen?end-reached) then $newResultGen
	   else
	     let $newResultGen2 :=  map:put($newResultGen, "move-next",   
	                                    fn($this as f:generator) 
	                                    {gn:for-each($nextGen, $action)}) 
		   return
		     $newResultGen2</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:subrange(1, 5) =&gt; gn:for-each($double) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[4,6,8,10,12]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:for-each($double) =&gt; gn:take(5) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[4,6,8,10,12]</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(</span><code><span class="deltaxml-new" style="background:#90EE90">gn:for-each</span></code><span class="deltaxml-new" style="background:#90EE90"> on an infinite generator).</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:for-each($double) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-for-each-pair"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.7 </span><a href="#generator-for-each-pair" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:for-each-pair</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Produces a new generator, in the yield of which each value is the result of applying the function item </span><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code><span class="deltaxml-new" style="background:#90EE90"> on the corresponding values of the yields of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator1</span></code><span class="deltaxml-new" style="background:#90EE90"> and </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90">, in their original order.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:for-each-pair</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator1</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*, item()*) as item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If one or both provided generators has an empty yield (yield that contains no values), then the result is a generator that has an empty yield. Otherwise:</span></p><p><span class="deltaxml-new" style="background:#90EE90">If the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator1</span></code><span class="deltaxml-new" style="background:#90EE90"> is: </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">11</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">12</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, ..., </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">1n</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, and the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90"> is: </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">21</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">22</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, ..., </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">2m</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span></p><p><span class="deltaxml-new" style="background:#90EE90">then the result is a generator with yield that contains </span><code><span class="deltaxml-new" style="background:#90EE90">k = min(m, n)</span></code><span class="deltaxml-new" style="background:#90EE90"> values:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$action(</span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">11</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">21</span></sub></var><span class="deltaxml-new" style="background:#90EE90">), $action(</span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">12</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">22</span></sub></var><span class="deltaxml-new" style="background:#90EE90">), ..., $action(</span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">1k</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, </span><var><span class="deltaxml-new" style="background:#90EE90">V</span><sub><span class="deltaxml-new" style="background:#90EE90">2k</span></sub></var><span class="deltaxml-new" style="background:#90EE90">)))</span></code></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($generator1?initialized)) then $generator1 =?&gt; move-next()
            else $generator1,
    $gen2 := if(not($generator2?initialized)) then $generator2 =?&gt; move-next()
             else $generator2
return
  if($gen?end-reached or $gen2?end-reached) then gn:empty-generator() 
   else  
	 let $current := $fun($gen =?&gt; get-current(), $gen2 =?&gt; get-current()),
	     $newResultGen := map:put($gen, "get-current", 
	                              fn($this as f:generator){$current}),
	     $nextGen1 := $gen =?&gt; move-next(),
	     $nextGen2 := $gen2 =?&gt; move-next()
	  return
	    if($nextGen1?end-reached or $nextGen2?end-reached) then $newResultGen
	     else
	      let $newResultGen2 := map:put($newResultGen, "move-next",
                                            fn($this as f:generator)
                                            {gn:for-each-pair($nextGen1, $nextGen2, $action)})
	          return
	            $newResultGen2</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:subrange(1, 5) 
               =&gt; gn:for-each-pair($gen2ToInf =&gt; gn:subrange(6, 10), $sum2) 
               =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[9,11,13,15,17]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:for-each-pair($gen2ToInf, $sum2) 
               =&gt; gn:take(5) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[4,6,8,10,12]</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(</span><code><span class="deltaxml-new" style="background:#90EE90">gn:for-each-pair</span></code><span class="deltaxml-new" style="background:#90EE90"> applied on two infinite generators).</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() 
               =&gt; gn:for-each-pair($gen2ToInf =&gt; gn:subrange(6, 10), $sum2) 
               =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-insert-at"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.8 </span><a href="#generator-insert-at" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:insert-at</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains the first </span><code><span class="deltaxml-new" style="background:#90EE90">$position - 1</span></code><span class="deltaxml-new" style="background:#90EE90"> values of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, followed by the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90">, followed by all the values of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> starting from position </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:insert-at</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:positiveInteger</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains less that </span><code><span class="deltaxml-new" style="background:#90EE90">$position - 1</span></code><span class="deltaxml-new" style="background:#90EE90"> values, error [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">1</span></code><span class="deltaxml-new" style="background:#90EE90"> then the function returns a generator whose yield is that of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, prepended by the provided </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, the function returns a generator in whose yield the values at position from 1 to </span><code><span class="deltaxml-new" style="background:#90EE90">$position - 1</span></code><span class="deltaxml-new" style="background:#90EE90"> are the values from the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> at the same positions, the value at position </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90"> in the returned generator's yield is the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90">, and the values in this yield after position </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90"> are the same as the remaining values in the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">'s yield starting at position </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $genTail := gn:skip-strict($generator, $position - 1, true())
 return
   if($position gt 1)
     then $generator =&gt; gn:take($position -1) =&gt; gn:append($value) =&gt; gn:concat($genTail)
     else $genTail =&gt; prepend($value)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:insert-at(3, "XYZ") 
               =&gt; gn:take(10) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,"XYZ",4,5,6,7,8,9,10]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
               =&gt; gn:insert-at(1, "ABC") =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">["ABC",2,3,4,5,6,7,8,9,10,11]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
               =&gt; gn:insert-at(11, "PQR") 
               =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,5,6,7,8,9,10,11,"PQR"]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
               =&gt; gn:insert-at(12, "GHI") 
               =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><span class="deltaxml-new" style="background:#90EE90">Raises error FOGR0002.</span></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-next"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.9 </span><a href="#generator-next" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:next</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Produces the next state/generator-instance obtained from the current generator-instance </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:next</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the generator's yield doesn't contain any value, error [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise returns the next state/generator-instance obtained from the current generator-instance </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></p><div class="note"><p class="prefix"><b><span class="deltaxml-new" style="background:#90EE90">Note:</span></b></p><p><span class="deltaxml-new" style="background:#90EE90">This function is a synonym for the generator method </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90">. The goal is to free the end user from the nuisance of having to enter additional parentheses within an expression due to the different precedence of the </span><code><span class="deltaxml-new" style="background:#90EE90">=?&gt;</span></code><span class="deltaxml-new" style="background:#90EE90"> and </span><code><span class="deltaxml-new" style="background:#90EE90">=&gt;</span></code><span class="deltaxml-new" style="background:#90EE90"> operators. Thus, instead of having to write: </span></p><p><code><span class="deltaxml-new" style="background:#90EE90">($myGenerator =&gt; gn:take(5)) =?&gt; move-next() =&gt; gn:head()</span></code><span class="deltaxml-new" style="background:#90EE90">, one simply writes: </span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$myGenerator =&gt; gn:take(5) =&gt; gn:next() =&gt; gn:head()</span></code></p></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">$generator =?&gt; move-next()</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:next()  instance of f:generator</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:next()  =&gt; gn:head()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">3</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:next()  =&gt; gn:next()  =&gt; gn:head()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">4</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:next()</span></code></pre></div></td><td style="vertical-align:top"><p><span class="deltaxml-new" style="background:#90EE90">Raises error FOGR0002.</span></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-prepend"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.10 </span><a href="#generator-prepend" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:prepend</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator, whose yield is the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90"> followed by the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:prepend</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">A generator </span><var><span class="deltaxml-new" style="background:#90EE90">G</span><sub><span class="deltaxml-new" style="background:#90EE90">0</span></sub></var><span class="deltaxml-new" style="background:#90EE90">, whose yield contains a single value: </span><code><span class="deltaxml-new" style="background:#90EE90">$value</span></code><span class="deltaxml-new" style="background:#90EE90"> is constructed.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Then the result of the concatenation of </span><var><span class="deltaxml-new" style="background:#90EE90">G</span><sub><span class="deltaxml-new" style="background:#90EE90">0</span></sub></var><span class="deltaxml-new" style="background:#90EE90"> and the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is returned.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
            else $generator,
    $genSingle := gn:empty-generator() =&gt; gn:append($value)
 return
    gn:concat($genSingle, $gen)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:subrange(1, 5) 
            =&gt; gn:prepend(101) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[101,2,3,4,5,6]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:prepend(999) 
            =&gt; gn:take(5) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[999,2,3,4,5]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:prepend(777) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[777]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-remove-at"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.11 </span><a href="#generator-remove-at" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:remove-at</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator, whose yield is the result of removing the </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90">th value from the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> . </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:remove-at</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:positiveInteger</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90"> is greater than the number of values in the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, error FOGR0002 is raised.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, returns the concatenation of two generators: one whose yield contains the first </span><code><span class="deltaxml-new" style="background:#90EE90">$position -1</span></code><span class="deltaxml-new" style="background:#90EE90"> values from the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, and the second: whose yield contains all values at positions greater than </span><code><span class="deltaxml-new" style="background:#90EE90">$position</span></code><span class="deltaxml-new" style="background:#90EE90"> from the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $genTail := gn:skip-strict($generator, $position, true())
  return
	if($position gt 1)
	  then gn:concat(gn:take($generator, $position - 1), $genTail)
	  else $genTail</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:remove-at(3) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,5,6,7,8,9,10,11]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:remove-at(1) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[3,4,5,6,7,8,9,10,11]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:remove-at(10) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,5,6,7,8,9,10]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:remove-at(3) 
            =&gt; gn:take(10) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,5,6,7,8,9,10,11,12]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:remove-at(11) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><span class="deltaxml-new" style="background:#90EE90">Raises error FOGR0002.</span></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-remove-where"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.12 </span><a href="#generator-remove-where" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:remove-where</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield is the result of removing from the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> all values upon which the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:remove-where</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">function(item()*) as xs:boolean</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty, then this same generator is returned.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise a generator is returned whose yield is the result of filtering the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> with a function that returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> exactly when the provided </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> returns </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
             else $generator
  return
    gn:filter($gen, fn($x){not($predicate($x))})</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:remove-where(fn($x){$x mod 3 eq 0}) 
            =&gt; gn:take(10) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,4,5,7,8,10,11,13,14,16]</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(Removed all matching values from an infinite generator).</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:remove-where(fn($x){$x mod 3 eq 0})
                      =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-replace"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.13 </span><a href="#generator-replace" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:replace</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator, whose yield is the result of replacing in the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> the first value upon which the application of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> with the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$replacement</span></code><span class="deltaxml-new" style="background:#90EE90"> . </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:replace</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">function(item()*) as xs:boolean</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$replacement</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of the provided </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty, then </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is returned.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If there is no value in the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">'s yield, upon which the application of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">, then the function returns the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, if the result of applying the </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> on the first value of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">'s yield is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">, then the function returns a generator the first value in whose yield is </span><code><span class="deltaxml-new" style="background:#90EE90">$replacement</span></code><span class="deltaxml-new" style="background:#90EE90">, and whose </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> method produces a generator having the same yield as </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =?&gt; move-next()</span></code></p><p><span class="deltaxml-new" style="background:#90EE90">If the result of applying the </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> on the first value of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">'s yield is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">, then the function returns a generator whose </span><code><span class="deltaxml-new" style="background:#90EE90">get-current()</span></code><span class="deltaxml-new" style="background:#90EE90"> method is the same as that of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, and whose </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> method returns the result of </span><code><span class="deltaxml-new" style="background:#90EE90">gn:replace</span></code><span class="deltaxml-new" style="background:#90EE90"> on the generator returned by </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =?&gt; move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> . </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">if($generator?end-reached) then $generator
   else
    let $current := $generator =?&gt; get-current()
     return
       if($predicate($current))
         then let $nextGen := $generator =?&gt; move-next()
               return
                 $generator =&gt; map:put("get-current", fn($this as f:generator) {$replacement})
                            =&gt; map:put("move-next", fn($this as f:generator) { $nextGen })
         else (: $current is not the match for replacement :)
           let $nextGen := $generator =?&gt; move-next()
            return  
              $generator =&gt; map:put("move-next", 
                                    fn($this as f:generator)
                                    {
                                      let $intendedReplace := 
                                             function($z) 
                                             {$z =&gt; gn:replace($funIsMatching, $replacement)}
                                       return
                                         if($nextGen?end-reached) then $nextGen
                                            else $intendedReplace($nextGen)
                                    }
                                   )</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:replace(fn($x)
                         {$x gt 4}, "Replacement")  
            =&gt; gn:take(10) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,"Replacement",6,7,8,9,10,11]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:replace(fn($x){$x lt 3},
                          "Replacement") 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">["Replacement",3,4,5,6,7,8,9,10,11]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:replace(fn($x){$x gt 10},
                          "Replacement") 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,5,6,7,8,9,10,"Replacement"]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:replace(fn($x){$x gt 11},
                          "Replacement") 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,5,6,7,8,9,10,11]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:replace(fn($x){$x lt 2},
                          "Replacement") 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,5,6,7,8,9,10,11]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:replace(fn($x){$x gt 4},
                          "Replacement") 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,"Replacement",6,7,8,9,10,11]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() 
            =&gt; gn:replace(fn($x){$x eq $x},
                          "Replacement") 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-reverse"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.14 </span><a href="#generator-reverse" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:reverse</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator, the values of whose yield are the ones in the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> but in reverse order. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:reverse</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of the provided </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty, then </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is returned.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise a generator is returned, whose yield is the result of appending the current value of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> to the reversed yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:tail()</span></code><span class="deltaxml-new" style="background:#90EE90"> .</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">if($generator?end-reached) then gn:empty-generator()
  else
   let $current := $generator =?&gt; get-current()
    return
      gn:append(gn:reverse(gn:tail($generator)), $current)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:reverse() 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:append(2)  
            =&gt; gn:reverse() =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) 
            =&gt; gn:reverse() =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[11,10,9,8,7,6,5,4,3,2]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-scan-left"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.15 </span><a href="#generator-scan-left" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:scan-left</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains the partial results of the evaluation of the </span><code><span class="deltaxml-new" style="background:#90EE90">gn:fold-left</span></code><span class="deltaxml-new" style="background:#90EE90"> function with the same arguments.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:scan-left</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*, item()*) as item()*) as item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty, returns a generator whose yield contains a single value: the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise computes a partial result </span><code><span class="deltaxml-new" style="background:#90EE90">$partial-result</span></code><span class="deltaxml-new" style="background:#90EE90"> equal to </span><code><span class="deltaxml-new" style="background:#90EE90">$action($init, $generator =?&gt; get-current())</span></code><span class="deltaxml-new" style="background:#90EE90">, and a </span><code><span class="deltaxml-new" style="background:#90EE90">$next-generator</span></code><span class="deltaxml-new" style="background:#90EE90">, that is equal to </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =?&gt; move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> and returns a generator, the first value of whose yield is </span><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code><span class="deltaxml-new" style="background:#90EE90">, and the remaining values are the yield of the generator: </span><code><span class="deltaxml-new" style="background:#90EE90">gn:scan-left($next-generator, $partial-result, $action)</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function delivers the same result as the following XQuery implementation.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">declare function gn:scan-left($generator as f:generator, $init as item()*, $action as fn(*)) 
           as f:generator
{
  let $resultGen := gn:empty-generator() 
                         =&gt; map:put("end-reached", false())
                         =&gt; map:put("get-current",   fn($this as f:generator){$init})
   return
     if($generator?end-reached) 
       then $resultGen =&gt; map:put("move-next", fn($this as f:generator)
                                               {gn:empty-generator()})
       else
         let $resultGen := $resultGen =&gt; map:put("get-current", 
                                                 fn($this as f:generator){$init}),
             $partialFoldResult := $action($init, $generator =?&gt; get-current())
           return
             let $nextGen := $generator =?&gt; move-next()
              return
                $resultGen =&gt; map:put("move-next", fn($this as f:generator)
                                      { 
                                          gn:scan-left($nextGen, $partialFoldResult, $action)
                                       }
                                      )            
}</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() 
         =&gt; gn:scan-left(0, fn($x, $y){$x + $y}) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[0]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(5)  
         =&gt; gn:scan-left(0, fn($x, $y){$x + $y}) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[0,2,5,9,14,20]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen0toInf 
   =&gt; gn:for-each(fn($n)
                  {(2*$n + 1) div $factorial(2*xs:decimal($n))}) 
   =&gt; gn:take(8) 
   =&gt; gn:scan-left(0, fn($x, $y){$x + $y}) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">[0,1,2.5,
 2.708333333333333333,
 2.718055555555555555,
 2.718278769841269841,
 2.718281801146384479,
 2.718281828286168563,
 2.718281828458229747]</span></pre></div><p><em><span class="deltaxml-new" style="background:#90EE90">(Infinite series summation: the partial sums from its first 8 steps.)</span></em></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-scan-right"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.16 </span><a href="#generator-scan-right" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:scan-right</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains the partial results of the evaluation of the </span><code><span class="deltaxml-new" style="background:#90EE90">gn:fold-right</span></code><span class="deltaxml-new" style="background:#90EE90"> function with the same arguments.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:scan-right</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$action</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*, item()*) as item()*) as item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty, returns a generator whose yield contains a single value: the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$init</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise returns the reversed yield of </span><code><span class="deltaxml-new" style="background:#90EE90">gn:scan-left(gn:reverse($generator), $init, $action)</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">gn:reverse(gn:scan-left(gn:reverse($gen), $init, $action))</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() 
       =&gt; gn:scan-right(0, fn($x, $y){$x + $y}) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[0]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$genN =&gt; gn:take(10) 
       =&gt; gn:scan-right(0, fn($x, $y){$x + $y}) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">[55,54,52,49,45,
 40,34,27,19,10,0]</span></pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-skip"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.17 </span><a href="#generator-skip" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:skip</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains only the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> after the </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90">th one and in their original order.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:skip</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:nonNegativeInteger</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">0</span></code><span class="deltaxml-new" style="background:#90EE90">, the function returns the same supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> is greater than the number of values of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise the function returns the result of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:next() =&gt; gn:skip($n -1)</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">gn:skip-strict($gen, $n, false())</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:skip(7) instance of f:generator</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(3) =&gt; gn:skip(2) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[4]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:skip(10) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:skip(11) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:skip(9) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[11]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-skip-strict"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.18 </span><a href="#generator-skip-strict" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:skip-strict</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator whose yield contains the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> after the </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90">th one. If the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains less than </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> values, and the supplied argument </span><code><span class="deltaxml-new" style="background:#90EE90">$raise-error-on-empty</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> then [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:skip-strict</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:nonNegativeInteger</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$raise-error-on-empty</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:boolean</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">0</span></code><span class="deltaxml-new" style="background:#90EE90">, the function returns the same supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> is greater than the number of values of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, and the supplied argument </span><code><span class="deltaxml-new" style="background:#90EE90">$raise-error-on-empty</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90"> then [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] is raised, otherwise (</span><code><span class="deltaxml-new" style="background:#90EE90">$raise-error-on-empty</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">) the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise the function returns the result of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:next() =&gt; gn:skip-strict($n -1, $raise-error-on-empty)</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function delivers the same result as the following XQuery implementation.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">declare function gn:skip-strict($gen as f:generator, 
                                $n as xs:nonNegativeInteger, 
                                $issueErrorOnEmpty as xs:boolean) as f:generator
{
  if($n eq 0) then $generator
    else if($generator?end-reached) 
           then if($issueErrorOnEmpty)
                 then error((), "Input Generator too-short") 
                 else gn:empty-generator()
    else 
      let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
                   else $generator
        return
          if(not($gen?end-reached)) 
            then gn:skip-strict($gen =?&gt; move-next(), $n -1, $issueErrorOnEmpty)
            else gn:empty-generator()    
};</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:skip-strict(7, true()) instance of f:generator</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(3) =&gt; gn:skip-strict(2, true()) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[4]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:skip-strict(10, true()) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:skip-strict(11, false()) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:skip-strict(11, true()) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><span class="deltaxml-new" style="background:#90EE90">Raises error FOGR0002.</span></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-skip-while"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.19 </span><a href="#generator-skip-while" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:skip-while</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains all the values from the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, having removed the longest leading segment of values on which the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:skip-while</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*) as xs:boolean</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty the function returns the same </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate($generator =&gt; gn:value())</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">, the function returns the same </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise the function returns </span><code><span class="deltaxml-new" style="background:#90EE90">gn:skip-while($generator =?&gt; move-next(), $predicate)</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function delivers the same result as the following XQuery implementation.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">declare function gn:skip-while($generator as f:generator, 
                               $predicate as function(item()*) as xs:boolean) 
           as f:generator
{
  let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
                else $generator
   return
     if($gen?end-reached) then gn:empty-generator()
      else
        let $current := $gen =?&gt; get-current()
         return
           if(not($predicate($current))) then $gen
            else gn:skip-while($gen =?&gt; move-next(), $pred)  
}</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:skip-while(fn($n){$n lt 11}) 
            =&gt; gn:take(5) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[11,12,13,14,15]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:skip-while(fn($n){$n lt 2})
            =&gt; gn:take(5) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,5,6]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() 
            =&gt; gn:skip-while(fn($n){$n lt 100}) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-subrange"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.20 </span><a href="#generator-subrange" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:subrange</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains the values from the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">, from position </span><code><span class="deltaxml-new" style="background:#90EE90">$start</span></code><span class="deltaxml-new" style="background:#90EE90"> to position </span><code><span class="deltaxml-new" style="background:#90EE90">$end</span></code><span class="deltaxml-new" style="background:#90EE90">in their original order.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:subrange</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$start</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:positiveInteger</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$end</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:positiveInteger</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If </span><code><span class="deltaxml-new" style="background:#90EE90">$start</span></code><span class="deltaxml-new" style="background:#90EE90"> is greater than the number of values in the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> then the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If </span><code><span class="deltaxml-new" style="background:#90EE90">$start</span></code><span class="deltaxml-new" style="background:#90EE90"> is greater than </span><code><span class="deltaxml-new" style="background:#90EE90">$end</span></code><span class="deltaxml-new" style="background:#90EE90"> then the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, if the number of values in the yield of the supplied</span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">$gen-size</span></code><span class="deltaxml-new" style="background:#90EE90">, the function produces a generator, whose yield starts with the </span><code><span class="deltaxml-new" style="background:#90EE90">$start</span></code><span class="deltaxml-new" style="background:#90EE90">th value in the yield of the supplied</span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> and ends with the </span><code><span class="deltaxml-new" style="background:#90EE90">min($gen-size, $end - $start + 1)</span></code><span class="deltaxml-new" style="background:#90EE90">th value of this yield. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">gn:take(gn:skip($generator, $start - 1), $end - $start + 1)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:subrange(4, 6) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[5,6,7]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:subrange(3, 13) 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[4,5,6,7,8,9,10,11]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:subrange(1, 1) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:subrange(5, 3) 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-tail"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.21 </span><a href="#generator-tail" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:tail</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains all the values but the first from the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> or raises [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] if the supplied generator's yield is empty.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:tail</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty, the function raises [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">].</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise the function returns a new generator, having as yield the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> with the first value skipped.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">gn:skip-strict($generator, 1, true())</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:tail() =&gt; gn:head()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">3</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:subrange(4, 6) =&gt; gn:tail() 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[6, 7]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:tail() =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><span class="deltaxml-new" style="background:#90EE90">Raises error FOGR0002.</span></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-take"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.22 </span><a href="#generator-take" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:take</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield is the leading segment with length </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> from the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> or raises [</span><a href="#ERRFOGR0002" title="err:FOGR0002"><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002</span></a><span class="deltaxml-new" style="background:#90EE90">] if the supplied generator's yield is empty and </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> is greater than </span><code><span class="deltaxml-new" style="background:#90EE90">0</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:take</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">xs:nonNegativeInteger</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If </span><code><span class="deltaxml-new" style="background:#90EE90">$n eq 0</span></code><span class="deltaxml-new" style="background:#90EE90"> the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains less than </span><code><span class="deltaxml-new" style="background:#90EE90">$n</span></code><span class="deltaxml-new" style="background:#90EE90"> values, the function returns </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise the function returns a generator, whose yield's only value is the first value of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">'s yield, concatenated with </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:next() =&gt; gn:take($n - 1)</span></code><span class="deltaxml-new" style="background:#90EE90"> .</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function delivers the same result as the following XQuery implementation.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">declare function gn:take($generator as f:generator, $n as xs:integer) as f:generator
{
  let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
                else $generator
   return
     if($gen?end-reached or $n le 0) then gn:empty-generator()
      else
        let $current := $gen =?&gt; get-current(),
            $newResultGen := map:put($gen, "get-current", fn($this as f:generator){$current}),
            $nextGen := $gen =?&gt; move-next()
         return
           if($nextGen?end-reached) then $newResultGen
             else
              let
               $newResultGen2 :=  map:put($newResultGen, 
                                          "move-next", 
                                          fn($this as f:generator) 
                                          {gn:take($nextGen, $n -1)}) 
                 return
                   $newResultGen2  
}</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(5) instance of f:generator</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(3) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(100000000) 
            =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">2</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(Take 100 million numbers and then get the first of these - fast, with no delay.)</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:take(5) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-take-while"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.23 </span><a href="#generator-take-while" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:take-while</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield contains the longest leading segment from the yield of the original </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> on all values of which the provided function </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> returns </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:take-while</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn(item()*) as xs:boolean</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If the the application of the </span><code><span class="deltaxml-new" style="background:#90EE90">$predicate</span></code><span class="deltaxml-new" style="background:#90EE90"> on the first value of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90"> the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise the function returns a generator whose yield id the concatenation of the first value of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> with </span><code><span class="deltaxml-new" style="background:#90EE90">$generator =&gt; gn:next() =&gt; gn:take-while($predicate)</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function delivers the same result as the following XQuery implementation.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">declare function gn:take-while($generator as f:generator, 
                               $predicate as function(item()*) as xs:boolean) 
                    as f:generator
{
  let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
                else $generator
   return
     if($gen?end-reached) then gn:empty-generator()
      else      
        let $current := $gen =?&gt; get-current()
          return
            if(not($predicate($current))) then gn:empty-generator()
            else
              let $newResultGen := map:put($gen, "get-current", 
                                           fn($this as f:generator){$current}),
                  $nextGen := $gen =?&gt; move-next()
               return
                  if($nextGen?end-reached) then $newResultGen
                  else
                    let $newResultGen2 :=  map:put($newResultGen, "move-next", 
                                                   fn($this as f:generator)
                                                   {gn:take-while($nextGen, $pred)}) 
                     return $newResultGen2    
}</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take-while(fn($n){$n lt 11}) 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4,5,6,7,8,9,10]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take-while(fn($n){$n lt 2}) 
            =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() 
            =&gt; gn:take-while(fn($n){$n lt 2}) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf 
            =&gt; gn:take-while(fn($n){$n lt 100000000}) =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">2</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(Take all numbers less than 100 million and then get the first of these - fast, with no delay.)</span></em></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-zip"></a><span class="deltaxml-new" style="background:#90EE90">18.4.2.24 </span><a href="#generator-zip" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:zip</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator the </span><code><span class="deltaxml-new" style="background:#90EE90">k</span></code><span class="deltaxml-new" style="background:#90EE90">th value of whose yield is an array having two members: the </span><code><span class="deltaxml-new" style="background:#90EE90">k</span></code><span class="deltaxml-new" style="background:#90EE90">th value of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator1</span></code><span class="deltaxml-new" style="background:#90EE90"> and the </span><code><span class="deltaxml-new" style="background:#90EE90">k</span></code><span class="deltaxml-new" style="background:#90EE90">th value of the yield of </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90">, where </span><code><span class="deltaxml-new" style="background:#90EE90">k</span></code><span class="deltaxml-new" style="background:#90EE90">does not exceed the smaller of the lengths of the yields of the two generators. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:zip</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator1</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code><span class="deltaxml-new" style="background:#90EE90">,</span></td><td></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If any of the yields of the two provided generators: </span><code><span class="deltaxml-new" style="background:#90EE90">$generator1</span></code><span class="deltaxml-new" style="background:#90EE90"> and </span><code><span class="deltaxml-new" style="background:#90EE90">$generator2</span></code><span class="deltaxml-new" style="background:#90EE90"> is empty, the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise the function returns the result of:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">gn:for-each-pair($generator1, $generator2, fn($x1, $x2){[$x1, $x2]})</span></code><span class="deltaxml-new" style="background:#90EE90"> .</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">gn:for-each-pair($generator1, $generator2, fn($x1, $x2){[$x1, $x2]})</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">gn:zip($gen2ToInf =&gt; gn:subrange(1, 5),
        $gen2ToInf =&gt; gn:subrange(6, 10)) 
        =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[[2,7],[3,8],[4,9],[5,10],[6,11]]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:zip($gen2ToInf,
        $gen2ToInf =&gt; gn:skip(5)) 
        =&gt; gn:take(10) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[[2,7],[3,8],[4,9],[5,10],[6,11],[7,12],[8,13],[9,14],[10,15],[11,16]]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:zip(gn:empty-generator(),
        $gen2ToInf =&gt; gn:subrange(6, 10)) 
        =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div3"><h4><a id="generator-functions-producing-generators-from-providers"></a><span class="deltaxml-new" style="background:#90EE90">18.4.3 </span><a href="#generator-functions-producing-generators-from-providers" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">Functions that produce a generator from a data provider</span></a></h4><p><span class="deltaxml-new" style="background:#90EE90">The functions in this section construct generators whose yield is supplied by an </span><span><b><span class="deltaxml-new" style="background:#90EE90">external provider function</span></b></span><span class="deltaxml-new" style="background:#90EE90">. Providers allow generators to expose yields that are too large to fit into memory, must be computed incrementally, or require access to external systems (such as files, databases, or web services).</span></p><p><span class="deltaxml-new" style="background:#90EE90">A provider function is responsible for producing, on each invocation, both:</span></p><ol class="enumar"><li><p><span><b><span class="deltaxml-new" style="background:#90EE90">state-data</span></b></span><span class="deltaxml-new" style="background:#90EE90"> - an array with information required for the provider to compute its next result, and</span></p></li><li><p><span><b><span class="deltaxml-new" style="background:#90EE90">result-data</span></b></span><span class="deltaxml-new" style="background:#90EE90"> - an array either containing a single yield-value or empty, signaling that the data for producing the yield has been exhausted.</span></p></li></ol><p><span class="deltaxml-new" style="background:#90EE90">The generator returned by these functions behaves identically to any other generator: values are not computed eagerly but are obtained only as result of evaluating the method </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> followed by the evaluation of the method </span><code><span class="deltaxml-new" style="background:#90EE90">get-current()</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p><table class="index"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Function</span></th><th><span class="deltaxml-new" style="background:#90EE90">Meaning</span></th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield does not contain any values.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:make-generator</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator, the values of whose yield are obtained by consecutive calls to a supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code><span class="deltaxml-new" style="background:#90EE90"> function.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-array</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator, the values of whose yield are the values of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> array.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-sequence</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator, the values of whose yield are the values of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> sequence.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-map</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a generator, whose yield is the sequence of all single map entries of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> map.</span></td></tr></tbody></table><div class="div4"><h5><a id="generator-empty-generator"></a><span class="deltaxml-new" style="background:#90EE90">18.4.3.1 </span><a href="#generator-empty-generator" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield does not contain any values.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator</span></code><span class="deltaxml-new" style="background:#90EE90">()</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code class="return-type"><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a new generator whose yield does not contain any values.</span></p><p><span class="deltaxml-new" style="background:#90EE90">The </span><code><span class="deltaxml-new" style="background:#90EE90">initialized</span></code><span class="deltaxml-new" style="background:#90EE90"> and </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> fields of the result are both set to </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">f:generator(initialized := true(), end-reached := true(),
            get-current := fn($this as f:generator)
                           {error(QName('http://www.w3.org/2005/xqt-errors', 'err:FOGR0002'),
                            "get-current() called on an empty-generator")},
            move-next := fn($this as f:generator)
                           {error(QName('http://www.w3.org/2005/xqt-errors', 'err:FOGR0002'),
                            "move-next() called on an empty-generator")},
                            state := map{}
            )</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:to-array() =&gt; array:empty()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-make-generator"></a><span class="deltaxml-new" style="background:#90EE90">18.4.3.2 </span><a href="#generator-make-generator" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator, the values of whose yield are obtained by consecutive calls to a supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code><span class="deltaxml-new" style="background:#90EE90"> function.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">function(array(*)) as array(*)</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The </span><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code><span class="deltaxml-new" style="background:#90EE90"> function is called to get the first value of the yield of the result-generator. It accepts as argument an array, that contains data, referred to as "state-data" here, necessary to identify and return its next result. On the first call to the </span><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code><span class="deltaxml-new" style="background:#90EE90">, an empty array is passed as the state-data.</span></p><p><span class="deltaxml-new" style="background:#90EE90">The </span><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code><span class="deltaxml-new" style="background:#90EE90"> returns an array with two members. The first member is the state-data to be passed to it on the next call. The second member is an array, containing the current value of the result-generator. </span></p><p><span class="deltaxml-new" style="background:#90EE90">To signal that there are no more yield-values to be returned the </span><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code><span class="deltaxml-new" style="background:#90EE90"> returns an empty array as its result's second member. When this happens no more calls to the </span><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code><span class="deltaxml-new" style="background:#90EE90"> are made and the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method of the current result-generator-instance is set to return an empty generator. </span></p><p><span class="deltaxml-new" style="background:#90EE90">If the </span><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code><span class="deltaxml-new" style="background:#90EE90"> returns a non-empty array as its result's second member, the value of the single member of this non-empty array is set to be returned by the </span><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90"> method of the current result-generator instance and the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method of the current result-generator instance is specified in such a way that, when it is called, it would itself call the </span><code><span class="deltaxml-new" style="background:#90EE90">$provider</span></code><span class="deltaxml-new" style="background:#90EE90"> with the latest returned state-data and based on the return of that call would construct correctly the next result-generator instance. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $gen := if(not($generator?initialized)) then $generator =?&gt; move-next()
              else $generator,
    $providerResult := $provider([]),
    $nextProviderState := $providerResult(1),
    $nextDataItemHolder := $providerResult(2)
 return
    let $nextGen := 
	       if(array:empty($nextDataItemHolder)) 
                 then gn:empty-generator()  
                 else gn:empty-generator()
                 =&gt; map:put("state", map{"providerState": $nextProviderState,
                                         "current": $nextDataItemHolder(1) 
                                      })
                 =&gt; map:put("end-reached", false())
                 =&gt; map:put("get-current", fn($this as f:generator) {$this?state?current})
                 =&gt; map:put("move-next",  
                            fn($this as f:generator) 
                            {
                             let $nextProviderResult := $provider($this?state?providerState),
                                 $nextDataItemHolder := $nextProviderResult(2)
                              return
                                 if(array:empty($nextDataItemHolder)) 
                                   then gn:empty-generator()
                                   else
                                     $this 
                                       =&gt; map:put("state", 
                                                  map{"current": $nextDataItemHolder(1), 
                                                     "providerState": $nextProviderResult(1)})
                            }
                           )
                             
    return $nextGen</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">
gn:make-generator(fn($state as array(*))
                 {
                  let $numGenerated := if(array:empty($state)) then 0
                                       else $state[1]
                   return
                      if($numGenerated le 9) 
                      then [ [$numGenerated + 1], [$numGenerated + 1] ]
                      else [[-1], []]
                 } 
                 ) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">[1,2,3,4,5,6,
7,8,9,10]</span></pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">
gn:make-generator(fn($state as array(*))
                {
                  let $numGenerated := if(array:empty($state)) then 0
                                       else $state[1]
                    return
                      [ [$numGenerated + 1], [$numGenerated + 1] ]
                } 
                 ) =&gt; gn:value()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">1</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(Make a generator from an infinite provider, then get its first value - immediately , with no delay.)</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">
gn:make-generator(fn($state as array(*))
                {
                  let $numGenerated := if(array:empty($state)) then 0
                                       else $state[1]
                    return
                      [ [$numGenerated + 1], [$numGenerated + 1] ]
                } 
                 ) =&gt; gn:subrange(10, 15) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[10,11,12,13,14,15]</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(Get a subrange of values from a generator created with an infinite provider - immediately , with no delay.)</span></em></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-make-generator-from-array"></a><span class="deltaxml-new" style="background:#90EE90">18.4.3.3 </span><a href="#generator-make-generator-from-array" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-array</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator, the values of whose yield are the values of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> array.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-array</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">array(*)</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function uses a provider function, whose state-data is the last-processed array index, and whose result is the new state-data and the </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> array's value at the next index.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> array is empty, the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, it calls </span><code><span class="deltaxml-new" style="background:#90EE90">gn:make-generator</span></code><span class="deltaxml-new" style="background:#90EE90">, passing to it the so constructed provider-function, and returns the result of this call.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $size := array:size($input),
      $arrayProvider := fn($state as array(xs:integer?))
                        {
                          let $ind := if(array:empty($state))
                                      then 0
                                      else $state(1),
                              $newState := if($ind +1 gt $size) then []   
                                             else [$ind +1],
                              $newResult := if($ind +1 gt $size) then []
                                              else [$input($ind + 1)]
                           return [$newState, $newResult]
                        }
   return gn:make-generator($arrayProvider)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
gn:make-generator-from-array([1, 4, 9, 16, 25]) 
           instance of f:generator</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
gn:make-generator-from-array([1, 4, 9, 16, 25]) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[1,4,9,16,25]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
gn:make-generator-from-array([]) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-make-generator-from-sequence"></a><span class="deltaxml-new" style="background:#90EE90">18.4.3.4 </span><a href="#generator-make-generator-from-sequence" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-sequence</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator, the values of whose yield are the values of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> sequence.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-sequence</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">item()*</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function uses a provider function, whose state-data is the last-processed sequence position, and whose result is the new state-data and the value of the </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> sequence at the next position.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> sequence is empty, the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, it calls </span><code><span class="deltaxml-new" style="background:#90EE90">gn:make-generator</span></code><span class="deltaxml-new" style="background:#90EE90">, passing to it the so constructed provider-function, and returns the result of this call.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $size := count($input), 
    $seqProvider := fn($state as array(xs:integer?))
                      {
                          let $ind := if(array:empty($state))
                                      then 0
                                      else $state(1),
                              $newState := if($ind +1 gt $size) then []   
                                             else [$ind +1],
                              $newResult := if($ind +1 gt $size) then []
                                              else [$input[$ind + 1]] 
                           return [$newState, $newResult]                  
                       }
   return gn:make-generator($seqProvider)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
gn:make-generator-from-sequence((1, 8, 27, 64, 125)) 
      instance of f:generator</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
gn:make-generator-from-sequence(()) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
gn:make-generator-from-sequence((1, 8, 27, 64, 125)) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[1,8,27,64,125]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-make-generator-from-map"></a><span class="deltaxml-new" style="background:#90EE90">18.4.3.5 </span><a href="#generator-make-generator-from-map" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-map</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a generator, whose yield is the sequence of all single map entries of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> map.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-map</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">map(*)</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The function uses a provider function, whose state-data is the position of the last-processed map key, and whose result is the new state-data and the single-entry of the </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> map for the next key of the map.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$input</span></code><span class="deltaxml-new" style="background:#90EE90"> map is empty, the function returns an empty generator.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, it calls </span><code><span class="deltaxml-new" style="background:#90EE90">gn:make-generator</span></code><span class="deltaxml-new" style="background:#90EE90">, passing to it the so constructed provider-function, and returns the result of this call.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">let $keys := map:keys($inputMap),
    $size := map:size($inputMap),
    $mapProvider := fn($state as array(xs:integer?))
    {	
	let $ind := if(array:empty($state))
                   then 0
                   else $state(1),
	    $newState := if($ind +1 gt $size) then []   
                         else [$ind +1],
	    $newResult := if($ind +1 gt $size) then []
                          else
                           let $key := $keys[$ind + 1]
                            return
                              [map:entry($key, $inputMap($key))]
        return [$newState, $newResult]                                      
     }                        
 return gn:make-generator($mapProvider)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">
let $myMap := {"John": 22, "Ann": 28, "Peter": 31}
 return 
   gn:make-generator-from-map($myMap) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">[{"John":22},
{"Ann":28},
{"Peter":31}]</span></pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">
 let $myMap := {"John": 22, "Ann": 28, "Peter": 31},
     $genMap := gn:make-generator-from-map($myMap)
  return
     $genMap =&gt; gn:to-map()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">{"John":22,
"Ann":28,
"Peter":31}</span></pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
let $myMap := {}
 return 
   gn:make-generator-from-map($myMap) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
let $myMap := {}
 return 
   gn:make-generator-from-map($myMap) =&gt; gn:to-map()()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">{}</span></code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div3"><h4><a id="generator-functions-producing-xpath-collections-from-generators"></a><span class="deltaxml-new" style="background:#90EE90">18.4.4 </span><a href="#generator-functions-producing-xpath-collections-from-generators" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">Functions that produce an XPath collection from a generator</span></a></h4><p><span class="deltaxml-new" style="background:#90EE90">Generators can be used to construct standard XPath collections: arrays, maps, and sequences.</span></p><table class="index"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Function</span></th><th><span class="deltaxml-new" style="background:#90EE90">Meaning</span></th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:to-array</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns an array, whose members are the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:to-map</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a map, whose single entries (key-value pairs) are obtained from the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></td></tr><tr><td style="white-space:nowrap; vertical-align:top"><code><span class="deltaxml-new" style="background:#90EE90">gn:to-sequence</span></code></td><td><span class="deltaxml-new" style="background:#90EE90">Returns a sequence, whose items are obtained from the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></td></tr></tbody></table><div class="div4"><h5><a id="generator-to-array"></a><span class="deltaxml-new" style="background:#90EE90">18.4.4.1 </span><a href="#generator-to-array" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:to-array</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns an array, whose members are the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:to-array</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">array(*)</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> has an empty yield, or is not initialized, the function returns an emprty array.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise, starting from an empty array-result, the function appends to it every value contained in the yield of the </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> until there are no more values in the yield. Then, this array-result is returned.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve" class="small"><span class="deltaxml-new" style="background:#90EE90">while-do( [$generator, []],
	  function( $in-out-args) 
	  { $in-out-args(1)?initialized and not($in-out-args(1)?end-reached) },
	  function($in-out-args) 
	           { array{$in-out-args(1) =?&gt; move-next(), 
	             array:append($in-out-args(2), $in-out-args(1) =?&gt; get-current())
	           }
	   }
) (2)</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
gn:empty-generator() =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[]</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
$gen2ToInf =&gt; gn:take(3) 
           =&gt; gn:to-array() instance of array(*)</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">
 $gen2ToInf =&gt; gn:take(3) =&gt; gn:to-array()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">[2,3,4]</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-to-map"></a><span class="deltaxml-new" style="background:#90EE90">18.4.4.2 </span><a href="#generator-to-map" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:to-map</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a map, whose single entries (key-value pairs) are obtained from the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:to-map</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">map(*)</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">If the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> has an empty yield the function returns an empty map.</span></p><p><span class="deltaxml-new" style="background:#90EE90">If the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> contains a value that is not a map-entry, an error is raised. </span></p><p><span class="deltaxml-new" style="background:#90EE90">Otherwise the function returns a map all single-map-entries of which are the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">map:merge($generator =&gt; gn:to-sequence())</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:to-map()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">{}</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">let $myMap := {}
  return 
    gn:make-generator-from-map($myMap) =&gt; gn:to-map()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">{}</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">let $myMap := {"John": 22, "Ann": 28, "Peter": 31},
    $genMap := gn:make-generator-from-map($myMap)
  return
    $genMap =&gt; gn:to-map()</span></code></pre></div></td><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">{"John":22,"Ann":28,
"Peter":31}</span></pre></div></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:to-map()</span></code></pre></div></td><td style="vertical-align:top"><p><span class="deltaxml-new" style="background:#90EE90">Raises error FORG0006.</span></p><p><em><span class="deltaxml-new" style="background:#90EE90">(Because the values are not map-entries.)</span></em></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:take(10) =&gt; gn:chunk(2) 
            =&gt; gn:for-each(fn($chunk)
                          {map:entry($chunk(1), $chunk(2))})
            =&gt;   gn:to-map()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">{2:3,4:5,6:7,8:9,10:11}</span></code></p></td></tr></tbody></table></div></dd></dl></div><div class="div4"><h5><a id="generator-to-sequence"></a><span class="deltaxml-new" style="background:#90EE90">18.4.4.3 </span><a href="#generator-to-sequence" style="text-decoration: none"><span class="deltaxml-new" style="background:#90EE90">gn:to-sequence</span></a></h5><dl><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Summary</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">Returns a sequence, whose items are obtained from the values of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Signature</span></dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function"><span class="deltaxml-new" style="background:#90EE90">gn:to-sequence</span></code><span class="deltaxml-new" style="background:#90EE90">(</span></td></tr><tr class="arg"><td><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></td><td><code class="as"><span class="deltaxml-new" style="background:#90EE90">as&nbsp;</span></code><code class="type"><code><span class="deltaxml-new" style="background:#90EE90">fn:generator</span></code></code></td><td></td></tr><tr class="return-type"><td colspan="3"><span class="deltaxml-new" style="background:#90EE90">)</span><code class="as"><span class="deltaxml-new" style="background:#90EE90">&nbsp;as&nbsp;</span></code><code><code><span class="deltaxml-new" style="background:#90EE90">item(*)</span></code></code></td></tr></tbody></table></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Properties</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function is </span><a title="deterministic" class="termref" href="#dt-deterministic"><span class="deltaxml-new" style="background:#90EE90">deterministic</span></a><span class="deltaxml-new" style="background:#90EE90">, </span><a title="context-independent" class="termref" href="#dt-context-independent"><span class="deltaxml-new" style="background:#90EE90">context-independent</span></a><span class="deltaxml-new" style="background:#90EE90">, and </span><a title="focus-dependent" class="termref" href="#dt-focus-independent"><span class="deltaxml-new" style="background:#90EE90">focus-independent</span></a><span class="deltaxml-new" style="background:#90EE90">. </span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Rules</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">This function obtains and outputs every value of the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code></p><p><span class="deltaxml-new" style="background:#90EE90">An empty sequence is returned if the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> has an empty yield.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Any value from the yield of the supplied </span><code><span class="deltaxml-new" style="background:#90EE90">$generator</span></code><span class="deltaxml-new" style="background:#90EE90"> that is an empty sequence, is not represented in the result returned by the function.</span></p></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Formal Equivalent</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">The effect of the function is equivalent to the result of the following XPath expression.</span></p><div class="exampleInner"><pre xml:space="preserve"><span class="deltaxml-new" style="background:#90EE90">gn:to-array($generator) =&gt; array:items()</span></pre></div></dd><dt class="label"><span class="deltaxml-new" style="background:#90EE90">Examples</span></dt><dd><div class="example"><table class="medium"><thead><tr><th><span class="deltaxml-new" style="background:#90EE90">Expression</span></th><th><span class="deltaxml-new" style="background:#90EE90">Result</span></th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator() =&gt; gn:to-sequence()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">()</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">$gen2ToInf =&gt; gn:filter(fn($n){$n mod 2 eq 1}) 
            =&gt; gn:take(10) =&gt; gn:to-sequence()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">(3,5,7,9,11,13,15,17,19,21)</span></code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code><span class="deltaxml-new" style="background:#90EE90">gn:make-generator-from-array([(),1,(),2,(),3]) 
            =&gt; gn:to-sequence()</span></code></pre></div></td><td style="vertical-align:top"><p><code><span class="deltaxml-new" style="background:#90EE90">(1, 2, 3)</span></code></p><p><em><span class="deltaxml-new" style="background:#90EE90">(Every value that is an empty sequence is not present in the result.)</span></em></p></td></tr></tbody></table></div></dd></dl></div></div></div></div><div class="div1"><h2><a id="dynamic-loading"></a><span class="deltaxml-old" style="background:#FF5555">18</span><span class="deltaxml-new" style="background:#90EE90">19</span> <a href="#dynamic-loading" style="text-decoration: none">Dynamic evaluation</a></h2><p>The following functions allow dynamic loading and evaluation of XQuery queries, XSLT stylesheets, and XPath binary operators.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a></td><td>Provides access to the public functions and global variables of a dynamically loaded XQuery library module.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-transform"><code>fn:transform</code></a></td><td>Invokes a transformation using a dynamically loaded XSLT stylesheet.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-op"><code>fn:op</code></a></td><td>Returns a function whose effect is to apply a supplied binary operator to two arguments.</td></tr></tbody></table><div class="div2"><h3><a id="load-xquery-module-record"></a><span class="deltaxml-old" style="background:#FF5555">18.1</span><span class="deltaxml-new" style="background:#90EE90">19.1</span> <a href="#load-xquery-module-record" style="text-decoration: none">Record fn:load-xquery-module-record</a></h3><p>This record type is used to hold the result of the <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a> function.</p><table class="fos-options"><thead><tr><th>Name</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>variables</code></p></td><td class="fos-thin"> global variable declared in the library module. The key of the <p>This map (<var>V</var> ) contains one entry for each public entry is the name of the variable, as an <code>xs:QName</code> value; the associated value is the value of the variable.</p><ul><li><p><b>Type: </b><code>map(xs:QName, item()*)</code></p></li></ul></td></tr><tr><td><p><code>functions</code></p></td><td class="fos-thin"><p>This map (<var>F</var> ) contains one entry for each distinct QName <var>Q</var> that represents the name of a public and non-external function declared in the library module. The key of the entry is <var>Q</var>, as an <code>xs:QName</code> value; the associated value is a map <var>A</var>. This map (<var>A</var>) contains one entry for each arity <var>N</var> within the arity range of any of the function declarations with the given name; its key is <var>N</var>, as an <code>xs:integer</code> value, and its associated value is a function item obtained as if by evaluating a named function reference <code>Q#N</code>, using the static and dynamic context of the call on <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a>. The function item can be invoked using the rules for dynamic function invocation.</p><ul><li><p><b>Type: </b><code>map(xs:QName, map(xs:integer, function(*)))</code></p></li></ul></td></tr></tbody></table></div><div class="div2"><h3><a id="func-load-xquery-module"></a><span class="deltaxml-old" style="background:#FF5555">18.2</span><span class="deltaxml-new" style="background:#90EE90">19.2</span> <a href="#func-load-xquery-module" style="text-decoration: none">fn:load-xquery-module</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-op">next</a> | <a href="#func-invisible-xml">previous</a>)</p><ol><li><p>It has been clarified that loading a module has no effect on the static or dynamic context of the caller.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/725">725</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/727">727</a>&nbsp;10 October 2023]</i></p></li><li><p>The return type is now specified more precisely.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/883">883</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1072">1072</a>&nbsp;19 March 2024]</i></p></li><li><p>A new option is provided to allow the content of the loaded module to be supplied as a string.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1329">1329</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1333">1333</a>&nbsp;22 July 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Provides access to the public functions and global variables of a dynamically loaded XQuery library module.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:load-xquery-module</code>(</td></tr><tr class="arg"><td><code>$module-uri</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code>,</td><td></td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)?</code></code></td><td><code class="assign">:=&nbsp;</code><code>{}</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code class="return-type-ref"><a href="#load-xquery-module-record">load-xquery-module-record</a></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function loads an implementation-defined set of modules having the target namespace <code>$module-uri</code>.</p><p>If the second argument is omitted or the empty sequence, the result is the same as calling the two-argument form with the empty map as the value of the <code>$options</code> argument.</p><p>The <code>$options</code> argument can be used to control the way in which the function operates. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply.</p><p>If the query module is retrieved as an external resource, this is subject to the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trust level</a><sup><small>XP</small></sup> of the calling code. In addition, the ability of the loaded query module to access additional resources is subject to the value of the supplied <code>trusted</code> option.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Versions of XQuery prior to 4.0 do not define any constraints on access to external resources. Many XQuery implementations, however, provide such mechanisms. An implementation of <code>fn:load-xquery-module</code> that allows execution of an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-untrusted">untrusted</a><sup><small>XP</small></sup> query <span class="verb">must</span> ensure that the ability of that query to access resources is appropriately restricted, regardless of the version of XQuery in use.</p></div><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">xquery-version?</code></td><td><code class="as">as&nbsp;</code><code>xs:decimal</code>,</td></tr><tr class="arg"><td><code class="opt">trusted?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">location-hints?</code></td><td><code class="as">as&nbsp;</code><code>xs:string*</code>,</td></tr><tr class="arg"><td><code class="opt">content?</code></td><td><code class="as">as&nbsp;</code><code>xs:string?</code>,</td></tr><tr class="arg"><td><code class="opt">context-item?</code></td><td><code class="as">as&nbsp;</code><code>item()?</code>,</td></tr><tr class="arg"><td><code class="opt">variables?</code></td><td><code class="as">as&nbsp;</code><code>map(xs:QName, item()*)</code>,</td></tr><tr class="arg"><td><code class="opt">vendor-options?</code></td><td><code class="as">as&nbsp;</code><code>map(xs:QName, item()*)</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>xquery-version?</code></p></td><td class="fos-thin" colspan="2">The minimum level of the XQuery language that the processor must support. <ul><li><p><b>Type: </b><code>xs:decimal</code></p></li><li><p><b>Default: </b>The version given in the prolog of the library module; or <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> if this is absent.</p></li></ul></td></tr><tr><td rowspan="3"><p><code>trusted?</code></p></td><td class="fos-thick" colspan="2">Indicates whether the returned query module is trusted to access external resources. This applies both to resources statically referenced in the query module (such as imported schemas and imported library modules), and to resources accessed dynamically by invoking functions in the retrieved module, for example by use of the <a href="#func-doc"><code>fn:doc</code></a> function. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false()</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>The loaded query has the same level of trust as the caller, and may therefore access all external resources available to the caller. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>The functions and variables in the returned XQuery module are <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-untrusted">untrusted</a><sup><small>XP</small></sup>, and are therefore unable to access external resources unless these have been made explicitly available by a trusted caller. </td></tr><tr><td><p><code>location-hints?</code></p></td><td class="fos-thin" colspan="2">A sequence of URIs (in the form of <code>xs:string</code> values) which may be used or ignored in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way. <ul><li><p><b>Type: </b><code>xs:string*</code></p></li><li><p><b>Default: </b><code>Empty sequence</code></p></li></ul></td></tr><tr><td><p><code>content?</code></p></td><td class="fos-thin" colspan="2">The content of the query module as a string. When this option is used, the <code>location-hints</code> option is ignored. The static base URI of the dynamically loaded module is the same as the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> of the caller. <ul><li><p><b>Type: </b><code>xs:string?</code></p></li><li><p><b>Default: </b><code>Empty sequence</code></p></li></ul></td></tr><tr><td><p><code>context-item?</code></p></td><td class="fos-thin" colspan="2">The item to be used as the initial context item when evaluating global variables in the library module. Supplying the empty sequence is equivalent to omitting the entry from the map, and indicates the absence of a context item. If the library module specifies a required type for the context item, then the supplied value <span class="verb">must</span> conform to this type, without conversion. <ul><li><p><b>Type: </b><code>item()?</code></p></li><li><p><b>Default: </b><code>Absent</code></p></li></ul></td></tr><tr><td><p><code>variables?</code></p></td><td class="fos-thin" colspan="2">Values for external variables defined in the library module. Values <span class="verb">must</span> be supplied for external variables that have no default value, and <span class="verb">may</span> be supplied for external variables that do have a default value. The supplied value <span class="verb">must</span> conform to the required type of the variable, without conversion. The map contains one entry for each external variable: the key is the variable’s name, and the associated value is the variable’s value. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> do not apply to this contained map. <ul><li><p><b>Type: </b><code>map(xs:QName, item()*)</code></p></li><li><p><b>Default: </b><code>The empty map</code></p></li></ul></td></tr><tr><td><p><code>vendor-options?</code></p></td><td class="fos-thin" colspan="2">Values for vendor-defined configuration options for the XQuery processor used to process the request. The key is the name of an option, expressed as a QName: the namespace URI of the QName <span class="verb">should</span> be a URI controlled by the vendor of the XQuery processor. The meaning of the associated value is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations <span class="verb">should</span> ignore options whose names are in an unrecognized namespace. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> do not apply to this contained map. <ul><li><p><b>Type: </b><code>map(xs:QName, item()*)</code></p></li><li><p><b>Default: </b><code>The empty map</code></p></li></ul></td></tr></tbody></table><p><span style="display: none;" class="delete_version">The result of the function is a map <var>R</var> with two entries, as defined in <a href="#load-xquery-module-record"><span class="delete_version"><b>18.1 Record fn:load-xquery-module-record</b></span><span class="modify_version"><b>18.1 Record fn:load-xquery-module-record</b></span></a>.</span><span style="display: none;" class="add_version">The result of the function is a map <var>R</var> with two entries, as defined in <a href="#load-xquery-module-record"><span class="add_version"><b>19.1 Record fn:load-xquery-module-record</b></span><span class="modify_version"><b>19.1 Record fn:load-xquery-module-record</b></span></a>.</span><span class="modify_version">The result of the function is a map <var>R</var> with two entries, as defined in <a href="#load-xquery-module-record"><span style="display: none;" class="delete_version"><b>18.1 Record fn:load-xquery-module-record</b></span><span style="display: none;" class="add_version"><b>19.1 Record fn:load-xquery-module-record</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">18.1</span><span class="deltaxml-new" style="background:#90EE90">19.1</span> Record fn:load-xquery-module-record</b></span></a>.</span></p><p>The static and dynamic context of the library module are established according to the rules in <a href="https://www.w3.org/TR/xquery-31/#id-xq-context-components"> C Context Components </a><sup><small>XQ31</small></sup>.</p><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether constructs in the library module are evaluated in the same <a title="execution scope" class="termref" href="#execution-scope">execution scope</a> as the calling module.</p><p>The library module that is loaded may import other modules using an <code>import module</code> declaration. The result of <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a> does not include global variables or functions declared in such a transitively imported module. However, the <code>options</code> map supplied in the function call <span class="verb">may</span> (and if no default is defined, <span class="verb">must</span>) supply values for external variables declared in transitively loaded library modules.</p><p>The library module that is loaded may import schema declarations using an <code>import schema</code> declaration. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether schema components in the in-scope schema definitions of the calling module are automatically added to the in-scope schema definitions of the dynamically loaded module. The in-scope schema definitions of the calling and called modules must be consistent, according to the rules defined in <a href="https://www.w3.org/TR/xquery-31/#id-consistency-constraints"> 2.2.5 Consistency Constraints </a><sup><small>XQ31</small></sup>.</p><p>Where nodes are passed to or from the dynamically loaded module, for example as an argument or result of a function, they <span class="verb">should</span> if possible retain their node identity, their base URI, their type annotations, and their relationships to all other nodes in the containing tree (including ancestors and siblings). If this is not possible, for example because the only way of passing nodes to the chosen XQuery implementation is by serializing and re-parsing, then a node <span class="verb">may</span> be passed in the form of a deep copy, which may lose information about the identity of the node, about its ancestors and siblings, about its base URI, about its type annotations, and about its relationships to other nodes passed across the interface.</p></dd><dt class="label">Error Conditions</dt><dd><p>If <code>$module-uri</code> is a zero length string, a dynamic error is raised [<a href="#ERRFOQM0001" title="err:FOQM0001">err:FOQM0001</a>].</p><p>If the implementation is not able to find a library module with the specified target namespace, an error is raised [<a href="#ERRFOQM0002" title="err:FOQM0002">err:FOQM0002</a>].</p><p>If a static error (including a statically detected type error) is encountered when processing the library module, a dynamic error is raised [<a href="#ERRFOQM0003" title="err:FOQM0003">err:FOQM0003</a>].</p><p>If a value is supplied for the initial context item or for an external variable and the value does not conform to the required type declared in the dynamically loaded module, a dynamic error is raised [<a href="#ERRFOQM0005" title="err:FOQM0005">err:FOQM0005</a>].</p><p>If no suitable XQuery processor is available, a dynamic error is raised [<a href="#ERRFOQM0006" title="err:FOQM0006">err:FOQM0006</a>]. This includes (but is not limited to) the following cases:</p><ol class="enumar"><li><p>No XQuery processor is available;</p></li><li><p>Use of the function has been disabled;</p></li><li><p>No XQuery processor supporting the requested version of XQuery is available;</p></li><li><p>No XQuery processor supporting the optional Module Feature is available.</p></li></ol><p>If a dynamic error (including a dynamically detected type error) is encountered when processing the module (for example, when evaluating its global variables), the dynamic error is returned <em>as is</em>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If a function declaration <var>F</var> in the loaded module declares (say) four parameters of which one is optional, its arity range will be from 3 to 4, so the result will include two function items corresponding to <code>F#3</code> and <code>F#4</code>. In the lower-arity function item, <code>F#3</code>, the fourth parameter will take its default value. If the expression that initializes the default value is context sensitive, the static and dynamic context for its evaluation are the static and dynamic contexts of the <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a> function call itself. </p><p>As with all other functions in this specification, conformance requirements depend on the host language. For example, a host language might specify that provision of this function is optional, or that it is excluded entirely, or that implementations are required to support XQuery modules using a specified version of XQuery.</p><p>Even where support for this function is mandatory, it is <span class="verb">recommended</span> for security reasons that implementations should provide a user option to disable its use, or to disable aspects of its functionality.</p><p>The <code>load-xquery-module</code> function does not modify the static or dynamic context. Functions and variables from the loaded module become available within the result returned by the function, but they are not added to the static or dynamic context of the caller. This means, for example, that <code>function-lookup</code> will not locate functions from the loaded module.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $expr := "2 + 2"
let $module := `
  xquery version "4.0"; 
  module namespace dyn="http://example.com/dyn";
  declare %public variable $dyn:value := { $expr };
`
let $exec := load-xquery-module(
  "http://example.com/dyn",
  { 'content':$module }
)
let $variables := $exec?variables
return $variables( #Q{http://example.com/dyn}value )</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">4</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-transform"></a><span class="deltaxml-old" style="background:#FF5555">18.3</span><span class="deltaxml-new" style="background:#90EE90">19.3</span> <a href="#func-transform" style="text-decoration: none">fn:transform</a></h3><dl><dt class="label">Summary</dt><dd><p>Invokes a transformation using a dynamically loaded XSLT stylesheet.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:transform</code>(</td></tr><tr class="arg"><td><code>$options</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>map(*)</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>map(*)</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>This function loads an XSLT stylesheet and invokes it to perform a transformation.</p><p>The inputs to the transformation are supplied in the form of a map. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> apply to this map; they do not apply to any nested map unless otherwise specified.</p><p>The function first identifies the <b>requested XSLT version</b>, as follows:</p><ul><li><p>If the <code>xslt-version</code> option is present, the requested XSLT version is the value of that option. </p></li><li><p>Otherwise, the requested XSLT version is the value of the <code>[xsl:]version</code> attribute of the outermost element in the supplied stylesheet or package.</p></li></ul><p>The function then attempts to locate an XSLT processor that implements the requested XSLT version.</p><ul><li><p>If a processor that implements the requested XSLT version is available, then it is used. </p></li><li><p>Otherwise, if a processor that implements a version later than the requested version is available, then it is used. </p></li><li><p>Otherwise, the function fails indicating that no suitable XSLT processor is available.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>The phrase <em>locate an XSLT processor</em> includes the possibility of locating a software product and configuring it to act as an XSLT processor that implements the requested XSLT version.</p></div><p>If more than one XSLT processor is available under the above rules, then the one that is chosen may be selected according to the availability of requested features: see below.</p><p>Once an XSLT processor has been selected that implements a given version of XSLT, the processor follows the rules of that version of the XSLT specification. This includes any decision to operate in backwards or forwards compatibility mode. For example, if an XSLT 2.0 processor is selected, and the stylesheet specifies <code>version="1.0"</code>, then the processor will operate in backwards compatibility mode; if the same processor is selected and the stylesheet specifies <code>version="3.0"</code>, the processor will operate in forwards compatibility mode.</p><p>If the stylesheet to be executed is retrieved as an external resource, this is subject to the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-trusted">trust level</a><sup><small>XP</small></sup> of the calling code. In addition, the ability of the loaded stylesheet to access additional resources is subject to the value of the supplied <code>trusted</code> option.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Versions of XSLT prior to 4.0 do not define any constraints on access to external resources. Many XSLT implementations, however, provide such mechanisms. An implementation of <code>fn:transform</code> that allows an XSLT processor to execute an <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-untrusted">untrusted</a><sup><small>XP</small></sup> stylesheet <span class="verb">must</span> ensure that the ability of that stylesheet to access resources is appropriately restricted, regardless of the version of XSLT.</p></div><p>The combinations of options that are relevant to each version of XSLT, other than <code>xslt-version</code> itself, are listed below. This is followed by a table giving the meaning of each option.</p><ol class="enumar"><li><p>For invocation of an XSLT 1.0 processor (see <a href="#xslt10">[XSL Transformations (XSLT) Version 1.0]</a>), the supplied options must include all of the following <span>(if anything else is present, it is ignored)</span>:</p><ol class="enumla"><li><p>The stylesheet, provided by supplying exactly one of the following:</p><blockquote><p><code>stylesheet-location</code><br><code>stylesheet-node</code><br><code>stylesheet-text</code></p></blockquote></li><li><p>The source tree, provided as the value of the <code>source-node</code> option.</p></li><li><p>Zero or more of the following additional options:</p><blockquote><p><code>stylesheet-base-uri</code><br><code>stylesheet-params</code> (defaults to the empty map)<br><code>initial-mode</code> (defaults to the stylesheet’s default mode)<br><code>delivery-format</code> (defaults to <code>document</code>)<br><code>serialization-params</code> (defaults to the empty map)<br><code>enable-messages</code> (default is implementation-defined)<br><code>requested-properties</code> (default is the empty map)<br><code>trusted</code> (default is <code>false</code>)<br><code>vendor-options</code> (defaults to the empty map)<br><code>cache</code> (default is implementation-defined)</p></blockquote></li></ol></li><li><p>For invocation of an XSLT 2.0 processor (see <a href="#xslt20">[XSL Transformations (XSLT) Version 2.0]</a>), the supplied options must include all of the following <span>(if anything else is present, it is ignored)</span>:</p><ol class="enumla"><li><p>The stylesheet, provided by supplying exactly one of the following:</p><blockquote><p><code>stylesheet-location</code><br><code>stylesheet-node</code><br><code>stylesheet-text</code></p></blockquote></li><li><p>Invocation details, as exactly one of the following:</p><ol class="enumlr"><li><p>For apply-templates invocation, all of the following:</p><p><code>source-node</code></p><p>Optionally, <code>initial-mode</code> (defaults to the stylesheet’s default mode)</p></li><li><p>For call-template invocation, all of the following:</p><p><code>initial-template</code></p><p>Optionally, <code>source-node</code></p></li></ol></li><li><p>Zero or more of the following additional options:</p><blockquote><p><code>stylesheet-base-uri</code><br><code>stylesheet-params</code> (defaults to the empty map)<br><code>base-output-uri</code> (defaults to absent)<br><code>delivery-format</code> (defaults to <code>document</code>)<br><code>serialization-params</code> (defaults to the empty map)<br><code>enable-messages</code> (default is implementation-defined)<br><code>enable-trace</code> (default is implementation-defined)<br><code>requested-properties</code> (default is the empty map)<br><code>trusted</code> (default is <code>false</code>)<br><code>vendor-options</code> (defaults to the empty map)<br><code>cache</code> (default is implementation-defined)</p></blockquote></li></ol></li><li><p>For invocation of an XSLT 3.0 or XSLT 4.0 processor (see <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a>), the supplied options must include all of the following <span>(if anything else is present, it is ignored)</span>:</p><ol class="enumla"><li><p>The stylesheet, provided either by supplying exactly one of the following:</p><blockquote><p><code>stylesheet-location</code><br><code>stylesheet-node</code><br><code>stylesheet-text</code></p></blockquote><p>Or by supplying exactly one of the following:</p><blockquote><p><code>package-location</code><br><code>package-node</code><br><code>package-text</code><br><code>package-name</code> plus optionally <code>package-version</code></p></blockquote></li><li><p>Invocation details, as exactly one of the following combinations:</p><ol class="enumlr"><li><p>For apply-templates invocation, all of the following:</p><p>Exactly one of <code>source-node</code>, <code>source-location</code>, or <code>initial-match-selection</code></p><p>Optionally, <code>initial-mode</code></p><p>Optionally, <code>template-params</code></p><p>Optionally, <code>tunnel-params</code></p></li><li><p>For call-template invocation using an explicit template name, all of the following:</p><p><code>initial-template</code></p><p>Optionally, <code>template-params</code></p><p>Optionally, <code>tunnel-params</code></p><p>Optionally, <code>source-node</code></p></li><li><p>For call-template invocation using the defaulted template name <code>xsl:initial-template</code>, all of the following:</p><p>Optionally, <code>template-params</code></p><p>Optionally, <code>tunnel-params</code></p><div class="note"><p class="prefix"><b>Note:</b></p><p>If the <code>source-node</code> or <code>source-location</code>option is present and <code>initial-template</code> is absent, then apply-templates invocation will be used. To use call-template invocation on the template named <code>xsl:initial-template</code> while also supplying a context item for use when evaluating global variables, either (a) supply the context item using the <code>global-context-item</code> option, or (b) supply <code>source-node</code>, and set the <code>initial-template</code> option explicitly to the QName <code>xsl:initial-template</code></p></div></li><li><p>For call-function invocation, all of the following:</p><p><code>initial-function</code></p><p><code>function-params</code></p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>The invocation method can be determined as the first of the following which applies:</p><ul><li><p>If <code>initial-function</code> is present, then call-function invocation.</p></li><li><p>If <code>initial-template</code> is present, then call-template invocation.</p></li><li><p>If <code>source-node</code> or <code>source-location</code> or <code>initial-match-selection</code> is present, then apply-templates invocation.</p></li><li><p>Otherwise, <code>call-template</code> invocation using the default entry point <code>xsl:initial-template</code>.</p></li></ul></div></li><li><p>Zero or more of the following additional options:</p><blockquote><p><code>stylesheet-base-uri</code><br><code>static-params</code> (defaults to the empty map)<br><code>stylesheet-params</code> (defaults to the empty map)<br><code>global-context-item</code> (defaults to absent)<br><code>base-output-uri</code> (defaults to absent)<br><code>delivery-format</code><br><code>serialization-params</code> (defaults to the empty map)<br><code>enable-assertions</code> (default is <code>false</code>)<br><code>enable-messages</code> (default is implementation-defined)<br><code>enable-trace</code> (default is implementation-defined)<br><code>requested-properties</code> (default is the empty map)<br><code>trusted</code> (default is <code>false</code>)<br><code>vendor-options</code> (defaults to the empty map)<br><code>cache</code> (default is implementation-defined)</p></blockquote></li></ol></li></ol><p>The meanings of each option are defined in the table below.</p><div><div class="record"><table class="record" border="0"><tbody><tr><td colspan="2"><code>record(</code></td></tr><tr class="arg"><td><code class="opt">base-output-uri?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">cache?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">delivery-format?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">enable-assertions?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">enable-messages?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">enable-trace?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">function-params?</code></td><td><code class="as">as&nbsp;</code><code>array(item()*)</code>,</td></tr><tr class="arg"><td><code class="opt">global-context-item?</code></td><td><code class="as">as&nbsp;</code><code>item()</code>,</td></tr><tr class="arg"><td><code class="opt">initial-function?</code></td><td><code class="as">as&nbsp;</code><code>xs:QName</code>,</td></tr><tr class="arg"><td><code class="opt">initial-match-selection?</code></td><td><code class="as">as&nbsp;</code><code>item()*</code>,</td></tr><tr class="arg"><td><code class="opt">initial-mode?</code></td><td><code class="as">as&nbsp;</code><code>xs:QName</code>,</td></tr><tr class="arg"><td><code class="opt">initial-template?</code></td><td><code class="as">as&nbsp;</code><code>xs:QName</code>,</td></tr><tr class="arg"><td><code class="opt">package-name?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">package-location?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">package-node?</code></td><td><code class="as">as&nbsp;</code><code>node()</code>,</td></tr><tr class="arg"><td><code class="opt">package-text?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">package-version?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">post-process?</code></td><td><code class="as">as&nbsp;</code><code>fn(xs:string, item()*) as item()*</code>,</td></tr><tr class="arg"><td><code class="opt">requested-properties?</code></td><td><code class="as">as&nbsp;</code><code>map(xs:QName, xs:anyAtomicType)</code>,</td></tr><tr class="arg"><td><code class="opt">serialization-params?</code></td><td><code class="as">as&nbsp;</code><code>map(xs:anyAtomicType, item()*)</code>,</td></tr><tr class="arg"><td><code class="opt">source-location?</code></td><td><code class="as">as&nbsp;</code><code>node()</code>,</td></tr><tr class="arg"><td><code class="opt">source-node?</code></td><td><code class="as">as&nbsp;</code><code>node()</code>,</td></tr><tr class="arg"><td><code class="opt">static-params?</code></td><td><code class="as">as&nbsp;</code><code>map(xs:QName, item()*)</code>,</td></tr><tr class="arg"><td><code class="opt">stylesheet-base-uri?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">stylesheet-location?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">stylesheet-node?</code></td><td><code class="as">as&nbsp;</code><code>node()</code>,</td></tr><tr class="arg"><td><code class="opt">stylesheet-params?</code></td><td><code class="as">as&nbsp;</code><code>map(xs:QName, item()*)</code>,</td></tr><tr class="arg"><td><code class="opt">stylesheet-text?</code></td><td><code class="as">as&nbsp;</code><code>xs:string</code>,</td></tr><tr class="arg"><td><code class="opt">template-params?</code></td><td><code class="as">as&nbsp;</code><code>map(xs:QName, item()*)</code>,</td></tr><tr class="arg"><td><code class="opt">tunnel-params?</code></td><td><code class="as">as&nbsp;</code><code>map(xs:QName, item()*)</code>,</td></tr><tr class="arg"><td><code class="opt">trusted?</code></td><td><code class="as">as&nbsp;</code><code>xs:boolean</code>,</td></tr><tr class="arg"><td><code class="opt">vendor-options?</code></td><td><code class="as">as&nbsp;</code><code>{ xs:QName, item()* }</code>,</td></tr><tr class="arg"><td><code class="opt">xslt-version?</code></td><td><code class="as">as&nbsp;</code><code>xs:decimal</code></td></tr><tr><td colspan="2"><code>)</code></td></tr></tbody></table></div></div><table class="fos-options"><thead><tr><th>Key</th><th>Applies to</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>base-output-uri?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">The URI of the principal result document; also used as the base URI for resolving relative URIs of secondary result documents. If the value is a relative reference, it is resolved against the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> of the <code>fn:transform</code> function call. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b>The effect of not supplying a base output URI is defined by the XSLT specification; the implementation <span class="verb">may</span> supply a default, for example the current working directory. If the <code>fn:transform</code> function is called from XSLT, then the <span class="verb">recommended</span> default is the current output URI of the calling transformation.</p></li></ul></td></tr><tr><td><p><code>cache?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">This option has no effect on the result of the transformation but may affect efficiency. The value <code>true</code> indicates an expectation that the same stylesheet is likely to be used for more than one transformation; the value <code>false</code> indicates an expectation that the stylesheet will be used once only. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>true</code></p></li></ul></td></tr><tr><td rowspan="5"><p><code>delivery-format?</code></p></td><td rowspan="5">1.0, 2.0, 3.0, 4.0</td><td class="fos-thick" colspan="2">The manner in which the transformation results should be delivered. Applies both to the principal result document and to secondary result documents created using <code>xsl:result-document</code>. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>document</code></p><p>If the relevant <code>xsl:output</code> or <code>xsl:result-document</code> element specifies <code>build-tree="no"</code> (applies to XSLT 3.0 only), then the default is <code>raw</code>.</p></li></ul></td></tr><tr><td class="fos-thin"><code>document</code></td><td>The result is delivered as a document node.</td></tr><tr><td class="fos-thin"><code>serialized</code></td><td>The result is delivered as a string, representing the results of serialization. Note that (as with the <a href="#func-serialize"><code>fn:serialize</code></a> function) the final encoding stage of serialization (which turns a sequence of characters into a sequence of octets) is either skipped, or reversed by decoding the octet stream back into a character stream.</td></tr><tr><td class="fos-thin"><code>raw</code></td><td>The result of the initial template or function is returned as an arbitrary XDM value (after conversion to the declared type, but without wrapping in a document node, and without serialization): when this option is chosen, the returned map contains the raw result.</td></tr><tr><td class="fos-thick"><code>file</code></td><td>The serialized result is written to persistent storage. This means that the <code>fn:transform</code> function has side-effects and becomes nondeterministic, so the option should be used with care, and the precise behavior may be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. When this option is used, the URIs used for the <code>base-output-uri</code> and the URIs of any secondary result documents must be writable locations.</td></tr><tr><td><p><code>enable-assertions?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">Indicates whether any <code>xsl:assert</code> instructions in the stylesheet are to be evaluated. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false</code></p></li></ul></td></tr><tr><td><p><code>enable-messages?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">Indicates whether any <code>xsl:message</code> instructions in the stylesheet are to be evaluated. The destination and formatting of any such messages is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><a title="implementation-defined" class="termref" href="#implementation-defined">Implementation-defined</a>.</p></li></ul></td></tr><tr><td><p><code>enable-trace?</code></p></td><td>2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">Indicates whether any <a href="#func-trace"><code>fn:trace</code></a> functions in the stylesheet are to generate diagnostic messages. The destination and formatting of any such messages is implementation-defined. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><a title="implementation-defined" class="termref" href="#implementation-defined">Implementation-defined</a>.</p></li></ul></td></tr><tr><td><p><code>function-params?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">An array of values to be used as the arguments to the initial function call. The value is converted to the required type of the declared parameter using the function conversion rules. <ul><li><p><b>Type: </b><code>array(item()*)</code></p></li><li><p><b>Default: </b><code>Empty array</code></p></li></ul></td></tr><tr><td><p><code>global-context-item?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The value of the global context item, as defined in XSLT 3.0 <ul><li><p><b>Type: </b><code>item()</code></p></li><li><p><b>Default: </b>The value of <code>source-node</code>, if supplied</p></li></ul></td></tr><tr><td><p><code>initial-function?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The name of the initial function to be called for call-function invocation. The arity of the function is inferred from the length of <code>function-params</code>. <ul><li><p><b>Type: </b><code>xs:QName</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>initial-match-selection?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The value of the initial match selection, as defined in XSLT 3.0 <ul><li><p><b>Type: </b><code>item()*</code></p></li><li><p><b>Default: </b>The value of <code>source-node</code></p></li></ul></td></tr><tr><td><p><code>initial-mode?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">The name of the initial processing mode. <ul><li><p><b>Type: </b><code>xs:QName</code></p></li><li><p><b>Default: </b>none</p></li></ul></td></tr><tr><td><p><code>initial-template?</code></p></td><td>2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">The name of a named template in the stylesheet to act as the initial entry point. <ul><li><p><b>Type: </b><code>xs:QName</code></p></li><li><p><b>Default: </b><code>xsl:initial-template</code></p></li></ul></td></tr><tr><td><p><code>package-name?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The name of the top-level stylesheet package to be invoked (an absolute URI) <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>package-location?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The location of the top-level stylesheet package, as a relative or absolute URI <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>package-node?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">A document or element node containing the top-level stylesheet package <ul><li><p><b>Type: </b><code>node()</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>package-text?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The top-level stylesheet package in the form of unparsed lexical XML. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>package-version?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The version of the top-level stylesheet package to be invoked. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b><code>"*" (any version)</code></p></li></ul></td></tr><tr><td><p><code>post-process?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">A function that is used to post-process each result document of the transformation (both the principal result and secondary results), in whatever form it would otherwise be delivered (document, serialized, or raw). The first argument of the function is the key used to identify the result in the map return by the <a href="#func-transform"><code>fn:transform</code></a> function (for example, this will be the supplied base output URI in the case of the principal result, or the string “output” if no base output URI was supplied). The second argument is the actual value. The value that is returned in the result of the <a href="#func-transform"><code>fn:transform</code></a> function is the result of applying this post-processing. <div class="note"><p class="prefix"><b>Note:</b></p><p>If the implementation provides a way of writing or invoking functions with side-effects, this post-processing function might be used to save a copy of the result document to persistent storage. For example, if the implementation provides access to the EXPath File library <a href="#expath">[EXPath]</a>, then a serialized document might be written to filestore by calling the <code>file:write</code> function. Similar mechanisms might be used to issue an HTTP POST request that posts the result to an HTTP server, or to send the document to an email recipient. The semantics of calling functions with side-effects are entirely <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p><p>If the primary purpose of the post-processing function is achieved by means of such side-effects, and if the actual results are not needed by the caller of the <a href="#func-transform"><code>fn:transform</code></a> function, then it does not matter what the post-processing function actually returns (it could be the empty sequence, for example).</p><p>Calls to <a href="#func-transform"><code>fn:transform</code></a> can potentially have side-effects even in the absence of the post-processing option, because the XSLT specification allows a stylesheet to invoke extension functions that have side-effects. The semantics in this case are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>.</p></div><ul><li><p><b>Type: </b><code>fn(xs:string, item()*) as item()*</code></p></li><li><p><b>Default: </b><code>fn($a, $b) { $b }</code></p></li></ul></td></tr><tr><td><p><code>requested-properties?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">The keys in the map are QNames that could legitimately be supplied in a call to the XSLT <code>system-property</code> function; the values in the map are the requested settings of the corresponding property. The boolean values <code>true</code> and <code>false</code> are equivalent to the string values <code>yes</code> and <code>no</code>. As a special case, setting a value for <code>xsl:version</code> has no effect, because of the potential for conflict with other options. For example: <ul><li><p>Setting <code>xsl:product-name</code> to a particular value requests a particular XSLT software product.</p></li><li><p>Setting <code>xsl:product-version</code> requests a specific version of that product.</p></li><li><p>Setting <code>xsl:is-schema-aware</code> to <code>true</code> requests a schema-aware processor.</p></li><li><p>Setting <code>xsl:xsd-version</code> to <code>"1.1"</code> requests a processor that supports XML Schema version 1.1.</p></li></ul> Setting a boolean property such as <code>xsl:supports-dynamic-evaluation</code> to <code>false</code> is interpreted as an explicit request for a processor in which the value of the property is <code>false</code>. The effect if the requests cannot be precisely met is implementation-defined. In some cases it may be appropriate to ignore the request or to provide an alternative (for example, a later version of the product than the one requested); in other cases it may be more appropriate to raise an error [<a href="#ERRFOXT0001" title="err:FOXT0001">err:FOXT0001</a>] indicating that no suitable XSLT processor is available. <ul><li><p><b>Type: </b><code>map(xs:QName, xs:anyAtomicType)</code></p></li><li><p><b>Default: </b><code>Empty map</code></p></li></ul></td></tr><tr><td><p><code>serialization-params?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">Serialization parameters for the principal result document. The supplied map follows the same rules that apply to a map supplied as the second argument of <a href="#func-serialize"><code>fn:serialize</code></a>. <ul><li><p>When a parameter is supplied, the corresponding value overrides or augments the value specified in the unnamed <code>xsl:output</code> declaration (or its default), following the same rules as when one <code>xsl:output</code> declaration overrides another with lower import precedence.</p></li><li><p>When a parameter is supplied and the corresponding value is the empty sequence (for example, <code>{ "standalone": () }</code>), any value specified in the unnamed <code>xsl:output</code> declaration is overridden by the default value. </p></li><li><p>When a parameter is not supplied in <code>serialization-params</code> (that is, when the key is absent) the value that applies is the value appearing in the unnamed <code>xsl:output</code> declaration, or its default. </p></li></ul><ul><li><p><b>Type: </b><code>map(xs:anyAtomicType, item()*)</code></p></li><li><p><b>Default: </b><code>Empty map</code></p></li></ul></td></tr><tr><td><p><code>source-location?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">When <code>source-location</code> is supplied then it is expected to be an absolute or relative URI identifying an unparsed XML document. If relative, it is resolved against the static base URI of the <code>fn:transform</code> function call. The document at this location is parsed, and the document node acts as the <code>initial-match-selection</code>, that is, stylesheet execution starts by applying templates to this node. If the initial mode is streamable and a streaming XSLT 3.0 or XSLT 4.0 processor is used, then the supplied document is processed in streaming mode. <ul><li><p><b>Type: </b><code>node()</code></p></li><li><p><b>Default: </b><code>n/a</code></p></li></ul></td></tr><tr><td><p><code>source-node?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">When <code>source-node</code> is supplied then the <code>global-context-item</code> (the context item for evaluating global variables) is the root of the tree containing the supplied node. In addition, for apply-templates invocation, the <code>source-node</code> acts as the <code>initial-match-selection</code>, that is, stylesheet execution starts by applying templates to this node. <ul><li><p><b>Type: </b><code>node()</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>static-params?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The values of static parameters defined in the stylesheet; the keys are the names of the parameters, and the associated values are their values. The value is converted to the required type of the declared parameter using the coercion rules. <ul><li><p><b>Type: </b><code>map(xs:QName, item()*)</code></p></li><li><p><b>Default: </b><code>Empty map</code></p></li></ul></td></tr><tr><td><p><code>stylesheet-base-uri?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">A string intended to be used as the static base URI of the principal stylesheet module. This value <span class="verb">must</span> be used if no other static base URI is available. If the supplied stylesheet already has a base URI (which will generally be the case if the stylesheet is supplied using <code>stylesheet-node</code> or <code>stylesheet-location</code>) then it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether this parameter has any effect. If the value is a relative reference, it is resolved against the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> of the <code>fn:transform</code> function call. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>stylesheet-location?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">URI that can be used to locate the principal stylesheet module. If relative, it is resolved against the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> of the <code>fn:transform</code> function call. The value also acts as the default for stylesheet-base-uri. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>stylesheet-node?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">Root of the tree containing the principal stylesheet module, as a document or element node. The base URI of the node acts as the default for stylesheet-base-uri. <ul><li><p><b>Type: </b><code>node()</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>stylesheet-params?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">A map holding values to be supplied for stylesheet parameters. The keys are the parameter names; the values are the corresponding parameter values. The values are converted if necessary to the required type using the coercion rules. The default is the empty map. <ul><li><p><b>Type: </b><code>map(xs:QName, item()*)</code></p></li><li><p><b>Default: </b><code>Empty map</code></p></li></ul></td></tr><tr><td><p><code>stylesheet-text?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">The principal stylesheet module in the form of unparsed lexical XML. <ul><li><p><b>Type: </b><code>xs:string</code></p></li><li><p><b>Default: </b>n/a</p></li></ul></td></tr><tr><td><p><code>template-params?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The values of non-tunnel parameters to be supplied to the initial template, used with both apply-templates and call-template invocation. Each value is converted to the required type of the declared parameter using the coercion rules. <ul><li><p><b>Type: </b><code>map(xs:QName, item()*)</code></p></li><li><p><b>Default: </b>none</p></li></ul></td></tr><tr><td><p><code>tunnel-params?</code></p></td><td>3.0, 4.0</td><td class="fos-thin" colspan="2">The values of tunnel parameters to be supplied to the initial template, used with both apply-templates and call-template invocation. Each value is converted to the required type of the declared parameter using the coercion rules. <ul><li><p><b>Type: </b><code>map(xs:QName, item()*)</code></p></li><li><p><b>Default: </b><code>Empty map</code></p></li></ul></td></tr><tr><td rowspan="3"><p><code>trusted?</code></p></td><td rowspan="3"></td><td class="fos-thick" colspan="2">Indicates whether the target stylesheet is trusted to access external resources. This applies both to resources statically referenced by the stylesheet (for example using <code>xsl:include</code>, <code>xsl:import</code>, <code>xsl:use-package</code>, or <code>xsl:import-schema</code>), and to resources accessed dynamically by executing the retrieved stylesheet, for example by use of the <a href="#func-doc"><code>fn:doc</code></a> or <a href="#func-unparsed-text"><code>unparsed-text</code></a> function. <ul><li><p><b>Type: </b><code>xs:boolean</code></p></li><li><p><b>Default: </b><code>false()</code></p></li></ul></td></tr><tr><td class="fos-thin"><code>true</code></td><td>The loaded stylesheet has the same level of trust as the caller, and may therefore access all external resources available to the caller. </td></tr><tr><td class="fos-thick"><code>false</code></td><td>The loaded stylesheet is <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-untrusted">untrusted</a><sup><small>XP</small></sup>, and is therefore unable to access external resources unless these have been made explicitly available by a trusted caller. </td></tr><tr><td><p><code>vendor-options?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">Values for vendor-defined configuration options for the XSLT processor used to process the request. The key is the name of an option, expressed as a QName: the namespace URI of the QName <span class="verb">should</span> be a URI controlled by the vendor of the XSLT processor. The meaning of the associated value is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations <span class="verb">should</span> ignore options whose names are in an unrecognized namespace. Default is the empty map. <ul><li><p><b>Type: </b><code>{ xs:QName, item()* }</code></p></li><li><p><b>Default: </b><code>Empty map</code></p></li></ul></td></tr><tr><td><p><code>xslt-version?</code></p></td><td>1.0, 2.0, 3.0, 4.0</td><td class="fos-thin" colspan="2">The minimum level of the XSLT language that the processor must support. <ul><li><p><b>Type: </b><code>xs:decimal</code></p></li><li><p><b>Default: </b>The <code>[xsl:]version</code> attribute at the outermost level of the stylesheet.</p></li></ul></td></tr></tbody></table><p>The result of the transformation is returned as a map. There is one entry in the map for the principal result document, and one for each secondary result document. The key is a URI in the form of an <code>xs:string</code> value. The key for the principal result document is the base output URI if specified, or the string <code>"output"</code> otherwise. The key for secondary result documents is the URI of the document, as an absolute URI. The associated value in each entry depends on the requested delivery format. If the delivery format is <code>document</code>, the value is a document node. If the delivery format is <code>serialized</code>, the value is a string containing the serialized result. </p><p>Where nodes are passed to or from the transformation, for example as the value of a stylesheet parameter or the result of a function, they <span class="verb">should</span> if possible retain their node identity, their base URI, their type annotations, and their relationships to all other nodes in the containing tree (including ancestors and siblings). If this is not possible, for example because the only way of passing nodes to the chosen XSLT implementation is by serializing and re-parsing, then a node <span class="verb">may</span> be passed in the form of a deep copy, which may lose information about the identity of the node, about its ancestors and siblings, about its base URI, about its type annotation, and about its relationships to other nodes passed across the interface.</p><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether the XSLT transformation is executed within the same <a title="execution scope" class="termref" href="#execution-scope">execution scope</a> as the calling code.</p><p>The function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a> in that it is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> whether running the function twice against the same inputs produces identical results. The results of two invocations may differ in the identity of any returned nodes; they may also differ in other respects, for example because the value of <a href="#func-current-dateTime"><code>fn:current-dateTime</code></a> is different for the two invocations, or because the contents of external documents accessed using <a href="#func-doc"><code>fn:doc</code></a> or <code>xsl:source-document</code> change between one invocation and the next.</p></dd><dt class="label">Error Conditions</dt><dd><p>A dynamic error is raised [<a href="#ERRFOXT0001" title="err:FOXT0001">err:FOXT0001</a>] if the transformation cannot be invoked because no suitable XSLT processor is available. This includes (but is not limited to) the following cases:</p><ol class="enumar"><li><p>No XSLT processor is available;</p></li><li><p>No XSLT processor supporting the requested version of XSLT is available;</p></li><li><p>The XSLT processor API does not support some requested feature (for example, the ability to supply tunnel parameters externally);</p></li></ol><p>A dynamic error is raised [<a href="#ERRFOXT0002" title="err:FOXT0002">err:FOXT0002</a>] if an error is detected in the supplied parameters (for example if two mutually exclusive parameters are supplied).</p><p>If a static or dynamic error is reported by the XSLT processor, this function fails with a dynamic error, retaining the XSLT error code.</p><p>A dynamic error is raised [<a href="#ERRFOXT0003" title="err:FOXT0003">err:FOXT0003</a>] if the XSLT transformation invoked by a call on <a href="#func-transform"><code>fn:transform</code></a> fails with a static or dynamic error, and no more specific error code is available. </p><div class="note"><p class="prefix"><b>Note:</b></p><p>XSLT 1.0 does not define any error codes, so this is the likely outcome with an XSLT 1.0 processor. XSLT 2.0 and 3.0 do define error codes, but some APIs do not expose them. If multiple errors are signaled by the transformation (which is most likely to happen with static errors) then the error code should where possible be that of one of these errors, chosen arbitrarily; the processor may make details of additional errors available to the application in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way.</p></div><p>A dynamic error is raised [<a href="#ERRFOXT0004" title="err:FOXT0004">err:FOXT0004</a>] if the use of this function (or of selected options) has been externally disabled, for example for security reasons.</p><p>A dynamic error is raised [<a href="#ERRFOXT0006" title="err:FOXT0006">err:FOXT0006</a>] if the transformation produces output containing characters available only in XML 1.1, and the calling processor cannot handle such characters.</p><p>Recursive use of the <a href="#func-transform"><code>fn:transform</code></a> function may lead to catastrophic failures such as non-termination or stack overflow. No error code is assigned to such conditions, since they cannot necessarily be detected by the processor.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>As with all other functions in this specification, conformance requirements depend on the host language. For example, a host language might specify that provision of this function is optional, or that it is excluded entirely, or that implementations are required to support a particular set of values for the <code>xslt-version</code> parameter.</p><p>Even where support for this function is mandatory, it is <span class="verb">recommended</span> for security reasons that implementations should provide a user option to disable its use, or to disable aspects of its functionality such as the ability to write to persistent resources.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The following example loads a stylesheet from the location <code>render.xsl</code>, applies it to a document loaded from <code>test.xml</code>, and uses an XPath expression to examine the result:</p></td></tr><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $result := transform({
  "stylesheet-location": "render.xsl",
  "source-node": doc('test.xml')
})
return $result?output//body</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-op"></a><span class="deltaxml-old" style="background:#FF5555">18.4</span><span class="deltaxml-new" style="background:#90EE90">19.4</span> <a href="#func-op" style="text-decoration: none">fn:op</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#functions-on-types">next</a> | <a href="#func-load-xquery-module">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/83">83</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/173">173</a>&nbsp;11 October 2022]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a function whose effect is to apply a supplied binary operator to two arguments.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:op</code>(</td></tr><tr class="arg"><td><code>$operator</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>fn(item()*, item()*) as item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The supplied operator must be one of:</p><p><code>","</code>, <code>"and"</code>, <code>"or"</code>, <code>"+"</code>, <code>"-"</code>, <code>"*"</code>, <code>"div"</code>, <code>"idiv"</code>, <code>"mod"</code>, <code>"="</code>, <code>"&lt;"</code>, <code>"&lt;="</code>, <code>"&gt;"</code>, <code>"&gt;="</code>, <code>"!="</code>, <code>"eq"</code>, <code>"lt"</code>, <code>"le"</code>, <code>"gt"</code>, <code>"ge"</code>, <code>"ne"</code>, <code>"&lt;&lt;"</code>, <code>"&gt;&gt;"</code>, <code>"precedes"</code>, <code>"follows"</code>, <code>"precedes-or-is"</code>, <code>"follows-or-is"</code>, <code>"is"</code>, <code>"is-not"</code>, <code>"||"</code>, <code>"|"</code>, <code>"union"</code>, <code>"except"</code>, <code>"intersect"</code>, <code>"to"</code>, <code>"otherwise"</code>.</p><p>The result of calling <code>fn:op("⊙")</code>, where <code>⊙</code> is one of the above operators, is the function represented by the XPath expression:</p><p><code>fn($x, $y) { $x ⊙ $y }</code></p><p>For example, <code>op("+")</code> returns <code>fn($x, $y) { $x + $y }</code>.</p></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup> if the supplied argument is not one of the supported operators. </p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function is useful in contexts where an arity-2 callback function needs to be supplied, and a standard operator meets the requirement.</p><p>For example, the XSLT <code>xsl:map</code> instruction has an <code>on-duplicates</code> attribute that expects such a function. Specifying <code>on-duplicates="op(',')"</code> is equivalent to specifying <code>on-duplicates="fn($x, $y) { $x, $y }</code></p><p>The function is also useful in cases where the choice of operator to apply is made dynamically.</p><p>Some operators (such as <code>and</code>, <code>or</code>, and <code>otherwise</code>) have custom error handling semantics, with the effect that evaluating one of the operands cannot cause an error unless the other operand has a particular value (see <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-guarded-expressions">2.5.5 Guarded Expressions</a>). Although implementations are free to make optimizations, it should be assumed that a function call such as <code>op('and')(X, Y)</code> will have the normal semantics of a dynamic function call, where the arguments are evaluated in any order, and a failure evaluating any argument may cause the function call as a whole to fail.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>for-each-pair(21 to 25, 1 to 5, op("+"))</code></pre></div></td><td style="vertical-align:top"><p><code>22, 24, 26, 28, 30</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>for-each-pair(21 to 25, 1 to 5, op("-"))</code></pre></div></td><td style="vertical-align:top"><p><code>20, 20, 20, 20, 20</code></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div1"><h2><a id="functions-on-types"></a><span class="deltaxml-old" style="background:#FF5555">19</span><span class="deltaxml-new" style="background:#90EE90">20</span> <a href="#functions-on-types" style="text-decoration: none">Processing types</a></h2><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-schema-type">next</a> | <a href="#func-op">previous</a>)</p><ol><li><p> New functions are provided to obtain information about built-in types and types defined in an imported schema. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/148">148</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1523">1523</a>&nbsp;5 November 2024]</i></p></li></ol></div><p>The functions in this section deliver information about schema types (including simple types and complex types). These may represent built-in types (such as <code>xs:dateTime</code>), user-defined types found in the static context (typically because they appear in an imported schema), or types used as type annotations on schema-validated nodes.</p><p>For more information on schema types, see <a href="#schema-type-hierarchy"><b>1.8.2 Schema Type Hierarchy</b></a>. The properties of a schema type are described in terms of the properties of a Simple Type Definition or Complex Type Definition component as described in <a href="https://www.w3.org/TR/xmlschema11-1/#Simple_Type_Definition_details"> 3.16.1 The Simple Type Definition Schema Component </a><sup><small>XS11-1</small></sup> and <a href="https://www.w3.org/TR/xmlschema11-1/#Complex_Type_Definition_details"> 3.4.1 The Complex Type Definition Schema Component </a><sup><small>XS11-1</small></sup> respectively. Not all properties are exposed.</p><p>The structured representation of a schema type is described in <a href="#schema-type-record"><span style="display: none;" class="delete_version"><b>19.1.1 Record fn:schema-type-record</b></span><span style="display: none;" class="add_version"><b>20.1.1 Record fn:schema-type-record</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">19.1.1</span><span class="deltaxml-new" style="background:#90EE90">20.1.1</span> Record fn:schema-type-record</b></span></a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Simple properties of a schema type that can be expressed as strings or booleans are represented in this record structure directly as atomic field values, while complex properties whose values are themselves types (for example, <code>base-type</code> and <code>primitive-type</code>) are represented as functions. This is done partly to make it easier for implementations to compute complex properties on demand rather than in advance, and partly to ensure that the overall structure is always acyclic. For example, the primitive type of <code>xs:decimal</code> is itself <code>xs:decimal</code>, and if this were represented as a field value without a guarding function, serialization of the map using the JSON output method would not terminate.</p></div><div class="div2"><h3><a id="functions-returning-type-information"></a><span class="deltaxml-old" style="background:#FF5555">19.1</span><span class="deltaxml-new" style="background:#90EE90">20.1</span> <a href="#functions-returning-type-information" style="text-decoration: none">Functions returning type information</a></h3><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-schema-type"><code>fn:schema-type</code></a></td><td>Returns a record containing information about a named schema type in the static context.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-type-of"><code>fn:type-of</code></a></td><td>Returns information about the type of a value, as a string.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-atomic-type-annotation"><code>fn:atomic-type-annotation</code></a></td><td>Returns a record containing information about the type annotation of an atomic value.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-node-type-annotation"><code>fn:node-type-annotation</code></a></td><td>Returns a record containing information about the type annotation of an element or attribute node.</td></tr></tbody></table><div class="div3"><h4><a id="schema-type-record"></a><span class="deltaxml-old" style="background:#FF5555">19.1.1</span><span class="deltaxml-new" style="background:#90EE90">20.1.1</span> <a href="#schema-type-record" style="text-decoration: none">Record fn:schema-type-record</a></h4><p>This record type represents the properties of a simple or complex type in a schema.</p><table class="fos-options"><thead><tr><th>Name</th><th>Meaning</th></tr></thead><tbody><tr><td><p><code>name</code></p></td><td class="fos-thin"><p>The name of the type. Empty in the case of an anonymous type. Corresponds to <a href="https://www.w3.org/TR/xmlschema11-1/#ctd-name">{name}<sup><small>XS11-1</small></sup></a> and <a href="https://www.w3.org/TR/xmlschema11-1/#ctd-target_namespace">{target namespace}<sup><small>XS11-1</small></sup></a> in the XSD component model for simple and complex type components.</p><ul><li><p><b>Type: </b><code>xs:QName?</code></p></li></ul></td></tr><tr><td><p><code>is-simple</code></p></td><td class="fos-thin"><p>True for a simple type, false for a complex type.</p><ul><li><p><b>Type: </b><code>xs:boolean</code></p></li></ul></td></tr><tr><td><p><code>base-type</code></p></td><td class="fos-thin"><p>Function item returning the base type (the type from which this type is derived by restriction or extension). The function is always present, and returns the empty sequence in the case of the type <code>xs:anyType</code>. Corresponds to the <a href="https://www.w3.org/TR/xmlschema11-1/#ctd-base_type_definition">{base type definition}<sup><small>XS11-1</small></sup></a> property in the XSD component model.</p><ul><li><p><b>Type: </b><code>fn() as schema-type-record?</code></p></li></ul></td></tr><tr><td><p><code>primitive-type?</code></p></td><td class="fos-thin"><p>For an atomic type, a function item returning the primitive type from which this type is ultimately derived. Corresponds to the <a href="https://www.w3.org/TR/xmlschema11-1/#std-primitive_type_definition">{primitive type definition}<sup><small>XS11-1</small></sup></a> in the XSD component model for simple types. Absent if the type is non atomic, or if it is the simple type <code>xs:anyAtomicType</code>. If this is a primitive type, the function item is idempotent.</p><ul><li><p><b>Type: </b><code>fn() as schema-type-record</code></p></li></ul></td></tr><tr><td><p><code>variety?</code></p></td><td class="fos-thin"><p>For a simple type, one of <code>"atomic"</code>, <code>"list"</code>, or <code>"union"</code>, corresponding to the <a href="https://www.w3.org/TR/xmlschema11-1/#std-variety">{variety}<sup><small>XS11-1</small></sup></a> of the simple type in the XSD component model. For a complex type, one of <code>"empty"</code>, <code>"simple"</code>, <code>"element-only"</code>, or <code>"mixed"</code>, corresponding to the <a href="https://www.w3.org/TR/xmlschema11-1/#ctd-content_type">{content type}<sup><small>XS11-1</small></sup></a>.<a href="https://www.w3.org/TR/xmlschema11-1/#ct-variety">{variety}<sup><small>XS11-1</small></sup></a> of the complex type in the XSD component model. The value is absent in cases where the <a href="https://www.w3.org/TR/xmlschema11-1/#std-variety">{variety}<sup><small>XS11-1</small></sup></a> in the XSD component model is absent, for example for the type <code>xs:anySimpleType</code>.</p><ul><li><p><b>Type: </b><code>enum("atomic", "list", "union", "empty", "simple", "element-only", "mixed")</code></p></li></ul></td></tr><tr><td><p><code>members?</code></p></td><td class="fos-thin"><p>For a simple type with variety <code>"union"</code>, a function that returns a sequence of records representing the member types of the union, in order, corresponding to the <a href="https://www.w3.org/TR/xmlschema11-1/#std-member_type_definitions">{member type definitions}<sup><small>XS11-1</small></sup></a> property in the XSD component model. For a simple type with variety <code>"list"</code>, a function that returns a record representing the item type of the list type, corresponding to the <a href="https://www.w3.org/TR/xmlschema11-1/#std-item_type_definition">{item type definition}<sup><small>XS11-1</small></sup></a> property in the XSD component model. In all other cases, absent.</p><ul><li><p><b>Type: </b><code>fn() as schema-type-record*</code></p></li></ul></td></tr><tr><td><p><code>simple-content-type?</code></p></td><td class="fos-thin"><p>For a complex type with variety <code>"simple"</code> (that is, a complex type with simple content), a function that returns a record representing the relevant simple type, corresponding to the <a href="https://www.w3.org/TR/xmlschema11-1/#ctd-content_type">{content type}<sup><small>XS11-1</small></sup></a>.<a href="https://www.w3.org/TR/xmlschema11-1/#ct-simple_type_definition">{simple type definition}<sup><small>XS11-1</small></sup></a> property in the XSD complex type component. In all other cases, absent.</p><ul><li><p><b>Type: </b><code>fn() as schema-type-record</code></p></li></ul></td></tr><tr><td><p><code>matches?</code></p></td><td class="fos-thin"><p>For a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-generalized-atomic-type">generalized atomic type</a><sup><small>XP</small></sup>, a function item that can be called to establish whether the supplied atomic item is an instance of this type. In all other cases, absent.</p><ul><li><p><b>Type: </b><code>fn(xs:anyAtomicType) as xs:boolean</code></p></li></ul></td></tr><tr><td><p><code>constructor?</code></p></td><td class="fos-thin"><p><span style="display: none;" class="delete_version">For a simple type, a function item that can be used to construct instances of this type. In the case of a named type that is present in the dynamic context, the result is the same function as returned by <a href="#func-function-lookup"><code>fn:function-lookup</code></a> applied to the type name (with arity one). For details see <a href="#constructor-functions-for-xsd-types"><span class="delete_version"><b>22.1 Constructor functions for XML Schema built-in atomic types</b></span><span class="modify_version"><b>22.1 Constructor functions for XML Schema built-in atomic types</b></span></a> and <a href="#constructor-functions-for-user-defined-types"><span class="delete_version"><b>22.5 Constructor functions for user-defined atomic and union types</b></span><span class="modify_version"><b>22.5 Constructor functions for user-defined atomic and union types</b></span></a>. Constructor function items are also available for anonymous types, and for types that might not be present in the dynamic context. The field is absent for complex types and for the abstract types <code>xs:anyAtomicType</code>, <code>xs:anySimpleType</code>, and <code>xs:NOTATION</code>. It is also absent for all <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-namespace-sensitive">namespace-sensitive</a><sup><small>XP</small></sup> types. </span><span style="display: none;" class="add_version">For a simple type, a function item that can be used to construct instances of this type. In the case of a named type that is present in the dynamic context, the result is the same function as returned by <a href="#func-function-lookup"><code>fn:function-lookup</code></a> applied to the type name (with arity one). For details see <a href="#constructor-functions-for-xsd-types"><span class="add_version"><b>23.1 Constructor functions for XML Schema built-in atomic types</b></span><span class="modify_version"><b>23.1 Constructor functions for XML Schema built-in atomic types</b></span></a> and <a href="#constructor-functions-for-user-defined-types"><span class="add_version"><b>23.5 Constructor functions for user-defined atomic and union types</b></span><span class="modify_version"><b>23.5 Constructor functions for user-defined atomic and union types</b></span></a>. Constructor function items are also available for anonymous types, and for types that might not be present in the dynamic context. The field is absent for complex types and for the abstract types <code>xs:anyAtomicType</code>, <code>xs:anySimpleType</code>, and <code>xs:NOTATION</code>. It is also absent for all <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-namespace-sensitive">namespace-sensitive</a><sup><small>XP</small></sup> types. </span><span class="modify_version">For a simple type, a function item that can be used to construct instances of this type. In the case of a named type that is present in the dynamic context, the result is the same function as returned by <a href="#func-function-lookup"><code>fn:function-lookup</code></a> applied to the type name (with arity one). For details see <a href="#constructor-functions-for-xsd-types"><span style="display: none;" class="delete_version"><b>22.1 Constructor functions for XML Schema built-in atomic types</b></span><span style="display: none;" class="add_version"><b>23.1 Constructor functions for XML Schema built-in atomic types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.1</span><span class="deltaxml-new" style="background:#90EE90">23.1</span> Constructor functions for XML Schema built-in atomic types</b></span></a> and <a href="#constructor-functions-for-user-defined-types"><span style="display: none;" class="delete_version"><b>22.5 Constructor functions for user-defined atomic and union types</b></span><span style="display: none;" class="add_version"><b>23.5 Constructor functions for user-defined atomic and union types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.5</span><span class="deltaxml-new" style="background:#90EE90">23.5</span> Constructor functions for user-defined atomic and union types</b></span></a>. Constructor function items are also available for anonymous types, and for types that might not be present in the dynamic context. The field is absent for complex types and for the abstract types <code>xs:anyAtomicType</code>, <code>xs:anySimpleType</code>, and <code>xs:NOTATION</code>. It is also absent for all <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-namespace-sensitive">namespace-sensitive</a><sup><small>XP</small></sup> types. </span></p><ul><li><p><b>Type: </b><code>fn(xs:anyAtomicType?) as xs:anyAtomicType*</code></p></li></ul></td></tr></tbody></table></div><div class="div3"><h4><a id="func-schema-type"></a><span class="deltaxml-old" style="background:#FF5555">19.1.2</span><span class="deltaxml-new" style="background:#90EE90">20.1.2</span> <a href="#func-schema-type" style="text-decoration: none">fn:schema-type</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-type-of">next</a> | <a href="#functions-on-types">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/148">148</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1523">1523</a>&nbsp;22 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a record containing information about a named schema type in the static context.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:schema-type</code>(</td></tr><tr class="arg"><td><code>$name</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:QName</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code class="return-type-ref"><a href="#schema-type-record">schema-type-record</a>?</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>If the static context (specifically, the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-is-types">in-scope schema types</a><sup><small>XP</small></sup>) includes a schema type whose name matches <code>$name</code>, the function returns a <a href="#schema-type-record">schema-type-record</a> containing information about that schema type. If not, it returns the empty sequence.</p></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>schema-type( #xs:integer ) ? name</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>#xs:integer</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>schema-type( #xs:long ) ? primitive-type() ? name</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>#xs:decimal</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>schema-type( #xs:positiveInteger ) ? base-type() ? name</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>#xs:nonNegativeInteger</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>schema-type( #xs:integer ) ? matches(23)</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>true()</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>schema-type( #xs:numeric ) ? variety</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>"union"</code></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>schema-type( #xs:numeric ) ? members() ? name</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p><code>#xs:double, #xs:float, #xs:decimal</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-type-of"></a><span class="deltaxml-old" style="background:#FF5555">19.1.3</span><span class="deltaxml-new" style="background:#90EE90">20.1.3</span> <a href="#func-type-of" style="text-decoration: none">fn:type-of</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-atomic-type-annotation">next</a> | <a href="#func-schema-type">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1550">1550</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1570">1570</a>&nbsp;12 November 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns information about the type of a value, as a string.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:type-of</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns a string, whose lexical form will always match the grammar of <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#SequenceType">SequenceType</a><sup><small>XP</small></sup>, representing a sequence type that matches <code>$value</code>.</p><p>If <code>$value</code> is the empty sequence, the function returns the string <code>"empty-sequence()"</code>.</p><p>Otherwise, the returned string is the concatenation of:</p><ol class="enumar"><li><p>A string representing the distinct item types that are present in <code>$value</code>, formed as follows:</p><ol class="enumla"><li><p>For each item in <code>$value</code>, construct a string representing its item type as described below.</p></li><li><p>Eliminate duplicate strings from this list by applying the <a href="#func-distinct-values"><code>fn:distinct-values</code></a> function, forming a sequence of strings <var>$ss</var>.</p></li><li><p>If <var>$ss</var> contains only one string, use that string.</p></li><li><p>Otherwise, return the result of the expression <code>`({ fn:string-join(<var>$ss</var>, "|") })`</code>.</p></li></ol></li><li><p>An occurrence indicator: absent if <code>$value</code> contains exactly one item, or <code>"+"</code> if it contains more than one item.</p></li></ol><p>The string representing the type of an individual item <var>J</var> is constructed as follows:</p><ol class="enumar"><li><p>If <var>J</var> is an <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-XNode">XNode</a><sup><small>DM</small></sup>, the result is one of the following strings, determined by the node kind of the node (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> section <a href="../xpath-datamodel-40/#dm-node-kind">7.6.9 node-kind Accessor</a>):</p><blockquote><p><code>"document-node()"</code><br><code>"element()"</code><br><code>"attribute()"</code><br><code>"text()"</code><br><code>"processing-instruction()"</code><br><code>"comment()"</code><br><code>"namespace-node()"</code></p></blockquote></li><li><p>If <var>J</var> is a <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-JNode">JNode</a><sup><small>DM</small></sup>, the result is in the form <code>jnode(<var>T</var>)</code>, where <var>T</var> is the result of applying the <a href="#func-type-of"><code>type-of</code></a> function to the <b>·content·</b> property of <var>J</var>.</p></li><li><p>If <var>J</var> is an atomic item, the result is a string chosen as follows:</p><ol class="enumla"><li><p>Let <var>T</var> be the type denoted by the type annotation of <var>J</var>.</p></li><li><p>If <var>T</var> is an anonymous type, set <var>T</var> to the base type of <var>T</var>, and repeat until a type is reached that is not anonymous.</p></li><li><p>If the name of <var>T</var> is in the namespace <code>http://www.w3.org/2001/XMLSchema</code>, return the string <code>"xs:<var>local</var>"</code> where <var>local</var> is the local part of the name of <var>T</var>.</p></li><li><p>Otherwise, return the name of <var>T</var> in the form of a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#URIQualifiedName">URIQualifiedName</a><sup><small>XP</small></sup> (that is, <code>"Q{<var>uri</var>}<var>local</var>"</code>, or <code>"Q{}<var>local</var>"</code> if the name is in no namespace).</p></li></ol></li><li><p>If <var>J</var> is a function item:</p><ol class="enumla"><li><p>If <var>J</var> is an array, return <code>"array(*)"</code>.</p></li><li><p>If <var>J</var> is a map, return <code>"map(*)"</code>.</p></li><li><p>Otherwise, return <code>"fn(*)"</code>.</p></li></ol></li></ol></dd><dt class="label">Error Conditions</dt><dd><p>If the <code>$value</code> argument is omitted and the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>, the function raises type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>In general, an item matches more than one type, and there are cases where there is no single matching type that is more specific than all the others. This is especially true with functions, maps, and arrays. This function therefore selects one of the types that matches the item, which is not necessarily the most specific type.</p><p>This function should not be used as a substitute for an <code>instance of</code> test. The precise type annotation of the result of an expression is not always predictable, because processors are free to deliver a more specific type than is mandated by the specification. For example, if <code>$n</code> is of type <code>xs:positiveInteger</code>, then the result of <code>abs($n)</code> is guaranteed to be an instance of <code>xs:integer</code>, but an implementation might reasonably return the supplied value unchanged: that is, a value whose actual type annotation is <code>xs:positiveInteger</code>. Similarly the type annotation of the value returned by <code>position()</code> might be <code>xs:long</code> rather than <code>xs:integer</code>.</p><p>Implementations <span class="verb">should</span>, however, refrain from exposing types that are purely internal. For example, an implementation might have an optimized internal representation for strings consisting entirely of ASCII characters, or for single-character strings; if this is the case then the type annotation returned by this function should be a user-visible supertype such as <code>xs:string</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Variables</th></tr></thead><tbody><tr><td colspan="2"><div class="exampleInner"><pre xml:space="preserve" class="small">let $e := &lt;doc&gt;
  &lt;p id="alpha" xml:id="beta"&gt;One&lt;/p&gt;
  &lt;p id="gamma" xmlns="http://example.com/ns"&gt;Two&lt;/p&gt;
  &lt;ex:p id="delta" xmlns:ex="http://example.com/ns"&gt;Three&lt;/ex:p&gt;
  &lt;?pi 3.14159?&gt;
&lt;/doc&gt;</pre></div></td></tr></tbody></table><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//*[@id = 'alpha'])</code></pre></div></td><td style="vertical-align:top"><p><code>"element()"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//*)</code></pre></div></td><td style="vertical-align:top"><p><code>"element()+"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//@id[. = 'gamma'])</code></pre></div></td><td style="vertical-align:top"><p><code>"attribute()"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//node()[. = '3.14159'])</code></pre></div></td><td style="vertical-align:top"><p><code>"processing-instruction()"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e//no-such-node)</code></pre></div></td><td style="vertical-align:top"><p><code>"empty-sequence()"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of($e/child::node())</code></pre></div></td><td style="vertical-align:top"><p><code>"(element()|processing-instruction())+"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of(1)</code></pre></div></td><td style="vertical-align:top"><p><code>"xs:integer"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of(1 to 5)</code></pre></div></td><td style="vertical-align:top"><p><code>"xs:integer+"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of((1, 1.2, 2))</code></pre></div></td><td style="vertical-align:top"><p><code>"(xs:integer|xs:decimal)+"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of([ 1, 2, 3 ])</code></pre></div></td><td style="vertical-align:top"><p><code>"array(*)"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of({ 'a': 1 })</code></pre></div></td><td style="vertical-align:top"><p><code>"map(*)"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of(type-of#1)</code></pre></div></td><td style="vertical-align:top"><p><code>"fn(*)"</code></p></td></tr><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>type-of(jtree([]))</code></pre></div></td><td style="vertical-align:top"><p><code>"jnode(array(*))"</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-atomic-type-annotation"></a><span class="deltaxml-old" style="background:#FF5555">19.1.4</span><span class="deltaxml-new" style="background:#90EE90">20.1.4</span> <a href="#func-atomic-type-annotation" style="text-decoration: none">fn:atomic-type-annotation</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-node-type-annotation">next</a> | <a href="#func-type-of">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/148">148</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1523">1523</a>&nbsp;22 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a record containing information about the type annotation of an atomic value.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:atomic-type-annotation</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code class="return-type-ref"><a href="#schema-type-record">schema-type-record</a></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Given an atomic value, the function returns a <a href="#schema-type-record">schema-type-record</a> containing information about the atomic type represented by its <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-type-annotation">type annotation</a><sup><small>DM</small></sup>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The result will always have <code>?is-simple = true()</code> and <code>?variety = "atomic"</code>. In a non-schema-aware environment the type will always be a built-in atomic type in the <code>xs</code> namespace: see <a href="#atomic-type-hierarchy"><b>1.8.3 Atomic Type Hierarchy</b></a>. Where a schema is in use, however, the result may be an atomic type defined in the schema, which may be an anonymous type.</p><p>Note that under the function coercion rules, it is possible to supply a node as the argument, which will then be atomized. In simple cases the type annotation on the atomized value will be the same as the type annotation on the node. But this is not always true: for example the type annotation on the node might be a complex type with simple content, while the type annotation on its atomized value is the corresponding simple content type. To get the type annotation on the node, use the function <a href="#func-node-type-annotation"><code>fn:node-type-annotation</code></a>.</p><p>This function should not be used as a substitute for an <code>instance of</code> test. The precise type annotation of the result of an expression is not always predictable, because processors are free to deliver a more specific type than is mandated by the specification. For example, if <code>$n</code> is of type <code>xs:positiveInteger</code>, then the result of <code>abs($n)</code> is guaranteed to be an instance of <code>xs:integer</code>, but an implementation might reasonably return the supplied value unchanged: that is, a value whose actual type annotation is <code>xs:positiveInteger</code>. Similarly the type annotation of the value returned by <code>position()</code> might be <code>xs:long</code> rather than <code>xs:integer</code>.</p><p>Implementations <span class="verb">should</span>, however, refrain from exposing types that are purely internal. For example, an implementation might have an optimized internal representation for strings consisting entirely of ASCII characters, or for single-character strings; if this is the case then the type annotation returned by this function should be a user-visible supertype such as <code>xs:string</code>.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">atomic-type-annotation(23) ? name</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">#xs:integer</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $x := 23, $y := 93.7 
return atomic-type-annotation($x) ? matches($y)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">false()</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">atomic-type-annotation(xs:numeric('23.2')) ? name</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">#xs:double</pre></div></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-node-type-annotation"></a><span class="deltaxml-old" style="background:#FF5555">19.1.5</span><span class="deltaxml-new" style="background:#90EE90">20.1.5</span> <a href="#func-node-type-annotation" style="text-decoration: none">fn:node-type-annotation</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-error">next</a> | <a href="#func-atomic-type-annotation">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/148">148</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1523">1523</a>&nbsp;22 October 2024]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Returns a record containing information about the type annotation of an element or attribute node.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:node-type-annotation</code>(</td></tr><tr class="arg"><td><code>$node</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>(element() | attribute())</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code class="return-type-ref"><a href="#schema-type-record">schema-type-record</a></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Given an element or attribute node, the function returns a <a href="#schema-type-record">schema-type-record</a> containing information about the schema type represented by its <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-type-annotation">type annotation</a><sup><small>DM</small></sup>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>For an element that has not been schema-validated, the type annotation is always <code>xs:untyped</code>.</p><p>For an attribute that has not been schema-validated, the type annotation is always <code>xs:untypedAtomic</code>.</p><p>The type annotation of an attribute node is always a simple type; the type annotation of an element node may be simple or complex.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $e := parse-xml("&lt;e/&gt;")/*
return node-type-annotation($e) ? name</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">#xs:untyped</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $a := parse-xml("&lt;e a='3'/&gt;")//@a
return node-type-annotation($a) ? name</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">#xs:untypedAtomic</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">let $x := json-to-xml('[23, 24]', { 'validate': true() })
return node-type-annotation($x/*) ? name</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">#fn:arrayType</pre></div></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve" class="small">let $x := json-to-xml('[23, 24]', { 'validate': true() })
let $n23 := $x//fn:number[. = 23]                  
let $type := node-type-annotation($n23)
return ($type ? name, 
        $type ? base-type() ? name, 
        $type ? base-type() ? base-type() ? name)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">#fn:numberType, 
#fn:finiteNumberType, 
#xs:double</pre></div></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="context"></a><span class="deltaxml-old" style="background:#FF5555">20</span><span class="deltaxml-new" style="background:#90EE90">21</span> <a href="#context" style="text-decoration: none">Accessing the context</a></h2><p>The following functions are defined to obtain information from the static or dynamic context.</p><table class="index"><thead><tr><th>Function</th><th>Meaning</th></tr></thead><tbody><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-current-date"><code>fn:current-date</code></a></td><td>Returns the current date.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-current-dateTime"><code>fn:current-dateTime</code></a></td><td>Returns the current date and time (with timezone).</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-current-time"><code>fn:current-time</code></a></td><td>Returns the current time.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-default-collation"><code>fn:default-collation</code></a></td><td>Returns the value of the default collation property from the <span>dynamic</span> context. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-default-language"><code>fn:default-language</code></a></td><td>Returns the value of the default language property from the dynamic context. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-implicit-timezone"><code>fn:implicit-timezone</code></a></td><td>Returns the value of the implicit timezone property from the dynamic context. </td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-last"><code>fn:last</code></a></td><td>Returns the context size from the dynamic context.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-position"><code>fn:position</code></a></td><td>Returns the context position from the dynamic context.</td></tr><tr><td style="white-space:nowrap; vertical-align:top"><a href="#func-static-base-uri"><code>fn:static-base-uri</code></a></td><td>This function returns the value of the <b>executable base URI</b> property from the dynamic context.</td></tr></tbody></table><div class="div2"><h3><a id="func-current-date"></a><span class="deltaxml-old" style="background:#FF5555">20.1</span><span class="deltaxml-new" style="background:#90EE90">21.1</span> <a href="#func-current-date" style="text-decoration: none">fn:current-date</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the current date.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:current-date</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:date</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>Returns <code>xs:date(fn:current-dateTime())</code>. This is an <code>xs:date</code> (with timezone) that is current at some time during the evaluation of a query or transformation in which <a href="#func-current-date"><code>fn:current-date</code></a> is executed.</p><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>. The precise instant during the query or transformation represented by the value of <a href="#func-current-date"><code>fn:current-date</code></a> is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The returned date will always have an associated timezone, which will always be the same as the implicit timezone in the dynamic context</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p><code>current-date()</code> returns an <code>xs:date</code> corresponding to the current date. For example, a call of <code>current-date()</code> might return <code>2004-05-12+01:00</code>. </p></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-current-dateTime"></a><span class="deltaxml-old" style="background:#FF5555">20.2</span><span class="deltaxml-new" style="background:#90EE90">21.2</span> <a href="#func-current-dateTime" style="text-decoration: none">fn:current-dateTime</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the current date and time (with timezone).</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:current-dateTime</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:dateTimeStamp</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>Returns the current dateTime (with timezone) from the dynamic context. (See <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>.) This is an <code>xs:dateTime</code> that is current at some time during the evaluation of a query or transformation in which <a href="#func-current-dateTime"><code>fn:current-dateTime</code></a> is executed.</p><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>. The precise instant during the query or transformation represented by the value of <code>fn:current-dateTime()</code> is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p>If the implementation supports data types from XSD 1.1 then the returned value will be an instance of <code>xs:dateTimeStamp</code>. Otherwise, the only guarantees are that it will be an instance of <code>xs:dateTime</code> and will have a timezone component.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The returned <code>xs:dateTime</code> will always have an associated timezone, which will always be the same as the implicit timezone in the dynamic context</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p><code>current-dateTime()</code> returns an <code>xs:dateTimeStamp</code> corresponding to the current date and time. For example, a call of <code>current-dateTime()</code> might return <code>2004-05-12T18:17:15.125Z</code> corresponding to the current time on May 12, 2004 in timezone <code>Z</code>. </p></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-current-time"></a><span class="deltaxml-old" style="background:#FF5555">20.3</span><span class="deltaxml-new" style="background:#90EE90">21.3</span> <a href="#func-current-time" style="text-decoration: none">fn:current-time</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the current time.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:current-time</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:time</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>Returns <code>xs:time(fn:current-dateTime())</code>. This is an <code>xs:time</code> (with timezone) that is current at some time during the evaluation of a query or transformation in which <a href="#func-current-time"><code>fn:current-time</code></a> is executed.</p><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>. The precise instant during the query or transformation represented by the value of <code>fn:current-time()</code> is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The returned time will always have an associated timezone, which will always be the same as the implicit timezone in the dynamic context</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p><code>current-time()</code> returns an <code>xs:time</code> corresponding to the current time. For example, a call of <code>current-time()</code> might return <code>23:17:00.000-05:00</code>. </p></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-default-collation"></a><span class="deltaxml-old" style="background:#FF5555">20.4</span><span class="deltaxml-new" style="background:#90EE90">21.4</span> <a href="#func-default-collation" style="text-decoration: none">fn:default-collation</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the value of the default collation property from the <span>dynamic</span> context. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:default-collation</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:string</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on collations. </p></dd><dt class="label">Rules</dt><dd><p>Returns the value of the default collation property from the <span>dynamic</span> context context. Components of the dynamic context are described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#eval_context">2.2.2 Dynamic Context</a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The default collation property can never be absent. If it is not explicitly defined, a system defined default can be invoked. If this is not provided, the Unicode codepoint collation (<code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code>) is used. </p><p>In most cases, the default collation is known statically, and a call on this function can therefore be pre-evaluated during static analysis. The only notable exception is when a call on <code>default-collation()</code> is used to define the default value of a parameter to a user-defined function. In this case it is interpreted as a reference to the default collation in the context of the relevant function call, which may differ from the default collation of the function definition.</p></div></dd></dl></div><div class="div2"><h3><a id="func-default-language"></a><span class="deltaxml-old" style="background:#FF5555">20.5</span><span class="deltaxml-new" style="background:#90EE90">21.5</span> <a href="#func-default-language" style="text-decoration: none">fn:default-language</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the value of the default language property from the dynamic context. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:default-language</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:language</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on default language. </p></dd><dt class="label">Rules</dt><dd><p>Returns the value of the default language property from the dynamic context. Components of the dynamic context are described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#eval_context">2.2.2 Dynamic Context</a>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The default language property can never be absent. The functions <a href="#func-format-integer"><code>fn:format-integer</code></a>, <a href="#func-format-date"><code>fn:format-date</code></a>, <a href="#func-format-time"><code>fn:format-time</code></a>, and <a href="#func-format-dateTime"><code>fn:format-dateTime</code></a> are defined to use the default language if no explicit language is supplied. The default language may play a role in selection of a default collation, but this is not a requirement.</p></div></dd></dl></div><div class="div2"><h3><a id="func-implicit-timezone"></a><span class="deltaxml-old" style="background:#FF5555">20.6</span><span class="deltaxml-new" style="background:#90EE90">21.6</span> <a href="#func-implicit-timezone" style="text-decoration: none">fn:implicit-timezone</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the value of the implicit timezone property from the dynamic context. </p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:implicit-timezone</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:dayTimeDuration</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on implicit timezone. </p></dd><dt class="label">Rules</dt><dd><p>Returns the value of the implicit timezone property from the dynamic context. Components of the dynamic context are described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>.</p></dd></dl></div><div class="div2"><h3><a id="func-last"></a><span class="deltaxml-old" style="background:#FF5555">20.7</span><span class="deltaxml-new" style="background:#90EE90">21.7</span> <a href="#func-last" style="text-decoration: none">fn:last</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the context size from the dynamic context.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:last</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:integer</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Returns the context size from the dynamic context. (See <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>.)</p></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup> if the context <span>size</span> is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>Under most circumstances, the context size is absent only if the context value is absent. However, XSLT 3.0 with streaming defines situations in which the context value and context position are known, but the context size is unknown.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><thead><tr><th>Expression</th><th>Result</th></tr></thead><tbody><tr><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve"><code>(1 to 20)[last() - 1]</code></pre></div></td><td style="vertical-align:top"><p><code>19</code></p></td></tr></tbody></table></div></dd></dl></div><div class="div2"><h3><a id="func-position"></a><span class="deltaxml-old" style="background:#FF5555">20.8</span><span class="deltaxml-new" style="background:#90EE90">21.8</span> <a href="#func-position" style="text-decoration: none">fn:position</a></h3><dl><dt class="label">Summary</dt><dd><p>Returns the context position from the dynamic context.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:position</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:integer</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Returns the context position from the dynamic context. (See <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#id-xp-evaluation-context-components">B.2 Dynamic Context Components</a>.)</p></dd><dt class="label">Error Conditions</dt><dd><p>A type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPDY0002" title="err:XPDY0002">err:XPDY0002</a>]<sup><small>XP</small></sup> if the context value is <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-absent">absent</a><sup><small>DM</small></sup>.</p></dd></dl></div><div class="div2"><h3><a id="func-static-base-uri"></a><span class="deltaxml-old" style="background:#FF5555">20.9</span><span class="deltaxml-new" style="background:#90EE90">21.9</span> <a href="#func-static-base-uri" style="text-decoration: none">fn:static-base-uri</a></h3><dl><dt class="label">Summary</dt><dd><p>This function returns the value of the <b>executable base URI</b> property from the dynamic context.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name return-type"><td colspan="3"><code class="function">fn:static-base-uri</code>()<code class="as">&nbsp;as&nbsp;</code><code class="return-type">xs:anyURI?</code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. It depends on executable base URI. </p></dd><dt class="label">Rules</dt><dd><p>The function (despite its name) returns the value of the <b>executable base URI</b> property from the dynamic context. If the property is absent, the empty sequence is returned.</p><p>Components of the dynamic context are described in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> section <a href="../xquery-40/xpath-40.html#eval_context">2.2.2 Dynamic Context</a> .</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The executable base URI will in many cases be the same as the static base URI in the static context. However, XQuery and XSLT give an implementation freedom to use different base URIs during the static analysis phase and the dynamic evaluation phase, that is, for retrieval of compile-time and run-time resources respectively. This is appropriate when the implementation allows the output of static analysis (a “compiled” query or stylesheet) to be deployed for execution to a different location from the one where static analysis took place. In this situation, the <a href="#func-static-base-uri"><code>fn:static-base-uri</code></a> function should return a URI suitable for locating resources needed during dynamic evaluation.</p><p>If a call on the <a href="#func-static-base-uri"><code>fn:static-base-uri</code></a> function appears within the expression used to define the value of an optional parameter to a user-defined function, then the value supplied to the function (if the argument is omitted) will be the executable base URI from the dynamic context of the function caller. This allows such a function to resolve relative URIs supplied in other parameters to the same function.</p></div></dd></dl></div></div><div class="div1"><h2><a id="errors-and-diagnostics"></a><span class="deltaxml-old" style="background:#FF5555">21</span><span class="deltaxml-new" style="background:#90EE90">22</span> <a href="#errors-and-diagnostics" style="text-decoration: none">Errors and diagnostics</a></h2><div class="div2"><h3><a id="errors"></a><span class="deltaxml-old" style="background:#FF5555">21.1</span><span class="deltaxml-new" style="background:#90EE90">22.1</span> <a href="#errors" style="text-decoration: none">Raising errors</a></h3><p>In this document, as well as in <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> and <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a>, the phrase “an error is raised” is used. Raising an error is equivalent to calling the <a href="#func-error"><code>fn:error</code></a> function defined in this section with the provided error code. Except where otherwise specified, errors defined in this specification are dynamic errors. Some errors, however, are classified as type errors. Type errors are typically used where the presence of the error can be inferred from knowledge of the type of the actual arguments to a function, for example with a call such as <code>fn:string(fn:abs#1)</code>. Host languages may allow type errors to be reported statically if they are discovered during static analysis.</p><p> When function specifications indicate that an error is to be raised, the notation “[<em>error code</em> ]” is used to specify an error code. Each error defined in this document is identified by an <code>xs:QName</code> that is in the <code>http://www.w3.org/2005/xqt-errors</code> namespace, represented in this document by the <code>err</code> prefix. It is this <code>xs:QName</code> that is actually passed as an argument to the <a href="#func-error"><code>fn:error</code></a> function. Calling this function raises an error. For a more detailed treatment of error handing, see <a href="https://www.w3.org/TR/xpath-31/#id-handling-dynamic"> 2.3.3 Handling Dynamic Errors </a><sup><small>XP31</small></sup>.</p><p>The <a href="#func-error"><code>fn:error</code></a> function is a general function that may be called as above but may also be called from <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> or <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> applications with, for example, an <code>xs:QName</code> argument. </p><div class="div3"><h4><a id="func-error"></a><span class="deltaxml-old" style="background:#FF5555">21.1.1</span><span class="deltaxml-new" style="background:#90EE90">22.1.1</span> <a href="#func-error" style="text-decoration: none">fn:error</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-trace">next</a> | <a href="#func-node-type-annotation">previous</a>)</p><ol><li><p>All three arguments are now optional, and each argument can be set to the empty sequence. Previously if <code>$description</code> was supplied, it could not be empty.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/895">895</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901</a>&nbsp;16 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Calling the <a href="#func-error"><code>fn:error</code></a> function raises an application-defined error.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:error</code>(</td></tr><tr class="arg"><td><code>$code</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:QName?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$description</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code>,</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="nondeterministic" class="termref" href="#dt-nondeterministic">nondeterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>This function never returns a value. Instead it always raises an error. The effect of the error is identical to the effect of dynamic errors raised implicitly, for example when an incorrect argument is supplied to a function.</p><p>The parameters to the <a href="#func-error"><code>fn:error</code></a> function supply information that is associated with the error condition and that is made available to a caller that asks for information about the error. The error may be caught either by the host language (using a try/catch construct in XSLT or XQuery, for example), or by the calling application or external processing environment. The way in which error information is returned to the external processing environment is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p>There are three pieces of information that may be associated with an error.</p><ul><li><p>The <code>$code</code> is an error code that distinguishes this error from others. It is an <code>xs:QName</code>; the namespace URI conventionally identifies the component, subsystem, or authority responsible for defining the meaning of the error code, while the local part identifies the specific error condition. The namespace URI <code>http://www.w3.org/2005/xqt-errors</code> is used for errors defined in this specification; other namespace URIs may be used for errors defined by the application.</p><p>If the external processing environment expects the error code to be returned as a URI or a string rather than as an <code>xs:QName</code>, then an error code with namespace URI <code>NS</code> and local part <code>LP</code> will be returned in the form <code>NS#LP</code>. The namespace URI part of the error code should therefore not include a fragment identifier.</p><p>If no value is supplied for the <code>$code</code> argument, <span>or if the value supplied is the empty sequence,</span> the effective value of the error code is <code>fn:QName('http://www.w3.org/2005/xqt-errors', 'err:FOER0000')</code>.</p></li><li><p>The <code>$description</code> is a natural-language description of the error condition.</p><p>If no value is supplied for the <code>$description</code> argument, <span>or if the value supplied is the empty sequence,</span> then the effective value of the description is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p></li><li><p>The <code>$value</code> is an arbitrary value used to convey additional information about the error, and may be used in any way the application chooses.</p><p>If no value is supplied for the <code>$value</code> argument <span>or if the value supplied is the empty sequence</span>, then the effective value of the error object is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p></li></ul></dd><dt class="label">Error Conditions</dt><dd><p>This function always raises a dynamic error. By default, it raises [<a href="#ERRFOER0000" title="err:FOER0000">err:FOER0000</a>]</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The value of the <code>$description</code> parameter may need to be localized.</p><p>Since the function never returns a value, the declared return type of <code>item()*</code> is a convenient fiction. It is relevant insofar as a function item such as <code>error#1</code> may (as a consequence of function coercion) be supplied in contexts where a function with a more specific return type is required.</p><p>Any QName may be used as an error code; there are no reserved names or namespaces. The error is always classified as a dynamic error, even if the error code used is one that is normally used for static errors or type errors.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><p><code>error()</code></p></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p>Raises error FOER0000.</p><p><em>(This returns the URI <code>http://www.w3.org/2005/xqt-errors#FOER0000</code> (or the corresponding <code>xs:QName</code>) to the external processing environment, unless the error is caught using a try/catch construct in the host language.)</em></p></td></tr><tr class="testdiv"><th style="vertical-align:top">Expression:</th><td style="vertical-align:top"><div class="exampleInner"><pre xml:space="preserve">error(
  QName('http://www.example.com/HR', 'myerr:toohighsal'),
  'Salary is too high'
)</pre></div></td></tr><tr><th style="vertical-align:top">Result:</th><td style="vertical-align:top"><p>Raises error myerr:toohighsal.</p><p><em>(This returns <code>http://www.example.com/HR#toohighsal</code> and the <code>xs:string</code><code>"Salary is too high"</code> (or the corresponding <code>xs:QName</code>) to the external processing environment, unless the error is caught using a try/catch construct in the host language.)</em></p></td></tr></tbody></table></div></dd></dl></div></div><div class="div2"><h3><a id="diagnostics"></a><span class="deltaxml-old" style="background:#FF5555">21.2</span><span class="deltaxml-new" style="background:#90EE90">22.2</span> <a href="#diagnostics" style="text-decoration: none">Diagnostic tracing</a></h3><div class="div3"><h4><a id="func-trace"></a><span class="deltaxml-old" style="background:#FF5555">21.2.1</span><span class="deltaxml-new" style="background:#90EE90">22.2.1</span> <a href="#func-trace" style="text-decoration: none">fn:trace</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#func-message">next</a> | <a href="#func-error">previous</a>)</p><ol><li><p>The <code>$label</code> argument can now be set to the empty sequence. Previously if <code>$label</code> was supplied, it could not be empty.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/895">895</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901</a>&nbsp;16 December 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Provides an execution trace intended to be used in debugging queries.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:trace</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$label</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>item()*</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>The function returns <code>$input</code>, unchanged.</p><p>In addition, the values of <code>$input</code>, typically serialized and converted to an <code>xs:string</code>, and <code>$label</code> (if supplied <span>and non-empty</span>) <span class="verb">may</span> be output to an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> destination.</p><p>Any serialization of the implementation’s trace output <span class="verb">must not</span> raise an error. This can be achieved (for example) by using a serialization method that can handle arbitrary input, such as the adaptive output method (see <a href="https://www.w3.org/TR/xslt-xquery-serialization-31/#adaptive-output"> 10 Adaptive Output Method </a><sup><small>SER31</small></sup>).</p><p>The format of the trace output and its order are <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>. Therefore, the order in which the output appears is not predictable. This also means that if dynamic errors occur (whether or not they are caught using try/catch), it may be unpredictable whether any output is reported before the error occurs.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>If the trace information is unrelated to a specific value, <a href="#func-message"><code>fn:message</code></a> can be used instead.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>Consider a situation in which a user wants to investigate the actual value passed to a function. Assume that in a particular execution, <code>$v</code> is an <code>xs:decimal</code> with value <code>124.84</code>. Writing <code>fn:trace($v, 'the value of $v is:')</code> will return <code>$v</code>. The processor <span class="verb">may</span> output <code>"124.84"</code> and <code>"the value of $v is:"</code> to an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> destination.</p></td></tr><tr><td colspan="2"><p>The following two XPath expressions are identical, but only the second provides trace feedback to the user: </p></td></tr><tr><td colspan="2"><ul><li><p><code>//book[xs:decimal(@price) gt 100]</code></p></li><li><p><code>//book[xs:decimal(@price) gt 100] =&gt; trace('books more expensive than €100:')</code></p></li></ul></td></tr></tbody></table></div></dd></dl></div><div class="div3"><h4><a id="func-message"></a><span class="deltaxml-old" style="background:#FF5555">21.2.2</span><span class="deltaxml-new" style="background:#90EE90">22.2.2</span> <a href="#func-message" style="text-decoration: none">fn:message</a></h4><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#constructor-functions">next</a> | <a href="#func-trace">previous</a>)</p><ol><li><p>New in 4.0<i>&nbsp;&nbsp;[Issues <a href="https://github.com/qt4cg/qtspecs/issues/574">574</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/issues/651">651</a>&nbsp;PRs <a href="https://github.com/qt4cg/qtspecs/pull/629">629</a>&nbsp;<a href="https://github.com/qt4cg/qtspecs/pull/803">803</a>&nbsp;7 November 2023]</i></p></li></ol></div><dl><dt class="label">Summary</dt><dd><p>Outputs trace information and discards the result.</p></dd><dt class="label">Signature</dt><dd><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">fn:message</code>(</td></tr><tr class="arg"><td><code>$input</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>item()*</code></code>,</td><td></td></tr><tr class="arg"><td><code>$label</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>()</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>empty-sequence()</code></code></td></tr></tbody></table></div></dd><dt class="label">Properties</dt><dd><p>This function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>, <a title="context-independent" class="termref" href="#dt-context-independent">context-independent</a>, and <a title="focus-dependent" class="termref" href="#dt-focus-independent">focus-independent</a>. </p></dd><dt class="label">Rules</dt><dd><p>Similar to <a href="#func-trace"><code>fn:trace</code></a>, the values of <code>$input</code>, typically serialized and converted to an <code>xs:string</code>, and <code>$label</code> (if supplied and non-empty) <span class="verb">may</span> be output to an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> destination.</p><p>In contrast to <a href="#func-trace"><code>fn:trace</code></a>, the function returns the empty sequence.</p><p>Any serialization of the implementation’s log output <span class="verb">must not</span> raise an error. This can e.g. be achieved by using a serialization method that can handle arbitrary input, such as the <a href="https://www.w3.org/TR/xslt-xquery-serialization-31/#adaptive-output"> 10 Adaptive Output Method </a><sup><small>SER31</small></sup>.</p><p>The format of the log output and its order are <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>. Therefore, the order in which the output appears is not predictable. This also means that if dynamic errors occur (whether or not they are caught using try/catch), it may be unpredictable whether any output is logged before the error occurs.</p></dd><dt class="label">Notes</dt><dd><div class="note"><p>The function can be used for debugging. It can also be helpful in productive environments, e.g. to store dynamic input and evaluations to log files.</p></div></dd><dt class="label">Examples</dt><dd><div class="example"><table class="medium"><tbody><tr><td colspan="2"><p>The following two XPath expressions are identical, but only the second logs any feedback: </p></td></tr><tr><td colspan="2"><ul><li><p><code>//book[xs:decimal(@price) lt 1000]</code></p></li><li><p><code>//book[if (xs:decimal(@price) lt 1000) then true() else message(@price, @title || ' is unexpectedly expensive: ')]</code></p></li></ul></td></tr></tbody></table></div></dd></dl></div></div></div><div class="div1"><h2><a id="constructor-functions"></a><span class="deltaxml-old" style="background:#FF5555">22</span><span class="deltaxml-new" style="background:#90EE90">23</span> <a href="#constructor-functions" style="text-decoration: none">Constructor functions</a></h2><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#id-constructors-for-record-tests">next</a> | <a href="#func-message">previous</a>)</p><ol><li><p> Constructor functions now have a zero-arity form; the first argument defaults to the context item. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/658">658</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/662">662</a>&nbsp;29 August 2023]</i></p></li></ol></div><p> Constructor functions are used to convert a supplied value to a given type, and the name of the function is the same as the name of the target type. This section describes constructor functions corresponding to the following types:</p><ul><li><p>Simple types (atomic types, union types, and list types as defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>), which are present in the static context either because they appear in the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-is-types">in-scope schema types</a><sup><small>XP</small></sup> or because they appear as <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-named-item-type">named item types</a><sup><small>XP</small></sup>. </p><p>These constructor functions always take a single argument.</p></li><li><p>Record types defined as <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-named-item-type">named item types</a><sup><small>XP</small></sup>.</p><p>These take one argument for each named field of the record type. Constructor functions for record types are defined in <a href="#id-constructors-for-record-tests"><span style="display: none;" class="delete_version"><b>22.6 Constructor functions for named record types</b></span><span style="display: none;" class="add_version"><b>23.6 Constructor functions for named record types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.6</span><span class="deltaxml-new" style="background:#90EE90">23.6</span> Constructor functions for named record types</b></span></a>. </p></li></ul><p> Constructor functions are defined for all user-defined named simple types, and for most built-in atomic, list, and union types. The only named simple types that have no constructor function are those that have no instances other than instances of their derived types: specifically, <code>xs:anySimpleType</code>, <code>xs:anyAtomicType</code>, and <code>xs:NOTATION</code>. </p><div class="div2"><h3><a id="constructor-functions-for-xsd-types"></a><span class="deltaxml-old" style="background:#FF5555">22.1</span><span class="deltaxml-new" style="background:#90EE90">23.1</span> <a href="#constructor-functions-for-xsd-types" style="text-decoration: none">Constructor functions for XML Schema built-in atomic types</a></h3><p>Every built-in atomic type that is defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, except <code>xs:anyAtomicType</code> and <code>xs:NOTATION</code>, has an associated constructor function. The type <code>xs:untypedAtomic</code>, defined in <a href="https://www.w3.org/TR/xpath-datamodel-31/#types"> 2.7 Schema Information </a><sup><small>DM31</small></sup> and the two derived types <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code> defined in <a href="https://www.w3.org/TR/xpath-datamodel-31/#types"> 2.7 Schema Information </a><sup><small>DM31</small></sup> also have associated constructor functions. Implementations <span class="verb">may</span> additionally provide a constructor functions for the datatype <code>xs:dateTimeStamp</code> introduced in <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a>.</p><p><span style="display: none;" class="delete_version"> A constructor function is not defined for <code>xs:anyAtomicType</code> as there are no atomic items with type annotation <code>xs:anyAtomicType</code> at runtime, although this can be a statically inferred type. A constructor function is not defined for <code>xs:NOTATION</code> since it is defined as an abstract type in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>. If the static context (See <a href="https://www.w3.org/TR/xpath-31/#static_context"> 2.1.1 Static Context </a><sup><small>XP31</small></sup>) contains a type derived from <code>xs:NOTATION</code> then a constructor function is defined for it. See <a href="#constructor-functions-for-user-defined-types"><span class="delete_version"><b>22.5 Constructor functions for user-defined atomic and union types</b></span><span class="modify_version"><b>22.5 Constructor functions for user-defined atomic and union types</b></span></a>. </span><span style="display: none;" class="add_version"> A constructor function is not defined for <code>xs:anyAtomicType</code> as there are no atomic items with type annotation <code>xs:anyAtomicType</code> at runtime, although this can be a statically inferred type. A constructor function is not defined for <code>xs:NOTATION</code> since it is defined as an abstract type in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>. If the static context (See <a href="https://www.w3.org/TR/xpath-31/#static_context"> 2.1.1 Static Context </a><sup><small>XP31</small></sup>) contains a type derived from <code>xs:NOTATION</code> then a constructor function is defined for it. See <a href="#constructor-functions-for-user-defined-types"><span class="add_version"><b>23.5 Constructor functions for user-defined atomic and union types</b></span><span class="modify_version"><b>23.5 Constructor functions for user-defined atomic and union types</b></span></a>. </span><span class="modify_version"> A constructor function is not defined for <code>xs:anyAtomicType</code> as there are no atomic items with type annotation <code>xs:anyAtomicType</code> at runtime, although this can be a statically inferred type. A constructor function is not defined for <code>xs:NOTATION</code> since it is defined as an abstract type in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>. If the static context (See <a href="https://www.w3.org/TR/xpath-31/#static_context"> 2.1.1 Static Context </a><sup><small>XP31</small></sup>) contains a type derived from <code>xs:NOTATION</code> then a constructor function is defined for it. See <a href="#constructor-functions-for-user-defined-types"><span style="display: none;" class="delete_version"><b>22.5 Constructor functions for user-defined atomic and union types</b></span><span style="display: none;" class="add_version"><b>23.5 Constructor functions for user-defined atomic and union types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.5</span><span class="deltaxml-new" style="background:#90EE90">23.5</span> Constructor functions for user-defined atomic and union types</b></span></a>. </span></p><p> The form of the constructor function for an atomic type <em>eg:TYPE</em> is:</p><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">eg:TYPE</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>eg:TYPE</code>?</code></td></tr></tbody></table></div><p>If <code>$arg</code> is the empty sequence, the empty sequence is returned. For example, the signature of the constructor function corresponding to the <code>xs:unsignedInt</code> type defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> is:</p><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:unsignedInt</code>(</td></tr><tr class="arg"><td><code>$arg</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:unsignedInt</code>?</code></td></tr></tbody></table></div><p>Calling the constructor function <code>xs:unsignedInt(12)</code> returns the <code> xs:unsignedInt</code> value 12. Another call of that constructor function that returns the same <code>xs:unsignedInt</code> value is <code>xs:unsignedInt("12")</code>.</p><p>The same result would also be returned if the constructor function were to be called with a node that had a typed value equal to the <code>xs:unsignedInt</code> 12. Because the declared parameter type for the argument is <code>xs:anyAtomicType?</code>, the coercion rules will atomize the supplied argument (see <a href="https://www.w3.org/TR/xpath-31/#id-atomization"> 2.4.2 Atomization </a><sup><small>XP31</small></sup>) to extract its typed value and then call the constructor with the atomized value.</p><p>If the value passed to a constructor function, after atomization, is not in the lexical space of the datatype to be constructed, and cannot be converted to a value in the value space of the datatype under the rules in <a href="#casting"><span style="display: none;" class="delete_version"><b>23 Casting</b></span><span style="display: none;" class="add_version"><b>24 Casting</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23</span><span class="deltaxml-new" style="background:#90EE90">24</span> Casting</b></span></a>, then an dynamic error is raised [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>].</p><p><span style="display: none;" class="delete_version">The semantics of the constructor function <code>xs:TYPE(arg)</code> are identical to the semantics of <code>arg</code> cast as <code>xs:TYPE?</code> . See <a href="#casting"><span class="delete_version"><b>23 Casting</b></span><span class="modify_version"><b>23 Casting</b></span></a>.</span><span style="display: none;" class="add_version">The semantics of the constructor function <code>xs:TYPE(arg)</code> are identical to the semantics of <code>arg</code> cast as <code>xs:TYPE?</code> . See <a href="#casting"><span class="add_version"><b>24 Casting</b></span><span class="modify_version"><b>24 Casting</b></span></a>.</span><span class="modify_version">The semantics of the constructor function <code>xs:TYPE(arg)</code> are identical to the semantics of <code>arg</code> cast as <code>xs:TYPE?</code> . See <a href="#casting"><span style="display: none;" class="delete_version"><b>23 Casting</b></span><span style="display: none;" class="add_version"><b>24 Casting</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23</span><span class="deltaxml-new" style="background:#90EE90">24</span> Casting</b></span></a>.</span></p><p>If the argument to a constructor function is a literal, the result of the function <span class="verb">may</span> be evaluated statically; if an error is found during such evaluation, it may be reported as a static error. </p><p><span style="display: none;" class="delete_version">Special rules apply to constructor functions for <code>xs:QName</code> and types derived from <code>xs:QName</code> and <code>xs:NOTATION</code>. See <a href="#constructor-qname-notation"><span class="delete_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span></a>. </span><span style="display: none;" class="add_version">Special rules apply to constructor functions for <code>xs:QName</code> and types derived from <code>xs:QName</code> and <code>xs:NOTATION</code>. See <a href="#constructor-qname-notation"><span class="add_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span></a>. </span><span class="modify_version">Special rules apply to constructor functions for <code>xs:QName</code> and types derived from <code>xs:QName</code> and <code>xs:NOTATION</code>. See <a href="#constructor-qname-notation"><span style="display: none;" class="delete_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span style="display: none;" class="add_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.2</span><span class="deltaxml-new" style="background:#90EE90">23.2</span> Constructor functions for xs:QName and xs:NOTATION</b></span></a>. </span></p><p>The argument is optional, and defaults to the context value (which will be atomized if necessary).</p><p>The following constructor functions for the built-in atomic types are supported:</p><ul><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:string</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:string</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:boolean</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:boolean</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:decimal</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:decimal</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:float</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:float</code>?</code></td></tr></tbody></table></div><p>Implementations <span class="verb">should</span> return negative zero for <code>xs:float("-0.0E0")</code>. But because <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> does not distinguish between the values positive zero and negative zero, implementations <span class="verb">may</span> return positive zero in this case.</p></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:double</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:double</code>?</code></td></tr></tbody></table></div><p>Implementations <span class="verb">should</span> return negative zero for <code>xs:double("-0.0E0")</code>. But because <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> does not distinguish between the values positive zero and negative zero, implementations <span class="verb">may</span> return positive zero in this case.</p></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:duration</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:duration</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:dateTime</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTime</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:time</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:time</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:date</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:date</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:gYearMonth</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:gYearMonth</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:gYear</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:gYear</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:gMonthDay</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:gMonthDay</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:gDay</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:gDay</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:gMonth</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:gMonth</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:hexBinary</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:hexBinary</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:base64Binary</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:base64Binary</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:anyURI</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:anyURI</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:QName</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:QName</code>?</code></td></tr></tbody></table></div><p> See <a href="#constructor-qname-notation"><span style="display: none;" class="delete_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span style="display: none;" class="add_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.2</span><span class="deltaxml-new" style="background:#90EE90">23.2</span> Constructor functions for xs:QName and xs:NOTATION</b></span></a> for special rules.</p></li></ul><ul><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:normalizedString</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:normalizedString</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:token</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:token</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:language</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:language</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:NMTOKEN</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:NMTOKEN</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:Name</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:Name</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:NCName</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:NCName</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:ID</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:ID</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:IDREF</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:IDREF</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:ENTITY</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:ENTITY</code>?</code></td></tr></tbody></table></div><p><span style="display: none;" class="delete_version">See <a href="#casting-to-ENTITY"><span class="delete_version"><b>23.1.10 Casting to xs:ENTITY</b></span><span class="modify_version"><b>23.1.10 Casting to xs:ENTITY</b></span></a> for rules related to constructing values of type <code>xs:ENTITY</code> and types derived from it.</span><span style="display: none;" class="add_version">See <a href="#casting-to-ENTITY"><span class="add_version"><b>24.1.10 Casting to xs:ENTITY</b></span><span class="modify_version"><b>24.1.10 Casting to xs:ENTITY</b></span></a> for rules related to constructing values of type <code>xs:ENTITY</code> and types derived from it.</span><span class="modify_version">See <a href="#casting-to-ENTITY"><span style="display: none;" class="delete_version"><b>23.1.10 Casting to xs:ENTITY</b></span><span style="display: none;" class="add_version"><b>24.1.10 Casting to xs:ENTITY</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.10</span><span class="deltaxml-new" style="background:#90EE90">24.1.10</span> Casting to xs:ENTITY</b></span></a> for rules related to constructing values of type <code>xs:ENTITY</code> and types derived from it.</span></p></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:integer</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:integer</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:nonPositiveInteger</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:nonPositiveInteger</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:negativeInteger</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:negativeInteger</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:long</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:long</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:int</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:int</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:short</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:short</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:byte</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:byte</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:nonNegativeInteger</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:nonNegativeInteger</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:unsignedLong</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:unsignedLong</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:unsignedInt</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:unsignedInt</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:unsignedShort</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:unsignedShort</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:unsignedByte</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:unsignedByte</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:positiveInteger</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:positiveInteger</code>?</code></td></tr></tbody></table></div></li></ul><ul><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:yearMonthDuration</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:yearMonthDuration</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:dayTimeDuration</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dayTimeDuration</code>?</code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:untypedAtomic</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:untypedAtomic</code>?</code></td></tr></tbody></table></div></li></ul><ul><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:dateTimeStamp</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:dateTimeStamp</code>?</code></td></tr></tbody></table></div><p><em>Available only if the implementation supports XSD 1.1.</em></p></li></ul></div><div class="div2"><h3><a id="constructor-qname-notation"></a><span class="deltaxml-old" style="background:#FF5555">22.2</span><span class="deltaxml-new" style="background:#90EE90">23.2</span> <a href="#constructor-qname-notation" style="text-decoration: none">Constructor functions for xs:QName and xs:NOTATION</a></h3><p>Special rules apply to constructor functions for the types <code>xs:QName</code> and <code>xs:NOTATION</code>, for two reasons:</p><ul><li><p> Values cannot belong directly to the type <code>xs:NOTATION</code>, only to its subtypes. </p></li><li><p> The lexical representation of these types uses namespace prefixes, whose meaning is context-dependent.</p></li></ul><p> These constraints result in the following rules:</p><ol class="enumar"><li><p> There is no constructor function for <code>xs:NOTATION</code>. Constructors are defined, however, for <code>xs:QName</code>, for types derived or constructed from <code>xs:QName</code>, and for types derived or constructed from <code>xs:NOTATION</code>. </p></li><li><p>When converting from an <code>xs:string</code>, the prefix within the lexical <code>xs:QName</code> supplied as the argument is resolved to a namespace URI using the statically known namespaces from the static context. If the lexical <code>xs:QName</code> has no prefix, the namespace URI of the resulting expanded-QName is the default namespace for elements and types, taken from the static context. Components of the static context are defined in <a href="https://www.w3.org/TR/xpath-31/#static_context"> 2.1.1 Static Context </a><sup><small>XP31</small></sup>. A dynamic error is raised [<a href="#ERRFONS0004" title="err:FONS0004">err:FONS0004</a>] if the prefix is not bound in the static context. As described in <a href="https://www.w3.org/TR/xpath-datamodel-31/#terminology"> 2.1 Terminology </a><sup><small>DM31</small></sup>, the supplied prefix is retained as part of the expanded-QName value.</p></li></ol><p>When a constructor function for a namespace-sensitive type is used as a literal function item or in a partial function application (for example, <code>xs:QName#1</code> or <code>xs:QName(?)</code>) the namespace bindings that are relevant are those from the static context of the literal function item or partial function application. When a constructor function for a namespace-sensitive type is obtained by means of the <a href="#func-function-lookup"><code>fn:function-lookup</code></a> function, the relevant namespace bindings are those from the static context of the call on <a href="#func-function-lookup"><code>fn:function-lookup</code></a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>When the supplied argument to the <code>xs:QName</code> constructor function is a node, the node is atomized in the usual way, and if the result is <code>xs:untypedAtomic</code> it is then converted as if a string had been supplied. The effect might not be what is desired. For example, given the attribute <code>xsi:type="my:type"</code>, the expression <code>xs:QName(@xsi:type)</code> might fail on the grounds that the prefix <code>my</code> is undeclared. This is because the namespace bindings are taken from the static context (that is, from the query or stylesheet), and not from the source document containing the <code>@xsi:type</code> attribute. The solution to this problem is to use the function call <code>resolve-QName(@xsi:type, .)</code> instead.</p></div></div><div class="div2"><h3><a id="constructor-functions-for-xsd-list-types"></a><span class="deltaxml-old" style="background:#FF5555">22.3</span><span class="deltaxml-new" style="background:#90EE90">23.3</span> <a href="#constructor-functions-for-xsd-list-types" style="text-decoration: none">Constructor functions for XML Schema built-in list types</a></h3><p>Each of the three built-in list types defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, namely <code>xs:NMTOKENS</code>, <code>xs:ENTITIES</code>, and <code>xs:IDREFS</code>, has an associated constructor function.</p><p>The function signatures are as follows:</p><ul><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:NMTOKENS</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:NMTOKEN*</code></code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:ENTITIES</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:ENTITY*</code></code></td></tr></tbody></table></div></li><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:IDREFS</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:string?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:IDREF*</code></code></td></tr></tbody></table></div></li></ul><p>The semantics are equivalent to casting to the corresponding types from <code>xs:string</code>.</p><p>All three of these types have the facet <code>minLength = 1</code> meaning that there must always be at least one item in the list. The return type, however, allows for the fact that when the argument to the function is the empty sequence, the result is the empty sequence.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>In the case of atomic types, it is possible to use an expression such as <code>xs:date(@date-of-birth)</code> to convert an attribute value to an instance of <code>xs:date</code>, knowing that this will work both in the case where the attribute is already annotated as <code>xs:date</code>, and also in the case where it is <code>xs:untypedAtomic</code>. This approach does not work with list types, because it is not permitted to use a value of type <code>xs:NMTOKEN*</code> as input to the constructor function <code>xs:NMTOKENS</code>. Instead, it is necessary to use conditional logic that performs the conversion only in the case where the input is untyped: <code>if (@x instance of attribute(*, xs:untypedAtomic)) then xs:NMTOKENS(@x) else data(@x)</code></p></div></div><div class="div2"><h3><a id="constructor-functions-for-xsd-union-types"></a><span class="deltaxml-old" style="background:#FF5555">22.4</span><span class="deltaxml-new" style="background:#90EE90">23.4</span> <a href="#constructor-functions-for-xsd-union-types" style="text-decoration: none">Constructor functions for XML Schema built-in union types</a></h3><p>There is a constructor function for the union type <code>xs:numeric</code> defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. The function signature is:</p><ul><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:numeric</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:numeric?</code></code></td></tr></tbody></table></div></li></ul><p>The semantics are determined by the rules in <a href="#casting-to-union"><span style="display: none;" class="delete_version"><b>23.3.7 Casting to union types</b></span><span style="display: none;" class="add_version"><b>24.3.7 Casting to union types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.7</span><span class="deltaxml-new" style="background:#90EE90">24.3.7</span> Casting to union types</b></span></a>. These rules have the effect that: </p><ol class="enumar"><li><p>If the argument is an instance of <code>xs:double</code>, <code>xs:float</code>, or <code>xs:decimal</code>, then the result is an instance of the same primitive type, with the same value;</p></li><li><p>If the argument is an instance of <code>xs:boolean</code>, the result is the <code>xs:double</code> value <code>0.0e0</code> or <code>1.0e0</code>;</p></li><li><p>If the argument is an instance of <code>xs:string</code> or <code>xs:untypedAtomic</code>, then:</p><ol class="enumla"><li><p>If the value is in the lexical space of <code>xs:double</code>, the result will be the corresponding <code>xs:double</code> value;</p></li><li><p>Otherwise, a dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>] occurs;</p></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>The result will never be an instance of <code>xs:float</code>, <code>xs:decimal</code>, or <code>xs:integer</code>. This is because <code>xs:double</code> appears first in the list of member types of <code>xs:numeric</code>, and its lexical space subsumes the lexical space of the other numeric types. Thus, unlike XPath numeric literals, the result does not depend on the lexical form of the supplied value. The reason for this design choice is to retain compatibility with the function conversion rules: functions such as <a href="#func-abs"><code>fn:abs</code></a> and <a href="#func-round"><code>fn:round</code></a> are declared to expect an instance of <code>xs:numeric</code> as their first or only argument, and compatibility with the function conversion rules defined in earlier versions of these specifications demands that when an untyped atomic item (or untyped node) is supplied as the argument, it is converted to an <code>xs:double</code> value even if its lexical form is that (say) of an integer.</p></div></li><li><p>In all other cases, a dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>] occurs.</p></li></ol><p>In the case of an implementation that supports XSD 1.1, there is a constructor function associated with the built-in union type <code>xs:error</code>.</p><p>The function signature is as follows:</p><ul><li><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">xs:error</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType?</code></code></td><td><code class="assign">:=&nbsp;</code><code>.</code></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>xs:error?</code></code></td></tr></tbody></table></div></li></ul><p>The semantics are equivalent to casting to the corresponding union type (see <a href="#casting-to-union"><span style="display: none;" class="delete_version"><b>23.3.7 Casting to union types</b></span><span style="display: none;" class="add_version"><b>24.3.7 Casting to union types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.7</span><span class="deltaxml-new" style="background:#90EE90">24.3.7</span> Casting to union types</b></span></a>).</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Because <code>xs:error</code> has no member types, and therefore has an empty value space, casting will always fail with a dynamic error except in the case where the supplied argument is the empty sequence, in which case the result is also the empty sequence.</p></div></div><div class="div2"><h3><a id="constructor-functions-for-user-defined-types"></a><span class="deltaxml-old" style="background:#FF5555">22.5</span><span class="deltaxml-new" style="background:#90EE90">23.5</span> <a href="#constructor-functions-for-user-defined-types" style="text-decoration: none">Constructor functions for user-defined atomic and union types</a></h3><p>For every <span>named</span> user-defined simple type in the static context (See <a href="https://www.w3.org/TR/xpath-31/#static_context"> 2.1.1 Static Context </a><sup><small>XP31</small></sup>), there is a constructor function whose name is the same as the name of the type.</p><p><span style="display: none;" class="delete_version">For named atomic types, the rules are the same as the rules for constructing built-in derived atomic types defined in <a href="#constructor-functions-for-xsd-types"><span class="delete_version"><b>22.1 Constructor functions for XML Schema built-in atomic types</b></span><span class="modify_version"><b>22.1 Constructor functions for XML Schema built-in atomic types</b></span></a>. For a named atomic type <code>T</code>, the signature of the function takes the form <code>T($value as xs:anyAtomicType? := .) as T?</code>, and the semantics are the same as casting to derived types: see <a href="#casting-to-derived-types"><span class="delete_version"><b>23.3.1 Casting to derived types</b></span><span class="modify_version"><b>23.3.1 Casting to derived types</b></span></a>..</span><span style="display: none;" class="add_version">For named atomic types, the rules are the same as the rules for constructing built-in derived atomic types defined in <a href="#constructor-functions-for-xsd-types"><span class="add_version"><b>23.1 Constructor functions for XML Schema built-in atomic types</b></span><span class="modify_version"><b>23.1 Constructor functions for XML Schema built-in atomic types</b></span></a>. For a named atomic type <code>T</code>, the signature of the function takes the form <code>T($value as xs:anyAtomicType? := .) as T?</code>, and the semantics are the same as casting to derived types: see <a href="#casting-to-derived-types"><span class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b>24.3.1 Casting to derived types</b></span></a>..</span><span class="modify_version">For named atomic types, the rules are the same as the rules for constructing built-in derived atomic types defined in <a href="#constructor-functions-for-xsd-types"><span style="display: none;" class="delete_version"><b>22.1 Constructor functions for XML Schema built-in atomic types</b></span><span style="display: none;" class="add_version"><b>23.1 Constructor functions for XML Schema built-in atomic types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.1</span><span class="deltaxml-new" style="background:#90EE90">23.1</span> Constructor functions for XML Schema built-in atomic types</b></span></a>. For a named atomic type <code>T</code>, the signature of the function takes the form <code>T($value as xs:anyAtomicType? := .) as T?</code>, and the semantics are the same as casting to derived types: see <a href="#casting-to-derived-types"><span style="display: none;" class="delete_version"><b>23.3.1 Casting to derived types</b></span><span style="display: none;" class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> Casting to derived types</b></span></a>..</span></p><p><span style="display: none;" class="delete_version">For named union types, the rules follow the same principles as the rules for constructing built-in union types defined in <a href="#constructor-functions-for-xsd-union-types"><span class="delete_version"><b>22.4 Constructor functions for XML Schema built-in union types</b></span><span class="modify_version"><b>22.4 Constructor functions for XML Schema built-in union types</b></span></a>. For a named union type <code>U</code>, the signature of the function takes the form <code>U($value as xs:anyAtomicType? := .) as U?</code>, and the semantics are the same as casting to union types: see <a href="#casting-to-union"><span class="delete_version"><b>23.3.7 Casting to union types</b></span><span class="modify_version"><b>23.3.7 Casting to union types</b></span></a>.</span><span style="display: none;" class="add_version">For named union types, the rules follow the same principles as the rules for constructing built-in union types defined in <a href="#constructor-functions-for-xsd-union-types"><span class="add_version"><b>23.4 Constructor functions for XML Schema built-in union types</b></span><span class="modify_version"><b>23.4 Constructor functions for XML Schema built-in union types</b></span></a>. For a named union type <code>U</code>, the signature of the function takes the form <code>U($value as xs:anyAtomicType? := .) as U?</code>, and the semantics are the same as casting to union types: see <a href="#casting-to-union"><span class="add_version"><b>24.3.7 Casting to union types</b></span><span class="modify_version"><b>24.3.7 Casting to union types</b></span></a>.</span><span class="modify_version">For named union types, the rules follow the same principles as the rules for constructing built-in union types defined in <a href="#constructor-functions-for-xsd-union-types"><span style="display: none;" class="delete_version"><b>22.4 Constructor functions for XML Schema built-in union types</b></span><span style="display: none;" class="add_version"><b>23.4 Constructor functions for XML Schema built-in union types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.4</span><span class="deltaxml-new" style="background:#90EE90">23.4</span> Constructor functions for XML Schema built-in union types</b></span></a>. For a named union type <code>U</code>, the signature of the function takes the form <code>U($value as xs:anyAtomicType? := .) as U?</code>, and the semantics are the same as casting to union types: see <a href="#casting-to-union"><span style="display: none;" class="delete_version"><b>23.3.7 Casting to union types</b></span><span style="display: none;" class="add_version"><b>24.3.7 Casting to union types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.7</span><span class="deltaxml-new" style="background:#90EE90">24.3.7</span> Casting to union types</b></span></a>.</span></p><p><span style="display: none;" class="delete_version">For named list types, the rules follow the same principles as the rules for constructing built-in list types defined in <a href="#constructor-functions-for-xsd-list-types"><span class="delete_version"><b>22.3 Constructor functions for XML Schema built-in list types</b></span><span class="modify_version"><b>22.3 Constructor functions for XML Schema built-in list types</b></span></a>. For a named list type <code>L</code>, where the item type of <code>L</code> is <code>I</code>, the signature of the function takes the form <code>L($value as xs:string? := .) as I*</code>, and the semantics are the same as casting to list types: see <a href="#casting-to-list"><span class="delete_version"><b>23.3.8 Casting to list types</b></span><span class="modify_version"><b>23.3.8 Casting to list types</b></span></a>.</span><span style="display: none;" class="add_version">For named list types, the rules follow the same principles as the rules for constructing built-in list types defined in <a href="#constructor-functions-for-xsd-list-types"><span class="add_version"><b>23.3 Constructor functions for XML Schema built-in list types</b></span><span class="modify_version"><b>23.3 Constructor functions for XML Schema built-in list types</b></span></a>. For a named list type <code>L</code>, where the item type of <code>L</code> is <code>I</code>, the signature of the function takes the form <code>L($value as xs:string? := .) as I*</code>, and the semantics are the same as casting to list types: see <a href="#casting-to-list"><span class="add_version"><b>24.3.8 Casting to list types</b></span><span class="modify_version"><b>24.3.8 Casting to list types</b></span></a>.</span><span class="modify_version">For named list types, the rules follow the same principles as the rules for constructing built-in list types defined in <a href="#constructor-functions-for-xsd-list-types"><span style="display: none;" class="delete_version"><b>22.3 Constructor functions for XML Schema built-in list types</b></span><span style="display: none;" class="add_version"><b>23.3 Constructor functions for XML Schema built-in list types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.3</span><span class="deltaxml-new" style="background:#90EE90">23.3</span> Constructor functions for XML Schema built-in list types</b></span></a>. For a named list type <code>L</code>, where the item type of <code>L</code> is <code>I</code>, the signature of the function takes the form <code>L($value as xs:string? := .) as I*</code>, and the semantics are the same as casting to list types: see <a href="#casting-to-list"><span style="display: none;" class="delete_version"><b>23.3.8 Casting to list types</b></span><span style="display: none;" class="add_version"><b>24.3.8 Casting to list types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.8</span><span class="deltaxml-new" style="background:#90EE90">24.3.8</span> Casting to list types</b></span></a>.</span></p><p>Constructor functions are available both for named types defined in an imported schema (that is, named simple types in the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-is-types">in-scope schema types</a><sup><small>XP</small></sup>), and for types defined by means of <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-named-item-type">named item types</a><sup><small>XP</small></sup>. Specifically, named enumeration types follow the same rules as schema types derived by restricting <code>xs:string</code>, and named local union types follow the same rules as union types defined in a schema.</p><p><span style="display: none;" class="delete_version">Special rules apply to constructor functions for namespace-sensitive types, that is, atomic types derived from <code>xs:QName</code> and <code>xs:NOTATION</code>, list types that have a namespace-sensitive item type, and union types that have a namespace-sensitive member type. See <a href="#constructor-qname-notation"><span class="delete_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span></a>.</span><span style="display: none;" class="add_version">Special rules apply to constructor functions for namespace-sensitive types, that is, atomic types derived from <code>xs:QName</code> and <code>xs:NOTATION</code>, list types that have a namespace-sensitive item type, and union types that have a namespace-sensitive member type. See <a href="#constructor-qname-notation"><span class="add_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span></a>.</span><span class="modify_version">Special rules apply to constructor functions for namespace-sensitive types, that is, atomic types derived from <code>xs:QName</code> and <code>xs:NOTATION</code>, list types that have a namespace-sensitive item type, and union types that have a namespace-sensitive member type. See <a href="#constructor-qname-notation"><span style="display: none;" class="delete_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span style="display: none;" class="add_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.2</span><span class="deltaxml-new" style="background:#90EE90">23.2</span> Constructor functions for xs:QName and xs:NOTATION</b></span></a>.</span></p><div class="example"><div class="exampleHeader"><a id="d5e84036"></a><a id="d5e89871"></a>Example: Using a Constructor Function for a User-Defined Atomic Type</div><p>Consider a situation where the static context contains an atomic type called <code>hatSize</code> defined in a schema whose target namespace is bound to the prefix <code>eg</code>. In such a case the following constructor function is available to users:</p><div class="proto"><table class="proto" border="0"><tbody><tr class="name"><td colspan="3"><code class="function">eg:hatSize</code>(</td></tr><tr class="arg"><td><code>$value</code></td><td><code class="as">as&nbsp;</code><code class="type"><code>xs:anyAtomicType</code></code></td><td></td></tr><tr class="return-type"><td colspan="3">)<code class="as">&nbsp;as&nbsp;</code><code><code>my:hatSize</code>?</code></td></tr></tbody></table></div><p>The resulting function may be used in an expression such as <code>eg:hatSize("10½")</code>.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p> To construct an instance of a user-defined type that is not in a namespace, it is possible to use an <code>EQName</code> (for example <code>Q{}hatsize(17)</code>). Alternatives are to use a cast expression (<code>17 cast as hatsize</code>) or (if the host language allows it) to undeclare the default function namespace. </p></div></div><div class="div2"><h3><a id="id-constructors-for-record-tests"></a><span class="deltaxml-old" style="background:#FF5555">22.6</span><span class="deltaxml-new" style="background:#90EE90">23.6</span> <a href="#id-constructors-for-record-tests" style="text-decoration: none">Constructor functions for named record types</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#casting-from-primitive-to-primitive">next</a> | <a href="#constructor-functions">previous</a>)</p><ol><li><p> Constructor functions for named record types have been introduced. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/617">617</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/953">953</a>&nbsp;20 February 2024]</i></p></li></ol></div><p>Both XQuery 4.0 and XSLT 4.0 provide syntax to declare named record types; such a declaration implicitly adds a constructor function for values of that type to the (See <a href="https://www.w3.org/TR/xpath-31/#static_context"> 2.1.1 Static Context </a><sup><small>XP31</small></sup>).</p><p>For example, if there is a named item type with the XQuery definition:</p><div class="exampleInner"><pre xml:space="preserve">declare record my:location (
  latitude  as xs:double,
  longitude as xs:double
)</pre></div><p>then there will be a function definition equivalent to:</p><div class="exampleInner"><pre xml:space="preserve" class="small">declare function my:location (
  $latitude  as xs:double,
  $longitude as xs:double
) as my:location {
  { 'latitude': $latitude, 'longitude': $longitude }
}</pre></div><p>Equivalently using XSLT syntax, if there is a named item type with the XSLT definition:</p><div class="exampleInner"><pre xml:space="preserve">&lt;xsl:record name="my:location"
  as="record(latitude as xs:double, longitude as xs:double)"/&gt;</pre></div><p>then there will be a function definition equivalent to:</p><div class="exampleInner"><pre xml:space="preserve" class="small">&lt;xsl:function name="my:location" as="my:location"&gt;
  &lt;xsl:param name="latitude" as="xs:double"/&gt;
  &lt;xsl:param name="longitude" as="xs:double"/&gt;
  &lt;xsl:map&gt;
    &lt;xsl:map-entry key="'latitude'" select="$latitude"/&gt;
    &lt;xsl:map-entry key="'longitude'" select="$longitude"/&gt;
  &lt;/xsl:map&gt;
&lt;/xsl:function&gt;</pre></div><p>The rules defining the relationship of the function definition to the record type are given for XQuery 4.0 in <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> section <a href="../xquery-40/xquery-40.html#named-records-as-functions">5.20.2 Constructor Functions for Named Record Types</a>.</p><table class="ednote" caption="Editorial note"><tbody><tr><td style="text-align: left; vertical-align:top; width: 50%;"><b>Editorial note</b></td><td style="text-align: right; vertical-align:top; width: 50%;">&nbsp;</td></tr><tr style="text-align: left; vertical-align: top;"><td colspan="2">TODO: Add cross-reference to XSLT here. Anticipates resolution of issue #1485. </td></tr></tbody></table></div></div><div class="div1"><h2><a id="casting"></a><span class="deltaxml-old" style="background:#FF5555">23</span><span class="deltaxml-new" style="background:#90EE90">24</span> <a href="#casting" style="text-decoration: none">Casting</a></h2><p> Constructor functions and cast expressions accept an expression and return a value of a given type. They both convert a source value <var>SV</var>, of a source type, <var>ST</var> to a target value <var>TV</var>, of the given target type <var>TT</var>.</p><p><span style="display: none;" class="delete_version">Constructor functions and cast expressions have identical semantics but different syntax. The name of the constructor function is the same as the name of the built-in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> datatype or the datatype defined in <a href="https://www.w3.org/TR/xpath-datamodel-31/#types"> 2.7 Schema Information </a><sup><small>DM31</small></sup> of <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> (see <a href="#constructor-functions-for-xsd-types"><span class="delete_version"><b>22.1 Constructor functions for XML Schema built-in atomic types</b></span><span class="modify_version"><b>22.1 Constructor functions for XML Schema built-in atomic types</b></span></a>) or the user-derived datatype (see <a href="#constructor-functions-for-user-defined-types"><span class="delete_version"><b>22.5 Constructor functions for user-defined atomic and union types</b></span><span class="modify_version"><b>22.5 Constructor functions for user-defined atomic and union types</b></span></a>) that is the target for the conversion, and the semantics are exactly the same as for a cast expression; for example, <code>xs:date("2003-01-01")</code> means exactly the same as <code>"2003-01-01"</code> cast as <code>xs:date?</code>.</span><span style="display: none;" class="add_version">Constructor functions and cast expressions have identical semantics but different syntax. The name of the constructor function is the same as the name of the built-in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> datatype or the datatype defined in <a href="https://www.w3.org/TR/xpath-datamodel-31/#types"> 2.7 Schema Information </a><sup><small>DM31</small></sup> of <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> (see <a href="#constructor-functions-for-xsd-types"><span class="add_version"><b>23.1 Constructor functions for XML Schema built-in atomic types</b></span><span class="modify_version"><b>23.1 Constructor functions for XML Schema built-in atomic types</b></span></a>) or the user-derived datatype (see <a href="#constructor-functions-for-user-defined-types"><span class="add_version"><b>23.5 Constructor functions for user-defined atomic and union types</b></span><span class="modify_version"><b>23.5 Constructor functions for user-defined atomic and union types</b></span></a>) that is the target for the conversion, and the semantics are exactly the same as for a cast expression; for example, <code>xs:date("2003-01-01")</code> means exactly the same as <code>"2003-01-01"</code> cast as <code>xs:date?</code>.</span><span class="modify_version">Constructor functions and cast expressions have identical semantics but different syntax. The name of the constructor function is the same as the name of the built-in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> datatype or the datatype defined in <a href="https://www.w3.org/TR/xpath-datamodel-31/#types"> 2.7 Schema Information </a><sup><small>DM31</small></sup> of <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> (see <a href="#constructor-functions-for-xsd-types"><span style="display: none;" class="delete_version"><b>22.1 Constructor functions for XML Schema built-in atomic types</b></span><span style="display: none;" class="add_version"><b>23.1 Constructor functions for XML Schema built-in atomic types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.1</span><span class="deltaxml-new" style="background:#90EE90">23.1</span> Constructor functions for XML Schema built-in atomic types</b></span></a>) or the user-derived datatype (see <a href="#constructor-functions-for-user-defined-types"><span style="display: none;" class="delete_version"><b>22.5 Constructor functions for user-defined atomic and union types</b></span><span style="display: none;" class="add_version"><b>23.5 Constructor functions for user-defined atomic and union types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.5</span><span class="deltaxml-new" style="background:#90EE90">23.5</span> Constructor functions for user-defined atomic and union types</b></span></a>) that is the target for the conversion, and the semantics are exactly the same as for a cast expression; for example, <code>xs:date("2003-01-01")</code> means exactly the same as <code>"2003-01-01"</code> cast as <code>xs:date?</code>.</span></p><p>The cast expression takes a type name to indicate the target type of the conversion. See <a href="https://www.w3.org/TR/xpath-31/#id-cast"> 3.14.2 Cast </a><sup><small>XP31</small></sup>. If the type name allows the empty sequence and the expression to be cast is the empty sequence, the empty sequence is returned. If the type name does not allow the empty sequence and the expression to be cast is the empty sequence, a type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p><p>Where the argument to a cast is a literal, the result of the function <span class="verb">may</span> be evaluated statically; if an error is encountered during such evaluation, it <span class="verb">may</span> be reported as a static error. </p><p><span style="display: none;" class="delete_version">The general rules for casting from primitive types to primitive types are defined in <a href="#casting-from-primitive-to-primitive"><span class="delete_version"><b>23.1 Casting from primitive types to primitive types</b></span><span class="modify_version"><b>23.1 Casting from primitive types to primitive types</b></span></a>, and subsections describe the rules for specific target types. The general rules for casting from <code>xs:string</code> (and <code>xs:untypedAtomic</code>) follow in <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. Casting to non-primitive types, including atomic types derived by restriction, union types, and list types, is described in <a href="#casting-non-primitive-types"><span class="delete_version"><b>23.3 Casting involving non-primitive types</b></span><span class="modify_version"><b>23.3 Casting involving non-primitive types</b></span></a>. Casting from derived types is defined in <a href="#casting-from-derived-to-parent"><span class="delete_version"><b>23.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b>23.3.4 Casting from derived types to parent types</b></span></a>, <a href="#casting-within-branch"><span class="delete_version"><b>23.3.5 Casting within a branch of the type hierarchy</b></span><span class="modify_version"><b>23.3.5 Casting within a branch of the type hierarchy</b></span></a> and <a href="#casting-across-hierarchy"><span class="delete_version"><b>23.3.6 Casting across the type hierarchy</b></span><span class="modify_version"><b>23.3.6 Casting across the type hierarchy</b></span></a>.</span><span style="display: none;" class="add_version">The general rules for casting from primitive types to primitive types are defined in <a href="#casting-from-primitive-to-primitive"><span class="add_version"><b>24.1 Casting from primitive types to primitive types</b></span><span class="modify_version"><b>24.1 Casting from primitive types to primitive types</b></span></a>, and subsections describe the rules for specific target types. The general rules for casting from <code>xs:string</code> (and <code>xs:untypedAtomic</code>) follow in <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. Casting to non-primitive types, including atomic types derived by restriction, union types, and list types, is described in <a href="#casting-non-primitive-types"><span class="add_version"><b>24.3 Casting involving non-primitive types</b></span><span class="modify_version"><b>24.3 Casting involving non-primitive types</b></span></a>. Casting from derived types is defined in <a href="#casting-from-derived-to-parent"><span class="add_version"><b>24.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b>24.3.4 Casting from derived types to parent types</b></span></a>, <a href="#casting-within-branch"><span class="add_version"><b>24.3.5 Casting within a branch of the type hierarchy</b></span><span class="modify_version"><b>24.3.5 Casting within a branch of the type hierarchy</b></span></a> and <a href="#casting-across-hierarchy"><span class="add_version"><b>24.3.6 Casting across the type hierarchy</b></span><span class="modify_version"><b>24.3.6 Casting across the type hierarchy</b></span></a>.</span><span class="modify_version">The general rules for casting from primitive types to primitive types are defined in <a href="#casting-from-primitive-to-primitive"><span style="display: none;" class="delete_version"><b>23.1 Casting from primitive types to primitive types</b></span><span style="display: none;" class="add_version"><b>24.1 Casting from primitive types to primitive types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1</span><span class="deltaxml-new" style="background:#90EE90">24.1</span> Casting from primitive types to primitive types</b></span></a>, and subsections describe the rules for specific target types. The general rules for casting from <code>xs:string</code> (and <code>xs:untypedAtomic</code>) follow in <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. Casting to non-primitive types, including atomic types derived by restriction, union types, and list types, is described in <a href="#casting-non-primitive-types"><span style="display: none;" class="delete_version"><b>23.3 Casting involving non-primitive types</b></span><span style="display: none;" class="add_version"><b>24.3 Casting involving non-primitive types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3</span><span class="deltaxml-new" style="background:#90EE90">24.3</span> Casting involving non-primitive types</b></span></a>. Casting from derived types is defined in <a href="#casting-from-derived-to-parent"><span style="display: none;" class="delete_version"><b>23.3.4 Casting from derived types to parent types</b></span><span style="display: none;" class="add_version"><b>24.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.4</span><span class="deltaxml-new" style="background:#90EE90">24.3.4</span> Casting from derived types to parent types</b></span></a>, <a href="#casting-within-branch"><span style="display: none;" class="delete_version"><b>23.3.5 Casting within a branch of the type hierarchy</b></span><span style="display: none;" class="add_version"><b>24.3.5 Casting within a branch of the type hierarchy</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.5</span><span class="deltaxml-new" style="background:#90EE90">24.3.5</span> Casting within a branch of the type hierarchy</b></span></a> and <a href="#casting-across-hierarchy"><span style="display: none;" class="delete_version"><b>23.3.6 Casting across the type hierarchy</b></span><span style="display: none;" class="add_version"><b>24.3.6 Casting across the type hierarchy</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.6</span><span class="deltaxml-new" style="background:#90EE90">24.3.6</span> Casting across the type hierarchy</b></span></a>.</span></p><p>Casting is not supported to or from <code>xs:anySimpleType</code>. Casting to <code>xs:anySimpleType</code> is not permitted and raises a static error: [<a href="https://www.w3.org/TR/xpath20/#ERRXPST0080" title="err:XPST0080">err:XPST0080</a>]<sup><small>XP</small></sup>.</p><p>Similarly, casting is not supported to or from <code>xs:anyAtomicType</code> and will raise a static error: [<a href="https://www.w3.org/TR/xpath20/#ERRXPST0080" title="err:XPST0080">err:XPST0080</a>]<sup><small>XP</small></sup>. There are no atomic items with the type annotation <code>xs:anyAtomicType</code>, although this can be a statically inferred type.</p><div class="div2"><h3><a id="casting-from-primitive-to-primitive"></a><span class="deltaxml-old" style="background:#FF5555">23.1</span><span class="deltaxml-new" style="background:#90EE90">24.1</span> <a href="#casting-from-primitive-to-primitive" style="text-decoration: none">Casting from primitive types to primitive types</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#casting-date-time-to-string">next</a> | <a href="#id-constructors-for-record-tests">previous</a>)</p><ol><li><p> This section now uses the term <b>primitive type</b> strictly to refer to the 20 atomic types that are not derived by restriction from another atomic type: that is, the 19 primitive atomic types defined in XSD, plus <code>xs:untypedAtomic</code>. The three types <code>xs:integer</code>, <code>xs:dayTimeDuration</code>, and <code>xs:yearMonthDuration</code>, which have custom casting rules but are not strictly-speaking primitive, are now handled in other subsections. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1401">1401</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1409">1409</a>]</i></p></li></ol></div><p>This section defines casting between <a title="primitive type" class="termref" href="#dt-primitive-type">primitive types</a> (specifically, the 19 primitive types defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> plus <code>xs:untypedAtomic</code>. The type conversions that are supported between primitive atomic types are indicated in the table below; casts between other (non-primitive) types are defined in terms of these primitives.</p><p>Where the target type <var>TT</var> is a primitive type, the result <var>TV</var> will always be an instance of <var>TT</var>. The result <span class="verb">may</span> also be an instance of a type derived from <var>TT</var>: for example casting an <code>xs:NCName</code><var>SV</var> to <code>xs:string</code><span class="verb">may</span> return <var>SV</var> unchanged, with its original type annotation.</p><p>In this table, there is a row for each <a title="primitive type" class="termref" href="#dt-primitive-type">primitive type</a> acting as the source of the conversion and there is a column for each <a title="primitive type" class="termref" href="#dt-primitive-type">primitive type</a> acting as the target of the conversion. The intersections of rows and columns contain one of three characters:</p><ul><li><p><code>Y</code> indicates that a conversion from values of the type to which the row applies to the type to which the column applies is supported;</p></li><li><p><code>N</code> indicates that there are no supported conversions from values of the type to which the row applies to the type to which the column applies;</p></li><li><p><code>M</code> indicates that a conversion from values of the type to which the row applies to the type to which the column applies may succeed for some values in the value space and fail for others.</p></li></ul><p><span style="display: none;" class="delete_version">There is no row or column for <code>xs:untypedAtomic</code> because the casting rules are exactly the same as for <code>xs:string</code>. When casting from <code>xs:string</code> or <code>xs:untypedAtomic</code> the semantics in <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a> apply, regardless of target type. </span><span style="display: none;" class="add_version">There is no row or column for <code>xs:untypedAtomic</code> because the casting rules are exactly the same as for <code>xs:string</code>. When casting from <code>xs:string</code> or <code>xs:untypedAtomic</code> the semantics in <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a> apply, regardless of target type. </span><span class="modify_version">There is no row or column for <code>xs:untypedAtomic</code> because the casting rules are exactly the same as for <code>xs:string</code>. When casting from <code>xs:string</code> or <code>xs:untypedAtomic</code> the semantics in <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a> apply, regardless of target type. </span></p><p><a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> defines <code>xs:NOTATION</code> as an abstract type. Thus, casting to <code>xs:NOTATION</code> from any other type including <code>xs:NOTATION</code> is not permitted and raises a static error [<a href="https://www.w3.org/TR/xpath20/#ERRXPST0080" title="err:XPST0080">err:XPST0080</a>]<sup><small>XP</small></sup>. However, casting from one subtype of <code>xs:NOTATION</code> to another subtype of <code>xs:NOTATION</code> is permitted.</p><p>Casting is not supported to or from <code>xs:anySimpleType</code>. Thus, there is no row or column for this type in the table below. For any node that has not been validated or has been validated as <code>xs:anySimpleType</code>, the typed value of the node is an atomic item of type <code>xs:untypedAtomic</code>. There are no atomic items with the type annotation <code>xs:anySimpleType</code> at runtime. Casting to <code>xs:anySimpleType</code> is not permitted and raises a static error: [<a href="https://www.w3.org/TR/xpath20/#ERRXPST0080" title="err:XPST0080">err:XPST0080</a>]<sup><small>XP</small></sup>.</p><p>Similarly, casting is not supported to or from <code>xs:anyAtomicType</code> and will raise a static error: [<a href="https://www.w3.org/TR/xpath20/#ERRXPST0080" title="err:XPST0080">err:XPST0080</a>]<sup><small>XP</small></sup>. There are no atomic items with the type annotation <code>xs:anyAtomicType</code> at runtime, although this can be a statically inferred type.</p><p>If casting is attempted from an <em>ST</em> to a <em>TT</em> for which casting is not supported, as defined in the table below, a type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p><p>In the following table, the columns and rows are identified by short codes that identify simple types as follows:</p><blockquote><p>aURI = xs:anyURI<br>b64 = xs:base64Binary<br>bool = xs:boolean<br>dat = xs:date<br>gDay = xs:gDay<br>dbl = xs:double<br>dec = xs:decimal<br>dT = xs:dateTime<br>dur = xs:duration<br>flt = xs:float<br>hxB = xs:hexBinary<br>gMD = xs:gMonthDay<br>gMon = xs:gMonth<br>NOT = xs:NOTATION<br>QN = xs:QName<br>str = xs:string<br>tim = xs:time<br>gYM = xs:gYearMonth<br>gYr = xs:gYear</p></blockquote><p>In the following table, the notation “S\T” indicates that the source (“S”) of the conversion is indicated in the column below the notation and that the target (“T”) is indicated in the row to the right of the notation.</p><table class="casting" style="border:1px solid; padding:1px"><thead><tr><th><span class="cancast" title="S\T">S\T</span></th><th><span class="cancast" title="string">str</span></th><th><span class="cancast" title="float">flt</span></th><th><span class="cancast" title="double">dbl</span></th><th><span class="cancast" title="decimal">dec</span></th><th><span class="cancast" title="duration">dur</span></th><th><span class="cancast" title="dateTime">dT</span></th><th><span class="cancast" title="time">tim</span></th><th><span class="cancast" title="date">dat</span></th><th><span class="cancast" title="gYearMonth">gYM</span></th><th><span class="cancast" title="gYear">gYr</span></th><th><span class="cancast" title="gMonthDay">gMD</span></th><th><span class="cancast" title="gDay">gDay</span></th><th><span class="cancast" title="gMonth">gMon</span></th><th><span class="cancast" title="boolean">bool</span></th><th><span class="cancast" title="base64Binary">b64</span></th><th><span class="cancast" title="hexBinary">hxB</span></th><th><span class="cancast" title="anyURI">aURI</span></th><th><span class="cancast" title="QName">QN</span></th><th><span class="cancast" title="NOTATION">NOT</span></th></tr></thead><tbody><tr><th><span class="cancast" title="string">str</span></th><td class="castY"><span class="cancast" title="Cast string to string? Yes">Y</span></td><td class="castM"><span class="cancast" title="Cast string to float? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to double? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to decimal? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to duration? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to dateTime? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to time? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to date? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to gYearMonth? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to gYear? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to gMonthDay? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to gDay? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to gMonth? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to boolean? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to base64Binary? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to hexBinary? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to anyURI? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to QName? Maybe">M</span></td><td class="castM"><span class="cancast" title="Cast string to NOTATION? Maybe">M</span></td></tr><tr><th><span class="cancast" title="float">flt</span></th><td class="castY"><span class="cancast" title="Cast float to string? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast float to float? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast float to double? Yes">Y</span></td><td class="castM"><span class="cancast" title="Cast float to decimal? Maybe">M</span></td><td class="castN"><span class="cancast" title="Cast float to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to gMonth? No">N</span></td><td class="castY"><span class="cancast" title="Cast float to boolean? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast float to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast float to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="double">dbl</span></th><td class="castY"><span class="cancast" title="Cast double to string? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast double to float? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast double to double? Yes">Y</span></td><td class="castM"><span class="cancast" title="Cast double to decimal? Maybe">M</span></td><td class="castN"><span class="cancast" title="Cast double to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to gMonth? No">N</span></td><td class="castY"><span class="cancast" title="Cast double to boolean? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast double to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast double to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="decimal">dec</span></th><td class="castY"><span class="cancast" title="Cast decimal to string? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast decimal to float? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast decimal to double? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast decimal to decimal? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast decimal to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to gMonth? No">N</span></td><td class="castY"><span class="cancast" title="Cast decimal to boolean? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast decimal to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast decimal to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="duration">dur</span></th><td class="castY"><span class="cancast" title="Cast duration to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast duration to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to decimal? No">N</span></td><td class="castY"><span class="cancast" title="Cast duration to duration? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast duration to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast duration to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="dateTime">dT</span></th><td class="castY"><span class="cancast" title="Cast dateTime to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast dateTime to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast dateTime to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast dateTime to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast dateTime to duration? No">N</span></td><td class="castY"><span class="cancast" title="Cast dateTime to dateTime? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast dateTime to time? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast dateTime to date? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast dateTime to gYearMonth? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast dateTime to gYear? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast dateTime to gMonthDay? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast dateTime to gDay? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast dateTime to gMonth? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast dateTime to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast dateTime to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast dateTime to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast dateTime to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast dateTime to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast dateTime to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="time">tim</span></th><td class="castY"><span class="cancast" title="Cast time to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast time to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to dateTime? No">N</span></td><td class="castY"><span class="cancast" title="Cast time to time? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast time to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast time to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="date">dat</span></th><td class="castY"><span class="cancast" title="Cast date to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast date to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast date to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast date to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast date to duration? No">N</span></td><td class="castY"><span class="cancast" title="Cast date to dateTime? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast date to time? No">N</span></td><td class="castY"><span class="cancast" title="Cast date to date? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast date to gYearMonth? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast date to gYear? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast date to gMonthDay? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast date to gDay? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast date to gMonth? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast date to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast date to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast date to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast date to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast date to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast date to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="gYearMonth">gYM</span></th><td class="castY"><span class="cancast" title="Cast gYearMonth to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to date? No">N</span></td><td class="castY"><span class="cancast" title="Cast gYearMonth to gYearMonth? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYearMonth to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="gYear">gYr</span></th><td class="castY"><span class="cancast" title="Cast gYear to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gYear to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to gYearMonth? No">N</span></td><td class="castY"><span class="cancast" title="Cast gYear to gYear? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gYear to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast gYear to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="gMonthDay">gMD</span></th><td class="castY"><span class="cancast" title="Cast gMonthDay to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to gYear? No">N</span></td><td class="castY"><span class="cancast" title="Cast gMonthDay to gMonthDay? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonthDay to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="gDay">gDay</span></th><td class="castY"><span class="cancast" title="Cast gDay to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gDay to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to gMonthDay? No">N</span></td><td class="castY"><span class="cancast" title="Cast gDay to gDay? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gDay to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast gDay to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="gMonth">gMon</span></th><td class="castY"><span class="cancast" title="Cast gMonth to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gMonth to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to gDay? No">N</span></td><td class="castY"><span class="cancast" title="Cast gMonth to gMonth? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast gMonth to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast gMonth to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="boolean">bool</span></th><td class="castY"><span class="cancast" title="Cast boolean to string? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast boolean to float? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast boolean to double? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast boolean to decimal? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast boolean to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to gMonth? No">N</span></td><td class="castY"><span class="cancast" title="Cast boolean to boolean? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast boolean to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast boolean to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="base64Binary">b64</span></th><td class="castY"><span class="cancast" title="Cast base64Binary to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to boolean? No">N</span></td><td class="castY"><span class="cancast" title="Cast base64Binary to base64Binary? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast base64Binary to hexBinary? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast base64Binary to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="hexBinary">hxB</span></th><td class="castY"><span class="cancast" title="Cast hexBinary to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to boolean? No">N</span></td><td class="castY"><span class="cancast" title="Cast hexBinary to base64Binary? Yes">Y</span></td><td class="castY"><span class="cancast" title="Cast hexBinary to hexBinary? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to anyURI? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast hexBinary to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="anyURI">aURI</span></th><td class="castY"><span class="cancast" title="Cast anyURI to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast anyURI to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to hexBinary? No">N</span></td><td class="castY"><span class="cancast" title="Cast anyURI to anyURI? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast anyURI to QName? No">N</span></td><td class="castN"><span class="cancast" title="Cast anyURI to NOTATION? No">N</span></td></tr><tr><th><span class="cancast" title="QName">QN</span></th><td class="castY"><span class="cancast" title="Cast QName to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast QName to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast QName to anyURI? No">N</span></td><td class="castY"><span class="cancast" title="Cast QName to QName? Yes">Y</span></td><td class="castM"><span class="cancast" title="Cast QName to NOTATION? Maybe">M</span></td></tr><tr><th><span class="cancast" title="NOTATION">NOT</span></th><td class="castY"><span class="cancast" title="Cast NOTATION to string? Yes">Y</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to float? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to double? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to decimal? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to duration? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to dateTime? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to time? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to date? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to gYearMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to gYear? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to gMonthDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to gDay? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to gMonth? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to boolean? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to base64Binary? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to hexBinary? No">N</span></td><td class="castN"><span class="cancast" title="Cast NOTATION to anyURI? No">N</span></td><td class="castY"><span class="cancast" title="Cast NOTATION to QName? Yes">Y</span></td><td class="castM"><span class="cancast" title="Cast NOTATION to NOTATION? Maybe">M</span></td></tr></tbody></table><div class="div3"><h4><a id="casting-to-untypedAtomic"></a><span class="deltaxml-old" style="background:#FF5555">23.1.1</span><span class="deltaxml-new" style="background:#90EE90">24.1.1</span> <a href="#casting-to-untypedAtomic" style="text-decoration: none">Casting to <code>xs:untypedAtomic</code></a></h4><p>Any atomic item <var>SV</var> can be cast to <code>xs:untypedAtomic</code>.</p><p><span style="display: none;" class="delete_version">The effect is the same as casting to <code>xs:string</code> (see <a href="#casting-to-string"><span class="delete_version"><b>23.1.2 Casting to xs:string</b></span><span class="modify_version"><b>23.1.2 Casting to xs:string</b></span></a>) and then returning the <code>xs:untypedAtomic</code> value comprising the same sequence of characters.</span><span style="display: none;" class="add_version">The effect is the same as casting to <code>xs:string</code> (see <a href="#casting-to-string"><span class="add_version"><b>24.1.2 Casting to xs:string</b></span><span class="modify_version"><b>24.1.2 Casting to xs:string</b></span></a>) and then returning the <code>xs:untypedAtomic</code> value comprising the same sequence of characters.</span><span class="modify_version">The effect is the same as casting to <code>xs:string</code> (see <a href="#casting-to-string"><span style="display: none;" class="delete_version"><b>23.1.2 Casting to xs:string</b></span><span style="display: none;" class="add_version"><b>24.1.2 Casting to xs:string</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.2</span> Casting to xs:string</b></span></a>) and then returning the <code>xs:untypedAtomic</code> value comprising the same sequence of characters.</span></p></div><div class="div3"><h4><a id="casting-to-string"></a><span class="deltaxml-old" style="background:#FF5555">23.1.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.2</span> <a href="#casting-to-string" style="text-decoration: none">Casting to <code>xs:string</code></a></h4><p>Any atomic item <var>SV</var> can be cast to <code>xs:string</code>.</p><p>The resulting <code>xs:string</code> value <var>TV</var> depends on the source type <var>ST</var> as follows.</p><ul><li><p>If <var>SV</var> is an instance of <code>xs:string</code>, <var>TV</var> is an instance of <code>xs:string</code> comprising the same sequence of characters as <var>SV</var>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The implementation is free to return <var>SV</var> unchanged, including its original type annotation.</p></div></li><li><p>If <var>SV</var> is an instance of <code>xs:anyURI</code>, the result <var>TV</var> is an instance of <code>xs:string</code> comprising the same sequence of characters as <var>SV</var>, but with a type annotation of <code>xs:anyURI</code>. No escaping of special characters takes place.</p></li><li><p>If <var>SV</var> is an instance of <code>xs:QName</code> or <code>xs:NOTATION</code>:</p><ul><li><p>if the qualified name has a prefix, then <var>TV</var> is the concatenation of the prefix of <var>SV</var>, a single colon (:), and the local name of <var>SV</var>.</p></li><li><p>otherwise <var>TV</var> is the local name of <var>SV</var>.</p></li></ul></li><li><p><span style="display: none;" class="delete_version">If <var>SV</var> is an instance of <code>xs:numeric</code>, the rules in <a href="#casting-numeric-to-string"><span class="delete_version"><b>23.1.2.1 Casting numeric values to xs:string</b></span><span class="modify_version"><b>23.1.2.1 Casting numeric values to xs:string</b></span></a> apply.</span><span style="display: none;" class="add_version">If <var>SV</var> is an instance of <code>xs:numeric</code>, the rules in <a href="#casting-numeric-to-string"><span class="add_version"><b>24.1.2.1 Casting numeric values to xs:string</b></span><span class="modify_version"><b>24.1.2.1 Casting numeric values to xs:string</b></span></a> apply.</span><span class="modify_version">If <var>SV</var> is an instance of <code>xs:numeric</code>, the rules in <a href="#casting-numeric-to-string"><span style="display: none;" class="delete_version"><b>23.1.2.1 Casting numeric values to xs:string</b></span><span style="display: none;" class="add_version"><b>24.1.2.1 Casting numeric values to xs:string</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.2.1</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.1</span> Casting numeric values to xs:string</b></span></a> apply.</span></p></li><li><p><span style="display: none;" class="delete_version">If <var>SV</var> is an instance of <code>xs:dateTime</code>, <code>xs:date</code> or <code>xs:time</code>, the rules in <a href="#casting-date-time-to-string"><span class="delete_version"><b>23.1.2.2 Casting date/time values to xs:string</b></span><span class="modify_version"><b>23.1.2.2 Casting date/time values to xs:string</b></span></a> apply. </span><span style="display: none;" class="add_version">If <var>SV</var> is an instance of <code>xs:dateTime</code>, <code>xs:date</code> or <code>xs:time</code>, the rules in <a href="#casting-date-time-to-string"><span class="add_version"><b>24.1.2.2 Casting date/time values to xs:string</b></span><span class="modify_version"><b>24.1.2.2 Casting date/time values to xs:string</b></span></a> apply. </span><span class="modify_version">If <var>SV</var> is an instance of <code>xs:dateTime</code>, <code>xs:date</code> or <code>xs:time</code>, the rules in <a href="#casting-date-time-to-string"><span style="display: none;" class="delete_version"><b>23.1.2.2 Casting date/time values to xs:string</b></span><span style="display: none;" class="add_version"><b>24.1.2.2 Casting date/time values to xs:string</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.2.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.2</span> Casting date/time values to xs:string</b></span></a> apply. </span></p></li><li><p><span style="display: none;" class="delete_version">If <var>ST</var> is <code>xs:duration</code>, or any subtype thereof including <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>, then the rules in <a href="#casting-duration-to-string"><span class="delete_version"><b>23.1.2.3 Casting xs:duration values to xs:string</b></span><span class="modify_version"><b>23.1.2.3 Casting xs:duration values to xs:string</b></span></a> apply.</span><span style="display: none;" class="add_version">If <var>ST</var> is <code>xs:duration</code>, or any subtype thereof including <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>, then the rules in <a href="#casting-duration-to-string"><span class="add_version"><b>24.1.2.3 Casting xs:duration values to xs:string</b></span><span class="modify_version"><b>24.1.2.3 Casting xs:duration values to xs:string</b></span></a> apply.</span><span class="modify_version">If <var>ST</var> is <code>xs:duration</code>, or any subtype thereof including <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>, then the rules in <a href="#casting-duration-to-string"><span style="display: none;" class="delete_version"><b>23.1.2.3 Casting xs:duration values to xs:string</b></span><span style="display: none;" class="add_version"><b>24.1.2.3 Casting xs:duration values to xs:string</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.2.3</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.3</span> Casting xs:duration values to xs:string</b></span></a> apply.</span></p></li><li><p>In all other cases, <var>TV</var> is the <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> canonical representation of <var>SV</var>. For datatypes that do not have a canonical representation defined an <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> canonical representation may be used.</p></li></ul><p>To cast as <code>xs:untypedAtomic</code> the value is cast as <code>xs:string</code>, as described above, and the type annotation changed to <code>xs:untypedAtomic</code>.</p><div class="div4"><h5><a id="casting-numeric-to-string"></a><span class="deltaxml-old" style="background:#FF5555">23.1.2.1</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.1</span> <a href="#casting-numeric-to-string" style="text-decoration: none">Casting numeric values to <code>xs:string</code></a></h5><p>The following rules apply when the source type <var>ST</var> is <code>xs:decimal</code>, <code>xs:double</code>, or <code>xs:float</code>, or any subtype of these including <code>xs:integer</code>.</p><ol class="enumar"><li><p>If <var>SV</var> is an instance of <code>xs:decimal</code>, then the canonical representation of <var>SV</var> is returned, as defined in <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a>. Specifically, see <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/datatypes.html#f-decimalCanmap">decimalCanonicalMap</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Unlike previous versions of this specification, no special rule is given for the case where <var>SV</var> is an instance of <code>xs:integer</code>. This is because the general rule for <code>xs:decimal</code> gives the same result. The result in this case will be a sequence of decimal digits in the range <span class="unicode-codepoint">U+0030</span> (<span class="unicode-name">DIGIT ZERO</span>, <code>0</code>) to <span class="unicode-codepoint">U+0039</span> (<span class="unicode-name">DIGIT NINE</span>, <code>9</code>) , optionally preceded by a minus sign, with no leading zeroes. For example: <code>42</code>, <code>-1</code>, <code>0</code>, or <code>1000000000</code>.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>An <code>xs:decimal</code> that is equal to an integer is converted to a string as if it were first cast to an <code>xs:integer</code>. Specifically, there will be no decimal point and no fractional part.</p><p>If the value is not equal to an integer, then there will be a decimal point and a fractional part, which will be a sequence of decimal digits with no trailing zeroes. For example: <code>42.3</code>, <code>-1.5</code>, or <code>0.00001</code>.</p></div></li><li><p> If <var>SV</var> is an instance of <code>xs:float</code> or <code>xs:double</code>, then:</p><ol class="enumla"><li><p><span style="display: none;" class="delete_version"><var>TV</var> will be an <code>xs:string</code> in the lexical space of <code>xs:double</code> or <code>xs:float</code> that when converted to an <code>xs:double</code> or <code>xs:float</code> under the rules of <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a> produces a value that is equal to <var>SV</var>, or is <code>NaN</code> if <var>SV</var> is <code>NaN</code>. In addition, <var>TV</var> must satisfy the constraints in the following sub-bullets. </span><span style="display: none;" class="add_version"><var>TV</var> will be an <code>xs:string</code> in the lexical space of <code>xs:double</code> or <code>xs:float</code> that when converted to an <code>xs:double</code> or <code>xs:float</code> under the rules of <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a> produces a value that is equal to <var>SV</var>, or is <code>NaN</code> if <var>SV</var> is <code>NaN</code>. In addition, <var>TV</var> must satisfy the constraints in the following sub-bullets. </span><span class="modify_version"><var>TV</var> will be an <code>xs:string</code> in the lexical space of <code>xs:double</code> or <code>xs:float</code> that when converted to an <code>xs:double</code> or <code>xs:float</code> under the rules of <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a> produces a value that is equal to <var>SV</var>, or is <code>NaN</code> if <var>SV</var> is <code>NaN</code>. In addition, <var>TV</var> must satisfy the constraints in the following sub-bullets. </span></p><ol class="enumlr"><li><p>If <var>SV</var> has an absolute value that is greater than or equal to 0.000001 (one millionth) and less than 1000000 (one million), then the value is converted to an <code>xs:decimal</code> and the resulting <code>xs:decimal</code> is converted to an <code>xs:string</code> according to the rules above, as though using an implementation of <code>xs:decimal</code> that imposes no limits on the <code>totalDigits</code> or <code>fractionDigits</code> facets.</p></li><li><p>If <var>SV</var> has the value positive or negative zero, <var>TV</var> is <code>"0"</code> or <code>"-0"</code> respectively.</p></li><li><p>If <var>SV</var> is positive or negative infinity, <var>TV</var> is the string <code>"INF"</code> or <code>"-INF"</code> respectively. </p></li><li><p>In other cases, the result consists of a mantissa, which has the lexical form of an <code>xs:decimal</code>, followed by the letter "E", followed by an exponent which has the lexical form of an <code>xs:integer</code>. Leading zeroes and "+" signs are prohibited in the exponent. For the mantissa, there must be a decimal point, and there must be exactly one digit before the decimal point, which must be non-zero. The "+" sign is prohibited. There must be at least one digit after the decimal point. Apart from this mandatory digit, trailing zero digits are prohibited. </p></li></ol></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>The above rules allow more than one representation of the same value. For example, the <code>xs:float</code> value whose exact decimal representation is 1.26743223E15 might be represented by any of the strings <code>"1.26743223E15"</code>, <code>"1.26743222E15"</code> or <code>"1.26743224E15"</code> (inter alia). It is implementation-dependent which of these representations is chosen.</p></div></li></ol><div class="note"><p class="prefix"><b>Note:</b></p><p>The string representations of numeric values are backwards compatible with XPath 1.0 except for the special values positive and negative infinity, negative zero and values outside the range <code>1.0e-6</code> to <code>1.0e+6</code>.</p></div></div><div class="div4"><h5><a id="casting-date-time-to-string"></a><span class="deltaxml-old" style="background:#FF5555">23.1.2.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.2</span> <a href="#casting-date-time-to-string" style="text-decoration: none">Casting date/time values to <code>xs:string</code></a></h5><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#casting-duration-to-string">next</a> | <a href="#casting-from-primitive-to-primitive">previous</a>)</p><ol><li><p> The rules for conversion of dates and times to strings are now defined entirely in terms of XSD 1.1 canonical mappings, since these deliver exactly the same result as the XPath 3.1 rules. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1401">1401</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1409">1409</a>]</i></p></li></ol></div><p>If <var>SV</var> is an instance of <code>xs:dateTime</code>, <code>xs:date</code>, <code>xs:time</code>, <code>xs:gYear</code>, <code>xs:gYearMonth</code>, <code>xs:gMonth</code>, <code>xs:gMonthDay</code>, or <code>xs:gDay</code>, then <var>TV</var> is the canonical representation of <var>SV</var> as defined in <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a>. </p><div class="note"><p class="prefix"><b>Note:</b></p><p>The result <var>TV</var> includes the original timezone if a timezone is present.</p><p>All these data types contain different combinations of the components year, month, day, hour, minute, second, and timezone; all the components relevant to the data type (with the exception of the timezone) are output, and the results are concatenated together with suitable punctuation. Specifically:</p><ol class="enumar"><li><p>The <code>year</code> component is represented as a <code>xs:string</code> of four digits, or more if needed. A leading minus sign is present for BCE years.</p></li><li><p>The <code>month</code>, <code>day</code>, <code>hour</code> and <code>minute</code> components are represented as two digits (with a leading zero if needed). For example, February is represented as <code>02</code>.</p><p>The hours component will never be <code>"24"</code>: midnight is always represented as <code>"00:00:00"</code>.</p></li><li><p>The <code>second</code> component is output using as a two-digit integer if it is a whole number (for example, <code>30</code>, <code>05</code>, or <code>00</code>), or if it is fractional, as two digits followed by a decimal point followed by as many digits as are necessary, with no trailing zeroes (for example <code>30.5</code> or <code>00.001</code>). </p></li><li><p><span style="display: none;" class="delete_version">The timezone component, if present, is cast to <code>xs:string</code> by applying the function <code>eg:convertTZtoString</code> given in <a href="#casting-to-datetimes"><span class="delete_version"><b>23.1.5 Casting to date and time types</b></span><span class="modify_version"><b>23.1.5 Casting to date and time types</b></span></a>. Examples are <code>Z</code>, <code>+01:00</code>, <code>-05:00</code>, or <code>+05:30</code>.</span><span style="display: none;" class="add_version">The timezone component, if present, is cast to <code>xs:string</code> by applying the function <code>eg:convertTZtoString</code> given in <a href="#casting-to-datetimes"><span class="add_version"><b>24.1.5 Casting to date and time types</b></span><span class="modify_version"><b>24.1.5 Casting to date and time types</b></span></a>. Examples are <code>Z</code>, <code>+01:00</code>, <code>-05:00</code>, or <code>+05:30</code>.</span><span class="modify_version">The timezone component, if present, is cast to <code>xs:string</code> by applying the function <code>eg:convertTZtoString</code> given in <a href="#casting-to-datetimes"><span style="display: none;" class="delete_version"><b>23.1.5 Casting to date and time types</b></span><span style="display: none;" class="add_version"><b>24.1.5 Casting to date and time types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.5</span><span class="deltaxml-new" style="background:#90EE90">24.1.5</span> Casting to date and time types</b></span></a>. Examples are <code>Z</code>, <code>+01:00</code>, <code>-05:00</code>, or <code>+05:30</code>.</span></p></li></ol><p>. </p></div></div><div class="div4"><h5><a id="casting-duration-to-string"></a><span class="deltaxml-old" style="background:#FF5555">23.1.2.3</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.3</span> <a href="#casting-duration-to-string" style="text-decoration: none">Casting <code>xs:duration</code> values to <code>xs:string</code></a></h5><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#casting-from-strings">next</a> | <a href="#casting-date-time-to-string">previous</a>)</p><ol><li><p> The rules for conversion of durations to strings are now defined entirely in terms of XSD 1.1 canonical mappings, since the XSD 1.1 rules deliver exactly the same result as the XPath 3.1 rules. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1401">1401</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1409">1409</a>]</i></p></li></ol></div><p>If <var>SV</var> is an instance of <code>xs:duration</code> (including its subtypes <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>), then <var>TV</var> is the canonical representation of <var>SV</var> as defined in <a href="#xmlschema11-2">[XSD 1.1 Part 2]</a>. Specifically, see <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/datatypes.html#f-durationCanMap">durationCanonicalMap</a>.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>The rules have the effect of normalizing the value so that the number of months is always less than 12, the number of hours less than 24, and the number of minutes and seconds less than 60. Zero-valued components are omitted. Fractional seconds follow the same rules as <code>xs:decimal</code>. For example, the duration <code>P15MT30H</code> is represented as <code>P1Y3M1DT6H</code>. A zero-length duration is output as <code>PT0S</code>.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p>At the time of writing, the published XSD 1.1 recommendation contains cut-and-paste errors in the definition of the <code>dayTimeDuration</code> canonical mapping. The binding of variable <var>s</var> should be to <var>dt</var>'s <code>·seconds·</code> (not <code>·months·</code>) component, and the return expression given as <code>sgn &amp; 'P' &amp; ·duYearMonthCanonicalFragmentMap·(|s|)</code> should read <code>sgn &amp; 'P' &amp; ·duDayTimeCanonicalFragmentMap·(|s|)</code></p><p>In reading these XSD formulations, be aware that <code>a &amp; b</code> represents string concatenation, while <code>|s|</code> computes the absolute value of a number.</p></div></div></div><div class="div3"><h4><a id="casting-to-numerics"></a><span class="deltaxml-old" style="background:#FF5555">23.1.3</span><span class="deltaxml-new" style="background:#90EE90">24.1.3</span> <a href="#casting-to-numerics" style="text-decoration: none">Casting to numeric types</a></h4><p><span style="display: none;" class="delete_version">This section defines the rules for casting to the primitive numeric types <code>xs:float</code>, <code>xs:double</code>, and <code>xs:decimal</code>. Rules for casting to the derived type <code>xs:integer</code> are given in <a href="#casting-to-integer"><span class="delete_version"><b>23.3.2 Casting to xs:integer</b></span><span class="modify_version"><b>23.3.2 Casting to xs:integer</b></span></a>.</span><span style="display: none;" class="add_version">This section defines the rules for casting to the primitive numeric types <code>xs:float</code>, <code>xs:double</code>, and <code>xs:decimal</code>. Rules for casting to the derived type <code>xs:integer</code> are given in <a href="#casting-to-integer"><span class="add_version"><b>24.3.2 Casting to xs:integer</b></span><span class="modify_version"><b>24.3.2 Casting to xs:integer</b></span></a>.</span><span class="modify_version">This section defines the rules for casting to the primitive numeric types <code>xs:float</code>, <code>xs:double</code>, and <code>xs:decimal</code>. Rules for casting to the derived type <code>xs:integer</code> are given in <a href="#casting-to-integer"><span style="display: none;" class="delete_version"><b>23.3.2 Casting to xs:integer</b></span><span style="display: none;" class="add_version"><b>24.3.2 Casting to xs:integer</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.2</span><span class="deltaxml-new" style="background:#90EE90">24.3.2</span> Casting to xs:integer</b></span></a>.</span></p><div class="div4"><h5><a id="casting-to-float"></a><span class="deltaxml-old" style="background:#FF5555">23.1.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.1.3.1</span> <a href="#casting-to-float" style="text-decoration: none">Casting to xs:float</a></h5><p>When a value of any simple type is cast as <code>xs:float</code>, the <code>xs:float</code><var>TV</var> is derived from the <var>ST</var> and the <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:float</code>, then <var>TV</var> is <var>SV</var> and the conversion is complete.</p></li><li><p>If <var>ST</var> is <code>xs:double</code>, then <var>TV</var> is obtained as follows: </p><ul><li><p>if <var>SV</var> is the <code>xs:double</code> value <code>INF</code>, <code>-INF</code>, <code>NaN</code>, positive zero, or negative zero, then <var>TV</var> is the <code>xs:float</code> value <code>INF</code>, <code>-INF</code>, <code>NaN</code>, positive zero, or negative zero respectively.</p></li><li><p>otherwise, <var>SV</var> can be expressed in the form <code>m × 2^e</code> where the mantissa <code>m</code> and exponent <code>e</code> are signed <code>xs:integer</code>s whose value range is defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, and the following rules apply:</p><ul><li><p>if <code>m</code> (the mantissa of <var>SV</var>) is outside the permitted range for the mantissa of an <code>xs:float</code> value <code>(-2^24-1 to +2^24-1)</code>, then it is divided by <code>2^N</code> where <code>N</code> is the lowest positive <code>xs:integer</code> that brings the result of the division within the permitted range, and the exponent <code>e</code> is increased by <code>N</code>. This is integer division (in effect, the binary value of the mantissa is truncated on the right). Let <code>M</code> be the mantissa and <code>E</code> the exponent after this adjustment.</p></li><li><p>if <code>E</code> exceeds <code>104</code> (the maximum exponent value in the value space of <code>xs:float</code>) then <var>TV</var> is the <code>xs:float</code> value <code>INF</code> or <code>-INF</code> depending on the sign of <code>M</code>.</p></li><li><p>if <code>E</code> is less than <code>-149</code> (the minimum exponent value in the value space of <code>xs:float</code>) then <var>TV</var> is the <code>xs:float</code> value positive or negative zero depending on the sign of <code>M</code></p></li><li><p>otherwise, <var>TV</var> is the <code>xs:float</code> value <code>M × 2^E</code>.</p></li></ul></li></ul></li><li><p>If <var>ST</var> is <code>xs:decimal</code>, or <code>xs:integer</code>, then <var>TV</var> is <code>xs:float(</code><var>SV</var><code> cast as xs:string)</code> and the conversion is complete.</p></li><li><p>If <var>ST</var> is <code>xs:boolean</code>, <var>SV</var> is converted to <code>1.0E0</code> if <var>SV</var> is <code>true</code> and to <code>0.0E0</code> if <var>SV</var> is <code>false</code> and the conversion is complete.</p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. </span></p><div class="note"><p class="prefix"><b>Note:</b></p><p>XSD 1.1 adds the value <code>+INF</code> to the lexical space, as an alternative to <code>INF</code>. XSD 1.1 also adds negative zero to the value space.</p></div></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>Implementations <span class="verb">should</span> return negative zero for <code>xs:float("-0.0E0")</code>. But because <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> does not distinguish between the values positive zero and negative zero. Implementations <span class="verb">may</span> return positive zero in this case.</p></div></div><div class="div4"><h5><a id="casting-to-double"></a><span class="deltaxml-old" style="background:#FF5555">23.1.3.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.3.2</span> <a href="#casting-to-double" style="text-decoration: none">Casting to xs:double</a></h5><p>When a value of any simple type is cast as <code>xs:double</code>, the <code>xs:double</code> value <var>TV</var> is derived from the <var>ST</var> and the <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:double</code>, then <var>TV</var> is <var>SV</var> and the conversion is complete.</p></li><li><p>If <var>ST</var> is <code>xs:float</code> or a type derived from <code>xs:float</code>, then <var>TV</var> is obtained as follows:</p><ul><li><p>if <var>SV</var> is the <code>xs:float</code> value <code>INF</code>, <code>-INF</code>, <code>NaN</code>, positive zero, or negative zero, then <var>TV</var> is the <code>xs:double</code> value <code>INF</code>, <code>-INF</code>, <code>NaN</code>, positive zero, or negative zero respectively. </p></li><li><p>otherwise, <var>SV</var> can be expressed in the form <code>m × 2^e</code> where the mantissa <code>m</code> and exponent <code>e</code> are signed <code>xs:integer</code> values whose value range is defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, and <var>TV</var> is the <code>xs:double</code> value <code>m × 2^e</code>. </p></li></ul></li><li><p>If <var>ST</var> is <code>xs:decimal</code> or <code>xs:integer</code>, then <var>TV</var> is <code>xs:double(</code><var>SV</var><code> cast as xs:string)</code> and the conversion is complete.</p></li><li><p>If <var>ST</var> is <code>xs:boolean</code>, <var>SV</var> is converted to <code>1.0E0</code> if <var>SV</var> is <code>true</code> and to <code>0.0E0</code> if <var>SV</var> is <code>false</code> and the conversion is complete.</p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>.</span></p><div class="note"><p class="prefix"><b>Note:</b></p><p>XSD 1.1 adds the value <code>+INF</code> to the lexical space, as an alternative to <code>INF</code>. XSD 1.1 also adds negative zero to the value space.</p></div></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p>Implementations <span class="verb">should</span> return negative zero for <code>xs:double("-0.0E0")</code>. But because <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> does not distinguish between the values positive zero and negative zero. Implementations <span class="verb">may</span> return positive zero in this case.</p></div></div><div class="div4"><h5><a id="casting-to-decimal"></a><span class="deltaxml-old" style="background:#FF5555">23.1.3.3</span><span class="deltaxml-new" style="background:#90EE90">24.1.3.3</span> <a href="#casting-to-decimal" style="text-decoration: none">Casting to xs:decimal</a></h5><p><span style="display: none;" class="delete_version">This section defines the rules for casting to the primitive type <code>xs:decimal</code>. The rules are also invoked implicitly as part of the process of converting to types derived from <code>xs:decimal</code>. There are special rules, however, if the target type <var>TT</var> is <code>xs:integer</code>, or a type derived from <code>xs:integer</code>: those rules are given in <a href="#casting-to-integer"><span class="delete_version"><b>23.3.2 Casting to xs:integer</b></span><span class="modify_version"><b>23.3.2 Casting to xs:integer</b></span></a>.</span><span style="display: none;" class="add_version">This section defines the rules for casting to the primitive type <code>xs:decimal</code>. The rules are also invoked implicitly as part of the process of converting to types derived from <code>xs:decimal</code>. There are special rules, however, if the target type <var>TT</var> is <code>xs:integer</code>, or a type derived from <code>xs:integer</code>: those rules are given in <a href="#casting-to-integer"><span class="add_version"><b>24.3.2 Casting to xs:integer</b></span><span class="modify_version"><b>24.3.2 Casting to xs:integer</b></span></a>.</span><span class="modify_version">This section defines the rules for casting to the primitive type <code>xs:decimal</code>. The rules are also invoked implicitly as part of the process of converting to types derived from <code>xs:decimal</code>. There are special rules, however, if the target type <var>TT</var> is <code>xs:integer</code>, or a type derived from <code>xs:integer</code>: those rules are given in <a href="#casting-to-integer"><span style="display: none;" class="delete_version"><b>23.3.2 Casting to xs:integer</b></span><span style="display: none;" class="add_version"><b>24.3.2 Casting to xs:integer</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.2</span><span class="deltaxml-new" style="background:#90EE90">24.3.2</span> Casting to xs:integer</b></span></a>.</span></p><p>When the target type <var>TT</var> is <code>xs:decimal</code>, the resulting <code>xs:decimal</code> value <var>TV</var> is derived from <var>ST</var> and <var>SV</var> as follows: </p><ul><li><p>If <var>ST</var> is <code>xs:decimal</code> or a subtype thereof (including <code>xs:integer</code>), then the result <var>TV</var> has the same <a title="datum" class="termref" href="#dt-datum">datum</a> as <var>SV</var>. The type annotation <span class="verb">may</span> be <code>xs:decimal</code> or any subtype of <code>xs:decimal</code> for which this is a valid instance, including the original type <code>ST</code>.</p></li><li><p>If <var>ST</var> is <code>xs:float</code> or <code>xs:double</code>, then <var>TV</var> is the <code>xs:decimal</code> value, within the set of <code>xs:decimal</code> values that the implementation is capable of representing, that is numerically closest to <var>SV</var>. If two values are equally close, then the one that is closest to zero is chosen. If <var>SV</var> is too large to be accommodated as an <code>xs:decimal</code>, (see <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> for <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on numeric values) a dynamic error is raised [<a href="#ERRFOCA0001" title="err:FOCA0001">err:FOCA0001</a>]. If <var>SV</var> is one of the special <code>xs:float</code> or <code>xs:double</code> values <code>NaN</code>, <code>INF</code>, or <code>-INF</code>, a dynamic error is raised [<a href="#ERRFOCA0002" title="err:FOCA0002">err:FOCA0002</a>].</p></li><li><p>If <var>ST</var> is <code>xs:boolean</code>, the result <var>TV</var> is <code>1.0</code> if <var>SV</var> is <code>1</code> or <code>true</code> and to <code>0.0</code> if <var>SV</var> is <code>0</code> or <code>false</code>. The type annotation of the result may be any subtype of <code>xs:decimal</code> whose value space includes the integer values <code>0</code> and <code>1</code>.</p></li><li><p><span style="display: none;" class="delete_version">If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span style="display: none;" class="add_version">If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span class="modify_version">If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>.</span></p></li></ul></div></div><div class="div3"><h4><a id="casting-to-durations"></a><span class="deltaxml-old" style="background:#FF5555">23.1.4</span><span class="deltaxml-new" style="background:#90EE90">24.1.4</span> <a href="#casting-to-durations" style="text-decoration: none">Casting to duration types</a></h4><p><span style="display: none;" class="delete_version">This section defines the rules for casting to the primitive duration type <code>xs:duration</code>. Rules for casting to the derived types <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code> are given in <a href="#casting-to-duration-subtypes"><span class="delete_version"><b>23.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span><span class="modify_version"><b>23.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span></a>.</span><span style="display: none;" class="add_version">This section defines the rules for casting to the primitive duration type <code>xs:duration</code>. Rules for casting to the derived types <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code> are given in <a href="#casting-to-duration-subtypes"><span class="add_version"><b>24.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span><span class="modify_version"><b>24.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span></a>.</span><span class="modify_version">This section defines the rules for casting to the primitive duration type <code>xs:duration</code>. Rules for casting to the derived types <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code> are given in <a href="#casting-to-duration-subtypes"><span style="display: none;" class="delete_version"><b>23.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span><span style="display: none;" class="add_version"><b>24.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.3</span><span class="deltaxml-new" style="background:#90EE90">24.3.3</span> Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span></a>.</span></p><ul><li><p>If the source value <var>SV</var> is an instance of <code>xs:duration</code> (including instances of subtypes such as <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>, then the datum of the result <var>TV</var> is the same as the datum of <var>SV</var>, and the type annotation is <code>xs:duration</code> or any subtype thereof that includes this datum in its value space (in particular, it <span class="verb">may</span> be the same as the type annotation of <var>SV</var>).</p></li><li><p><span style="display: none;" class="delete_version">If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span style="display: none;" class="add_version">If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span class="modify_version">If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>.</span></p></li></ul></div><div class="div3"><h4><a id="casting-to-datetimes"></a><span class="deltaxml-old" style="background:#FF5555">23.1.5</span><span class="deltaxml-new" style="background:#90EE90">24.1.5</span> <a href="#casting-to-datetimes" style="text-decoration: none">Casting to date and time types</a></h4><p>In several situations, casting to date and time types requires the extraction of a component from <var>SV</var> or from the result of <a href="#func-current-dateTime"><code>fn:current-dateTime</code></a> and converting it to an <code>xs:string</code>. These conversions must follow certain rules. For example, converting an <code>xs:integer</code> year value requires converting to an <code>xs:string</code> with four or more characters, preceded by a minus sign if the value is negative.</p><p>This document defines four functions to perform these conversions. These functions are for illustrative purposes only and make no recommendations as to style or efficiency. References to these functions from the following text are not normative.</p><p>The arguments to these functions come from functions defined in this document. Thus, the functions below assume that they are correct and do no range checking on them.</p><div class="exampleInner"><pre xml:space="preserve" class="small">declare function eg:convertYearToString($year as xs:integer) as xs:string {
  let $plusMinus := if ($year &gt;= 0) then "" else "-"
  let $yearString := abs($year) cast as xs:string
  let $length := string-length($yearString)
  return if ($length = 1) then concat($plusMinus, "000", $yearString)
         else if ($length = 2) then concat($plusMinus, "00", $yearString)
         else if ($length = 3) then concat($plusMinus, "0", $yearString)
         else concat($plusMinus, $yearString)
};</pre></div><div class="exampleInner"><pre xml:space="preserve" class="small">declare function eg:convertTo2CharString($value as xs:integer) as xs:string {
  let $string := $value cast as xs:string
  return if (string-length($string) = 1) then concat("0", $string)
         else $string
};</pre></div><div class="exampleInner"><pre xml:space="preserve" class="small">declare function eg:convertSecondsToString($seconds as xs:decimal) as xs:string {
  let $string := $seconds cast as xs:string
  let $intLength := string-length(($seconds cast as xs:integer) cast as xs:string)
  return if ($intLength = 1) then concat("0", $string)
         else $string
};</pre></div><div class="exampleInner"><pre xml:space="preserve" class="small">declare function eg:convertTZtoString($tz as xs:dayTimeDuration?) as xs:string {
  if (empty($tz)) then ""
  else if ($tz eq xs:dayTimeDuration('PT0S')) then "Z"
  else let $tzh := hours-from-duration($tz)
       let $tzm := minutes-from-duration($tz)
       let $plusMinus := if ($tzh &gt;= 0) then "+" else "-"
       let $tzhString := eg:convertTo2CharString(abs($tzh))
       let $tzmString := eg:convertTo2CharString(abs($tzm))
       return concat($plusMinus, $tzhString, ":", $tzmString)
};</pre></div><p>Conversion from <a title="primitive type" class="termref" href="#dt-primitive-type">primitive types</a> to date and time types follows the rules below.</p><ol class="enumar"><li><p>When a value of any primitive type is cast as <code>xs:dateTime</code>, the <code>xs:dateTime</code> value <var>TV</var> is derived from <var>ST</var> and <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:dateTime</code>, then <var>TV</var> is <var>SV</var>. </p></li><li><p>If <var>ST</var> is <code>xs:date</code>, then let <em>SYR</em> be <code>eg:convertYearToString( year-from-date(</code><var>SV</var><code>))</code>, let <em>SMO</em> be <code>eg:convertTo2CharString( month-from-date(</code><var>SV</var><code>))</code>, let <em>SDA</em> be <code>eg:convertTo2CharString( day-from-date(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-date(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:dateTime( concat(</code><em>SYR</em><code>, '-', </code><em>SMO</em><code>, '-', </code><em>SDA</em><code>, 'T00:00:00 '</code>, <em>STZ</em><code>) )</code>. </p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>.</span></p></li></ul></li><li><p>When a value of any primitive type is cast as <code>xs:time</code>, the <code>xs:time</code> value <var>TV</var> is derived from <var>ST</var> and <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:time</code>, then <var>TV</var> is <var>SV</var>. </p></li><li><p>If <var>ST</var> is <code>xs:dateTime</code>, then <var>TV</var> is <code>xs:time( concat( eg:convertTo2CharString( hours-from-dateTime(</code><var>SV</var><code>)), ':', eg:convertTo2CharString( minutes-from-dateTime(</code><var>SV</var><code>)), ':', eg:convertSecondsToString( seconds-from-dateTime(</code><var>SV</var><code>)), eg:convertTZtoString( timezone-from-dateTime(</code><var>SV</var><code>)) ))</code>. </p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. </span></p></li></ul></li><li><p>When a value of any primitive type is cast as <code>xs:date</code>, the <code>xs:date</code> value <var>TV</var> is derived from <var>ST</var> and <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:date</code>, then <var>TV</var> is <var>SV</var>. </p></li><li><p>If <var>ST</var> is <code>xs:dateTime</code>, then let <em>SYR</em> be <code>eg:convertYearToString( year-from-dateTime(</code><var>SV</var><code>))</code>, let <em>SMO</em> be <code>eg:convertTo2CharString( month-from-dateTime(</code><var>SV</var><code>))</code>, let <em>SDA</em> be <code>eg:convertTo2CharString( day-from-dateTime(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString(timezone-from-dateTime(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:date( concat(</code><em>SYR</em><code>, '-', </code><em>SMO</em><code>, '-', </code><em>SDA</em>, <em>STZ</em><code>) )</code>. </p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. </span></p></li></ul></li><li><p>When a value of any primitive type is cast as <code>xs:gYearMonth</code>, the <code>xs:gYearMonth</code> value <var>TV</var> is derived from <var>ST</var> and <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:gYearMonth</code>, then <var>TV</var> is <var>SV</var>. </p></li><li><p>If <var>ST</var> is <code>xs:dateTime</code>, then let <em>SYR</em> be <code>eg:convertYearToString( year-from-dateTime(</code><var>SV</var><code>))</code>, let <em>SMO</em> be <code>eg:convertTo2CharString( month-from-dateTime(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-dateTime(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gYearMonth( concat(</code><em>SYR</em><code>, '-', </code><em>SMO</em>, <em>STZ</em><code>) )</code>. </p></li><li><p>If <var>ST</var> is <code>xs:date</code>, then let <em>SYR</em> be <code>eg:convertYearToString( year-from-date(</code><var>SV</var><code>))</code>, let <em>SMO</em> be <code>eg:convertTo2CharString( month-from-date(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-date(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gYearMonth( concat(</code><em>SYR</em><code>, '-', </code><em>SMO</em>, <em>STZ</em><code>) )</code>. </p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. </span></p></li></ul></li><li><p>When a value of any primitive type is cast as <code>xs:gYear</code>, the <code>xs:gYear</code> value <var>TV</var> is derived from <var>ST</var> and <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:gYear</code>, then <var>TV</var> is <var>SV</var>. </p></li><li><p>If <var>ST</var> is <code>xs:dateTime</code>, let <em>SYR</em> be <code>eg:convertYearToString( year-from-dateTime(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-dateTime(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gYear(concat(</code><em>SYR</em>, <em>STZ</em><code>))</code>. </p></li><li><p>If <var>ST</var> is <code>xs:date</code>, let <em>SYR</em> be <code>eg:convertYearToString( year-from-date(</code><var>SV</var><code>))</code>; and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-date(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gYear(concat(</code><em>SYR</em>, <em>STZ</em><code>))</code>. </p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. </span></p></li></ul></li><li><p>When a value of any primitive type is cast as <code>xs:gMonthDay</code>, the <code>xs:gMonthDay</code> value <var>TV</var> is derived from <var>ST</var> and <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:gMonthDay</code>, then <var>TV</var> is <var>SV</var>. </p></li><li><p>If <var>ST</var> is <code>xs:dateTime</code>, then let <em>SMO</em> be <code>eg:convertTo2CharString( month-from-dateTime(</code><var>SV</var><code>))</code>, let <em>SDA</em> be <code>eg:convertTo2CharString( day-from-dateTime(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-dateTime(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gYearMonth( concat(</code><code> '--', </code><em>SMO</em><code> '-', </code><em>SDA</em>, <em>STZ</em><code>) )</code>. </p></li><li><p>If <var>ST</var> is <code>xs:date</code>, then let <em>SMO</em> be <code>eg:convertTo2CharString( month-from-date(</code><var>SV</var><code>))</code>, let <em>SDA</em> be <code>eg:convertTo2CharString( day-from-date(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-date(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gYearMonth( concat(</code><code> '--', </code><em>SMO</em><code>, '-', </code><em>SDA</em>, <em>STZ</em><code>) )</code>. </p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>.</span></p></li></ul></li><li><p>When a value of any primitive type is cast as <code>xs:gDay</code>, the <code>xs:gDay</code> value <var>TV</var> is derived from <var>ST</var> and <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:gDay</code>, then <var>TV</var> is <var>SV</var>. </p></li><li><p>If <var>ST</var> is <code>xs:dateTime</code>, then let <em>SDA</em> be <code>eg:convertTo2CharString( day-from-dateTime(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-dateTime(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gDay( concat( '---'</code>, <em>SDA</em>, <em>STZ</em><code>))</code>. </p></li><li><p>If <var>ST</var> is <code>xs:date</code>, then let <em>SDA</em> be <code>eg:convertTo2CharString( day-from-date(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-date(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gDay( concat( '---'</code>, <em>SDA</em>, <em>STZ</em><code>))</code>. </p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. </span></p></li></ul></li><li><p>When a value of any primitive type is cast as <code>xs:gMonth</code>, the <code>xs:gMonth</code> value <var>TV</var> is derived from <var>ST</var> and <var>SV</var> as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:gMonth</code>, then <var>TV</var> is <var>SV</var>. </p></li><li><p>If <var>ST</var> is <code>xs:dateTime</code>, then let <em>SMO</em> be <code>eg:convertTo2CharString( month-from-dateTime(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-dateTime(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gMonth( concat( '--' </code>, <em>SMO</em>, <em>STZ</em><code>))</code>. </p></li><li><p>If <var>ST</var> is <code>xs:date</code>, then let <em>SMO</em> be <code>eg:convertTo2CharString( month-from-date(</code><var>SV</var><code>))</code> and let <em>STZ</em> be <code>eg:convertTZtoString( timezone-from-date(</code><var>SV</var><code>))</code>; <var>TV</var> is <code>xs:gMonth( concat( '--'</code>, <em>SMO</em>, <em>STZ</em><code>))</code>. </p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>.</span></p></li></ul></li></ol></div><div class="div3"><h4><a id="casting-boolean"></a><span class="deltaxml-old" style="background:#FF5555">23.1.6</span><span class="deltaxml-new" style="background:#90EE90">24.1.6</span> <a href="#casting-boolean" style="text-decoration: none">Casting to <code>xs:boolean</code></a></h4><p>When the target type <var>TT</var> is <code>xs:boolean</code>, the resulting <code>xs:boolean</code> value <var>TV</var> is derived from the source value <var>SV</var> as follows:</p><ul><li><p>If <var>SV</var> is an instance of <code>xs:boolean</code>, then <var>TV</var> is <var>SV</var>.</p></li><li><p>If <var>SV</var> is an instance of <code>xs:numeric</code> and <var>SV</var> is <code>0</code>, <code>+0</code>, <code>-0</code>, <code>0.0</code>, <code>0.0E0</code> or <code>NaN</code>, then <var>TV</var> is <code>false</code>. </p></li><li><p>If <var>ST</var> is is an instance of <code>xs:numeric</code> and <var>SV</var> is not one of the above values, then <var>TV</var> is <code>true</code>. </p></li><li><p><span style="display: none;" class="delete_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span style="display: none;" class="add_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span class="modify_version"> If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code>, see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. </span></p></li></ul></div><div class="div3"><h4><a id="casting-to-binary"></a><span class="deltaxml-old" style="background:#FF5555">23.1.7</span><span class="deltaxml-new" style="background:#90EE90">24.1.7</span> <a href="#casting-to-binary" style="text-decoration: none">Casting to <code>xs:base64Binary</code> and <code>xs:hexBinary</code></a></h4><p>Values of type <code>xs:base64Binary</code> can be cast as <code>xs:hexBinary</code> and vice versa, since the two types have the same value space. Casting to <code>xs:base64Binary</code> and <code>xs:hexBinary</code> is also supported from the same type and from <code>xs:untypedAtomic</code>, <code>xs:string</code> and subtypes of <code>xs:string</code> using <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> semantics.</p></div><div class="div3"><h4><a id="casting-to-anyuri"></a><span class="deltaxml-old" style="background:#FF5555">23.1.8</span><span class="deltaxml-new" style="background:#90EE90">24.1.8</span> <a href="#casting-to-anyuri" style="text-decoration: none">Casting to xs:anyURI</a></h4><p>Casting to <code>xs:anyURI</code> is supported only from the same type, <code>xs:untypedAtomic</code> or <code>xs:string</code>.</p><p>When a value of any <a title="primitive type" class="termref" href="#dt-primitive-type">primitive type</a> is cast as <code>xs:anyURI</code>, the <code>xs:anyURI</code> value <var>TV</var> is derived from the <var>ST</var> and <var>SV</var> as follows:</p><ul><li><p><span style="display: none;" class="delete_version">If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code> see <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span style="display: none;" class="add_version">If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code> see <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. </span><span class="modify_version">If <var>ST</var> is <code>xs:untypedAtomic</code> or <code>xs:string</code> see <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. </span></p></li></ul></div><div class="div3"><h4><a id="casting-to-qname-and-notation"></a><span class="deltaxml-old" style="background:#FF5555">23.1.9</span><span class="deltaxml-new" style="background:#90EE90">24.1.9</span> <a href="#casting-to-qname-and-notation" style="text-decoration: none">Casting to xs:QName and xs:NOTATION</a></h4><p><span style="display: none;" class="delete_version">Casting from <code>xs:string</code> or <code>xs:untypedAtomic</code> to <code>xs:QName</code> or <code>xs:NOTATION</code> is described in <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span style="display: none;" class="add_version">Casting from <code>xs:string</code> or <code>xs:untypedAtomic</code> to <code>xs:QName</code> or <code>xs:NOTATION</code> is described in <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span class="modify_version">Casting from <code>xs:string</code> or <code>xs:untypedAtomic</code> to <code>xs:QName</code> or <code>xs:NOTATION</code> is described in <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>.</span></p><p>It is also possible to cast from <code>xs:NOTATION</code> to <code>xs:QName</code>, or from <code>xs:QName</code> to any type derived by restriction from <code>xs:NOTATION</code>. (Casting to <code>xs:NOTATION</code> itself is not allowed, because <code>xs:NOTATION</code> is an abstract type.) The resulting <code>xs:QName</code> or <code>xs:NOTATION</code> has the same prefix, local name, and namespace URI parts as the supplied value.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>See <a href="#constructor-qname-notation"><span style="display: none;" class="delete_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span style="display: none;" class="add_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.2</span><span class="deltaxml-new" style="background:#90EE90">23.2</span> Constructor functions for xs:QName and xs:NOTATION</b></span></a> for a discussion of how the combination of atomization and casting might not produce the desired effect.</p></div></div><div class="div3"><h4><a id="casting-to-ENTITY"></a><span class="deltaxml-old" style="background:#FF5555">23.1.10</span><span class="deltaxml-new" style="background:#90EE90">24.1.10</span> <a href="#casting-to-ENTITY" style="text-decoration: none">Casting to xs:ENTITY</a></h4><p><a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> says that “The value space of ENTITY is the set of all strings that match the NCName production ... and have been declared as an unparsed entity in a document type definition.” However, <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a> and <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a> do not check that constructed values of type <code>xs:ENTITY</code> match declared unparsed entities. Thus, this rule is relaxed in this specification and, in casting to <code>xs:ENTITY</code> and types derived from it, no check is made that the values correspond to declared unparsed entities. </p></div></div><div class="div2"><h3><a id="casting-from-strings"></a><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> <a href="#casting-from-strings" style="text-decoration: none">Casting from xs:string and xs:untypedAtomic</a></h3><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#id-built-in-named-record-types">next</a> | <a href="#casting-duration-to-string">previous</a>)</p><ol><li><p> When casting from a string to a duration or time or dateTime, it is now specified that when there are more digits in the fractional seconds than the implementation is able to retain, excess digits are truncated. Rounding upwards (which could affect the number of minutes or hours in the value) is not permitted. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1089">1089</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1090">1090</a>&nbsp;19 March 2024]</i></p></li></ol></div><p>This section applies when the supplied value <var>SV</var> is an instance of <code>xs:string</code> or <code>xs:untypedAtomic</code>, including types derived from these by restriction. If the value is <code>xs:untypedAtomic</code>, it is treated in exactly the same way as a string containing the same sequence of characters.</p><p>The supplied string is mapped to a typed value of the target type as defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>. Whitespace normalization is applied as indicated by the <code>whiteSpace</code> facet for the datatype. The resulting whitespace-normalized string must be a valid lexical form for the datatype. The semantics of casting follow the rules of XML Schema validation. For example, <code>"13" cast as xs:unsignedInt</code> returns the <code>xs:unsignedInt</code> typed value <code>13</code>. This could also be written <code>xs:unsignedInt("13")</code>.</p><p>The target type can be any simple type other than an abstract type. Specifically, it can be a type whose variety is atomic, union, or list. In each case the effect of casting to the target type is the same as constructing an element with the supplied value as its content, validating the element using the target type as the governing type, and atomizing the element to obtain its typed value.</p><p>When the target type is a derived type that is restricted by a pattern facet, the lexical form is first checked against the pattern before further casting is attempted (See <a href="#casting-to-derived-types"><span style="display: none;" class="delete_version"><b>23.3.1 Casting to derived types</b></span><span style="display: none;" class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> Casting to derived types</b></span></a>). If the lexical form does not conform to the pattern, a dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>] is raised.</p><p>For example, consider a user-defined type <code>my:boolean</code> which is derived by restriction from <code>xs:boolean</code> and specifies the pattern facet <code>value="0|1"</code>. The expression <code>"true" cast as my:boolean</code> would fail with a dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>].</p><p>Facets other than <code>pattern</code> are checked <em>after</em> the conversion. For example if there is a user-defined datatype called <code>my:height</code> defined as a restriction of <code>xs:integer</code> with the facet <code>&lt;maxInclusive value="84"/&gt;</code>, then the expression <code>"100" cast as my:height</code> would fail with a dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>].</p><p>Casting to the types <code>xs:NOTATION</code>, <code>xs:anySimpleType</code>, or <code>xs:anyAtomicType</code> is not permitted because these types are abstract (they have no immediate instances).</p><p><span style="display: none;" class="delete_version">Special rules apply when casting to namespace-sensitive types. The types <code>xs:QName</code> and <code>xs:NOTATION</code> are namespace-sensitive. Any type derived by restriction from a namespace-sensitive type is itself namespace-sensitive, as is any union type having a namespace-sensitive type among its members, and any list type having a namespace-sensitive type as its item type. For details, see <a href="#constructor-qname-notation"><span class="delete_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span></a>.</span><span style="display: none;" class="add_version">Special rules apply when casting to namespace-sensitive types. The types <code>xs:QName</code> and <code>xs:NOTATION</code> are namespace-sensitive. Any type derived by restriction from a namespace-sensitive type is itself namespace-sensitive, as is any union type having a namespace-sensitive type among its members, and any list type having a namespace-sensitive type as its item type. For details, see <a href="#constructor-qname-notation"><span class="add_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span></a>.</span><span class="modify_version">Special rules apply when casting to namespace-sensitive types. The types <code>xs:QName</code> and <code>xs:NOTATION</code> are namespace-sensitive. Any type derived by restriction from a namespace-sensitive type is itself namespace-sensitive, as is any union type having a namespace-sensitive type among its members, and any list type having a namespace-sensitive type as its item type. For details, see <a href="#constructor-qname-notation"><span style="display: none;" class="delete_version"><b>22.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span style="display: none;" class="add_version"><b>23.2 Constructor functions for xs:QName and xs:NOTATION</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.2</span><span class="deltaxml-new" style="background:#90EE90">23.2</span> Constructor functions for xs:QName and xs:NOTATION</b></span></a>.</span></p><div class="note"><p class="prefix"><b>Note:</b></p><p>Since version 3.0 of this specification, casting has been allowed between <code>xs:QName</code> and <code>xs:NOTATION</code> in either direction; this was not permitted in previous Recommendations. Version 3.0 also removed the rule that only a string literal (rather than a dynamic string) may be cast to an <code>xs:QName</code></p></div><p>When casting to a numeric type:</p><ul><li><p>If the value is too large or too small to be accurately represented by the implementation, it is handled as an overflow or underflow as defined in <a href="#op.numeric"><b>4.2 Arithmetic operators on numeric values</b></a>.</p></li><li><p>If the target type is <code>xs:float</code> or <code>xs:double</code>, the string <code>-0</code> (and equivalents such as <code>-0.0</code> or <code>-000</code>) <span class="verb">should</span> be converted to the value negative zero. However, if the implementation is reliant on an implementation of XML Schema 1.0 in which negative zero is not part of the value space for these types, these lexical forms <span class="verb">may</span> be converted to positive zero.</p></li></ul><p> In casting to <code>xs:decimal</code> or to a type derived from <code>xs:decimal</code>, if the value is not too large or too small but nevertheless cannot be represented accurately with the number of decimal digits available to the implementation, the implementation may round to the nearest representable value or may raise a dynamic error [<a href="#ERRFOCA0006" title="err:FOCA0006">err:FOCA0006</a>]. The choice of rounding algorithm and the choice between rounding and error behavior is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. </p><p>When casting to <code>xs:duration</code>, <code>xs:dateTime</code>, or <code>xs:time</code>, if the seconds component has more fractional digits than are supported by the implementation, excess digits <span class="verb">must</span> be truncated. This rule ensures that components other than the seconds component are unaffected: for example <code>xs:dateTime('2023-12-31T23:59:59.999999999')</code> is guaranteed to deliver an <code>xs:dateTime</code> value whose year component is 2023 rather than 2024.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>Implementations are required to support millisecond precision or greater.</p></div><p>In casting to <code>xs:date</code>, <code>xs:dateTime</code>, <code>xs:gYear</code>, or <code>xs:gYearMonth</code> (or types derived from these), if the value is too large or too small to be represented by the implementation, a dynamic error [<a href="#ERRFODT0001" title="err:FODT0001">err:FODT0001</a>] is raised.</p><p>In casting to a duration value, if the value is too large or too small to be represented by the implementation, a dynamic error [<a href="#ERRFODT0002" title="err:FODT0002">err:FODT0002</a>] is raised.</p><p> For <code>xs:anyURI</code>, the extent to which an implementation validates the lexical form of <code>xs:anyURI</code> is <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>.</p><p>If the cast fails for any other reason, a dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>] is raised.</p></div><div class="div2"><h3><a id="casting-non-primitive-types"></a><span class="deltaxml-old" style="background:#FF5555">23.3</span><span class="deltaxml-new" style="background:#90EE90">24.3</span> <a href="#casting-non-primitive-types" style="text-decoration: none">Casting involving non-primitive types</a></h3><p><span style="display: none;" class="delete_version">Casting from <code>xs:string</code> and <code>xs:untypedAtomic</code> to any other type (primitive or non-primitive) has been described in <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. This section defines how other casts to non-primitive types operate, including casting to types derived by restriction, to union types, and to list types.</span><span style="display: none;" class="add_version">Casting from <code>xs:string</code> and <code>xs:untypedAtomic</code> to any other type (primitive or non-primitive) has been described in <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>. This section defines how other casts to non-primitive types operate, including casting to types derived by restriction, to union types, and to list types.</span><span class="modify_version">Casting from <code>xs:string</code> and <code>xs:untypedAtomic</code> to any other type (primitive or non-primitive) has been described in <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>. This section defines how other casts to non-primitive types operate, including casting to types derived by restriction, to union types, and to list types.</span></p><div class="div3"><h4><a id="casting-to-derived-types"></a><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> <a href="#casting-to-derived-types" style="text-decoration: none">Casting to derived types</a></h4><p>Casting a value to a derived type can be separated into a number of cases. In these rules:</p><ul><li><p>The types <code>xs:integer</code>, <code>xs:yearMonthDuration</code>, and <code>xs:dayTimeDuration</code> are treated as quasi-primitive types (alongside the 20 truly <a title="primitive type" class="termref" href="#dt-primitive-type">primitive types</a>).</p></li><li><p>For any atomic type <var>T</var>, let <var>P(T)</var> denote the most specific primitive or quasi-primitive type such that <code>itemType-subtype(T, P(T))</code> is <code>true</code>.</p></li></ul><p>The rules are then:</p><ol class="enumar"><li><p>When the source type <var>ST</var> is the same type as the target type <var>TT</var>: this case always succeeds, returning the source value <var>SV</var> unchanged.</p></li><li><p><span style="display: none;" class="delete_version">When <code>itemType-subtype(ST, TT)</code> is <code>true</code>: see <a href="#casting-from-derived-to-parent"><span class="delete_version"><b>23.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b>23.3.4 Casting from derived types to parent types</b></span></a>. </span><span style="display: none;" class="add_version">When <code>itemType-subtype(ST, TT)</code> is <code>true</code>: see <a href="#casting-from-derived-to-parent"><span class="add_version"><b>24.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b>24.3.4 Casting from derived types to parent types</b></span></a>. </span><span class="modify_version">When <code>itemType-subtype(ST, TT)</code> is <code>true</code>: see <a href="#casting-from-derived-to-parent"><span style="display: none;" class="delete_version"><b>23.3.4 Casting from derived types to parent types</b></span><span style="display: none;" class="add_version"><b>24.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.4</span><span class="deltaxml-new" style="background:#90EE90">24.3.4</span> Casting from derived types to parent types</b></span></a>. </span></p></li><li><p><span style="display: none;" class="delete_version">When <var>TT</var> is the quasi-primitive type <code>xs:integer</code> and <code>SV</code> is an instance of <code>xs:numeric</code>: see <a href="#casting-to-integer"><span class="delete_version"><b>23.3.2 Casting to xs:integer</b></span><span class="modify_version"><b>23.3.2 Casting to xs:integer</b></span></a>.</span><span style="display: none;" class="add_version">When <var>TT</var> is the quasi-primitive type <code>xs:integer</code> and <code>SV</code> is an instance of <code>xs:numeric</code>: see <a href="#casting-to-integer"><span class="add_version"><b>24.3.2 Casting to xs:integer</b></span><span class="modify_version"><b>24.3.2 Casting to xs:integer</b></span></a>.</span><span class="modify_version">When <var>TT</var> is the quasi-primitive type <code>xs:integer</code> and <code>SV</code> is an instance of <code>xs:numeric</code>: see <a href="#casting-to-integer"><span style="display: none;" class="delete_version"><b>23.3.2 Casting to xs:integer</b></span><span style="display: none;" class="add_version"><b>24.3.2 Casting to xs:integer</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.2</span><span class="deltaxml-new" style="background:#90EE90">24.3.2</span> Casting to xs:integer</b></span></a>.</span></p></li><li><p><span style="display: none;" class="delete_version">When <var>TT</var> is the quasi-primitive type <code>xs:yearMonthDuration</code> or <code>xs:dayTimeDuration</code> and <code>SV</code> is an instance of <code>xs:duration</code>: see <a href="#casting-to-duration-subtypes"><span class="delete_version"><b>23.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span><span class="modify_version"><b>23.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span></a>.</span><span style="display: none;" class="add_version">When <var>TT</var> is the quasi-primitive type <code>xs:yearMonthDuration</code> or <code>xs:dayTimeDuration</code> and <code>SV</code> is an instance of <code>xs:duration</code>: see <a href="#casting-to-duration-subtypes"><span class="add_version"><b>24.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span><span class="modify_version"><b>24.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span></a>.</span><span class="modify_version">When <var>TT</var> is the quasi-primitive type <code>xs:yearMonthDuration</code> or <code>xs:dayTimeDuration</code> and <code>SV</code> is an instance of <code>xs:duration</code>: see <a href="#casting-to-duration-subtypes"><span style="display: none;" class="delete_version"><b>23.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span><span style="display: none;" class="add_version"><b>24.3.3 Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.3</span><span class="deltaxml-new" style="background:#90EE90">24.3.3</span> Casting to xs:yearMonthDuration and xs:dayTimeDuration</b></span></a>.</span></p></li><li><p><span style="display: none;" class="delete_version">When <var>P(ST)</var> is the same type as <var>P(TT)</var>: see <a href="#casting-within-branch"><span class="delete_version"><b>23.3.5 Casting within a branch of the type hierarchy</b></span><span class="modify_version"><b>23.3.5 Casting within a branch of the type hierarchy</b></span></a>.</span><span style="display: none;" class="add_version">When <var>P(ST)</var> is the same type as <var>P(TT)</var>: see <a href="#casting-within-branch"><span class="add_version"><b>24.3.5 Casting within a branch of the type hierarchy</b></span><span class="modify_version"><b>24.3.5 Casting within a branch of the type hierarchy</b></span></a>.</span><span class="modify_version">When <var>P(ST)</var> is the same type as <var>P(TT)</var>: see <a href="#casting-within-branch"><span style="display: none;" class="delete_version"><b>23.3.5 Casting within a branch of the type hierarchy</b></span><span style="display: none;" class="add_version"><b>24.3.5 Casting within a branch of the type hierarchy</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.5</span><span class="deltaxml-new" style="background:#90EE90">24.3.5</span> Casting within a branch of the type hierarchy</b></span></a>.</span></p></li><li><p><span style="display: none;" class="delete_version">Otherwise (<var>P(ST)</var> is not the same type as <var>P(TT)</var>): see <a href="#casting-across-hierarchy"><span class="delete_version"><b>23.3.6 Casting across the type hierarchy</b></span><span class="modify_version"><b>23.3.6 Casting across the type hierarchy</b></span></a>.</span><span style="display: none;" class="add_version">Otherwise (<var>P(ST)</var> is not the same type as <var>P(TT)</var>): see <a href="#casting-across-hierarchy"><span class="add_version"><b>24.3.6 Casting across the type hierarchy</b></span><span class="modify_version"><b>24.3.6 Casting across the type hierarchy</b></span></a>.</span><span class="modify_version">Otherwise (<var>P(ST)</var> is not the same type as <var>P(TT)</var>): see <a href="#casting-across-hierarchy"><span style="display: none;" class="delete_version"><b>23.3.6 Casting across the type hierarchy</b></span><span style="display: none;" class="add_version"><b>24.3.6 Casting across the type hierarchy</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.6</span><span class="deltaxml-new" style="background:#90EE90">24.3.6</span> Casting across the type hierarchy</b></span></a>.</span></p></li></ol></div><div class="div3"><h4><a id="casting-to-integer"></a><span class="deltaxml-old" style="background:#FF5555">23.3.2</span><span class="deltaxml-new" style="background:#90EE90">24.3.2</span> <a href="#casting-to-integer" style="text-decoration: none">Casting to xs:integer</a></h4><p>When an atomic item <code>SV</code> is cast as <code>xs:integer</code>, the resulting <code>xs:integer</code> value <var>TV</var> is obtained as follows:</p><ul><li><p>If <var>ST</var> is <code>xs:decimal</code>, <code>xs:float</code> or <code>xs:double</code>, then <var>TV</var> is <var>SV</var> with the fractional part discarded and the value converted to <code>xs:integer</code>. Thus, casting <code>3.1456</code> returns <code>3</code> while <code>-17.89</code> returns <code>-17</code>. Casting <code>3.124E1</code> returns <code>31</code>. If <var>SV</var> is too large to be accommodated as an integer, (see <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> for <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on numeric values) a dynamic error is raised [<a href="#ERRFOCA0003" title="err:FOCA0003">err:FOCA0003</a>]. If <var>SV</var> is one of the special <code>xs:float</code> or <code>xs:double</code> values <code>NaN</code>, <code>INF</code>, or <code>-INF</code>, a dynamic error is raised [<a href="#ERRFOCA0002" title="err:FOCA0002">err:FOCA0002</a>].</p></li><li><p>In all other cases, the general rules of <a href="#casting-to-derived-types"><span style="display: none;" class="delete_version"><b>23.3.1 Casting to derived types</b></span><span style="display: none;" class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> Casting to derived types</b></span></a> apply.</p></li></ul><div class="note"><p class="prefix"><b>Note:</b></p><p><span style="display: none;" class="delete_version">When casting to a subtype of <code>xs:integer</code> (for example, <code>xs:long</code>), the rules in <a href="#casting-to-derived-types"><span class="delete_version"><b>23.3.1 Casting to derived types</b></span><span class="modify_version"><b>23.3.1 Casting to derived types</b></span></a> apply. Note, however, that these rules treat <code>xs:integer</code> as a quasi-primitive type.</span><span style="display: none;" class="add_version">When casting to a subtype of <code>xs:integer</code> (for example, <code>xs:long</code>), the rules in <a href="#casting-to-derived-types"><span class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b>24.3.1 Casting to derived types</b></span></a> apply. Note, however, that these rules treat <code>xs:integer</code> as a quasi-primitive type.</span><span class="modify_version">When casting to a subtype of <code>xs:integer</code> (for example, <code>xs:long</code>), the rules in <a href="#casting-to-derived-types"><span style="display: none;" class="delete_version"><b>23.3.1 Casting to derived types</b></span><span style="display: none;" class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> Casting to derived types</b></span></a> apply. Note, however, that these rules treat <code>xs:integer</code> as a quasi-primitive type.</span></p></div></div><div class="div3"><h4><a id="casting-to-duration-subtypes"></a><span class="deltaxml-old" style="background:#FF5555">23.3.3</span><span class="deltaxml-new" style="background:#90EE90">24.3.3</span> <a href="#casting-to-duration-subtypes" style="text-decoration: none">Casting to <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code></a></h4><p>When the source value <var>SV</var> is an instance of <code>xs:duration</code> (including any subtype of <code>xs:duration</code>), then:</p><ul><li><p>If the target type <var>TT</var> is <code>xs:yearMonthDuration</code>, the result is an instance of <code>xs:yearMonthDuration</code> whose <code>months</code> component is equal to the <code>months</code> component of <var>SV</var>. The <code>seconds</code> component of <var>SV</var> is ignored.</p></li><li><p>If the target type <var>TT</var> is <code>xs:dayTimeDuration</code>, the result is an instance of <code>xs:dayTimeDuration</code> whose <code>seconds</code> component is equal to the <code>seconds</code> component of <var>SV</var>. The <code>months</code> component of <var>SV</var> is ignored.</p></li></ul><p>In all other cases, the general rules of <a href="#casting-to-derived-types"><span style="display: none;" class="delete_version"><b>23.3.1 Casting to derived types</b></span><span style="display: none;" class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> Casting to derived types</b></span></a> apply.</p><div class="note"><p class="prefix"><b>Note:</b></p><p>In general, casting to <code>xs:yearMonthDuration</code> or <code>xs:dayTimeDuration</code> loses information.</p></div><div class="note"><p class="prefix"><b>Note:</b></p><p><span style="display: none;" class="delete_version">When casting to a subtype of <code>xs:dayTimeDuration</code> or <code>xs:yearMonthDuration</code>, the rules in <a href="#casting-to-derived-types"><span class="delete_version"><b>23.3.1 Casting to derived types</b></span><span class="modify_version"><b>23.3.1 Casting to derived types</b></span></a> apply. Note, however, that these rules treat <code>xs:dayTimeDuration</code> and <code>xs:yearMonthDuration</code> as quasi-primitive types.</span><span style="display: none;" class="add_version">When casting to a subtype of <code>xs:dayTimeDuration</code> or <code>xs:yearMonthDuration</code>, the rules in <a href="#casting-to-derived-types"><span class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b>24.3.1 Casting to derived types</b></span></a> apply. Note, however, that these rules treat <code>xs:dayTimeDuration</code> and <code>xs:yearMonthDuration</code> as quasi-primitive types.</span><span class="modify_version">When casting to a subtype of <code>xs:dayTimeDuration</code> or <code>xs:yearMonthDuration</code>, the rules in <a href="#casting-to-derived-types"><span style="display: none;" class="delete_version"><b>23.3.1 Casting to derived types</b></span><span style="display: none;" class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> Casting to derived types</b></span></a> apply. Note, however, that these rules treat <code>xs:dayTimeDuration</code> and <code>xs:yearMonthDuration</code> as quasi-primitive types.</span></p></div></div><div class="div3"><h4><a id="casting-from-derived-to-parent"></a><span class="deltaxml-old" style="background:#FF5555">23.3.4</span><span class="deltaxml-new" style="background:#90EE90">24.3.4</span> <a href="#casting-from-derived-to-parent" style="text-decoration: none">Casting from derived types to parent types</a></h4><p> It is always possible to cast an atomic item <var>A</var> to a type <var>T</var> if the relation <code>A instance of T</code> is true, provided that <var>T</var> is not an abstract type. </p><p>For example, it is possible to cast an <code>xs:unsignedShort</code> to an <code>xs:unsignedInt</code>, to an <code>xs:integer</code>, to an <code>xs:decimal</code>, or to a union type whose member types are <code>xs:integer</code> and <code>xs:double</code>.</p><p>Since the value space of the original type is a subset of the value space of the target type, such a cast is always successful.</p><p>For the expression <code>A instance of T</code> to be true, <var>T</var> must be either an atomic type, or a union type that has no constraining facets. It cannot be a list type, nor a union type derived by restriction from another union type, nor a union type that has a list type among its member types.</p><p>The result will have the same value as the original, but will have a new type annotation:</p><ul><li><p>If <var>T</var> is an atomic type, then the type annotation of the result is <code>T</code>. </p></li><li><p>If <var>T</var> is a union type, then the type of the result is an atomic type <code>M</code> such that <var>M</var> is one of the atomic types in the transitive membership of the union type <var>T</var> and <code>A instance of M</code> is true; if there is more than one type <var>M</var> that satisfies these conditions (which could happen, for example, if <var>T</var> is the union of two overlapping types such as <code>xs:int</code> and <code>xs:positiveInteger</code>) then the first one is used, taking the member types in the order in which they appear within the definition of the union type.</p></li></ul></div><div class="div3"><h4><a id="casting-within-branch"></a><span class="deltaxml-old" style="background:#FF5555">23.3.5</span><span class="deltaxml-new" style="background:#90EE90">24.3.5</span> <a href="#casting-within-branch" style="text-decoration: none">Casting within a branch of the type hierarchy</a></h4><p>It is possible to cast an <var>SV</var> to a <var>TT</var> if the type of the <var>SV</var> and the <var>TT</var> type are both derived by restriction (directly or indirectly) from the same <a title="primitive type" class="termref" href="#dt-primitive-type">primitive type</a>, provided that the supplied value conforms to the constraints implied by the facets of the target type. This includes the case where the target type is derived from the type of the supplied value, as well as the case where the type of the supplied value is derived from the target type. For example, an instance of <code>xs:byte</code> can be cast as <code>xs:unsignedShort</code>, provided the value is not negative. </p><p>If the value does not conform to the facets defined for the target type, then a dynamic error is raised [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>]. See <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>. In the case of the pattern facet (which applies to the lexical space rather than the value space), the pattern is tested against the canonical representation of the value, as defined for the source type (or the result of casting the value to an <code>xs:string</code>, in the case of types that have no canonical representation defined for them).</p><p>Note that this will cause casts to fail if the pattern excludes the canonical lexical representation of the source type. For example, if the type <code>my:distance</code> is defined as a restriction of <code>xs:decimal</code> with a pattern that requires two digits after the decimal point, casting of an <code>xs:integer</code> to <code>my:distance</code> will always fail, because the canonical representation of an <code>xs:integer</code> does not conform to this pattern.</p><p><span style="display: none;" class="delete_version">In some cases, casting from a parent type to a derived type requires special rules. See <a href="#casting-to-durations"><span class="delete_version"><b>23.1.4 Casting to duration types</b></span><span class="modify_version"><b>23.1.4 Casting to duration types</b></span></a> for rules regarding casting to <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>. See <a href="#casting-to-ENTITY"><span class="delete_version"><b>23.1.10 Casting to xs:ENTITY</b></span><span class="modify_version"><b>23.1.10 Casting to xs:ENTITY</b></span></a>, below, for casting to <code>xs:ENTITY</code> and types derived from it.</span><span style="display: none;" class="add_version">In some cases, casting from a parent type to a derived type requires special rules. See <a href="#casting-to-durations"><span class="add_version"><b>24.1.4 Casting to duration types</b></span><span class="modify_version"><b>24.1.4 Casting to duration types</b></span></a> for rules regarding casting to <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>. See <a href="#casting-to-ENTITY"><span class="add_version"><b>24.1.10 Casting to xs:ENTITY</b></span><span class="modify_version"><b>24.1.10 Casting to xs:ENTITY</b></span></a>, below, for casting to <code>xs:ENTITY</code> and types derived from it.</span><span class="modify_version">In some cases, casting from a parent type to a derived type requires special rules. See <a href="#casting-to-durations"><span style="display: none;" class="delete_version"><b>23.1.4 Casting to duration types</b></span><span style="display: none;" class="add_version"><b>24.1.4 Casting to duration types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.4</span><span class="deltaxml-new" style="background:#90EE90">24.1.4</span> Casting to duration types</b></span></a> for rules regarding casting to <code>xs:yearMonthDuration</code> and <code>xs:dayTimeDuration</code>. See <a href="#casting-to-ENTITY"><span style="display: none;" class="delete_version"><b>23.1.10 Casting to xs:ENTITY</b></span><span style="display: none;" class="add_version"><b>24.1.10 Casting to xs:ENTITY</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.10</span><span class="deltaxml-new" style="background:#90EE90">24.1.10</span> Casting to xs:ENTITY</b></span></a>, below, for casting to <code>xs:ENTITY</code> and types derived from it.</span></p></div><div class="div3"><h4><a id="casting-across-hierarchy"></a><span class="deltaxml-old" style="background:#FF5555">23.3.6</span><span class="deltaxml-new" style="background:#90EE90">24.3.6</span> <a href="#casting-across-hierarchy" style="text-decoration: none">Casting across the type hierarchy</a></h4><p>When the <var>ST</var> and the <var>TT</var> are derived, directly or indirectly, from different <a title="primitive type" class="termref" href="#dt-primitive-type">primitive types</a>, this is called casting across the type hierarchy. Casting across the type hierarchy is logically equivalent to three separate steps performed in order. Errors can occur in either of the latter two steps.</p><ol class="enumar"><li><p><span style="display: none;" class="delete_version">Cast the <var>SV</var>, up the hierarchy, to the <a title="primitive type" class="termref" href="#dt-primitive-type">primitive type</a> of the source, as described in <a href="#casting-from-derived-to-parent"><span class="delete_version"><b>23.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b>23.3.4 Casting from derived types to parent types</b></span></a>.</span><span style="display: none;" class="add_version">Cast the <var>SV</var>, up the hierarchy, to the <a title="primitive type" class="termref" href="#dt-primitive-type">primitive type</a> of the source, as described in <a href="#casting-from-derived-to-parent"><span class="add_version"><b>24.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b>24.3.4 Casting from derived types to parent types</b></span></a>.</span><span class="modify_version">Cast the <var>SV</var>, up the hierarchy, to the <a title="primitive type" class="termref" href="#dt-primitive-type">primitive type</a> of the source, as described in <a href="#casting-from-derived-to-parent"><span style="display: none;" class="delete_version"><b>23.3.4 Casting from derived types to parent types</b></span><span style="display: none;" class="add_version"><b>24.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.4</span><span class="deltaxml-new" style="background:#90EE90">24.3.4</span> Casting from derived types to parent types</b></span></a>.</span></p><ol class="enumla"><li><p> If <var>SV</var> is an instance of <code>xs:string</code> or <code>xs:untypedAtomic</code>, check its value against the pattern facet of <var>TT</var>, and raise a dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>] if the check fails.</p></li></ol></li><li><p><span style="display: none;" class="delete_version">Let <var>P(TT)</var> be the most specific primitive or quasi-primitive type of which <var>TT</var> is a subtype, as described in <a href="#casting-to-derived-types"><span class="delete_version"><b>23.3.1 Casting to derived types</b></span><span class="modify_version"><b>23.3.1 Casting to derived types</b></span></a>.</span><span style="display: none;" class="add_version">Let <var>P(TT)</var> be the most specific primitive or quasi-primitive type of which <var>TT</var> is a subtype, as described in <a href="#casting-to-derived-types"><span class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b>24.3.1 Casting to derived types</b></span></a>.</span><span class="modify_version">Let <var>P(TT)</var> be the most specific primitive or quasi-primitive type of which <var>TT</var> is a subtype, as described in <a href="#casting-to-derived-types"><span style="display: none;" class="delete_version"><b>23.3.1 Casting to derived types</b></span><span style="display: none;" class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> Casting to derived types</b></span></a>.</span></p><p><span style="display: none;" class="delete_version">Cast the value to <var>P(TT)</var>, as described in <a href="#casting-from-primitive-to-primitive"><span class="delete_version"><b>23.1 Casting from primitive types to primitive types</b></span><span class="modify_version"><b>23.1 Casting from primitive types to primitive types</b></span></a> if <var>P(TT)</var> is primitive, or as described in <a href="#casting-to-derived-types"><span class="delete_version"><b>23.3.1 Casting to derived types</b></span><span class="modify_version"><b>23.3.1 Casting to derived types</b></span></a> if <var>P(TT)</var> is quasi-primitive.</span><span style="display: none;" class="add_version">Cast the value to <var>P(TT)</var>, as described in <a href="#casting-from-primitive-to-primitive"><span class="add_version"><b>24.1 Casting from primitive types to primitive types</b></span><span class="modify_version"><b>24.1 Casting from primitive types to primitive types</b></span></a> if <var>P(TT)</var> is primitive, or as described in <a href="#casting-to-derived-types"><span class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b>24.3.1 Casting to derived types</b></span></a> if <var>P(TT)</var> is quasi-primitive.</span><span class="modify_version">Cast the value to <var>P(TT)</var>, as described in <a href="#casting-from-primitive-to-primitive"><span style="display: none;" class="delete_version"><b>23.1 Casting from primitive types to primitive types</b></span><span style="display: none;" class="add_version"><b>24.1 Casting from primitive types to primitive types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1</span><span class="deltaxml-new" style="background:#90EE90">24.1</span> Casting from primitive types to primitive types</b></span></a> if <var>P(TT)</var> is primitive, or as described in <a href="#casting-to-derived-types"><span style="display: none;" class="delete_version"><b>23.3.1 Casting to derived types</b></span><span style="display: none;" class="add_version"><b>24.3.1 Casting to derived types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.1</span><span class="deltaxml-new" style="background:#90EE90">24.3.1</span> Casting to derived types</b></span></a> if <var>P(TT)</var> is quasi-primitive.</span></p><p>If <var>TT</var> is derived from <code>xs:NOTATION</code>, assume for the purposes of this rule that casting to <code>xs:NOTATION</code> succeeds.</p></li><li><p><span style="display: none;" class="delete_version">Cast the value down to the target type <var>TT</var>, as described in <a href="#casting-within-branch"><span class="delete_version"><b>23.3.5 Casting within a branch of the type hierarchy</b></span><span class="modify_version"><b>23.3.5 Casting within a branch of the type hierarchy</b></span></a></span><span style="display: none;" class="add_version">Cast the value down to the target type <var>TT</var>, as described in <a href="#casting-within-branch"><span class="add_version"><b>24.3.5 Casting within a branch of the type hierarchy</b></span><span class="modify_version"><b>24.3.5 Casting within a branch of the type hierarchy</b></span></a></span><span class="modify_version">Cast the value down to the target type <var>TT</var>, as described in <a href="#casting-within-branch"><span style="display: none;" class="delete_version"><b>23.3.5 Casting within a branch of the type hierarchy</b></span><span style="display: none;" class="add_version"><b>24.3.5 Casting within a branch of the type hierarchy</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.5</span><span class="deltaxml-new" style="background:#90EE90">24.3.5</span> Casting within a branch of the type hierarchy</b></span></a></span></p></li></ol></div><div class="div3"><h4><a id="casting-to-union"></a><span class="deltaxml-old" style="background:#FF5555">23.3.7</span><span class="deltaxml-new" style="background:#90EE90">24.3.7</span> <a href="#casting-to-union" style="text-decoration: none">Casting to union types</a></h4><p>If the target type of a cast expression (or a constructor function) is a type with variety union, the supplied value must be one of the following:</p><ol class="enumar"><li><p><span style="display: none;" class="delete_version">A value of type <code>xs:string</code> or <code>xs:untypedAtomic</code>. This case follows the general rules for casting from strings, and has already been described in <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span style="display: none;" class="add_version">A value of type <code>xs:string</code> or <code>xs:untypedAtomic</code>. This case follows the general rules for casting from strings, and has already been described in <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span class="modify_version">A value of type <code>xs:string</code> or <code>xs:untypedAtomic</code>. This case follows the general rules for casting from strings, and has already been described in <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>.</span></p><p>If the union type has a pattern facet, the pattern is tested against the supplied value after whitespace normalization, using the <code>whiteSpace</code> normalization rules of the member datatype against which validation succeeds.</p></li><li><p>A value that is an instance of one of the atomic types in the transitive membership of the union type, and of the union type itself. This case has already been described in <a href="#casting-from-derived-to-parent"><span style="display: none;" class="delete_version"><b>23.3.4 Casting from derived types to parent types</b></span><span style="display: none;" class="add_version"><b>24.3.4 Casting from derived types to parent types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.3.4</span><span class="deltaxml-new" style="background:#90EE90">24.3.4</span> Casting from derived types to parent types</b></span></a></p><p>This situation only applies when the value is an instance of the union type, which means it will never apply when the union is derived by facet-based restriction from another union type.</p></li><li><p>A value that is castable to one or more of the atomic types in the transitive membership of the union type (in the sense that the <code>castable as</code> operator returns <code>true</code>).</p><p>In this case the supplied value is cast to each atomic type in the transitive membership of the union type in turn (in the order in which the member types appear in the declaration) until one of these casts is successful; if none of them is successful, a dynamic error occurs [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>]. If the union type has constraining facets then the resulting value must satisfy these facets, otherwise a dynamic error occurs [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>].</p><p>If the union type has a pattern facet, the pattern is tested against the canonical representation of the result value.</p><p><span style="display: none;" class="delete_version">Only the atomic types in the transitive membership of the union type are considered. The union type may have list types in its transitive membership, but (unless the supplied value is of type <code>xs:string</code> or <code>xs:untypedAtomic</code>, in which case the rules in <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a> apply), any list types in the membership are effectively ignored.</span><span style="display: none;" class="add_version">Only the atomic types in the transitive membership of the union type are considered. The union type may have list types in its transitive membership, but (unless the supplied value is of type <code>xs:string</code> or <code>xs:untypedAtomic</code>, in which case the rules in <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a> apply), any list types in the membership are effectively ignored.</span><span class="modify_version">Only the atomic types in the transitive membership of the union type are considered. The union type may have list types in its transitive membership, but (unless the supplied value is of type <code>xs:string</code> or <code>xs:untypedAtomic</code>, in which case the rules in <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a> apply), any list types in the membership are effectively ignored.</span></p></li></ol><p>If more than one of these conditions applies, then the casting is done according to the rules for the first condition that applies.</p><p>If none of these conditions applies, the cast fails with a dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>].</p><p>Example: consider a type <var>U</var> whose member types are <code>xs:integer</code> and <code>xs:date</code>.</p><ul><li><p>The expression <code>"123" cast as U</code> returns the <code>xs:integer</code> value <code>123</code>.</p></li><li><p>The expression <code>current-date() cast as U</code> returns the current date as an instance of <code>xs:date</code>.</p></li><li><p>The expression <code>23.1 cast as U</code> returns the <code>xs:integer</code> value <code>23</code>.</p></li></ul><p>Example: consider a type <var>V</var> whose member types are <code>xs:short</code> and <code>xs:negativeInteger</code>.</p><ul><li><p>The expression <code>"-123" cast as V</code> returns the <code>xs:short</code> value <code>-123</code>.</p></li><li><p>The expression <code>"-100000" cast as V</code> returns the <code>xs:negativeInteger</code> value <code>-100000</code>.</p></li><li><p>The expression <code>93.7 cast as V</code> returns the <code>xs:short</code> value <code>93</code>.</p></li><li><p>The expression <code>"93.7" cast as V</code> raises a dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>] on the grounds that the string <code>"93.7"</code> is not in the lexical space of the union type.</p></li></ul><p>Example: consider a type <var>W</var> that is derived from the above type <var>V</var> by restriction, with a pattern facet of <code>-?\d\d</code>.</p><ul><li><p>The expression <code>"12" cast as V</code> returns the <code>xs:short</code> value <code>12</code>.</p></li><li><p>The expression <code>"123" cast as V</code> raises an dynamic error [<a href="#ERRFORG0001" title="err:FORG0001">err:FORG0001</a>] on the grounds that the string <code>"123"</code> does not match the pattern facet.</p></li></ul></div><div class="div3"><h4><a id="casting-to-list"></a><span class="deltaxml-old" style="background:#FF5555">23.3.8</span><span class="deltaxml-new" style="background:#90EE90">24.3.8</span> <a href="#casting-to-list" style="text-decoration: none">Casting to list types</a></h4><p><span style="display: none;" class="delete_version">If the target type of a cast expression (or a constructor function) is a type with variety <code>list</code>, the supplied value must be of type <code>xs:string</code> or <code>xs:untypedAtomic</code>. The rules follow the general principle for all casts from <code>xs:string</code> outlined in <a href="#casting-from-strings"><span class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span style="display: none;" class="add_version">If the target type of a cast expression (or a constructor function) is a type with variety <code>list</code>, the supplied value must be of type <code>xs:string</code> or <code>xs:untypedAtomic</code>. The rules follow the general principle for all casts from <code>xs:string</code> outlined in <a href="#casting-from-strings"><span class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span></a>.</span><span class="modify_version">If the target type of a cast expression (or a constructor function) is a type with variety <code>list</code>, the supplied value must be of type <code>xs:string</code> or <code>xs:untypedAtomic</code>. The rules follow the general principle for all casts from <code>xs:string</code> outlined in <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a>.</span></p><p>If the supplied value is not of type <code>xs:string</code> or <code>xs:untypedAtomic</code>, a type error is raised [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>.</p><p>The semantics of the operation are consistent with validation: that is, the effect of casting a string <var>S</var> to a list type <var>L</var> is the same as constructing an element or attribute node whose string value is <var>S</var>, validating it using <var>L</var> as the governing type, and atomizing the resulting node. The result will always be either failure, or a sequence of zero or more atomic items each of which is an instance of the item type of <var>L</var> (or if the item type of <var>L</var> is a union type, an instance of one of the atomic types in its transitive membership).</p><p>If the item type of the list type is namespace-sensitive, then the namespace bindings in the static context will be used to resolve any namespace prefix, in the same way as when the target type is <code>xs:QName</code>.</p><p>If the list type has a <code>pattern</code> facet, the pattern must match the supplied value after collapsing whitespace (an operation equivalent to the use of the <a href="#func-normalize-space"><code>fn:normalize-space</code></a> function).</p><p>For example, the expression <code>cast "A B C D" as xs:NMTOKENS</code> produces a sequence of four <code>xs:NMTOKEN</code> values, <code>("A", "B", "C", "D")</code>.</p><p>For example, given a user-defined type <code>my:coordinates</code> defined as a list of <code>xs:integer</code> with the facet <code>&lt;xs:length value="2"/&gt;</code>, the expression <code>my:coordinates("2 -1")</code> will return a sequence of two xs:integer values <code>(2, -1)</code>, while the expression <code>my:coordinates("1 2 3")</code> will result in a dynamic error because the length of the list does not conform to the <code>length</code> facet. The expression <code>my:coordinates("1.0 3.0")</code> will also fail because the strings <code>1.0</code> and <code>3.0</code> are not in the lexical space of <code>xs:integer</code>.</p></div></div></div></div><div class="back"><div class="div1"><h2><a id="biblio"></a>A <a href="#biblio" style="text-decoration: none">References</a></h2><div class="div2"><h3><a id="normative-biblio"></a>A.1 <a href="#normative-biblio" style="text-decoration: none">Normative references</a></h3><dl><dt class="label"><span><a id="charmod"></a>Character Model for the World Wide Web 1.0: Fundamentals</span></dt><dd><div><a href="https://www.w3.org/TR/charmod/"><cite>Character Model for the World Wide Web 1.0: Fundamentals</cite></a>, Martin J. Dürst, François Yergeau, <em>et. al.</em>, Editors. World Wide Web Consortium, 15 February 2015. This version is http://www.w3.org/TR/2005/REC-charmod-20050215/. The <a href="https://www.w3.org/TR/charmod/">latest version</a> is available at https://www.w3.org/TR/charmod/.</div></dd><dt class="label"><span><a id="html5"></a>HTML: Living Standard</span></dt><dd><div><a href="https://html.spec.whatwg.org/"><cite>HTML: Living Standard</cite></a>. WHATWG, 18 November 2022.</div></dd><dt class="label"><span><a id="dom-ls"></a>DOM: Living Standard</span></dt><dd><div><a href="https://dom.spec.whatwg.org/"><cite>DOM: Living Standard</cite></a>. WHATWG, 26 October 2022.</div></dd><dt class="label"><span><a id="olson"></a>IANA Timezone Database</span></dt><dd><div> The <em>tz</em> timezone database, available at <a href="http://www.iana.org/time-zones">http://www.iana.org/time-zones</a>. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which version of the database is used. </div></dd><dt class="label"><span><a id="ieee754-2019"></a>IEEE 754-2019</span></dt><dd><div>IEEE. <em>IEEE Standard for Floating-Point Arithmetic.</em></div></dd><dt class="label"><span><a id="ieee1003.1-2024"></a>IEEE 1003.1-2024</span></dt><dd><div><a href="https://pubs.opengroup.org/onlinepubs/9799919799/functions/time.html"><cite>Open Group Base Specifications Issue 8</cite></a>. IEEE, 2024. </div></dd><dt class="label"><span><a id="ieee802-3"></a>IEEE 802-3</span></dt><dd><div>“IEEE Standard for Ethernet,” in IEEE Std 802.3-2022 (Revision of IEEE Std 802.3-2018). 29 July 2022. doi: 10.1109/IEEESTD.2022.9844436. </div></dd><dt class="label"><span><a id="ISO3166"></a>ISO 3166-1</span></dt><dd><div>ISO (International Organization for Standardization) <em>Codes for the representation of names of countries and their subdivisions - Part 1: Country codes</em> ISO 3166-1:2013. </div></dd><dt class="label"><span><a id="ISO8601"></a>ISO 8601</span></dt><dd><div>ISO (International Organization for Standardization). <em>Representations of dates and times. Third edition, 2004-12-01.</em> ISO 8601:2004(E). Available from: <a href="http://www.iso.org/">http://www.iso.org/"</a>. </div></dd><dt class="label"><span><a id="ISO10967"></a>ISO 10967</span></dt><dd><div>ISO (International Organization for Standardization). <em>ISO/IEC 10967-1:2012, Information technology—Language Independent Arithmetic—Part 1: Integer and floating point arithmetic</em> [Geneva]: International Organization for Standardization, 2012. Available from: <a href="http://www.iso.org/">http://www.iso.org/</a>. </div></dd><dt class="label"><span><a id="ISO15924"></a>ISO 15924</span></dt><dd><div>ISO (International Organization for Standardization) <em>Information and documentation — Codes for the representation of names of scripts</em> ISO 15924:2004, January 2004.</div></dd><dt class="label"><span><a id="ISO15924_register"></a>ISO 15924 Register</span></dt><dd><div>Unicode Consortium. <em>Codes for the representation of names of scripts — Alphabetical list of four-letter script codes.</em> See <a href="http://www.unicode.org/iso15924/iso15924-codes.html">http://www.unicode.org/iso15924/iso15924-codes.html</a>. Retrieved February 2013; continually updated.</div></dd><dt class="label"><span><a id="LEIRI"></a>Legacy extended IRIs for XML resource identification</span></dt><dd><div><em>Legacy extended IRIs for XML resource identification</em>. Henry S. Thomson, Richard Tobin, and Norman Walsh (eds), World Wide Web Consortium. 3 November 2008. Available at <a href="http://www.w3.org/TR/leiri/">http://www.w3.org/TR/leiri/</a>. </div></dd><dt class="label"><span><a id="rfc1321"></a>RFC 1321</span></dt><dd><div>IETF. <em>RFC 1321: The MD5 Message-Digest Algorithm. </em> Available at: <a href="http://www.ietf.org/rfc/rfc1321.txt">http://www.ietf.org/rfc/rfc1321.txt</a>. </div></dd><dt class="label"><span><a id="rfc2376"></a>RFC 2376</span></dt><dd><div>IETF. <em>RFC 2376: XML Media Types. </em> Available at: <a href="http://www.ietf.org/rfc/rfc2376.txt">http://www.ietf.org/rfc/rfc2376.txt</a>. </div></dd><dt class="label"><span><a id="rfc3986"></a>RFC 3986</span></dt><dd><div>IETF. <em>RFC 3986: Uniform Resource Identifiers (URI): Generic Syntax. </em> Available at: <a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</a>. </div></dd><dt class="label"><span><a id="rfc3987"></a>RFC 3987</span></dt><dd><div>IETF. <em>RFC 3987: Internationalized Resource Identifiers (IRIs).</em> Available at: <a href="http://www.ietf.org/rfc/rfc3987.txt">http://www.ietf.org/rfc/rfc3987.txt</a>. </div></dd><dt class="label"><span><a id="rfc4180"></a>RFC 4180</span></dt><dd><div>IETF. <em>RFC 4180: Common Format and MIME Type for Comma-Separated Values (CSV) Files.</em> Available at: <a href="http://www.ietf.org/rfc/rfc4180.txt">http://www.ietf.org/rfc/rfc4180.txt</a>. </div></dd><dt class="label"><span><a id="rfc6151"></a>RFC 6151</span></dt><dd><div>IETF. <em>RFC 6151: Updated Security Considerations for the MD5 Message-Digest and the HMAC-MD5 Algorithms</em> Available at: <a href="http://www.ietf.org/rfc/rfc6151.txt">http://www.ietf.org/rfc/rfc6151.txt</a>. </div></dd><dt class="label"><span><a id="rfc7159"></a>RFC 7159</span></dt><dd><div>IETF. <em>RFC 7159: The Javascript Object Notation (JSON) Data Interchange Format</em> Available at: <a href="http://www.rfc-editor.org/rfc/rfc7159.txt">http://www.rfc-editor.org/rfc/rfc7159.txt</a>. </div></dd><dt class="label"><span><a id="rfc7303"></a>RFC 7303</span></dt><dd><div>H. Thompson and C. Lilley. <em>XML Media Types</em>. IETF RFC 7303. See <a href="http://www.ietf.org/rfc/rfc7303.txt">http://www.ietf.org/rfc/rfc7303.txt</a>.</div></dd><dt class="label"><span><a id="fips180-4"></a>FIPS 180-4</span></dt><dd><div>National Institute of Standards and Technology. <em>Secure Hash Standard (SHS)</em>. FIPS PUB 180-4. August 2015. See <a href="http://dx.doi.org/10.6028/NIST.FIPS.180-4">http://dx.doi.org/10.6028/NIST.FIPS.180-4</a>. </div></dd><dt class="label"><span><a id="UNICODE-TR15"></a>UAX #15</span></dt><dd><div><em>Unicode Standard Annex #15: Unicode Normalization Forms</em>. Ed. Mark Davis and Ken Whistler, Unicode Consortium. The current version is 16.0.0, dated 2024-08-14. As with <a href="#Unicode">[The Unicode Standard]</a>, the version to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Available at: <a href="http://www.unicode.org/reports/tr15/">http://www.unicode.org/reports/tr15/</a>. </div></dd><dt class="label"><span><a id="UNICODE-TR29"></a>UAX #29</span></dt><dd><div><em>Unicode Standard Annex #29: Unicode Text Segmentation</em>. Ed. Josh Hadley, Unicode Consortium. The current version is 16.0.0, dated 2024-08-28. As with <a href="#Unicode">[The Unicode Standard]</a>, the version to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Available at: <a href="http://www.unicode.org/reports/tr29/">http://www.unicode.org/reports/tr29/</a>. </div></dd><dt class="label"><span><a id="Unicode"></a>The Unicode Standard</span></dt><dd><div> The Unicode Consortium, Reading, MA, Addison-Wesley, 2016. <em>The Unicode Standard</em> as updated from time to time by the publication of new versions. See <a href="http://www.unicode.org/standard/versions/">http://www.unicode.org/standard/versions/</a> for the latest version and additional information on versions of the standard and of the Unicode Character Database. The version of Unicode to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but implementations are recommended to use the latest Unicode version; currently, Version 9.0.0. </div></dd><dt class="label"><span><a id="UNICODE-TR10"></a>UTS #10</span></dt><dd><div><em>Unicode Technical Standard #10: Unicode Collation Algorithm</em>. Ed. Mark Davis and Ken Whistler, Unicode Consortium. The current version is 16.0.0, dated 2024-08-22. As with <a href="#Unicode">[The Unicode Standard]</a>, the version to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Available at: <a href="http://www.unicode.org/reports/tr10/">http://www.unicode.org/reports/tr10/</a>.</div></dd><dt class="label"><span><a id="UNICODE-TR35"></a>UTS #35</span></dt><dd><div><em>Unicode Technical Standard #35: Unicode Locale Data Markup Language</em>. Ed Mark Davis <em>et al</em>, Unicode Consortium. The current version is 47, dated 2025-03-11. As with <a href="#Unicode">[The Unicode Standard]</a>, the version to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Available at: <a href="http://www.unicode.org/reports/tr35/">http://www.unicode.org/reports/tr35/</a>.</div></dd><dt class="label"><span><a id="XINFO"></a>XML Infoset</span></dt><dd><div>World Wide Web Consortium. <em>XML Information Set (Second Edition).</em> W3C Recommendation 4 February 2004. See <a href="http://www.w3.org/TR/xml-infoset/">http://www.w3.org/TR/xml-infoset/</a></div></dd><dt class="label"><span><a id="xml"></a>Extensible Markup Language (XML) 1.0 (Fifth Edition)</span></dt><dd><div><a href="http://www.w3.org/TR/xml/"><cite>Extensible Markup Language (XML) 1.0 (Fifth Edition)</cite></a>, Tim Bray, Jean Paoli, Michael Sperberg-McQueen, <em>et. al.</em>, Editors. World Wide Web Consortium, 26&nbsp;Nov&nbsp;2008. This version is http://www.w3.org/TR/2008/REC-xml-20081126/. The <a href="http://www.w3.org/TR/xml/">latest version</a> is available at http://www.w3.org/TR/xml.</div></dd><dt class="label"><span><a id="xml11"></a>Extensible Markup Language (XML) 1.1 Recommendation</span></dt><dd><div><a href="http://www.w3.org/TR/xml11/"><cite>Extensible Markup Language (XML) 1.1 (Second Edition)</cite></a>, Tim Bray, Jean Paoli, Michael Sperberg-McQueen, <em>et. al.</em>, Editors. World Wide Web Consortium, 16&nbsp;Aug&nbsp;2006. This version is http://www.w3.org/TR/2006/REC-xml11-20060816. The <a href="http://www.w3.org/TR/xml11/">latest version</a> is available at http://www.w3.org/TR/xml11/.</div></dd><dt class="label"><span><a id="xpath"></a>XML Path Language (XPath) Version 1.0</span></dt><dd><div><a href="http://www.w3.org/TR/xpath/"><cite>XML Path Language (XPath) Version 1.0</cite></a>, James Clark and Steven DeRose, Editors. World Wide Web Consortium, 16&nbsp;Nov&nbsp;1999. This version is http://www.w3.org/TR/1999/REC-xpath-19991116. The <a href="http://www.w3.org/TR/xpath/">latest version</a> is available at http://www.w3.org/TR/xpath.</div></dd><dt class="label"><span><a id="xpath-40"></a>XML Path Language (XPath) 4.0</span></dt><dd><div><em>CITATION: T.B.D.</em></div></dd><dt class="label"><span><a id="binary-40"></a>EXPath Binary Module 4.0</span></dt><dd><div><em>CITATION: T.B.D.</em></div></dd><dt class="label"><span><a id="xslt10"></a>XSL Transformations (XSLT) Version 1.0</span></dt><dd><div><a href="https://www.w3.org/TR/xslt/"><cite>XSL Transformations (XSLT) Version 1.0</cite></a>, James Clark, Editor. World Wide Web Consortium, 16 November 1999. This version is https://www.w3.org/TR/1999/REC-xslt-19991116/. The <a href="https://www.w3.org/TR/xslt/">latest version</a> is available at https://www.w3.org/TR/xslt/.</div></dd><dt class="label"><span><a id="xslt20"></a>XSL Transformations (XSLT) Version 2.0</span></dt><dd><div><a href="https://www.w3.org/TR/xslt20/"><cite>XSL Transformations (XSLT) Version 2.0 (Second Edition)</cite></a>, Michael Kay, Editor. World Wide Web Consortium, 23 January 2007. This version is https://www.w3.org/TR/2007/REC-xslt20-20070123/. The <a href="https://www.w3.org/TR/xslt20/">latest version</a> is available at https://www.w3.org/TR/xslt20/.</div></dd><dt class="label"><span><a id="xslt-40"></a>XSL Transformations (XSLT) Version 4.0</span></dt><dd><div><em>CITATION: T.B.D.</em></div></dd><dt class="label"><span><a id="xpath-datamodel-30"></a>XQuery and XPath Data Model (XDM) 3.0</span></dt><dd><div><a href="https://www.w3.org/TR/xpath-datamodel-30/"><cite>XQuery and XPath Data Model (XDM) 3.0</cite></a>, Norman Walsh, Anders Berglund, John Snelson, Editors. World Wide Web Consortium, 08 April 2014. This version is https://www.w3.org/TR/2014/REC-xpath-datamodel-30-20140408/. The <a href="https://www.w3.org/TR/xpath-datamodel-30/">latest version</a> is available at https://www.w3.org/TR/xpath-datamodel-30/.</div></dd><dt class="label"><span><a id="xpath-datamodel-31"></a>XQuery and XPath Data Model (XDM) 3.1</span></dt><dd><div><a href="https://www.w3.org/TR/xpath-datamodel-31/"><cite>XQuery and XPath Data Model (XDM) 3.1</cite></a>, Norman Walsh, John Snelson, Andrew Coleman, Editors. World Wide Web Consortium, 21 March 2017. This version is https://www.w3.org/TR/2017/REC-xpath-datamodel-31-20170321/. The <a href="https://www.w3.org/TR/xpath-datamodel-31/">latest version</a> is available at https://www.w3.org/TR/xpath-datamodel-31/.</div></dd><dt class="label"><span><a id="xpath-datamodel-40"></a>XQuery and XPath Data Model (XDM) 4.0</span></dt><dd><div><a href="../xpath-datamodel-40/Overview.html"><cite>XQuery and XPath Data Model (XDM) 4.0</cite></a>, XSLT Extensions Community Group, World Wide Web Consortium.</div></dd><dt class="label"><span><a id="xslt-xquery-serialization-31"></a>XSLT and XQuery Serialization 3.1</span></dt><dd><div><a href="https://www.w3.org/TR/xslt-xquery-serialization-31/"><cite>XSLT and XQuery Serialization 3.1</cite></a>, Andrew Coleman and Michael Sperberg-McQueen, Editors. World Wide Web Consortium, 21 March 2017. This version is https://www.w3.org/TR/2017/REC-xslt-xquery-serialization-31-20170321/. The <a href="https://www.w3.org/TR/xslt-xquery-serialization-31/">latest version</a> is available at https://www.w3.org/TR/xslt-xquery-serialization-31/.</div></dd><dt class="label"><span><a id="xquery-semantics"></a>XQuery 1.0 and XPath 2.0 Formal Semantics</span></dt><dd><div><a href="https://www.w3.org/TR/xquery-semantics/"><cite>XQuery 1.0 and XPath 2.0 Formal Semantics (Second Edition)</cite></a>, Jérôme Siméon, Denise Draper, Peter Frankhauser, <em>et. al.</em>, Editors. World Wide Web Consortium, 14 December 2010. This version is https://www.w3.org/TR/2010/REC-xquery-semantics-20101214/. The <a href="https://www.w3.org/TR/xquery-semantics/">latest version</a> is available at https://www.w3.org/TR/xquery-semantics/.</div></dd><dt class="label"><span><a id="xquery-40"></a>XQuery 4.0: An XML Query Language</span></dt><dd><div><em>CITATION: T.B.D.</em></div></dd><dt class="label"><span><a id="xinclude"></a>XML Inclusions (XInclude) Version 1.0 (Second Edition)</span></dt><dd><div><a href="http://www.w3.org/TR/xinclude/"><cite>XML Inclusions (XInclude) Version 1.0 (Second Edition)</cite></a>, Jonathan Marsh, David Orchard, and Daniel Veillard, Editors. World Wide Web Consortium, 15&nbsp;Nov&nbsp;2006. This version is http://www.w3.org/TR/2006/REC-xinclude-20061115/. The <a href="http://www.w3.org/TR/xinclude/">latest version</a> is available at http://www.w3.org/TR/xinclude/.</div></dd><dt class="label"><span><a id="xmlschema-1"></a>XML Schema Part 1: Structures Second Edition</span></dt><dd><div> XML Schema Part 1: Structures Second Edition, Oct 28 2004. Available at: <a href="http://www.w3.org/TR/xmlschema-1/">http://www.w3.org/TR/xmlschema-1/</a></div></dd><dt class="label"><span><a id="xmlschema-2"></a>XML Schema Part 2: Datatypes Second Edition</span></dt><dd><div> XML Schema Part 2: Datatypes Second Edition, Oct. 28 2004. Available at: <a href="http://www.w3.org/TR/xmlschema-2/">http://www.w3.org/TR/xmlschema-2/</a></div></dd><dt class="label"><span><a id="xmlschema11-1"></a>XSD 1.1 Part 1</span></dt><dd><div><a href="http://www.w3.org/TR/xmlschema11-1/"><cite>W3C XML Schema Definition Language (XSD) 1.1 Part 1: Structures</cite></a>, Sandy Gao, Michael Sperberg-McQueen, Henry Thompson, <em>et. al.</em>, Editors. World Wide Web Consortium, 05&nbsp;Apr&nbsp;2012. This version is http://www.w3.org/TR/2012/REC-xmlschema11-1-20120405/. The <a href="http://www.w3.org/TR/xmlschema11-1/">latest version</a> is available at http://www.w3.org/TR/xmlschema11-1/.</div></dd><dt class="label"><span><a id="xmlschema11-2"></a>XSD 1.1 Part 2</span></dt><dd><div><a href="http://www.w3.org/TR/xmlschema11-2/"><cite>W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes</cite></a>, David Peterson, Sandy Gao, Ashok Malhotra, <em>et. al.</em>, Editors. World Wide Web Consortium, 05&nbsp;Apr&nbsp;2012. This version is http://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/. The <a href="http://www.w3.org/TR/xmlschema11-2/">latest version</a> is available at http://www.w3.org/TR/xmlschema11-2/.</div></dd><dt class="label"><span><a id="xml-names"></a>Namespaces in XML</span></dt><dd><div><a href="http://www.w3.org/TR/xml-names/"><cite>Namespaces in XML 1.0 (Third Edition)</cite></a>, Tim Bray, Dave Hollander, Andrew Layman, <em>et. al.</em>, Editors. World Wide Web Consortium, 08&nbsp;Dec&nbsp;2009. This version is http://www.w3.org/TR/2009/REC-xml-names-20091208/. The <a href="http://www.w3.org/TR/xml-names/">latest version</a> is available at http://www.w3.org/TR/xml-names/.</div></dd><dt class="label"><span><a id="invisible-xml"></a>Invisible XML</span></dt><dd><div><a href="https://invisiblexml.org/1.0/"><cite>Invisible XML Specification</cite></a>, Steven Pemberton, editor. World Wide Web Consortium, 20 June 2020. This version is https://invisiblexml.org/1.0/. The <a href="https://invisiblexml.org/current/">latest version</a> is available at https://invisiblexml.org/current/.</div></dd></dl></div><div class="div2"><h3><a id="non-normative-biblio"></a>A.2 <a href="#non-normative-biblio" style="text-decoration: none">Non-normative references</a></h3><dl><dt class="label"><span><a id="BLAKE3"></a>BLAKE3 Hashing</span></dt><dd><div><em>Blake3 Algorithm Specification</em>. Available at: <a href="https://github.com/BLAKE3-team/BLAKE3-specs/blob/master/blake3.pdf">https://github.com/BLAKE3-team/BLAKE3-specs/blob/master/blake3.pdf</a></div></dd><dt class="label"><span><a id="CALCALC"></a>Calendrical Calculations</span></dt><dd><div>Edward M. Reingold and Nachum Dershowitz. <em>Calendrical Calculations Millennium edition (2nd Edition)</em>. Cambridge University Press, ISBN 0 521 77752 6.</div></dd><dt class="label"><span><a id="CLDR"></a>Unicode CLDR</span></dt><dd><div>CLDR - Unicode Common Locale Data Repository. Available at: <a href="http://cldr.unicode.org">http://cldr.unicode.org</a>.</div></dd><dt class="label"><span><a id="charmod-normalization"></a>Character Model for the World Wide Web 1.0: Normalization</span></dt><dd><div>Character Model for the World Wide Web 1.0: Normalization, Last Call Working Draft. Available at: <a href="http://www.w3.org/TR/2004/WD-charmod-norm-20040225/">http://www.w3.org/TR/2004/WD-charmod-norm-20040225/</a>. </div></dd><dt class="label"><span><a id="expath"></a>EXPath</span></dt><dd><div>EXPath: Collaboratively Defining Open Standards for Portable XPath Extensions. <a href="http://expath.org/">http://expath.org/</a>.</div></dd><dt class="label"><span><a id="exquery"></a>EXQuery</span></dt><dd><div>EXQuery: Collaboratively Defining Open Standards for Portable XQuery Extensions. <a href="http://exquery.org/">http://exquery.org/</a>.</div></dd><dt class="label"><span><a id="exslt"></a>EXSLT</span></dt><dd><div>EXSLT: A Community Initiative to Provide Extensions to XSLT. <a href="https://exslt.github.io">https://exslt.github.io</a>.</div></dd><dt class="label"><span><a id="functx"></a>FunctX</span></dt><dd><div>FunctX Functions. <a href="http://www.functx.com/">http://www.functx.com/</a>.</div></dd><dt class="label"><span><a id="Goessner"></a>Goessner</span></dt><dd><div>Stefan Goessner. Converting Between XML and JSON. <a href="https://www.xml.com/pub/a/2006/05/31/converting-between-xml-and-json.html">https://www.xml.com/pub/a/2006/05/31/converting-between-xml-and-json.html</a>. 31 May 2006.</div></dd><dt class="label"><span><a id="HTML40"></a>HTML 4.0</span></dt><dd><div>HTML 4.01 Recommendation, 24 December 1999. Available at: <a href="http://www.w3.org/TR/REC-html40/">http://www.w3.org/TR/REC-html40/</a>. </div></dd><dt class="label"><span><a id="ICU"></a>ICU</span></dt><dd><div>ICU - International Components for Unicode. Available at <a href="http://site.icu-project.org">http://site.icu-project.org</a>. </div></dd><dt class="label"><span><a id="POSIX.1-2008"></a>POSIX.1-2008</span></dt><dd><div><em>The Open Group Base Specifications Issue 7 (IEEE Std 1003.1-2008)</em>. Available at: <a href="http://pubs.opengroup.org/onlinepubs/9699919799/">http://pubs.opengroup.org/onlinepubs/9699919799/</a>. </div></dd><dt class="label"><span><a id="rfc822"></a>RFC 822</span></dt><dd><div>IETF. <em>RFC 822: Standard for the Format of ARPA Internet Text Messages. </em> Available at: <a href="http://www.ietf.org/rfc/rfc822.txt">http://www.ietf.org/rfc/rfc822.txt</a>. </div></dd><dt class="label"><span><a id="rfc850"></a>RFC 850</span></dt><dd><div>IETF. <em>RFC 850: Standard for Interchange of USENET Messages. </em> Available at: <a href="http://www.ietf.org/rfc/rfc850.txt">http://www.ietf.org/rfc/rfc850.txt</a>. </div></dd><dt class="label"><span><a id="rfc1036"></a>RFC 1036</span></dt><dd><div>IETF. <em>RFC 1036: Standard for Interchange of USENET Messages. </em> Available at: <a href="http://www.ietf.org/rfc/rfc1036.txt">http://www.ietf.org/rfc/rfc1036.txt</a>. </div></dd><dt class="label"><span><a id="rfc1123"></a>RFC 1123</span></dt><dd><div>IETF. <em>RFC 1123: Requirements for Internet Hosts -- Application and Support. </em> Available at: <a href="http://www.ietf.org/rfc/rfc1123.txt">http://www.ietf.org/rfc/rfc1123.txt</a>. </div></dd><dt class="label"><span><a id="rfc2616"></a>RFC 2616</span></dt><dd><div>IETF. <em>RFC 2616: Hypertext Transfer Protocol -- HTTP/1.1. </em> Available at: <a href="http://www.ietf.org/rfc/rfc2616.txt">http://www.ietf.org/rfc/rfc2616.txt</a>. </div></dd><dt class="label"><span><a id="rfc3339"></a>RFC 3339</span></dt><dd><div>IETF. <em>RFC 3339: Date and Time on the Internet: Timestamps. </em> Available at: <a href="http://www.ietf.org/rfc/rfc3339.txt">http://www.ietf.org/rfc/rfc3339.txt</a>. </div></dd><dt class="label"><span><a id="UNICODE-TR18"></a>UTS #18</span></dt><dd><div><em>Unicode Technical Standard #18: Unicode Regular Expressions</em>. Ed. Mark Davis and Andy Heniger, Unicode Consortium. The current version is 17, dated 2013-11-19. Available at: <a href="http://www.unicode.org/reports/tr18/">http://www.unicode.org/reports/tr18/</a>. </div></dd><dt class="label"><span><a id="Working-With-Timezones"></a>Working With Timezones</span></dt><dd><div>World Wide Web Consortium Working Group Note. <em>Working With Timezones, October 13, 2005.</em> Available at: <a href="http://www.w3.org/TR/2005/NOTE-timezone-20051013/">http://www.w3.org/TR/2005/NOTE-timezone-20051013/</a>. </div></dd></dl></div></div><div class="div1"><h2><a id="error-summary"></a>B <a href="#error-summary" style="text-decoration: none">Error codes</a></h2><p>The error text provided with these errors is non-normative.</p><dl><dt><a id="ERRFOAP0001"></a>err:FOAP0001, Wrong number of arguments.</dt><dd><p>Raised when <a href="#func-apply"><code>fn:apply</code></a> is called and the arity of the supplied function is not the same as the number of members in the supplied array.</p></dd><dt><a id="ERRFOAR0001"></a>err:FOAR0001, Division by zero.</dt><dd><p>This error is raised whenever an attempt is made to divide by zero.</p></dd><dt><a id="ERRFOAR0002"></a>err:FOAR0002, Numeric operation overflow/underflow.</dt><dd><p>This error is raised whenever numeric operations result in an overflow or underflow.</p></dd><dt><a id="ERRFOAY0001"></a>err:FOAY0001, Array index out of bounds.</dt><dd><p>This error is raised when an integer used to select a member of an array is outside the range of values for that array.</p></dd><dt><a id="ERRFOAY0002"></a>err:FOAY0002, Negative array length.</dt><dd><p>This error is raised when the <code>$length</code> argument to <a href="#func-array-subarray"><code>array:subarray</code></a> is negative.</p></dd><dt><a id="ERRFOCA0001"></a>err:FOCA0001, Input value too large for decimal.</dt><dd><p>Raised when casting to <code>xs:decimal</code> if the supplied value exceeds the implementation-defined limits for the datatype.</p></dd><dt><a id="ERRFOCA0002"></a>err:FOCA0002, Invalid lexical value.</dt><dd><p>Raised by <a href="#func-resolve-QName"><code>fn:resolve-QName</code></a> and <a href="#func-QName"><code>fn:QName</code></a> when a supplied value does not have the lexical form of a QName or URI respectively; and when casting to decimal, if the supplied value is <code>NaN</code> or Infinity.</p></dd><dt><a id="ERRFOCA0003"></a>err:FOCA0003, Input value too large for integer.</dt><dd><p>Raised when casting to <code>xs:integer</code> if the supplied value exceeds the implementation-defined limits for the datatype.</p></dd><dt><a id="ERRFOCA0005"></a>err:FOCA0005, NaN supplied as float/double value.</dt><dd><p>Raised when multiplying or dividing a duration by a number, if the number supplied is <code>NaN</code>.</p></dd><dt><a id="ERRFOCA0006"></a>err:FOCA0006, String to be cast to decimal has too many digits of precision.</dt><dd><p>Raised when casting a string to <code>xs:decimal</code> if the string has more digits of precision than the implementation can represent (the implementation also has the option of rounding).</p></dd><dt><a id="ERRFOCH0001"></a>err:FOCH0001, Codepoint not valid.</dt><dd><p>Raised by <a href="#func-codepoints-to-string"><code>fn:codepoints-to-string</code></a> if the input contains an integer that is not the codepoint of a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>.</p></dd><dt><a id="ERRFOCH0002"></a>err:FOCH0002, Unsupported collation.</dt><dd><p>Raised by any function that uses a collation if the requested collation is not recognized.</p></dd><dt><a id="ERRFOCH0003"></a>err:FOCH0003, Unsupported normalization form.</dt><dd><p>Raised by <a href="#func-normalize-unicode"><code>fn:normalize-unicode</code></a> if the requested normalization form is not supported by the implementation.</p></dd><dt><a id="ERRFOCH0004"></a>err:FOCH0004, Collation does not support collation units.</dt><dd><p>Raised by functions such as <a href="#func-contains"><code>fn:contains</code></a> if the requested collation does not operate on a character-by-character basis.</p></dd><dt><a id="ERRFOCH0005"></a>err:FOCH0005, Unrecognized or invalid character name.</dt><dd><p>Raised by <a href="#func-char"><code>fn:char</code></a> if the supplied character name is not recognized, or if it represents a codepoint that is not a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>.</p></dd><dt><a id="ERRFOCV0001"></a>err:FOCV0001, CSV field quoting error.</dt><dd><p>Raised when parsing CSV input if a syntax error in the input CSV is found.</p></dd><dt><a id="ERRFOCV0002"></a>err:FOCV0002, Invalid CSV delimiter error.</dt><dd><p>Raised when parsing CSV input if the <code>field-separator</code>, <code>record-separator</code>, or <code>quote-character</code> option is set to an invalid value.</p></dd><dt><a id="ERRFOCV0003"></a>err:FOCV0003, Duplicate CSV delimiter error.</dt><dd><p>Raised when parsing CSV input if the same delimiter character is assigned to more than one role.</p></dd><dt><a id="ERRFOCV0004"></a>err:FOCV0004, Argument supplied is not a known column name.</dt><dd><p>Raised by the function from the <code>get</code> entry of <code>csv-columns-record</code>, if its <code>$key</code> argument is an <code>xs:string</code> and is not one of the known column names.</p></dd><dt><a id="ERRFODC0001"></a>err:FODC0001, No context document.</dt><dd><p>Raised by <a href="#func-id"><code>fn:id</code></a>, <a href="#func-idref"><code>fn:idref</code></a>, and <a href="#func-element-with-id"><code>fn:element-with-id</code></a> if the node that identifies the tree to be searched is a node in a tree whose root is not a document node.</p></dd><dt><a id="ERRFODC0002"></a>err:FODC0002, Error retrieving resource.</dt><dd><p>Raised by <a href="#func-doc"><code>fn:doc</code></a>, <a href="#func-collection"><code>fn:collection</code></a>, and <a href="#func-uri-collection"><code>fn:uri-collection</code></a> to indicate that either the supplied URI cannot be dereferenced to obtain a resource, or the resource that is returned is not parseable as XML.</p></dd><dt><a id="ERRFODC0003"></a>err:FODC0003, Function not defined as deterministic.</dt><dd><p>Raised by <a href="#func-doc"><code>fn:doc</code></a>, <a href="#func-collection"><code>fn:collection</code></a>, and <a href="#func-uri-collection"><code>fn:uri-collection</code></a> to indicate that it is not possible to return a result that is guaranteed deterministic.</p></dd><dt><a id="ERRFODC0004"></a>err:FODC0004, Invalid collection URI.</dt><dd><p>Raised by <a href="#func-collection"><code>fn:collection</code></a> and <a href="#func-uri-collection"><code>fn:uri-collection</code></a> if the argument is not a valid <code>xs:anyURI</code>.</p></dd><dt><a id="ERRFODC0005"></a>err:FODC0005, Invalid URI reference.</dt><dd><p>Raised (optionally) by <a href="#func-doc"><code>fn:doc</code></a> if the argument is not a valid <code>xs:anyURI</code>.</p></dd><dt><a id="ERRFODC0006"></a>err:FODC0006, String passed to fn:parse-xml is not a well-formed XML document.</dt><dd><p>Raised by <a href="#func-parse-xml"><code>fn:parse-xml</code></a> if the supplied string is not a well-formed and namespace-well-formed XML document; or if DTD validation is requested and the document is not valid against its DTD.</p></dd><dt><a id="ERRFODC0007"></a>err:FODC0007, String passed to fn:parse-xml is not a DTD-valid XML document.</dt><dd><p>Raised by <a href="#func-parse-xml"><code>fn:parse-xml</code></a> if DTD validation is requested and the supplied string has no DTD or is not valid against the DTD.</p></dd><dt><a id="ERRFODC0008"></a>err:FODC0008, Invalid value for the xsd-validation option of fn:parse-xml.</dt><dd><p>Raised when the <code>xsd-validation</code> option to <a href="#func-parse-xml"><code>fn:parse-xml</code></a> is supplied, and the value is not one of the permitted values; for example if the option <code>type Q{U}NNN</code> is used, and <code>Q{U}NNN</code> does not identify a type in the static context.</p></dd><dt><a id="ERRFODC0009"></a>err:FODC0009, Processor is not schema-aware.</dt><dd><p>Raised when the <code>xsd-validation</code> option to <a href="#func-parse-xml"><code>fn:parse-xml</code></a> is set to a value other than <code>skip</code>, if the processor is not schema-aware.</p></dd><dt><a id="ERRFODC0010"></a>err:FODC0010, The processor does not support serialization.</dt><dd><p>Raised when <a href="#func-serialize"><code>fn:serialize</code></a> is called and the processor does not support serialization, in cases where the host language makes serialization an optional feature.</p></dd><dt><a id="ERRFODC0011"></a>err:FODC0011, String passed to fn:parse-html is not a well-formed HTML document.</dt><dd><p>Raised by <a href="#func-parse-html"><code>fn:parse-html</code></a> if the supplied string is not a well-formed HTML document.</p></dd><dt><a id="ERRFODC0013"></a>err:FODC0013, No validating XML parser available.</dt><dd><p>Raised when the <code>dtd-validation</code> option to <a href="#func-parse-xml"><code>fn:parse-xml</code></a> is set, if no validating XML parser is available. Note: it is <span class="verb">recommended</span> that all processors should support the <code>dtd-validation</code> option, but there may be environments (such as web browsers) where this is not practically feasible.</p></dd><dt><a id="ERRFODC0014"></a>err:FODC0014, String passed to fn:parse-xml is not a schema-valid XML document.</dt><dd><p>Raised by <a href="#func-parse-xml"><code>fn:parse-xml</code></a> if XSD validation is requested and the XML document represented by the supplied string is not valid against the relevant XSD schema.</p></dd><dt><a id="ERRFODC0015"></a>err:FODC0015, Unable to compile schema for fn:xsd-validator.</dt><dd><p>Raised by <a href="#func-xsd-validator"><code>fn:xsd-validator</code></a> if it is not possible to assemble a valid and consistent schema.</p></dd><dt><a id="ERRFODF1280"></a>err:FODF1280, Invalid decimal format name.</dt><dd><p>This error is raised if the decimal format name supplied to <a href="#func-format-number"><code>fn:format-number</code></a> is not a valid QName, or if the prefix in the QName is undeclared, or if there is no decimal format in the static context with a matching name.</p></dd><dt><a id="ERRFODF1290"></a>err:FODF1290, Invalid decimal format property.</dt><dd><p>This error is raised if a decimal format value supplied to <a href="#func-format-number"><code>fn:format-number</code></a> is not valid for the associated property, or if the properties of the decimal format resulting from a supplied map do not have distinct values.</p></dd><dt><a id="ERRFODF1310"></a>err:FODF1310, Invalid decimal format picture string.</dt><dd><p>This error is raised if the picture string supplied to <a href="#func-format-number"><code>fn:format-number</code></a> or <a href="#func-format-integer"><code>fn:format-integer</code></a> has invalid syntax.</p></dd><dt><a id="ERRFODT0001"></a>err:FODT0001, Overflow/underflow in date/time operation.</dt><dd><p>Raised when casting to date/time datatypes, or performing arithmetic with date/time values, if arithmetic overflow or underflow occurs.</p></dd><dt><a id="ERRFODT0002"></a>err:FODT0002, Overflow/underflow in duration operation.</dt><dd><p>Raised when casting to duration datatypes, or performing arithmetic with duration values, if arithmetic overflow or underflow occurs.</p></dd><dt><a id="ERRFODT0003"></a>err:FODT0003, Invalid timezone value.</dt><dd><p>Raised by <code>adjust-date-to-timezone</code> and related functions if the supplied timezone is invalid.</p></dd><dt><a id="ERRFODT0004"></a>err:FODT0004, No timezone data available</dt><dd><p>Raised by <code>civil-timezone</code> if no timezone data is available for the given date/time and place.</p></dd><dt><a id="ERRFODT0005"></a>err:FODT0005, Invalid combination of date/time fields</dt><dd><p>Raised by <code>build-dateTime</code> if the set of fields supplied does not correspond to those present in one of the <a title="Gregorian" class="termref" href="#dt-gregorian">Gregorian</a> types.</p></dd><dt><a id="ERRFODT0006"></a>err:FODT0006, Invalid component of date/time vallue</dt><dd><p>Raised by <code>build-dateTime</code> if one of the fields supplied has a value that is outside the supported range.</p></dd><dt><a id="ERRFOER0000"></a>err:FOER0000, Unidentified error.</dt><dd><p>Error code used by <a href="#func-error"><code>fn:error</code></a> when no other error code is provided.</p></dd><dt><a id="ERRFOFD1340"></a>err:FOFD1340, Invalid date/time formatting parameters.</dt><dd><p>This error is raised if the picture string or calendar supplied to <a href="#func-format-date"><code>fn:format-date</code></a>, <a href="#func-format-time"><code>fn:format-time</code></a>, or <a href="#func-format-dateTime"><code>fn:format-dateTime</code></a> has invalid syntax.</p></dd><dt><a id="ERRFOFD1350"></a>err:FOFD1350, Invalid date/time formatting component.</dt><dd><p>This error is raised if the picture string supplied to <a href="#func-format-date"><code>fn:format-date</code></a> selects a component that is not present in a date, or if the picture string supplied to <a href="#func-format-time"><code>fn:format-time</code></a> selects a component that is not present in a time.</p></dd><dt><a id="ERRFOGR0001"></a><span class="deltaxml-new" style="background:#90EE90">err:FOGR0001, Attempt to access the value of a generator that is not initialized.</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">A dynamic error is raised if the code attempts to access the current value of a generator whose </span><code><span class="deltaxml-new" style="background:#90EE90">initialized</span></code><span class="deltaxml-new" style="background:#90EE90"> field is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt><a id="ERRFOGR0002"></a><span class="deltaxml-new" style="background:#90EE90">err:FOGR0002, Attempt to access a value beyond the end of a generator.</span></dt><dd><p><span class="deltaxml-new" style="background:#90EE90">A dynamic error is raised if the code attempts to access the current value or move to the next state of a generator whose </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> field is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></dd><dt><a id="ERRFOHA0001"></a>err:FOHA0001, Invalid algorithm.</dt><dd><p>Raised by <a href="#func-hash"><code>fn:hash</code></a> if the effective value of the supplied algorithm is not one of the values supported by the implementation.</p></dd><dt><a id="ERRFOJS0001"></a>err:FOJS0001, JSON syntax error.</dt><dd><p>Raised by functions such as <a href="#func-json-doc"><code>fn:json-doc</code></a>, <a href="#func-parse-json"><code>fn:parse-json</code></a> or <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a> if the string supplied as input does not conform to the JSON grammar (optionally with implementation-defined extensions).</p></dd><dt><a id="ERRFOJS0003"></a>err:FOJS0003, JSON duplicate keys.</dt><dd><p>Raised by functions such as <a href="#func-map-merge"><code>map:merge</code></a>, <a href="#func-json-doc"><code>fn:json-doc</code></a>, <a href="#func-parse-json"><code>fn:parse-json</code></a> or <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a> if the input contains duplicate keys, when the chosen policy is to reject duplicates.</p></dd><dt><a id="ERRFOJS0004"></a>err:FOJS0004, JSON: not schema-aware.</dt><dd><p>Raised by <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a> if validation is requested when the processor does not support schema validation or typed nodes.</p></dd><dt><a id="ERRFOJS0005"></a>err:FOJS0005, Invalid options.</dt><dd><p>Raised by functions such as <a href="#func-map-merge"><code>map:merge</code></a>, <a href="#func-parse-json"><code>fn:parse-json</code></a>, and <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> if the <code>$options</code> map contains an invalid entry.</p></dd><dt><a id="ERRFOJS0006"></a>err:FOJS0006, Invalid XML representation of JSON.</dt><dd><p>Raised by <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> if the XML input does not conform to the rules for the XML representation of JSON.</p></dd><dt><a id="ERRFOJS0007"></a>err:FOJS0007, Bad JSON escape sequence.</dt><dd><p>Raised by <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> if the XML input uses the attribute <code>escaped="true"</code> or <code>escaped-key="true"</code>, and the corresponding string or key contains an invalid JSON escape sequence.</p></dd><dt><a id="ERRFOJS0008"></a>err:FOJS0008, Cannot convert element to map.</dt><dd><p>Raised by <a href="#func-element-to-map"><code>fn:element-to-map</code></a> if the layout selected for converting elements of a given name is unsuitable for an element node with that name, or if the conversion plan explicitly defines the processing of a particular element as an error.</p></dd><dt><a id="ERRFONS0004"></a>err:FONS0004, No namespace found for prefix.</dt><dd><p>Raised by <a href="#func-resolve-QName"><code>fn:resolve-QName</code></a> and analogous functions if a supplied QName has a prefix that has no binding to a namespace.</p></dd><dt><a id="ERRFONS0005"></a>err:FONS0005, Base-uri not defined in the static context.</dt><dd><p>Raised by <a href="#func-resolve-uri"><code>fn:resolve-uri</code></a> if no base URI is available for resolving a relative URI.</p></dd><dt><a id="ERRFOPA0001"></a>err:FOPA0001, Origin node is not an ancestor of the target node.</dt><dd><p>Raised by <a href="#func-path"><code>fn:path</code></a> if the node supplied in the <code>origin</code> option is not an ancestor of the <code>$node</code> whose relative path is required.</p></dd><dt><a id="ERRFOQM0001"></a>err:FOQM0001, Module URI is a zero-length string.</dt><dd><p>Raised by <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a> if the supplied module URI is zero-length.</p></dd><dt><a id="ERRFOQM0002"></a>err:FOQM0002, Module URI not found.</dt><dd><p>Raised by <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a> if no module can be found with the supplied module URI.</p></dd><dt><a id="ERRFOQM0003"></a>err:FOQM0003, Static error in dynamically loaded XQuery module.</dt><dd><p>Raised by <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a> if a static error (including a statically detected type error) is encountered when processing the library module.</p></dd><dt><a id="ERRFOQM0005"></a>err:FOQM0005, Parameter for dynamically loaded XQuery module has incorrect type.</dt><dd><p>Raised by <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a> if a value is supplied for the initial context item or for an external variable, and the value does not conform to the required type declared in the dynamically loaded module.</p></dd><dt><a id="ERRFOQM0006"></a>err:FOQM0006, No suitable XQuery processor available.</dt><dd><p>Raised by <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a> if no XQuery processor is available supporting the requested XQuery version (or if none is available at all).</p></dd><dt><a id="ERRFORG0001"></a>err:FORG0001, Invalid value for cast/constructor.</dt><dd><p>A general-purpose error raised when casting, if a cast between two datatypes is allowed in principle, but the supplied value cannot be converted: for example when attempting to cast the string <code>"nine"</code> to an integer.</p></dd><dt><a id="ERRFORG0002"></a>err:FORG0002, Invalid argument to fn:resolve-uri.</dt><dd><p>Raised when either argument to <a href="#func-resolve-uri"><code>fn:resolve-uri</code></a> is not a valid URI/IRI.</p></dd><dt><a id="ERRFORG0003"></a>err:FORG0003, fn:zero-or-one called with a sequence containing more than one item.</dt><dd><p>Raised by <a href="#func-zero-or-one"><code>fn:zero-or-one</code></a> if the supplied value contains more than one item.</p></dd><dt><a id="ERRFORG0004"></a>err:FORG0004, fn:one-or-more called with a sequence containing no items.</dt><dd><p>Raised by <a href="#func-one-or-more"><code>fn:one-or-more</code></a> if the supplied value is the empty sequence.</p></dd><dt><a id="ERRFORG0005"></a>err:FORG0005, fn:exactly-one called with a sequence containing zero or more than one item.</dt><dd><p>Raised by <a href="#func-exactly-one"><code>fn:exactly-one</code></a> if the supplied value is not a singleton sequence.</p></dd><dt><a id="ERRFORG0006"></a>err:FORG0006, Invalid argument type.</dt><dd><p>Raised by functions such as <a href="#func-max"><code>fn:max</code></a>, <a href="#func-min"><code>fn:min</code></a>, <a href="#func-avg"><code>fn:avg</code></a>, <a href="#func-sum"><code>fn:sum</code></a> if the supplied sequence contains values inappropriate to this function.</p></dd><dt><a id="ERRFORG0008"></a>err:FORG0008, The two arguments to fn:dateTime have inconsistent timezones.</dt><dd><p>Raised by <a href="#func-dateTime"><code>fn:dateTime</code></a> if the two arguments both have timezones and the timezones are different.</p></dd><dt><a id="ERRFORG0009"></a>err:FORG0009, Error in resolving a relative URI against a base URI in fn:resolve-uri.</dt><dd><p>A catch-all error for <a href="#func-resolve-uri"><code>fn:resolve-uri</code></a>, recognizing that the implementation can choose between a variety of algorithms and that some of these may fail for a variety of reasons.</p></dd><dt><a id="ERRFORG0010"></a>err:FORG0010, Invalid date/time.</dt><dd><p>Raised when the input to <a href="#func-parse-ietf-date"><code>fn:parse-ietf-date</code></a> does not match the prescribed grammar, or when it represents an invalid date/time such as 31 February.</p></dd><dt><a id="ERRFORG0011"></a>err:FORG0011, Invalid radix.</dt><dd><p>Raised when the radix supplied to <a href="#func-parse-integer"><code>fn:parse-integer</code></a> is not in the range 2 to 36.</p></dd><dt><a id="ERRFORG0012"></a>err:FORG0012, Invalid digits.</dt><dd><p>Raised when the digits in the string supplied to <a href="#func-parse-integer"><code>fn:parse-integer</code></a> are not in the range appropriate to the chosen radix.</p></dd><dt><a id="ERRFORX0001"></a>err:FORX0001, Invalid regular expression flags.</dt><dd><p>Raised by regular expression functions such as <a href="#func-matches"><code>fn:matches</code></a> and <a href="#func-replace"><code>fn:replace</code></a> if the regular expression flags contain a character other than <code>i</code>, <code>m</code>, <code>q</code>, <code>s</code>, or <code>x</code>.</p></dd><dt><a id="ERRFORX0002"></a>err:FORX0002, Invalid regular expression.</dt><dd><p>Raised by regular expression functions such as <a href="#func-matches"><code>fn:matches</code></a> and <a href="#func-replace"><code>fn:replace</code></a> if the regular expression is syntactically invalid.</p></dd><dt><a id="ERRFORX0004"></a>err:FORX0004, Invalid replacement string.</dt><dd><p>Raised by <a href="#func-replace"><code>fn:replace</code></a> to report errors in the replacement string.</p></dd><dt><a id="ERRFORX0005"></a>err:FORX0005, Incompatible arguments for fn:replace.</dt><dd><p>Raised by <a href="#func-replace"><code>fn:replace</code></a> if both the <code>$replacement</code> and <code>$action</code> arguments are supplied.</p></dd><dt><a id="ERRFOTY0012"></a>err:FOTY0012, Argument to fn:data contains a node that does not have a typed value.</dt><dd><p>Raised by <a href="#func-data"><code>fn:data</code></a>, or by implicit atomization, if applied to a node with no typed value, the main example being an element validated against a complex type that defines it to have element-only content.</p></dd><dt><a id="ERRFOTY0013"></a>err:FOTY0013, The argument to fn:data contains a function item.</dt><dd><p>Raised by <a href="#func-data"><code>fn:data</code></a>, or by implicit atomization, if the sequence to be atomized contains a function item other than an array.</p></dd><dt><a id="ERRFOTY0014"></a>err:FOTY0014, The argument to fn:string is a function item.</dt><dd><p>Raised by <a href="#func-string"><code>fn:string</code></a>, or by implicit string conversion, if the input sequence contains a function item.</p></dd><dt><a id="ERRFOUR0001"></a>err:FOUR0001, Invalid IPv6/IPvFuture authority</dt><dd><p>A dynamic error is raised if the authority component of a URI contains an open square bracket but no corresponding close square bracket.</p></dd><dt><a id="ERRFOUT1170"></a>err:FOUT1170, Invalid URI reference.</dt><dd><p>Raised by <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> or <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> if the <code>$source</code> argument contains a fragment identifier, or if it cannot be resolved to an absolute URI (for example, because the base-URI property in the static context is absent), or if it cannot be used to retrieve the string representation of a resource.</p></dd><dt><a id="ERRFOUT1190"></a>err:FOUT1190, Cannot decode external resource.</dt><dd><p>Raised by <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> or <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> if the <code>$encoding</code> argument is not a valid encoding name, if the processor does not support the specified encoding, if the string representation of the retrieved resource contains octets that cannot be decoded into Unicode <a title="character" class="termref" href="#character">characters</a> using the specified encoding, or if the resulting characters are not <a title="permitted character" class="termref" href="#dt-permitted-character">permitted characters</a>.</p></dd><dt><a id="ERRFOUT1200"></a>err:FOUT1200, Cannot infer encoding of external resource.</dt><dd><p>Raised by <a href="#func-unparsed-text"><code>fn:unparsed-text</code></a> or <a href="#func-unparsed-text-lines"><code>fn:unparsed-text-lines</code></a> if the <code>$encoding</code> argument is absent and the processor cannot infer the encoding using external information and the encoding is not UTF-8.</p></dd><dt><a id="ERRFOXT0001"></a>err:FOXT0001, No suitable XSLT processor available</dt><dd><p>A dynamic error is raised if no XSLT processor suitable for evaluating a call on <a href="#func-transform"><code>fn:transform</code></a> is available.</p></dd><dt><a id="ERRFOXT0002"></a>err:FOXT0002, Invalid parameters to XSLT transformation</dt><dd><p>A dynamic error is raised if the parameters supplied to <a href="#func-transform"><code>fn:transform</code></a> are invalid, for example if two mutually exclusive parameters are supplied. If a suitable XSLT error code is available (for example in the case where the requested <code>initial-template</code> does not exist in the stylesheet), that error code should be used in preference.</p></dd><dt><a id="ERRFOXT0003"></a>err:FOXT0003, XSLT transformation failed</dt><dd><p>A dynamic error is raised if an XSLT transformation invoked using <a href="#func-transform"><code>fn:transform</code></a> fails with a static or dynamic error. The XSLT error code is used if available; this error code provides a fallback when no XSLT error code is returned, for example because the processor is an XSLT 1.0 processor.</p></dd><dt><a id="ERRFOXT0004"></a>err:FOXT0004, XSLT transformation has been disabled</dt><dd><p>A dynamic error is raised if the <a href="#func-transform"><code>fn:transform</code></a> function is invoked when XSLT transformation (or a specific transformation option) has been disabled for security or other reasons.</p></dd><dt><a id="ERRFOXT0006"></a>err:FOXT0006, XSLT output contains non-accepted characters</dt><dd><p>A dynamic error is raised if the result of the <a href="#func-transform"><code>fn:transform</code></a> function contains characters available only in XML 1.1 and the calling processor cannot handle such characters.</p></dd></dl></div><div class="div1"><h2><a id="id-built-in-named-record-types"></a>C <a href="#id-built-in-named-record-types" style="text-decoration: none">Built-in named record types</a></h2><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#schemata">next</a> | <a href="#casting-from-strings">previous</a>)</p><ol><li><p> Named record types used in the signatures of built-in functions are now available as standard in the static context. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/835">835</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1991">1991</a>&nbsp;11 May 2025]</i></p></li></ol></div><p>This appendix lists the named record types that are used in function signatures in this function library, and that are available in the static context of every application.</p><p>These definitions are all in the standard function namespace <code>http://www.w3.org/2005/xpath-functions</code>, which is normally bound to the prefix <code>fn</code>. Because this will not usually be the default namespace for types, the names will usually be written with the prefix <code>fn</code>.</p><ul><li><p>Record <a href="#dateTime-record">dateTime-record</a></p></li><li class="add_version" style="display: none;"><p>Record <a href="#generator">generator</a></p></li><li class="modify_version"><p><span class="deltaxml-new" style="background:#90EE90">Record </span><a href="#generator"><span class="deltaxml-new" style="background:#90EE90">generator</span></a></p></li><li><p>Record <a href="#load-xquery-module-record">load-xquery-module-record</a></p></li><li><p>Record <a href="#parsed-csv-structure-record">parsed-csv-structure-record</a></p></li><li><p>Record <a href="#random-number-generator-record">random-number-generator-record</a></p></li><li><p>Record <a href="#schema-type-record">schema-type-record</a></p></li><li><p>Record <a href="#uri-structure-record">uri-structure-record</a></p></li></ul></div><div class="div1"><h2><a id="schemata"></a>D <a href="#schemata" style="text-decoration: none">Schemas</a></h2><div class="changes"><p class="changesHeading"> Changes in 4.0 (<a href="#id-built-in-named-record-types">previous</a>)</p><ol><li><p> Rules have been added clarifying that users should not be allowed to change the schema for the <code>fn</code> namespace. <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/648">648</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/924">924</a>&nbsp;9 January 2024]</i></p></li></ol></div><p>Two functions in this specification, <a href="#func-analyze-string"><code>fn:analyze-string</code></a> and <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a>, produce results in the form of an XDM node tree that must conform to a specified schema, defined in this appendix. In both cases the elements in the result are in the namespace <code>http://www.w3.org/2005/xpath-functions</code>, which is therefore the target namespace of the relevant schema.</p><p>A processor <span class="verb">may</span> have built-in knowledge of this schema, or it <span class="verb">may</span> read it from external files. Any attempt to supply a modified form of this schema will have unpredictable consequences. <em>Modification</em> here includes not only actual changes to the text of a schema document, but also actions such as using <code>xs:redefine</code> or <code>xs:override</code>, adding members to substitution groups, or defining derived types. Processors are not <span class="verb">required</span> to detect and reject such modifications. When validating against this schema, it is <span class="verb">recommended</span> that processors should ignore or reject any <code>xsi:schemaLocation</code> or <code>xsi:type</code> attributes in the instance being validated.</p><p>The schema for this namespace is organized as three schema documents. The first is a simple umbrella document that includes the other two. A copy can be found at <a href="xpath-functions.xsd">xpath-functions.xsd</a>:</p><pre xml:space="preserve" class="small">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified"
    targetNamespace="http://www.w3.org/2005/xpath-functions"&gt;
    
    &lt;!-- 
     * This is a schema for the namespace http://www.w3.org/2005/xpath-functions
     *
     * The schema is made available under the terms of the W3C software notice and license
     * at http://www.w3.org/Consortium/Legal/copyright-software-19980720
     *
     * The schema includes two schema documents, containing definitions of the structure
     * of the results of the fn:analyze-string and fn:json-to-xml functions respectively.
     *
    --&gt;
    
    &lt;xs:include schemaLocation="analyze-string.xsd"/&gt;
    &lt;xs:include schemaLocation="schema-for-json.xsd"/&gt;
    &lt;xs:include schemaLocation="schema-for-csv.xsd"/&gt;
&lt;/xs:schema&gt;
</pre><div class="div2"><h3><a id="schema-for-analyze-string"></a>D.1 <a href="#schema-for-analyze-string" style="text-decoration: none">Schema for the result of <code>fn:analyze-string</code></a></h3><p>This schema describes the output of the function <a href="#func-analyze-string"><code>fn:analyze-string</code></a>.</p><p>The schema is reproduced below, and can also be found in <a href="analyze-string.xsd">analyze-string.xsd</a>:</p><pre xml:space="preserve" class="small">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    targetNamespace="http://www.w3.org/2005/xpath-functions"
    xmlns:fn="http://www.w3.org/2005/xpath-functions"
    elementFormDefault="qualified"&gt;
    
    &lt;!-- 
     * This is a schema for the XML representation of JSON used as the target for the
     * function fn:analyze-string()
     *
     * The schema is made available under the terms of the W3C software notice and license
     * at http://www.w3.org/Consortium/Legal/copyright-software-19980720
     *
    --&gt;

    &lt;xs:element name="analyze-string-result" type="fn:analyze-string-result-type"/&gt;
    &lt;xs:element name="match" type="fn:match-type"/&gt;
    &lt;xs:element name="non-match" type="xs:string"/&gt;
    &lt;xs:element name="group" type="fn:group-type"/&gt;
    &lt;xs:element name="lookahead-group" type="fn:lookahead-group-type"/&gt;
    
    &lt;xs:complexType name="analyze-string-result-type" mixed="true"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:choice minOccurs="0" maxOccurs="unbounded"&gt;
                &lt;xs:element ref="fn:match"/&gt;
                &lt;xs:element ref="fn:non-match"/&gt;
            &lt;/xs:choice&gt;
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
        
    &lt;xs:complexType name="match-type" mixed="true"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element ref="fn:group" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xs:element ref="fn:lookahead-group" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="group-type" mixed="true"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element ref="fn:group" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attribute name="nr" type="xs:positiveInteger"/&gt;
    &lt;/xs:complexType&gt;

    &lt;xs:complexType name="lookahead-group-type"&gt;
        &lt;xs:attribute name="nr" type="xs:positiveInteger"/&gt;
        &lt;xs:attribute name="value" type="xs:string"/&gt;
        &lt;xs:attribute name="position" type="xs:positiveInteger"/&gt;
    &lt;/xs:complexType&gt;
 
&lt;/xs:schema&gt;
</pre></div><div class="div2"><h3><a id="schema-for-json"></a>D.2 <a href="#schema-for-json" style="text-decoration: none">Schema for the result of <code>fn:json-to-xml</code></a></h3><p>This schema describes the output of the function <a href="#func-json-to-xml"><code>fn:json-to-xml</code></a>, and the input to the function <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a>. </p><p>The schema is reproduced below, and can also be found in <a href="schema-for-json.xsd">schema-for-json.xsd</a>:</p><pre xml:space="preserve" class="small">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified"
    targetNamespace="http://www.w3.org/2005/xpath-functions"
    xmlns:j="http://www.w3.org/2005/xpath-functions"&gt;
    
    &lt;!-- 
     * This is a schema for the XML representation of JSON used as the target for the
     * function fn:json-to-xml()
     *
     * The schema is made available under the terms of the W3C software notice and license
     * at http://www.w3.org/Consortium/Legal/copyright-software-19980720
     *
    --&gt;
    
    &lt;xs:element name="map" type="j:mapType"&gt;
        &lt;xs:unique name="unique-key"&gt;
            &lt;xs:selector xpath="*"/&gt;
            &lt;xs:field xpath="@key"/&gt;
            &lt;xs:field xpath="@escaped-key"/&gt;
        &lt;/xs:unique&gt;
    &lt;/xs:element&gt;
    
    &lt;xs:element name="array" type="j:arrayType"/&gt;
    
    &lt;xs:element name="string" type="j:stringType"/&gt;
    
    &lt;xs:element name="number" type="j:numberType"/&gt;
    
    &lt;xs:element name="boolean" type="j:booleanType"/&gt;
    
    &lt;xs:element name="null" type="j:nullType"/&gt;
    
    &lt;xs:complexType name="nullType"&gt;
        &lt;xs:sequence/&gt;
        &lt;xs:anyAttribute processContents="skip" namespace="##other"/&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="booleanType"&gt;
        &lt;xs:simpleContent&gt;
            &lt;xs:extension base="xs:boolean"&gt;
                &lt;xs:anyAttribute processContents="skip" namespace="##other"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="stringType"&gt;
        &lt;xs:simpleContent&gt;
            &lt;xs:extension base="xs:string"&gt;
                &lt;xs:attribute name="escaped" type="xs:boolean" use="optional" default="false"/&gt;
                &lt;xs:anyAttribute processContents="skip" namespace="##other"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:simpleType name="finiteNumberType"&gt;
        &lt;xs:restriction base="xs:double"&gt;
            &lt;!-- exclude positive and negative infinity, and NaN --&gt;
            &lt;xs:minExclusive value="-INF"/&gt;
            &lt;xs:maxExclusive value="INF"/&gt;
        &lt;/xs:restriction&gt;
    &lt;/xs:simpleType&gt;
    
    &lt;xs:complexType name="numberType"&gt;
        &lt;xs:simpleContent&gt;
            &lt;xs:extension base="j:finiteNumberType"&gt;
                &lt;xs:anyAttribute processContents="skip" namespace="##other"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="arrayType"&gt;
        &lt;xs:choice minOccurs="0" maxOccurs="unbounded"&gt;
            &lt;xs:element ref="j:map"/&gt;
            &lt;xs:element ref="j:array"/&gt;
            &lt;xs:element ref="j:string"/&gt;
            &lt;xs:element ref="j:number"/&gt;
            &lt;xs:element ref="j:boolean"/&gt;
            &lt;xs:element ref="j:null"/&gt;
        &lt;/xs:choice&gt;
        &lt;xs:anyAttribute processContents="skip" namespace="##other"/&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="mapWithinMapType"&gt;
        &lt;xs:complexContent&gt;
            &lt;xs:extension base="j:mapType"&gt;
                &lt;xs:attributeGroup ref="j:key-group"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:complexContent&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="arrayWithinMapType"&gt;
        &lt;xs:complexContent&gt;
            &lt;xs:extension base="j:arrayType"&gt;
                &lt;xs:attributeGroup ref="j:key-group"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:complexContent&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="stringWithinMapType"&gt;
        &lt;xs:simpleContent&gt;
            &lt;xs:extension base="j:stringType"&gt;
                &lt;xs:attributeGroup ref="j:key-group"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="numberWithinMapType"&gt;
        &lt;xs:simpleContent&gt;
            &lt;xs:extension base="j:numberType"&gt;
                &lt;xs:attributeGroup ref="j:key-group"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="booleanWithinMapType"&gt;
        &lt;xs:simpleContent&gt;
            &lt;xs:extension base="j:booleanType"&gt;
                &lt;xs:attributeGroup ref="j:key-group"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="nullWithinMapType"&gt;
        &lt;xs:attributeGroup ref="j:key-group"/&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:complexType name="mapType"&gt;
        &lt;xs:choice minOccurs="0" maxOccurs="unbounded"&gt;
            &lt;xs:element name="map" type="j:mapWithinMapType"&gt;
                &lt;xs:unique name="unique-key-2"&gt;
                    &lt;xs:selector xpath="*"/&gt;
                    &lt;xs:field xpath="@key"/&gt;
                &lt;/xs:unique&gt;
            &lt;/xs:element&gt;
            &lt;xs:element name="array" type="j:arrayWithinMapType"/&gt;            
            &lt;xs:element name="string" type="j:stringWithinMapType"/&gt;   
            &lt;xs:element name="number" type="j:numberWithinMapType"/&gt;
            &lt;xs:element name="boolean" type="j:booleanWithinMapType"/&gt;
            &lt;xs:element name="null" type="j:nullWithinMapType"/&gt;
        &lt;/xs:choice&gt;
        &lt;xs:anyAttribute processContents="skip" namespace="##other"/&gt;
    &lt;/xs:complexType&gt;
    
    &lt;xs:attributeGroup name="key-group"&gt;
        &lt;xs:attribute name="key" type="xs:string" use="required"/&gt;
        &lt;xs:attribute name="escaped-key" type="xs:boolean" use="optional" default="false"/&gt;
    &lt;/xs:attributeGroup&gt;
    
&lt;/xs:schema&gt;
</pre></div><div class="div2"><h3><a id="schema-for-csv"></a>D.3 <a href="#schema-for-csv" style="text-decoration: none">Schema for the result of <code>fn:csv-to-xml</code></a></h3><p>This schema describes the output of the function <a href="#func-csv-to-xml"><code>fn:csv-to-xml</code></a>.</p><p>The schema is reproduced below, and can also be found in <a href="schema-for-csv.xsd">schema-for-csv.xsd</a>:</p><pre xml:space="preserve" class="small">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" elementFormDefault="qualified"
    targetNamespace="http://www.w3.org/2005/xpath-functions"
    xmlns:csv="http://www.w3.org/2005/xpath-functions"&gt;

    &lt;!--
     * This is a schema for the XML representation of CSV used as the target for the
     * function fn:csv-to-xml()
     *
     * The schema is made available under the terms of the W3C software notice and license
     * at http://www.w3.org/Consortium/Legal/copyright-software-19980720
     *
    --&gt;

    &lt;xs:element name="csv" type="csv:csvType"/&gt;

    &lt;xs:element name="columns" type="csv:columnsType"/&gt;

    &lt;xs:element name="rows" type="csv:rowsType"/&gt;

    &lt;xs:element name="column" type="csv:columnFieldType"/&gt;

    &lt;xs:element name="row" type="csv:rowType"/&gt;

    &lt;xs:element name="field" type="csv:fieldType"/&gt;

    &lt;xs:complexType name="csvType"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element ref="csv:columns" minOccurs="0" maxOccurs="1"/&gt;
            &lt;xs:element ref="csv:rows" minOccurs="1" maxOccurs="1"/&gt;
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;

    &lt;xs:complexType name="columnsType"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element ref="csv:column" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;

    &lt;xs:complexType name="rowsType"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element ref="csv:row" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;

    &lt;xs:complexType name="rowType"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element ref="csv:field" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;

    &lt;xs:complexType name="columnFieldType"&gt;
        &lt;xs:simpleContent&gt;
            &lt;xs:extension base="xs:string"&gt;
                &lt;xs:anyAttribute processContents="skip" namespace="##other"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;

    &lt;xs:complexType name="fieldType"&gt;
        &lt;xs:simpleContent&gt;
            &lt;xs:extension base="csv:columnFieldType"&gt;
                  &lt;xs:attribute name="column" type="xs:string" use="optional"/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
</pre></div></div><div class="div1"><h2><a id="glossary"></a>E <a href="#glossary" style="text-decoration: none">Glossary</a> (Non-Normative)</h2><dl><dt><a href="#dt-atomic-item">atomic item</a></dt><dd><p>An <b>atomic item</b> is a pair (<var>T</var>, <var>D</var>) where <var>T</var> (the <a title="type annotation" class="termref" href="#dt-type-annotation">type annotation</a>) is an atomic type, and <var>D</var> (the <a title="datum" class="termref" href="#dt-datum">datum</a>) is a point in the value space of <var>T</var>.</p></dd><dt><a href="#dt-capturing-subexpression">capturing subexpression</a></dt><dd><p>A left parenthesis is recognized as a capturing left parenthesis provided it is not immediately followed by <code>?</code> or <code>*</code> (see below), is not within a character group (square brackets), and is not escaped with a backslash. The sub-expression enclosed by a capturing left parenthesis and its matching right parenthesis is referred to as a <b>capturing subexpression</b>.</p></dd><dt><a href="#character">character</a></dt><dd><p>A <b>character</b> is an instance of the <a href="https://www.w3.org/TR/REC-xml/#NT-Char">Char</a><sup><small>XML</small></sup> production of <a href="#xml">[Extensible Markup Language (XML) 1.0 (Fifth Edition)]</a>.</p></dd><dt><a href="#dt-character-position">character position</a></dt><dd><p>A string of length <var>N</var> has <var>N+1</var><b>character positions</b>: one immediately before each character in the string, and one after the last character. In interfaces where character positions are exposed, they are numbered from 1 to <var>N+1</var>.</p></dd><dt><a href="#codepoint">codepoint</a></dt><dd><p>A <b>codepoint</b> is an integer assigned to a <a title="character" class="termref" href="#character">character</a> by the Unicode consortium, or reserved for future assignment to a character.</p></dd><dt><a href="#dt-collation">collation</a></dt><dd><p> A <b>collation</b> is an algorithm that determines, for any two given strings <var>S<sub>1</sub></var> and <var>S<sub>2</sub></var>, whether <var>S<sub>1</sub></var> is less than, equal to, or greater than <var>S<sub>2</sub></var>. In this specification, a collation is identified by an absolute URI.</p></dd><dt><a href="#dt-collation-unit">collation unit</a></dt><dd><p>The term <b>collation unit</b> as used in this specification is equivalent to the term <b>collation element</b> used in <a href="#UNICODE-TR10">[UTS #10]</a>.</p></dd><dt><a href="#dt-context-dependent">context-dependent</a></dt><dd><p>A <span><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-function-definition">function definition</a><sup><small>XP</small></sup></span> may have the property of being <b>context-dependent</b>: the result of such a function depends on the values of properties in the static and dynamic evaluation context <span>of the caller</span> as well as on the actual supplied arguments (if any). A function definition may be context-dependent for some arities in its arity range, and context-independent for others: for example <a href="#func-name"><code>fn:name#0</code></a> is context-dependent while <a href="#func-name"><code>fn:name#1</code></a> is context-independent.</p></dd><dt><a href="#dt-context-independent">context-independent</a></dt><dd><p>A <span><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-function-definition">function definition</a><sup><small>XP</small></sup></span> that is not <a title="context-dependent" class="termref" href="#dt-context-dependent">context-dependent</a> is called <b>context-independent</b>.</p></dd><dt><a href="#dt-contextually-equal">contextually equal</a></dt><dd><p>Two atomic items <var>A</var> and <var>B</var> are said to be <b>contextually equal</b> if the function call <code>fn:compare(<var>A</var>, <var>B</var>)</code> returns zero when evaluated with a specified or context-determined collation and implicit timezone.</p></dd><dt><a href="#dt-csv">CSV</a></dt><dd><p> The term <b>comma separated values</b> or <b>CSV</b> refers to a wide variety of plain-text tabular data formats with fields and records separated by standard character delimiters (often, but not invariably, commas).</p></dd><dt><a href="#dt-date-formatting-function">date formatting function</a></dt><dd><p>The three functions <a href="#func-format-dateTime"><code>fn:format-dateTime</code></a>, <a href="#func-format-date"><code>fn:format-date</code></a>, and <a href="#func-format-time"><code>fn:format-time</code></a> are referred to collectively as the <b>date formatting functions</b>.</p></dd><dt><a href="#dt-datum">datum</a></dt><dd><p>The <b>datum</b> of an <a title="atomic item" class="termref" href="#dt-atomic-item">atomic item</a> is a point in the value space of its type, which is also a point in the value space of the primitive type from which that type is derived.</p></dd><dt><a href="#dt-deterministic">deterministic</a></dt><dd><p>A function that is guaranteed to produce <a title="identical" class="termref" href="#dt-identical">identical</a> results from repeated calls within a single <a title="execution scope" class="termref" href="#execution-scope">execution scope</a> if the explicit and implicit arguments are identical is referred to as <b>deterministic</b>.</p></dd><dt><a href="#dt-decimal-digit-family">digit family</a></dt><dd><p>The <b>decimal digit family</b> of a decimal format is the sequence of ten digits with consecutive Unicode <a title="codepoint" class="termref" href="#codepoint">codepoints</a> starting with the character that is the value of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-zero-digit">zero-digit</a><sup><small>XP31</small></sup> property.</p></dd><dt><a href="#dt-disjoint-matching-segments">disjoint matching segments</a></dt><dd><p>The <b>disjoint matching segments</b> obtained by applying a regular expression <var>R</var> to a string <var>S</var> in the presence of a set of flags <var>F</var> are the <a title="segment" class="termref" href="#dt-segment">segments</a> of <var>S</var> that match <var>R</var> (using flags <var>F</var>), after elimination of overlapping segments.</p></dd><dt><a href="#dt-end-position">end position</a></dt><dd><p>The <b>end position</b> of a segment is the start position of the segment plus its length.</p></dd><dt><a href="#execution-scope">execution scope</a></dt><dd><p>An <b>execution scope</b> is a sequence of calls to the function library during which certain aspects of the state are required to remain invariant. For example, two calls to <a href="#func-current-dateTime"><code>fn:current-dateTime</code></a> within the same execution scope will return the same result. The execution scope is defined by the host language that invokes the function library.</p></dd><dt><a href="#expanded-name">expanded-QName</a></dt><dd><p> An <b>expanded-QName</b> is a value in the value space of the <code>xs:QName</code> datatype as defined in the XDM data model (see <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>): that is, a triple containing namespace prefix (optional), namespace URI (optional), and local name. Two expanded QNames are equal if the namespace URIs are the same (or both absent) and the local names are the same. The prefix plays no part in the comparison, but is used only if the expanded QName needs to be converted back to a string.</p></dd><dt><a href="#dt-focus-dependent">focus-dependent</a></dt><dd><p>A function is <b>focus-dependent</b> if its result depends on the <a href="https://www.w3.org/TR/xpath-31/#dt-focus">focus</a><sup><small>XP31</small></sup> (that is, the context item, position, or size) <span>of the caller</span>.</p></dd><dt><a href="#dt-focus-independent">focus-dependent</a></dt><dd><p>A function that is not <a title="focus-dependent" class="termref" href="#dt-focus-dependent">focus-dependent</a> is called <b>focus-independent</b>.</p></dd><dt><a href="#gr-collection-data-source"><span class="deltaxml-new" style="background:#90EE90">generator-collection-data-source</span></a></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> An </span><span><b><span class="deltaxml-new" style="background:#90EE90">XPath collection</span></b></span><span class="deltaxml-new" style="background:#90EE90"> or just </span><span><b><span class="deltaxml-new" style="background:#90EE90">collection</span></b></span><span class="deltaxml-new" style="background:#90EE90"> has nothing to do with the </span><code><span class="deltaxml-new" style="background:#90EE90">f:collection</span></code><span class="deltaxml-new" style="background:#90EE90"> function. An </span><span><b><span class="deltaxml-new" style="background:#90EE90">XPath collection</span></b></span><span class="deltaxml-new" style="background:#90EE90"> can be a sequence, an array or a map. </span></p></dd><dt><a href="#gr-empty-generator"><span class="deltaxml-new" style="background:#90EE90">generator-empty</span></a></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> A generator is </span><span><b><span class="deltaxml-new" style="background:#90EE90">empty</span></b></span><span class="deltaxml-new" style="background:#90EE90"> if and only if its field </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> has the effective boolean value </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. An </span><span><b><span class="deltaxml-new" style="background:#90EE90">empty generator-instance</span></b></span><span class="deltaxml-new" style="background:#90EE90"> reached in the chain produced by successive evaluations of the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method signifies that the yield of a starting generator-instance has been fully traversed. It has the following properties: </span></p><ol class="enumar"><li><p><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90">'s evaluation raises an error.</span></p></li><li><p><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90">'s evaluation raises an error.</span></p></li></ol><div class="note"><p class="prefix"><b><span class="deltaxml-new" style="background:#90EE90">Note:</span></b></p><p><span class="deltaxml-new" style="background:#90EE90">Empty generators may arise in two ways:</span></p><ol class="enumar"><li><p><span class="deltaxml-new" style="background:#90EE90">Produced by the function </span><code><span class="deltaxml-new" style="background:#90EE90">gn:empty-generator</span></code><span class="deltaxml-new" style="background:#90EE90">.</span></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">Termination of a chain of generator instances - the final value of repeated application of the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method is an empty generator instance.</span></p><p><span class="deltaxml-new" style="background:#90EE90">Generators with infinite yield never reach an empty-generator instance in this process.</span></p></li></ol></div><p></p></dd><dt><a href="#gr-instance"><span class="deltaxml-new" style="background:#90EE90">generator-instance</span></a></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> Generator </span><span><b><span class="deltaxml-new" style="background:#90EE90">instance</span></b></span><span class="deltaxml-new" style="background:#90EE90"> - a given instance of the </span><code><span class="deltaxml-new" style="background:#90EE90">f:generator</span></code><span class="deltaxml-new" style="background:#90EE90"> record or the result produced by a chain of one or more applications of the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> method starting from a given </span><code><span class="deltaxml-new" style="background:#90EE90">f:generator</span></code><span class="deltaxml-new" style="background:#90EE90"> instance. </span></p></dd><dt><a href="#gr-next-value"><span class="deltaxml-new" style="background:#90EE90">generator-next-value</span></a></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> The term </span><span><b><span class="deltaxml-new" style="background:#90EE90">the next value of a generator</span></b></span><span class="deltaxml-new" style="background:#90EE90"> denotes the value returned from the </span><code><span class="deltaxml-new" style="background:#90EE90">get-current()</span></code><span class="deltaxml-new" style="background:#90EE90"> method applied on the generator-instance produced by the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> method, if the </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> field of this next generator-instance is </span><code><span class="deltaxml-new" style="background:#90EE90">false()</span></code><span class="deltaxml-new" style="background:#90EE90">. This is also the next value in the generator's </span><span><b><span class="deltaxml-new" style="background:#90EE90">yield</span></b></span><span class="deltaxml-new" style="background:#90EE90"> - see below. </span></p></dd><dt><a href="#gr-value"><span class="deltaxml-new" style="background:#90EE90">generator-value</span></a></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> Generator </span><span><b><span class="deltaxml-new" style="background:#90EE90">value</span></b></span><span class="deltaxml-new" style="background:#90EE90"> - a "value" produced by a call to the generator method </span><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90"> can be either an individual XPath </span><code><span class="deltaxml-new" style="background:#90EE90">item()</span></code><span class="deltaxml-new" style="background:#90EE90"> or an XPath sequence. </span></p></dd><dt><a href="#gr-contents"><span class="deltaxml-new" style="background:#90EE90">generator-yield</span></a></dt><dd><p><span class="deltaxml-new" style="background:#90EE90"> The term </span><span><b><span class="deltaxml-new" style="background:#90EE90">yield</span></b><span class="deltaxml-new" style="background:#90EE90"> (of a generator)</span></span><span class="deltaxml-new" style="background:#90EE90"> denotes the consecutive values returned from calling the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> and then the </span><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90"> method starting from the current generator instance, and on each generator instance thus produced, by applying the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> method and then the </span><code><span class="deltaxml-new" style="background:#90EE90">get-current</span></code><span class="deltaxml-new" style="background:#90EE90"> method until </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> produces a generator instance whose </span><code><span class="deltaxml-new" style="background:#90EE90">end-reached</span></code><span class="deltaxml-new" style="background:#90EE90"> field is </span><code><span class="deltaxml-new" style="background:#90EE90">true()</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p><div class="note"><p class="prefix"><b><span class="deltaxml-new" style="background:#90EE90">Note:</span></b></p><ol class="enumar"><li><p><span class="deltaxml-new" style="background:#90EE90">Thus, if the consecutive generator instances produced by continuously applying the </span><code><span class="deltaxml-new" style="background:#90EE90">move-next()</span></code><span class="deltaxml-new" style="background:#90EE90"> method on each of them, starting from the initialized </span><code><span class="deltaxml-new" style="background:#90EE90">$G1</span></code><span class="deltaxml-new" style="background:#90EE90"> generator is:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$G2, $G3, ... , $Gn, ...</span></code><span class="deltaxml-new" style="background:#90EE90">, then the yield of the generator $G1 is exactly these consecutive generator values:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$G1 =?&gt; get-current(), $G2 =?&gt; get-current(), ..., $Gn =?&gt; get-current(), ... </span></code></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">If the sequence of the generator instances thus produced is finite (for the final produced generator </span><code><span class="deltaxml-new" style="background:#90EE90">$Gm</span></code><span class="deltaxml-new" style="background:#90EE90">, </span><code><span class="deltaxml-new" style="background:#90EE90">$Gm?end-reached eq true()</span></code><span class="deltaxml-new" style="background:#90EE90">, then the yield is:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$G1 =?&gt; get-current(), $G2 =?&gt; get-current(), ..., $Gm-1 =?&gt; get-current()</span></code></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">If the </span><code><span class="deltaxml-new" style="background:#90EE90">$G1</span></code><span class="deltaxml-new" style="background:#90EE90"> generator is not initialized (</span><code><span class="deltaxml-new" style="background:#90EE90">$G1?initialized eq false())</span></code><span class="deltaxml-new" style="background:#90EE90">, then the yield of this generator is the same as the yield of the (first initialized in the chain) </span><code><span class="deltaxml-new" style="background:#90EE90">$G2</span></code><span class="deltaxml-new" style="background:#90EE90"> generator:</span></p><p><code><span class="deltaxml-new" style="background:#90EE90">$G2 =?&gt; get-current(), $G3 =?&gt; get-current(), ..., $Gn =?&gt; get-current(), ... </span></code></p></li><li><p><span class="deltaxml-new" style="background:#90EE90">The yield is empty, if </span><code><span class="deltaxml-new" style="background:#90EE90">$G1?end-reached eq true</span></code><span class="deltaxml-new" style="background:#90EE90"> and the yield is infinite if neither </span><code><span class="deltaxml-new" style="background:#90EE90">$G1?end-reached eq true()</span></code><span class="deltaxml-new" style="background:#90EE90"> nor any of the consecutive applications of </span><code><span class="deltaxml-new" style="background:#90EE90">move-next</span></code><span class="deltaxml-new" style="background:#90EE90"> produces a generator </span><code><span class="deltaxml-new" style="background:#90EE90">$Gx</span></code><span class="deltaxml-new" style="background:#90EE90">, such that </span><code><span class="deltaxml-new" style="background:#90EE90">$Gx?end-reached eq true()</span></code><span class="deltaxml-new" style="background:#90EE90">. </span></p></li></ol></div><p></p></dd><dt><a href="#dt-gregorian">Gregorian</a></dt><dd><p>The eight primitive types <code>xs:dateTime</code>, <code>xs:date</code>, <code>xs:time</code>, <code>xs:gYearMonth</code>, <code>xs:gYear</code>, <code>xs:gMonthDay</code>, <code>xs:gMonth</code>, <code>xs:gDay</code> are referred to collectively as the <b>Gregorian</b> types.</p></dd><dt><a href="#dt-higher-order">higher-order</a></dt><dd><p>Functions that accept functions among their arguments, or that return functions in their result, are described in this specification as <b>higher-order</b> functions.</p></dd><dt><a href="#dt-identical">identical</a></dt><dd><p>Two values <code>$V1</code> and <code>$V2</code> are defined to be <b>identical</b> if they contain the same number of items and the items are pairwise identical. Two items are identical if and only if one of the following conditions applies:</p></dd><dt><a href="#implementation-defined">implementation-defined</a></dt><dd><p>Where behavior is described as <b>implementation-defined</b>, variations between processors are permitted, but a conformant implementation <span class="verb">must</span> document the choices it has made.</p></dd><dt><a href="#implementation-dependent">implementation-dependent</a></dt><dd><p>Where behavior is described as <b>implementation-dependent</b>, variations between processors are permitted, and conformant implementations are not required to document the choices they have made.</p></dd><dt><a href="#dt-map">map</a></dt><dd><p>A <b>map</b> consists of a sequence of entries, also known as key-value pairs. Each entry comprises a key which is an arbitrary atomic item, and an arbitrary sequence called the associated value.</p></dd><dt><a href="#dt-match.collation">match</a></dt><dd><p>The term <b>match</b> is used in the sense of definition DS2 from <a href="#UNICODE-TR10">[UTS #10]</a>.</p></dd><dt><a href="#dt-minimal-match.collation">minimal match</a></dt><dd><p>The term <b>minimal match</b> is used in the sense of definition DS4 from <a href="#UNICODE-TR10">[UTS #10]</a>.</p></dd><dt><a href="#dt-nondeterministic">nondeterministic</a></dt><dd><p>A function that is not <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a> is referred to as <b>nondeterministic</b>.</p></dd><dt><a href="#dt-nondeterministic-wrt-ordering">nondeterministic with respect to ordering</a></dt><dd><p>Some functions (such as <a href="#func-in-scope-prefixes"><code>fn:in-scope-prefixes</code></a>, <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a>, and <a href="#func-unordered"><code>fn:unordered</code></a>) produce result sequences or result maps in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> or <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> order. In such cases two calls with the same arguments are not guaranteed to produce the results in the same order. These functions are said to be <b>nondeterministic with respect to ordering</b>.</p></dd><dt><a href="#dt-optional-digit-character">optional digit character</a></dt><dd><p>The <b>optional digit character</b> is the character that is the value of the <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-digit">digit</a><sup><small>XP31</small></sup> property.</p></dd><dt><a href="#option-parameter-conventions">option parameter conventions</a></dt><dd><p>Functions that take an options parameter adopt common conventions on how the options are used. These are referred to as the <b>option parameter conventions</b>. These rules apply only to functions that explicitly refer to them.</p></dd><dt><a href="#dt-permitted-character">permitted character</a></dt><dd><p>A <b>permitted character</b> is one within the repertoire accepted by the implementation.</p></dd><dt><a href="#dt-picture-string">picture string</a></dt><dd><p>The formatting of a number is controlled by a <b>picture string</b>. The picture string is a sequence of <a title="character" class="termref" href="#character">characters</a>, in which the characters assigned to the properties <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-decimal-separator">decimal-separator</a><sup><small>XP31</small></sup> , <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-exponent-separator">exponent-separator</a><sup><small>XP31</small></sup>, <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-grouping-separator">grouping-separator</a><sup><small>XP31</small></sup>, <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-digit">digit</a><sup><small>XP31</small></sup>, and <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-pattern-separator">pattern-separator</a><sup><small>XP31</small></sup> and the members of the <a title="digit family" class="termref" href="#dt-decimal-digit-family">decimal digit family</a>, are classified as active characters, and all other characters (including the values of the properties <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-percent">percent</a><sup><small>XP31</small></sup> and <a href="https://www.w3.org/TR/xpath-31/#id-static-decimal-format-per-mille">per-mille</a><sup><small>XP31</small></sup>) are classified as passive characters.</p></dd><dt><a href="#dt-primitive-type">primitive type</a></dt><dd><p>A <b>primitive type</b> is one of the 19 <b>primitive atomic</b> types defined in <a href="https://www.w3.org/TR/xmlschema-2/#built-in-primitive-datatypes"> 3.2 Primitive datatypes</a><sup><small>XS2</small></sup> of <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>, or the type <code>xs:untypedAtomic</code> defined in <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p></dd><dt><a href="#dt-same-key">same key</a></dt><dd><p>Within a map, no two entries have the <b>same key</b>. Two atomic items <code>K1</code> and <code>K2</code> are the <b>same key</b> for this purpose if the <span>function call <code>fn:atomic-equal($K1, $K2)</code></span> returns <code>true</code>.</p></dd><dt><a href="#dt-segment">segment</a></dt><dd><p>A <b>segment</b> of a string <var>S</var> is a sequence of zero or more contiguous characters starting at a given <a title="character position" class="termref" href="#dt-character-position">character position</a> within <var>S</var>.</p></dd><dt><a href="#dt-single-entry-map">single-entry map</a></dt><dd><p>A <b>single-entry map</b> is a map containing a single entry.</p></dd><dt><a href="#string">string</a></dt><dd><p>A <b>string</b> is a sequence of zero or more <a title="character" class="termref" href="#character">characters</a>, or equivalently, a value in the value space of the <code>xs:string</code> datatype.</p></dd><dt><a href="#dt-type-annotation">type annotation</a></dt><dd><p>The <b>type annotation</b> of an atomic item is the most specific atomic type that it is an instance of (it is also an instance of every type from which that type is derived).</p></dd><dt><a href="#dt-codepoint-collation">Unicode codepoint collation</a></dt><dd><p>The collation URI <code>http://www.w3.org/2005/xpath-functions/collation/codepoint</code> identifies a collation which must be recognized by every implementation: it is referred to as the <b>Unicode codepoint collation</b> (not to be confused with the Unicode collation algorithm).</p></dd><dt><a href="#dt-uri">URI</a></dt><dd><p>Within this specification, the term <b>URI</b> refers to Universal Resource Identifiers as defined in <a href="#rfc3986">[RFC 3986]</a> and extended in <a href="#rfc3987">[RFC 3987]</a> with a new name <b>IRI</b>. The term <b>URI Reference</b>, unless otherwise stated, refers to a string in the lexical space of the <code>xs:anyURI</code> datatype as defined in <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a>.</p></dd><dt><a href="#dt-variadic">variadic</a></dt><dd><p>The function <a href="#func-concat"><code>fn:concat</code></a> is defined to be variadic: it accepts any number of arguments. No other function has this property.</p></dd></dl></div><div class="div1"><h2><a id="other-functions"></a>F <a href="#other-functions" style="text-decoration: none">Functions defined elsewhere</a> (Non-Normative)</h2><p>This Appendix describes some sources of functions that fall outside the scope of the function library defined in this specification. It includes both function specifications and function implementations. Inclusion of a function in this appendix does not constitute any kind of recommendation or endorsement; neither is omission from this appendix to be construed negatively. This Appendix does not attempt to give any information about licensing arrangements for these function specifications or implementations.</p><div class="div2"><h3><a id="functions-in-other-w3c-specs"></a>F.1 <a href="#functions-in-other-w3c-specs" style="text-decoration: none">XPath Functions Defined in Other W3C Recommendations</a></h3><p>A number of W3C Recommendations make use of XPath, and in some cases such Recommmendations define additional functions to be made available when XPath is used in a specific host language.</p><div class="div3"><h4><a id="functions-defined-in-XSLT"></a>F.1.1 <a href="#functions-defined-in-XSLT" style="text-decoration: none">Functions Defined in XSLT</a></h4><p>The various versions of XSLT have all included additional functions intended to be available only when XPath is used within XSLT, and not in other host language environments. Some of these functions were originally defined in XSLT, and subsequently migrated into the core function library defined in this specification.</p><p>Generally, the reason that functions have been defined in XSLT rather than in the core library has been that they required additional static or dynamic context information.</p><p>XSLT-defined functions share the core namespace <code>http://www.w3.org/2005/xpath-functions</code> (but in XPath 1.0 and XSLT 1.0, no namespace was defined for these functions).</p><p>The following table lists all functions that have been defined in XSLT, and summarizes their current status.</p><table class="data"><thead><tr><th>Function name</th><th>Availability</th></tr></thead><tbody><tr><td>fn:accumulator-after</td><td>XSLT 3.0 and later</td></tr><tr><td>fn:accumulator-before</td><td>XSLT 3.0 and later</td></tr><tr><td>fn:apply-templates</td><td>XSLT 4.0</td></tr><tr><td>fn:available-system-properties</td><td>XSLT 3.0 and later</td></tr><tr><td>fn:character-map</td><td>XSLT 4.0</td></tr><tr><td>fn:collation-key</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>fn:copy-of</td><td>XSLT 3.0 and later</td></tr><tr><td>fn:current</td><td>XSLT 1.0 and later</td></tr><tr><td>fn:current-group</td><td>XSLT 2.0 and later</td></tr><tr><td>fn:current-grouping-key</td><td>XSLT 2.0 and later</td></tr><tr><td>fn:current-merge-group</td><td>XSLT 3.0 and later</td></tr><tr><td>fn:current-merge-key</td><td>XSLT 3.0 and later</td></tr><tr><td>fn:current-merge-key-array</td><td>XSLT 4.0</td></tr><tr><td>fn:current-output-uri</td><td>XSLT 3.0 and later</td></tr><tr><td>fn:document</td><td>XSLT 1.0 and later</td></tr><tr><td>fn:element-available</td><td>XSLT 1.0 and later</td></tr><tr><td>fn:format-date</td><td>Originally XSLT 2.0, then XPath 3.0 and later</td></tr><tr><td>fn:format-dateTime</td><td>Originally XSLT 2.0, then XPath 3.0 and later</td></tr><tr><td>fn:format-number</td><td>Originally XSLT 1.0 and 2.0; then XPath 3.0 and later</td></tr><tr><td>fn:format-time</td><td>Originally XSLT 2.0; then XPath 3.0 and later</td></tr><tr><td>fn:function-available</td><td>XSLT 1.0 and later</td></tr><tr><td>fn:generate-id</td><td>Originally XSLT 1.0 and 2.0; then XPath 3.0 and later</td></tr><tr><td>fn:json-to-xml</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>fn:key</td><td>XSLT 1.0 and later</td></tr><tr><td>fn:map-for-key</td><td>XSLT 4.0</td></tr><tr><td>fn:regex-group</td><td>XSLT 2.0 and later</td></tr><tr><td>fn:regex-groups</td><td>XSLT 4.0</td></tr><tr><td>fn:snapshot</td><td>XSLT 3.0 and later</td></tr><tr><td>fn:stream-available</td><td>XSLT 3.0 and later</td></tr><tr><td>fn:system-property</td><td>XSLT 1.0 and later</td></tr><tr><td>fn:type-available</td><td>XSLT 2.0 and later</td></tr><tr><td>fn:unparsed-entity-public-id</td><td>XSLT 2.0 and later</td></tr><tr><td>fn:unparsed-entity-uri</td><td>XSLT 1.0 and later</td></tr><tr><td>fn:unparsed-text</td><td>Originally XSLT 2.0; then XPath 3.0 and later</td></tr><tr><td>fn:unparsed-text-available</td><td>Originally XSLT 2.0; then XPath 3.0 and later</td></tr><tr><td>fn:xml-to-json</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:contains</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:entry</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:find</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:for-each</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:get</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:keys</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:merge</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:put</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:remove</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr><tr><td>map:size</td><td>Originally XSLT 3.0, then XPath 3.1 and later</td></tr></tbody></table><div class="note"><p class="prefix"><b>Note:</b></p><p>XSLT 3.0 was well advanced when work started on XPath 3.1, but XPath 3.1 appeared as a Recommendation before XSLT 3.0 reached that status.</p></div></div><div class="div3"><h4><a id="functions-defined-in-XForms"></a>F.1.2 <a href="#functions-defined-in-XForms" style="text-decoration: none">Functions Defined in XForms</a></h4><p>XForms 1.1 is based on XPath 1.0. It adds the following functions to the set defined in XPath 1.0, using the same namespace:</p><p><code>boolean-from-string</code>, <code>is-card-number</code>, <code>avg</code>, <code>min</code>, <code>max</code>, <code>count-non-empty</code>, <code>index</code>, <code>power</code>, <code>random</code>, <code>compare</code>, <code>if</code>, <code>property</code>, <code>digest</code>, <code>hmac</code>, <code>local-date</code>, <code>local-dateTime</code>, <code>now</code>, <code>days-from-date</code>, <code>days-to-date</code>, <code>seconds-from-dateTime</code>, <code>seconds-to-dateTime</code>, <code>adjust-dateTime-to-timezone</code>, <code>seconds</code>, <code>months</code>, <code>instance</code>, <code>current</code>, <code>id</code>, <code>context</code>, <code>choose</code>, <code>event</code>.</p><p>XForms 2.0 was first published as a W3C Working Draft, and subsequently as a W3C Community Group specification. These draft specifications do not include any additional functions beyond those in the core XPath specification.</p></div><div class="div3"><h4><a id="xquery-update"></a>F.1.3 <a href="#xquery-update" style="text-decoration: none">Function Defined in XQuery Update 1.0</a></h4><p>The XQuery Update 1.0 specification defines one additional function in the core namespace <code>http://www.w3.org/2005/xpath-functions</code>, namely <code>fn:put</code>. This function can be used to write a document to external storage. It is thus unusual in that it has side-effects; the XQuery Update 1.0 specification defines semantics for updating expressions including this function.</p><p>Although XQuery Update 1.0 is defined as an extension of XQuery 1.0, a number of implementers have adapted it, in a fairly intuitive way, to work with later versions of XQuery. At the time of this publication, later versions of the XQuery Update specification remain at Working Draft status.</p></div></div><div class="div2"><h3><a id="functions-defined-by-community-groups"></a>F.2 <a href="#functions-defined-by-community-groups" style="text-decoration: none">Functions Defined by Community Groups</a></h3><p>A number of community groups, with varying levels of formal organization, have defined specifications for additional function libraries to augment the core functions defined in this specification. Many of the resulting function specifications have implementations available for popular XPath, XQuery, and XSLT processors, though the level of support is highly variable.</p><p>The first such group was EXSLT. This activity was primarily concerned with augmenting the capability of XSLT 1.0, and many of its specifications were overtaken by core functions that became available in XPath 2.0. EXSLT defined a number of function modules covering:</p><blockquote><p>Dates and Times<br>Dynamic XPath Evaluation<br>Common (containing most notably the widely used <code>node-set</code> function)<br>Math (<code>max</code>, <code>min</code>, <code>abs</code>, and trigonometric functions)<br>Random Number Generation<br>Regular Expressions<br>Sets (operations on sets of nodes including set intersection and difference)<br>String Manipulation (tokenize, replace, join and split, etc.)</p></blockquote><p>Specifications from the EXSLT group can be found at <a href="#exslt">[EXSLT]</a>.</p><p>A renewed attempt to define additional function libraries using XPath 2.0 as its baseline formed under the name EXPath. Again, the specifications are in various states of maturity and stability, and implementation across popular processors is patchy. At the time of this publication the function libraries that exist in stable published form include:</p><blockquote><p>Binary (functions for manipulating binary data)<br>File Handling (reading and writing files)<br>Geospatial (handling of geographic data)<br>HTTP Client (sending HTTP requests)<br>ZIP Facility (reading and creating ZIP files or similar archives)</p></blockquote><p>The EXPath community has also been engaged in other related projects, such as defining packaging standards for distribution of XSLT/XQuery components, and tools for unit testing. Its specifications can be found at <a href="#expath">[EXPath]</a>.</p><p>A third activity has operated under the name EXQuery, which as the name suggests has focused on extensions to XQuery. EXQuery has published a single specification, RestXQ, which is primarily a system of function annotations allowing XQuery functions to act as endpoints for RESTful services. It also includes some simple functions to assist with the creation of such services. The RestXQ specification can be found at <a href="#exquery">[EXQuery]</a>.</p></div><div class="div2"><h3><a id="functx-library"></a>F.3 <a href="#functx-library" style="text-decoration: none">The FunctX Library</a></h3><p>Many useful functions can be written in XSLT or XQuery, and in this case the function implementations themselves can be portable across different XSLT and XQuery processors. This section describes one such library.</p><p>FunctX is an open-source library of general-purpose functions, supplied in the form of XQuery 1.0 and XSLT 2.0 implementations. It contains over a hundred functions. Typical examples of these functions are:</p><blockquote><p>Test whether a string is all-whitespace<br>Trim leading and trailing whitespace<br>Test whether all the values in a sequence are distinct<br>Capitalize the first character of a string<br>Change the namespace of all elements in a tree<br>Get the number of days in a given month<br>Get the first or last day in a given month<br>Get the date of the preceding or following day<br>Ask whether an element has element-only, mixed, or simple content<br>Find the position of a node in a sequence<br>Count words in a string</p></blockquote><p>The FunctX library can be found at <a href="#functx">[FunctX]</a>.</p></div></div><div class="div1"><h2><a id="impl-def"></a>G <a href="#impl-def" style="text-decoration: none">Implementation-defined features</a> (Non-Normative)</h2><ol><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which version of Unicode is supported, but it is recommended that the most recent version of Unicode be used. (See <a href="#conformance">Conformance</a>.)</p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether the type system is based on XML Schema 1.0 or XML Schema 1.1. (See <a href="#conformance">Conformance</a>.)</p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether definitions that rely on XML (for example, the set of valid XML characters) should use the definitions in XML 1.0 or XML 1.1. (See <a href="#conformance">Conformance</a>.)</p></li><li><p>Implementations <span class="verb">may</span> attach an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> meaning to options in the map that are not described in this specification. These options <span class="verb">should</span> use values of type <code>xs:QName</code> as the option names, using an appropriate namespace. (See <a href="#options">Options</a>.)</p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which version of <a href="#Unicode">[The Unicode Standard]</a> is supported, but it is recommended that the most recent version of Unicode be used. (See <a href="#character-terminology">Strings, characters, and codepoints</a>.)</p></li><li><p><span class="termdef">[Definition] Some functions (such as <a href="#func-in-scope-prefixes"><code>fn:in-scope-prefixes</code></a>, <a href="#func-load-xquery-module"><code>fn:load-xquery-module</code></a>, and <a href="#func-unordered"><code>fn:unordered</code></a>) produce result sequences or result maps in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> or <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> order. In such cases two calls with the same arguments are not guaranteed to produce the results in the same order. These functions are said to be <b>nondeterministic with respect to ordering</b>.</span> (See <a href="#properties-of-functions">Properties of functions</a>.)</p></li><li><p>Where the results of a function are described as being (to a greater or lesser extent) <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> or <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a>, this does not by itself remove the requirement that the results should be deterministic: that is, that repeated calls with the same explicit and implicit arguments <span class="verb">must</span> return identical results. (See <a href="#properties-of-functions">Properties of functions</a>.)</p></li><li><p> They <span class="verb">may</span> provide an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> mechanism that allows users to choose between raising an error and returning a result that is modulo the largest representable integer value. See <a href="#ISO10967">[ISO 10967]</a>. (See <a href="#op.numeric">Arithmetic operators on numeric values</a>.)</p></li><li><p>For <code>xs:decimal</code> values, let <var>N</var> be the number of digits of precision supported by the implementation, and let <var>M</var> (<code>M &lt;= N</code>) be the minimum limit on the number of digits required for conformance (18 digits for XSD 1.0, 16 digits for XSD 1.1). Then for addition, subtraction, and multiplication operations, the returned result <span class="verb">should</span> be accurate to <var>N</var> digits of precision, and for division and modulus operations, the returned result <span class="verb">should</span> be accurate to at least <var>M</var> digits of precision. The actual precision is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the number of digits in the mathematical result exceeds the number of digits that the implementation retains for that operation, the result is truncated or rounded in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> manner. (See <a href="#op.numeric">Arithmetic operators on numeric values</a>.)</p></li><li><p>The <a href="#ieee754-2019">[IEEE 754-2019]</a> specification also describes handling of two exception conditions called <code>divideByZero</code> and <code>invalidOperation</code>. The IEEE <code>divideByZero</code> exception is raised not only by a direct attempt to divide by zero, but also by operations such as <code>log(0)</code>. The IEEE <code>invalidOperation</code> exception is raised by attempts to call a function with an argument that is outside the function’s domain (for example, <code>sqrt(-1)</code> or <code>log(-1)</code>). Although IEEE defines these as exceptions, it also defines “default non-stop exception handling” in which the operation returns a defined result, typically positive or negative infinity, or <code>NaN</code>. With this function library, these IEEE exceptions do not cause a dynamic error at the application level; rather they result in the relevant function or operator returning the defined non-error result. The underlying IEEE exception <span class="verb">may</span> be notified to the application or to the user by some <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> warning condition, but the observable effect on an application using the functions and operators defined in this specification is simply to return the defined result (typically <code>-INF</code>, <code>+INF</code>, or <code>NaN</code>) with no error. (See <a href="#op.numeric">Arithmetic operators on numeric values</a>.)</p></li><li><p>The <a href="#ieee754-2019">[IEEE 754-2019]</a> specification distinguishes two <code>NaN</code> values: a quiet <code>NaN</code> and a signaling <code>NaN</code>. These two values are not distinguishable in the XDM model: the value spaces of <code>xs:float</code> and <code>xs:double</code> each include only a single <code>NaN</code> value. This does not prevent the implementation distinguishing them internally, and triggering different <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> warning conditions, but such distinctions do not affect the observable behavior of an application using the functions and operators defined in this specification. (See <a href="#op.numeric">Arithmetic operators on numeric values</a>.)</p></li><li><p>The implementation may adopt a different algorithm provided that it is equivalent to this formulation in all cases where <a title="implementation-dependent" class="termref" href="#implementation-dependent">implementation-dependent</a> or <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> behavior does not affect the outcome, for example, the implementation-defined precision of the result of <code>xs:decimal</code> division. (See <a href="#func-numeric-integer-divide">op:numeric-integer-divide</a>.)</p></li><li><p>There may be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on the precision available. If the requested <code>$precision</code> is outside this range, it should be adjusted to the nearest value supported by the implementation. (See <a href="#func-divide-decimals">fn:divide-decimals</a>.)</p></li><li><p>There may be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on the precision available. If the requested <code>$precision</code> is outside this range, it should be adjusted to the nearest value supported by the implementation. (See <a href="#func-round">fn:round</a>.)</p></li><li><p>There may be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on the precision available. If the requested <code>$precision</code> is outside this range, it should be adjusted to the nearest value supported by the implementation. (See <a href="#func-round-half-to-even">fn:round-half-to-even</a>.)</p></li><li><p>XSD 1.1 allows the string <code>+INF</code> as a representation of positive infinity; XSD 1.0 does not. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether XSD 1.1 is supported. (See <a href="#func-number">fn:number</a>.)</p></li><li><p>Any other format token, which indicates a numbering sequence in which that token represents the number 1 (one) (but see the note below). It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which numbering sequences, additional to those listed above, are supported. If an implementation does not support a numbering sequence represented by the given token, it <span class="verb">must</span> use a format token of <code>1</code>. (See <a href="#func-format-integer">fn:format-integer</a>.)</p></li><li><p>For all format tokens other than a <var>digit-pattern</var>, there <span class="verb">may</span> be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> lower and upper bounds on the range of numbers that can be formatted using this format token; indeed, for some numbering sequences there may be intrinsic limits. For example, the format token <span class="unicode-codepoint">U+2460</span> (<span class="unicode-name">CIRCLED DIGIT ONE</span>, <code>①</code>) has a range imposed by the Unicode character repertoire — <span>zero to 20</span> in Unicode versions prior to <span>3.2</span>, or <span>zero to 50</span> in subsequent versions. For the numbering sequences described above any upper bound imposed by the implementation <span class="verb">must not</span> be less than 1000 (one thousand) and any lower bound must not be greater than 1. Numbers that fall outside this range <span class="verb">must</span> be formatted using the format token <code>1</code>. (See <a href="#func-format-integer">fn:format-integer</a>.)</p></li><li><p>The set of languages for which numbering is supported is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the <code>$language</code> argument is absent, or is set to the empty sequence, or is invalid, or is not a language supported by the implementation, then the number is formatted using the default language from the dynamic context. (See <a href="#func-format-integer">fn:format-integer</a>.)</p></li><li><p>...either <code>a</code> or <code>t</code>, to indicate alphabetic or traditional numbering respectively, the default being <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#func-format-integer">fn:format-integer</a>.)</p></li><li><p>The string of characters between the parentheses, if present, is used to select between other possible variations of cardinal or ordinal numbering sequences. The interpretation of this string is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. No error occurs if the implementation does not define any interpretation for the defined string. (See <a href="#func-format-integer">fn:format-integer</a>.)</p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> what combinations of values of the format token, the language, and the cardinal/ordinal modifier are supported. If ordinal numbering is not supported for the combination of the format token, the language, and the string appearing in parentheses, the request is ignored and cardinal numbers are generated instead. (See <a href="#func-format-integer">fn:format-integer</a>.)</p></li><li><p>The use of the <code>a</code> or <code>t</code> modifier disambiguates between numbering sequences that use letters. In many languages there are two commonly used numbering sequences that use letters. One numbering sequence assigns numeric values to letters in alphabetic sequence, and the other assigns numeric values to each letter in some other manner traditional in that language. In English, these would correspond to the numbering sequences specified by the format tokens <code>a</code> and <code>i</code>. In some languages, the first member of each sequence is the same, and so the format token alone would be ambiguous. In the absence of the <code>a</code> or <code>t</code> modifier, the default is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#func-format-integer">fn:format-integer</a>.)</p></li><li><p>The static context provides a set of decimal formats. One of the decimal formats is unnamed, the others (if any) are identified by a QName. There is always an unnamed decimal format available, but its contents are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#defining-decimal-format">Defining a decimal format</a>.)</p></li><li><p>IEEE states that the preferred quantum is language-defined. In this specification, it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#trigonometry">Trigonometric and exponential functions</a>.)</p></li><li><p>IEEE defines various rounding algorithms for inexact results, and states that the choice of rounding direction, and the mechanisms for influencing this choice, are language-defined. In this specification, the rounding direction and any mechanisms for influencing it are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#trigonometry">Trigonometric and exponential functions</a>.)</p></li><li><p>The map returned by the <a href="#func-random-number-generator"><code>fn:random-number-generator</code></a> function <span class="verb">may</span> contain additional entries beyond those specified here, but it <span class="verb">must</span> match the <span>record type defined above</span>. The meaning of any additional entries is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. To avoid conflict with any future version of this specification, the keys of any such entries <span class="verb">should</span> start with an underscore character. (See <a href="#func-random-number-generator">fn:random-number-generator</a>.)</p></li><li><p>It is no longer automatically an error if the input contains a codepoint that is not valid in XML. Instead, the codepoint must be a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. The set of permitted characters is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but it is <span class="verb">recommended</span> that all Unicode characters should be accepted. (See <a href="#func-codepoints-to-string">fn:codepoints-to-string</a>.)</p></li><li><p>If two query parameters use the same keyword then the last one wins. If a query parameter uses a keyword or value which is not defined in this specification then the meaning is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the implementation recognizes the meaning of the keyword and value then it <span class="verb">should</span> interpret it accordingly; if it does not recognize the keyword or value then if the <code>fallback</code> parameter is present with the value <code>no</code> it should reject the collation as unsupported, otherwise it should ignore the unrecognized parameter. (See <a href="#uca-collations">The Unicode Collation Algorithm</a>.)</p></li><li><p>The following query parameters are defined. If any parameter is absent, the default is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> except where otherwise stated. The meaning given for each parameter is non-normative; the normative specification is found in <a href="#UNICODE-TR35">[UTS #35]</a>. (See <a href="#uca-collations">The Unicode Collation Algorithm</a>.)</p></li><li><p>Because the set of collations that are supported is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, an implementation has the option to support all collation URIs, in which case it will never raise this error. (See <a href="#choosing-a-collation">Choosing a collation</a>.)</p></li><li><p>The properties available are as defined for the Unicode Collation Algorithm (see <a href="#uca-collations"><b>5.3.4 The Unicode Collation Algorithm</b></a>). Additional <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> properties <span class="verb">may</span> be specified as described in the rules for UCA collation URIs. (See <a href="#func-collation">fn:collation</a>.)</p></li><li><p>It is possible to define collations that do not have the ability to generate collation keys. Supplying such a collation will cause the function to fail. The ability to generate collation keys is an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> property of the collation. (See <a href="#func-collation-key">fn:collation-key</a>.)</p></li><li><p>Conforming implementations <span class="verb">must</span> support normalization form <code>NFC</code> and <span class="verb">may</span> support normalization forms <code>NFD</code>, <code>NFKC</code>, <code>NFKD</code>, and <code>FULLY-NORMALIZED</code>. They <span class="verb">may</span> also support other normalization forms with <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> semantics. (See <a href="#func-normalize-unicode">fn:normalize-unicode</a>.)</p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which version of Unicode (and therefore, of the normalization algorithms and their underlying data) is supported by the implementation. See <a href="#UNICODE-TR15">[UAX #15]</a> for details of the stability policy regarding changes to the normalization rules in future versions of Unicode. If the input string contains codepoints that are unassigned in the relevant version of Unicode, or for which no normalization rules are defined, the <a href="#func-normalize-unicode"><code>fn:normalize-unicode</code></a> function leaves such codepoints unchanged. If the implementation supports the requested normalization form then it <span class="verb">must</span> be able to handle every input string without raising an error. (See <a href="#func-normalize-unicode">fn:normalize-unicode</a>.)</p></li><li><p>It is possible to define collations that do not have the ability to decompose a string into units suitable for substring matching. An argument to a function defined in this section may be a URI that identifies a collation that is able to compare two strings, but that does not have the capability to split the string into collation units. Such a collation may cause the function to fail, or to give unexpected results, or it may be rejected as an unsuitable argument. The ability to decompose strings into collation units is an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> property of the collation. The <a href="#func-collation-available"><code>fn:collation-available</code></a> function can be used to ask whether a particular collation has this property. (See <a href="#substring.functions">Functions based on substring matching</a>.)</p></li><li><p>The result of the function will always be such that validation against this schema would succeed. However, it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether the result is typed or untyped, that is, whether the elements and attributes in the returned tree have type annotations that reflect the result of validating against this schema. (See <a href="#func-analyze-string">fn:analyze-string</a>.)</p></li><li><p>Some URI schemes are hierarchical and some are non-hierarchical. Implementations must treat the following schemes as non-hierarchical: <code>jar</code>, <code>mailto</code>, <code>news</code>, <code>tag</code>, <code>tel</code>, and <code>urn</code>. Whether additional schemes are known to be non-hierarchical <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If a scheme is not known to be non-hierarchical, it must be treated as hierarchical. (See <a href="#parse-build">Parsing and building URIs</a>.)</p></li><li><p>If the <code>omit-default-ports</code> option is <code>true</code>, the port is discarded and set to the empty sequence if the port number is the same as the default port for the given scheme. Implementations <span class="verb">should</span> recognize the default ports for <code>http</code> (80), <code>https</code> (443), <code>ftp</code> (21), and <code>ssh</code> (22). Exactly which ports are recognized is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#func-parse-uri">fn:parse-uri</a>.)</p></li><li><p>If the <code>omit-default-ports</code> option is <code>true</code> then the <code>$port</code> is set to the empty sequence if the port number is the same as the default port for the given scheme. Implementations <span class="verb">should</span> recognize the default ports for <code>http</code> (80), <code>https</code> (443), <code>ftp</code> (21), and <code>ssh</code> (22). Exactly which ports are recognized is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#func-build-uri">fn:build-uri</a>.)</p></li><li><p>Processors <span class="verb">may</span> support a greater range and/or precision. The limits are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#duration-conformance">Limits and precision</a>.)</p></li><li><p>Similarly, a processor may be unable accurately to represent the result of dividing a duration by 2, or multiplying a duration by 0.5. A processor that limits the precision of the seconds component of duration values <span class="verb">must</span> deliver a result that is as close as possible to the mathematically precise result, given these limits; if two values are equally close, the one that is chosen is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#duration-conformance">Limits and precision</a>.)</p></li><li><p>All conforming processors <span class="verb">must</span> support year values in the range 1 to 9999, and a minimum fractional second precision of 1 millisecond or three digits (that is, <code>s.sss</code>). However, processors <span class="verb">may</span> set larger <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on the maximum number of digits they support in these two situations. Processors <span class="verb">may</span> also choose to support the year 0 and years with negative values. The results of operations on dates that cross the year 0 are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#date-time-duration-conformance">Limits and precision</a>.)</p></li><li><p>Similarly, a processor that limits the precision of the seconds component of date and time or duration values may need to deliver a rounded result for arithmetic operations. Such a processor <span class="verb">must</span> deliver a result that is as close as possible to the mathematically precise result, given these limits: if two values are equally close, the one that is chosen is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#date-time-duration-conformance">Limits and precision</a>.)</p></li><li><p>...the format token <code>n</code>, <code>N</code>, or <code>Nn</code>, indicating that the value of the component is to be output by name, in lower-case, upper-case, or title-case respectively. Components that can be output by name include (but are not limited to) months, days of the week, timezones, and eras. If the processor cannot output these components by name for the chosen calendar and language then it must use an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> fallback representation. (See <a href="#date-picture-string">The picture string</a>.)</p></li><li><p>...indicates alphabetic or traditional numbering respectively, the default being <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. This has the same meaning as in the second argument of <a href="#func-format-integer"><code>fn:format-integer</code></a>. (See <a href="#date-picture-string">The picture string</a>.)</p></li><li><p>The sequence of characters in the (adjusted) first presentation modifier is reversed (for example, <code>999'###</code> becomes <code>###'999</code>). If the result is not a valid <b>decimal digit pattern</b>, then the output is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#formatting-fractional-seconds">Formatting Fractional Seconds</a>.)</p></li><li><p>The output for these components is entirely <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. The default presentation modifier for these components is <code>n</code>, indicating that they are output as names (or conventional abbreviations), and the chosen names will in many cases depend on the chosen language: see <a href="#lang-cal-place"><b>9.9.4.8 The language, calendar, and place arguments</b></a>. (See <a href="#formatting-other-components">Formatting Other Components</a>.)</p></li><li><p>The set of languages, calendars, and places that are supported in the <a title="date formatting function" class="termref" href="#dt-date-formatting-function">date formatting functions</a> is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. When any of these arguments is omitted or is the empty sequence, an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> default value is used. (See <a href="#lang-cal-place">The language, calendar, and place arguments</a>.)</p></li><li><p>The choice of the names and abbreviations used in any given language is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. For example, one implementation might abbreviate July as <code>Jul</code> while another uses <code>Jly</code>. In German, one implementation might represent Saturday as <code>Samstag</code> while another uses <code>Sonnabend</code>. Implementations <span class="verb">may</span> provide mechanisms allowing users to control such choices. (See <a href="#lang-cal-place">The language, calendar, and place arguments</a>.)</p></li><li><p>The choice of the names and abbreviations used in any given language for calendar units such as days of the week and months of the year is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#lang-cal-place">The language, calendar, and place arguments</a>.)</p></li><li><p>The calendar value if present <span class="verb">must</span> be a valid <code>EQName</code> (dynamic error: [<a href="#ERRFOFD1340" title="err:FOFD1340">err:FOFD1340</a>]). If it is a lexical <code>QName</code> then it is expanded into an expanded QName using the statically known namespaces; if it has no prefix then it represents an expanded-QName in no namespace. If the expanded QName is in no namespace, then it <span class="verb">must</span> identify a calendar with a designator specified below (dynamic error: [<a href="#ERRFOFD1340" title="err:FOFD1340">err:FOFD1340</a>]). If the expanded QName is in a namespace then it identifies the calendar in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way. (See <a href="#lang-cal-place">The language, calendar, and place arguments</a>.)</p></li><li><p>At least one of the above calendars <span class="verb">must</span> be supported. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which calendars are supported. (See <a href="#lang-cal-place">The language, calendar, and place arguments</a>.)</p></li><li><p>If the arguments to <a href="#func-function-lookup"><code>fn:function-lookup</code></a> identify a function that is present in the static context of the function call, the function will always return the same function that a static reference to this function would bind to. If there is no such function in the static context, then the results depend on what is present in the dynamic context, which is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#func-function-lookup">fn:function-lookup</a>.)</p></li><li><p>It is to some extent <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether two maps or arrays have the same function identity. Processors <span class="verb">should</span> ensure as a minimum that when a variable <code>$m</code> is bound to a map or array, calling <code>jtree($m)</code> more than once (with the same variable reference) will deliver the same JNode each time. (See <a href="#func-jtree">fn:jtree</a>.)</p></li><li><p>The requirement to deliver a deterministic result has performance implications, and for this reason implementations may provide a user option to evaluate the function without a guarantee of determinism. The manner in which any such option is provided is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the user has not selected such an option, a call of the function must either return a deterministic result or must raise a dynamic error [<a href="#ERRFODC0003" title="err:FODC0003">err:FODC0003</a>]. (See <a href="#func-doc">fn:doc</a>.)</p></li><li><p>Various aspects of this processing are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations may provide external configuration options that allow any aspect of the processing to be controlled by the user. In particular:... (See <a href="#func-doc">fn:doc</a>.)</p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether DTD validation and/or schema validation is applied to the source document. (See <a href="#func-doc">fn:doc</a>.)</p></li><li><p>The effect of a fragment identifier in the supplied URI is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. One possible interpretation is to treat the fragment identifier as an ID attribute value, and to return a document node having the element with the selected ID value as its only child. (See <a href="#func-doc">fn:doc</a>.)</p></li><li><p>By default, this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>. This means that repeated calls on the function with the same argument will return the same result. However, for performance reasons, implementations may provide a user option to evaluate the function without a guarantee of determinism. The manner in which any such option is provided is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the user has not selected such an option, a call to this function must either return a deterministic result or must raise a dynamic error [<a href="#ERRFODC0003" title="err:FODC0003">err:FODC0003</a>]. (See <a href="#func-collection">fn:collection</a>.)</p></li><li><p>By default, this function is <a title="deterministic" class="termref" href="#dt-deterministic">deterministic</a>. This means that repeated calls on the function with the same argument will return the same result. However, for performance reasons, implementations may provide a user option to evaluate the function without a guarantee of determinism. The manner in which any such option is provided is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. If the user has not selected such an option, a call to this function must either return a deterministic result or must raise a dynamic error [<a href="#ERRFODC0003" title="err:FODC0003">err:FODC0003</a>]. (See <a href="#func-uri-collection">fn:uri-collection</a>.)</p></li><li><p>It is no longer automatically an error if the resource (after decoding) contains a codepoint that is not valid in XML. Instead, the codepoint must be a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. The set of permitted characters is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but it is <span class="verb">recommended</span> that all Unicode characters should be accepted. (See <a href="#func-unparsed-text">fn:unparsed-text</a>.)</p></li><li><p>...the encoding inferred from the initial octets of the resource, or from <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> heuristics as defined by the rules of the <a href="https://qt4cg.org/specifications/EXPath/binary-40/Overview.html#func-bin-infer-encoding"><code>bin:infer-encoding</code></a> function. (See <a href="#func-unparsed-text">fn:unparsed-text</a>.)</p></li><li><p>The fact that the resolution of URIs is defined by a mapping in the dynamic context means that in effect, various aspects of the behavior of this function are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations may provide external configuration options that allow any aspect of the processing to be controlled by the user. In particular:... (See <a href="#func-unparsed-text">fn:unparsed-text</a>.)</p></li><li><p>The fact that the resolution of URIs is defined by a mapping in the dynamic context means that in effect, various aspects of the behavior of this function are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations may provide external configuration options that allow any aspect of the processing to be controlled by the user. In particular:... (See <a href="#func-unparsed-binary">fn:unparsed-binary</a>.)</p></li><li><p>The collation used for matching names is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but must be the same as the collation used to ensure that the names of all environment variables are unique. (See <a href="#func-environment-variable">fn:environment-variable</a>.)</p></li><li><p>Except to the extent defined by these options, the precise process used to construct the XDM instance is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. In particular, it is implementation-defined whether an XML 1.0 or XML 1.1 parser is used. (See <a href="#func-parse-xml">fn:parse-xml</a>.)</p></li><li><p>Options set in <code>$options</code> may be supplemented or modified based on configuration options defined externally using <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> mechanisms. (See <a href="#func-parse-xml">fn:parse-xml</a>.)</p></li><li><p>Except as explicitly defined, the precise process used to construct the XDM instance is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. In particular, it is implementation-defined whether an XML 1.0 or XML 1.1 parser is used. (See <a href="#func-parse-xml-fragment">fn:parse-xml-fragment</a>.)</p></li><li><p>If the second argument is omitted, or is supplied in the form of an <code>output:serialization-parameters</code> element, then the values of any serialization parameters that are not explicitly specified is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, and may depend on the context. (See <a href="#func-serialize">fn:serialize</a>.)</p></li><li><p>A list of target namespaces identifying schema components to be used for validation. The way in which the processor locates schema components for the specified target namespaces is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. A zero-length string denotes a no-namespace schema.... (See <a href="#func-xsd-validator">fn:xsd-validator</a>.)</p></li><li><p>Set to the decimal value 1.0 or 1.1 to indicate which version of XSD is to be used. The default is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. A processor may use a later version of XSD than the version requested, but must not use an earlier version.... (See <a href="#func-xsd-validator">fn:xsd-validator</a>.)</p></li><li><p>The XSD specification allows a schema to be used for validation even when it contains unresolved references to absent schema components. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether this function allows the schema to be incomplete in this way. For example, some processors might allow validation using a schema in which an element declaration contains a reference to a type declaration that is not present in the schema, provided that the element declaration is never needed in the course of a particular validation episode. (See <a href="#func-xsd-validator">fn:xsd-validator</a>.)</p></li><li><p>...<code>error-details as map(*)*</code>. This field is present only when (a) the option <code>return-error-details</code> was set to <code>true</code>, and (b) the supplied document was found to be invalid. The value is a sequence of maps, each containing details of one invalidity that was found. The precise details of the invalidities are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but they <span class="verb">may</span> include the following fields, if the information is available:... (See <a href="#func-xsd-validator">fn:xsd-validator</a>.)</p></li><li><p>Because the <a href="#dom-ls">[DOM: Living Standard]</a> and <a href="#html5">[HTML: Living Standard]</a> are not fixed, it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which versions are used. (See <a href="#html-xdm-mapping">XDM Mapping from HTML DOM Nodes</a>.)</p></li><li><p>If an implementation allows these nodes to be passed in via an API or similar mechanism, their behaviour is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#html-xdm-mapping">XDM Mapping from HTML DOM Nodes</a>.)</p></li><li><p>If the local name contains a character that is not a valid XML <code>NameStartChar</code> or <code>NameChar</code>, then an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> replacement string is used. The result must be a valid <code>NCName</code>. (See <a href="#html-node-name-accessor">node-name Accessor</a>.)</p></li><li><p>If the local name contains a character that is not a valid XML <code>NameStartChar</code> or <code>NameChar</code>, then an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> replacement string is used. The result must be a valid <code>NCName</code>. (See <a href="#html-node-name-accessor">node-name Accessor</a>.)</p></li><li><p> The input <span class="verb">may</span> contain deviations from the grammar of <a href="#rfc7159">[RFC 7159]</a>, which are handled in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way. (Note: some popular extensions include allowing quotes on keys to be omitted, allowing a comma to appear after the last item in an array, allowing leading zeroes in numbers, and allowing control characters such as tab and newline to be present in unescaped form.) Since the extensions accepted are implementation-defined, an error <span class="verb">may</span> be raised [<a href="#ERRFOJS0001" title="err:FOJS0001">err:FOJS0001</a>] if the input does not conform to the grammar. (See <a href="#func-parse-json">fn:parse-json</a>.)</p></li><li><p> The supplied function is called to process the string value of any JSON number in the input. By default, numbers are processed by converting to <code>xs:double</code> using the XPath casting rules. Supplying the value <code>xs:decimal#1</code> will instead convert to <code>xs:decimal</code> (which potentially retains more precision, but disallows exponential notation), while supplying a function that casts to <code>(xs:decimal | xs:double)</code> will treat the value as <code>xs:decimal</code> if there is no exponent, or as <code>xs:double</code> otherwise. Supplying the value <a href="#func-identity"><code>fn:identity#1</code></a> causes the value to be retained unchanged as an <code>xs:untypedAtomic</code>. If the <code>liberal</code> option is <code>false</code> (the default), then the supplied <code>number-parser</code> is called if and only if the value conforms to the JSON grammar for numbers (for example, a leading plus sign and redundant leading zeroes are not allowed). If the <code>liberal</code> option is <code>true</code> then it is also called if the value conforms to an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> extension of this grammar. (See <a href="#func-parse-json">fn:parse-json</a>.)</p></li><li><p>It is no longer automatically an error if the input contains a codepoint that is not valid in XML. Instead, the codepoint must be a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. The set of permitted characters is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but it is <span class="verb">recommended</span> that all Unicode characters should be accepted. (See <a href="#func-json-doc">fn:json-doc</a>.)</p></li><li><p> The input <span class="verb">may</span> contain deviations from the grammar of <a href="#rfc7159">[RFC 7159]</a>, which are handled in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way. (Note: some popular extensions include allowing quotes on keys to be omitted, allowing a comma to appear after the last item in an array, allowing leading zeroes in numbers, and allowing control characters such as tab and newline to be present in unescaped form.) Since the extensions accepted are implementation-defined, an error <span class="verb">may</span> be raised (see below) if the input does not conform to the grammar. (See <a href="#func-json-to-xml">fn:json-to-xml</a>.)</p></li><li><p><b>Default: </b><a title="implementation-defined" class="termref" href="#implementation-defined">Implementation-defined</a>. (See <a href="#func-json-to-xml">fn:json-to-xml</a>.)</p></li><li><p> Indicates that the resulting XDM instance must be typed; that is, the element and attribute nodes must carry the type annotations that result from validation against the schema given at <a href="#schema-for-json"><b>D.2 Schema for the result of fn:json-to-xml</b></a>, or against an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> schema if the <code>liberal</code> option has the value <code>true</code>. (See <a href="#func-json-to-xml">fn:json-to-xml</a>.)</p></li><li><p>The result of the function will always be such that validation against this schema would succeed. However, it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether the result is typed or untyped, that is, whether the elements and attributes in the returned tree have type annotations that reflect the result of validating against this schema. (See <a href="#func-csv-to-xml">fn:csv-to-xml</a>.)</p></li><li><p>Additional, <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> options may be available, for example, to control aspects of the XML serialization, to specify the grammar start symbol, or to produce output formats other than XML. (See <a href="#func-invisible-xml">fn:invisible-xml</a>.)</p></li><li><p><b>Default: </b>The version given in the prolog of the library module; or <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> if this is absent. (See <a href="#func-load-xquery-module">fn:load-xquery-module</a>.)</p></li><li><p>A sequence of URIs (in the form of <code>xs:string</code> values) which may be used or ignored in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way.... (See <a href="#func-load-xquery-module">fn:load-xquery-module</a>.)</p></li><li><p>Values for vendor-defined configuration options for the XQuery processor used to process the request. The key is the name of an option, expressed as a QName: the namespace URI of the QName <span class="verb">should</span> be a URI controlled by the vendor of the XQuery processor. The meaning of the associated value is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations <span class="verb">should</span> ignore options whose names are in an unrecognized namespace. The <a title="option parameter conventions" class="termref" href="#option-parameter-conventions">option parameter conventions</a> do not apply to this contained map.... (See <a href="#func-load-xquery-module">fn:load-xquery-module</a>.)</p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether constructs in the library module are evaluated in the same <a title="execution scope" class="termref" href="#execution-scope">execution scope</a> as the calling module. (See <a href="#func-load-xquery-module">fn:load-xquery-module</a>.)</p></li><li><p>The library module that is loaded may import schema declarations using an <code>import schema</code> declaration. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether schema components in the in-scope schema definitions of the calling module are automatically added to the in-scope schema definitions of the dynamically loaded module. The in-scope schema definitions of the calling and called modules must be consistent, according to the rules defined in <a href="https://www.w3.org/TR/xquery-31/#id-consistency-constraints"> 2.2.5 Consistency Constraints </a><sup><small>XQ31</small></sup>. (See <a href="#func-load-xquery-module">fn:load-xquery-module</a>.)</p></li><li><p>The serialized result is written to persistent storage. This means that the <code>fn:transform</code> function has side-effects and becomes nondeterministic, so the option should be used with care, and the precise behavior may be <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. When this option is used, the URIs used for the <code>base-output-uri</code> and the URIs of any secondary result documents must be writable locations. (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p>Indicates whether any <code>xsl:message</code> instructions in the stylesheet are to be evaluated. The destination and formatting of any such messages is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p><b>Default: </b><a title="implementation-defined" class="termref" href="#implementation-defined">Implementation-defined</a>. (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p><b>Default: </b><a title="implementation-defined" class="termref" href="#implementation-defined">Implementation-defined</a>. (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p>If the implementation provides a way of writing or invoking functions with side-effects, this post-processing function might be used to save a copy of the result document to persistent storage. For example, if the implementation provides access to the EXPath File library <a href="#expath">[EXPath]</a>, then a serialized document might be written to filestore by calling the <code>file:write</code> function. Similar mechanisms might be used to issue an HTTP POST request that posts the result to an HTTP server, or to send the document to an email recipient. The semantics of calling functions with side-effects are entirely <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p>Calls to <a href="#func-transform"><code>fn:transform</code></a> can potentially have side-effects even in the absence of the post-processing option, because the XSLT specification allows a stylesheet to invoke extension functions that have side-effects. The semantics in this case are <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p>A string intended to be used as the static base URI of the principal stylesheet module. This value <span class="verb">must</span> be used if no other static base URI is available. If the supplied stylesheet already has a base URI (which will generally be the case if the stylesheet is supplied using <code>stylesheet-node</code> or <code>stylesheet-location</code>) then it is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether this parameter has any effect. If the value is a relative reference, it is resolved against the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-executable-base-uri">executable base URI</a><sup><small>XP</small></sup> of the <code>fn:transform</code> function call.... (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p>Values for vendor-defined configuration options for the XSLT processor used to process the request. The key is the name of an option, expressed as a QName: the namespace URI of the QName <span class="verb">should</span> be a URI controlled by the vendor of the XSLT processor. The meaning of the associated value is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Implementations <span class="verb">should</span> ignore options whose names are in an unrecognized namespace. Default is the empty map.... (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p>It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> whether the XSLT transformation is executed within the same <a title="execution scope" class="termref" href="#execution-scope">execution scope</a> as the calling code. (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p>XSLT 1.0 does not define any error codes, so this is the likely outcome with an XSLT 1.0 processor. XSLT 2.0 and 3.0 do define error codes, but some APIs do not expose them. If multiple errors are signaled by the transformation (which is most likely to happen with static errors) then the error code should where possible be that of one of these errors, chosen arbitrarily; the processor may make details of additional errors available to the application in an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> way. (See <a href="#func-transform">fn:transform</a>.)</p></li><li><p>In addition, the values of <code>$input</code>, typically serialized and converted to an <code>xs:string</code>, and <code>$label</code> (if supplied <span>and non-empty</span>) <span class="verb">may</span> be output to an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> destination. (See <a href="#func-trace">fn:trace</a>.)</p></li><li><p>Consider a situation in which a user wants to investigate the actual value passed to a function. Assume that in a particular execution, <code>$v</code> is an <code>xs:decimal</code> with value <code>124.84</code>. Writing <code>fn:trace($v, 'the value of $v is:')</code> will return <code>$v</code>. The processor <span class="verb">may</span> output <code>"124.84"</code> and <code>"the value of $v is:"</code> to an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> destination. (See <a href="#func-trace">fn:trace</a>.)</p></li><li><p>Similar to <a href="#func-trace"><code>fn:trace</code></a>, the values of <code>$input</code>, typically serialized and converted to an <code>xs:string</code>, and <code>$label</code> (if supplied and non-empty) <span class="verb">may</span> be output to an <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> destination. (See <a href="#func-message">fn:message</a>.)</p></li><li><p>If <var>ST</var> is <code>xs:float</code> or <code>xs:double</code>, then <var>TV</var> is the <code>xs:decimal</code> value, within the set of <code>xs:decimal</code> values that the implementation is capable of representing, that is numerically closest to <var>SV</var>. If two values are equally close, then the one that is closest to zero is chosen. If <var>SV</var> is too large to be accommodated as an <code>xs:decimal</code>, (see <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> for <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on numeric values) a dynamic error is raised [<a href="#ERRFOCA0001" title="err:FOCA0001">err:FOCA0001</a>]. If <var>SV</var> is one of the special <code>xs:float</code> or <code>xs:double</code> values <code>NaN</code>, <code>INF</code>, or <code>-INF</code>, a dynamic error is raised [<a href="#ERRFOCA0002" title="err:FOCA0002">err:FOCA0002</a>]. (See <a href="#casting-to-decimal">Casting to xs:decimal</a>.)</p></li><li><p> In casting to <code>xs:decimal</code> or to a type derived from <code>xs:decimal</code>, if the value is not too large or too small but nevertheless cannot be represented accurately with the number of decimal digits available to the implementation, the implementation may round to the nearest representable value or may raise a dynamic error [<a href="#ERRFOCA0006" title="err:FOCA0006">err:FOCA0006</a>]. The choice of rounding algorithm and the choice between rounding and error behavior is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. (See <a href="#casting-from-strings">Casting from xs:string and xs:untypedAtomic</a>.)</p></li><li><p>If <var>ST</var> is <code>xs:decimal</code>, <code>xs:float</code> or <code>xs:double</code>, then <var>TV</var> is <var>SV</var> with the fractional part discarded and the value converted to <code>xs:integer</code>. Thus, casting <code>3.1456</code> returns <code>3</code> while <code>-17.89</code> returns <code>-17</code>. Casting <code>3.124E1</code> returns <code>31</code>. If <var>SV</var> is too large to be accommodated as an integer, (see <a href="#xmlschema-2">[XML Schema Part 2: Datatypes Second Edition]</a> for <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> limits on numeric values) a dynamic error is raised [<a href="#ERRFOCA0003" title="err:FOCA0003">err:FOCA0003</a>]. If <var>SV</var> is one of the special <code>xs:float</code> or <code>xs:double</code> values <code>NaN</code>, <code>INF</code>, or <code>-INF</code>, a dynamic error is raised [<a href="#ERRFOCA0002" title="err:FOCA0002">err:FOCA0002</a>]. (See <a href="#casting-to-integer">Casting to xs:integer</a>.)</p></li><li><p> The <em>tz</em> timezone database, available at <a href="http://www.iana.org/time-zones">http://www.iana.org/time-zones</a>. It is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a> which version of the database is used. (See <a href="#olson">IANA Timezone Database</a>.)</p></li><li><p><em>Unicode Standard Annex #15: Unicode Normalization Forms</em>. Ed. Mark Davis and Ken Whistler, Unicode Consortium. The current version is 16.0.0, dated 2024-08-14. As with <a href="#Unicode">[The Unicode Standard]</a>, the version to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Available at: <a href="http://www.unicode.org/reports/tr15/">http://www.unicode.org/reports/tr15/</a>. (See <a href="#UNICODE-TR15">UAX #15</a>.)</p></li><li><p><em>Unicode Standard Annex #29: Unicode Text Segmentation</em>. Ed. Josh Hadley, Unicode Consortium. The current version is 16.0.0, dated 2024-08-28. As with <a href="#Unicode">[The Unicode Standard]</a>, the version to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Available at: <a href="http://www.unicode.org/reports/tr29/">http://www.unicode.org/reports/tr29/</a>. (See <a href="#UNICODE-TR29">UAX #29</a>.)</p></li><li><p> The Unicode Consortium, Reading, MA, Addison-Wesley, 2016. <em>The Unicode Standard</em> as updated from time to time by the publication of new versions. See <a href="http://www.unicode.org/standard/versions/">http://www.unicode.org/standard/versions/</a> for the latest version and additional information on versions of the standard and of the Unicode Character Database. The version of Unicode to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but implementations are recommended to use the latest Unicode version; currently, Version 9.0.0. (See <a href="#Unicode">The Unicode Standard</a>.)</p></li><li><p><em>Unicode Technical Standard #10: Unicode Collation Algorithm</em>. Ed. Mark Davis and Ken Whistler, Unicode Consortium. The current version is 16.0.0, dated 2024-08-22. As with <a href="#Unicode">[The Unicode Standard]</a>, the version to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Available at: <a href="http://www.unicode.org/reports/tr10/">http://www.unicode.org/reports/tr10/</a>. (See <a href="#UNICODE-TR10">UTS #10</a>.)</p></li><li><p><em>Unicode Technical Standard #35: Unicode Locale Data Markup Language</em>. Ed Mark Davis <em>et al</em>, Unicode Consortium. The current version is 47, dated 2025-03-11. As with <a href="#Unicode">[The Unicode Standard]</a>, the version to be used is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>. Available at: <a href="http://www.unicode.org/reports/tr35/">http://www.unicode.org/reports/tr35/</a>. (See <a href="#UNICODE-TR35">UTS #35</a>.)</p></li></ol></div><div class="div1"><h2><a id="changelog"></a>H <a href="#changelog" style="text-decoration: none">Changes since 3.1</a> (Non-Normative)</h2><div class="div2"><h3><a id="changes-summary"></a>H.1 <a href="#changes-summary" style="text-decoration: none">Summary of Changes</a></h3><ol><li><p>If a section of this specification has been updated since version 3.1, an overview of the changes is provided, along with links to navigate to the next or previous change.</p><p>See <a href="#intro"><b>1 Introduction</b></a></p></li><li><p>Sections with significant changes are marked with a ✭ symbol in the table of contents. New functions are indicated by ✚.</p><p>See <a href="#intro"><b>1 Introduction</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1504 2329">1504 2329&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-insert-separator"><b>2.1.7 fn:insert-separator</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-replicate"><b>2.1.10 fn:replicate</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-slice"><b>2.1.12 fn:slice</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1120 1150">1120 1150&nbsp;</a></p><p>A callback function can be supplied for comparing individual items.</p><p>See <a href="#func-deep-equal"><b>2.2.4 fn:deep-equal</b></a></p></li><li><p>Changed in 4.0 to use transitive equality comparisons for numeric values.</p><p>See <a href="#func-distinct-values"><b>2.2.5 fn:distinct-values</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/614 987">614 987&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-duplicate-values"><b>2.2.6 fn:duplicate-values</b></a></p></li><li><p>New in 4.0. Originally proposed under the name <code>fn:uniform</code></p><p>See <a href="#func-all-equal"><b>2.4.2 fn:all-equal</b></a></p></li><li><p>New in 4.0. Originally proposed under the name <code>fn:unique</code></p><p>See <a href="#func-all-different"><b>2.4.3 fn:all-different</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-every"><b>2.5.3 fn:every</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-highest"><b>2.5.9 fn:highest</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-index-where"><b>2.5.10 fn:index-where</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-lowest"><b>2.5.11 fn:lowest</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-scan-right"><b>2.5.15 fn:scan-right</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-some"><b>2.5.16 fn:some</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/795 2228">795 2228&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-sort-with"><b>2.5.19 fn:sort-with</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/521 761">521 761&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-transitive-closure"><b>2.5.22 fn:transitive-closure</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-is-NaN"><b>4.4.5 fn:is-NaN</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1260 1275">1260 1275&nbsp;</a></p><p>A third argument has been added, providing control over the rounding mode.</p><p>See <a href="#func-round"><b>4.4.6 fn:round</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1049 1151">1049 1151&nbsp;</a></p><p>Decimal format parameters can now be supplied directly as a map in the third argument, rather than referencing a format defined in the static context.</p><p>See <a href="#func-format-number"><b>4.7.2 fn:format-number</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1205 1230">1205 1230&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-math-e"><b>4.8.2 math:e</b></a></p><p>See <a href="#func-math-cosh"><b>4.8.8 math:cosh</b></a></p><p>See <a href="#func-math-sinh"><b>4.8.15 math:sinh</b></a></p><p>See <a href="#func-math-tanh"><b>4.8.18 math:tanh</b></a></p></li><li><p>The 3.1 specification suggested that every value in the result range should have the same chance of being chosen. This has been corrected to say that the distribution should be arithmetically uniform (because there are as many <code>xs:double</code> values between 0.01 and 0.1 as there are between 0.1 and 1.0).</p><p>See <a href="#func-random-number-generator"><b>4.9.2 fn:random-number-generator</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/261 306 993">261 306 993&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-char"><b>5.4.1 fn:char</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-characters"><b>5.4.2 fn:characters</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/937 995 1190">937 995 1190&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-hash"><b>5.4.13 fn:hash</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/215 415 ">215 415 &nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-parse-uri"><b>7.6.2 fn:parse-uri</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1423 1413">1423 1413&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-build-uri"><b>7.6.3 fn:build-uri</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-build-dateTime"><b>9.4.2 fn:build-dateTime</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-parts-of-dateTime"><b>9.6.16 fn:parts-of-dateTime</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-in-scope-namespaces"><b>12.2.2 fn:in-scope-namespaces</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1620 1886">1620 1886&nbsp;</a></p><p>Options are added to customize the form of the output.</p><p>See <a href="#func-path"><b>12.2.9 fn:path</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1547 1551">1547 1551&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-siblings"><b>12.2.11 fn:siblings</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/969 1134">969 1134&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-map-filter"><b>14.4.6 map:filter</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/478 515">478 515&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-map-keys-where"><b>14.4.12 map:keys-where</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1575 1906">1575 1906&nbsp;</a></p><p> A new function <a href="#func-element-to-map"><code>fn:element-to-map</code></a> is provided for converting XDM trees to maps suitable for serialization as JSON. Unlike the <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> function retained from 3.1, this can handle arbitrary XML as input. </p><p>See <a href="#xml-to-json-mappings"><b>14.5 Converting elements to maps</b></a></p></li><li><p>New in 4.0</p><p>See <a href="#func-array-empty"><b>15.2.3 array:empty</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/968 1295">968 1295&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-array-index-of"><b>15.2.13 array:index-of</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/476 1087">476 1087&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-array-items"><b>15.2.16 array:items</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/360 476">360 476&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-array-members"><b>15.2.18 array:members</b></a></p><p>See <a href="#func-array-of-members"><b>15.2.19 array:of-members</b></a></p></li><li><p>Supplying the empty sequence as the value of an optional argument is equivalent to omitting the argument.</p><p>See <a href="#func-array-subarray"><b>15.2.29 array:subarray</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1117 1279">1117 1279&nbsp;</a></p><p>The <code>$options</code> parameter has been added.</p><p>See <a href="#func-unparsed-text-lines"><b>17.1.6 fn:unparsed-text-lines</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/259 956">259 956&nbsp;</a></p><p> A new function is available for processing input data in HTML format. </p><p>See <a href="#html-functions"><b>17.3 Functions on HTML Data</b></a></p><p>New in 4.0</p><p>See <a href="#func-parse-html"><b>17.3.2 fn:parse-html</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/975 1058 1246">975 1058 1246&nbsp;</a></p><p>An option is provided to control how JSON numbers should be formatted.</p><p>See <a href="#func-parse-json"><b>17.4.4 fn:parse-json</b></a></p></li><li><p>Additional options are available, as defined by <a href="#func-parse-json"><code>fn:parse-json</code></a>.</p><p>See <a href="#func-json-doc"><b>17.4.5 fn:json-doc</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/533 719 834 1066">533 719 834 1066&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-csv-to-arrays"><b>17.5.4 fn:csv-to-arrays</b></a></p><p>See <a href="#func-parse-csv"><b>17.5.7 fn:parse-csv</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/533 719 834 1066 1605">533 719 834 1066 1605&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-csv-to-xml"><b>17.5.10 fn:csv-to-xml</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/791 1256 1282 1405">791 1256 1282 1405&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-invisible-xml"><b>17.6.1 fn:invisible-xml</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/629 803">629 803&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-message"><span style="display: none;" class="delete_version"><b>21.2.2 fn:message</b></span><span style="display: none;" class="add_version"><b>22.2.2 fn:message</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">21.2.2</span><span class="deltaxml-new" style="background:#90EE90">22.2.2</span> fn:message</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/533 719 834">533 719 834&nbsp;</a></p><p> New functions are available for processing input data in CSV (comma separated values) format. </p><p>See <a href="#csv-functions"><b>17.5 Functions on CSV Data</b></a></p></li><li><p>Comparison of mixed numeric types (for example <code>xs:double</code> and <code>xs:decimal</code>) now generally converts both values to <code>xs:decimal</code>.</p><p>See <a href="#comp.numeric"><b>4.3 Comparing numeric values</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/289 1901">289 1901&nbsp;</a></p><p>A third argument is added, allowing user control of how absent keys should be handled.</p><p>See <a href="#func-map-get"><b>14.4.9 map:get</b></a></p><p>A third argument is added, allowing user control of how index-out-of-bounds conditions should be handled.</p><p>See <a href="#func-array-get"><b>15.2.11 array:get</b></a></p></li><li><p> A new collation URI is defined for Unicode case-insensitive comparison and ordering. </p><p>See <a href="#unicode-case-insensitive-collation"><b>5.3.5 The Unicode case-insensitive collation</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1727 1740">1727 1740&nbsp;</a></p><p>It is no longer guaranteed that the new key replaces the existing key.</p><p>See <a href="#func-map-put"><b>14.4.14 map:put</b></a></p></li><li><p>The group may remove this function, it is considered <a href="#at-risk">at risk</a>. </p><p>See <a href="#func-array-members"><b>15.2.18 array:members</b></a></p><p>See <a href="#func-array-of-members"><b>15.2.19 array:of-members</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/173">173&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-op"><span style="display: none;" class="delete_version"><b>18.4 fn:op</b></span><span style="display: none;" class="add_version"><b>19.4 fn:op</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">18.4</span><span class="deltaxml-new" style="background:#90EE90">19.4</span> fn:op</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/203">203&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-map-build"><b>14.4.1 map:build</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/207">207&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-parse-QName"><b>10.1.2 fn:parse-QName</b></a></p><p>See <a href="#func-expanded-QName"><b>10.2.4 fn:expanded-QName</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/222">222&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-contains-subsequence"><b>2.2.3 fn:contains-subsequence</b></a></p><p>See <a href="#func-ends-with-subsequence"><b>2.2.7 fn:ends-with-subsequence</b></a></p><p>See <a href="#func-starts-with-subsequence"><b>2.2.9 fn:starts-with-subsequence</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/250">250&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-foot"><b>2.1.3 fn:foot</b></a></p><p>See <a href="#func-trunk"><b>2.1.15 fn:trunk</b></a></p><p>See <a href="#func-array-build"><b>15.2.2 array:build</b></a></p><p>See <a href="#func-array-foot"><b>15.2.8 array:foot</b></a></p><p>See <a href="#func-array-trunk"><b>15.2.31 array:trunk</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/258">258&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-array-index-where"><b>15.2.14 array:index-where</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/313">313&nbsp;</a></p><p>The second argument can now be a sequence of integers.</p><p>See <a href="#func-remove"><b>2.1.9 fn:remove</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/319">319&nbsp;</a></p><p>New in 4.0. The function replaces the internal <a href="#dt-same-key"><code>op:same-key</code></a> function in 3.1</p><p>See <a href="#func-atomic-equal"><b>2.2.1 fn:atomic-equal</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/326">326&nbsp;</a></p><p>Higher-order functions are no longer an optional feature.</p><p>See <a href="#conformance"><b>1.2 Conformance</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/360">360&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-map-entries"><b>14.4.4 map:entries</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/419">419&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-items-at"><b>2.1.8 fn:items-at</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/434">434&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-parse-integer"><b>4.5.2 fn:parse-integer</b></a></p><p>The function has been extended to allow output in a radix other than 10, for example in hexadecimal.</p><p>See <a href="#func-format-integer"><b>4.6.1 fn:format-integer</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/477">477&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-array-slice"><b>15.2.24 array:slice</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/482">482&nbsp;</a></p><p>Deleted an inaccurate statement concerning the behavior of NaN.</p><p>See <a href="#comp.numeric"><b>4.3 Comparing numeric values</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/507">507&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-partition"><b>2.5.13 fn:partition</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/546">546&nbsp;</a></p><p>It is no longer automatically an error if the input contains a codepoint that is not valid in XML. Instead, the codepoint must be a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. The set of permitted characters is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but it is <span class="verb">recommended</span> that all Unicode characters should be accepted.</p><p>See <a href="#func-codepoints-to-string"><b>5.2.1 fn:codepoints-to-string</b></a></p><p>It is no longer automatically an error if the resource (after decoding) contains a codepoint that is not valid in XML. Instead, the codepoint must be a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. The set of permitted characters is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but it is <span class="verb">recommended</span> that all Unicode characters should be accepted.</p><p>See <a href="#func-unparsed-text"><b>17.1.5 fn:unparsed-text</b></a></p><p> The rules regarding use of non-XML characters in JSON texts have been relaxed. </p><p>See <a href="#json-character-repertoire"><b>17.4.3 JSON character repertoire</b></a></p><p>See <a href="#func-parse-json"><b>17.4.4 fn:parse-json</b></a></p><p>It is no longer automatically an error if the input contains a codepoint that is not valid in XML. Instead, the codepoint must be a <a title="permitted character" class="termref" href="#dt-permitted-character">permitted character</a>. The set of permitted characters is <a title="implementation-defined" class="termref" href="#implementation-defined">implementation-defined</a>, but it is <span class="verb">recommended</span> that all Unicode characters should be accepted.</p><p>See <a href="#func-json-doc"><b>17.4.5 fn:json-doc</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/609">609&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-array-split"><b>15.2.28 array:split</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/631">631&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-decode-from-uri"><b>7.1 fn:decode-from-uri</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/662">662&nbsp;</a></p><p> Constructor functions now have a zero-arity form; the first argument defaults to the context item. </p><p>See <a href="#constructor-functions"><span style="display: none;" class="delete_version"><b>22 Constructor functions</b></span><span style="display: none;" class="add_version"><b>23 Constructor functions</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22</span><span class="deltaxml-new" style="background:#90EE90">23</span> Constructor functions</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/680">680&nbsp;</a></p><p> The case-insensitive collation is now defined normatively within this specification, rather than by reference to the HTML "living specification", which is subject to change. The collation can now be used for ordering comparisons as well as equality comparisons. </p><p>See <a href="#html-ascii-case-insensitive-collation"><b>5.3.6 The HTML ASCII Case-Insensitive Collation</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/702">702&nbsp;</a></p><p>The function can now take any number of arguments (previously it had to be two or more), and the arguments can be sequences of strings rather than single strings.</p><p>See <a href="#func-concat"><b>5.4.4 fn:concat</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/710">710&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-function-annotations"><b>13.5 fn:function-annotations</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/727">727&nbsp;</a></p><p>It has been clarified that loading a module has no effect on the static or dynamic context of the caller.</p><p>See <a href="#func-load-xquery-module"><span style="display: none;" class="delete_version"><b>18.2 fn:load-xquery-module</b></span><span style="display: none;" class="add_version"><b>19.2 fn:load-xquery-module</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">18.2</span><span class="deltaxml-new" style="background:#90EE90">19.2</span> fn:load-xquery-module</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/828">828&nbsp;</a></p><p>The <code>$predicate</code> callback function accepts an optional position argument.</p><p>See <a href="#func-filter"><b>2.5.4 fn:filter</b></a></p><p>The <code>$action</code> callback function accepts an optional position argument.</p><p>See <a href="#func-for-each"><b>2.5.7 fn:for-each</b></a></p><p>See <a href="#func-for-each-pair"><b>2.5.8 fn:for-each-pair</b></a></p><p>The <code>$predicate</code> callback function now accepts an optional position argument.</p><p>See <a href="#func-array-filter"><b>15.2.4 array:filter</b></a></p><p>The <code>$action</code> callback function now accepts an optional position argument.</p><p>See <a href="#func-array-for-each"><b>15.2.9 array:for-each</b></a></p><p>See <a href="#func-array-for-each-pair"><b>15.2.10 array:for-each-pair</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/881">881&nbsp;</a></p><p>The way that <a href="#func-min"><code>fn:min</code></a> and <a href="#func-max"><code>fn:max</code></a> compare numeric values of different types has changed. The most noticeable effect is that when these functions are applied to a sequence of <code>xs:integer</code> or <code>xs:decimal</code> values, the result is an <code>xs:integer</code> or <code>xs:decimal</code>, rather than the result of converting this to an <code>xs:float</code> or <code>xs:double</code>.</p><p>See <a href="#func-max"><b>2.4.5 fn:max</b></a></p><p>See <a href="#func-min"><b>2.4.6 fn:min</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/901">901&nbsp;</a></p><p>The optional third argument can now be supplied as the empty sequence.</p><p>See <a href="#func-subsequence"><b>2.1.13 fn:subsequence</b></a></p><p>The third argument can now be supplied as the empty sequence.</p><p>See <a href="#func-substring"><b>5.4.6 fn:substring</b></a></p><p>The second argument can now be the empty sequence.</p><p>See <a href="#func-tokenize"><b>6.3.3 fn:tokenize</b></a></p><p>The optional second argument can now be supplied as the empty sequence.</p><p>See <a href="#func-resolve-uri"><b>7.5 fn:resolve-uri</b></a></p><p>The 3rd, 4th, and 5th arguments are now optional; previously the function required either 2 or 5 arguments.</p><p>See <a href="#func-format-dateTime"><b>9.9.1 fn:format-dateTime</b></a></p><p>See <a href="#func-format-date"><b>9.9.2 fn:format-date</b></a></p><p>See <a href="#func-format-time"><b>9.9.3 fn:format-time</b></a></p><p>All three arguments are now optional, and each argument can be set to the empty sequence. Previously if <code>$description</code> was supplied, it could not be empty.</p><p>See <a href="#func-error"><span style="display: none;" class="delete_version"><b>21.1.1 fn:error</b></span><span style="display: none;" class="add_version"><b>22.1.1 fn:error</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">21.1.1</span><span class="deltaxml-new" style="background:#90EE90">22.1.1</span> fn:error</b></span></a></p><p>The <code>$label</code> argument can now be set to the empty sequence. Previously if <code>$label</code> was supplied, it could not be empty.</p><p>See <a href="#func-trace"><span style="display: none;" class="delete_version"><b>21.2.1 fn:trace</b></span><span style="display: none;" class="add_version"><b>22.2.1 fn:trace</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">21.2.1</span><span class="deltaxml-new" style="background:#90EE90">22.2.1</span> fn:trace</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/905">905&nbsp;</a></p><p>The rule that multiple calls on <a href="#func-doc"><code>fn:doc</code></a> supplying the same absolute URI must return the same document node has been clarified; in particular the rule does not apply if the dynamic context for the two calls requires different processing of the documents (such as schema validation or whitespace stripping).</p><p>See <a href="#func-doc"><b>17.1.1 fn:doc</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/909">909&nbsp;</a></p><p>The function has been expanded in scope to handle comparison of values other than strings.</p><p>See <a href="#func-compare"><b>2.2.2 fn:compare</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/924">924&nbsp;</a></p><p> Rules have been added clarifying that users should not be allowed to change the schema for the <code>fn</code> namespace. </p><p>See <a href="#schemata"><b>D Schemas</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/925">925&nbsp;</a></p><p>The decimal format name can now be supplied as a value of type <code>xs:QName</code>, as an alternative to supplying a lexical QName as an instance of <code>xs:string</code>.</p><p>See <a href="#func-format-number"><b>4.7.2 fn:format-number</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/932">932&nbsp;</a></p><p> The specification now prescribes a minimum precision and range for durations. </p><p>See <a href="#duration-conformance"><b>8.1.2 Limits and precision</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/933">933&nbsp;</a></p><p>When comments and processing instructions are ignored, any text nodes either side of the comment or processing instruction are now merged prior to comparison.</p><p>See <a href="#func-deep-equal"><b>2.2.4 fn:deep-equal</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/940">940&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-subsequence-where"><b>2.5.20 fn:subsequence-where</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/953">953&nbsp;</a></p><p> Constructor functions for named record types have been introduced. </p><p>See <a href="#id-constructors-for-record-tests"><span style="display: none;" class="delete_version"><b>22.6 Constructor functions for named record types</b></span><span style="display: none;" class="add_version"><b>23.6 Constructor functions for named record types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">22.6</span><span class="deltaxml-new" style="background:#90EE90">23.6</span> Constructor functions for named record types</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/962">962&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-do-until"><b>2.5.2 fn:do-until</b></a></p><p>See <a href="#func-while-do"><b>2.5.23 fn:while-do</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/969">969&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-map-empty"><b>14.4.3 map:empty</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/984">984&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-seconds"><b>8.4.1 fn:seconds</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/987">987&nbsp;</a></p><p>The order of results is now prescribed; it was previously implementation-dependent.</p><p>See <a href="#func-distinct-values"><b>2.2.5 fn:distinct-values</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1022">1022&nbsp;</a></p><p> Regular expressions can include comments (starting and ending with <code>#</code>) if the <code>c</code> flag is set. </p><p>See <a href="#regex-syntax"><b>6.1 Regular expression syntax</b></a></p><p>See <a href="#flags"><b>6.2 Flags</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1028">1028&nbsp;</a></p><p>An option is provided to control how the JSON <code>null</code> value should be handled.</p><p>See <a href="#func-parse-json"><b>17.4.4 fn:parse-json</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1032">1032&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-void"><b>2.1.17 fn:void</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1046">1046&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-take-while"><b>2.5.21 fn:take-while</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1059">1059&nbsp;</a></p><p> Use of an option keyword that is not defined in the specification and is not known to the implementation now results in a dynamic error; previously it was ignored. </p><p>See <a href="#options"><b>1.7 Options</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1068">1068&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-graphemes"><b>5.4.3 fn:graphemes</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1072">1072&nbsp;</a></p><p>The return type is now specified more precisely.</p><p>See <a href="#func-load-xquery-module"><span style="display: none;" class="delete_version"><b>18.2 fn:load-xquery-module</b></span><span style="display: none;" class="add_version"><b>19.2 fn:load-xquery-module</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">18.2</span><span class="deltaxml-new" style="background:#90EE90">19.2</span> fn:load-xquery-module</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1090">1090&nbsp;</a></p><p> When casting from a string to a duration or time or dateTime, it is now specified that when there are more digits in the fractional seconds than the implementation is able to retain, excess digits are truncated. Rounding upwards (which could affect the number of minutes or hours in the value) is not permitted. </p><p>See <a href="#casting-from-strings"><span style="display: none;" class="delete_version"><b>23.2 Casting from xs:string and xs:untypedAtomic</b></span><span style="display: none;" class="add_version"><b>24.2 Casting from xs:string and xs:untypedAtomic</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.2</span><span class="deltaxml-new" style="background:#90EE90">24.2</span> Casting from xs:string and xs:untypedAtomic</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1093">1093&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-collation"><b>5.3.9 fn:collation</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1117">1117&nbsp;</a></p><p>The <code>$options</code> parameter has been added.</p><p>See <a href="#func-unparsed-text"><b>17.1.5 fn:unparsed-text</b></a></p><p>See <a href="#func-unparsed-text-available"><b>17.1.7 fn:unparsed-text-available</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1182">1182&nbsp;</a></p><p>The <code>$predicate</code> callback function may return the empty sequence (meaning <code>false</code>).</p><p>See <a href="#func-do-until"><b>2.5.2 fn:do-until</b></a></p><p>See <a href="#func-every"><b>2.5.3 fn:every</b></a></p><p>See <a href="#func-filter"><b>2.5.4 fn:filter</b></a></p><p>See <a href="#func-index-where"><b>2.5.10 fn:index-where</b></a></p><p>See <a href="#func-some"><b>2.5.16 fn:some</b></a></p><p>See <a href="#func-take-while"><b>2.5.21 fn:take-while</b></a></p><p>See <a href="#func-while-do"><b>2.5.23 fn:while-do</b></a></p><p>See <a href="#func-map-filter"><b>14.4.6 map:filter</b></a></p><p>See <a href="#func-map-keys-where"><b>14.4.12 map:keys-where</b></a></p><p>See <a href="#func-array-filter"><b>15.2.4 array:filter</b></a></p><p>See <a href="#func-array-index-where"><b>15.2.14 array:index-where</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1191">1191&nbsp;</a></p><p>The <code>$options</code> parameter has been added, absorbing the <code>$collation</code> parameter.</p><p>See <a href="#func-deep-equal"><b>2.2.4 fn:deep-equal</b></a></p><p>New in 4.0</p><p>See <a href="#func-distinct-ordered-nodes"><b>12.3.1 fn:distinct-ordered-nodes</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1250">1250&nbsp;</a></p><p>For selected properties including <code>percent</code> and <code>exponent-separator</code>, it is now possible to specify a single-character marker to be used in the picture string, together with a multi-character rendition to be used in the formatted output.</p><p>See <a href="#func-format-number"><b>4.7.2 fn:format-number</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1257">1257&nbsp;</a></p><p>The <code>$options</code> parameter has been added.</p><p>See <a href="#func-parse-xml"><b>17.2.1 fn:parse-xml</b></a></p><p>See <a href="#func-parse-xml-fragment"><b>17.2.2 fn:parse-xml-fragment</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1262">1262&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-collation-available"><b>5.3.10 fn:collation-available</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1265">1265&nbsp;</a></p><p>The constraints on the result of the function have been relaxed.</p><p>See <a href="#func-document-uri"><b>12.1.2 fn:document-uri</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1280">1280&nbsp;</a></p><p>As a result of changes to the coercion rules, the number of supplied arguments can be greater than the number required: extra arguments are ignored.</p><p>See <a href="#func-apply"><b>2.5.1 fn:apply</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1288">1288&nbsp;</a></p><p>Additional error conditions have been defined.</p><p>See <a href="#func-parse-xml"><b>17.2.1 fn:parse-xml</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1296">1296&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-scan-left"><b>2.5.14 fn:scan-left</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1333">1333&nbsp;</a></p><p>A new option is provided to allow the content of the loaded module to be supplied as a string.</p><p>See <a href="#func-load-xquery-module"><span style="display: none;" class="delete_version"><b>18.2 fn:load-xquery-module</b></span><span style="display: none;" class="add_version"><b>19.2 fn:load-xquery-module</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">18.2</span><span class="deltaxml-new" style="background:#90EE90">19.2</span> fn:load-xquery-module</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1353">1353&nbsp;</a></p><p>An option has been added to suppress the escaping of the solidus (forwards slash) character.</p><p>See <a href="#func-xml-to-json"><b>17.4.7 fn:xml-to-json</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1358">1358&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-unix-dateTime"><b>9.4.3 fn:unix-dateTime</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1361">1361&nbsp;</a></p><p> The term <b>atomic value</b> has been replaced by <b>atomic item</b>. </p><p>See <a href="#terminology"><b>1.9 Terminology</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1393">1393&nbsp;</a></p><p>Changes the function to return a sequence of key-value pairs rather than a map.</p><p>See <a href="#func-function-annotations"><b>13.5 fn:function-annotations</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1409">1409&nbsp;</a></p><p> This section now uses the term <b>primitive type</b> strictly to refer to the 20 atomic types that are not derived by restriction from another atomic type: that is, the 19 primitive atomic types defined in XSD, plus <code>xs:untypedAtomic</code>. The three types <code>xs:integer</code>, <code>xs:dayTimeDuration</code>, and <code>xs:yearMonthDuration</code>, which have custom casting rules but are not strictly-speaking primitive, are now handled in other subsections. </p><p>See <a href="#casting-from-primitive-to-primitive"><span style="display: none;" class="delete_version"><b>23.1 Casting from primitive types to primitive types</b></span><span style="display: none;" class="add_version"><b>24.1 Casting from primitive types to primitive types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1</span><span class="deltaxml-new" style="background:#90EE90">24.1</span> Casting from primitive types to primitive types</b></span></a></p><p> The rules for conversion of dates and times to strings are now defined entirely in terms of XSD 1.1 canonical mappings, since these deliver exactly the same result as the XPath 3.1 rules. </p><p>See <a href="#casting-date-time-to-string"><span style="display: none;" class="delete_version"><b>23.1.2.2 Casting date/time values to xs:string</b></span><span style="display: none;" class="add_version"><b>24.1.2.2 Casting date/time values to xs:string</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.2.2</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.2</span> Casting date/time values to xs:string</b></span></a></p><p> The rules for conversion of durations to strings are now defined entirely in terms of XSD 1.1 canonical mappings, since the XSD 1.1 rules deliver exactly the same result as the XPath 3.1 rules. </p><p>See <a href="#casting-duration-to-string"><span style="display: none;" class="delete_version"><b>23.1.2.3 Casting xs:duration values to xs:string</b></span><span style="display: none;" class="add_version"><b>24.1.2.3 Casting xs:duration values to xs:string</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">23.1.2.3</span><span class="deltaxml-new" style="background:#90EE90">24.1.2.3</span> Casting xs:duration values to xs:string</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1455">1455&nbsp;</a></p><p>Numbers now retain their original lexical form, except for any changes needed to satisfy JSON syntax rules (for example, stripping leading zero digits).</p><p>See <a href="#func-xml-to-json"><b>17.4.7 fn:xml-to-json</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1473">1473&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-identity"><b>2.1.5 fn:identity</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1481">1481&nbsp;</a></p><p>The function has been extended to handle other Gregorian types such as <code>xs:gYearMonth</code>.</p><p>See <a href="#func-year-from-dateTime"><b>9.6.1 fn:year-from-dateTime</b></a></p><p>See <a href="#func-month-from-dateTime"><b>9.6.2 fn:month-from-dateTime</b></a></p><p>The function has been extended to handle other Gregorian types such as <code>xs:gMonthDay</code>.</p><p>See <a href="#func-day-from-dateTime"><b>9.6.3 fn:day-from-dateTime</b></a></p><p>The function has been extended to handle other types including <code>xs:time</code>.</p><p>See <a href="#func-hours-from-dateTime"><b>9.6.4 fn:hours-from-dateTime</b></a></p><p>See <a href="#func-minutes-from-dateTime"><b>9.6.5 fn:minutes-from-dateTime</b></a></p><p>The function has been extended to handle other types such as <code>xs:gYearMonth</code>.</p><p>See <a href="#func-timezone-from-dateTime"><b>9.6.7 fn:timezone-from-dateTime</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1523">1523&nbsp;</a></p><p> New functions are provided to obtain information about built-in types and types defined in an imported schema. </p><p>See <a href="#functions-on-types"><span style="display: none;" class="delete_version"><b>19 Processing types</b></span><span style="display: none;" class="add_version"><b>20 Processing types</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">19</span><span class="deltaxml-new" style="background:#90EE90">20</span> Processing types</b></span></a></p><p>New in 4.0</p><p>See <a href="#func-schema-type"><span style="display: none;" class="delete_version"><b>19.1.2 fn:schema-type</b></span><span style="display: none;" class="add_version"><b>20.1.2 fn:schema-type</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">19.1.2</span><span class="deltaxml-new" style="background:#90EE90">20.1.2</span> fn:schema-type</b></span></a></p><p>See <a href="#func-atomic-type-annotation"><span style="display: none;" class="delete_version"><b>19.1.4 fn:atomic-type-annotation</b></span><span style="display: none;" class="add_version"><b>20.1.4 fn:atomic-type-annotation</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">19.1.4</span><span class="deltaxml-new" style="background:#90EE90">20.1.4</span> fn:atomic-type-annotation</b></span></a></p><p>See <a href="#func-node-type-annotation"><span style="display: none;" class="delete_version"><b>19.1.5 fn:node-type-annotation</b></span><span style="display: none;" class="add_version"><b>20.1.5 fn:node-type-annotation</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">19.1.5</span><span class="deltaxml-new" style="background:#90EE90">20.1.5</span> fn:node-type-annotation</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1545">1545&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-civil-timezone"><b>9.7.4 fn:civil-timezone</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1565">1565&nbsp;</a></p><p>The default for the <code>escape</code> option has been changed to <code>false</code>. The 3.1 specification gave the default value as <code>true</code>, but this appears to have been an error, since it was inconsistent with examples given in the specification and with tests in the test suite.</p><p>See <a href="#func-parse-json"><b>17.4.4 fn:parse-json</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1570">1570&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-type-of"><span style="display: none;" class="delete_version"><b>19.1.3 fn:type-of</b></span><span style="display: none;" class="add_version"><b>20.1.3 fn:type-of</b></span><span class="modify_version"><b><span class="deltaxml-old" style="background:#FF5555">19.1.3</span><span class="deltaxml-new" style="background:#90EE90">20.1.3</span> fn:type-of</b></span></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1587">1587&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-unparsed-binary"><b>17.1.8 fn:unparsed-binary</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1611">1611&nbsp;</a></p><p>The spec has been corrected to note that the function depends on the implicit timezone.</p><p>See <a href="#func-compare"><b>2.2.2 fn:compare</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1671">1671&nbsp;</a></p><p>New in 4.0.</p><p>See <a href="#func-divide-decimals"><b>4.4.3 fn:divide-decimals</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1687">1687&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-map-items"><b>14.4.10 map:items</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703&nbsp;</a></p><p>Ordered maps are introduced.</p><p>See <a href="#map-ordering"><b>14.1 Ordering of Maps</b></a></p><p>Enhanced to allow for ordered maps.</p><p>See <a href="#func-map-filter"><b>14.4.6 map:filter</b></a></p><p>See <a href="#func-map-find"><b>14.4.7 map:find</b></a></p><p>See <a href="#func-map-for-each"><b>14.4.8 map:for-each</b></a></p><p>See <a href="#func-map-put"><b>14.4.14 map:put</b></a></p><p>See <a href="#func-map-remove"><b>14.4.15 map:remove</b></a></p><p>The order of entries in maps is retained.</p><p>See <a href="#func-parse-json"><b>17.4.4 fn:parse-json</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1711">1711&nbsp;</a></p><p>It is explicitly stated that the limits for <code>$precision</code> are implementation-defined.</p><p>See <a href="#func-round"><b>4.4.6 fn:round</b></a></p><p>See <a href="#func-round-half-to-even"><b>4.4.7 fn:round-half-to-even</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1727">1727&nbsp;</a></p><p>For consistency with the new function <a href="#func-map-build"><code>map:build</code></a>, the handling of duplicates may now be controlled by supplying a user-defined callback function as an alternative to the fixed values for the earlier <code>duplicates</code> option.</p><p>See <a href="#func-map-merge"><b>14.4.13 map:merge</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1734">1734&nbsp;</a></p><p>In 3.1, given a mixed input sequence such as (1, 3, 4.2e0), the specification was unclear whether it was permitted to add the first two integer items using integer arithmetic, rather than converting all items to doubles before performing any arithmetic. The 4.0 specification is clear that this is permitted; but since the items can be reordered before being added, this is not required.</p><p>See <a href="#func-avg"><b>2.4.4 fn:avg</b></a></p><p>See <a href="#func-sum"><b>2.4.7 fn:sum</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1801">1801&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-function-identity"><b>13.4 fn:function-identity</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1825">1825&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-partial-apply"><b>2.5.12 fn:partial-apply</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1856">1856&nbsp;</a></p><p> Word boundaries can be matched. Lookahead and lookbehind assertions are supported. Assertions (including <code>^</code> and <code>$</code>) can no longer be followed by a quantifier. </p><p>See <a href="#regex-syntax"><b>6.1 Regular expression syntax</b></a></p><p>The output of the function is extended to allow the represention of captured groups found within lookahead assertions.</p><p>See <a href="#func-analyze-string"><b>6.3.4 fn:analyze-string</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1879">1879&nbsp;</a></p><p>Additional options to control DTD and XInclude processing have been added.</p><p>See <a href="#func-parse-xml"><b>17.2.1 fn:parse-xml</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1897">1897&nbsp;</a></p><p>The <code>$replacement</code> argument can now be a function that computes the replacement strings.</p><p>See <a href="#func-replace"><b>6.3.2 fn:replace</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1906">1906&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-element-to-map-plan"><b>14.5.11 fn:element-to-map-plan</b></a></p><p>New in 4.0.</p><p>See <a href="#func-element-to-map"><b>14.5.12 fn:element-to-map</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1910">1910&nbsp;</a></p><p>An <code>$options</code> parameter is added. Note that the rules for the <code>$options</code> parameter control aspects of processing that were implementation-defined in earlier versions of this specification. An implementation may provide configuration options designed to retain backwards-compatible behavior when no explicit options are supplied.</p><p>See <a href="#func-doc"><b>17.1.1 fn:doc</b></a></p><p>See <a href="#func-doc-available"><b>17.1.2 fn:doc-available</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1913">1913&nbsp;</a></p><p>It is now permitted for the regular expression to match a zero-length string.</p><p>See <a href="#func-replace"><b>6.3.2 fn:replace</b></a></p><p>See <a href="#func-tokenize"><b>6.3.3 fn:tokenize</b></a></p><p>See <a href="#func-analyze-string"><b>6.3.4 fn:analyze-string</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1933">1933&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-xsd-validator"><b>17.2.5 fn:xsd-validator</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1991">1991&nbsp;</a></p><p> Named record types used in the signatures of built-in functions are now available as standard in the static context. </p><p>See <a href="#id-built-in-named-record-types"><b>C Built-in named record types</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2001">2001&nbsp;</a></p><p>New in 4.0.</p><p>See <a href="#func-sort-by"><b>2.5.18 fn:sort-by</b></a></p><p>See <a href="#func-array-sort-by"><b>15.2.26 array:sort-by</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2013">2013&nbsp;</a></p><p>Support for binary input has been added.</p><p>See <a href="#func-parse-xml"><b>17.2.1 fn:parse-xml</b></a></p><p>See <a href="#func-parse-xml-fragment"><b>17.2.2 fn:parse-xml-fragment</b></a></p><p>New in 4.0</p><p>See <a href="#func-html-doc"><b>17.3.3 fn:html-doc</b></a></p><p>See <a href="#func-csv-doc"><b>17.5.8 fn:csv-doc</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2030">2030&nbsp;</a></p><p> This description of the XSD validation process was previously found (with some duplication) in the XQuery and XSLT specifications; those specifications now reference this description. As a side-effects, the descriptions of the process in XQuery and XSLT are better aligned. </p><p>See <a href="#xsd-validation"><b>17.2.4 XSD validation</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2031">2031&nbsp;</a></p><p> Introduced the concept of JNodes. </p><p>See <a href="#processing-jnodes"><b>16 Processing JNodes</b></a></p><p>New in 4.0</p><p>See <a href="#func-jtree"><b>16.1.1 fn:jtree</b></a></p><p>See <a href="#func-jnode-content"><b>16.1.2 fn:jnode-content</b></a></p><p>See <a href="#func-jnode-selector"><b>16.1.3 fn:jnode-selector</b></a></p><p>See <a href="#func-jnode-position"><b>16.1.4 fn:jnode-position</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2149">2149&nbsp;</a></p><p>Generalized to work with JNodes as well as XNodes.</p><p>See <a href="#func-has-children"><b>12.2.1 fn:has-children</b></a></p><p>The function is extended to handle JNodes.</p><p>See <a href="#func-path"><b>12.2.9 fn:path</b></a></p><p>Generalized to work with JNodes as well as XNodes.</p><p>See <a href="#func-innermost"><b>12.3.2 fn:innermost</b></a></p><p>See <a href="#func-outermost"><b>12.3.3 fn:outermost</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2168">2168&nbsp;</a></p><p>Atomic items of types <code>xs:hexBinary</code> and <code>xs:base64Binary</code> are now mutually comparable. In rare cases, where an application uses both types and assumes they are distinct, this can represent a backwards incompatibility.</p><p>See <a href="#func-atomic-equal"><b>2.2.1 fn:atomic-equal</b></a></p><p>See <a href="#func-deep-equal"><b>2.2.4 fn:deep-equal</b></a></p><p>See <a href="#func-distinct-values"><b>2.2.5 fn:distinct-values</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2223">2223&nbsp;</a></p><p>An error may now be raised if the base URI is not a valid LEIRI reference.</p><p>See <a href="#func-base-uri"><b>12.1.1 fn:base-uri</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2224">2224&nbsp;</a></p><p>The <code>$action</code> callback function now accepts an optional position argument.</p><p>See <a href="#func-map-filter"><b>14.4.6 map:filter</b></a></p><p>See <a href="#func-map-for-each"><b>14.4.8 map:for-each</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2228">2228&nbsp;</a></p><p>New in 4.0</p><p>See <a href="#func-array-sort-with"><b>15.2.27 array:sort-with</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2249">2249&nbsp;</a></p><p>The specification now describes in more detail how to determine the effective encoding value.</p><p>See <a href="#func-unparsed-text"><b>17.1.5 fn:unparsed-text</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2256">2256&nbsp;</a></p><p>In the interests of consistency, the <a href="#func-index-of"><code>index-of</code></a> function now defines equality to mean <a title="contextually equal" class="termref" href="#dt-contextually-equal">contextually equal</a>. This has the implication that <code>NaN</code> is now considered equal to <code>NaN</code>.</p><p>See <a href="#func-index-of"><b>2.2.8 fn:index-of</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2259">2259&nbsp;</a></p><p>A new parameter <code>canonical</code> is available to give control over serialization of XML, XHTML, and JSON.</p><p>See <a href="#func-serialize"><b>17.2.3 fn:serialize</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2286">2286&nbsp;</a></p><p>The type of <code>$value</code> has been generalized to <code>xs:anyAtomicType?</code>.</p><p>See <a href="#func-string-length"><b>5.4.7 fn:string-length</b></a></p><p>See <a href="#func-normalize-space"><b>5.4.8 fn:normalize-space</b></a></p></li><li><p>PR <a href="https://github.com/qt4cg/qtspecs/pull/2387">2387&nbsp;</a></p><p>It is now recommended that out-of-range <code>xs:double</code> values should translate to positive or negative infinity.</p><p>See <a href="#func-parse-json"><b>17.4.4 fn:parse-json</b></a></p></li></ol></div><div class="div2"><h3><a id="changes-to-casts-and-constructors"></a>H.2 <a href="#changes-to-casts-and-constructors" style="text-decoration: none">Changes to Casts and Constructor Functions</a></h3><ol class="enumar"><li><p>The keyword for the argument has changed from <code>arg</code> to <code>value</code>.</p></li><li><p>The argument is now optional, and defaults to the context value (which is atomized if necessary). This change aligns constructor functions such as <code>xs:string</code>, <code>xs:boolean</code>, and <code>xs:numeric</code> with <a href="#func-string"><code>fn:string</code></a>, <a href="#func-boolean"><code>fn:boolean</code></a>, and <a href="#func-number"><code>fn:number</code></a>.</p></li></ol></div><div class="div2"><h3><a id="miscellaneous-changes"></a>H.3 <a href="#miscellaneous-changes" style="text-decoration: none">Miscellaneous Changes</a></h3><ol class="enumar"><li><p>The semantics of the HTML case-insensitive collation <code>"http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"</code> are now defined normatively in this specification rather than by reference to the living HTML5 specification (which has changed since 3.1); and the rules now make ordering explicit rather than leaving it implementation-defined.</p></li><li><p>An option in an <a title="" class="termref" href="#options">option map</a> is now rejected if it is not described in the specification, if it is not supported by the implementation and if its name is in no namespace.</p></li></ol></div><div class="div2"><h3><a id="editorial-changes"></a>H.4 <a href="#editorial-changes" style="text-decoration: none">Editorial Changes</a></h3><p>These changes are not highlighted in the change-marked version of the specification.</p><ol class="enumar"><li><p>The value comparison operators such as <code>eq</code>, <code>lt</code>, and <code>gt</code> are now defined in <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> by reference to <a href="#func-compare"><code>fn:compare</code></a> and other functions. The datatype-specific functions <code>op:XX-equal</code>, <code>op:XX-less-than</code>, and <code>op:XX-greater-than</code> have therefore been dropped.</p></li><li><p>The names of parameters appearing in function signatures have been changed. This is to reflect the introduction of keyword arguments in XPath 4.0; the names chosen for parameters are now more consistent across the function library.</p><p>In 3.1 and earlier versions, the keywords used in the specification were for documentation purposes only, so these changes do not affect backwards compatibility.</p></li><li><p>Where appropriate, the phrase "the value of <code>$x</code>" has been replaced by the simpler <code>$x</code>. No change in meaning is intended.</p></li><li><p>For functions that take a variable number of arguments, wherever possible the specification now gives a single function signature indicating default values for arguments that may be omitted, rather than multiple signatures.</p></li><li><p>The formal specifications of array functions have been rewritten to use two new primitives: <code>array:members</code> which converts an array to a sequence of value records, and <code>array:of-members</code> which does the inverse. This has enabled many of the functions to be specified more concisely, and with less duplication between similar functions for sequences and arrays.</p></li><li><p>The appendix containing illustrative user-written functions has been dropped; many of these functions are no longer needed.</p></li></ol></div></div><div class="div1"><h2><a id="back-compatibility"></a>I <a href="#back-compatibility" style="text-decoration: none">Backward compatibility</a> (Non-Normative)</h2><p>This section summarizes the extent to which this specification is compatible with previous versions.</p><p>Version 4.0 of this function library is fully backwards compatible with version 3.1, except as noted below:</p><ol class="enumar"><li><p>In <a href="#func-deep-equal"><code>fn:deep-equal</code></a>, and in other functions such as <a href="#func-distinct-values"><code>fn:distinct-values</code></a> that refer to <a href="#func-deep-equal"><code>fn:deep-equal</code></a>, the rules for comparing values of different numeric types (for example, <code>xs:double</code> and <code>xs:decimal</code>) have changed. In previous versions of the specification, <code>xs:decimal</code> values were converted to <code>xs:double</code>, leading to a possible loss of precision. This could make comparisons non-transitive, leading to problems when grouping, and potentially (depending on the sort algorithm) with sorting. The problem has been fixed by requiring comparisons to be performed based on the exact mathematical value without any loss of precision.</p><p>This means, for example, that <code>deep-equal(0.2, 0.2e0)</code> is now false, whereas in previous versions it was true. The two values are not mathematically equal, because the exact decimal equivalent of the <code>xs:double</code> value written as <code>0.2e0</code> is <code>0.200000000000000011102230246251565404236316680908203125</code>.</p><p>The corresponding change has not been made to the <code>=</code> and <code>eq</code> operators, because it was found to be too disruptive. For example, if the context node is the element <code>&lt;e price="10.0" discount="0.2"/&gt;</code>, there is an expectation that the expression <code>@price - @discount = 9.8</code> should return true. But (assuming untyped data), the result of the subtraction is an <code>xs:double</code> whose precise value is <code>9.800000000000000710542735760100185871124267578125</code>, so comparing the two values as decimals would return false.</p></li><li><p>In previous versions, unrecognized options supplied to the <code>$options</code> parameter of functions such as <a href="#func-parse-json"><code>fn:parse-json</code></a> were silently ignored. In 4.0, they are rejected as a type error, unless they are QNames with a non-absent namespace, or are extensions recognized by the implementation.</p></li><li><p>In version 4.0, omitting the <code>$value</code> of <a href="#func-error"><code>fn:error</code></a> has the same effect as setting it to the empty sequence. In 3.1, the effects could be different (the effect of omitting the argument was implementation-defined).</p></li><li><p>In version 3.1, the <a href="#func-deep-equal"><code>fn:deep-equal</code></a> function did not merge adjacent text nodes after stripping comments and processing instructions, so the elements <code>&lt;a&gt;abc&lt;!--note1--&gt;def&lt;/code&gt;</code> and <code>&lt;a&gt;abcde&lt;!--note2--&gt;f&lt;/code&gt;</code> were considered non-equal. In version 4.0, the text nodes are now merged prior to comparison, so these two elements compare equal.</p></li><li><p>In version 3.1, the atomic types <code>xs:hexBinary</code> and <code>xs:base64Binary</code> were not mutually comparable under the <code>eq</code> operator, and always compared not equal as map keys or under operations such as <a href="#func-distinct-values"><code>fn:distinct-values</code></a> and <a href="#func-deep-equal"><code>fn:deep-equal</code></a>. In version 4.0, instances of <code>xs:hexBinary</code> and <code>xs:base64Binary</code> are equal if they represent the same octet sequence. This means, for example, that the zero-length values <code>xs:hexBinary("")</code> and <code>xs:base64Binary("")</code> can no longer co-exist as keys in the same map.</p></li><li><p>The format of numeric values in the output of <a href="#func-xml-to-json"><code>fn:xml-to-json</code></a> may be different. In version 3.1, the supplied value was parsed as an <code>xs:double</code> and then serialized using the casting rules, resulting in an input value of 10000000 being output as <code>1e7</code>. In version 4.0, the value is output <em>as is</em>, except for any changes (such as stripping of leading zeroes or a leading plus sign) that might be needed to ensure the result is valid JSON.</p></li><li><p>In version 4.0, the function signature of <a href="#func-namespace-uri-for-prefix"><code>fn:namespace-uri-for-prefix</code></a> constrains the first argument to be either an <code>xs:NCName</code> or a zero-length string (the new coercion rules mean that any string in the form of an <code>xs:NCName</code> is acceptable). If a string is supplied that does not meet these requirements, a type error will be raised. In version 3.1, this was not an error: it came under the rule that when no namespace binding existed for the supplied prefix, the function would return the empty sequence.</p><p>Furthermore, because the expected type of this parameter is no longer <code>xs:string</code>, the special coercion rules for <code>xs:string</code> parameters in XPath 1.0 compatibility mode no longer apply. For example, supplying <code>xs:duration('PT1H')</code> as the first argument will now raise a type error, rather than looking for a namespace binding for the prefix <code>PT1H</code>.</p></li><li><p>Version 4.0 makes it clear that the casting of a value other than <code>xs:string</code> or <code>xs:untypedAtomic</code> to a list type (whether using a cast expression or a constructor function) is a type error [<a href="https://www.w3.org/TR/xpath20/#ERRXPTY0004" title="err:XPTY0004">err:XPTY0004</a>]<sup><small>XP</small></sup>. Previously this was defined as an error, but the kind of error and the error code were left unspecified. Accordingly, the function signatures of the constructor functions for built-in list types have been changed to use an argument type of <code>xs:string?</code>.</p></li><li><p>The way that <a href="#func-min"><code>fn:min</code></a> and <a href="#func-max"><code>fn:max</code></a> compare numeric values of different types has changed. The most noticeable effect is that when these functions are applied to a sequence of <code>xs:integer</code> or <code>xs:decimal</code> values, the result is an <code>xs:integer</code> or <code>xs:decimal</code>, rather than the result of converting this to an <code>xs:double</code>.</p></li><li><p>The type of the third argument of <a href="#func-format-number"><code>fn:format-number</code></a> has changed from <code>xs:string</code> to <code>(xs:string | xs:QName)</code>. Because the expected type of this parameter is no longer <code>xs:string</code>, the special coercion rules for <code>xs:string</code> parameters no longer apply. For example, it is no longer possible to supply an instance of <code>xs:anyURI</code> or (when XPath 1.0 compatibility mode is in force) an instance of <code>xs:boolean</code> or <code>xs:duration</code>.</p></li><li><p>When <a href="#func-map-put"><code>map:put</code></a> replaces an entry in a map with a new value for an existing key, in the case where the existing key and the new key differ (for example, if they have different type annotations), it is no longer guaranteed that the new entry includes the new key rather than the existing key.</p></li><li><p>In regular expressions, the assertions <code>^</code> and <code>$</code> can no longer be followed by a quantifier. This is because (a) a quantifier that allows zero occurrences means that the assertion will always match, and (b) a quantifier that allows multiple occurrences has no effect. Processors may provide an option that allows such regular expressions to be accepted for compatibility reasons.</p></li><li><p>The <a href="#func-index-of"><code>index-of</code></a> now treats <code>NaN</code> as equal to <code>NaN</code>.</p></li></ol><p>For compatibility issues regarding earlier versions, see the 3.1 version of this specification.</p></div></div><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script><script src="js/toc.js"></script><script src="/js/scroll.js"></script></body></html>