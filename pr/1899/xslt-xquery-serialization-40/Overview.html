<!--{xsl-query} XSLT Processor: Saxonica--><!DOCTYPE HTML>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>XSLT and XQuery Serialization 4.0 </title>
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <link rel="stylesheet" type="text/css" href="css/w3c-base.css">
      <link rel="stylesheet" href="css/qtspecs.css">
      <link rel="stylesheet" href="css/xslt-xquery-serialization-40.css">
   </head>
   <body>
      <div class="head">
         <p><a href="https://www.w3.org/"><img src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" alt="W3C" height="48" width="72"></a></p>
         
         <h1><a id="title"></a>XSLT and XQuery Serialization 4.0 </h1>
         
         <h2><a id="w3c-doctype"></a>W3C Editor's Draft 26&nbsp;March&nbsp;2025</h2>
         <dl>
            <dt>This version:</dt>
            <dd>
               <a href="https://www.w3.org/TR/2000/REC-xslt-xquery-serialization-40-20000101/">https://www.w3.org/TR/2000/REC-xslt-xquery-serialization-40-20000101/</a>
               </dd>
            <dt>Latest version of XSLT and XQuery Serialization 4.0:</dt>
            <dd>
               <a href="https://www.w3.org/TR/xslt-xquery-serialization-40/">https://www.w3.org/TR/xslt-xquery-serialization-40/</a>
               </dd>
            <dt>Most recent version of XSLT and XQuery Serialization 4:</dt>
            <dd>
               <a href="https://www.w3.org/TR/xslt-xquery-serialization-4/">https://www.w3.org/TR/xslt-xquery-serialization-4/</a>
               </dd>
            <dt>Most recent version of XSLT and XQuery Serialization:</dt>
            <dd>
               <a href="https://www.w3.org/TR/xslt-xquery-serialization/">https://www.w3.org/TR/xslt-xquery-serialization/</a>
               </dd>
            <dt>Most recent Recommendation of XSLT and XQuery Serialization:</dt>
            <dd>
               <a href="https://www.w3.org/TR/xslt-xquery-serialization-31/">https://www.w3.org/TR/xslt-xquery-serialization-31/</a>
               </dd>
            <dt>Editors:</dt>
            <dd>Andrew Coleman, IBM Hursley Laboratories <a href="mailto:andrew_coleman@uk.ibm.com">&lt;andrew_coleman@uk.ibm.com&gt;</a></dd>
            <dd>C. M. Sperberg-McQueen, Black Mesa Technologies <a href="http://www.blackmesatech.com/">&lt;http://blackmesatech.com/&gt;</a></dd>
         </dl>
         <p>Please check the <a href="https://www.w3.org/XML/2017/qt-errata/xslt-xquery-serialization-40-errata.html"><strong>errata</strong></a> for any errors or issues reported since publication.</p>
         <p>See also <a href="https://www.w3.org/2003/03/Translations/byTechnology?technology=xslt-xquery-serialization-40"><strong>translations</strong></a>.</p>
         <p>This document is also available in these non-normative formats: <a href="https://www.w3.org/TR/2000/REC-xslt-xquery-serialization-40-20000101/xslt-xquery-serialization-40.xml">XML</a>.</p>
         <p class="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>&nbsp;©&nbsp;2000&nbsp;<a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p>
         <hr>
      </div>
      <div>
         
         <h2><a id="abstract"></a>Abstract</h2>
         <p>This document defines serialization of an instance of the data model as defined in
     <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> into a sequence of octets. 
     Serialization is designed to be a component that can be used by other specifications
     such as <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a> or <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a>.</p>
      </div>
      <div>
         
         <h2><a id="status"></a>Status of this Document</h2>
         <p><em>This section describes the status of this
         document at the time of its publication.
         Other documents may supersede this document.
         A list of current W3C publications and the latest
         revision of this technical report can be found in the
         <a href="https://www.w3.org/TR/">W3C technical reports index</a>
         at https://www.w3.org/TR/.</em></p>
         <p>This document is governed by the
         <a id="w3c_process_revision" href="https://www.w3.org/2017/Process-20170301/">1 March 2017 W3C Process Document</a>. </p>
         <p>This is a <a href="https://www.w3.org/2015/Process-20150901/#rec-publication">Recommendation</a> of the W3C. 
It was jointly developed by the W3C 
<a href="https://www.w3.org/Style/XSL/">XSLT Working Group</a> and the W3C <a href="https://www.w3.org/XML/Query/">XML Query Working Group</a>, each of which is part of the <a href="https://www.w3.org/XML/Activity">XML Activity</a>.</p>
         <p>This Editor's Draft specifies XSLT and XQuery Serialization
   version 4.0, a fully compatible extension of
   <a href="https://www.w3.org/TR/xslt-xquery-serialization-31/">Serialization version 3.1</a>.</p>
         <p>This specification is designed to be referenced normatively from
other specifications defining a host language for it; it is not
intended to be implemented outside a host language.  The
implementability of this specification has been tested in the context
of its normative inclusion in host languages defined by the
<a href="https://www.w3.org/TR/xquery-31/">XQuery 3.1</a>
and
<a href="https://www.w3.org/TR/xslt-30/">XSLT 3.0</a> specifications;
see the
<a href="https://dev.w3.org/2011/QT3-test-suite/ReportingResults31/report.html">XQuery 3.1 implementation report</a>
(and, in the future, the WGs expect that there will also be an
XSLT 3.0 implementation report) for details.</p>
         <p>No substantive changes have been made to this specification
since its publication as a Proposed Recommendation.</p>
         <p>Please report errors in this document using W3C's
         <a href="https://www.w3.org/Bugs/Public/">public Bugzilla system</a>
         (instructions can be found at
         <a href="https://www.w3.org/XML/2005/04/qt-bugzilla">https://www.w3.org/XML/2005/04/qt-bugzilla</a>).
         If access to that system is not feasible, you may send your comments
         to the W3C XSLT/XPath/XQuery public comments mailing list,
         <a href="mailto:public-qt-comments@w3.org">public-qt-comments@w3.org</a>.
         It will be very helpful if you include the string 
         “[SER40]”
         in the subject line of your report, whether made in Bugzilla or in email.
         Please use multiple Bugzilla entries (or, if necessary, multiple email messages)
         if you have more than one comment to make.
         Archives of the comments and responses are available at
         <a href="https://lists.w3.org/Archives/Public/public-qt-comments/">https://lists.w3.org/Archives/Public/public-qt-comments/</a>. </p>
         <p>This document has been reviewed by W3C Members, by
software developers, and by other W3C groups and interested parties,
and is endorsed by the Director as a W3C Recommendation. 
It is a stable document and may be used as reference material or cited from
another document. 
W3C's role in making the Recommendation is to draw attention to
the specification and to promote its widespread deployment. 
This enhances the functionality and interoperability of
the Web.</p>
         <p>This document was produced by groups operating under the
   <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
   W3C maintains a <a href="https://www.w3.org/2004/01/pp-impl/18797/status#disclosures" rel="disclosure">public list of any 
   patent disclosures (W3C XML Query Working Group)</a> and a <a href="https://www.w3.org/2004/01/pp-impl/19552/status#disclosures" rel="disclosure">public list of any patent 
   disclosures (W3C XSLT Working Group)</a> made in connection with the deliverables of 
   each group; these pages also include instructions for disclosing a patent.
   An individual who has actual knowledge of a patent which the individual believes contains
   <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a>
   must disclose the information in accordance with
   <a href="https://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
         <div class="dedication" id="dedication">
            <h3>Dedication</h3>
            <p>The publications of this community group 
<a href="../xquery-40/xpath-40.html#dedication">are dedicated</a> to our co-chair,
Michael Sperberg-McQueen&nbsp;(1954–2024).</p>
         </div>
      </div>
      <nav id="toc">
         
         <h2><a id="contents"></a>Table of Contents<span class="expalltoc collapsed"> ▶</span></h2>
         <ol class="toc">
            <li>
               <details>
                  <summary><a href="#intro"><span class="secno">1 </span><span class="content toc-chg">Introduction</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#terminology"><span class="secno">1.1 </span><span class="content toc-chg">Terminology</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#namespaces"><span class="secno">1.2 </span><span class="content">Namespaces</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#serdm"><span class="secno">2 </span><span class="content">Sequence Normalization</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#serparam"><span class="secno">3 </span><span class="content toc-chg">Serialization Parameters</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#serparams-in-xdm-instance"><span class="secno">3.1 </span><span class="content">Setting Serialization Parameters by Means of a Parameter Document</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#serphases"><span class="secno">4 </span><span class="content">Phases of Serialization</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#xml-output"><span class="secno">5 </span><span class="content">XML Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#XML_PARAMS"><span class="secno">5.1 </span><span class="content">The Influence of Serialization Parameters upon the XML Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#XML_VERSION"><span class="secno">5.1.1 </span><span class="content">XML Output Method: the version Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XML_ENCODING"><span class="secno">5.1.2 </span><span class="content">XML Output Method: the encoding Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#xml-indent"><span class="secno">5.1.3 </span><span class="content">XML Output Method: the indent and suppress-indentation Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XML_CDATA-SECTION-ELEMENTS"><span class="secno">5.1.4 </span><span class="content">XML Output Method: the cdata-section-elements Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XML_OMIT-XML-DECLARATION"><span class="secno">5.1.5 </span><span class="content">XML Output Method: the omit-xml-declaration and standalone Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XML_DOCTYPE"><span class="secno">5.1.6 </span><span class="content">XML Output Method: the doctype-system and doctype-public Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#xml-undeclare-NS"><span class="secno">5.1.7 </span><span class="content">XML Output Method: the undeclare-prefixes Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XML_NORMALIZATION-FORM"><span class="secno">5.1.8 </span><span class="content">XML Output Method: the normalization-form Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XML_MEDIA-TYPE"><span class="secno">5.1.9 </span><span class="content">XML Output Method: the media-type Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XML_USE-CHARACTER-MAPS"><span class="secno">5.1.10 </span><span class="content">XML Output Method: the use-character-maps Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XML_BYTE-ORDER-MARK"><span class="secno">5.1.11 </span><span class="content">XML Output Method: the byte-order-mark Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XML_ITEM-SEPARATOR"><span class="secno">5.1.12 </span><span class="content">XML Output Method: the item-separator Parameter</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#xhtml-output"><span class="secno">6 </span><span class="content toc-chg">XHTML Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#XHTML_PARAMS"><span class="secno">6.1 </span><span class="content">The Influence of Serialization Parameters upon the XHTML Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_VERSION"><span class="secno">6.1.1 </span><span class="content">XHTML Output Method: the version
                                             Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_HTML_VERSION"><span class="secno">6.1.2 </span><span class="content">XHTML Output Method: the html-version Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_ENCODING"><span class="secno">6.1.3 </span><span class="content">XHTML Output Method: the encoding Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_INDENT"><span class="secno">6.1.4 </span><span class="content">XHTML Output Method: the indent and suppress-indentation Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_CDATA-SECTION-ELEMENTS"><span class="secno">6.1.5 </span><span class="content">XHTML Output Method: the cdata-section-elements Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_OMIT-XML-DECLARATION"><span class="secno">6.1.6 </span><span class="content">XHTML Output Method: the omit-xml-declaration and standalone Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_DOCTYPE"><span class="secno">6.1.7 </span><span class="content">XHTML Output Method: the doctype-system and doctype-public Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_UNDECLARE-PREFIXES"><span class="secno">6.1.8 </span><span class="content">XHTML Output Method: the undeclare-prefixes Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_NORMALIZATION-FORM"><span class="secno">6.1.9 </span><span class="content">XHTML Output Method: the normalization-form Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_MEDIA-TYPE"><span class="secno">6.1.10 </span><span class="content">XHTML Output Method: the media-type Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_USE-CHARACTER-MAPS"><span class="secno">6.1.11 </span><span class="content">XHTML Output Method: the use-character-maps Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_BYTE-ORDER-MARK"><span class="secno">6.1.12 </span><span class="content">XHTML Output Method: the byte-order-mark Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_ESCAPE-URI-ATTRIBUTES"><span class="secno">6.1.13 </span><span class="content">XHTML Output Method: the escape-uri-attributes Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_INCLUDE-CONTENT-TYPE"><span class="secno">6.1.14 </span><span class="content">XHTML Output Method: the include-content-type Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#XHTML_ITEM-SEPARATOR"><span class="secno">6.1.15 </span><span class="content">XHTML Output Method: the item-separator Parameter</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#html-output"><span class="secno">7 </span><span class="content toc-chg">HTML Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#HTML_MARKUP"><span class="secno">7.1 </span><span class="content">Markup for Elements</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#HTML_ATTRIBS"><span class="secno">7.2 </span><span class="content">Writing Attributes</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#HTML_CHARDATA"><span class="secno">7.3 </span><span class="content">Writing Character Data</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#HTML_PARAMS"><span class="secno">7.4 </span><span class="content">The Influence of Serialization Parameters upon the HTML Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#HTML_VERSION"><span class="secno">7.4.1 </span><span class="content">HTML Output Method: the version
                                             and html-version
                                             Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_ENCODING"><span class="secno">7.4.2 </span><span class="content">HTML Output Method: the encoding Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_INDENT"><span class="secno">7.4.3 </span><span class="content">HTML Output Method: the indent and suppress-indentation Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_CDATA-SECTION-ELEMENTS"><span class="secno">7.4.4 </span><span class="content">HTML Output Method: the cdata-section-elements Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_DOCTYPE"><span class="secno">7.4.5 </span><span class="content">HTML Output Method: the doctype-system and doctype-public Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_NORMALIZATION-FORM"><span class="secno">7.4.6 </span><span class="content">HTML Output Method: the normalization-form Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_MEDIA-TYPE"><span class="secno">7.4.7 </span><span class="content">HTML Output Method: the media-type Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_USE-CHARACTER-MAPS"><span class="secno">7.4.8 </span><span class="content">HTML Output Method: the use-character-maps Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_BYTE-ORDER-MARK"><span class="secno">7.4.9 </span><span class="content">HTML Output Method: the byte-order-mark Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_ESCAPE-URI-ATTRIBUTES"><span class="secno">7.4.10 </span><span class="content">HTML Output Method: the escape-uri-attributes Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_INCLUDE-CONTENT-TYPE"><span class="secno">7.4.11 </span><span class="content">HTML Output Method: the include-content-type Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#HTML_ITEM-SEPARATOR"><span class="secno">7.4.12 </span><span class="content">HTML Output Method: the item-separator Parameter</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#text-output"><span class="secno">8 </span><span class="content">Text Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#TEXT_PARAMS"><span class="secno">8.1 </span><span class="content">The Influence of Serialization Parameters upon the Text Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#TEXT_ENCODING"><span class="secno">8.1.1 </span><span class="content">Text Output Method: the encoding Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#TEXT_NORMALIZATION-FORM"><span class="secno">8.1.2 </span><span class="content">Text Output Method: the normalization-form Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#TEXT_MEDIA-TYPE"><span class="secno">8.1.3 </span><span class="content">Text Output Method: the media-type Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#TEXT_USE-CHARACTER-MAPS"><span class="secno">8.1.4 </span><span class="content">Text Output Method: the use-character-maps Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#TEXT_BYTE-ORDER-MARK"><span class="secno">8.1.5 </span><span class="content">Text Output Method: the byte-order-mark Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#TEXT_ITEM-SEPARATOR"><span class="secno">8.1.6 </span><span class="content">Text Output Method: the item-separator Parameter</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#json-output"><span class="secno">9 </span><span class="content toc-chg">JSON Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#id-json-lines"><span class="secno">9.1 </span><span class="content">JSON Lines</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#JSON_PARAMS"><span class="secno">9.2 </span><span class="content">The Influence of Serialization Parameters upon the JSON Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#JSON_ENCODING"><span class="secno">9.2.1 </span><span class="content">JSON Output Method: the encoding Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#JSON_INDENT"><span class="secno">9.2.2 </span><span class="content">JSON Output Method: the indent Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#JSON_NORMALIZATION-FORM"><span class="secno">9.2.3 </span><span class="content">JSON Output Method: the normalization-form Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#JSON_MEDIA-TYPE"><span class="secno">9.2.4 </span><span class="content">JSON Output Method: the media-type Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#JSON_USE-CHARACTER-MAPS"><span class="secno">9.2.5 </span><span class="content">JSON Output Method: the use-character-maps Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#JSON_BYTE-ORDER-MARK"><span class="secno">9.2.6 </span><span class="content">JSON Output Method: the byte-order-mark Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#JSON_ESCAPE-SOLIDUS"><span class="secno">9.2.7 </span><span class="content">JSON Output Method: the escape-solidus Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#JSON_ALLOW-DUPLICATE-NAMES"><span class="secno">9.2.8 </span><span class="content">JSON Output Method: the allow-duplicate-names Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#JSON_JSON-NODE-OUTPUT-METHOD"><span class="secno">9.2.9 </span><span class="content">JSON Output Method: the json-node-output-method Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#JSON_JSON-LINES"><span class="secno">9.2.10 </span><span class="content">JSON Output Method: the json-lines Parameter</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#adaptive-output"><span class="secno">10 </span><span class="content toc-chg">Adaptive Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#ADAPTIVE_PARAMS"><span class="secno">10.1 </span><span class="content toc-chg">The Influence of Serialization Parameters upon the Adaptive Output Method</span></a><span class="exptoc collapsed"> ▶</span></summary>
                           <ol class="toc">
                              <li>
                                 <details>
                                    <summary><a href="#ADAPTIVE_OMIT-XML-DECLARATION"><span class="secno">10.1.1 </span><span class="content">Adaptive Output Method: the omit-xml-declaration and standalone Parameters</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#ADAPTIVE_USE-CHARACTER-MAPS"><span class="secno">10.1.2 </span><span class="content">Adaptive Output Method: the use-character-maps Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#ADAPTIVE_BYTE-ORDER-MARK"><span class="secno">10.1.3 </span><span class="content">Adaptive Output Method: the byte-order-mark Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#ADAPTIVE_ESCAPE-SOLIDUS"><span class="secno">10.1.4 </span><span class="content">Adaptive Output Method: the escape-solidus Parameter</span></a></summary>
                                 </details>
                              </li>
                              <li>
                                 <details>
                                    <summary><a href="#ADAPTIVE_ITEM-SEPARATOR"><span class="secno">10.1.5 </span><span class="content">Adaptive Output Method: the item-separator Parameter</span></a></summary>
                                 </details>
                              </li>
                           </ol>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#character-maps"><span class="secno">11 </span><span class="content">Character Maps</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#conformance"><span class="secno">12 </span><span class="content">Conformance</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#references"><span class="secno">A </span><span class="content">References</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#normative-references"><span class="secno">A.1 </span><span class="content">Normative References</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#informative-references"><span class="secno">A.2 </span><span class="content">Informative References</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#serparams-schema"><span class="secno">B </span><span class="content">Schema for Serialization Parameters</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#id-errors"><span class="secno">C </span><span class="content">Summary of Error Conditions</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#list-of-uri-attributes"><span class="secno">D </span><span class="content">List of URI Attributes</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#id-glossary"><span class="secno">E </span><span class="content">Glossary</span></a></summary>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#implementation-defined-or-dependent-features"><span class="secno">F </span><span class="content">Checklist of Implementation-Defined and Implementation-Dependent Features</span></a><span class="exptoc collapsed"> ▶</span></summary>
                  <ol class="toc">
                     <li>
                        <details>
                           <summary><a href="#implementation-defined-features"><span class="secno">F.1 </span><span class="content">Checklist of Implementation-Defined Features</span></a></summary>
                        </details>
                     </li>
                     <li>
                        <details>
                           <summary><a href="#implementation-dependent-features"><span class="secno">F.2 </span><span class="content">Checklist of Implementation-Dependent Features</span></a></summary>
                        </details>
                     </li>
                  </ol>
               </details>
            </li>
            <li>
               <details>
                  <summary><a href="#revision-log"><span class="secno">G </span><span class="content">Change Log</span></a></summary>
               </details>
            </li>
         </ol>
      </nav>
      <hr>
      <div class="body">
         <div class="div1">
            
            <h2><a id="intro"></a>1 <a href="#intro" style="text-decoration: none">Introduction</a></h2>
            <div class="changes">
               <p class="changesHeading">Changes in 4.0&nbsp;<a href="#terminology">⬇</a></p>
               <ol>
                  <li>
                     <p>Use the arrows to browse significant changes since the 3.1 version of this specification.</p>
                  </li>
                  <li>
                     <p>Sections with significant changes are marked Δ in the table of contents.</p>
                  </li>
               </ol>
            </div>
            <p>This document defines serialization of the W3C XQuery
and XPath Data Model 4.0 (XDM),
which is the data model of at least <a href="#xpath-40">[XML Path Language (XPath) 4.0]</a>,
<a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a>, and
<a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a>, and any other specifications that reference it.</p>
            <p>In this document, examples and material labeled as “Note” are provided for
explanatory purposes and are not normative. </p>
            <p>Serialization is the process of converting an instance of the
<a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a> into a sequence of octets.</p>
            <p>[<a id="dt-input-value" title="input value">Definition</a>: The XDM value supplied as input to the serializer
is referred to as the <b>input value</b>.] Some serialization methods apply only
to certain types of input value.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>Where serialization is used to process the result of an XQuery evaluation or an XSLT transformation,
  the <a title="input value" class="termref" href="#dt-input-value">input value</a> of the serializer corresponds to the output from XQuery
  or XSLT.</p>
            </div>
            <p>[<a id="dt-input-tree" title="input tree">Definition</a>: In general the output of the serializer
    will represent the items actually present in the input value, together with other items that are reachable
    from these, for example (in the case of nodes) their descendants. The complete set of items that
    are represented in the output of the serializer is referred to (without loss of generality) as the 
    <b>input tree</b>.]</p>
            <div class="div2">
               
               <h3><a id="terminology"></a>1.1 <a href="#terminology" style="text-decoration: none">Terminology</a></h3>
               <div class="changes">
                  <p class="changesHeading">Changes in 4.0&nbsp;<a href="#serparam">⬇</a>&nbsp;<a href="#intro">⬆</a></p>
                  <ol>
                     <li>
                        <p>
        The term <b>atomic value</b> has been replaced by <b>atomic item</b>.
     <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1337">1337</a>&nbsp;&nbsp;2 August 2024]</i></p>
                     </li>
                  </ol>
               </div>
               <p>In this specification,
where they are rendered in small capitals,
the words <span class="verb">must</span>, <span class="verb">must not</span>,
<span class="verb">should</span>, <span class="verb">should not</span>, <span class="verb">may</span>, 
  <span class="verb">required</span>, and
<span class="verb">recommended</span> are to be interpreted as described in
<a href="#RFC2119">[RFC2119]</a>.</p>
               <p>[<a id="serializer" title="serializer">Definition</a>: As is indicated in
<a href="#conformance"><b>12 Conformance</b></a>, conformance criteria for serialization
are determined by other specifications that refer to this specification.
A <b>serializer</b> is software that implements some or all of the
requirements of this specification in accordance with such conformance
criteria.]  A serializer is not <span class="verb">required</span> to directly provide a
programming interface that permits a user to set serialization parameters
or to provide an input sequence for serialization.
In this document, material labeled
as "Note" and examples are provided for explanatory purposes and are not
normative.

</p>
               <p>Certain aspects of serialization are described in this specification 
as <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> 
or <a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a>.</p>
               <p>
[<a id="impdef" title="implementation-defined">Definition</a>: <b>Implementation-defined</b> indicates an
aspect that <span class="verb">may</span> differ between
<a title="serializer" class="termref" href="#serializer">serializers</a>, but whose actual
behavior <span class="verb">must</span> be specified either by another specification that sets
conformance criteria for serialization (see <a href="#conformance"><b>12 Conformance</b></a>)
or in documentation that accompanies the
<a title="serializer" class="termref" href="#serializer">serializer</a>.]</p>
               <p>
[<a id="impdep" title="implementation-dependent">Definition</a>: <b>Implementation-dependent</b> indicates an
aspect that <span class="verb">may</span> differ between
<a title="serializer" class="termref" href="#serializer">serializers</a>, and whose actual
behavior is not <span class="verb">required</span>  to be specified either by another specification
that sets conformance criteria for serialization (see
<a href="#conformance"><b>12 Conformance</b></a>) or in documentation that accompanies the
<a title="serializer" class="termref" href="#serializer">serializer</a>.]</p>
               <p>
[<a id="serial-err" title="serialization error">Definition</a>: In some instances, the
<a title="input tree" class="termref" href="#dt-input-tree">input tree</a> cannot be successfully converted
into a sequence of octets given the set of serialization parameter
(<a href="#serparam"><b>3 Serialization Parameters</b></a>) values specified.  A
<b>serialization error</b> is said to occur in such an instance.]
In some cases, a <a title="serializer" class="termref" href="#serializer">serializer</a> is
<span class="verb">required</span>  to <b>raise</b> such an error.
What it means to raise a serialization error is determined by the
relevant conformance criteria (<a href="#conformance"><b>12 Conformance</b></a>) to which
the <a title="serializer" class="termref" href="#serializer">serializer</a> conforms.  In other cases,
there is an <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> choice
between raising a serialization error and performing a recovery action.
Such a recovery action will allow a
<a title="serializer" class="termref" href="#serializer">serializer</a> to produce a sequence of
octets that might not fully reflect the usual requirements of the
parameter settings that are in effect.
</p>
               <p>
[<a id="caseless-compare" title="without regard to case">Definition</a>: 
Where this specification indicates that two strings are to be
compared <b>without regard to case</b>, the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> translate any characters in the range
<span class="unicode-codepoint">U+0041</span> (<span class="unicode-name">LATIN CAPITAL LETTER A</span>, <code>A</code>)  through <span class="unicode-codepoint">U+005A</span> (<span class="unicode-name">LATIN CAPITAL LETTER Z</span>, <code>Z</code>) 
inclusive, to the corresponding lower-case letters in the range
<span class="unicode-codepoint">U+0061</span> (<span class="unicode-name">LATIN SMALL LETTER A</span>, <code>a</code>)  through <span class="unicode-codepoint">U+007A</span> (<span class="unicode-name">LATIN SMALL LETTER Z</span>, <code>z</code>)  only
for the purposes of making the comparison.  The comparison
succeeds if the two strings are the same length and the code
point of each character in the first string is equal to the
code point of the character in the corresponding position in
the second string.]
</p>
               <p>Many terms used in this document are defined in the XPath specification 
<a href="#xpath-40">[XML Path Language (XPath) 4.0]</a> or the Data Model specification <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>. Particular
attention is drawn to the following:</p>
               <ul>
                  <li>
                     <p>[<a id="dt-atomization" title="atomize">Definition</a>: The term <b>atomization</b> is defined
in <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-atomization">Section 2.5.3 Atomization</a><sup><small>XP</small></sup>.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-node" title="node">Definition</a>: The term <b>node</b>
is defined as part of   <span class="markup-error">[TITLE OF DM40 SPEC, TITLE OF Node SECTION]<sup><small>DM40</small></sup></span>. 
There are seven kinds of <a title="node" class="termref" href="#dt-node">nodes</a> in the data model: document, element, attribute, text, namespace, processing instruction, and comment.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-sequence" title="sequence">Definition</a>: The term <b>sequence</b>
is defined in <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-basics">Section 2 Basics</a><sup><small>XP</small></sup>. 
A <a title="sequence" class="termref" href="#dt-sequence">sequence</a> is an ordered collection of zero or more items.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-function-item" title="function item">Definition</a>: The term
<b>function item</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#function-items">Section 7.1 Function Items</a><sup><small>DM</small></sup>.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-map-item" title="map item">Definition</a>: The term
<b>map item</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#map-items">Section 7.2 Map Items</a><sup><small>DM</small></sup>.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-array-item" title="array item">Definition</a>: The term
<b>array item</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#array-items">Section 7.3 Array Items</a><sup><small>DM</small></sup>.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-string" title="string">Definition</a>: The term
<b>string</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#xml-and-xsd-versions">Section 4.1.5 XML and XSD Versions</a><sup><small>DM</small></sup>.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-character" title="character">Definition</a>: The term
<b>character</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#xml-and-xsd-versions">Section 4.1.5 XML and XSD Versions</a><sup><small>DM</small></sup>.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-codepoint" title="codepoint">Definition</a>: The term
<b>codepoint</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#xml-and-xsd-versions">Section 4.1.5 XML and XSD Versions</a><sup><small>DM</small></sup>.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-string-value" title="string value">Definition</a>: The term <b>string value</b>
is defined in <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dm-string-value">Section 6.7.12 string-value Accessor</a><sup><small>DM</small></sup>. 
Every <a title="node" class="termref" href="#dt-node">node</a> has a <a title="string value" class="termref" href="#dt-string-value">string value</a>. For example, the <a title="string value" class="termref" href="#dt-string-value">string value</a>
of an element is the concatenation of the <a title="string value" class="termref" href="#dt-string-value">string values</a> of all its descendant text <a title="node" class="termref" href="#dt-node">nodes</a>.]</p>
                  </li>
                  <li>
                     <p>[<a id="dt-expanded-qname" title="expanded QName">Definition</a>: The term <b>expanded QName</b>
is defined in <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-basics">Section 2 Basics</a><sup><small>XP</small></sup>. 
An <a title="expanded QName" class="termref" href="#dt-expanded-qname">expanded QName</a> consists of an optional namespace URI and a local name. An <a title="expanded QName" class="termref" href="#dt-expanded-qname">expanded QName</a> also retains its original namespace prefix (if any), to facilitate casting the expanded QName into a string.]</p>
                  </li>
                  <li>
                     <p>[<a id="null-namespace-URI" title="null namespace URI">Definition</a>: 
An <a title="expanded QName" class="termref" href="#dt-expanded-qname">expanded-QName</a> whose 
namespace part is an empty sequence,
or an element or attribute whose name expands to such 
an <a title="expanded QName" class="termref" href="#dt-expanded-qname">expanded-QName</a>,
is referred to as having a <b>null namespace URI</b>].</p>
                  </li>
                  <li>
                     <p>[<a id="non-null-namespace-URI" title="non-null namespace URI">Definition</a>: An element or attribute that does not have a <a title="null namespace URI" class="termref" href="#null-namespace-URI">null namespace URI</a>, is referred to as having a <b>non-null namespace URI</b>].</p>
                  </li>
                  <li>
                     <p>
[<a id="whitespace-char" title="whitespace character">Definition</a>: A space character,
TAB character, CR character or NL character is referred to as a
<b>whitespace character</b>.]</p>
                  </li>
               </ul>
               <p>Where this specification indicates that an
XSLT instruction is evaluated, the behavior is as specified by
<a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a>.  Where it indicates that an XQuery expression is
evaluated, the behavior is as specified by <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a>.</p>
            </div>
            <div class="div2">
               
               <h3><a id="namespaces"></a>1.2 <a href="#namespaces" style="text-decoration: none">Namespaces</a></h3>
               <p>This specification refers to several namespaces that affect the process
of serialization.  These are:</p>
               <ul>
                  <li>
                     <p>[<a id="output-namespace" title="Output declaration namespace">Definition</a>: the
<b>Output declaration namespace</b>,
<code>https://www.w3.org/2010/xslt-xquery-serialization</code>];</p>
                  </li>
                  <li>
                     <p>[<a id="xml-namespace" title="XML namespace">Definition</a>: the
<b>XML namespace</b>,
<code>https://www.w3.org/XML/1998/namespace</code>];</p>
                  </li>
                  <li>
                     <p>[<a id="xhtml-namespace" title="XHTML namespace">Definition</a>: the
<b>XHTML namespace</b> namespace,
<code>https://www.w3.org/1999/xhtml</code>];</p>
                  </li>
                  <li>
                     <p>[<a id="svg-namespace" title="SVG namespace">Definition</a>: the
<b>SVG namespace</b>,
<code>https://www.w3.org/2000/svg</code>]; and</p>
                  </li>
                  <li>
                     <p>[<a id="mathml-namespace" title="MathML namespace">Definition</a>: the
<b>MathML namespace</b> namespace,
<code>https://www.w3.org/1998/Math/MathML</code>.]</p>
                  </li>
               </ul>
               <p>Wherever an element node or attribute node is said to be in a
particular namespace, it is understood that the namespace URI of the
node is equal to the namespace URI corresponding to that namespace.
Wherever a namespace node is said to be a namespace node for a
particular namespace, it is understood that the
<a title="string value" class="termref" href="#dt-string-value">string value</a> of the node is
equal to the namespace URI corresponding to that namespace.</p>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="serdm"></a>2 <a href="#serdm" style="text-decoration: none">Sequence Normalization</a></h2>
            <p>The <a title="input value" class="termref" href="#dt-input-value">input value</a> is a sequence.
Prior to serializing a sequence using any of
the output methods whose behavior is specified by this document
(<a href="#serparam"><b>3 Serialization Parameters</b></a>), 
with the exception of the JSON and Adaptive
output methods,
the <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> first
compute a normalized sequence for serialization; it
is the normalized sequence that is actually serialized.
[<a id="sequence-normalization" title="sequence normalization">Definition</a>: The purpose of <b>sequence normalization</b> is
to create a sequence that can be serialized as a
well-formed XML document or external general parsed entity, that
also reflects the content of the input sequence to the extent possible.]
[<a id="result-tree" title="result tree">Definition</a>: The result of the <a title="sequence normalization" class="termref" href="#sequence-normalization">sequence normalization</a> process is a <b>result tree</b>.]</p>
            <p>The normalized sequence for serialization is constructed by applying all
  of the following rules in order, with the <a title="input value" class="termref" href="#dt-input-value">input value</a> being
input to the first step, and the sequence that results from any
step being used as input to the subsequent step.
For any <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
output method, it is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
whether this sequence normalization process takes place.
For the JSON and Adaptive output methods,
sequence normalization <span class="verb">must not</span> take place.</p>
            <p>Where the process of converting the input sequence
to a normalized sequence indicates that a value <span class="verb">must</span> be cast to
<code>xs:string</code>, that operation is
defined in <a href="https://qt4cg.org/specifications/xpath-functions-40/#casting-to-string">Section 22.1.2 Casting to xs:string</a><sup><small>FO</small></sup> of
<a href="#xpath-functions-40">[XQuery and XPath Functions and Operators 4.0]</a>.
Where a
step in the sequence normalization process indicates that a node should be
copied, the copy is performed in the same way as an XSLT
<code>xsl:copy-of</code> instruction that has a
<code>validation</code> attribute whose value is
<code>preserve</code> and has a
<code>select</code> attribute whose effective value is the
node, as described in <a href="https://qt4cg.org/specifications/xslt-40/#copy-of">Section 11.9.2 Deep Copy</a><sup><small>XT</small></sup>
of <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a>,
or equivalently in the same way as an XQuery
content expression as described in Step 1e of
<a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-content">Section 4.12.1.3 Content</a><sup><small>XQ</small></sup>
of <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a>, where the construction mode is
<code>preserve</code>.

Let <var>S<sub>0</sub></var> be the sequence that is input to serialization. 
The steps in computing the normalized sequence are:
</p>
            <ol class="enumar">
               <li>
                  <p>Create a new sequence <var>S<sub>1</sub></var> from <var>S<sub>0</sub></var> as follows. For
each item in <var>S<sub>0</sub></var>, if the item is an array, copy the results of
passing the item into the function <code>array:flatten()</code>; otherwise, copy the item
itself. If <var>S<sub>0</sub></var> is empty, let <var>S<sub>1</sub></var> consist
of a zero-length string. </p>
               </li>
               <li>
                  <p>Create a new sequence <var>S<sub>2</sub></var> from <var>S<sub>1</sub></var> as follows. For
each item in <var>S<sub>1</sub></var>, if the item is atomic, copy to <var>S<sub>2</sub></var> only the lexical
representation resulting from casting the item to an <code>xs:string</code>, otherwise, 
copy the item to <var>S<sub>2</sub></var>.</p>
               </li>
               <li>
                  <p>Create a new sequence <var>S<sub>3</sub></var> from <var>S<sub>2</sub></var> as follows. If the
<code>item-separator</code> serialization parameter is present, then copy each item in
<var>S<sub>2</sub></var> to <var>S<sub>3</sub></var>, inserting between each pair of items
a string whose value is equal to the value of the item-separator parameter. If the
<code>item-separator</code> serialization parameter is not present, then first maximally 
group the items in <var>S<sub>2</sub></var> into subsequences of <code>xs:string</code> items 
and non-<code>xs:string</code> items. For each group of items, if the group is a subsequence of
non-<code>xs:string</code> items, copy the subsequence to
<var>S<sub>3</sub></var>; if the group is a subsequence of <code>xs:string</code> 
items, copy to <var>S<sub>3</sub></var> the results of passing to
<code>fn:string-join()</code> the subsequence and the value of
<code>item-separator</code> as the function’s two parameters. </p>
               </li>
               <li>
                  <p>Create a new sequence <var>S<sub>4</sub></var> from <var>S<sub>3</sub></var> as follows.
For each item in <var>S<sub>3</sub></var>, if the item is a string,
copy to <var>S<sub>4</sub></var> a text node whose <a title="string value" class="termref" href="#dt-string-value">string value</a> is equal to
the string; otherwise, copy the item to <var>S<sub>4</sub></var>.</p>
               </li>
               <li>
                  <p>
Create a new sequence <var>S<sub>5</sub></var> from <var>S<sub>4</sub></var> as follows.
For each item in <var>S<sub>4</sub></var>, if the item is a document node,
copy its children to <var>S<sub>5</sub></var>; otherwise, copy the item to <var>S<sub>5</sub></var>.</p>
               </li>
               <li>
                  <p>Create a new sequence <var>S<sub>6</sub></var> from <var>S<sub>5</sub></var> as follows. First,
remove any text nodes with values of zero length from <var>S<sub>5</sub></var>, then
maximally group the results into groups of text nodes and non-text nodes. For each group
of items, if the group is a subsequence of text nodes, copy to
<var>S<sub>6</sub></var> a single text node whose value is equal to the concatenated
values of the subsequence; if the group is a subsequence of non-text nodes, copy the
subsequence of items to <var>S<sub>6</sub></var>. It is a <a title="serialization error" class="termref" href="#serial-err">serialization error</a>
[<a href="#ERRSENR0001" title="err:SENR0001">err:SENR0001</a>] if any item in <var>S<sub>6</sub></var> is an
attribute node, a namespace node, or a <a title="function item" class="termref" href="#dt-function-item">function</a>. </p>
               </li>
               <li>
                  <p>Create a new sequence <var>S<sub>7</sub></var> from <var>S<sub>6</sub></var> as follows.
Let <var>S<sub>7</sub></var> be a single document node. 
Copy sequence <var>S<sub>6</sub></var> to the document node as its children.
</p>
               </li>
            </ol>
            <p><var>S<sub>7</sub></var> is the normalized sequence.</p>
            <p>The <a title="result tree" class="termref" href="#result-tree">result tree</a> rooted at the document node that is
created by the final step of this sequence
normalization process is the
value to which the rules of the appropriate
output method are applied.  If the sequence
normalization process results
in a <a title="serialization error" class="termref" href="#serial-err">serialization error</a>, the
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> raise the error.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>If the <code>item-separator</code>
serialization parameter is absent, the sequence normalization process
for a sequence <code>$seq</code> is equivalent
to constructing a document node using the XSLT instruction:</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:document&gt;
  &lt;xsl:copy-of select="$seq" validation="preserve"/&gt;
&lt;/xsl:document&gt;</pre>
               </div>
               <p>or the XQuery expression:</p>
               <div class="exampleInner">
                  <pre>
declare construction preserve;

document { $seq }</pre>
               </div>
               <p>If the <code>item-separator</code>
serialization parameter is present, the sequence normalization process
for a sequence <code>$seq</code> is equivalent to constructing a
document node using the XSLT
instruction:</p>
               <div class="exampleInner">
                  <pre>
&lt;xsl:document&gt;
  &lt;xsl:for-each select="$seq"&gt;
    &lt;xsl:sequence select="if (position() gt 1) 
                          then $sep 
                          else ()"/&gt;

    &lt;xsl:choose&gt;
      &lt;xsl:when test=". instance of node()"&gt;
        &lt;xsl:sequence select="."/&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:value-of select="."/&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:for-each&gt;
&lt;/xsl:document&gt;</pre>
               </div>
               <p>or the XQuery expression:</p>
               <div class="exampleInner">
                  <pre>
declare construction preserve; 

document {
  for $item at $pos in $seq
  let $node := 
    if ($item instance of node()) then 
      $item 
    else 
      text { $item }
  return
    if ($pos eq 1) then
      $node
    else
      ($sep, $node)  
}</pre>
               </div>
               <p>where the value of the <code>sep</code>
variable is a string whose value is equal to the value of the
<code>item-separator</code> serialization parameter.</p>
               <p>This process results in a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSENR0001" title="err:SENR0001">err:SENR0001</a>]
if 

<code>$seq</code> contains functions,
attribute nodes or namespace
nodes.</p>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="serparam"></a>3 <a href="#serparam" style="text-decoration: none">Serialization Parameters</a></h2>
            <div class="changes">
               <p class="changesHeading">Changes in 4.0&nbsp;<a href="#xhtml-output">⬇</a>&nbsp;<a href="#terminology">⬆</a></p>
               <ol>
                  <li>
                     <p>
      Added the <code>escape-solidus</code> parameter for JSON serialization.
    <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/530">530</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/534">534</a>&nbsp;6 June 2023]</i></p>
                  </li>
                  <li>
                     <p>
      Added the <code>json-lines</code> parameter for JSON serialization.
    <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1471">1471</a>&nbsp;&nbsp;15 October 2024]</i></p>
                  </li>
               </ol>
            </div>
            <p>There are a number of parameters that influence how serialization
is performed. <a title="host language" class="termref" href="#host-language">Host languages</a> <span class="verb">may</span> allow users to specify any or all of these parameters, but
they are not <span class="verb">required</span> to be able to do so. However, the <a title="host language" class="termref" href="#host-language">host language</a>
specification <span class="verb">must</span> specify how the values of all applicable parameters are to be
determined. </p>
            <p>Host languages may also define alternative representations of the values of serialization parameters. For example, both XSLT
  and XQuery allow the boolean values <code>true</code> and <code>false</code> to be written as <code>1</code>/<code>0</code>
  or <code>yes</code>/<code>no</code>. The <code>$options</code> map passed to the <code>fn:serialize</code> function,
  by contrast, requires an <code>xs:boolean</code> value.</p>
            <p>It is a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSEPM0016" title="err:SEPM0016">err:SEPM0016</a>] if a parameter value is invalid for the given parameter.   It
is the responsibility of the <a title="host language" class="termref" href="#host-language">host language</a> to specify how invalid values should be handled at the level of that language.</p>
            <p>The following serialization parameters are defined:</p>
            <table style="border:1px solid" class="medium no-code-break">
               <caption>Serialization parameters</caption>
               <col span="1">
               <col span="1">
               <thead>
                  <tr>
                     <th style="text-align:left">Serialization parameter name</th>
                     <th style="text-align:left">Permitted values for parameter</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td><code>allow-duplicate-names</code></td>
                     <td>A boolean value, <code>true</code> or <code>false</code>.
                        This parameter indicates
                        whether a map item serialized as a JSON object using the JSON output method is 
                        allowed to contain duplicate member names.  If the value <code>false</code>
                        is specified, a serialization error [<a href="#ERRSERE0022" title="err:SERE0022">err:SERE0022</a>] may be raised under certain conditions.</td>
                  </tr>
                  <tr>
                     <td><code>byte-order-mark</code></td>
                     <td>A boolean value, 
                        <code>true</code> or <code>false</code>.
                        This parameter indicates
                        whether the serialized sequence of octets is to be preceded by
                        a Byte Order Mark  (See Section 5.1 of
                        <a href="#UNICODE-ENCODING">[Unicode Encoding]</a>).  The actual octet order used is
                        <a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a>.
                        If the encoding defines no Byte Order Mark, or if the Byte Order Mark is
                        prohibited for the specific Unicode encoding or implementation environment, then
                        this parameter is ignored.</td>
                  </tr>
                  <tr>
                     <td><code>cdata-section-elements</code></td>
                     <td>A list of expanded QNames, possibly empty.</td>
                  </tr>
                  <tr>
                     <td><code>doctype-public</code></td>
                     <td>A string of
                        <a href="https://www.w3.org/TR/REC-xml/#NT-PubidChar">PubidChar</a><sup><small>XML</small></sup> characters.
                        This parameter <span class="verb">may</span> be absent.</td>
                  </tr>
                  <tr>
                     <td><code>doctype-system</code></td>
                     <td>A string of Unicode characters
                        	that does not include both the characters <span class="unicode-codepoint">U+0027</span> (<span class="unicode-name">APOSTROPHE</span>, <code>'</code>)  and 
                        	  <span class="unicode-codepoint">U+0022</span> (<span class="unicode-name">QUOTATION MARK</span>, <code>"</code>) .
                        	This parameter <span class="verb">may</span> be absent.</td>
                  </tr>
                  <tr>
                     <td><code>encoding</code></td>
                     <td>A string of Unicode characters in the range <span class="unicode-codepoint">U+0021</span> (<span class="unicode-name">EXCLAMATION MARK</span>, <code>!</code>)  
                        through <span class="unicode-codepoint">U+007E</span> (<span class="unicode-name">TILDE</span>, <code>~</code>)  (that is,
                        printable ASCII characters); the value <span class="verb">should</span> be a charset
                        registered with the Internet Assigned Numbers Authority
                        <a href="#IANA">[IANA]</a>,  <a href="#RFC2978">[RFC2978]</a> or begin with the
                        characters <code>x-</code> or <code>X-</code>.</td>
                  </tr>
                  <tr>
                     <td><code>escape-solidus</code></td>
                     <td>A boolean value, <code>true</code> or <code>false</code>.
                        </td>
                  </tr>
                  <tr>
                     <td><code>escape-uri-attributes</code></td>
                     <td>A boolean value, <code>true</code> or <code>false</code>.
                        </td>
                  </tr>
                  <tr>
                     <td><code>html-version</code></td>
                     <td>A decimal value.  This parameter <span class="verb">may</span> be absent.</td>
                  </tr>
                  <tr>
                     <td><code>include-content-type</code></td>
                     <td>A boolean value, <code>true</code> or <code>false</code>.
                        </td>
                  </tr>
                  <tr>
                     <td><code>indent</code></td>
                     <td>A boolean value, <code>true</code> or <code>false</code>.
                        </td>
                  </tr>
                  <tr>
                     <td><code>item-separator</code></td>
                     <td>A string of Unicode characters.  This
                        parameter <span class="verb">may</span> be absent.</td>
                  </tr>
                  <tr>
                     <td><code>json-lines</code></td>
                     <td>A boolean value, <code>true</code> or <code>false</code>.
                        </td>
                  </tr>
                  <tr>
                     <td><code>json-node-output-method</code></td>
                     <td>An expanded QName 
                        with a 
                        <a title="non-null namespace URI" class="termref" href="#non-null-namespace-URI">non-null
                           namespace URI</a>,
                        or with a <a title="null namespace URI" class="termref" href="#null-namespace-URI">null 
                           namespace URI</a> and a local name equal 
                        to one of <code>xml</code>, <code>xhtml</code>,
                        <code>html</code> or 
                        <code>text</code>. 
                        If the namespace URI is non-null, 
                        the parameter
                        specifies an <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> 
                        output method.</td>
                  </tr>
                  <tr>
                     <td><code>media-type</code></td>
                     <td>A string of Unicode characters specifying the media type (MIME
                        content type) <a href="#RFC2046">[RFC2046]</a>;
                        the charset parameter of
                        the media type <span class="verb">must not</span> be specified explicitly in the value of
                        the <code>media-type</code> parameter.
                        If the destination of the serialized output
                        is annotated with a media type, this parameter <span class="verb">may</span> be used to
                        provide such an annotation.  For example, it <span class="verb">may</span> be used to set
                        the media type in an HTTP header.</td>
                  </tr>
                  <tr>
                     <td><code>method</code></td>
                     <td>An expanded QName with a 
                        <a title="non-null namespace URI" class="termref" href="#non-null-namespace-URI">non-null
                           namespace URI</a>,
                        or with a <a title="null namespace URI" class="termref" href="#null-namespace-URI">null 
                           namespace URI</a> and a local name that <span class="verb">must</span> be equal 
                        to one of <code>xml</code>, <code>xhtml</code>,
                        <code>html</code>, <code>text</code>, 
                        <code>json</code>, or <code>adaptive</code>, in which case, the output method specified <span class="verb">must</span> 
                        be used for serializing. 
                        If the namespace URI is non-null, 
                        the parameter
                        specifies an <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> 
                        output method; its behavior is not specified by this document.</td>
                  </tr>
                  <tr>
                     <td><code>normalization-form</code></td>
                     <td>One of the enumerated values <code>NFC</code>, <code>NFD</code>,
                        <code>NFKC</code>, <code>NFKD</code>, <code>fully-normalized</code>
                        or <code>none</code>, or an
                        <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> value
                        of type
                        <code>NMTOKEN</code>.</td>
                  </tr>
                  <tr>
                     <td><code>omit-xml-declaration</code></td>
                     <td>A boolean value, <code>true</code> or <code>false</code>.
                        </td>
                  </tr>
                  <tr>
                     <td><code>standalone</code></td>
                     <td>Either a boolean value, <code>true</code> or <code>false</code>, or the value
                        or <code>omit</code>.</td>
                  </tr>
                  <tr>
                     <td><code>suppress-indentation</code></td>
                     <td>A list of expanded QNames, possibly empty.</td>
                  </tr>
                  <tr>
                     <td><code>undeclare-prefixes</code></td>
                     <td>A boolean value, <code>true</code> or <code>false</code>.
                        </td>
                  </tr>
                  <tr>
                     <td><code>use-character-maps</code></td>
                     <td>A list of pairs, possibly empty, with each pair consisting of
                        a single Unicode character and a string of Unicode characters.</td>
                  </tr>
                  <tr>
                     <td><code>version</code></td>
                     <td>A string of Unicode characters.</td>
                  </tr>
               </tbody>
            </table>
            <p>In those cases where they have no important
effect on the content of the serialized result, details of the
output methods defined by this specification are left unspecified
and are regarded as <a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a>.
Whether a <a title="serializer" class="termref" href="#serializer">serializer</a> uses
apostrophes or quotation marks to delimit attribute values in the
XML output method is an example of such a detail.</p>
            <p>The detailed semantics of each parameter will be described
separately for each output method for which it is applicable. If the
semantics of a parameter are not described for an output method, then
it is not applicable to that output method.</p>
            <p>Implementations <span class="verb">may</span> define additional serialization 
parameters, and <span class="verb">may</span>
allow users to do so. For this purpose, the name of a serialization
parameter is considered to be a QName; the parameters listed above are
QNames whose
<a title="expanded QName" class="termref" href="#dt-expanded-qname">expanded-QName</a>
has a <a title="null namespace URI" class="termref" href="#null-namespace-URI">null namespace URI</a>,
while any additional serialization parameters
that are either
<a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> or
defined by the <a title="host language" class="termref" href="#host-language">host language</a>
<span class="verb">must</span> have names that are namespace-qualified.
Any such
additional serialization parameters <span class="verb">must not</span> be in the namespace
<code>https://www.w3.org/2010/xslt-xquery-serialization</code>.
A <a title="host language" class="termref" href="#host-language">host language</a> <span class="verb">may</span>
specify the means by which an implementation can define such an additional
serialization parameter, and implementations <span class="verb">may</span> provide
mechanisms by which users can define such an additional serialization
parameter.
If the serialization method is one of the six
methods <code>xml</code>, <code>html</code>, 
<code>xhtml</code>, <code>text</code>, 
<code>json</code>, or <code>adaptive</code>
 then the additional serialization parameters <span class="verb">may</span>
affect the output of the <a title="serializer" class="termref" href="#serializer">serializer</a> to the extent (but only to the extent)
that this specification leaves the output <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> or
<a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a>. For example, such parameters might control whether
namespace declarations on an element are written before or after the
attributes of the element, or they might define the number of space or tab
characters to be inserted when the <code>indent</code> parameter is set to 
<code>true</code>; but they
could not instruct the <a title="serializer" class="termref" href="#serializer">serializer</a>
to suppress the error that occurs when the
HTML output method encounters
characters
that are not permitted
(see error [<a href="#ERRSERE0014" title="err:SERE0014">err:SERE0014</a>]).</p>
            <div class="div2">
               
               <h3><a id="serparams-in-xdm-instance"></a>3.1 <a href="#serparams-in-xdm-instance" style="text-decoration: none">Setting Serialization Parameters by Means of a Parameter Document</a></h3>
               <p>A <a title="host language" class="termref" href="#host-language">host language</a> <span class="verb">may</span> provide, by reference to this
section, a mechanism by 
which the settings of serialization parameters are supplied in the form of 
an <span><code>output:serialization-parameters</code> element node.</span></p>
               <p>[<a id="dt-parameter-document" title="parameter document">Definition</a>: An 
    <code>output:serialization-parameters</code> element node
  used to hold the settings of serialization parameters is referred to as a <b>parameter document</b>].</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>The use of the word <b>document</b> does not imply that the 
  <code>output:serialization-parameters</code> element must be the outermost element of an XDM document,
although this will often be the case.</p>
               </div>
               <p>The <span><a title="parameter document" class="termref" href="#dt-parameter-document">parameter document</a></span> 
    <span class="verb">must</span> be processed as if by the
procedure described below.</p>
               <p>With the exception of the <code>use-character-maps</code> parameter,
the setting of each serialization parameter
defined in this specification
is equal to the result of
evaluating the XQuery expression</p>
               <div class="exampleInner">
                  <pre>
document { . } 
   /output:serialization-parameters
   /(validate lax { 
      output:*[local-name() eq $param-name] 
   })
   /data(@value)</pre>
               </div>
               <p>
or equivalently the XSLT instructions
</p>
               <div class="exampleInner">
                  <pre>
&lt;xsl:sequence&gt;
  &lt;xsl:variable name="validated-instance"&gt;
    &lt;xsl:document validation="lax"&gt;
      &lt;xsl:sequence select="
        self::output:serialization-parameters
        /output:*
       [local-name() eq $param-name]"/&gt;
    &lt;/xsl:document&gt;
  &lt;/xsl:variable&gt;
  &lt;xsl:sequence select="$validated-instance
                        /data(@value)"/&gt;
&lt;/xsl:sequence&gt;</pre>
               </div>
               <p>with the <span><a title="parameter document" class="termref" href="#dt-parameter-document">parameter document</a></span> as the
  <span>context value</span>, the
<code>param-name</code> variable 
<span>bound to</span> 
a value of type
<code>xs:string</code> equal to 
the local part of the name of the particular serialization parameter, and 
the other components of the dynamic context and static context as 
specified in the subsequent tables.  If in any case evaluating this 
expression would yield an error,
<a title="serialization error" class="termref" href="#serial-err">serialization error</a>
[<a href="#ERRSEPM0017" title="err:SEPM0017">err:SEPM0017</a>]
results.</p>
               <p>If the result of evaluating this expression for a particular serialization 
parameter is the empty sequence, then</p>
               <ol class="enumar">
                  <li>
                     <p>If the parameter is either <code>cdata-section-elements</code> or 
<code>suppress-indentation</code>, and the result of evaluating
the XQuery expression</p>
                     <div class="exampleInner">
                        <pre>
document { . }
/output:serialization-parameters
/(validate lax {  
   output:*[local-name() eq $param-name]
})</pre>
                     </div>
                     <p>
or equivalently the XSLT instructions
</p>
                     <div class="exampleInner">
                        <pre>
&lt;xsl:sequence&gt;
  &lt;xsl:variable name="validated-instance"&gt;
    &lt;xsl:document select="." validation="lax"&gt;
      &lt;xsl:sequence select="
        self::output:serialization-parameters
        /output:*
       [local-name() eq $param-name]"/&gt;
    &lt;/xsl:document&gt;
  &lt;/xsl:variable&gt;
  &lt;xsl:sequence select="$validated-instance"/&gt;
&lt;/xsl:sequence&gt;</pre>
                     </div>
                     <p>with the same settings of the static context and dynamic context is not an 
empty sequence, the setting of the parameter is the empty list;</p>
                  </li>
                  <li>
                     <p>otherwise, the setting of the parameter is
absent.</p>
                  </li>
               </ol>
               <p>The components of the static context used in evaluating the XQuery 
expressions or XSLT instructions
are as defined in the following table.</p>
               <table style="border:1px solid" class="medium no-code-break">
                  <caption>Settings of static context components used in extracting serialization parameter settings
                     from a parameter document</caption>
                  <thead>
                     <tr>
                        <th>Static Context Component</th>
                        <th>XQuery or XSLT</th>
                        <th>Setting</th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr>
                        <td>XPath 1.0 compatibility mode</td>
                        <td>Both</td>
                        <td>false</td>
                     </tr>
                     <tr>
                        <td rowspan="2">Statically known namespaces</td>
                        <td>XQuery</td>
                        <td>The pair
                           (output,http://www.w3.org/2010/xslt-xquery-serialization)
                           </td>
                     </tr>
                     <tr>
                        <td>XSLT</td>
                        <td>The pairs
                           (output,http://www.w3.org/2010/xslt-xquery-serialization),
                           (xsl,http://www.w3.org/1999/XSL/Transform)
                           </td>
                     </tr>
                     <tr>
                        <td>Default element/type namespace</td>
                        <td>Both</td>
                        <td>"none"</td>
                     </tr>
                     <tr>
                        <td>Default function namespace</td>
                        <td>Both</td>
                        <td>http://www.w3.org/2005/xpath-functions</td>
                     </tr>
                     <tr>
                        <td>In-scope schema types, In-scope element declarations,
                           Substitution groups, In-scope attribute declarations</td>
                        <td>Both</td>
                        <td>As defined by the schema for serialization parameters
                           (<a href="#serparams-schema"><b>B Schema for Serialization Parameters</b></a>)
                           and any additional <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
                           in-scope schema components
                           </td>
                     </tr>
                     <tr>
                        <td>In-scope variables</td>
                        <td>Both</td>
                        <td>{param-name}</td>
                     </tr>
                     <tr>
                        <td><span>Context value</span> static type</td>
                        <td>Both</td>
                        <td><code>node()</code></td>
                     </tr>
                     <tr>
                        <td>Statically known
                           function signatures</td>
                        <td>Both</td>
                        <td>{<code>fn:data($arg as item()*) as xs:anyAtomicType*</code>},
                           {<code>fn:local-name($arg as node()?) as xs:string</code>}</td>
                     </tr>
                     <tr>
                        <td>Statically known collations</td>
                        <td>Both</td>
                        <td> { (http://www.w3.org/2005/xpath-functions/collation/codepoint,
                           The Unicode codepoint collation ) }
                           </td>
                     </tr>
                     <tr>
                        <td>Default collation</td>
                        <td>Both</td>
                        <td>The Unicode codepoint collation</td>
                     </tr>
                     <tr>
                        <td>Construction mode</td>
                        <td>XQuery</td>
                        <td>strip</td>
                     </tr>
                     <tr>
                        <td>Ordering mode</td>
                        <td>XQuery</td>
                        <td>ordered</td>
                     </tr>
                     <tr>
                        <td>Default order for empty sequences</td>
                        <td>XQuery</td>
                        <td>least</td>
                     </tr>
                     <tr>
                        <td>Boundary space policy</td>
                        <td>XQuery</td>
                        <td>strip</td>
                     </tr>
                     <tr>
                        <td>Copy-namespaces mode</td>
                        <td>XQuery</td>
                        <td>(preserve,inherit)</td>
                     </tr>
                     <tr>
                        <td>Base URI</td>
                        <td>Both</td>
                        <td>Absent</td>
                     </tr>
                     <tr>
                        <td>Statically known documents</td>
                        <td>Both</td>
                        <td>None</td>
                     </tr>
                     <tr>
                        <td>Statically known collections</td>
                        <td>Both</td>
                        <td>None</td>
                     </tr>
                     <tr>
                        <td>Statically known default collection type</td>
                        <td>Both</td>
                        <td><code>node()*</code></td>
                     </tr>
                     <tr>
                        <td>Statically known decimal formats</td>
                        <td>Both</td>
                        <td>None</td>
                     </tr>
                     <tr>
                        <td>Set of named keys</td>
                        <td>XSLT</td>
                        <td>{}</td>
                     </tr>
                     <tr>
                        <td>Values of system
                           properties</td>
                        <td>XSLT</td>
                        <td>None</td>
                     </tr>
                     <tr>
                        <td>Set of available
                           instructions</td>
                        <td>XSLT</td>
                        <td>The set of all instructions defined
                           by <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a></td>
                     </tr>
                  </tbody>
               </table>
               <p>The remaining components of the dynamic context used in evaluating the 
XQuery expressions
or XSLT instructions
in the preceding table are as defined in the following 
table.</p>
               <table style="border:1px solid" class="medium no-code-break">
                  <caption>Settings of dynamic context components used in extracting serialization parameter
                     settings from a parameter document</caption>
                  <thead>
                     <tr>
                        <th>Dynamic Context Component</th>
                        <th>XQuery or XSLT</th>
                        <th>Setting</th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr>
                        <td>Context position</td>
                        <td>Both</td>
                        <td>1</td>
                     </tr>
                     <tr>
                        <td>Context size</td>
                        <td>Both</td>
                        <td>1</td>
                     </tr>
                     <tr>
                        <td>Variable values</td>
                        <td>Both</td>
                        <td>The <code>param-name</code> variable has
                           a value of type <code>xs:string</code> equal to the local part of the name
                           of the serialization parameter under consideration</td>
                     </tr>
                     <tr>
                        <td>Function implementations</td>
                        <td>Both</td>
                        <td>The implementation of <code>fn:data</code></td>
                     </tr>
                     <tr>
                        <td>Current dateTime</td>
                        <td>Both</td>
                        <td>Absent</td>
                     </tr>
                     <tr>
                        <td>Implicit timezone</td>
                        <td>Both</td>
                        <td>Absent</td>
                     </tr>
                     <tr>
                        <td>Available documents</td>
                        <td>Both</td>
                        <td>None</td>
                     </tr>
                     <tr>
                        <td>Available collections</td>
                        <td>Both</td>
                        <td>None</td>
                     </tr>
                     <tr>
                        <td>Default collection</td>
                        <td>Both</td>
                        <td>None</td>
                     </tr>
                     <tr>
                        <td>Current template rule</td>
                        <td>XSLT</td>
                        <td>Absent</td>
                     </tr>
                     <tr>
                        <td>Current mode</td>
                        <td>XSLT</td>
                        <td>The default mode</td>
                     </tr>
                     <tr>
                        <td>Current group</td>
                        <td>XSLT</td>
                        <td>Absent</td>
                     </tr>
                     <tr>
                        <td>Current grouping key</td>
                        <td>XSLT</td>
                        <td>Absent</td>
                     </tr>
                     <tr>
                        <td>Current captured substrings</td>
                        <td>XSLT</td>
                        <td>The empty sequence</td>
                     </tr>
                     <tr>
                        <td>Output state</td>
                        <td>XSLT</td>
                        <td>Temporary output state</td>
                     </tr>
                  </tbody>
               </table>
               <p>In the case of the <code>use-character-maps</code> parameter, the
XQuery
expression</p>
               <div class="exampleInner">
                  <pre>
document { . }
/output:serialization-parameters
/ ( validate lax { output:use-character-maps } )
/output:character-map[@character eq $char]
/string(@map-string)</pre>
               </div>
               <p>
or equivalently the XSLT instructions
</p>
               <div class="exampleInner">
                  <pre>
&lt;xsl:sequence&gt;
  &lt;xsl:variable name="validated-instance"&gt;
    &lt;xsl:document validation="lax"&gt;
      &lt;xsl:sequence select="
        self::output:serialization-parameters
         /output:use-character-maps"/&gt;
    &lt;/xsl:document&gt;
  &lt;/xsl:variable&gt;
  &lt;xsl:sequence select="$validated-instance                          
                        /output:character-map
                        [@character eq $char]
                        /string(@map-string)"/&gt;
&lt;/xsl:sequence&gt;</pre>
               </div>
               <p>is evaluated for each Unicode character that is permitted in an XML 
document.  The dynamic context and static context used to evaluate the 
expression are as defined above, except that the component <code>In-scope variables</code> is the set 
{<code>char</code>} and the value of the variable "<code>char</code>"
is a value of type <code>xs:string</code>
of length one whose value is the Unicode character under consideration. If 
the result of evaluating the expression is not an empty sequence, the pair 
consisting of the Unicode character and the result of evaluating the 
expression is part of the list of pairs in the value of the 
<code>use-character-maps</code> parameter.  It is a
<a title="serialization error" class="termref" href="#serial-err">serialization error</a>
[<a href="#ERRSEPM0018" title="err:SEPM0018">err:SEPM0018</a>]
if the result of evaluating this expression for any character is a 
sequence of length greater than one.</p>
               <p>Using the same settings of the components of the dynamic context and 
static context,
<a title="serialization error" class="termref" href="#serial-err">serialization error</a>
[<a href="#ERRSEPM0019" title="err:SEPM0019">err:SEPM0019</a>]
results if the result 
of evaluating the following
XQuery expression is not true
</p>
               <div class="exampleInner">
                  <pre>
(document { . })/output:serialization-parameters
   /(count(distinct-values(*/node-name(.))) eq (count(*)))</pre>
               </div>
               <p>
or equivalently if the result of evaluating the following XSLT
instructions is not true.
</p>
               <div class="exampleInner">
                  <pre>
&lt;xsl:sequence&gt;
  &lt;xsl:variable name="doc"&gt;
    &lt;xsl:document&gt;
      &lt;xsl:sequence select="."/&gt;
    &lt;/xsl:document&gt;
  &lt;/xsl:variable&gt;
  &lt;xsl:sequence
    select="$doc/output:serialization-parameters
                /(count(distinct-values(
                    */node-name(.))) 
                eq (count(*)))"/&gt;
&lt;/xsl:sequence&gt;</pre>
               </div>
               <p>The result of evaluating either
  will be false if the <span><a title="parameter document" class="termref" href="#dt-parameter-document">parameter document</a></span> 
supplies a value
for any particular serialization parameter
more than once, or will be the
empty sequence if the <span><a title="parameter document" class="termref" href="#dt-parameter-document">parameter document</a></span> 
 <span>
is not an element node whose local name is
<code>serialization-parameters</code> and whose namespace URI is
<code>http://www.w3.org/2010/xslt-xquery-serialization</code>.</span></p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>A <a title="serializer" class="termref" href="#serializer">serializer</a> or implementation of a 
  <a title="host language" class="termref" href="#host-language">host language</a> does not need to 
be accompanied by an XQuery processor nor by a general-purpose schema 
validator in order to meet the requirements of this section.  It merely 
needs to be capable of extracting values from an XDM instance that 
conforms to the schema for serialization parameters, while checking that 
the constraints implied by the schema and additional constraints implied 
by the XQuery validate expression or explicitly stated in this section are 
satisfied.</p>
               </div>
               <p>The <a title="host language" class="termref" href="#host-language">host language</a> <span class="verb">may</span> provide additional mechanisms for overriding the 
values of any serialization parameters specified through the mechanism 
defined in this section, as well as additional mechanisms for specifying 
the values of any serialization parameters whose values
are absent
after applying the mechanism defined in this section.</p>
               <p>If the <span><a title="parameter document" class="termref" href="#dt-parameter-document">parameter document</a></span> 
    contains elements or attributes
that are in a namespace other than 
<code>http://www.w3.org/2010/xslt-xquery-serialization</code>, the
implementation <span class="verb">may</span> interpret them to specify the
values of <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> 
serialization parameters in an
<a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> manner.</p>
               <div class="example">
                  <p>The following XML document, if 
    <span>parsed as a <a title="parameter document" class="termref" href="#dt-parameter-document">parameter document</a></span> 
and processed using the mechanism described in this section,
would specify the settings of the <code>method</code>, <code>version</code>
and <code>indent</code> serialization parameters with the values
<code>xml</code>, <code>1.0</code> and <code>true</code>, respectively.
</p>
                  <div class="exampleInner">
                     <pre>
&lt;output:serialization-parameters 
    xmlns:output 
    = "http://www.w3.org/2010/xslt-xquery-serialization"&gt;
  &lt;output:method value="xml"/&gt;
  &lt;output:version value="1.0"/&gt;
  &lt;output:indent value="yes"/&gt;
&lt;/output:serialization-parameters&gt;</pre>
                  </div>
                  <p>The following document would specify the value of the
<code>cdata-section-elements</code> serialization parameter with value equal to the
pair of expanded QNames
(<code>http://example.org/book/chapter</code>,<code>heading</code>) and
(<code>http://example.org/book</code>,<code>footnote</code>)</p>
                  <div class="exampleInner">
                     <pre>
&lt;output:serialization-parameters
    xmlns:output
    = "http://www.w3.org/2010/xslt-xquery-serialization"
    xmlns:book="http://example.org/book"
    xmlns="http://example.org/book/chapter"&gt;
  &lt;output:cdata-section-elements value="heading book:footnote"/&gt;
&lt;/output:serialization-parameters&gt;</pre>
                  </div>
                  <p>The following document would specify the value of the <code>method</code>
serialization parameter with the value <code>html</code>.</p>
                  <p>Notice that in this example, the default namespace declaration
in scope has no effect on the interpretation of the setting of the
<code>method</code> parameter.</p>
                  <div class="exampleInner">
                     <pre>
&lt;output:serialization-parameters
    xmlns:output
    = "http://www.w3.org/2010/xslt-xquery-serialization"
    xmlns="http://example.org/ext"&gt;
  &lt;output:method value="html"/&gt;
&lt;/output:serialization-parameters&gt;</pre>
                  </div>
                  <p>The following document would specify the value of the <code>method</code>
serialization parameter with value equal to the expanded QName
(<code>http://example.org/ext</code>, <code>jsp</code>), and the
<code>use-character-maps</code> parameter with value equal to the list of
pairs, <code>(«, &lt;%), (», %&gt;)</code>.</p>
                  <div class="exampleInner">
                     <pre>
&lt;output:serialization-parameters
    xmlns:output
    = "http://www.w3.org/2010/xslt-xquery-serialization"
    xmlns:ext="http://example.org/ext"&gt;
  &lt;output:method value="ext:jsp"/&gt;
  &lt;output:use-character-maps&gt;
    &lt;output:character-map character="&amp;#xAB;" map-string="&amp;lt;%"/&gt;
    &lt;output:character-map character="&amp;#xBB;" map-string="%&amp;gt;"/&gt;
  &lt;/output:use-character-maps&gt;
&lt;/output:serialization-parameters&gt;</pre>
                  </div>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="serphases"></a>4 <a href="#serphases" style="text-decoration: none">Phases of Serialization</a></h2>
            <p>For the XML, HTML, XHTML and Text output methods, 
serialization
comprises five phases of processing 
(preceded by the sequence normalization process 
described in <a href="#serdm"><b>2 Sequence Normalization</b></a>).


For the JSON and Adaptive
output methods, serialization is described in <a href="#json-output"><b>9 JSON Output Method</b></a> and 
  <a href="#adaptive-output"><b>10 Adaptive Output Method</b></a> respectively.


</p>
            <p>For an <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
output method, any of these phases <span class="verb">may</span> be skipped
or <span class="verb">may</span> be performed in a different order than is
specified here.  For the output methods defined in this specification,
these phases are carried out sequentially as follows:</p>
            <ol class="enumar">
               <li>
                  <p>A <code>meta</code> element is added to the sequence, 
<span>possibly replacing existing <code>meta</code> elements</span>, as 
controlled by the <code>include-content-type</code> parameter 
for the XHTML and HTML output methods. This step is skipped for the 
other output methods defined by this 
specification.
</p>
               </li>
               <li>
                  <p><em>Markup generation</em> produces the character representation of
those parts of the serialized result that describe the structure of the 
sequence.  In the cases of the XML, HTML and XHTML
output methods, this phase produces the character representations 
of the following:</p>
                  <ul>
                     <li>
                        <p>the document type declaration;
</p>
                     </li>
                     <li>
                        <p>start tags and end tags (except for
attribute values, whose representation is produced by the character
expansion phase);
</p>
                     </li>
                     <li>
                        <p>processing instructions; and</p>
                     </li>
                     <li>
                        <p>comments.</p>
                     </li>
                  </ul>
                  <p>In the cases of the XML and XHTML output methods,
this phase also produces the following:</p>
                  <ul>
                     <li>
                        <p>the XML or text declaration; and</p>
                     </li>
                     <li>
                        <p>empty element tags (except for the attribute
values);</p>
                     </li>
                  </ul>
                  <p>
In the case of the text output method,
this phase replaces the single
document node produced by <a title="sequence normalization" class="termref" href="#sequence-normalization">sequence
normalization</a> with a new document node that has exactly one child,
which is a text node.  The string value of the new text node is the string value
of the document node that was produced by sequence normalization.
</p>
               </li>
               <li>
                  <p><em>Character expansion</em> 
is concerned with the representation of characters appearing in text 
and attribute nodes in the sequence. 
For each text and attribute node, 
the following rules are applied in sequence. 
</p>
                  <ol class="enumla">
                     <li>
                        <p>
If the node is an attribute that is 
a <a title="URI attribute values" class="termref" href="#uri-attribute-values">URI attribute value</a> 
and the <code>escape-uri-attributes</code> parameter is set to 
require escaping of URI attributes, 
apply <a title="URI Escaping" class="termref" href="#uri-escaping">URI escaping</a> as defined below, 
and skip rules b-e. Otherwise, continue with rule b.</p>
                        <p>[<a id="uri-escaping" title="URI Escaping">Definition</a>: <b>URI escaping</b> consists of the following three steps applied in sequence to the content of 
<a title="URI attribute values" class="termref" href="#uri-attribute-values">URI attribute values</a>:]
</p>
                        <ol class="enumlr">
                           <li>
                              <p>normalize to NFC using the method defined in <a href="https://qt4cg.org/specifications/xpath-functions-40/#func-normalize-unicode">Section 5.4.9 fn:normalize-unicode</a><sup><small>FO</small></sup></p>
                           </li>
                           <li>
                              <p>percent-encode any special characters in the URI using the method defined in <a href="https://qt4cg.org/specifications/xpath-functions-40/#func-escape-html-uri">Section 7.5 fn:escape-html-uri</a><sup><small>FO</small></sup></p>
                           </li>
                           <li>
                              <p>escape according to

the rules of the XML or HTML output
method, whichever is applicable, any characters that require

escaping, and any characters that cannot be represented in the
selected encoding. 
For example, replace <code>&lt;</code> with <code>&amp;lt;</code>
(See also section <a href="#HTML_CHARDATA"><b>7.3 Writing Character Data</b></a>).
</p>
                           </li>
                        </ol>
                        <p>
[<a id="uri-attribute-values" title="URI attribute values">Definition</a>:  The values of attributes listed in 
<a href="#list-of-uri-attributes"><b>D List of URI Attributes</b></a> are <b>URI attribute values</b>. 
Attributes are not considered to be URI attributes simply because they are namespace declaration attributes or have the type annotation <code>xs:anyURI</code>.]</p>
                     </li>
                     <li>
                        <p>
If the node is a text node whose parent element is selected by the rules of the 
<code>cdata-section-elements</code> parameter for the applicable output method, 
create CDATA sections as described below, and skip rules c-e. Otherwise, continue with rule c.
</p>
                        <p>Apply the following two processes in sequence to create CDATA sections</p>
                        <ol class="enumlr">
                           <li>
                              <p><a title="Unicode Normalization" class="termref" href="#unicode-normalization">Unicode Normalization</a> if requested by the <code>normalization-form</code> parameter.</p>
                           </li>
                           <li>
                              <p>The application of changes as detailed in the description of the <code>cdata-section-elements</code> parameter for the applicable output method.</p>
                           </li>
                        </ol>
                     </li>
                     <li>
                        <p>Apply character mapping as determined by the 
<code>use-character-maps</code> parameter for the applicable output method.  
For characters that were substituted by this process, skip rules d and e. 
For the remaining characters that were not modified by character mapping, continue with rule d. 
</p>
                     </li>
                     <li>
                        <p>Apply <a title="Unicode Normalization" class="termref" href="#unicode-normalization">Unicode Normalization</a> if requested by the <code>normalization-form</code> parameter.  </p>
                        <p>
[<a id="unicode-normalization" title="Unicode Normalization">Definition</a>: <b>Unicode Normalization</b>
is the process of removing alternative representations of equivalent sequences from textual data,
to convert the data into a form that can be binary-compared for equivalence, as specified in 
<a href="#UNICODE-NORMALIZATION-FORM">[UAX #15: Unicode Normalization Forms]</a>.   
For specific recommendations for character normalization on the World Wide Web, 
see <a href="#charmod-norm">[Character Model for the World Wide Web 1.0: Normalization]</a>.]</p>
                        <p>
The meanings associated with the possible values of the <code>normalization-form</code> parameter 
are defined in section <a href="#XML_NORMALIZATION-FORM"><b>5.1.8 XML Output Method: the normalization-form Parameter</b></a>. </p>
                        <p>Continue with step e.
</p>
                     </li>
                     <li>
                        <p>Escape according to
the rules of the XML or HTML output
method, whichever is applicable,

any characters (such as <code>&lt;</code> and <code>&amp;</code>) where XML or HTML requires 
escaping, 
and any characters that cannot be represented in the selected encoding. 
For example, replace <code>&lt;</code> with <code>&amp;lt;</code>. 
(See also section <a href="#HTML_CHARDATA"><b>7.3 Writing Character Data</b></a>).
For characters such as <code>&gt;</code> where XML defines a built-in entity but does not 
require its use in all circumstances, it is implementation-dependent whether the character 
is escaped.
</p>
                     </li>
                  </ol>
               </li>
               <li>
                  <p><em>Indentation</em>, as controlled by
the <code>indent</code> parameter and the
<code>suppress-indentation</code> parameter, <span class="verb">may</span>
add or remove
whitespace according to the rules defined by the applicable output method.</p>
               </li>
               <li>
                  <p><em>Encoding</em>, as controlled by the
<code>encoding</code> parameter, converts the character sequence
produced by the previous phases into an octet stream.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Serialization is defined only in terms of encoding the result as a stream of octets.  
However, a <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">may</span> 
provide an option that allows the encoding phase to be skipped, so
that the result of serialization can be encoded in a way required by a particular destination (e.g., a Java StringBuffer).
The effect of any such option is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>, 
and a <a title="serializer" class="termref" href="#serializer">serializer</a> is not required to support such an option.
</p>
                  </div>
               </li>
            </ol>
         </div>
         <div class="div1">
            
            <h2><a id="xml-output"></a>5 <a href="#xml-output" style="text-decoration: none">XML Output Method</a></h2>
            <p>The XML output method serializes the normalized sequence as an XML entity that
<span class="verb">must</span> satisfy the rules for either a well-formed XML document entity, a well-formed XML
external general parsed entity, or both.
A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0003" title="err:SERE0003">err:SERE0003</a>] results if the
<a title="serializer" class="termref" href="#serializer">serializer</a>
is unable to satisfy those rules,
except for content modified by the character expansion phase of serialization,
as described in <a href="#serphases"><b>4 Phases of Serialization</b></a>.
The effects of the character expansion phase could result in the serialized output 
being not well-formed, but will not result in a <a title="serialization error" class="termref" href="#serial-err">serialization error</a>.  
If a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> results, the 
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> raise the error.</p>
            <p>If the document node of the
normalized sequence has a single element
node child and no text node children,
then the serialized output
is a well-formed XML document entity, and the serialized output
<span class="verb">must</span> conform to the
appropriate version of the
XML Namespaces Recommendation <a href="#xml-names">[XML Names]</a>
or <a href="#xml-names11">[XML Names 1.1]</a>.
If the normalized sequence does not take this form, then
the serialized output is a well-formed XML external general parsed entity,
which, when referenced within a trivial XML document wrapper
like this:</p>
            <div class="exampleInner">
               <pre>
&lt;?xml version="<em>version</em>"?&gt;
&lt;!DOCTYPE doc [
&lt;!ENTITY e SYSTEM "<em>entity-URI</em>"&gt;
]&gt;
&lt;doc&gt;&amp;e;&lt;/doc&gt;</pre>
            </div>
            <p>where <code>entity-URI</code> is a URI for the entity,
and the value of the <code>version</code>
pseudo-attribute is the value of the <code>version</code>
parameter, produces a
document which <span class="verb">must</span> itself be a
well-formed XML document conforming
to the
corresponding version of the
XML Namespaces Recommendation <a href="#xml-names">[XML Names]</a>
or <a href="#xml-names11">[XML Names 1.1]</a>.</p>
            <p>[<a id="reconstructed-tree" title="reconstructed tree">Definition</a>: A <b>reconstructed tree</b> may be
constructed by parsing the XML document and converting it into an
document node as specified in 
<a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.]
The result of serialization <span class="verb">must</span> be such that the <a title="reconstructed tree" class="termref" href="#reconstructed-tree">reconstructed tree</a>
is the same as the <a title="result tree" class="termref" href="#result-tree">result tree</a> except for the following permitted differences:</p>
            <ul>
               <li>
                  <p>If the document was produced by adding a document wrapper, as
described above, then it will contain an extra <code>doc</code>
element as the document element.</p>
               </li>
               <li>
                  <p>The order of attribute and namespace nodes in the two trees <span class="verb">may</span> be
different.</p>
               </li>
               <li>
                  <p>
The following properties of corresponding nodes
in the two trees <span class="verb">may</span> be different:</p>
                  <ul>
                     <li>
                        <p>the base-uri property of document nodes and element nodes;</p>
                     </li>
                     <li>
                        <p>the document-uri and unparsed-entities properties of document
nodes;</p>
                     </li>
                     <li>
                        <p>the type-name and typed-value properties of element and attribute
nodes;</p>
                     </li>
                     <li>
                        <p>the nilled property of element nodes;</p>
                     </li>
                     <li>
                        <p>the content property of text nodes, due to the effect of the
<code>indent</code> and <code>use-character-maps</code>
parameters.</p>
                     </li>
                  </ul>
               </li>
               <li>
                  <p>The <a title="reconstructed tree" class="termref" href="#reconstructed-tree">reconstructed tree</a> <span class="verb">may</span> contain additional attributes and text nodes resulting from the
expansion of default and fixed values in its DTD or schema;
also, in the presence of a DTD, non-CDATA attributes may lose whitespace
characters as a result of attribute value normalization.</p>
               </li>
               <li>
                  <p>The type annotations of the nodes in the two trees <span class="verb">may</span> be different. 
Type annotations in a <a title="result tree" class="termref" href="#result-tree">result tree</a> are discarded when the tree is serialized. 
Any new type annotations obtained by parsing the document will depend on whether the serialized XML document is assessed against a schema, 
and this <span class="verb">may</span> result in type annotations that are different from
those in the original <a title="result tree" class="termref" href="#result-tree">result tree</a>.
</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>In order to influence the type annotations in the
tree that would result from processing a serialized XML document,
the author of the XSLT stylesheet, XQuery expression or other process
might wish to create the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> so that it makes use of mechanisms provided by
<a href="#xmlschema-1">[XML Schema]</a>, such as <code>xsi:type</code> and
<code>xsi:schemaLocation</code> attributes.  The serialization process
will not automatically create such attributes in the serialized
document if those attributes were not part of the <a title="result tree" class="termref" href="#result-tree">result tree</a> that is
to be serialized.</p>
                     <p>Similarly, it is possible that an element node in
  the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> has the <code>nilled</code>
property with the value <code>true</code>, but no <code>xsi:nil</code>
attribute.  The serialization process will not create such an attribute
in the serialized document simply to reflect the value of the property.
The value of the <code>nilled</code> property has no direct effect on
the serialized result.
</p>
                  </div>
               </li>
               <li>
                  <p>Additional namespace nodes <span class="verb">may</span> be present
in the <a title="reconstructed tree" class="termref" href="#reconstructed-tree">reconstructed tree</a> if the serialization process
did not undeclare one or more namespaces,
as described in <a href="#xml-undeclare-NS"><b>5.1.7 XML Output Method: the undeclare-prefixes Parameter</b></a>,
  and the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> contained an element node
with a namespace node that declared some prefix, but a child element
of that node did not have any namespace node that declared the same prefix.</p>
                  <p>
The <a title="result tree" class="termref" href="#result-tree">result tree</a> <span class="verb">may</span> contain namespace nodes
that are not present in the <a title="reconstructed tree" class="termref" href="#reconstructed-tree">reconstructed tree</a>, as the process of creating an instance
of the data model <span class="verb">may</span> ignore namespace declarations in some circumstances.
See <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#const-infoset-element">Section 6.6.2.3 Construction from an Infoset</a><sup><small>DM</small></sup> and
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#const-psvi-element">Section 6.6.2.4 Construction from a PSVI</a><sup><small>DM</small></sup> of <a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>
for additional information.
</p>
               </li>
               <li>
                  <p>If the <code>indent</code> parameter has
the value <code>true</code>,
</p>
                  <ul>
                     <li>
                        <p>additional text nodes consisting of
whitespace characters <span class="verb">may</span> be present in the <a title="reconstructed tree" class="termref" href="#reconstructed-tree">reconstructed tree</a>; and</p>
                     </li>
                     <li>
                        <p>text nodes in the <a title="result tree" class="termref" href="#result-tree">result tree</a> that contained only whitespace
characters <span class="verb">may</span> correspond to text nodes in the <a title="reconstructed tree" class="termref" href="#reconstructed-tree">reconstructed tree</a> that contain additional
whitespace characters that were not present in the <a title="result tree" class="termref" href="#result-tree">result tree</a></p>
                     </li>
                  </ul>
                  <p>See <a href="#xml-indent"><b>5.1.3 XML Output Method: the indent and suppress-indentation Parameters</b></a> for more information on the
<code>indent</code> parameter.</p>
               </li>
               <li>
                  <p>Additional nodes <span class="verb">may</span> be present in the
<a title="reconstructed tree" class="termref" href="#reconstructed-tree">reconstructed tree</a> due to the effect of character mapping in the character expansion phase,
and the values of attribute nodes and text nodes in the
<a title="reconstructed tree" class="termref" href="#reconstructed-tree">reconstructed tree</a> <span class="verb">may</span> be different from those in the <a title="result tree" class="termref" href="#result-tree">result tree</a>, due to
the effects of URI expansion, character mapping
and <a title="Unicode Normalization" class="termref" href="#unicode-normalization">Unicode Normalization</a> in
the character expansion phase of serialization.
</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The <code>use-character-maps</code> parameter can
cause arbitrary characters to be inserted into the serialized XML document
in an unescaped form, including characters that would be considered to be
part of XML markup.  Such characters could result in arbitrary new element
nodes, attribute nodes, and so on, in the <a title="reconstructed tree" class="termref" href="#reconstructed-tree">reconstructed tree</a> that results from
processing the serialized XML document.</p>
                  </div>
               </li>
            </ul>
            <p>A consequence of this rule is that certain characters
<span class="verb">must</span> be output as character
references, to ensure that they survive
the round trip through serialization and parsing.
Specifically:</p>
            <ul>
               <li>
                  <p>In text nodes, the characters <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , <span class="unicode-codepoint">U+0085</span> (<span class="unicode-name">NEXT LINE, NEL</span>) , and <span class="unicode-codepoint">U+2028</span> (<span class="unicode-name">LINE SEPARATOR</span>) 
      <span class="verb">must</span> be output respectively as
      "<code>&amp;#xD;</code>", "<code>&amp;#x85;</code>", and
      "<code>&amp;#x2028;</code>", or their equivalents</p>
               </li>
               <li>
                  <p>In attribute nodes, the characters 
      <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) , <span class="unicode-codepoint">U+0009</span> (<span class="unicode-name">TAB</span>) , 
      <span class="unicode-codepoint">U+0085</span> (<span class="unicode-name">NEXT LINE, NEL</span>) , and <span class="unicode-codepoint">U+2028</span> (<span class="unicode-name">LINE SEPARATOR</span>) 
      <span class="verb">must</span> be output respectively
      as "<code>&amp;#xD;</code>", "<code>&amp;#xA;</code>", "<code>&amp;#x9;</code>",
      "<code>&amp;#x85;</code>", and "<code>&amp;#x2028;</code>", or their equivalents.</p>
               </li>
               <li>
                  <p>In both text nodes and attribute nodes, control characters
      <span class="unicode-codepoint">U+0001</span> (<span class="unicode-name">SOH</span>)  through <span class="unicode-codepoint">U+001F</span> (<span class="unicode-name">IS1</span>)  and <span class="unicode-codepoint">U+007F</span> (<span class="unicode-name">DELETE</span>)  through 
      <span class="unicode-codepoint">U+009F</span> (<span class="unicode-name">APC</span>)  (except <span class="unicode-codepoint">U+0009</span> (<span class="unicode-name">TAB</span>) , 
      <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) , and <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , and <span class="unicode-codepoint">U+0085</span> (<span class="unicode-name">NEXT LINE, NEL</span>) ) <span class="verb">must</span> be
      output as character references.</p>
               </li>
            </ul>
            <p>For example, an attribute with the value "x" followed by "y"
separated by a newline will result in the output
<code>"x&amp;#xA;y"</code> (or with any equivalent character
reference). The XML output cannot be "x" followed by a literal newline
followed by a "y" because after parsing, the attribute value would be
<code>"x y"</code> as a consequence of the XML attribute normalization
rules.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>XML 1.0 did not permit
  an XML processor to normalize <span class="unicode-codepoint">U+0085</span> (<span class="unicode-name">NEXT LINE, NEL</span>)  or <span class="unicode-codepoint">U+2028</span> (<span class="unicode-name">LINE SEPARATOR</span>)  characters 
  to a <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>)  character.  However, if
a document entity that specifies version 1.1 invokes an external general
parsed entity with no text declaration or a text declaration that specifies
version 1.0, the external parsed entity is processed according to the rules
of XML 1.1.  For this reason, <span class="unicode-codepoint">U+0085</span> (<span class="unicode-name">NEXT LINE, NEL</span>)  and <span class="unicode-codepoint">U+2028</span> (<span class="unicode-name">LINE SEPARATOR</span>)  characters in text and
attribute nodes <span class="verb">must</span> always be escaped using character references,
regardless of the value of the <code>version</code> parameter.
</p>
               <p>
  XML 1.0 permitted control characters in the range <span class="unicode-codepoint">U+007F</span> (<span class="unicode-name">DELETE</span>)  through 
  <span class="unicode-codepoint">U+009F</span> (<span class="unicode-name">APC</span>) 
to appear as literal characters in an XML document, but XML 1.1
requires such characters, other than <span class="unicode-codepoint">U+0085</span> (<span class="unicode-name">NEXT LINE, NEL</span>) ,
to be escaped as character references.  An
external general parsed entity with no text declaration or a text
declaration that specifies a version pseudo-attribute with value
<code>1.0</code> that is invoked by an XML 1.1 document entity
<span class="verb">must</span>
follow the rules of XML 1.1.  Therefore, the non-whitespace control
characters in the ranges <span class="unicode-codepoint">U+0001</span> (<span class="unicode-name">SOH</span>)  through <span class="unicode-codepoint">U+001F</span> (<span class="unicode-name">IS1</span>)  and <span class="unicode-codepoint">U+007F</span> (<span class="unicode-name">DELETE</span>)  through 
  <span class="unicode-codepoint">U+009F</span> (<span class="unicode-name">APC</span>) 
<span class="verb">must</span>
always be escaped, regardless of the value of the <code>version</code> parameter.
</p>
            </div>
            <p>It is a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSEPM0004" title="err:SEPM0004">err:SEPM0004</a>] 
  to specify the <code>doctype-system</code> parameter, or to specify the <code>standalone</code> parameter 
  with a value other than <code>omit</code>, if the
  <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> contains text nodes or multiple element nodes as children
of the root node. The
<a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> either raise the error, or recover
by ignoring the request to output a document type declaration or
<code>standalone</code> parameter.</p>
            <div class="div2">
               
               <h3><a id="XML_PARAMS"></a>5.1 <a href="#XML_PARAMS" style="text-decoration: none">The Influence of Serialization Parameters upon the XML Output Method</a></h3>
               <p>The serialization parameters that affect the XML output method are listed
    in the following subsections.</p>
               <p>Serialization parameters other than those listed are not applicable to this output
    method.  It is the responsibility of the
    <a title="host language" class="termref" href="#host-language">host language</a> to specify
    whether an error occurs if such a parameter is specified in combination
    with the XML output method, or whether the parameter is ignored, or whether
    it is validated and then ignored.</p>
               <div class="div3">
                  
                  <h4><a id="XML_VERSION"></a>5.1.1 <a href="#XML_VERSION" style="text-decoration: none">XML Output Method: the <code>version</code> Parameter</a></h4>
                  <p>The 
  <code>version</code> parameter specifies the version of XML
and the version of Namespaces in XML to
be used <span>in the serialized output</span>.   
The version output in the XML declaration (if an XML declaration is not omitted) 
<span class="verb">must</span> correspond to the version of XML used by
the <a title="serializer" class="termref" href="#serializer">serializer</a>. The value of the
<code>version</code> parameter 
<span class="verb">must</span> match the
<a href="https://www.w3.org/TR/REC-xml/#NT-VersionNum">VersionNum</a><sup><small>XML</small></sup>
production of the XML Recommendation <a href="#xml">[XML10]</a> or <a href="#xml11">[XML11]</a>.
A serialization error [<a href="#ERRSESU0013" title="err:SESU0013">err:SESU0013</a>] results if the value of the <code>version</code> parameter specifies 
a version of XML that is not supported by the <a title="serializer" class="termref" href="#serializer">serializer</a>; 
the <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span>
raise the error.</p>
                  <p>This document provides the normative
definition of serialization for the XML output method if the
<code>version</code> parameter has either the value <code>1.0</code> or
<code>1.1</code>.  For
any other value of <code>version</code> parameter, the behavior is
<a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>. 
In that case the <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
behavior <span class="verb">may</span> supersede all other requirements of
this recommendation.</p>
                  <p>If the serialized result would contain an
<a href="https://www.w3.org/TR/REC-xml-names/#NT-NCName">NCName</a><sup><small>Names</small></sup> that contains a character that is not
permitted by the version of Namespaces in XML specified by the
<code>version</code> parameter, a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0005" title="err:SERE0005">err:SERE0005</a>] results.
The <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> raise the error.</p>
                  <p>If the serialized result would contain a character
that is not permitted by the version of XML specified by the
<code>version</code> parameter, a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0006" title="err:SERE0006">err:SERE0006</a>] results.  The
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> raise the error.</p>
                  <div class="example">
                     <p>For example, if the <code>version</code>
  parameter has the value <code>1.0</code>, and the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>
contains a non-whitespace control character in the range <span class="unicode-codepoint">U+0001</span> (<span class="unicode-name">SOH</span>)  through
<span class="unicode-codepoint">U+001F</span> (<span class="unicode-name">IS1</span>) , a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0006" title="err:SERE0006">err:SERE0006</a>] results.
If the <code>version</code> parameter has the value <code>1.1</code>
  and a comment node in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> contains a
  non-whitespace control character in the range <span class="unicode-codepoint">U+0001</span> (<span class="unicode-name">SOH</span>)  through
  <span class="unicode-codepoint">U+001F</span> (<span class="unicode-name">IS1</span>)  or a
  control character other than <span class="unicode-codepoint">U+0085</span> (<span class="unicode-name">NEXT LINE, NEL</span>)  in the range <span class="unicode-codepoint">U+007F</span> (<span class="unicode-name">DELETE</span>)  through
  <span class="unicode-codepoint">U+009F</span> (<span class="unicode-name">APC</span>) , a
<a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0006" title="err:SERE0006">err:SERE0006</a>] results.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="XML_ENCODING"></a>5.1.2 <a href="#XML_ENCODING" style="text-decoration: none">XML Output Method: the <code>encoding</code> Parameter</a></h4>
                  <p>The <code>encoding</code> parameter specifies the
encoding to be used <span>in the serialized output</span>.
<a title="serializer" class="termref" href="#serializer">Serializers</a>
are <span class="verb">required</span>  to support values of <code>UTF-8</code> and
<code>UTF-16</code>. A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSESU0007" title="err:SESU0007">err:SESU0007</a>] occurs if an output
encoding other than <code>UTF-8</code> or <code>UTF-16</code> is
requested and the <a title="serializer" class="termref" href="#serializer">serializer</a>
does not support that encoding. The <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> raise the error, or recover by using
<code>UTF-8</code> or <code>UTF-16</code> instead.
The <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must not</span> use an encoding whose name does not match the
<a href="https://www.w3.org/TR/REC-xml/#NT-EncName">EncName</a><sup><small>XML</small></sup>
production of the XML Recommendation <a href="#xml">[XML10]</a>.
</p>
                  <p>When outputting a newline character in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>, the
<a title="serializer" class="termref" href="#serializer">serializer</a> is free to represent it using any character sequence
that will be normalized to a newline character by an XML parser,
unless a specific mapping for the newline character is
provided in a character map (see <a href="#character-maps"><b>11 Character Maps</b></a>).</p>
                  <p>When outputting any other character that is defined in the
selected encoding, the character 
<span class="verb">must</span> be output
using the correct representation of that character in the selected encoding.</p>
                  <p>It is possible that the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> will contain a character that
cannot be represented in the encoding that the <a title="serializer" class="termref" href="#serializer">serializer</a>
is using for output. In this case, if the character occurs in a context where XML
recognizes character references (that is, in the value of an attribute
node or text node), then the character <span class="verb">must</span> be output as a character
reference. A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0008" title="err:SERE0008">err:SERE0008</a>] occurs if such a character appears in
a context where character references are not allowed (for example, if
the character occurs in the name of an element). The <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> raise the error.
</p>
                  <div class="example">
                     <p>For example,
if a text node contains the character <span class="unicode-codepoint">U+00E9</span> (<span class="unicode-name">LATIN SMALL LETTER E WITH ACUTE</span>, <code>é</code>) ,
and the value of the <code>encoding</code> parameter is
<code>US-ASCII</code>, the character <span class="verb">must</span> be serialized as a character
reference.  If a comment node contains the same character, a
<a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0008" title="err:SERE0008">err:SERE0008</a>] results.
</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="xml-indent"></a>5.1.3 <a href="#xml-indent" style="text-decoration: none">XML Output Method: the <code>indent</code> and <code>suppress-indentation</code> Parameters</a></h4>
                  <p>The <code>indent</code> and
<code>suppress-indentation</code> parameters control whether the
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">may</span> adjust the whitespace
in the serialized result so that a person will find it easier to read.
If the <code>indent</code> parameter has 
the value <code>true</code>,
the <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">may</span> output whitespace characters in
  addition to the whitespace characters in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>.  
  It <span class="verb">may</span> also elide from the output whitespace
  characters that occurred in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> or replace
such whitespace characters with other whitespace characters.</p>
                  <p>
[<a id="content" title="content">Definition</a>: The term <b>content</b> has the
same meaning as the term <a href="https://www.w3.org/TR/REC-xml/#dt-content">Content</a><sup><small>XML</small></sup>
defined in <a href="https://www.w3.org/TR/REC-xml/#sec-starttags">Section 
3.1 Start-Tags, End-Tags, and Empty-Element Tags</a><sup><small>XML</small></sup> of
<a href="#xml">[XML10]</a>.]
[<a id="immediate-content" title="immediate content">Definition</a>: 
The <b>immediate content</b> of an element is the part of the
<a title="content" class="termref" href="#content">content</a> of the element that is not
also in the <a title="content" class="termref" href="#content">content</a> of a child element
of that element.]
</p>
                  <p>If the
<code>indent</code> parameter has the value <code>false</code>, the
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must not</span> add, elide
or replace whitespace characters in the output. If the <code>indent</code> parameter has 
the value <code>true</code>,
the <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span>
use an algorithm for dealing with whitespace characters that satisfies
all of the following constraints.


If more than one constraint applies,
the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> apply the most restrictive constraint.  That is, if
any applicable constraint indicates that whitespace 
<span class="verb">must not</span> be added, elided or replaced, that
constraint prevails; if an applicable constraint indicates that
whitespace <span class="verb">should not</span> be added, elided or replaced,
while all other applicable constraints indicate that whitespace
<span class="verb">may</span>
be added, elided or replaced, whitespace <span class="verb">should not</span>
be added, elided or replaced.


</p>
                  <ul>
                     <li>
                        <p>Whitespace characters
<span class="verb">may</span>
be added adjacent to a text node
only
if the text node contains only whitespace characters.  Whitespace characters in
such a text node <span class="verb">may</span> also be elided or replaced.
For example, a tab <span class="verb">may</span> be inserted as a
replacement for existing spaces.</p>
                     </li>
                     <li>
                        <p>Whitespace characters
<span class="verb">may</span> be added, elided or replaced in the
<a title="immediate content" class="termref" href="#immediate-content">immediate content</a> of an
element whose type annotation is <code>xs:untyped</code> or
<code>xs:anyType</code> and that has element node children, in the
<a title="immediate content" class="termref" href="#immediate-content">immediate content</a> of an element whose content model
is element only, or outside
the <a title="content" class="termref" href="#content">content</a> of any element.</p>
                     </li>
                     <li>
                        <p>Whitespace characters
<span class="verb">must not</span> be added,
elided or replaced
in the <a title="immediate content" class="termref" href="#immediate-content">immediate content</a> of an element
whose content model is 
known to be simple or
empty.</p>
                     </li>
                     <li>
                        <p>Whitespace characters 
<span class="verb">should not</span> be added,
elided or replaced
in places where the characters would
constitute significant whitespace, for example, in the
<a title="immediate content" class="termref" href="#immediate-content">immediate content</a> of an element
that is annotated with a type
other than <code>xs:untyped</code> or <code>xs:anyType</code>, and
whose content model is known to be mixed.</p>
                     </li>
                     <li>
                        <p>Whitespace characters
<span class="verb">must not</span> be added,
elided or replaced
in the <a title="content" class="termref" href="#content">content</a>
of an element
whose expanded QName is a member of the list of expanded QNames in the
value of the <code>suppress-indentation</code> parameter.</p>
                     </li>
                     <li>
                        <p>Whitespace characters <span class="verb">must not</span> be
added, elided or replaced
in a part of the result document that is controlled by an
<code>xml:space</code> attribute with value <code>preserve</code>.
(See <a href="#xml">[XML10]</a> for more information about the
<code>xml:space</code> attribute.)
</p>
                     </li>
                  </ul>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The effect of these rules is to ensure that whitespace is
added in only those places where (a) XSLT’s <code>&lt;xsl:strip-space&gt;</code>
declaration could cause it to be removed, and
(b) it does not affect the <a title="string value" class="termref" href="#dt-string-value">string value</a> of any element node with
simple content. It is usually not safe to indent document types that include elements
with mixed content.</p>
                  </div>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The whitespace added may possibly
be based on whitespace stripped from either the source document or the
stylesheet (in the case of XSLT), or
guided by other means that might depend on the <a title="host language" class="termref" href="#host-language">host language</a>,
  in the case of an <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> created using some other process.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="XML_CDATA-SECTION-ELEMENTS"></a>5.1.4 <a href="#XML_CDATA-SECTION-ELEMENTS" style="text-decoration: none">XML Output Method: the <code>cdata-section-elements</code> Parameter</a></h4>
                  <p>The <code>cdata-section-elements</code> parameter contains a list
of expanded QNames. If the expanded QName of the parent of a text node
is a member of the list, then the text node

<span class="verb">must</span> be output as a
CDATA section, except in those circumstances
described below.</p>
                  <p>If the text node contains the sequence of characters
<code>]]&gt;</code>, then the currently open CDATA section

<span class="verb">must</span> be
closed following the <code>]]</code> and a new CDATA section opened
before the <code>&gt;</code>.</p>
                  <p>If the text node contains characters that are not
representable in the character encoding being used 
  <span>in the serialized output</span>, 
  then the currently open CDATA section

<span class="verb">must</span> be closed
before such characters, the characters

<span class="verb">must</span> be output using
character references or entity references, and a new CDATA
section

<span class="verb">must</span> be opened for any further
characters in the text node.</p>
                  <p>CDATA sections 
<span class="verb">must not</span> be used except where they
have been explicitly requested by the user, either by using the
<code>cdata-section-elements</code> parameter, or by using some other
<a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> mechanism.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This is phrased to permit an implementer to provide an option that
attempts to preserve CDATA sections present in the source
document.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="XML_OMIT-XML-DECLARATION"></a>5.1.5 <a href="#XML_OMIT-XML-DECLARATION" style="text-decoration: none">XML Output Method: the <code>omit-xml-declaration</code> and <code>standalone</code> Parameters</a></h4>
                  <p>The XML output method
<span class="verb">must</span> output an XML declaration if the <code>omit-xml-declaration</code> parameter has the value <code>false</code>.   
The XML declaration <span class="verb">must</span> include both version information and an encoding declaration. 
If the <code>standalone</code> parameter has 
the value <code>true</code> or <code>false</code>,
the XML declaration <span class="verb">must</span> include a standalone document declaration 
  with the value of the <code>standalone</code> parameter set accordingly to <code>yes</code> or <code>no</code>.
If the <code>standalone</code> parameter has
the value <code>omit</code>, the XML declaration
<span class="verb">must not</span> include a standalone document declaration; this ensures
that it is both an XML declaration (allowed at the beginning of a
document entity) and a text declaration (allowed at the beginning of
an external general parsed entity).</p>
                  <p>A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSEPM0009" title="err:SEPM0009">err:SEPM0009</a>] results if the
<code>omit-xml-declaration</code> parameter has 
the value <code>true</code>, and</p>
                  <ul>
                     <li>
                        <p>the <code>standalone</code> parameter has a value other than
<code>omit</code>; or
</p>
                     </li>
                     <li>
                        <p>the <code>version</code> parameter has a value other than
<code>1.0</code> and the <code>doctype-system</code>
parameter is specified.</p>
                     </li>
                  </ul>
                  <p>The <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> raise the error.
</p>
                  <p>Otherwise, if the
<code>omit-xml-declaration</code> parameter has 
the <code>true</code>,
 the XML output method

<span class="verb">must not</span> output an XML declaration.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XML_DOCTYPE"></a>5.1.6 <a href="#XML_DOCTYPE" style="text-decoration: none">XML Output Method: the <code>doctype-system</code> and <code>doctype-public</code> Parameters</a></h4>
                  <p>If the <code>doctype-system</code> parameter is specified, the
XML output method 
<span class="verb">must</span> output a document type
declaration immediately before the first element. The name following
<code>&lt;!DOCTYPE</code> 
<span class="verb">must</span> be the name of the first element,
if any. If the <code>doctype-public</code> parameter is also specified, then the
XML output method <span class="verb">must</span> output <code>PUBLIC</code>
followed by the public identifier and then the system identifier;
otherwise, it <span class="verb">must</span> output <code>SYSTEM</code>
followed by the system
identifier. The internal subset 
<span class="verb">must</span> be empty. The
<code>doctype-public</code> parameter 
<span class="verb">must</span> be ignored unless the
<code>doctype-system</code> parameter is specified.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="xml-undeclare-NS"></a>5.1.7 <a href="#xml-undeclare-NS" style="text-decoration: none">XML Output Method: the <code>undeclare-prefixes</code> Parameter</a></h4>
                  <p>The Data Model allows an element
node that binds a non-empty prefix to
have a child element node that does
not bind that same prefix. In <em>Namespaces in XML 1.1</em> (<a href="#xml-names11">[XML Names 1.1]</a>), this can be represented accurately by undeclaring
prefixes.  For the undeclaring prefix of the child element node,  
if the <code>undeclare-prefixes</code> parameter has 
the value <code>true</code>,
the output method is XML or XHTML, and the <code>version</code> 
parameter value is greater than <code>1.0</code>,
the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> undeclare its namespace.  If the
<code>undeclare-prefixes</code> parameter has the value <code>false</code> and the output method is XML or
XHTML, then the undeclaration of prefixes <span class="verb">must not</span> occur.</p>
                  <div class="example">
                     <p>Consider an element <code>x:foo</code> with four in-scope namespaces
that associate prefixes with URIs as follows:
</p>
                     <ul>
                        <li>
                           <p><code>x</code> is associated with
<code>http://example.org/x</code></p>
                        </li>
                        <li>
                           <p><code>y</code> is associated with
<code>http://example.org/y</code></p>
                        </li>
                        <li>
                           <p><code>z</code> is associated with
<code>http://example.org/z</code></p>
                        </li>
                        <li>
                           <p><code>xml</code> is associated with
<code>http://www.w3.org/XML/1998/namespace</code></p>
                        </li>
                     </ul>
                     <p>Suppose that it has a child element <code>x:bar</code> with three in-scope namespaces:</p>
                     <ul>
                        <li>
                           <p><code>x</code> is associated with
<code>http://example.org/x</code></p>
                        </li>
                        <li>
                           <p><code>y</code> is associated with
<code>http://example.org/y</code></p>
                        </li>
                        <li>
                           <p><code>xml</code> is associated with
<code>http://www.w3.org/XML/1998/namespace</code></p>
                        </li>
                     </ul>
                     <p>If namespace undeclaration is in effect, it will be serialized this way:</p>
                     <div class="exampleInner">
                        <pre>&lt;x:foo xmlns:x="http://example.org/x"
       xmlns:y="http://example.org/y"
       xmlns:z="http://example.org/z"&gt;
       
       &lt;x:bar xmlns:z=""&gt;...&lt;/x:bar&gt;
       
&lt;/x:foo&gt;</pre>
                     </div>
                  </div>
                  <p>In <em>Namespaces in XML</em> 1.0 (<a href="#xml-names">[XML Names]</a>), prefix undeclaration is not possible.
If the output method is XML or XHTML, the value of the <code>undeclare-prefixes</code> parameter is 
<code>true</code>,
and the value of the <code>version</code> parameter is <code>1.0</code>,
a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSEPM0010" title="err:SEPM0010">err:SEPM0010</a>] results; the
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> raise the error.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XML_NORMALIZATION-FORM"></a>5.1.8 <a href="#XML_NORMALIZATION-FORM" style="text-decoration: none">XML Output Method: the <code>normalization-form</code> Parameter</a></h4>
                  <p>The <code>normalization-form</code> parameter is applicable to the XML output method.
The values <code>NFC</code> and <code>none</code> <span class="verb">must</span> be supported by the <a title="serializer" class="termref" href="#serializer">serializer</a>.
A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSESU0011" title="err:SESU0011">err:SESU0011</a>] results if the value of the
<code>normalization-form</code> parameter specifies a normalization form
that is not supported by the
<a title="serializer" class="termref" href="#serializer">serializer</a>; the
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> raise the error.</p>
                  <p>The meanings associated with the possible values of
the <code>normalization-form</code> parameter are as follows:</p>
                  <ul>
                     <li>
                        <p><code>NFC</code> specifies the serialized result will be
       in Normalization Form C, using the rules specified in <a href="#charmod-norm">[Character Model for the World Wide Web 1.0: Normalization]</a>.</p>
                     </li>
                     <li>
                        <p><code>NFD</code> specifies the serialized result will be
       in Normalization Form D, as specified in <a href="#UNICODE-NORMALIZATION-FORM">[UAX #15: Unicode Normalization Forms]</a>.</p>
                     </li>
                     <li>
                        <p><code>NFKC</code> specifies the serialized result will be
       in Normalization Form KC, as specified in <a href="#UNICODE-NORMALIZATION-FORM">[UAX #15: Unicode Normalization Forms]</a>.</p>
                     </li>
                     <li>
                        <p><code>NFKD</code> specifies the serialized result will be
       in Normalization Form KD, as specified in <a href="#UNICODE-NORMALIZATION-FORM">[UAX #15: Unicode Normalization Forms]</a>.</p>
                     </li>
                     <li>
                        <p><code>fully-normalized</code> specifies the serialized result
       will be in fully normalized text, as specified in <a href="#charmod-norm">[Character Model for the World Wide Web 1.0: Normalization]</a>.</p>
                     </li>
                     <li>
                        <p><code>none</code> specifies that no <a title="Unicode Normalization" class="termref" href="#unicode-normalization">Unicode Normalization</a> will
       be applied.</p>
                     </li>
                     <li>
                        <p>An <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> value
       has an <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
       effect.</p>
                     </li>
                  </ul>
                  <p>If the value of the parameter is <code>fully-normalized</code>, then no
<em>relevant construct</em> of the parsed entity created by the <a title="serializer" class="termref" href="#serializer">serializer</a>
may start with a composing character. The term <em>relevant construct</em>
has the meaning defined in section 2.13 of <a href="#xml11">[XML11]</a>. If this condition is not
satisfied, a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0012" title="err:SERE0012">err:SERE0012</a>] <span class="verb">must</span> be raised.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Specifying <code>fully-normalized</code> as the value of this parameter
does not guarantee that the XML document output by the <a title="serializer" class="termref" href="#serializer">serializer</a> will in fact
be fully normalized as defined in <a href="#xml11">[XML11]</a>. This is because the <a title="serializer" class="termref" href="#serializer">serializer</a> does
not check that the text is <code>include normalized</code>, which would involve
checking all external entities that it refers to (such as an external DTD).
Furthermore, the <a title="serializer" class="termref" href="#serializer">serializer</a> does not check whether any character escape
generated using character maps represents a composing character.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="XML_MEDIA-TYPE"></a>5.1.9 <a href="#XML_MEDIA-TYPE" style="text-decoration: none">XML Output Method: the <code>media-type</code> Parameter</a></h4>
                  <p>The <code>media-type</code> parameter is applicable to the
XML output method. 
See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more
information.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XML_USE-CHARACTER-MAPS"></a>5.1.10 <a href="#XML_USE-CHARACTER-MAPS" style="text-decoration: none">XML Output Method: the <code>use-character-maps</code> Parameter</a></h4>
                  <p>The <code>use-character-maps</code> parameter is applicable to the XML output method.
The result of serialization using the XML output method is not
guaranteed to be well-formed XML if character maps have been specified.
See <a href="#character-maps"><b>11 Character Maps</b></a> for more information.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XML_BYTE-ORDER-MARK"></a>5.1.11 <a href="#XML_BYTE-ORDER-MARK" style="text-decoration: none">XML Output Method: the <code>byte-order-mark</code> Parameter</a></h4>
                  <p>The <code>byte-order-mark</code> parameter is
applicable to the XML output method.  See
<a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The byte order mark may be undesirable under certain circumstances, 
for example, to concatenate resulting XML fragments without additional processing to remove the byte order mark. 
Therefore this specification does not mandate the <code>byte-order-mark</code> parameter to have 
the value <code>true</code>
when the encoding is UTF-16, 
even though the XML 1.0 and XML 1.1 specifications state that entities encoded in UTF-16 <span class="verb">must</span> begin with a byte order mark.  
Consequently, this specification does not guarantee that the resulting XML fragment, 
without a byte order mark, will not cause an error when processed by a conforming XML processor.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="XML_ITEM-SEPARATOR"></a>5.1.12 <a href="#XML_ITEM-SEPARATOR" style="text-decoration: none">XML Output Method: the <code>item-separator</code> Parameter</a></h4>
                  <p>The effect of the <code>item-separator</code> serialization parameter
is described in <a href="#serdm"><b>2 Sequence Normalization</b></a>.</p>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="xhtml-output"></a>6 <a href="#xhtml-output" style="text-decoration: none">XHTML Output Method</a></h2>
            <div class="changes">
               <p class="changesHeading">Changes in 4.0&nbsp;<a href="#html-output">⬇</a>&nbsp;<a href="#serparam">⬆</a></p>
               <ol>
                  <li>
                     <p>In the HTML and XHTML output methods, the rules for adding and replacing
      <code>meta</code> elements have been revised to take account of the new HTML5 syntax,
      for example <code>&lt;meta charset="utf-8"&gt;</code>.
    <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/318">318</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/342">342</a>&nbsp;14 February 2023]</i></p>
                  </li>
               </ol>
            </div>
            <p>The XHTML output method serializes the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> as
XML, using the HTML compatibility guidelines defined in the XHTML
specification
(<a href="#xhtml1">[XHTML 1.0]</a>
or the XHTML syntax of HTML5
(see <a href="#html5">[HTML5]</a>).</p>
            <p>
[<a id="recognized-as-HTML" title="recognized as an HTML element">Definition</a>: An element node is <b>recognized as an
HTML element</b> by the XHTML output method if
</p>
            <ul>
               <li>
                  <p>the element node is in the
<a title="XHTML namespace" class="termref" href="#xhtml-namespace">XHTML namespace</a>,
regardless of the value of the
<code>html-version</code>
serialization parameter
or if the <code>html-version</code>
serialization parameter is absent; or</p>
               </li>
               <li>
                  <p>the value of the
<code>html-version</code>
serialization parameter is
<code>5.0</code>, the element has a
<a title="null namespace URI" class="termref" href="#null-namespace-URI">null namespace URI</a>, and
the local part of the name is equal
to the name of an element defined by HTML5 <a href="#html5">[HTML5]</a>,
making the comparison
<a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>.</p>
               </li>
            </ul>
            <p>]</p>
            <p>It is entirely the responsibility of the
  person or process that creates the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>
to ensure that it conforms to the <a href="#xhtml1">[XHTML 1.0]</a> or
<a href="#xhtml11">[XHTML 1.1]</a> specification
if the <code>html-version</code>
serialization parameter is absent or has a value less than
<code>5.0</code>
or the XHTML syntax of
HTML5 if the value of the
<code>html-version</code> serialization parameter is <code>5.0</code>.
It is not an error if the
instance of the data model is invalid XHTML. Equally, it is entirely under the
control of the person or process that creates the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> 
  whether the output conforms to XHTML 1.0
Strict, XHTML 1.0 Transitional,
the XHTML syntax of HTML5 (see
<a href="#html5">[HTML5]</a>),
<a href="#html-polyglot">[POLYGLOT]</a>
or any other specific definition of XHTML.</p>
            <p>The serialization of the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> follows the same rules as for
the XML output method, with the general exceptions noted below and parameter-specific exceptions in <a href="#XHTML_PARAMS"><b>6.1 The Influence of Serialization Parameters upon the XHTML Output Method</b></a>.
These differences are based on the HTML compatibility guidelines
published in Appendix C of <a href="#xhtml1">[XHTML 1.0]</a>
and on <a href="#html-polyglot">[POLYGLOT]</a>,
both of which are designed
to ensure that as far as possible, XHTML is rendered correctly on user
agents designed originally to handle HTML.</p>
            <p>If the value of the <code>html-version</code>
  serialization parameter is <code>5.0</code>, the 
  <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> is first subjected to
<a title="prefix normalization" class="termref" href="#PREFIXNORMALIZATION">prefix normalization</a>.</p>
            <p>
[<a id="PREFIXNORMALIZATION" title="prefix normalization">Definition</a>: During
  <b>prefix normalization</b>, any element node in the 
  <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> that is in one of the
<a title="XHTML namespace" class="termref" href="#xhtml-namespace">XHTML namespace</a>, the
<a title="SVG namespace" class="termref" href="#svg-namespace">SVG namespace</a> or the
<a title="MathML namespace" class="termref" href="#mathml-namespace">MathML namespace</a> has its name
replaced by the local part of its name.  Such an element node is given a
default namespace node whose value is the element’s namespace URI.  Any
namespace node for any of those three namespaces that was previously present
on any element node in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> is also removed,
unless the prefix that that namespace node declared is used as the prefix on
the name of an attribute on that element or an ancestor of that
element.]</p>
            <p>
The process of <a title="prefix normalization" class="termref" href="#PREFIXNORMALIZATION">prefix normalization</a>

  is equivalent to replacing the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> 
  with the result of the transformation described by this XSLT
  stylesheet, with the root of the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> as the initial <span>context value</span>.

</p>
            <div class="exampleInner">
               <pre>
&lt;xsl:stylesheet
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    version="4.0"
    xmlns:xhtml="http://www.w3.org/1999/xhtml"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns:mathml="http://www.w3.org/1998/Math/MathML"&gt;
  &lt;xsl:template match="xhtml:*|svg:*|mathml:*"&gt;
    &lt;xsl:element name="{local-name()}" 
                 namespace="{namespace-uri()}"&gt;
      &lt;xsl:apply-templates select="@*|namespace::*|node()"/&gt;
    &lt;/xsl:element&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="node()|@*|namespace::*"&gt;
    &lt;xsl:copy copy-namespaces="no"&gt;
      &lt;xsl:apply-templates select="@*|namespace::*|node()"/&gt;
    &lt;/xsl:copy&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template
    match="namespace::*[. eq 'http://www.w3.org/1999/xhtml']|
           namespace::*[. eq 'http://www.w3.org/2000/svg']|
           namespace::*[. eq 'http://www.w3.org/1998/Math/MathML']"/&gt;
&lt;/xsl:stylesheet&gt;</pre>
            </div>
            <ul>
               <li>
                  <p>[<a id="XHTMLEMPTY" title="EMPTY">Definition</a>: The following XHTML elements have an <b>EMPTY</b> content model: <code>area</code>, <code>base</code>, <code>br</code>, <code>col</code>, <code>embed</code>, <code>hr</code>, <code>img</code>, <code>input</code>, <code>link</code>, <code>meta</code>, <code>basefont</code>, <code>frame</code>,  <code>isindex</code>, and <code>param</code>.]
[<a id="XHTMLVOID" title="void">Definition</a>: The
<b>void</b> elements of HTML5 are
<code>area</code>, <code>base</code>,
<code>br</code>, <code>col</code>, <code>embed</code>,
<code>hr</code>, <code>img</code>, <code>input</code>,
<code>keygen</code>, <code>link</code>, <code>meta</code>,
<code>param</code>, <code>source</code>, <code>track</code> and
<code>wbr</code>.]

[<a id="XHTMLEXPECTEDEMPTY" title="expected-empty">Definition</a>: An element node is <b>expected to be empty</b> if
it is <a title="recognized as an HTML element" class="termref" href="#recognized-as-HTML">recognized as an HTML element</a>
and if either</p>
                  <ul>
                     <li>
                        <p>the <code>html-version</code> serialization parameter is
absent or has a value less than <code>5.0</code> and the content model is
<a title="EMPTY" class="termref" href="#XHTMLEMPTY">EMPTY</a>, or</p>
                     </li>
                     <li>
                        <p>the <code>html-version</code> serialization parameter has the value
<code>5.0</code> and the element is a <a title="void" class="termref" href="#XHTMLVOID">void</a>
element.</p>
                     </li>
                  </ul>
                  <p>]</p>
                  <p>
If an element node that has no
child nodes is


not
<a title="expected-empty" class="termref" href="#XHTMLEXPECTEDEMPTY">expected to be empty</a>, and:

</p>
                  <ul>
                     <li>
                        <p>
the
<code>html-version</code>
serialization parameter is
absent or has a value
less than <code>5.0</code>, and the
content model of the HTML element
is not <a title="EMPTY" class="termref" href="#XHTMLEMPTY">EMPTY</a>
(for example, an empty title or paragraph); or</p>
                     </li>
                     <li>
                        <p>the value of the
<code>html-version</code>
serialization parameter is <code>5.0</code>, and the
HTML element is not a <a title="void" class="termref" href="#XHTMLVOID">void</a> element,
</p>
                     </li>
                  </ul>
                  <p>
the <a title="serializer" class="termref" href="#serializer">serializer</a> 
<span class="verb">must not</span> use the minimized form.
That is, it 
<span class="verb">must</span>
output <code>&lt;p&gt;&lt;/p&gt;</code> and not
<code>&lt;p&nbsp;/&gt;</code>. </p>
               </li>
               <li>
                  <p>If an element that has no
children is 

<a title="expected-empty" class="termref" href="#XHTMLEXPECTEDEMPTY">expected to be empty</a>,

the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> use the minimized tag syntax,
for example
<code>&lt;br&nbsp;/&gt;</code>, as the alternative syntax
<code>&lt;br&gt;&lt;/br&gt;</code> allowed by XML gives uncertain
results in many
legacy
user agents.
If the
<code>html-version</code>
serialization parameter is
absent or has a value
less than <code>5.0</code>,
the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> include a
space before the trailing <code>/&gt;</code>, e.g.
<code>&lt;br&nbsp;/&gt;</code>, <code>&lt;hr&nbsp;/&gt;</code> and
<code>&lt;img&nbsp;src="karen.jpg"&nbsp;alt="Karen"&nbsp;/&gt;</code>.
</p>
               </li>
               <li>
                  <p>
If the
<code>html-version</code>
serialization parameter is
absent or has a value
less than <code>5.0</code>,
the <a title="serializer" class="termref" href="#serializer">serializer</a> 
<span class="verb">must not</span> use the entity reference
<code>&amp;apos;</code> which, although
defined
in XML and therefore in
XHTML, is not defined in
versions of HTML
prior to HTML5,
and is not recognized by all HTML user
agents.</p>
               </li>
               <li>
                  <p>If the
<code>html-version</code>
serialization parameter is
absent or has a value
less than
<code>5.0</code>,
the <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">should</span> output namespace declarations
in a way that is consistent with the requirements of the XHTML DTD if this is
possible.
If the value of the
<code>html-version</code>
serialization parameter is
<code>5.0</code>,
the <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">should</span>
output namespace declarations in a way that is consistent with the requirements
of
<a href="#html-polyglot">[POLYGLOT]</a>.

The XHTML 1.0 DTDs require the declaration
<code>xmlns="http://www.w3.org/1999/xhtml"</code>
to appear on the <code>html</code> element, and only on the <code>html</code> element.
The <a href="#html-polyglot">[POLYGLOT]</a> specification permits namespace declarations
to appear in a conforming document, but 
restricts the elements on which they can appear.
The <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> output namespace declarations that are consistent with
the namespace nodes present in the <a title="result tree" class="termref" href="#result-tree">result tree</a>, but it <span class="verb">must</span> avoid outputting
redundant namespace declarations on elements where the DTD would make them invalid,
for versions prior to HTML5, or where they
are not permitted by
<a href="#html-polyglot">[POLYGLOT]</a>,
for serialization according to the syntax of HTML5.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>If the <code>html</code> element is generated by an XSLT literal result element of
the form <code>&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt; ... &lt;/html&gt;</code>, or by an
XQuery direct element constructor of the same form, then the <code>html</code> element in
the result document will have a node name whose prefix is "", which will
satisfy the requirements of the DTD. In other cases the prefix assigned to
the element is implementation-dependent.</p>
                  </div>
               </li>
            </ul>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p><a href="#html-polyglot">[POLYGLOT]</a>
and Appendix C of <a href="#xhtml1">[XHTML 1.0]</a>
describe
a number of compatibility guidelines for users of XHTML who wish to
render their XHTML documents with HTML user agents.  In some cases, such
as the guideline on the form empty elements
take, only the
serialization process itself has the ability to follow the guideline.  In
such cases, those guidelines are reflected in the requirements on the
<a title="serializer" class="termref" href="#serializer">serializer</a>
described above.</p>
               <p>In all other cases, the guidelines can be
  adhered to by the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>.  
  The guideline on the use of whitespace characters in attribute
values is one such example.  Another example is that <code>xml:lang="..."</code> does not serialize to both <code>xml:lang="..."</code> and <code>lang="..."</code> as required by some legacy user agents.  It is the responsibility of the person or
process that creates the instance of the data model that is input to the
serialization process to ensure it is created in a way that is consistent
with the guidelines.  No <a title="serialization error" class="termref" href="#serial-err">serialization error</a> results if the 
  <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> does not adhere to the guidelines.</p>
            </div>
            <div class="div2">
               
               <h3><a id="XHTML_PARAMS"></a>6.1 <a href="#XHTML_PARAMS" style="text-decoration: none">The Influence of Serialization Parameters upon the XHTML Output Method</a></h3>
               <p>The serialization parameters that affect the XHTML output method are listed
    in the following subsections.</p>
               <p>Serialization parameters other than those listed are not applicable to this output
    method.  It is the responsibility of the
    <a title="host language" class="termref" href="#host-language">host language</a> to specify
    whether an error occurs if such a parameter is specified in combination
    with the XHTML output method, or whether the parameter is ignored, or whether
    it is validated and then ignored.</p>
               <div class="div3">
                  
                  <h4><a id="XHTML_VERSION"></a>6.1.1 <a href="#XHTML_VERSION" style="text-decoration: none">XHTML Output Method: the <code>version</code>
                        Parameter</a></h4>
                  <p>The behavior for the <code>version</code>
parameter for the XHTML output method is described in
<a href="#XML_VERSION"><b>5.1.1 XML Output Method: the version Parameter</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_HTML_VERSION"></a>6.1.2 <a href="#XHTML_HTML_VERSION" style="text-decoration: none">XHTML Output Method: the <code>html-version</code> Parameter</a></h4>
                  <p>The <code>html-version</code> parameter specifies whether the XHTML
output method will produce a serialized document following rules that
are tailored to the requirements of the XHTML syntax of <a href="#html5">[HTML5]</a>
or the requirements of <a href="#xhtml1">[XHTML 1.0]</a> and <a href="#xhtml11">[XHTML 1.1]</a>.</p>
                  <p>The differences are described in detail throughout
<a href="#xhtml-output"><b>6 XHTML Output Method</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_ENCODING"></a>6.1.3 <a href="#XHTML_ENCODING" style="text-decoration: none">XHTML Output Method: the <code>encoding</code> Parameter</a></h4>
                  <p>The behavior for <code>encoding</code> parameter for the XHTML output method is described in <a href="#XML_ENCODING"><b>5.1.2 XML Output Method: the encoding Parameter</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_INDENT"></a>6.1.4 <a href="#XHTML_INDENT" style="text-decoration: none">XHTML Output Method: the <code>indent</code> and <code>suppress-indentation</code> Parameters</a></h4>
                  <p>If the <code>indent</code> parameter has 
the value <code>true</code>, the
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">may</span> add or remove whitespace as it serializes the
<a title="result tree" class="termref" href="#result-tree">result tree</a>,
if it observes the following constraints.</p>
                  <ul>
                     <li>
                        <p>Whitespace <span class="verb">must not</span> be added other than before or
after an element, or adjacent to an existing whitespace character.</p>
                     </li>
                     <li>
                        <p>Whitespace <span class="verb">must not</span> be added or removed adjacent to
an inline element. The inline elements are those elements
<a title="recognized as an HTML element" class="termref" href="#recognized-as-HTML">recognized
as HTML elements</a> that are
in the %inline category of any of the XHTML 1.0 DTDs, in the
%inline.class category of the XHTML 1.1 DTD,
those elements defined to be phrasing
elements in HTML5
 and elements
<a title="recognized as an HTML element" class="termref" href="#recognized-as-HTML">recognized
as HTML elements</a>
with local names <code>ins</code> and <code>del</code> if they are used as
inline elements (i.e., if they do not contain element children).</p>
                     </li>
                     <li>
                        <p>Whitespace <span class="verb">must not</span> be added or removed inside a
formatted element, the formatted elements being those
<a title="recognized as an HTML element" class="termref" href="#recognized-as-HTML">recognized
as HTML elements</a>
with local names <code>pre</code>, <code>script</code>, <code>style</code>,
<code>title</code>, and
    <code>textarea</code>.
</p>
                     </li>
                     <li>
                        <p>Whitespace characters
<span class="verb">must not</span> be added in the content of an element
whose expanded QName matches a
member of the list of expanded QNames in the
value of the <code>suppress-indentation</code> parameter.
The expanded QName of an element node
is considered to match a member of the list of expanded QNames
if:</p>
                        <ul>
                           <li>
                              <p>the two expanded QNames are equal;</p>
                           </li>
                           <li>
                              <p>the expanded QNames both have <a title="null namespace URI" class="termref" href="#null-namespace-URI">null
namespace URIs</a>, and the local parts of the two QNames are
equal <a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>; or
</p>
                           </li>
                           <li>
                              <p>the value of the
<code>html-version</code>
serialization parameter is
<code>5.0</code>, the local parts of the two QNames are equal
<a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>
and one QName has a <a title="null namespace URI" class="termref" href="#null-namespace-URI">null namespace
URI</a> and the namespace URI of the other is equal to the
<a title="XHTML namespace" class="termref" href="#xhtml-namespace">XHTML namespace</a> URI.</p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The effect of the above constraints is to
ensure any insertion or deletion of whitespace would not affect how
an
HTML user agent
that conforms to the specified version
of HTML
would render the output, assuming the serialized document does
not refer to any HTML style sheets.</p>
                     <p>The HTML definition of whitespace is different from the XML
  definition: see section 9.1 of  <a href="#html401">[HTML]</a> 4.01 specification.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_CDATA-SECTION-ELEMENTS"></a>6.1.5 <a href="#XHTML_CDATA-SECTION-ELEMENTS" style="text-decoration: none">XHTML Output Method: the <code>cdata-section-elements</code> Parameter</a></h4>
                  <p>The behavior for <code>cdata-section-elements</code> parameter for the XHTML output method is described in <a href="#XML_CDATA-SECTION-ELEMENTS"><b>5.1.4 XML Output Method: the cdata-section-elements Parameter</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_OMIT-XML-DECLARATION"></a>6.1.6 <a href="#XHTML_OMIT-XML-DECLARATION" style="text-decoration: none">XHTML Output Method: the <code>omit-xml-declaration</code> and <code>standalone</code> Parameters</a></h4>
                  <p>The behavior for <code>omit-xml-declaration</code> and  <code>standalone</code> parameters for the XHTML output method is described in <a href="#XML_OMIT-XML-DECLARATION"><b>5.1.5 XML Output Method: the omit-xml-declaration and standalone Parameters</b></a>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>As with the XML output method, the XHTML
output method specifies that an XML declaration will be output unless it is suppressed using
the <code>omit-xml-declaration</code> parameter. Appendix C.1 of 
<a href="#xhtml1">[XHTML 1.0]</a>
provides advice on the consequences of including,
or omitting, the XML declaration.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_DOCTYPE"></a>6.1.7 <a href="#XHTML_DOCTYPE" style="text-decoration: none">XHTML Output Method: the <code>doctype-system</code> and <code>doctype-public</code> Parameters</a></h4>
                  <p>If the value of the
<code>html-version</code>
serialization parameter is <code>5.0</code>, the




<code>doctype-system</code> serialization parameter is

absent,
the first element node child of
the document node that is to be serialized
is
<a title="recognized as an HTML element" class="termref" href="#recognized-as-HTML">recognized as an HTML
element</a>, the local part of the QName of which is equal to
the string <code>HTML</code>,
<a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>,
and any text node preceding that
element in document order contains only whitespace characters,
then
the XHTML output method <span class="verb">must</span> output a document type
declaration immediately before the first element, with no public or
system identifier.  The name following <code>&lt;!DOCTYPE</code>
<span class="verb">must</span>
be the same as the local part of the
name of the element.</p>
                  <p>Otherwise, the behavior for <code>doctype-system</code> and  <code>doctype-public</code> parameters for the XHTML output method is described in <a href="#XML_DOCTYPE"><b>5.1.6 XML Output Method: the doctype-system and doctype-public Parameters</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_UNDECLARE-PREFIXES"></a>6.1.8 <a href="#XHTML_UNDECLARE-PREFIXES" style="text-decoration: none">XHTML Output Method: the <code>undeclare-prefixes</code> Parameter</a></h4>
                  <p>The behavior for <code>undeclare-prefixes</code> parameter for the XHTML output method is described in <a href="#xml-undeclare-NS"><b>5.1.7 XML Output Method: the undeclare-prefixes Parameter</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_NORMALIZATION-FORM"></a>6.1.9 <a href="#XHTML_NORMALIZATION-FORM" style="text-decoration: none">XHTML Output Method: the <code>normalization-form</code> Parameter</a></h4>
                  <p>The behavior for <code>normalization-form</code> parameter for the XHTML output method is described in <a href="#XML_NORMALIZATION-FORM"><b>5.1.8 XML Output Method: the normalization-form Parameter</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_MEDIA-TYPE"></a>6.1.10 <a href="#XHTML_MEDIA-TYPE" style="text-decoration: none">XHTML Output Method: the <code>media-type</code> Parameter</a></h4>
                  <p>The behavior for <code>media-type</code> parameter for the XHTML output method is described in <a href="#XML_MEDIA-TYPE"><b>5.1.9 XML Output Method: the media-type Parameter</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_USE-CHARACTER-MAPS"></a>6.1.11 <a href="#XHTML_USE-CHARACTER-MAPS" style="text-decoration: none">XHTML Output Method: the <code>use-character-maps</code> Parameter</a></h4>
                  <p>The behavior for <code>use-character-maps</code> parameter for the XHTML output method is described in <a href="#XML_USE-CHARACTER-MAPS"><b>5.1.10 XML Output Method: the use-character-maps Parameter</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_BYTE-ORDER-MARK"></a>6.1.12 <a href="#XHTML_BYTE-ORDER-MARK" style="text-decoration: none">XHTML Output Method: the <code>byte-order-mark</code> Parameter</a></h4>
                  <p>The behavior for <code>byte-order-mark</code> parameter for the XHTML output method is described in <a href="#XML_BYTE-ORDER-MARK"><b>5.1.11 XML Output Method: the byte-order-mark Parameter</b></a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_ESCAPE-URI-ATTRIBUTES"></a>6.1.13 <a href="#XHTML_ESCAPE-URI-ATTRIBUTES" style="text-decoration: none">XHTML Output Method: the <code>escape-uri-attributes</code> Parameter</a></h4>
                  <p>

If the <code>escape-uri-attributes</code> parameter has
the value <code>true</code>,
 the XHTML output method 
<span class="verb">must</span> apply <a title="URI Escaping" class="termref" href="#uri-escaping">URI escaping</a> to 
<a title="URI attribute values" class="termref" href="#uri-attribute-values">URI attribute values</a>, except that relative URIs <span class="verb">must not</span> be absolutized.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This escaping is deliberately confined to non-ASCII characters,
because escaping of ASCII characters is not always appropriate, for
example when URIs or URI fragments are interpreted locally by the HTML
user agent. Even in the case of non-ASCII characters, escaping can
sometimes cause problems. More precise control of <a title="URI Escaping" class="termref" href="#uri-escaping">URI escaping</a> is
therefore available by setting <code>escape-uri-attributes</code> to
<code>false</code>, and controlling the escaping of URIs by using methods defined in
<a href="https://qt4cg.org/specifications/xpath-functions-40/#func-encode-for-uri">Section 7.2 fn:encode-for-uri</a><sup><small>FO</small></sup> and <a href="https://qt4cg.org/specifications/xpath-functions-40/#func-iri-to-uri">Section 7.4 fn:iri-to-uri</a><sup><small>FO</small></sup>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_INCLUDE-CONTENT-TYPE"></a>6.1.14 <a href="#XHTML_INCLUDE-CONTENT-TYPE" style="text-decoration: none">XHTML Output Method: the <code>include-content-type</code> Parameter</a></h4>
                  <p>If the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> includes a <code>head</code> element
<a title="recognized as an HTML element" class="termref" href="#recognized-as-HTML">recognized as
an HTML element</a>,
and the <code>include-content-type</code> parameter has 
the value <code>true</code>,
the XHTML output method
<span class="verb">must</span>
add a <code>meta</code> element as the first child element of the
<code>head</code> element, specifying the character encoding actually
used. The <code>meta</code> element <span class="verb">should</span>
 be in no namespace if the <code>head</code> element is in no namespace, and in the XHTML namespace if the 
 <code>head</code> element is in the XHTML namespace.
</p>
                  <div class="example">
                     <p>For example,</p>
                     <div class="exampleInner">
                        <pre>&lt;head&gt;
&lt;meta http-equiv="Content-Type" 
      content="text/html; charset=EUC-JP" /&gt;
...</pre>
                     </div>
                  </div>
                  <p>For HTML5, the alternative form <code>&lt;meta charset="EUC-JP"/&gt;</code> 
  <span class="verb">may</span> be used.</p>
                  <p>The content type<span>, if included,</span> 
    <span class="verb">should</span> be set to the value given for the
<code>media-type</code> parameter.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>It is recommended that the <a title="host language" class="termref" href="#host-language">host language</a> use as default
value for this parameter one of the MIME types (<a href="#RFC2046">[RFC2046]</a>) registered for
XHTML. Currently, these are <code>text/html</code> (registered by <a href="#RFC2854">[RFC2854]</a>)
and <code>application/xhtml+xml</code> (registered by <a href="#RFC3236">[RFC3236]</a>). Note that
some user agents fail to recognize the charset parameter if the
content type is not <code>text/html</code>.</p>
                  </div>
                  <p>If a <code>meta</code> element has been added to the <code>head</code> element as described above,
then any existing <code>meta</code> element child of the <code>head</code> element having 
  <span>either a <code>charset</code> attribute, or </span>
  an <code>http-equiv</code> attribute with the value "Content-Type",
making the comparison

<a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>
after first stripping leading and trailing spaces from the value of
the attribute solely for the purposes of comparison,

<span class="verb">must</span> be discarded. </p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This process removes possible parameters in the attribute value.  For example,</p>
                     <div class="exampleInner">
                        <pre>&lt;meta http-equiv="Content-Type" 
      content="text/html;version='4.0'" /&gt;</pre>
                     </div>
                     <p>in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> 
    <span>might</span> be replaced by</p>
                     <div class="exampleInner">
                        <pre>&lt;meta http-equiv="Content-Type" 
      content="text/html;charset=utf-8" /&gt;</pre>
                     </div>
                     <p>or by</p>
                     <div class="exampleInner">
                        <pre>&lt;meta charset="utf-8"/&gt;</pre>
                     </div>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="XHTML_ITEM-SEPARATOR"></a>6.1.15 <a href="#XHTML_ITEM-SEPARATOR" style="text-decoration: none">XHTML Output Method: the <code>item-separator</code> Parameter</a></h4>
                  <p>The effect of the <code>item-separator</code> serialization parameter
is described in <a href="#serdm"><b>2 Sequence Normalization</b></a>.</p>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="html-output"></a>7 <a href="#html-output" style="text-decoration: none">HTML Output Method</a></h2>
            <div class="changes">
               <p class="changesHeading">Changes in 4.0&nbsp;<a href="#json-output">⬇</a>&nbsp;<a href="#xhtml-output">⬆</a></p>
               <ol>
                  <li>
                     <p>In the HTML and XHTML output methods, the rules for adding and replacing
      <code>meta</code> elements have been revised to take account of the new HTML5 syntax,
      for example <code>&lt;meta charset="utf-8"&gt;</code>.<i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/318">318</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/342">342</a>&nbsp;14 February 2023]</i></p>
                  </li>
               </ol>
            </div>
            <p>The HTML output method serializes
  the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> as
HTML.</p>
            <div class="example">
               <p>For example, the following XSL stylesheet generates html output,</p>
               <div class="exampleInner">
                  <pre>&lt;xsl:stylesheet version="2.0" 
     xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
&lt;xsl:output method="html" version="4.0"/&gt;
&lt;xsl:template match="/"&gt;
  &lt;html&gt;
    &lt;xsl:apply-templates/&gt;
  &lt;/html&gt;
&lt;/xsl:template&gt;
...
&lt;/xsl:stylesheet&gt;</pre>
               </div>
            </div>
            <p>In the example, the <code>version</code> attribute of the <code>xsl:output</code> element indicates the version of the HTML Recommendation <a href="#html401">[HTML]</a> to which the serialized result is to conform.</p>
            <p>It is entirely the responsibility of the person or process that creates 
  the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> to ensure that it conforms to the HTML Recommendation <a href="#html401">[HTML]</a>. 
  It is not an error if the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> is invalid HTML. 
  Equally, it is entirely under the control of the person or process that creates the 
  <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> whether the output conforms to HTML.

If the result tree is valid HTML, the
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> serialize the result in a way that
conforms with the version of HTML specified by the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>.</p>
            <div class="div2">
               
               <h3><a id="HTML_MARKUP"></a>7.1 <a href="#HTML_MARKUP" style="text-decoration: none">Markup for Elements</a></h3>
               <p>As is described in detail below,
the HTML output method
will not
output an element
differently from the XML output method unless the
element is to be
<a title="serialized as an HTML element" class="termref" href="#serialize-as-HTML">serialized as an HTML
element</a>.
[<a id="XML-ISLAND" title="XML Island">Definition</a>: The
portion of the serialized document representing the result of serializing 
an element
that is not to be
<a title="serialized as an HTML element" class="termref" href="#serialize-as-HTML">serialized as an HTML
element</a>
is known as an
<b>XML Island.</b>]
[<a id="serialize-as-HTML" title="serialized as an HTML element">Definition</a>: An element node is <b>serialized as an
HTML element</b> if</p>
               <ul>
                  <li>
                     <p>the expanded QName of the element has a
<a title="null namespace URI" class="termref" href="#null-namespace-URI">null namespace URI</a>,
regardless of the value of the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>, or
</p>
                  </li>
                  <li>
                     <p>the value of the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>
is <code>5.0</code> or
greater, and
the element node is in the
<a title="XHTML namespace" class="termref" href="#xhtml-namespace">XHTML namespace</a>.</p>
                  </li>
               </ul>
               <p>]</p>
               <p>If the 
element is to be
<a title="serialized as an HTML element" class="termref" href="#serialize-as-HTML">serialized as an HTML
element</a>,
but the local part of the expanded QName is not recognized as the name
of an HTML element, the element 
<span class="verb">must</span> be output in the same way as a
non-empty, inline element such as <code>span</code>. In particular:</p>
               <ol class="enumar">
                  <li>
                     <p>
Any namespace node in the result tree
for the <a title="XML namespace" class="termref" href="#xml-namespace">XML namespace</a> is ignored
by the HTML output method.
In addition,
if the 
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML version</a>
is <code>5.0</code>, any element node that has a prefix and is in the
<a title="XHTML namespace" class="termref" href="#xhtml-namespace">XHTML namespace</a>,
<a title="MathML namespace" class="termref" href="#mathml-namespace">MathML namespace</a>,
or <a title="SVG namespace" class="termref" href="#svg-namespace">SVG namespace</a>
<span class="verb">must</span> be serialized
with an unprefixed element name.  The <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span>
serialize an attribute with the name <code>xmlns</code> whose value is
equal to the namespace URI of the element node, unless an ancestor
element in the serialized result already has an attribute named
<code>xmlns</code> with the same value, and no intervening element 
has an attribute named <code>xmlns</code> with a different value.
If the element
node has a namespace node for the default namespace whose value is not
equal to the namespace URI of the element node,
the namespace node is ignored.
The <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must not</span> serialize a namespace declaration for the
namespace node declaring the element node’s prefix, unless an attribute
of the element node has the same prefix.


For namespace nodes in the result tree
that are not ignored, the HTML output method 
<span class="verb">must</span> represent these namespaces using
attributes named <code>xmlns</code> or <code>xmlns:</code><em>prefix</em>
in the same way as the XML output method would represent them when the
<code>version</code> parameter is set to <code>1.0</code>.</p>
                  </li>
                  <li>
                     <p>If the <a title="result tree" class="termref" href="#result-tree">result tree</a> contains elements or attributes whose names have a
<a title="non-null namespace URI" class="termref" href="#non-null-namespace-URI">non-null namespace URI</a>, the HTML output method

<span class="verb">must</span> generate
namespace-prefixed QNames for these nodes in the same way as the XML output
method would do when the <code>version</code> parameter is set to <code>1.0</code>.</p>
                  </li>
                  <li>
                     <p>Where special rules are defined later in this section for
serializing specific HTML elements and attributes, these rules

<span class="verb">must not</span> be 
applied to an element that is not to be
<a title="serialized as an HTML element" class="termref" href="#serialize-as-HTML">serialized as an HTML
element</a>
or an attribute whose name has
a <a title="non-null namespace URI" class="termref" href="#non-null-namespace-URI">non-null
namespace URI</a>. However, the generic rules for the HTML output method
that apply to all elements and attributes, for example the rules for
escaping special characters in the text and the rules for indentation,
<span class="verb">must</span> be used also for namespaced elements and attributes.</p>
                  </li>
                  <li>
                     <p>When serializing an element whose name is not defined in the
HTML specification, but that is
to be
<a title="serialized as an HTML element" class="termref" href="#serialize-as-HTML">serialized as an HTML
element</a>, the HTML output method

<span class="verb">must</span>
apply the same rules (for example, indentation rules) as
when serializing a <code>span</code> element. The descendants of such
an element 
<span class="verb">must</span> be serialized as if they were descendants of a
<code>span</code> element.</p>
                  </li>
                  <li>
                     <p>When serializing an element whose name is in a non-null
namespace, the HTML output method 
<span class="verb">must</span> apply the same rules (for
example, indentation rules) as when serializing a <code>div</code>
element. The descendants of such an element

<span class="verb">must</span> be serialized as if
they were descendants of a <code>div</code> element,
        except for the influence
          of the <code>cdata-section-elements</code> serialization parameter
          on any text node children of the element.
      </p>
                  </li>
               </ol>
               <p>The HTML output method 
<span class="verb">must not</span> output an end-tag for an empty element
if the element type has an empty content model,
and the value of the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>
is less than <code>5.0</code>, or the element is a void
element and the value of the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>
is <code>5.0</code>. For example, an element written as
<code>&lt;br/&gt;</code> or <code>&lt;br&gt;&lt;/br&gt;</code> in an
XSLT stylesheet 
<span class="verb">must</span> be output as <code>&lt;br&gt;</code>.</p>
               <p>For HTML 4.0, the
element types that have an empty content model are 
<code>area</code>, <code>base</code>, <code>basefont</code>,
<code>br</code>, <code>col</code>,
<code>embed</code>,
<code>frame</code>,
<code>hr</code>, <code>img</code>, <code>input</code>,
<code>isindex</code>, <code>link</code>, <code>meta</code> and
<code>param</code>.
For HTML5, the void elements are
<code>area</code>, <code>base</code>,
<code>br</code>, <code>col</code>, <code>embed</code>,
<code>hr</code>, <code>img</code>, <code>input</code>,
<code>keygen</code>, <code>link</code>, <code>meta</code>,
<code>param</code>, <code>source</code>, <code>track</code> and
<code>wbr</code>.  It is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
whether the <code>basefont</code>, <code>frame</code> and <code>isindex</code>
elements, which are not part of HTML5, are considered to be void elements when
the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>
has the value <code>5.0</code>.
</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>The markup generation step of the
<a title="" class="termref" href="#serphases">phases of serialization</a> only creates
start tags and end tags for the HTML output method, never XML-style
empty element tags.  As such, a <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> serialize an HTML
element that has no children, but whose content model is not empty,
using a pair of adjacent start and end element tags, or as a solitary
start tag if permitted by the context.
</p>
               </div>
               <p>For any element node that is to be
<a title="serialized as an HTML element" class="termref" href="#serialize-as-HTML">serialized as an HTML
element</a>,
the HTML output method 
<span class="verb">must</span>
compare the local part of the name of
the element node with the names of HTML elements,

making the comparison
<a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>.

If the local part of the name of the
element node compares equal to that of any HTML element, the element node
<span class="verb">must</span> be recognized as being that kind of HTML
element.
For example, elements named
<code>br</code>, <code>BR</code> or <code>Br</code> 
<span class="verb">must</span> all be
recognized as the HTML <code>br</code> element and output without an
end tag.</p>
               <p>The HTML output method 
<span class="verb">must not</span> perform escaping for

any text node
descendant, nor for any attribute of an element node descendant,
of
a
<code>script</code>
or
<code>style</code>
element.

</p>
               <div class="example">
                  <p>For example, a <code>script</code> element
created by an XQuery direct element constructor or an XSLT
literal result element, such as:</p>
                  <div class="exampleInner">
                     <pre>&lt;script&gt;if (a &amp;lt; b) foo()&lt;/script&gt;</pre>
                  </div>
                  <p>or</p>
                  <div class="exampleInner">
                     <pre>&lt;script&gt;&lt;![CDATA[if (a &lt; b) foo()]]&gt;&lt;/script&gt;</pre>
                  </div>
                  <p>
<span class="verb">must</span> be output as</p>
                  <div class="exampleInner">
                     <pre>&lt;script&gt;if (a &lt; b) foo()&lt;/script&gt;</pre>
                  </div>
               </div>
               <p>&nbsp;</p>
               <div class="example">
                  <p>A common requirement is to output a <code>script</code> element
as shown in the example below:</p>
                  <div class="exampleInner">
                     <pre>&lt;script type="application/ecmascript"&gt;
      document.write ("&lt;em&gt;This won't work&lt;/em&gt;")
&lt;/script&gt;</pre>
                  </div>
                  <p>This is
invalid
HTML, for the reasons explained in section B.3.2 of
the <a href="#html401">[HTML]</a> 4.01 specification. Nevertheless, it is possible to output
this fragment using either of the following constructs:</p>
                  <p>Firstly, by use of a <code>script</code> element
created by an XQuery direct element constructor or an
XSLT literal result element:</p>
                  <div class="exampleInner">
                     <pre>&lt;script type="application/ecmascript"&gt;
      document.write ("&lt;em&gt;This won't work&lt;/em&gt;")
&lt;/script&gt;</pre>
                  </div>
                  <p>Secondly, by constructing the markup from ordinary text characters:</p>
                  <div class="exampleInner">
                     <pre>&lt;script type="application/ecmascript"&gt;
      document.write ("&amp;lt;em&amp;gt;This won't work&amp;lt;/em&amp;gt;")
&lt;/script&gt;</pre>
                  </div>
                  <p>As the <a href="#html401">[HTML]</a> specification points out, the correct way to write this
is to use the escape conventions for the specific scripting language.
For JavaScript, it can be written as:</p>
                  <div class="exampleInner">
                     <pre>&lt;script type="application/ecmascript"&gt;
      document.write ("&amp;lt;em&amp;gt;This will work&amp;lt;\/em&amp;gt;")
&lt;/script&gt;</pre>
                  </div>
                  <p>The <a href="#html401">[HTML]</a> 4.01 specification also shows examples of how to write
this in various other scripting languages. The escaping <span class="verb">must</span> be done
explicitly; it will not be done by the <a title="serializer" class="termref" href="#serializer">serializer</a>.</p>
               </div>
            </div>
            <div class="div2">
               
               <h3><a id="HTML_ATTRIBS"></a>7.2 <a href="#HTML_ATTRIBS" style="text-decoration: none">Writing Attributes</a></h3>
               <p>The HTML output method
<span class="verb">must not</span> escape
"<code>&lt;</code>" characters occurring in attribute values.</p>
               <p>A boolean attribute is an
attribute with only a single allowed value in any of the HTML DTDs
or that is specified to be a boolean
attribute by HTML5 (see <a href="#html5">[HTML5]</a>), where the
allowed value is equal without regard to case
to the name of the attribute. 
The HTML output method <span class="verb">must</span> output any boolean attribute in minimized form if
and only if the value of the attribute node actually is equal to the name of
the attribute


making the comparison <a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>.

</p>
               <div class="example">
                  <p>For example, a start-tag created
using the following XQuery direct element constructor or XSLT
literal result element</p>
                  <div class="exampleInner">
                     <pre>&lt;OPTION selected="selected"&gt;</pre>
                  </div>
                  <p><span class="verb">must</span> be output as</p>
                  <div class="exampleInner">
                     <pre>&lt;OPTION selected&gt;</pre>
                  </div>
               </div>
               <p>The HTML output method 
<span class="verb">must not</span> escape a
<code>&amp;</code> character occurring in an attribute value
immediately followed by a <code>{</code> character (see <a href="http://www.w3.org/TR/REC-html40/appendix/notes.html#h-B.7.1.1">Section
B.7.1</a> of the HTML Recommendation <a href="#html401">[HTML]</a>).</p>
               <div class="example">
                  <p>For example, a start-tag created
using the following XQuery direct element constructor or XSLT
literal result element</p>
                  <div class="exampleInner">
                     <pre>&lt;BODY bgcolor='&amp;amp;{{randomrbg}};'&gt;</pre>
                  </div>
                  <p>
<span class="verb">must</span> be output as</p>
                  <div class="exampleInner">
                     <pre>&lt;BODY bgcolor='&amp;{randomrbg};'&gt;</pre>
                  </div>
               </div>
               <p>See <a href="#HTML_PARAMS"><b>7.4 The Influence of Serialization Parameters upon the HTML Output Method</b></a> for additional directives on how attributes <span class="verb">may</span> be written.</p>
            </div>
            <div class="div2">
               
               <h3><a id="HTML_CHARDATA"></a>7.3 <a href="#HTML_CHARDATA" style="text-decoration: none">Writing Character Data</a></h3>
               <p>The HTML output method <span class="verb">may</span> output a character using a
character entity reference in preference to using a numeric character
reference, if an entity is defined for the character in the version of
HTML that the output method is using. Entity references and character
references <span class="verb">should</span> be used only where the character is not present in
the selected encoding, or where the visual representation of the
character is unclear (as with <code>&amp;nbsp;</code>, for
example).</p>
               <p>When outputting a sequence of
<a title="whitespace character" class="termref" href="#whitespace-char">whitespace characters</a> in the
  <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>, within an element where
whitespace
characters are
treated normally
(but not in elements such as <code>pre</code> and
<code>textarea</code>), the HTML output method
<span class="verb">may</span>
represent it using any sequence of whitespace
characters that will be treated
in the same way by an HTML user agent. See section 3.5 of <a href="#xhtml-modularization">[XHTML Modularization]</a> for some additional information on
handling of whitespace by an HTML user agent
for versions of HTML prior to HTML5,
and see <a href="#html5">[HTML5]</a> for information on the handling of whitespace
characters by an HTML5 user agent.
</p>
               <div class="note">
                  <p class="prefix"><b>Note:</b></p>
                  <p>The terms space character
and whitespace character defined in HTML5 do not match the definition of
<a title="whitespace character" class="termref" href="#whitespace-char">whitespace character</a> in this
specification.</p>
               </div>
               <p>Certain characters are permitted in XML, but not in HTML prior to HTML5
— for example,
the control characters <span class="unicode-codepoint">U+007F</span> (<span class="unicode-name">DELETE</span>)  through <span class="unicode-codepoint">U+009F</span> (<span class="unicode-name">APC</span>)  are
permitted
in both XML 1.0 and XML 1.1, and
the control characters <span class="unicode-codepoint">U+0001</span> (<span class="unicode-name">SOH</span>)  through <span class="unicode-codepoint">U+0008</span> (<span class="unicode-name">BACKSPACE</span>) ,
  <span class="unicode-codepoint">U+000B</span> (<span class="unicode-name">VERTICAL TAB</span>) , <span class="unicode-codepoint">U+000C</span> (<span class="unicode-name">FORM FEED</span>)  and <span class="unicode-codepoint">U+000E</span> (<span class="unicode-name">SHIFT OUT</span>)  through <span class="unicode-codepoint">U+001F</span> (<span class="unicode-name">IS1</span>)  are
permitted in XML 1.1, but none of these is permitted in HTML prior to HTML5.

It is a
<a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0014" title="err:SERE0014">err:SERE0014</a>] to use the HTML
output method if such characters
appear in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>
and the value of the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>
is less than <code>5.0</code>. The
<a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> raise the error.</p>
               <p>The HTML output method 
<span class="verb">must</span> terminate processing
instructions with <code>&gt;</code> rather than
<code>?&gt;</code>.  It is a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0015" title="err:SERE0015">err:SERE0015</a>] to use the HTML output method when <code>&gt;</code> 
  appears within a processing instruction in <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>.</p>
            </div>
            <div class="div2">
               
               <h3><a id="HTML_PARAMS"></a>7.4 <a href="#HTML_PARAMS" style="text-decoration: none">The Influence of Serialization Parameters upon the HTML Output Method</a></h3>
               <p>The serialization parameters that affect the HTML output method are listed
    in the following subsections.</p>
               <p>Serialization parameters other than those listed are not applicable to this output
    method.  It is the responsibility of the
    <a title="host language" class="termref" href="#host-language">host language</a> to specify
    whether an error occurs if such a parameter is specified in combination
    with the HTML output method, or whether the parameter is ignored, or whether
    it is validated and then ignored.</p>
               <div class="div3">
                  
                  <h4><a id="HTML_VERSION"></a>7.4.1 <a href="#HTML_VERSION" style="text-decoration: none">HTML Output Method: the <code>version</code>
                        and <code>html-version</code>
                        Parameters</a></h4>
                  <p>The
<code>html-version</code> or the
<code>version</code> 
serialization parameter
indicates the version of the HTML
Recommendation <a href="#html401">[HTML]</a>
or <a href="#html5">[HTML5]</a>
to which the serialized result is
to conform.
[<a id="req-html-ver" title="requested HTML version">Definition</a>: 
If the
<code>html-version</code> serialization parameter is not absent, the
<b>requested HTML version</b> is the value of the
<code>html-version</code> serialization parameter; otherwise, it is
the value of the <code>version</code> serialization
parameter.]
If the <a title="serializer" class="termref" href="#serializer">serializer</a> does
not support the version of HTML specified by
the <a title="requested HTML version" class="termref" href="#req-html-ver">requested
HTML version</a>, it
<span class="verb">must</span> raise a
<a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSESU0013" title="err:SESU0013">err:SESU0013</a>].</p>
                  <p>This document provides the normative
definition of serialization for the HTML output method if the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML version</a>
has the lexical form of a value of type decimal whose value
is 1.0 or greater, but no greater than
5.0.  For any other value of
version parameter, the behavior is
<a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>.
In that case the
<a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
behavior <span class="verb">may</span> supersede all other requirements
of this recommendation.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_ENCODING"></a>7.4.2 <a href="#HTML_ENCODING" style="text-decoration: none">HTML Output Method: the <code>encoding</code> Parameter</a></h4>
                  <p>The <code>encoding</code> parameter specifies the encoding to be used.
<a title="serializer" class="termref" href="#serializer">Serializers</a> are
<span class="verb">required</span>  to support values of <code>UTF-8</code> and
<code>UTF-16</code>. A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSESU0007" title="err:SESU0007">err:SESU0007</a>] occurs if an output
encoding other than <code>UTF-8</code> or <code>UTF-16</code> is
requested and the <a title="serializer" class="termref" href="#serializer">serializer</a>
does not support that encoding. The <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> raise the error.
</p>
                  <p>It is possible that the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> will contain a character that
cannot be represented in the encoding that the <a title="serializer" class="termref" href="#serializer">serializer</a>
is using for
output. In this case, if the character occurs in a context where HTML
recognizes character references, then the character 
<span class="verb">must</span> be output
as a character entity reference or decimal numeric character
reference; otherwise (for example, in a <code>script</code> or
<code>style</code> element or in a comment), the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span>
raise a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0008" title="err:SERE0008">err:SERE0008</a>].
</p>
                  <p>See <a href="#HTML_INCLUDE-CONTENT-TYPE"><b>7.4.11 HTML Output Method: the include-content-type Parameter</b></a> regarding how this parameter is used with the <code>include-content-type</code> parameter.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_INDENT"></a>7.4.3 <a href="#HTML_INDENT" style="text-decoration: none">HTML Output Method: the <code>indent</code> and <code>suppress-indentation</code> Parameters</a></h4>
                  <p>If the <code>indent</code> parameter has 
the value <code>true</code>,
then the
HTML output method <span class="verb">may</span> add or remove whitespace as it
serializes the <a title="result tree" class="termref" href="#result-tree">result tree</a>,
if it observes the following
constraints.</p>
                  <ul>
                     <li>
                        <p>Whitespace <span class="verb">must not</span> be added other than before or
after an element, or adjacent to an existing whitespace character.</p>
                     </li>
                     <li>
                        <p>Whitespace <span class="verb">must not</span> be added or removed adjacent to
an inline element.  The inline elements are those included in the
<code>%inline</code> category of any of the HTML 4.01 DTDs
or those elements defined to be phrasing
elements in HTML5, as well as the
<code>ins</code> and <code>del</code> elements if they are used as inline
elements (i.e., if they do not contain element children).</p>
                     </li>
                     <li>
                        <p>Whitespace <span class="verb">must not</span> be added or removed inside a
formatted element, the formatted elements being <code>pre</code>,
<code>script</code>, <code>style</code>,
<code>title</code>,
and <code>textarea</code>.
</p>
                     </li>
                     <li>
                        <p>Whitespace characters
<span class="verb">must not</span> be added in the content of an element
whose expanded QName matches
a member of the list of expanded QNames in the
value of the <code>suppress-indentation</code> parameter.
The expanded QName of an element node
is considered to match a member of the list of expanded QNames
if:</p>
                        <ul>
                           <li>
                              <p>the two expanded QNames are equal;</p>
                           </li>
                           <li>
                              <p>the expanded QNames both have <a title="null namespace URI" class="termref" href="#null-namespace-URI">null
namespace URIs</a>, and the local parts of the two QNames are
equal <a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>; or
</p>
                           </li>
                           <li>
                              <p>the value of the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>
is <code>5.0</code>, the local parts of the two QNames are equal
<a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>
and one QName has a <a title="null namespace URI" class="termref" href="#null-namespace-URI">null namespace
URI</a> and the namespace URI of the other is equal to the XHTML
namespace URI.</p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The effect of the above constraints is to
ensure that any insertion or deletion of whitespace would not affect how a
conforming
HTML user agent would render the output, assuming the serialized document does
not refer to any HTML style sheets.</p>
                     <p>Note that the HTML definition of whitespace is different from the XML definition
(see section 9.1 of the <a href="#html401">[HTML]</a> specification).</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_CDATA-SECTION-ELEMENTS"></a>7.4.4 <a href="#HTML_CDATA-SECTION-ELEMENTS" style="text-decoration: none">HTML Output Method: the <code>cdata-section-elements</code> Parameter</a></h4>
                  <p>The <code>cdata-section-elements</code> parameter is not applicable to the HTML output method, except in the case of <a title="XML Island" class="termref" href="#XML-ISLAND">XML Islands</a>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_DOCTYPE"></a>7.4.5 <a href="#HTML_DOCTYPE" style="text-decoration: none">HTML Output Method: the <code>doctype-system</code> and <code>doctype-public</code> Parameters</a></h4>
                  <p>If the <code>doctype-public</code> or <code>doctype-system</code>
parameters are specified, then the HTML output method <span class="verb">must</span>
output a document type declaration.
If the
<code>doctype-public</code> parameter is specified, then the output
method 
<span class="verb">must</span> output <code>PUBLIC</code>
followed by the specified
public identifier; if the <code>doctype-system</code> parameter is
also specified, it 
<span class="verb">must</span> also output the specified
system identifier
following the public identifier. If the <code>doctype-system</code>
parameter is specified but the <code>doctype-public</code> parameter
is not specified, then the output method
<span class="verb">must</span> output
<code>SYSTEM</code> followed by the specified system identifier.</p>
                  <p>If the value of the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>
is <code>5.0</code>, the
<code>doctype-public</code> and <code>doctype-system</code> serialization
parameters are both absent,
the first element node child of
the document node that is to be serialized
is to be
<a title="serialized as an HTML element" class="termref" href="#serialize-as-HTML">serialized as an HTML
element</a>, the local part of the QName of which is equal to
the string <code>HTML</code>,
<a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>,
and any text node that precedes that
element node in the document contains only whitespace characters,
then
the HTML output method <span class="verb">must</span> output a document type
declaration, with no public or system identifier.</p>
                  <p>If the HTML output method <span class="verb">must</span>
output a document type declaration, it <span class="verb">must</span> be serialized
immediately before the first element, if any, and the name following
<code>&lt;!DOCTYPE</code> <span class="verb">must</span> be <code>HTML</code>
or <code>html</code>.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_NORMALIZATION-FORM"></a>7.4.6 <a href="#HTML_NORMALIZATION-FORM" style="text-decoration: none">HTML Output Method: the <code>normalization-form</code> Parameter</a></h4>
                  <p>The
<code>normalization-form</code>
parameter is applicable to the
HTML output method.
The values <code>NFC</code> and
<code>none</code> <span class="verb">must</span> be supported by the <a title="serializer" class="termref" href="#serializer">serializer</a>.
A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSESU0011" title="err:SESU0011">err:SESU0011</a>] results if the value of the <code>normalization-form</code>
parameter specifies a normalization form that is not supported by the
<a title="serializer" class="termref" href="#serializer">serializer</a>;
the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> raise the error.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_MEDIA-TYPE"></a>7.4.7 <a href="#HTML_MEDIA-TYPE" style="text-decoration: none">HTML Output Method: the <code>media-type</code> Parameter</a></h4>
                  <p>The <code>media-type</code> parameter is applicable to the
HTML output method.
See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more
information.  See <a href="#HTML_INCLUDE-CONTENT-TYPE"><b>7.4.11 HTML Output Method: the include-content-type Parameter</b></a> regarding how this parameter is used with the <code>include-content-type</code> parameter.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_USE-CHARACTER-MAPS"></a>7.4.8 <a href="#HTML_USE-CHARACTER-MAPS" style="text-decoration: none">HTML Output Method: the <code>use-character-maps</code> Parameter</a></h4>
                  <p>The <code>use-character-maps</code> parameter is applicable to the
HTML output method.  See <a href="#character-maps"><b>11 Character Maps</b></a> for more
information.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_BYTE-ORDER-MARK"></a>7.4.9 <a href="#HTML_BYTE-ORDER-MARK" style="text-decoration: none">HTML Output Method: the <code>byte-order-mark</code> Parameter</a></h4>
                  <p>The <code>byte-order-mark</code> parameter is
applicable to the HTML output method.  See
<a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_ESCAPE-URI-ATTRIBUTES"></a>7.4.10 <a href="#HTML_ESCAPE-URI-ATTRIBUTES" style="text-decoration: none">HTML Output Method: the <code>escape-uri-attributes</code> Parameter</a></h4>
                  <p>
If the <code>escape-uri-attributes</code> parameter
has the value <code>true</code>,
the HTML output method <span class="verb">must</span>
apply <a title="URI Escaping" class="termref" href="#uri-escaping">URI escaping</a> to 
<a title="URI attribute values" class="termref" href="#uri-attribute-values">URI attribute values</a>, except that relative URIs <span class="verb">must not</span> be absolutized.
</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This escaping is deliberately confined to non-ASCII characters,
because escaping of ASCII characters is not always appropriate, for
example when URIs or URI fragments are interpreted locally by the HTML
user agent. Even in the case of non-ASCII characters, escaping can
sometimes cause problems. More precise control of <a title="URI Escaping" class="termref" href="#uri-escaping">URI escaping</a> is
therefore available by setting <code>escape-uri-attributes</code> to
<code>false</code>, and controlling the escaping of URIs by using methods defined in
<a href="https://qt4cg.org/specifications/xpath-functions-40/#func-encode-for-uri">Section 7.2 fn:encode-for-uri</a><sup><small>FO</small></sup> and <a href="https://qt4cg.org/specifications/xpath-functions-40/#func-iri-to-uri">Section 7.4 fn:iri-to-uri</a><sup><small>FO</small></sup>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_INCLUDE-CONTENT-TYPE"></a>7.4.11 <a href="#HTML_INCLUDE-CONTENT-TYPE" style="text-decoration: none">HTML Output Method: the <code>include-content-type</code> Parameter</a></h4>
                  <p>If there is a <code>head</code> element,
and the <code>include-content-type</code> parameter has 
the value <code>true</code>,
the HTML output method
<span class="verb">must</span> add a <code>meta</code> element
as the first child element
of the <code>head</code> element specifying the character encoding
  actually used. <span>The <code>meta</code> element <span class="verb">may</span>
    take either the traditional form using
    an <code>http-equiv</code> attribute or the newer HTML5 form using a <code>charset</code>
    attribute.</span></p>
                  <div class="example">
                     <p>For example,</p>
                     <div class="exampleInner">
                        <pre>&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=EUC-JP"&gt;
...</pre>
                     </div>
                     <p>or</p>
                     <div class="exampleInner">
                        <pre>&lt;head&gt;
&lt;meta charset="EUC-JP"&gt;
...</pre>
                     </div>
                  </div>
                  <p>The content type<span>, if included,</span> <span class="verb">must</span>
be set to the value given for the
<code>media-type</code> parameter.</p>
                  <p>If a <code>meta</code> element has been added to the <code>head</code> element as described above,
then any existing <code>meta</code> element child of the <code>head</code> element having 
  <span>a <code>charset</code> attribute or</span>
  an <code>http-equiv</code> attribute with the value
"Content-Type", making the comparison

<a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>
after first stripping leading and trailing spaces from the value of
the attribute solely for the purposes of comparison,

<span class="verb">must</span> be discarded.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This process removes possible parameters in the
attribute value.  For example,</p>
                     <div class="exampleInner">
                        <pre>&lt;meta http-equiv="Content-Type" 
      content="text/html;version='4.0'"&gt;</pre>
                     </div>
                     <p>in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> 
    <span>might</span> be replaced by</p>
                     <div class="exampleInner">
                        <pre>&lt;meta http-equiv="Content-Type" 
      content="text/html;charset=utf-8"&gt;</pre>
                     </div>
                     <p>or by</p>
                     <div class="exampleInner">
                        <pre>&lt;meta charset="utf-8"&gt;</pre>
                     </div>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="HTML_ITEM-SEPARATOR"></a>7.4.12 <a href="#HTML_ITEM-SEPARATOR" style="text-decoration: none">HTML Output Method: the <code>item-separator</code> Parameter</a></h4>
                  <p>The effect of the <code>item-separator</code> serialization parameter
is described in <a href="#serdm"><b>2 Sequence Normalization</b></a>.</p>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="text-output"></a>8 <a href="#text-output" style="text-decoration: none">Text Output Method</a></h2>
            <p>The Text output method serializes the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> by
outputting the <a title="string value" class="termref" href="#dt-string-value">string value</a> of the
document node created by
the markup generation step of the
<a title="" class="termref" href="#serphases">phases of serialization</a> without any
escaping.</p>
            <p>A newline character in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> 
    <span class="verb">may</span> be output using any
character sequence that is conventionally used to represent a line
ending in the chosen system environment.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>The rule just stated applies to the character <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) ; it does
  not apply to occurrences in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> of 
  <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) , <code>U+0085</code>, or <code>U+2028</code>: these should be output
literally, regardless of the conventions for line endings in the
system environment.</p>
               <p>To illustrate, the following table shows the expected output
for various character sequences in environments which conventionally
use <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>)  (LF, as in Linux systems), <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>)  followed by <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>)  (CR+LF, Windows), 
  <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>)  (CR only, older versions of Mac OS),
  <code>U+0085</code> (some IBM operating systems),
  or <code>U+2028</code> to separate lines:</p>
               <table style="border:1px solid" class="medium no-code-break">
                  <caption>Expected output for various character sequences</caption>
                  <thead>
                     <tr>
                        <th style="text-align:left">Input</th>
                        <th style="text-align:left">#xA systems</th>
                        <th style="text-align:left">#xD#xA systems</th>
                        <th style="text-align:left">#xD systems</th>
                        <th style="text-align:left">#x85 systems</th>
                        <th style="text-align:left">#x2028 systems</th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr>
                        <td>character #xD</td>
                        <td>character #xD</td>
                        <td>character #xD</td>
                        <td>character #xD</td>
                        <td>character #xD</td>
                        <td>character #xD</td>
                     </tr>
                     <tr>
                        <td>character #xA</td>
                        <td>character #xA</td>
                        <td>string #xD + #xA</td>
                        <td>character #xD</td>
                        <td>character #x85</td>
                        <td>character #x2028</td>
                     </tr>
                     <tr>
                        <td>string #xD + #xA</td>
                        <td>string #xD + #xA</td>
                        <td>string #xD + #xD + #xA</td>
                        <td>string #xD + #xD</td>
                        <td>string #xD + #x85</td>
                        <td>string #xD + #x2028</td>
                     </tr>
                     <tr>
                        <td>string #xD + #xD + #xA</td>
                        <td>string #xD + #xD + #xA</td>
                        <td>string #xD + #xD + #xD + #xA</td>
                        <td>string #xD + #xD + #xD</td>
                        <td>string #xD + #xD + #x85</td>
                        <td>string #xD + #xD + #x2028</td>
                     </tr>
                  </tbody>
               </table>
            </div>
            <div class="div2">
               
               <h3><a id="TEXT_PARAMS"></a>8.1 <a href="#TEXT_PARAMS" style="text-decoration: none">The Influence of Serialization Parameters upon the Text Output Method</a></h3>
               <p>The serialization parameters that affect the Text output method are listed
    in the following subsections.</p>
               <p>Serialization parameters other than those listed are not applicable to this output
    method.  It is the responsibility of the
    <a title="host language" class="termref" href="#host-language">host language</a> to specify
    whether an error occurs if such a parameter is specified in combination
    with the Text output method, or whether the parameter is ignored, or whether
    it is validated and then ignored.</p>
               <div class="div3">
                  
                  <h4><a id="TEXT_ENCODING"></a>8.1.1 <a href="#TEXT_ENCODING" style="text-decoration: none">Text Output Method: the <code>encoding</code> Parameter</a></h4>
                  <p>The <code>encoding</code> parameter identifies the encoding that
the Text output method
<span class="verb">must</span> use to convert sequences of
characters to sequences of bytes.
<a title="serializer" class="termref" href="#serializer">Serializers</a>
are <span class="verb">required</span> to support values of <code>UTF-8</code> and
<code>UTF-16</code>.
A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSESU0007" title="err:SESU0007">err:SESU0007</a>]
occurs if the <a title="serializer" class="termref" href="#serializer">serializer</a>
does not support the encoding specified
by the <code>encoding</code> parameter.
The <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> raise the error.
  If the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> contains a
character that cannot be represented in the encoding that the
<a title="serializer" class="termref" href="#serializer">serializer</a> is using for output, the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span>
raise a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0008" title="err:SERE0008">err:SERE0008</a>].</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="TEXT_NORMALIZATION-FORM"></a>8.1.2 <a href="#TEXT_NORMALIZATION-FORM" style="text-decoration: none">Text Output Method: the <code>normalization-form</code> Parameter</a></h4>
                  <p>The <code>normalization-form</code>
parameter is applicable to the
Text output method.
The values <code>NFC</code>
and <code>none</code> <span class="verb">must</span> be supported by the <a title="serializer" class="termref" href="#serializer">serializer</a>.
A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSESU0011" title="err:SESU0011">err:SESU0011</a>] results if the value of the
<code>normalization-form</code> parameter specifies a normalization form
that is not supported by the <a title="serializer" class="termref" href="#serializer">serializer</a>; the
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> raise the
error.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="TEXT_MEDIA-TYPE"></a>8.1.3 <a href="#TEXT_MEDIA-TYPE" style="text-decoration: none">Text Output Method: the <code>media-type</code> Parameter</a></h4>
                  <p>The <code>media-type</code> parameter is applicable to the
Text output method.
See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more
information.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="TEXT_USE-CHARACTER-MAPS"></a>8.1.4 <a href="#TEXT_USE-CHARACTER-MAPS" style="text-decoration: none">Text Output Method: the <code>use-character-maps</code> Parameter</a></h4>
                  <p>The <code>use-character-maps</code> parameter is applicable to the
Text output method.
See <a href="#character-maps"><b>11 Character Maps</b></a> for more
information.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="TEXT_BYTE-ORDER-MARK"></a>8.1.5 <a href="#TEXT_BYTE-ORDER-MARK" style="text-decoration: none">Text Output Method: the <code>byte-order-mark</code> Parameter</a></h4>
                  <p>The <code>byte-order-mark</code> parameter is
applicable to the Text output method.  See
<a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="TEXT_ITEM-SEPARATOR"></a>8.1.6 <a href="#TEXT_ITEM-SEPARATOR" style="text-decoration: none">Text Output Method: the <code>item-separator</code> Parameter</a></h4>
                  <p>The effect of the <code>item-separator</code> serialization parameter
is described in <a href="#serdm"><b>2 Sequence Normalization</b></a>.</p>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="json-output"></a>9 <a href="#json-output" style="text-decoration: none">JSON Output Method</a></h2>
            <div class="changes">
               <p class="changesHeading">Changes in 4.0&nbsp;<a href="#adaptive-output">⬇</a>&nbsp;<a href="#html-output">⬆</a></p>
               <ol>
                  <li>
                     <p>
      Added the <code>escape-solidus</code> parameter for JSON serialization.
    <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/530">530</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/534">534</a>&nbsp;6 June 2023]</i></p>
                  </li>
                  <li>
                     <p>
      Added the <code>json-lines</code> parameter for JSON serialization.
    <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1471">1471</a>&nbsp;&nbsp;15 October 2024]</i></p>
                  </li>
                  <li>
                     <p>
      The serialization of maps retains the order of entries.
    <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1651">1651</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703</a>&nbsp;14 January 2025]</i></p>
                  </li>
               </ol>
            </div>
            <p>The JSON output method serializes the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>
    using the JSON syntax defined in <a href="#rfc7159">[RFC 7159]</a>,
    or (if the <code>json-lines</code> parameter is set to true) the <b>json-lines</b>
    syntax defined at <a href="#JSON-LINES">[JSON Lines]</a>.
    Sequence normalization is not performed for this output method.
    The effect of the <code>json-lines</code> parameter is explained at
    <a href="#id-json-lines"><b>9.1 JSON Lines</b></a>.</p>
            <p>If <code>json-lines</code> is set to <code>false</code>, then:</p>
            <ul>
               <li>
                  <p>If the <a title="input value" class="termref" href="#dt-input-value">input value</a> is an empty sequence, 
    it is serialized as the string <code>null</code>.</p>
               </li>
               <li>
                  <p>If the input value is a single item, it is serialized as
    described below.</p>
               </li>
               <li>
                  <p>If the input value is a sequence containing two or more items,
    a serialization error results [<a href="#ERRSERE0023" title="err:SERE0023">err:SERE0023</a>].
    </p>
               </li>
            </ul>
            <p>An individual item is serialized as follows:</p>
            <ul>
               <li>
                  <p>An <a title="array item" class="termref" href="#dt-array-item">array item</a> in the
  <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> is
serialized to a JSON array by outputting the serialized JSON value of
each member
 within the array separated by delimiters according to the
JSON array syntax, i.e. <code>[member, member, ...]</code>. Each member
in the array is to be serialized by recursively applying the rules
in this section.
</p>
               </li>
               <li>
                  <p>A <a title="map item" class="termref" href="#dt-map-item">map item</a> 
  in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>
is serialized to a JSON object by outputting, for each key/value pair,
the <a title="string value" class="termref" href="#dt-string-value">string value</a> of the key 
<a title="to a JSON string" class="termref" href="#to-a-json-string">to a JSON string</a>, followed by
the serialized JSON value of the entry,
separated by delimiters according to the JSON object 
syntax, i.e. <code>{key:value, key:value, ...}</code>.
The key/value pairs in the serialized output retain the 
  <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup> of entries in the map.</p>
                  <p>If any two keys of the map item have the same 
<a title="string value" class="termref" href="#dt-string-value">string value</a>,
serialization error [<a href="#ERRSERE0022" title="err:SERE0022">err:SERE0022</a>] is raised,
unless the <code>allow-duplicate-names</code> parameter has
the value <code>true</code>.
</p>
               </li>
               <li>
                  <p>
  A node in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>
is serialized <a title="to a JSON string" class="termref" href="#to-a-json-string">to a JSON string</a> by outputting 
the result of serializing the node using the method specified by the 
<code>json-node-output-method</code> parameter.  
The node is serialized with the serialization parameter <code>omit-xml-declaration</code> set
 to <code>true</code> and with no other serialization parameters set.

</p>
               </li>
               <li>
                  <p>An <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-atomic-item">atomic
  value</a><sup><small>XP</small></sup> in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> with a numeric type, or
derived from a numeric type <code>xs:float</code>, <code>xs:double</code> or <code>xs:decimal</code> is
serialized to a JSON number.
Implementations <span class="verb">may</span> serialize the
numeric value using any lexical representation of a JSON number defined in <a href="#rfc7159">[RFC 7159]</a>.
 If the numeric value cannot be 
represented in the JSON grammar (such as Infinity or NaN), then the 
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> 
raise a serialization error 
[<a href="#ERRSERE0020" title="err:SERE0020">err:SERE0020</a>].
</p>
               </li>
               <li>
                  <p>An <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-atomic-item">atomic item</a><sup><small>XP</small></sup> 
  in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>
of type <code>xs:boolean</code> and value <code>true</code>
is serialized to the JSON token <code>true</code>.</p>
               </li>
               <li>
                  <p>An <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-atomic-item">atomic item</a><sup><small>XP</small></sup> 
  in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>
of type <code>xs:boolean</code> and value <code>false</code> is
serialized to the JSON token <code>false</code>.</p>
               </li>
               <li>
                  <p>An <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-atomic-item">atomic item</a><sup><small>XP</small></sup> 
      of type <code>xs:QName</code> in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>
     whose namespace part is <code>"http://www.w3.org/2005/xpath-functions"</code> 
    and whose local part is <code>"null"</code> is
    serialized to the JSON token <code>null</code>.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This rule is introduced in 4.0, along with an option in the <code>fn:parse-json</code>
  function to allow a user-defined representation of the JSON value <code>null</code>. While
  the default representation of <code>null</code> as an empty sequence is usable in many
  circumstances, an explicit representation of <code>null</code> as a recognizable item can make
  some operations on JSON-derived values easier.</p>
                  </div>
               </li>
               <li>
                  <p>Any other <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-atomic-item">atomic
  value</a><sup><small>XP</small></sup> in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> 
is serialized <a title="to a JSON string" class="termref" href="#to-a-json-string">to a JSON string</a> by outputting the 
result of applying the <code>fn:string</code> function to the item.</p>
               </li>
               <li>
                  <p>An empty sequence in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> 
    is serialized to the JSON token <code>null</code>.</p>
               </li>
               <li>
                  <p>A sequence of length greater than 
  one in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> 
will result in a serialization error 
[<a href="#ERRSERE0023" title="err:SERE0023">err:SERE0023</a>].
</p>
               </li>
               <li>
                  <p>
  Any item in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> of a type not specified in the above 
list will result in a serialization error 
[<a href="#ERRSERE0021" title="err:SERE0021">err:SERE0021</a>].</p>
               </li>
            </ul>
            <p>
[<a id="to-a-json-string" title="to a JSON string">Definition</a>: Whenever a value is serialized
<b>to a JSON string</b>, the following procedure is applied to the supplied string:</p>
            <ol class="enumar">
               <li>
                  <p>Any character in the string for which character mapping is defined 
(see <a href="#character-maps"><b>11 Character Maps</b></a>) is substituted by the replacement string defined in the character map.</p>
               </li>
               <li>
                  <p>
Any other character in the input string (but not a character produced by character mapping) 
is a candidate for 
<a title="Unicode Normalization" class="termref" href="#unicode-normalization">Unicode Normalization</a> if requested by the <code>normalization-form</code> parameter,
and JSON escaping. JSON escaping replaces the characters 
quotation mark, backspace, form-feed, newline, carriage return, 
 tab, or reverse solidus by the corresponding JSON escape sequences
<code>\"</code>, <code>\b</code>, <code>\f</code>, <code>\n</code>,
  <code>\r</code>, <code>\t</code>, or <code>\\</code> 
respectively, and any other codepoint in the 
range 1-31 or 127-159 by an escape in the form <code>\uHHHH</code> 
where <code>HHHH</code> is the hexadecimal representation of the codepoint value.
  <span>Escaping further replaces the solidus character (<code>/</code>)
  by the escape sequence <code>\/</code> if the <code>escape-solidus</code> parameter
  is set to <code>true</code>, but not if it is
  set to <code>false</code>.</span>
Escaping is also applied to any characters that cannot be represented in the selected encoding.
</p>
               </li>
               <li>
                  <p>The resulting string is enclosed in double quotation marks.</p>
               </li>
            </ol>
            <p>]</p>
            <p>
Finally, encoding, as controlled by the <code>encoding</code> parameter, 
converts the character stream produced by the preceding rules into an octet stream.
</p>
            <div class="div2">
               
               <h3><a id="id-json-lines"></a>9.1 <a href="#id-json-lines" style="text-decoration: none">JSON Lines</a></h3>
               <p>When the <code>json-lines</code> parameter is set to <code>true</code>, the serialized
    output is written in <b>json-lines</b> format, as defined in <a href="#JSON-LINES">[JSON Lines]</a>.</p>
               <p>If <code>json-lines</code> is set to <code>true</code>, then each item
      in the <a title="input value" class="termref" href="#dt-input-value">input value</a> is serialized indepedently as a JSON text,
      and the resulting serializations are then concatenated using a single
      <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>)  character as a separator.
    </p>
               <p>If <code>json-lines</code> and <code>indent</code> are both set to true, then
     the serialization of each individual item may include added <span class="unicode-codepoint">U+0020</span> (<span class="unicode-name">SPACE</span>) 
      and <span class="unicode-codepoint">U+0009</span> (<span class="unicode-name">TAB</span>)  characters for formatting purposes, but it must not
      include <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>)  or <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>)  characters.</p>
               <p>The <b>json-lines</b> specification allows <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) 
      characters to appear, and does not treat them as significant; however, they are likely to
      cause practical problems. For example processing such input using the XPath expression
      <code>unparsed-text-lines($uri) ! parse-json()</code> would fail. The serializer
      <span class="verb">must not</span> output any <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>)  characters, either at the end
      of a line or elsewhere.</p>
               <p>The <b>json-lines</b> specification allows a terminating
      <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>)  character after the last line. In the interests of interoperability,
      however, the serializer <span class="verb">must not</span> output such a terminator.</p>
               <p>If the <a title="input value" class="termref" href="#dt-input-value">input value</a> is an empty sequence, then
      it is serialized as a zero-length string (rather than as the string <code>null</code>).</p>
               <p>The <code>item-separator</code> parameter has no effect.</p>
            </div>
            <div class="div2">
               
               <h3><a id="JSON_PARAMS"></a>9.2 <a href="#JSON_PARAMS" style="text-decoration: none">The Influence of Serialization Parameters upon the JSON Output Method</a></h3>
               <p>
When nodes are serialized using the JSON output method, 
serialization is delegated to the output method specified by the 
<code>json-node-output-method</code> serialization parameter.  The 
<code>omit-xml-declaration</code> parameter is set to <code>true</code>, and no other 
serialization parameters are passed down to the serialization 
method responsible for serializing the node.
</p>
               <p>The serialization parameters that affect the JSON output method are listed
    in the following subsections.</p>
               <p>Serialization parameters other than those listed are not applicable to this output
    method.  It is the responsibility of the
    <a title="host language" class="termref" href="#host-language">host language</a> to specify
    whether an error occurs if such a parameter is specified in combination
    with the JSON output method, or whether the parameter is ignored, or whether
    it is validated and then ignored.</p>
               <div class="div3">
                  
                  <h4><a id="JSON_ENCODING"></a>9.2.1 <a href="#JSON_ENCODING" style="text-decoration: none">JSON Output Method: the <code>encoding</code> Parameter</a></h4>
                  <p>The <code>encoding</code> parameter identifies the encoding that
the JSON output method
<span class="verb">must</span> use to convert sequences of
characters to sequences of bytes.
<a title="serializer" class="termref" href="#serializer">Serializers</a>
are <span class="verb">required</span> to support values of <code>UTF-8</code> and
<code>UTF-16</code>.
A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSESU0007" title="err:SESU0007">err:SESU0007</a>]
occurs if the <a title="serializer" class="termref" href="#serializer">serializer</a>
does not support the encoding specified
by the <code>encoding</code> parameter.
The <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> raise the error.
  If the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> contains a
character that cannot be represented in the encoding that the
<a title="serializer" class="termref" href="#serializer">serializer</a> is using for output, the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span>
raise a <a title="serialization error" class="termref" href="#serial-err">serialization error</a> 
[<a href="#ERRSERE0008" title="err:SERE0008">err:SERE0008</a>].</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>If an encoding other than UTF-8, UTF-16, UTF-32, US-ASCII, or an
equivalent is specified for the <code>encoding</code> parameter, the
output will (except in unusual circumstances) fail to conform to the
definition of JSON in <a href="#rfc7159">[RFC 7159]</a>.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="JSON_INDENT"></a>9.2.2 <a href="#JSON_INDENT" style="text-decoration: none">JSON Output Method: the <code>indent</code> Parameter</a></h4>
                  <p>The <code>indent</code> parameter
controls whether the <a title="serializer" class="termref" href="#serializer">serializer</a>
adjusts the whitespace in the serialized result so that a person will
find it easier to read. If the <code>indent</code> parameter has 
the value <code>true</code>,
the <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">may</span> output
additional whitespace characters adjacent to the JSON structural
tokens. For all other values, the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> output no whitespace characters adjacent to
the JSON structural tokens.
</p>
                  <p>If <code>indent</code> and <code>json-lines</code> are both <code>true</code>, 
  additional whitespace is allowed, but it <span class="verb">must not</span> include
the characters <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>)  or <span class="unicode-codepoint">U+000D</span> (<span class="unicode-name">CARRIAGE RETURN</span>) .</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="JSON_NORMALIZATION-FORM"></a>9.2.3 <a href="#JSON_NORMALIZATION-FORM" style="text-decoration: none">JSON Output Method: the <code>normalization-form</code> Parameter</a></h4>
                  <p>The <code>normalization-form</code>
parameter is applicable to the JSON output method.
The values <code>NFC</code>
and <code>none</code> <span class="verb">must</span> be supported by the <a title="serializer" class="termref" href="#serializer">serializer</a>.
A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSESU0011" title="err:SESU0011">err:SESU0011</a>] results if the value of the
<code>normalization-form</code> parameter specifies a normalization form
that is not supported by the <a title="serializer" class="termref" href="#serializer">serializer</a>; the
<a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">must</span> raise the
error.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="JSON_MEDIA-TYPE"></a>9.2.4 <a href="#JSON_MEDIA-TYPE" style="text-decoration: none">JSON Output Method: the <code>media-type</code> Parameter</a></h4>
                  <p>The <code>media-type</code> parameter is applicable to the
JSON output method.
See <a href="#serparam"><b>3 Serialization Parameters</b></a> for more
information.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="JSON_USE-CHARACTER-MAPS"></a>9.2.5 <a href="#JSON_USE-CHARACTER-MAPS" style="text-decoration: none">JSON Output Method: the <code>use-character-maps</code> Parameter</a></h4>
                  <p>The <code>use-character-maps</code> parameter is applicable to the
JSON output method.
See <a href="#character-maps"><b>11 Character Maps</b></a> for more
information.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="JSON_BYTE-ORDER-MARK"></a>9.2.6 <a href="#JSON_BYTE-ORDER-MARK" style="text-decoration: none">JSON Output Method: the <code>byte-order-mark</code> Parameter</a></h4>
                  <p>The <code>byte-order-mark</code> parameter is
applicable to the JSON output method.  See
<a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>Serialized output containing a byte-order mark does not
conform to the definition of JSON in <a href="#rfc7159">[RFC 7159]</a>
(although conforming JSON parsers are allowed to tolerate
the byte-order mark).</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="JSON_ESCAPE-SOLIDUS"></a>9.2.7 <a href="#JSON_ESCAPE-SOLIDUS" style="text-decoration: none">JSON Output Method: the <code>escape-solidus</code> Parameter</a></h4>
                  <p>The <code>escape-solidus</code> parameter is
      applicable to the JSON output method. If the value is <code>true</code>,
      then the solidus character (<code>"/"</code>) appearing in a string is escaped with a backslash
      (as <code>"\/"</code>). If the value is <code>false</code>,
    then it is not escaped.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>In previous versions of this specification, the solidus was always escaped. Although JSON does not require
  this character to be escaped, doing so provides extra safety when the generated JSON is embedded in an HTML <code>script</code>
  element, since an unintended <code>&lt;/script&gt;</code> end tag might otherwise cause the script to be prematurely
  terminated. In other situations, however, the escaping creates visual clutter and makes the output less readable.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="JSON_ALLOW-DUPLICATE-NAMES"></a>9.2.8 <a href="#JSON_ALLOW-DUPLICATE-NAMES" style="text-decoration: none">JSON Output Method: the <code>allow-duplicate-names</code> Parameter</a></h4>
                  <p>The <code>allow-duplicate-names</code> serialization parameter
determines whether the presence of multiple keys in a map item
with the same string value (e.g. the date 2014-10-01 and the string
"<code>2014-10-01</code>") will or will not raise serialization error
[<a href="#ERRSERE0022" title="err:SERE0022">err:SERE0022</a>].  If the value is 
<code>true</code>,
such duplicate keys will result in duplicate object-member names in
the JSON output and no error will be raised because of the duplicate names.
If the value is <code>false</code>,
such duplicate keys are an error 
([<a href="#ERRSERE0022" title="err:SERE0022">err:SERE0022</a>]).</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="JSON_JSON-NODE-OUTPUT-METHOD"></a>9.2.9 <a href="#JSON_JSON-NODE-OUTPUT-METHOD" style="text-decoration: none">JSON Output Method: the <code>json-node-output-method</code> Parameter</a></h4>
                  <p>
The <code>json-node-output-method</code> serialization parameter determines how a node 
  in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> gets converted to a JSON value.  
If the value is one of <code>xml</code>, <code>xhtml</code>, <code>html</code> or <code>text</code>, 
then the node is converted <a title="to a JSON string" class="termref" href="#to-a-json-string">to a JSON string</a> by serializing the node using the output method 
specified by this parameter.  If the value is <code>xml</code> or <code>xhtml</code> then 
the node is serialised with the additional serialization parameter <code>omit-xml-declaration</code> 
set to <code>true</code>.
</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="JSON_JSON-LINES"></a>9.2.10 <a href="#JSON_JSON-LINES" style="text-decoration: none">JSON Output Method: the <code>json-lines</code> Parameter</a></h4>
                  <p>The <code>json-lines</code> serialization parameter determines if items are serialized
according to the <a href="#JSON-LINES">[JSON Lines]</a> format, as described in <a href="#id-json-lines"><b>9.1 JSON Lines</b></a>.
</p>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="adaptive-output"></a>10 <a href="#adaptive-output" style="text-decoration: none">Adaptive Output Method</a></h2>
            <div class="changes">
               <p class="changesHeading">Changes in 4.0&nbsp;<a href="#ADAPTIVE_PARAMS">⬇</a>&nbsp;<a href="#json-output">⬆</a></p>
               <ol>
                  <li>
                     <p>
      The serialization of maps retains the order of entries.
    <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/1651">1651</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703</a>&nbsp;14 January 2025]</i></p>
                  </li>
               </ol>
            </div>
            <p>The Adaptive output method serializes the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> 
into a human readable form for the purposes of debugging query results.

The intention of this is to allow any <a title="input value" class="termref" href="#dt-input-value">input value</a> to be serialized 
without raising a serialization error.
Sequence normalization is not performed for this output method.
</p>
            <p>Each item in the supplied sequence is serialized individually as
follows, with an occurrence of the chosen <code>item-separator</code>
between successive items.</p>
            <ul>
               <li>
                  <p>A document, element, text, comment, or processing instruction
node is serialized using the XML
output method described in <a href="#xml-output"><b>5 XML Output Method</b></a>.</p>
               </li>
               <li>
                  <p>An attribute or namespace <a title="node" class="termref" href="#dt-node">node</a> is serialized as if it had a containing
element node.  For example an
attribute node might be serialized as the string
<code>xsi:type="xs:integer"</code>; a namespace node might be
serialized as
<code>xmlns:sns="http://example.com/sample-namespace"</code>.
</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>This may result in output of QNames containing prefixes whose
binding is not displayed.</p>
                  </div>
               </li>
               <li>
                  <p>An <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-atomic-item">atomic
value</a><sup><small>XP</small></sup> is serialized as follows:</p>
                  <ul>
                     <li>
                        <p>An instance of <code>xs:boolean</code> is serialized as <code>true()</code> or <code>false()</code>. </p>
                     </li>
                     <li>
                        <p>An instance of <code>xs:string</code>, <code>xs:untypedAtomic</code>
 or <code>xs:anyURI</code>
is serialized by enclosing the value in double 
quotation marks and doubling any quotes within the value; or optionally by enclosing the value 
in apostrophes and doubling any apostrophes within the value.
The resulting value is then serialized using the Text output method 
described in <a href="#text-output"><b>8 Text Output Method</b></a>.
</p>
                        <div class="note">
                           <p class="prefix"><b>Note:</b></p>
                           <p>The Text output method will apply character expansion and encoding rules to this 
string as specified by the serialization parameters.</p>
                        </div>
                     </li>
                     <li>
                        <p>An instance of <code>xs:integer</code> or <code>xs:decimal</code> is serialized by converting 
the value to a string using the <code>fn:string</code> function.</p>
                     </li>
                     <li>
                        <p>An instance of <code>xs:double</code> is serialized by applying the function 
<code>format-number(?, '0.0##########################e0')</code>
using the following default decimal format properties:</p>
                        <table class="medium no-code-break">
                           <caption>Decimal format</caption>
                           <col style="width:180px" span="1">
                           <col span="1">
                           <thead>
                              <tr>
                                 <th style="text-align:left">Property name</th>
                                 <th style="text-align:left">Property value</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td><code>decimal-separator</code></td>
                                 <td><span class="unicode-codepoint">U+002E</span> (<span class="unicode-name">FULL STOP, PERIOD</span>, <code>.</code>) </td>
                              </tr>
                              <tr>
                                 <td><code>exponent-separator</code></td>
                                 <td><span class="unicode-codepoint">U+0065</span> (<span class="unicode-name">LATIN SMALL LETTER E</span>, <code>e</code>) </td>
                              </tr>
                              <tr>
                                 <td><code>grouping-separator</code></td>
                                 <td><span class="unicode-codepoint">U+002C</span> (<span class="unicode-name">COMMA</span>, <code>,</code>) </td>
                              </tr>
                              <tr>
                                 <td><code>zero-digit</code></td>
                                 <td><span class="unicode-codepoint">U+0030</span> (<span class="unicode-name">DIGIT ZERO</span>, <code>0</code>) </td>
                              </tr>
                              <tr>
                                 <td><code>digit</code></td>
                                 <td><span class="unicode-codepoint">U+0023</span> (<span class="unicode-name">NUMBER SIGN</span>, <code>#</code>) </td>
                              </tr>
                              <tr>
                                 <td><code>infinity</code></td>
                                 <td>The string "INF"</td>
                              </tr>
                              <tr>
                                 <td><code>NaN</code></td>
                                 <td>The string "NaN"</td>
                              </tr>
                              <tr>
                                 <td><code>minus-sign</code></td>
                                 <td><span class="unicode-codepoint">U+002D</span> (<span class="unicode-name">HYPHEN-MINUS</span>, <code>-</code>) </td>
                              </tr>
                           </tbody>
                        </table>
                     </li>
                     <li>
                        <p>An instance of <code>xs:QName</code> or <code>xs:NOTATION</code> is serialized 
as a URI-qualified name (that is, in the form <code>Q{uri}local</code>).</p>
                     </li>
                     <li>
                        <p>An atomic item of any other type is serialized using the syntax of a constructor 
function: <code>xs:TYPE("VAL")</code> where <code>TYPE</code> is the name of the primitive 
type, and <code>VAL</code> is the result of applying the <code>fn:string()</code> function.
 For example, <code>xs:date("2015-07-17")</code>.
 The resulting string is then serialized using the Text output method 
described in <a href="#text-output"><b>8 Text Output Method</b></a>.</p>
                     </li>
                  </ul>
               </li>
               <li>
                  <p>
An <a title="array item" class="termref" href="#dt-array-item">array item</a> is serialized using the syntax 
of a <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#SquareArrayConstructor">SquareArrayConstructor</a><sup><small>XP</small></sup>, 
that is as <code>[member, member, ... ]</code>. The members, which in general are sequences, 
are serialized in the form <code>(item, item, ...)</code> where the items are serialized by 
applying these rules recursively. The items are separated by commas 
(not by the <code>item-separator</code> character). The enclosing parentheses are optional if the sequence 
has length one. </p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>The serializer should avoid outputting the parentheses if it is able 
to determine the length of the sequence before serializing the first item; but it is allowed 
to output parentheses around a singleton if this avoids buffering data in memory.</p>
                  </div>
               </li>
               <li>
                  <p>
A <a title="map item" class="termref" href="#dt-map-item">map item</a> is serialized using the syntax of a 
<a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#doc-xpath40-MapConstructor">MapConstructor</a><sup><small>XP</small></sup> without the optional <code>map</code>
keyword, that is in the format <code>{key:value, key:value, ...}</code>.
The key/value pairs in the serialized output retain the 
  <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dt-entry-order">entry order</a><sup><small>DM</small></sup> of entries in the map.
   The key is serialized by applying the rules 
for serializing an atomic item. The values are serialized in the same way as the members of an array (see above).
</p>
               </li>
               <li>
                  <p>A <a title="function item" class="termref" href="#dt-function-item">function item</a> is
serialized to the representation <code>name#A</code> where 
<var>fn:name</var> is a representation of
the function name and <var>A</var> is the arity. 
If the function name is in one of the namespaces
<code>http://www.w3.org/2005/xpath-functions</code>,
<code>http://www.w3.org/2005/xpath-functions/math</code>,
<code>http://www.w3.org/2005/xpath-functions/map</code>,
<code>http://www.w3.org/2005/xpath-functions/array</code> or
<code>http://www.w3.org/2001/XMLSchema</code>,
then the name is output as a lexical QName using the conventional prefix 
<code>fn</code>, <code>math</code>, <code>map</code>, <code>array</code>, or <code>xs</code>
as appropriate; if it is in any other namespace or in no namespace, then the name is 
output as a URI-qualified name (that is, <code>Q{uri}local</code>).
 
If the function is anonymous,
<var>name</var> is replaced by the string
<code>(anonymous-function)</code>.  </p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>
The following examples illustrate this rule:</p>
                     <ul>
                        <li>
                           <p><code>fn:exists#1</code> is serialized as <code>function fn:exists#1</code></p>
                        </li>
                        <li>
                           <p><code>Q{http://www.w3.org/2005/xpath-functions}exists#1</code> is serialized as <code>fn:exists#1</code></p>
                        </li>
                        <li>
                           <p><code>function($a) { $a }</code> is serialized as <code>(anonymous-function)#1</code></p>
                        </li>
                        <li>
                           <p><code>math:pi#0</code> is serialized as <code>math:pi#0</code></p>
                        </li>
                     </ul>
                  </div>
               </li>
            </ul>
            <p>Character maps are applied (a) when nodes are serialized using the XML 
output method, and (b) to any value represented as a string enclosed in quotation marks.</p>
            <p>Optionally, in all the above constructs, characters whose visual 
representation is ambiguous (for example tab or non-breaking-space) may be represented in the 
form of an XML numeric character reference (for example <code>&amp;#x9;</code> or <code>&amp;#xa0;</code>)</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>
In many cases the serialization of an item conforms to the syntax of an XQuery expression whose result 
is that item. There are exceptions, however. For example, the syntax will not be valid XQuery in the 
case of free-standing attribute or namespace nodes, or QName values, or anonymous functions; and where 
it is valid XQuery, the result of evaluating the expression will not necessarily be identical to the 
original: for example, the distinction between strings and untypedAtomic items is lost.
</p>
            </div>
            <p>
If any value cannot be output because doing so would cause a
serialization error, the behavior is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>.
</p>
            <p>
If the output is sent to a destination that allows hyperlinks to be included in the 
generated text, then the serializer <span class="verb">may</span> include 
<a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a> 
hyperlinks to provide additional information for example:</p>
            <ul>
               <li>
                  <p>
to allow the type of <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#dt-atomic-item">atomic items</a><sup><small>XP</small></sup>
to be ascertained.
</p>
               </li>
               <li>
                  <p>
to allow the namespace binding of prefixes to be ascertained.
</p>
               </li>
               <li>
                  <p>
to provide further information about the cause of error indicators.
</p>
               </li>
            </ul>
            <div class="div2">
               
               <h3><a id="ADAPTIVE_PARAMS"></a>10.1 <a href="#ADAPTIVE_PARAMS" style="text-decoration: none">The Influence of Serialization Parameters upon the Adaptive Output Method</a></h3>
               <div class="changes">
                  <p class="changesHeading">Changes in 4.0&nbsp;<a href="#adaptive-output">⬆</a></p>
                  <ol>
                     <li>
                        <p>
      Added the <code>escape-solidus</code> parameter for JSON serialization.
    <i>&nbsp;&nbsp;[Issue <a href="https://github.com/qt4cg/qtspecs/issues/530">530</a>&nbsp;PR <a href="https://github.com/qt4cg/qtspecs/pull/534">534</a>&nbsp;6 June 2023]</i></p>
                     </li>
                  </ol>
               </div>
               <p>
For some item types the Adaptive output method will delegate serialization to other output methods. 
With the exception of the <code>byte-order-mark</code> serialization parameter, all serialization parameters, 
if set, will be passed down to the serialization method that is applied to each item in the supplied sequence. 
Only the <code>item-separator</code> and <code>byte-order-mark</code> parameters are directly applicable to the Adaptive output method. 
</p>
               <div class="div3">
                  
                  <h4><a id="ADAPTIVE_OMIT-XML-DECLARATION"></a>10.1.1 <a href="#ADAPTIVE_OMIT-XML-DECLARATION" style="text-decoration: none">Adaptive Output Method: the <code>omit-xml-declaration</code> and <code>standalone</code> Parameters</a></h4>
                  <p>The <code>omit-xml-declaration</code> and <code>standalone</code>
parameters are not directly applicable to the Adaptive output
method.</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>
If these parameters call for an XML declaration to be serialized, then
an XML declaration is to be output each time the Adaptive output
method delegates the serialization of a node to the XML output method.
If several node items appear in the sequence to be serialized or as
values in maps or arrays to be serialized, then the output will
contain several XML declarations.  

</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="ADAPTIVE_USE-CHARACTER-MAPS"></a>10.1.2 <a href="#ADAPTIVE_USE-CHARACTER-MAPS" style="text-decoration: none">Adaptive Output Method: the <code>use-character-maps</code> Parameter</a></h4>
                  <p>The <code>use-character-maps</code> parameter is applicable to the
Adaptive output method only as elsewhere specified.
</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="ADAPTIVE_BYTE-ORDER-MARK"></a>10.1.3 <a href="#ADAPTIVE_BYTE-ORDER-MARK" style="text-decoration: none">Adaptive Output Method: the <code>byte-order-mark</code> Parameter</a></h4>
                  <p>The <code>byte-order-mark</code> parameter is applicable to the
Adaptive output method. See
<a href="#serparam"><b>3 Serialization Parameters</b></a> for more information.
</p>
                  <div class="note">
                     <p class="prefix"><b>Note:</b></p>
                     <p>A byte order mark can appear only once in the serialized output.
Therefore, this parameter does not get passed down to any delegated output method.</p>
                  </div>
               </div>
               <div class="div3">
                  
                  <h4><a id="ADAPTIVE_ESCAPE-SOLIDUS"></a>10.1.4 <a href="#ADAPTIVE_ESCAPE-SOLIDUS" style="text-decoration: none">Adaptive Output Method: the <code>escape-solidus</code> Parameter</a></h4>
                  <p>The <code>escape-solidus</code> parameter is
    applicable to the Adaptive output method only as elsewhere specified.</p>
               </div>
               <div class="div3">
                  
                  <h4><a id="ADAPTIVE_ITEM-SEPARATOR"></a>10.1.5 <a href="#ADAPTIVE_ITEM-SEPARATOR" style="text-decoration: none">Adaptive Output Method: the <code>item-separator</code> Parameter</a></h4>
                  <p>The <code>item-separator</code> serialization parameter is directly applicable to the
Adaptive output method. It specifies the string to be inserted between
adjacent serialized items.
 If the <code>item-separator</code> parameter is absent, the character <span class="unicode-codepoint">U+000A</span> (<span class="unicode-name">NEWLINE</span>) 
 is used by the Adaptive output method as the 
 <code>item-separator</code> value.

</p>
               </div>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="character-maps"></a>11 <a href="#character-maps" style="text-decoration: none">Character Maps</a></h2>
            <p>The <code>use-character-maps</code> parameter is a list of characters
and corresponding string substitutions.</p>
            <p>Character maps allow a specific character appearing in a text or
attribute node or a string 
in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> to be replaced with a specified
string of characters during serialization. The string that is
substituted is output "as is," and the <a title="serializer" class="termref" href="#serializer">serializer</a> performs no checks
that the resulting document is well-formed. This mechanism can
therefore be used to introduce arbitrary markup in the serialized
output.
See <a href="https://qt4cg.org/specifications/xslt-40/#character-maps">Section 26.3 Character Maps</a><sup><small>XT</small></sup>
of <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a> for examples of using character mapping in
XSLT.</p>
            <p>Character mapping is applied to the characters that actually appear
in a text or attribute node or a string
in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a>, before any other
serialization operations such as escaping or <a title="Unicode Normalization" class="termref" href="#unicode-normalization">Unicode Normalization</a> are
applied. If a character is mapped, then it is not subjected to XML or
HTML escaping, nor to Unicode Normalization. The string that is
substituted for a character is not validated or processed in any way
by the <a title="serializer" class="termref" href="#serializer">serializer</a>, except for translation into the target encoding. In
particular, it is not subjected to XML or HTML escaping, it is not
subjected to Unicode Normalization, and it is not subjected to further
character mapping.  </p>
            <p>Character mapping is not applied to characters in text nodes whose
parent elements are listed in the <code>cdata-section-elements</code>
parameter,

nor to characters for which output escaping has
been disabled (disabling output escaping is an <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a>
feature),

nor to characters in attribute
values that are subject to <a title="URI Escaping" class="termref" href="#uri-escaping">URI escaping</a> defined for the HTML and
XHTML output methods, unless <a title="URI Escaping" class="termref" href="#uri-escaping">URI escaping</a> has been disabled using the
<code>escape-uri-attributes</code> parameter in the output
definition.</p>
            <p>On serialization, occurrences of a character specified in the
<code>use-character-maps</code> in text nodes, attribute values
and strings
are replaced by the corresponding string from the <code>use-character-maps</code>
parameter.</p>
            <div class="note">
               <p class="prefix"><b>Note:</b></p>
               <p>Using a character map can result in non-well-formed documents
if the string contains XML-significant
characters. For example, it is possible to create documents containing
unmatched start and end tags, references to entities that are not
declared, or attributes that contain tags or unescaped quotation
marks.</p>
            </div>
            <p>If a character is mapped, then it is not subjected to XML or HTML escaping.</p>
            <p>A <a title="serialization error" class="termref" href="#serial-err">serialization error</a> [<a href="#ERRSERE0008" title="err:SERE0008">err:SERE0008</a>] occurs if character mapping causes the output
of a string containing a character that cannot be represented in the
encoding that the <a title="serializer" class="termref" href="#serializer">serializer</a>
is using for output. The <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> raise the error.</p>
         </div>
         <div class="div1">
            
            <h2><a id="conformance"></a>12 <a href="#conformance" style="text-decoration: none">Conformance</a></h2>
            <p>Serialization is intended primarily as a component
of a <a title="host language" class="termref" href="#host-language">host language</a>.
[<a id="host-language" title="host language">Definition</a>: 
A <b>host language</b> is another
specification that includes, by reference, this specification and all of
its requirements.  A host language might be a programming language
such as <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a> or <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a>, or it
might be an application programming interface (API) intended to be used by
programs written in some other high-level programming language.  The use of
the term <em>language</em> is not intended to preclude the possibility that
this specification might be referenced outside the context of a
programming language specification.]
This document
relies on specifications that use it to specify conformance criteria
for Serialization in their respective environments.
Specifications that set conformance criteria for their use of
Serialization <span class="verb">must not</span> change the semantic definitions of 
Serialization as given in this specification, except by
subsetting and/or compatible extensions.  It is the responsibility of the <a title="host language" class="termref" href="#host-language">host language</a> to specify how <a title="serialization error" class="termref" href="#serial-err">serialization errors</a>
are to
be handled.</p>
            <p>Certain facilities in this specification are described as producing 
<a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> results. A
claim that asserts conformance with this specification <span class="verb">must</span> be accompanied by documentation
stating the effect of each implementation-defined feature. For convenience, a non-normative
checklist of implementation-defined features is provided at 
<a href="#implementation-defined-features"><b>F.1 Checklist of Implementation-Defined Features</b></a>.</p>
         </div>
      </div>
      <div class="back">
         <div class="div1">
            
            <h2><a id="references"></a>A <a href="#references" style="text-decoration: none">References</a></h2>
            <div class="div2">
               
               <h3><a id="normative-references"></a>A.1 <a href="#normative-references" style="text-decoration: none">Normative References</a></h3>
               <dl>
                  <dt class="label"><span><a id="charmod-norm"></a>Character Model for the World Wide Web 1.0: Normalization</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/charmod-norm/"><cite>Character Model for the World Wide Web 1.0: Normalization</cite></a>, François Yergeau, Martin Dürst, Richard Ishida, <em>et. al.</em>, Editors. World Wide Web Consortium, 01&nbsp;May&nbsp;2012. This version is http://www.w3.org/TR/2012/WD-charmod-norm-20120501/.
                        The <a href="http://www.w3.org/TR/charmod-norm/">latest version</a> is available at http://www.w3.org/TR/charmod-norm/.</div>
                  </dd>
                  <dt class="label"><span><a id="xpath-datamodel-40"></a>XQuery and XPath Data Model (XDM) 4.0</span></dt>
                  <dd>
                     <div>
                        <a href="https://qt4cg.org/specifications/xpath-datamodel-40/Overview.html"><cite>XQuery and XPath Data Model (XDM) 4.0</cite></a>,
                        XSLT Extensions Community Group,
                        World Wide Web Consortium.</div>
                  </dd>
                  <dt class="label"><span><a id="xpath-functions-40"></a>XQuery and XPath Functions and Operators 4.0</span></dt>
                  <dd>
                     <div>
                        <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html"><cite>XQuery and XPath Functions and Operators 4.0</cite></a>,
                        XSLT Extensions Community Group,
                        World Wide Web Consortium.</div>
                  </dd>
                  <dt class="label"><span><a id="html5"></a>HTML5</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/html5/"><cite>HTML5</cite></a>, Robin Berjon, Steve Faulkner, Travis Leithead, <em>et. al.</em>, Editors. World Wide Web Consortium, 04&nbsp;Feb&nbsp;2014. This version is http://www.w3.org/TR/2014/CR-html5-20140204/.
                        The <a href="http://www.w3.org/TR/html5/">latest version</a> is available at http://www.w3.org/TR/html5/.</div>
                  </dd>
                  <dt class="label"><span><a id="html401"></a>HTML</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/html401/"><cite>HTML 4.01 Specification</cite></a>, Dave Raggett, Arnaud Le Hors, and Ian Jacobs, Editors. World Wide Web Consortium,
                        24&nbsp;Dec&nbsp;1999. This version is http://www.w3.org/TR/1999/REC-html401-19991224/. The
                        <a href="http://www.w3.org/TR/html401/">latest version</a> is available at http://www.w3.org/TR/html401/</div>
                  </dd>
                  <dt class="label"><span><a id="html-polyglot"></a>POLYGLOT</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/html-polyglot/"><cite>Polyglot Markup: A robust profile of the HTML5 vocabulary</cite></a>, Eliot Graff and Leif Halvard Silli, Editors. World Wide Web Consortium, 04&nbsp;Feb&nbsp;2014.
                        This version is http://www.w3.org/TR/2014/WD-html-polyglot-20140204/. The <a href="http://www.w3.org/TR/html-polyglot/">latest version</a> is available at http://www.w3.org/TR/html-polyglot/.</div>
                  </dd>
                  <dt class="label"><span><a id="IANA"></a>IANA</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.iana.org/assignments/character-sets"><cite>Character Sets</cite></a>.
                        Internet Assigned Numbers Authority.
                        Oct 2012.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="RFC2046"></a>RFC2046</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.ietf.org/rfc/rfc2046.txt"><cite>Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</cite></a>,
                        N. Freed, N. Borenstein.
                        Network Working Group, IETF,
                        Nov 1996.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="RFC2119"></a>RFC2119</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>,
                        S. Bradner.
                        Network Working Group, IETF,
                        Mar 1997.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="RFC2978"></a>RFC2978</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.ietf.org/rfc/rfc2978.txt"><cite>IANA Charset Registration Procedures</cite></a>,
                        N. Freed and J. Postel
                        Network Working Group, IETF,
                        Oct 2000.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="RFC2854"></a>RFC2854</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.ietf.org/rfc/rfc2854.txt"><cite>The 'text/html' Media Type</cite></a>,
                        D. Connolly, L. Masinter.
                        Network Working Group, IETF,
                        Jun 2000.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="RFC3236"></a>RFC3236</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.ietf.org/rfc/rfc3236.txt"><cite>The 'application/xhtml+xml' Media Type</cite></a>,
                        M. Baker and P. Stark.
                        Network Working Group, IETF,
                        Jan 2002.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="UNICODE-ENCODING"></a>Unicode Encoding</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.unicode.org/reports/tr17/"><cite>Unicode
                              Character Encoding Model</cite></a>,
                        Unicode Consortium.
                        Unicode Standard Annex #17.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="UNICODE-NORMALIZATION-FORM"></a>UAX #15: Unicode Normalization Forms</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.unicode.org/reports/tr15/"><cite>Unicode
                              Normalization Forms</cite></a>,
                        Unicode Consortium.
                        Unicode Standard Annex #15.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="JSON-LINES"></a>JSON Lines</span></dt>
                  <dd>
                     <div>
                        <a href="https://jsonlines.org/"><cite>JSON Lines</cite></a>.
                        Maintained by Ian Ward.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="xhtml1"></a>XHTML 1.0</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xhtml1/"><cite>XHTML™ 1.0 The Extensible HyperText Markup Language (Second Edition)</cite></a>, Steven Pemberton, Editor. World Wide Web Consortium, 01&nbsp;Aug&nbsp;2002. This version is
                        http://www.w3.org/TR/2002/REC-xhtml1-20020801. The <a href="http://www.w3.org/TR/xhtml1/">latest version</a> is available at http://www.w3.org/TR/xhtml1/.</div>
                  </dd>
                  <dt class="label"><span><a id="xhtml11"></a>XHTML 1.1</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xhtml11/"><cite>XHTML™ 1.1 - Module-based XHTML - Second Edition</cite></a>, Shane McCarron and Masayasu Ishikawa, Editors. World Wide Web Consortium, 23&nbsp;Nov&nbsp;2010.
                        This version is http://www.w3.org/TR/2010/REC-xhtml11-20101123. The <a href="http://www.w3.org/TR/xhtml11/">latest version</a> is available at http://www.w3.org/TR/xhtml11/.</div>
                  </dd>
                  <dt class="label"><span><a id="xml"></a>XML10</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml/"><cite>Extensible Markup Language (XML) 1.0 (Fifth Edition)</cite></a>, Tim Bray, Jean Paoli, Michael Sperberg-McQueen, <em>et. al.</em>, Editors. World Wide Web Consortium, 26&nbsp;Nov&nbsp;2008. This version is http://www.w3.org/TR/2008/REC-xml-20081126/.
                        The <a href="http://www.w3.org/TR/xml/">latest version</a> is available at http://www.w3.org/TR/xml.</div>
                  </dd>
                  <dt class="label"><span><a id="xml11"></a>XML11</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml11/"><cite>Extensible Markup Language (XML) 1.1 (Second Edition)</cite></a>, Tim Bray, Jean Paoli, Michael Sperberg-McQueen, <em>et. al.</em>, Editors. World Wide Web Consortium, 16&nbsp;Aug&nbsp;2006. This version is http://www.w3.org/TR/2006/REC-xml11-20060816.
                        The <a href="http://www.w3.org/TR/xml11/">latest version</a> is available at http://www.w3.org/TR/xml11/.</div>
                  </dd>
                  <dt class="label"><span><a id="xml-names"></a>XML Names</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml-names/"><cite>Namespaces in XML 1.0 (Third Edition)</cite></a>, Tim Bray, Dave Hollander, Andrew Layman, <em>et. al.</em>, Editors. World Wide Web Consortium, 08&nbsp;Dec&nbsp;2009. This version is http://www.w3.org/TR/2009/REC-xml-names-20091208/.
                        The <a href="http://www.w3.org/TR/xml-names/">latest version</a> is available at http://www.w3.org/TR/xml-names/.</div>
                  </dd>
                  <dt class="label"><span><a id="xml-names11"></a>XML Names 1.1</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xml-names11/"><cite>Namespaces in XML 1.1 (Second Edition)</cite></a>, Tim Bray, Dave Hollander, Andrew Layman, and Richard Tobin, Editors. World Wide
                        Web Consortium, 16&nbsp;Aug&nbsp;2006. This version is http://www.w3.org/TR/2006/REC-xml-names11-20060816.
                        The <a href="http://www.w3.org/TR/xml-names11/">latest version</a> is available at http://www.w3.org/TR/xml-names11/.</div>
                  </dd>
                  <dt class="label"><span><a id="xmlschema-1"></a>XML Schema</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xmlschema-1/"><cite>XML Schema Part 1: Structures Second Edition</cite></a>, Henry Thompson, David Beech, Murray Maloney, and Noah Mendelsohn, Editors. World
                        Wide Web Consortium, 28&nbsp;Oct&nbsp;2004. This version is http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/.
                        The <a href="http://www.w3.org/TR/xmlschema-1/">latest version</a> is available at http://www.w3.org/TR/xmlschema-1/.</div>
                  </dd>
                  <dt class="label"><span><a id="xpath-40"></a>XML Path Language (XPath) 4.0</span></dt>
                  <dd>
                     <div>
                        <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html"><cite>XML Path Language (XPath) 4.0</cite></a>,
                        XSLT Extensions Community Group,
                        World Wide Web Consortium.</div>
                  </dd>
                  <dt class="label"><span><a id="xquery-40"></a>XQuery 4.0: An XML Query Language</span></dt>
                  <dd>
                     <div>
                        <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html"><cite>XQuery 4.0: An XML Query Language</cite></a>,
                        XSLT Extensions Community Group,
                        World Wide Web Consortium.</div>
                  </dd>
                  <dt class="label"><span><a id="xslt-40"></a>XSL Transformations (XSLT) Version 4.0</span></dt>
                  <dd>
                     <div>
                        <a href="https://qt4cg.org/specifications/xslt-40/Overview.html"><cite>XSL Transformations (XSLT) Version 4.0</cite></a>,
                        XSLT Extensions Community Group,
                        World Wide Web Consortium.</div>
                  </dd>
                  <dt class="label"><span><a id="rfc7159"></a>RFC 7159</span></dt>
                  <dd>
                     <div>IETF. 
                        <em>RFC 7159: The Javascript Object Notation (JSON) Data Interchange Format</em><span>,
                           T. Bray, Editor.
                           Internet Engineering Task Force, March 2014.</span>
                        Available at:
                        <a href="http://www.rfc-editor.org/rfc/rfc7159.txt">http://www.rfc-editor.org/rfc/rfc7159.txt</a>
                        </div>
                  </dd>
               </dl>
            </div>
            <div class="div2">
               
               <h3><a id="informative-references"></a>A.2 <a href="#informative-references" style="text-decoration: none">Informative References</a></h3>
               <dl>
                  <dt class="label"><span><a id="ECMA-404"></a>The JSON Data Interchange Format</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.ecma-international.org/publications/standards/Ecma-404.htm"><cite>The JSON Data Interchange Format</cite></a>,
                        ECMA International.
                        </div>
                  </dd>
                  <dt class="label"><span><a id="xhtml-modularization"></a>XHTML Modularization</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/xhtml-modularization/"><cite>XHTML™ Modularization 1.1 - Second Edition</cite></a>, Shane McCarron, Editor. World Wide Web Consortium, 29&nbsp;Jul&nbsp;2010. This version is
                        http://www.w3.org/TR/2010/REC-xhtml-modularization-20100729. The <a href="http://www.w3.org/TR/xhtml-modularization/">latest version</a> is available at http://www.w3.org/TR/xhtml-modularization/.</div>
                  </dd>
                  <dt class="label"><span><a id="xpath-datamodel"></a>XQuery 1.0 and XPath 2.0 Data Model</span></dt>
                  <dd>
                     <div>
                        <a href="https://www.w3.org/TR/xpath-datamodel/"><cite>XQuery 1.0 and XPath 2.0 Data Model (XDM) (Second Edition)</cite></a>,
                        Norman Walsh, Mary Fernández, Ashok Malhotra, <em>et. al.</em>, Editors.
                        World Wide Web Consortium,
                        14 December 2010.
                        This version is https://www.w3.org/TR/2010/REC-xpath-datamodel-20101214/.
                        The <a href="https://www.w3.org/TR/xpath-datamodel/">latest version</a>
                        is available at https://www.w3.org/TR/xpath-datamodel/.</div>
                  </dd>
                  <dt class="label"><span><a id="serialization-10-2ed"></a>XSLT 2.0 and XQuery 1.0 Serialization (Second Edition)</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/2010/REC-xslt-xquery-serialization-20101214/"><cite>XSLT 2.0 and XQuery 1.0 Serialization (Second Edition), W3C Recommendation</cite></a>, 
                        Henry Zongaro, Norman Walsh, Joanne Tong, <em>et. al.</em>, Editors. 
                        World Wide Web Consortium, 14&nbsp; December&nbsp; 2010. 
                        This version is http://www.w3.org/TR/2010/REC-xslt-xquery-serialization-20101214/</div>
                  </dd>
                  <dt class="label"><span><a id="serialization-40-fpwd"></a>XSLT and XQuery Serialization 4.0 (First Public Working Draft)</span></dt>
                  <dd>
                     <div>
                        <a href="http://www.w3.org/TR/2014/WD-xslt-xquery-serialization-40-20140424/"><cite>XSLT and XQuery 
                              Serialization, W3C First Public Working Draft</cite></a>, 
                        Andrew Coleman, C.&nbsp;M.&nbsp;Sperberg-McQueen, <em>et. al.</em>, Editors. 
                        World Wide Web Consortium, 24&nbsp;April&nbsp;2014.</div>
                  </dd>
               </dl>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="serparams-schema"></a>B <a href="#serparams-schema" style="text-decoration: none">Schema for Serialization Parameters</a></h2>
            <p>The following schema describes the structure of a <a title="parameter document" class="termref" href="#dt-parameter-document">parameter document</a>
that can be used to specify the settings of serialization parameters using
the mechanism described in <a href="#serparams-in-xdm-instance"><b>3.1 Setting Serialization Parameters by Means of a Parameter Document</b></a>.</p>
            <p>A copy of this schema is available at
<a href="http://www.w3.org/2017/01/xslt-xquery-serialization/schema-for-serialization-parameters.xsd">http://www.w3.org/2017/01/xslt-xquery-serialization/schema-for-serialization-parameters.xsd</a>.</p>
            <pre>&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    targetNamespace="http://www.w3.org/2010/xslt-xquery-serialization"
    xmlns:output="http://www.w3.org/2010/xslt-xquery-serialization"
    elementFormDefault="qualified"&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      This is a schema for serialization parameters for XSLT and
      XQuery Serialization 3.1.

      This schema is available for use under the conditions of the
      W3C Software License published at
      http://www.w3.org/Consortium/Legal/copyright-software-19980720
      
      It defines a schema for XML Infoset instances with which a
      user of a host language MAY specify serialization parameters
      for use in serializing an instance of the XQuery and XPath
      Data Model.  It also provides hooks that allow the inclusion
      of implementation- defined serialization parameters and
      implementation-defined modifiers to serialization parameters.
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:simpleType name="EQName"&gt;
    &lt;!--* In principle, this could be declared as a single-step
        * restriction of xs:token with the pattern
        * "Q\{(.*)\}[\i-[:]][\c-[:]]*".  We derive it in two
        * steps because a bug causes some widely used processors 
        * not to support character-class subtraction.
        *--&gt;
    &lt;xs:restriction&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="xs:token"&gt;
          &lt;xs:pattern value="Q\{[^{}]*\}[\i][\c]*"/&gt;
          &lt;xs:whiteSpace value="collapse"/&gt;
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
      &lt;xs:pattern value="Q\{.*\}[^:]*"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  
  &lt;xs:simpleType name="Prefixed-QName"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        Prefixed-QName matches only QNames with a non-null prefix:  
        that is, only QNames with a colon.
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:restriction base="xs:QName"&gt;
      &lt;xs:pattern value=".*:.*"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
  
  &lt;xs:simpleType name="Qualified-EQName"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;
        Qualified-EQName matches only EQNames with a non-null namespace name.
      &lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
    &lt;xs:restriction base="output:EQName"&gt;
      &lt;xs:pattern value=".*\{(.*\S.*)\}.*"/&gt;
    &lt;/xs:restriction&gt;    
  &lt;/xs:simpleType&gt;
  
  &lt;xs:simpleType name="QName-or-EQName"&gt;
    &lt;xs:union memberTypes="xs:QName output:EQName"/&gt; 
  &lt;/xs:simpleType&gt;   
  
  &lt;xs:simpleType name="QNames-type"&gt;
    &lt;xs:list itemType="output:QName-or-EQName"/&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="yes-no-type"&gt;
    &lt;xs:restriction base="xs:token"&gt;
      &lt;xs:enumeration value="no"/&gt;
      &lt;xs:enumeration value="yes"/&gt;
      &lt;xs:enumeration value="false"/&gt;
      &lt;xs:enumeration value="true"/&gt;
      &lt;xs:enumeration value="0"/&gt;
      &lt;xs:enumeration value="1"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="yes-no-omit-type"&gt;
    &lt;xs:restriction base="xs:token"&gt;
      &lt;xs:enumeration value="no"/&gt;
      &lt;xs:enumeration value="omit"/&gt;
      &lt;xs:enumeration value="yes"/&gt;
      &lt;xs:enumeration value="false"/&gt;
      &lt;xs:enumeration value="true"/&gt;
      &lt;xs:enumeration value="0"/&gt;
      &lt;xs:enumeration value="1"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="char-type"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:maxLength value="1"/&gt;
      &lt;xs:minLength value="1"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="encoding-string-type"&gt;
    &lt;xs:restriction base="xs:token"&gt;
      &lt;xs:pattern value="[A-Za-z][A-Za-z0-9._\-]*"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="json-node-output-method-type"&gt;
    &lt;xs:union&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="xs:token"&gt;
          &lt;xs:enumeration value="html"/&gt;
          &lt;xs:enumeration value="text"/&gt;
          &lt;xs:enumeration value="xml"/&gt;
          &lt;xs:enumeration value="xhtml"/&gt;
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="output:EQName"&gt;
          &lt;xs:pattern value="Q\{\s*\}(html|text|xml|xhtml)"/&gt;
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
      &lt;!--* other values must have non-null namespace URI *--&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="output:Prefixed-QName"/&gt;        
      &lt;/xs:simpleType&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="output:Qualified-EQName"/&gt;        
      &lt;/xs:simpleType&gt;
    &lt;/xs:union&gt;
  &lt;/xs:simpleType&gt;

  &lt;!--
     - Serialization parameter element for json-lines
       parameter
    --&gt;
  &lt;xs:element id="json-lines" 
              name="json-linestype"
              type="output:yes-no-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;xs:simpleType name="method-type"&gt;
    &lt;xs:union&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="xs:token"&gt;
          &lt;xs:enumeration value="html"/&gt;
          &lt;xs:enumeration value="text"/&gt;
          &lt;xs:enumeration value="xml"/&gt;
          &lt;xs:enumeration value="xhtml"/&gt;
          &lt;xs:enumeration value="json"/&gt;
          &lt;xs:enumeration value="adaptive"/&gt;
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="output:EQName"&gt;
          &lt;xs:pattern value="Q\{\s*\}(html|text|xml|xhtml|json|adaptive)"/&gt;
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
      &lt;!--* other values must have non-null namespace URI *--&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="output:Prefixed-QName"/&gt;        
      &lt;/xs:simpleType&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="output:Qualified-EQName"/&gt;        
      &lt;/xs:simpleType&gt;
    &lt;/xs:union&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="pubid-char-string-type"&gt;
    &lt;xs:restriction base="xs:token"&gt;
      &lt;xs:pattern value="([- \r\n\ta-zA-Z0-9'()+,./:=?;!*#@$_%])*"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="system-id-string-type"&gt;
    &lt;xs:restriction base="xs:string"&gt;
      &lt;xs:pattern value="[^']*|[^&amp;quot;]*"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;!--
     - Base type of all serialization parameter types
    --&gt;
  &lt;xs:complexType name="base-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="xs:anyType"&gt;
        &lt;xs:anyAttribute namespace="##other" 
                         processContents="lax"/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Generic string serialization parameters
    --&gt;
  &lt;xs:complexType name="string-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="xs:string" 
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;
  
  &lt;!--
     - Generic tokenized string serialization parameters
    --&gt;
  &lt;xs:complexType name="tokenized-string-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
          type="xs:token" 
          use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Generic decimal serialization parameters
    --&gt;
  &lt;xs:complexType name="decimal-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="xs:decimal" 
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter type for "yes", "no", "true", "false", "0" or "1"
     - serialization parameters
    --&gt;
  &lt;xs:complexType name="yes-no-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="output:yes-no-type" 
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter type for list of xs:QName
     - serialization parameters
    --&gt;
  &lt;xs:complexType name="QNames-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="output:QNames-type" 
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter type for "yes", "no", "true", "false", "0", "1" or "omit"
     - serialization parameters
    --&gt;
  &lt;xs:complexType name="yes-no-omit-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="output:yes-no-omit-type"
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter type for NMTOKEN serialization
       parameters
    --&gt;
  &lt;xs:complexType name="NMTOKEN-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="xs:NMTOKEN" 
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Base element declaration for all serialization parameter
       elements
    --&gt;
  &lt;xs:element name="serialization-parameter-element"
              abstract="true"
              type="output:base-param-type"/&gt;

  &lt;!--
     - Serialization parameter element for allow-duplicate-names
       parameter
    --&gt;
  &lt;xs:element id="allow-duplicate-names" 
              name="allow-duplicate-names" 
              type="output:yes-no-param-type"
              substitutionGroup 
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for byte-order-mark
       parameter
    --&gt;
  &lt;xs:element id="byte-order-mark" 
              name="byte-order-mark" 
              type="output:yes-no-param-type"
              substitutionGroup 
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for cdata-section-elements
       parameter
    --&gt;
  &lt;xs:element id="cdata-section-elements" 
              name="cdata-section-elements" 
              type="output:QNames-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter type for doctype-public parameter
    --&gt;
  &lt;xs:complexType name="doctype-public-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="output:pubid-char-string-type"
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter element for doctype-public parameter
    --&gt;
  &lt;xs:element id="doctype-public" 
              name="doctype-public" 
              type="output:doctype-public-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter type for doctype-system parameter
    --&gt;
  &lt;xs:complexType name="doctype-system-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="output:system-id-string-type"
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter element for doctype-system parameter
    --&gt;
  &lt;xs:element id="doctype-system" 
              name="doctype-system" 
              type="output:doctype-system-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter type for encoding parameter
    --&gt;
  &lt;xs:complexType name="encoding-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="output:encoding-string-type"
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter element for encoding parameter
    --&gt;
  &lt;xs:element id="encoding" 
              name="encoding" 
              type="output:encoding-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;
  
  &lt;!--
     - Serialization parameter element for escape-solidus
       parameter
    --&gt;
  &lt;xs:element id="escape-solidus"
    name="escape-solidus"
    type="output:yes-no-param-type"
    substitutionGroup
    = "output:serialization-parameter-element"/&gt;
  

  &lt;!--
     - Serialization parameter element for escape-uri-attributes
       parameter
    --&gt;
  &lt;xs:element id="escape-uri-attributes"
              name="escape-uri-attributes"
              type="output:yes-no-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for html-version parameter
    --&gt;
  &lt;xs:element id="html-version" 
              name="html-version"
              type="output:decimal-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for include-content-type
       parameter
    --&gt;
  &lt;xs:element id="include-content-type" 
              name="include-content-type"
              type="output:yes-no-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for indent parameter
    --&gt;
  &lt;xs:element id="indent" 
              name="indent"
              type="output:yes-no-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for item-separator 
       parameter
    --&gt;
  &lt;xs:element id="item-separator" 
              name="item-separator"
              type="output:string-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter type for json-node-output-method parameter
    --&gt;
  &lt;xs:complexType name="json-node-output-method-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="output:json-node-output-method-type"
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter element for json-node-output-method parameter
    --&gt;
  &lt;xs:element id="json-node-output-method" 
              name="json-node-output-method" 
              type="output:json-node-output-method-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for media-type parameter
    --&gt;
  &lt;xs:element id="media-type" 
              name="media-type" 
              type="output:tokenized-string-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter type for method parameter
    --&gt;
  &lt;xs:complexType name="method-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:attribute name="value" 
                      type="output:method-type"
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter element for method parameter
    --&gt;
  &lt;xs:element id="method" 
              name="method" 
              type="output:method-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;
  &lt;!--
     - Serialization parameter element for normalization-form
       parameter
    --&gt;
  &lt;xs:element id="normalization-form" 
              name="normalization-form" 
              type="output:NMTOKEN-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for omit-xml-declaration
       parameter
    --&gt;
  &lt;xs:element id="omit-xml-declaration" 
              name="omit-xml-declaration" 
              type="output:yes-no-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for standalone parameter
    --&gt;
  &lt;xs:element id="standalone" 
              name="standalone" 
              type="output:yes-no-omit-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for suppress-indentation
       parameter
    --&gt;
  &lt;xs:element id="suppress-indentation" 
              name="suppress-indentation" 
              type="output:QNames-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for undeclare-prefixes
       parameter
    --&gt;
  &lt;xs:element id="undeclare-prefixes" 
              name="undeclare-prefixes" 
              type="output:yes-no-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter type for use-character-maps
       parameter
    --&gt;
  &lt;xs:complexType name="use-character-maps-param-type"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="output:base-param-type"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="character-map" 
                      minOccurs="0"
                      maxOccurs="unbounded"&gt;
            &lt;xs:complexType&gt;
              &lt;xs:attribute name="character" 
                            type="output:char-type"/&gt;
              &lt;xs:attribute name="map-string" 
                            type="xs:string"/&gt;
              &lt;xs:anyAttribute namespace="##other"
                               processContents="lax"/&gt;
            &lt;/xs:complexType&gt;
          &lt;/xs:element&gt;
          &lt;xs:any minOccurs="0" 
                  namespace="##other"
                  processContents="lax"/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!--
     - Serialization parameter element for use-character-maps
       parameter
    --&gt;
  &lt;xs:element id="use-character-maps" 
              name="use-character-maps"
              type="output:use-character-maps-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;!--
     - Serialization parameter element for version parameter
    --&gt;
  &lt;xs:element id="version" 
              name="version"
              type="output:tokenized-string-param-type"
              substitutionGroup
              = "output:serialization-parameter-element"/&gt;

  &lt;xs:element name="serialization-parameters"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs="0" maxOccurs="unbounded"&gt;
        &lt;xs:element ref="output:serialization-parameter-element"/&gt;
        &lt;xs:any namespace="##other"
                processContents="lax"/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;
</pre>
         </div>
         <div class="div1">
            
            <h2><a id="id-errors"></a>C <a href="#id-errors" style="text-decoration: none">Summary of Error Conditions</a></h2>
            <p>This document uses the <code>err</code> prefix which represents the
same namespace URI (http://www.w3.org/2005/xqt-errors) as defined in
<a href="#xpath-40">[XML Path Language (XPath) 4.0]</a>.  Use of this
namespace prefix binding in this document is not normative.</p>
            <dl>
               
               
               <dt><a id="ERRSENR0001"></a>err:SENR0001</dt>
               <dd>
                  
                  <p>It is an error if an item in <em>S<sub>6</sub></em> in <a title="sequence normalization" class="termref" href="#sequence-normalization">sequence normalization</a> is an
attribute node, a namespace node, or a
<a title="function item" class="termref" href="#dt-function-item">function</a>.</p>
               </dd>
               
               
               <dt><a id="ERRSERE0003"></a>err:SERE0003</dt>
               <dd>
                  
                  <p>It is an error if the <a title="serializer" class="termref" href="#serializer">serializer</a> is unable to satisfy the rules
for either a well-formed XML document entity or a well-formed XML
external general parsed entity, or both, except for content modified
by the character expansion phase of serialization.</p>
               </dd>
               
               
               <dt><a id="ERRSEPM0004"></a>err:SEPM0004</dt>
               <dd>
                  
                  <p>It is an error to specify the doctype-system parameter, or to
specify the standalone parameter with a value other than
<code>omit</code>, if the instance of the data model contains text
nodes or multiple element nodes as children of the root
node.</p>
               </dd>
               
               
               <dt><a id="ERRSERE0005"></a>err:SERE0005</dt>
               <dd>
                  
                  <p>It is an error if the serialized result would contain an
<a href="https://www.w3.org/TR/REC-xml-names/#NT-NCName">NCName</a><sup><small>Names</small></sup> that contains a character that is not
permitted by the version of Namespaces in XML specified by the
<code>version</code> parameter.</p>
               </dd>
               
               
               <dt><a id="ERRSERE0006"></a>err:SERE0006</dt>
               <dd>
                  
                  <p>It is an error if the serialized result would contain a character
that is not permitted by the version of XML specified by the
<code>version</code> parameter.</p>
                  </dd>
               
               
               <dt><a id="ERRSESU0007"></a>err:SESU0007</dt>
               <dd>
                  
                  <p>It is an error if an output encoding other than <code>UTF-8</code>
or <code>UTF-16</code> is requested and the <a title="serializer" class="termref" href="#serializer">serializer</a> does not support that
encoding.</p>
               </dd>
               
               
               <dt><a id="ERRSERE0008"></a>err:SERE0008</dt>
               <dd>
                  
                  
                  <p>It is an error if a character that cannot be represented in the
encoding that the <a title="serializer" class="termref" href="#serializer">serializer</a> is
using for output appears in a context where character references are
not allowed (for example if the character occurs in the name of an
element).</p>
               </dd>
               
               
               <dt><a id="ERRSEPM0009"></a>err:SEPM0009</dt>
               <dd>
                  
                  <p>It is an error if the <code>omit-xml-declaration</code> parameter
has the value <code>yes</code>, 
<span><code>true</code> or <code>1</code></span>,
and the <code>standalone</code>
attribute has a value other than <code>omit</code>; or the
<code>version</code> parameter has a value other than <code>1.0</code>
and the <code>doctype-system</code> parameter is
specified.</p>
               </dd>
               
               
               <dt><a id="ERRSEPM0010"></a>err:SEPM0010</dt>
               <dd>
                  
                  <p>It is an error if the output method is <code>xml</code> or
<code>xhtml</code>, the value of the <code>undeclare-prefixes</code>
parameter is 
<span>one of</span>
<code>yes</code>,
<span> <code>true</code> or <code>1</code></span>,
and the value of the
<code>version</code> parameter is 1.0.</p>
               </dd>
               
               
               <dt><a id="ERRSESU0011"></a>err:SESU0011</dt>
               <dd>
                  
                  <p>It is an error if the value of the <code>normalization-form</code>
parameter specifies a normalization form that is not supported by the
<a title="serializer" class="termref" href="#serializer">serializer</a>.</p>
               </dd>
               
               
               <dt><a id="ERRSERE0012"></a>err:SERE0012</dt>
               <dd>
                  
                  <p>It is an error if the value of the <code>normalization-form</code>
parameter is <code>fully-normalized</code> and any relevant construct
of the result begins with a combining character.</p>
               </dd>
               
               
               <dt><a id="ERRSESU0013"></a>err:SESU0013</dt>
               <dd>
                  
                  <p>It is an error if the <a title="serializer" class="termref" href="#serializer">serializer</a> does not support the version of
XML or HTML specified by the <code>version</code> parameter.</p>
                  </dd>
               
               
               <dt><a id="ERRSERE0014"></a>err:SERE0014</dt>
               <dd>
                  
                  <p>It is an error to use the HTML output method if characters which
are permitted in XML but not in HTML appear in the instance of the
data model.</p>
               </dd>
               
               
               <dt><a id="ERRSERE0015"></a>err:SERE0015</dt>
               <dd>
                  
                  <p>It is an error to use the HTML output method when <code>&gt;</code>
appears within a processing instruction in the data model instance
being serialized.</p>
               </dd>
               
               
               <dt><a id="ERRSEPM0016"></a>err:SEPM0016</dt>
               <dd>
                  
                  <p>It is an error if a parameter value is invalid for the defined
domain.</p>
               </dd>
               
               
               <dt><a id="ERRSEPM0017"></a>err:SEPM0017</dt>
               <dd>
                  
                  <p>It is an error if evaluating an expression in order to extract the
setting of a serialization parameter from a data model instance would
yield an error.</p>
               </dd>
               
               
               <dt><a id="ERRSEPM0018"></a>err:SEPM0018</dt>
               <dd>
                  
                  <p>It is an error if evaluating an expression in order to extract the
setting of the <code>use-character-maps</code> serialization parameter
from a data model instance would yield a sequence of length greater
than one.</p>
               </dd>
               
               
               <dt><a id="ERRSEPM0019"></a>err:SEPM0019</dt>
               <dd>
                  
                  <p>It is an error if an instance of the data model used to specify the
settings of serialization parameters specifies the value of the same
parameter more than once.</p>
               </dd>
               
               
               <dt><a id="ERRSERE0020"></a>err:SERE0020</dt>
               <dd>
                  
                  <p>It is an error if a numeric value being serialized using the 
JSON output method cannot be represented in the JSON grammar
(e.g. <code>+INF</code>, <code>-INF</code>, <code>NaN</code>).
</p>
               </dd>
               
               
               <dt><a id="ERRSERE0021"></a>err:SERE0021</dt>
               <dd>
                  
                  <p>It is an error if a sequence being serialized using the JSON output
method includes items for which no rules are provided in the
appropriate section of the serialization rules.</p>
               </dd>
               
               
               <dt><a id="ERRSERE0022"></a>err:SERE0022</dt>
               <dd>
                  
                  <p>It is an error if a map being serialized using the JSON output method
has two keys with the same string value, unless the 
<code>allow-duplicate-names</code> has the value
<code>yes</code>,
<span> <code>true</code> or <code>1</code></span>.</p>
               </dd>
               
               
               <dt><a id="ERRSERE0023"></a>err:SERE0023</dt>
               <dd>
                  
                  <p>It is an error if a sequence being serialized using the JSON output
method is of length greater than one.</p>
               </dd>
               
               </dl>
         </div>
         <div class="div1">
            
            <h2><a id="list-of-uri-attributes"></a>D <a href="#list-of-uri-attributes" style="text-decoration: none">List of URI Attributes</a></h2>
            <p>The following list of attributes are declared as type <code>%URI</code> or 
  <code>%UriList</code> for a given HTML or XHTML element, with the exception of the 
  <code>name</code> attribute for element <code>A</code> which is not a URI type.  
  The <code>name</code> attribute for element <code>A</code> <span class="verb">should</span> be escaped as is
  recommended by the HTML Recommendation <a href="#html401">[HTML]</a> in Appendix B.2.1.</p>
            <table style="width:500px" class="medium no-code-break">
               <caption>Attributes of type URI</caption>
               <col style="width:200px" span="1">
               <col style="width:300px" span="1">
               <thead>
                  <tr>
                     <th style="text-align:left">Attributes</th>
                     <th style="text-align:left">Elements</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>action</td>
                     <td>FORM</td>
                  </tr>
                  <tr>
                     <td>archive</td>
                     <td>OBJECT</td>
                  </tr>
                  <tr>
                     <td>background</td>
                     <td>BODY</td>
                  </tr>
                  <tr>
                     <td>cite</td>
                     <td>BLOCKQUOTE, DEL, INS, Q</td>
                  </tr>
                  <tr>
                     <td>classid</td>
                     <td>OBJECT</td>
                  </tr>
                  <tr>
                     <td>codebase</td>
                     <td>APPLET, OBJECT</td>
                  </tr>
                  <tr>
                     <td>data</td>
                     <td>OBJECT</td>
                  </tr>
                  <tr>
                     <td>datasrc</td>
                     <td>BUTTON, DIV, INPUT, OBJECT, SELECT, SPAN, TABLE, TEXTAREA</td>
                  </tr>
                  <tr>
                     <td>for</td>
                     <td>SCRIPT</td>
                  </tr>
                  <tr>
                     <td>formaction</td>
                     <td>BUTTON, INPUT</td>
                  </tr>
                  <tr>
                     <td>href</td>
                     <td>A, AREA, BASE, LINK</td>
                  </tr>
                  <tr>
                     <td>icon</td>
                     <td>COMMAND</td>
                  </tr>
                  <tr>
                     <td>longdesc</td>
                     <td>FRAME, IFRAME, IMG</td>
                  </tr>
                  <tr>
                     <td>manifest</td>
                     <td>HTML</td>
                  </tr>
                  <tr>
                     <td>name</td>
                     <td>A</td>
                  </tr>
                  <tr>
                     <td>poster</td>
                     <td>VIDEO</td>
                  </tr>
                  <tr>
                     <td>profile</td>
                     <td>HEAD</td>
                  </tr>
                  <tr>
                     <td>src</td>
                     <td>AUDIO, EMBED, FRAME, IFRAME, IMG, INPUT, SCRIPT, SOURCE, TRACK, VIDEO</td>
                  </tr>
                  <tr>
                     <td>usemap</td>
                     <td>IMG, INPUT, OBJECT</td>
                  </tr>
                  <tr>
                     <td>value</td>
                     <td>INPUT</td>
                  </tr>
               </tbody>
            </table>
         </div>
         <div class="div1">
            
            <h2><a id="id-glossary"></a>E <a href="#id-glossary" style="text-decoration: none">Glossary</a> (Non-Normative)</h2>
            <dl>
               <dt><a href="#dt-array-item">array item</a></dt>
               <dd>
                  <p>The term
<b>array item</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#array-items">Section 7.3 Array Items</a><sup><small>DM</small></sup>.</p>
               </dd>
               <dt><a href="#dt-atomization">atomize</a></dt>
               <dd>
                  <p>The term <b>atomization</b> is defined
in <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-atomization">Section 2.5.3 Atomization</a><sup><small>XP</small></sup>.</p>
               </dd>
               <dt><a href="#dt-character">character</a></dt>
               <dd>
                  <p>The term
<b>character</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#xml-and-xsd-versions">Section 4.1.5 XML and XSD Versions</a><sup><small>DM</small></sup>.</p>
               </dd>
               <dt><a href="#dt-codepoint">codepoint</a></dt>
               <dd>
                  <p>The term
<b>codepoint</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#xml-and-xsd-versions">Section 4.1.5 XML and XSD Versions</a><sup><small>DM</small></sup>.</p>
               </dd>
               <dt><a href="#content">content</a></dt>
               <dd>
                  <p>The term <b>content</b> has the
same meaning as the term <a href="https://www.w3.org/TR/REC-xml/#dt-content">Content</a><sup><small>XML</small></sup>
defined in <a href="https://www.w3.org/TR/REC-xml/#sec-starttags">Section 
3.1 Start-Tags, End-Tags, and Empty-Element Tags</a><sup><small>XML</small></sup> of
<a href="#xml">[XML10]</a>.</p>
               </dd>
               <dt><a href="#XHTMLEMPTY">EMPTY</a></dt>
               <dd>
                  <p>The following XHTML elements have an <b>EMPTY</b> content model: <code>area</code>, <code>base</code>, <code>br</code>, <code>col</code>, <code>embed</code>, <code>hr</code>, <code>img</code>, <code>input</code>, <code>link</code>, <code>meta</code>, <code>basefont</code>, <code>frame</code>,  <code>isindex</code>, and <code>param</code>.</p>
               </dd>
               <dt><a href="#dt-expanded-qname">expanded QName</a></dt>
               <dd>
                  <p>The term <b>expanded QName</b>
is defined in <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-basics">Section 2 Basics</a><sup><small>XP</small></sup>. 
An <a title="expanded QName" class="termref" href="#dt-expanded-qname">expanded QName</a> consists of an optional namespace URI and a local name. An <a title="expanded QName" class="termref" href="#dt-expanded-qname">expanded QName</a> also retains its original namespace prefix (if any), to facilitate casting the expanded QName into a string.</p>
               </dd>
               <dt><a href="#XHTMLEXPECTEDEMPTY">expected-empty</a></dt>
               <dd>
                  <p>An element node is <b>expected to be empty</b> if
it is <a title="recognized as an HTML element" class="termref" href="#recognized-as-HTML">recognized as an HTML element</a>
and if either</p>
                  <ul>
                     <li>
                        <p>the <code>html-version</code> serialization parameter is
absent or has a value less than <code>5.0</code> and the content model is
<a title="EMPTY" class="termref" href="#XHTMLEMPTY">EMPTY</a>, or</p>
                     </li>
                     <li>
                        <p>the <code>html-version</code> serialization parameter has the value
<code>5.0</code> and the element is a <a title="void" class="termref" href="#XHTMLVOID">void</a>
element.</p>
                     </li>
                  </ul>
               </dd>
               <dt><a href="#dt-function-item">function item</a></dt>
               <dd>
                  <p>The term
<b>function item</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#function-items">Section 7.1 Function Items</a><sup><small>DM</small></sup>.</p>
               </dd>
               <dt><a href="#host-language">host language</a></dt>
               <dd>
                  <p>
A <b>host language</b> is another
specification that includes, by reference, this specification and all of
its requirements.  A host language might be a programming language
such as <a href="#xslt-40">[XSL Transformations (XSLT) Version 4.0]</a> or <a href="#xquery-40">[XQuery 4.0: An XML Query Language]</a>, or it
might be an application programming interface (API) intended to be used by
programs written in some other high-level programming language.  The use of
the term <em>language</em> is not intended to preclude the possibility that
this specification might be referenced outside the context of a
programming language specification.</p>
               </dd>
               <dt><a href="#immediate-content">immediate content</a></dt>
               <dd>
                  <p>
The <b>immediate content</b> of an element is the part of the
<a title="content" class="termref" href="#content">content</a> of the element that is not
also in the <a title="content" class="termref" href="#content">content</a> of a child element
of that element.</p>
               </dd>
               <dt><a href="#impdef">implementation-defined</a></dt>
               <dd>
                  <p><b>Implementation-defined</b> indicates an
aspect that <span class="verb">may</span> differ between
<a title="serializer" class="termref" href="#serializer">serializers</a>, but whose actual
behavior <span class="verb">must</span> be specified either by another specification that sets
conformance criteria for serialization (see <a href="#conformance"><b>12 Conformance</b></a>)
or in documentation that accompanies the
<a title="serializer" class="termref" href="#serializer">serializer</a>.</p>
               </dd>
               <dt><a href="#impdep">implementation-dependent</a></dt>
               <dd>
                  <p><b>Implementation-dependent</b> indicates an
aspect that <span class="verb">may</span> differ between
<a title="serializer" class="termref" href="#serializer">serializers</a>, and whose actual
behavior is not <span class="verb">required</span>  to be specified either by another specification
that sets conformance criteria for serialization (see
<a href="#conformance"><b>12 Conformance</b></a>) or in documentation that accompanies the
<a title="serializer" class="termref" href="#serializer">serializer</a>.</p>
               </dd>
               <dt><a href="#dt-input-tree">input tree</a></dt>
               <dd>
                  <p>In general the output of the serializer
    will represent the items actually present in the input value, together with other items that are reachable
    from these, for example (in the case of nodes) their descendants. The complete set of items that
    are represented in the output of the serializer is referred to (without loss of generality) as the 
    <b>input tree</b>.</p>
               </dd>
               <dt><a href="#dt-input-value">input value</a></dt>
               <dd>
                  <p>The XDM value supplied as input to the serializer
is referred to as the <b>input value</b>.</p>
               </dd>
               <dt><a href="#dt-map-item">map item</a></dt>
               <dd>
                  <p>The term
<b>map item</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#map-items">Section 7.2 Map Items</a><sup><small>DM</small></sup>.</p>
               </dd>
               <dt><a href="#mathml-namespace">MathML namespace</a></dt>
               <dd>
                  <p>the
<b>MathML namespace</b> namespace,
<code>https://www.w3.org/1998/Math/MathML</code>.</p>
               </dd>
               <dt><a href="#dt-node">node</a></dt>
               <dd>
                  <p>The term <b>node</b>
is defined as part of   <span class="markup-error">[TITLE OF DM40 SPEC, TITLE OF Node SECTION]<sup><small>DM40</small></sup></span>. 
There are seven kinds of <a title="node" class="termref" href="#dt-node">nodes</a> in the data model: document, element, attribute, text, namespace, processing instruction, and comment.</p>
               </dd>
               <dt><a href="#non-null-namespace-URI">non-null namespace URI</a></dt>
               <dd>
                  <p>An element or attribute that does not have a <a title="null namespace URI" class="termref" href="#null-namespace-URI">null namespace URI</a>, is referred to as having a <b>non-null namespace URI</b></p>
               </dd>
               <dt><a href="#null-namespace-URI">null namespace URI</a></dt>
               <dd>
                  <p>
An <a title="expanded QName" class="termref" href="#dt-expanded-qname">expanded-QName</a> whose 
namespace part is an empty sequence,
or an element or attribute whose name expands to such 
an <a title="expanded QName" class="termref" href="#dt-expanded-qname">expanded-QName</a>,
is referred to as having a <b>null namespace URI</b></p>
               </dd>
               <dt><a href="#output-namespace">Output declaration namespace</a></dt>
               <dd>
                  <p>the
<b>Output declaration namespace</b>,
<code>https://www.w3.org/2010/xslt-xquery-serialization</code></p>
               </dd>
               <dt><a href="#dt-parameter-document">parameter document</a></dt>
               <dd>
                  <p>An 
    <code>output:serialization-parameters</code> element node
  used to hold the settings of serialization parameters is referred to as a <b>parameter document</b></p>
               </dd>
               <dt><a href="#PREFIXNORMALIZATION">prefix normalization</a></dt>
               <dd>
                  <p>During
  <b>prefix normalization</b>, any element node in the 
  <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> that is in one of the
<a title="XHTML namespace" class="termref" href="#xhtml-namespace">XHTML namespace</a>, the
<a title="SVG namespace" class="termref" href="#svg-namespace">SVG namespace</a> or the
<a title="MathML namespace" class="termref" href="#mathml-namespace">MathML namespace</a> has its name
replaced by the local part of its name.  Such an element node is given a
default namespace node whose value is the element’s namespace URI.  Any
namespace node for any of those three namespaces that was previously present
on any element node in the <a title="input tree" class="termref" href="#dt-input-tree">input tree</a> is also removed,
unless the prefix that that namespace node declared is used as the prefix on
the name of an attribute on that element or an ancestor of that
element.</p>
               </dd>
               <dt><a href="#recognized-as-HTML">recognized as an HTML element</a></dt>
               <dd>
                  <p>An element node is <b>recognized as an
HTML element</b> by the XHTML output method if</p>
                  <ul>
                     <li>
                        <p>the element node is in the
<a title="XHTML namespace" class="termref" href="#xhtml-namespace">XHTML namespace</a>,
regardless of the value of the
<code>html-version</code>
serialization parameter
or if the <code>html-version</code>
serialization parameter is absent; or</p>
                     </li>
                     <li>
                        <p>the value of the
<code>html-version</code>
serialization parameter is
<code>5.0</code>, the element has a
<a title="null namespace URI" class="termref" href="#null-namespace-URI">null namespace URI</a>, and
the local part of the name is equal
to the name of an element defined by HTML5 <a href="#html5">[HTML5]</a>,
making the comparison
<a title="without regard to case" class="termref" href="#caseless-compare">without regard to case</a>.</p>
                     </li>
                  </ul>
               </dd>
               <dt><a href="#reconstructed-tree">reconstructed tree</a></dt>
               <dd>
                  <p>A <b>reconstructed tree</b> may be
constructed by parsing the XML document and converting it into an
document node as specified in 
<a href="#xpath-datamodel-40">[XQuery and XPath Data Model (XDM) 4.0]</a>.</p>
               </dd>
               <dt><a href="#req-html-ver">requested HTML version</a></dt>
               <dd>
                  <p>
If the
<code>html-version</code> serialization parameter is not absent, the
<b>requested HTML version</b> is the value of the
<code>html-version</code> serialization parameter; otherwise, it is
the value of the <code>version</code> serialization
parameter.</p>
               </dd>
               <dt><a href="#result-tree">result tree</a></dt>
               <dd>
                  <p>The result of the <a title="sequence normalization" class="termref" href="#sequence-normalization">sequence normalization</a> process is a <b>result tree</b>.</p>
               </dd>
               <dt><a href="#dt-sequence">sequence</a></dt>
               <dd>
                  <p>The term <b>sequence</b>
is defined in <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-basics">Section 2 Basics</a><sup><small>XP</small></sup>. 
A <a title="sequence" class="termref" href="#dt-sequence">sequence</a> is an ordered collection of zero or more items.</p>
               </dd>
               <dt><a href="#sequence-normalization">sequence normalization</a></dt>
               <dd>
                  <p>The purpose of <b>sequence normalization</b> is
to create a sequence that can be serialized as a
well-formed XML document or external general parsed entity, that
also reflects the content of the input sequence to the extent possible.</p>
               </dd>
               <dt><a href="#serial-err">serialization error</a></dt>
               <dd>
                  <p>In some instances, the
<a title="input tree" class="termref" href="#dt-input-tree">input tree</a> cannot be successfully converted
into a sequence of octets given the set of serialization parameter
(<a href="#serparam"><b>3 Serialization Parameters</b></a>) values specified.  A
<b>serialization error</b> is said to occur in such an instance.</p>
               </dd>
               <dt><a href="#serialize-as-HTML">serialized as an HTML element</a></dt>
               <dd>
                  <p>An element node is <b>serialized as an
HTML element</b> if</p>
                  <ul>
                     <li>
                        <p>the expanded QName of the element has a
<a title="null namespace URI" class="termref" href="#null-namespace-URI">null namespace URI</a>,
regardless of the value of the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>, or
</p>
                     </li>
                     <li>
                        <p>the value of the
<a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
version</a>
is <code>5.0</code> or
greater, and
the element node is in the
<a title="XHTML namespace" class="termref" href="#xhtml-namespace">XHTML namespace</a>.</p>
                     </li>
                  </ul>
               </dd>
               <dt><a href="#serializer">serializer</a></dt>
               <dd>
                  <p>As is indicated in
<a href="#conformance"><b>12 Conformance</b></a>, conformance criteria for serialization
are determined by other specifications that refer to this specification.
A <b>serializer</b> is software that implements some or all of the
requirements of this specification in accordance with such conformance
criteria.</p>
               </dd>
               <dt><a href="#dt-string">string</a></dt>
               <dd>
                  <p>The term
<b>string</b> is defined in
<a href="https://qt4cg.org/specifications/xpath-datamodel-40/#xml-and-xsd-versions">Section 4.1.5 XML and XSD Versions</a><sup><small>DM</small></sup>.</p>
               </dd>
               <dt><a href="#dt-string-value">string value</a></dt>
               <dd>
                  <p>The term <b>string value</b>
is defined in <a href="https://qt4cg.org/specifications/xpath-datamodel-40/#dm-string-value">Section 6.7.12 string-value Accessor</a><sup><small>DM</small></sup>. 
Every <a title="node" class="termref" href="#dt-node">node</a> has a <a title="string value" class="termref" href="#dt-string-value">string value</a>. For example, the <a title="string value" class="termref" href="#dt-string-value">string value</a>
of an element is the concatenation of the <a title="string value" class="termref" href="#dt-string-value">string values</a> of all its descendant text <a title="node" class="termref" href="#dt-node">nodes</a>.</p>
               </dd>
               <dt><a href="#svg-namespace">SVG namespace</a></dt>
               <dd>
                  <p>the
<b>SVG namespace</b>,
<code>https://www.w3.org/2000/svg</code></p>
               </dd>
               <dt><a href="#to-a-json-string">to a JSON string</a></dt>
               <dd>
                  <p>Whenever a value is serialized
<b>to a JSON string</b>, the following procedure is applied to the supplied string:</p>
                  <ol class="enumar">
                     <li>
                        <p>Any character in the string for which character mapping is defined 
(see <a href="#character-maps"><b>11 Character Maps</b></a>) is substituted by the replacement string defined in the character map.</p>
                     </li>
                     <li>
                        <p>
Any other character in the input string (but not a character produced by character mapping) 
is a candidate for 
<a title="Unicode Normalization" class="termref" href="#unicode-normalization">Unicode Normalization</a> if requested by the <code>normalization-form</code> parameter,
and JSON escaping. JSON escaping replaces the characters 
quotation mark, backspace, form-feed, newline, carriage return, 
 tab, or reverse solidus by the corresponding JSON escape sequences
<code>\"</code>, <code>\b</code>, <code>\f</code>, <code>\n</code>,
  <code>\r</code>, <code>\t</code>, or <code>\\</code> 
respectively, and any other codepoint in the 
range 1-31 or 127-159 by an escape in the form <code>\uHHHH</code> 
where <code>HHHH</code> is the hexadecimal representation of the codepoint value.
  <span>Escaping further replaces the solidus character (<code>/</code>)
  by the escape sequence <code>\/</code> if the <code>escape-solidus</code> parameter
  is set to <code>true</code>, but not if it is
  set to <code>false</code>.</span>
Escaping is also applied to any characters that cannot be represented in the selected encoding.
</p>
                     </li>
                     <li>
                        <p>The resulting string is enclosed in double quotation marks.</p>
                     </li>
                  </ol>
               </dd>
               <dt><a href="#unicode-normalization">Unicode Normalization</a></dt>
               <dd>
                  <p><b>Unicode Normalization</b>
is the process of removing alternative representations of equivalent sequences from textual data,
to convert the data into a form that can be binary-compared for equivalence, as specified in 
<a href="#UNICODE-NORMALIZATION-FORM">[UAX #15: Unicode Normalization Forms]</a>.   
For specific recommendations for character normalization on the World Wide Web, 
see <a href="#charmod-norm">[Character Model for the World Wide Web 1.0: Normalization]</a>.</p>
               </dd>
               <dt><a href="#uri-attribute-values">URI attribute values</a></dt>
               <dd>
                  <p> The values of attributes listed in 
<a href="#list-of-uri-attributes"><b>D List of URI Attributes</b></a> are <b>URI attribute values</b>. 
Attributes are not considered to be URI attributes simply because they are namespace declaration attributes or have the type annotation <code>xs:anyURI</code>.</p>
               </dd>
               <dt><a href="#uri-escaping">URI Escaping</a></dt>
               <dd>
                  <p><b>URI escaping</b> consists of the following three steps applied in sequence to the content of 
<a title="URI attribute values" class="termref" href="#uri-attribute-values">URI attribute values</a>:</p>
               </dd>
               <dt><a href="#XHTMLVOID">void</a></dt>
               <dd>
                  <p>The
<b>void</b> elements of HTML5 are
<code>area</code>, <code>base</code>,
<code>br</code>, <code>col</code>, <code>embed</code>,
<code>hr</code>, <code>img</code>, <code>input</code>,
<code>keygen</code>, <code>link</code>, <code>meta</code>,
<code>param</code>, <code>source</code>, <code>track</code> and
<code>wbr</code>.</p>
               </dd>
               <dt><a href="#whitespace-char">whitespace character</a></dt>
               <dd>
                  <p>A space character,
TAB character, CR character or NL character is referred to as a
<b>whitespace character</b>.</p>
               </dd>
               <dt><a href="#caseless-compare">without regard to case</a></dt>
               <dd>
                  <p>
Where this specification indicates that two strings are to be
compared <b>without regard to case</b>, the <a title="serializer" class="termref" href="#serializer">serializer</a>
<span class="verb">must</span> translate any characters in the range
<span class="unicode-codepoint">U+0041</span> (<span class="unicode-name">LATIN CAPITAL LETTER A</span>, <code>A</code>)  through <span class="unicode-codepoint">U+005A</span> (<span class="unicode-name">LATIN CAPITAL LETTER Z</span>, <code>Z</code>) 
inclusive, to the corresponding lower-case letters in the range
<span class="unicode-codepoint">U+0061</span> (<span class="unicode-name">LATIN SMALL LETTER A</span>, <code>a</code>)  through <span class="unicode-codepoint">U+007A</span> (<span class="unicode-name">LATIN SMALL LETTER Z</span>, <code>z</code>)  only
for the purposes of making the comparison.  The comparison
succeeds if the two strings are the same length and the code
point of each character in the first string is equal to the
code point of the character in the corresponding position in
the second string.</p>
               </dd>
               <dt><a href="#xhtml-namespace">XHTML namespace</a></dt>
               <dd>
                  <p>the
<b>XHTML namespace</b> namespace,
<code>https://www.w3.org/1999/xhtml</code></p>
               </dd>
               <dt><a href="#XML-ISLAND">XML Island</a></dt>
               <dd>
                  <p>The
portion of the serialized document representing the result of serializing 
an element
that is not to be
<a title="serialized as an HTML element" class="termref" href="#serialize-as-HTML">serialized as an HTML
element</a>
is known as an
<b>XML Island.</b></p>
               </dd>
               <dt><a href="#xml-namespace">XML namespace</a></dt>
               <dd>
                  <p>the
<b>XML namespace</b>,
<code>https://www.w3.org/XML/1998/namespace</code></p>
               </dd>
            </dl>
         </div>
         <div class="div1">
            
            <h2><a id="implementation-defined-or-dependent-features"></a>F <a href="#implementation-defined-or-dependent-features" style="text-decoration: none">Checklist of Implementation-Defined and Implementation-Dependent Features</a> (Non-Normative)</h2>
            <p>This appendix provides a summary of Serialization features whose
  effect is explicitly 
  <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> or <a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a>.</p>
            <div class="div2">
               
               <h3><a id="implementation-defined-features"></a>F.1 <a href="#implementation-defined-features" style="text-decoration: none">Checklist of Implementation-Defined Features</a></h3>
               <p>The following list describes
  Serialization features whose effect is explicitly <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>.  The conformance
  rules (see <a href="#conformance"><b>12 Conformance</b></a>) require vendors to provide
  documentation that explains how these choices have been
  exercised.</p>
               <ol>
                  <li>For any <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
                     output method, it is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
                     whether  <a title="sequence normalization" class="termref" href="#sequence-normalization">sequence normalization</a>
                     process takes place. (See <a href="#serdm"><b>2 Sequence Normalization</b></a>)</li>
                  <li>If the namespace URI is non-null for the <code>method</code> serialization 
                     parameter, then the parameter specifies an <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
                     output method. (See <a href="#serparam"><b>3 Serialization Parameters</b></a>)</li>
                  <li>The effect of additional serialization parameters on the output of the <a title="serializer" class="termref" href="#serializer">serializer</a>, 
                     where the name of such a parameter <span class="verb">must</span> be namespace-qualified, is 
                     <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> 
                     or <a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a>.  
                     The extent of this effect on the output <span class="verb">must not</span> 
                     override the provisions of this specification. 
                     (See <a href="#serparam"><b>3 Serialization Parameters</b></a>)</li>
                  <li>
                     <a title="implementation-defined" class="termref" href="#impdef">Implementation-defined</a> schema components
                     <span class="verb">may</span> be included in the set of schema components
                     that are used in evaluating an XQuery expression or XSLT instruction
                     in the process of using a <a title="parameter document" class="termref" href="#dt-parameter-document">parameter document</a> to determine the 
                     serialization parameters. (See <a href="#serparams-in-xdm-instance"><b>3.1 Setting Serialization Parameters by Means of a Parameter Document</b></a>)</li>
                  <li>If a <span><a title="parameter document" class="termref" href="#dt-parameter-document">parameter document</a></span> 
                     contains elements or attributes that are in a namespace other than
                     <code>http://www.w3.org/2010/xslt-xquery-serialization</code>, the
                     implementation <span class="verb">may</span> interpret them to specify the
                     values of <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
                     serialization parameters in an
                     <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> manner.
                     (See <a href="#serparams-in-xdm-instance"><b>3.1 Setting Serialization Parameters by Means of a Parameter Document</b></a>)</li>
                  <li>The effect of providing an option that allows the encoding phase to be skipped, 
                     so that the result of serialization can be encoded in a way required by a particular
                     destination (e.g., a Java StringBuffer), 
                     is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>.  
                     The <a title="serializer" class="termref" href="#serializer">serializer</a> is not required  to support such an option.
                     (See <a href="#serphases"><b>4 Phases of Serialization</b></a>)</li>
                  <li>If an implementation
                     supports a value of the <code>version</code> parameter for the XML or XHTML
                     output method for which this document does not provide a normative definition,
                     the behavior is
                     <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>. (See <a href="#XML_VERSION"><b>5.1.1 XML Output Method: the version Parameter</b></a>)</li>
                  <li>A <a title="serializer" class="termref" href="#serializer">serializer</a> <span class="verb">may</span> provide an <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> mechanism to place CDATA sections in the <a title="result tree" class="termref" href="#result-tree">result tree</a>. (See <a href="#XML_CDATA-SECTION-ELEMENTS"><b>5.1.4 XML Output Method: the cdata-section-elements Parameter</b></a>)</li>
                  <li>If the value of the <code>normalization-form</code> form parameter is not <code>NFC</code>, <code>NFD</code>,
                     <code>NFKC</code>, <code>NFKD</code>, <code>fully-normalized</code>,
                     or <code>none</code> then the meaning of the value and its effect is
                     <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>. (See <a href="#XML_NORMALIZATION-FORM"><b>5.1.8 XML Output Method: the normalization-form Parameter</b></a>)</li>
                  <li><span>In the XHTML output method, for HTML5, when <code>meta</code> elements are added
                        to the output according to the rules of the <code>include-content-type</code> parameter, it
                        is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> whether the traditional form using
                        an <code>http-equiv</code> attribute or the newer HTML5 form using a <code>charset</code>
                        attribute is produced.</span> (See <a href="#XHTML_INCLUDE-CONTENT-TYPE"><b>6.1.14 XHTML Output Method: the include-content-type Parameter</b></a>)</li>
                  <li>
                     For the HTML output method,
                     it is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>
                     whether the <code>basefont</code>, <code>frame</code> and <code>isindex</code>
                     elements, which are not part of HTML5, are considered to be void elements when
                     the <a title="requested HTML version" class="termref" href="#req-html-ver">requested HTML
                        version</a> has the value <code>5.0</code>.
                     
                     (See <a href="#HTML_MARKUP"><b>7.1 Markup for Elements</b></a>)</li>
                  <li>If an implementation
                     supports a value of the <code>version</code> parameter for the HTML output
                     method for which this document does not provide a normative definition, the
                     behavior is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a>. (See <a href="#HTML_VERSION"><b>7.4.1 HTML Output Method: the version
                           and html-version
                           Parameters</b></a>)</li>
                  <li><span>In the HTML output method, for HTML5, when <code>meta</code> elements are added
                        to the output according to the rules of the <code>include-content-type</code> parameter, it
                        is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> whether the traditional form using
                        an <code>http-equiv</code> attribute or the newer HTML5 form using a <code>charset</code>
                        attribute is produced.</span> (See <a href="#HTML_INCLUDE-CONTENT-TYPE"><b>7.4.11 HTML Output Method: the include-content-type Parameter</b></a>)</li>
                  <li>It is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> whether the
                     serialization process recovers from serialization errors when the
                     Adaptive output method is used.  If it does, it
                     is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> what error
                     indicator is used. (See <a href="#adaptive-output"><b>10 Adaptive Output Method</b></a>)</li>
                  <li>It is <a title="implementation-defined" class="termref" href="#impdef">implementation-defined</a> whether, when the
                     Adaptive output method is used, a serializer includes hyperlinks in
                     its output to record the types of atomic items, the bindings of
                     namespace prefixes, the causes of error indicators, and other
                     information.
                     (See <a href="#adaptive-output"><b>10 Adaptive Output Method</b></a>)</li>
               </ol>
            </div>
            <div class="div2">
               
               <h3><a id="implementation-dependent-features"></a>F.2 <a href="#implementation-dependent-features" style="text-decoration: none">Checklist of Implementation-Dependent Features</a></h3>
               <p>The following list describes Serialization features whose effect is
  explicitly <a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a>.
  The conformance rules (see <a href="#conformance"><b>12 Conformance</b></a>) do not require vendors
  or specifications which define conformance criteria for serialization
  to provide documentation that explains how these choices have been exercised.</p>
               <ol>
                  <li>The octet order of the serialized result sequence of 
                     octets is <a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a>. (See <a href="#serparam"><b>3 Serialization Parameters</b></a>)</li>
                  <li>In those cases where they have no important
                     effect on the content of the serialized result, details of the
                     output methods defined by this specification are left unspecified
                     and are regarded as <a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a>. (See <a href="#serparam"><b>3 Serialization Parameters</b></a>)</li>
                  <li>If, when the
                     Adaptive output method is used, a serializer includes hyperlinks in
                     its output to record the types of atomic items, the bindings of
                     namespace prefixes, the causes of error indicators, and other
                     information, then it is <a title="implementation-dependent" class="termref" href="#impdep">implementation-dependent</a> what hyperlinks are
                     used and how they convey the information.
                     (See <a href="#adaptive-output"><b>10 Adaptive Output Method</b></a>)</li>
               </ol>
            </div>
         </div>
         <div class="div1">
            
            <h2><a id="revision-log"></a>G <a href="#revision-log" style="text-decoration: none">Change Log</a> (Non-Normative)</h2>
            <p>This appendix lists changes made in version 4.0 of this specification.</p>
            <ol>
               <li>
                  <p>Use the arrows to browse significant changes since the 3.1 version of this specification.</p>
                  <p>See <a href="#intro"><b>1 Introduction</b></a></p>
               </li>
               <li>
                  <p>Sections with significant changes are marked Δ in the table of contents.</p>
                  <p>See <a href="#intro"><b>1 Introduction</b></a></p>
               </li>
               <li>
                  <p>
        The term <b>atomic value</b> has been replaced by <b>atomic item</b>.
     </p>
                  <p>See <a href="#terminology"><b>1.1 Terminology</b></a></p>
               </li>
               <li>
                  <p>
      Added the <code>json-lines</code> parameter for JSON serialization.
    </p>
                  <p>See <a href="#serparam"><b>3 Serialization Parameters</b></a></p>
                  <p>See <a href="#json-output"><b>9 JSON Output Method</b></a></p>
               </li>
               <li>
                  <p>PR <a href="https://github.com/qt4cg/qtspecs/pull/342">342&nbsp;</a></p>
                  <p>In the HTML and XHTML output methods, the rules for adding and replacing
      <code>meta</code> elements have been revised to take account of the new HTML5 syntax,
      for example <code>&lt;meta charset="utf-8"&gt;</code>.
    </p>
                  <p>See <a href="#xhtml-output"><b>6 XHTML Output Method</b></a></p>
                  <p>See <a href="#html-output"><b>7 HTML Output Method</b></a></p>
               </li>
               <li>
                  <p>PR <a href="https://github.com/qt4cg/qtspecs/pull/534">534&nbsp;</a></p>
                  <p>
      Added the <code>escape-solidus</code> parameter for JSON serialization.
    </p>
                  <p>See <a href="#serparam"><b>3 Serialization Parameters</b></a></p>
                  <p>See <a href="#json-output"><b>9 JSON Output Method</b></a></p>
                  <p>See <a href="#ADAPTIVE_PARAMS"><b>10.1 The Influence of Serialization Parameters upon the Adaptive Output Method</b></a></p>
               </li>
               <li>
                  <p>PR <a href="https://github.com/qt4cg/qtspecs/pull/1703">1703&nbsp;</a></p>
                  <p>
      The serialization of maps retains the order of entries.
    </p>
                  <p>See <a href="#json-output"><b>9 JSON Output Method</b></a></p>
                  <p>See <a href="#adaptive-output"><b>10 Adaptive Output Method</b></a></p>
               </li>
            </ol>
         </div>
      </div><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script><script src="js/toc.js"></script></body>
</html><!--{xmlspec} XSLT Processor: Saxonica-->